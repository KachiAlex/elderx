/*! For license information please see main.0e7e79b2.js.LICENSE.txt */
(()=>{var e={75:(e,t,n)=>{"use strict";n.d(t,{B:()=>s,t:()=>i});var r=console;function i(){return r}function s(e){r=e}},477:()=>{},548:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){var t=e.words,n=e.sigBytes-1;for(n=e.sigBytes-1;n>=0;n--)if(t[n>>>2]>>>24-n%4*8&255){e.sigBytes=n+1;break}}},t.pad.ZeroPadding)}()},579:(e,t,n)=>{"use strict";e.exports=n(1153)},823:(e,t,n)=>{"use strict";n.d(t,{IX:()=>tt,Oe:()=>vn,kT:()=>mn,eJ:()=>St,xI:()=>lr,VO:()=>Lt,hg:()=>Rt,kZ:()=>vt,J1:()=>wt,x9:()=>Tt,CI:()=>It,f3:()=>Ct,r7:()=>Nt});var r=n(3986),i=n(2555),s=n(9232),a=n(1776),o=n(2965),c=n(9606);const l=["providerId"],d=["uid","auth","stsTokenManager"],u=["providerId","signInMethod"];function h(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const p=h,m=new a.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),f=new o.Vy("@firebase/auth");function g(e){if(f.logLevel<=o.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];f.error("Auth (".concat(s.MF,"): ").concat(e),...n)}}function v(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw b(e,...n)}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return b(e,...n)}function _(e,t,n){const r=(0,i.A)((0,i.A)({},p()),{},{[t]:n});return new a.FA("auth","Firebase",r).create(t,{appName:e.name})}function E(e){return _(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return m.create(e,...n)}function x(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw b(t,...r)}}function w(e){const t="INTERNAL ASSERTION FAILED: "+e;throw g(t),new Error(t)}function S(e,t){e||w(t)}function T(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function N(){return"http:"===C()||"https:"===C()}function C(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class A{constructor(e,t){this.shortDelay=e,this.longDelay=t,S(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,a.jZ)()||(0,a.lV)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(N()||(0,a.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function R(e,t){S(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class I{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void w("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void w("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void w("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const O={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},P=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],k=new A(3e4,6e4);function D(e,t){return e.tenantId&&!t.tenantId?(0,i.A)((0,i.A)({},t),{},{tenantId:e.tenantId}):t}async function L(e,t,n,r){return j(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const c=(0,a.Am)((0,i.A)({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const d=(0,i.A)({method:t,headers:l},s);return(0,a.c1)()||(d.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,a.zJ)(e.emulatorConfig.host)&&(d.credentials="include"),I.fetch()(await U(e,e.config.apiHost,n,c),d)})}async function j(e,t,n){e._canInitEmulator=!1;const r=(0,i.A)((0,i.A)({},O),t);try{const t=new F(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw B(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw B(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw B(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw B(e,"user-disabled",s);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw _(e,o,a);v(e,o)}}catch(s){if(s instanceof a.g)throw s;v(e,"network-request-failed",{message:String(s)})}}async function M(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=await L(e,t,n,r,i);return"mfaPendingCredential"in s&&v(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function U(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r),s=e,a=s.config.emulator?R(e.config,i):"".concat(e.config.apiScheme,"://").concat(i);if(P.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())){return s._getPersistence()._getFinalTarget(a).toString()}return a}function V(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class F{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(y(this.auth,"network-request-failed")),k.get())})}}function B(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=y(e,t,r);return i.customData._tokenResponse=n,i}function G(e){return void 0!==e&&void 0!==e.getResponse}function H(e){return void 0!==e&&void 0!==e.enterprise}class W{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return V(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function z(e,t){return L(e,"GET","/v2/recaptchaConfig",D(e,t))}async function K(e,t){return L(e,"POST","/v1/accounts:lookup",t)}function q(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Y(e){return 1e3*Number(e)}function X(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return g("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,a.u)(n);return e?JSON.parse(e):(g("Failed to decode base64 JWT payload"),null)}catch(i){return g("Caught error parsing JWT payload as JSON",null===i||void 0===i?void 0:i.toString()),null}}function J(e){const t=X(e);return x(t,"internal-error"),x("undefined"!==typeof t.exp,"internal-error"),x("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Q(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof a.g&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class Z{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{var t;this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class ${constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=q(this.lastLoginAt),this.creationTime=q(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ee(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Q(e,K(n,{idToken:r}));x(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const a=null!==(t=s.providerUserInfo)&&void 0!==t&&t.length?te(s.providerUserInfo):[],o=(c=e.providerData,l=a,[...c.filter(e=>!l.some(t=>t.providerId===e.providerId)),...l]);var c,l;const d=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(null!==o&&void 0!==o&&o.length),h=!!d&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new $(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,p)}function te(e){return e.map(e=>{let{providerId:t}=e,n=(0,r.A)(e,l);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class ne{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){x(e.idToken,"internal-error"),x("undefined"!==typeof e.idToken,"internal-error"),x("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):J(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){x(0!==e.length,"internal-error");const t=J(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(x(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await j(e,{},async()=>{const n=(0,a.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=await U(e,r,"/v1/token","key=".concat(i)),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:o,body:n};return e.emulatorConfig&&(0,a.zJ)(e.emulatorConfig.host)&&(c.credentials="include"),I.fetch()(s,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new ne;return n&&(x("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(x("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(x("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ne,this.toJSON())}_performRefresh(){return w("not implemented")}}function re(e,t){x("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class ie{constructor(e){let{uid:t,auth:n,stsTokenManager:i}=e,s=(0,r.A)(e,d);this.providerId="firebase",this.proactiveRefresh=new Z(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new $(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Q(this,this.stsTokenManager.getToken(this.auth,e));return x(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,a.Ku)(e),r=await n.getIdToken(t),i=X(r);x(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"===typeof i.firebase?i.firebase:void 0,o=null===s||void 0===s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:q(Y(i.auth_time)),issuedAtTime:q(Y(i.iat)),expirationTime:q(Y(i.exp)),signInProvider:o||null,signInSecondFactor:(null===s||void 0===s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,a.Ku)(e);await ee(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(x(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>(0,i.A)({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ie((0,i.A)((0,i.A)({},this),{},{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){x(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ee(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,s.xZ)(this.auth.app))return Promise.reject(E(this.auth));const e=await this.getIdToken();return await Q(this,async function(e,t){return L(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return(0,i.A)((0,i.A)({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>(0,i.A)({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{},{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,s,a,o,c,l,d;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,p=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,m=null!==(a=t.photoURL)&&void 0!==a?a:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,v=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(d=t.lastLoginAt)&&void 0!==d?d:void 0,{uid:_,emailVerified:E,isAnonymous:b,providerData:w,stsTokenManager:S}=t;x(_&&S,e,"internal-error");const T=ne.fromJSON(this.name,S);x("string"===typeof _,e,"internal-error"),re(u,e.name),re(h,e.name),x("boolean"===typeof E,e,"internal-error"),x("boolean"===typeof b,e,"internal-error"),re(p,e.name),re(m,e.name),re(f,e.name),re(g,e.name),re(v,e.name),re(y,e.name);const N=new ie({uid:_,auth:e,email:h,emailVerified:E,displayName:u,isAnonymous:b,photoURL:m,phoneNumber:p,tenantId:f,stsTokenManager:T,createdAt:v,lastLoginAt:y});return w&&Array.isArray(w)&&(N.providerData=w.map(e=>(0,i.A)({},e))),g&&(N._redirectEventId=g),N}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new ne;r.updateFromServerResponse(t);const i=new ie({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ee(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];x(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?te(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null!==i&&void 0!==i&&i.length),a=new ne;a.updateFromIdToken(n);const o=new ie({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new $(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null!==i&&void 0!==i&&i.length)};return Object.assign(o,c),o}}const se=new Map;function ae(e){S(e instanceof Function,"Expected a class definition");let t=se.get(e);return t?(S(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,se.set(e,t),t)}class oe{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}oe.type="NONE";const ce=oe;function le(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class de{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=le(this.userKey,r.apiKey,i),this.fullPersistenceKey=le("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await K(this.auth,{idToken:e}).catch(()=>{});return t?ie._fromGetAccountInfoResponse(this.auth,t,e):null}return ie._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new de(ae(ce),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||ae(ce);const s=le(n,e.config.apiKey,e.name);let a=null;for(const l of t)try{const t=await l._get(s);if(t){let n;if("string"===typeof t){const r=await K(e,{idToken:t}).catch(()=>{});if(!r)break;n=await ie._fromGetAccountInfoResponse(e,r,t)}else n=ie._fromJSON(e,t);l!==i&&(a=n),i=l;break}}catch(c){}const o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length?(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(t){}})),new de(i,e,n)):new de(i,e,n)}}function ue(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(fe(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(he(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ve(t))return"Blackberry";if(ye(t))return"Webos";if(pe(t))return"Safari";if((t.includes("chrome/")||me(t))&&!t.includes("edge/"))return"Chrome";if(ge(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function he(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/firefox\//i.test(e)}function pe(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function me(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/crios\//i.test(e)}function fe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/iemobile/i.test(e)}function ge(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/android/i.test(e)}function ve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/blackberry/i.test(e)}function ye(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/webos/i.test(e)}function _e(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ee(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)();return _e(e)||ge(e)||ye(e)||ve(e)||/windows phone/i.test(e)||fe(e)}function be(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=ue((0,a.ZQ)());break;case"Worker":t="".concat(ue((0,a.ZQ)()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(s.MF,"/").concat(r)}class xe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class we{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsNumericCharacter)||void 0===s||s),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Se{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ne(this),this.idTokenSubscription=new Ne(this),this.beforeStateQueue=new xe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=m,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ae(t)),this._initializationPromise=this.queue(async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await de.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null!==(r=this._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await K(this,{idToken:e}),n=await ie._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,s.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){var i,a;await this.getOrInitRedirectPersistenceManager();const t=null===(i=this.redirectUser)||void 0===i?void 0:i._redirectEventId,s=null===(a=n)||void 0===a?void 0:a._redirectEventId,o=await this.tryRedirectSignIn(e);t&&t!==s||null===o||void 0===o||!o.user||(n=o.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return x(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ee(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,s.xZ)(this.app))return Promise.reject(E(this));const t=e?(0,a.Ku)(e):null;return t&&x(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&x(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,s.xZ)(this.app)?Promise.reject(E(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,s.xZ)(this.app)?Promise.reject(E(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ae(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return L(e,"GET","/v2/passwordPolicy",D(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new we(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new a.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return L(e,"POST","/v2/accounts:revokeToken",D(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ae(e)||this._popupRedirectResolver;x(t,this,"argument-error"),this.redirectPersistenceManager=await de.create(this,[ae(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let s=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(x(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return x(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=be(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if((0,s.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return null!==t&&void 0!==t&&t.error&&function(e){if(f.logLevel<=o.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];f.warn("Auth (".concat(s.MF,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function Te(e){return(0,a.Ku)(e)}class Ne{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,a.tD)(e=>this.observer=e)}get next(){return x(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ce={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ae(e){return Ce.loadJS(e)}function Re(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}const Ie=1e12;class Oe{constructor(e){this.auth=e,this.counter=Ie,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new De(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Ie;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Ie;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Ie;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Pe{constructor(){this.enterprise=new ke}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ke{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class De{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"===typeof e?document.getElementById(e):e;x(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Le="NO_RECAPTCHA";class je{constructor(e){this.type="recaptcha-enterprise",this.auth=Te(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;H(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(Le)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Pe).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{z(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new W(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&H(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Ce.recaptchaEnterpriseScript;0!==t.length&&(t+=i),Ae(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Me(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=new je(e);let o;if(s)o=Le;else try{o=await a.verify(n)}catch(l){o=await a.verify(n,!0)}const c=(0,i.A)({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in c){const e=c.phoneEnrollmentInfo.phoneNumber,t=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const e=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function Ue(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i){var s;if(null!==(s=e._getRecaptchaConfig())&&void 0!==s&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Me(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await Me(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}if("PHONE_PROVIDER"===i){var a;if(null!==(a=e._getRecaptchaConfig())&&void 0!==a&&a.isProviderEnabled("PHONE_PROVIDER")){const i=await Me(e,t,n);return r(e,i).catch(async i=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&(i.code==="auth/".concat("missing-recaptcha-token")||i.code==="auth/".concat("invalid-app-credential"))){console.log("Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ".concat(n," flow."));const i=await Me(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{const i=await Me(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}async function Ve(e){const t=Te(e),n=await z(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new W(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new je(t).verify()}}function Fe(e,t,n){const r=Te(e);x(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!(null===n||void 0===n||!n.disableWarnings),s=Be(t),{host:o,port:c}=function(e){const t=Be(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Ge(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ge(t)}}}(t),l=null===c?"":":".concat(c),d={url:"".concat(s,"//").concat(o).concat(l,"/")},u=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return x(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void x((0,a.bD)(d,r.config.emulator)&&(0,a.bD)(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,(0,a.zJ)(o)?((0,a.gE)("".concat(s,"//").concat(o).concat(l)),(0,a.P1)("Auth",!0)):i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Be(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ge(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class He{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return w("not implemented")}_getIdTokenResponse(e){return w("not implemented")}_linkToIdToken(e,t){return w("not implemented")}_getReauthenticationResolver(e){return w("not implemented")}}async function We(e,t){return L(e,"POST","/v1/accounts:signUp",t)}async function ze(e,t){return M(e,"POST","/v1/accounts:signInWithPassword",D(e,t))}async function Ke(e,t){return L(e,"POST","/v1/accounts:sendOobCode",D(e,t))}async function qe(e,t){return Ke(e,t)}class Ye extends He{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ye(e,t,"password")}static _fromEmailAndCode(e,t){return new Ye(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(null!==t&&void 0!==t&&t.email&&null!==t&&void 0!==t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Ue(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",ze,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}(e,{email:this._email,oobCode:this._password});default:v(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ue(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",We,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return M(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:v(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Xe(e,t){return M(e,"POST","/v1/accounts:signInWithIdp",D(e,t))}class Je extends He{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Je(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):v("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=(0,r.A)(t,u);if(!n||!i)return null;const a=new Je(n,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){return Xe(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Xe(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Xe(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,a.Am)(t)}return e}}async function Qe(e,t){return L(e,"POST","/v1/accounts:sendVerificationCode",D(e,t))}const Ze={USER_NOT_FOUND:"user-not-found"};class $e extends He{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new $e({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new $e({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await M(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,t));if(n.temporaryProof)throw B(e,"account-exists-with-different-credential",n);return n}(e,(0,i.A)({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return M(e,"POST","/v1/accounts:signInWithPhoneNumber",D(e,(0,i.A)((0,i.A)({},t),{},{operation:"REAUTH"})),Ze)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new $e({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class et{constructor(e){var t,n,r,i,s,o;const c=(0,a.I9)((0,a.hp)(e)),l=null!==(t=c.apiKey)&&void 0!==t?t:null,d=null!==(n=c.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);x(l&&d&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=d,this.continueUrl=null!==(i=c.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=c.lang)&&void 0!==s?s:null,this.tenantId=null!==(o=c.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=(0,a.I9)((0,a.hp)(e)).link,n=t?(0,a.I9)((0,a.hp)(t)).deep_link_id:null,r=(0,a.I9)((0,a.hp)(e)).deep_link_id;return(r?(0,a.I9)((0,a.hp)(r)).link:null)||r||n||t||e}(e);try{return new et(t)}catch(n){return null}}}class tt{constructor(){this.providerId=tt.PROVIDER_ID}static credential(e,t){return Ye._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=et.parseLink(t);return x(n,"argument-error"),Ye._fromEmailAndCode(e,n.code,n.tenantId)}}tt.PROVIDER_ID="password",tt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",tt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class nt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rt extends nt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class it extends rt{constructor(){super("facebook.com")}static credential(e){return Je._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return it.credential(t.oauthAccessToken)}catch(n){return null}}}it.FACEBOOK_SIGN_IN_METHOD="facebook.com",it.PROVIDER_ID="facebook.com";class st extends rt{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Je._fromParams({providerId:st.PROVIDER_ID,signInMethod:st.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return st.credentialFromTaggedObject(e)}static credentialFromError(e){return st.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return st.credential(n,r)}catch(i){return null}}}st.GOOGLE_SIGN_IN_METHOD="google.com",st.PROVIDER_ID="google.com";class at extends rt{constructor(){super("github.com")}static credential(e){return Je._fromParams({providerId:at.PROVIDER_ID,signInMethod:at.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return at.credentialFromTaggedObject(e)}static credentialFromError(e){return at.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return at.credential(t.oauthAccessToken)}catch(n){return null}}}at.GITHUB_SIGN_IN_METHOD="github.com",at.PROVIDER_ID="github.com";class ot extends rt{constructor(){super("twitter.com")}static credential(e,t){return Je._fromParams({providerId:ot.PROVIDER_ID,signInMethod:ot.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ot.credentialFromTaggedObject(e)}static credentialFromError(e){return ot.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return ot.credential(n,r)}catch(i){return null}}}async function ct(e,t){return M(e,"POST","/v1/accounts:signUp",D(e,t))}ot.TWITTER_SIGN_IN_METHOD="twitter.com",ot.PROVIDER_ID="twitter.com";class lt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await ie._fromIdTokenResponse(e,n,r),s=dt(n);return new lt({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=dt(n);return new lt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function dt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ut extends a.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,ut.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new ut(e,t,n,r)}}function ht(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw ut._fromErrorAndOperation(e,n,t,r);throw n})}async function pt(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await Q(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return lt._forOperation(e,"link",r)}async function mt(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if((0,s.xZ)(r.app))return Promise.reject(E(r));const i="reauthenticate";try{const s=await Q(e,ht(r,i,t,e),n);x(s.idToken,r,"internal-error");const a=X(s.idToken);x(a,r,"internal-error");const{sub:o}=a;return x(e.uid===o,r,"user-mismatch"),lt._forOperation(e,i,s)}catch(a){throw(null===a||void 0===a?void 0:a.code)==="auth/".concat("user-not-found")&&v(r,"user-mismatch"),a}}async function ft(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,s.xZ)(e.app))return Promise.reject(E(e));const r="signIn",i=await ht(e,r,t),a=await lt._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(a.user),a}async function gt(e,t){return ft(Te(e),t)}async function vt(e,t){return mt((0,a.Ku)(e),t)}class yt{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?_t._fromServerResponse(e,t):"totpInfo"in t?Et._fromServerResponse(e,t):v(e,"internal-error")}}class _t extends yt{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new _t(t)}}class Et extends yt{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Et(t)}}function bt(e,t,n){var r;x((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),x("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),x("undefined"===typeof n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(x(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(x(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function xt(e){const t=Te(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function wt(e,t,n){const r=Te(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&bt(r,i,n),await Ue(r,i,"getOobCode",qe,"EMAIL_PASSWORD_PROVIDER")}async function St(e,t,n){if((0,s.xZ)(e.app))return Promise.reject(E(e));const r=Te(e),i=Ue(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ct,"EMAIL_PASSWORD_PROVIDER"),a=await i.catch(t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&xt(e),t}),o=await lt._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function Tt(e,t,n){return(0,s.xZ)(e.app)?Promise.reject(E(e)):gt((0,a.Ku)(e),tt.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&xt(e),t})}async function Nt(e,t){let{displayName:n,photoURL:r}=t;if(void 0===n&&void 0===r)return;const i=(0,a.Ku)(e),s={idToken:await i.getIdToken(),displayName:n,photoUrl:r,returnSecureToken:!0},o=await Q(i,async function(e,t){return L(e,"POST","/v1/accounts:update",t)}(i.auth,s));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const c=i.providerData.find(e=>{let{providerId:t}=e;return"password"===t});c&&(c.displayName=i.displayName,c.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function Ct(e,t){return At((0,a.Ku)(e),null,t)}async function At(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await Q(e,async function(e,t){return L(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(s,!0)}function Rt(e,t,n,r){return(0,a.Ku)(e).onAuthStateChanged(t,n,r)}function It(e){return(0,a.Ku)(e).signOut()}class Ot{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new Ot("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ot("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){if(null!==e&&void 0!==e&&e.multiFactorSession){var t,n;if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Ot._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(n=e.multiFactorSession)&&void 0!==n&&n.idToken)return Ot._fromIdtoken(e.multiFactorSession.idToken)}return null}}function Pt(e,t){return L(e,"POST","/v2/accounts/mfaEnrollment:start",D(e,t))}class kt{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>yt._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new kt(e)}async getSession(){return Ot._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e,r=await this.getSession(),i=await Q(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"===typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await Q(this.user,function(e,t){return L(e,"POST","/v2/accounts/mfaEnrollment:withdraw",D(e,t))}(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(e=>{let{uid:n}=e;return n!==t}),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(r){throw r}}}const Dt=new WeakMap;function Lt(e){const t=(0,a.Ku)(e);return Dt.has(t)||Dt.set(t,kt._fromUser(t)),Dt.get(t)}const jt="__sak";class Mt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(jt,"1"),this.storage.removeItem(jt),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ut extends Mt{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ee(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);(0,a.lT)()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ut.type="LOCAL";const Vt=Ut;function Ft(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=RegExp("".concat(r,"=([^;]+)"));return null!==(t=null===(n=document.cookie.match(i))||void 0===n?void 0:n[1])&&void 0!==t?t:null}function Bt(e){const t="http:"===window.location.protocol;return"".concat(t?"__dev_":"__HOST-","FIREBASE_").concat(e.split(":")[3])}class Gt{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL("".concat(window.location.origin,"/__cookies__"));return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Bt(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return Ft(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=Bt(e);document.cookie="".concat(t,"=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High"),await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=Bt(e);if(window.cookieStore){const e=e=>{const r=e.changed.find(e=>e.name===n);r&&t(r.value);e.deleted.find(e=>e.name===n)&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=Ft(n);const i=setInterval(()=>{const e=Ft(n);e!==r&&(t(e),r=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(i))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}Gt.type="COOKIE";class Ht extends Mt{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ht.type="SESSION";const Wt=Ht;class zt{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new zt(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(null===s||void 0===s||!s.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const a=Array.from(s).map(async e=>e(t.origin,i)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Kt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}zt.receivers=[];class qt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((a,o)=>{const c=Kt("",20);r.port1.start();const l=setTimeout(()=>{o(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),i=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(t.data.response);break;default:clearTimeout(l),clearTimeout(i),o(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function Yt(){return window}function Xt(){return"undefined"!==typeof Yt().WorkerGlobalScope&&"function"===typeof Yt().importScripts}const Jt="firebaseLocalStorageDb",Qt="firebaseLocalStorage",Zt="fbase_key";class $t{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function en(e,t){return e.transaction([Qt],t?"readwrite":"readonly").objectStore(Qt)}function tn(){const e=indexedDB.open(Jt,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Qt,{keyPath:Zt})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(Qt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Jt);return new $t(e).toPromise()}(),t(await tn()))})})}async function nn(e,t,n){const r=en(e,!0).put({[Zt]:t,value:n});return new $t(r).toPromise()}function rn(e,t){const n=en(e,!0).delete(t);return new $t(n).toPromise()}class sn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await tn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Xt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=zt._getInstance(Xt()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){var e;if(null===(e=navigator)||void 0===e||!e.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new qt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=navigator)||void 0===e||null===(e=e.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await tn();return await nn(e,jt,"1"),await rn(e,jt),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>nn(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=en(e,!1).get(t),r=await new $t(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rn(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=en(e,!1).getAll();return new $t(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}sn.type="LOCAL";const an=sn;function on(e,t){return L(e,"POST","/v2/accounts/mfaSignIn:start",D(e,t))}const cn=Re("rcb"),ln=new A(3e4,6e4);class dn{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=Yt().grecaptcha)||void 0===e||!e.render)}load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return x(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&G(Yt().grecaptcha)?Promise.resolve(Yt().grecaptcha):new Promise((n,r)=>{const i=Yt().setTimeout(()=>{r(y(e,"network-request-failed"))},ln.get());Yt()[cn]=()=>{Yt().clearTimeout(i),delete Yt()[cn];const s=Yt().grecaptcha;if(!s||!G(s))return void r(y(e,"internal-error"));const a=s.render;s.render=(e,t)=>{const n=a(e,t);return this.counter++,n},this.hostLanguage=t,n(s)};Ae("".concat(Ce.recaptchaV2Script,"?").concat((0,a.Am)({onload:cn,render:"explicit",hl:t}))).catch(()=>{clearTimeout(i),r(y(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=Yt().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class un{async load(e){return new Oe(e)}clearedOneInstance(){}}const hn="recaptcha",pn={theme:"light",type:"image"};class mn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,i.A)({},pn);this.parameters=n,this.type=hn,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Te(e),this.isInvisible="invisible"===this.parameters.size,x("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"===typeof t?document.getElementById(t):t;x(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new un:new dn,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){x(!this.parameters.sitekey,this.auth,"argument-error"),x(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),x("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"===typeof e)e(t);else if("string"===typeof e){const n=Yt()[e];"function"===typeof n&&n(t)}}}assertNotDestroyed(){x(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){x(N()&&!Xt(),this.auth,"internal-error"),await function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await L(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);x(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return x(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}async function fn(e,t,n){if(!e._getRecaptchaConfig())try{await Ve(e)}catch(i){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){x("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=Ue(e,r,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Le){x((null===n||void 0===n?void 0:n.type)===hn,e,"argument-error");return Pt(e,await gn(e,t,n))}return Pt(e,t)},"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{var r;x("signin"===t.type,e,"internal-error");const s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;x(s,e,"missing-multi-factor-info");const a={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=Ue(e,a,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Le){x((null===n||void 0===n?void 0:n.type)===hn,e,"argument-error");return on(e,await gn(e,t,n))}return on(e,t)},"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=Ue(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===Le){x((null===n||void 0===n?void 0:n.type)===hn,e,"argument-error");return Qe(e,await gn(e,t,n))}return Qe(e,t)},"PHONE_PROVIDER");return(await r.catch(e=>Promise.reject(e))).sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function gn(e,t,n){x(n.type===hn,e,"argument-error");const r=await n.verify();x("string"===typeof r,e,"argument-error");const s=(0,i.A)({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:r}),s}class vn{constructor(e){this.providerId=vn.PROVIDER_ID,this.auth=Te(e)}verifyPhoneNumber(e,t){return fn(this.auth,e,(0,a.Ku)(t))}static credential(e,t){return $e._fromVerification(e,t)}static credentialFromResult(e){const t=e;return vn.credentialFromTaggedObject(t)}static credentialFromError(e){return vn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?$e._fromTokenResponse(n,r):null}}function yn(e,t){return t?ae(t):(x(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}vn.PROVIDER_ID="phone",vn.PHONE_SIGN_IN_METHOD="phone";class _n extends He{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Xe(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Xe(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Xe(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function En(e){return ft(e.auth,new _n(e),e.bypassAuthState)}function bn(e){const{auth:t,user:n}=e;return x(n,t,"internal-error"),mt(n,new _n(e),e.bypassAuthState)}async function xn(e){const{auth:t,user:n}=e;return x(n,t,"internal-error"),pt(n,new _n(e),e.bypassAuthState)}class wn{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return En;case"linkViaPopup":case"linkViaRedirect":return xn;case"reauthViaPopup":case"reauthViaRedirect":return bn;default:v(this.auth,"internal-error")}}resolve(e){S(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){S(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Sn=new A(2e3,1e4);class Tn extends wn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Tn.currentPopupAction&&Tn.currentPopupAction.cancel(),Tn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return x(e,this.auth,"internal-error"),e}async onExecution(){S(1===this.filter.length,"Popup operations only handle one event");const e=Kt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(y(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(y(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Tn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t;null!==(t=this.authWindow)&&void 0!==t&&null!==(t=t.window)&&void 0!==t&&t.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(y(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Sn.get())};e()}}Tn.currentPopupAction=null;const Nn=new Map;class Cn extends wn{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Nn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=In(t),r=Rn(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Nn.set(this.auth._key(),e)}return this.bypassAuthState||Nn.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function An(e,t){Nn.set(e._key(),t)}function Rn(e){return ae(e._redirectPersistence)}function In(e){return le("pendingRedirect",e.config.apiKey,e.name)}async function On(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,s.xZ)(e.app))return Promise.reject(E(e));const r=Te(e),i=yn(r,t),a=new Cn(r,i,n),o=await a.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Pn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Dn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Dn(e)){var n;const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(y(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(kn(e))}saveEventToCache(e){this.cachedEventUids.add(kn(e)),this.lastProcessedEventTime=Date.now()}}function kn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Dn(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const Ln=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jn=/^https?/;async function Mn(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return L(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(Un(r))return}catch(n){}v(e,"unauthorized-domain")}function Un(e){const t=T(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!jn.test(n))return!1;if(Ln.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Vn=new A(3e4,6e4);function Fn(){const e=Yt().___jsl;if(null!==e&&void 0!==e&&e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Bn(e){return new Promise((t,n)=>{var r,i;function s(){Fn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Fn(),n(y(e,"network-request-failed"))},timeout:Vn.get()})}if(null!==(r=Yt().gapi)&&void 0!==r&&null!==(r=r.iframes)&&void 0!==r&&r.Iframe)t(gapi.iframes.getContext());else{if(null===(i=Yt().gapi)||void 0===i||!i.load){const t=Re("iframefcb");return Yt()[t]=()=>{gapi.load?s():n(y(e,"network-request-failed"))},Ae("".concat(Ce.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}s()}}).catch(e=>{throw Gn=null,e})}let Gn=null;const Hn=new A(5e3,15e3),Wn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},zn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Kn(e){const t=e.config;x(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?R(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:s.MF},i=zn.get(e.config.apiHost);i&&(r.eid=i);const o=e._getFrameworks();return o.length&&(r.fw=o.join(",")),"".concat(n,"?").concat((0,a.Am)(r).slice(1))}async function qn(e){const t=await function(e){return Gn=Gn||Bn(e),Gn}(e),n=Yt().gapi;return x(n,e,"internal-error"),t.open({where:document.body,url:Kn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Wn,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=y(e,"network-request-failed"),s=Yt().setTimeout(()=>{r(i)},Hn.get());function a(){Yt().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{r(i)})}))}const Yn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Xn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Jn(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const o=Math.max((window.screen.availHeight-s)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const d=(0,i.A)((0,i.A)({},Yn),{},{width:r.toString(),height:s.toString(),top:o,left:c}),u=(0,a.ZQ)().toLowerCase();n&&(l=me(u)?"_blank":n),he(u)&&(t=t||"http://localhost",d.scrollbars="yes");const h=Object.entries(d).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return _e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.ZQ)())&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(u)&&"_self"!==l)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",l),new Xn(null);const p=window.open(t||"",l,h);x(p,e,"popup-blocked");try{p.focus()}catch(m){}return new Xn(p)}const Qn="__/auth/handler",Zn="emulator/auth/handler",$n=encodeURIComponent("fac");async function er(e,t,n,r,i,o){x(e.config.authDomain,e,"auth-domain-config-required"),x(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:s.MF,eventId:i};if(t instanceof nt){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,a.Im)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(o||{}))c[e]=t}if(t instanceof rt){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const l=c;for(const s of Object.keys(l))void 0===l[s]&&delete l[s];const d=await e._getAppCheckToken(),u=d?"#".concat($n,"=").concat(encodeURIComponent(d)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Qn);return R(t,Zn)}(e),"?").concat((0,a.Am)(l).slice(1)).concat(u)}const tr="webStorageSupport";const nr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wt,this._completeRedirectFn=On,this._overrideRedirectResult=An}async _openPopup(e,t,n,r){var i;S(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Jn(e,await er(e,t,n,T(),r),Kt())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Yt().location.href=e}(await er(e,t,n,T(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(S(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await qn(e),n=new Pn(e);return t.register("authEvent",t=>{x(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(tr,{type:tr},n=>{var r;const i=null===n||void 0===n||null===(r=n[0])||void 0===r?void 0:r[tr];void 0!==i&&t(!!i),v(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Mn(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ee()||pe()||_e()}};var rr="@firebase/auth",ir="1.11.0";class sr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){x(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ar=(0,a.XA)("authIdTokenMaxAge")||300;let or=null;const cr=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>ar)return;const i=null===n||void 0===n?void 0:n.token;or!==i&&(or=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:"Bearer ".concat(i)}:{}}))};function lr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.Sx)();const t=(0,s.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,s.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,a.bD)(r,null!==t&&void 0!==t?t:{}))return e;v(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:nr,persistence:[an,Vt,Wt]}),r=(0,a.XA)("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=cr(e.toString());!function(e,t,n){(0,a.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){(0,a.Ku)(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}const i=(0,a.Tj)("auth");return i&&Fe(n,"http://".concat(i)),n}var dr;Ce={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=y("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},dr="Browser",(0,s.om)(new c.uA("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;x(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:o,clientPlatform:dr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:be(dr)},l=new Se(r,i,s,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ae);null!==t&&void 0!==t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,s.om)(new c.uA("auth-internal",e=>(e=>new sr(e))(Te(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.KO)(rr,ir,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(dr)),(0,s.KO)(rr,ir,"esm2020")},1112:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.CFB=function(){var e=t.lib.BlockCipherMode.extend();function n(e,t,n,r){var i,s=this._iv;s?(i=s.slice(0),this._iv=void 0):i=this._prevBlock,r.encryptBlock(i,0);for(var a=0;a<n;a++)e[t+a]^=i[a]}return e.Encryptor=e.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize;n.call(this,e,t,i,r),this._prevBlock=e.slice(t,t+i)}}),e.Decryptor=e.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,s=e.slice(t,t+i);n.call(this,e,t,i,r),this._prevBlock=s}}),e}(),t.mode.CFB)}()},1153:(e,t,n)=>{"use strict";var r=n(5043),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,s={},l=null,d=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!c.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:d,props:s,_owner:o.current}}t.Fragment=s,t.jsx=l,t.jsxs=l},1635:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i=function(e){try{return!!e()}catch(e){return!0}},s=!i(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),a=s,o=Function.prototype,c=o.call,l=a&&o.bind.bind(c,c),d=a?l:function(e){return function(){return c.apply(e,arguments)}},u=d({}.isPrototypeOf),h=function(e){return e&&e.Math===Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof t&&t)||h("object"==typeof t&&t)||function(){return this}()||Function("return this")(),m=s,f=Function.prototype,g=f.apply,v=f.call,y="object"==typeof Reflect&&Reflect.apply||(m?v.bind(g):function(){return v.apply(g,arguments)}),_=d,E=_({}.toString),b=_("".slice),x=function(e){return b(E(e),8,-1)},w=x,S=d,T=function(e){if("Function"===w(e))return S(e)},N="object"==typeof document&&document.all,C=void 0===N&&void 0!==N?function(e){return"function"==typeof e||e===N}:function(e){return"function"==typeof e},A={},R=!i(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),I=s,O=Function.prototype.call,P=I?O.bind(O):function(){return O.apply(O,arguments)},k={},D={}.propertyIsEnumerable,L=Object.getOwnPropertyDescriptor,j=L&&!D.call({1:2},1);k.f=j?function(e){var t=L(this,e);return!!t&&t.enumerable}:D;var M,U,V=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},F=i,B=x,G=Object,H=d("".split),W=F(function(){return!G("z").propertyIsEnumerable(0)})?function(e){return"String"===B(e)?H(e,""):G(e)}:G,z=function(e){return null==e},K=z,q=TypeError,Y=function(e){if(K(e))throw new q("Can't call method on "+e);return e},X=W,J=Y,Q=function(e){return X(J(e))},Z=C,$=function(e){return"object"==typeof e?null!==e:Z(e)},ee={},te=ee,ne=p,re=C,ie=function(e){return re(e)?e:void 0},se=function(e,t){return arguments.length<2?ie(te[e])||ie(ne[e]):te[e]&&te[e][t]||ne[e]&&ne[e][t]},ae=p.navigator,oe=ae&&ae.userAgent,ce=oe?String(oe):"",le=p,de=ce,ue=le.process,he=le.Deno,pe=ue&&ue.versions||he&&he.version,me=pe&&pe.v8;me&&(U=(M=me.split("."))[0]>0&&M[0]<4?1:+(M[0]+M[1])),!U&&de&&(!(M=de.match(/Edge\/(\d+)/))||M[1]>=74)&&(M=de.match(/Chrome\/(\d+)/))&&(U=+M[1]);var fe=U,ge=fe,ve=i,ye=p.String,_e=!!Object.getOwnPropertySymbols&&!ve(function(){var e=Symbol("symbol detection");return!ye(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ge&&ge<41}),Ee=_e&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,be=se,xe=C,we=u,Se=Object,Te=Ee?function(e){return"symbol"==typeof e}:function(e){var t=be("Symbol");return xe(t)&&we(t.prototype,Se(e))},Ne=String,Ce=function(e){try{return Ne(e)}catch(e){return"Object"}},Ae=C,Re=Ce,Ie=TypeError,Oe=function(e){if(Ae(e))return e;throw new Ie(Re(e)+" is not a function")},Pe=Oe,ke=z,De=function(e,t){var n=e[t];return ke(n)?void 0:Pe(n)},Le=P,je=C,Me=$,Ue=TypeError,Ve={exports:{}},Fe=p,Be=Object.defineProperty,Ge=p,He=function(e,t){try{Be(Fe,e,{value:t,configurable:!0,writable:!0})}catch(r){Fe[e]=t}return t},We="__core-js_shared__",ze=Ve.exports=Ge[We]||He(We,{});(ze.versions||(ze.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Ke=Ve.exports,qe=Ke,Ye=function(e,t){return qe[e]||(qe[e]=t||{})},Xe=Y,Je=Object,Qe=function(e){return Je(Xe(e))},Ze=Qe,$e=d({}.hasOwnProperty),et=Object.hasOwn||function(e,t){return $e(Ze(e),t)},tt=d,nt=0,rt=Math.random(),it=tt(1..toString),st=function(e){return"Symbol("+(void 0===e?"":e)+")_"+it(++nt+rt,36)},at=Ye,ot=et,ct=st,lt=_e,dt=Ee,ut=p.Symbol,ht=at("wks"),pt=dt?ut.for||ut:ut&&ut.withoutSetter||ct,mt=function(e){return ot(ht,e)||(ht[e]=lt&&ot(ut,e)?ut[e]:pt("Symbol."+e)),ht[e]},ft=P,gt=$,vt=Te,yt=De,_t=function(e,t){var n,r;if("string"===t&&je(n=e.toString)&&!Me(r=Le(n,e)))return r;if(je(n=e.valueOf)&&!Me(r=Le(n,e)))return r;if("string"!==t&&je(n=e.toString)&&!Me(r=Le(n,e)))return r;throw new Ue("Can't convert object to primitive value")},Et=TypeError,bt=mt("toPrimitive"),xt=function(e,t){if(!gt(e)||vt(e))return e;var n,r=yt(e,bt);if(r){if(void 0===t&&(t="default"),n=ft(r,e,t),!gt(n)||vt(n))return n;throw new Et("Can't convert object to primitive value")}return void 0===t&&(t="number"),_t(e,t)},wt=Te,St=function(e){var t=xt(e,"string");return wt(t)?t:t+""},Tt=$,Nt=p.document,Ct=Tt(Nt)&&Tt(Nt.createElement),At=function(e){return Ct?Nt.createElement(e):{}},Rt=At,It=!R&&!i(function(){return 7!==Object.defineProperty(Rt("div"),"a",{get:function(){return 7}}).a}),Ot=R,Pt=P,kt=k,Dt=V,Lt=Q,jt=St,Mt=et,Ut=It,Vt=Object.getOwnPropertyDescriptor;A.f=Ot?Vt:function(e,t){if(e=Lt(e),t=jt(t),Ut)try{return Vt(e,t)}catch(e){}if(Mt(e,t))return Dt(!Pt(kt.f,e,t),e[t])};var Ft=i,Bt=C,Gt=/#|\.prototype\./,Ht=function(e,t){var n=zt[Wt(e)];return n===qt||n!==Kt&&(Bt(t)?Ft(t):!!t)},Wt=Ht.normalize=function(e){return String(e).replace(Gt,".").toLowerCase()},zt=Ht.data={},Kt=Ht.NATIVE="N",qt=Ht.POLYFILL="P",Yt=Ht,Xt=Oe,Jt=s,Qt=T(T.bind),Zt=function(e,t){return Xt(e),void 0===t?e:Jt?Qt(e,t):function(){return e.apply(t,arguments)}},$t={},en=R&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),tn=$,nn=String,rn=TypeError,sn=function(e){if(tn(e))return e;throw new rn(nn(e)+" is not an object")},an=R,on=It,cn=en,ln=sn,dn=St,un=TypeError,hn=Object.defineProperty,pn=Object.getOwnPropertyDescriptor,mn="enumerable",fn="configurable",gn="writable";$t.f=an?cn?function(e,t,n){if(ln(e),t=dn(t),ln(n),"function"==typeof e&&"prototype"===t&&"value"in n&&gn in n&&!n[gn]){var r=pn(e,t);r&&r[gn]&&(e[t]=n.value,n={configurable:fn in n?n[fn]:r[fn],enumerable:mn in n?n[mn]:r[mn],writable:!1})}return hn(e,t,n)}:hn:function(e,t,n){if(ln(e),t=dn(t),ln(n),on)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new un("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var vn=$t,yn=V,_n=R?function(e,t,n){return vn.f(e,t,yn(1,n))}:function(e,t,n){return e[t]=n,e},En=p,bn=y,xn=T,wn=C,Sn=A.f,Tn=Yt,Nn=ee,Cn=Zt,An=_n,Rn=et,In=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return bn(e,this,arguments)};return t.prototype=e.prototype,t},On=function(e,t){var n,r,i,s,a,o,c,l,d,u=e.target,h=e.global,p=e.stat,m=e.proto,f=h?En:p?En[u]:En[u]&&En[u].prototype,g=h?Nn:Nn[u]||An(Nn,u,{})[u],v=g.prototype;for(s in t)r=!(n=Tn(h?s:u+(p?".":"#")+s,e.forced))&&f&&Rn(f,s),o=g[s],r&&(c=e.dontCallGetSet?(d=Sn(f,s))&&d.value:f[s]),a=r&&c?c:t[s],(n||m||typeof o!=typeof a)&&(l=e.bind&&r?Cn(a,En):e.wrap&&r?In(a):m&&wn(a)?xn(a):a,(e.sham||a&&a.sham||o&&o.sham)&&An(l,"sham",!0),An(g,s,l),m&&(Rn(Nn,i=u+"Prototype")||An(Nn,i,{}),An(Nn[i],s,a),e.real&&v&&(n||!v[s])&&An(v,s,a)))},Pn=Math.ceil,kn=Math.floor,Dn=Math.trunc||function(e){var t=+e;return(t>0?kn:Pn)(t)},Ln=Dn,jn=function(e){var t=+e;return t!=t||0===t?0:Ln(t)},Mn=jn,Un=Math.max,Vn=Math.min,Fn=function(e,t){var n=Mn(e);return n<0?Un(n+t,0):Vn(n,t)},Bn=jn,Gn=Math.min,Hn=function(e){var t=Bn(e);return t>0?Gn(t,9007199254740991):0},Wn=Hn,zn=function(e){return Wn(e.length)},Kn=Q,qn=Fn,Yn=zn,Xn=function(e){return function(t,n,r){var i=Kn(t),s=Yn(i);if(0===s)return!e&&-1;var a,o=qn(r,s);if(e&&n!=n){for(;s>o;)if((a=i[o++])!=a)return!0}else for(;s>o;o++)if((e||o in i)&&i[o]===n)return e||o||0;return!e&&-1}},Jn={includes:Xn(!0),indexOf:Xn(!1)},Qn=Jn.includes;On({target:"Array",proto:!0,forced:i(function(){return!Array(1).includes()})},{includes:function(e){return Qn(this,e,arguments.length>1?arguments[1]:void 0)}});var Zn=p,$n=ee,er=function(e,t){var n=$n[e+"Prototype"],r=n&&n[t];if(r)return r;var i=Zn[e],s=i&&i.prototype;return s&&s[t]},tr=er("Array","includes"),nr=$,rr=x,ir=mt("match"),sr=function(e){var t;return nr(e)&&(void 0!==(t=e[ir])?!!t:"RegExp"===rr(e))},ar=sr,or=TypeError,cr={};cr[mt("toStringTag")]="z";var lr="[object z]"===String(cr),dr=lr,ur=C,hr=x,pr=mt("toStringTag"),mr=Object,fr="Arguments"===hr(function(){return arguments}()),gr=dr?hr:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=mr(e),pr))?n:fr?hr(t):"Object"===(r=hr(t))&&ur(t.callee)?"Arguments":r},vr=gr,yr=String,_r=function(e){if("Symbol"===vr(e))throw new TypeError("Cannot convert a Symbol value to a string");return yr(e)},Er=mt("match"),br=On,xr=function(e){if(ar(e))throw new or("The method doesn't accept regular expressions");return e},wr=Y,Sr=_r,Tr=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Er]=!1,"/./"[e](t)}catch(e){}}return!1},Nr=d("".indexOf);br({target:"String",proto:!0,forced:!Tr("includes")},{includes:function(e){return!!~Nr(Sr(wr(this)),Sr(xr(e)),arguments.length>1?arguments[1]:void 0)}});var Cr=er("String","includes"),Ar=u,Rr=tr,Ir=Cr,Or=Array.prototype,Pr=String.prototype,kr=function(e){var t=e.includes;return e===Or||Ar(Or,e)&&t===Or.includes?Rr:"string"==typeof e||e===Pr||Ar(Pr,e)&&t===Pr.includes?Ir:t},Dr=r(kr),Lr=Oe,jr=Qe,Mr=W,Ur=zn,Vr=TypeError,Fr="Reduce of empty array with no initial value",Br=function(e){return function(t,n,r,i){var s=jr(t),a=Mr(s),o=Ur(s);if(Lr(n),0===o&&r<2)throw new Vr(Fr);var c=e?o-1:0,l=e?-1:1;if(r<2)for(;;){if(c in a){i=a[c],c+=l;break}if(c+=l,e?c<0:o<=c)throw new Vr(Fr)}for(;e?c>=0:o>c;c+=l)c in a&&(i=n(i,a[c],c,s));return i}},Gr={left:Br(!1),right:Br(!0)},Hr=i,Wr=function(e,t){var n=[][e];return!!n&&Hr(function(){n.call(null,t||function(){return 1},1)})},zr=p,Kr=ce,qr=x,Yr=function(e){return Kr.slice(0,e.length)===e},Xr=Yr("Bun/")?"BUN":Yr("Cloudflare-Workers")?"CLOUDFLARE":Yr("Deno/")?"DENO":Yr("Node.js/")?"NODE":zr.Bun&&"string"==typeof Bun.version?"BUN":zr.Deno&&"object"==typeof Deno.version?"DENO":"process"===qr(zr.process)?"NODE":zr.window&&zr.document?"BROWSER":"REST",Jr="NODE"===Xr,Qr=Gr.left;On({target:"Array",proto:!0,forced:!Jr&&fe>79&&fe<83||!Wr("reduce")},{reduce:function(e){var t=arguments.length;return Qr(this,e,t,t>1?arguments[1]:void 0)}});var Zr=er("Array","reduce"),$r=u,ei=Zr,ti=Array.prototype,ni=function(e){var t=e.reduce;return e===ti||$r(ti,e)&&t===ti.reduce?ei:t},ri=ni,ii=r(ri),si=x,ai=Array.isArray||function(e){return"Array"===si(e)},oi=On,ci=ai,li=d([].reverse),di=[1,2];oi({target:"Array",proto:!0,forced:String(di)===String(di.reverse())},{reverse:function(){return ci(this)&&(this.length=this.length),li(this)}});var ui=er("Array","reverse"),hi=u,pi=ui,mi=Array.prototype,fi=function(e){var t=e.reverse;return e===mi||hi(mi,e)&&t===mi.reverse?pi:t},gi=fi,vi=r(gi),yi=st,_i=Ye("keys"),Ei=function(e){return _i[e]||(_i[e]=yi(e))},bi=!i(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),xi=et,wi=C,Si=Qe,Ti=bi,Ni=Ei("IE_PROTO"),Ci=Object,Ai=Ci.prototype,Ri=Ti?Ci.getPrototypeOf:function(e){var t=Si(e);if(xi(t,Ni))return t[Ni];var n=t.constructor;return wi(n)&&t instanceof n?n.prototype:t instanceof Ci?Ai:null},Ii=d,Oi=Oe,Pi=$,ki=function(e){return Pi(e)||null===e},Di=String,Li=TypeError,ji=function(e,t,n){try{return Ii(Oi(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Mi=$,Ui=Y,Vi=function(e){if(ki(e))return e;throw new Li("Can't set "+Di(e)+" as a prototype")},Fi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=ji(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Ui(n),Vi(r),Mi(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0),Bi={},Gi={},Hi=et,Wi=Q,zi=Jn.indexOf,Ki=Gi,qi=d([].push),Yi=function(e,t){var n,r=Wi(e),i=0,s=[];for(n in r)!Hi(Ki,n)&&Hi(r,n)&&qi(s,n);for(;t.length>i;)Hi(r,n=t[i++])&&(~zi(s,n)||qi(s,n));return s},Xi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ji=Yi,Qi=Xi.concat("length","prototype");Bi.f=Object.getOwnPropertyNames||function(e){return Ji(e,Qi)};var Zi={};Zi.f=Object.getOwnPropertySymbols;var $i=se,es=Bi,ts=Zi,ns=sn,rs=d([].concat),is=$i("Reflect","ownKeys")||function(e){var t=es.f(ns(e)),n=ts.f;return n?rs(t,n(e)):t},ss=et,as=is,os=A,cs=$t,ls={},ds=Yi,us=Xi,hs=Object.keys||function(e){return ds(e,us)},ps=R,ms=en,fs=$t,gs=sn,vs=Q,ys=hs;ls.f=ps&&!ms?Object.defineProperties:function(e,t){gs(e);for(var n,r=vs(t),i=ys(t),s=i.length,a=0;s>a;)fs.f(e,n=i[a++],r[n]);return e};var _s,Es=se("document","documentElement"),bs=sn,xs=ls,ws=Xi,Ss=Gi,Ts=Es,Ns=At,Cs="prototype",As="script",Rs=Ei("IE_PROTO"),Is=function(){},Os=function(e){return"<"+As+">"+e+"</"+As+">"},Ps=function(e){e.write(Os("")),e.close();var t=e.parentWindow.Object;return e=null,t},ks=function(){try{_s=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;ks="undefined"!=typeof document?document.domain&&_s?Ps(_s):(t=Ns("iframe"),n="java"+As+":",t.style.display="none",Ts.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Os("document.F=Object")),e.close(),e.F):Ps(_s);for(var r=ws.length;r--;)delete ks[Cs][ws[r]];return ks()};Ss[Rs]=!0;var Ds=Object.create||function(e,t){var n;return null!==e?(Is[Cs]=bs(e),n=new Is,Is[Cs]=null,n[Rs]=e):n=ks(),void 0===t?n:xs.f(n,t)},Ls=$,js=_n,Ms=Error,Us=d("".replace),Vs=String(new Ms("zxcasd").stack),Fs=/\n\s*at [^:]*:[^\n]*/,Bs=Fs.test(Vs),Gs=V,Hs=!i(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Gs(1,7)),7!==e.stack)}),Ws=_n,zs=function(e,t){if(Bs&&"string"==typeof e&&!Ms.prepareStackTrace)for(;t--;)e=Us(e,Fs,"");return e},Ks=Hs,qs=Error.captureStackTrace,Ys={},Xs=Ys,Js=mt("iterator"),Qs=Array.prototype,Zs=function(e){return void 0!==e&&(Xs.Array===e||Qs[Js]===e)},$s=gr,ea=De,ta=z,na=Ys,ra=mt("iterator"),ia=function(e){if(!ta(e))return ea(e,ra)||ea(e,"@@iterator")||na[$s(e)]},sa=P,aa=Oe,oa=sn,ca=Ce,la=ia,da=TypeError,ua=function(e,t){var n=arguments.length<2?la(e):t;if(aa(n))return oa(sa(n,e));throw new da(ca(e)+" is not iterable")},ha=P,pa=sn,ma=De,fa=function(e,t,n){var r,i;pa(e);try{if(!(r=ma(e,"return"))){if("throw"===t)throw n;return n}r=ha(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return pa(r),n},ga=Zt,va=P,ya=sn,_a=Ce,Ea=Zs,ba=zn,xa=u,wa=ua,Sa=ia,Ta=fa,Na=TypeError,Ca=function(e,t){this.stopped=e,this.result=t},Aa=Ca.prototype,Ra=function(e,t,n){var r,i,s,a,o,c,l,d=n&&n.that,u=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),m=!(!n||!n.INTERRUPTED),f=ga(t,d),g=function(e){return r&&Ta(r,"normal",e),new Ca(!0,e)},v=function(e){return u?(ya(e),m?f(e[0],e[1],g):f(e[0],e[1])):m?f(e,g):f(e)};if(h)r=e.iterator;else if(p)r=e;else{if(!(i=Sa(e)))throw new Na(_a(e)+" is not iterable");if(Ea(i)){for(s=0,a=ba(e);a>s;s++)if((o=v(e[s]))&&xa(Aa,o))return o;return new Ca(!1)}r=wa(e,i)}for(c=h?e.next:r.next;!(l=va(c,r)).done;){try{o=v(l.value)}catch(e){Ta(r,"throw",e)}if("object"==typeof o&&o&&xa(Aa,o))return o}return new Ca(!1)},Ia=_r,Oa=On,Pa=u,ka=Ri,Da=Fi,La=function(e,t,n){for(var r=as(t),i=cs.f,s=os.f,a=0;a<r.length;a++){var o=r[a];ss(e,o)||n&&ss(n,o)||i(e,o,s(t,o))}},ja=Ds,Ma=_n,Ua=V,Va=function(e,t){Ls(t)&&"cause"in t&&js(e,"cause",t.cause)},Fa=function(e,t,n,r){Ks&&(qs?qs(e,t):Ws(e,"stack",zs(n,r)))},Ba=Ra,Ga=function(e,t){return void 0===e?arguments.length<2?"":t:Ia(e)},Ha=mt("toStringTag"),Wa=Error,za=[].push,Ka=function(e,t){var n,r=Pa(qa,this);Da?n=Da(new Wa,r?ka(this):qa):(n=r?this:ja(qa),Ma(n,Ha,"Error")),void 0!==t&&Ma(n,"message",Ga(t)),Fa(n,Ka,n.stack,1),arguments.length>2&&Va(n,arguments[2]);var i=[];return Ba(e,za,{that:i}),Ma(n,"errors",i),n};Da?Da(Ka,Wa):La(Ka,Wa,{name:!0});var qa=Ka.prototype=ja(Wa.prototype,{constructor:Ua(1,Ka),message:Ua(1,""),name:Ua(1,"AggregateError")});Oa({global:!0,constructor:!0,arity:2},{AggregateError:Ka});var Ya,Xa,Ja,Qa=C,Za=p.WeakMap,$a=Qa(Za)&&/native code/.test(String(Za)),eo=p,to=$,no=_n,ro=et,io=Ke,so=Ei,ao=Gi,oo="Object already initialized",co=eo.TypeError,lo=eo.WeakMap;if($a||io.state){var uo=io.state||(io.state=new lo);uo.get=uo.get,uo.has=uo.has,uo.set=uo.set,Ya=function(e,t){if(uo.has(e))throw new co(oo);return t.facade=e,uo.set(e,t),t},Xa=function(e){return uo.get(e)||{}},Ja=function(e){return uo.has(e)}}else{var ho=so("state");ao[ho]=!0,Ya=function(e,t){if(ro(e,ho))throw new co(oo);return t.facade=e,no(e,ho,t),t},Xa=function(e){return ro(e,ho)?e[ho]:{}},Ja=function(e){return ro(e,ho)}}var po,mo,fo,go={set:Ya,get:Xa,has:Ja,enforce:function(e){return Ja(e)?Xa(e):Ya(e,{})},getterFor:function(e){return function(t){var n;if(!to(t)||(n=Xa(t)).type!==e)throw new co("Incompatible receiver, "+e+" required");return n}}},vo=R,yo=et,_o=Function.prototype,Eo=vo&&Object.getOwnPropertyDescriptor,bo=yo(_o,"name"),xo={EXISTS:bo,PROPER:bo&&"something"===function(){}.name,CONFIGURABLE:bo&&(!vo||vo&&Eo(_o,"name").configurable)},wo=_n,So=function(e,t,n,r){return r&&r.enumerable?e[t]=n:wo(e,t,n),e},To=i,No=C,Co=$,Ao=Ds,Ro=Ri,Io=So,Oo=mt("iterator"),Po=!1;[].keys&&("next"in(fo=[].keys())?(mo=Ro(Ro(fo)))!==Object.prototype&&(po=mo):Po=!0);var ko=!Co(po)||To(function(){var e={};return po[Oo].call(e)!==e});No((po=ko?{}:Ao(po))[Oo])||Io(po,Oo,function(){return this});var Do={IteratorPrototype:po,BUGGY_SAFARI_ITERATORS:Po},Lo=gr,jo=lr?{}.toString:function(){return"[object "+Lo(this)+"]"},Mo=lr,Uo=$t.f,Vo=_n,Fo=et,Bo=jo,Go=mt("toStringTag"),Ho=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(Fo(i,Go)||Uo(i,Go,{configurable:!0,value:t}),r&&!Mo&&Vo(i,"toString",Bo))},Wo=Do.IteratorPrototype,zo=Ds,Ko=V,qo=Ho,Yo=Ys,Xo=function(){return this},Jo=function(e,t,n,r){var i=t+" Iterator";return e.prototype=zo(Wo,{next:Ko(+!r,n)}),qo(e,i,!1,!0),Yo[i]=Xo,e},Qo=On,Zo=P,$o=Jo,ec=Ri,tc=Ho,nc=So,rc=Ys,ic=Do,sc=xo.PROPER,ac=ic.BUGGY_SAFARI_ITERATORS,oc=mt("iterator"),cc="keys",lc="values",dc="entries",uc=function(){return this},hc=function(e,t,n,r,i,s,a){$o(n,t,r);var o,c,l,d=function(e){if(e===i&&f)return f;if(!ac&&e&&e in p)return p[e];switch(e){case cc:case lc:case dc:return function(){return new n(this,e)}}return function(){return new n(this)}},u=t+" Iterator",h=!1,p=e.prototype,m=p[oc]||p["@@iterator"]||i&&p[i],f=!ac&&m||d(i),g="Array"===t&&p.entries||m;if(g&&(o=ec(g.call(new e)))!==Object.prototype&&o.next&&(tc(o,u,!0,!0),rc[u]=uc),sc&&i===lc&&m&&m.name!==lc&&(h=!0,f=function(){return Zo(m,this)}),i)if(c={values:d(lc),keys:s?f:d(cc),entries:d(dc)},a)for(l in c)(ac||h||!(l in p))&&nc(p,l,c[l]);else Qo({target:t,proto:!0,forced:ac||h},c);return a&&p[oc]!==f&&nc(p,oc,f,{name:i}),rc[t]=f,c},pc=function(e,t){return{value:e,done:t}},mc=Q,fc=Ys,gc=go;$t.f;var vc=hc,yc=pc,_c="Array Iterator",Ec=gc.set,bc=gc.getterFor(_c);vc(Array,"Array",function(e,t){Ec(this,{type:_c,target:mc(e),index:0,kind:t})},function(){var e=bc(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,yc(void 0,!0);switch(e.kind){case"keys":return yc(n,!1);case"values":return yc(t[n],!1)}return yc([n,t[n]],!1)},"values"),fc.Arguments=fc.Array;var xc=$t,wc=function(e,t,n){return xc.f(e,t,n)},Sc=se,Tc=wc,Nc=R,Cc=mt("species"),Ac=u,Rc=TypeError,Ic=function(e,t){if(Ac(t,e))return e;throw new Rc("Incorrect invocation")},Oc=C,Pc=Ke,kc=d(Function.toString);Oc(Pc.inspectSource)||(Pc.inspectSource=function(e){return kc(e)});var Dc=Pc.inspectSource,Lc=d,jc=i,Mc=C,Uc=gr,Vc=Dc,Fc=function(){},Bc=se("Reflect","construct"),Gc=/^\s*(?:class|function)\b/,Hc=Lc(Gc.exec),Wc=!Gc.test(Fc),zc=function(e){if(!Mc(e))return!1;try{return Bc(Fc,[],e),!0}catch(e){return!1}},Kc=function(e){if(!Mc(e))return!1;switch(Uc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Wc||!!Hc(Gc,Vc(e))}catch(e){return!0}};Kc.sham=!0;var qc,Yc,Xc,Jc,Qc=!Bc||jc(function(){var e;return zc(zc.call)||!zc(Object)||!zc(function(){e=!0})||e})?Kc:zc,Zc=Qc,$c=Ce,el=TypeError,tl=sn,nl=function(e){if(Zc(e))return e;throw new el($c(e)+" is not a constructor")},rl=z,il=mt("species"),sl=function(e,t){var n,r=tl(e).constructor;return void 0===r||rl(n=tl(r)[il])?t:nl(n)},al=d([].slice),ol=TypeError,cl=function(e,t){if(e<t)throw new ol("Not enough arguments");return e},ll=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),dl=p,ul=y,hl=Zt,pl=C,ml=et,fl=i,gl=Es,vl=al,yl=At,_l=cl,El=ll,bl=Jr,xl=dl.setImmediate,wl=dl.clearImmediate,Sl=dl.process,Tl=dl.Dispatch,Nl=dl.Function,Cl=dl.MessageChannel,Al=dl.String,Rl=0,Il={},Ol="onreadystatechange";fl(function(){qc=dl.location});var Pl=function(e){if(ml(Il,e)){var t=Il[e];delete Il[e],t()}},kl=function(e){return function(){Pl(e)}},Dl=function(e){Pl(e.data)},Ll=function(e){dl.postMessage(Al(e),qc.protocol+"//"+qc.host)};xl&&wl||(xl=function(e){_l(arguments.length,1);var t=pl(e)?e:Nl(e),n=vl(arguments,1);return Il[++Rl]=function(){ul(t,void 0,n)},Yc(Rl),Rl},wl=function(e){delete Il[e]},bl?Yc=function(e){Sl.nextTick(kl(e))}:Tl&&Tl.now?Yc=function(e){Tl.now(kl(e))}:Cl&&!El?(Jc=(Xc=new Cl).port2,Xc.port1.onmessage=Dl,Yc=hl(Jc.postMessage,Jc)):dl.addEventListener&&pl(dl.postMessage)&&!dl.importScripts&&qc&&"file:"!==qc.protocol&&!fl(Ll)?(Yc=Ll,dl.addEventListener("message",Dl,!1)):Yc=Ol in yl("script")?function(e){gl.appendChild(yl("script"))[Ol]=function(){gl.removeChild(this),Pl(e)}}:function(e){setTimeout(kl(e),0)});var jl={set:xl,clear:wl},Ml=p,Ul=R,Vl=Object.getOwnPropertyDescriptor,Fl=function(e){if(!Ul)return Ml[e];var t=Vl(Ml,e);return t&&t.value},Bl=function(){this.head=null,this.tail=null};Bl.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Gl,Hl,Wl,zl,Kl,ql=Bl,Yl=/ipad|iphone|ipod/i.test(ce)&&"undefined"!=typeof Pebble,Xl=/web0s(?!.*chrome)/i.test(ce),Jl=p,Ql=Fl,Zl=Zt,$l=jl.set,ed=ql,td=ll,nd=Yl,rd=Xl,id=Jr,sd=Jl.MutationObserver||Jl.WebKitMutationObserver,ad=Jl.document,od=Jl.process,cd=Jl.Promise,ld=Ql("queueMicrotask");if(!ld){var dd=new ed,ud=function(){var e,t;for(id&&(e=od.domain)&&e.exit();t=dd.get();)try{t()}catch(e){throw dd.head&&Gl(),e}e&&e.enter()};td||id||rd||!sd||!ad?!nd&&cd&&cd.resolve?((zl=cd.resolve(void 0)).constructor=cd,Kl=Zl(zl.then,zl),Gl=function(){Kl(ud)}):id?Gl=function(){od.nextTick(ud)}:($l=Zl($l,Jl),Gl=function(){$l(ud)}):(Hl=!0,Wl=ad.createTextNode(""),new sd(ud).observe(Wl,{characterData:!0}),Gl=function(){Wl.data=Hl=!Hl}),ld=function(e){dd.head||Gl(),dd.add(e)}}var hd=ld,pd=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},md=p.Promise,fd=p,gd=md,vd=C,yd=Yt,_d=Dc,Ed=mt,bd=Xr,xd=fe,wd=gd&&gd.prototype,Sd=Ed("species"),Td=!1,Nd=vd(fd.PromiseRejectionEvent),Cd=yd("Promise",function(){var e=_d(gd),t=e!==String(gd);if(!t&&66===xd)return!0;if(!wd.catch||!wd.finally)return!0;if(!xd||xd<51||!/native code/.test(e)){var n=new gd(function(e){e(1)}),r=function(e){e(function(){},function(){})};if((n.constructor={})[Sd]=r,!(Td=n.then(function(){})instanceof r))return!0}return!(t||"BROWSER"!==bd&&"DENO"!==bd||Nd)}),Ad={CONSTRUCTOR:Cd,REJECTION_EVENT:Nd,SUBCLASSING:Td},Rd={},Id=Oe,Od=TypeError,Pd=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw new Od("Bad Promise constructor");t=e,n=r}),this.resolve=Id(t),this.reject=Id(n)};Rd.f=function(e){return new Pd(e)};var kd,Dd,Ld=On,jd=Jr,Md=p,Ud=P,Vd=So,Fd=Ho,Bd=function(e){var t=Sc(e);Nc&&t&&!t[Cc]&&Tc(t,Cc,{configurable:!0,get:function(){return this}})},Gd=Oe,Hd=C,Wd=$,zd=Ic,Kd=sl,qd=jl.set,Yd=hd,Xd=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}},Jd=pd,Qd=ql,Zd=go,$d=md,eu=Ad,tu=Rd,nu="Promise",ru=eu.CONSTRUCTOR,iu=eu.REJECTION_EVENT,su=Zd.getterFor(nu),au=Zd.set,ou=$d&&$d.prototype,cu=$d,lu=ou,du=Md.TypeError,uu=Md.document,hu=Md.process,pu=tu.f,mu=pu,fu=!!(uu&&uu.createEvent&&Md.dispatchEvent),gu="unhandledrejection",vu=function(e){var t;return!(!Wd(e)||!Hd(t=e.then))&&t},yu=function(e,t){var n,r,i,s=t.value,a=1===t.state,o=a?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{o?(a||(2===t.rejection&&wu(t),t.rejection=1),!0===o?n=s:(d&&d.enter(),n=o(s),d&&(d.exit(),i=!0)),n===e.promise?l(new du("Promise-chain cycle")):(r=vu(n))?Ud(r,n,c,l):c(n)):l(s)}catch(e){d&&!i&&d.exit(),l(e)}},_u=function(e,t){e.notified||(e.notified=!0,Yd(function(){for(var n,r=e.reactions;n=r.get();)yu(n,e);e.notified=!1,t&&!e.rejection&&bu(e)}))},Eu=function(e,t,n){var r,i;fu?((r=uu.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Md.dispatchEvent(r)):r={promise:t,reason:n},!iu&&(i=Md["on"+e])?i(r):e===gu&&Xd("Unhandled promise rejection",n)},bu=function(e){Ud(qd,Md,function(){var t,n=e.facade,r=e.value;if(xu(e)&&(t=Jd(function(){jd?hu.emit("unhandledRejection",r,n):Eu(gu,n,r)}),e.rejection=jd||xu(e)?2:1,t.error))throw t.value})},xu=function(e){return 1!==e.rejection&&!e.parent},wu=function(e){Ud(qd,Md,function(){var t=e.facade;jd?hu.emit("rejectionHandled",t):Eu("rejectionhandled",t,e.value)})},Su=function(e,t,n){return function(r){e(t,r,n)}},Tu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,_u(e,!0))},Nu=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new du("Promise can't be resolved itself");var r=vu(t);r?Yd(function(){var n={done:!1};try{Ud(r,t,Su(Nu,n,e),Su(Tu,n,e))}catch(t){Tu(n,t,e)}}):(e.value=t,e.state=1,_u(e,!1))}catch(t){Tu({done:!1},t,e)}}};ru&&(lu=(cu=function(e){zd(this,lu),Gd(e),Ud(kd,this);var t=su(this);try{e(Su(Nu,t),Su(Tu,t))}catch(e){Tu(t,e)}}).prototype,(kd=function(e){au(this,{type:nu,done:!1,notified:!1,parent:!1,reactions:new Qd,rejection:!1,state:0,value:null})}).prototype=Vd(lu,"then",function(e,t){var n=su(this),r=pu(Kd(this,cu));return n.parent=!0,r.ok=!Hd(e)||e,r.fail=Hd(t)&&t,r.domain=jd?hu.domain:void 0,0===n.state?n.reactions.add(r):Yd(function(){yu(r,n)}),r.promise}),Dd=function(){var e=new kd,t=su(e);this.promise=e,this.resolve=Su(Nu,t),this.reject=Su(Tu,t)},tu.f=pu=function(e){return e===cu||void 0===e?new Dd(e):mu(e)}),Ld({global:!0,constructor:!0,wrap:!0,forced:ru},{Promise:cu}),Fd(cu,nu,!1,!0),Bd(nu);var Cu=mt("iterator"),Au=!1;try{var Ru=0,Iu={next:function(){return{done:!!Ru++}},return:function(){Au=!0}};Iu[Cu]=function(){return this},Array.from(Iu,function(){throw 2})}catch(e){}var Ou=md,Pu=function(e,t){try{if(!t&&!Au)return!1}catch(e){return!1}var n=!1;try{var r={};r[Cu]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},ku=Ad.CONSTRUCTOR||!Pu(function(e){Ou.all(e).then(void 0,function(){})}),Du=P,Lu=Oe,ju=Rd,Mu=pd,Uu=Ra;On({target:"Promise",stat:!0,forced:ku},{all:function(e){var t=this,n=ju.f(t),r=n.resolve,i=n.reject,s=Mu(function(){var n=Lu(t.resolve),s=[],a=0,o=1;Uu(e,function(e){var c=a++,l=!1;o++,Du(n,t,e).then(function(e){l||(l=!0,s[c]=e,--o||r(s))},i)}),--o||r(s)});return s.error&&i(s.value),n.promise}});var Vu=On,Fu=Ad.CONSTRUCTOR;md&&md.prototype,Vu({target:"Promise",proto:!0,forced:Fu,real:!0},{catch:function(e){return this.then(void 0,e)}});var Bu=P,Gu=Oe,Hu=Rd,Wu=pd,zu=Ra;On({target:"Promise",stat:!0,forced:ku},{race:function(e){var t=this,n=Hu.f(t),r=n.reject,i=Wu(function(){var i=Gu(t.resolve);zu(e,function(e){Bu(i,t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var Ku=Rd;On({target:"Promise",stat:!0,forced:Ad.CONSTRUCTOR},{reject:function(e){var t=Ku.f(this);return(0,t.reject)(e),t.promise}});var qu=sn,Yu=$,Xu=Rd,Ju=function(e,t){if(qu(e),Yu(t)&&t.constructor===e)return t;var n=Xu.f(e);return(0,n.resolve)(t),n.promise},Qu=On,Zu=md,$u=Ad.CONSTRUCTOR,eh=Ju,th=se("Promise"),nh=!$u;Qu({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return eh(nh&&this===th?Zu:this,e)}});var rh=P,ih=Oe,sh=Rd,ah=pd,oh=Ra;On({target:"Promise",stat:!0,forced:ku},{allSettled:function(e){var t=this,n=sh.f(t),r=n.resolve,i=n.reject,s=ah(function(){var n=ih(t.resolve),i=[],s=0,a=1;oh(e,function(e){var o=s++,c=!1;a++,rh(n,t,e).then(function(e){c||(c=!0,i[o]={status:"fulfilled",value:e},--a||r(i))},function(e){c||(c=!0,i[o]={status:"rejected",reason:e},--a||r(i))})}),--a||r(i)});return s.error&&i(s.value),n.promise}});var ch=P,lh=Oe,dh=se,uh=Rd,hh=pd,ph=Ra,mh="No one promise resolved";On({target:"Promise",stat:!0,forced:ku},{any:function(e){var t=this,n=dh("AggregateError"),r=uh.f(t),i=r.resolve,s=r.reject,a=hh(function(){var r=lh(t.resolve),a=[],o=0,c=1,l=!1;ph(e,function(e){var d=o++,u=!1;c++,ch(r,t,e).then(function(e){u||l||(l=!0,i(e))},function(e){u||l||(u=!0,a[d]=e,--c||s(new n(a,mh)))})}),--c||s(new n(a,mh))});return a.error&&s(a.value),r.promise}});var fh=On,gh=y,vh=al,yh=Rd,_h=Oe,Eh=pd,bh=p.Promise,xh=!1;fh({target:"Promise",stat:!0,forced:!bh||!bh.try||Eh(function(){bh.try(function(e){xh=8===e},8)}).error||!xh},{try:function(e){var t=arguments.length>1?vh(arguments,1):[],n=yh.f(this),r=Eh(function(){return gh(_h(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var wh=Rd;On({target:"Promise",stat:!0},{withResolvers:function(){var e=wh.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Sh=On,Th=md,Nh=i,Ch=se,Ah=C,Rh=sl,Ih=Ju,Oh=Th&&Th.prototype;Sh({target:"Promise",proto:!0,real:!0,forced:!!Th&&Nh(function(){Oh.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=Rh(this,Ch("Promise")),n=Ah(e);return this.then(n?function(n){return Ih(t,e()).then(function(){return n})}:e,n?function(n){return Ih(t,e()).then(function(){throw n})}:e)}});var Ph=d,kh=jn,Dh=_r,Lh=Y,jh=Ph("".charAt),Mh=Ph("".charCodeAt),Uh=Ph("".slice),Vh=function(e){return function(t,n){var r,i,s=Dh(Lh(t)),a=kh(n),o=s.length;return a<0||a>=o?e?"":void 0:(r=Mh(s,a))<55296||r>56319||a+1===o||(i=Mh(s,a+1))<56320||i>57343?e?jh(s,a):r:e?Uh(s,a,a+2):i-56320+(r-55296<<10)+65536}},Fh={codeAt:Vh(!1),charAt:Vh(!0)},Bh=Fh.charAt,Gh=_r,Hh=go,Wh=hc,zh=pc,Kh="String Iterator",qh=Hh.set,Yh=Hh.getterFor(Kh);Wh(String,"String",function(e){qh(this,{type:Kh,string:Gh(e),index:0})},function(){var e,t=Yh(this),n=t.string,r=t.index;return r>=n.length?zh(void 0,!0):(e=Bh(n,r),t.index+=e.length,zh(e,!1))});var Xh=ee.Promise,Jh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Qh=p,Zh=Ho,$h=Ys;for(var ep in Jh)Zh(Qh[ep],ep),$h[ep]=$h.Array;var tp=Xh,np=r(tp),rp=er("Array","values"),ip=gr,sp=et,ap=u,op=rp,cp=Array.prototype,lp={DOMTokenList:!0,NodeList:!0},dp=function(e){var t=e.values;return e===cp||ap(cp,e)&&t===cp.values||sp(lp,ip(e))?op:t},up=r(dp),hp=Ce,pp=TypeError,mp=al,fp=Math.floor,gp=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var a=fp(n/2),o=gp(mp(e,0,a),t),c=gp(mp(e,a),t),l=o.length,d=c.length,u=0,h=0;u<l||h<d;)e[u+h]=u<l&&h<d?t(o[u],c[h])<=0?o[u++]:c[h++]:u<l?o[u++]:c[h++];return e},vp=gp,yp=ce.match(/firefox\/(\d+)/i),_p=!!yp&&+yp[1],Ep=/MSIE|Trident/.test(ce),bp=ce.match(/AppleWebKit\/(\d+)\./),xp=!!bp&&+bp[1],wp=On,Sp=d,Tp=Oe,Np=Qe,Cp=zn,Ap=function(e,t){if(!delete e[t])throw new pp("Cannot delete property "+hp(t)+" of "+hp(e))},Rp=_r,Ip=i,Op=vp,Pp=Wr,kp=_p,Dp=Ep,Lp=fe,jp=xp,Mp=[],Up=Sp(Mp.sort),Vp=Sp(Mp.push),Fp=Ip(function(){Mp.sort(void 0)}),Bp=Ip(function(){Mp.sort(null)}),Gp=Pp("sort"),Hp=!Ip(function(){if(Lp)return Lp<70;if(!(kp&&kp>3)){if(Dp)return!0;if(jp)return jp<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Mp.push({k:t+r,v:n})}for(Mp.sort(function(e,t){return t.v-e.v}),r=0;r<Mp.length;r++)t=Mp[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}});wp({target:"Array",proto:!0,forced:Fp||!Bp||!Gp||!Hp},{sort:function(e){void 0!==e&&Tp(e);var t=Np(this);if(Hp)return void 0===e?Up(t):Up(t,e);var n,r,i=[],s=Cp(t);for(r=0;r<s;r++)r in t&&Vp(i,t[r]);for(Op(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Rp(t)>Rp(n)?1:-1}}(e)),n=Cp(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)Ap(t,r++);return t}});var Wp=er("Array","sort"),zp=u,Kp=Wp,qp=Array.prototype,Yp=function(e){var t=e.sort;return e===qp||zp(qp,e)&&t===qp.sort?Kp:t},Xp=r(Yp),Jp=On,Qp=d,Zp=Fn,$p=RangeError,em=String.fromCharCode,tm=String.fromCodePoint,nm=Qp([].join);Jp({target:"String",stat:!0,arity:1,forced:!!tm&&1!==tm.length},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],Zp(t,1114111)!==t)throw new $p(t+" is not a valid code point");n[i]=t<65536?em(t):em(55296+((t-=65536)>>10),t%1024+56320)}return nm(n,"")}});var rm=i,im=mt("iterator"),sm=!rm(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(e,n){t.delete("b"),r+=n+e}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[im]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("https://a#\u0431").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host}),am=So,om=On,cm=p,lm=Fl,dm=se,um=P,hm=d,pm=R,mm=sm,fm=So,gm=wc,vm=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:am(e,r,t[r],n);return e},ym=Ho,_m=Jo,Em=go,bm=Ic,xm=C,wm=et,Sm=Zt,Tm=gr,Nm=sn,Cm=$,Am=_r,Rm=Ds,Im=V,Om=ua,Pm=ia,km=pc,Dm=cl,Lm=vp,jm=mt("iterator"),Mm="URLSearchParams",Um=Mm+"Iterator",Vm=Em.set,Fm=Em.getterFor(Mm),Bm=Em.getterFor(Um),Gm=lm("fetch"),Hm=lm("Request"),Wm=lm("Headers"),zm=Hm&&Hm.prototype,Km=Wm&&Wm.prototype,qm=cm.TypeError,Ym=cm.encodeURIComponent,Xm=String.fromCharCode,Jm=dm("String","fromCodePoint"),Qm=parseInt,Zm=hm("".charAt),$m=hm([].join),ef=hm([].push),tf=hm("".replace),nf=hm([].shift),rf=hm([].splice),sf=hm("".split),af=hm("".slice),of=hm(/./.exec),cf=/\+/g,lf=/^[0-9a-f]+$/i,df=function(e,t){var n=af(e,t,t+2);return of(lf,n)?Qm(n,16):NaN},uf=function(e){for(var t=0,n=128;n>0&&0!=(e&n);n>>=1)t++;return t},hf=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},pf=function(e){for(var t=(e=tf(e,cf," ")).length,n="",r=0;r<t;){var i=Zm(e,r);if("%"===i){if("%"===Zm(e,r+1)||r+3>t){n+="%",r++;continue}var s=df(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var a=uf(s);if(0===a)i=Xm(s);else{if(1===a||a>4){n+="\ufffd",r++;continue}for(var o=[s],c=1;c<a&&!(3+ ++r>t||"%"!==Zm(e,r));){var l=df(e,r+1);if(l!=l){r+=3;break}if(l>191||l<128)break;ef(o,l),r+=2,c++}if(o.length!==a){n+="\ufffd";continue}var d=hf(o);null===d?n+="\ufffd":i=Jm(d)}}n+=i,r++}return n},mf=/[!'()~]|%20/g,ff={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},gf=function(e){return ff[e]},vf=function(e){return tf(Ym(e),mf,gf)},yf=_m(function(e,t){Vm(this,{type:Um,target:Fm(e).entries,index:0,kind:t})},Mm,function(){var e=Bm(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,km(void 0,!0);var r=t[n];switch(e.kind){case"keys":return km(r.key,!1);case"values":return km(r.value,!1)}return km([r.key,r.value],!1)},!0),_f=function(e){this.entries=[],this.url=null,void 0!==e&&(Cm(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Zm(e,0)?af(e,1):e:Am(e)))};_f.prototype={type:Mm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,a,o,c=this.entries,l=Pm(e);if(l)for(n=(t=Om(e,l)).next;!(r=um(n,t)).done;){if(s=(i=Om(Nm(r.value))).next,(a=um(s,i)).done||(o=um(s,i)).done||!um(s,i).done)throw new qm("Expected sequence with length 2");ef(c,{key:Am(a.value),value:Am(o.value)})}else for(var d in e)wm(e,d)&&ef(c,{key:d,value:Am(e[d])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=sf(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=sf(t,"="),ef(r,{key:pf(nf(n)),value:pf($m(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],ef(n,vf(e.key)+"="+vf(e.value));return $m(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ef=function(){bm(this,bf);var e=Vm(this,new _f(arguments.length>0?arguments[0]:void 0));pm||(this.size=e.entries.length)},bf=Ef.prototype;if(vm(bf,{append:function(e,t){var n=Fm(this);Dm(arguments.length,2),ef(n.entries,{key:Am(e),value:Am(t)}),pm||this.length++,n.updateURL()},delete:function(e){for(var t=Fm(this),n=Dm(arguments.length,1),r=t.entries,i=Am(e),s=n<2?void 0:arguments[1],a=void 0===s?s:Am(s),o=0;o<r.length;){var c=r[o];if(c.key!==i||void 0!==a&&c.value!==a)o++;else if(rf(r,o,1),void 0!==a)break}pm||(this.size=r.length),t.updateURL()},get:function(e){var t=Fm(this).entries;Dm(arguments.length,1);for(var n=Am(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Fm(this).entries;Dm(arguments.length,1);for(var n=Am(e),r=[],i=0;i<t.length;i++)t[i].key===n&&ef(r,t[i].value);return r},has:function(e){for(var t=Fm(this).entries,n=Dm(arguments.length,1),r=Am(e),i=n<2?void 0:arguments[1],s=void 0===i?i:Am(i),a=0;a<t.length;){var o=t[a++];if(o.key===r&&(void 0===s||o.value===s))return!0}return!1},set:function(e,t){var n=Fm(this);Dm(arguments.length,1);for(var r,i=n.entries,s=!1,a=Am(e),o=Am(t),c=0;c<i.length;c++)(r=i[c]).key===a&&(s?rf(i,c--,1):(s=!0,r.value=o));s||ef(i,{key:a,value:o}),pm||(this.size=i.length),n.updateURL()},sort:function(){var e=Fm(this);Lm(e.entries,function(e,t){return e.key>t.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Fm(this).entries,r=Sm(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new yf(this,"keys")},values:function(){return new yf(this,"values")},entries:function(){return new yf(this,"entries")}},{enumerable:!0}),fm(bf,jm,bf.entries,{name:"entries"}),fm(bf,"toString",function(){return Fm(this).serialize()},{enumerable:!0}),pm&&gm(bf,"size",{get:function(){return Fm(this).entries.length},configurable:!0,enumerable:!0}),ym(Ef,Mm),om({global:!0,constructor:!0,forced:!mm},{URLSearchParams:Ef}),!mm&&xm(Wm)){var xf=hm(Km.has),wf=hm(Km.set),Sf=function(e){if(Cm(e)){var t,n=e.body;if(Tm(n)===Mm)return t=e.headers?new Wm(e.headers):new Wm,xf(t,"content-type")||wf(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Rm(e,{body:Im(0,Am(n)),headers:Im(0,t)})}return e};if(xm(Gm)&&om({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Gm(e,arguments.length>1?Sf(arguments[1]):{})}}),xm(Hm)){var Tf=function(e){return bm(this,zm),new Hm(e,arguments.length>1?Sf(arguments[1]):{})};zm.constructor=Tf,Tf.prototype=zm,om({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Tf})}}var Nf,Cf={URLSearchParams:Ef,getState:Fm},Af=ee.URLSearchParams,Rf=R,If=d,Of=P,Pf=i,kf=hs,Df=Zi,Lf=k,jf=Qe,Mf=W,Uf=Object.assign,Vf=Object.defineProperty,Ff=If([].concat),Bf=!Uf||Pf(function(){if(Rf&&1!==Uf({b:1},Uf(Vf({},"a",{enumerable:!0,get:function(){Vf(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!==Uf({},e)[n]||kf(Uf({},t)).join("")!==r})?function(e,t){for(var n=jf(e),r=arguments.length,i=1,s=Df.f,a=Lf.f;r>i;)for(var o,c=Mf(arguments[i++]),l=s?Ff(kf(c),s(c)):kf(c),d=l.length,u=0;d>u;)o=l[u++],Rf&&!Of(a,c,o)||(n[o]=c[o]);return n}:Uf,Gf=sn,Hf=fa,Wf=R,zf=$t,Kf=V,qf=function(e,t,n){Wf?zf.f(e,t,Kf(0,n)):e[t]=n},Yf=Zt,Xf=P,Jf=Qe,Qf=function(e,t,n,r){try{return r?t(Gf(n)[0],n[1]):t(n)}catch(t){Hf(e,"throw",t)}},Zf=Zs,$f=Qc,eg=zn,tg=qf,ng=ua,rg=ia,ig=Array,sg=d,ag=2147483647,og=/[^\0-\u007E]/,cg=/[.\u3002\uFF0E\uFF61]/g,lg="Overflow: input needs wider integers to process",dg=RangeError,ug=sg(cg.exec),hg=Math.floor,pg=String.fromCharCode,mg=sg("".charCodeAt),fg=sg([].join),gg=sg([].push),vg=sg("".replace),yg=sg("".split),_g=sg("".toLowerCase),Eg=function(e){return e+22+75*(e<26)},bg=function(e,t,n){var r=0;for(e=n?hg(e/700):e>>1,e+=hg(e/t);e>455;)e=hg(e/35),r+=36;return hg(r+36*e/(e+38))},xg=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=mg(e,n++);if(i>=55296&&i<=56319&&n<r){var s=mg(e,n++);56320==(64512&s)?gg(t,((1023&i)<<10)+(1023&s)+65536):(gg(t,i),n--)}else gg(t,i)}return t}(e);var n,r,i=e.length,s=128,a=0,o=72;for(n=0;n<e.length;n++)(r=e[n])<128&&gg(t,pg(r));var c=t.length,l=c;for(c&&gg(t,"-");l<i;){var d=ag;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<d&&(d=r);var u=l+1;if(d-s>hg((ag-a)/u))throw new dg(lg);for(a+=(d-s)*u,s=d,n=0;n<e.length;n++){if((r=e[n])<s&&++a>ag)throw new dg(lg);if(r===s){for(var h=a,p=36;;){var m=p<=o?1:p>=o+26?26:p-o;if(h<m)break;var f=h-m,g=36-m;gg(t,pg(Eg(m+f%g))),h=hg(f/g),p+=36}gg(t,pg(Eg(h))),o=bg(a,u,l===c),a=0,l++}}a++,s++}return fg(t,"")},wg=On,Sg=R,Tg=sm,Ng=p,Cg=Zt,Ag=d,Rg=So,Ig=wc,Og=Ic,Pg=et,kg=Bf,Dg=function(e){var t=Jf(e),n=$f(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=void 0!==i;s&&(i=Yf(i,r>2?arguments[2]:void 0));var a,o,c,l,d,u,h=rg(t),p=0;if(!h||this===ig&&Zf(h))for(a=eg(t),o=n?new this(a):ig(a);a>p;p++)u=s?i(t[p],p):t[p],tg(o,p,u);else for(o=n?new this:[],d=(l=ng(t,h)).next;!(c=Xf(d,l)).done;p++)u=s?Qf(l,i,[c.value,p],!0):c.value,tg(o,p,u);return o.length=p,o},Lg=al,jg=Fh.codeAt,Mg=function(e){var t,n,r=[],i=yg(vg(_g(e),cg,"."),".");for(t=0;t<i.length;t++)n=i[t],gg(r,ug(og,n)?"xn--"+xg(n):n);return fg(r,".")},Ug=_r,Vg=Ho,Fg=cl,Bg=Cf,Gg=go,Hg=Gg.set,Wg=Gg.getterFor("URL"),zg=Bg.URLSearchParams,Kg=Bg.getState,qg=Ng.URL,Yg=Ng.TypeError,Xg=Ng.parseInt,Jg=Math.floor,Qg=Math.pow,Zg=Ag("".charAt),$g=Ag(/./.exec),ev=Ag([].join),tv=Ag(1..toString),nv=Ag([].pop),rv=Ag([].push),iv=Ag("".replace),sv=Ag([].shift),av=Ag("".split),ov=Ag("".slice),cv=Ag("".toLowerCase),lv=Ag([].unshift),dv="Invalid scheme",uv="Invalid host",hv="Invalid port",pv=/[a-z]/i,mv=/[\d+-.a-z]/i,fv=/\d/,gv=/^0x/i,vv=/^[0-7]+$/,yv=/^\d+$/,_v=/^[\da-f]+$/i,Ev=/[\0\t\n\r #%/:<>?@[\\\]^|]/,bv=/[\0\t\n\r #/:<>?@[\\\]^|]/,xv=/^[\u0000-\u0020]+/,wv=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Sv=/[\t\n\r]/g,Tv=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)lv(t,e%256),e=Jg(e/256);return ev(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,s=0;s<8;s++)0!==e[s]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=s),++i);return i>n?r:t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=tv(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Nv={},Cv=kg({},Nv,{" ":1,'"':1,"<":1,">":1,"`":1}),Av=kg({},Cv,{"#":1,"?":1,"{":1,"}":1}),Rv=kg({},Av,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Iv=function(e,t){var n=jg(e,0);return n>32&&n<127&&!Pg(t,e)?e:encodeURIComponent(e)},Ov={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Pv=function(e,t){var n;return 2===e.length&&$g(pv,Zg(e,0))&&(":"===(n=Zg(e,1))||!t&&"|"===n)},kv=function(e){var t;return e.length>1&&Pv(ov(e,0,2))&&(2===e.length||"/"===(t=Zg(e,2))||"\\"===t||"?"===t||"#"===t)},Dv=function(e){return"."===e||"%2e"===cv(e)},Lv={},jv={},Mv={},Uv={},Vv={},Fv={},Bv={},Gv={},Hv={},Wv={},zv={},Kv={},qv={},Yv={},Xv={},Jv={},Qv={},Zv={},$v={},ey={},ty={},ny=function(e,t,n){var r,i,s,a=Ug(e);if(t){if(i=this.parse(a))throw new Yg(i);this.searchParams=null}else{if(void 0!==n&&(r=new ny(n,!0)),i=this.parse(a,null,r))throw new Yg(i);(s=Kg(new zg)).bindURL(this),this.searchParams=s}};ny.prototype={type:"URL",parse:function(e,t,n){var r,i,s,a,o,c=this,l=t||Lv,d=0,u="",h=!1,p=!1,m=!1;for(e=Ug(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=iv(e,xv,""),e=iv(e,wv,"$1")),e=iv(e,Sv,""),r=Dg(e);d<=r.length;){switch(i=r[d],l){case Lv:if(!i||!$g(pv,i)){if(t)return dv;l=Mv;continue}u+=cv(i),l=jv;break;case jv:if(i&&($g(mv,i)||"+"===i||"-"===i||"."===i))u+=cv(i);else{if(":"!==i){if(t)return dv;u="",l=Mv,d=0;continue}if(t&&(c.isSpecial()!==Pg(Ov,u)||"file"===u&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&Ov[c.scheme]===c.port&&(c.port=null));u="","file"===c.scheme?l=Yv:c.isSpecial()&&n&&n.scheme===c.scheme?l=Uv:c.isSpecial()?l=Gv:"/"===r[d+1]?(l=Vv,d++):(c.cannotBeABaseURL=!0,rv(c.path,""),l=$v)}break;case Mv:if(!n||n.cannotBeABaseURL&&"#"!==i)return dv;if(n.cannotBeABaseURL&&"#"===i){c.scheme=n.scheme,c.path=Lg(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=ty;break}l="file"===n.scheme?Yv:Fv;continue;case Uv:if("/"!==i||"/"!==r[d+1]){l=Fv;continue}l=Hv,d++;break;case Vv:if("/"===i){l=Wv;break}l=Zv;continue;case Fv:if(c.scheme=n.scheme,i===Nf)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.query=n.query;else if("/"===i||"\\"===i&&c.isSpecial())l=Bv;else if("?"===i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.query="",l=ey;else{if("#"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.path.length--,l=Zv;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.query=n.query,c.fragment="",l=ty}break;case Bv:if(!c.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=Zv;continue}l=Wv}else l=Hv;break;case Gv:if(l=Hv,"/"!==i||"/"!==Zg(u,d+1))continue;d++;break;case Hv:if("/"!==i&&"\\"!==i){l=Wv;continue}break;case Wv:if("@"===i){h&&(u="%40"+u),h=!0,s=Dg(u);for(var f=0;f<s.length;f++){var g=s[f];if(":"!==g||m){var v=Iv(g,Rv);m?c.password+=v:c.username+=v}else m=!0}u=""}else if(i===Nf||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(h&&""===u)return"Invalid authority";d-=Dg(u).length+1,u="",l=zv}else u+=i;break;case zv:case Kv:if(t&&"file"===c.scheme){l=Jv;continue}if(":"!==i||p){if(i===Nf||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(c.isSpecial()&&""===u)return uv;if(t&&""===u&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(u))return a;if(u="",l=Qv,t)return;continue}"["===i?p=!0:"]"===i&&(p=!1),u+=i}else{if(""===u)return uv;if(a=c.parseHost(u))return a;if(u="",l=qv,t===Kv)return}break;case qv:if(!$g(fv,i)){if(i===Nf||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()||t){if(""!==u){var y=Xg(u,10);if(y>65535)return hv;c.port=c.isSpecial()&&y===Ov[c.scheme]?null:y,u=""}if(t)return;l=Qv;continue}return hv}u+=i;break;case Yv:if(c.scheme="file","/"===i||"\\"===i)l=Xv;else{if(!n||"file"!==n.scheme){l=Zv;continue}switch(i){case Nf:c.host=n.host,c.path=Lg(n.path),c.query=n.query;break;case"?":c.host=n.host,c.path=Lg(n.path),c.query="",l=ey;break;case"#":c.host=n.host,c.path=Lg(n.path),c.query=n.query,c.fragment="",l=ty;break;default:kv(ev(Lg(r,d),""))||(c.host=n.host,c.path=Lg(n.path),c.shortenPath()),l=Zv;continue}}break;case Xv:if("/"===i||"\\"===i){l=Jv;break}n&&"file"===n.scheme&&!kv(ev(Lg(r,d),""))&&(Pv(n.path[0],!0)?rv(c.path,n.path[0]):c.host=n.host),l=Zv;continue;case Jv:if(i===Nf||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&Pv(u))l=Zv;else if(""===u){if(c.host="",t)return;l=Qv}else{if(a=c.parseHost(u))return a;if("localhost"===c.host&&(c.host=""),t)return;u="",l=Qv}continue}u+=i;break;case Qv:if(c.isSpecial()){if(l=Zv,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==Nf&&(l=Zv,"/"!==i))continue}else c.fragment="",l=ty;else c.query="",l=ey;break;case Zv:if(i===Nf||"/"===i||"\\"===i&&c.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(o=cv(o=u))||"%2e."===o||".%2e"===o||"%2e%2e"===o?(c.shortenPath(),"/"===i||"\\"===i&&c.isSpecial()||rv(c.path,"")):Dv(u)?"/"===i||"\\"===i&&c.isSpecial()||rv(c.path,""):("file"===c.scheme&&!c.path.length&&Pv(u)&&(c.host&&(c.host=""),u=Zg(u,0)+":"),rv(c.path,u)),u="","file"===c.scheme&&(i===Nf||"?"===i||"#"===i))for(;c.path.length>1&&""===c.path[0];)sv(c.path);"?"===i?(c.query="",l=ey):"#"===i&&(c.fragment="",l=ty)}else u+=Iv(i,Av);break;case $v:"?"===i?(c.query="",l=ey):"#"===i?(c.fragment="",l=ty):i!==Nf&&(c.path[0]+=Iv(i,Nv));break;case ey:t||"#"!==i?i!==Nf&&("'"===i&&c.isSpecial()?c.query+="%27":c.query+="#"===i?"%23":Iv(i,Nv)):(c.fragment="",l=ty);break;case ty:i!==Nf&&(c.fragment+=Iv(i,Cv))}d++}},parseHost:function(e){var t,n,r;if("["===Zg(e,0)){if("]"!==Zg(e,e.length-1))return uv;if(t=function(e){var t,n,r,i,s,a,o,c=[0,0,0,0,0,0,0,0],l=0,d=null,u=0,h=function(){return Zg(e,u)};if(":"===h()){if(":"!==Zg(e,1))return;u+=2,d=++l}for(;h();){if(8===l)return;if(":"!==h()){for(t=n=0;n<4&&$g(_v,h());)t=16*t+Xg(h(),16),u++,n++;if("."===h()){if(0===n)return;if(u-=n,l>6)return;for(r=0;h();){if(i=null,r>0){if(!("."===h()&&r<4))return;u++}if(!$g(fv,h()))return;for(;$g(fv,h());){if(s=Xg(h(),10),null===i)i=s;else{if(0===i)return;i=10*i+s}if(i>255)return;u++}c[l]=256*c[l]+i,2!=++r&&4!==r||l++}if(4!==r)return;break}if(":"===h()){if(u++,!h())return}else if(h())return;c[l++]=t}else{if(null!==d)return;u++,d=++l}}if(null!==d)for(a=l-d,l=7;0!==l&&a>0;)o=c[l],c[l--]=c[d+a-1],c[d+--a]=o;else if(8!==l)return;return c}(ov(e,1,-1)),!t)return uv;this.host=t}else if(this.isSpecial()){if(e=Mg(e),$g(Ev,e))return uv;if(t=function(e){var t,n,r,i,s,a,o,c=av(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""===(i=c[r]))return e;if(s=10,i.length>1&&"0"===Zg(i,0)&&(s=$g(gv,i)?16:8,i=ov(i,8===s?1:2)),""===i)a=0;else{if(!$g(10===s?yv:8===s?vv:_v,i))return e;a=Xg(i,s)}rv(n,a)}for(r=0;r<t;r++)if(a=n[r],r===t-1){if(a>=Qg(256,5-t))return null}else if(a>255)return null;for(o=nv(n),r=0;r<n.length;r++)o+=n[r]*Qg(256,3-r);return o}(e),null===t)return uv;this.host=t}else{if($g(bv,e))return uv;for(t="",n=Dg(e),r=0;r<n.length;r++)t+=Iv(n[r],Nv);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return Pg(Ov,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&Pv(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,a=e.path,o=e.query,c=e.fragment,l=t+":";return null!==i?(l+="//",e.includesCredentials()&&(l+=n+(r?":"+r:"")+"@"),l+=Tv(i),null!==s&&(l+=":"+s)):"file"===t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+ev(a,"/"):"",null!==o&&(l+="?"+o),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw new Yg(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new ry(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+Tv(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ug(e)+":",Lv)},getUsername:function(){return this.username},setUsername:function(e){var t=Dg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Iv(t[n],Rv)}},getPassword:function(){return this.password},setPassword:function(e){var t=Dg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Iv(t[n],Rv)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Tv(e):Tv(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,zv)},getHostname:function(){var e=this.host;return null===e?"":Tv(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Kv)},getPort:function(){var e=this.port;return null===e?"":Ug(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=Ug(e))?this.port=null:this.parse(e,qv))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ev(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Qv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=Ug(e))?this.query=null:("?"===Zg(e,0)&&(e=ov(e,1)),this.query="",this.parse(e,ey)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=Ug(e))?("#"===Zg(e,0)&&(e=ov(e,1)),this.fragment="",this.parse(e,ty)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var ry=function(e){var t=Og(this,iy),n=Fg(arguments.length,1)>1?arguments[1]:void 0,r=Hg(t,new ny(e,!1,n));Sg||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},iy=ry.prototype,sy=function(e,t){return{get:function(){return Wg(this)[e]()},set:t&&function(e){return Wg(this)[t](e)},configurable:!0,enumerable:!0}};if(Sg&&(Ig(iy,"href",sy("serialize","setHref")),Ig(iy,"origin",sy("getOrigin")),Ig(iy,"protocol",sy("getProtocol","setProtocol")),Ig(iy,"username",sy("getUsername","setUsername")),Ig(iy,"password",sy("getPassword","setPassword")),Ig(iy,"host",sy("getHost","setHost")),Ig(iy,"hostname",sy("getHostname","setHostname")),Ig(iy,"port",sy("getPort","setPort")),Ig(iy,"pathname",sy("getPathname","setPathname")),Ig(iy,"search",sy("getSearch","setSearch")),Ig(iy,"searchParams",sy("getSearchParams")),Ig(iy,"hash",sy("getHash","setHash"))),Rg(iy,"toJSON",function(){return Wg(this).serialize()},{enumerable:!0}),Rg(iy,"toString",function(){return Wg(this).serialize()},{enumerable:!0}),qg){var ay=qg.createObjectURL,oy=qg.revokeObjectURL;ay&&Rg(ry,"createObjectURL",Cg(ay,qg)),oy&&Rg(ry,"revokeObjectURL",Cg(oy,qg))}Vg(ry,"URL"),wg({global:!0,constructor:!0,forced:!Tg,sham:!Sg},{URL:ry});var cy=On,ly=i,dy=cl,uy=_r,hy=sm,py=se("URL"),my=hy&&ly(function(){py.canParse()}),fy=ly(function(){return 1!==py.canParse.length});cy({target:"URL",stat:!0,forced:!my||fy},{canParse:function(e){var t=dy(arguments.length,1),n=uy(e),r=t<2||void 0===arguments[1]?void 0:uy(arguments[1]);try{return!!new py(n,r)}catch(e){return!1}}});var gy=On,vy=cl,yy=_r,_y=sm,Ey=se("URL");gy({target:"URL",stat:!0,forced:!_y},{parse:function(e){var t=vy(arguments.length,1),n=yy(e),r=t<2||void 0===arguments[1]?void 0:yy(arguments[1]);try{return new Ey(n,r)}catch(e){return null}}});var by=r(ee.URL);let xy=!0,wy=!0;function Sy(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Ty(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const s=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,s),i.apply(this,[e,s])};const s=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(n))return s.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Ny(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(xy=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Cy(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(wy=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ay(){if("object"==typeof window){if(xy)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Ry(e,t){wy&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Iy(e){return"[object Object]"===Object.prototype.toString.call(e)}function Oy(e){var t;return Iy(e)?ii(t=Object.keys(e)).call(t,function(t,n){const r=Iy(e[n]),i=r?Oy(e[n]):e[n],s=r&&!Object.keys(i).length;return void 0===i||s?t:Object.assign(t,{[n]:i})},{}):e}function Py(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Py(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(t=>{Py(e,e.get(t),n)})}))}function ky(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const s=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&Py(e,n,i)})}),i}const Dy=Ay;function Ly(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const a=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{n=n.filter(e=>"videoinput"===e.kind);let a=n.find(e=>t.some(t=>{var n;return Dr(n=e.label.toLowerCase()).call(n,t)}));return!a&&n.length&&Dr(t).call(t,"back")&&(a=n[n.length-1]),a&&(e.video.deviceId=s.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),Dy("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return Dy("chrome: "+JSON.stringify(e)),i(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,e=>{n.webkitGetUserMedia(e,t,e=>{r&&r(s(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>np.reject(s(e))))}}}function jy(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function My(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ty(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Uy(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vy(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(s(i(e)))};return t.apply(this,[r,e])}return new np((e,n)=>{t.apply(this,[function(t){e(s(i(t)))},n])}).then(n,r)}}function Fy(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ky(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Ty(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ky(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?np.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():np.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function By(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function Gy(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return By(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[n.id];if(s)s.addTrack(t),np.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=s(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>s(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Hy(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})}function Wy(e,t){Ty(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var zy=Object.freeze({__proto__:null,fixNegotiationNeeded:Wy,shimAddTrackRemoveTrack:Gy,shimAddTrackRemoveTrackWithNative:By,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Uy,shimGetStats:Vy,shimGetUserMedia:Ly,shimMediaStream:jy,shimOnTrack:My,shimPeerConnection:Hy,shimSenderReceiverGetStats:Fy});function Ky(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Ry("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function qy(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Yy(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,s]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,s)}}function Xy(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):np.resolve(new Map)}}function Jy(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Ty(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Qy(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Ry("removeStream","removeTrack"),this.getSenders().forEach(t=>{var n;t.track&&Dr(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function Zy(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $y(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function e_(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function t_(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function n_(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var r_=Object.freeze({__proto__:null,shimAddTransceiver:$y,shimCreateAnswer:n_,shimCreateOffer:t_,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,np.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:e_,shimGetUserMedia:Ky,shimOnTrack:qy,shimPeerConnection:Yy,shimRTCDataChannel:Zy,shimReceiverGetStats:Jy,shimRemoveStream:Qy,shimSenderGetStats:Xy});function i_(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Dr(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach(e=>{var t;this._localStreams?Dr(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{Dr(n).call(n,e.track)&&this.removeTrack(e)})})}}function s_(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Dr(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function a_(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),np.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),np.resolve()):i};let o=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),np.resolve()):r};t.setLocalDescription=o,o=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),np.resolve()):r},t.setRemoteDescription=o,o=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),np.resolve()):r},t.addIceCandidate=o}function o_(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(c_(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function c_(e){return e&&void 0!==e.video?Object.assign({},e,{video:Oy(e.video)}):e}function l_(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Ry("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function d_(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function u_(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function h_(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var p_=Object.freeze({__proto__:null,shimAudioContext:h_,shimCallbacksAPI:a_,shimConstraints:c_,shimCreateOfferLegacy:u_,shimGetUserMedia:o_,shimLocalStreamsAPI:i_,shimRTCIceServerUrls:l_,shimRemoteStreamsAPI:s_,shimTrackEventTransceiver:d_}),m_="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",f_=Y,g_=_r,v_=m_,y_=d("".replace),__=RegExp("^["+v_+"]+"),E_=RegExp("(^|[^"+v_+"])["+v_+"]+$"),b_=function(e){return function(t){var n=g_(f_(t));return 1&e&&(n=y_(n,__,"")),2&e&&(n=y_(n,E_,"$1")),n}},x_={start:b_(1),end:b_(2),trim:b_(3)},w_=xo.PROPER,S_=i,T_=m_,N_=x_.trim;On({target:"String",proto:!0,forced:function(e){return S_(function(){return!!T_[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||w_&&T_[e].name!==e})}("trim")},{trim:function(){return N_(this)}});var C_=er("String","trim"),A_=u,R_=C_,I_=String.prototype,O_=function(e){var t=e.trim;return"string"==typeof e||e===I_||A_(I_,e)&&t===I_.trim?R_:t},P_=r(O_),k_={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)n=r[i].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let s=3;s<r.length;s++){const i=r[s],a=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){const r=t.parseRtpMap(a),s=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=s.length?t.parseFmtp(s[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{i.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)});let i=0;return n.codecs.forEach(e=>{e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{r+=t.writeExtmap(e)}),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),o=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===o&&(c=l[0][1]),r.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:s?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&o&&n.push({ssrc:o});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=d})),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const s=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(k_);var D_=k_.exports,L_=r(D_),j_=e({__proto__:null,default:L_},[D_]);function M_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=L_.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Ty(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function U_(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ty(e,"icecandidate",e=>{if(e.candidate){const t=L_.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function V_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=L_.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=L_.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},s=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=L_.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=s(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>a}),this._sctp=o}return a.apply(this,arguments)}}function F_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Ty(e,"datachannel",e=>(t(e.channel,e.target),e))}function B_(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function G_(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==P_(e).call(e)).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function H_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?np.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),np.resolve())})}function W_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var z_=Object.freeze({__proto__:null,removeExtmapAllowMixed:G_,shimAddIceCandidateNullOrEmpty:H_,shimConnectionState:B_,shimMaxMessageSize:V_,shimParameterlessSetLocalDescription:W_,shimRTCIceCandidate:M_,shimRTCIceCandidateRelayProtocol:U_,shimSendThrowTypeError:F_});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Ay,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Sy(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Sy(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Sy(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:z_,extractVersion:Sy,disableLog:Ny,disableWarnings:Cy,sdp:j_};switch(r.browser){case"chrome":if(!zy||!Hy||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=zy,H_(e,r),W_(e),Ly(e,r),jy(e),Hy(e,r),My(e),Gy(e,r),Uy(e),Vy(e),Fy(e),Wy(e,r),M_(e),U_(e),B_(e),V_(e,r),F_(e),G_(e,r);break;case"firefox":if(!r_||!Yy||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=r_,H_(e,r),W_(e),Ky(e,r),Yy(e,r),qy(e),Qy(e),Xy(e),Jy(e),Zy(e),$y(e),e_(e),t_(e),n_(e),M_(e),B_(e),V_(e,r),F_(e);break;case"safari":if(!p_||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=p_,H_(e,r),W_(e),l_(e),u_(e),a_(e),i_(e),s_(e),d_(e),o_(e),h_(e),M_(e),U_(e),V_(e,r),F_(e),G_(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var K_=p;On({global:!0,forced:K_.globalThis!==K_},{globalThis:K_});var q_=r(p),Y_={exports:{}};!function(e,n){!function(t,r){var i="function",s="undefined",a="object",o="string",c="major",l="model",d="name",u="type",h="vendor",p="version",m="architecture",f="console",g="mobile",v="tablet",y="smarttv",_="wearable",E="embedded",b="Amazon",x="Apple",w="ASUS",S="BlackBerry",T="Browser",N="Chrome",C="Firefox",A="Google",R="Huawei",I="LG",O="Microsoft",P="Motorola",k="Opera",D="Samsung",L="Sharp",j="Sony",M="Xiaomi",U="Zebra",V="Facebook",F="Chromium OS",B="Mac OS",G=" Browser",H=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},W=function(e,t){return typeof e===o&&-1!==z(t).indexOf(z(e))},z=function(e){return e.toLowerCase()},K=function(e,t){if(typeof e===o)return e=e.replace(/^\s\s*/,""),typeof t===s?e:e.substring(0,500)},q=function(e,t){for(var n,s,o,c,l,d,u=0;u<t.length&&!l;){var h=t[u],p=t[u+1];for(n=s=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(e))for(o=0;o<p.length;o++)d=l[++s],typeof(c=p[o])===a&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):r:this[c[0]]=d?c[1].call(this,d,c[2]):r:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):r):this[c]=d||r;u+=2}},Y=function(e,t){for(var n in t)if(typeof t[n]===a&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(W(t[n][i],e))return"?"===n?r:n}else if(W(t[n],e))return"?"===n?r:n;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,p],[/opios[\/ ]+([\w\.]+)/i],[p,[d,k+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[d,k+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[d,k]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[p,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[d,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[d,"Smart Lenovo "+T]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+T],p],[/\bfocus\/([\w\.]+)/i],[p,[d,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[d,k+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[d,k+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI"+G]],[/fxios\/([\w\.-]+)/i],[p,[d,C]],[/\bqihoobrowser\/?([\w\.]*)/i],[p,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+G],p],[/samsungbrowser\/([\w\.]+)/i],[p,[d,D+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[p,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,p],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[p,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,V],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[d,N+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,N+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[d,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[p,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],p],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[d,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,z]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",z]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,z]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,D],[u,v]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,D],[u,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[h,x],[u,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,x],[u,v]],[/(macintosh);/i],[l,[h,x]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,L],[u,g]],[/(?:honor)([-\w ]+)[;\)]/i],[l,[h,"Honor"],[u,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,R],[u,v]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,R],[u,g]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,g]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[u,g]],[/\b(opd2\d{3}a?) bui/i],[l,[h,"OPPO"],[u,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[u,g]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[u,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,P],[u,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,P],[u,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,I],[u,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,I],[u,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[u,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[u,g]],[/(pixel c)\b/i],[l,[h,A],[u,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,A],[u,g]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,j],[u,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,j],[u,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[u,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,b],[u,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,b],[u,g]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[u,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,S],[u,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,w],[u,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,w],[u,g]],[/(nexus 9)/i],[l,[h,"HTC"],[u,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[u,g]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[l,[h,"TCL"],[u,v]],[/(itel) ((\w+))/i],[[h,z],l,[u,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[u,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[u,g]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[h,"Ulefone"],[u,g]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[h,"Energizer"],[u,g]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[h,"Cat"],[u,g]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[h,"Smartfren"],[u,g]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[h,"Nothing"],[u,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[u,g]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[u,v]],[/(surface duo)/i],[l,[h,O],[u,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[u,g]],[/(u304aa)/i],[l,[h,"AT&T"],[u,g]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[u,g]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[u,v]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[u,v]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[u,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[u,v]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[u,v]],[/\b(k88) b/i],[l,[h,"ZTE"],[u,v]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[u,g]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[u,g]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[u,v]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[u,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[u,v]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[u,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[u,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[u,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[u,g]],[/\b(ph-1) /i],[l,[h,"Essential"],[u,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[u,v]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[u,v]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[u,v]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[u,v]],[/(sprint) (\w+)/i],[h,l,[u,g]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,O],[u,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,U],[u,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,U],[u,g]],[/smart-tv.+(samsung)/i],[h,[u,y]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,D],[u,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,I],[u,y]],[/(apple) ?tv/i],[h,[l,x+" TV"],[u,y]],[/crkey/i],[[l,N+"cast"],[h,A],[u,y]],[/droid.+aft(\w+)( bui|\))/i],[l,[h,b],[u,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,L],[u,y]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,j],[u,y]],[/(mitv-\w{5}) bui/i],[l,[h,M],[u,y]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[u,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,K],[l,K],[u,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[u,f]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[u,f]],[/(playstation [345portablevi]+)/i],[l,[h,j],[u,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,O],[u,f]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[l,[h,D],[u,_]],[/((pebble))app/i],[h,l,[u,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,x],[u,_]],[/droid.+; (glass) \d/i],[l,[h,A],[u,_]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,U],[u,_]],[/droid.+; (glass) \d/i],[l,[h,A],[u,_]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,l,[u,_]],[/; (quest( \d| pro)?)/i],[l,[h,V],[u,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[u,E]],[/(aeobc)\b/i],[l,[h,b],[u,E]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[l,[u,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[u,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,g]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,p],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[p,Y,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,Y,X],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,p],[/\(bb(10);/i],[p,[d,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[d,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[d,N+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,F],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,p],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,p]]},Q=function(e,n){if(typeof e===a&&(n=e,e=r),!(this instanceof Q))return new Q(e,n).getResult();var f=typeof t!==s&&t.navigator?t.navigator:r,y=e||(f&&f.userAgent?f.userAgent:""),_=f&&f.userAgentData?f.userAgentData:r,E=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(J,n):J,b=f&&f.userAgent==y;return this.getBrowser=function(){var e={};return e[d]=r,e[p]=r,q.call(e,y,E.browser),e[c]=function(e){return typeof e===o?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[p]),b&&f&&f.brave&&typeof f.brave.isBrave==i&&(e[d]="Brave"),e},this.getCPU=function(){var e={};return e[m]=r,q.call(e,y,E.cpu),e},this.getDevice=function(){var e={};return e[h]=r,e[l]=r,e[u]=r,q.call(e,y,E.device),b&&!e[u]&&_&&_.mobile&&(e[u]=g),b&&"Macintosh"==e[l]&&f&&typeof f.standalone!==s&&f.maxTouchPoints&&f.maxTouchPoints>2&&(e[l]="iPad",e[u]=v),e},this.getEngine=function(){var e={};return e[d]=r,e[p]=r,q.call(e,y,E.engine),e},this.getOS=function(){var e={};return e[d]=r,e[p]=r,q.call(e,y,E.os),b&&!e[d]&&_&&_.platform&&"Unknown"!=_.platform&&(e[d]=_.platform.replace(/chrome os/i,F).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return y},this.setUA=function(e){return y=typeof e===o&&e.length>500?K(e,500):e,this},this.setUA(y),this};Q.VERSION="0.7.40",Q.BROWSER=H([d,p,c]),Q.CPU=H([m]),Q.DEVICE=H([l,h,u,f,g,y,v,_,E]),Q.ENGINE=Q.OS=H([d,p]),e.exports&&(n=e.exports=Q),n.UAParser=Q;var Z=typeof t!==s&&(t.jQuery||t.Zepto);if(Z&&!Z.ua){var $=new Q;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==typeof window?window:t)}(Y_,Y_.exports);var X_=r(Y_.exports),J_=jl.clear;On({global:!0,bind:!0,enumerable:!0,forced:p.clearImmediate!==J_},{clearImmediate:J_});var Q_=p,Z_=y,$_=C,eE=Xr,tE=ce,nE=al,rE=cl,iE=Q_.Function,sE=/MSIE .\./.test(tE)||"BUN"===eE&&function(){var e=Q_.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}(),aE=On,oE=p,cE=jl.set,lE=function(e,t){var n=t?2:1;return sE?function(r,i){var s=rE(arguments.length,1)>n,a=$_(r)?r:iE(r),o=s?nE(arguments,n):[],c=s?function(){Z_(a,this,o)}:a;return t?e(c,i):e(c)}:e},dE=oE.setImmediate?lE(cE,!1):cE;aE({global:!0,bind:!0,enumerable:!0,forced:oE.setImmediate!==dE},{setImmediate:dE});var uE=r(ee.setImmediate),hE=p,pE=hd,mE=Oe,fE=cl,gE=R;On({global:!0,enumerable:!0,dontCallGetSet:!0,forced:i(function(){return gE&&1!==Object.getOwnPropertyDescriptor(hE,"queueMicrotask").value.length})},{queueMicrotask:function(e){fE(arguments.length,1),pE(mE(e))}});var vE=r(ee.queueMicrotask);function yE(e,t){return function(){return e.apply(t,arguments)}}const{toString:_E}=Object.prototype,{getPrototypeOf:EE}=Object,{iterator:bE,toStringTag:xE}=Symbol,wE=(SE=Object.create(null),e=>{const t=_E.call(e);return SE[t]||(SE[t]=t.slice(8,-1).toLowerCase())});var SE;const TE=e=>(e=e.toLowerCase(),t=>wE(t)===e),NE=e=>t=>typeof t===e,{isArray:CE}=Array,AE=NE("undefined"),RE=TE("ArrayBuffer"),IE=NE("string"),OE=NE("function"),PE=NE("number"),kE=e=>null!==e&&"object"==typeof e,DE=e=>{if("object"!==wE(e))return!1;const t=EE(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||xE in e||bE in e)},LE=TE("Date"),jE=TE("File"),ME=TE("Blob"),UE=TE("FileList"),VE=TE("URLSearchParams"),[FE,BE,GE,HE]=["ReadableStream","Request","Response","Headers"].map(TE);function WE(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),CE(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),s=r.length;let a;for(n=0;n<s;n++)a=r[n],t.call(null,e[a],a,e)}}function zE(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const KE=void 0!==q_?q_:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,qE=e=>!AE(e)&&e!==KE,YE=(XE="undefined"!=typeof Uint8Array&&EE(Uint8Array),e=>XE&&e instanceof XE);var XE;const JE=TE("HTMLFormElement"),QE=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),ZE=TE("RegExp"),$E=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};WE(n,(n,i)=>{let s;!1!==(s=t(n,i,e))&&(r[i]=s||n)}),Object.defineProperties(e,r)},eb=TE("AsyncFunction"),tb=(nb="function"==typeof uE,rb=OE(KE.postMessage),nb?uE:rb?(ib="axios@".concat(Math.random()),sb=[],KE.addEventListener("message",e=>{let{source:t,data:n}=e;t===KE&&n===ib&&sb.length&&sb.shift()()},!1),e=>{sb.push(e),KE.postMessage(ib,"*")}):e=>setTimeout(e));var nb,rb,ib,sb;const ab=void 0!==vE?vE.bind(KE):"undefined"!=typeof process&&process.nextTick||tb;var ob={isArray:CE,isArrayBuffer:RE,isBuffer:function(e){return null!==e&&!AE(e)&&null!==e.constructor&&!AE(e.constructor)&&OE(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||OE(e.append)&&("formdata"===(t=wE(e))||"object"===t&&OE(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&RE(e.buffer),t},isString:IE,isNumber:PE,isBoolean:e=>!0===e||!1===e,isObject:kE,isPlainObject:DE,isReadableStream:FE,isRequest:BE,isResponse:GE,isHeaders:HE,isUndefined:AE,isDate:LE,isFile:jE,isBlob:ME,isRegExp:ZE,isFunction:OE,isStream:e=>kE(e)&&OE(e.pipe),isURLSearchParams:VE,isTypedArray:YE,isFileList:UE,forEach:WE,merge:function e(){const{caseless:t}=qE(this)&&this||{},n={},r=(r,i)=>{const s=t&&zE(n,i)||i;DE(n[s])&&DE(r)?n[s]=e(n[s],r):DE(r)?n[s]=e({},r):CE(r)?n[s]=r.slice():n[s]=r};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&WE(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return WE(t,(t,r)=>{n&&OE(t)?e[r]=yE(t,n):e[r]=t},{allOwnKeys:r}),e},trim:e=>P_(e)?P_(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,a;const o={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],r&&!r(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==n&&EE(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:wE,kindOfTest:TE,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(CE(e))return e;let t=e.length;if(!PE(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[bE]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:JE,hasOwnProperty:QE,hasOwnProp:QE,reduceDescriptors:$E,freezeMethods:e=>{$E(e,(t,n)=>{if(OE(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];OE(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return CE(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:zE,global:KE,isContextDefined:qE,isSpecCompliantForm:function(e){return!!(e&&OE(e.append)&&"FormData"===e[xE]&&e[bE])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(kE(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=CE(e)?[]:{};return WE(e,(e,t)=>{const s=n(e,r+1);!AE(s)&&(i[t]=s)}),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:eb,isThenable:e=>e&&(kE(e)||OE(e))&&OE(e.then)&&OE(e.catch),setImmediate:tb,asap:ab,isIterable:e=>null!=e&&OE(e[bE])};function cb(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}ob.inherits(cb,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ob.toJSONObject(this.config),code:this.code,status:this.status}}});const lb=cb.prototype,db={};function ub(e){return ob.isPlainObject(e)||ob.isArray(e)}function hb(e){return ob.endsWith(e,"[]")?e.slice(0,-2):e}function pb(e,t,n){return e?e.concat(t).map(function(e,t){return e=hb(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{db[e]={value:e}}),Object.defineProperties(cb,db),Object.defineProperty(lb,"isAxiosError",{value:!0}),cb.from=(e,t,n,r,i,s)=>{const a=Object.create(lb);return ob.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),cb.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};const mb=ob.toFlatObject(ob,{},null,function(e){return/^is[A-Z]/.test(e)});function fb(e,t,n){if(!ob.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=ob.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!ob.isUndefined(t[e])})).metaTokens,i=n.visitor||l,s=n.dots,a=n.indexes,o=(n.Blob||"undefined"!=typeof Blob&&Blob)&&ob.isSpecCompliantForm(t);if(!ob.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(ob.isDate(e))return e.toISOString();if(!o&&ob.isBlob(e))throw new cb("Blob is not supported. Use a Buffer instead.");return ob.isArrayBuffer(e)||ob.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let o=e;if(e&&!i&&"object"==typeof e)if(ob.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(ob.isArray(e)&&function(e){return ob.isArray(e)&&!e.some(ub)}(e)||(ob.isFileList(e)||ob.endsWith(n,"[]"))&&(o=ob.toArray(e)))return n=hb(n),o.forEach(function(e,r){!ob.isUndefined(e)&&null!==e&&t.append(!0===a?pb([n],r,s):null===a?n:n+"[]",c(e))}),!1;return!!ub(e)||(t.append(pb(i,n,s),c(e)),!1)}const d=[],u=Object.assign(mb,{defaultVisitor:l,convertValue:c,isVisitable:ub});if(!ob.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!ob.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),ob.forEach(n,function(n,s){!0===(!(ob.isUndefined(n)||null===n)&&i.call(t,n,ob.isString(s)?P_(s).call(s):s,r,u))&&e(n,r?r.concat(s):[s])}),d.pop()}}(e),t}function gb(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function vb(e,t){this._pairs=[],e&&fb(e,this,t)}const yb=vb.prototype;function _b(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Eb(e,t,n){if(!t)return e;const r=n&&n.encode||_b;ob.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):ob.isURLSearchParams(t)?t.toString():new vb(t,n).toString(r),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}yb.append=function(e,t){this._pairs.push([e,t])},yb.toString=function(e){const t=e?function(t){return e.call(this,t,gb)}:gb;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var bb=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ob.forEach(this.handlers,function(t){null!==t&&e(t)})}},xb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wb={exports:{}},Sb=On,Tb=R,Nb=$t.f;Sb({target:"Object",stat:!0,forced:Object.defineProperty!==Nb,sham:!Tb},{defineProperty:Nb});var Cb=ee.Object,Ab=wb.exports=function(e,t,n){return Cb.defineProperty(e,t,n)};Cb.defineProperty.sham&&(Ab.sham=!0);var Rb=r(wb.exports),Ib=TypeError,Ob=ai,Pb=Qc,kb=$,Db=mt("species"),Lb=Array,jb=function(e){var t;return Ob(e)&&(t=e.constructor,(Pb(t)&&(t===Lb||Ob(t.prototype))||kb(t)&&null===(t=t[Db]))&&(t=void 0)),void 0===t?Lb:t},Mb=function(e,t){return new(jb(e))(0===t?0:t)},Ub=i,Vb=fe,Fb=mt("species"),Bb=function(e){return Vb>=51||!Ub(function(){var t=[];return(t.constructor={})[Fb]=function(){return{foo:1}},1!==t[e](Boolean).foo})},Gb=On,Hb=i,Wb=ai,zb=$,Kb=Qe,qb=zn,Yb=function(e){if(e>9007199254740991)throw Ib("Maximum allowed index exceeded");return e},Xb=qf,Jb=Mb,Qb=Bb,Zb=fe,$b=mt("isConcatSpreadable"),ex=Zb>=51||!Hb(function(){var e=[];return e[$b]=!1,e.concat()[0]!==e}),tx=function(e){if(!zb(e))return!1;var t=e[$b];return void 0!==t?!!t:Wb(e)};Gb({target:"Array",proto:!0,arity:1,forced:!ex||!Qb("concat")},{concat:function(e){var t,n,r,i,s,a=Kb(this),o=Jb(a,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(tx(s=-1===t?a:arguments[t]))for(i=qb(s),Yb(c+i),n=0;n<i;n++,c++)n in s&&Xb(o,c,s[n]);else Yb(c+1),Xb(o,c++,s);return o.length=c,o}});var nx={},rx=x,ix=Q,sx=Bi.f,ax=al,ox="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];nx.f=function(e){return ox&&"Window"===rx(e)?function(e){try{return sx(e)}catch(e){return ax(ox)}}(e):sx(ix(e))};var cx={},lx=mt;cx.f=lx;var dx=ee,ux=et,hx=cx,px=$t.f,mx=function(e){var t=dx.Symbol||(dx.Symbol={});ux(t,e)||px(t,e,{value:hx.f(e)})},fx=P,gx=se,vx=mt,yx=So,_x=function(){var e=gx("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=vx("toPrimitive");t&&!t[r]&&yx(t,r,function(e){return fx(n,this)},{arity:1})},Ex=Zt,bx=W,xx=Qe,wx=zn,Sx=Mb,Tx=d([].push),Nx=function(e){var t=1===e,n=2===e,r=3===e,i=4===e,s=6===e,a=7===e,o=5===e||s;return function(c,l,d,u){for(var h,p,m=xx(c),f=bx(m),g=wx(f),v=Ex(l,d),y=0,_=u||Sx,E=t?_(c,g):n||a?_(c,0):void 0;g>y;y++)if((o||y in f)&&(p=v(h=f[y],y,m),e))if(t)E[y]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return y;case 2:Tx(E,h)}else switch(e){case 4:return!1;case 7:Tx(E,h)}return s?-1:r||i?i:E}},Cx={forEach:Nx(0),map:Nx(1),filter:Nx(2),some:Nx(3),every:Nx(4),find:Nx(5),findIndex:Nx(6),filterReject:Nx(7)},Ax=On,Rx=p,Ix=P,Ox=d,Px=R,kx=_e,Dx=i,Lx=et,jx=u,Mx=sn,Ux=Q,Vx=St,Fx=_r,Bx=V,Gx=Ds,Hx=hs,Wx=Bi,zx=nx,Kx=Zi,qx=A,Yx=$t,Xx=ls,Jx=k,Qx=So,Zx=wc,$x=Ye,ew=Gi,tw=st,nw=mt,rw=cx,iw=mx,sw=_x,aw=Ho,ow=go,cw=Cx.forEach,lw=Ei("hidden"),dw="Symbol",uw="prototype",hw=ow.set,pw=ow.getterFor(dw),mw=Object[uw],fw=Rx.Symbol,gw=fw&&fw[uw],vw=Rx.RangeError,yw=Rx.TypeError,_w=Rx.QObject,Ew=qx.f,bw=Yx.f,xw=zx.f,ww=Jx.f,Sw=Ox([].push),Tw=$x("symbols"),Nw=$x("op-symbols"),Cw=$x("wks"),Aw=!_w||!_w[uw]||!_w[uw].findChild,Rw=function(e,t,n){var r=Ew(mw,t);r&&delete mw[t],bw(e,t,n),r&&e!==mw&&bw(mw,t,r)},Iw=Px&&Dx(function(){return 7!==Gx(bw({},"a",{get:function(){return bw(this,"a",{value:7}).a}})).a})?Rw:bw,Ow=function(e,t){var n=Tw[e]=Gx(gw);return hw(n,{type:dw,tag:e,description:t}),Px||(n.description=t),n},Pw=function(e,t,n){e===mw&&Pw(Nw,t,n),Mx(e);var r=Vx(t);return Mx(n),Lx(Tw,r)?(n.enumerable?(Lx(e,lw)&&e[lw][r]&&(e[lw][r]=!1),n=Gx(n,{enumerable:Bx(0,!1)})):(Lx(e,lw)||bw(e,lw,Bx(1,Gx(null))),e[lw][r]=!0),Iw(e,r,n)):bw(e,r,n)},kw=function(e,t){Mx(e);var n=Ux(t),r=Hx(n).concat(Mw(n));return cw(r,function(t){Px&&!Ix(Dw,n,t)||Pw(e,t,n[t])}),e},Dw=function(e){var t=Vx(e),n=Ix(ww,this,t);return!(this===mw&&Lx(Tw,t)&&!Lx(Nw,t))&&(!(n||!Lx(this,t)||!Lx(Tw,t)||Lx(this,lw)&&this[lw][t])||n)},Lw=function(e,t){var n=Ux(e),r=Vx(t);if(n!==mw||!Lx(Tw,r)||Lx(Nw,r)){var i=Ew(n,r);return!i||!Lx(Tw,r)||Lx(n,lw)&&n[lw][r]||(i.enumerable=!0),i}},jw=function(e){var t=xw(Ux(e)),n=[];return cw(t,function(e){Lx(Tw,e)||Lx(ew,e)||Sw(n,e)}),n},Mw=function(e){var t=e===mw,n=xw(t?Nw:Ux(e)),r=[];return cw(n,function(e){!Lx(Tw,e)||t&&!Lx(mw,e)||Sw(r,Tw[e])}),r};kx||(fw=function(){if(jx(gw,this))throw new yw("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Fx(arguments[0]):void 0,t=tw(e),n=function(e){var r=void 0===this?Rx:this;r===mw&&Ix(n,Nw,e),Lx(r,lw)&&Lx(r[lw],t)&&(r[lw][t]=!1);var i=Bx(1,e);try{Iw(r,t,i)}catch(e){if(!(e instanceof vw))throw e;Rw(r,t,i)}};return Px&&Aw&&Iw(mw,t,{configurable:!0,set:n}),Ow(t,e)},Qx(gw=fw[uw],"toString",function(){return pw(this).tag}),Qx(fw,"withoutSetter",function(e){return Ow(tw(e),e)}),Jx.f=Dw,Yx.f=Pw,Xx.f=kw,qx.f=Lw,Wx.f=zx.f=jw,Kx.f=Mw,rw.f=function(e){return Ow(nw(e),e)},Px&&Zx(gw,"description",{configurable:!0,get:function(){return pw(this).description}})),Ax({global:!0,constructor:!0,wrap:!0,forced:!kx,sham:!kx},{Symbol:fw}),cw(Hx(Cw),function(e){iw(e)}),Ax({target:dw,stat:!0,forced:!kx},{useSetter:function(){Aw=!0},useSimple:function(){Aw=!1}}),Ax({target:"Object",stat:!0,forced:!kx,sham:!Px},{create:function(e,t){return void 0===t?Gx(e):kw(Gx(e),t)},defineProperty:Pw,defineProperties:kw,getOwnPropertyDescriptor:Lw}),Ax({target:"Object",stat:!0,forced:!kx},{getOwnPropertyNames:jw}),sw(),aw(fw,dw),ew[lw]=!0;var Uw=_e&&!!Symbol.for&&!!Symbol.keyFor,Vw=On,Fw=se,Bw=et,Gw=_r,Hw=Ye,Ww=Uw,zw=Hw("string-to-symbol-registry"),Kw=Hw("symbol-to-string-registry");Vw({target:"Symbol",stat:!0,forced:!Ww},{for:function(e){var t=Gw(e);if(Bw(zw,t))return zw[t];var n=Fw("Symbol")(t);return zw[t]=n,Kw[n]=t,n}});var qw=On,Yw=et,Xw=Te,Jw=Ce,Qw=Uw,Zw=Ye("symbol-to-string-registry");qw({target:"Symbol",stat:!0,forced:!Qw},{keyFor:function(e){if(!Xw(e))throw new TypeError(Jw(e)+" is not a symbol");if(Yw(Zw,e))return Zw[e]}});var $w=ai,eS=C,tS=x,nS=_r,rS=d([].push),iS=On,sS=se,aS=y,oS=P,cS=d,lS=i,dS=C,uS=Te,hS=al,pS=function(e){if(eS(e))return e;if($w(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?rS(n,i):"number"!=typeof i&&"Number"!==tS(i)&&"String"!==tS(i)||rS(n,nS(i))}var s=n.length,a=!0;return function(e,t){if(a)return a=!1,t;if($w(this))return t;for(var r=0;r<s;r++)if(n[r]===e)return t}}},mS=_e,fS=String,gS=sS("JSON","stringify"),vS=cS(/./.exec),yS=cS("".charAt),_S=cS("".charCodeAt),ES=cS("".replace),bS=cS(1..toString),xS=/[\uD800-\uDFFF]/g,wS=/^[\uD800-\uDBFF]$/,SS=/^[\uDC00-\uDFFF]$/,TS=!mS||lS(function(){var e=sS("Symbol")("stringify detection");return"[null]"!==gS([e])||"{}"!==gS({a:e})||"{}"!==gS(Object(e))}),NS=lS(function(){return'"\\udf06\\ud834"'!==gS("\udf06\ud834")||'"\\udead"'!==gS("\udead")}),CS=function(e,t){var n=hS(arguments),r=pS(t);if(dS(r)||void 0!==e&&!uS(e))return n[1]=function(e,t){if(dS(r)&&(t=oS(r,this,fS(e),t)),!uS(t))return t},aS(gS,null,n)},AS=function(e,t,n){var r=yS(n,t-1),i=yS(n,t+1);return vS(wS,e)&&!vS(SS,i)||vS(SS,e)&&!vS(wS,r)?"\\u"+bS(_S(e,0),16):e};gS&&iS({target:"JSON",stat:!0,arity:3,forced:TS||NS},{stringify:function(e,t,n){var r=hS(arguments),i=aS(TS?CS:gS,null,r);return NS&&"string"==typeof i?ES(i,xS,AS):i}});var RS=Zi,IS=Qe;On({target:"Object",stat:!0,forced:!_e||i(function(){RS.f(1)})},{getOwnPropertySymbols:function(e){var t=RS.f;return t?t(IS(e)):[]}}),mx("asyncIterator"),mx("hasInstance"),mx("isConcatSpreadable"),mx("iterator"),mx("match"),mx("matchAll"),mx("replace"),mx("search"),mx("species"),mx("split");var OS=_x;mx("toPrimitive"),OS();var PS=se,kS=Ho;mx("toStringTag"),kS(PS("Symbol"),"Symbol"),mx("unscopables"),Ho(p.JSON,"JSON",!0);var DS=ee.Symbol,LS=mt,jS=$t.f,MS=LS("metadata"),US=Function.prototype;void 0===US[MS]&&jS(US,MS,{value:null}),mx("asyncDispose"),mx("dispose"),mx("metadata");var VS=DS,FS=d,BS=se("Symbol"),GS=BS.keyFor,HS=FS(BS.prototype.valueOf),WS=BS.isRegisteredSymbol||function(e){try{return void 0!==GS(HS(e))}catch(e){return!1}};On({target:"Symbol",stat:!0},{isRegisteredSymbol:WS});for(var zS=Ye,KS=se,qS=d,YS=Te,XS=mt,JS=KS("Symbol"),QS=JS.isWellKnownSymbol,ZS=KS("Object","getOwnPropertyNames"),$S=qS(JS.prototype.valueOf),eT=zS("wks"),tT=0,nT=ZS(JS),rT=nT.length;tT<rT;tT++)try{var iT=nT[tT];YS(JS[iT])&&XS(iT)}catch(e){}var sT=function(e){if(QS&&QS(e))return!0;try{for(var t=$S(e),n=0,r=ZS(eT),i=r.length;n<i;n++)if(eT[r[n]]==t)return!0}catch(e){}return!1};On({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:sT}),mx("customMatcher"),mx("observable"),On({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:WS}),On({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:sT}),mx("matcher"),mx("metadataKey"),mx("patternMatch"),mx("replaceAll");var aT=r(VS),oT=r(cx.f("iterator"));function cT(e){return cT="function"==typeof aT&&"symbol"==typeof oT?function(e){return typeof e}:function(e){return e&&"function"==typeof aT&&e.constructor===aT&&e!==aT.prototype?"symbol":typeof e},cT(e)}var lT=r(cx.f("toPrimitive"));function dT(e){var t=function(e,t){if("object"!=cT(e)||!e)return e;var n=e[lT];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=cT(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==cT(t)?t:t+""}function uT(e,t,n){return(t=dT(t))in e?Rb(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hT=r(Af),pT={isBrowser:!0,classes:{URLSearchParams:void 0!==hT?hT:vb,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const mT="undefined"!=typeof window&&"undefined"!=typeof document,fT="object"==typeof navigator&&navigator||void 0,gT=mT&&(!fT||["ReactNative","NativeScript","NS"].indexOf(fT.product)<0),vT="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,yT=mT&&window.location.href||"http://localhost";function _T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ET(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_T(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var bT=ET(ET({},Object.freeze({__proto__:null,hasBrowserEnv:mT,hasStandardBrowserEnv:gT,hasStandardBrowserWebWorkerEnv:vT,navigator:fT,origin:yT})),pT),xT=sn,wT=P,ST=et,TT=u,NT=function(){var e=xT(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},CT=RegExp.prototype,AT=function(e){var t=e.flags;return void 0!==t||"flags"in CT||ST(e,"flags")||!TT(CT,e)?t:wT(NT,e)},RT=Fh.charAt,IT=P,OT=sn,PT=C,kT=x,DT=/./.exec,LT=TypeError,jT=On,MT=P,UT=T,VT=Jo,FT=pc,BT=Y,GT=Hn,HT=_r,WT=sn,zT=$,KT=x,qT=sr,YT=AT,XT=De,JT=i,QT=sl,ZT=function(e,t,n){return t+(n?RT(e,t).length:1)},$T=function(e,t){var n=e.exec;if(PT(n)){var r=IT(n,e,t);return null!==r&&OT(r),r}if("RegExp"===kT(e))return IT(DT,e,t);throw new LT("RegExp#exec called on incompatible receiver")},eN=go,tN=mt("matchAll"),nN="RegExp String",rN=nN+" Iterator",iN=eN.set,sN=eN.getterFor(rN),aN=TypeError,oN=UT("".indexOf),cN=UT("".matchAll),lN=!!cN&&!JT(function(){cN("a",/./)}),dN=VT(function(e,t,n,r){iN(this,{type:rN,regexp:e,string:t,global:n,unicode:r,done:!1})},nN,function(){var e=sN(this);if(e.done)return FT(void 0,!0);var t=e.regexp,n=e.string,r=$T(t,n);return null===r?(e.done=!0,FT(void 0,!0)):e.global?(""===HT(r[0])&&(t.lastIndex=ZT(n,GT(t.lastIndex),e.unicode)),FT(r,!1)):(e.done=!0,FT(r,!1))}),uN=function(e){var t,n,r,i=WT(this),s=HT(e),a=QT(i,RegExp),o=HT(YT(i));return t=new a(a===RegExp?i.source:i,o),n=!!~oN(o,"g"),r=!!~oN(o,"u"),t.lastIndex=GT(i.lastIndex),new dN(t,s,n,r)};jT({target:"String",proto:!0,forced:lN},{matchAll:function(e){var t,n,r,i,s=BT(this);if(zT(e)){if(qT(e)&&(t=HT(BT(YT(e))),!~oN(t,"g")))throw new aN("`.matchAll` does not allow non-global regexes");if(lN)return cN(s,e);if(void 0===(r=XT(e,tN))&&"RegExp"===KT(e)&&(r=uN),r)return MT(r,e,s)}else if(lN)return cN(s,e);return n=HT(s),i=new RegExp(e,"g"),MT(uN,i,n)}});var hN=er("String","matchAll"),pN=u,mN=hN,fN=String.prototype,gN=function(e){var t=e.matchAll;return"string"==typeof e||e===fN||pN(fN,e)&&t===fN.matchAll?mN:t},vN=r(gN);function yN(e){function t(e,n,r,i){let s=e[i++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),o=i>=e.length;return s=!s&&ob.isArray(r)?r.length:s,o?(ob.hasOwnProp(r,s)?r[s]=[r[s],n]:r[s]=n,!a):(r[s]&&ob.isObject(r[s])||(r[s]=[]),t(e,n,r[s],i)&&ob.isArray(r[s])&&(r[s]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let s;for(r=0;r<i;r++)s=n[r],t[s]=e[s];return t}(r[s])),!a)}if(ob.isFormData(e)&&ob.isFunction(e.entries)){const n={};return ob.forEachEntry(e,(e,r)=>{t(function(e){return vN(ob).call(ob,/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null}const _N={transitional:xb,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=ob.isObject(e);if(i&&ob.isHTMLForm(e)&&(e=new FormData(e)),ob.isFormData(e))return r?JSON.stringify(yN(e)):e;if(ob.isArrayBuffer(e)||ob.isBuffer(e)||ob.isStream(e)||ob.isFile(e)||ob.isBlob(e)||ob.isReadableStream(e))return e;if(ob.isArrayBufferView(e))return e.buffer;if(ob.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return fb(e,new bT.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return bT.isNode&&ob.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=ob.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return fb(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(ob.isString(e))try{return(t||JSON.parse)(e),P_(ob).call(ob,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||_N.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(ob.isResponse(e)||ob.isReadableStream(e))return e;if(e&&ob.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw cb.from(e,cb.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bT.classes.FormData,Blob:bT.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ob.forEach(["delete","get","head","post","put","patch"],e=>{_N.headers[e]={}});var EN=_N;const bN=ob.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),xN=Symbol("internals");function wN(e){var t;return e&&P_(t=String(e)).call(t).toLowerCase()}function SN(e){return!1===e||null==e?e:ob.isArray(e)?e.map(SN):String(e)}function TN(e,t,n,r,i){return ob.isFunction(r)?r.call(this,t,n):(i&&(t=n),ob.isString(t)?ob.isString(r)?-1!==t.indexOf(r):ob.isRegExp(r)?r.test(t):void 0:void 0)}class NN{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=wN(t);if(!i)throw new Error("header name must be a non-empty string");const s=ob.findKey(r,i);(!s||void 0===r[s]||!0===n||void 0===n&&!1!==r[s])&&(r[s||t]=SN(e))}const s=(e,t)=>ob.forEach(e,(e,n)=>i(e,n,t));if(ob.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(ob.isString(e)&&(e=P_(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(P_(a=e).call(a)))s((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach(function(e){var s,a;i=e.indexOf(":"),n=P_(s=e.substring(0,i)).call(s).toLowerCase(),r=P_(a=e.substring(i+1)).call(a),!n||t[n]&&bN[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(ob.isObject(e)&&ob.isIterable(e)){let n,r,i={};for(const t of e){if(!ob.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[r=t[0]]=(n=i[r])?ob.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,n);var a;return this}get(e,t){if(e=wN(e)){const n=ob.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(ob.isFunction(t))return t.call(this,e,n);if(ob.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=wN(e)){const n=ob.findKey(this,e);return!(!n||void 0===this[n]||t&&!TN(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=wN(e)){const i=ob.findKey(n,e);!i||t&&!TN(0,n[i],i,t)||(delete n[i],r=!0)}}return ob.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!TN(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return ob.forEach(this,(r,i)=>{var s;const a=ob.findKey(n,i);if(a)return t[a]=SN(r),void delete t[i];const o=e?function(e){return P_(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(i):P_(s=String(i)).call(s);o!==i&&delete t[i],t[o]=SN(r),n[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return ob.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&ob.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[xN]=this[xN]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=wN(e);t[r]||(function(e,t){const n=ob.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})})}(n,e),t[r]=!0)}return ob.isArray(e)?e.forEach(r):r(e),this}}NN.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ob.reduceDescriptors(NN.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}}),ob.freezeMethods(NN);var CN=NN;function AN(e,t){const n=this||EN,r=t||n,i=CN.from(r.headers);let s=r.data;return ob.forEach(e,function(e){s=e.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function RN(e){return!(!e||!e.__CANCEL__)}function IN(e,t,n){cb.call(this,null==e?"canceled":e,cb.ERR_CANCELED,t,n),this.name="CanceledError"}function ON(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new cb("Request failed with status code "+n.status,[cb.ERR_BAD_REQUEST,cb.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}ob.inherits(IN,cb,{__CANCEL__:!0});const PN=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const c=Date.now(),l=r[a];i||(i=c),n[s]=o,r[s]=c;let d=a,u=0;for(;d!==s;)u+=n[d++],d%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),c-i<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let n,r,i=0,s=1e3/t;const a=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=s,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];t>=s?a(c,e):(n=c,r||(r=setTimeout(()=>{r=null,a(n)},s-t)))},()=>n&&a(n)]}(n=>{const s=n.loaded,a=n.lengthComputable?n.total:void 0,o=s-r,c=i(o);r=s,e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&s<=a?(a-s)/c:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},kN=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},DN=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ob.asap(()=>e(...n))};var LN=bT.hasStandardBrowserEnv?((e,t)=>n=>(n=new by(n,bT.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new by(bT.origin),bT.navigator&&/(msie|trident)/i.test(bT.navigator.userAgent)):()=>!0,jN=bT.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const a=[e+"="+encodeURIComponent(t)];ob.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),ob.isString(r)&&a.push("path="+r),ob.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function MN(e,t,n){let r=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function UN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}const VN=e=>e instanceof CN?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UN(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UN(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e):e;function FN(e,t){t=t||{};const n={};function r(e,t,n,r){return ob.isPlainObject(e)&&ob.isPlainObject(t)?ob.merge.call({caseless:r},e,t):ob.isPlainObject(t)?ob.merge({},t):ob.isArray(t)?t.slice():t}function i(e,t,n,i){return ob.isUndefined(t)?ob.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function s(e,t){if(!ob.isUndefined(t))return r(void 0,t)}function a(e,t){return ob.isUndefined(t)?ob.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(n,i,s){return s in t?r(n,i):s in e?r(void 0,n):void 0}const c={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,n)=>i(VN(e),VN(t),0,!0)};return ob.forEach(Object.keys(Object.assign({},e,t)),function(r){const s=c[r]||i,a=s(e[r],t[r],r);ob.isUndefined(a)&&s!==o||(n[r]=a)}),n}var BN=e=>{const t=FN({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:a,headers:o,auth:c}=t;if(t.headers=o=CN.from(o),t.url=Eb(MN(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),ob.isFormData(r))if(bT.hasStandardBrowserEnv||bT.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(n=o.getContentType())){const[e,...t]=n?n.split(";").map(e=>P_(e).call(e)).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(bT.hasStandardBrowserEnv&&(i&&ob.isFunction(i)&&(i=i(t)),i||!1!==i&&LN(t.url))){const e=s&&a&&jN.read(a);e&&o.set(s,e)}return t},GN="undefined"!=typeof XMLHttpRequest&&function(e){return new np(function(t,n){const r=BN(e);let i=r.data;const s=CN.from(r.headers).normalize();let a,o,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=r;function m(){l&&l(),d&&d(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let f=new XMLHttpRequest;function g(){if(!f)return;const r=CN.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());ON(function(e){t(e),m()},function(e){n(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:e,request:f}),f=null}f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(n(new cb("Request aborted",cb.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new cb("Network Error",cb.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||xb;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new cb(t,i.clarifyTimeoutError?cb.ETIMEDOUT:cb.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&ob.forEach(s.toJSON(),function(e,t){f.setRequestHeader(t,e)}),ob.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),u&&"json"!==u&&(f.responseType=r.responseType),p&&([c,d]=PN(p,!0),f.addEventListener("progress",c)),h&&f.upload&&([o,l]=PN(h),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(a=t=>{f&&(n(!t||t.type?new IN(null,e,f):t),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===bT.protocols.indexOf(v)?n(new cb("Unsupported protocol "+v+":",cb.ERR_BAD_REQUEST,e)):f.send(i||null)})},HN=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;r.abort(t instanceof cb?t:new IN(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new cb("timeout ".concat(t," of ms exceeded"),cb.ETIMEDOUT))},t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:o}=r;return o.unsubscribe=()=>ob.asap(a),o}},WN=r(tp),zN=cx.f("asyncIterator"),KN=r(zN);function qN(e,t){this.v=e,this.k=t}function YN(e){return function(){return new XN(e.apply(this,arguments))}}function XN(e){var t,n;function r(t,n){try{var s=e[t](n),a=s.value,o=a instanceof qN;WN.resolve(o?a.v:a).then(function(n){if(o){var c="return"===t?"return":"next";if(!a.k||n.done)return r(c,n);n=e[c](n).value}i(s.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new WN(function(s,a){var o={key:e,arg:i,resolve:s,reject:a,next:null};n?n=n.next=o:(t=n=o,r(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}function JN(e){return new qN(e,0)}function QN(e){var t={},n=!1;function r(t,r){return n=!0,r=new WN(function(n){n(e[t](r))}),{done:!1,value:new qN(r,1)}}return t[void 0!==aT&&oT||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}XN.prototype["function"==typeof aT&&KN||"@@asyncIterator"]=function(){return this},XN.prototype.next=function(e){return this._invoke("next",e)},XN.prototype.throw=function(e){return this._invoke("throw",e)},XN.prototype.return=function(e){return this._invoke("return",e)};var ZN=r(zN);function $N(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=ZN,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new eC(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function eC(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then(function(e){return{value:e,done:t}})}return eC=function(e){this.s=e,this.n=e.next},eC.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new eC(e)}const tC=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},nC=function(){var e=YN(function*(e,t){var n,r=!1,i=!1;try{for(var s,a=$N(rC(e));r=!(s=yield JN(a.next())).done;r=!1){const e=s.value;yield*QN($N(tC(e,t)))}}catch(e){i=!0,n=e}finally{try{r&&null!=a.return&&(yield JN(a.return()))}finally{if(i)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),rC=function(){var e=YN(function*(e){if(e[ZN])return void(yield*QN($N(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield JN(t.read());if(e)break;yield n}}finally{yield JN(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),iC=(e,t,n,r)=>{const i=nC(e,t);let s,a=0,o=e=>{s||(s=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return o(),void e.close();let s=r.byteLength;if(n){let e=a+=s;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw o(e),e}},cancel:e=>(o(e),i.return())},{highWaterMark:2})};function sC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function aC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sC(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const oC="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,cC=oC&&"function"==typeof ReadableStream,lC=oC&&("function"==typeof TextEncoder?(dC=new TextEncoder,e=>dC.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var dC;const uC=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(e){return!1}},hC=cC&&uC(()=>{let e=!1;const t=new Request(bT.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),pC=cC&&uC(()=>ob.isReadableStream(new Response("").body)),mC={stream:pC&&(e=>e.body)};var fC;oC&&(fC=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!mC[e]&&(mC[e]=ob.isFunction(fC[e])?t=>t[e]():(t,n)=>{throw new cb("Response type '".concat(e,"' is not supported"),cb.ERR_NOT_SUPPORT,n)})}));const gC=async(e,t)=>{const n=ob.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(ob.isBlob(e))return e.size;if(ob.isSpecCompliantForm(e)){const t=new Request(bT.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return ob.isArrayBufferView(e)||ob.isArrayBuffer(e)?e.byteLength:(ob.isURLSearchParams(e)&&(e+=""),ob.isString(e)?(await lC(e)).byteLength:void 0)})(t):n};var vC=oC&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:c,responseType:l,headers:d,withCredentials:u="same-origin",fetchOptions:h}=BN(e);l=l?(l+"").toLowerCase():"text";let p,m=HN([i,s&&s.toAbortSignal()],a);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(c&&hC&&"get"!==n&&"head"!==n&&0!==(g=await gC(d,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(ob.isFormData(r)&&(e=n.headers.get("content-type"))&&d.setContentType(e),n.body){const[e,t]=kN(g,PN(DN(c)));r=iC(n.body,65536,e,t)}}ob.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,aC(aC({},h),{},{signal:m,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:r,duplex:"half",credentials:i?u:void 0}));let s=await fetch(p);const a=pC&&("stream"===l||"response"===l);if(pC&&(o||a&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=ob.toFiniteNumber(s.headers.get("content-length")),[n,r]=o&&kN(t,PN(DN(o),!0))||[];s=new Response(iC(s.body,65536,n,()=>{r&&r(),f&&f()}),e)}l=l||"text";let v=await mC[ob.findKey(mC,l)||"text"](s,e);return!a&&f&&f(),await new np((t,n)=>{ON(t,n,{data:v,headers:CN.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})})}catch(t){if(f&&f(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new cb("Network Error",cb.ERR_NETWORK,e,p),{cause:t.cause||t});throw cb.from(t,t&&t.code,e,p)}});const yC={http:null,xhr:GN,fetch:vC};ob.forEach(yC,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const _C=e=>"- ".concat(e),EC=e=>ob.isFunction(e)||null===e||!1===e;var bC={getAdapter:e=>{e=ob.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let t;if(n=e[s],r=n,!EC(n)&&(r=yC[(t=String(n)).toLowerCase()],void 0===r))throw new cb("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+s]=r}if(!r){const e=Object.entries(i).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});throw new cb("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(_C).join("\n"):" "+_C(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:yC};function xC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new IN(null,e)}function wC(e){return xC(e),e.headers=CN.from(e.headers),e.data=AN.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),bC.getAdapter(e.adapter||EN.adapter)(e).then(function(t){return xC(e),t.data=AN.call(e,e.transformResponse,t),t.headers=CN.from(t.headers),t},function(t){return RN(t)||(xC(e),t&&t.response&&(t.response.data=AN.call(e,e.transformResponse,t.response),t.response.headers=CN.from(t.response.headers))),np.reject(t)})}const SC="1.9.0",TC={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{TC[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const NC={};TC.transitional=function(e,t,n){function r(e,t){return"[Axios v"+SC+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,s)=>{if(!1===e)throw new cb(r(i," has been removed"+(t?" in "+t:"")),cb.ERR_DEPRECATED);return t&&!NC[i]&&(NC[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,s)}},TC.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var CC={assertOptions:function(e,t,n){if("object"!=typeof e)throw new cb("options must be an object",cb.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],a=t[s];if(a){const t=e[s],n=void 0===t||a(t,s,e);if(!0!==n)throw new cb("option "+s+" must be "+n,cb.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new cb("Unknown option "+s,cb.ERR_BAD_OPTION)}},validators:TC};const AC=CC.validators;let RC=class{constructor(e){this.defaults=e||{},this.interceptors={request:new bb,response:new bb}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=FN(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&CC.assertOptions(n,{silentJSONParsing:AC.transitional(AC.boolean),forcedJSONParsing:AC.transitional(AC.boolean),clarifyTimeoutError:AC.transitional(AC.boolean)},!1),null!=r&&(ob.isFunction(r)?t.paramsSerializer={serialize:r}:CC.assertOptions(r,{encode:AC.function,serialize:AC.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),CC.assertOptions(t,{baseUrl:AC.spelling("baseURL"),withXsrfToken:AC.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&ob.merge(i.common,i[t.method]);i&&ob.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=CN.concat(s,i);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const c=[];let l;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let d,u=0;if(!o){const e=[wC.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),d=e.length,l=np.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=a.length;let h=t;for(u=0;u<d;){const t=a[u++],n=a[u++];try{h=t(h)}catch(e){n.call(this,e);break}}try{l=wC.call(this,h)}catch(e){return np.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return Eb(MN((e=FN(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ob.forEach(["delete","get","head","options"],function(e){RC.prototype[e]=function(t,n){return this.request(FN(n||{},{method:e,url:t,data:(n||{}).data}))}}),ob.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,i){return this.request(FN(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}RC.prototype[e]=t(),RC.prototype[e+"Form"]=t(!0)});var IC=RC;class OC{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new np(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new np(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,i){n.reason||(n.reason=new IN(e,r,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new OC(function(t){e=t}),cancel:e}}}var PC=OC;const kC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kC).forEach(e=>{let[t,n]=e;kC[n]=t});var DC=kC;const LC=function e(t){const n=new IC(t),r=yE(IC.prototype.request,n);return ob.extend(r,IC.prototype,n,{allOwnKeys:!0}),ob.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(FN(t,n))},r}(EN);LC.Axios=IC,LC.CanceledError=IN,LC.CancelToken=PC,LC.isCancel=RN,LC.VERSION=SC,LC.toFormData=fb,LC.AxiosError=cb,LC.Cancel=LC.CanceledError,LC.all=function(e){return np.all(e)},LC.spread=function(e){return function(t){return e.apply(null,t)}},LC.isAxiosError=function(e){return ob.isObject(e)&&!0===e.isAxiosError},LC.mergeConfig=FN,LC.AxiosHeaders=CN,LC.formToJSON=e=>yN(ob.isHTMLForm(e)?new FormData(e):e),LC.getAdapter=bC.getAdapter,LC.HttpStatusCode=DC,LC.default=LC;var jC=LC;const MC=()=>{};function UC(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:MC};return e.promise=new np((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}}),e}const VC=new Map,FC=new Map,BC=new Map;let GC=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),HC=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const WC=new X_;let zC=WC.getResult(),KC=null;function qC(e){if(!KC){e&&WC.setUA(e),zC=WC.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return HC.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return HC.CHROME;case"Safari":case"Mobile Safari":return HC.SAFARI;case"Edge":return HC.EDGE;case"Firefox":return HC.FIREFOX;case"QQ":case"QQBrowser":return HC.QQ;case"Opera":return HC.OPERA;case"WeChat":return HC.WECHAT;default:return e.browser.name||""}}(zC),n=YC(zC),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(zC),i=zC.os.version,s=YC(zC,!1),a=zC.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:a};KC={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:a}}return KC}function YC(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function XC(){return qC().os}function JC(){const e=qC();return"".concat(e.os," ").concat(e.osVersion)}function QC(){const e=qC();return!!("WebKit"===zC.engine.name&&e.os===GC.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==HC.SAFARI||rA()&&e.name!==HC.SAFARI)}function ZC(){return qC().name===HC.CHROME}function $C(){return qC().name===HC.SAFARI}function eA(){const e=qC();if(e.name!==HC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}function tA(){return qC().name===HC.EDGE}function nA(){return qC().name===HC.FIREFOX}function rA(){return qC().os===GC.IOS}function iA(e){const t=qC();return!(t.name!==HC.CHROME||!t.osVersion)&&Number(t.version)>=e}function sA(e){const t=qC();return!(t.name!==HC.CHROME||!t.osVersion)&&Number(t.version)<e}function aA(e,t,n){const r=qC();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function oA(e){const t=qC();return!(t.name!==HC.EDGE||!t.osVersion)&&Number(t.version)>=e}function cA(e){const t=qC();return!(t.name!==HC.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function lA(e){const t=qC();return!(t.name!==HC.SAFARI||!t.osVersion)&&Number(t.version)>=e}function dA(e,t,n){const r=qC();if(r.os!==GC.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function uA(e,t,n){const r=qC();if(r.os!==GC.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function hA(e,t,n){const r=qC();if(r.name!==HC.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function pA(e){const t=qC();return!(t.name!==HC.OPERA||!t.osVersion)&&Number(t.version)>=e}function mA(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function fA(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function gA(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function vA(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function yA(){return $C()&&navigator.maxTouchPoints>0}function _A(){return qC().name===HC.WECHAT}function EA(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function bA(){const e=XC();return function(){const{deviceType:e}=qC();return"mobile"===e||"tablet"===e}()||e===GC.ANDROID||e===GC.IOS||e===GC.HARMONY_OS}function xA(){const e=qC();return e.name!==HC.EDGE&&e.name!==HC.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function wA(){return XC()===GC.ANDROID}function SA(){const e=qC();return wA()&&(e.name===HC.CHROME||e.name===HC.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function TA(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function CA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NA(Object(n),!0).forEach(function(t){TA(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let AA=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),RA=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),TA(this,"code",void 0),TA(this,"message",void 0),TA(this,"data",void 0),TA(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function IA(e,t){if("boolean"!=typeof e)throw new RA(AA.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function OA(e,t,n){if(!Dr(n).call(n,e))throw new RA(AA.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function PA(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new RA(AA.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function kA(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new RA(AA.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&PA(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&PA(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&PA(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&PA(e.ideal,"".concat(t,".ideal"),1,1/0)}else PA(e,t,1,1/0)}function DA(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new RA(AA.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!MA(e,n,r,i))throw new RA(AA.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function LA(e,t){if(!Array.isArray(e))throw new RA(AA.INVALID_PARAMS,"".concat(t," should be an array"))}function jA(e){return null==e}function MA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var UA=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(UA||{}),VA=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(VA||{});const FA=new class{constructor(){TA(this,"_clientSize",null),TA(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),TA(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),TA(this,"getStyle",e=>window.getComputedStyle(e,null)),TA(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:a,filter:o}=r;return("none"===i||Dr(t=["hidden","collapse"]).call(t,s)||Number(a)<.1)&&(n=!1),!!n&&(o&&o.split(" ").filter(e=>{var t;const n=e.split("(")[0];return Dr(t=["brightness","blur","opacity"]).call(t,n)}).map(e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]}).forEach(e=>{const[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}}),n)}),TA(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=e=>t(e);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),TA(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),TA(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:a}=e.getBoundingClientRect(),o=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:a,clientWidth:o,clientHeight:c,clientMin:Math.min(o,c)}}),TA(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),TA(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),TA(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n}),TA(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,a=[],o=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*o+(0===c?.1:4===c?(i*c*o-1e5)/o:i*c)*o)/o,l=(r*o+(0===e?.1:4===e?(s*e*o-1e5)/o:s*e)*o)/o;a.push({x:t,y:l})}return[...a]}),TA(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(e=>!!e).length>6),TA(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),TA(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:a}=this._clientSize;let o,c,l,d;if(e<0)o=0;else{if(!(e<s))return!1;o=e}if(t<0)return!1;if(c=t<s?t:s,n<0)l=0;else{if(!(n<i))return!1;l=n}if(r<0)return!1;d=r<i?r:i;const u=c-o,h=d-l;return this.checkSizeIsVisible(u,h,a)}),TA(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),TA(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(UA.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(UA.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(UA.SIZE)}}return this.returnHiddenResult(UA.STYLE)}return this.returnHiddenResult(VA.UNMOUNTED)}return this.returnHiddenResult(VA.INVALID_HTML_ELEMENT)}),TA(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))}};function BA(e){return(new TextEncoder).encode(e)}const GA=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},HA=async e=>function(e,t){let n="";return new Uint8Array(e).forEach(e=>{n+=e.toString(t).padStart(2,"0")}),n}(await crypto.subtle.digest("SHA-256",BA(e)),16);class WA{constructor(){TA(this,"_events",{}),TA(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(e=>e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let s=0;s<t.length;s+=1){const n=t[s];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}let zA=null;function KA(){if(zA)return zA;if(window.electron)return zA=window.electron;if(!window.require)return null;try{return zA=window.require("electron"),zA}catch(e){return null}}let qA=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),YA=function(e){return e.TRACER="tracer",e}({});function XA(e){return PA(e.timeout,"config.timeout",0,1e5),PA(e.timeoutFactor,"config.timeoutFactor",0,100,!1),PA(e.maxRetryCount,"config.maxRetryConfig",0,1/0),PA(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let JA=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),QA=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ZA(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(e=>{if(!e.urls)throw Error()})}catch(e){return!1}return!0}function $A(e){return DA(e.turnServerURL,"turnServerURL"),DA(e.username,"username"),DA(e.password,"password"),e.udpport&&PA(e.udpport,"udpport",1,99999,!0),e.forceturn&&IA(e.forceturn,"forceturn"),e.security&&IA(e.security,"security"),e.tcpport&&PA(e.tcpport,"tcpport",1,99999,!0),!0}function eR(e){return void 0!==e.level&&OA(e.level,"level",[1,2,3]),void 0!==e.delay&&PA(e.delay,"delay",0,3e3,!0),!0}let tR=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),nR=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),rR=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),iR=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function sR(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?np.reject(new RA(AA.UNEXPECTED_ERROR,"can not emit promise")):new np((n,i)=>{e.emit(t,...r,n,i)})}function aR(e,t){if(0===e.getListeners(t).length)return np.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return sR(e,t,...r)}function oR(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return cR(e,t,...r)}function cR(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];if(e.emit(t,...s,e=>{n=e},e=>{r=e}),null!==r)throw r;if(null===n)throw new RA(AA.UNEXPECTED_ERROR,"handler is not sync");return n}const lR=new class extends WA{set networkState(e){this.emit(iR.NETWORK_STATE_CHANGE,e,this._networkState),e===rR.ONLINE?this.emit(iR.ONLINE):e===rR.OFFLINE&&(this.onlineWaiter=new np(e=>{this.once(iR.ONLINE,()=>{this.onlineWaiter=void 0,e(rR.ONLINE)})}),this.emit(iR.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===rR.ONLINE}constructor(){super(),TA(this,"_moduleName","network-indicator"),TA(this,"_networkState",rR.ONLINE),TA(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=rR.ONLINE}),window.addEventListener("offline",()=>{this.networkState=rR.OFFLINE})}};function dR(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function uR(e){const t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function hR(e){void 0!==np?np.resolve().then(e):setTimeout(e,0)}function pR(e){return JSON.parse(JSON.stringify(e))}function mR(e){try{return pR(e)}catch(t){return e}}const fR={};function gR(e,t){fR[t]||(fR[t]=!0,e())}function vR(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function yR(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function _R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function ER(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=ii(t).call(t,(e,t)=>e+t.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach(e=>{i.set(e,s),s+=e.length}),i}function bR(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function xR(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(e=>{t+="string"==typeof e?bR(e):e.size}),t+138}function wR(e){const t=new RA(AA.TIMEOUT,"timeout");return new np((n,r)=>{window.setTimeout(()=>r(t),e)})}function SR(e){return new np(t=>{window.setTimeout(t,e)})}function TR(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+TR(e-n.length,"")}function NR(){return TR(32,"").toUpperCase()}const CR=()=>{},AR=new class{constructor(){TA(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),a=4;a<i;a++)s[a-4]=arguments[a];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const a=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:s,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,CA(CA({},i),{},{fn:e,args:s,skipFn:r}))}else{const i=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:s,skipFn:r})}}},RR=AR.throttleByKey.bind(AR);function IR(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function OR(e,t){if(!IR(e)||!IR(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=OR(e[r],t[r]);return n}{const n=CA({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=OR(e[r],t[r]):n[r]=t[r]);return n}}function PR(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function kR(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function DR(e){return ii(e).call(e,(e,t)=>e+t,0)}function LR(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,s,a){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,a)),s),n)}function s(e,t,n,r,s,a,o){return i(t&n|~t&r,e,t,s,a,o)}function a(e,t,n,r,s,a,o){return i(t&r|n&~r,e,t,s,a,o)}function o(e,t,n,r,s,a,o){return i(t^n^r,e,t,s,a,o)}function c(e,t,n,r,s,a,o){return i(n^(t|~r),e,t,s,a,o)}const l=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let d,u,h,p,m,f=1732584193,g=-271733879,v=-1732584194,y=271733878;for(d=0;d<l.length;d+=16)u=f,h=g,p=v,m=y,f=s(f,g,v,y,l[d+0],7,-680876936),y=s(y,f,g,v,l[d+1],12,-389564586),v=s(v,y,f,g,l[d+2],17,606105819),g=s(g,v,y,f,l[d+3],22,-1044525330),f=s(f,g,v,y,l[d+4],7,-176418897),y=s(y,f,g,v,l[d+5],12,1200080426),v=s(v,y,f,g,l[d+6],17,-1473231341),g=s(g,v,y,f,l[d+7],22,-45705983),f=s(f,g,v,y,l[d+8],7,1770035416),y=s(y,f,g,v,l[d+9],12,-1958414417),v=s(v,y,f,g,l[d+10],17,-42063),g=s(g,v,y,f,l[d+11],22,-1990404162),f=s(f,g,v,y,l[d+12],7,1804603682),y=s(y,f,g,v,l[d+13],12,-40341101),v=s(v,y,f,g,l[d+14],17,-1502002290),g=s(g,v,y,f,l[d+15],22,1236535329),f=a(f,g,v,y,l[d+1],5,-165796510),y=a(y,f,g,v,l[d+6],9,-1069501632),v=a(v,y,f,g,l[d+11],14,643717713),g=a(g,v,y,f,l[d+0],20,-373897302),f=a(f,g,v,y,l[d+5],5,-701558691),y=a(y,f,g,v,l[d+10],9,38016083),v=a(v,y,f,g,l[d+15],14,-660478335),g=a(g,v,y,f,l[d+4],20,-405537848),f=a(f,g,v,y,l[d+9],5,568446438),y=a(y,f,g,v,l[d+14],9,-1019803690),v=a(v,y,f,g,l[d+3],14,-187363961),g=a(g,v,y,f,l[d+8],20,1163531501),f=a(f,g,v,y,l[d+13],5,-1444681467),y=a(y,f,g,v,l[d+2],9,-51403784),v=a(v,y,f,g,l[d+7],14,1735328473),g=a(g,v,y,f,l[d+12],20,-1926607734),f=o(f,g,v,y,l[d+5],4,-378558),y=o(y,f,g,v,l[d+8],11,-2022574463),v=o(v,y,f,g,l[d+11],16,1839030562),g=o(g,v,y,f,l[d+14],23,-35309556),f=o(f,g,v,y,l[d+1],4,-1530992060),y=o(y,f,g,v,l[d+4],11,1272893353),v=o(v,y,f,g,l[d+7],16,-155497632),g=o(g,v,y,f,l[d+10],23,-1094730640),f=o(f,g,v,y,l[d+13],4,681279174),y=o(y,f,g,v,l[d+0],11,-358537222),v=o(v,y,f,g,l[d+3],16,-722521979),g=o(g,v,y,f,l[d+6],23,76029189),f=o(f,g,v,y,l[d+9],4,-640364487),y=o(y,f,g,v,l[d+12],11,-421815835),v=o(v,y,f,g,l[d+15],16,530742520),g=o(g,v,y,f,l[d+2],23,-995338651),f=c(f,g,v,y,l[d+0],6,-198630844),y=c(y,f,g,v,l[d+7],10,1126891415),v=c(v,y,f,g,l[d+14],15,-1416354905),g=c(g,v,y,f,l[d+5],21,-57434055),f=c(f,g,v,y,l[d+12],6,1700485571),y=c(y,f,g,v,l[d+3],10,-1894986606),v=c(v,y,f,g,l[d+10],15,-1051523),g=c(g,v,y,f,l[d+1],21,-2054922799),f=c(f,g,v,y,l[d+8],6,1873313359),y=c(y,f,g,v,l[d+15],10,-30611744),v=c(v,y,f,g,l[d+6],15,-1560198380),g=c(g,v,y,f,l[d+13],21,1309151649),f=c(f,g,v,y,l[d+4],6,-145523070),y=c(y,f,g,v,l[d+11],10,-1120210379),v=c(v,y,f,g,l[d+2],15,718787259),g=c(g,v,y,f,l[d+9],21,-343485551),f=r(f,u),g=r(g,h),v=r(v,p),y=r(y,m);return n(f)+n(g)+n(v)+n(y)}let jR=1,MR=console,UR=class{static setLogger(e){MR=e}constructor(e,t){TA(this,"id",void 0),TA(this,"lockingPromise",np.resolve()),TA(this,"locks",0),TA(this,"name",""),TA(this,"lockId",void 0),this.lockId=jR++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");MR.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new np(n=>{t=()=>{this.locks-=1,this.logger("unlocked",e),n()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function VR(e,t){return function(n,r,i){const s=i.value;if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return await s.apply(this,o)}finally{i()}},i}}const FR={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function BR(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function GR(e,t,n,r){const i=Object.assign({},FR,r);let s=i.timeout;const a=async()=>{await function(e){return new np(t=>{window.setTimeout(t,e)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let o=!1;const c=new np(async(r,s)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(o)return s(new RA(AA.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await a()}catch(e){if(!n(e,c))return s(e);if(c+1===i.maxRetryCount)return s(e);await a()}}});return c.cancel=()=>o=!0,c}let HR,WR=class{constructor(e){TA(this,"input",[]),TA(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:ii(e=this.input).call(e,(e,t)=>e+t)/this.input.length}},zR=0,KR=0;function qR(e,t,n,r){return new np((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),zR+=bR(t.data)):n&&(t.data.size?zR+=t.data.size:t.data instanceof FormData?zR+=xR(t.data):zR+=bR(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,jC.request(t).then(e=>{"string"==typeof e.data?KR+=bR(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?KR+=e.data.byteLength:KR+=bR(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)}).catch(e=>{jC.isCancel(e)?s(new RA(AA.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?s(new RA(AA.NETWORK_TIMEOUT,e.message)):e.response?s(new RA(AA.NETWORK_RESPONSE_ERROR,e.response.status)):s(new RA(AA.NETWORK_ERROR,e.message))})})}async function YR(e,t){const n=new Blob([t.data],{type:"buffer"});return await qR(e,CA(CA({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XR=()=>void 0!==window.isSecureContext;function JR(e){if(Array.isArray(e))return e.map(e=>e);if(!QR(e))return e;const t={};for(const n in e){const r=e[n];QR(r)||Array.isArray(r)?t[n]=JR(r):t[n]=r}return t}function QR(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let ZR=class{constructor(e){TA(this,"input",[]),TA(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const $R={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},eI={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:$R,remoteCandidate:$R},updateInterval:0},tI={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},nI={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},rI={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},iI={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let sI=class{constructor(e,t){TA(this,"onFirstVideoReceived",void 0),TA(this,"onFirstVideoDecoded",void 0),TA(this,"onFirstAudioReceived",void 0),TA(this,"onFirstVideoDecodedTimeout",void 0),TA(this,"onFirstAudioDecoded",void 0),TA(this,"onSelectedLocalCandidateChanged",void 0),TA(this,"onSelectedRemoteCandidateChanged",void 0),TA(this,"videoIsReady",!1),TA(this,"videoIsReady2",{}),TA(this,"pc",void 0),TA(this,"options",void 0),TA(this,"intervalTimer",void 0),TA(this,"stats",JR(eI)),TA(this,"isFirstVideoReceived",{}),TA(this,"isFirstVideoDecoded",{}),TA(this,"isFirstAudioReceived",{}),TA(this,"isFirstAudioDecoded",{}),TA(this,"isFirstVideoDecodedTimeout",{}),TA(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new np(e=>{e({local:CA({},$R),remote:CA({},$R)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,a=0;for(const o of n)e[o].forEach((e,n)=>{if(!this.lossRateWindowStats[t-1][o][n]||!this.lossRateWindowStats[0][o][n])return;const c=this.lossRateWindowStats[t-1][o][n].packets-this.lossRateWindowStats[0][o][n].packets,l=this.lossRateWindowStats[t-1][o][n].packetsLost-this.lossRateWindowStats[0][o][n].packetsLost;"videoSend"===o||"audioSend"===o?(r+=c,s+=l):(i+=c,a+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}},aI=class extends sI{constructor(){super(...arguments),TA(this,"_stats",eI),TA(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=JR(eI);const n=t.filter(e=>"ssrc"===e.type);this.processSSRCStats(n);const r=t.find(e=>"VideoBwe"===e.type);r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(e=>{var t;const n=Dr(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=JR(nI);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=JR(tI),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CA({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=JR(iI);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=JR(rI);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}})}_getStats(){return new np((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t.push(n)}),t}},oI=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),cI=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),lI=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),dI=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var uI=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(uI||{});function hI(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:uI.kNone;if(!t)return;const s=Number(t[n]);if("number"!=typeof s)return;const a=Number(t[r]);if("number"!=typeof a)return;if(!e)return a?s/a*i:void 0;const o=Number(e[n]);if("number"!=typeof o)return;const c=Number(e[r]);if("number"!=typeof c)return;const l=a-c;return l?(s-o)/l*i:void 0}let pI=class extends sI{constructor(){super(...arguments),TA(this,"_stats",eI),TA(this,"report",void 0),TA(this,"lastDecodeVideoReceiverStats",new Map),TA(this,"lastVideoFramesRecv",new Map),TA(this,"lastVideoFramesSent",new Map),TA(this,"lastVideoFramesDecode",new Map),TA(this,"lastVideoFramesOutput",new Map),TA(this,"lastVideoJBDelay",new Map),TA(this,"lastAudioJBDelay",new Map),TA(this,"mediaBytesSent",new Map),TA(this,"mediaBytesRetransmit",new Map),TA(this,"mediaBytesTargetEncode",new Map),TA(this,"lastDecodeAudioReceiverStats",new Map),TA(this,"lastAudioConcealment",new Map),TA(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=JR(eI),this.report.forEach(e=>{switch(e.type){case dI.OUTBOUND:case dI.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===dI.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===dI.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case dI.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case dI.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:CA({},$R),remote:CA({},$R)};return e.forEach(n=>{let r;if(n.type===dI.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===dI.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===dI.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===dI.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===dI.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(CA({},t),CA({},this.stats.selectedCandidatePair.localCandidate)),e.type===dI.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(CA({},t),CA({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(t=>t.ssrc===e.ssrc);t||(t=JR(iI),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=hI(n,t,"totalProcessingDelay","jitterBufferEmittedCount",uI.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,CA({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(null!=t&&null!=r){const i=r.lts,s=n.timestamp,a=s-i;if(a<=0)return;const o=e.concealedSamples-t.concealedSamples-0,c=r.nonSilent+o,l=e.totalSamplesReceived-t.totalSamplesReceived;if(l<=0)return;const d=80*l/a,u=200*l/a,h=a/l;let p=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,c>d&&(r.plc80>0?(e.freezeSamples80+=o,e.freezeMs80+=Math.round(o*h)):(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*h)),p=r.plc80+1);let m=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,c>u&&(r.plc200>0?(e.freezeSamples200+=o,e.freezeMs200+=Math.round(o*h)):(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*h)),m=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:o,lts:s,plc80:p,plc200:m})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(t=>t.ssrc===e.ssrc);t||(t=JR(tI),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,i=s-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=hI(null==n?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=hI(null==n?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",uI.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=hI(null==n?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",uI.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=hI(null==n?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",uI.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CA({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(t=>t.ssrc===e.ssrc);t||(t=JR(nI),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new ZR(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new ZR(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new ZR(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dI.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(t=>t.ssrc===e.ssrc);if(t||(t=JR(rI),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dI.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(up(n=this.report).call(n)).find(n=>n.type===t&&n.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,a;const o=t?this.report.get(t):void 0,c=null!==(r=null==o?void 0:o.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let l=null!==(i=null==o?void 0:o.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(s=null==o?void 0:o.frameHeight)&&void 0!==s?s:e.frameHeight,u=null!==(a=null==o?void 0:o.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof l&&"number"==typeof d||(l=0,d=0),null==u){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(u=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:u})):t?u=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:l,height:d,frameRate:Math.max(0,u)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,a,o;const c=t?this.report.get(t):void 0,l=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,d=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(s=null==c?void 0:c.frameHeight)&&void 0!==s?s:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(o=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let r=0;e&&t-e.lts>=800?(r=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:d||0,height:u||0,frameRate:r||0},n.decodedFrame={width:d||0,height:u||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:d||0,height:u||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,a;const o=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==o?void 0:o.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,l=null!==(s=null!==(a=null==o?void 0:o.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==s?s:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var r,i,s,a,o,c,l,d,u;const h=t?this.report.get(t):void 0,p=null!==(r=null==h?void 0:h.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,m=null!==(i=null==h?void 0:h.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,f=null!==(s=null==h?void 0:h.jitterBufferDelay)&&void 0!==s?s:e.jitterBufferDelay,g=null!==(a=null==h?void 0:h.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,v=null!==(o=null==h?void 0:h.audioLevel)&&void 0!==o?o:null==e?void 0:e.audioLevel,y=null!==(c=null==h?void 0:h.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,_=null!==(l=null==h?void 0:h.concealedSamples)&&void 0!==l?l:e.concealedSamples,E=null!==(d=null==h?void 0:h.silentConcealedSamples)&&void 0!==d?d:e.silentConcealedSamples,b=null!==(u=null==h?void 0:h.concealmentEvents)&&void 0!==u?u:e.concealmentEvents;if("number"==typeof m&&(n.totalSamplesReceived=m),"number"==typeof E&&(n.silentConcealedSamples=E),"number"==typeof b&&(n.concealmentEvents=b),"number"==typeof _&&(n.concealedSamples=_),p&&m&&(n.accelerateRate=p/m),f&&g){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=g-e.jitterBufferEmittedCount;r>0&&(t=1e3*(f-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:f,jitterBufferEmittedCount:g,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=v;let x=1920;y&&m&&(x=m/y/50,n.receivedFrames=Math.round(m/x)),_&&(n.droppedFrames=Math.round(_/x))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(t=>{e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(e=>{t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(e=>{n=null===n?e.diffMean():n+e.diffMean()});const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},mI=class extends sI{updateStats(){return np.resolve()}};function fI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const s=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return s?s<76?new aI(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new pI(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof np||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new pI(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new mI(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const gI="websdk_ng_install_id";function vI(){try{if(AI("INSTALL_ID"))return AI("INSTALL_ID");let e=window.localStorage.getItem(gI);return e||(e=NR(),window.localStorage.setItem(gI,e)),CI("INSTALL_ID",e),e}catch(e){return}}const yI=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}return"4.0.0.999"}("4.24.0"),_I=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let EI=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const bI=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let o=0;o<6;o++)i.push("1");const s=i.join(""),a={};return a[e]=r,a[t]=s,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=bI;const xI={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},wI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},SI="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",TI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},NI=CA(CA(CA(CA({},TI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:wI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},xI),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function CI(e,t,n){var r,i,s;Dr(r=Object.keys(NI)).call(r,e)&&(!n&&Dr(i=Object.keys(II)).call(i,e)||(NI[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS"!==e||!0!==t||(NI.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(s=!!t,NI.USE_NEW_NETWORK_CONFIG=s,s&&(NI.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],NI.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],NI.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],NI.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],NI.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",NI.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",NI.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(NI.ENABLE_INSTANT_VIDEO=!0,NI.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(NI.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(NI.NEW_TURN_MODE||(NI.NEW_TURN_MODE=4))))}function AI(e){return NI[e]}_I||(NI.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],NI.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],NI.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],NI.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],NI.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],NI.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],NI.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",NI.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",NI.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",NI.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",NI.AREAS=["NORTH_AMERICA","OVERSEA"]);let RI=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const II={};var OI=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(OI||{});let PI=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const kI=128,DI=96,LI=1e3,jI=10;let MI=0;var UI=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>x,Printer:()=>C,parse:()=>O,print:()=>P});const r="\n",i="".concat("\r").concat(r),s=" ";let a;function o(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function m(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function f(e){return h(e)||o(e)||"+"===e||"/"===e}function g(e){return o(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function v(e){return h(e)||o(e)||"+"===e||"/"===e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){E(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));class b{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,s)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===s)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&o(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;o(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let s=0;s<3;s++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!u(e[t]))throw new Error("Invalid integer.");for(t+=1;o(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&o(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(u(e[n])&&(n+=1);o(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,s)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,o),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!u(e[t]))throw new Error("Invalid repeat interval");for(t+=1;o(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,o)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class x extends b{constructor(){super(),E(this,"records",[]),E(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter(e=>!!P_(e).call(e)).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),s=this.parseInformation(),a=this.parseUri(),o=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),d=this.parseBandWidth(),u=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),m=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:s,uri:a,emails:o,phones:c,connection:l,bandwidths:d,timeFields:u,key:h,attributes:p,mediaDescriptions:m}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new S;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,e=>d(e)&&":"!==e),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,m)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new T(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,e=>d(e)&&":"!==e),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,m)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;{const n=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,o);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,o));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const s=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:s,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==a.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===a.CONNECTION){const t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===a.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),s=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:s,attributes:a})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const s=t.call(this,e.value,e.cur,...r),a=e.value.slice(e.cur,s);return e.cur=s,a}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==s)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class w extends b{constructor(){super(...arguments),E(this,"attributes",void 0),E(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[s,a]=n||[];if("number"==typeof s&&i.length<s)throw new Error("error in length, should be more or equal than ".concat(s," characters."));if("number"==typeof a&&i.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==s)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const s=t.call(this,e.attValue,e._cur,...r),a=e.attValue.slice(e._cur,s);return e._cur=s,a}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,o);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,s),i=_(_({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===s&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class S extends w{constructor(){super(...arguments),E(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===s;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,v),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===s;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,e=>e!==s&&m(e));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===s&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,s);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class T extends w{constructor(e){super(),E(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,o,[1,10]);this.consumeAttributeSpace(e);const a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const d={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:a,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));this.peekChar(e)===s;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,o)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find(e=>e.ssrcId===parseInt(t,10));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,s);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach(e=>{let[t,n]=e.split("=");t=P_(t).call(t);const i="string"==typeof n?P_(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)});const i=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,s),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,s);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===s&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===s&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===s&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,d,[1,64])};this.peekChar(e)===s&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,e=>h(e)||o(e)||"_"===e||"-"===e);this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===s){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===s&&this.extract(e,this.consume,s)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,o,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,o,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C{constructor(){N(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map(e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new R(this.eol).print(e)}printMediaAttributes(e){return new I(this.eol).print(e)}}class A{constructor(e){N(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(s)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(e=>"a=fingerprint:".concat(e.hashFunction).concat(s).concat(e.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(s).concat(e.extensionName).concat(e.extensionAttributes?"".concat(s).concat(e.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol)).join("")}}class R extends A{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map(e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map(e=>"".concat(s).concat(e)).join("")).concat(this.eol)).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map(e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map(e=>"".concat(s).concat(e.name).concat(e.value?"=".concat(e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(s,"*"):e.identifierList.length>0&&(t+=e.identifierList.map(e=>"".concat(s).concat(e))),t+this.eol}}class I extends A{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map(e=>"a=candidate:".concat(e.foundation).concat(s).concat(e.componentId).concat(s).concat(e.transport).concat(s).concat(e.priority).concat(s).concat(e.connectionAddress).concat(s).concat(e.port).concat(s,"typ").concat(s).concat(e.type).concat(e.relAddr?"".concat(s,"raddr").concat(s).concat(e.relAddr):"").concat(e.relPort?"".concat(s,"rport").concat(s).concat(e.relPort):"").concat(Object.keys(e.extension).map(t=>"".concat(s).concat(t).concat(s).concat(e.extension[t])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(e=>"a=remote-candidates:".concat(e.join(s)).concat(this.eol)).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map(e=>this.printRTCPFeedback("*",e)).join("");for(const r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map(e=>this.printRTCPFeedback(r.payloadType,e)).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(s).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(s).concat(Object.keys(t.parameters).map(e=>"".concat(e,"=").concat(t.parameters[e])).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(s).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(s),r=t;return"trr-int"===r.type?n+="ttr-int".concat(s).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(s).concat(r.parameter),r.additional&&(n+="".concat(s).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(e=>Object.keys(e.attributes).map(t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(s).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(s).concat(e.netType)),e.addressType&&(t+="".concat(s).concat(e.addressType)),e.address&&(t+="".concat(s).concat(e.address)),t+this.eol}printMSId(e){return e.map(e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(s).concat(e.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(e=>"a=imageattr:".concat(e).concat(this.eol)).join("")}printRid(e){return e.map(e=>{let t="a=rid:".concat(e.id).concat(s).concat(e.direction);return e.payloads&&(t+="".concat(s,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(s).concat(e.params.map(e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)).join(";"))),t+this.eol}).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map(e=>"".concat(s).concat(e.toString(10))).join("")).concat(this.eol)).join("")}}function O(e){return(new x).parse(e)}function P(e,t){return(new C).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();function VI(e){return UI.parse(e)}function FI(e,t){return UI.print(e,t)}var BI=er("Array","keys"),GI=gr,HI=et,WI=u,zI=BI,KI=Array.prototype,qI={DOMTokenList:!0,NodeList:!0},YI=function(e){var t=e.keys;return e===KI||WI(KI,e)&&t===KI.keys||HI(qI,GI(e))?zI:t},XI=r(YI);function JI(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ZI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QI(Object(n),!0).forEach(function(t){JI(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QI(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const $I=new class extends WA{constructor(){super(...arguments),JI(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class eO{constructor(e){JI(this,"logger",void 0),JI(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function nO(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const rO={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},iO=Date.now(),sO=e=>{for(const t in rO)if(Object.prototype.hasOwnProperty.call(rO,t)&&rO[t]===e)return t;return"DEFAULT"},aO=new class{constructor(){JI(this,"proxyServerURL",void 0),JI(this,"logLevel",rO.DEBUG),JI(this,"uploadState","collecting"),JI(this,"uploadLogWaitingList",[]),JI(this,"uploadLogUploadingList",[]),JI(this,"uploadErrorCount",0),JI(this,"currentLogID",0),JI(this,"url",void 0),JI(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rO.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rO.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rO.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rO.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rO.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){CI("UPLOAD_LOG",!0)}disableLogUpload(){CI("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new eO(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-iO<100)return void setTimeout(()=>{this.log(...t)},Date.now()-iO);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=tO()+" Agora-SDK [".concat(sO(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=tO()+" %cAgora-SDK [".concat(sO(r),"]:");let s=[];if(!AI("USE_NEW_LOG"))switch(r){case rO.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case rO.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case rO.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case rO.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-iO<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-iO);const r=Math.max(0,Math.min(4,t[0]));t[0]=tO()+" Agora-SDK [".concat(sO(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!AI("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=nO()+" Agora-SDK [".concat(sO(e),"]:"):n[0]=nO()+" Agora-SDK [".concat(sO(e),"]:");let i="";n.forEach(e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:yI,process_id:AI("PROCESS_ID"),payload:JSON.stringify(e)};return GR(async()=>{const e=await jC.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(AI("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(AI("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}},()=>(this.uploadLogUploadingList=[],!1),t=>{const n={status:-1,message:t.message,errorRange:e.map(e=>e.log_item_id)};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),$I.reportLogUploadError(n),!0},{timeout:AI("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:AI("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,AI("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),AI("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),AI("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),AI("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var oO;function cO(e){return DA(e.reportId,"params.reportId",0,100,!1),DA(e.category,"params.category",0,100,!1),DA(e.event,"params.event",0,100,!1),DA(e.label,"params.label",0,100,!1),PA(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(oO={}).FREE="free",oO.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const lO={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let dO=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),uO=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let hO=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function pO(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const s=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];let c=a;if(e.argsMap)try{c=e.argsMap(this,...a)}catch(e){aO.warning(e),c=[]}try{JSON.stringify(c)}catch(e){aO.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),c=[]}const l=(e.report||mO).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:c,tag:YA.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,a);return t instanceof np?t.then(t=>(l.onSuccess(e.reportResult&&t),t)).catch(e=>{throw l.onError(e),e}):(l.onSuccess(e.reportResult&&t),t)}catch(e){throw l.onError(e),e}}}return r}}const mO=new class{constructor(){JI(this,"baseInfoMap",new Map),JI(this,"proxyServer",void 0),JI(this,"eventUploadTimer",void 0),JI(this,"setSessionIdTimer",void 0),JI(this,"url",void 0),JI(this,"sids",new Set),JI(this,"backupUrl",void 0),JI(this,"_appId",void 0),JI(this,"_aid",0),JI(this,"keyEventUploadPendingItems",[]),JI(this,"normalEventUploadPendingItems",[]),JI(this,"apiInvokeUploadPendingItems",[]),JI(this,"apiInvokeCount",0),JI(this,"apiInvokeLoggedCount",0),JI(this,"ltsList",[]),JI(this,"lastSendNormalEventTime",Date.now()),JI(this,"customReportCounterTimer",void 0),JI(this,"customReportCount",0),JI(this,"extApiInvoke",async e=>{for(const t of e){const e=ZI(ZI({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:YA.TRACER});this.sendApiInvoke(e)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),AI("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),AI("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,n]=e;return t+n}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!AI("SHOW_REPORT_INVOKER_LOG"),a=!!AI("SHOW_REPORT_USER_INVOKER_LOG"),o=s||a&&t.id;o&&(this.apiInvokeLoggedCount+=1);const c=this.apiInvokeLoggedCount;function l(e,n){if(o){let r="[apiInvoke-".concat(c,"]");if(t.id&&(r+="[".concat(t.id,"]")),t.name&&(r+="[".concat(t.name,"]"),t.name===qA.JOIN))return aO.info("".concat(r," ").concat(e));aO.info("".concat(r," ").concat(e),"start"===e?t.options:n||"")}}const d=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});l("start");let u=!1;SR(t.timeout).then(()=>{u||(this.sendApiInvoke(ZI(ZI({},d()),{},{error:AA.API_INVOKE_TIMEOUT,success:!1})),l("timeout"))});const h=new RA(AA.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(u)throw h;return u=!0,this.sendApiInvoke(ZI(ZI({},d()),{},{success:!0},t.reportResult&&{result:e})),l("onSuccess"),e};return n?RR(r,t.name+"Success",n,()=>u=!0):r()},onError:e=>{const r=()=>{if(u)throw e;u=!0,this.sendApiInvoke(ZI(ZI({},d()),{},{success:!1,error:e})),l("onFailure",e.toString())};return n?RR(r,t.name+"Error",n,()=>u=!0):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:AI("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:_I?"global":"oversea",areas:AI("AREAS")&&AI("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientRole:d}=t,u=Date.now(),h=ZI(ZI({},r),{},{eventType:dO.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:SI,lts:u,elapse:u-n,extend:JSON.stringify(i),mode:t.mode,process:AI("PROCESS_ID"),appType:AI("APP_TYPE"),success:!0,version:yI,stringUid:s,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientType:Dr(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:d,serviceId:AI("PROCESS_ID"),extensionID:AI("PLUGIN_INFO").join(",")||""});var p;this.send({type:uO.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI({},r),{},{role:t.role,eventType:dO.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:uO.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI({},r),{},{eventType:dO.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:uO.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:a,isProxy:o}=t,c=i-n.startTime,l=ZI(ZI({},r),{},{eventType:dO.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:vI(),isABTestSuccess:t.isABTestSuccess?1:0}),d=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),s)this.send({type:uO.JOIN_GATEWAY,data:l},!0);else{let e;if(a)if(o){const t=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=a.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:o?1:0}}else{const t=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=a.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:o?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:o?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const t=Object.assign({},l,e,{eventType:dO.REJOIN_GATEWAY});this.send({type:uO.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=ZI(ZI({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:uO.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI({},r),{},{eventType:dO.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:uO.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),a=ZI(ZI({},i),{},{eventType:dO.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:uO.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...XI(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,a=Date.now(),o=ZI(ZI({},s),{},{eventType:dO.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:uO.WS_COMPRESSOR_INIT,data:o},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),a=ZI(ZI({},r),{},{elapse:i-n.startTime,eventType:dO.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:uO.XLA_PEER_FIRST_VIDEO_FRAME,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),o=ZI(ZI(ZI({},s),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((r.firstFrame||a)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:o},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),o=ZI(ZI(ZI({},s),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:o},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI(ZI({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:dO.AB_TEST,lts:i});this.send({type:uO.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI(ZI({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:dO.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:uO.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI(ZI({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:dO.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:uO.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),o=ZI(ZI(ZI({},s),r),{},{eventType:t,lts:a});this.send({type:n,data:o},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI({},r),{},{eventType:dO.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:uO.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI({},r),{},{eventType:dO.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI({},r),{},{eventType:dO.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?aO.debug("reportProxyServerurl: ".concat(e)):aO.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:uO.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=bR(JSON.stringify(e));let s=0;const a=[];let o=0;for(let c=0;c<r.length;c++)o+=r.charCodeAt(c)<=127?1:3,o<=n-i||(a[a.length]=CA(CA({},e),{},{[t]:r.substring(s,c)}),s=c,o=r.charCodeAt(c)<=127?1:3);return s!==r.length-1&&(a[a.length]=CA(CA({},e),{},{[t]:r.substring(s)})),a})(ZI(ZI(ZI({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(e=>this.send({type:uO.WORKER_EVENT,data:e},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI(ZI({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:uO.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI(ZI({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:uO.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=ZI(ZI(ZI({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:uO.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>AI("CUSTOM_REPORT_LIMIT"))throw new RA(AA.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(t=>({type:uO.USER_ANALYTICS,data:ZI(ZI({sid:e},t),{},{lts:n})}));try{AI("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw aO.error("send custom report message failed",e.toString()),new RA(AA.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=AI("NOT_REPORT_EVENT");if(e.tag&&Dr(t)&&Dr(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof RA){const{code:t,message:n}=e.error;a=t||n||e.error.toString()}else a=e.error.toString();const o={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:uO.API_INVOKE,data:o},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find(e=>null!==e);t&&e.forEach(e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>AI("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const s of[...n]){var i;-1!==this.ltsList.indexOf(s.data.lts)?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Xp(i=this.ltsList).call(i,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=Date.now()),AI("ENABLE_EVENT_REPORT")?(n.length&&(AI("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{AI("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>AI("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-AI("NORMAL_EVENT_QUEUE_CAPACITY")),aO.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){lR.networkState===rR.OFFLINE&&await np.race([lR.onlineWaiter,SR(2*FR.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach(e=>{const n=BA(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(uO).forEach(n=>{let[r,i]=n;i===e.type&&(t=hO[r])}),t})(e),s=new DataView(r);s.setUint16(0,n.byteLength,!0),s.setUint8(2,255&i),s.setUint8(3,i>>>8&255),s.setUint8(4,i>>>16&255),t=GA(t,new Uint8Array(r)),t=GA(t,n)}),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(AI("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(AI("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(AI("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(AI("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await qR(r,{timeout:1e4,data:t(e),headers:ZI(ZI({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(e=>JSON.stringify(e)),vid:n,aid:r};lR.networkState===rR.OFFLINE&&await np.race([lR.onlineWaiter,SR(2*FR.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(AI("EVENT_REPORT_DOMAIN"),"&p=").concat(AI("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(AI("EVENT_REPORT_DOMAIN"),":").concat(AI("STATS_COLLECTOR_PORT")).concat(s));for(let o=0;o<2;o+=1){1===o&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(AI("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(AI("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(AI("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(AI("STATS_COLLECTOR_PORT")).concat(s)));try{t?await YR(a,{timeout:1e4,data:i}):await qR(a,{timeout:1e4,data:i})}catch(t){if(1===o)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},lO);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:YA.TRACER}).onSuccess()}};$I.on("REPORT_LOG_UPLOAD",e=>{e.networkState=lR.networkState,mO.reportApiInvoke(null,{name:"logUploadError",options:e,tag:YA.TRACER}).onSuccess("logUploadError")});class fO extends RA{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),JI(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,aO)}throw(){super.throw(aO)}}const gO={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function vO(){return gO}function yO(){return"setSinkId"in HTMLAudioElement.prototype&&(!AI("RESTRICTION_SET_PLAYBACK_DEVICE")||(ZC()||tA())&&!bA())}function _O(){return!gO.supportUnifiedPlan||AI("CHROME_FORCE_PLAN_B")&&xA()}function EO(e){return!(nA()||sA(87)||_O()||!AI("ENABLE_PRE_SUB")&&(null==e||!e.autoSubscribe||AI("FORCE_DISABLE_AUTO_SUB")))}function bO(e){return!!AI("ENABLE_INSTANT_VIDEO")||!(null==e||!e.autoSubscribe||AI("FORCE_DISABLE_AUTO_SUB"))}let xO=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function wO(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function SO(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function TO(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function NO(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const CO={"90p":SO(160,90),"90p_1":SO(160,90),"120p":SO(160,120,15,30,65),"120p_1":SO(160,120,15,30,65),"120p_3":SO(120,120,15,30,50),"120p_4":SO(212,120),"180p":SO(320,180,15,30,140),"180p_1":SO(320,180,15,30,140),"180p_3":SO(180,180,15,30,100),"180p_4":SO(240,180,15,30,120),"240p":SO(320,240,15,40,200),"240p_1":SO(320,240,15,40,200),"240p_3":SO(240,240,15,40,140),"240p_4":SO(424,240,15,40,220),"360p":SO(640,360,15,80,400),"360p_1":SO(640,360,15,80,400),"360p_3":SO(360,360,15,80,260),"360p_4":SO(640,360,30,80,600),"360p_6":SO(360,360,30,80,400),"360p_7":SO(480,360,15,80,320),"360p_8":SO(480,360,30,80,490),"360p_9":SO(640,360,15,80,800),"360p_10":SO(640,360,24,80,800),"360p_11":SO(640,360,24,80,1e3),"480p":SO(640,480,15,100,500),"480p_1":SO(640,480,15,100,500),"480p_2":SO(640,480,30,100,1e3),"480p_3":SO(480,480,15,100,400),"480p_4":SO(640,480,30,100,750),"480p_6":SO(480,480,30,100,600),"480p_8":SO(848,480,15,100,610),"480p_9":SO(848,480,30,100,930),"480p_10":SO(640,480,10,100,400),"720p":SO(1280,720,15,120,1130),"720p_auto":SO(1280,720,30,900,3e3),"720p_1":SO(1280,720,15,120,1130),"720p_2":SO(1280,720,30,120,2e3),"720p_3":SO(1280,720,30,120,1710),"720p_5":SO(960,720,15,120,910),"720p_6":SO(960,720,30,120,1380),"1080p":SO(1920,1080,15,120,2080),"1080p_1":SO(1920,1080,15,120,2080),"1080p_2":SO(1920,1080,30,120,3e3),"1080p_3":SO(1920,1080,30,120,3150),"1080p_5":SO(1920,1080,60,120,4780),"1440p":SO(2560,1440,30,120,4850),"1440p_1":SO(2560,1440,30,120,4850),"1440p_2":SO(2560,1440,60,120,7350),"4k":SO(3840,2160,30,120,8910),"4k_1":SO(3840,2160,30,120,8910),"4k_3":SO(3840,2160,60,120,13500)},AO={"480p":TO(640,480,5),"480p_1":TO(640,480,5),"480p_2":TO(640,480,30),"480p_3":TO(640,480,15),"720p":TO(1280,720,5),"720p_auto":SO(1280,720,30,900,3e3),"720p_1":TO(1280,720,5),"720p_2":TO(1280,720,30),"720p_3":TO(1280,720,15),"1080p":TO(1920,1080,5),"1080p_1":TO(1920,1080,5),"1080p_2":TO(1920,1080,30),"1080p_3":TO(1920,1080,15)},RO={"1SL1TL":NO(1,1),"3SL3TL":NO(3,3),"2SL3TL":NO(2,3)};function IO(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},CO[e]):e}function OO(e){return"string"==typeof e?Object.assign({},AO[e]):e}function PO(e){return"string"==typeof e?Object.assign({},RO[e]):e}const kO={speech_low_quality:wO(16e3,!1),speech_standard:wO(32e3,!1,18),music_standard:wO(48e3,!1),standard_stereo:wO(48e3,!0,56),high_quality:wO(48e3,!1,128),high_quality_stereo:wO(48e3,!0,192)};function DO(e){return"string"==typeof e?Object.assign({},kO[e]):e}const LO=[];function jO(e){return OA(e,"mediaSource",["screen","window","application"]),!0}let MO=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),UO=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),VO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),FO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),BO=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),GO=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),HO=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),WO=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),zO=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),KO=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const qO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},XO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},JO={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ZO=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),$O=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),eP=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),tP=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),nP=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),rP=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const iP={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let sP=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function aP(e,t,n,r,i){var s,a,o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=ii(s=vi(a=n.slice()).call(a)).call(s,function(n,r){return r(e,t,n)||n},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function oP(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function lP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cP(Object(n),!0).forEach(function(t){oP(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cP(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class dP extends WA{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(GO.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),oP(this,"trackMediaType",void 0),oP(this,"_ID",void 0),oP(this,"_rtpTransceiver",void 0),oP(this,"_lowRtpTransceiver",void 0),oP(this,"_hints",[]),oP(this,"_isClosed",!1),oP(this,"_originMediaStreamTrack",void 0),oP(this,"mediaStreamTrack",void 0),oP(this,"_external",{}),this._ID=t||TR(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Dr(LO).call(LO,e)||LO.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||gR(()=>{var e;mO.reportApiInvoke(null,{name:qA.GET_MEDIA_STREAM_TRACK,options:[],tag:YA.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===VO.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=LO.indexOf(e);-1!==t&&LO.splice(t,1)}(this),this.emit(HO.CLOSED),this.removeAllListeners(GO.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===VO.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(GO.TRANSCEIVER_UPDATED,e,t)}}class uP extends dP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),oP(this,"_enabled",!0),oP(this,"_muted",!1),oP(this,"_isExternalTrack",!1),oP(this,"_isClosed",!1),oP(this,"_enabledMutex",void 0),oP(this,"processor",void 0),oP(this,"_processorContext",void 0),oP(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new UR("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,aO.debug("[".concat(this.getTrackId(),"] close")),this.emit(MO.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aR(this,MO.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(HO.TRACK_ENDED)}stateCheck(e,t){if(aO.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),IA(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new RA(AA.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",aO);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new RA(AA.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",aO)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():np.resolve([])}}const hP=window.AudioContext||window.webkitAudioContext;let pP=null;const mP=new class extends WA{constructor(){super(...arguments),oP(this,"prevState",void 0),oP(this,"curState",void 0),oP(this,"currentTime",void 0),oP(this,"currentTimeStuckAt",void 0),oP(this,"interruptDetectorTrack",void 0),oP(this,"onLocalAudioTrackMute",()=>{aO.info("ios15-interruption-start"),this.emit(xO.IOS_15_16_INTERRUPTION_START)}),oP(this,"onLocalAudioTrackUnmute",async()=>{aO.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?aO.info("ios15-interruption-end-canceled"):(pP&&await pP.suspend(),this.emit(xO.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){aO.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){aO.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function fP(){if(!pP){if(function(){if(!hP)return void aO.error("your browser is not support web audio");aO.info("create audio context");const e=lP({},AI("WEBAUDIO_INIT_OPTIONS"));aO.debug("audio context init option:",JSON.stringify(e)),pP=new hP(e),mP.curState=pP.state,pP.onstatechange=()=>{mP.prevState=mP.curState,mP.curState=pP?pP.state:void 0;const{prevState:e,curState:t}=mP,n="running"===t,r="interrupted"===t,i="running"===e,s="suspended"===e,a="interrupted"===e,o=qC().osVersion;(rA()||yA())&&i&&r&&(aO.info("ios".concat(o,"-interruption-start")),mP.emit(xO.IOS_INTERRUPTION_START)),(rA()||yA())&&(s||a)&&n&&(aO.info("ios".concat(o,"-interruption-end")),mP.emit(xO.IOS_INTERRUPTION_END)),e!==t&&mP.emit(xO.STATE_CHANGE,t,e)},setInterval(()=>{var e;const t=null===(e=pP)||void 0===e?void 0:e.currentTime;mP.currentTime!==t?(mP.currentTimeStuckAt&&(aO.debug("AudioContext current time resume at ".concat(t)),mP.currentTimeStuckAt=void 0),mP.currentTime=t):(t!==mP.currentTimeStuckAt&&(mO.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:YA.TRACER}).onSuccess(),aO.warning("AudioContext current time stuck at ".concat(t))),mP.currentTimeStuckAt=t)},5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,s=!1;function a(t){"running"===e.state?o(!1):rA()||yA()?"suspended"===e.state&&(o(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(o(!0),t&&e.resume().then(c,c))}function o(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,l,{capture:!0,passive:!0}):window.removeEventListener(t,l,{capture:!0,passive:!0})}}}function c(){a(!1)}function l(){a(!0)}function d(e){if(!s)if(n.paused)if(e){let t;u(!1),s=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else u(!0);else u(!1)}function u(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),s=!1,d(!1)}function p(){d(!0)}if(rA()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,d(!0)}mP.on(xO.STATE_CHANGE,function(){a(!0)}),a(!1)}(pP)}(),!pP)throw new RA(AA.NOT_SUPPORTED,"can not create audio context");return pP}return pP}function gP(e){if(function(){if(null!==vP)return vP;const e=fP(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),vP=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var s;return e._inputNodes||(e._inputNodes=[]),Dr(s=e._inputNodes).call(s,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,s)=>{n.call(e),r?dR(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let vP=null;function yP(e,t){let n=!1;const r=1/t;if(AI("DISABLE_WEBAUDIO")){const t=window.setInterval(()=>{n?window.clearInterval(t):e(performance.now()/1e3)},1e3*r)}else{const t=fP();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const s=()=>{if(n)return void(i=null);const a=t.createOscillator();a.onended=s,a.connect(i),a.start(0),a.stop(t.currentTime+r),e(t.currentTime)};s()}return()=>{n=!0}}class _P{constructor(){oP(this,"context",void 0),oP(this,"analyserNode",void 0),oP(this,"sourceNode",void 0),this.context=fP(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||rA()||yA()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=ii(e).call(e,(e,t)=>e+t*t,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){aO.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class EP extends WA{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),oP(this,"outputNode",void 0),oP(this,"outputTrack",void 0),oP(this,"isPlayed",!1),oP(this,"sourceNode",void 0),oP(this,"context",void 0),oP(this,"audioBufferNode",void 0),oP(this,"destNode",void 0),oP(this,"audioOutputLevel",0),oP(this,"volumeLevelAnalyser",void 0),oP(this,"_processedNode",void 0),oP(this,"playNode",void 0),oP(this,"isDestroyed",!1),oP(this,"onNoAudioInput",void 0),oP(this,"isNoAudioInput",!1),oP(this,"_noAudioInputCount",0),this.context=fP(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),gP(this.outputNode),this.volumeLevelAnalyser=new _P}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(KO.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!vO().webAudioMediaStreamDest)throw new RA(AA.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&hR(()=>{mP.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;rA()||yA()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let i=0;i<n.length;i++)0!==n[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await SR(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bP extends EP{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),oP(this,"sourceNode",void 0),oP(this,"track",void 0),oP(this,"clonedTrack",void 0),oP(this,"audioElement",void 0),oP(this,"isCurrentTrackCloned",!1),oP(this,"isRemoteTrack",!1),oP(this,"originVolumeLevelAnalyser",void 0),oP(this,"rebuildWebAudio",async()=>{if(aO.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void aO.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>aO.info("resume success")),aO.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),gP(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),gP(this.outputNode),this.emit(KO.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),"audio"!==e.kind)throw new RA(AA.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),gP(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,aO.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));gP(t),this.originVolumeLevelAnalyser=new _P,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const s=qC();t&&s.os===GC.IOS&&Number(null===(r=s.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(mP.on(xO.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),gP(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(KO.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),mP.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),aO.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));gP(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function xP(e,t,n){const r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function wP(e,t){const n=await SP(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new np((n,r)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const s=document.createElement("div");s.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let d=t;const u=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=d,e.onchange=()=>{d=e.checked},u.appendChild(e),u.appendChild(t)}c.appendChild(u),c.appendChild(l),s.appendChild(a),s.appendChild(o),s.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(s),document.body.appendChild(h),e.map(e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{const{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:d})},o.appendChild(t)}})})}(n,t);return await xP(r,e,i)}async function SP(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=KA();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new RA(AA.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new np((e,r)=>{n.desktopCapturer.getSources({types:t},(t,n)=>{t?r(t):e(n)})}));try{return await r}catch(e){throw new RA(AA.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const TP=new UR("safari");let NP=!1,CP=!1;async function AP(e,t){let n=0,r=null;for(;n<2;)try{r=await RP(e,t,n>0);break}catch(e){if(e instanceof RA)throw aO.error("[".concat(t,"] ").concat(e.toString())),e;const r=IP(e.name||e.code||e,e.message);if(r.code===AA.MEDIA_OPTION_INVALID){aO.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await SR(500);continue}throw aO.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new RA(AA.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function RP(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new RA(AA.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=vO(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return aO.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(KA())e.screen.sourceId?OP(i,await xP(e.screen.sourceId,e.screen,!!e.screenAudio)):OP(i,await wP(e.screen,!!e.screenAudio));else if(ZC()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new RA(AA.NOT_SUPPORTED,"This browser does not support screen sharing");aO.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(a=e.screen.extensionId,o=t,new np((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},n=>{if(!n||!n.streamId)return aO.error("[".concat(o,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new RA(AA.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)})}catch(e){aO.error("[".concat(o,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),e.toString()),t(new RA(AA.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=n,OP(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&jO(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(s=e.screen.displaySurface)&&void 0!==s?s:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c}=e.screen,l={selfBrowserSurface:r,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c};!r&&delete l.selfBrowserSurface,!a&&delete l.surfaceSwitching,!o&&delete l.systemAudio,!c&&delete l.preferCurrentTab,aO.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:e.screenAudio,controls:l})),OP(i,await navigator.mediaDevices.getDisplayMedia(lP({video:n,audio:e.screenAudio},l)))}else{if(!nA())throw aO.error("[".concat(t,"] This browser does not support screenSharing")),new RA(AA.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&jO(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};aO.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),OP(i,await navigator.mediaDevices.getUserMedia(n))}}var a,o;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=AI("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=OR(c,l)}catch(e){}aO.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),qC();let d,u=null;($C()||rA()||QC())&&(u=await TP.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw u&&u(),e}return c.audio&&(NP=!0),c.video&&(CP=!0),OP(i,d),u&&u(),i}function IP(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new RA(AA.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new RA(AA.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new RA(AA.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new RA(AA.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new RA(AA.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new RA(AA.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return aO.error("getUserMedia unexpected error",e),new RA(AA.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function OP(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const PP=new class extends WA{get state(){return this._state}set state(e){e!==this._state&&(this.emit(tP.STATE_CHANGE,e),this._state=e)}constructor(){super(),oP(this,"_state",eP.IDLE),oP(this,"isAccessMicrophonePermission",!1),oP(this,"isAccessCameraPermission",!1),oP(this,"lastAccessMicrophonePermission",!1),oP(this,"lastAccessCameraPermission",!1),oP(this,"checkdeviceMatched",!1),oP(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(AI("ENUMERATE_DEVICES_INTERVAL")||(wA()||XC()===GC.HARMONY_OS)&&xA())&&this.updateDevicesInfo()},AI("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>aO.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new RA(AA.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(a=!1);let o=null,c=null,l=null;if(!n&&(s||a)){if(TP.isLocked&&(aO.debug("[device manager] wait GUM lock"),(await TP.lock())(),aO.debug("[device manager] GUM unlock")),NP&&(s=!1,this.isAccessMicrophonePermission=!0),CP&&(a=!1,this.isAccessCameraPermission=!0),aO.debug("[device manager] check media device permissions",e,t,s,a),s&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=IP(e.name||e.code||e,e.message);if(t.code===AA.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{o=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=IP(e.name||e.code||e,e.message);if(t.code===AA.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=IP(e.name||e.code||e,e.message);if(t.code===AA.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}aO.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,e}catch(e){return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,new RA(AA.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audioinput"===e.kind)}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(e=>"videoinput"===e.kind)}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audiooutput"===e.kind)}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===e);if(!t)throw new RA(AA.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=eP.INITING;try{await this.updateDevicesInfo(),this.state=eP.INITEND}catch(e){throw aO.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=eP.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new RA(AA.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find(e=>"audioinput"===e.kind&&"default"===e.deviceId),n=e.find(e=>"audiooutput"===e.kind&&"default"===e.deviceId);t&&n?n.groupId===t.groupId?aO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):aO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):aO.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)}),this.deviceInfoMap.forEach((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))}),this.state!==eP.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tP.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(tP.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tP.PLAYOUT_DEVICE_CHANGED,e)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(e=>"audioinput"===e.kind),n=e.filter(e=>"videoinput"===e.kind),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let kP=!1;const DP=new class extends WA{constructor(){super(...arguments),oP(this,"onAutoplayFailed",void 0),oP(this,"onAudioAutoplayFailed",void 0)}};function LP(){if(qC(),!kP){const e=t=>{t.preventDefault(),kP=!1,SA()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};kP=!0,SA()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),aO.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),DP.onAutoplayFailed?DP.onAutoplayFailed():DP.onAudioAutoplayFailed?aO.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):aO.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),DP.emit("autoplay-failed")}}function jP(e,t,n,r){if(!e)return;const i=mO.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,a=Date.now(),o=lP(lP({},s),{},{vid:void 0===s.vid?0:Number(s.vid),lts:a,elapse:a-i.startTime,cbRegistered:DP.onAutoplayFailed||DP.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});mO.send({type:uO.AUTOPLAY_FAILED,data:o},!0)}const MP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],UP=new class{constructor(){oP(this,"onAutoplayFailed",void 0),oP(this,"elementMap",new Map),oP(this,"elementStateMap",new Map),oP(this,"elementsNeedToResume",[]),oP(this,"sinkIdMap",new Map),oP(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],a=s&&s.readyState;if(aO.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return r.pause(),void r.play();if("running"===mP.curState)return fA()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}})}),oP(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(aO.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),mP.on(xO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mP.on(xO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),mP.on(xO.STATE_CHANGE,()=>{rA()&&"suspended"===mP.prevState&&"running"===mP.curState&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new RA(AA.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,nP.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch(e=>{aO.warning("[".concat(t,"] set sink id failed"),e.toString())})}catch(e){aO.warning("[".concat(t,"] set sink id failed"),e.toString())}const a=i.play();a&&a.then&&a.catch(e=>{r&&jP(r,"audio",e.message,t),aO.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(aO.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),hR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),LP()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){MP.forEach(n=>{t.addEventListener(n,n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(aO.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&aO.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(e=>{aO.debug("Auto resume audio element success")}).catch(e=>{aO.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new np(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{SA()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function VP(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new RA(AA.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",aO);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof np?new np((e,t)=>{i.then(e).catch(t)}):i}),n}}class FP extends WA{constructor(e){super(),oP(this,"name","VideoProcessorDestination"),oP(this,"ID","0"),oP(this,"_source",void 0),oP(this,"videoContext",void 0),oP(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new RA(AA.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new RA(AA.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ZO.ON_TRACK,void 0)}}class BP extends WA{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),oP(this,"constraintsMap",new Map),oP(this,"statsRegistry",[]),oP(this,"usageRegistry",[]),oP(this,"trackId",void 0),oP(this,"direction",void 0),oP(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await sR(this,$O.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aR(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return aO.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),aR(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const s=i();e.push({processorID:t,processorName:n,type:r,stats:s})}catch(e){aO.error(new RA(AA.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(lP(lP({},n),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class GP extends WA{constructor(e){super(),oP(this,"name","AudioProcessorDestination"),oP(this,"ID","0"),oP(this,"inputTrack",void 0),oP(this,"inputNode",void 0),oP(this,"audioProcessorContext",void 0),oP(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new RA(AA.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new RA(AA.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ZO.ON_TRACK,void 0),this.emit(ZO.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(ZO.ON_NODE,this.inputNode))}}class HP extends WA{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),oP(this,"constraintsMap",new Map),oP(this,"statsRegistry",[]),oP(this,"audioContext",void 0),oP(this,"trackId",void 0),oP(this,"direction",void 0),oP(this,"usageRegistry",[]),oP(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return sR(this,$O.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aR(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),aR(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const s=i();e.push({processorID:t,processorName:n,type:r,stats:s})}catch(e){aO.error(new RA(AA.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(lP(lP({},n),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class WP extends WA{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),oP(this,"context",void 0),oP(this,"processSourceNode",void 0),oP(this,"outputTrack",void 0),oP(this,"processedNode",void 0),oP(this,"clonedTrack",void 0),oP(this,"outputNode",void 0),this.outputNode=new zP}setVolume(){}createOutputTrack(){throw new RA(AA.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class zP{disconnect(){}connect(){}}function KP(e){return new np((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=rA()?"canplay":"playing";i.addEventListener(s,()=>{const e=i.videoWidth,n=i.videoHeight;!e&&nA()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))}),i.srcObject=new MediaStream([e]),i.play().catch(CR),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function qP(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=IO(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!EA()&&n.frameRate&&(t.frameRate=n.frameRate),tA()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),nA()&&(t.frameRate={ideal:30,max:30}),t}function YP(e){const t={};return EA()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,ZC()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function XP(e){const t=YP(e);if(e.encoderConfig){const n=DO(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),wA()&&(t.sampleRate=void 0),t}const JP=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:a=r,height:o=i}=t;if(!s||!a||!o)return;a=kR(a),o=kR(o),s=kR(s);const{max:c,min:l}=function(e,t,n){const r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(a,o,s),{bitrateMax:d,bitrateMin:u}=t||{};d||aO.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(o,", fps: ").concat(s,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));const{maxFramerate:h}=AI("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(s=Math.min(s,h)),{frameRate:s,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}},QP=async(e,t,n)=>await(async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(LR(""+t+n)).slice(0,16),i=r.slice(0,12),s=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},s,e))})(e.buffer,t,n),ZP=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new np((n,r)=>{t.toBlob(async e=>{if(t.remove(),e){const r=await $P(e);n({buffer:r,width:t.width,height:t.height})}else r(new RA(AA.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},$P=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var ek,tk,nk,rk,ik,sk,ak,ok,ck,lk,dk,uk,hk,pk,mk,fk,gk,vk,yk,_k,Ek,bk,xk,wk,Sk,Tk,Nk,Ck,Ak,Rk,Ik,Ok,Pk,kk,Dk,Lk,jk,Mk,Uk,Vk;let Fk=(ek=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tk=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),nk=VP(),rk=VR("LocalAudioTrack","_enabledMutex"),ik=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),sk=VP(),ak=VR("LocalAudioTrack","_enabledMutex"),ok=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),ck=VP(),lk=VP(),dk=VP(),uk=pO({argsMap:e=>[e.getTrackId()]}),hk=VP(),pk=pO({argsMap:e=>[e.getTrackId()]}),mk=VP(),fk=pO({argsMap:e=>[e.getTrackId()]}),gk=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),vk=pO({argsMap:e=>[e.getTrackId()]}),aP((yk=class extends uP{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?UP.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),oP(this,"trackMediaType",zO.AUDIO),oP(this,"_encoderConfig",void 0),oP(this,"_trackSource",void 0),oP(this,"metadata",[]),oP(this,"_enabled",!0),oP(this,"_volume",100),oP(this,"_useAudioElement",!0),oP(this,"_bypassWebAudio",!1),oP(this,"processor",void 0),oP(this,"_processorContext",void 0),oP(this,"_processorDestination",void 0),oP(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new WP,AI("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),AI("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$C()&&!pP?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){PA(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&UP.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void aO.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,aR(this,MO.NEED_REPLACE_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!yO())throw new RA(AA.NOT_SUPPORTED,"your browser does not support setting the audio output device");await UP.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await aR(this,MO.NEED_ENABLE_TRACK,this),aO.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await aR(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aR(this,MO.NEED_MUTE_TRACK,this):await aR(this,MO.NEED_UNMUTE_TRACK,this))}getStats(){return gR(()=>{aO.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),oR(this,MO.GET_STATS)||lP({},qO)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(KO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(KO.ON_AUDIO_BUFFER),this._source.on(KO.ON_AUDIO_BUFFER,t=>e(t))}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] start audio playback in element")),UP.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?UP.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&UP.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aR(this,MO.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return np.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new RA(AA.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new RA(AA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await aR(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aR(this,MO.NEED_REPLACE_TRACK,this))}),e.on(ZO.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ZO.ON_TRACK),e.removeAllListeners(ZO.ON_NODE)}bindProcessorContextEvents(e){e.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners($O.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof WP&&(this._trackSource=new bP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new HP(this._source.context,this.getTrackId(),"local"),t=new GP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(KO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(UP.stop(this.getTrackId()),this._source.play()),aR(this,MO.NEED_REPLACE_MIXING_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[ek],Object.getOwnPropertyDescriptor(yk.prototype,"setVolume"),yk.prototype),aP(yk.prototype,"setPlaybackDevice",[tk,nk],Object.getOwnPropertyDescriptor(yk.prototype,"setPlaybackDevice"),yk.prototype),aP(yk.prototype,"setEnabled",[rk,ik,sk],Object.getOwnPropertyDescriptor(yk.prototype,"setEnabled"),yk.prototype),aP(yk.prototype,"setMuted",[ak,ok,ck],Object.getOwnPropertyDescriptor(yk.prototype,"setMuted"),yk.prototype),aP(yk.prototype,"getStats",[lk],Object.getOwnPropertyDescriptor(yk.prototype,"getStats"),yk.prototype),aP(yk.prototype,"setAudioFrameCallback",[dk],Object.getOwnPropertyDescriptor(yk.prototype,"setAudioFrameCallback"),yk.prototype),aP(yk.prototype,"play",[uk,hk],Object.getOwnPropertyDescriptor(yk.prototype,"play"),yk.prototype),aP(yk.prototype,"stop",[pk,mk],Object.getOwnPropertyDescriptor(yk.prototype,"stop"),yk.prototype),aP(yk.prototype,"close",[fk],Object.getOwnPropertyDescriptor(yk.prototype,"close"),yk.prototype),aP(yk.prototype,"pipe",[gk],Object.getOwnPropertyDescriptor(yk.prototype,"pipe"),yk.prototype),aP(yk.prototype,"unpipe",[vk],Object.getOwnPropertyDescriptor(yk.prototype,"unpipe"),yk.prototype),yk),Bk=(_k=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),Ek=VP(),bk=VR("MicrophoneAudioTrack","_enabledMutex"),xk=pO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),wk=VP(),Sk=pO({argsMap:e=>[e.getTrackId()]}),aP((Tk=class extends Fk{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?DO(t.encoderConfig):{},r,AI("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),oP(this,"_config",void 0),oP(this,"_deviceName","default"),oP(this,"_constraints",void 0),oP(this,"_originalConstraints",void 0),oP(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(fA()||gA())&&mP.bindInterruptDetectorTrack(this)}async setDevice(e){if(aO.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await PP.getDeviceById(e),n={};n.audio=lP({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await AP(n,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await AP({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await PP.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return aO.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),AI("AUTO_RESET_AUDIO_ROUTE")&&(rA()||yA())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await aR(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=lP({},this._constraints),s=PP.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const e=await AP({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await aR(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(fA()||gA())&&mP.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((rA()||yA())&&this._enabled&&!this._isClosed&&mP.duringInterruption){const e=async()=>{mP.off(xO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mP.on(xO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(HO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=PP.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await AP({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[_k,Ek],Object.getOwnPropertyDescriptor(Tk.prototype,"setDevice"),Tk.prototype),aP(Tk.prototype,"setEnabled",[bk,xk,wk],Object.getOwnPropertyDescriptor(Tk.prototype,"setEnabled"),Tk.prototype),aP(Tk.prototype,"close",[Sk],Object.getOwnPropertyDescriptor(Tk.prototype,"close"),Tk.prototype),Tk),Gk=(Nk=pO({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Ck=VP(),Ak=pO({argsMap:e=>[e.getTrackId()]}),Rk=VP(),Ik=pO({argsMap:e=>[e.getTrackId()]}),Ok=VP(),Pk=pO({argsMap:e=>[e.getTrackId()]}),kk=VP(),Dk=pO({argsMap:e=>[e.getTrackId()]}),Lk=VP(),jk=pO({argsMap:e=>[e.getTrackId()]}),Mk=pO({argsMap:e=>[e.getTrackId()]}),Uk=VP(),aP((Vk=class extends Fk{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),oP(this,"source",void 0),oP(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(KO.AUDIO_SOURCE_STATE_CHANGE,e=>{this.safeEmit(HO.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){PA(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Nk,Ck],Object.getOwnPropertyDescriptor(Vk.prototype,"startProcessAudioBuffer"),Vk.prototype),aP(Vk.prototype,"pauseProcessAudioBuffer",[Ak,Rk],Object.getOwnPropertyDescriptor(Vk.prototype,"pauseProcessAudioBuffer"),Vk.prototype),aP(Vk.prototype,"seekAudioBuffer",[Ik,Ok],Object.getOwnPropertyDescriptor(Vk.prototype,"seekAudioBuffer"),Vk.prototype),aP(Vk.prototype,"resumeProcessAudioBuffer",[Pk,kk],Object.getOwnPropertyDescriptor(Vk.prototype,"resumeProcessAudioBuffer"),Vk.prototype),aP(Vk.prototype,"stopProcessAudioBuffer",[Dk,Lk],Object.getOwnPropertyDescriptor(Vk.prototype,"stopProcessAudioBuffer"),Vk.prototype),aP(Vk.prototype,"close",[jk],Object.getOwnPropertyDescriptor(Vk.prototype,"close"),Vk.prototype),aP(Vk.prototype,"setAudioBufferPlaybackSpeed",[Mk,Uk],Object.getOwnPropertyDescriptor(Vk.prototype,"setAudioBufferPlaybackSpeed"),Vk.prototype),Vk);class Hk extends Fk{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=fP().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,TR(8,"track-mix-")),oP(this,"trackList",void 0),oP(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(aO.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):aO.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){aO.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}dR(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof Hk?t.emit(GO.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class Wk extends EP{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(KO.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),oP(this,"audioBuffer",void 0),oP(this,"sourceNode",void 0),oP(this,"startPlayTime",0),oP(this,"startPlayOffset",0),oP(this,"pausePlayTime",0),oP(this,"options",void 0),oP(this,"currentLoopCount",0),oP(this,"currentPlaybackSpeed",100),oP(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):aO.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const zk=new Map;function Kk(e,t){if(0===e.length||0===t.length)return 1/0;const n=DR(e),r=DR(t);return Math.floor(r/n)}class qk{get rendFrameRate(){const e=Math.max(1,Kk(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:nP.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(aO.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){oP(this,"trackId",void 0),oP(this,"config",void 0),oP(this,"onFirstVideoFrameDecoded",void 0),oP(this,"onFirstVideoFrameRender",void 0),oP(this,"onVideoStateChanged",void 0),oP(this,"freezeTimeCounterList",[]),oP(this,"renderFreezeAccTime",0),oP(this,"renderFreezeAccTime2",0),oP(this,"isKeepLastFrame",!1),oP(this,"isDestroyed",!1),oP(this,"timeUpdatedCount",0),oP(this,"freezeTime",0),oP(this,"playbackTime",0),oP(this,"lastTimeUpdatedTime",0),oP(this,"autoplayFailed",!1),oP(this,"videoTrack",void 0),oP(this,"videoElement",void 0),oP(this,"cacheVideoElement",void 0),oP(this,"internal",!1),oP(this,"_render_interframe_delays",[]),oP(this,"_render_interframe_delays_sizes",[]),oP(this,"_videoState",rP.VideoStateStopped),oP(this,"videoElementCheckInterval",void 0),oP(this,"videoElementFreezeTimeout",void 0),oP(this,"_videoElementStatus",nP.NONE),oP(this,"_isInPage",!0),oP(this,"isGettingVideoDimensions",!1),oP(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return aO.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),oP(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===mP.curState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),vA()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),oP(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":"play"===e.type&&aO.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=nP.PLAYING;break;case"loadeddata":if(this.videoState=rP.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=nP.CANPLAY;break;case"stalled":this.videoElementStatus=nP.STALLED;break;case"suspend":this.videoElementStatus=nP.SUSPEND;break;case"pause":this.videoElementStatus=nP.PAUSED,rA()||yA()||$C()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=nP.WAITING;break;case"abort":this.videoElementStatus=nP.ABORT;break;case"ended":this.videoElementStatus=nP.ENDED;break;case"emptied":this.videoElementStatus=nP.EMPTIED;break;case"error":{const e=this.videoElement.error;e&&(this.videoElementStatus=nP.ERROR,aO.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,ZD.lastVisibleTime<ZD.lastHiddenTime||n<ZD.lastHiddenTime||n<ZD.lastVisibleTime)return;if(this.isSkipCalcRenderFreezeTime())return;for(t>AI("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),oP(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),vA()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),mP.on(xO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mP.on(xO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch(t=>{e&&jP(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(aO.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):aO.warning("[".concat(this.trackId,"] play warning: "),t)});const n=qC();if(("Safari"===n.name&&15===Number(n.version)||fA())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return aO.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new np((r,i)=>{n.toBlob(async e=>{if(n.remove(),e){const t=await $P(e);r({buffer:t,width:n.width,height:n.height})}else i(new RA(AA.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await ZP(e)}destroy(){this.isDestroyed=!0,mP.off(xO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mP.off(xO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=rP.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=nP.INIT,!this.videoElementCheckInterval&&(Yk.forEach(e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(e){return e!==document.body&&document.body.contains(e)}(this.videoElement)},1e3),AI("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,AI("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===rP.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=rP.VideoStateFrozen:document.addEventListener("visibilitychange",r))},s=(e,t)=>{if(this.videoElementStatus===nP.PLAYING){if(n){const e=t.presentationTime-n.presentationTime,r=t.presentedFrames-n.presentedFrames;this._render_interframe_delays_sizes.push(r),this._render_interframe_delays.push(e);const s=DR(this._render_interframe_delays_sizes),a=s-this._render_interframe_delays_sizes[0];if(s>30&&a>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===rP.VideoStateStarting&&(this.videoState=rP.VideoStateDecoding),this.videoState===rP.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,AI("VIDEO_FREEZE_DURATION"))),e<AI("VIDEO_FREEZE_DURATION")&&this.videoState===rP.VideoStateFrozen&&(this.videoState=rP.VideoStateDecoding),e>AI("VIDEO_FREEZE_DURATION")&&ZD.lastVisibleTime>=ZD.lastHiddenTime&&n.timestamp>ZD.lastVisibleTime&&n.timestamp>ZD.lastHiddenTime){const t=Math.min(66,Kk(this._render_interframe_delays_sizes,this._render_interframe_delays)),n=Math.max(0,e-(r-1)*t);this.renderFreezeAccTime2+=n>t?n:0,this.renderFreezeAccTime+=e}}n=lP(lP({},t),{},{timestamp:e})}else this.isSkipCalcRenderFreezeTime()&&(n=lP(lP({},t),{},{timestamp:e}));var r,a;AI("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(a=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(a,s))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,s)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),wA()&&!AI("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=qC();"Safari"===n.name&&15===Number(n.version)||fA()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nA()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nA()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch(e=>{aO.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}resetVideoElement(){Yk.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=nP.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===nP.DESTROYED||this.internal}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{aO.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(e=>{aO.error(e)}),this.autoplayFailed=!1,SA()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};SA()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),LP()}}const Yk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Xk extends qk{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),oP(this,"container",void 0),oP(this,"slot",void 0),this.slot=e.element,this.internal=t,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;var n;!this.internal||this.slot?(t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()):(this.slot=t,t&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",null===(n=this.slot)||void 0===n||n.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await ZP(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),null===(e=this.slot)||void 0===e||e.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",AI("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),null===(e=this.slot)||void 0===e||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Jk,Qk,Zk,$k,eD,tD,nD,rD,iD,sD,aD,oD,cD,lD,dD,uD,hD,pD,mD,fD,gD,vD,yD,_D,ED,bD,xD,wD,SD,TD,ND,CD,AD,RD,ID,OD,PD,kD;let DD=(Jk=pO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Qk=VP(),Zk=pO({argsMap:e=>[e.getTrackId()]}),$k=VR("LocalVideoTrack","_enabledMutex"),eD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),tD=VP(),nD=VR("LocalVideoTrack","_enabledMutex"),rD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),iD=VP(),sD=pO({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),aD=VP(),oD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),cD=VP(),lD=VP(),dD=pO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),uD=VP(),hD=VP(),pD=VP(),mD=pO({argsMap:e=>[e.getTrackId()]}),fD=VP(),gD=VP(),vD=VP(),yD=VP(),_D=VP(),ED=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),bD=pO({argsMap:e=>[e.getTrackId()]}),xD=pO({argsMap:e=>[e.getTrackId()]}),wD=pO({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),SD=class e extends uP{get videoHeight(){if($C()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if($C()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nP.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,s){if(super(e,i),oP(this,"trackMediaType",zO.VIDEO),oP(this,"_player",void 0),oP(this,"isUseScaleResolutionDownBy",!1),oP(this,"_videoVisibleTimer",null),oP(this,"_previousVideoVisibleStatus",void 0),oP(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oP(this,"_encoderConfig",void 0),oP(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),oP(this,"_optimizationMode",void 0),oP(this,"_saveEncodeBitrateRatio",1),oP(this,"_videoHeight",void 0),oP(this,"_videoWidth",void 0),oP(this,"_forceBitrateLimit",void 0),oP(this,"_enabled",!0),oP(this,"_processorDestination",void 0),oP(this,"_processorContext",void 0),$C()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=r,this._hints=s||[],t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)?this._encoderConfig=pR(t):this._encoderConfig=t,-1===this._hints.indexOf(UO.SCREEN_TRACK))this.updateBitrateFromProfile();else if(aA(HC.CHROME,115)&&-1!==XC().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&vO().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),r=new MediaStreamTrackGenerator({kind:"video"});let i,s,a=Date.now();const o=()=>{c&&(clearInterval(c),c=void 0),i&&(i.close(),i=void 0),e.stop(),s=void 0,r.removeEventListener("ended",o)};let c=window.setInterval(()=>{if(s&&i&&Date.now()-a>(null!=t?t:1e3))try{"live"===r.readyState?s.enqueue(i.clone()):o()}catch(e){o()}},null!=t?t:1e3);const l=new TransformStream({transform:(e,t)=>{"live"===r.readyState?(s=t,a=Date.now(),void 0===i?(i=e,t.enqueue(e.clone())):(t.enqueue(i),i=e)):e.close()}});return r.addEventListener("ended",o),n.readable.pipeThrough(l).pipeTo(r.writable),r}}(e);t&&(aO.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new BP(this.getTrackId(),"local"),this._processorDestination=new FP(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=lP(lP(lP({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new qk(n):this._player=new Xk(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(HO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},AI("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await aR(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await aR(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aR(this,MO.NEED_MUTE_TRACK,this):await aR(this,MO.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._saveEncodeBitrateRatio;if(1!==this._saveEncodeBitrateRatio&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),aO.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await aR(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new RA(AA.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=IO(e),AI("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=qP({encoderConfig:e});($C()||rA()||yA())&&(t.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new RA(AA.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aR(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}getStats(){return gR(()=>{aO.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),oR(this,MO.GET_STATS)||lP({},YO)}async setBeautyEffect(e){aO.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await ZP(e)}async findClosestProfile(){const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings(),{width:r,height:i,frameRate:s}=this._encoderConfig||{},a=kR(this._videoWidth||e||r||0),o=kR(this._videoHeight||t||i||0),c=function(e,t,n){if(!Array.isArray(AI("VIDEO_ENCODER_CONFIG_LIST")))return!1;if(0===AI("VIDEO_ENCODER_CONFIG_LIST").length)return!1;const r=Math.min(e,t);return!(r>=480)&&lP(lP({},AI("VIDEO_ENCODER_CONFIG_LIST").find(e=>e.height>r)),{},{frameRate:n})}(a,o,kR(n||s||15));if(c)return aO.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(a,"x").concat(o," => ").concat(JSON.stringify(c))),this.setEncoderConfiguration(c)}async setBitrateLimit(e){aO.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void aO.error(AA.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await aR(this,MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,aO.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return aO.error(AA.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,aO.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){KP(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(CR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new RA(AA.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");aO.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=IO(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aR(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){const{max:s,min:a}=function(e,t,n,r,i){const s=AI("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===s)return{min:r,max:i};if(void 0===i){const a=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===s?4*a:2*a,r=null!=r?r:a}else r=null!=r?r:Math.floor(i/10);return{min:r,max:i}}(e,t,n,i,r);if(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=s,AI("VIDEO_STANDARD_BITRATE_VERSION")&&null==i&&null==r){const[r,i]=function(e,t,n){const r=4*Math.floor(2e5*Math.pow(n/15,.6)*Math.pow(e*t/230400,.75)),i=e*t,s=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),a=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let o=up(s).call(s).next().value,c=1;if(s.has(i))o=s.get(i);else{var l;const e=Xp(l=Array.from(s.entries())).call(l,(e,t)=>{let[n]=e,[r]=t;return n-r}),t=e.find(e=>{let[t]=e;return t>i});if(t){const n=e.indexOf(t);if(n>0){const r=e[n-1],s=(i-r[0])/(t[0]-r[0]);o=r[1]+s*(t[1]-r[1])}else o=t[1]}else o=e[e.length-1][1]}if(a.has(i))c=a.get(i);else{var d;const e=Xp(d=Array.from(a.entries())).call(d,(e,t)=>{let[n]=e,[r]=t;return n-r}),t=e.find(e=>{let[t]=e;return t>i});if(t){const n=e.indexOf(t);if(n>0){const r=e[n-1],s=(i-r[0])/(t[0]-r[0]);c=r[1]+s*(t[1]-r[1])}else c=t[1]}else c=e[e.length-1][1]}const u=AI("VIDEO_NEW_BITRATE_RATIO");u&&u>0&&(o=u/100);const h=Math.floor(r*o),p=Math.floor(65e4*Math.pow(e*t/230400,.5)*Math.pow(n/15,.69));let m=h;const f=AI("VIDEO_STANDARD_BITRATE_VERSION");return f&&f>0&&(1===f?m=r:2===f?m=h:3===f&&(m=p)),[Math.floor(m/1e3),c]}(e,t,n);this._encoderConfig.bitrateMax=r,this._encoderConfig.bitrateMin=a?Math.min(a,r):r,this._saveEncodeBitrateRatio=i,aO.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else aO.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(s,", brMin: ").concat(a,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const e=FA.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YA.TRACER,name:qA.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new RA(AA.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new RA(AA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=lP(lP({},r),IO(t))),r=mR(r);const i=TR(8,"track-video-cloned-"),s=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,mR(this._scalabilityMode),this._optimizationMode,i,mR(this._hints));return t&&r&&s.setEncoderConfiguration(r),aO.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new RA(AA.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new RA(AA.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(gR(()=>{mO.reportApiInvoke(null,{name:qA.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:YA.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!AI("ENABLE_VIDEO_SEI")||!AI("ENABLE_ENCODED_TRANSFORM"))return void aO.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new RA(AA.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void aO.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r||"video/h265"===r?this.safeEmit("sei-to-send",e):aO.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await aR(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aR(this,MO.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($O.REQUEST_CONSTRAINTS)}},aP(SD.prototype,"play",[Jk,Qk],Object.getOwnPropertyDescriptor(SD.prototype,"play"),SD.prototype),aP(SD.prototype,"stop",[Zk],Object.getOwnPropertyDescriptor(SD.prototype,"stop"),SD.prototype),aP(SD.prototype,"setEnabled",[$k,eD,tD],Object.getOwnPropertyDescriptor(SD.prototype,"setEnabled"),SD.prototype),aP(SD.prototype,"setMuted",[nD,rD,iD],Object.getOwnPropertyDescriptor(SD.prototype,"setMuted"),SD.prototype),aP(SD.prototype,"setSaveEncodeBitrateRatio",[sD,aD],Object.getOwnPropertyDescriptor(SD.prototype,"setSaveEncodeBitrateRatio"),SD.prototype),aP(SD.prototype,"setEncoderConfiguration",[oD,cD],Object.getOwnPropertyDescriptor(SD.prototype,"setEncoderConfiguration"),SD.prototype),aP(SD.prototype,"getStats",[lD],Object.getOwnPropertyDescriptor(SD.prototype,"getStats"),SD.prototype),aP(SD.prototype,"setBeautyEffect",[dD,uD],Object.getOwnPropertyDescriptor(SD.prototype,"setBeautyEffect"),SD.prototype),aP(SD.prototype,"getCurrentFrameData",[hD],Object.getOwnPropertyDescriptor(SD.prototype,"getCurrentFrameData"),SD.prototype),aP(SD.prototype,"getCurrentFrameImage",[pD],Object.getOwnPropertyDescriptor(SD.prototype,"getCurrentFrameImage"),SD.prototype),aP(SD.prototype,"findClosestProfile",[mD,fD],Object.getOwnPropertyDescriptor(SD.prototype,"findClosestProfile"),SD.prototype),aP(SD.prototype,"setBitrateLimit",[gD],Object.getOwnPropertyDescriptor(SD.prototype,"setBitrateLimit"),SD.prototype),aP(SD.prototype,"setOptimizationMode",[vD],Object.getOwnPropertyDescriptor(SD.prototype,"setOptimizationMode"),SD.prototype),aP(SD.prototype,"setScalabiltyMode",[yD],Object.getOwnPropertyDescriptor(SD.prototype,"setScalabiltyMode"),SD.prototype),aP(SD.prototype,"updateMediaStreamTrackResolution",[_D],Object.getOwnPropertyDescriptor(SD.prototype,"updateMediaStreamTrackResolution"),SD.prototype),aP(SD.prototype,"pipe",[ED],Object.getOwnPropertyDescriptor(SD.prototype,"pipe"),SD.prototype),aP(SD.prototype,"unpipe",[bD],Object.getOwnPropertyDescriptor(SD.prototype,"unpipe"),SD.prototype),aP(SD.prototype,"close",[xD],Object.getOwnPropertyDescriptor(SD.prototype,"close"),SD.prototype),aP(SD.prototype,"replaceTrack",[wD],Object.getOwnPropertyDescriptor(SD.prototype,"replaceTrack"),SD.prototype),SD),LD=(TD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),ND=VP(),CD=VR("CameraVideoTrack","_enabledMutex"),AD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),RD=VP(),ID=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),OD=VP(),PD=pO({argsMap:e=>[e.getTrackId()]}),kD=class e extends DD{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,s){super(e,IO(t.encoderConfig),r,i,s),oP(this,"_config",void 0),oP(this,"_originalConstraints",void 0),oP(this,"_constraints",void 0),oP(this,"_enabled",!0),oP(this,"_deviceName","default"),oP(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(fA()||gA())&&!function(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&_A()&&this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=IO(this._config.encoderConfig),mP.on(xO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mP.on(xO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await PP.getDeviceById(e),n={};n.video=lP({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await AP(n,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await AP({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await PP.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){aO.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:lP(lP({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await AP(t,this.getTrackId())}catch(t){throw aO.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await AP({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=lP({},t.video),aO.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await AP({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await aR(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await aR(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new RA(AA.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=IO(e),AI("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=pR(this._config);n.encoderConfig=e;const r=qP(n);($C()||rA()||yA())&&(r.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new RA(AA.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aR(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((rA()||yA())&&this._enabled&&!this._isClosed&&mP.duringInterruption){const e=async()=>{mP.off(xO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mP.on(xO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(HO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=PP.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await AP({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),mP.off(xO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mP.off(xO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=lP(lP({},r),IO(t))),r=mR(r);const i=TR(8,"track-cam-cloned-"),s=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,mR(lP(lP({},this._config),{},{encoderConfig:r})),mR(this._constraints),mR(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),aO.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}),this.processorContext.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},aP(kD.prototype,"setDevice",[TD,ND],Object.getOwnPropertyDescriptor(kD.prototype,"setDevice"),kD.prototype),aP(kD.prototype,"setEnabled",[CD,AD,RD],Object.getOwnPropertyDescriptor(kD.prototype,"setEnabled"),kD.prototype),aP(kD.prototype,"setEncoderConfiguration",[ID,OD],Object.getOwnPropertyDescriptor(kD.prototype,"setEncoderConfiguration"),kD.prototype),aP(kD.prototype,"close",[PD],Object.getOwnPropertyDescriptor(kD.prototype,"close"),kD.prototype),kD);function jD(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=lP(lP({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?aO.debug("[".concat(e,"] set content hint to"),n.optimizationMode):aO.debug("[".concat(e,"] set content hint failed")))):aO.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MD,UD,VD,FD,BD,GD,HD,WD,zD,KD,qD,YD;class XD extends dP{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(TR(5,""))),oP(this,"_userId",void 0),oP(this,"_uintId",void 0),oP(this,"_isDestroyed",!1),oP(this,"store",void 0),oP(this,"processor",void 0),oP(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,aO.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let JD=(MD=pO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),UD=pO({argsMap:e=>[e.getTrackId()]}),VD=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FD=pO({argsMap:e=>[e.getTrackId()]}),aP((BD=class extends XD{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nP.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),oP(this,"_videoVisibleTimer",null),oP(this,"_previousVideoVisibleStatus",void 0),oP(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oP(this,"trackMediaType",zO.VIDEO),oP(this,"_videoWidth",void 0),oP(this,"_videoHeight",void 0),oP(this,"_player",void 0),oP(this,"_prePlayer",void 0),oP(this,"processorDestination",void 0),oP(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new BP(this.getTrackId(),"remote"),this.processorDestination=new FP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return gR(()=>{aO.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),oR(this,MO.GET_STATS)||lP({},QO)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.safeEmit(WO.PLAY_START),"string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=lP(lP({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let t=!1,r=!1;e instanceof HTMLVideoElement?(this._player=new qk(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,r=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,t=this._player.videoState>0,this._player.updateConfig(n)):this._player=new Xk(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(WO.FIRST_FRAME_DECODED),r&&this.safeEmit(WO.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=e=>{this.safeEmit(WO.VIDEO_STATE_CHANGED,e)},t&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(WO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},AI("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(WO.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){KP(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(CR)}_updatePlayerSource(){aO.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const e=FA.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YA.TRACER,name:qA.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new RA(AA.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new RA(AA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(GO.SEI_RECEIVED,e)}}).prototype,"play",[MD],Object.getOwnPropertyDescriptor(BD.prototype,"play"),BD.prototype),aP(BD.prototype,"stop",[UD],Object.getOwnPropertyDescriptor(BD.prototype,"stop"),BD.prototype),aP(BD.prototype,"pipe",[VD],Object.getOwnPropertyDescriptor(BD.prototype,"pipe"),BD.prototype),aP(BD.prototype,"unpipe",[FD],Object.getOwnPropertyDescriptor(BD.prototype,"unpipe"),BD.prototype),BD),QD=(GD=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),HD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),WD=pO({argsMap:e=>[e.getTrackId()]}),zD=pO({argsMap:e=>[e.getTrackId()]}),KD=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),qD=pO({argsMap:e=>[e.getTrackId()]}),aP((YD=class extends XD{get isPlaying(){return this._useAudioElement?UP.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),oP(this,"trackMediaType",zO.AUDIO),oP(this,"_source",void 0),oP(this,"_useAudioElement",!0),oP(this,"_volume",100),oP(this,"processorContext",void 0),oP(this,"processorDestination",void 0),oP(this,"_played",!1),oP(this,"_bypassWebAudio",!1),AI("DISABLE_WEBAUDIO")?(this._source=new WP,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bP(e,!0),AI("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(KO.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(WO.FIRST_FRAME_DECODED)}),this.processorContext=new HP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new GP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(KO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(KO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(KO.ON_AUDIO_BUFFER),this._source.on(KO.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){this._volume=e,this._useAudioElement?UP.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!yO())throw new RA(AA.NOT_SUPPORTED,"your browser does not support setting the audio output device");await UP.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return gR(()=>{aO.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),oR(this,MO.GET_STATS)||lP({},XO)}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] use audio element to play")),UP.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?UP.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&UP.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new RA(AA.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new RA(AA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new RA(AA.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ZO.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK),this.processorDestination.removeAllListeners(ZO.ON_NODE)}}).prototype,"setVolume",[GD],Object.getOwnPropertyDescriptor(YD.prototype,"setVolume"),YD.prototype),aP(YD.prototype,"setPlaybackDevice",[HD],Object.getOwnPropertyDescriptor(YD.prototype,"setPlaybackDevice"),YD.prototype),aP(YD.prototype,"play",[WD],Object.getOwnPropertyDescriptor(YD.prototype,"play"),YD.prototype),aP(YD.prototype,"stop",[zD],Object.getOwnPropertyDescriptor(YD.prototype,"stop"),YD.prototype),aP(YD.prototype,"pipe",[KD],Object.getOwnPropertyDescriptor(YD.prototype,"pipe"),YD.prototype),aP(YD.prototype,"unpipe",[qD],Object.getOwnPropertyDescriptor(YD.prototype,"unpipe"),YD.prototype),YD);const ZD=new class extends WA{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),oP(this,"_lastHiddenTime",0),oP(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),aO.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class $D extends WA{constructor(e,t){super(),oP(this,"trackMediaType",zO.DATA),oP(this,"_version",1),oP(this,"_type",3),oP(this,"_config",void 0),oP(this,"_originDataChannel",void 0),oP(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),oP(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),oP(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return AI("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new np((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout(()=>{var e;t(new RA(AA.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new RA(AA.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new RA(AA.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[sP.OPEN,sP.CLOSE,sP.ERROR].forEach(t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[n,r]=t;e.removeEventListener(n,r)}),this._datachannelEventMap.clear()}}class eL extends $D{constructor(e){super(e),oP(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(AI("SHOW_DATASTREAM2_LOG")&&aO.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(sP.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class tL extends $D{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function nL(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>by.revokeObjectURL(e),0),new Worker(by.createObjectURL(e))}const rL=71,iL=1,sL=2,aL=1,oL=2;var cL=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(cL||{});function lL(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.getUint8(0);if(n!==rL)return;const r=e.getUint16(1),i=iL+sL+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const a={m:n,tlvLen:r,tlv:[],frame:s};let o=iL+sL;for(;o<i;){const n=e.getUint8(o),r=e.getUint16(o+aL),i=aL+oL;if(n===cL.AUDIO_LEVEL){let s=e.getUint8(o+i);for(let t=1;t<r;t++)s=s<<8|e.getUint8(o+i+t);a.tlv.push({tag:n,length:r,value:t?127^s>>1:127&s})}else if(n===cL.METADATA||n===cL.AUDIO_64_BIT_PTS){const t=new Uint8Array(r);for(let n=0;n<r;n++)t[n]=e.getUint8(o+i+n);a.tlv.push({tag:n,length:r,value:t})}o+=i+r}return a}const dL=new Map,uL=127,hL=1e-10,pL=139/13,mL=new Map;function fL(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;if(mL.has(r))i=mL.get(r);else{const s=.5;i=Math.log(function(e,t){const n=e-t;t<n&&(t=n);let r=1;for(let i=e,s=1;i>t;i--,s++)r=r*i/s;return r}(t,e))+e*Math.log(s)+(t-e)*Math.log(1-s)-Math.log(n)+n*e,mL.set(r,i)}return i<hL&&(i=hL),i}function gL(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let a=0,o=0;a<r;a++){let r=0;for(let t=o+i;o<t;o++)e[o]>n&&r++;t[a]!==r&&(t[a]=r,s=!0)}return s}window.cache=mL;let vL=0;class yL{constructor(e){oP(this,"id",void 0),oP(this,"immediates",[]),oP(this,"lastNonSilence",-1),oP(this,"immediateSpeechActivityScore",hL),oP(this,"lastLevelChangedTime",Date.now()),oP(this,"levels",[]),oP(this,"longs",[]),oP(this,"longSpeechActivityScore",hL),oP(this,"mediums",[]),oP(this,"mediumSpeechActivityScore",hL),oP(this,"minLevel",0),oP(this,"nextMinLevel",0),oP(this,"nextMinLevelWindowLength",0),oP(this,"energyScore",0),this.id=e||"".concat(vL++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,t=this.levels,n=this.minLevel+pL;let r=!1;for(let i=0;i<e.length;++i){let s=t[i];s<n&&(s=0);const a=Math.floor(s/pL);e[i]!==a&&(e[i]=a,r=!0)}return r}computeLongs(){return gL(this.mediums,this.longs,4)}computeMediums(){return gL(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=fL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=fL(this.longs[0],10,47),this.longSpeechActivityScore>hL&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=fL(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(vi(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let n=e;return e<0&&(n=0),e>uL&&(n=uL),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+pL?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>uL&&(e=uL),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class _L{constructor(e){oP(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class EL{constructor(e,t,n){oP(this,"isDominant",void 0),oP(this,"energyRanking",void 0),oP(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n}}class bL extends WA{constructor(e){super(),oP(this,"dominantId",null),oP(this,"lastDecisionTime",0),oP(this,"lastLevelChangedTime",0),oP(this,"lastLevelIdleTime",0),oP(this,"relativeSpeechActivities",[]),oP(this,"speakers",new Map),oP(this,"enableSilence",!1),oP(this,"timeoutToSilenceInterval",0),oP(this,"decisionMaker",null),oP(this,"loudest",[]),oP(this,"numLoudestToTrack",3),oP(this,"energyExpireTimeMs",250),oP(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=n&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(t=>t.id===e)}levelChanged(e,t){const n=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());const i=r.levelChanged(t,n);return this.updateLoudestList(r,i,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)})}removeSpeakers(e){e.forEach(e=>{this.speakers.delete(e.id)})}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new yL(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,n){const r=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new EL(r,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new EL(r,0,e.energyScore);const i=n-this.energyExpireTimeMs;let s=0;for(;s<this.loudest.length;){const t=this.loudest[s];if(t.getLastLevelChangedTime()<i&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(s,1);else if(t.id!==e.id)++s;else if(this.loudest.splice(s,1),this.loudest.length<this.numLoudestToTrack)break}let a=0;for(;a<this.loudest.length&&!(this.loudest[a].energyScore<e.energyScore);)++a;return a<this.numLoudestToTrack&&(this.loudest.splice(a,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new EL(r,a,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new _L(this),this.decisionMaker.execute())}makeDecision(e){let t=null,n=null;const r=this.speakers.size;let i=null;if(0===r)i=null;else if(1===r){var s;const t=up(s=this.speakers).call(s).next().value;this.enableSilence&&t&&(i=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){const e=this.speakers.entries().next();e.value&&(i=e.value[0],t=e.value[1])}else i=t.id;null!=t&&t.evaluateSpeechActivityScores(e);const n=this.relativeSpeechActivities;let r=2;for(const s of this.speakers.entries()){const[a,o]=s;if(o===t)continue;o.evaluateSpeechActivityScores(e);for(let e=0;e<n.length;++e){const r=null==t?hL:t.getSpeechActivityScore(e);n[e]=Math.log(o.getSpeechActivityScore(e)/r)}const c=n[0],l=n[1],d=n[2];c>3&&l>2&&d>0&&l>r&&(r=l,i=a)}this.enableSilence&&null!=t&&i===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null)}null==i&&!this.enableSilence||i===this.dominantId||(t=this.dominantId,this.dominantId=i,n=this.dominantId),null==n&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){const e=Date.now(),t=300-(e-this.lastLevelIdleTime);let n=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&n>r&&(n=r),n}timeoutIdleLevels(e){const t=[];for(const r of up(n=this.speakers).call(n)){var n;const i=e-r.getLastLevelChangedTime();36e5<i&&(null==this.dominantId||r.id!==this.dominantId)?t.push(r.id):300<i&&r.levelTimedOut()}t.forEach(e=>this.speakers.delete(e))}}const xL=new Map;let wL=null,SL=null;const TL=3;let NL=[];const CL=new Map,AL=new Map;class RL{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){oP(this,"id",void 0),oP(this,"track",void 0),oP(this,"score",0),oP(this,"active",!0),oP(this,"muted",!1),oP(this,"timer",0),oP(this,"actives",0),oP(this,"inactives",0),this.id=e,this.track=t,this.setActive(CL.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:t,inactives:n}=function(){const e=[],t=[];return Array.from(up(CL).call(CL)).forEach(n=>{n.active?e.push(n):t.push(n)}),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach(t=>{(!e||e.score>t.score)&&(e=t)}),e&&e.setActive(!1)}if(t.length<3&&n.length>0){let t;n.forEach(e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)}),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(e){let t;return Array.from(up(CL).call(CL)).forEach(n=>{!n.active||n.id===e||n.samples<40||(!t||n.score<t.score)&&(t=n)}),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(e){let t;return Array.from(up(CL).call(CL)).forEach(n=>{n.active||n.id===e||n.samples<40||(!t||n.score>t.score)&&(t=n)}),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let IL;function OL(e){const t=CL.get(e);t&&(CL.delete(e),t.clearTimer())}const PL=new Map,kL=new Map,DL="video/h264",LL="video/h265";function jL(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&0===r[s]&&0===r[s+1]&&3===r[s+2]&&(0===r[s+3]||1===r[s+3]||2===r[s+3]||3===r[s+3])?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function ML(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function UL(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(0===e[i]&&0===e[i+1]&&1===e[i+2]){t=i;break}if(i<e.length-4&&0===e[i]&&0===e[i+1]&&0===e[i+2]&&1===e[i+3]){t=i;break}}if(-1===t)return"";const n=t+(0===e[t+2]?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&0==(248&e[n+1])?LL:(31&r)<=31?DL:""}const VL=new Map,FL=new Map;!function(){const e=qC();gO.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gO.getStreamFromExtension=e.name===HC.CHROME&&Number(e.version)>34,gO.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),gO.supportMinBitrate=e.name===HC.CHROME||e.name===HC.EDGE,gO.supportSetRtpSenderParameters=function(){const e=qC();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!xA()||!(!$C()&&!QC())||e.name===HC.FIREFOX&&Number(e.version)>=64)}(),e.name===HC.SAFARI&&(Number(e.version)>=14?gO.supportDualStream=!0:gO.supportDualStream=!1),gO.webAudioMediaStreamDest=function(){const e=qC();return!(e.name===HC.SAFARI&&Number(e.version)<12)}(),gO.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,gO.supportWebGL="undefined"!=typeof WebGLRenderingContext,gO.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,xA()||(gO.webAudioWithAEC=!0),gO.supportShareAudio=function(){const e=qC();return(e.os===GC.WIN_10||e.os===GC.WIN_81||e.os===GC.WIN_7||e.os===GC.LINUX||e.os===GC.MAC_OS||e.os===GC.CHROMIUM_OS)&&e.name===HC.CHROME&&Number(e.version)>=74}(),gO.supportDataChannel=!!(iA(76)||cA(68)||lA(14)),gO.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!nA()&&!!e&&e.prototype.setConfiguration instanceof Function}(),gO.supportWebRTCEncodedTransform=iA(87)||eA()||cA(117),gO.supportWebRTCInsertableStream=function(){const e=qC();return(e.name===HC.CHROME||e.name===HC.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gO.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gO.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,hR(()=>{gO.supportDualStreamEncoding=function(){const e=qC();return!!AI("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&AI("CHROME_DUAL_STREAM_USE_ENCODING"))}(),aO.debug("browser ua: ",navigator.userAgent),aO.info("browser info: ",e),aO.info("browser compatibility: ",gO)})}();const BL=["CHINA","GLOBAL"],GL=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],HL=[],WL=[];function zL(e,t){return!!t&&HL.some(n=>n.uid===e&&n.channelName===t)}function KL(){return WL.length>0}var qL=Cx.forEach,YL=Wr("forEach")?[].forEach:function(e){return qL(this,e,arguments.length>1?arguments[1]:void 0)};On({target:"Array",proto:!0,forced:[].forEach!==YL},{forEach:YL});var XL=er("Array","forEach"),JL=gr,QL=et,ZL=u,$L=XL,ej=Array.prototype,tj={DOMTokenList:!0,NodeList:!0},nj=function(e){var t=e.forEach;return e===ej||ZL(ej,e)&&t===ej.forEach||QL(tj,JL(e))?$L:t},rj=r(nj),ij=Qe,sj=hs;On({target:"Object",stat:!0,forced:i(function(){sj(1)})},{keys:function(e){return sj(ij(e))}});var aj=r(ee.Object.keys),oj=r(ri),cj=r(gi),lj=On,dj=ai,uj=Qc,hj=$,pj=Fn,mj=zn,fj=Q,gj=qf,vj=mt,yj=al,_j=Bb("slice"),Ej=vj("species"),bj=Array,xj=Math.max;lj({target:"Array",proto:!0,forced:!_j},{slice:function(e,t){var n,r,i,s=fj(this),a=mj(s),o=pj(e,a),c=pj(void 0===t?a:t,a);if(dj(s)&&(n=s.constructor,(uj(n)&&(n===bj||dj(n.prototype))||hj(n)&&null===(n=n[Ej]))&&(n=void 0),n===bj||void 0===n))return yj(s,o,c);for(r=new(void 0===n?bj:n)(xj(c-o,0)),i=0;o<c;o++,i++)o in s&&gj(r,i,s[o]);return r.length=i,r}});var wj=er("Array","slice"),Sj=u,Tj=wj,Nj=Array.prototype,Cj=function(e){var t=e.slice;return e===Nj||Sj(Nj,e)&&t===Nj.slice?Tj:t},Aj=r(Cj);function Rj(e,t,n,r,i){var s,a,o,c={};return rj(s=aj(r)).call(s,function(e){c[e]=r[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=oj(a=cj(o=Aj(n).call(n)).call(o)).call(a,function(n,r){return r(e,t,n)||n},c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer?(Rb(e,t,c),null):c}let Ij=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Oj=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Pj=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),kj=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Dj=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Lj=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),jj=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Mj=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Uj=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Vj=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Fj=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Bj=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Gj(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw aO.error("Invalid Channel Name ".concat(e)),new fO(AA.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Hj(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||MA(e,1,255)))throw new fO(AA.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&aO.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Wj=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const zj={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Kj={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qj(e,t){DA(e.url,"".concat(t,".url"),1,1e3,!1),jA(e.x)||PA(e.x,"".concat(t,".x"),0,1e4),jA(e.y)||PA(e.y,"".concat(t,".y"),0,1e4),jA(e.width)||PA(e.width,"".concat(t,".width"),0,1e4),jA(e.height)||PA(e.height,"".concat(t,".height"),0,1e4),jA(e.zOrder)||PA(e.zOrder,"".concat(t,".zOrder"),0,255),jA(e.alpha)||PA(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Yj={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Xj=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Jj=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Qj=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Zj(e){if(!e.channelName)throw new fO(AA.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new fO(AA.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&DA(e.token,"info.token",1,2047),Hj(e.uid),Gj(e.channelName),!0}let $j=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),eM=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),tM=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),nM=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),rM=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),iM=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),sM=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),aM=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),oM=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const cM=[oM.AFRICA,oM.ASIA,oM.CHINA,oM.EUROPE,oM.GLOBAL,oM.INDIA,oM.JAPAN,oM.NORTH_AMERICA,oM.OCEANIA,oM.OVERSEA,oM.SOUTH_AMERICA];let lM=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const dM={CHINA:{},ASIA:{CODE:lM.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:lM.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:lM.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:lM.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:lM.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:lM.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:lM.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:lM.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:lM.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:lM.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:lM.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:lM.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:lM.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};_I&&(dM.CHINA={CODE:lM.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let uM=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function hM(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class pM extends WA{constructor(e,t){super(),uT(this,"onICEConnectionStateChange",void 0),uT(this,"onConnectionStateChange",void 0),uT(this,"onDTLSTransportStateChange",void 0),uT(this,"onDTLSTransportError",void 0),uT(this,"onICETransportStateChange",void 0),uT(this,"onFirstAudioReceived",void 0),uT(this,"onFirstVideoReceived",void 0),uT(this,"onFirstAudioDecoded",void 0),uT(this,"onFirstVideoDecoded",void 0),uT(this,"onFirstVideoRender",void 0),uT(this,"onFirstVideoDecodedTimeout",void 0),uT(this,"onSelectedLocalCandidateChanged",void 0),uT(this,"onSelectedRemoteCandidateChanged",void 0),uT(this,"onICECandidateError",void 0),uT(this,"getLocalVideoStats",void 0)}}class mM extends pM{constructor(e,t){super(e,t),uT(this,"establishPromise",void 0)}}let fM=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),gM=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),vM=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const yM=["disconnected","failed"];let _M=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),EM=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),bM=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),xM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),wM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),SM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),TM=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),NM=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),CM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),AM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),RM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),IM=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),OM=function(e){return e.ABORT="abort",e}({}),PM=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),kM=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const DM={[Ij.ACCESS_POINT]:{[kj.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[kj.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[kj.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[kj.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[kj.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[kj.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ij.UNILBS]:{[Pj.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Pj.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Pj.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Pj.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Pj.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Pj.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Pj.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Pj.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Pj.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Pj.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Pj.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Pj.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ij.STRING_UID_ALLOCATOR]:{[Oj.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Oj.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Oj.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function LM(e){const t=DM[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Ij.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const jM={[Dj.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Dj.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Dj.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Dj.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Dj.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Dj.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Dj.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Dj.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Dj.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Dj.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Dj.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Dj.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Dj.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Dj.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Dj.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Dj.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Dj.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Dj.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Dj.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Dj.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Dj.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Dj.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Dj.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Dj.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Dj.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Dj.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Dj.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Dj.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Dj.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Dj.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Dj.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Dj.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Dj.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Dj.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Dj.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Dj.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Dj.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Dj.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Dj.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Dj.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Dj.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Dj.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dj.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dj.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Dj.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Dj.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Dj.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Dj.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Dj.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Dj.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Dj.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Dj.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Dj.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Dj.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Dj.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Dj.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Dj.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Dj.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Dj.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Dj.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Dj.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Dj.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Dj.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Dj.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function MM(e){return jM[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function UM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function VM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UM(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function FM(e,t){if("string"==typeof e)return e;const{proxy:n,host:r,port:i}=e;if(t){const e=AI("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const BM=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,GM=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,HM=/wss:\/\/(.+):([0-9]+)\/?/,WM=/wss:\/\/(.[^\/]+)\/?/;let zM=0;class KM{constructor(e,t){uT(this,"id",0),uT(this,"store",void 0),uT(this,"recordIndex",void 0),uT(this,"websockets",[]),uT(this,"try443PortDuration",2e3),uT(this,"forceCloseWSDuration",5e3),uT(this,"try443PortTimeout",null),uT(this,"forceCloseTimeout",null),uT(this,"isTry443PortFailed",!1),uT(this,"isNormalPortFailed",!1),uT(this,"useDoubleDomain",!1),uT(this,"useProxy",!1),uT(this,"startTime",Date.now()),this.id=++zM,this.try443PortDuration=AI("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];aO.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const r=AI("GATEWAY_DOMAINS"),i=Date.now(),s=[],a=r.find(t=>{var n;return Dr(n=e.host).call(n,t)});a||(this.useDoubleDomain=!1);const o=[];if(this.useDoubleDomain)r.forEach(n=>{o.push(FM(VM(VM({},e),{},{host:e.host.replace(a,n)}),t))});else{const n=VM({},e);if(t&&a){const e=r.find(e=>e!==a);e&&(n.host=n.host.replace(a,e))}o.push(FM(n,t))}try{o.forEach(e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",s.push(t),this.logger("ws is connecting:",t.url)})}catch(r){if(this.logger("ws create failed"),s.forEach(e=>e.close()),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new fO(AA.WS_ERR,"init websocket failed! Error: ".concat(r.toString()))}const c=UC();this.store&&this.store.recordJoinChannelService({urls:s.map(e=>e.url),service:"gateway"},this.recordIndex),s.forEach(e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach(t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))}),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState));const r=s.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(r)),r&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:sM.A_ROUND_WS_FAILED})):!t&&r&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),d()),t?this.isTry443PortFailed=r:this.isNormalPortFailed=r},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))}),this.websockets.push(...s);const l=()=>{this.websockets.forEach(e=>e.readyState!==WebSocket.OPEN&&e.close())},d=()=>{if(c.isResolved)return l();qC().os===GC.MAC_OS&&nA()&&l(),this.createWebSocket(e,!0,!0).then(e=>{c.resolve(e)}).catch(e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,l()},this.forceCloseWSDuration)};return n||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,l()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,d()},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(BM)||[],t||([,n,r]=e.match(GM)||[]),n&&r||([,n,r]=e.match(HM)||[]),n&&r||([,n]=e.match(WM)||[]),n||aO.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(aO.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally(()=>this.clearTimeout())}}function qM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}class YM extends WA{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Dr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Bj.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Bj.CONNECTED):"closed"===this._state?this.emit(Bj.CLOSED):"failed"===this._state&&this.emit(Bj.FAILED))}resetReconnectCount(e){aO.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;super(),uT(this,"_websocketUrl",null),uT(this,"connectionID",0),uT(this,"currentURLIndex",0),uT(this,"urls",[]),uT(this,"_reconnectMode","tryNext"),uT(this,"reconnectReason",void 0),uT(this,"_initMutex",void 0),uT(this,"name",void 0),uT(this,"_state","closed"),uT(this,"reconnectInterrupter",void 0),uT(this,"websocket",void 0),uT(this,"retryConfig",void 0),uT(this,"reconnectCount",0),uT(this,"forceCloseTimeout",5e3),uT(this,"onlineReconnectListener",void 0),uT(this,"useCompress",void 0),uT(this,"tryDoubleDomain",!1),uT(this,"use443PortOnly",!1),uT(this,"wsInflateLength",0),uT(this,"wsDeflateLength",0),uT(this,"closeEstablishingWs",()=>{}),uT(this,"store",void 0),uT(this,"joinGatewayRecordIndex",void 0),this.store=s,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qM(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i,this._initMutex=new UR("websocket",s?s.clientId:void 0);const{timeout:a,timeoutFactor:o}=t,c=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*o)/10);rR.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),lR.on(iR.NETWORK_STATE_CHANGE,(e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===rR.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=o))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{var r;const e=UC(),t=this.urls[this.currentURLIndex];null===(r=this.store)||void 0===r||r.beforeConnect(),function(e){return!(_O()||AI("USE_NEW_TOKEN")||!AI("ENABLE_PREALLOC_PC")&&(null==e||!e.autoSubscribe||AI("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(TM.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(Bj.CLOSED,()=>{e.reject(new RA(AA.WS_DISCONNECT))}),this.once(Bj.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout(()=>e.close(),500):e.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void aO.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),aO.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new RA(AA.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new RA(AA.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=UC();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),aO.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(aO.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new RA(AA.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=oR(this,Bj.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void aO.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new RA(AA.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},s=e=>{this.emit(Bj.ON_MESSAGE,e)},a=e=>{aO.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),AI("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=AI("GATEWAY_WSS_ADDRESS")),aO.debug("[".concat(this.name,"] start connect, url:"),e);const o=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;this._websocketUrl=FM(e);const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=s,this.websocket.onerror=a,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},o),this.joinGatewayRecordIndex=o}catch(e){const t="closed"===this.state,r=e instanceof RA,s=r&&e.code===AA.WS_ABORT,a=r&&e.code===AA.WS_ERR,c=r?e.message:e&&(e.reason||e.toString());aO.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:s?"aborted":"error",errors:[e]},o),t||a?(n.reject(t?new RA(AA.WS_DISCONNECT,"websocket is closed: ".concat(c)):new RA(AA.WS_ERR,"init websocket failed: ".concat(c))),a&&aO.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;aO.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||lR.isOnline||!lR.onlineWaiter||(this.onlineReconnectListener=lR.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=BR(this.reconnectCount,this.retryConfig);aO.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await np.race([SR(t),this.onlineReconnectListener||new np(()=>{})])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(Bj.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);aO.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(aO.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await sR(this,Bj.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(n){var i;aO.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const r=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&Dr(r).call(r,"dynamic key expired")?(this.emit(Bj.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class XM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=UC(),r=function(e,t){return new KM(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new RA(AA.WS_ABORT,"choose best websocket aborted"))};const i=AI("GATEWAY_DOMAINS");return aO.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class JM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new np((n,r)=>{let i=!1;const s=[];this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),s.forEach(e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()}),r(new RA(AA.WS_ABORT,"choose best websocket aborted"))};const a=AI("GATEWAY_DOMAINS");let o;const c=e.indexOf("?h="),l=a.find(t=>-1!==c?Dr(e).call(e,t,c):Dr(e).call(e,t));aO.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let d=!this.tryDoubleDomain||!l;if(!d&&l){var u;const h=Date.now();try{a.forEach(t=>{const n=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),r=new WebSocket(n);r.binaryType="arraybuffer",s.push(r),aO.debug("[choose-best-ws] ws is connecting:",r.url)})}catch(e){for(aO.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach(e=>e.close());s.length;)s.pop();d=!0}null===(u=this.store)||void 0===u||u.recordJoinChannelService({urls:s.map(e=>e.url),service:"gateway"},t),s.forEach(e=>{e.onopen=()=>{if(i)return;const t=Date.now()-h;aO.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),s.filter(t=>t!==e).forEach(e=>{aO.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()}),i=!0,n(e)},e.onclose=e=>{o=e,i||s.find(e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))||(aO.debug("[choose-best-ws] all websocket is closed"),i=!0,r(o))},e.onmessage=t=>{aO.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}}),SR(this.forceCloseTimeout).then(()=>{s.forEach(e=>{e.readyState!==WebSocket.OPEN&&e.close()})})}if(d){var h;let i;aO.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),s.push(i),i.binaryType="arraybuffer"}catch(e){const n=new RA(AA.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return aO.error("[".concat(this.name,"]").concat(n)),void r(n)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{aO.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},SR(this.forceCloseTimeout).then(()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()})}}).then(e=>(this.closeEstablishingWs=void 0,e)).catch(e=>{throw this.closeEstablishingWs=void 0,e})}}class QM extends WA{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Lj.CONNECTED?this.emit(jj.WS_CONNECTED):e===Lj.RECONNECTING?this.emit(jj.WS_RECONNECTING,this._websocketReconnectReason):e===Lj.CLOSED&&this.emit(jj.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uT(this,"_disconnectedReason",void 0),uT(this,"_websocketReconnectReason",void 0),uT(this,"_connectionState",Lj.CLOSED),uT(this,"reconnectToken",void 0),uT(this,"websocket",void 0),uT(this,"openConnectionTime",void 0),uT(this,"clientId",void 0),uT(this,"lastMsgTime",Date.now()),uT(this,"uploadCache",[]),uT(this,"uploadCacheInterval",void 0),uT(this,"rttRolling",new WR(5)),uT(this,"pingpongTimer",void 0),uT(this,"wsInflateDataTimer",void 0),uT(this,"pingpongTimeoutCount",0),uT(this,"ortc",void 0),uT(this,"joinResponse",void 0),uT(this,"multiIpOption",void 0),uT(this,"initError",void 0),uT(this,"spec",void 0),uT(this,"store",void 0),uT(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(jj.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===Vj.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===Vj.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QA.UID_BANNED);break;case 15:this.close(QA.IP_BANNED);break;case 16:this.close(QA.CHANNEL_BANNED)}if(t._type===Vj.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Dj.ERR_LICENSE_MISSING:this.close(QA.LICENSE_MISSING);break;case Dj.ERR_LICENSE_EXPIRED:this.close(QA.LICENSE_EXPIRED);break;case Dj.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QA.LICENSE_MINUTES_EXCEEDED);break;case Dj.ERR_LICENSE_PERIOD_INVALID:this.close(QA.LICENSE_PERIOD_INVALID);break;case Dj.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QA.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dj.ERR_LICENSE_ILLEGAL:this.close(QA.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,AI("JOIN_GATEWAY_USE_DUAL_DOMAIN"),AI("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lj.CONNECTED&&this.reconnect("retry",nR.OFFLINE)})}async request(e,t,n,r){const i=TR(6,""),s={_id:i,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new np((t,n)=>{if(this.connectionState===Lj.CONNECTED)return t();const r=()=>{this.off(jj.WS_CLOSED,i),t()},i=()=>{this.off(jj.WS_CONNECTED,r),n(new fO(AA.WS_ABORT))};this.once(jj.WS_CONNECTED,r),this.once(jj.WS_CLOSED,i),e!==Mj.PUBLISH&&e!==Mj.PUBLISH_DATASTREAM&&e!==Mj.SUBSCRIBE&&e!==Mj.SUBSCRIBE_DATASTREAM&&e!==Mj.UNSUBSCRIBE&&e!==Mj.UNSUBSCRIBE_DATASTREAM&&e!==Mj.UNPUBLISH&&e!==Mj.UNPUBLISH_DATASTREAM&&e!==Mj.CONTROL&&e!==Mj.RESTART_ICE||this.once(jj.DISCONNECT_P2P,()=>{n(new fO(AA.DISCONNECT_P2P))}),e!==Mj.PUBLISH&&e!==Mj.RESTART_ICE||this.once(jj.ABORT_P2P_EXECUTION,()=>{n(new fO(AA.DISCONNECT_P2P))})});if(this.connectionState!==Lj.CONNECTING&&this.connectionState!==Lj.RECONNECTING||e===Mj.JOIN||e===Mj.REJOIN||await o(),this.websocket.sendMessage(s,!0),r)return;const c=new np((n,r)=>{let s=!1;const o=(r,i)=>{s=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.emit(jj.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),o);const c=()=>{r(new fO(AA.WS_ABORT,"type: ".concat(e))),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.off("res-@".concat(i),o)};this.once(jj.WS_CLOSED,c),this.once(jj.WS_RECONNECTING,c),SR(AI("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||s||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(jj.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(r){if(this.connectionState===Lj.CLOSED||e===Mj.LEAVE)throw new fO(AA.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===Mj.JOIN||e===Mj.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new fO(AA.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===Dj.ERR_TOO_MANY_BROADCASTERS?e===Mj.JOIN||e===Mj.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===Dj.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nR.MULTI_IP)):this.reconnect(u.action,nR.SERVER_ERROR),e===Mj.JOIN||e===Mj.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np(n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Uj.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=AI("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lj.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},AI("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np((t,n)=>{this.once(jj.WS_CONNECTED,()=>t(this.joinResponse)),this.once(jj.WS_CLOSED,e=>n(this.initError||new fO(AA.WS_ABORT,e))),this.connectionState=Lj.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||QA.LEAVE,this.connectionState=Lj.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(jj.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await sR(this,jj.REQUEST_JOIN_INFO);this.store.joinReq();const t=await this.request(Mj.JOIN,e);if(this.ortc=null==e?void 0:e.ortc,this.store.joinRep(),!t)return this.emit(jj.REPORT_JOIN_GATEWAY,sM.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(jj.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lj.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new fO(AA.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=cR(this,jj.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(Mj.REJOIN,e);return!!t&&(this.connectionState=Lj.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(e=>{this.emit(Vj.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(Vj.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(Vj.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(Vj.MUTE_AUDIO,{uid:e.uid}):this.emit(Vj.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(Vj.MUTE_VIDEO,{uid:e.uid}):this.emit(Vj.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(Vj.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(Vj.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(Vj.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(Vj.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(Vj.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){if(!this.ortc)return!1;const t={downgrade_codec:e,ortc:this.ortc};return!!await this.request(Mj.DOWNGRADE_CODEC,t)}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if(28===e.code&&"detail"in e&&(aO.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(jj.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QA.UID_BANNED),void this.close()):void this.reconnect(t.action,nR.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=AI("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>AI("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nR.TIMEOUT):this.request(Mj.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),AI("REPORT_STATS")&&this.send(Mj.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(Uj.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Bj.RECONNECT_CREATE_CONNECTION,e=>{this.emit(jj.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Bj.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bj.CLOSED,()=>{this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.FAILED,()=>{this._disconnectedReason=QA.NETWORK_ERROR,this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Lj.CONNECTED?this.connectionState=Lj.RECONNECTING:this.connectionState=Lj.CONNECTING}),this.websocket.on(Bj.WILL_RECONNECT,(e,t,n)=>{const r=cR(this,jj.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(aO.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=sM.P2P_DISCONNECTED),i&&(aO.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(jj.REPORT_JOIN_GATEWAY,t||sM.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(jj.DISCONNECT_P2P)),n(e)}),this.websocket.on(Bj.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{aO.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",nR.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(jj.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof fO){if(e.code===AA.UNEXPECTED_RESPONSE&&e.data.code===Dj.ERR_NO_AUTHORIZED)return this.initError=new fO(AA.TOKEN_EXPIRE,"dynamic key expired"),void this.close(QA.TOKEN_EXPIRE);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nR.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Bj.REQUEST_NEW_URLS,(e,t)=>{sR(this,jj.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Bj.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Vj.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(TM.PRE_CONNECT_PC,()=>{this.emit(jj.PRE_CONNECT_PC)})}}let ZM=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),$M=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function eU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eU(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nU(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(AI("TURN_DOMAIN")):(aO.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function rU(e){try{const t=AI("GATEWAY_DOMAINS").concat(AI("TURN_DOMAIN")).find(t=>Dr(e).call(e,t));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch(t){return aO.debug("serverUrlToIp error, fallback to url",e),e}}function iU(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(AI("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map(e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}});const n=AI("GATEWAY_DOMAINS");let r=n[1]&&Dr(t).call(t,n[1])?1:0;return e.map(e=>{let{domain_prefix:t,port:i,ip:s}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};const a=/^[\.\:\d]+$/.test(s),o=a?"".concat(s.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(s,":").concat(i);return a||aO.debug("Cannot recognized as ip address: ".concat(s,", use as host3")),{ip:s,port:i,address:o}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){const e=r.split(";");for(let t=0;t<e.length;t++){var i;const r=P_(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}const s=e.detail&&e.detail.candidate;let a;if(s){const[e,t]=s.split(":");e&&t&&(a={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function sU(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function aU(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(sU(t.width),"x").concat(sU(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function oU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function cU(e,t){let n,r,i;switch(t){case $M.CHOOSE_SERVER:r=4096,i="choose server";break;case $M.CLOUD_PROXY:r=1048576,i="proxy";break;case $M.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case $M.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new fO(AA.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map(e=>tU(tU({},e),{},{ticket:t.buffer.cert})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:tU(tU({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})}),!n)throw new fO(AA.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function lU(e,t){return await np.all(e.addresses.map(async e=>({address:nU(e.ip),tcpport:e.port,udpport:e.port,username:t&&AI("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():bI.username,password:t&&AI("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await HA(t.toString()):bI.password})))}function dU(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(sU(e.height),sU(e.width)),1):(aO.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function uU(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:a}=e;const o={candidateType:t,relayProtocol:n,protocol:a};if("local-candidate"!==r){const e=i.split(".");e.length>=4&&(e[1]="*",e[2]="*"),o.address=e.join("."),o.port=s}return o}function hU(e){const t=e.split(":"),n=e.split(/[-.]/),r=Dr(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function pU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:AI("SVC_MODE");if(AI("ENABLE_SVC"))return function(e){return e in cI}(e)?e:cI.L1T3}const mU={[fM.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[fM.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function fU(e,t,n){t.forEach(t=>{var r;const i=mU[e].find(e=>{var n;let{key:r}=e;return Dr(n=t.extensionName).call(n,r)});if(!i)return;const s=n.find(e=>{let{extensionName:t}=e;return Dr(t).call(t,i.key)});s&&Dr(r=s.extensionName).call(r,"gdpr_forbidden")&&(t.extensionName=s.extensionName)})}function gU(e,t){t.forEach(t=>{var n;const r=mU[e].find(e=>{var n;let{key:r}=e;return Dr(n=t.extensionName).call(n,r)});Dr(n=t.extensionName).call(n,"gdpr_forbidden")&&r&&(t.extensionName=r.extensionName)})}function vU(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Dr(e).call(e,"abs-send-time")}function yU(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Dr(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function _U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function EU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_U(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_U(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function bU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:a,filterAudioCodec:o,filterVideoCodec:c,unsupportedVideoUplinkCodec:l,unsupportedVideoDownlinkCodec:d}=t,{useXR:u}=n;let h=[],p=[],m=[],f=[],g=!1,v=!1;if(VI(e).mediaDescriptions.forEach(e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||g||(p=e.attributes.payloads,f=e.attributes.extmaps,g=!0),"audio"!==e.media.mediaType||v||(h=e.attributes.payloads,m=e.attributes.extmaps,v=!0))}),!f||0===p.length)throw new Error("Cannot get video capabilities from SDP.");if(!m||0===h.length)throw new Error("Cannot get audio capabilities from SDP.");if(p.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),h.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),i&&(h=h.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}),p=p.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),s){const e=p.filter(e=>{var t;return/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}),t=VU(e,p).map(e=>e.payloadType),n=[...e.map(e=>e.payloadType),...t];p=p.filter(e=>!Dr(n).call(n,e.payloadType))}if(a&&(h=h.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),o&&(null==o?void 0:o.length)>0&&(h=h.filter(e=>{var t;return Dr(o).call(o,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})),c&&(null==c?void 0:c.length)>0){const e=p.filter(e=>{var t;return Dr(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")});p=e.concat(i?[]:VU(e,p))}const y=AI("UNSUPPORTED_VIDEO_CODEC");if(y&&y.length>0){const e=p.filter(e=>e.rtpMap&&Dr(y).call(y,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Dr(n).call(n,e.payloadType)),aO.debug("unsupportedVideoCodec: ".concat(y,", toBeRemoved: ").concat(n))}if(l&&l.length>0&&"sendonly"===r){const e=p.filter(e=>e.rtpMap&&Dr(l).call(l,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Dr(n).call(n,e.payloadType)),aO.debug("unsupportedVideoUplinkCodec: ".concat(l,", toBeRemoved: ").concat(n))}if(d&&d.length>0&&"recvonly"===r){const e=p.filter(e=>e.rtpMap&&Dr(d).call(d,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Dr(n).call(n,e.payloadType)),aO.debug("unsupportedVideoDownlinkCodec: ".concat(d,", toBeRemoved: ").concat(n))}return{audioCodecs:h,videoCodecs:p,audioExtensions:m,videoExtensions:f}}function xU(e){const t=VI(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const e=i.attributes.iceUfrag,t=i.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!r){const e=i.attributes.fingerprints;e.length>0&&(r={fingerprints:e})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function wU(e,t){const n=[],r=e.attributes.ssrcGroups.filter(e=>"FID"===e.semantic),i=e.attributes.ssrcGroups.find(e=>"SIM"===e.semantic),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(e=>{var i;const s=null===(i=r.find(t=>t.ssrcIds[0]===e))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?s:void 0})});else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===s.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function SU(e,t,n){const{cname:r}=e;let i=[];t&&(i=TU(t)),0===i.length&&(i=e.iceParameters.candidates.map(e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})),aO.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let o;switch(e.dtlsParameters.role){case"server":o="passive";break;case"client":o="active";break;case"auto":o="actpass"}const c=jU(e.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach(e=>{l.push({kind:fM.VIDEO,ssrcMsg:[{ssrcId:e.v,rtx:e.v_rtx}],mslabel:"".concat(e.v,"_").concat(e.a)},{kind:fM.AUDIO,ssrcMsg:[{ssrcId:e.a}],mslabel:"".concat(e.v,"_").concat(e.a)})}),{dtlsParameters:s,iceParameters:a,candidates:i,rtpCapabilities:c,setup:o,cname:r,preSSRCs:l}}function TU(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],aO.debug("Using remote candidate from AP ".concat(hU(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),aO.debug("Using IPV6 remote candidate from AP ".concat(hU(e.ip6),":").concat(e.port)))),t}function NU(e,t,n){const r=[],i=[];return e.forEach(e=>{let{ssrcId:s,rtx:a}=e;const o=TR(8,"track-"),c={ssrcId:s,attributes:EU({label:o,mslabel:n=n||TR(10,""),msid:"".concat(n," ").concat(o)},t&&{cname:t})};if(r.push(c),void 0!==a){const e={ssrcId:a,attributes:EU({label:o,mslabel:n,msid:"".concat(n," ").concat(o)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[s,a]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(e=>{let{ssrcId:t}=e;return t})}),{ssrcs:r,ssrcGroups:i}}function CU(e,t){t instanceof Fk&&e.attributes.payloads.forEach(e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),"opus"===r&&"number"==typeof AI("OPUS_PTIME")?e.fmtp.parameters.ptime=AI("OPUS_PTIME"):e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&("pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!nA()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1")),t instanceof Bk&&"opus"===r&&t._config.DTX&&(e.fmtp.parameters.usedtx="1"))})}function AU(e){const t=e.attributes.unrecognized.findIndex(e=>"x-google-flag"===e.attField&&"conference"===e.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}function RU(e,t){var n;if(!(t instanceof DD&&t._encoderConfig&&-1===t._hints.indexOf(UO.SCREEN_TRACK)))return;const r=t._encoderConfig;vO().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(e=>{var t,n;Dr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),vO().supportMinBitrate&&!Dr(n=t._hints).call(n,UO.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(e=>{var t,n;Dr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(AI("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function IU(e){if("video"!==e.media.mediaType)return;const t=qC();if(t.name!==HC.SAFARI&&t.os!==GC.IOS)return;const n=e.attributes.extmaps.findIndex(e=>/video-orientation/g.test(e.extensionName));-1!==n&&e.attributes.extmaps.splice(n,1)}function OU(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find(e=>yU(e.extensionName));if(t){const n=t.extensionName;e.attributes.extmaps.find(e=>yU(e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)))}(i,e.attributes.payloads);r.forEach(e=>{e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)||e.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex(e=>yU(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}if(!0===t.remb){const t=r.find(e=>vU(e.extensionName));if(t){const n=t.extensionName;e.attributes.extmaps.find(e=>e.extensionName===n)||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)))}(i,e.attributes.payloads);r.forEach(e=>{e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)||e.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex(e=>vU(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"goog-remb"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}}function PU(e,t,n){if(nA())return;if("video"!==e.media.mediaType)return;if(!(t instanceof DD))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!AI("SIMULCAST"))return;if("vp9"===n&&AI("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let o=1;o<r;o++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+o,attributes:pR(i.attributes)}),a.ssrcIds.push(i.ssrcId+o),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+o,attributes:pR(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+o,s.ssrcIds[1]+o]}));e.attributes.ssrcGroups.unshift(a)}async function kU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=bU(n,e,t,"sendonly"),i=bU(n,e,t,"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(LU(r,i,"videoExtensions",s,a,o),LU(r,i,"videoCodecs",s,a,o),LU(r,i,"audioExtensions",s,a,o),LU(r,i,"audioCodecs",s,a,o),AI("RAISE_H264_BASELINE_PRIORITY")){const e=[],t=[];if(o.videoCodecs.forEach((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){var s,a;const i=o.videoCodecs[r+1],c=i&&WU(n,i),l=null===(s=n.fmtp)||void 0===s?void 0:s.parameters["profile-level-id"],d=null===(a=n.fmtp)||void 0===a?void 0:a.parameters["packetization-mode"];!l||l!==AI("FIRST_H264_PROFILE_LEVEL_ID")||AI("FIRST_PACKETIZATION_MODE")&&d!==AI("FIRST_PACKETIZATION_MODE")?c?t.push([n,i]):t.push([n]):c?e.push([n,i]):e.push([n])}}),e.length>0&&t.length>0){aO.debug("raising H264 baseline profile priority"),o.videoCodecs.forEach((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){const i=WU(n,o.videoCodecs[r+1]),s=e.shift()||t.shift()||[];s.length>0&&(i?o.videoCodecs.splice(r,2,...s):o.videoCodecs.splice(r,1,...s))}});const n=a.videoCodecs.filter(e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==AI("FIRST_H264_PROFILE_LEVEL_ID")});if(n.length>0){const e=VU(n,a.videoCodecs).map(e=>e.payloadType),t=[...n.map(e=>e.payloadType),...e];a.videoCodecs=a.videoCodecs.filter(e=>!Dr(t).call(t,e.payloadType))}AI("FILTER_SEND_H264_BASELINE")&&(s.videoCodecs=s.videoCodecs.filter(e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==AI("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:s,recv:a,sendrecv:o}}return{send:s,recv:a,sendrecv:o}}(e,t,r);try{n.close()}catch(e){}return{send:i,recv:s,sendrecv:a}}function DU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(LU(e,t,"videoExtensions",n,r,i),LU(e,t,"videoCodecs",n,r,i),LU(e,t,"audioExtensions",n,r,i),LU(e,t,"audioCodecs",n,r,i),AI("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:r,sendrecv:i}}function LU(e,t,n,r,i,s){if("videoExtensions"===n||"audioExtensions"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0})?s[n].push(e):r[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)})}if("videoCodecs"===n||"audioCodecs"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(n),!0})?s[n].push(e):r[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)})}}function jU(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function MU(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function UU(e,t,n,r){let i=[];if(e===fM.VIDEO){if(AI("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter(e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===AI("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||0===i.length){let e=[];const s=[],a=[],o=[];if(n.videoCodecs.forEach(t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Dr(n).call(n,r)?e.push(t):Dr(n).call(n,"vp9")?s.push(t):Dr(n).call(n,"vp8")?a.push(t):Dr(n).call(n,"h264")&&o.push(t)}),0===e.length){let t="";0!==s.length?(e=s,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==o.length&&(e=o,t="h264"),aO.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter(t=>e.some(e=>e.payloadType===t.payloadType)))}if(0===i.length&&(aO.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),AI("USE_PUB_RTX")||AI("USE_SUB_RTX")){const e=VU(i,t.videoCodecs);i=[...i,...e]}}else{i=t.audioCodecs.filter(e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)});const e=t.audioCodecs.filter(e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"red")});0===i.length&&(aO.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})),AI("ENABLE_AUDIO_RED")&&0!==e.length&&(i=[...e,...i])}return i}function VU(e,t){const n=e.map(e=>e.payloadType.toString());return t.filter(e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Dr(n).call(n,e.fmtp&&e.fmtp.parameters.apt))}async function FU(e,t,n){const r=t.toString(),i=GU(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let a=s.sdp;a=BU(a,n||{}),null==i||i(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function BU(e,t,n){const r=VI(e),{useXR:i}=t;return r.mediaDescriptions.forEach(e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!Dr(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&MU(e),i&&Dr(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach(e=>{-1===e.rtcpFeedbacks.findIndex(e=>"rrtr"===e.type)&&e.rtcpFeedbacks.push({type:"rrtr"})})))}),FI(r)}function GU(e,t,n,r){if(AI("SDP_LOGGING"))return aO.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{GU(e,"answer","local"===n?"remote":"local",r)}:void 0}function HU(e){const t=AI("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(t=>Dr(e).call(e,t))}function WU(e,t){try{var n;return(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function zU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function KU(e,t){return typeof AI(e)===t?AI(e):void 0}function qU(){try{const e=AI("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zU(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e)}catch(e){return aO.debug("handle gateway attributes failed: ",e),{}}}const YU={};function XU(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&aO.debug("install service ".concat(e.name)),YU[e.name]=e}function JU(e){const t=YU[e];if(!t)throw new RA(AA.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function QU(e,t){return JU("DataStream").create(e,t)}function ZU(){return JU("InterceptFrame").create()}function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$U(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const tV=new Map;class nV extends WA{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(iM.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(iM.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){aO.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var n,r,i;super(),uT(this,"store",void 0),uT(this,"joinInfo",void 0),uT(this,"key",void 0),uT(this,"ntpOffset",0),uT(this,"signal",void 0),uT(this,"role",void 0),uT(this,"isPreallocation",void 0),uT(this,"isPreSub",void 0),uT(this,"inChannelInfo",{joinAt:null,duration:0}),uT(this,"spec",void 0),uT(this,"_state","DISCONNECTED"),uT(this,"_statsCollector",void 0),uT(this,"_disconnectedReason",void 0),uT(this,"isSignalRecover",!1),uT(this,"hasChangeBGPAddress",!1),uT(this,"trafficStatsInterval",void 0),uT(this,"networkQualityInterval",void 0),uT(this,"_joinGatewayStartTime",0),uT(this,"_signalTimeout",!1),uT(this,"_clientRoleOptions",void 0),uT(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(n={spec:eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(r=(i=JU("P2PChannel")).createSubmodule)||void 0===r?void 0:r.call(i,n)):new QM(eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=tV.get(e.cname);if(i||(i=new Map,tV.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new fO(AA.UID_CONFLICT);throw mO.joinGateway(e.sid,{lts:r,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let s=0;this.joinGatewayStartTime=r;const a=e.proxyServer;try{aO.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s));const t=e.gatewayAddrs.map(t=>{let{address:n}=t;const[r,i]=n.split(":"),s={host:r,port:i};return e.proxyServer&&(s.proxy=e.proxyServer),s});s=(await this.signal.init(t)).uid,aO.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var o;throw aO.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),mO.joinGateway(e.sid,{lts:r,succ:!1,ec:(null===(o=t.data)||void 0===o?void 0:o.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!a,signalChannel:"0",preload:e.preload}),i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),aO.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{aO.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(iM.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(iM.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(iM.NETWORK_QUALITY,{uplinkNetworkQuality:oU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:oU(this._statsCollector.trafficStats.B_dnq)}):this.emit(iM.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),s}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==QA.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Lj.CONNECTED||await function(e,t){return t===1/0?e:np.race([e,wR(t)])}(this.signal.request(Mj.LEAVE,void 0,!0),3e3)}catch(e){aO.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==QA.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:AI("PUB_EXTEND"),twcc:!!AI("PUBLISH_TWCC"),rtx:!!AI("USE_PUB_RTX")};try{return(await this.signal.request(Mj.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Dj.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(Mj.PUBLISH_DATASTREAM,i,!0)}catch(r){if(n&&r.data&&r.data.code===Dj.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),r.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Mj.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map(e=>this.signal.request(Mj.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){aO.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!AI("SUBSCRIBE_TWCC"),rtx:!!AI("USE_SUB_RTX")||void 0,extend:AI("SUB_EXTEND"),svc:Array.isArray(AI("SVC"))&&0!==AI("SVC").length?AI("SVC"):void 0};try{return await this.signal.request(Mj.PRE_SUBSCRIBE,r,!0)}catch(r){if(n&&r.data&&r.data.code===Dj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),r.toString()),this.presubscribe(e,t,!1);throw r}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!AI("SUBSCRIBE_TWCC"),rtx:!!AI("USE_SUB_RTX"),extend:AI("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(AI("SVC"))&&0!==AI("SVC").length?AI("SVC"):void 0};try{return(await this.signal.request(Mj.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Dj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(Mj.SUBSCRIBE_DATASTREAM,r,!0)}catch(r){if(n&&r.data&&r.data.code===Dj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!AI("USE_SUB_RTX"),twcc:!!AI("SUBSCRIBE_TWCC"),svc:Array.isArray(AI("SVC"))&&0!==AI("SVC").length?AI("SVC"):void 0};try{return await this.signal.request(Mj.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===Dj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(Mj.SET_VIDEO_PROFILE,t);aO.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(Mj.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(AA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map(e=>this.signal.request(Mj.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0)))}catch(e){aO.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(Mj.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Mj.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Mj.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Mj.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),AI("CLIENT_ROLE_OPTIONS")&&(aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(AI("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},AI("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),AI("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},AI("CLIENT_ROLE_OPTIONS")),aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(AI("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0;const i=Object.assign({},t);delete i.delay,delete i.level,await this.signal.request(Mj.SET_CLIENT_ROLE,eV(eV({role:e,level:r,delay:n},i),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(Mj.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Mj.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(Mj.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(Mj.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Mj.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),eV({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Mj.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=tV.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:bI.username,password:bI.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(eV(eV({},bI),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(Mj.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(t=>t.peer_uid===e.peer_uid);t&&t.B_st!==e.B_st&&hR(()=>{this.emit(iM.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t,n;if(!this.joinInfo||!this.key)throw new fO(AA.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let i=AI("REPORT_APP_SCENARIO");if("string"!=typeof i)try{i=JSON.stringify(i)}catch(e){i=void 0}var s;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(iM.UPDATE_GATEWAY_CONFIG),s=this.store.clientId,Dr(WL).call(WL,s)||WL.push(s);const a=EO(this.store),o=!(null===(t=this.isPreallocation)||void 0===t||!t.call(this)),c=bO(this.store),l=qU(),d=iA(87)||eA()||cA(117),u=(function(){const e=qC();if(e.name!==HC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>18||18===Number(t[0])&&Number(t[1])>=4}()||dA(18,4,!1))&&hA(18,6,!0)&&"h264"===this.spec.codec&&AI("ENABLE_ABSSENDTIME_AS_SENTTS"),h=eV({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:yI,browser:navigator.userAgent,process_id:AI("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:AI("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:eV(eV({enableEncodedTransform:(!!AI("ENABLE_AUDIO_METADATA")||!!AI("ENABLE_AUDIO_PTS"))&&d||!!AI("ENABLE_AUDIO_TOPN")&&aA(HC.CHROME,87,116)||void 0,enableAudioMetadata:!!AI("ENABLE_AUDIO_METADATA")&&d,enableAudioPts:!!AI("ENABLE_AUDIO_PTS")&&d,topnSmoothLevel:AI("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:AI("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:AI("TOPN_SWITCH_HOLD_MS"),topnAudioGain:AI("TOPN_AUDIO_GAIN"),enablePublishedUserList:AI("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:AI("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:KU("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:KU("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:KU("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===AI("USE_PUB_RTX")||!0===AI("USE_SUB_RTX")||void 0,disableFEC:AI("DISABLE_FEC"),enableNTPReport:!!AI("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:c,enableFulllinkAvSync:!!AI("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:KU("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!AI("FORCE_ENABLE_AUT_CC")||!_O()&&(!!AI("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!AI("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:KU("USE_XR","boolean"),enableLossbasedBwe:KU("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!AI("FORCE_ENABLE_AUT_CC")||!_O()&&(!!AI("ENABLE_AUT_CC")||void 0),enableCCFallback:KU("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:a?KU("PRE_SUB_NUM","number"):void 0,enablePubTWCC:KU("PUBLISH_TWCC","boolean"),enableSubTWCC:KU("SUBSCRIBE_TWCC","boolean"),enablePubRTX:KU("USE_PUB_RTX","boolean"),enableSubRTX:KU("USE_SUB_RTX","boolean"),enableSubSVC:AI("ENABLE_SVC")?AI("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(AI("SVC"))&&0!==AI("SVC").length?AI("SVC"):void 0,enableSvcExtended:AI("ENABLE_SVC")&&Array.isArray(AI("SVC_EXTENDED"))&&0!==AI("SVC_EXTENDED").length?AI("SVC_EXTENDED"):void 0},l),{},{audioDuplicate:KU("ENABLE_AUDIO_RED","boolean")?null!==(n=KU("AUDIO_DUPLICATE_NUM","number"))&&void 0!==n?n:2:void 0,senttsUsesAbsSendTime:!!u||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,AI("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new fO(AA.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(jj.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(jj.WS_RECONNECTING,e=>{this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||nR.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",mO.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(jj.WS_CLOSED,e=>{let t;switch(e){case QA.LEAVE:t=nR.LEAVE;break;case QA.UID_BANNED:case QA.IP_BANNED:case QA.CHANNEL_BANNED:case QA.SERVER_ERROR:t=nR.SERVER_ERROR;break;case QA.FALLBACK:t=nR.FALLBACK;break;case QA.LICENSE_MISSING:case QA.LICENSE_EXPIRED:case QA.LICENSE_MINUTES_EXCEEDED:case QA.LICENSE_PERIOD_INVALID:case QA.LICENSE_MULTIPLE_SDK_SERVICE:case QA.LICENSE_ILLEGAL:case QA.TOKEN_EXPIRE:t=e;break;default:t=nR.NETWORK_ERROR}aO.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+nR.NETWORK_ERROR)),this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===QA.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==QA.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(jj.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){const e=AI("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(aO.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void aO.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));CI("EVENT_REPORT_DOMAIN",e[1]),CI("EVENT_REPORT_BACKUP_DOMAIN",e[1]),CI("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(Vj.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(jj.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new fO(AA.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,sR(this,iM.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(jj.REQUEST_JOIN_INFO,async(e,t,n)=>{var r,i,s;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const a=pR(null===(r=this.joinInfo)||void 0===r?void 0:r.turnServer);if(AI("NEW_TURN_MODE")&&a&&"disabled"===(null===(i=this.joinInfo)||void 0===i?void 0:i.cloudProxyServer)){var o;let e=a.servers.map(e=>"turnServerURL"in e&&AI("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:rU(e.turnServerURL)}):e),t=null===(o=a.serversFromGateway)||void 0===o?void 0:o.map(e=>AI("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:rU(e.turnServerURL)}):e);const n=this.signal.currentURLIndex;e.length>0&&(e=[e[n%e.length]],a.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],a.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(n))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await sR(this,iM.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:a,cloudProxyServer:null===(s=this.joinInfo)||void 0===s?void 0:s.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(e){t(e)}}),this.signal.on(jj.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(jj.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let n,r="";var i;e instanceof fO?(n=(null===(i=e.data)||void 0===i?void 0:i.desc)||e.code,r=e.message):n=e,mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(jj.IS_P2P_DISCONNECTED,e=>{e(cR(this,iM.IS_P2P_DISCONNECTED))}),this.signal.on(jj.DISCONNECT_P2P,()=>{this.emit(iM.DISCONNECT_P2P)}),this.signal.on(jj.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(jj.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(jj.JOIN_RESPONSE,e=>{const t=this.getCurrentGatewayAddress();this.emit(iM.JOIN_RESPONSE,e,t)}),this.signal.on(jj.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,t;this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),i=pR(null===(e=this.joinInfo)||void 0===e?void 0:e.turnServer);if(AI("NEW_TURN_MODE")&&i&&"disabled"===(null===(t=this.joinInfo)||void 0===t?void 0:t.cloudProxyServer)){var n;let e=i.servers.map(e=>"turnServerURL"in e&&AI("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:rU(e.turnServerURL)}):e),t=null===(n=i.serversFromGateway)||void 0===n?void 0:n.map(e=>AI("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:rU(e.turnServerURL)}):e);const r=this.signal.currentURLIndex;e.length>0&&(e=[e[r%e.length]],i.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],i.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(r,",in pre pc"))}const s=AI("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const e=TU(r);this.emit(iM.PRE_CONNECT_PC,{candidates:e,fingerprint:s,turnServer:i})}}}),this.signal.on(jj.RECOVER_NOTIFICATION,e=>{this.joinInfo&&"string"==typeof AI("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(AI("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(Mj.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(Mj.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw aO.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(Mj.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(Mj.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw aO.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map(e=>({stream_id:e.stream_id,stream_type:e.stream_type}))};try{await this.signal.request(Mj.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find(e=>e.stream_type===rM.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find(e=>e.stream_type===rM.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===fM.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===fM.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Mj.RESTART_ICE,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||nR.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!AI("GATEWAY_WSS_ADDRESS"))return AI("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(aO.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Mj.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let rV=0,iV=0;function sV(e,t,n,r){return new np((i,s)=>{t.timeout=t.timeout||AI("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),rV+=bR(t.data)):n&&(t.data.size?rV+=t.data.size:t.data instanceof FormData?rV+=xR(t.data):rV+=bR(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,jC.request(t).then(e=>{"string"==typeof e.data?iV+=bR(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?iV+=e.data.byteLength:iV+=bR(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)}).catch(e=>{jC.isCancel(e)?s(new fO(AA.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?s(new fO(AA.NETWORK_TIMEOUT,e.message)):e.response?s(new fO(AA.NETWORK_RESPONSE_ERROR,e.response.status)):s(new fO(AA.NETWORK_ERROR,e.message))})})}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},s=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=s;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in n))break e;n=n[a]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(a("Symbol",function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}}),a("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var a=s[t[r]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&i(a.prototype,e,{configurable:!0,writable:!0,value:function(){return o(n(this))}})}return e}),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var l;e:{var d={};try{d.__proto__={a:!0},l=d.a;break e}catch(e){}l=!1}r=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var u=r;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function m(e,t){return e.h=3,{value:t}}function f(e){this.g=new h,this.G=e}function g(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var s=i.value}catch(t){return e.g.j=null,e.g.s(t),v(e)}return e.g.j=null,r.call(e.g,s),v(e)}function v(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function y(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),v(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function _(e,t){return t=new y(new f(t)),u&&e.prototype&&u(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return p(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),v(this))},f.prototype.s=function(e){return p(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),v(this))},a("Array.prototype.entries",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return[e,t]})}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var E=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},b=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},x=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},w=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},S="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,T=S.FormData,N=S.XMLHttpRequest&&S.XMLHttpRequest.prototype.send,C=S.Request&&S.fetch,A=S.navigator&&S.navigator.sendBeacon,R=S.Element&&S.Element.prototype,I=S.Symbol&&Symbol.toStringTag;I&&(Blob.prototype[I]||(Blob.prototype[I]="Blob"),"File"in S&&!File.prototype[I]&&(File.prototype[I]="File"));try{new File([],"")}catch(e){S.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),I&&Object.defineProperty(e,I,{value:"File"}),e}}var O=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},P=function(e){this.i=[];var t=this;e&&E(e.elements,function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];E(n,function(n){t.append(e.name,n)})}else"select-multiple"===e.type||"select-one"===e.type?E(e.options,function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)}):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?b(e.value):e.value,t.append(e.name,n))})};if((e=P.prototype).append=function(e,t,n){w(arguments,2),this.i.push(x(e,t,n))},e.delete=function(e){w(arguments,1);var t=[];e=String(e),E(this.i,function(n){n[0]!==e&&t.push(n)}),this.i=t},e.entries=function e(){var t,n=this;return _(e,function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=m(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2})},e.forEach=function(e,t){w(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){w(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){w(arguments,1);var t=[];return e=String(e),E(this.i,function(n){n[0]===e&&t.push(n[1])}),t},e.has=function(e){w(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return _(e,function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,m(e,c(r).next().value));n=t.next(),e.h=2})},e.set=function(e,t,n){w(arguments,2),e=String(e);var r=[],i=x(e,t,n),s=!0;E(this.i,function(t){t[0]===e?s&&(s=!r.push(i)):r.push(t)}),s&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,s=this;return _(e,function(e){if(1==e.h&&(t=c(s),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=c(r)).next(),m(e,i.next().value));n=t.next(),e.h=2})},P.prototype._asNative=function(){for(var e=new T,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},P.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(e,r){return"string"==typeof e?t.push(n+O(b(r))+'"\r\n\r\n'+b(e)+"\r\n"):t.push(n+O(b(r))+'"; filename="'+O(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")}),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},P.prototype[Symbol.iterator]=function(){return this.entries()},P.prototype.toString=function(){return"[object FormData]"},R&&!R.matches&&(R.matches=R.matchesSelector||R.mozMatchesSelector||R.msMatchesSelector||R.oMatchesSelector||R.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),I&&(P.prototype[I]="FormData"),N){var k=S.XMLHttpRequest.prototype.setRequestHeader;S.XMLHttpRequest.prototype.setRequestHeader=function(e,t){k.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},S.XMLHttpRequest.prototype.send=function(e){e instanceof P?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),N.call(this,e)):N.call(this,e)}}C&&(S.fetch=function(e,t){return t&&t.body&&t.body instanceof P&&(t.body=t.body._blob()),C.call(this,e,t)}),A&&(S.navigator.sendBeacon=function(e,t){return t instanceof P&&(t=t._asNative()),A.call(this,e,t)}),S.FormData=P}}();const aV=()=>{const e=AI("AREAS");return 0===e.length&&e.push(oM.GLOBAL),ii(e).call(e,(e,t,n)=>{const r=oV(t);return r?0===n?r:"".concat(e,",").concat(r):e},"")},oV=e=>e===oM.OVERSEA?"".concat(lM.ASIA,",").concat(lM.EUROPE,",").concat(lM.AFRICA,",").concat(lM.NORTH_AMERICA,",").concat(lM.SOUTH_AMERICA,",").concat(lM.OCEANIA):lM[e],cV=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(e=>{const n=dM[e],r=Object.keys(n);r&&r.map(e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))})}),t},lV={GLOBAL:{ASIA:[oM.CHINA,oM.JAPAN,oM.INDIA,oM.KOREA,oM.HKMC],EUROPE:[],NORTH_AMERICA:[oM.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dV=Object.keys(lV[oM.GLOBAL]),uV=[oM.CHINA,oM.NORTH_AMERICA,oM.EUROPE,oM.ASIA,oM.JAPAN,oM.INDIA,oM.OCEANIA,oM.SOUTH_AMERICA,oM.AFRICA,oM.KOREA,oM.HKMC,oM.US],hV=function(e,t){let n=[];if(Dr(e).call(e,oM.GLOBAL)){const s=[oM.GLOBAL,oM.OVERSEA],a=Object.keys(dM);if(t===oM.GLOBAL)throw new fO(AA.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===oM.CHINA)n=[oM.OVERSEA];else if(i=t,Dr(dV).call(dV,i)){const e=(r=t,lV[oM.GLOBAL][r]||[]),i=[...s,t,...e];n=a.filter(e=>!Dr(i).call(i,e))}else if(function(e){let t=!1;return dV.forEach(n=>{var r;Dr(r=lV[oM.GLOBAL][n]).call(r,e)&&(t=!0)}),t}(t)){const e=function(e){let t;return dV.forEach(n=>{var r;Dr(r=lV[oM.GLOBAL][n]).call(r,e)&&(t=n)}),t}(t),r=[...s,e,t];n=a.filter(e=>!Dr(r).call(r,e))}else n=e;n=function(e){const t=[];return uV.forEach(n=>{Dr(e).call(e,n)&&t.push(n)}),t.concat(e.filter(e=>!Dr(uV).call(uV,e)))}(n)}else n=e;var r,i;return n};function pV(e){var t,n;if(!e&&Dr(t=AI("AREAS")).call(t,oM.EXTENSIONS))return aO.debug("update area from ap : reset"),void mV(BL,!0);if(!Dr(n=AI("AREAS")).call(n,oM.GLOBAL)||!e)return;let r=dM.EXTENSIONS;r&&(r={CODE:oV(oM.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},aO.debug("update area from ap success: ".concat(e,",config is "),r),CI("AREAS",[oM.EXTENSIONS],!0),Object.keys(r).map(e=>{CI(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])}))}function mV(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=mO.reportApiInvoke(null,{name:qA.SET_AREA,options:e,tag:YA.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach(e=>{if(!Dr(cM).call(cM,e))throw new fO(AA.INVALID_PARAMS,"invalid area code")}),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new fO(AA.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?hV(i,n):i}if(!t){if(II.AREAS){const e=new fO(AA.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void aO.warning("setArea is prohibited because of config-distribute")}if(Dr(r).call(r,oM.GLOBAL)&&AI("AREAS")===oM.EXTENSIONS){const e=new fO(AA.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void aO.warning("setArea is prohibited because of ap extensions")}}CI("AREAS",r,t);const i=cV(r);Object.keys(i).map(e=>{CI(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])}),aO.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function fV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function gV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fV(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let vV=1;function yV(e,t,n,r,i){vV+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:vV,requestId:vV,version:yI,cname:n.cname},a={service_name:t,json_body:JSON.stringify(s)};let o,c,l=e[0];return GR(async()=>{o=Date.now();const e=await sV(l,{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-o,0!==e.code){const t=new fO(AA.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw aO.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new fO(AA.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw aO.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new fO(AA.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw aO.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(AI("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))),workerToken:e.workerToken,vid:e.vid}}(n,t);return AI("LIVE_STREAMING_ADDRESS")&&(i.addressList=AI("LIVE_STREAMING_ADDRESS")instanceof Array?AI("LIVE_STREAMING_ADDRESS"):[AI("LIVE_STREAMING_ADDRESS")]),gV(gV({},i),{},{responseTime:c})},(r,i)=>(mO.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1),(r,i)=>(mO.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==AA.OPERATION_ABORTED&&r.code!==AA.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0)),i)}let _V=1;function EV(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:a,sid:o}=t,c=Date.now();let l;const d=t.role,[u,h]=TV(t,s,[$M.CHOOSE_SERVER]);let p=lR.networkState;return GR(async()=>{p&&lR.networkState===rR.OFFLINE&&lR.onlineWaiter&&await np.race([lR.onlineWaiter,SR(r&&r.maxRetryTimeout||FR.maxRetryTimeout)]),p=lR.networkState;const{data:e,headers:s}=await sV(i,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===s.http3?1:-1,mO.reportResourceTiming(i,o),xV(e,i,t,c,[$M.CHOOSE_SERVER],l);const a=cU(e,$M.CHOOSE_SERVER);return wV(a),iU(a,i)},e=>(e&&mO.joinChooseServer(o,{role:d,lts:c,succ:!0,csAddr:i,opid:h,serverList:e.gatewayAddrs.map(e=>e.address),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1),e=>e.code!==AA.OPERATION_ABORTED&&(e.code===AA.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinChooseServer(o,{role:d,lts:c,succ:!1,csAddr:i,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),aO.warning("[".concat(a||"sid-".concat(o.slice(0,6)),"] Choose server network error, retry"),e),!0)),r)}function bV(e,t,n,r){let i,{url:s,areaCode:a,serviceIds:o}=e;const c=Date.now(),l=t.role,[d,u]=TV(t,a,o);let h;return GR(async()=>{h&&lR.networkState===rR.OFFLINE&&lR.onlineWaiter&&await np.race([lR.onlineWaiter,SR(r&&r.maxRetryTimeout||FR.maxRetryTimeout)]),h=lR.networkState;const{data:e,headers:a}=await sV(s,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===a.http3?1:-1,mO.reportResourceTiming(s,t.sid),xV(e,s,t,c,o,i);const l=cU(e,$M.CHOOSE_SERVER),u=cU(e,"proxy5"===t.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK),p=performance.getEntriesByName(s),m=p[p.length-1];let f;return m&&(f={name:m.name,protocol:"nextHopProtocol"in m?m.nextHopProtocol:"",dnscost:"domainLookupEnd"in m&&"domainLookupStart"in m&&"number"==typeof m.domainLookupEnd&&"number"==typeof m.domainLookupStart?m.domainLookupEnd-m.domainLookupStart:-1,tcpTlsCost:"connectEnd"in m&&"connectStart"in m&&"number"==typeof m.connectEnd&&"number"==typeof m.connectStart?m.connectEnd-m.connectStart:-1,reqCost:"requestStart"in m&&"number"==typeof m.requestStart&&"responseEnd"in m&&"number"==typeof m.responseEnd?m.responseEnd-m.requestStart:-1,handleCost:"leave_ts"in e&&"enter_ts"in e&&"number"==typeof e.leave_ts&&"number"==typeof e.enter_ts?e.leave_ts-e.enter_ts:-1}),wV(l),{gatewayInfo:iU(l,s),proxyInfo:u,url:s,resourceTimingInfo:f}},e=>(e.gatewayInfo&&mO.joinChooseServer(t.sid,{role:l,lts:c,succ:!0,csAddr:s,serverList:e.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,opid:u,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:o.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38],resourceTimingInfo:e.resourceTimingInfo?JSON.stringify(e.resourceTimingInfo):void 0}),e.proxyInfo&&mO.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:s,turnServerAddrList:e.proxyInfo.addresses.map(e=>e.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:o.toString()}),!1),e=>e.code!==AA.OPERATION_ABORTED&&(e.code===AA.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:o.toString(),extend:JSON.stringify({networkState:h})}),aO.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0)),r)}const xV=(e,t,n,r,i,s)=>{const{sid:a,clientId:o,cloudProxyServer:c}=n,l=[],d=o=>{4096===o.flag?mO.joinChooseServer(a,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:o.error.message,csIp:o.error.data&&o.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):1048576!==o.flag&&4194304!==o.flag&&4194310!==o.flag||mO.joinWebProxyAP(a,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:o.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach(t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new fO(AA.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};l.push(n),d(n)}if(0!==n){const r=LM(n),i={error:new fO(AA.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?aO.warning(i.error.toString()):l.push(i),d(i)}}),l.length)throw aO.warning("[".concat(o||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)).join(" | "))),new fO(AA.CAN_NOT_GET_GATEWAY_SERVER,l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!l.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(l.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})},wV=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new fO(AA.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(AI("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?pV(e.detail[23].toLowerCase()):pV()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let r=0;r<n.length;r++){var s;const t=P_(s=n[r]).call(s);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if(AI("GATEWAY_ADDRESS")&&AI("GATEWAY_ADDRESS").length>0){aO.debug("assign gateway address to",AI("GATEWAY_ADDRESS"));const t=AI("GATEWAY_ADDRESS").map(t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find(e=>e.ip===t.ip&&e.port===t.port))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}});e.addresses=t}},SV=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=LM(t.buffer.code);throw new fO(AA.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw aO.debug("update ticket request received ap response without response body:",t),new fO(AA.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},TV=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i="host"===e.role?"1":"audience"===e.role?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:gV(gV(gV({6:e.stringUid,11:t,12:AI("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach(t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(s)),[a,r]},NV=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(e=>({ip:e.ip,port:e.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let CV=0;function AV(e){return np.all(e.map(e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}const RV=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,a=0;const o=t;let c,l=0;const d=async()=>{const e=(()=>{const e=a*o,t=e+o;return n.slice(e,t).map(r)})();s&&s.push(...e);try{c=await AV(e)}catch(e){if(l+=o,a++,!(l>=n.length))return void await d();i(e)}e.forEach(e=>e.cancel())};return await d(),c},IV=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const a=async()=>{const e=n(t.shift());try{return await e}catch(e){if(s++,s>=i||null!=r&&r(e))throw e;return a()}};return a()};async function OV(){if("undefined"==typeof VideoDecoder)return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],a=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128],o=await new np((o,c)=>{let l;!async function(){e&&"closed"!==e.state||await async function(){e=new VideoDecoder({output:e=>{e.close(),clearTimeout(l),o(!0)},error:e=>{clearTimeout(l),o(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const c=[t,n,r,i,s,a];for(let t=0;t<c.length;t++){const n=new EncodedVideoChunk({type:0==t?"key":"delta",timestamp:33333*t,duration:33333,data:new Uint8Array(c[t])});try{await e.decode(n)}catch(e){return void o(!1)}}}(),l=setTimeout(()=>{o(!1)},5e3)});return o}async function PV(e,t,n,r){const i=async function(e,t,n,r){let i=null;const s=[],a=async()=>{const i=AI("WEBCS_DOMAIN").slice(0,AI("AJAX_REQUEST_CONCURRENT")).map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),o=await RV({fragementLength:AI("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),EV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),o},o=async()=>{if(await SR(1e3),null!==i)return i;const a=AI("WEBCS_DOMAIN_BACKUP_LIST").map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),o=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map(e=>e.url)}),c=await RV({fragementLength:AI("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),EV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},o),c};try{return i=await AV([a(),o()]),s.length&&s.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function kV(e,t,n,r,i){const s=e.cloudProxyServer;if("disabled"===s){if(!r)return;if(e.useLocalAccessPoint)return await PV(e,t,n,i);if(AI("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:s}=await UV(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};const o=s.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bI.tcpport,udpport:e.udpport||bI.udpport,username:e.username||bI.username,password:e.password||bI.password,forceturn:!1,security:!0}));if(i.useP2P){var a;const t=null!==(a=e.uid)&&void 0!==a?a:r.uid,n="glb:".concat(t.toString()),i=await HA(n),c=s.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bI.tcpport,udpport:e.udpport||bI.udpport,username:n,password:i,forceturn:!1,security:!0}));o.push(...c)}return e.turnServer={mode:"manual",servers:o},{gatewayInfo:r}}return await PV(e,t,n,i)}const{proxyInfo:o,gatewayInfo:c}=await UV(e,t,n,i),l={gatewayInfo:c},d=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===s?void 0:e.tcpport?e.tcpport:bI.tcpport,udpport:"proxy4"===s?void 0:e.udpport?e.udpport:bI.udpport,username:e.username||bI.username,password:e.password||bI.password,forceturn:"proxy4"!==s,security:"proxy5"===s}));if(i.useP2P){var u;const t=null!==(u=e.uid)&&void 0!==u?u:c.uid,n="glb:".concat(t.toString()),r=await HA(n),i=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===s?void 0:e.tcpport||bI.tcpport,udpport:"proxy4"===s?void 0:e.udpport||bI.udpport,username:n,password:r,forceturn:"proxy4"!==s,security:"proxy5"===s}));d.push(...i)}return e.turnServer={mode:"manual",servers:d},aO.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),l}async function DV(e,t,n,r,i){const s=AI("ACCOUNT_REGISTER").slice(0,AI("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?s.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):s.map(e=>"https://".concat(e,"/api/v1"));const o=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const s=await async function(e,t,n,r,i){const s=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let o=e[0];const c=await GR(()=>sV(o+"".concat(-1===o.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw aO.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),mO.reqUserAccount(a.sid,{lts:s,success:!1,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:AA.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new fO(AA.INVALID_UINT_UID_FROM_STRING_UID);return mO.reqUserAccount(a.sid,{lts:s,success:!0,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:null,extend:a}),!1}const i=LM(n.code);return i.retry&&(o=e[(r+1)%e.length]),mO.reqUserAccount(a.sid,{lts:s,success:!1,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:i.desc,extend:a}),i.retry},(t,n)=>t.code!==AA.OPERATION_ABORTED&&(mO.reqUserAccount(a.sid,{lts:s,success:!1,serverAddr:o,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),o=e[(n+1)%e.length],!0),i);if(0!==c.code){const e=LM(c.code);throw new fO(AA.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},o),s.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},o),e}}async function LV(e,t,n){const r=AI("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):r.map(e=>"https://".concat(e,"/api/v1"));try{const r=await IV({referenceList:i,asyncMapHandler:r=>async function(e,t,n,r){const i=Date.now(),s={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await sV(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=LM(t.code);throw new fO(AA.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new fO(AA.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:s,uid:t.uid,elapse:Date.now()-i}}catch(e){throw e}}(r,e,t,n),closeFn:e=>e.code===AA.OPERATION_ABORTED||e.code===AA.UNEXPECTED_RESPONSE&&!e.data.retry});return r}catch(e){throw e}}async function jV(e,t,n){const r=AI("CDS_AP").slice(0,AI("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")),i=r.map(r=>function(e,t,n,r){const i=qC(),s={flag:64,cipher_method:0,features:gV(gV(gV(gV(gV({install_id:vI(),device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:yI,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:ZM.WEB_RTC,browser_name:i.name,browser_version:i.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),i.os&&{os_name:i.os}),i.osVersion&&{os_version:i.osVersion}),{},{detail:""})};return GR(()=>sV(e,{data:s,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==AA.OPERATION_ABORTED,r)}(r,e,t,n));let s=null,a=null,o={};try{s=await AV(i)}catch(e){if(e.code===AA.OPERATION_ABORTED)throw e;a=e}if(i.forEach(e=>e.cancel()),mO.reportApiInvoke(e.sid,{name:qA.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:s}}).onSuccess(),s&&s.test_tags)try{o=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach(e=>{var n;const i=P_(n=e.slice(4)).call(n),s=JSON.parse(t[e]),a=s[1];r[i]={tag:s[0]||"",value:a}}),r}(s)}catch(e){}return o}async function MV(e,t){const n=AI("WEBCS_DOMAIN").concat(AI("WEBCS_DOMAIN_BACKUP_LIST")).map(e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK]}));try{const r=await IV({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:s,serviceIds:a}=e;const o=Date.now(),[c,l]=TV(t,s,a);let d=lR.networkState;try{d&&lR.networkState===rR.OFFLINE&&lR.onlineWaiter&&await np.race([lR.onlineWaiter,SR(FR.maxRetryTimeout)]),d=lR.networkState;const{data:e,headers:t}=await sV(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1;const s=e=>{const t=[];if(e.response_body.forEach(n=>{const r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const r={error:new fO(AA.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){const i=LM(r),s={error:new fO(AA.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?aO.warning(s.error.toString()):t.push(s)}}),t.length)throw new fO(AA.CAN_NOT_GET_GATEWAY_SERVER,t.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!t.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(t.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})};s(e);const a=cU(e,$M.CHOOSE_SERVER),u=cU(e,$M.CLOUD_PROXY_FALLBACK);return wV(a),{gatewayInfo:iU(a,i),proxyInfo:u,opid:l,requestTime:o,url:i,isHttp3:r,elapse:Date.now()-o}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===AA.OPERATION_ABORTED||e.code===AA.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return r}catch(e){throw e}}async function UV(e,t,n,r){const i=AI("PROXY_SERVER_TYPE3"),s=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0&&i[1]||i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let a=null;const o=[],c=async()=>{const i=AI("WEBCS_DOMAIN").slice(0,AI("AJAX_REQUEST_CONCURRENT")).map((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?s("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):s("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),c=await RV({fragementLength:AI("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),bV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c},l=async()=>{if(await SR(1e3),null!==a)return a;const i=AI("WEBCS_DOMAIN_BACKUP_LIST").map((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?s("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):s("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),l=await RV({fragementLength:AI("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),bV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let d,u,h;try{({gatewayInfo:d,proxyInfo:u,url:h}=await AV([c(),l()]))}catch(e){throw e[0]}if(o.length&&o.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),!d||!u)throw new fO(AA.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Dr(i).call(i,t)&&(e.proxyServer=t,aO.setProxyServer(t),mO.setProxyServer(t))}return a={gatewayInfo:d,proxyInfo:await lU(u,d.uid)},a}async function VV(e,t,n){const r=AI("UAP_AP").slice(0,AI("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")),i=r.map(r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:yI,cname:t.cname,uid:t.uid.toString(),requestId:_V,seq:_V};_V+=1;const s={service_name:"tele_channel",json_body:JSON.stringify(i)};return GR(async()=>{const t=await sV(e,{data:s,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new fO(AA.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw aO.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new fO(AA.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw aO.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new fO(AA.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw aO.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(AI("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(AI("WORKER_DOMAIN"),":").concat(e.wss))}},void 0,e=>!!(e.code!==AA.OPERATION_ABORTED&&e.code!==AA.UNEXPECTED_RESPONSE||e.data&&e.data.retry),r)}(r,e,t,n));try{const e=await AV(i);return i.forEach(e=>e.cancel()),e}catch(e){throw e[0]}}async function FV(e,t,n){let r=null;const i=[],s=async s=>{const a=AI(s?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"));return s&&(await SR(1e3),null!==r)?r:await RV({fragementLength:AI("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(aO.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(s?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=NV(t,[$M.CHOOSE_SERVER]);let s=lR.networkState;return GR(async()=>{s&&lR.networkState===rR.OFFLINE&&lR.onlineWaiter&&await np.race([lR.onlineWaiter,SR(r&&r.maxRetryTimeout||FR.maxRetryTimeout)]),s=lR.networkState;const t=await sV(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return SV(t,e)},()=>!1,e=>e.code!==AA.OPERATION_ABORTED&&(e.code===AA.UPDATE_TICKET_FAILED?e.data.retry:(aO.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0)),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await AV([s(!1),s(!0)]),i.length&&i.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),r}catch(e){throw e[0]}}function BV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function GV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BV(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class HV extends WA{get isSuccess(){return!!this.configs}constructor(e,t){super(),uT(this,"configs",void 0),uT(this,"store",void 0),uT(this,"joinInfo",void 0),uT(this,"cancelToken",void 0),uT(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),uT(this,"interval",void 0),uT(this,"mutex",void 0),uT(this,"mutableParamsRead",!1),uT(this,"configCache",{}),uT(this,"limit_bitrate",void 0),this.mutex=new UR("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),AI("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},AI("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,mO.reportApiInvoke(null,{options:void 0,name:qA.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:YA.TRACER}).onSuccess(JSON.stringify(II))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void aO.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await jV(this.joinInfo,this.cancelToken,this.retryConfig),aO.debug("[config-distribute] get config distribute",JSON.stringify(e));const t=function(e){var t;const n=Xp(t=Object.keys(e).filter(e=>/^webrtc_ng_global_parameter/.test(e))).call(t);for(let s=0;s<n.length;s++)for(let t=n.length-1;t>s;t--){const r=n[t],i=e[r].value;if("number"==typeof i.__priority){const s=i.__priority,a=n[t-1],o=e[a].value;if("number"==typeof o.__priority){if(!(s>o.__priority))continue;{const e=r;n[t]=n[t-1],n[t-1]=e}}else{const e=r;n[t]=n[t-1],n[t-1]=e}}}const r=Date.now();let i={};return n.forEach(t=>{const n=e[t].value.__expires;n&&n<=r||(i[t]=e[t])}),i}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(e){const t=new fO(AA.NETWORK_RESPONSE_ERROR,e);aO.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){hM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(uM.UPDATE_BITRATE_LIMIT,e):this.emit(uM.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&GV({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const t={},n=Object.keys(e),r=[];n.forEach(n=>{const i=e[n].value;t[n]=i;const s=i.__id;if(s&&this.configCache[n]&&this.configCache[n].__id===s)return;const a=i.__type,o=e[n].value,c=e[n].tag;let l=0;a?a===RI.REALTIME&&(l=1):Object.keys(o).some(e=>Object.prototype.hasOwnProperty.call(TI,e)||!KL()&&Object.prototype.hasOwnProperty.call(xI,e)?(l=1,!0):void 0),r.push({tag:c,isApplied:l,feature:n,params:JSON.stringify(i)})}),r.forEach(e=>{let{tag:t,feature:n,params:r,isApplied:i}=e;this.store.sessionId&&mO.abTest(this.store.sessionId,{intSucc:1,isApplied:i,tag:t,feature:n,params:r,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(e){aO.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){const t=function(e){const t={};return Object.keys(e).forEach(n=>{const r=e[n].value,i=r.__expires,s=r.__type;Object.keys(r).forEach(e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=GV(GV({value:r[e]},i&&{expires:i}),s&&{type:s}))})}),t}(e);try{var n;const r=null===(n=t.LIMIT_BITRATE)||void 0===n?void 0:n.value;delete t.LIMIT_BITRATE,r&&hM(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{const t=Date.now();Object.keys(e).forEach(n=>{const{value:r,type:i,expires:s}=e[n];s&&s<=t||((i===RI.REALTIME||Object.prototype.hasOwnProperty.call(TI,n))&&(II[n]=r,NI[n]=r,aO.debug("Update realtime parameters from config distribute",n,r)),i||KL()||!Object.prototype.hasOwnProperty.call(xI,n)||(II[n]=r,NI[n]=r,aO.debug("Update gateway parameters from config distribute",n,r)))})}catch(t){aO.error("Error update config immediately: ".concat(e),t.message)}}(t);const i=JSON.stringify(t),s=window.btoa(i);window.localStorage.setItem("websdk_ng_global_parameter",s),aO.debug("Caching global parameters ".concat(i))}catch(e){aO.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{const t=Date.now();Object.keys(e).forEach(n=>{if("CLIENT_ROLE_OPTIONS"===n&&Object.prototype.hasOwnProperty.call(NI,n)){const{value:r,expires:i}=e[n];if(i&&i<=t)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(NI[n],r)||(II[n]=r,NI[n]=r,this.emit(uM.UPDATE_CLIENT_ROLE_OPTIONS,r),aO.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(e){aO.error("Error handling global parameter config:",e.message)}}}class WV extends WA{constructor(){super(...arguments),uT(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n)),!t.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(AI("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(!r)return;r.result.push(n);const i="VIDEO_ENCODE_FAILED"===e?AI("ENCODE_EXCEPTION_TIMES"):5;if(r.result.length>=i){var s;const n=Dr(s=r.result).call(s,!0);r.isPrevNormal&&!n&&this.emit("exception",zV[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",zV[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof Hk&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=sU(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var t;return!(!e.codecType||Dr(t=AI("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(t,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||0!==e.sendFrameRate||0!==e.sendResolutionWidth||0!==e.sendResolutionHeight}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof Hk&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const zV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},KV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function qV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function YV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qV(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class XV{constructor(e){uT(this,"store",void 0),uT(this,"onStatsException",void 0),uT(this,"onUploadPublishDuration",void 0),uT(this,"onStatsChanged",void 0),uT(this,"onVideoCodecChanged",void 0),uT(this,"localStats",new Map),uT(this,"remoteStats",new Map),uT(this,"updateStatsInterval",void 0),uT(this,"trafficStats",void 0),uT(this,"trafficStatsPeerList",[]),uT(this,"uplinkStats",void 0),uT(this,"exceptionMonitor",void 0),uT(this,"p2pChannel",void 0),uT(this,"scalabilityMode",cI.L1T1),uT(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new WV,this.exceptionMonitor.on("exception",(e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(_M.LocalAudioTrack)||YV({},qO)}getLocalVideoTrackStats(){return this.localStats.get(_M.LocalVideoTrack)||YV({},YO)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))});return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach(e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)});return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))});return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get(_M.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const s=this.localStats.get(_M.LocalVideoTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate);const a=this.localStats.get(_M.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach(e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)});let o=1;return this.trafficStats&&(o+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:o,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(e=>void 0!==e.B_ppad||void 0!==e.B_ppvd),e.peer_delay.filter(e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid)).forEach(e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?KV.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?KV.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&aO.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[n,r]=t;switch(n){case _M.LocalVideoTrack:case _M.LocalVideoLowTrack:{const t=r,a=YV({},YO),o=e.getStats(),c=e.getLocalMedia(n);if(o){const n=o.videoSend.find(e=>e.ssrc===(null==c?void 0:c.ssrcs[0].ssrcId));if(n){const r=e.getLocalVideoSize(),s=e.getEncoderConfig(_M.LocalVideoTrack);var i;"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(a.codecType=n.codec,(null==t?void 0:t.codecType)!==n.codec&&(null===(i=this.onVideoCodecChanged)||void 0===i||i.call(this,n.codec.toLocaleLowerCase()))),a.sendBytes=n.bytes,a.sendBitrate=t?8*Math.max(0,a.sendBytes-t.sendBytes):0,n.inputFrame?(a.captureFrameRate=n.inputFrame.frameRate,a.captureResolutionHeight=n.inputFrame.height,a.captureResolutionWidth=n.inputFrame.width):r&&(a.captureResolutionWidth=r.width,a.captureResolutionHeight=r.height),n.sentFrame?(a.sendFrameRate=n.sentFrame.frameRate,a.sendResolutionHeight=n.sentFrame.height,a.sendResolutionWidth=n.sentFrame.width):r&&(a.sendResolutionWidth=r.width,a.sendResolutionHeight=r.height),n.avgEncodeMs&&(a.encodeDelay=n.avgEncodeMs),s&&s.bitrateMax?a.targetSendBitrate=1e3*s.bitrateMax:n.targetBitrate&&(a.targetSendBitrate=n.targetBitrate),a.sendPackets=n.packets,a.sendPacketsLost=n.packetsLost,a.sendJitterMs=n.jitterMs,a.sendRttMs=n.rttMs,a.totalDuration=t?t.totalDuration+1:1,a.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(a.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(aO.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(n,a),((null==t?void 0:t.sendResolutionWidth)!==a.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==a.sendResolutionHeight)&&(null===(s=this.onStatsChanged)||void 0===s||s.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&c&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,c.track,a);break}case _M.LocalAudioTrack:{const t=r,i=YV({},qO),s=e.getStats(),a=e.getLocalMedia(n);if(s){const n=s.audioSend.find(e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(_M.LocalAudioTrack,i),i&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,i);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var n,r;let[i,{videoStats:s,audioStats:a,videoPcStats:o}]=t;const c=a,l=s,d=o,u=YV({},XO),h=YV({},QO),p=YV({},JO),{audioTrack:m,videoTrack:f,audioSSRC:g,videoSSRC:v}=e.getRemoteMedia(i);let y;y=this.store.useP2P?e.getStats(!0):e.getStats();const _=null===(n=y)||void 0===n?void 0:n.audioRecv.find(e=>e.ssrc===g),E=null===(r=y)||void 0===r?void 0:r.videoRecv.find(e=>e.ssrc===v),b=this.trafficStats&&this.trafficStats.peer_delay.find(e=>e.peer_uid===i);if(_&&("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(u.codecType=_.codec),_.outputLevel?u.receiveLevel=Math.round(32767*_.outputLevel):m&&(u.receiveLevel=Math.round(32767*m.getVolumeLevel())),u.receiveBytes=_.bytes,u.receivePackets=_.packets,u.receivePacketsLost=_.packetsLost,u.receivePacketsDiscarded=_.packetsDiscarded,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.receiveBitrate=c?8*Math.max(0,u.receiveBytes-c.receiveBytes):0,u.totalDuration=c?c.totalDuration+1:1,u.totalFreezeTime=c?c.totalFreezeTime:0,u.freezeRate=u.totalFreezeTime/u.totalDuration,u.receiveDelay=_.jitterBufferMs,u.totalDuration>10&&XV.isRemoteAudioFreeze(m)&&(u.totalFreezeTime+=1)),E){var x;"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(h.codecType=E.codec),h.receiveBytes=E.bytes,h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.decodeFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,h.renderFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,E.outputFrame&&(h.renderFrameRate=E.outputFrame.frameRate),E.receivedFrame?(h.receiveFrameRate=E.receivedFrame.frameRate,h.receiveResolutionHeight=E.receivedFrame.height,h.receiveResolutionWidth=E.receivedFrame.width):f&&(h.receiveResolutionHeight=f._videoHeight||0,h.receiveResolutionWidth=f._videoWidth||0),void 0!==E.framesRateFirefox&&(h.receiveFrameRate=Math.round(E.framesRateFirefox)),h.receivePackets=E.packets,h.receivePacketsLost=E.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost);const t=l?l.totalFreezeTime:0,n=l?l.totalDuration:0;h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=null!==(x=E.totalFreezesDuration)&&void 0!==x?x:t||0,h.receiveDelay=E.jitterBufferMs||0;const r=!!v&&e.getRemoteVideoIsReady(v);void 0===E.totalFreezesDuration&&f&&r&&XV.isRemoteVideoFreeze(f,E,d)&&(h.totalFreezeTime+=1),h.freezeRate=Math.max(0,Math.min((h.totalFreezeTime-t)/(h.totalDuration-n),1))}b&&(u.end2EndDelay=b.B_ad,h.end2EndDelay=b.B_vd,u.transportDelay=b.B_ed,h.transportDelay=b.B_ed,u.currentPacketLossRate=b.B_ealr4/100,h.currentPacketLossRate=b.B_evlr4/100,p.uplinkNetworkQuality=b.B_punq?b.B_punq:0,p.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(i,{audioStats:u,videoStats:h,videoPcStats:E,networkStats:p}),m&&this.exceptionMonitor.setRemoteAudioStats(m,u),f&&this.exceptionMonitor.setRemoteVideoStats(f,h)})}}class JV{constructor(){uT(this,"destChannelMediaInfos",new Map),uT(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Zj(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Zj(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Gj(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QV(e){if(!(e instanceof JV))return new fO(AA.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new fO(AA.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new fO(AA.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class ZV{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){uT(this,"uid",void 0),uT(this,"_uintid",void 0),uT(this,"_trust_in_room_",!0),uT(this,"_trust_audio_enabled_state_",!0),uT(this,"_trust_video_enabled_state_",!0),uT(this,"_trust_audio_mute_state_",!0),uT(this,"_trust_video_mute_state_",!0),uT(this,"_audio_muted_",!1),uT(this,"_video_muted_",!1),uT(this,"_audio_enabled_",!0),uT(this,"_video_enabled_",!0),uT(this,"_audio_added_",!1),uT(this,"_video_added_",!1),uT(this,"_is_pre_created",!1),uT(this,"_video_pre_subscribed",!1),uT(this,"_audio_pre_subscribed",!1),uT(this,"_trust_video_stream_added_state_",!0),uT(this,"_trust_audio_stream_added_state_",!0),uT(this,"_audioTrack",void 0),uT(this,"_videoTrack",void 0),uT(this,"_dataChannels",[]),uT(this,"_audioSSRC",void 0),uT(this,"_videoSSRC",void 0),uT(this,"_audioOrtc",void 0),uT(this,"_videoOrtc",void 0),uT(this,"_cname",void 0),uT(this,"_rtxSsrcId",void 0),uT(this,"_videoMid",void 0),uT(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function $V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$V(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$V(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const tF="9",nF=2e4,rF=4e4;function iF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function sF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iF(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var aF=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(aF||{});const oF=new Map;function cF(e,t,n,r){let{scale:i}=e;if(0===i&&r===aF.UP||i>=t.length-1&&r===aF.DOWN)return e;let s=sF(sF({},e),{},{scale:r===aF.DOWN?++i:--i});switch(n){case"maintain-framerate":s=sF(sF({},s),t[i].motion);break;case"maintain-resolution":s=sF(sF({},s),t[i].detail);break;case"balanced":s=sF(sF({},s),t[i].balanced)}return s}function lF(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:dF(t)};oF.set(e,n)}else oF.delete(e)}function dF(e){const t=sF({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:o,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:m,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:v,MOTION_RESOLUTION_FACTOR:y,MOTION_BITRATE_FACTOR:_,DETAIL_FRAMERATE_FACTOR:E,DETAIL_BITRATE_FACTOR:b}=wI,x=Math.min(t.frameRate,o),w=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*x),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let S=1;S<=c;S++){const e={bwe_up:Math.round(Math.pow(u,S)*n),bwe_down:Math.round(Math.pow(h,S+1)*n),fps_up:Math.round(Math.pow(m,S)*x),fps_down:Math.round(Math.pow(p,S+1)*x)},t={scaleResolutionDownBy:i/Math.pow(v,S),frameRate:Math.max(Math.round(Math.pow(g,S)*r),a),bitrateMax:Math.max(Math.round(Math.pow(f,S)*n),d),bitrateMin:Math.max(Math.round(Math.pow(f,S)*s),l)},o={scaleResolutionDownBy:i/Math.pow(y,S),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(_,S)*n),d),bitrateMin:Math.max(Math.round(Math.pow(_,S)*s),l)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(E,S)*r),a),bitrateMax:Math.max(Math.round(Math.pow(b,S)*n),d),bitrateMin:Math.max(Math.round(Math.pow(b,S)*s),l)};w.push({scale:S,threshold:e,balanced:t,motion:o,detail:c})}return w}function uF(e,t,n,r,i,s){const a=oF.get(e)||{overUse:0,underUse:0,adaptationList:dF(i)},{adaptationList:o}=a;oF.set(e,a);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=wI,{scale:d}=r;let u,h;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return AI("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,d,o,s)&&(a.overUse++,h=oI.CPU,a.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:r}}=n[t];return e<r}(n,d,o)&&(a.overUse++,h=oI.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,u=cF(r,o,s,aF.DOWN),[u,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return AI("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,d,o,s)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:r}}=n[t];return e>r}(n,d,o)&&(a.underUse++,a.underUse>l&&(a.overUse=0,a.underUse=0,u=cF(r,o,s,aF.UP),0===u.scale&&(h=oI.NONE))),[u,h])}function hF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hF(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const mF=new Map;function fF(e,t){const n=mF.get(e);if(n){const{timer:t}=n;window.clearTimeout(t),mF.delete(e)}t.qualityLimitationReason=oI.NONE,lF(e)}function gF(e,t){var n;let r;switch(t){case _M.LocalAudioTrack:r=rM.Audio;break;case _M.LocalVideoTrack:r=Dr(n=e._hints).call(n,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalVideoLowTrack:r=rM.Low}return r}function vF(e){const t=vO();if(e.some(e=>e._bypassWebAudio))throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function yF(e,t){vF(e);const n=t||new Hk;return e.forEach(e=>n.addAudioTrack(e)),n}const _F=!vO().supportUnifiedPlan||AI("CHROME_FORCE_PLAN_B")&&xA();function EF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return _F?(n={spec:t,store:e},JU("PlanBConnection").create(n)):new NF(t,e)}function bF(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function xF(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(ZA(e.turnServer.servers))return!1;if(AI("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch(e){return!1}}var wF;function SF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function TF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SF(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let NF=(wF=class e extends mM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dr(t=Object.keys(PI)).call(t,e)}))]}constructor(t,n){super(t,n),uT(this,"id",TR(5,"connection-")),uT(this,"store",void 0),uT(this,"peerConnection",void 0),uT(this,"forceTurn",!1),uT(this,"remoteSDP",void 0),uT(this,"initialOffer",void 0),uT(this,"transportEventReceiver",void 0),uT(this,"statsFilter",void 0),uT(this,"extension",{useXR:AI("USE_XR")}),uT(this,"localCapabilities",void 0),uT(this,"remoteCodecs",void 0),uT(this,"localCandidateCount",0),uT(this,"allCandidatesReceived",!1),uT(this,"isPreallocation",!1),uT(this,"preMediaMap",new Map),uT(this,"dataStreamChannelMap",new Map),uT(this,"establishPromise",void 0),uT(this,"recoveredDataChannelIds",[]),uT(this,"currentDataChannelId",1),uT(this,"supportAV1RtpSpec",!1),uT(this,"mutex",void 0),uT(this,"qualityLimitationReason",oI.NONE),uT(this,"isFirstConnected",!1),this.store=n,this.forceTurn=xF(t),this.mutex=new UR("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=fI(this.peerConnection,AI("STATS_UPDATE_INTERVAL"),void 0,nA()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else aO.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else aO.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=xU(n.sdp),i=await kU({filterRTX:!AI("USE_PUB_RTX")&&!AI("USE_SUB_RTX"),filterVideoFec:AI("FILTER_VIDEO_FEC"),filterAudioFec:AI("FILTER_AUDIO_FEC"),filterVideoCodec:AI("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:AI("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:AI("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=jU(i),this.initialOffer=n,AI("ENABLE_SVC")&&"av1"==this.store.codec){const t=await async function(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:cI.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=VI(t.sdp).mediaDescriptions[0];if(!n)return;const r=n.attributes.extmaps.find(e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName);return e.close(),r}catch(e){return}}();var e;t&&(this.supportAV1RtpSpec=!0,null===(e=i.send)||void 0===e||e.videoExtensions.push(t))}let s;return n.sdp&&HU(n.sdp)&&(s=pR(i),(t=s).send&&(gU(fM.VIDEO,t.send.videoExtensions),gU(fM.AUDIO,t.send.audioExtensions)),t.recv&&(gU(fM.VIDEO,t.recv.videoExtensions),gU(fM.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(gU(fM.VIDEO,t.sendrecv.videoExtensions),gU(fM.AUDIO,t.sendrecv.audioExtensions))),TF(TF({},r),{},{rtpCapabilities:s||i,offerSDP:n.sdp})}catch(e){throw new RA(AA.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&HU(this.initialOffer.sdp)&&(t=e.rtpCapabilities,n=this.localCapabilities,t.send&&(fU(fM.VIDEO,t.send.videoExtensions,n.send.videoExtensions),fU(fM.AUDIO,t.send.audioExtensions,n.send.audioExtensions)),t.recv&&(fU(fM.VIDEO,t.recv.videoExtensions,n.recv.videoExtensions),fU(fM.AUDIO,t.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return pR(this._localCapabilities)}get rtpCapabilities(){return pR(this._rtpCapabilities)}get candidates(){return pR(this._candidates)}get iceParameters(){return pR(this._iceParameters)}get dtlsParameters(){return pR(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];uT(this,"sessionDesc",void 0),uT(this,"_localCapabilities",void 0),uT(this,"_rtpCapabilities",void 0),uT(this,"_candidates",void 0),uT(this,"_originCandidates",void 0),uT(this,"_iceParameters",void 0),uT(this,"_isUseExtmapAllowMixed",void 0),uT(this,"_isUseLocalCodecs",void 0),uT(this,"_dtlsParameters",void 0),uT(this,"setup",void 0),uT(this,"currentMidIndex",void 0),uT(this,"cname",void 0),uT(this,"useLocalCodecsMids",[]),uT(this,"preloadSsrcs",[]),uT(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,e=pR(e);const{iceParameters:r,dtlsParameters:i,candidates:s,rtpCapabilities:a,setup:o,localCapabilities:c,cname:l}=e;this._rtpCapabilities=a,this._candidates=s,this._originCandidates=pR(s),this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=c,this.setup=o,this.cname=l,[this.sessionDesc]=this.updateRemoteRTPCapabilities(a),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(e=>{var t;return Dr(t=this.preloadSsrcs).call(t,e)})}preloadRemoteMedia(e){let t=0;const n=[],r=[];for(;e>0;){const i=[eF({ssrcId:rF+t},AI("USE_SUB_RTX")?{rtx:rF+t+1}:{})],s="".concat(rF+t,"_").concat(nF+t),{ssrcs:a,ssrcGroups:o}=NU(i,this.cname,AI("SYNC_GROUP")?s:void 0),c=this.preCreateOrRecycleSendMedia("video",a,o,void 0),l=[{ssrcId:nF+t}],d="".concat(rF+t,"_").concat(nF+t),{ssrcs:u,ssrcGroups:h}=NU(l,this.cname,AI("SYNC_GROUP")?d:void 0),p=this.preCreateOrRecycleSendMedia("audio",u,h,void 0);e--,t+=2,n.push(c,p),r.push(a[0].ssrcId,u[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=r,{mids:n,preSSRCs:r,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,r){const i=this.rtpCapabilities.send.videoCodecs,s=this._isUseLocalCodecs||0===i.length?this.localCapabilities.recv:this.rtpCapabilities.send;aO.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const a=e===fM.VIDEO?s.videoCodecs:s.audioCodecs,o=e===fM.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:o,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};return l=this.mungSendMediaDesc(l,r),this.sessionDesc.mediaDescriptions.push(l),this.updateBundleMids(),c}toString(){return FI(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:s}=NU(t,this.cname,AI("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(nA()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&($C()||function(){const e=qC();return!(e.name!==HC.CHROME||!e.osVersion)&&Number(e.version)<=90}()||AI("ENABLE_ENCODED_TRANSFORM")&&ZC())||0===t&&!function(e){const t=qC();return!(t.name!==HC.FIREFOX||!t.osVersion)&&Number(t.version)===e}(138)&&AI("USE_SUB_RTX")||mA()?(n=this.createOrRecycleSendMedia(e,i,s,"sendonly",r),this.updateBundleMids()):(n=pR(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),nA()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)}),n=[];let r=!1;return t.forEach(e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)}),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{"0"===e.attributes.mid||nA()||mA()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dr(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dr(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}receive(e,t,n,r){e.forEach((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||VI((n=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(n?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));var n;this._rtpCapabilities=e;let r=!1;const i=this.rtpCapabilities.send,s=this.localCapabilities.send,a=this.localCapabilities.recv,o=a.videoCodecs,c=a.audioCodecs,l=a.videoExtensions,d=a.audioExtensions;for(const m of t.mediaDescriptions){var u;if("sendonly"!==m.attributes.direction||"string"!=typeof m.attributes.mid||!Dr(u=this.useLocalCodecsMids).call(u,m.attributes.mid)){if(r=!0,m.attributes.iceUfrag=this._iceParameters.iceUfrag,m.attributes.icePwd=this._iceParameters.icePwd,m.attributes.fingerprints=this._dtlsParameters.fingerprints,m.attributes.candidates=this._candidates,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var h;m.media.fmts=o.map(e=>e.payloadType.toString(10)),m.attributes.payloads=o,m.attributes.extmaps=l;const e=m.attributes.mid;"string"!=typeof e||Dr(h=this.useLocalCodecsMids).call(h,e)||this.useLocalCodecsMids.push(e)}else if(0===i.videoCodecs.length){const e=s.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dr(n=t.encodingName.toLowerCase()).call(n,"vp8")})||[s.videoCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=i.videoCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=i.videoCodecs,m.attributes.extmaps=i.videoExtensions;if("audio"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var p;m.media.fmts=c.map(e=>e.payloadType.toString(10)),m.attributes.payloads=c,m.attributes.extmaps=d;const e=m.attributes.mid;"string"!=typeof e||Dr(p=this.useLocalCodecsMids).call(p,e)||this.useLocalCodecsMids.push(e)}else if(0===i.audioCodecs.length){const e=s.audioCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dr(n=t.encodingName.toLowerCase()).call(n,"opus")})||[s.audioCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=i.audioCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=i.audioCodecs,m.attributes.extmaps=i.audioExtensions,MU(m)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,r]}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),n=[];if(t.forEach(e=>{n.push(eF(eF({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this._candidates=n;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pR(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(nA()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:tF,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,s){const a=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=UU(a,o,this.localCapabilities.send,a===fM.VIDEO?r:i),l=a===fM.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let u={media:{mediaType:a,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e,s);const h=this.findFirstClosedMedia(a);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(e=>e.fingerprint)),n=new Set(e.map(e=>e.fingerprint));let r=!1;t.size!==n.size&&(r=!0);for(const i of t)n.has(i)||(r=!0);return r}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dr(t=Object.keys(PI)).call(t,e)}))],i=new Set(t);if(r.every(e=>i.has(e)))return aO.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const s=this._rtpCapabilities.recv.videoCodecs.filter(e=>t.some(t=>{var n;return Dr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}));if(0===s.length)return aO.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const a=[...new Set(s.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""))];let o;if(aO.debug("updateRemoteCodec, from ".concat(r," to ").concat(a)),0===e.length)o=this.sessionDesc.mediaDescriptions.filter(e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction);else if(o=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&"video"===t.media.mediaType&&Dr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction),o.length!==e.length)return aO.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(AI("USE_PUB_RTX")||AI("USE_SUB_RTX")){const e=VU(s,this.rtpCapabilities.recv.videoCodecs);s.push(...e)}this._rtpCapabilities.recv.videoCodecs=s;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,d=UU(fM.VIDEO,l,c,n);return o.forEach(e=>{const t=d.map(e=>e.payloadType.toString(10));aO.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",d),e.attributes.payloads=d,e.media.fmts=t}),!0}createOrRecycleSendMedia(e,t,n,r,i){const s=this.rtpCapabilities.send.videoCodecs,a=this._isUseLocalCodecs||0===s.length?this.localCapabilities.recv:this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungSendMediaDesc(d,i);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const r=pR(e);return AU(r),CU(r,t),RU(r,t),IU(r),OU(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=pR(e);return OU(n,t,this.localCapabilities.recv),MU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>nA()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===t?void 0:t.attributes.ssrcs}}(TF(TF({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!AI("ENABLE_PRE_SUB_WITH_PRE_PC")||!AI("PRE_USE_LOCAL_CODECS"))&&EO(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),i=BU(this.initialOffer.sdp,this.extension),s=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==s||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const a=this.peerConnection.getTransceivers()[0];if(null!=a&&a.receiver&&this.tryBindTransportEvents(a.receiver),EO(this.store))if(e.preallocation&&AI("ENABLE_PRE_SUB_WITH_PRE_PC")){const e=AI("PRE_SUB_NUM"),{mids:t,preSSRCs:n}=this.remoteSDP.preloadRemoteMedia(e);await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(n)),this.presetMedia(t,n)}else{const{preSSRCs:t=[]}=e,n=t.map(e=>e.ssrcMsg[0].ssrcId);if(0===t.length)return;const{mids:r}=this.remoteSDP.batchSend(t.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(n)),this.presetMedia(r,n)}}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}var t,n}presetMedia(e,t){e.forEach((e,n)=>{this.peerConnection.getTransceivers().forEach(r=>{if(null!=r.mid&&e===r.mid&&r.receiver.track){const i=r.receiver.track;let s;"video"===i.kind&&AI("ENABLE_PRE_RENDER")&&(s=new Xk({trackId:"track-".concat(i.kind,"-unknown-").concat(this.store.clientId,"_").concat(TR(5,""))},!0),s.updateVideoTrack(i),s.onFirstVideoFrameRender=()=>{var e;const r=this.preMediaMap.get(t[n]);r&&(r.firstVideoRender=Date.now()),null===(e=this.onFirstVideoRender)||void 0===e||e.call(this,t[n])},s.play(this.store.sessionId||void 0)),this.preMediaMap.set(t[n],{mid:e,track:i,player:s,transceiver:r})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let t=!1;const{rtpCapabilities:n}=e;if([,t]=this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const e=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);t=t||e}const{preSSRCs:r=[]}=e,i=r.map(e=>e.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(i)){const e=[],t=[];if(Array.from(this.preMediaMap.entries()).every(n=>{let[r,{mid:i,player:s,track:a}]=n;return e.push(i),t.push(r),this.preMediaMap.delete(r),s&&s.destroy(),!0}),e.length>0&&(this.remoteSDP.stopSending(e),await FU(this.peerConnection,this.remoteSDP,this.extension),aO.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(t)),mO.reportApiInvoke(this.store.sessionId,{name:qA.PRELOAD_MEDIA_FAILED,options:[r,t],tag:YA.TRACER}).onSuccess()),r.length>0){const{mids:e}=this.remoteSDP.batchSend(r.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(i)),this.presetMedia(e,i)}}t?(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):aO.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return YN(function*(){const i=yield JN(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[],a=pU();e.forEach(e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,TF({direction:"sendonly"},"video"===e.trackMediaType&&r.supportAV1RtpSpec&&a?{sendEncodings:[{scalabilityMode:a}]}:{}));s.push(t),e._updateRtpTransceiver(t)}),nA()&&!0===AI("SIMULCAST")&&(yield JN(r.applySimulcastForFirefox(s,e)));const o=yield JN(r.peerConnection.createOffer()),c=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(o.sdp,e,c),d=VI(l),u=c.map(e=>{const t=d.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(t,AI("USE_PUB_RTX"))});let h;try{h=yield u}catch(i){h=[],r.remoteSDP.receive(e,t,n,h);const s=r.remoteSDP.toString();throw yield JN(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JN(r.peerConnection.setRemoteDescription({type:"answer",sdp:s})),yield JN(r.stopSending(c,!0)),i}r.remoteSDP.receive(e,t,n,h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(l,"offer","local","send");return yield JN(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JN(r.applySimulcastEncodings(s,e)),yield JN(r.applySendEncodings(s,e)),null==m||m(p),yield JN(r.peerConnection.setRemoteDescription({type:"answer",sdp:p})),s.map((e,t)=>{const n=c[t];return{localSSRC:u[t],id:n,transceiver:e}})}catch(e){throw e instanceof RA?e:new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)aO.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:AI("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach(e=>{e._updateOriginDataChannel(n)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),aO.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else aO.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof RA?e:new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof RA?e:new RA(AA.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{var t;fF(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:s}=this.remoteSDP.send(e,t,n,r);s&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(e=>e.mid===i);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(e=>{const t=this.peerConnection.getTransceivers().find(t=>t.mid===e);if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(e=>{Array.from(this.preMediaMap.entries()).some(t=>{let[n,{mid:r,player:i}]=t;if(r===e)return this.preMediaMap.delete(n),i&&i.destroy(),!0})}),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(e,t)=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YN(function*(){const n=yield JN(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=vO().supportPCSetConfiguration,r=AI("FORCE_TURN_TCP")||t.forceTurn;if(e===gM.RELAY&&!n)return;if(n&&!r){const n=e===gM.RELAY?"relay":"all",r=t.peerConnection.getConfiguration();r.iceTransportPolicy!==n&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(r.iceTransportPolicy,"] to [").concat(n,"]")),r.iceTransportPolicy=n,t.peerConnection.setConfiguration(r))}t.remoteSDP.updateCandidates(e);const i=yield JN(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=xU(i.sdp),{remoteIceParameters:a}=yield s.iceParameters;t.remoteSDP.restartICE(a);const o=t.remoteSDP.toString(),c=t.logSDPExchange(i.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield JN(t.peerConnection.setLocalDescription(i)),null==c||c(o),yield JN(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(gM.TCP_RELAY),await FU(this.peerConnection,this.remoteSDP,this.extension)}catch(e){aO.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(e=>{fF(this.id+e.mid,this)}),this.preMediaMap.forEach(e=>{let{player:t}=e;t&&t.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return TF(TF({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==s||s(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?nA()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:TF(TF({},$R),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:TF(TF({},$R),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;const n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"",i=hU(e.url||"");aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(i||"",", host_candidate:").concat(r)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},AI("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(ZA(t.turnServer.servers)?n.iceServers=t.turnServer.servers:AI("NEW_TURN_MODE")&&n.iceServers&&"disabled"===r?(AI("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),AI("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),AI("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),AI("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),AI("ENABLE_ENCODED_TRANSFORM")&&vO().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!AI("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{const n=AI("NEW_TURN_MODE");1===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":443?transport=tcp")}):4===n&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair()||{};if(e&&t){const n=e.address+":"+e.port,r=t.address+":"+t.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(n)),", remote ").concat(JSON.stringify(hU(r))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(!t){const n=this.peerConnection.getSenders();t=n.find(t=>t.track===e._mediaStreamTrack)}if(!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vO().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}const a=function(e,t){return e.getTransceivers().find(e=>e.sender.track===t||e.receiver.track===t)}(this.peerConnection,e._mediaStreamTrack),o=JP(e);if(function(e){var t;return!(!AI("ENABLE_AG_ADAPTATION")||!(e instanceof LD||Dr(t=e._hints).call(t,UO.CUSTOM_TRACK))||!AI("FORCE_SUPPORT_AG_ADAPTATION")&&!(dA(14,0,!1)&&uA(17,4,!0)||lA(14)&&hA(17,4,!0)))}(e)&&a&&t&&o&&this.getLocalVideoStats&&Dr(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=i.degradationPreference||(Dr(c=e._hints).call(c,UO.CUSTOM_TRACK)?AI("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,s){if(fF(e,n),i(t),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let a=-1;lF(e,t);const o=window.setInterval(()=>{const o=mF.get(e);if(!AI("ENABLE_AG_ADAPTATION")||!o)return fF(e,n),void i(t);const c=s();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;const s=c.sendFrameRate,l=c.OutgoingAvailableBandwidth,[d,u]=uF(e,s,l,o.adaptationConfig,t,r);u&&(n.qualityLimitationReason=u),d&&o.adaptationConfig.scale!==d.scale&&(aO.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(s,", bwe ").concat(l,", switch from ").concat(o.adaptationConfig.scale," to ").concat(d.scale," ")),o.adaptationConfig=pF(pF({},o.adaptationConfig),d),i(d))}},AI("CHECK_LOCAL_STATS_INTERVAL")),c=pF({},t);mF.set(e,{timer:o,adaptationConfig:c,originConfig:t,adaptationFunc:i}),aO.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+a.mid,o,this,n,e=>{t&&this.updateAdaptation(t,e)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(s.maxBitrate=1e3*t),(Dr(l=e._hints).call(l,UO.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(s.maxFramerate=sU(n)),r&&r>=1&&(s.scaleResolutionDownBy=r))}const{maxFramerate:d}=AI("ENCODER_CONFIG_LIMIT");if(d&&"number"==typeof d&&(s.maxFramerate=s.maxFramerate?Math.min(s.maxFramerate,d):d),AI("DSCP_TYPE")&&xA()){var u;const e=AI("DSCP_TYPE");Dr(u=["very-low","low","medium","high"]).call(u,e)&&(s.networkPriority=e)}const h=t.getParameters(),p=null===(r=h.encodings)||void 0===r?void 0:r[0];nA()&&!p&&(i.encodings=[s]),p&&Object.assign(p,s),Object.assign(h,i),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,n){try{var r;if(!vO().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e||"av1"===e}(e)||!AI("ENABLE_SVC"))return;const i={},s={},a=t.getParameters(),o=null===(r=a.encodings)||void 0===r?void 0:r[0];s.scalabilityMode=pU(n),o&&Object.assign(o,s),Object.assign(a,i),await t.setParameters(a),aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,AI("SVC_MODE"))}async updateAdaptation(e,t){var n,r;if(!e)return aO.debug("[updateAdaptation] no rtpSender found");if(!vO().supportSetRtpSenderParameters)return aO.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const i={},{bitrateMax:s,frameRate:a,scaleResolutionDownBy:o}=t;s&&(i.maxBitrate=1e3*s),a&&(i.maxFramerate=sU(a)),o&&o>=1&&Dr(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=o);const c=e.getParameters(),l=null===(r=c.encodings)||void 0===r?void 0:r[0];l&&Object.assign(l,i),Object.assign(c,{});try{await e.setParameters(c),aO.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?aO.debug("[updateAdaptation] peerConnection not connected}"):aO.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):aO.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!vO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof DD&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=VI(e);return t.forEach((e,t)=>{const i=n[t],s=r.mediaDescriptions.find(e=>e.attributes.mid===i);s&&(CU(s,e),PU(s,e,this.store.codec))}),FI(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var n,r,i,s,a;const c=e[o],l=t[o];if(l instanceof DD&&!Dr(n=l._hints).call(n,UO.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(s=l._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nA()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof DD&&this.isVP8Simulcast(r)){const t=e[n],i={},s={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,s;return!!(e instanceof DD&&AI("SIMULCAST")&&"vp8"===this.store.codec&&!Dr(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(s=e._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(AI("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(vO().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Rj(wF.prototype,"updateRemoteRTPCapabilities",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateRemoteRTPCapabilities"),wF.prototype),Rj(wF.prototype,"connect",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"connect"),wF.prototype),Rj(wF.prototype,"updateRemoteConnect",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateRemoteConnect"),wF.prototype),Rj(wF.prototype,"createDataChannels",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"createDataChannels"),wF.prototype),Rj(wF.prototype,"receive",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"receive"),wF.prototype),Rj(wF.prototype,"batchReceive",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"batchReceive"),wF.prototype),Rj(wF.prototype,"stopReceiving",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"stopReceiving"),wF.prototype),Rj(wF.prototype,"muteRemote",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"muteRemote"),wF.prototype),Rj(wF.prototype,"unmuteRemote",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"unmuteRemote"),wF.prototype),Rj(wF.prototype,"muteLocal",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"muteLocal"),wF.prototype),Rj(wF.prototype,"unmuteLocal",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"unmuteLocal"),wF.prototype),Rj(wF.prototype,"close",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"close"),wF.prototype),Rj(wF.prototype,"updateEncoderConfig",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateEncoderConfig"),wF.prototype),Rj(wF.prototype,"updateSendParameters",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateSendParameters"),wF.prototype),Rj(wF.prototype,"replaceTrack",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"replaceTrack"),wF.prototype),Rj(wF.prototype,"updateAdaptation",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateAdaptation"),wF.prototype),Rj(wF.prototype,"getRemoteSSRC",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"getRemoteSSRC"),wF.prototype),wF);function CF(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return await r.apply(this,s)}finally{n()}},n}function AF(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=sU(t.width),r.height=sU(t.height);const i=sU(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const a=r.getContext("2d");if(!a)throw new fO(AA.UNEXPECTED_ERROR,"can not get canvas context");const o=vO(),c=r.captureStream(o.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(aO.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}a.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=yP(()=>r.startCapture&&r.startCapture(),i);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),aO.debug("clean low stream renderer")},c}var RF=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(RF||{}),IF=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(IF||{}),OF=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(OF||{}),PF=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(PF||{}),kF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(kF||{}),DF=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(DF||{});const LF=1e3,jF=6,MF=3,UF=Math.max(jF,MF,60);function VF(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function FF(e){const t={[kF.CONN_TYPE]:0,[kF.RTT]:e.rtt,[kF.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[kF.CONN_TYPE]=1),"tcp"===n&&(t[kF.CONN_TYPE]=3),"tls"===n&&(t[kF.CONN_TYPE]=4);break}case"srflx":t[kF.CONN_TYPE]=2;break;case"unknown":t[kF.CONN_TYPE]=5;break;default:t[kF.CONN_TYPE]=0}return t}function BF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class GF extends WA{constructor(e){super(),uT(this,"store",void 0),uT(this,"uploadWRTCStatsTimer",void 0),uT(this,"uploadOutboundDenoiserStatsTimer",void 0),uT(this,"uploadExtStatsTimer",void 0),uT(this,"uploadExtUsageStatsTimer",void 0),uT(this,"uploadInboundExtStatsTimer",void 0),uT(this,"requestStats",void 0),uT(this,"requestTransportStats",void 0),uT(this,"requestLocalMedia",void 0),uT(this,"requestRemoteMedia",void 0),uT(this,"requestAllTracks",void 0),uT(this,"requestVideoIsReady",void 0),uT(this,"requestUploadStats",void 0),uT(this,"requestUpload",void 0),uT(this,"uploadOutboundStarted",!1),uT(this,"uploadInboundStarted",!1),uT(this,"uploadTransportStarted",!1),uT(this,"uploadBaseStatsStarted",!1),uT(this,"uploadExtensionUsageStarted",!1),uT(this,"lastRecvStats",void 0),uT(this,"lastSendStats",void 0),uT(this,"lastRefRecvStats",void 0),uT(this,"lastRefSendStats",void 0),uT(this,"lastNormalRecvStats",void 0),uT(this,"lastNormalSendStats",void 0),uT(this,"lastExtendStats",{}),uT(this,"needUploadStats",{}),uT(this,"needUploadRenderFreezeTime",!0),uT(this,"lastUploadCompensateTime",-1),uT(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const t=e%MF==0,n=e%jF==0,r=e%60==0;let i,s;if(this.uploadTransportStarted&&(i=this.requestStats(),this.store.useP2P&&(s=this.requestStats(!0))),!i&&this.uploadOutboundStarted&&(i=this.requestStats()),!s&&this.uploadInboundStarted&&(s=this.requestStats(!0)),i||s){var a;const o={};if(this.uploadTransportStarted&&i){const e=this.getTransportStats(i,s,t);e&&(o.misc=[e])}if(this.uploadOutboundStarted&&i){const e=this.getOutboundStats(i,n?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats,r);e&&(o.outbound=[e])}if(this.uploadInboundStarted&&s){this.uploadCompensateStats(e);const r=this.getInboundStats(s,n?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);r&&(o.inbound=r)}const c=null===(a=this.requestTransportStats)||void 0===a?void 0:a.call(this).connectState;c&&(Array.isArray(o.misc)?o.misc[0]&&o.misc[0].addition&&(o.misc[0].addition[DF.RTC_PEER_CONNECTION_STATE]=lI[c]):o.misc=[{addition:{[DF.RTC_PEER_CONNECTION_STATE]:lI[c]}}]),this.needUploadStats.sendType&&(Array.isArray(o.outbound)&&o.outbound[0]&&o.outbound[0].high&&(o.outbound[0].high[RF.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(o)}this.lastRecvStats=s,this.lastSendStats=i,n&&(this.lastNormalRecvStats=s,this.lastNormalSendStats=i),t&&(this.lastRefRecvStats=s,this.lastRefSendStats=i)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,n;const e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(n=this.requestUploadStats)||void 0===n||n.call(this,{misc:[{addition:{[DF.RTC_PEER_CONNECTION_STATE]:lI[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===UF+1&&(e=1)},LF)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const t=e%MF==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(-1===this.lastUploadCompensateTime)return void(this.lastUploadCompensateTime=Date.now());const n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;const i=this.requestStats(!0);new Array(r).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const e={};if(this.uploadInboundStarted&&i){const t=this.requestRemoteMedia()||[],n=[];t.forEach(e=>{let[t,r]=e;const s={peer:t.uid};if(t._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(t._videoSSRC)&&r.has(fM.VIDEO)&&t.videoTrack){const e=function(e,t,n){if(!t.videoRecv.find(t=>t.ssrc===e))return;const r={};if(n&&n._player){const e=n._player,{renderFreezeAccTime2:t,videoElementStatus:i}=e;if("visible"===ZD.visibility&&i===nP.PLAYING&&vO().supportRequestVideoFrameCallback){const n=Math.min(6e3,t);e.renderFreezeAccTime2=Math.max(0,t-n),VF(r,IF.Video_Render_Freeze_Time_Render2,n),AI("USE_NEW_RENDER_FREEZE_TIME")&&VF(r,IF.Video_Render_Freeze_Time_Render,n)}}return r}(t._videoSSRC,i,t.videoTrack);e&&(s.video=e)}s.video&&n.push(s)}),n.length>0&&(e.inbound=n,this.requestUploadStats(e))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,n){if(!this.requestStats)return;if(!n)return null==e.rtt?void 0:{addition:{[kF.RTT]:e.rtt,[kF.CONN_TYPE]:void 0,[kF.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=FF(e);if(this.store.useP2P){if(t){const e=FF(t);r[kF.CONN_TYPE]+=e[kF.CONN_TYPE]<<3}r[kF.CONN_TYPE]+=110}else r[kF.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n,r,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;const s=this.requestLocalMedia();if(!s||0===s.length)return;let a,o,c;return s.forEach(r=>{let[s,{track:l,ssrcs:d}]=r;switch(s){case _M.LocalVideoLowTrack:case _M.LocalVideoTrack:if(s===_M.LocalVideoTrack){var u;const r=function(e,t,n,r,i){const s=t.videoSend.find(t=>t.ssrc===e);if(!s)return;const a={},{sentFrame:o,inputFrame:c}=s;if(r&&(VF(a,IF.Video_Send_Qp_Sum,s.qpSumPerFrame),c&&o)){const e=c.frameRate,t=o.frameRate;a[IF.Video_Send_Freeze]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(i){switch(o&&(VF(a,OF.Video_Send_Height,o.height),VF(a,OF.Video_Send_Width,o.width),VF(a,OF.Video_Send_Frame_Rate,o.frameRate)),a[OF.Video_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0,s.adaptionChangeReason){case"none":a[OF.Video_Send_Adaptation]=0;break;case"cpu":a[OF.Video_Send_Adaptation]=1;break;case"bandwidth":a[OF.Video_Send_Adaptation]=2;break;case"other":a[OF.Video_Send_Adaptation]=3}let r=0;s.adaptionChangeReason&&(r+=BF(s.adaptionChangeReason)),t.qualityLimitationReason&&(r+=BF(t.qualityLimitationReason)<<3),a[OF.Video_Send_Adaptation]=r,a[OF.Video_Send_Player_Status]=iP[n._player?n._player.videoElementStatus:"uninit"],VF(a,OF.Video_Send_Nacks,s.nacksCount),VF(a,OF.Video_Send_Plis,s.plisCount),VF(a,OF.Video_Send_Firs,s.firsCount),VF(a,OF.Video_Send_Avg_Encode,s.avgEncodeMs),VF(a,OF.Video_Send_Huge_Frame_Sent,s.hugeFramesSent),VF(a,OF.Video_Send_Bytes_Retransmit,s.retransmittedBytesSent),VF(a,OF.Video_Send_Packages_Retransmit,s.retransmittedPacketsSent),VF(a,OF.Video_Send_Key_Frames_Encoded,s.keyFramesEncoded);const c=i.videoSend.find(t=>t.ssrc===e);if(c){let e=LF*MF;c.timestamp&&s.timestamp&&(e=s.timestamp-c.timestamp),null!=c.packets&&null!=s.packets&&VF(a,OF.Video_Send_Package_Rate,1e3*(s.packets-c.packets)/e),null!=s.packetsLost&&null!=c.packetsLost&&VF(a,OF.Video_Send_Package_Lost,s.packetsLost-c.packetsLost),null!=c.bytes&&null!=s.bytes&&VF(a,OF.Video_Send_Bitrate,8*(s.bytes-c.bytes)/e)}}return a}(d[0].ssrcId,e,l,t,n),s="CameraVideoTrack"===l.__className__?3:Dr(u=l._hints).call(u,UO.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==s||i)&&(this.needUploadStats={sendType:s},this.lastExtendStats.sendType=s);const a=l&&function(e,t,n,r){const i=t.videoSend.find(t=>t.ssrc===e);if(!i)return null;const s={};if(r){const e=i.inputFrame,t=e&&e.height||n.videoHeight||0,r=e&&e.width||n.videoWidth||0,a=e&&e.frameRate||0;VF(s,OF.Video_Capture_Height,t),VF(s,OF.Video_Capture_Width,r),VF(s,OF.Video_Capture_Frame_Rate,a)}return s}(d[0].ssrcId,e,l,!!n),c=function(e,t){const n={};return t&&(VF(n,OF.Video_Send_Retransmit,e.bitrate.retransmit),VF(n,OF.Video_Send_Target_Encoded,e.bitrate.targetEncoded),VF(n,OF.Video_Send_Actual_Encoded,e.bitrate.actualEncoded),VF(n,OF.Video_Send_Transmit,e.bitrate.transmit),VF(n,OF.Video_Send_Bandwidth,e.sendBandwidth)),n}(e,!!n);o=Object.assign({},r,a,c)}else c=function(e,t,n,r){const i=t.videoSend.find(t=>t.ssrc===e);if(!i)return;const s={};if(r){const t=i.sentFrame;t&&(VF(s,OF.Video_Send_Low_Height,t.height),VF(s,OF.Video_Send_Low_Width,t.width),VF(s,OF.Video_Send_Low_Frame_Rate,t.frameRate));const n=r.videoSend.find(t=>t.ssrc===e);if(n){let e=LF*jF;n.timestamp&&i.timestamp&&(e=i.timestamp-n.timestamp),null!=n.packets&&null!=i.packets&&VF(s,OF.Video_Send_Low_Package_Rate,1e3*(i.packets-n.packets)/e),null!=i.packetsLost&&null!=n.packetsLost&&VF(s,OF.Video_Send_Low_Package_Lost,i.packetsLost-n.packetsLost),null!=n.bytes&&null!=i.bytes&&VF(s,OF.Video_Send_Low_Bitrate,8*(i.bytes-n.bytes)/e)}}return s}(d[0].ssrcId,e,0,n);break;case _M.LocalAudioTrack:a=l&&function(e,t,n,r,i){const s=t.audioSend.find(t=>t.ssrc===e);if(!s)return;const a={};if(i){a[OF.Audio_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0;const t=100*n._source.getAccurateVolumeLevel(),r=s.inputLevel;if(null!=r){const e=Math.ceil(50*Math.log10(100*r+1));VF(a,OF.Audio_Send_Level,e)}VF(a,OF.Audio_Capture_PCM_Level,t),VF(a,OF.Audio_Send_AEC_Return_Loss,s.aecReturnLoss),VF(a,OF.Audio_Send_AEC_Return_Loss_Enhancement,s.aecReturnLossEnhancement),VF(a,OF.Audio_Send_Bytes_Retransmit,s.retransmittedBytesSent),VF(a,OF.Audio_Send_Packages_Retransmit,s.retransmittedPacketsSent),a[OF.Audio_Send_Freeze]=0;const o=i.audioSend.find(t=>t.ssrc===e);if(o){let e=LF*jF;o.timestamp&&s.timestamp&&(e=s.timestamp-o.timestamp),null!=o.bytes&&null!=s.bytes&&VF(a,OF.Audio_Send_Bitrate,8*(s.bytes-o.bytes)/e),null!=o.packets&&null!=s.packets&&VF(a,OF.Audio_Send_Package_Rate,1e3*(s.packets-o.packets)/e)}}return a}(d[0].ssrcId,e,l,0,n)}}),{high:o,low:c,audio:a}}getInboundStats(e,t,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],s=[];return i.forEach(i=>{let[a,o]=i;const c={peer:a.uid};if(o.has(fM.VIDEO)&&a.videoTrack){const i=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,s=a.videoTrack?function(e,t,n,r,i,s,a,o){const c=t.videoRecv.find(t=>t.ssrc===e);if(!c)return;const l={},{receivedFrame:d,outputFrame:u,decodeFrameRate:h}=c;VF(l,PF.Video_Render_Frame_Rate_Decode,h),c.framesRateFirefox&&VF(l,PF.Video_Recv_Frame_Rate,c.framesRateFirefox),d&&VF(l,PF.Video_Recv_Frame_Rate,d.frameRate),VF(l,PF.Video_Recv_Frame_Dropped,c.framesDroppedCount),VF(l,PF.Video_Recv_Bytes_Retransmit,c.retransmittedBytesReceived),VF(l,PF.Video_Recv_Packages_Retransmit,c.retransmittedPacketsReceived),VF(l,PF.Video_Recv_Packages_Discarded,c.packetsDiscarded),VF(l,PF.Video_Recv_Avg_Decode,c.avgDecodeMs),VF(l,PF.Video_Recv_Avg_Processing_Delay,c.avgProcessingDelayMs),VF(l,PF.Video_Recv_Avg_Assembly_Time,c.avgFramesAssembledFromMultiplePacketsMs),VF(l,PF.Video_Recv_Avg_Inter_Frame_Delay,c.avgInterFrameDelayMs),VF(l,PF.Video_Recv_Key_Frames_Decoded,c.keyFramesDecoded);const p=o&&o.videoRecv.find(t=>t.ssrc===e);if(p){const e=t.timestamp-o.timestamp||LF;null!=c.packetsLost&&null!=p.packetsLost&&VF(l,PF.Video_Recv_Package_Lost,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&VF(l,PF.Video_Recv_Bitrate,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&VF(l,PF.Video_Recv_Package_Rate,1e3*(c.packets-p.packets)/e)}const m=s&&s.videoRecv.find(t=>t.ssrc===e);if(m&&(VF(l,IF.Video_Recv_Qp_Sum,c.qpSumPerFrame),l[IF.Video_Recv_Freeze]=r&&XV.isRemoteVideoFreeze(n,c,m)?1:0),a){var f;const t=a.videoRecv.find(t=>t.ssrc===e);d?(VF(l,OF.Video_Recv_Height,d.height),VF(l,OF.Video_Recv_Width,d.width)):n&&(VF(l,OF.Video_Recv_Height,n._videoHeight||0),VF(l,OF.Video_Recv_Width,n._videoWidth||0)),u&&VF(l,OF.Video_Recv_Frame_Rate_Output,u.frameRate);const r=null===(f=n._player)||void 0===f?void 0:f.rendFrameRate.toFixed(0);if(r&&VF(l,OF.Video_Render_Frame_Rate_Render,+r),VF(l,OF.Video_Recv_Jitter_Buffer,c.jitterBufferMs),VF(l,OF.Video_Recv_Current_Delay,c.currentDelayMs),VF(l,OF.Video_Recv_Firs,c.firsCount),VF(l,OF.Video_Recv_Nacks,c.nacksCount),VF(l,OF.Video_Recv_Plis,c.plisCount),n){l[OF.Video_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1;const e=n._player;if(e){const{freezeTimeCounterList:n,renderFreezeAccTime:r,renderFreezeAccTime2:s,videoElementStatus:a}=e;if(n&&n.length>0&&VF(l,IF.Video_Render_Freeze_Time,n.splice(0,1)[0]),i&&"visible"===ZD.visibility&&a===nP.PLAYING&&vO().supportRequestVideoFrameCallback){const t=Math.min(6e3,s);e.renderFreezeAccTime2=Math.max(0,s-t),VF(l,IF.Video_Render_Freeze_Time_Render2,t);const n=Math.min(6e3,r);e.renderFreezeAccTime=Math.max(0,r-n),VF(l,IF.Video_Render_Freeze_Time_Render,AI("USE_NEW_RENDER_FREEZE_TIME")?t:n)}if("number"==typeof c.totalFreezesDuration){const e=t&&t.totalFreezesDuration?c.totalFreezesDuration-t.totalFreezesDuration:c.totalFreezesDuration;VF(l,OF.Video_Render_Freeze_Duration,1e3*e)}}}if(l[OF.Video_Recv_Player_Status]=iP[n._player?n._player.videoElementStatus:"uninit"],t&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-t.totalInterFrameDelay,n=c.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,r=c.framesDecodeCount-t.framesDecodeCount,i=e/r*1e3,s=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/r)/r));!isNaN(s)&&i+s>Math.max(3*i,i+150)&&(l[OF.Video_Recv_I_Frame_Delay]=s)}}return l}(a._videoSSRC,e,a.videoTrack,!0===i,this.needUploadRenderFreezeTime,t,n,r):void 0;s&&(c.video=s)}if(o.has(fM.AUDIO)&&a.audioTrack){const i=a.audioTrack?function(e,t,n,r,i,s){const a=t.audioRecv.find(t=>t.ssrc===e);if(!a)return;const o={};VF(o,PF.Audio_Recv_Jitter,a.jitterMs),VF(o,PF.Audio_Recv_Bytes_Retransmit,a.retransmittedBytesReceived),VF(o,PF.Audio_Recv_Packages_Retransmit,a.retransmittedPacketsReceived),VF(o,PF.Audio_Recv_Packages_Discarded,a.packetsDiscarded),VF(o,PF.Audio_Recv_Avg_Processing_Delay,a.avgProcessingDelayMs);const c=s&&s.audioRecv.find(t=>t.ssrc===e);if(c){const e=LF;null!=a.packets&&null!=c.packets&&VF(o,PF.Audio_Recv_Package_Rate,1e3*(a.packets-c.packets)/e),null!=a.packetsLost&&null!=c.packetsLost&&VF(o,PF.Audio_Recv_Package_Lost,a.packetsLost-c.packetsLost)}if(r){const{receivedFrames:e,droppedFrames:t}=a;null!=e&&null!=t&&(o[IF.Audio_Recv_Freeze]=0===(l=e)||100*t/l>20?1:0)}var l;if(i){const t=100*n._source.getAccurateVolumeLevel(),r=a.outputLevel;if(null!=r){const e=Math.ceil(50*Math.log10(100*r+1));VF(o,OF.Audio_Render_Level,e)}VF(o,OF.Audio_Recv_PCM_Level,t),n&&(o[OF.Audio_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1),VF(o,OF.Audio_Recv_Jitter_Buffer,a.jitterBufferMs),VF(o,OF.Audio_Recv_Current_Delay,a.jitterBufferMs),o[OF.Audio_Recv_Player_Status]=iP[UP.getPlayerState(n.getTrackId())];const s=i.audioRecv.find(t=>t.ssrc===e);if(s){null!=s.bytes&&null!=a.bytes&&VF(o,OF.Audio_Recv_Bitrate,8*(a.bytes-s.bytes)/(LF*MF));const e=a.concealedSamples-s.concealedSamples;e>0&&VF(o,OF.Audio_Recv_Concealed_Samples,e);const t=a.totalSamplesReceived-s.totalSamplesReceived;t>0&&VF(o,OF.Audio_Recv_Total_Samples_Received,t);const n=a.freezeSamples80-s.freezeSamples80;n>0&&VF(o,OF.Audio_Render_Freeze_Samples_80ms,n);const r=a.freezeSamples200-s.freezeSamples200;r>0&&VF(o,OF.Audio_Render_Freeze_Samples_200ms,r);const i=a.freezeMs80-s.freezeMs80;VF(o,OF.Audio_Render_Freeze_Time_80ms,i<0?0:i);const c=a.freezeMs200-s.freezeMs200;VF(o,OF.Audio_Render_Freeze_Time_200ms,c<0?0:c)}}return o}(a._audioSSRC,e,a.audioTrack,t,n,r):void 0;i&&(c.audio=i)}(c.video||c.audio)&&s.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,s}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(e=>e instanceof Bk);if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(Uj.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach(e=>{let[t,n]=e;n.has(fM.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}),n.has(fM.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const t=Date.now(),n={connectionInterval:AI("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let r=[];const i=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));const s=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of s)c.has(fM.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),c.has(fM.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){const n={};for(const{id:a,value:o,level:c,direction:l}of e){var r;const e=null!==(r=t.get(a))&&void 0!==r?r:0,d=2===o?e+AI("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,s;t.set(a,d),n[a]?(2===o&&(n[a].value=o),c>n[a].level&&(n[a].level=c),"remote"===l&&(n[a].remoteUidCount+=1),n[a].totalTs=null!==(i=t.get(a))&&void 0!==i?i:0):n[a]={value:o,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(s=t.get(a))&&void 0!==s?s:0}}return Object.keys(n).map(e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}})}(r,e);const a=Date.now(),o=a>t?a:t+1;this.requestUpload&&this.requestUpload(Uj.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:o})},AI("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const HF=AI("ICE_RESTART_INTERVAL");let WF=new Map,zF=new Map,KF=[gM.UDP_TCP_RELAY,gM.TCP_RELAY,gM.RELAY],qF=AI("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vO().supportPCSetConfiguration;function YF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=WF.get(e.id);n&&(window.clearTimeout(n),WF.delete(e.id));const r=zF.get(e.id);t&&r&&r.index===KF.length-1&&(aO.debug("[".concat(e.id,"] reset ICE restart policy")),zF.delete(e.id))}function XF(e,t,n){if(0===WF.size&&0===zF.size&&(Array.isArray(AI("RESTART_SEQUENCE"))&&AI("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const r=e[n];if(e.filter(e=>e===r).length!==t.filter(e=>e===r).length)return!1}return!0}(KF,AI("RESTART_SEQUENCE"))&&(KF=AI("RESTART_SEQUENCE").filter(e=>{var t;if(Dr(t=Object.values(gM)).call(t,e))return!0}),aO.debug("use reconnection policy from config distribution, queues: ".concat(KF.join(" => ")))),qF=AI("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vO().supportPCSetConfiguration),0===KF.length)return void n();let r,{index:i=0,type:s}=zF.get(e.id)||{};if(qF&&s===gM.RELAY)return void n();let a=s&&i>=KF.length-1;if(qF)s=gM.RELAY;else{if(a)return void n();s?(i++,s=KF[i]):(s=KF[0],i=0)}aO.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),zF.set(e.id,{index:i,type:s}),r=window.setTimeout(()=>XF(e,t,n),HF),WF.set(e.id,r)}var JF;function QF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ZF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QF(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $F(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=ZN,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new eB(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function eB(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then(function(e){return{value:e,done:t}})}return eB=function(e){this.s=e,this.n=e.next},eB.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new eB(e)}let tB=(JF=class extends WA{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(bM.StateChange,t,this._state)}constructor(e,t){super(),uT(this,"isPlanB",void 0),uT(this,"store",void 0),uT(this,"statsUploader",void 0),uT(this,"connection",void 0),uT(this,"localTrackMap",new Map),uT(this,"remoteUserMap",new Map),uT(this,"localDataChannels",[]),uT(this,"remoteDataChannelMap",new Map),uT(this,"pendingLocalTracks",[]),uT(this,"pendingRemoteTracks",[]),uT(this,"pendingLocalDataChannels",[]),uT(this,"pendingRemoteDataChannels",[]),uT(this,"statsCollector",void 0),uT(this,"shouldForwardP2PCreation",void 0),uT(this,"iceFailedCount",0),uT(this,"dtlsFailedCount",0),uT(this,"mutex",void 0),uT(this,"_state",EM.Disconnected),uT(this,"_pcStatsUploadType",AI("NEW_ICE_RESTART")?vM.FIRST_CONNECTION:vM.OLD_FIRST_CONNECTION),uT(this,"_isStartRestartIce",!1),uT(this,"_restartTimer",void 0),uT(this,"_isTryConnecting",!1),uT(this,"_iceError",null),uT(this,"_forceTurn",!1),uT(this,"_isWaitPcToRePub",!1),uT(this,"handleMuteLocalTrack",async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==EM.Connected)return void n(new RA(AA.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find(e=>"videoLowTrack"===e[0]);if(i){const e=i[1];this.store.enableInstantMuteRestore?(e.track._originMediaStreamTrack.enabled=!1,aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):e.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(r.map(e=>{let[,{id:t}]=e;return t}));const s=this.createMuteMessage(r);await aR(this,bM.RequestMuteLocal,s),t()}catch(e){n(e)}finally{r()}}),uT(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==EM.Connected)return void n(new RA(AA.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find(e=>"videoLowTrack"===e[0]);if(i){const t=i[1];if(this.store.enableInstantMuteRestore)t.track._originMediaStreamTrack.enabled=!0,aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(t.track._originMediaStreamTrack.stop(),!AI("DISABLE_DUAL_STREAM_USE_ENCODING")&&vO().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=AF(e,cR(this,bM.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(r.map(e=>{let[,{id:t}]=e;return t}));const s=this.createUnmuteMessage(r);await aR(this,bM.RequestUnmuteLocal,s),t()}catch(e){n(e)}finally{r()}}),uT(this,"handleUpdateVideoEncoder",async(e,t,n,r)=>{let i;r||(i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(bM.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}}),uT(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}}),uT(this,"handleReplaceMixingTrack",async(e,t,n,r)=>{if(!this.connection||this.state!==EM.Connected)return void t();const i=yF([e]);let s;aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(i.getTrackId(),"]")),"boolean"==typeof r&&r||(s=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,i),t()}catch(e){n(e)}finally{var a;null===(a=s)||void 0===a||a()}}),uT(this,"handleReplaceTrack",async(e,t,n,r)=>{let i;aO.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var s;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.connection||!n||this.state!==EM.Connected)return void t();if(await(null===(s=this.connection)||void 0===s?void 0:s.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===_M.LocalVideoTrack&&!AI("DISABLE_DUAL_STREAM_USE_ENCODING")&&vO().supportDualStreamEncoding){const t=this.localTrackMap.get(_M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}}),uT(this,"handleGetRTCStats",e=>{e(this.statsCollector.getRTCStats())}),uT(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uT(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uT(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uT(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(this.store),this.bindStatsUploaderEvents(),this.mutex=new UR("P2PChannel-mutex",this.store.clientId),this.isPlanB=!vO().supportUnifiedPlan||AI("CHROME_FORCE_PLAN_B")&&xA(),this.shouldForwardP2PCreation=AI("FORWARD_P2P_CREATION")&&vO().supportPCSetConfiguration&&bA(),this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=EM.New,this._forceTurn=xF(e),aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=EF(this.store,e),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new RA(AA.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=AI("NEW_ICE_RESTART")?vM.FIRST_CONNECTION:vM.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new RA(AA.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===EM.Connected){if(this.connection instanceof NF&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),mO.reportApiInvoke(this.store.sessionId,{name:qA.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:YA.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(bM.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EM.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(e=>{var t;let[n]=e;return Dr(t=[_M.LocalVideoLowTrack,_M.LocalVideoTrack]).call(t,n)}),n=t.map(e=>{let[,{id:t}]=e;return t}),r=t.map(e=>{let[t]=e;return t});if(this.connection instanceof NF){if(mO.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Dr(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find(t=>Dr(e).call(e,t));t&&(this.store.codec=t,aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof NF&&"closed"!==this.connection.peerConnectionState&&Dr(e=[EM.New,EM.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==EM.Connected){if(this.state===EM.Disconnected)throw new RA(AA.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(e=>{var t;Dr(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach(e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)}),e.map(e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId})))}publish(e,t,n){var r=this;return YN(function*(){const i=yield JN(r.mutex.lock("From P2PChannel.publish"));try{var s;const i=r.connection&&Dr(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==EM.Connected||i){if(r.state===EM.Disconnected)throw new RA(AA.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===r.pendingLocalTracks.indexOf(e));return r.pendingLocalTracks=r.pendingLocalTracks.concat(t),void(i&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,KV.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(0===a.length)return void(yield JN(r.tryToUnmuteAudio(e)));yield*QN($F(r.doPublish(r.connection,a)))}finally{i()}})()}doPublish(e,t){var n=this;return YN(function*(){t.forEach(e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===_M.LocalAudioTrack?"audio":"video",i)}),n.bindLocalTrackEvents(t);const r=t.map(e=>{let{track:t}=e;return t}),i=yield JN(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield JN(i.next())).value,a=n.createGatewayPublishMessage(t,s);let o;try{o=yield a}catch(e){throw i.throw(e),(null==e?void 0:e.code)===AA.WS_ABORT&&t.forEach(e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)}),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(a,o,r),l=(yield JN(i.next(c))).value;if(n.state===EM.Disconnected)throw new RA(AA.UNEXPECTED_ERROR,"PeerConnection already disconnected.");AI("ENABLE_VIDEO_SEI");const d=AI("ENABLE_ENCODED_TRANSFORM"),u=AI("ENABLE_AUDIO_METADATA");r.forEach(async e=>{const t=e.getRTCRtpTransceiver();if(!t||!d)return;const{interceptLocalVideoFrame:n,interceptLocalAudioFrame:r}=ZU();e.trackMediaType===fM.VIDEO?await n(t.sender,e):e.trackMediaType===fM.AUDIO&&await r(t.sender,{metadata:u?()=>{const t=e.metadata.shift();return t&&t.value}:void 0})}),t.forEach(e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)}),n.assignLocalTracks(t,l),n.statsUploader.startUploadOutboundStats(),t.forEach(e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===_M.LocalAudioTrack?"audio":"video",void 0,i)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof DD))return aO.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=dU(e,t)),n.maxFramerate=e.framerate?sU(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==_M.LocalVideoLowTrack||!AI("DISABLE_DUAL_STREAM_USE_ENCODING")&&vO().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=r._originMediaStreamTrack;if(!t.canvas)return aO.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=sU(t.width)),t.height&&(n.height=sU(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=yP(()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()},sU(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),aO.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return YN(function*(){if(!t.connection||t.state!==EM.Connected)return;const n=yield JN(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(_M.LocalVideoTrack);if(!n)throw new RA(AA.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(_M.LocalVideoLowTrack))throw new RA(AA.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:_M.LocalVideoLowTrack}];if(yield*QN($F(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get(_M.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield JN(t.connection.muteLocal([e])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await sR(this,bM.RequestRePublish,this.pendingLocalTracks),this.emit(bM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(aO.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await sR(this,bM.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==fM.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==fM.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await sR(this,bM.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===fM.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(bM.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==EM.Connected)return void e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)});const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==EM.Connected)return void e.forEach(e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)});const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach(e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)}),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map(e=>e.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==EM.Connected)return;const e=this.localTrackMap.get(_M.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[_M.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==EM.Connected)throw new RA(AA.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))});if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach(t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const r=this.pendingRemoteDataChannels.findIndex(n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id});-1!==r&&this.pendingRemoteDataChannels.splice(r,1)}),n.map(e=>e.id)}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==EM.Connected)throw new RA(AA.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(s=this.remoteUserMap.get(e))&&void 0!==s&&s.has(t))return;let a,o,c,l;const d=this.connection.getPreMedia(n);if(d)aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=d.transceiver,a=d.track,o=d.mid,l=d.player,d.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:d.firstVideoRender});else if(i){const n=i.find(e=>{let{stream_type:n}=e;return n===t});if(!n)throw new RA(AA.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof NF&&(c=r.transceiver),a=r.track,o=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof NF&&(c=i.transceiver),a=i.track,o=i.id}if(t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new QD(a,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new JD(a,e.uid,e._uintid,this.store,l),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(WO.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(WO.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),l?e._videoTrack.once(WO.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(WO.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&AI("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:n,interceptRemoteAudioFrame:r}=ZU();t==fM.VIDEO?await n(c.receiver,{onSei:AI("ENABLE_VIDEO_SEI")&&(t=>{var n;return null===(n=e._videoTrack)||void 0===n?void 0:n._onSei(t)})}):t==fM.AUDIO&&await r(c.receiver,{enableTopn:!!AI("ENABLE_AUDIO_TOPN"),enableMetadata:!!AI("ENABLE_AUDIO_METADATA"),enablePts:!!AI("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(bM.AudioMetadata,e)},onPts:e=>{this.safeEmit(bM.AudioPts,e)}})}const u=this.remoteUserMap.get(e);u?u.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const h=this.pendingRemoteTracks.findIndex(n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i});-1!==h&&(this.pendingRemoteTracks.splice(h,1),this.emit(bM.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==EM.Connected)throw new RA(AA.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))});const t=[],n=new Map;e.forEach(e=>{if(!this.connection)return;const r=this.connection.getPreMedia(e.ssrcId);if(r){const{track:t,mid:i,transceiver:s,player:a}=r;n.set(e.ssrcId,{track:t,id:i,transceiver:s,player:a})}else t.push(e)});const r=await this.connection.batchReceive(t.map(e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}}));t.forEach((e,t)=>{n.set(e.ssrcId,r[t])});for(const{user:i,mediaType:s,ssrcId:a}of e){const e=n.get(a);if(!e)return void aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(a));const{track:t,id:r,transceiver:o,player:c}=e;if(o&&AI("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();s==fM.VIDEO?await e(o.receiver,{onSei:AI("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=i._videoTrack)||void 0===t?void 0:t._onSei(e)})}):s==fM.AUDIO&&await t(o.receiver,{enableTopn:!!AI("ENABLE_AUDIO_TOPN"),enableMetadata:!!AI("ENABLE_AUDIO_METADATA"),enablePts:!!AI("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(bM.AudioMetadata,e)},onPts:e=>{this.safeEmit(bM.AudioPts,e)}})}if(s===fM.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(t):(i._audioTrack=new QD(t,i.uid,i._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),o&&i._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(t):(i._videoTrack=new JD(t,i.uid,i._uintid,this.store,c),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),o&&i._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(i,i._videoTrack)),AI("ENABLE_VIDEO_SEI")&&o){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();s==fM.VIDEO?await e(o.receiver,{onSei:e=>{var t;null===(t=i._videoTrack)||void 0===t||t._onSei(e)}}):s==fM.AUDIO&&await t(o.receiver)}const l=this.remoteUserMap.get(i);l?l.set(s,r):this.remoteUserMap.set(i,new Map([[s,r]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const d=this.pendingRemoteTracks.findIndex(e=>{let{user:t,kind:n}=e;return t.uid===i.uid&&s===n});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(bM.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid});if(r.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.connection&&this.state===EM.Connected||n||r.forEach(t=>{let{kind:n}=t;var r;if(n===fM.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===fM.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==EM.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map(e=>{let[,{id:t}]=e;return t}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach(e=>{let[t,{kind:r}]=e;var i,s;if(r===fM.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(s=t._videoTrack)||void 0===s||s._destroy(),t._videoTrack=void 0);else if(r===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(e=>{const t=this.pendingRemoteDataChannels.findIndex(t=>t.id===e.id);-1!==t&&this.pendingRemoteDataChannels.splice(t,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach(e=>{e._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(e=>{r&&r.delete(e.id)}),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(e=>e.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const e=this.pendingRemoteTracks.filter(e=>{let{user:t,kind:n}=e;return void 0!==s?t.uid===i.uid&&s===n:t.uid===i.uid});e.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),t=t.concat(e)}if(!this.connection||this.state!==EM.Connected)return void t.forEach(e=>{let{user:t,kind:n}=e;var r;if(n===fM.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===fM.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}});const n=ii(e).call(e,(e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)},[]);if(0===n.length)return;await this.connection.stopReceiving(n.map(e=>{let[,{id:t}]=e;return t}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach(e=>{let[t,{kind:n}]=e;var r,i;if(n===fM.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===fM.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0}}),r}isPreSubScribe(e){return!(!this.connection||this.state!==EM.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(_M.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(_M.LocalAudioTrack);if((null==t?void 0:t.track)instanceof Hk){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==_M.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(_M.LocalAudioTrack),s=r?this.localTrackMap.get(_M.LocalVideoLowTrack):this.localTrackMap.get(_M.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:KV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==s?void 0:s.track.getTrackLabel(),screenshare:-1!==(null==s?void 0:s.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!n,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const a=n.find(e=>e instanceof Fk),o=r?null===(s=this.localTrackMap.get(_M.LocalVideoTrack))||void 0===s?void 0:s.track:n.find(e=>e instanceof DD);mO.publish(this.store.sessionId,{eventElapse:KV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===fM.VIDEO?n._videoSSRC:n._audioSSRC;i&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===fM.VIDEO,audio:r===fM.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:KV.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new UR("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(_M.LocalAudioTrack);if((null==e?void 0:e.track)instanceof Hk){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=EM.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof DD||t&&t.track instanceof Fk?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(_M.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.connection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=EM.Reconnecting,AI("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case _M.LocalVideoTrack:Dr(t=r._hints).call(t,UO.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case _M.LocalAudioTrack:r instanceof Hk?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case _M.LocalVideoLowTrack:}}),this.emit(bM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XI(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(bM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XI(n).call(n)).forEach(e=>{this.setPendingRemoteDataChannel(t,e)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof ZV?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof ZV?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return YN(function*(){if(!t.connection||t.state!==EM.Connected)return;const n=yield JN(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield JN(t.connection.restartICE(e));const n=yield JN(r.next());if(n.done)return;const i=n.value,s=yield i;switch(bF(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case gM.UDP_TCP_RELAY:t._pcStatsUploadType=vM.UDP_TCP_RESTART;break;case gM.TCP_RELAY:t._pcStatsUploadType=vM.TCP_RESTART;break;case gM.RELAY:t._pcStatsUploadType=vM.RELAY_RESTART;break;default:t._pcStatsUploadType=vM.OLD_RESTART}t._isTryConnecting=!0,r.next(s)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalAudioTrack),r=e.videoSend.find(e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const s=oR(this,bM.NeedSignalRTT),a=r?r.rttMs:void 0,o=i?i.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&s?(c+s)/2:c||s)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return GL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===i),o=e.videoRecv.find(e=>e.ssrc===s);if(!a&&!o)return void(t+=1);const c=oR(this,bM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(aO.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==EM.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===_M.LocalVideoTrack&&!AI("DISABLE_DUAL_STREAM_USE_ENCODING")&&vO().supportDualStreamEncoding){const t=this.localTrackMap.get(_M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=uR(e=e.filter(e=>-1===i.indexOf(e)));let s,a=!1;const o=this.localTrackMap.get(_M.LocalAudioTrack);for(const c of e){if(c instanceof DD&&(this.localTrackMap.has(_M.LocalVideoTrack)||a?new RA(AA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:_M.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:_M.LocalVideoLowTrack})}if(c instanceof Fk)if(o){const e=o.track;if(e instanceof Hk)vF([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=yF([e,c]);aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else s instanceof Hk?(vF([c]),s.addAudioTrack(c)):s=s||!c._useAudioElement&&vO().webAudioMediaStreamDest&&!c._bypassWebAudio?yF(s?[c,s]:[c]):c}return s&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:_M.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=uR(e=e.filter(e=>-1!==n.indexOf(e)));for(const r of e){if(r instanceof Fk){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(!e)continue;e.track instanceof Hk?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([_M.LocalAudioTrack,e]),e.track.close())):t.push([_M.LocalAudioTrack,e])}if(r instanceof DD){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(!e)continue;t.push([_M.LocalVideoTrack,e]);const n=this.localTrackMap.get(_M.LocalVideoLowTrack);n&&t.push([_M.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=uR(e)).filter(e=>-1===this.localDataChannels.findIndex(t=>t.id===e.id))}filterTobeUnpublishedDataChannels(e){return(e=(e=uR(e)).filter(e=>-1!==this.localDataChannels.indexOf(e))).filter(e=>e._originDataChannel)}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Hk?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.GET_RTC_STATS,this.handleGetRTCStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Hk?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var r;let i,s,{track:a,type:o}=e;switch(o){case _M.LocalAudioTrack:i=rM.Audio,s={dtx:a instanceof Bk&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case _M.LocalVideoTrack:i=Dr(r=a._hints).call(r,UO.SCREEN_TRACK)?rM.Screen:rM.High,s=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()});break;case _M.LocalVideoLowTrack:i=rM.Low,s=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()})}return{stream_type:i,attributes:s,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:s,id:a}]=e;switch(r){case _M.LocalVideoTrack:n=Dr(t=i._hints).call(t,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalAudioTrack:n=rM.Audio;break;case _M.LocalVideoLowTrack:n=rM.Low}return{stream_type:n,ssrcs:s,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(bM.PeerConnectionStateChange,t),"connecting"===t&&e instanceof NF&&!nA()&&AI("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{"connecting"===t&&e.extendCandidate()},AI("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof NF&&YF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=vM.DISCONNECTED_OR_FAILED,"CONNECTED"===oR(this,bM.QueryClientConnectionState)&&this._isWaitPcToRePub)){const e=this.pendingLocalTracks.map(e=>e.getTrackId()),t=this.pendingLocalDataChannels.map(e=>"dc_".concat(e.id));mO.reportApiInvoke(this.store.sessionId,{name:qA.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:YA.TRACER}).onSuccess(),this.republish()}if(AI("NEW_ICE_RESTART")&&e instanceof NF&&!nA()&&!this._forceTurn){if(Dr(yM).call(yM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{bF(e)&&(aO.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===oR(this,bM.QueryClientConnectionState)&&this.emit(bM.RequestRestartICE,t))},n=()=>{bF(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),aO.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{XF(e,t,n)},800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&AI("ICE_RESTART")&&"CONNECTED"===oR(this,bM.QueryClientConnectionState)&&this.emit(bM.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);"failed"===t&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YA.TRACER}).onSuccess(),this.emit(bM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(WO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{var r;const i=Array.from(XI(r=this.remoteUserMap).call(r)).find(t=>t._videoSSRC===e);i&&this.store.firstVideoFrameDecoded(i.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoRender=e=>{var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(n))},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstReceived:Date.now()}),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(bM.ConnectionTypeChange,n),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return ZF(ZF({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){e instanceof NF&&function(e){zF.delete(e.id),YF(e)}(e),e.close(),this.emit(bM.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Hk)return n.track.isActive||t.push([_M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r&&(t.push(r),r[0]===_M.LocalVideoTrack)){const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Hk)return n.track.isActive&&t.push([_M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r)if(r[0]===_M.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:s,id:a}]=e;switch(r){case _M.LocalAudioTrack:n=rM.Audio;break;case _M.LocalVideoTrack:n=Dr(t=i._hints).call(t,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalVideoLowTrack:n=rM.Low}return{stream_type:n,ssrcs:s,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:s,id:a}]=e;switch(r){case _M.LocalAudioTrack:n=rM.Audio;break;case _M.LocalVideoTrack:n=Dr(t=i._hints).call(t,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalVideoLowTrack:n=rM.Low}return{stream_type:n,ssrcs:s,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:r,id:i}]=e;switch(r){case fM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:n._videoSSRC}));case fM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===fM.VIDEO?e|=aM.Video:e|=aM.Audio,t.set(n,e)}else r===fM.VIDEO?t.set(n,aM.Video):t.set(n,aM.Audio)}),{users:Array.from(t.entries()).map(e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}})}}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)}))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}isPreallocation(){return this.connection instanceof NF&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof NF&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((e,r)=>{var i;let{stream_type:s}=e;const a=null===(i=t.find(e=>{let{stream_type:t}=e;return s===t}))||void 0===i?void 0:i.attributes;if(a&&AI("DISABLE_SCREEN_SHARE_REMB")){const e=n[r]._hints;(Dr(e).call(e,UO.SCREEN_TRACK)||Dr(e).call(e,UO.SCREEN_LOW_TRACK))&&(a.remb=!1,aO.debug("disable remb for screen share, hints:",e))}return a})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Fk){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map(e=>{let[,{id:t}]=e;return t})));const i=this.createUnmuteMessage(r);return void await aR(this,bM.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(bM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(bM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await SR(BR(this.dtlsFailedCount,FR)),this.emit(bM.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await sR(this,bM.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(bM.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(_M.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof DD)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof DD).length>1)throw new RA(AA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Fk).length>1&&(e.some(e=>e instanceof Fk&&e._bypassWebAudio)||!vO().webAudioMediaStreamDest))throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof DD&&this.pendingLocalTracks.some(e=>e instanceof DD))throw new RA(AA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fk&&this.pendingLocalTracks.some(e=>e instanceof Fk)&&(!vO().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Fk&&e._bypassWebAudio)))throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!AI("DISABLE_DUAL_STREAM_USE_ENCODING")&&vO().supportDualStreamEncoding,i=ZF(ZF({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():AF(e,i);const a=TR(8,"track-low-"),o=new DD(s,ZF(ZF({},r&&{scaleResolutionDownBy:dU(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return o.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),o._hints.push(UO.LOW_STREAM),Dr(n=e._hints).call(n,UO.SCREEN_TRACK)&&o._hints.push(UO.SCREEN_LOW_TRACK),e.on("sei-to-send",e=>{o.emit("sei-to-send",e)}),e.addListener(MO.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof NF){var i,s,a,o;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();mO.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(s=h.candidateType)&&void 0!==s?s:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(o=p.candidateType)&&void 0!==o?o:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(t=>t.userId===e.uid);if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:a,peerPublishDuration:o,peerPubStatusMs:c}=n;let{firstRender:l=0}=n;if(s&&(l||a)&&o&&c){n.isInternalUpload=!0;const{playEnd:r}=n;r&&(n.isExternalUpload=!0);const{firstPreRender:i=0}=n;l=i||l;const a=e.videoTrack,d={peer:e._uintid,width:(null==a?void 0:a._videoWidth)||0,height:(null==a?void 0:a._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:o,peerPubStatusMs:c,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:i||0,firstRender:r?Math.max(l,r):Math.max(l,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:bO(this.store)};mO.firstXLAPeerFirstVideoFrame(this.store.sessionId,d)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(XI(i=this.remoteUserMap).call(i)).find(t=>t._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find(e=>e.userId===s.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:r?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return void 0!==s&&s!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===_M.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VO.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Rj(JF.prototype,"startP2PConnection",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"startP2PConnection"),JF.prototype),Rj(JF.prototype,"connect",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"connect"),JF.prototype),Rj(JF.prototype,"updateRemoteRTPCapabilities",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"updateRemoteRTPCapabilities"),JF.prototype),Rj(JF.prototype,"publishDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"publishDataChannel"),JF.prototype),Rj(JF.prototype,"unpublish",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublish"),JF.prototype),Rj(JF.prototype,"unpublishDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishDataChannel"),JF.prototype),Rj(JF.prototype,"unpublishLowStream",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishLowStream"),JF.prototype),Rj(JF.prototype,"subscribeDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribeDataChannel"),JF.prototype),Rj(JF.prototype,"subscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribe"),JF.prototype),Rj(JF.prototype,"massSubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"massSubscribe"),JF.prototype),Rj(JF.prototype,"unsubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribe"),JF.prototype),Rj(JF.prototype,"unsubscribeDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribeDataChannel"),JF.prototype),Rj(JF.prototype,"massUnsubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"massUnsubscribe"),JF.prototype),Rj(JF.prototype,"muteRemote",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"muteRemote"),JF.prototype),Rj(JF.prototype,"unmuteRemote",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unmuteRemote"),JF.prototype),Rj(JF.prototype,"hasRemoteMediaWithLock",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"hasRemoteMediaWithLock"),JF.prototype),Rj(JF.prototype,"disconnectForReconnect",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"disconnectForReconnect"),JF.prototype),Rj(JF.prototype,"updateBitrateLimit",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"updateBitrateLimit"),JF.prototype),Rj(JF.prototype,"remoteMediaSsrcChanged",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"remoteMediaSsrcChanged"),JF.prototype),JF);function nB(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return await r.apply(this,s)}finally{n()}},n}function rB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rB(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const sB=Date.now(),aB=20,oB=new Map,cB=new Map;async function lB(e){const t=oB.get(e),n=Array.isArray(t)&&t[t.length-1],r=cB.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,a=s-(Date.now()-r.firstRecvTs);a>0&&(r.firstRecvTs=Date.now()-s);let o=n.mediaDelay+a;o<=0?(t.pop(),dB(n.context,i),o=0):o=Math.min(o,aB),setTimeout(()=>t.length&&lB(e),o)}function dB(e,t){e.safeEmit(tR.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function uB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return dB(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=oB.get(r)||[],s=i.findIndex(t=>e.sendTs>=t.sendTs),a=iB(iB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===s?i.push(a):i.splice(s,0,a),oB.set(r,i);let o=!1;var c;cB.has(r)?o=!(null===(c=cB.get(r))||void 0===c||!c.isSyncing):cB.set(r,{isSyncing:o,firstRecvTs:0,firstSendTs:0}),o||lB(r)}const hB=qC().name;function pB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function mB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pB(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const fB="websdk_ng_cache_parameter",gB=AI("MAX_PRELOAD_ASYNC_LENGTH"),vB=1e4,yB=new Map,_B=[];let EB=null,bB=0,xB=0;const wB=new Map,SB=function(e,t){const n=[];let r=0;const i=async()=>{const e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return new np(async(s,o)=>{n.push(async()=>{try{const t=await e(...a);s(t)}catch(e){o(e)}}),r<t&&(r++,i())})}}(NB,gB),TB=jC.CancelToken.source();async function NB(e,t,n,r,i,s){try{if(!AI("ENABLE_PRELOAD"))return;if(!vO().supportWebCrypto)return void gR(()=>{aO.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&null!==n)throw new RA(AA.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&DA(n,"token",1,2047),DA(e,"appid",1,2047),Gj(t),r&&Hj(r);const a=NR();aO.debug("preload channel ".concat(t,", uid is ").concat(r));const o={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:a,proxyServer:i};let c,l;"string"==typeof r?(o.stringUid=r,[l,c]=await np.all([LV(r,{sid:a,appId:e},TB.token),MV(mB(mB({},o),{},{token:n||e,uid:0}),TB.token)]),o.uid=l.uid,c.gatewayInfo.uid=o.uid,c.gatewayInfo.res.uid=o.uid):(s&&(o.stringUid=s),c=await MV(o,TB.token));const d={sid:a,appId:e,cname:t,token:n||e,uid:o.stringUid||r,intUid:o.uid||c.gatewayInfo.uid,stringUid:o.stringUid,ts:Date.now(),sua:l,ap:c};await async function(e){let t;try{e.uid&&AB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=DB(e),r=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",_R(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,vR(window.btoa(JSON.stringify(e))));return yR(new Uint8Array(r))}catch(e){return}}(e,e.token||e.appId);if(!r)return;t=PB(fB);const i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>AI("AP_CACHE_NUM")&&i.shift(),kB(fB,JSON.stringify(i))}catch(e){aO.warn("Error caching server parameters:",e.message),kB(fB,"")}}(d),bB++}catch(e){throw xB++,function(e){EB||(EB=window.setTimeout(()=>{let t="";wB.forEach((e,n)=>{t+="".concat(n,": ").concat(e," ;")}),mO.reportApiInvoke(null,{name:qA.PRELOAD,options:{success:bB,failed:xB,err:t}}).onError(e),bB=0,xB=0,wB.clear(),EB=null},vB));const t=wB.get(e.code)||0;wB.set(e.code,t+1)}(e),e}}async function CB(e){try{if(AI("AP_REQUEST_DETAIL")||AI("ENABLE_ROLE_SELECT_EDGE"))return;const t=AB(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",_R(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,vR(e));return JSON.parse(window.atob(yR(new Uint8Array(r))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<AI("AP_CACHE_LIFETIME"))return n}catch(e){aO.warn("Error get preloadInfo",e.message)}}function AB(e){let t;try{if(t=PB(fB),!t)return;const n=JSON.parse(t),r=DB(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,e=>r in e);if(-1===i)return;const s=n.splice(i,1)[0];return kB(fB,JSON.stringify(n)),s[r]}catch(e){aO.warn("Error delete preload info: ".concat(t),e.message),kB(fB,"")}}function RB(e){if(e){let t=yB.get(e);t&&(window.clearTimeout(t),t=null,yB.delete(e)),Dr(_B).call(_B,e)||"disabled"!==e.cloudProxyServer||_B.push(e)}if(yB.size<AI("AP_CACHE_NUM")&&_B.length>0){const e=_B.shift();yB.set(e,window.setTimeout(async()=>{const{appId:t,cname:n,token:r,stringUid:i,uid:s,proxyServer:a}=e;try{await SB(t,n,r,s,a,i),yB.has(e)&&RB(e)}catch(t){aO.warn("update preload failed",t.message),IB(e)}},AI("AP_UPDATE_INTERVAL")))}}function IB(e){const t=_B.indexOf(e);-1!==t&&_B.splice(t,1);let n=yB.get(e);n&&(window.clearTimeout(n),n=null,yB.delete(e),RB())}function OB(e,t){const n=e.sua,r=e.ap;t&&n&&mO.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),mO.reportResourceTiming(e.ap.url,e.sid),mO.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(e=>e.ip).join(","),eventType:"disabled",unilbsServerIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK].toString()}),mO.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function PB(e){return window.atob(window.localStorage.getItem(e)||"")}function kB(e,t){window.localStorage.setItem(e,window.btoa(t))}function DB(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),LR(t)}function LB(e){let t=function(){const e=VB.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(JB(t,10),KB(t,n));let r=e.cid;void 0!==r&&(JB(t,16),JB(t,r));let i=e.cname;void 0!==i&&(JB(t,26),KB(t,i));let s=e.deviceId;void 0!==s&&(JB(t,34),KB(t,s));let a=e.elapse;void 0!==a&&(JB(t,40),ZB(t,a));let o=e.fileSize;void 0!==o&&(JB(t,48),ZB(t,UB(o)));let c=e.height;void 0!==c&&(JB(t,56),ZB(t,UB(c)));let l=e.jpg;void 0!==l&&(JB(t,66),JB(t,l.length),WB(t,l));let d=e.networkType;void 0!==d&&(JB(t,72),ZB(t,UB(d)));let u=e.osType;void 0!==u&&(JB(t,80),ZB(t,UB(u)));let h=e.requestId;void 0!==h&&(JB(t,90),KB(t,h));let p=e.sdkVersion;void 0!==p&&(JB(t,98),KB(t,p));let m=e.sequence;void 0!==m&&(JB(t,104),ZB(t,UB(m)));let f=e.sid;void 0!==f&&(JB(t,114),KB(t,f));let g=e.timestamp;void 0!==g&&(JB(t,120),ZB(t,g));let v=e.uid;void 0!==v&&(JB(t,128),JB(t,v));let y=e.vid;void 0!==y&&(JB(t,136),JB(t,y));let _=e.width;void 0!==_&&(JB(t,144),ZB(t,UB(_)));let E=e.service;void 0!==E&&(JB(t,152),JB(t,E));let b=e.callbackData;void 0!==b&&(JB(t,162),JB(t,b.length),WB(t,b));let x=e.ticket;void 0!==x&&(JB(t,170),KB(t,x));let w=e.vendorConfigs;void 0!==w&&(JB(t,178),KB(t,w))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function jB(e){return function(e){let t={};e:for(;!BB(e);){let n=XB(e);switch(n>>>3){case 0:break e;case 1:t.code=XB(e);break;case 2:t.msg=zB(e,XB(e));break;case 3:t.requestId=zB(e,XB(e));break;case 4:t.timestamp=QB(e,!1);break;default:MB(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function MB(e,t){switch(t){case 0:for(;128&qB(e););break;case 2:FB(e,XB(e));break;case 5:FB(e,4);break;case 1:FB(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function UB(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let VB=[];function FB(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function BB(e){return e.offset>=e.limit}function GB(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let t=new Uint8Array(2*s);t.set(n),e.bytes=t}return e.offset=s,s>i&&(e.limit=s),r}function HB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function WB(e,t){let n=GB(e,t.length);e.bytes.set(t,n)}function zB(e,t){let n=HB(e,t),r=String.fromCharCode,i=e.bytes,s="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=i[o+n];0==(128&u)?a+=r(u):192==(224&u)?o+1>=t?a+=s:(e=i[o+n+1],128!=(192&e)?a+=s:(d=(31&u)<<6|63&e,d<128?a+=s:(a+=r(d),o++))):224==(240&u)?o+2>=t?a+=s:(e=i[o+n+1],c=i[o+n+2],32896!=(49344&(e|c<<8))?a+=s:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=s:(a+=r(d),o+=2))):240==(248&u)?o+3>=t?a+=s:(e=i[o+n+1],c=i[o+n+2],l=i[o+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=s:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=s:(d-=65536,a+=r(55296+(d>>10),56320+(1023&d)),o+=3))):a+=s}return a}function KB(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}JB(e,r);let i=GB(e,r),s=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?s[i++]=e:(e<2048?s[i++]=e>>6&31|192:(e<65536?s[i++]=e>>12&15|224:(s[i++]=e>>18&7|240,s[i++]=e>>12&63|128),s[i++]=e>>6&63|128),s[i++]=63&e|128)}}function qB(e){return e.bytes[HB(e,1)]}function YB(e,t){let n=GB(e,1);e.bytes[n]=t}function XB(e){let t,n=0,r=0;do{t=qB(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function JB(e,t){for(t>>>=0;t>=128;)YB(e,127&t|128),t>>>=7;YB(e,t)}function QB(e,t){let n,r=0,i=0,s=0;return n=qB(e),r=127&n,128&n&&(n=qB(e),r|=(127&n)<<7,128&n&&(n=qB(e),r|=(127&n)<<14,128&n&&(n=qB(e),r|=(127&n)<<21,128&n&&(n=qB(e),i=127&n,128&n&&(n=qB(e),i|=(127&n)<<7,128&n&&(n=qB(e),i|=(127&n)<<14,128&n&&(n=qB(e),i|=(127&n)<<21,128&n&&(n=qB(e),s=127&n,128&n&&(n=qB(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function ZB(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=GB(e,s),o=e.bytes;switch(s){case 10:o[a+9]=i>>>7&1;case 9:o[a+8]=9!==s?128|i:127&i;case 8:o[a+7]=8!==s?r>>>21|128:r>>>21&127;case 7:o[a+6]=7!==s?r>>>14|128:r>>>14&127;case 6:o[a+5]=6!==s?r>>>7|128:r>>>7&127;case 5:o[a+4]=5!==s?128|r:127&r;case 4:o[a+3]=4!==s?n>>>21|128:n>>>21&127;case 3:o[a+2]=3!==s?n>>>14|128:n>>>14&127;case 2:o[a+1]=2!==s?n>>>7|128:n>>>7&127;case 1:o[a]=1!==s?128|n:127&n}}const $B={},eG={},tG=4294967296,nG=tG*tG,rG=nG/2,iG=lG(0,!0),sG=lG(0),aG=dG(0,-2147483648,!1),oG=dG(-1,2147483647,!1),cG=dG(-1,-1,!0);function lG(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=eG[e],r)?r:(n=dG(e,0,!0),i&&(eG[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=$B[e],r)?r:(n=dG(e,e<0?-1:0,!1),i&&($B[e]=n),n)}function dG(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function uG(e,t){if(isNaN(e))return t?iG:sG;if(t){if(e<0)return iG;if(e>=nG)return cG}else{if(e<=-rG)return aG;if(e+1>=rG)return oG}return e<0?t?iG:sG:dG(e%tG|0,e/tG|0,t)}function hG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}class pG extends WA{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(AM.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),uT(this,"name","AgoraRTCImageModeration"),uT(this,"_connectionState",CM.CONNECTING),uT(this,"_sequence",0),uT(this,"_moderationStartTime",void 0),uT(this,"_workerConnection",void 0),uT(this,"_workerMessageLengthLimit",void 0),uT(this,"_qualityRatio",void 0),uT(this,"_connectInfo",void 0),uT(this,"_cancelTokenSource",jC.CancelToken.source()),uT(this,"_retryConfig",void 0),uT(this,"_moderationInterval",void 0),uT(this,"_moderationTimer",null),uT(this,"_moderationMode",1),uT(this,"_quality",1),uT(this,"_qualityTimer",null),uT(this,"_ticket",void 0),uT(this,"_moderationIntervalMinimum",void 0),uT(this,"_uploadFailedNum",0),uT(this,"_uploadNum",0),uT(this,"_uploadTimer",null),uT(this,"_extraInfo",void 0),uT(this,"_vendor",""),uT(this,"_encoder",new TextEncoder),uT(this,"_moderationId",void 0),uT(this,"inspectImage",()=>{if(this.connectionState!==CM.CONNECTED)throw new fO(AA.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===CM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=TR(5,"image-moderation-"),this._workerMessageLengthLimit=AI("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=AI("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=AI("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new JM("worker-"+this._moderationId,FR),this.on(AM.STATE_CHANGE,(e,t)=>{aO.debug("[".concat(this._moderationId,"] Moderation operation :").concat(RM[e]," ").concat(t||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(AM.STATE_CHANGE,RM.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np((r,i)=>{this.on(AM.CONNECTION_STATE_CHANGE,(e,t)=>{e===CM.CONNECTED&&r()}),this.requestAP(e,n,t).then(e=>{this.connectWorker(e)}).catch(e=>{i(e)})})}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),aO.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===CM.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=AI("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),i=await function(e,t,n,r){let{appId:i,areaCode:s,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="moderation_plugin",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:s,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,appToken:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GR(async()=>{h=Date.now();const e=await sV(m,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(AA.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(AA.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(AA.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers.some(e=>!!e.wss)){const e=new fO(AA.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const r=AI("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}},(t,n)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==AA.OPERATION_ABORTED&&t.code!==AA.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)),r)}(r,e,t,n);this.emit(AM.STATE_CHANGE,RM.AP_CONNECTED);const{addressList:s,ticket:a}=i;return this._ticket=a,s}async connectWorker(e){this.emit(AM.STATE_CHANGE,RM.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Bj.CONNECTED,async()=>{this.emit(AM.STATE_CHANGE,RM.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=CM.CONNECTED}),this._workerConnection.on(Bj.CLOSED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(Bj.FAILED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(Bj.RECONNECTING,()=>{this.connectionState=this.connectionState===CM.CONNECTED?CM.RECONNECTING:CM.CONNECTING}),this._workerConnection.on(Bj.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const t=jB(new Uint8Array(e.data));AI("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,aO.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{mO.reportApiInvoke(this._connectInfo.sid||null,{name:qA.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:YA.TRACER}).onError(new fO(AA.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},AI("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else aO.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Bj.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this._workerConnection.on(Bj.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=oR(this,AM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(AI("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else AI("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:s,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await QP(l,n,r),u=this._sequence+"-"+i+"-"+o+"-"+c+"-"+TR(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:pG.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this._sequence,sid:a,timestamp:uG(c),uid:o,vid:s,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=LB(h);if(p.byteLength<this._workerMessageLengthLimit){if(AI("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hG(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:s,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=jC.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=CM.CLOSED,this.emit(AM.STATE_CHANGE,RM.CLOSED)}}function mG(e){if(PA(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(AA.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new fO(AA.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fG={name:"ImageModeration",create:function(e){let{config:t}=e;return mG(t),new pG(t)}};var gG,vG,yG,_G,EG,bG,xG,wG,SG,TG,NG,CG,AG,RG,IG,OG,PG,kG,DG,LG,jG,MG,UG,VG,FG,BG,GG,HG,WG,zG,KG,qG,YG,XG,JG,QG,ZG,$G,eH,tH,nH,rH;function iH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function sH(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iH(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}UR.setLogger(aO);let aH=(gG=pO(),vG=pO({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof uP))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),yG=pO({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==zO.DATA?(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())):[t.getChannelId()])}),_G=pO({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),EG=pO({argsMap:(e,t,n)=>[t,n]}),bG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]})}),xG=pO({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),wG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}})}),SG=pO(),TG=pO(),NG=pO(),CG=pO(),AG=pO(),RG=pO(),IG=pO(),OG=pO(),PG=pO(),kG=pO(),DG=pO(),LG=pO(),jG=pO(),MG=pO(),UG=pO(),VG=pO({argsMap:(e,t)=>[t]}),FG=pO(),BG=pO(),GG=pO(),HG=pO(),WG=pO(),zG=pO(),KG=pO(),qG=pO(),YG=pO({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),XG=pO(),JG=pO(),QG=pO(),ZG=pO(),$G=pO(),eH=pO(),tH=pO({reportResult:!0}),nH=pO(),rH=class extends WA{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),uT(this,"store",void 0),uT(this,"_uid",void 0),uT(this,"_channelName",void 0),uT(this,"_uintUid",void 0),uT(this,"_users",[]),uT(this,"_config",void 0),uT(this,"_clientId",void 0),uT(this,"_appId",void 0),uT(this,"_sessionId",null),uT(this,"_key",void 0),uT(this,"_rtmConfig",{}),uT(this,"_joinInfo",void 0),uT(this,"_gateway",void 0),uT(this,"_statsCollector",void 0),uT(this,"_configDistribute",void 0),uT(this,"_leaveMutex",void 0),uT(this,"_publishMutex",void 0),uT(this,"_renewTokenMutex",void 0),uT(this,"_subscribeMutex",void 0),uT(this,"_encryptionMode","none"),uT(this,"_encryptionSecret",null),uT(this,"_encryptionSalt",null),uT(this,"_encryptDataStream",!1),uT(this,"_encryptDataStreamKey",null),uT(this,"_encryptDataStreamIv",null),uT(this,"_proxyServer",void 0),uT(this,"_turnServer",{servers:[],mode:"auto"}),uT(this,"_cloudProxyServerMode","disabled"),uT(this,"_isDualStreamEnabled",!1),uT(this,"_defaultStreamFallbackType",void 0),uT(this,"_lowStreamParameter",void 0),uT(this,"_streamFallbackTypeCacheMap",new Map),uT(this,"_remoteStreamTypeCacheMap",new Map),uT(this,"_axiosCancelSource",jC.CancelToken.source()),uT(this,"_audioVolumeIndicationInterval",void 0),uT(this,"_networkQualityInterval",void 0),uT(this,"_userOfflineTimeout",void 0),uT(this,"_streamRemovedTimeout",void 0),uT(this,"_liveTranscodeStreamingClient",void 0),uT(this,"_liveRawStreamingClient",void 0),uT(this,"_channelMediaRelayClient",void 0),uT(this,"_networkQualitySensitivity","normal"),uT(this,"_p2pChannel",void 0),uT(this,"_useLocalAccessPoint",!1),uT(this,"_setLocalAPVersion",void 0),uT(this,"_joinAndNotLeaveYet",!1),uT(this,"_numberOfJoinCount",0),uT(this,"_joinResponse",null),uT(this,"_remoteDefaultVideoStreamType",void 0),uT(this,"_inspect",void 0),uT(this,"_moderation",void 0),uT(this,"_license",void 0),uT(this,"_pendingPublishedUsers",[]),uT(this,"ntpAlignErrorCount",0),uT(this,"remoteInboundOffset",0),uT(this,"_peerConnectionState",void 0),uT(this,"_handleLocalTrackEnable",(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),uT(this,"_handleLocalTrackDisable",(e,t,n)=>{this.unpublish(e).then(t).catch(n)}),uT(this,"_handleUserOnline",e=>{if(AI("BLOCK_LOCAL_CLIENT")&&zL(e.uid,this.channelName))return void aO.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&aO.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find(t=>t.uid===e.uid);if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(tR.USER_JOINED,t));else{const t=new ZV(e.uid,e.uint_id||e.uid);this._users.push(t),aO.debug("[".concat(this._clientId,"] user online"),e.uid),this.store.firstVideoFrameDecoded(t.uid,{userJoinNotify:Date.now()}),this.safeEmit(tR.USER_JOINED,t)}}),uT(this,"_handleUserOffline",e=>{if(AI("BLOCK_LOCAL_CLIENT")&&zL(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:dR(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),aO.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(tR.USER_LEAVED,t,e.reason))}),uT(this,"_handleAddAudioOrVideoStream",(e,t,n,r,i,s,a,o)=>{if(AI("BLOCK_LOCAL_CLIENT")&&zL(t,this.channelName))return;const c=this._users.find(e=>e.uid===t);if(!c)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now()),"video"===e&&this.store.firstVideoFrameDecoded(c.uid,{videoAddNotify:Date.now()});const l="audio"===e?c.hasAudio:c.hasVideo;if(c._uintid||(c._uintid=s||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==n&&(c._audioSSRC=n),void 0!==r&&(c._cname=r),a&&(c._audioOrtc=a)):(c._video_added_=!0,void 0!==n&&(c._videoSSRC=n),void 0!==r&&(c._cname=r),void 0!==o&&(c._rtxSsrcId=o),a&&(c._videoOrtc=a)),("audio"===e?c.hasAudio:c.hasVideo)&&!l&&(aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(e)),this.safeEmit(tR.USER_PUBLISHED,c,e)),"video"===e?mO.onGatewayStream(this._sessionId,dO.ON_ADD_VIDEO_STREAM,uO.ON_ADD_VIDEO_STREAM,{peer:s||t,ssrc:c._videoSSRC}):mO.onGatewayStream(this._sessionId,dO.ON_ADD_AUDIO_STREAM,uO.ON_ADD_AUDIO_STREAM,{peer:s||t,ssrc:c._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(c,e,n).then(t=>{if(t&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tB))return this._p2pChannel.unsubscribe(c,e,!0).then(()=>this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(c,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})),"video"===e&&!$C()&&!rA()){const e=this._getEncodingName(i);(null==e?void 0:e.toLocaleLowerCase())==PI.av1&&OV().then(t=>{t||this._gateway.downgradeCodec(e)})}}),uT(this,"_handleRemoveStream",e=>{if(AI("BLOCK_LOCAL_CLIENT")&&zL(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);if(!t)return void aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));aO.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tR.USER_UNPUBLISHED,t,"audio"),aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tR.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tR.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tR.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof tB&&this._p2pChannel.unsubscribe(t).then(e=>{if(e)return this._gateway.unsubscribe(e,t.uid)}),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),mO.onGatewayStream(this._sessionId,dO.ON_REMOVE_STREAM,uO.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()}),uT(this,"_handleSetStreamLocalEnable",(e,t,n)=>{if(AI("BLOCK_LOCAL_CLIENT")&&zL(t,this.channelName))return;const r=this._users.find(e=>e.uid===t);if(!r)return void aO.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));aO.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";aO.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tR.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tR.USER_INFO_UPDATED,t,e)}}const s="audio"===e?r.hasAudio:r.hasVideo;return i!==s?!i&&s?(aO.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(tR.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(tR.USER_UNPUBLISHED,r,e)):void 0}),uT(this,"_handleMuteStream",(e,t,n)=>{if(AI("BLOCK_LOCAL_CLIENT")&&zL(e,this.channelName))return;aO.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find(t=>t.uid===e);if(!r)return void aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tR.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tR.USER_INFO_UPDATED,e,t)}}const s="audio"===t?r.hasAudio:r.hasVideo;if(i!==s){if(!i&&s)return("audio"===t?r._audioSSRC:r._videoSSRC)?(aO.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(tR.USER_PUBLISHED,r,t)):void aO.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),aO.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(tR.USER_UNPUBLISHED,r,t)}}),uT(this,"_handleP2PLost",async e=>{aO.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():aO.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)}),uT(this,"_handleTokenWillExpire",()=>{aO.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(tR.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),uT(this,"_handleBeforeUnload",e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),aO.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),uT(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(tR.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(tR.NETWORK_QUALITY,e)}),uT(this,"_handleP2PAddAudioOrVideoStream",(e,t,n,r)=>{const i=this._users.find(e=>e.uid===t);if(!i)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());const s="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!s&&(aO.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(tR.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._config=e,this._clientId=t||TR(5,"client-"),this.store=new class{constructor(e,t,n,r){TA(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:EI.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case OI.SET_SESSION_ID:return CA(CA({},e),{},{sessionId:t.sessionId});case OI.SET_P2P_ID:return CA(CA({},e),{},{p2pId:t.p2pId});case OI.SET_UID:return CA(CA({},e),{},{uid:t.uid});case OI.SET_INT_UID:return CA(CA({},e),{},{intUid:t.intUid});case OI.SET_PUB_ID:return CA(CA({},e),{},{pubId:t.pubId});case OI.KEY_METRIC_CLIENT_CREATED:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{clientCreated:t.metric})});case OI.KEY_METRIC_JOIN_START:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{joinStart:t.metric})});case OI.KEY_METRIC_PRELOAD_START:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{preloadStart:t.metric})});case OI.KEY_METRIC_PRELOAD_END:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{preloadEnd:t.metric})});case OI.KEY_METRIC_JOIN_END:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{joinEnd:t.metric})});case OI.KEY_METRIC_REQUEST_AP_START:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{requestAPStart:t.metric})});case OI.KEY_METRIC_REQUEST_AP_END:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{requestAPEnd:t.metric})});case OI.KEY_METRIC_REQUEST_SUA_END:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{requestSUAEnd:t.metric})});case OI.KEY_METRIC_BEFORE_CONNECT:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{beforeConnect:t.metric})});case OI.KEY_METRIC_PEER_RECEIVER:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{peerReceiver:t.metric})});case OI.KEY_METRIC_SIGNAL_CONNECTED:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{signalConnected:t.metric})});case OI.KEY_METRIC_JOIN_REQ:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{joinReq:t.metric})});case OI.KEY_METRIC_JOIN_REP:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{joinRep:t.metric})});case OI.KEY_METRIC_JOIN_GATEWAY_START:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case OI.KEY_METRIC_JOIN_GATEWAY_END:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case OI.KEY_METRIC_PEER_CONNECTION_START:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case OI.KEY_METRIC_PEER_CONNECTION_END:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case OI.KEY_METRIC_DESCRIPTION_START:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{descriptionStart:t.metric})});case OI.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case OI.KEY_METRIC_ICE_CONNECTION_END:return CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case OI.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex(e=>e.trackId===t.metric.trackId);return-1!==r?(n[r]=CA(CA({},n[r]),t.metric),CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{publish:[...n]})})):CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case OI.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex(e=>e.userId===t.metric.userId&&e.type===t.metric.type);return-1!==r?(n[r]=CA(CA({},n[r]),t.metric),CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{subscribe:[...n]})})):CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case OI.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const n=e.keyMetrics.firstVideoFrameDecoded,r=n.findIndex(e=>e.userId===t.metric.userId);return-1!==r?(n[r]=CA(CA({},n[r]),t.metric),CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{firstVideoFrameDecoded:[...n]})})):CA(CA({},e),{},{keyMetrics:CA(CA({},e.keyMetrics),{},{firstVideoFrameDecoded:[...e.keyMetrics.firstVideoFrameDecoded,t.metric]})})}case OI.RESET_FIRST_VIDEO_FRAME_DECODED:return e.keyMetrics.firstVideoFrameDecoded=[],e;case OI.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case OI.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=CA(CA({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case OI.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case OI.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},e;case OI.SET_USE_P2P:return CA(CA({},e),{},{useP2P:t.val});case OI.SET_TRANSPORT_TYPE:return CA(CA({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set autoSubscribe(e){this.state.autoSubscribe=e}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(e){this.state.enableInstantMuteRestore=e}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(e){this.dispatch({type:OI.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:OI.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:OI.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:OI.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:OI.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:OI.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:OI.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:OI.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:OI.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:OI.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:OI.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:OI.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:OI.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:OI.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:OI.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:OI.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:OI.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:OI.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:OI.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:OI.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:OI.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:OI.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:OI.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:OI.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:OI.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:OI.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(e,t){this.dispatch({type:OI.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:CA({userId:e},t)})}descriptionStart(){this.dispatch({type:OI.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:OI.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:OI.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:OI.KEY_METRIC_PUBLISH,metric:CA(CA({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,s,a){this.dispatch({type:OI.KEY_METRIC_SUBSCRIBE,metric:CA(CA(CA(CA(CA({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),s&&{streamAdded:s}),a&&{firstDecoded:a})})}massSubscribe(e,t,n,r){e.forEach(e=>{this.dispatch({type:OI.KEY_METRIC_SUBSCRIBE,metric:CA(CA(CA({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map(e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof t?(this.dispatch({type:OI.RECORD_JOIN_CHANNEL_SERVICE,record:CA(CA({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:OI.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:OI.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:OI.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:OI.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new UR("client-leave",this._clientId),this._publishMutex=new UR("client-publish",this._clientId),this._renewTokenMutex=new UR("client-renewtoken",this._clientId),this._subscribeMutex=new UR("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),aO.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(yI," build: ").concat(SI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{eR(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(e){aO.warning("[".concat(this._clientId,"] ").concat(e.toString()))}var r;this._statsCollector=new XV(this.store),this._statsCollector.onStatsException=(e,t,n)=>{aO.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),e===zV.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(e=>{e instanceof LD&&AI("ENABLE_ENCODE_EXCEPTION")&&e.findClosestProfile()}),this.safeEmit(tR.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find(t=>t.uid===e);i&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(i._uintid,{peerPublishDuration:n,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(i)),mO.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid}))},this._statsCollector.onVideoCodecChanged=e=>{if(AI("VIDEO_STANDARD_BITRATE_VERSION")&&("av1"===e||"h265"===e||"h264"===e)){const t=this.localTracks.find(e=>e instanceof DD);t&&1!==t._saveEncodeBitrateRatio&&t.setSaveEncodeBitrateRatio("h264"===e?AI("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P="p2p"===e.mode,this._gateway=new nV(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||FR,httpRetryConfig:e.httpRetryConfig||FR,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new HV(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},JU("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new tB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];CI("JOIN_GATEWAY_USE_443PORT_ONLY",s),CI("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const o=this._gateway.signal.websocket;return o instanceof XM&&(o.use443PortOnly=s,o.tryDoubleDomain=a),async function(e,t,n){VC.get(e)||VC.set(e,[]),FC.get(e)||FC.set(e,t),BC.get(e)||BC.set(e,0);const r=VC.get(e),i=FC.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(BC.get(e)===i){const e=UC();r.push(e),await e.promise}BC.set(e,BC.get(e)+1);for(var s=arguments.length,a=new Array(s>3?s-3:0),o=3;o<s;o++)a[o-3]=arguments[o];const c=await n(...a);return BC.set(e,BC.get(e)-1),BC.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===BC.get(e)&&(VC.set(e,[]),FC.set(e,0),BC.set(e,0)),c}("client.join",AI("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const a="HTTPS"===(HR||HR||(HR=(window.location.protocol.split(":")[0]||"").toUpperCase(),HR)),o=XR()?window.isSecureContext:"Browser Not Support";if(!XR()&&!a||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";aO.warning(e)}let c;mO.setAppId(e);try{if(!n&&null!==n)throw new fO(AA.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&DA(n,"token",1,2047),DA(e,"appid",1,2047),Gj(t),r&&Hj(r),i)if("string"==typeof i)DA(i,"optionalInfo",1,256),c=i;else{if("object"!=typeof i)throw new fO(AA.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:e,enableInstantMuteRestore:t}=i;e&&(IA(e,"autoSubscribe"),aO.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(e)),this.store.autoSubscribe=e),t&&(IA(t,"enableInstantMuteRestore"),aO.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(t)),this.store.enableInstantMuteRestore=t)}}}catch(i){throw mO.reportApiInvoke(NR(),{name:qA.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:o},tag:YA.TRACER}).onError(i),i}if(this._leaveMutex.isLocked&&(aO.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),aO.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const i=new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw mO.reportApiInvoke(NR(),{name:qA.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:o},tag:YA.TRACER}).onError(i),i}this._gateway.state="CONNECTING",this.store.preloadStart();const l=await CB({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const d=(null==l?void 0:l.sid)||NR();aO.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId);const u=mO.reportApiInvoke(d,{id:this._clientId,name:qA.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:o},tag:YA.TRACER}),h=sH(sH(sH({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!l},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:AI("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(h.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(h.stringUid=r,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(h.aesmode=this._encryptionMode,h.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=BA(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(h.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=AI("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(h.appId+this._encryptionSecret+this._encryptionSecret):e.encode(h.appId+h.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,s=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:LI,hash:"SHA-256",salt:n},r,i+DI);return new Uint8Array(s).subarray(i/8)}(this._encryptionMode,t,vR(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:LI,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,vR(this._encryptionSalt))}else o?aO.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):aO.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,aO.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:h.stringUid});const p=this._sessionId;setTimeout(()=>{"CONNECTING"===this.connectionState&&p===this._sessionId&&mO.joinChannelTimeout(this._sessionId,5)},5e3);try{var m;let r;const i=h.cloudProxyServer;if(Dr(m=["proxy3","proxy4","proxy5"]).call(m,i)){const e=AI("PROXY_SERVER_TYPE3");Array.isArray(e)?h.proxyServer=e[0]:h.proxyServer=e}if(mO.setProxyServer(h.proxyServer),aO.setProxyServer(h.proxyServer),this.store.requestAPStart(),l){if(aO.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(h.stringUid?", ".concat(h.stringUid," => ").concat(l.intUid):""," ")),h.stringUid&&!h.uid&&(h.uid=l.intUid),r={gatewayInfo:l.ap.gatewayInfo},AI("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===h.turnServer.mode)if(0===l.ap.proxyInfo.addresses.length)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await lU(l.ap.proxyInfo,l.ap.gatewayInfo.uid)).map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bI.tcpport,udpport:e.udpport||bI.udpport,username:e.username||bI.username,password:e.password||bI.password,forceturn:!1,security:!0}));h.turnServer={mode:"manual",servers:e}}OB(l,h.stringUid)}else{if(h.stringUid&&!h.uid){let e;[e,r]=await np.all([DV(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||FR,this.store).finally(()=>{this.store.requestSUAEnd()}),kV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FR,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),aO.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(h.stringUid," => ").concat(e)),h.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await kV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FR,!0,this.store);if(!this._joinAndNotLeaveYet)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(uM.UPDATE_BITRATE_LIMIT,e=>{this._p2pChannel.updateBitrateLimit(e)}),this._configDistribute.on(uM.UPDATE_CLIENT_ROLE_OPTIONS,e=>{this._setClientRoleOptions(e)})},0),this._key=n||e;const s=r.gatewayInfo,a=h.uid?h.uid:s.uid;this._joinInfo=sH(sH({},h),{},{cid:s.cid,uid:a,vid:s.vid,apResponse:s.res,apGatewayAddress:s.apGatewayAddress,uni_lbs_ip:s.uni_lbs_ip,gatewayAddrs:s.gatewayAddrs}),this.store.intUid=a,this.store.cid=s.cid;const o=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(o),this._appId=e,this._channelName=h.cname,this._uid=o,this.store.uid=o,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const c=h.stringUid?"string uid: ".concat(h.stringUid,",uid: ").concat(h.uid):"uid: ".concat(this._uid);return aO.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(c)),setTimeout(()=>{aO.startUpload()},5e3),this.store.joinEnd(),f=this,Dr(HL).call(HL,f)||HL.push(f),"disabled"===this._cloudProxyServerMode&&vO().supportWebCrypto&&AI("ENABLE_PRELOAD")&&RB(this._joinInfo),o}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===AA.OPERATION_ABORTED?aO.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),t):aO.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),t),t.code!==AA.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(t),t}var f}_joinGateway(){if(!this._joinInfo||!this._key)throw new fO(AA.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!AI("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){aO.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=HL.indexOf(e);-1!==t&&HL.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return aO.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,QA.LEAVE),aO.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof uP))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new fO(AA.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new fO(AA.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof uP))throw new fO(AA.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new fO(AA.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}aO.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(e=>{const t=this._configDistribute.getBitrateLimit();e instanceof DD&&t&&e.setBitrateLimit(t.uplink)});try{await this._publishHighStream(n),aO.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))))}catch(e){throw aO.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{r()}}async _publishDataChannel(e){if(null==e)throw new fO(AA.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));PA(e.id,"id",0,65535,!0),IA(e.ordered,"ordered"),DA(e.metadata,"metadata",0,512),aO.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex(t=>t.id===e.id))throw new fO(AA.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new fO(AA.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&AI("FORCE_TURN")&&!AI("TURN_ENABLE_TCP")&&!AI("TURN_ENABLE_UDP"))throw new fO(AA.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return QU(e,!1)}(e),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if("number"!=typeof t._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new fO(AA.CREATE_DATACHANNEL_ERROR);try{await np.all(n.map(e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0))),await t._waitTillOpen()}catch(e){if(e.code!==AA.DISCONNECT_P2P)throw e}}return aO.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw aO.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new fO(AA.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof uP))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);aO.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(e=>"".concat(e.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(IM.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),aO.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(e=>"".concat(e.getTrackId()))))}}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),aO.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(e=>"".concat(e.id," "))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),aO.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(e=>"".concat(e.id))))}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(OA(t,"mediaType",["audio","video"]),this.store.useP2P)throw new fO(AA.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===fM.AUDIO,r=t===fM.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:i,ortc:s,rtxSsrcId:a,cname:o,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new fO(AA.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(t=>t.uid===e);l||(l=new ZV(e,c||e),l._is_pre_created=!0,this._users.push(l)),o&&(l._cname=o),l._uintid||(l._uintid=c||e),n&&(l._audioSSRC=i,l._audio_pre_subscribed=!0,s&&(l._audioOrtc=s)),r&&(l._videoSSRC=i,l._video_pre_subscribed=!0,s&&(l._videoOrtc=s),null!=a&&(l._rtxSsrcId=a)),aO.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(l,t,i,a,s);const d=n?l._audioTrack:l._videoTrack;if(!d)throw new fO(AA.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),r&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),d}catch(t){throw aO.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{i()}}async _subscribeDataChannel(e,t){var n;if(PA(t,"channelId",0,65535,!0),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const r=this._users.find(t=>t===e);if(!r)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new fO(AA.INVALID_REMOTE_USER,"user is not published");const i=null===(n=e._dataChannels)||void 0===n?void 0:n.find(e=>e.id===t);if(!i)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new fO(AA.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[i]);if(n&&Dr(n).call(n,i.id))try{var a;if("number"!=typeof i._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new fO(AA.CREATE_DATACHANNEL_ERROR);const t={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(a=i.metadata)&&void 0!==a?a:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await i._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==AA.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),t;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(OA(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find(t=>t===e);if(!r){const t=new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(AA.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new fO(AA.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const i=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,n,r)}catch(e){throw e}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new fO(AA.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(OA(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find(t=>t===e);if(!r){const t=new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(AA.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new fO(AA.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i="audio"===t?e._audioSSRC:e._videoSSRC,s="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:i};"video"===t&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const c=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,s="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:i}),KV.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,o,!0)}catch(n){if((null==n?void 0:n.code)!==AA.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new fO(AA.UNEXPECTED_ERROR,"can not find remote track in user object");return"video"===t&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),r}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(LA(e,"subscribeList"),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; ")));const i=(e=[...e]).map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}}),s=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:s,mediaType:a}=r;if(OA(a,"mediaType",["audio","video"]),!s){const e=new fO(AA.INVALID_PARAMS,"user property does not exist in subscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const o=this._users.find(e=>e===s);if(!o){const n=new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");aO.error("[".concat(this._clientId,"] can not massSubscribe ").concat(s.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===a&&(!s.hasAudio||void 0===s._audioSSRC)||"video"===a&&(!s.hasVideo||void 0===s._videoSSRC)){const n=new fO(AA.REMOTE_USER_IS_NOT_PUBLISHED);aO.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid," with mediaType ").concat(a,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const c=aM.Video|aM.LwoVideo,l=n.get(s);if(l){if("video"===a?l&c:l&aM.Audio){e.splice(t,1),aO.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(s.uid,", mediaType:").concat(a," twice"));continue}n.set(s,l|("video"===a?c:aM.Audio))}else n.set(s,"video"===a?c:aM.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:s}=r,a=aM.Video|aM.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,s)){await this._p2pChannel.unmuteRemoteNoLock(i,s);const r=n.get(i);n.set(i,"video"===s?r^a:r^aM.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map(e=>({userId:e.user.uid,type:e.mediaType})),t);let r=ii(a=Array.from(n.entries())).call(a,(e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&aM.Audio&&(i.audio_ssrc=n._audioSSRC),r&aM.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===fM.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===fM.VIDEO?t._rtxSsrcId:void 0}}));const n=new Map;if(r=r.filter(e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc),r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach(e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:s}=e;(r||i||s)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:s})})}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach(t=>{let[n,r]=t;const i=this.remoteUsers.find(e=>e.uid===n);if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=fM.VIDEO:r.audio_error_code&&(t=fM.AUDIO),e.push({user:i,mediaType:t})}}),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=MM(n);aO.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new fO(AA.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter(e=>!e.error).map(e=>({userId:e.user.uid,type:e.mediaType})),void 0,Date.now()),i.forEach(e=>{var n;mO.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===fM.VIDEO,audio:e.mediaType===fM.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===fM.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)}),aO.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&OA(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const r=this._users.find(t=>t===e);if(!r){const t=new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&dR(this._users,e),aO.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===AA.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&PA(t,"id",0,65535,!0),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find(t=>t===e);if(!n){const t=new fO(AA.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let r;if("number"==typeof t){const n=e._dataChannels.find(e=>e.id===t);n&&(r=[n])}else r=e._dataChannels;if(void 0===r){const n=new fO(AA.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(e=>e.id)));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),aO.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===AA.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(LA(e,"unsubscribeList"),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");aO.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new fO(AA.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}OA(i,"mediaType",["video","audio",void 0]);const s=this._users.find(e=>e===r);if(!s){aO.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const a=aM.Video|aM.LwoVideo;if(t.has(r)){const s=t.get(r);let o;switch(i){case"video":o=s&a;break;case"audio":o=s&aM.Audio;break;default:o=s&(aM.Audio|a)}if(o){aO.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,s|aM.Audio):"video"===i&&t.set(r,s|a):t.set(r,s|aM.Audio|a)}else i?"audio"===i?t.set(r,aM.Audio):"video"===i&&t.set(r,a):t.set(r,aM.Audio|a)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),aO.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join()))}catch(e){if(e.code===AA.DISCONNECT_P2P)return void aO.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw aO.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new RA(AA.INVALID_PARAMS);jA(e.width)||kA(e.width,"streamParameter.width"),jA(e.height)||kA(e.height,"streamParameter.height"),jA(e.framerate)||kA(e.framerate,"streamParameter.framerate"),jA(e.bitrate)||PA(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&aO.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),aO.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,_M.LocalVideoLowTrack)}async enableDualStream(){if(!vO().supportDualStream)throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new fO(AA.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new fO(AA.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),aO.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(_M.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),aO.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){OA(e,"role",["audience","host"])}(e),t&&eR(t),"rtc"===this.mode||"p2p"===this.mode)throw aO.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new fO(AA.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new fO(AA.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new fO(AA.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&AI("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",nR.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),aO.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode)return;if("audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&eR(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{aO.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(DA(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(AA.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,mO.setProxyServer(this._proxyServer),aO.setProxyServer(this._proxyServer),aO.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(AA.INVALID_OPERATION,"You have already set the proxy")}if(ZA(e))return this._turnServer={servers:e,mode:"original-manual"},void aO.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(e=>e.urls).join(","),"."));e.forEach(e=>$A(e)),this._turnServer={servers:e,mode:"manual"},aO.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"you should set license before join channel");if(DA(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new fO(AA.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,aO.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new fO(AA.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new fO(AA.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new fO(AA.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"Stop proxy server after leave channel");mO.setProxyServer(),aO.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new fO(AA.INVALID_PARAMS,"accessPoints is required.");LA(e.accessPoints.serverList,"accessPoints.serverList"),DA(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{PA(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(AA.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");AI("CLOSE_AFB_FOR_LOCAL_AP")&&(CI("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),CI("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map(e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e),a=s.map(e=>"".concat(e,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,CI("WEBCS_DOMAIN",a),CI("WEBCS_DOMAIN_BACKUP_LIST",a),CI("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(LA(e.report.hostname,"report.hostname"),CI("EVENT_REPORT_DOMAIN",e.report.hostname[0]),CI("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(CI("EVENT_REPORT_DOMAIN",s[0]),CI("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let o=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),o=e.report.port),CI("STATS_COLLECTOR_PORT",o),e.report?CI("ENABLE_EVENT_REPORT",!0):CI("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(LA(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=s[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),CI("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(LA(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=s;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),CI("CDS_AP",d.map(e=>"".concat(e,":").concat(u))),e.cds?CI("ENABLE_CONFIG_DISTRIBUTE",!0):CI("ENABLE_CONFIG_DISTRIBUTE",!1),aO.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(LA(e,"serverList"),DA(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(AA.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,CI("WEBCS_DOMAIN",e),CI("WEBCS_DOMAIN_BACKUP_LIST",e),CI("GATEWAY_DOMAINS",[t]),CI("EVENT_REPORT_DOMAIN",e[0]),CI("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),CI("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),aO.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(OA(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw aO.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else aO.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){OA(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const t=this._users.find(t=>t.uid===e);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(e){throw aO.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){OA(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){!function(e){OA(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),DA(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Dr(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new fO(AA.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new fO(AA.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(IA(r,"encryptDataStream"),!Dr(i).call(i,e))throw new fO(AA.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||aO.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=yR(n))}async renewToken(e){if(DA(e,"token",1,2047),!this._key||!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(AI("USE_NEW_TOKEN")){aO.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await FV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FR);aO.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else aO.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});aO.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,aO.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?aO.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(tR.VOLUME_INDICATOR,e)},AI("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new fO(AA.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new fO(AA.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new fO(AA.LIVE_STREAMING_TASK_CONFLICT);const n=t?Wj.TRANSCODE:Wj.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Wj.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(e));if(!t.length)throw new fO(AA.INVALID_PARAMS,"can not find live streaming url to stop");await np.all(t.map(t=>t&&t.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof tB&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;const i=ii(r=Array.from(n)).call(r,(e,t)=>e+t,0),s={serverTs:0,seq:MI++,length:n.length,checkSum:i},a=new Uint8Array(PR(i,2)),o=new ArrayBuffer(jI),c=new DataView(o);c.setUint32(0,s.serverTs),c.setUint16(4,s.seq),c.setUint16(6,s.length),c.setUint16(8,s.checkSum);const l=16-n.length%16;n=ER(n,new Uint8Array(l));const d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:kI,additionalData:a},t,n);return ER(new Uint8Array(o),new Uint8Array(d))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new fO(AA.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Mj.DATA_STREAM,{payload:yR(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-sB},!n)}sendMetadata(e){if(!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new fO(AA.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Mj.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:yR(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(cO),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"can not send custom report, not joined");await mO.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(AI("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(e=>e.uid+"");Object.keys(e).forEach(n=>{Dr(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){OA(t.spatialLayer,"spatialLayer",[0,1,2,3]),OA(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(IA(t,"apRTM"),PA(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,aO.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(aO.debug("[".concat(this._clientId,"] reset client")),function(e){const t=WL.indexOf(e);-1!==t&&WL.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=jC.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&IB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&mO.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(e=>e._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new UR("client-publish",this._clientId),this._subscribeMutex=new UR("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const r=e||NR();e?aO.debug("[".concat(this._clientId,"] new Session ").concat(r)):aO.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,mO.addSid(r);const s={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};mO.sessionInit(this._sessionId,sH({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new fO(AA.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&AI("FORCE_TURN")&&!AI("TURN_ENABLE_TCP")&&!AI("TURN_ENABLE_UDP"))throw new fO(AA.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");aO.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(IM.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==AA.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof DD&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch(e=>{aO.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===AA.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new fO(AA.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));aO.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==AA.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===AA.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new fO(AA.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},JU("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qA.ON_LIVE_STREAM_ERROR,options:[e,t],tag:YA.TRACER}).onSuccess(),this.safeEmit(tR.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qA.ON_LIVE_STREAM_WARNING,options:[e,t],tag:YA.TRACER}).onSuccess(),this.safeEmit(tR.LIVE_STREAMING_WARNING,e,t)},e.on(Jj.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new fO(AA.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,r){const i=AI("UAP_AP").slice(0,AI("AJAX_REQUEST_CONCURRENT")).map(e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"));return await yV(i,e,t,n,r)})(e,this._joinInfo,this._axiosCancelSource.token,FR).then(t).catch(n)}),e};return e===Wj.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new fO(AA.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},JU("ChannelMediaRelay").create(e));r.on("state",e=>{e===tM.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(tR.CHANNEL_MEDIA_RELAY_STATE,e)}),r.on("event",e=>{this.safeEmit(tR.CHANNEL_MEDIA_RELAY_EVENT,e)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const e=[];this._users.forEach(t=>{t._dataChannels.forEach(r=>{n.every(e=>e.uid!==t._uintid||e.stream_id!==r.id)&&e.push({uid:t._uintid,stream_id:r.id,ordered:r.ordered,max_retrans_times:r.maxRetransmits,metadata:r.metadata})})}),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach(e=>{const{uid:n,stream_id:r,ordered:s,max_retrans_times:a,metadata:o}=e,c=this._users.find(e=>e._uintid===n);if(c){if(aO.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Dr(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex(t=>t.id===e.stream_id)){const e={id:r,ordered:!!s,maxRetransmits:a,metadata:o},n=function(e){return QU(e,!0)}(e);c._dataChannels.push(n),aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(tR.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(aO.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())}))}else aO.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),t&&(this.safeEmit(tR.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(e=>{const{uid:t,stream_id:n}=e,r=this._users.find(e=>e._uintid===t);if(!r)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const i=r._dataChannels.find(t=>t.id===e.stream_id);i&&(aO.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then(e=>{if(r._dataChannels=r._dataChannels.filter(e=>e!==i),e)return this._gateway.unsubscribeDataChannel(e,r.uid)}),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(tR.USER_UNPUBLISHED,r,"datachannel",i._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=null===(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)||void 0===t?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return null==i||null===(r=i.rtpMap)||void 0===r?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(t=>t.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){aO.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(e=>{this.safeEmit(tR.USER_UNPUBLISHED,t,"datachannel",e._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)}),n()}}else aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(iM.UPDATE_GATEWAY_CONFIG,()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(e=>{const{value:r,type:i,expires:s}=t[e];s&&s<=n||i||KL()||!Object.prototype.hasOwnProperty.call(xI,e)||(II[e]=r,NI[e]=r,aO.debug("Update gateway parameters from config distribute",e,r))})}catch(e){aO.error("Error update config from local cache",e.message)}}()}),this._gateway.on(iM.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(iM.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===QA.FALLBACK)return;const i=()=>{this.safeEmit(tR.CONNECTION_STATE_CHANGE,e,t,n)};if(mO.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:qA.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:YA.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),aO.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach(e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var s;this._streamFallbackTypeCacheMap.forEach((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)})}),this._remoteStreamTypeCacheMap.forEach((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(s=this._joinInfo)||void 0===s?void 0:s.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{aO.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(e=>{aO.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(e=>!e._trust_in_room_).forEach(e=>{aO.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(e=>{e._trust_audio_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.AUDIO,!1)),e._trust_video_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.VIDEO,!1)),e._trust_audio_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(aO.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3))}i()}),this._gateway.on(iM.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new fO(AA.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const n=await CB(sH(sH({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,OB(n),this._joinInfo.preload=!0):(t=await PV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FR,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const r=[];t.gatewayInfo.gatewayAddrs.forEach(e=>{let{address:t}=e;const[n,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:n,port:i}):r.push({host:n,port:i})}),e(r)}catch(e){t(e)}}),this._gateway.on(iM.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(tR.NETWORK_QUALITY,e)}),this._gateway.on(iM.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(tR.STREAM_TYPE_CHANGED,e,t),mO.reportApiInvoke(this._sessionId,{name:qA.STREAM_TYPE_CHANGE,options:[e,t],tag:YA.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(iM.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(iM.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();n&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(e){n(e)}}),this._gateway.on(iM.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:aO.debug("no attributes in joinResponse");const r=SU(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(iM.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:a}=this._joinInfo.apResponse,o="".concat(a,"_").concat(s);if(o.length<4||o.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(s),icePwd:"".concat(a,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(i=AI("FINGERPRINT"))&&void 0!==i?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(e){e.code&&e.code===AA.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Vj.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Vj.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Vj.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Vj.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Vj.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Vj.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Vj.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Vj.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Vj.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!0)),this._gateway.signal.on(Vj.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!1)),this._gateway.signal.on(Vj.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!0)),this._gateway.signal.on(Vj.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!1)),this._gateway.signal.on(Vj.RECEIVE_METADATA,e=>{const t=vR(e.metadata);this.safeEmit(tR.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Vj.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=vR(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<jI)throw new fO(AA.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(jI));const t=await async function(e,t,n){const r=n.subarray(0,jI),i=r.slice(8,jI),s=(i[0]<<8)+i[1],a=(r[6]<<8)+r[7],o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:kI,additionalData:new Uint8Array(PR(s,2))},t,n.subarray(jI));return new Uint8Array(o).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let r=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find(t=>t.uid===e.uid),i=null==t?void 0:t.audioRecv.find(e=>e.ssrc===(null==n?void 0:n._audioSSRC));r=null==i?void 0:i.jitterBufferMs}(null==r||Number.isNaN(r))&&(r=0),uB(sH(sH({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Vj.ON_CRYPT_ERROR,()=>{gR(()=>{aO.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(tR.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Vj.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Vj.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{aO.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,QA.TOKEN_EXPIRE),this.safeEmit(tR.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Vj.ON_STREAM_FALLBACK_UPDATE,e=>{aO.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(tR.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(Vj.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),aO.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Vj.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Vj.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(jj.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Mj.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r;const i=e.some(e=>{let{stream_type:t}=e;return t===rM.Audio}),s=e.some(e=>{let{stream_type:t}=e;return t!==rM.Audio}),a=e.some(e=>{let{stream_type:t}=e;return t===rM.Screen||t===rM.ScreenLow});"offer"===t.state&&mO.publish(this._joinInfo.sid,{eventElapse:KV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:AA.TIMEOUT,audio:i,video:s,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:i?null===(n=e.find(e=>{let{stream_type:t}=e;return t===rM.Audio}))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:s?null===(r=e.find(e=>{let{stream_type:t}=e;return t!==rM.Audio}))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case Mj.SUBSCRIBE:t&&mO.subscribe(this._joinInfo.sid,{succ:!1,ec:AA.TIMEOUT,audio:t.stream_type===fM.AUDIO,video:t.stream_type===fM.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:KV.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Vj.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Vj.ON_PUBLISHED_USER_LIST,e=>{if(null==e||!e.users)return;AI("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(e=>!zL(e.string_id||e.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let e=this._users.find(e=>e._uintid===r.stream_id);e?e._trust_in_room_=!0:(e=new ZV(r.string_id||r.stream_id,r.stream_id),this._users.push(e),this.store.firstVideoFrameDecoded(e.uid,{userJoinNotify:Date.now()}),0===this.getListeners(tR.PUBLISHED_USER_LIST).length&&(aO.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(tR.USER_JOINED,e)));const i=aM.Audio&r.stream_type,s=(aM.Video|aM.LwoVideo)&r.stream_type,a=0!=(65280&r.stream_type),o=i&&e.hasAudio,c=s&&e.hasVideo;s&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!o&&0===this.getListeners(tR.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(tR.USER_PUBLISHED,e,"audio")),s&&!c&&0===this.getListeners(tR.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(tR.USER_PUBLISHED,e,"video")),(i&&!o||s&&!c||a)&&t.push(e),s&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(aO.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(e=>{aO.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())})),this.getListeners(tR.PUBLISHED_USER_LIST).length>0?AI("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(aO.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(e=>e.uid).join(", "))),this.safeEmit(tR.PUBLISHED_USER_LIST,t)):aO.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(e=>e.uid).join(", ")))}),this._gateway.signal.on(Vj.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof tB&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(e=>e.toLowerCase()).filter(e=>{var t;return Dr(t=Object.keys(PI)).call(t,e)}))})}_handleP2PEvents(){this._gateway.signal.on(Vj.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(IM.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(e=>{const{kind:i,ssrcs:s,mid:a,isMuted:o}=e;this._handleP2PAddAudioOrVideoStream(i,r,s[0].ssrcId,a);const c=this._users.find(e=>e.uid===r);return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,i,s[0].ssrcId,a).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,i,!!o)})}),this._gateway.signal.on(IM.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(e){n(e)}}),this._gateway.signal.on(jj.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(IM.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find(e=>e.uid===i);if(!s)return aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async e=>{let{stream_type:t}=e;const n=t===rM.Audio?fM.AUDIO:fM.VIDEO;await this._p2pChannel.unsubscribe(s,n),this._handleMuteStream(i,n,!0)}),t()}catch(e){n(e)}}}),this._gateway.signal.on(IM.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case PM.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,fM.VIDEO,!0);break;case PM.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,fM.AUDIO,!0);break;case PM.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,fM.VIDEO,!1);break;case PM.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,fM.AUDIO,!1)}}),this._gateway.signal.on(IM.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:n,iceParameter:r}=e;n!==Fj.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}}),this._gateway.signal.on(IM.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(bM.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(IM.RESTART_ICE,e,n===Fj.SEND_ONLY))}catch(e){n(e)}}),this._p2pChannel.on(bM.LocalCandidate,e=>{this._gateway.sendExtensionMessage(IM.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(bM.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(IM.CONTROL,e,!0),t()}catch(e){n(e)}}),this._p2pChannel.on(bM.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===AA.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===AA.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.StateChange,(e,t)=>{t===EM.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(bM.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(tR.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(bM.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===AA.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===AA.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(bM.RequestRePublishDataChannel,(e,t,n)=>{np.all(e.map(async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach(e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)})}catch(e){if(e.code!==AA.DISCONNECT_P2P)throw e}})).then(t).catch(n)}),this._p2pChannel.on(bM.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===fM.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}}),this._p2pChannel.on(bM.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(bM.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(bM.MediaReconnectStart,e=>{this.safeEmit(tR.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(bM.MediaReconnectEnd,e=>{this.safeEmit(tR.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(bM.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(bM.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:s}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(bM.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(bM.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),a=SU(i,s);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(bM.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(bM.P2PLost,()=>{this.safeEmit(tR.P2P_LOST,this.store.uid)}),this._p2pChannel.on(bM.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(bM.ConnectionTypeChange,e=>{this.safeEmit(tR.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(bM.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(bM.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(bM.AudioMetadata,e=>{this.safeEmit(tR.AUDIO_METADATA,e)}),this._p2pChannel.on(bM.AudioPts,e=>{this.safeEmit(tR.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},JU("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:a,uid:o,cid:c,vid:l?Number(l):0},FR)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(SM.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(tR.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===xM.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(tR.CONTENT_INSPECT_ERROR,new fO(AA.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(SM.INSPECT_RESULT,(e,t)=>{var n;if((null==t?void 0:t.code)===AA.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return aO.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(tR.CONTENT_INSPECT_RESULT,e,t)}),e.on(SM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}async disableContentInspect(){if(!this._inspect)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(IA(e,"enabled"),e){if(!t)throw new fO(AA.INVALID_PARAMS,"config is required");if(mG(t),!this._joinInfo)throw new fO(AA.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(n={config:t},JU("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);const{appId:r,cname:i,sid:s,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await e.init({appId:r,areaCode:"",cname:i,sid:s,token:a,uid:o,cid:c,vid:l?Number(l):0},FR)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var n;if(!this._moderation)throw new fO(AA.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(AM.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(tR.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===CM.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new fO(AA.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(AM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}setP2PTransport(e){if(function(e){OA(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new fO(AA.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,aO.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return aO.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){IA(e,"enabled"),CI("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Rj(rH.prototype,"leave",[gG],Object.getOwnPropertyDescriptor(rH.prototype,"leave"),rH.prototype),Rj(rH.prototype,"publish",[vG],Object.getOwnPropertyDescriptor(rH.prototype,"publish"),rH.prototype),Rj(rH.prototype,"unpublish",[yG],Object.getOwnPropertyDescriptor(rH.prototype,"unpublish"),rH.prototype),Rj(rH.prototype,"subscribe",[_G],Object.getOwnPropertyDescriptor(rH.prototype,"subscribe"),rH.prototype),Rj(rH.prototype,"presubscribe",[EG],Object.getOwnPropertyDescriptor(rH.prototype,"presubscribe"),rH.prototype),Rj(rH.prototype,"massSubscribe",[bG],Object.getOwnPropertyDescriptor(rH.prototype,"massSubscribe"),rH.prototype),Rj(rH.prototype,"unsubscribe",[xG],Object.getOwnPropertyDescriptor(rH.prototype,"unsubscribe"),rH.prototype),Rj(rH.prototype,"massUnsubscribe",[wG],Object.getOwnPropertyDescriptor(rH.prototype,"massUnsubscribe"),rH.prototype),Rj(rH.prototype,"setLowStreamParameter",[SG],Object.getOwnPropertyDescriptor(rH.prototype,"setLowStreamParameter"),rH.prototype),Rj(rH.prototype,"enableDualStream",[TG],Object.getOwnPropertyDescriptor(rH.prototype,"enableDualStream"),rH.prototype),Rj(rH.prototype,"disableDualStream",[NG],Object.getOwnPropertyDescriptor(rH.prototype,"disableDualStream"),rH.prototype),Rj(rH.prototype,"setClientRole",[CG],Object.getOwnPropertyDescriptor(rH.prototype,"setClientRole"),rH.prototype),Rj(rH.prototype,"_setClientRoleOptions",[AG],Object.getOwnPropertyDescriptor(rH.prototype,"_setClientRoleOptions"),rH.prototype),Rj(rH.prototype,"setProxyServer",[RG],Object.getOwnPropertyDescriptor(rH.prototype,"setProxyServer"),rH.prototype),Rj(rH.prototype,"setTurnServer",[IG],Object.getOwnPropertyDescriptor(rH.prototype,"setTurnServer"),rH.prototype),Rj(rH.prototype,"setLicense",[OG],Object.getOwnPropertyDescriptor(rH.prototype,"setLicense"),rH.prototype),Rj(rH.prototype,"startProxyServer",[PG],Object.getOwnPropertyDescriptor(rH.prototype,"startProxyServer"),rH.prototype),Rj(rH.prototype,"stopProxyServer",[kG],Object.getOwnPropertyDescriptor(rH.prototype,"stopProxyServer"),rH.prototype),Rj(rH.prototype,"setLocalAccessPointsV2",[DG],Object.getOwnPropertyDescriptor(rH.prototype,"setLocalAccessPointsV2"),rH.prototype),Rj(rH.prototype,"setLocalAccessPoints",[LG],Object.getOwnPropertyDescriptor(rH.prototype,"setLocalAccessPoints"),rH.prototype),Rj(rH.prototype,"setRemoteDefaultVideoStreamType",[jG],Object.getOwnPropertyDescriptor(rH.prototype,"setRemoteDefaultVideoStreamType"),rH.prototype),Rj(rH.prototype,"setRemoteVideoStreamType",[MG],Object.getOwnPropertyDescriptor(rH.prototype,"setRemoteVideoStreamType"),rH.prototype),Rj(rH.prototype,"setStreamFallbackOption",[UG],Object.getOwnPropertyDescriptor(rH.prototype,"setStreamFallbackOption"),rH.prototype),Rj(rH.prototype,"setEncryptionConfig",[VG],Object.getOwnPropertyDescriptor(rH.prototype,"setEncryptionConfig"),rH.prototype),Rj(rH.prototype,"renewToken",[FG],Object.getOwnPropertyDescriptor(rH.prototype,"renewToken"),rH.prototype),Rj(rH.prototype,"enableAudioVolumeIndicator",[BG],Object.getOwnPropertyDescriptor(rH.prototype,"enableAudioVolumeIndicator"),rH.prototype),Rj(rH.prototype,"startLiveStreaming",[GG],Object.getOwnPropertyDescriptor(rH.prototype,"startLiveStreaming"),rH.prototype),Rj(rH.prototype,"setLiveTranscoding",[HG],Object.getOwnPropertyDescriptor(rH.prototype,"setLiveTranscoding"),rH.prototype),Rj(rH.prototype,"stopLiveStreaming",[WG],Object.getOwnPropertyDescriptor(rH.prototype,"stopLiveStreaming"),rH.prototype),Rj(rH.prototype,"startChannelMediaRelay",[zG],Object.getOwnPropertyDescriptor(rH.prototype,"startChannelMediaRelay"),rH.prototype),Rj(rH.prototype,"updateChannelMediaRelay",[KG],Object.getOwnPropertyDescriptor(rH.prototype,"updateChannelMediaRelay"),rH.prototype),Rj(rH.prototype,"stopChannelMediaRelay",[qG],Object.getOwnPropertyDescriptor(rH.prototype,"stopChannelMediaRelay"),rH.prototype),Rj(rH.prototype,"sendCustomReportMessage",[YG],Object.getOwnPropertyDescriptor(rH.prototype,"sendCustomReportMessage"),rH.prototype),Rj(rH.prototype,"pickSVCLayer",[XG],Object.getOwnPropertyDescriptor(rH.prototype,"pickSVCLayer"),rH.prototype),Rj(rH.prototype,"setRTMConfig",[JG],Object.getOwnPropertyDescriptor(rH.prototype,"setRTMConfig"),rH.prototype),Rj(rH.prototype,"enableContentInspect",[QG],Object.getOwnPropertyDescriptor(rH.prototype,"enableContentInspect"),rH.prototype),Rj(rH.prototype,"disableContentInspect",[ZG],Object.getOwnPropertyDescriptor(rH.prototype,"disableContentInspect"),rH.prototype),Rj(rH.prototype,"setImageModeration",[$G],Object.getOwnPropertyDescriptor(rH.prototype,"setImageModeration"),rH.prototype),Rj(rH.prototype,"setP2PTransport",[eH],Object.getOwnPropertyDescriptor(rH.prototype,"setP2PTransport"),rH.prototype),Rj(rH.prototype,"getJoinChannelServiceRecords",[tH],Object.getOwnPropertyDescriptor(rH.prototype,"getJoinChannelServiceRecords"),rH.prototype),Rj(rH.prototype,"setPublishAudioFilterEnabled",[nH],Object.getOwnPropertyDescriptor(rH.prototype,"setPublishAudioFilterEnabled"),rH.prototype),rH);class oH{constructor(e,t){uT(this,"id",0),uT(this,"element",void 0),uT(this,"peerPair",void 0),uT(this,"context",void 0),uT(this,"audioPlayerElement",void 0),uT(this,"audioTrack",void 0),oH.count+=1,this.id=oH.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new np(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new fO(AA.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new fO(AA.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new fO(AA.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){aO.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var cH,lH;uT(oH,"count",0);const dH=window.AudioContext||window.webkitAudioContext,uH=new(cH=pO({report:mO}),Rj((lH=class{constructor(){uT(this,"units",[]),uT(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return aO.debug("the system does not need to process local aec"),-1;this.context||(this.context=new dH);let t=this.units.find(t=>t&&t.getElement()===e);return t||(t=new oH(e,this.context),this.units.push(t)),t.startEchoCancellation(),aO.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qC().name!==HC.SAFARI}}).prototype,"processExternalMediaAEC",[cH],Object.getOwnPropertyDescriptor(lH.prototype,"processExternalMediaAEC"),lH.prototype),lH);function hH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pH(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hH(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const mH=window||document;function fH(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!mH)return;const n=LY._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(LY.onSecurityPolicyViolation||LY.getListeners(NM.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;AI("CSP_DETECTED_HOSTNAME_LIST").some(e=>Dr(t).call(t,e))&&(LY.onSecurityPolicyViolation&&"function"==typeof LY.onSecurityPolicyViolation&&LY.onSecurityPolicyViolation(e),LY.getListeners(NM.SECURITY_POLICY_VIOLATION).length>0&&LY.safeEmit(NM.SECURITY_POLICY_VIOLATION,e))};n&&mH.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||LY.getListeners(NM.SECURITY_POLICY_VIOLATION).length>0)&&mH.addEventListener("securitypolicyviolation",r),LY._cspEventHandlerPointer=r}var gH=u,vH=AT,yH=RegExp.prototype,_H=function(e){return e===yH||gH(yH,e)?vH(e):e.flags},EH=r(_H);function bH(e){let t=e.length;for(;--t>=0;)e[t]=0}const xH=256,wH=286,SH=30,TH=15,NH=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),CH=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),AH=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),RH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),IH=new Array(576);bH(IH);const OH=new Array(60);bH(OH);const PH=new Array(512);bH(PH);const kH=new Array(256);bH(kH);const DH=new Array(29);bH(DH);const LH=new Array(SH);function jH(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let MH,UH,VH;function FH(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}bH(LH);const BH=e=>e<256?PH[e]:PH[256+(e>>>7)],GH=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},HH=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,GH(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},WH=(e,t,n)=>{HH(e,n[2*t],n[2*t+1])},zH=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},KH=(e,t,n)=>{const r=new Array(16);let i,s,a=0;for(i=1;i<=TH;i++)a=a+n[i-1]<<1,r[i]=a;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=zH(r[t]++,t))}},qH=e=>{let t;for(t=0;t<wH;t++)e.dyn_ltree[2*t]=0;for(t=0;t<SH;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},YH=e=>{e.bi_valid>8?GH(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},XH=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},JH=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&XH(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!XH(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},QH=(e,t,n)=>{let r,i,s,a,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,i=e.pending_buf[e.sym_buf+o++],0===r?WH(e,i,t):(s=kH[i],WH(e,s+xH+1,t),a=NH[s],0!==a&&(i-=DH[s],HH(e,i,a)),r--,s=BH(r),WH(e,s,n),a=CH[s],0!==a&&(r-=LH[s],HH(e,r,a)))}while(o<e.sym_next);WH(e,256,t)},ZH=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let a,o,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<s;a++)0!==n[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)JH(e,n,a);c=s;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],JH(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,n[2*c]=n[2*a]+n[2*o],e.depth[c]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,n[2*a+1]=n[2*o+1]=c,e.heap[1]=c++,JH(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,d,u,h,p,m,f=0;for(h=0;h<=TH;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)d=e.heap[l],h=n[2*n[2*d+1]+1]+1,h>c&&(h=c,f++),n[2*d+1]=h,d>r||(e.bl_count[h]++,p=0,d>=o&&(p=a[d-o]),m=n[2*d],e.opt_len+=m*(h+p),s&&(e.static_len+=m*(i[2*d+1]+p)));if(0!==f){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,f-=2}while(f>0);for(h=c;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--l],u>r||(n[2*u+1]!==h&&(e.opt_len+=(h-n[2*u+1])*n[2*u],n[2*u+1]=h),d--)}})(e,t),KH(n,l,e.bl_count)},$H=(e,t,n)=>{let r,i,s=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++o<c&&i===a||(o<l?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=i,0===a?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4))},eW=(e,t,n)=>{let r,i,s=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++o<c&&i===a)){if(o<l)do{WH(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==s&&(WH(e,i,e.bl_tree),o--),WH(e,16,e.bl_tree),HH(e,o-3,2)):o<=10?(WH(e,17,e.bl_tree),HH(e,o-3,3)):(WH(e,18,e.bl_tree),HH(e,o-11,7));o=0,s=i,0===a?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4)}};let tW=!1;const nW=(e,t,n,r)=>{HH(e,0+(r?1:0),3),YH(e),GH(e,n),GH(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var rW=e=>{tW||((()=>{let e,t,n,r,i;const s=new Array(16);for(n=0,r=0;r<28;r++)for(DH[r]=n,e=0;e<1<<NH[r];e++)kH[n++]=r;for(kH[n-1]=r,i=0,r=0;r<16;r++)for(LH[r]=i,e=0;e<1<<CH[r];e++)PH[i++]=r;for(i>>=7;r<SH;r++)for(LH[r]=i<<7,e=0;e<1<<CH[r]-7;e++)PH[256+i++]=r;for(t=0;t<=TH;t++)s[t]=0;for(e=0;e<=143;)IH[2*e+1]=8,e++,s[8]++;for(;e<=255;)IH[2*e+1]=9,e++,s[9]++;for(;e<=279;)IH[2*e+1]=7,e++,s[7]++;for(;e<=287;)IH[2*e+1]=8,e++,s[8]++;for(KH(IH,287,s),e=0;e<SH;e++)OH[2*e+1]=5,OH[2*e]=zH(e,5);MH=new jH(IH,NH,257,wH,TH),UH=new jH(OH,CH,0,SH,TH),VH=new jH(new Array(0),AH,0,19,7)})(),tW=!0),e.l_desc=new FH(e.dyn_ltree,MH),e.d_desc=new FH(e.dyn_dtree,UH),e.bl_desc=new FH(e.bl_tree,VH),e.bi_buf=0,e.bi_valid=0,qH(e)},iW=(e,t,n,r)=>{let i,s,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<xH;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ZH(e,e.l_desc),ZH(e,e.d_desc),a=(e=>{let t;for($H(e,e.dyn_ltree,e.l_desc.max_code),$H(e,e.dyn_dtree,e.d_desc.max_code),ZH(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*RH[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&-1!==t?nW(e,t,n,r):4===e.strategy||s===i?(HH(e,2+(r?1:0),3),QH(e,IH,OH)):(HH(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(HH(e,t-257,5),HH(e,n-1,5),HH(e,r-4,4),i=0;i<r;i++)HH(e,e.bl_tree[2*RH[i]+1],3);eW(e,e.dyn_ltree,t-1),eW(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),QH(e,e.dyn_ltree,e.dyn_dtree)),qH(e),r&&YH(e)},sW=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(kH[n]+xH+1)]++,e.dyn_dtree[2*BH(t)]++),e.sym_next===e.sym_end),aW=e=>{HH(e,2,3),WH(e,256,IH),(e=>{16===e.bi_valid?(GH(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},oW={_tr_init:rW,_tr_stored_block:nW,_tr_flush_block:iW,_tr_tally:sW,_tr_align:aW},cW=(e,t,n,r)=>{let i=65535&e,s=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{i=i+t[r++]|0,s=s+i|0}while(--a);i%=65521,s%=65521}return i|s<<16};const lW=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var dW=(e,t,n,r)=>{const i=lW,s=r+n;e^=-1;for(let a=r;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},uW={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},hW={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:pW,_tr_stored_block:mW,_tr_flush_block:fW,_tr_tally:gW,_tr_align:vW}=oW,{Z_NO_FLUSH:yW,Z_PARTIAL_FLUSH:_W,Z_FULL_FLUSH:EW,Z_FINISH:bW,Z_BLOCK:xW,Z_OK:wW,Z_STREAM_END:SW,Z_STREAM_ERROR:TW,Z_DATA_ERROR:NW,Z_BUF_ERROR:CW,Z_DEFAULT_COMPRESSION:AW,Z_FILTERED:RW,Z_HUFFMAN_ONLY:IW,Z_RLE:OW,Z_FIXED:PW,Z_DEFAULT_STRATEGY:kW,Z_UNKNOWN:DW,Z_DEFLATED:LW}=hW,jW=286,MW=30,UW=19,VW=2*jW+1,FW=15,BW=258,GW=262,HW=42,WW=113,zW=666,KW=(e,t)=>(e.msg=uW[t],t),qW=e=>2*e-(e>4?9:0),YW=e=>{let t=e.length;for(;--t>=0;)e[t]=0},XW=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let JW=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const QW=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},ZW=(e,t)=>{fW(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,QW(e.strm)},$W=(e,t)=>{e.pending_buf[e.pending++]=t},ez=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},tz=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=cW(e.adler,t,i,n):2===e.state.wrap&&(e.adler=dW(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},nz=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match;const c=e.strstart>e.w_size-GW?e.strstart-(e.w_size-GW):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+BW;let p=l[s+a-1],m=l[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,l[n+a]===m&&l[n+a-1]===p&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<h);if(r=BW-(h-s),s=h-BW,r>a){if(e.match_start=t,a=r,r>=o)break;p=l[s+a-1],m=l[s+a]}}}while((t=u[t&d])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead},rz=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-GW)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),XW(e),r+=t),0===e.strm.avail_in)break;if(n=tz(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=JW(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=JW(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<GW&&0!==e.strm.avail_in)},iz=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(0===n&&t!==bW||t===yW||n!==r+e.strm.avail_in))break;a=t===bW&&n===r+e.strm.avail_in?1:0,mW(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,QW(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(tz(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==yW&&t!==bW&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(tz(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===bW)&&t!==yW&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===bW&&0===e.strm.avail_in&&n===r?1:0,mW(e,e.block_start,n,a),e.block_start+=n,QW(e.strm)),a?3:1)},sz=(e,t)=>{let n,r;for(;;){if(e.lookahead<GW){if(rz(e),e.lookahead<GW&&t===yW)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=JW(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-GW&&(e.match_length=nz(e,n)),e.match_length>=3)if(r=gW(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=JW(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=JW(e,e.ins_h,e.window[e.strstart+1]);else r=gW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(ZW(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===bW?(ZW(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZW(e,!1),0===e.strm.avail_out)?1:2},az=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<GW){if(rz(e),e.lookahead<GW&&t===yW)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=JW(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-GW&&(e.match_length=nz(e,n),e.match_length<=5&&(e.strategy===RW||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=gW(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=JW(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(ZW(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=gW(e,0,e.window[e.strstart-1]),r&&ZW(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=gW(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===bW?(ZW(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZW(e,!1),0===e.strm.avail_out)?1:2};function oz(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const cz=[new oz(0,0,0,0,iz),new oz(4,4,8,4,sz),new oz(4,5,16,8,sz),new oz(4,6,32,32,sz),new oz(4,4,16,16,az),new oz(8,16,32,32,az),new oz(8,16,128,128,az),new oz(8,32,128,256,az),new oz(32,128,258,1024,az),new oz(32,258,258,4096,az)];function lz(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=LW,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*VW),this.dyn_dtree=new Uint16Array(2*(2*MW+1)),this.bl_tree=new Uint16Array(2*(2*UW+1)),YW(this.dyn_ltree),YW(this.dyn_dtree),YW(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(FW+1),this.heap=new Uint16Array(2*jW+1),YW(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jW+1),YW(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dz=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==HW&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==WW&&t.status!==zW?1:0},uz=e=>{if(dz(e))return KW(e,TW);e.total_in=e.total_out=0,e.data_type=DW;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?HW:WW,e.adler=2===t.wrap?0:1,t.last_flush=-2,pW(t),wW},hz=e=>{const t=uz(e);return t===wW&&(e=>{e.window_size=2*e.w_size,YW(e.head),e.max_lazy_match=cz[e.level].max_lazy,e.good_match=cz[e.level].good_length,e.nice_match=cz[e.level].nice_length,e.max_chain_length=cz[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},pz=(e,t,n,r,i,s)=>{if(!e)return TW;let a=1;if(t===AW&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==LW||r<8||r>15||t<0||t>9||s<0||s>PW||8===r&&1!==a)return KW(e,TW);8===r&&(r=9);const o=new lz;return e.state=o,o.strm=e,o.status=HW,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=s,o.method=n,hz(e)};var mz=(e,t)=>{if(dz(e)||t>xW||t<0)return e?KW(e,TW):TW;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===zW&&t!==bW)return KW(e,0===e.avail_out?CW:TW);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(QW(e),0===e.avail_out)return n.last_flush=-1,wW}else if(0===e.avail_in&&qW(t)<=qW(r)&&t!==bW)return KW(e,CW);if(n.status===zW&&0!==e.avail_in)return KW(e,CW);if(n.status===HW&&0===n.wrap&&(n.status=WW),n.status===HW){let t=LW+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=IW||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,ez(n,t),0!==n.strstart&&(ez(n,e.adler>>>16),ez(n,65535&e.adler)),e.adler=1,n.status=WW,QW(e),0!==n.pending)return n.last_flush=-1,wW}if(57===n.status)if(e.adler=0,$W(n,31),$W(n,139),$W(n,8),n.gzhead)$W(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),$W(n,255&n.gzhead.time),$W(n,n.gzhead.time>>8&255),$W(n,n.gzhead.time>>16&255),$W(n,n.gzhead.time>>24&255),$W(n,9===n.level?2:n.strategy>=IW||n.level<2?4:0),$W(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&($W(n,255&n.gzhead.extra.length),$W(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=dW(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if($W(n,0),$W(n,0),$W(n,0),$W(n,0),$W(n,0),$W(n,9===n.level?2:n.strategy>=IW||n.level<2?4:0),$W(n,3),n.status=WW,QW(e),0!==n.pending)return n.last_flush=-1,wW;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=dW(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,QW(e),0!==n.pending)return n.last_flush=-1,wW;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=dW(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=dW(e.adler,n.pending_buf,n.pending-r,r)),QW(e),0!==n.pending)return n.last_flush=-1,wW;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,$W(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=dW(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=dW(e.adler,n.pending_buf,n.pending-r,r)),QW(e),0!==n.pending)return n.last_flush=-1,wW;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,$W(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=dW(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(QW(e),0!==n.pending))return n.last_flush=-1,wW;$W(n,255&e.adler),$W(n,e.adler>>8&255),e.adler=0}if(n.status=WW,QW(e),0!==n.pending)return n.last_flush=-1,wW}if(0!==e.avail_in||0!==n.lookahead||t!==yW&&n.status!==zW){let r=0===n.level?iz(n,t):n.strategy===IW?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(rz(e),0===e.lookahead)){if(t===yW)return 1;break}if(e.match_length=0,n=gW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(ZW(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bW?(ZW(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZW(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===OW?((e,t)=>{let n,r,i,s;const a=e.window;for(;;){if(e.lookahead<=BW){if(rz(e),e.lookahead<=BW&&t===yW)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){s=e.strstart+BW;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);e.match_length=BW-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=gW(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=gW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(ZW(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bW?(ZW(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZW(e,!1),0===e.strm.avail_out)?1:2})(n,t):cz[n.level].func(n,t);if(3!==r&&4!==r||(n.status=zW),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),wW;if(2===r&&(t===_W?vW(n):t!==xW&&(mW(n,0,0,!1),t===EW&&(YW(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),QW(e),0===e.avail_out))return n.last_flush=-1,wW}return t!==bW?wW:n.wrap<=0?SW:(2===n.wrap?($W(n,255&e.adler),$W(n,e.adler>>8&255),$W(n,e.adler>>16&255),$W(n,e.adler>>24&255),$W(n,255&e.total_in),$W(n,e.total_in>>8&255),$W(n,e.total_in>>16&255),$W(n,e.total_in>>24&255)):(ez(n,e.adler>>>16),ez(n,65535&e.adler)),QW(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?wW:SW)},fz=(e,t)=>{let n=t.length;if(dz(e))return TW;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==HW||r.lookahead)return TW;if(1===i&&(e.adler=cW(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(YW(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const s=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,rz(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=JW(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,rz(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=o,e.avail_in=s,r.wrap=i,wW},gz={deflateInit:(e,t)=>pz(e,t,LW,15,8,kW),deflateInit2:pz,deflateReset:hz,deflateResetKeep:uz,deflateSetHeader:(e,t)=>dz(e)||2!==e.state.wrap?TW:(e.state.gzhead=t,wW),deflate:mz,deflateEnd:e=>{if(dz(e))return TW;const t=e.state.status;return e.state=null,t===WW?KW(e,NW):wW},deflateSetDictionary:fz,deflateInfo:"pako deflate (from Nodeca project)"};const vz=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var yz={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)vz(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let t=e[r];n.set(t,i),i+=t.length}return n}};let _z=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){_z=!1}const Ez=new Uint8Array(256);for(let n=0;n<256;n++)Ez[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Ez[254]=Ez[254]=1;var bz={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,s,a=e.length,o=0;for(i=0;i<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),s=0,i=0;s<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){s[i++]=t;continue}let a=Ez[t];if(a>4)s[i++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?s[i++]=65533:t<65536?s[i++]=t:(t-=65536,s[i++]=55296|t>>10&1023,s[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&_z)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Ez[e[n]]>t?n:t}},xz=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const wz=Object.prototype.toString,{Z_NO_FLUSH:Sz,Z_SYNC_FLUSH:Tz,Z_FULL_FLUSH:Nz,Z_FINISH:Cz,Z_OK:Az,Z_STREAM_END:Rz,Z_DEFAULT_COMPRESSION:Iz,Z_DEFAULT_STRATEGY:Oz,Z_DEFLATED:Pz}=hW;function kz(e){this.options=yz.assign({level:Iz,method:Pz,chunkSize:16384,windowBits:15,memLevel:8,strategy:Oz},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xz,this.strm.avail_out=0;let n=gz.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Az)throw new Error(uW[n]);if(t.header&&gz.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?bz.string2buf(t.dictionary):"[object ArrayBuffer]"===wz.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=gz.deflateSetDictionary(this.strm,e),n!==Az)throw new Error(uW[n]);this._dict_set=!0}}function Dz(e,t){const n=new kz(t);if(n.push(e,!0),n.err)throw n.msg||uW[n.err];return n.result}kz.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Cz:Sz,"string"==typeof e?n.input=bz.string2buf(e):"[object ArrayBuffer]"===wz.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Tz||s===Nz)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=gz.deflate(n,s),i===Rz)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=gz.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Az;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},kz.prototype.onData=function(e){this.chunks.push(e)},kz.prototype.onEnd=function(e){e===Az&&(this.result=yz.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Lz={Deflate:kz,deflate:Dz,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Dz(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Dz(e,t)},constants:hW};const jz=16209;var Mz=function(e,t){let n,r,i,s,a,o,c,l,d,u,h,p,m,f,g,v,y,_,E,b,x,w,S,T;const N=e.state;n=e.next_in,S=e.input,r=n+(e.avail_in-5),i=e.next_out,T=e.output,s=i-(t-e.avail_out),a=i+(e.avail_out-257),o=N.dmax,c=N.wsize,l=N.whave,d=N.wnext,u=N.window,h=N.hold,p=N.bits,m=N.lencode,f=N.distcode,g=(1<<N.lenbits)-1,v=(1<<N.distbits)-1;e:do{p<15&&(h+=S[n++]<<p,p+=8,h+=S[n++]<<p,p+=8),y=m[h&g];t:for(;;){if(_=y>>>24,h>>>=_,p-=_,_=y>>>16&255,0===_)T[i++]=65535&y;else{if(!(16&_)){if(0==(64&_)){y=m[(65535&y)+(h&(1<<_)-1)];continue t}if(32&_){N.mode=16191;break e}e.msg="invalid literal/length code",N.mode=jz;break e}E=65535&y,_&=15,_&&(p<_&&(h+=S[n++]<<p,p+=8),E+=h&(1<<_)-1,h>>>=_,p-=_),p<15&&(h+=S[n++]<<p,p+=8,h+=S[n++]<<p,p+=8),y=f[h&v];n:for(;;){if(_=y>>>24,h>>>=_,p-=_,_=y>>>16&255,!(16&_)){if(0==(64&_)){y=f[(65535&y)+(h&(1<<_)-1)];continue n}e.msg="invalid distance code",N.mode=jz;break e}if(b=65535&y,_&=15,p<_&&(h+=S[n++]<<p,p+=8,p<_&&(h+=S[n++]<<p,p+=8)),b+=h&(1<<_)-1,b>o){e.msg="invalid distance too far back",N.mode=jz;break e}if(h>>>=_,p-=_,_=i-s,b>_){if(_=b-_,_>l&&N.sane){e.msg="invalid distance too far back",N.mode=jz;break e}if(x=0,w=u,0===d){if(x+=c-_,_<E){E-=_;do{T[i++]=u[x++]}while(--_);x=i-b,w=T}}else if(d<_){if(x+=c+d-_,_-=d,_<E){E-=_;do{T[i++]=u[x++]}while(--_);if(x=0,d<E){_=d,E-=_;do{T[i++]=u[x++]}while(--_);x=i-b,w=T}}}else if(x+=d-_,_<E){E-=_;do{T[i++]=u[x++]}while(--_);x=i-b,w=T}for(;E>2;)T[i++]=w[x++],T[i++]=w[x++],T[i++]=w[x++],E-=3;E&&(T[i++]=w[x++],E>1&&(T[i++]=w[x++]))}else{x=i-b;do{T[i++]=T[x++],T[i++]=T[x++],T[i++]=T[x++],E-=3}while(E>2);E&&(T[i++]=T[x++],E>1&&(T[i++]=T[x++]))}break}}break}}while(n<r&&i<a);E=p>>3,n-=E,p-=E<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),N.hold=h,N.bits=p};const Uz=15,Vz=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Fz=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Bz=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Gz=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Hz=(e,t,n,r,i,s,a,o)=>{const c=o.bits;let l,d,u,h,p,m,f=0,g=0,v=0,y=0,_=0,E=0,b=0,x=0,w=0,S=0,T=null;const N=new Uint16Array(16),C=new Uint16Array(16);let A,R,I,O=null;for(f=0;f<=Uz;f++)N[f]=0;for(g=0;g<r;g++)N[t[n+g]]++;for(_=c,y=Uz;y>=1&&0===N[y];y--);if(_>y&&(_=y),0===y)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(v=1;v<y&&0===N[v];v++);for(_<v&&(_=v),x=1,f=1;f<=Uz;f++)if(x<<=1,x-=N[f],x<0)return-1;if(x>0&&(0===e||1!==y))return-1;for(C[1]=0,f=1;f<Uz;f++)C[f+1]=C[f]+N[f];for(g=0;g<r;g++)0!==t[n+g]&&(a[C[t[n+g]]++]=g);if(0===e?(T=O=a,m=20):1===e?(T=Vz,O=Fz,m=257):(T=Bz,O=Gz,m=0),S=0,g=0,f=v,p=s,E=_,b=0,u=-1,w=1<<_,h=w-1,1===e&&w>852||2===e&&w>592)return 1;for(;;){A=f-b,a[g]+1<m?(R=0,I=a[g]):a[g]>=m?(R=O[a[g]-m],I=T[a[g]-m]):(R=96,I=0),l=1<<f-b,d=1<<E,v=d;do{d-=l,i[p+(S>>b)+d]=A<<24|R<<16|I}while(0!==d);for(l=1<<f-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,g++,0==--N[f]){if(f===y)break;f=t[n+a[g]]}if(f>_&&(S&h)!==u){for(0===b&&(b=_),p+=v,E=f-b,x=1<<E;E+b<y&&(x-=N[E+b],!(x<=0));)E++,x<<=1;if(w+=1<<E,1===e&&w>852||2===e&&w>592)return 1;u=S&h,i[u]=_<<24|E<<16|p-s}}return 0!==S&&(i[p+S]=f-b<<24|64<<16),o.bits=_,0};const{Z_FINISH:Wz,Z_BLOCK:zz,Z_TREES:Kz,Z_OK:qz,Z_STREAM_END:Yz,Z_NEED_DICT:Xz,Z_STREAM_ERROR:Jz,Z_DATA_ERROR:Qz,Z_MEM_ERROR:Zz,Z_BUF_ERROR:$z,Z_DEFLATED:eK}=hW,tK=16180,nK=16190,rK=16191,iK=16192,sK=16194,aK=16199,oK=16200,cK=16206,lK=16209,dK=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function uK(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const hK=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<tK||t.mode>16211?1:0},pK=e=>{if(hK(e))return Jz;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=tK,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qz},mK=e=>{if(hK(e))return Jz;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,pK(e)},fK=(e,t)=>{let n;if(hK(e))return Jz;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Jz:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,mK(e))},gK=(e,t)=>{if(!e)return Jz;const n=new uK;e.state=n,n.strm=e,n.window=null,n.mode=tK;const r=fK(e,t);return r!==qz&&(e.state=null),r};let vK,yK,_K=!0;const EK=e=>{if(_K){vK=new Int32Array(512),yK=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Hz(1,e.lens,0,288,vK,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Hz(2,e.lens,0,32,yK,0,e.work,{bits:5}),_K=!1}e.lencode=vK,e.lenbits=9,e.distcode=yK,e.distbits=5},bK=(e,t,n,r)=>{let i;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var xK=(e,t)=>{let n,r,i,s,a,o,c,l,d,u,h,p,m,f,g,v,y,_,E,b,x,w,S=0;const T=new Uint8Array(4);let N,C;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(hK(e)||!e.output||!e.input&&0!==e.avail_in)return Jz;n=e.state,n.mode===rK&&(n.mode=iK),a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,l=n.hold,d=n.bits,u=o,h=c,w=qz;e:for(;;)switch(n.mode){case tK:if(0===n.wrap){n.mode=iK;break}for(;d<16;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,T[0]=255&l,T[1]=l>>>8&255,n.check=dW(n.check,T,2,0),l=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=lK;break}if((15&l)!==eK){e.msg="unknown compression method",n.mode=lK;break}if(l>>>=4,d-=4,x=8+(15&l),0===n.wbits&&(n.wbits=x),x>15||x>n.wbits){e.msg="invalid window size",n.mode=lK;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:rK,l=0,d=0;break;case 16181:for(;d<16;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(n.flags=l,(255&EH(n))!==eK){e.msg="unknown compression method",n.mode=lK;break}if(57344&EH(n)){e.msg="unknown header flags set",n.mode=lK;break}n.head&&(n.head.text=l>>8&1),512&EH(n)&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=dW(n.check,T,2,0)),l=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}n.head&&(n.head.time=l),512&EH(n)&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,n.check=dW(n.check,T,4,0)),l=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&EH(n)&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=dW(n.check,T,2,0)),l=0,d=0,n.mode=16184;case 16184:if(1024&EH(n)){for(;d<16;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}n.length=l,n.head&&(n.head.extra_len=l),512&EH(n)&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=dW(n.check,T,2,0)),l=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&EH(n)&&(p=n.length,p>o&&(p=o),p&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+p),x)),512&EH(n)&&4&n.wrap&&(n.check=dW(n.check,r,p,s)),o-=p,s+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&EH(n)){if(0===o)break e;p=0;do{x=r[s+p++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x))}while(x&&p<o);if(512&EH(n)&&4&n.wrap&&(n.check=dW(n.check,r,p,s)),o-=p,s+=p,x)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&EH(n)){if(0===o)break e;p=0;do{x=r[s+p++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x))}while(x&&p<o);if(512&EH(n)&&4&n.wrap&&(n.check=dW(n.check,r,p,s)),o-=p,s+=p,x)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&EH(n)){for(;d<16;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=lK;break}l=0,d=0}n.head&&(n.head.hcrc=EH(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=rK;break;case 16189:for(;d<32;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}e.adler=n.check=dK(l),l=0,d=0,n.mode=nK;case nK:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=o,n.hold=l,n.bits=d,Xz;e.adler=n.check=1,n.mode=rK;case rK:if(t===zz||t===Kz)break e;case iK:if(n.last){l>>>=7&d,d-=7&d,n.mode=cK;break}for(;d<3;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}switch(n.last=1&l,l>>>=1,d-=1,3&l){case 0:n.mode=16193;break;case 1:if(EK(n),n.mode=aK,t===Kz){l>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=lK}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=lK;break}if(n.length=65535&l,l=0,d=0,n.mode=sK,t===Kz)break e;case sK:n.mode=16195;case 16195:if(p=n.length,p){if(p>o&&(p=o),p>c&&(p=c),0===p)break e;i.set(r.subarray(s,s+p),a),o-=p,s+=p,c-=p,a+=p,n.length-=p;break}n.mode=rK;break;case 16196:for(;d<14;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(n.nlen=257+(31&l),l>>>=5,d-=5,n.ndist=1+(31&l),l>>>=5,d-=5,n.ncode=4+(15&l),l>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=lK;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}n.lens[A[n.have++]]=7&l,l>>>=3,d-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,N={bits:n.lenbits},w=Hz(0,n.lens,0,19,n.lencode,0,n.work,N),n.lenbits=N.bits,w){e.msg="invalid code lengths set",n.mode=lK;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[l&(1<<n.lenbits)-1],g=S>>>24,v=S>>>16&255,y=65535&S,!(g<=d);){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(y<16)l>>>=g,d-=g,n.lens[n.have++]=y;else{if(16===y){for(C=g+2;d<C;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(l>>>=g,d-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=lK;break}x=n.lens[n.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===y){for(C=g+3;d<C;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}l>>>=g,d-=g,x=0,p=3+(7&l),l>>>=3,d-=3}else{for(C=g+7;d<C;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}l>>>=g,d-=g,x=0,p=11+(127&l),l>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=lK;break}for(;p--;)n.lens[n.have++]=x}}if(n.mode===lK)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=lK;break}if(n.lenbits=9,N={bits:n.lenbits},w=Hz(1,n.lens,0,n.nlen,n.lencode,0,n.work,N),n.lenbits=N.bits,w){e.msg="invalid literal/lengths set",n.mode=lK;break}if(n.distbits=6,n.distcode=n.distdyn,N={bits:n.distbits},w=Hz(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,N),n.distbits=N.bits,w){e.msg="invalid distances set",n.mode=lK;break}if(n.mode=aK,t===Kz)break e;case aK:n.mode=oK;case oK:if(o>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=o,n.hold=l,n.bits=d,Mz(e,h),a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,l=n.hold,d=n.bits,n.mode===rK&&(n.back=-1);break}for(n.back=0;S=n.lencode[l&(1<<n.lenbits)-1],g=S>>>24,v=S>>>16&255,y=65535&S,!(g<=d);){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(v&&0==(240&v)){for(_=g,E=v,b=y;S=n.lencode[b+((l&(1<<_+E)-1)>>_)],g=S>>>24,v=S>>>16&255,y=65535&S,!(_+g<=d);){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}l>>>=_,d-=_,n.back+=_}if(l>>>=g,d-=g,n.back+=g,n.length=y,0===v){n.mode=16205;break}if(32&v){n.back=-1,n.mode=rK;break}if(64&v){e.msg="invalid literal/length code",n.mode=lK;break}n.extra=15&v,n.mode=16201;case 16201:if(n.extra){for(C=n.extra;d<C;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;S=n.distcode[l&(1<<n.distbits)-1],g=S>>>24,v=S>>>16&255,y=65535&S,!(g<=d);){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(0==(240&v)){for(_=g,E=v,b=y;S=n.distcode[b+((l&(1<<_+E)-1)>>_)],g=S>>>24,v=S>>>16&255,y=65535&S,!(_+g<=d);){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}l>>>=_,d-=_,n.back+=_}if(l>>>=g,d-=g,n.back+=g,64&v){e.msg="invalid distance code",n.mode=lK;break}n.offset=y,n.extra=15&v,n.mode=16203;case 16203:if(n.extra){for(C=n.extra;d<C;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=lK;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=lK;break}p>n.wnext?(p-=n.wnext,m=n.wsize-p):m=n.wnext-p,p>n.length&&(p=n.length),f=n.window}else f=i,m=a-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[a++]=f[m++]}while(--p);0===n.length&&(n.mode=oK);break;case 16205:if(0===c)break e;i[a++]=n.length,c--,n.mode=oK;break;case cK:if(n.wrap){for(;d<32;){if(0===o)break e;o--,l|=r[s++]<<d,d+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=EH(n)?dW(n.check,i,h,a-h):cW(n.check,i,h,a-h)),h=c,4&n.wrap&&(EH(n)?l:dK(l))!==n.check){e.msg="incorrect data check",n.mode=lK;break}l=0,d=0}n.mode=16207;case 16207:if(n.wrap&&EH(n)){for(;d<32;){if(0===o)break e;o--,l+=r[s++]<<d,d+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=lK;break}l=0,d=0}n.mode=16208;case 16208:w=Yz;break e;case lK:w=Qz;break e;case 16210:return Zz;default:return Jz}return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=o,n.hold=l,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<lK&&(n.mode<cK||t!==Wz))&&bK(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=EH(n)?dW(n.check,i,h,e.next_out-h):cW(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===rK?128:0)+(n.mode===aK||n.mode===sK?256:0),(0===u&&0===h||t===Wz)&&w===qz&&(w=$z),w},wK={inflateReset:mK,inflateReset2:fK,inflateResetKeep:pK,inflateInit:e=>gK(e,15),inflateInit2:gK,inflate:xK,inflateEnd:e=>{if(hK(e))return Jz;let t=e.state;return t.window&&(t.window=null),e.state=null,qz},inflateGetHeader:(e,t)=>{if(hK(e))return Jz;const n=e.state;return 0==(2&n.wrap)?Jz:(n.head=t,t.done=!1,qz)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return hK(e)?Jz:(r=e.state,0!==r.wrap&&r.mode!==nK?Jz:r.mode===nK&&(i=1,i=cW(i,t,n,0),i!==r.check)?Qz:(s=bK(e,t,n,n),s?(r.mode=16210,Zz):(r.havedict=1,qz)))},inflateInfo:"pako inflate (from Nodeca project)"},SK=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const TK=Object.prototype.toString,{Z_NO_FLUSH:NK,Z_FINISH:CK,Z_OK:AK,Z_STREAM_END:RK,Z_NEED_DICT:IK,Z_STREAM_ERROR:OK,Z_DATA_ERROR:PK,Z_MEM_ERROR:kK}=hW;function DK(e){this.options=yz.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xz,this.strm.avail_out=0;let n=wK.inflateInit2(this.strm,t.windowBits);if(n!==AK)throw new Error(uW[n]);if(this.header=new SK,wK.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=bz.string2buf(t.dictionary):"[object ArrayBuffer]"===TK.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=wK.inflateSetDictionary(this.strm,t.dictionary),n!==AK)))throw new Error(uW[n])}function LK(e,t){const n=new DK(t);if(n.push(e),n.err)throw n.msg||uW[n.err];return n.result}DK.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?CK:NK,"[object ArrayBuffer]"===TK.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=wK.inflate(n,a),s===IK&&i&&(s=wK.inflateSetDictionary(n,i),s===AK?s=wK.inflate(n,a):s===PK&&(s=IK));n.avail_in>0&&s===RK&&n.state.wrap>0&&0!==e[n.next_in];)wK.inflateReset(n),s=wK.inflate(n,a);switch(s){case OK:case PK:case IK:case kK:return this.onEnd(s),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||s===RK))if("string"===this.options.to){let e=bz.utf8border(n.output,n.next_out),t=n.next_out-e,i=bz.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==AK||0!==o){if(s===RK)return s=wK.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},DK.prototype.onData=function(e){this.chunks.push(e)},DK.prototype.onEnd=function(e){e===AK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=yz.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jK={Inflate:DK,inflate:LK,inflateRaw:function(e,t){return(t=t||{}).raw=!0,LK(e,t)},ungzip:LK,constants:hW};const{Deflate:MK,deflate:UK,deflateRaw:VK,gzip:FK}=Lz,{Inflate:BK,inflate:GK,inflateRaw:HK,ungzip:WK}=jK;var zK=UK,KK=GK,qK=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(qK||{});class YK{constructor(){uT(this,"_sequence",0),uT(this,"_startTime",Date.now()),uT(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;AI("SHOW_DATASTREAM2_LOG")&&aO.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n);let s=0;if(i.setUint16(s,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),s+=2,i.setUint32(s,t.commonPacketHeader.sequence,!0),s+=4,i.setUint16(s,t.commonStreamHeader,!0),s+=2,t.extension){const e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),s),s+=e.byteLength}if(r.set(new Uint8Array(t.payload),s),s+=t.payload.byteLength,s!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const r=t.getUint16(n,!0);n+=2;const i={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let s,a;if(n+=4,AI("SHOW_DATASTREAM2_LOG")&&aO.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(n,!0),n+=2,i.extension){a=this.deserializeExtension(e.slice(n)),n+=2+a.length,s=e.slice(n);let t=!1;if(a.datas.length>0){const e=a.datas.find(e=>0===e.id);e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}s=t?this.decompress(s):s}else s=e.slice(8);return s}serializeExtension(e){const{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),s=new Uint8Array(i),a=new DataView(i);let o=0;if(a.setUint8(o++,t),a.setUint8(o++,n),r.forEach(e=>{t?(a.setUint8(o++,e.id),a.setUint8(o++,e.length),s.set(new Uint8Array(e.data),o),o+=e.data.byteLength):(a.setUint8(o++,e.id|e.length<<4),s.set(new Uint8Array(e.data),o),o+=e.data.byteLength)}),o!==n+2)throw Error("serialize extension error, is ".concat(o,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const r=t.getUint8(n);n++;const i=t.getUint8(n);n++;const s=r===qK.TWO_BYTE,a=[],o=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);s?(e=o.getUint8(c),c++,t=o.getUint8(c),c++):(e=15&o.getUint8(c),t=o.getUint8(c)>>4,c++),t>0&&(n=o.buffer.slice(c+2,c+2+t),c+=n.byteLength),a.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:a}}decompress(e){return KK(new Uint8Array(e))}compress(e){return zK(new Uint8Array(e))}}const XK={name:"DataStream",create:(e,t)=>{const n=t?new eL(e):new tL(e);return n.useDataStream(new YK),n}};class JK extends WA{constructor(e,t,n){super(),uT(this,"ws",void 0),uT(this,"requestId",1),uT(this,"heartBeatTimer",void 0),uT(this,"joinInfo",void 0),uT(this,"clientId",void 0),uT(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),uT(this,"onClose",e=>{this.emit("close"),this.dispose()}),uT(this,"onMessage",e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)}),this.joinInfo=e,this.clientId=t,this.ws=new JM("cross-channel-".concat(this.clientId),n),this.ws.on(Bj.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Bj.CONNECTED,this.onOpen),this.ws.on(Bj.ON_MESSAGE,this.onMessage),this.ws.on(Bj.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new np((t,n)=>{const r=window.setTimeout(()=>{n(new fO(AA.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new fO(AA.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),n(new fO(AA.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new fO(AA.WS_DISCONNECT);const t=()=>new np((e,t)=>{this.ws.once(Bj.CLOSED,()=>t(new fO(AA.WS_ABORT))),this.ws.once(Bj.CONNECTED,e)});"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),r=new np((e,t)=>{const r=()=>{t(new fO(AA.WS_ABORT))};this.ws.once(Bj.RECONNECTING,r),this.ws.once(Bj.CLOSED,r),this.once("req_".concat(n),e),SR(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(Bj.RECONNECTING,r),this.ws.off(Bj.CLOSED,r),t(new fO(AA.TIMEOUT,"cross channel ws request timeout"))})}),i=await r;if(!i||200!==i.code)throw new fO(AA.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(Bj.REQUEST_NEW_URLS),this.ws.on(Bj.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class QK extends WA{set state(e){e!==this._state&&(e!==tM.RELAY_STATE_FAILURE&&(this.errorCode=nM.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),uT(this,"joinInfo",void 0),uT(this,"sid",void 0),uT(this,"clientId",void 0),uT(this,"cancelToken",jC.CancelToken.source()),uT(this,"workerToken",void 0),uT(this,"requestId",0),uT(this,"signal",void 0),uT(this,"prevChannelMediaConfig",void 0),uT(this,"httpRetryConfig",void 0),uT(this,"_resolution",void 0),uT(this,"_state",tM.RELAY_STATE_IDLE),uT(this,"errorCode",nM.RELAY_OK),uT(this,"onStatus",e=>{aO.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nM.SRC_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nM.DEST_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE))}),uT(this,"onReconnect",async()=>{aO.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",eM.NETWORK_DISCONNECTED),this.state=tM.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{this.state!==tM.RELAY_STATE_IDLE&&(aO.error("auto restart channel media relay failed",e.toString()),this.errorCode=nM.SERVER_CONNECTION_LOST,this.state=tM.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=NR(),this.signal=new JK(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_IDLE)throw new fO(AA.INVALID_OPERATION);this.state=tM.RELAY_STATE_CONNECTING,await this.connect(),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new fO(AA.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new fO(AA.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new fO(AA.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_RUNNING)throw new fO(AA.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==tM.RELAY_STATE_RUNNING)throw new fO(AA.INVALID_OPERATION);const t=this.genMessage($j.SetVideoProfile);await this.signal.request(t),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),aO.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tM.RELAY_STATE_IDLE,this.dispose()}dispose(){aO.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=jC.CancelToken.source(),this.state=tM.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await VV(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",eM.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage($j.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage($j.SetSdkProfile,e);await this.signal.request(n),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage($j.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",eM.PACKET_JOINED_SRC_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage($j.SetSourceUserId,e);await this.signal.request(i),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const s=this.genMessage($j.SetDestChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",eM.PACKET_JOINED_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage($j.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",eM.PACKET_SENT_TO_DEST_CHANNEL),this.state=tM.RELAY_STATE_RUNNING,aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage($j.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",eM.PACKET_UPDATE_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage($j.StopPacketTransfer);await this.signal.request(e),aO.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:yI,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.24.0"===s.sdkVersion&&(s.sdkVersion="0.0.1");let a=null,o=null;switch(e){case $j.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case $j.SetSourceChannel:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(AA.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:o.channelName,token:o.token||this.joinInfo.appId},s;case $j.SetSourceUserId:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(AA.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:o.uid+""},s;case $j.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(AA.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),s.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},s;case $j.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case $j.Reconnect:return s.clientRequest={command:"Reconnect"},s;case $j.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case $j.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(AA.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},s;case $j.SetVideoProfile:s.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s}}const ZK={name:"ChannelMediaRelay",create:function(e){return new QK(e.joinInfo,e.clientId,e.websocketRetryConfig||FR,e.httpRetryConfig||FR,e.resolution)}};function $K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$K(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$K(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class tq extends WA{constructor(e,t,n,r){super(),uT(this,"spec",void 0),uT(this,"token",void 0),uT(this,"websocket",void 0),uT(this,"pingpongTimer",void 0),uT(this,"reconnectMode","retry"),uT(this,"serviceMode",void 0),uT(this,"reqId",0),uT(this,"commandReqId",0),uT(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),uT(this,"handleWebSocketMessage",e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(mO.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===Wj.TRANSCODE?1:2}),this.emit(Xj.PUBLISH_STREAM_STATUS,t))}),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new JM("live-streaming",n),this.websocket.on(Bj.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Bj.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Bj.REQUEST_NEW_URLS,(e,t)=>{sR(this,Xj.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(Bj.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new fO(AA.UNEXPECTED_ERROR);const a=eq({command:e,sdkVersion:"4.24.0"===yI?"0.0.1":yI,seq:s,requestId:s,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new fO(AA.WS_DISCONNECT);const o=()=>new np((e,t)=>{this.websocket.once(Bj.CLOSED,()=>t(new fO(AA.WS_ABORT))),this.websocket.once(Bj.CONNECTED,e)});"connected"!==this.websocket.state&&await o(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const c=new np((e,t)=>{const n=()=>{t(new fO(AA.WS_ABORT))};this.websocket.once(Bj.RECONNECTING,n),this.websocket.once(Bj.CLOSED,n),this.once("@".concat(s,"-").concat(this.spec.sid),t=>{e(t)})});r&&mO.workerEvent(this.spec.sid,eq(eq({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let d=null;try{d=await c}catch(r){if("closed"===this.websocket.state)throw r;return await o(),await this.request(e,t,n)}return r&&mO.workerEvent(this.spec.sid,eq(eq({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-l})),200!==d.code&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.24.0"===yI?"0.0.1":yI;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Qj.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void aO.warning("live stream response already exists stream");case Qj.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Qj.LIVE_STREAM_RESPONSE_BAD_STREAM:case Qj.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new fO(AA.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Qj.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new fO(AA.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new fO(AA.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Xj.WARNING,t,e.serverResponse.url)}case Qj.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new fO(AA.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Xj.WARNING,t,e.serverResponse.url)}case Qj.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Qj.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new fO(AA.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new fO(AA.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Xj.WARNING,t,e.serverResponse.url)}case Qj.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Qj.LIVE_STREAM_RESPONSE_WORKER_LOST:case Qj.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Qj.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Qj.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new fO(AA.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(CR)},6e3)}}function nq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nq(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class iq extends WA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FR,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FR;super(),uT(this,"onLiveStreamWarning",void 0),uT(this,"onLiveStreamError",void 0),uT(this,"spec",void 0),uT(this,"retryTimeout",1e4),uT(this,"connection",void 0),uT(this,"httpRetryConfig",void 0),uT(this,"wsRetryConfig",void 0),uT(this,"streamingTasks",new Map),uT(this,"isStartingStreamingTask",!1),uT(this,"taskMutex",new UR("live-streaming")),uT(this,"cancelToken",jC.CancelToken.source()),uT(this,"transcodingConfig",void 0),uT(this,"uapResponse",void 0),uT(this,"lastTaskId",1),uT(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=rq(rq({},Yj),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(aO.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(e=>rq(rq(rq({},zj),e),{},{zOrder:e.zOrder?e.zOrder+1:1}))),function(e){jA(e.width)||PA(e.width,"config.width",0,1e4),jA(e.height)||PA(e.height,"config.height",0,1e4),jA(e.videoBitrate)||PA(e.videoBitrate,"config.videoBitrate",1,1e6),jA(e.videoFrameRate)||PA(e.videoFrameRate,"config.videoFrameRate"),jA(e.lowLatency)||IA(e.lowLatency,"config.lowLatency"),jA(e.audioSampleRate)||OA(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),jA(e.audioBitrate)||PA(e.audioBitrate,"config.audioBitrate",1,128),jA(e.audioChannels)||OA(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),jA(e.videoGop)||PA(e.videoGop,"config.videoGop"),jA(e.videoCodecProfile)||OA(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),jA(e.userCount)||PA(e.userCount,"config.userCount",0,17),jA(e.backgroundColor)||PA(e.backgroundColor,"config.backgroundColor",0,16777215),jA(e.userConfigExtraInfo)||DA(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!jA(e.transcodingUsers)&&(LA(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((e,t)=>{Hj(e.uid),jA(e.x)||PA(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),jA(e.y)||PA(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),jA(e.width)||PA(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),jA(e.height)||PA(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),jA(e.zOrder)||PA(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),jA(e.alpha)||PA(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),jA(e.watermark)||qj(e.watermark,"watermark"),jA(e.backgroundImage)||qj(e.backgroundImage,"backgroundImage"),e.images&&!jA(e.images)&&(LA(e.images,"config.images"),e.images.forEach((e,t)=>{qj(e,"images[".concat(t,"]"))}))}(t);const n=[];t.images&&n.push(...t.images.map(e=>rq(rq(rq({},Kj),e),{},{zOrder:255}))),t.backgroundImage&&(n.push(rq(rq(rq({},Kj),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(rq(rq(rq({},Kj),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(e=>rq({},e)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map(e=>"number"==typeof e.uid?np.resolve(e.uid):DV(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await np.all(r)).forEach((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)}),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(up(i=this.streamingTasks).call(i)).map(e=>e.taskId).join("#")});aO.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(t=>{aO.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then(()=>{aO.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))}).catch(e=>{aO.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)})})}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===Wj.TRANSCODE)throw new fO(AA.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};aO.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const i=await this.taskMutex.lock();if(!this.connection&&n)return void i();if(this.streamingTasks.get(e)&&!n)return i(),new fO(AA.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw i(),e}switch(t){case Wj.TRANSCODE:r.transcodingConfig=rq({},this.transcodingConfig);case Wj.RAW:}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const s=this.lastTaskId++;try{const a=new np((t,r)=>{SR(this.retryTimeout).then(()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0})}),o=await np.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===Wj.TRANSCODE?1:2,requestByUser:!n,tid:s.toString()}),a]);this.isStartingStreamingTask=!1,aO.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(o.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:s}),i()}catch(r){if(i(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new np((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new fO(AA.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===Wj.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(n=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(n)})}resetAllTask(){var e;const t=Array.from(up(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch(e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=jC.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new fO(AA.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await sR(this,Jj.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new tq(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Xj.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(Xj.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(Xj.REQUEST_NEW_ADDRESS,(t,n)=>{if(!this.connection)return n(new fO(AA.UNEXPECTED_ERROR,"can not get new live streaming address list"));sR(this,Jj.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(n)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case Qj.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new fO(AA.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return aO.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case Qj.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new fO(AA.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case Qj.LIVE_STREAM_RESPONSE_WORKER_LOST:case Qj.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(up(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(aO.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new fO(AA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{aO.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)}).catch(e=>{aO.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const sq={name:"LiveStreaming",create:function(e){return new iq(e.joinInfo,e.websocketRetryConfig||FR,e.httpRetryConfig||FR)}};function aq(e){let t=vq();return function(e,t){let n=e.appId;void 0!==n&&(Oq(t,10),Sq(t,n));let r=e.cid;void 0!==r&&(Oq(t,16),Oq(t,r));let i=e.cname;void 0!==i&&(Oq(t,26),Sq(t,i));let s=e.deviceId;void 0!==s&&(Oq(t,34),Sq(t,s));let a=e.elapse;void 0!==a&&(Oq(t,40),Pq(t,a));let o=e.fileSize;void 0!==o&&(Oq(t,48),Pq(t,fq(o)));let c=e.height;void 0!==c&&(Oq(t,56),Pq(t,fq(c)));let l=e.jpg;void 0!==l&&(Oq(t,66),Oq(t,l.length),function(e,t){let n=bq(e,t.length);e.bytes.set(t,n)}(t,l));let d=e.networkType;void 0!==d&&(Oq(t,72),Pq(t,fq(d)));let u=e.osType;void 0!==u&&(Oq(t,80),Pq(t,fq(u)));let h=e.requestId;void 0!==h&&(Oq(t,90),Sq(t,h));let p=e.sdkVersion;void 0!==p&&(Oq(t,98),Sq(t,p));let m=e.sequence;void 0!==m&&(Oq(t,104),Pq(t,fq(m)));let f=e.sid;void 0!==f&&(Oq(t,114),Sq(t,f));let g=e.timestamp;void 0!==g&&(Oq(t,120),Pq(t,g));let v=e.uid;void 0!==v&&(Oq(t,128),Oq(t,v));let y=e.vid;void 0!==y&&(Oq(t,136),Oq(t,y));let _=e.width;void 0!==_&&(Oq(t,144),Pq(t,fq(_)));let E=e.service;void 0!==E&&(Oq(t,152),Oq(t,E));let b=e.callbackData;void 0!==b&&(Oq(t,162),Sq(t,b));let x=e.jpgEncryption;void 0!==x&&(Oq(t,168),Oq(t,x));let w=e.requestType;void 0!==w&&(Oq(t,176),Oq(t,w));let S=e.scorePorn;void 0!==S&&(Oq(t,185),Rq(t,S));let T=e.scoreSexy;void 0!==T&&(Oq(t,193),Rq(t,T));let N=e.scoreNeutral;void 0!==N&&(Oq(t,201),Rq(t,N));let C=e.scene;void 0!==C&&(Oq(t,208),Oq(t,C));let A=e.ossFilePrefix;void 0!==A&&(Oq(t,218),Sq(t,A));let R=e.serviceVendor;if(void 0!==R)for(let I of R){Oq(t,226);let e=vq();lq(I,e),Oq(t,e.limit),Tq(t,e),yq(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function oq(e){return function(e){let t={};e:for(;!Eq(e);){let n=Iq(e);switch(n>>>3){case 0:break e;case 1:t.code=Iq(e);break;case 2:t.msg=wq(e,Iq(e));break;case 3:{let n=dq(e);t.data=cq(e),e.limit=n;break}default:uq(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function cq(e){let t={};e:for(;!Eq(e);){let n=Iq(e);switch(n>>>3){case 0:break e;case 1:t.requestId=wq(e,Iq(e));break;case 2:t.requestType=Iq(e)>>>0;break;case 3:t.scorePorn=Aq(e);break;case 4:t.scoreSexy=Aq(e);break;case 5:t.scoreNeutral=Aq(e);break;case 6:t.requestScene=Iq(e)>>>0;break;case 7:t.scene=Iq(e)>>>0;break;default:uq(e,7&n)}}return t}function lq(e,t){let n=e.service;void 0!==n&&(Oq(t,8),Oq(t,n));let r=e.vendor;void 0!==r&&(Oq(t,16),Oq(t,r));let i=e.token;void 0!==i&&(Oq(t,26),Sq(t,i));let s=e.callbackUrl;void 0!==s&&(Oq(t,34),Sq(t,s))}function dq(e){let t=Iq(e),n=e.limit;return e.limit=e.offset+t,n}function uq(e,t){switch(t){case 0:for(;128&Nq(e););break;case 2:_q(e,Iq(e));break;case 5:_q(e,4);break;case 1:_q(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let hq=new Float32Array(1);new Uint8Array(hq.buffer);let pq=new Float64Array(1),mq=new Uint8Array(pq.buffer);function fq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let gq=[];function vq(){const e=gq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function yq(e){gq.push(e)}function _q(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Eq(e){return e.offset>=e.limit}function bq(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let t=new Uint8Array(2*s);t.set(n),e.bytes=t}return e.offset=s,s>i&&(e.limit=s),r}function xq(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function wq(e,t){let n=xq(e,t),r=String.fromCharCode,i=e.bytes,s="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=i[o+n];0==(128&u)?a+=r(u):192==(224&u)?o+1>=t?a+=s:(e=i[o+n+1],128!=(192&e)?a+=s:(d=(31&u)<<6|63&e,d<128?a+=s:(a+=r(d),o++))):224==(240&u)?o+2>=t?a+=s:(e=i[o+n+1],c=i[o+n+2],32896!=(49344&(e|c<<8))?a+=s:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=s:(a+=r(d),o+=2))):240==(248&u)?o+3>=t?a+=s:(e=i[o+n+1],c=i[o+n+2],l=i[o+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=s:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=s:(d-=65536,a+=r(55296+(d>>10),56320+(1023&d)),o+=3))):a+=s}return a}function Sq(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}Oq(e,r);let i=bq(e,r),s=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?s[i++]=e:(e<2048?s[i++]=e>>6&31|192:(e<65536?s[i++]=e>>12&15|224:(s[i++]=e>>18&7|240,s[i++]=e>>12&63|128),s[i++]=e>>6&63|128),s[i++]=63&e|128)}}function Tq(e,t){let n=bq(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,a=t.limit;s<a;s++)r[s+n]=i[s]}function Nq(e){return e.bytes[xq(e,1)]}function Cq(e,t){let n=bq(e,1);e.bytes[n]=t}function Aq(e){let t=xq(e,8),n=e.bytes;return mq[0]=n[t++],mq[1]=n[t++],mq[2]=n[t++],mq[3]=n[t++],mq[4]=n[t++],mq[5]=n[t++],mq[6]=n[t++],mq[7]=n[t++],pq[0]}function Rq(e,t){let n=bq(e,8),r=e.bytes;pq[0]=t,r[n++]=mq[0],r[n++]=mq[1],r[n++]=mq[2],r[n++]=mq[3],r[n++]=mq[4],r[n++]=mq[5],r[n++]=mq[6],r[n++]=mq[7]}function Iq(e){let t,n=0,r=0;do{t=Nq(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function Oq(e,t){for(t>>>=0;t>=128;)Cq(e,127&t|128),t>>>=7;Cq(e,t)}function Pq(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=bq(e,s),o=e.bytes;switch(s){case 10:o[a+9]=i>>>7&1;case 9:o[a+8]=9!==s?128|i:127&i;case 8:o[a+7]=8!==s?r>>>21|128:r>>>21&127;case 7:o[a+6]=7!==s?r>>>14|128:r>>>14&127;case 6:o[a+5]=6!==s?r>>>7|128:r>>>7&127;case 5:o[a+4]=5!==s?128|r:127&r;case 4:o[a+3]=4!==s?n>>>21|128:n>>>21&127;case 3:o[a+2]=3!==s?n>>>14|128:n>>>14&127;case 2:o[a+1]=2!==s?n>>>7|128:n>>>7&127;case 1:o[a]=1!==s?128|n:127&n}}function kq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}const Dq=new Map([["moderation",1],["supervise",2]]);class Lq extends WA{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(SM.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=ii(t=e.map(e=>Dq.get(e)||0)).call(t,(e,t)=>e+t),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),uT(this,"name","AgoraRTCVideoContentInspect"),uT(this,"_connectionState",xM.CONNECTING),uT(this,"_innerConnectionState",void 0),uT(this,"sequence",0),uT(this,"inspectStartTime",void 0),uT(this,"workerManagerConnection",void 0),uT(this,"workerConnection",void 0),uT(this,"workerMessageLengthLimit",void 0),uT(this,"inspectIntervalMinimum",void 0),uT(this,"qualityRatio",void 0),uT(this,"_connectInfo",void 0),uT(this,"_cancelTokenSource",jC.CancelToken.source()),uT(this,"_retryConfig",void 0),uT(this,"wmSequence",0),uT(this,"inspectInterval",void 0),uT(this,"inspectTimer",null),uT(this,"ossFilePrefix",void 0),uT(this,"extraInfo",void 0),uT(this,"_inspectType",void 0),uT(this,"_inspectMode",void 0),uT(this,"_quality",1),uT(this,"qualityTimer",null),uT(this,"_inspectId",void 0),uT(this,"_needWorkUrlOnly",!1),uT(this,"inspectImage",()=>{if(this.connectionState!==xM.CONNECTED)throw new fO(AA.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===xM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=TR(5,"inspect-"),this.workerMessageLengthLimit=AI("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=AI("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=AI("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new JM("worker-manager-"+this._inspectId,FR),this.on(SM.STATE_CHANGE,(e,t)=>{this._innerConnectionState=e,aO.debug("[".concat(this._inspectId,"] Inspect operation :").concat(wM[e]," ").concat(t||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new JM("worker-"+this._inspectId,FR),this.handleWorkerEvents()}async init(e,t){this.emit(SM.STATE_CHANGE,wM.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np((r,i)=>{this.on(SM.CONNECTION_STATE_CHANGE,(e,t)=>{t===xM.CONNECTED&&r()}),this.requestAP(e,n,t).then(e=>{this.connectWorkerManager(e)}).catch(e=>{i(e)})})}async requestAP(e,t,n){const r=AI("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),i=await function(e,t,n,r){let{appId:i,areaCode:s,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="image_moderation_api",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:s,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,token:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GR(async()=>{h=Date.now();const e=await sV(m,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(AA.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(AA.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(AA.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const r=AI("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=AI("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,responseTime:p}},(t,n)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==AA.OPERATION_ABORTED&&t.code!==AA.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)),r)}(r,e,t,n);this.emit(SM.STATE_CHANGE,wM.AP_CONNECTED);const{addressList:s}=i;return this.wmSequence++,s}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(SM.STATE_CHANGE,wM.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Bj.CONNECTED,async()=>{this.emit(SM.STATE_CHANGE,wM.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Bj.CLOSED,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Bj.FAILED,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Bj.RECONNECTING,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Bj.ON_MESSAGE,async e=>{this.emit(SM.STATE_CHANGE,wM.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw aO.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new fO(AA.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw aO.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new fO(AA.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=AI("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(SM.STATE_CHANGE,wM.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(SM.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}}),this.workerManagerConnection.on(Bj.WILL_RECONNECT,(e,t,n)=>{n(e)}),this.workerManagerConnection.on(Bj.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(Bj.CONNECTED,async()=>{this.emit(SM.STATE_CHANGE,wM.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=xM.CONNECTED}),this.workerConnection.on(Bj.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=oq(new Uint8Array(e.data));if(AI("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&aO.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(SM.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=ii(t=Object.keys(e)).call(t,(t,n)=>e[t]>e[n]?t:n,"porn"),i=Object.keys(e).find(e=>e===r);this.emit(SM.INSPECT_RESULT,i)}else this.emit(SM.INSPECT_RESULT,void 0,new fO(AA.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(SM.INSPECT_RESULT,void 0,new fO(AA.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else aO.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(SM.INSPECT_RESULT,void 0,new fO(AA.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Bj.CLOSED,()=>{this.connectionState=xM.CLOSED}),this.workerConnection.on(Bj.FAILED,()=>{this.connectionState=xM.CLOSED}),this.workerConnection.on(Bj.RECONNECTING,()=>{this.connectionState=this.connectionState===xM.CONNECTED?xM.RECONNECTING:xM.CONNECTING}),this.workerConnection.on(Bj.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this.workerConnection.on(Bj.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(SM.REQUEST_NEW_WORKER_URL,t=>{e([t])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e=>{this.connectWorkerManager(e,!0)}).catch(e=>{t(e)})})}async requestToInspectImage(){this.sequence++;const e=oR(this,SM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(SM.INSPECT_RESULT,void 0,new fO(AA.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(SM.INSPECT_RESULT,void 0,new fO(AA.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:s,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await QP(l,n,r),u=this.sequence+"-"+i+"-"+o+"-"+c+"-"+TR(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:(p=Number(c-this.inspectStartTime),{low:p|=0,high:p>>31,unsigned:p>=0}),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this.sequence,sid:a,timestamp:uG(c),uid:o,vid:s,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var p;void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const m=aq(h);if(m.byteLength<this.workerMessageLengthLimit){if(AI("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kq(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return m}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:s,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=jC.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=xM.CLOSED,this.emit(SM.STATE_CHANGE,wM.CLOSED)}}const jq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new fO(AA.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new fO(AA.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach(e=>{var t;if(!Dr(t=["supervise","moderation"]).call(t,e))throw new fO(AA.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(AA.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Lq(t)}};var Mq=r(ee.Object.getOwnPropertySymbols),Uq=On,Vq=Jn.indexOf,Fq=Wr,Bq=T([].indexOf),Gq=!!Bq&&1/Bq([1],1,-0)<0;Uq({target:"Array",proto:!0,forced:Gq||!Fq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Gq?Bq(this,e,t)||0:Vq(this,e,t)}});var Hq=er("Array","indexOf"),Wq=u,zq=Hq,Kq=Array.prototype,qq=function(e){var t=e.indexOf;return e===Kq||Wq(Kq,e)&&t===Kq.indexOf?zq:t},Yq=r(qq);function Xq(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==Yq(t).call(t,r))continue;n[r]=e[r]}return n}(e,t);if(Mq){var s=Mq(e);for(r=0;r<s.length;r++)n=s[r],-1===Yq(t).call(t,n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let Jq=class{get localCapabilities(){return pR(this._localCapabilities)}get rtpCapabilities(){return pR(this._rtpCapabilities)}get candidates(){return pR(this._candidates)}get iceParameters(){return pR(this._iceParameters)}get dtlsParameters(){return pR(this._dtlsParameters)}constructor(e){uT(this,"sessionDesc",void 0),uT(this,"_localCapabilities",void 0),uT(this,"_rtpCapabilities",void 0),uT(this,"_candidates",void 0),uT(this,"_iceParameters",void 0),uT(this,"_dtlsParameters",void 0),uT(this,"setup",void 0),uT(this,"currentMidIndex",void 0),uT(this,"cname","o/i14u9pJrxRKAsu"),uT(this,"firefoxSsrcMidMap",new Map),e=pR(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:a,setup:o,videoCodec:c,audioCodec:l}=e;let d;this.setup=o,d=a===Fj.RECEIVE_ONLY?VI("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):VI("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const u=a===Fj.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===Fj.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===Fj.RECEIVE_ONLY?i.send.videoCodecs:UU(fM.VIDEO,u,h,c),m=a===Fj.RECEIVE_ONLY?i.send.audioCodecs:UU(fM.AUDIO,u,h,l);for(const f of d.mediaDescriptions)f.attributes.iceUfrag=t.iceUfrag,f.attributes.icePwd=t.icePwd,f.attributes.fingerprints=n.fingerprints,f.attributes.candidates=r,f.attributes.setup=this.setup,"application"===f.media.mediaType&&(f.attributes.sctpPort="5000"),"video"===f.media.mediaType&&(f.media.fmts=p.map(e=>e.payloadType.toString(10)),f.attributes.payloads=p,f.attributes.extmaps=u.videoExtensions),"audio"===f.media.mediaType&&(f.media.fmts=m.map(e=>e.payloadType.toString(10)),f.attributes.payloads=m,f.attributes.extmaps=u.audioExtensions,MU(f));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return FI(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:a}=NU(t,this.cname,AI("SYNC_GROUP")?n:void 0),o=this.findPreloadMediaDesc(s);if(o){if(nA()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,o.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(o,i),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,s,r);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,s,a,"sendonly",r,i),this.updateBundleMids()):(n=pR(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=s,n.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),nA()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{e.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(e=>{const i=e._mediaStreamTrack.kind,s=this.findAvailableRecvMediaIndex(i);let a,o=!1;-1===s?(o=!0,a=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(a=pR(this.sessionDesc.mediaDescriptions[s]),a.attributes.direction="recvonly"),r.push({mid:a.attributes.mid,needCreateTransceiver:o})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:a,relatedPort:o,priority:c}=new RTCIceCandidate(e),l={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=r?r:"",port:i?i+"":"",type:s?s+"":"",relAddr:null!=a?a:"",relPort:o?o+"":"",extension:{}};this.candidates.some(e=>e.priority===l.priority&&e.connectionAddress===l.connectionAddress&&e.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,o=UU(s,a,this.localCapabilities.send,s===fM.AUDIO?i:r),c=s===fM.VIDEO?a.videoExtensions:a.audioExtensions,l="".concat(++this.currentMidIndex);let d={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);const u=this.findFirstClosedMedia(s);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dr(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dr(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(nA()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=pR(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,s){const a=this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;nA()&&(i="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};l=this.mungSendMediaDesc(l,s);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,n){const r=pR(e);return AU(r),CU(r,t),RU(r,t),IU(r),OU(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=pR(e);return OU(n,t,this.localCapabilities.recv),MU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>nA()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}};const Qq=["sdp"];var Zq;function $q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$q(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let tY=(Zq=class e extends pM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),uT(this,"direction",void 0),uT(this,"name",void 0),uT(this,"store",void 0),uT(this,"spec",void 0),uT(this,"peerConnection",void 0),uT(this,"initialOffer",void 0),uT(this,"transport",void 0),uT(this,"statsFilter",void 0),uT(this,"localCandidateCount",0),uT(this,"_isInRestartIce",!1),uT(this,"mutex",void 0),uT(this,"onLocalCandidate",void 0),uT(this,"remoteSDP",void 0),uT(this,"pendingCandidates",[]),uT(this,"localCapabilities",void 0),uT(this,"isReady",!1),uT(this,"restartCnt",0),uT(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new UR("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=r?r:Fj.SEND_ONLY,this.name=this.direction===Fj.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=fI(this.peerConnection,AI("STATS_UPDATE_INTERVAL"),void 0,nA()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await kU();if(this.localCapabilities=jU(t),e){const{sdp:t}=e,n=Xq(e,Qq),r=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(LU(t,e,"videoExtensions",n,r,i),LU(t,e,"videoCodecs",n,r,i),LU(t,e,"audioExtensions",n,r,i),LU(t,e,"audioCodecs",n,r,i),AI("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&AI("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new Jq({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const s=xU(i.sdp);await this.peerConnection.setLocalDescription(i);const a=await DU({},{},i.sdp);this.localCapabilities=jU(a);const o=this.peerConnection.getTransceivers()[0];return null!=o&&o.receiver&&o.receiver.transport&&this.tryBindTransportEvents(o.receiver.transport),eY(eY({},s),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=xU(e.sdp);return this.initialOffer=e,eY(eY({},t),{},{sdp:e.sdp})}}catch(e){throw new RA(AA.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await DU({},{},t);this.remoteSDP=new Jq({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const s=this.peerConnection.getTransceivers()[0];null!=s&&s.sender&&s.sender.transport&&this.tryBindTransportEvents(s.sender.transport)}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(e=>{this.peerConnection.addIceCandidate(e)}),this.pendingCandidates=[])}catch(e){throw new RA(AA.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return YN(function*(){const i=yield JN(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],s=r.remoteSDP.receive(e,t,n);e.forEach((e,t)=>{if(s[t].needCreateTransceiver){const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{const n=r.peerConnection.getTransceivers().find(e=>e.mid===s[t].mid);if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(s[t].mid));i.push(n),e._updateRtpTransceiver(n)}}),nA()&&!0===AI("SIMULCAST")&&(yield JN(r.applySimulcastForFirefox(i,e)));const a=s.map(e=>e.mid),o=yield JN(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(o.sdp,e,a),l=VI(c),d=a.map(e=>{const t=l.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(t,AI("USE_PUB_RTX"))}),u=i.map((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}});yield JN(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield u}catch(e){const n=r.remoteSDP.toString();throw yield JN(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JN(r.peerConnection.setRemoteDescription({type:"answer",sdp:n})),yield JN(r.stopSending(a,!0)),e}yield JN(r.applySimulcastEncodings(i,e)),yield JN(r.applySendEncodings(i,e));const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield JN(r.setRemoteDescription({type:"answer",sdp:h})),i.map((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}})}catch(e){throw e instanceof RA?e:new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map(e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:s}=this.remoteSDP.send(e,t,n,r);if(s){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),s=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(s||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:s}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(e=>e.mid===i);if(!a||null===a.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:s}=this.remoteSDP.send(e,t,n,r);if(s){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),s=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(s||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:s}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===EI.Auto&&(this.store.p2pTransport=EI.SdRtn,vO().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,vO().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=xU(e.sdp);return this.store.descriptionStart(),this.direction===Fj.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Fj.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=xU(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==s||s(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?nA()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:eY(eY({},$R),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:eY(eY({},$R),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Dr(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZA(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),AI("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Dr(s=[EI.Relay,EI.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),AI("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(i.iceTransportPolicy="relay")}))),AI("ENABLE_ENCODED_TRANSFORM")&&vO().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),aO.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=[],i=e.filter(e=>e.tcpport);aO.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));const s=i.length>n?i[n]:i[0];switch(t){case EI.SdRtn:const t=e.filter(e=>{var t;return Dr(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL}),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(nU(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(nU(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case EI.Relay:s&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(nU(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;default:s&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(nU(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair()||{};if(e&&n){const t=e.address+":"+e.port,r=n.address+":"+n.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(t)),", remote ").concat(JSON.stringify(hU(r))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vO().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var s;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Dr(s=e._hints).call(s,UO.LOW_STREAM)&&(n&&(i.maxFramerate=sU(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(AI("DSCP_TYPE")&&xA()){var a;const e=AI("DSCP_TYPE");Dr(a=["very-low","low","medium","high"]).call(a,e)&&(i.networkPriority=e)}const o=t.getParameters(),c=null===(n=o.encodings)||void 0===n?void 0:n[0];nA()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(o,r),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await t.setParameters(o)}async applySendEncodings(e,t){try{if(!vO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof DD&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=VI(e);return t.forEach((e,t)=>{const i=n[t],s=r.mediaDescriptions.find(e=>e.attributes.mid===i);s&&(CU(s,e),PU(s,e,this.store.codec))}),FI(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var n,r,i,s,a;const c=e[o],l=t[o];if(l instanceof DD&&!Dr(n=l._hints).call(n,UO.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(s=l._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nA()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof DD&&this.isVP8Simulcast(r)){const t=e[n],i={},s={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,s;return!!(e instanceof DD&&AI("SIMULCAST")&&"vp8"===this.store.codec&&!Dr(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(s=e._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(AI("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async e=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n;if(t=null!=t?t:null===(n=this.currentRemoteDescription)||void 0===n?void 0:n.sdp){var r;const n=null===(r=VI(t).mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===r?void 0:r.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Dr(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const r=VI(e),i=r.mediaDescriptions.find(e=>e.attributes.mid===t);return i&&n===fM.AUDIO&&"audio"===i.media.mediaType&&MU(i),FI(r)}},Rj(Zq.prototype,"establish",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"establish"),Zq.prototype),Rj(Zq.prototype,"connect",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"connect"),Zq.prototype),Rj(Zq.prototype,"receive",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"receive"),Zq.prototype),Rj(Zq.prototype,"mockReceive",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"mockReceive"),Zq.prototype),Rj(Zq.prototype,"stopReceiving",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"stopReceiving"),Zq.prototype),Rj(Zq.prototype,"restartICE",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"restartICE"),Zq.prototype),Rj(Zq.prototype,"close",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"close"),Zq.prototype),Rj(Zq.prototype,"updateEncoderConfig",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateEncoderConfig"),Zq.prototype),Rj(Zq.prototype,"updateSendParameters",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateSendParameters"),Zq.prototype),Rj(Zq.prototype,"replaceTrack",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"replaceTrack"),Zq.prototype),Rj(Zq.prototype,"muteLocal",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"muteLocal"),Zq.prototype),Rj(Zq.prototype,"unmuteLocal",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"unmuteLocal"),Zq.prototype),Zq);function nY(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return await r.apply(this,s)}finally{n()}},n}let rY=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var iY,sY,aY,oY,cY,lY,dY,uY,hY,pY,mY,fY;function gY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function vY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gY(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let yY=(iY=_Y(rY.SEND_ONLY),sY=_Y(rY.SEND_ONLY),aY=_Y(),oY=_Y(rY.RECEIVE_ONLY),cY=_Y(rY.RECEIVE_ONLY),lY=_Y(rY.RECEIVE_ONLY),dY=_Y(rY.RECEIVE_ONLY),uY=_Y(rY.RECEIVE_ONLY),hY=_Y(rY.RECEIVE_ONLY),pY=_Y(),mY=_Y(rY.RECEIVE_ONLY),fY=class extends WA{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(bM.StateChange,t,this._state)}constructor(e,t){super(),uT(this,"isPlanB",!1),uT(this,"store",void 0),uT(this,"statsUploader",void 0),uT(this,"sendConnection",void 0),uT(this,"recvConnection",void 0),uT(this,"localTrackMap",new Map),uT(this,"remoteUserMap",new Map),uT(this,"localDataChannels",[]),uT(this,"pendingLocalTracks",[]),uT(this,"pendingRemoteTracks",[]),uT(this,"statsCollector",void 0),uT(this,"dtlsFailedCount",0),uT(this,"sendMutex",void 0),uT(this,"recvMutex",void 0),uT(this,"_state",EM.Disconnected),uT(this,"_restartStates",["disconnected","failed"]),uT(this,"reconnectInterval",void 0),uT(this,"uploadUnplinkStarted",!1),uT(this,"uploadDownlinkStarted",!1),uT(this,"uplinkStateUploadInterval",void 0),uT(this,"downlinkStatsUploadInterval",void 0),uT(this,"handleMuteLocalTrack",async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==EM.Connected)return void n(new RA(AA.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const a=r.find(e=>"videoLowTrack"===e[0]);a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map(e=>{let[,{id:t}]=e;return t}));let o=!1;var i,s;o="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(_M.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(s=this.localTrackMap.get(_M.LocalVideoTrack))||void 0===s?void 0:s.id);const c=this.createMuteMessage(r);await aR(this,bM.RequestMuteLocal,c);const l="video"===e.trackMediaType?PM.MUTE_LOCAL_VIDEO:PM.MUTE_LOCAL_AUDIO;await aR(this,bM.RequestP2PMuteLocal,{action:l,message:c,isMuteAll:o}),t()}catch(e){n(e)}finally{r()}}),uT(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==EM.Connected)return void n(new RA(AA.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map(e=>{let[,{id:t}]=e;return t}));const i=this.createUnmuteMessage(r),s="video"===e.trackMediaType?PM.UNMUTE_LOCAL_VIDEO:PM.UNMUTE_LOCAL_AUDIO;await aR(this,bM.RequestP2PMuteLocal,{action:s,message:i}),t()}catch(e){n(e)}finally{r()}}),uT(this,"handleUpdateVideoEncoder",async(e,t,n,r)=>{let i;"boolean"==typeof r&&r||(i=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(bM.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}}),uT(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}}),uT(this,"handleReplaceTrack",async(e,t,n,r)=>{let i;aO.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var s;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.sendConnection||!n||void 0===n[1].id||this.state!==EM.Connected)return void t();if(await(null===(s=this.sendConnection)||void 0===s?void 0:s.replaceTrack(e,n[1].id)),n[0]===_M.LocalVideoTrack&&vO().supportDualStreamEncoding){const t=this.localTrackMap.get(_M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}}),uT(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uT(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uT(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uT(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(e),this.bindStatsUploaderEvents(),this.sendMutex=new UR("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new UR("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))})},AI("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new tY(e,this.store,Fj.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=EM.New,this.sendConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new tY(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new RA(AA.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EM.Connected}async addRemoteCandidate(e,t){if(t===Fj.RECEIVE_ONLY){if(!this.sendConnection)throw new RA(AA.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new RA(AA.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return YN(function*(){const i=yield JN(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==EM.Connected){r.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===r.pendingLocalTracks.indexOf(e));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,KV.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield JN(r.tryToUnmuteAudio(e)));i.forEach(e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===_M.LocalAudioTrack?"audio":"video",i)}),r.bindLocalTrackEvents(i);const s=yield JN(r.sendConnection.send(i.map(e=>{let{track:t}=e;return t}),r.store.codec,r.store.audioCodec)),a=(yield JN(s.next())).value,o=r.createGatewayPublishMessage(i,a);try{yield o}catch(e){throw s.throw(e),(null==e?void 0:e.code)===AA.WS_ABORT&&i.forEach(e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)}),r.unbindLocalTrackEvents(i),e}yield JN(s.next()),i.forEach(e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,a),i.forEach(e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===_M.LocalAudioTrack?"audio":"video",void 0,i)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==EM.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(t=>!Dr(e).call(e,t)));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===EM.Connected)return n&&n[1].track.close(),r;e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:i,ssrcs:s}]=n;const a={stream_type:gF(i,r),ssrcs:s};i._muted||!i._enabled?e.push(a):t.push(a)}),e.length>0&&e.forEach(e=>{aR(this,bM.RequestMuteLocal,[e])}),t.length>0&&t.forEach(e=>{aR(this,bM.RequestUnmuteLocal,[e])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return YN(function*(){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await sR(this,bM.RequestRePublish,this.pendingLocalTracks),this.emit(bM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new RA(AA.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:s,mid:a,transceiver:o}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new QD(s,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),o&&e._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new JD(s,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),o&&e._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex(n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i});-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(bM.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new RA(AA.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid});if(r.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.recvConnection||n||r.forEach(t=>{let{kind:n}=t;var r;if(n===fM.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===fM.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map(e=>{let[,{id:t}]=e;return t})),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(e=>{let[t,{kind:r}]=e;var i,s;if(r===fM.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(s=t._videoTrack)||void 0===s||s._destroy(),t._videoTrack=void 0);else if(r===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),i.forEach(e=>{let[,{kind:t}]=e;aR(this,bM.RequestP2PMuteRemote,t)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[fM.VIDEO,fM.AUDIO].forEach(e=>{t.has(e)?aR(this,bM.RequestP2PUnmuteRemote,e):aR(this,bM.RequestP2PMuteRemote,e)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new RA(AA.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(_M.LocalAudioTrack);if((null==t?void 0:t.track)instanceof Hk){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==_M.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(_M.LocalAudioTrack),s=r?this.localTrackMap.get(_M.LocalVideoLowTrack):this.localTrackMap.get(_M.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:KV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==s?void 0:s.track.getTrackLabel(),screenshare:-1!==(null==s?void 0:s.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!n,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const a=n.find(e=>e instanceof Fk),o=r?null===(s=this.localTrackMap.get(_M.LocalVideoTrack))||void 0===s?void 0:s.track:n.find(e=>e instanceof DD);mO.publish(this.store.sessionId,{eventElapse:KV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===fM.VIDEO?n._videoSSRC:n._audioSSRC;i&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===fM.VIDEO,audio:r===fM.AUDIO,peerid:n.uid,subscribeRequestid:r===fM.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:KV.measureFromSubscribeStart(this.store.clientId,i)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new UR("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new UR("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(_M.LocalAudioTrack);if((null==e?void 0:e.track)instanceof Hk){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=EM.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof DD||t&&t.track instanceof Fk?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(_M.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=EM.Reconnecting,AI("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case _M.LocalVideoTrack:Dr(t=r._hints).call(t,UO.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case _M.LocalAudioTrack:r instanceof Hk?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case _M.LocalVideoLowTrack:}}),this.emit(bM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XI(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(bM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof ZV?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Fj.SEND_ONLY){if(!this.sendConnection)throw new RA(AA.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new RA(AA.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const e=await r.restartICE(t);return r.isInRestartIce=!1,e}{const e=await r.restartICE();if(e){const t=await sR(this,bM.RequestP2PRestartICE,{direction:Fj.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalAudioTrack),r=e.videoSend.find(e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)}),i=e.audioSend.find(e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)});if(!r||!i)return 1;const s=oR(this,bM.NeedSignalRTT),a=r?r.rttMs:void 0,o=i?i.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&s?(c+s)/2:c||s)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return GL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===i),o=e.videoRecv.find(e=>e.ssrc===s);if(!a&&!o)return void(t+=1);const c=oR(this,bM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=vO(),s=this.getAllTracks();e=uR(e=e.filter(e=>-1===s.indexOf(e)));let a=!1,o=!1;for(const c of e){if(c instanceof DD&&(this.localTrackMap.has(_M.LocalVideoTrack)||a?new RA(AA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:_M.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:_M.LocalVideoLowTrack})}if(c instanceof Fk){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(e){if(!(e.track instanceof Hk))throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(o){const e=r.find(e=>{let{type:t}=e;return t===_M.LocalAudioTrack});if(!(e.track instanceof Hk))throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof Hk||c._bypassWebAudio)r.push({track:c,type:_M.LocalAudioTrack});else{const e=new Hk;e.addAudioTrack(c),r.push({track:e,type:_M.LocalAudioTrack})}o=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=uR(e=e.filter(e=>-1!==n.indexOf(e)));for(const r of e){if(r instanceof Fk){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(!e)continue;e.track instanceof Hk?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([_M.LocalAudioTrack,e]),e.track.close())):t.push([_M.LocalAudioTrack,e])}if(r instanceof DD){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(!e)continue;t.push([_M.LocalVideoTrack,e]);const n=this.localTrackMap.get(_M.LocalVideoLowTrack);n&&t.push([_M.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Hk?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Hk?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var r;let i,{track:s,type:a}=e;switch(a){case _M.LocalAudioTrack:i=rM.Audio;break;case _M.LocalVideoTrack:i=Dr(r=s._hints).call(r,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalVideoLowTrack:i=rM.Low}return{kind:a===_M.LocalAudioTrack?fM.AUDIO:fM.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:s.muted||!s.enabled}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:s,id:a}]=e;switch(r){case _M.LocalVideoTrack:n=Dr(t=i._hints).call(t,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalAudioTrack:n=rM.Audio;break;case _M.LocalVideoLowTrack:n=rM.Low}return{stream_type:n,ssrcs:s,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(bM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Dr(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await SR(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YA.TRACER}).onSuccess(),this.emit(bM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(WO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XI(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(bM.ConnectionTypeChange,n),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(bM.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Fj.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,aO.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Fj.SEND_ONLY?this.restartICE(e):sR(this,bM.RequestP2PRestartICE,{direction:Fj.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Hk)return n.track.isActive||t.push([_M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r&&(t.push(r),r[0]===_M.LocalVideoTrack)){const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Hk)return n.track.isActive&&t.push([_M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r)if(r[0]===_M.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:s,id:a}]=e;switch(r){case _M.LocalAudioTrack:n=rM.Audio;break;case _M.LocalVideoTrack:n=Dr(t=i._hints).call(t,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalVideoLowTrack:n=rM.Low}return{stream_type:n,ssrcs:s,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:s,id:a}]=e;switch(r){case _M.LocalAudioTrack:n=rM.Audio;break;case _M.LocalVideoTrack:n=Dr(t=i._hints).call(t,UO.SCREEN_TRACK)?rM.Screen:rM.High;break;case _M.LocalVideoLowTrack:n=rM.Low}return{stream_type:n,ssrcs:s,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:r,id:i}]=e;switch(r){case fM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:n._videoSSRC}));case fM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Fk){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const r=this.createUnmuteMessage(n);return void await aR(this,bM.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(bM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(bM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await SR(BR(this.dtlsFailedCount,FR)),this.emit(bM.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(_M.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof DD)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof DD).length>1)throw new RA(AA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Fk).length>1&&(e.some(e=>e instanceof Fk&&e._bypassWebAudio)||!vO().webAudioMediaStreamDest))throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof DD&&this.pendingLocalTracks.some(e=>e instanceof DD))throw new RA(AA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fk&&this.pendingLocalTracks.some(e=>e instanceof Fk)&&(!vO().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Fk&&e._bypassWebAudio)))throw new RA(AA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!AI("DISABLE_DUAL_STREAM_USE_ENCODING")&&vO().supportDualStreamEncoding,r=vY(vY({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():AF(e,r);const s=TR(8,"track-low-"),a=new DD(i,vY(vY({},n&&{scaleResolutionDownBy:dU(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return a.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),a._hints.push(UO.LOW_STREAM),e.addListener(MO.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(XI(i=this.remoteUserMap).call(i)).find(t=>t._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find(e=>e.userId===s.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:KV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return void 0!==s&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new RA(AA.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new RA(AA.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new RA(AA.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new RA(AA.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new RA(AA.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new RA(AA.NOT_SUPPORTED)}async preConnect(e){throw new RA(AA.NOT_SUPPORTED)}getEstablishParams(){throw new RA(AA.NOT_SUPPORTED)}async reSubscribe(e){throw new RA(AA.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new RA(AA.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===_M.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VO.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Rj(fY.prototype,"p2pConnect",[iY],Object.getOwnPropertyDescriptor(fY.prototype,"p2pConnect"),fY.prototype),Rj(fY.prototype,"unpublish",[sY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublish"),fY.prototype),Rj(fY.prototype,"unpublishLowStream",[aY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublishLowStream"),fY.prototype),Rj(fY.prototype,"subscribe",[oY],Object.getOwnPropertyDescriptor(fY.prototype,"subscribe"),fY.prototype),Rj(fY.prototype,"mockSubscribe",[cY],Object.getOwnPropertyDescriptor(fY.prototype,"mockSubscribe"),fY.prototype),Rj(fY.prototype,"unsubscribe",[lY],Object.getOwnPropertyDescriptor(fY.prototype,"unsubscribe"),fY.prototype),Rj(fY.prototype,"muteRemote",[dY],Object.getOwnPropertyDescriptor(fY.prototype,"muteRemote"),fY.prototype),Rj(fY.prototype,"unmuteRemote",[uY],Object.getOwnPropertyDescriptor(fY.prototype,"unmuteRemote"),fY.prototype),Rj(fY.prototype,"hasRemoteMediaWithLock",[hY],Object.getOwnPropertyDescriptor(fY.prototype,"hasRemoteMediaWithLock"),fY.prototype),Rj(fY.prototype,"disconnectForReconnect",[pY],Object.getOwnPropertyDescriptor(fY.prototype,"disconnectForReconnect"),fY.prototype),Rj(fY.prototype,"remoteMediaSsrcChanged",[mY],Object.getOwnPropertyDescriptor(fY.prototype,"remoteMediaSsrcChanged"),fY.prototype),fY);function _Y(e){return function(t,n,r){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];switch(e){case rY.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case rY.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}class EY extends WA{constructor(e,t){super(),uT(this,"signal",void 0),uT(this,"token",void 0),uT(this,"tokenTimeout",void 0),uT(this,"tokenInterval",void 0),uT(this,"_sequence",0),uT(this,"userMap",new Map),uT(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===Lj.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*AI("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var s;if(0===this.userMap.size)return;const a=Array.from(up(s=this.userMap).call(s))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!=r?r:TR(6,""),i=null!=i?i:this._sequence++;const o={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(a)};AI("SHOW_P2P_LOG")&&aO.debug("send message",o,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(o)).forEach(e=>{this.signal.request(Mj.DATA_STREAM,{payload:yR(this.encoder.encode(e))})});const c=new np((t,i)=>{const s=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),l),this.off(OM.ABORT,c),aO.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),0===this.userMap.size?i(new RA(AA.INVALID_REMOTE_USER)):i(new RA(AA.TIMEOUT))},AI("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{s&&window.clearTimeout(s),this.off(OM.ABORT,c),n&&t()},c=()=>{s&&window.clearTimeout(s),this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),l),i(new RA(AA.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(OM.ABORT,c),this.once("res-@".concat(r,"_ack"),a);const l=(n,o)=>{d=!0,s&&window.clearTimeout(s),this.off("res-@".concat(r,"_ack"),a),this.off(OM.ABORT,c),"success"===n?t(o):i(new RA(AA.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let d=!1;n||(this.once("res-@".concat(r),l),SR(AI("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d||aO.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(o))}))});try{return await c}catch(s){if(s.code===AA.TIMEOUT)return await this.send(e,t,n,r,i);throw s}}onMessage(e){var t;const{_uid:n}=e;let r,i=this.userMap.get(n);if(i)r=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==IM.CHECK)return;const{token:t}=e;r=new Map,i={uid:n,isStart:!0,token:t,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,i),this.signal.emit(Vj.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var s;const{id:t,total:i}=e,a=null!==(s=r.get(t))&&void 0!==s?s:[];if(a.push(e),r.has(t)||r.set(t,a),a.length!==i)return;{const i=Xp(a).call(a,(e,t)=>e.index-t.index).map(e=>e.payload).join("");r.delete(t),(e=JSON.parse(i))._uid=n}}const{_type:a,token:o}=e;if(Dr(t=[IM.ACK,IM.CHECK]).call(t,a))return a===IM.CHECK&&this.handleCheckToken(i,o),void this.receiveMessage(e);o==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):aO.debug('Receive unexpected message", '.concat(o,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){const e={_id:TR(6,""),token:this.token,_type:IM.CHECK};AI("SHOW_P2P_LOG")&&aO.debug("send message",e),this.signal.request(Mj.DATA_STREAM,{payload:yR(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:IM.ACK,token:this.token};AI("SHOW_P2P_LOG")&&aO.debug("send message",t),this.signal.request(Mj.DATA_STREAM,{payload:yR(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(IM.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach(e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}})};if(!e)return void t();const{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:s,isStart:a,nextExpectedSequenceNumber:o}=i;if(r<o)return this.ack(e._id),void aO.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));s.set(r,e),a&&r===o&&(this.receiveMessage(e),s.delete(o),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:r,_uid:i}=e;if(AI("SHOW_P2P_LOG")&&aO.debug("receive message",e),t){let s;switch(e._type!==IM.ACK&&(r&&(s=JSON.parse(r)),this.ack(e._id)),e._type){case IM.CANDIDATE:case IM.CONTROL:this.signal.emit(n,s,i);break;case IM.PUBLISH:case IM.UNPUBLISH:case IM.RESTART_ICE:case IM.CALL:s.uid=i,sR(this.signal,n,s).then(t=>{this.response(e._id,t)}).catch(()=>{this.response(e._id,void 0,!0)});break;case IM.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case IM.RESPONSE:{const{success:e,message:n}=s;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<EY.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),r=TR(6,"");let i=0,s=800;const a=Math.ceil(e.length/s);for(;e.length>0;){i++;const o={id:r,index:i,total:a,payload:e.slice(0,s),token:"".concat(this.token,"_").concat(n)};JSON.stringify(o).length>EY.MAX_MESSAGE_SIZE?s-=50:(t.push(o),e=e.slice(s))}return t.map(e=>JSON.stringify(e))}handleCheckToken(e,t){return e.token!==t?(aO.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{aO.debug("token timeout, ".concat(t)),this.reset(e.uid)},AI("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await sR(this.signal,IM.CALL,void 0),t=await this.send(IM.CALL,e);this.signal.emit(jj.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(OM.ABORT),this.signal.emit(Vj.ON_USER_OFFLINE,{uid:n.uid,reason:kM.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(aO.debug("change local token from ".concat(t," to ").concat(t)),this.token=TR(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(OM.ABORT)}}uT(EY,"MAX_SIZE",1),uT(EY,"MAX_MESSAGE_SIZE",1024);class bY extends WA{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Lj.CONNECTED?this.emit(jj.WS_CONNECTED):e===Lj.RECONNECTING?this.emit(jj.WS_RECONNECTING,this._websocketReconnectReason):e===Lj.CLOSED&&this.emit(jj.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uT(this,"_disconnectedReason",void 0),uT(this,"_websocketReconnectReason",void 0),uT(this,"_connectionState",Lj.CLOSED),uT(this,"reconnectToken",void 0),uT(this,"p2pToken",void 0),uT(this,"websocket",void 0),uT(this,"openConnectionTime",void 0),uT(this,"clientId",void 0),uT(this,"lastMsgTime",Date.now()),uT(this,"uploadCache",[]),uT(this,"uploadCacheInterval",void 0),uT(this,"rttRolling",new WR(5)),uT(this,"pingpongTimer",void 0),uT(this,"pingpongTimeoutCount",0),uT(this,"joinResponse",void 0),uT(this,"multiIpOption",void 0),uT(this,"initError",void 0),uT(this,"spec",void 0),uT(this,"store",void 0),uT(this,"_external_signal",void 0),uT(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(jj.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case Vj.ON_DATA_STREAM:return void this.handleDataStream(t._message);case Vj.MUTE_AUDIO:case Vj.MUTE_VIDEO:case Vj.ON_P2P_LOST:case Vj.ON_USER_ONLINE:return;case Vj.ON_USER_OFFLINE:const{uid:e}=t._message;return aO.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===Vj.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===Vj.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QA.UID_BANNED);break;case 15:this.close(QA.IP_BANNED);break;case 16:this.close(QA.CHANNEL_BANNED)}if(t._type===Vj.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Dj.ERR_LICENSE_MISSING:this.close(QA.LICENSE_MISSING);break;case Dj.ERR_LICENSE_EXPIRED:this.close(QA.LICENSE_EXPIRED);break;case Dj.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QA.LICENSE_MINUTES_EXCEEDED);break;case Dj.ERR_LICENSE_PERIOD_INVALID:this.close(QA.LICENSE_PERIOD_INVALID);break;case Dj.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QA.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dj.ERR_LICENSE_ILLEGAL:this.close(QA.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,AI("JOIN_GATEWAY_USE_DUAL_DOMAIN"),AI("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lj.CONNECTED&&this.reconnect("retry",nR.OFFLINE)}),this.p2pToken=TR(6,""),this._external_signal=new EY(this,this.p2pToken)}async request(e,t,n,r){const i=TR(6,""),s={_id:i,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new np((e,t)=>{if(this.connectionState===Lj.CONNECTED)return e();const n=()=>{this.off(jj.WS_CLOSED,r),e()},r=()=>{this.off(jj.WS_CONNECTED,n),t(new RA(AA.WS_ABORT))};this.once(jj.WS_CONNECTED,n),this.once(jj.WS_CLOSED,r)});if(this.connectionState!==Lj.CONNECTING&&this.connectionState!==Lj.RECONNECTING||e===Mj.JOIN||e===Mj.REJOIN||await o(),this.websocket.sendMessage(s,!0),r)return;const c=new np((n,r)=>{let s=!1;const o=(r,i)=>{s=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.emit(jj.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),o);const c=()=>{r(new RA(AA.WS_ABORT,"type: ".concat(e))),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.off("res-@".concat(i),o)};this.once(jj.WS_CLOSED,c),this.once(jj.WS_RECONNECTING,c),SR(AI("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||s||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(jj.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(r){if(this.connectionState===Lj.CLOSED||e===Mj.LEAVE)throw new RA(AA.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===Mj.JOIN||e===Mj.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new RA(AA.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===Dj.ERR_TOO_MANY_BROADCASTERS?e===Mj.JOIN||e===Mj.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===Dj.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nR.MULTI_IP)):this.reconnect(u.action,nR.SERVER_ERROR),e===Mj.JOIN||e===Mj.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np(n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Uj.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=AI("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lj.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},AI("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np((t,n)=>{this.once(jj.WS_CONNECTED,()=>t(this.joinResponse)),this.once(jj.WS_CLOSED,()=>n(this.initError||new RA(AA.WS_ABORT))),this.connectionState=Lj.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||QA.LEAVE,this.connectionState=Lj.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=TR(6,""),this._external_signal.clear(),this._external_signal=new EY(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(jj.ABORT_P2P_EXECUTION);const e=await sR(this,jj.REQUEST_JOIN_INFO),t=await this.request(Mj.JOIN,e);if(!t)return this.emit(jj.REPORT_JOIN_GATEWAY,AA.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(jj.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lj.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){return!1}handleDataStream(e){try{var t;const n=vR(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Dr(t=Object.values(IM)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(Vj.ON_DATA_STREAM,e)}catch(t){this.emit(Vj.ON_DATA_STREAM,e)}}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QA.UID_BANNED),void this.close()):void this.reconnect(t.action,nR.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=AI("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>AI("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nR.TIMEOUT):this.request(Mj.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),AI("REPORT_STATS")&&this.send(Mj.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWebsocketEvents(){this.websocket.on(Bj.RECONNECT_CREATE_CONNECTION,e=>{this.emit(jj.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Bj.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bj.CLOSED,()=>{this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.FAILED,()=>{this._disconnectedReason=QA.NETWORK_ERROR,this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Lj.CONNECTED?this.connectionState=Lj.RECONNECTING:this.connectionState=Lj.CONNECTING}),this.websocket.on(Bj.WILL_RECONNECT,(e,t,n)=>{"retry"!==e?(aO.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):aO.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)}),this.websocket.on(Bj.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(jj.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof RA&&e.code===AA.UNEXPECTED_RESPONSE&&e.data.code===Dj.ERR_NO_AUTHORIZED)return aO.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",nR.SERVER_ERROR);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nR.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Bj.REQUEST_NEW_URLS,(e,t)=>{sR(this,jj.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Bj.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Vj.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const xY={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new yY(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new bY(n,t)}};function wY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function SY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wY(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class TY{constructor(e){uT(this,"sessionDesc",void 0),uT(this,"localCapabilities",void 0),uT(this,"rtpCapabilities",void 0),uT(this,"candidates",void 0),uT(this,"_originCandidates",void 0),uT(this,"iceParameters",void 0),uT(this,"dtlsParameters",void 0),uT(this,"setup",void 0),uT(this,"currentMidIndex",void 0),uT(this,"cname",void 0),e=pR(e);const{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:s,localCapabilities:a,sdkCodec:o,cname:c}=e,l=VI("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this._originCandidates=pR(r),this.iceParameters=t,this.dtlsParameters=n,this.setup=s,this.localCapabilities=a,this.cname=c;for(let d=0;d<l.mediaDescriptions.length;d++){const e=l.mediaDescriptions[d];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=s,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map(e=>e.payloadType.toString(10));const t=i.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dr(n=t.encodingName.toLowerCase()).call(n,o)}),n=i.videoCodecs.filter(e=>!Dr(t).call(t,e));e.attributes.payloads=[...t,...n],e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),l.mediaDescriptions[d]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return FI(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=NU(t,this.cname),s=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType),a=r[0].attributes.label,o=r[0].attributes.mslabel;return s.attributes.ssrcs=s.attributes.ssrcs.concat(r),s.attributes.ssrcGroups=s.attributes.ssrcGroups.concat(i),{id:a,mslabel:o}}batchSend(e){return e.map(e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach(t=>{Dr(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)}),t.attributes.ssrcGroups.forEach(e=>{var t;Dr(t=i.map(e=>e.ssrcId)).call(t,e.ssrcIds[0])||r.push(e)}),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r})}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex(e=>e.attributes.mid===n.kind),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i})}stopReceiving(e){}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),n=[];if(t.forEach(e=>{n.push(SY(SY({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this.candidates=n;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this.candidates=[...t,...n];break;default:this.candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pR(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=pR(e);return CU(n,t),RU(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid);if(r){const e=r.attributes.ssrcs.find(e=>e.attributes.label===t);var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=pR(e);return AU(t),function(e){const t=e.attributes.extmaps.find(e=>yU(e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var NY;function CY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function AY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CY(Object(n),!0).forEach(function(t){uT(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let RY=(NY=class e extends mM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dr(t=Object.keys(PI)).call(t,e)}))]}constructor(t,n){super(t,n),uT(this,"store",void 0),uT(this,"peerConnection",void 0),uT(this,"remoteSDP",void 0),uT(this,"initialOffer",void 0),uT(this,"statsFilter",void 0),uT(this,"useRTX",!1),uT(this,"localCapabilities",void 0),uT(this,"localCandidateCount",0),uT(this,"allCandidatesReceived",!1),uT(this,"establishPromise",void 0),uT(this,"mutex",void 0),this.store=n,this.mutex=new UR("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=fI(this.peerConnection,AI("STATS_UPDATE_INTERVAL"),void 0,nA()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=xU(e.sdp),n=bU(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:AI("FILTER_VIDEO_FEC"),filterAudioFec:AI("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,AY(AY({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new RA(AA.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new TY(AY(AY({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new RA(AA.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return YN(function*(){const r=yield JN(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map(e=>n.peerConnection.addTrack(e._mediaStreamTrack)),i=yield JN(n.peerConnection.createOffer()),s=VI(i.sdp),a=e.map(e=>{const t=e._mediaStreamTrack,r=s.mediaDescriptions.find(e=>e.attributes.mid===t.kind);if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter(e=>e.attributes.label===t),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find(e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)});let o;try{o=yield a}catch(e){throw r.forEach(e=>{$C()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)}),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,o);const l=n.remoteSDP.toString();return yield JN(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JN(n.applySendEncodings(r,e)),yield JN(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:a[t],id:n}})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{$C()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),s=new np((t,r)=>{const s=setTimeout(()=>{r(new Error("Cannot receive track, id: ".concat(n)))},1e4),a=r=>{const o=qC();if(("Safari"===o.name&&11===Number(o.version)||rA())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(s),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(s),void t(r.track)};this.peerConnection.addEventListener("track",a)}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),{track:await s,id:n}}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(e=>{if($C()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!1),e.setParameters(t)}})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async e=>{if($C()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!0),await e.setParameters(t)}});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YN(function*(){const n=yield JN(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=vO().supportPCSetConfiguration;if(e===gM.RELAY&&!n)return;if(n){const n=t.peerConnection.getConfiguration(),r=e===gM.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}e!==gM.RELAY&&t.remoteSDP.updateCandidates(e);const r=yield JN(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=xU(r.sdp),{remoteIceParameters:s}=yield i.iceParameters;t.remoteSDP.restartICE(s);const a=t.remoteSDP.toString();yield JN(t.peerConnection.setLocalDescription(r)),yield JN(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e});1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find(e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t});n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new RA(AA.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new RA(AA.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},AI("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZA(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),AI("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id})),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!vO().supportSetRtpSenderParameters)return aO.warn("Browser not support set rtp-sender parameters");const r={},i={};if(e instanceof DD)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(AI("DSCP_TYPE")&&xA()){var s;const e=AI("DSCP_TYPE");Dr(s=["very-low","low","medium","high"]).call(s,e)&&(i.networkPriority=e)}const a=t.getParameters(),o=null===(n=a.encodings)||void 0===n?void 0:n[0];o&&Object.assign(o,i),Object.assign(a,r),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!vO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=VI(e);return t.forEach((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find(e=>e.attributes.mid===r.kind);i&&CU(i,e)}),FI(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map((t,n)=>{let{id:r,mslabel:i}=t;const{kind:s}=e[n];return new np((e,t)=>{const n=setTimeout(()=>{t(new Error("Cannot receive track, id: ".concat(r)))},1e4),a=t=>{const o=qC();if("Safari"===o.name&&11===Number(o.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(s,r,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",a)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await np.all(t)}catch(e){throw new RA(AA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(vO().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Rj(NY.prototype,"connect",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"connect"),NY.prototype),Rj(NY.prototype,"stopSending",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"stopSending"),NY.prototype),Rj(NY.prototype,"receive",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"receive"),NY.prototype),Rj(NY.prototype,"stopReceiving",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"stopReceiving"),NY.prototype),Rj(NY.prototype,"muteRemote",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"muteRemote"),NY.prototype),Rj(NY.prototype,"unmuteRemote",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"unmuteRemote"),NY.prototype),Rj(NY.prototype,"muteLocal",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"muteLocal"),NY.prototype),Rj(NY.prototype,"unmuteLocal",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"unmuteLocal"),NY.prototype),Rj(NY.prototype,"close",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"close"),NY.prototype),Rj(NY.prototype,"updateEncoderConfig",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"updateEncoderConfig"),NY.prototype),Rj(NY.prototype,"updateSendParameters",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"updateSendParameters"),NY.prototype),Rj(NY.prototype,"replaceTrack",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"replaceTrack"),NY.prototype),Rj(NY.prototype,"getRemoteSSRC",[IY],Object.getOwnPropertyDescriptor(NY.prototype,"getRemoteSSRC"),NY.prototype),NY);function IY(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return await r.apply(this,s)}finally{n()}},n}const OY={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new RY(n,t)}},PY={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!vO().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(dL.has(e))return;if(!e.track)return;const n={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const s=new TransformStream({transform(i,s){n.controller||(n.controller=s),e.track&&e.track.id!==n.track.id&&(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const a=t.metadata&&t.metadata();a?function(e,t){const{chunk:n,controller:r}=t,i=cL.METADATA;n.data=function(e,t,n){const r=n.byteLength,i=r+aL+oL,s=iL+sL+i,a=new ArrayBuffer(e.byteLength+s),o=new DataView(a);o.setUint8(0,rL),o.setUint16(1,i),o.setUint8(3,t),o.setUint16(4,r);for(let l=0;l<r;l++)o.setUint8(6+l,n[l]);const c=new Uint8Array(o.buffer);return c.set(new Uint8Array(e),s),c.buffer}(n.data,i,e),r.enqueue(n)}(a,{sender:e,chunk:i,controller:s}):s.enqueue(i)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const i=nL(),s=new MessageChannel;await new np(e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=a,await new np(e=>i.onmessage=t=>{"started"===t.data&&e(void 0)}),s.port1.onmessage=i=>{var a;if(i.data.transformed&&e.track&&(null===(a=e.track)||void 0===a?void 0:a.id)!==n.track.id)aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(i.data.getMetadata){const e=t.metadata&&t.metadata();e&&s.port1.postMessage({metadata:e})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=dL.get(e);if(t){dL.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){aO.warning(e&&e.message)}}}dL.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!vO().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(PL.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ZC()&&!rA()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");aA(HC.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const s=new TransformStream({transform(i,s){n.controller||(n.controller=s),e.track&&e.track.id!==n.track.id&&(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(e,t,n){var r;const i=lL(new DataView(t.data));if(!i)return n.enqueue(t);const s=e.track.id;kL.set(s,e.track);const a=null===(r=i.tlv.find(e=>e.tag===cL.AUDIO_LEVEL))||void 0===r?void 0:r.value;let o=0;"number"==typeof a&&(o=127-a);const c=Math.round(Math.pow(10,o/60)-1),{selected:l,speaker:d}=function(e,t){let n=xL.get(e);if(n||(n=function(e){const t=new yL;return xL.set(e,t),wL||(wL=new bL(AI("TOPN_SILENCE_THRESHOLD")||500),wL.on("ActiveSpeakerChanged",e=>{null!=e&&(SL=e)})),wL.addSpeakers([t]),t}(e)),xL.size<=TL)return{selected:!0,speaker:n};if(!wL)throw new Error("no active speaker detector");return wL.levelChanged(n.id,t),NL=wL.loudest.map(e=>e.id),SL&&!Dr(NL).call(NL,SL)&&NL.length>=TL&&NL.pop(),{selected:Dr(NL).call(NL,n.id)||n.id===SL,speaker:n}}(e,c),u=function(e,t,n){const r=CL.get(e)||new RL(e,t);return r.score=n,CL.set(e,r),function(e){if(AL.set(e,!0),!IL)return void(IL=Date.now());const t=Date.now();t-IL>1e3&&(AL.get(e)?AL.set(e,!1):(OL(e),AL.delete(e)),IL=t)}(e),r}(s,e.track,d.energyScore);u.addSample(l),u.active&&(t.data=i.frame.buffer,n.enqueue(t))}(e,i,s):t.enableMetadata||t.enablePts?function(e,t,n,r){const i=new DataView(e.data),s=i.getUint8(0);let a;if(0!=(128&s)&&71!==s){const t=function(e){if(e.byteLength<=0)return[];const t=[];let n=0;for(;n<e.byteLength;){const r=(128&e.getUint8(n))>>7,i=127&e.getUint8(n);if(!(r&&n+4<=e.byteLength)){n++;break}{const r=e.getUint32(n,!1),s=(16776192&r)>>10,a=1023&r;t.push({pt:i,ts_offset:s,length:a,data:new Uint8Array}),n+=4}}let r=e.byteLength-n;for(const i of t){if(i.length>r)return console.warn("Broken red payload"),[];i.length>0&&(i.data=new Uint8Array(e.buffer,e.byteOffset+n,i.length),n+=i.length,r-=i.length)}if(r>0){const i={pt:t.length>0?t[t.length-1].pt:0,ts_offset:0,length:r,data:new Uint8Array(e.buffer,e.byteOffset+n,r)};t.push(i)}return t}(i);if(t.length>0){const n=function(e){let t=0;for(let i=0;i<e.length;i++)t+=i<e.length-1?4:1,t+=e[i].length;const n=new Uint8Array(t);let r=0;for(let i=0;i<e.length;i++)if(i<e.length-1){const t=(2147483648|(127&e[i].pt)<<24|(262143&e[i].ts_offset)<<10|1023&e[i].length)>>>0;n[r++]=t>>24&255,n[r++]=t>>16&255,n[r++]=t>>8&255,n[r++]=255&t}else n[r++]=127&e[i].pt;for(const i of e)n.set(i.data,r),r+=i.length;return n}(t.map(e=>{const t=new Uint8Array(e.length);t.set(e.data);const n=lL(new DataView(t.buffer));return null!=n&&n.frame&&(e.data=null==n?void 0:n.frame),a=n,e}));e.data=n.buffer}}else a=lL(i),a&&(e.data=a.frame.buffer);if(t.enqueue(e),!a)return;const o=a.tlv.find(e=>e.tag===cL.METADATA);o&&n&&o.value instanceof Uint8Array&&n(o.value);const c=a.tlv.find(e=>e.tag===cL.AUDIO_64_BIT_PTS);c&&r&&c.value instanceof Uint8Array&&8==c.value.length&&r(new DataView(c.value.buffer).getBigUint64(0,!0))}(i,s,t.onMetadata,t.onPts):s.enqueue(i)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=nL(),i=new MessageChannel;await new np(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const s=new RTCRtpScriptTransform(t,{name:"audio-metadata-rx",port:i.port2},[i.port2]);e.transform=s,await new np(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.metadata&&n.onMetadata?n.onMetadata(t.data.metadata):t.data.pts&&n.onPts&&n.onPts(t.data.pts)},n.worker=t}function r(){e.track.removeEventListener("ended",r),function(e){const t=PL.get(e);if(t){!function(e){const t=xL.get(e);t&&(xL.delete(e),wL&&(wL.removeSpeakers([t]),0===xL.size&&(wL.destroy(),wL=null)))}(e),OL(e.track.id),PL.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}PL.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!vO().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(VL.has(e))return;if(!e.track)return;const n={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const s=[];t.on("sei-to-send",e=>{s.push(e)});const a=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const a=UL(new Uint8Array(t.data)),o=s.shift();if(o){const e=function(e,t,n){switch(n){case DL:return function(e,t){const n=ML(t),r=n.length,i=Math.floor(r/255),s=r%255,a=new Uint8Array(6+i+1+r+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=6,a[5]=101;let o=0;for(;o<i;)a[6+o]=255,o++;return a[6+o]=s,o++,a.set(n,6+o),a.set(new Uint8Array(e),6+o+r),a.buffer}(e,t);case LL:return function(e,t){const n=ML(t),r=n.length,i=Math.floor(r/255),s=r%255,a=new Uint8Array(7+i+1+r+1+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=78,a[5]=1,a[6]=101;let o=0;for(;o<i;)a[7+o]=255,o++;return a[7+o]=s,o++,a.set(n,7+o),o+=r,a[7+o]=128,o++,a.set(new Uint8Array(e),7+o),a.buffer}(e,t);default:return null}}(t.data,o,a);e&&(t.data=e)}i.enqueue(t)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if(!$C())return;{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const i=nL(),s=new MessageChannel;await new np(e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=a,await new np(e=>i.onmessage=t=>{"started"===t.data&&e(void 0)}),t.on("sei-to-send",e=>{s.port1.postMessage({sei:e})}),s.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=VL.get(e);if(t){VL.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){aO.warning(e&&e.message)}}}VL.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!vO().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(!e.track)return;if(FL.has(e)){const n=FL.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const s=function(e,t){switch(t){case DL:return function(e){const t=new DataView(e.data);let n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let r=n+6,i=0,s=0;for(;255===(s=t.getUint8(r++));)i+=255;i+=s;const a=jL(e.data,r,i);return new Uint8Array(a)}n++}return null}(e);case LL:return function(e){const t=new DataView(e.data);let n=0;for(;n+5<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&78===t.getUint8(n+4)&&1===t.getUint8(n+5)&&101===t.getUint8(n+6)){let r=n+7,i=0,s=0;for(;255===(s=t.getUint8(r++));)i+=255;i+=s;const a=jL(e.data,r,i);return new Uint8Array(a)}n++}return null}(e);default:return null}}(t,UL(new Uint8Array(t.data)));s&&n.onSei&&n.onSei(s),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=nL(),i=new MessageChannel;await new np(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const s=new RTCRtpScriptTransform(t,{name:"sei-rx",port:i.port2},[i.port2]);e.transform=s,await new np(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){const t=FL.get(e);if(t){FL.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}FL.set(e,n),e.track.addEventListener("ended",r)}},kY={name:"InterceptFrame",create:()=>PY};vI(),CI("PROCESS_ID","process-".concat(TR(8,""),"-").concat(TR(4,""),"-").concat(TR(4,""),"-").concat(TR(4,""),"-").concat(TR(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();aO.debug("Loading global parameters from cache",t),Object.keys(t).forEach(e=>{if(Object.prototype.hasOwnProperty.call(NI,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;II[e]=r,NI[e]=r}})}catch(t){aO.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(II.AREAS)&&II.AREAS.length>0&&mV(II.AREAS,!0);const DY=(e,t,n)=>{aO.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),CI(e,t,n)};XU(ZK,!1),XU(sq,!1),XU(fG,!1),XU(jq,!1),XU(XK,!1),XU(xY,!1),XU(OY,!1),XU(kY,!1);const LY=function(e){const t=new WA,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===NM.SECURITY_POLICY_VIOLATION&&fH(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return pH(pH({},n),r)}({__TRACK_LIST__:LO,VERSION:yI,BUILD:SI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:DY,getParameter:AI,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return vO().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new fO(AA.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=mO.reportApiInvoke(null,{name:qA.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:YA.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&bA()&&sA(75)&&(new e).close()}catch(e){return aO.error("check system requirement failed: ",e),!1}let n=!1;const r=qC();r.name===HC.CHROME&&Number(r.version)>=58&&("WebKit"!==zC.engine.name||function(){const e=qC();if(QC()){if(e.os===GC.MAC_OS)return!0;if(e.os===GC.IOS){const e=zC.os.version&&zC.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===HC.FIREFOX&&Number(r.version)>=56||r.name===HC.OPERA&&Number(r.version)>=45||r.name===HC.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&(rA()||yA())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||_A()||qC().name===HC.QQ)&&(n=!0),aO.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return PP.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return PP.getRecordingDevices(e)},getCameras:function(e){return PP.getCamerasDevices(e)},getElectronScreenSources:SP,getPlaybackDevices:function(e){return PP.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=TR(5,"client-"),r=mO.reportApiInvoke(null,{id:n,name:qA.CREATE_CLIENT,options:[t],tag:YA.TRACER});try{!function(e){OA(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),OA(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&OA(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&DA(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&$A(e.turnServer),void 0!==e.httpRetryConfig&&XA(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&XA(e.websocketRetryConfig)}(t)}catch(e){throw r.onError(e),e}return(uA(16,0,!0)||hA(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",aO.debug("browser not support vp9, force use vp8")),CI("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),r.onSuccess(),new aH(sH(sH({forceWaitGatewayResponse:!0},t),{},{role:Dr(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=AI("CAMERA_CAPTURE_CONFIG"),n=TR(8,"track-cam-"),r=mO.reportApiInvoke(null,{id:n,tag:YA.TRACER,name:qA.CREATE_CAM_VIDEO_TRACK,options:[lP({},e),t]});t&&(e.encoderConfig=t);const i=qP(e);let s=null;aO.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await AP({video:i},n)).getVideoTracks()[0]||null}catch(e){throw r.onError(e),e}if(!s){const e=new RA(AA.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(e),e.throw(aO)}if(e.optimizationMode&&jD(n,s,e,IO(e.encoderConfig)),AI("USE_STANDARD_BITRATE_DEFAULT")){const t=IO(e.encoderConfig);e.encoderConfig=t,delete t.bitrateMax,delete t.bitrateMin}const a=new LD(s,e,i,e.scalabiltyMode?PO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(a.getTrackId()),aO.info("create camera video success, trackId:",n),a},createCustomVideoTrack:function(e){const t=TR(8,"track-cus-"),n=mO.reportApiInvoke(null,{id:t,tag:YA.TRACER,name:qA.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});AI("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new DD(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?PO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[UO.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),aO.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n="object"==typeof t?function(e){return YP(e)}(t):void 0;n&&(t="auto");const r=TR(8,"track-scr-v-"),i=mO.reportApiInvoke(null,{id:r,tag:YA.TRACER,name:qA.CREATE_SCREEN_VIDEO_TRACK,options:[lP({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&ZC()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:s,preferCurrentTab:a}=e;(iA(107)||oA(107)||pA(93))&&(n&&(OA(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(OA(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(OA(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(iA(105)||oA(105)||pA(91))&&s&&(OA(s,"systemAudio",["exclude","include"]),t.systemAudio=s),(iA(94)||oA(94)||pA(80))&&a&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const o=e.encoderConfig?OO(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&(o.frameRate&&("number"==typeof o.frameRate?(t.mandatory.maxFrameRate=o.frameRate,t.mandatory.minFrameRate=o.frameRate):(t.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,t.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),t.frameRate=o.frameRate),o.width&&(t.width=o.width),o.height&&(t.height=o.height)),t}(e);let a=null,o=null;const c=vO();if(!c.supportShareAudio&&"enable"===t){const e=new RA(AA.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(e),e.throw(aO)}aO.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const l=c.supportShareAudio&&"disable"!==t;try{const e=await AP({screen:s,screenAudio:l?n||!0:void 0},r);a=e.getVideoTracks()[0]||null,o=e.getAudioTracks()[0]||null}catch(e){throw i.onError(e),e}if(!a){const e=new RA(AA.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(e),e.throw(aO)}if(!o&&"enable"===t){a&&a.stop();const e=new RA(AA.SHARE_AUDIO_NOT_ALLOWED);return i.onError(e),e.throw(aO)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(jD(r,a,e,e.encoderConfig&&OO(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const d=new DD(a,e.encoderConfig?OO(e.encoderConfig):{},e.scalabiltyMode?PO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[UO.SCREEN_TRACK]);if(!o)return i.onSuccess(d.getTrackId()),aO.info("create screen video track success","video:",d.getTrackId()),d;const u=new Fk(o,void 0,TR(8,"track-scr-a-"),!1);return i.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create screen video track success","video:",d.getTrackId(),"audio:",u.getTrackId()),[d,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=AI("CAMERA_CAPTURE_CONFIG"),r=TR(8,"track-mic-"),i=TR(8,"track-cam-"),s=mO.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:YA.TRACER,name:qA.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const a=qP(t),o=XP(e);let c=null,l=null;aO.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await AP({audio:o,video:a},"".concat(r,"-").concat(i));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw s.onError(e),e}if(!c||!l){const e=new RA(AA.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(e),e.throw(aO)}if(t.optimizationMode&&jD(i,l,t,IO(t.encoderConfig)),AI("USE_STANDARD_BITRATE_DEFAULT")){const e=IO(t.encoderConfig);t.encoderConfig=e,delete e.bitrateMax,delete e.bitrateMin}const d=new Bk(c,e,o,r),u=new LD(l,t,a,t.scalabiltyMode?PO(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=TR(8,"track-mic-"),n=mO.reportApiInvoke(null,{id:t,tag:YA.TRACER,name:qA.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=XP(e);let i=null;aO.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await AP({audio:r},t)).getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!i){const e=new RA(AA.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(aO)}const s=new Bk(i,e,r,t);return n.onSuccess(s.getTrackId()),aO.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=TR(8,"track-cus-"),n=mO.reportApiInvoke(null,{id:t,tag:YA.TRACER,name:qA.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Fk(e.mediaStreamTrack,e.encoderConfig?DO(e.encoderConfig):{},t,!1);return aO.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},a=TR(8,"track-buf-"),o=mO.reportApiInvoke(null,{id:a,tag:YA.TRACER,name:qA.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(AI("DISABLE_WEBAUDIO"))throw new RA(AA.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");aO.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",a);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){const t=zk.get(e);if(t)return aO.debug("use cached audio resource: ",e),t;try{n=(await GR(()=>jC.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new RA(AA.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new np((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new RA(AA.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new RA(AA.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)});n=await t}const r=await function(e){const t=fP();return new np((n,r)=>{t.decodeAudioData(e,e=>{n(e)},e=>{r(new RA(AA.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(n);return"string"==typeof e&&t&&zk.set(e,r),r}(i,n)}catch(e){return o.onError(e),e.throw(aO)}const l=new Wk(i),d=new Gk(c,l,r?DO(r):{},a);return aO.info("create buffer source audio track success, trackId:",a),o.onSuccess(d.getTrackId()),d},setAppType:function(e){if(aO.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw aO.debug("Invalid appType"),new fO(AA.INVALID_PARAMS,"invalid app type",e);CI("APP_TYPE",Math.floor(e))},setLogLevel:function(e){aO.setLogLevel(e)},enableLogUpload:function(){AI("USE_NEW_LOG")?CI("UPLOAD_LOG",!0):aO.enableLogUpload()},disableLogUpload:function(){AI("USE_NEW_LOG")?CI("UPLOAD_LOG",!1):aO.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new JV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=mO.reportApiInvoke(null,{tag:YA.TRACER,name:qA.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Fk||e instanceof QD)){const e=new fO(AA.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Fk?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,a=i;const o=Date.now();return new np(i=>{const c=setInterval(()=>{const l=e.getVolumeLevel();s=l>s?l:s,a=l<a?l:a;const d=s-a>1e-4,u=Date.now()-o;if(d||u>t){clearInterval(c);const t=d,a={duration:u,deviceLabel:r,maxVolumeLevel:s,result:t};aO.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),n.onSuccess(a),i(t)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=mO.reportApiInvoke(null,{tag:YA.TRACER,name:qA.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof DD||e instanceof JD)){const e=new fO(AA.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof DD?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,($C()||QC())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const a=document.createElement("canvas");a.width=160,a.height=120;let o=0,c=0;try{const e=Date.now();o=await function(e,t,n,r){let i,s=0,a=null;return new np((o,c)=>{function l(){s>r&&i&&(i(),o(s));const t=n.getContext("2d");if(!t){const e=new fO(AA.UNEXPECTED_ERROR,"can not get canvas 2d context.");return aO.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,n.width,n.height),d=Math.floor(l.data.length/3);if(a){for(let e=0;e<d;e+=3)if(l.data[e]!==a[e])return s+=1,void(a=l.data);a=l.data}else a=l.data}setTimeout(()=>{i&&(i(),o(s))},t),i=yP(()=>{l()},30)})}(s,t,a,4),c=Date.now()-e}catch(e){throw n.onError(e),e}hB===HC.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const l=o>4,d={duration:c,changedPicNum:o,deviceLabel:r,result:l};return aO.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),n.onSuccess(d),l},setArea:mV,audioElementPlayCenter:UP,resumeAudioContext:function(){UP.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){uH.processExternalMediaAEC(e)},registerExtensions:function(e){const t=AI("PLUGIN_INFO")||[];e.forEach(e=>{"name"in e&&!Dr(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=aO.extLog,n.reporter.hookApiInvoke=mO.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(e=>{n.parameters[e]=AI(e)})}),DY("PLUGIN_INFO",t)},ChannelMediaRelayError:nM,ChannelMediaRelayEvent:eM,ChannelMediaRelayState:tM,RemoteStreamFallbackType:BO,RemoteStreamType:FO,ConnectionDisconnectedReason:QA,AudienceLatencyLevelType:JA,AREAS:oM,preload:async function(e,t,n,r){return NB(e,t,n,r)}});return Object.defineProperties(LY,{onAudioAutoplayFailed:{get:()=>DP.onAudioAutoplayFailed,set:e=>{DP.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>DP.onAutoplayFailed,set:e=>{DP.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>LY._onSecurityPolicyViolation,set(e){LY._onSecurityPolicyViolation=e,fH(e)}},__CLIENT_LIST__:{get:()=>AI("SHOW_GLOBAL_CLIENT_LIST")?HL:[]}}),PP.on(tP.CAMERA_DEVICE_CHANGED,e=>{aO.info("camera device changed",JSON.stringify(e)),LY.onCameraChanged&&LY.onCameraChanged(e),LY.safeEmit(NM.CAMERA_CHANGED,e)}),PP.on(tP.RECORDING_DEVICE_CHANGED,e=>{aO.info("microphone device changed",JSON.stringify(e)),LY.onMicrophoneChanged&&LY.onMicrophoneChanged(e),LY.safeEmit(NM.MICROPHONE_CHANGED,e)}),PP.on(tP.PLAYOUT_DEVICE_CHANGED,e=>{aO.debug("playout device changed",JSON.stringify(e)),LY.onPlaybackDeviceChanged&&LY.onPlaybackDeviceChanged(e),LY.safeEmit(NM.PLAYBACK_DEVICE_CHANGED,e)}),UP.onAutoplayFailed=()=>{aO.info("detect audio element autoplay failed"),DP.onAudioAutoplayFailed&&DP.onAudioAutoplayFailed()},mP.on("autoplay-failed",()=>{aO.info("detect webaudio autoplay failed"),DP.onAudioAutoplayFailed&&DP.onAudioAutoplayFailed(),LY.safeEmit(NM.AUTOPLAY_FAILED)}),mP.on(xO.STATE_CHANGE,(e,t)=>{aO.info("audio context state changed: ".concat(t," => ").concat(e)),LY.onAudioContextStateChanged&&LY.onAudioContextStateChanged(e,t),LY.safeEmit(NM.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),lR.on(iR.NETWORK_STATE_CHANGE,(e,t)=>{aO.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=LY),LY}()},1641:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(6368),function(){var e=t,n=e.lib.WordArray,r=e.algo,i=r.SHA256,s=r.SHA224=i.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=i._createHelper(s),e.HmacSHA224=i._createHmacHelper(s)}(),t.SHA224)}()},1659:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.StreamCipher,r=e.algo,i=[],s=[],a=[],o=r.RabbitLegacy=n.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)r[i]^=n[i+4&7];if(t){var s=t.words,a=s[0],o=s[1],l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=l>>>16|4294901760&d,h=d<<16|65535&l;for(r[0]^=l,r[1]^=u,r[2]^=d,r[3]^=h,r[4]^=l,r[5]^=u,r[6]^=d,r[7]^=h,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,o=r>>>16,c=((i*i>>>17)+i*o>>>15)+o*o,l=((4294901760&r)*r|0)+((65535&r)*r|0);a[n]=c^l}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=n._createHelper(o)}(),t.RabbitLegacy)}()},1776:(e,t,n)=>{"use strict";n.d(t,{cY:()=>f,FA:()=>D,g:()=>k,u:()=>c,Uj:()=>o,Fy:()=>y,tD:()=>G,bD:()=>M,hp:()=>B,T9:()=>p,Tj:()=>u,yU:()=>h,XA:()=>m,mS:()=>l,Ku:()=>z,ZQ:()=>x,sr:()=>N,zJ:()=>g,c1:()=>T,Im:()=>j,lT:()=>A,zW:()=>O,jZ:()=>w,lV:()=>C,nr:()=>R,Ov:()=>I,gE:()=>v,Am:()=>V,I9:()=>F,P1:()=>b,eX:()=>P});var r=n(2555);const i=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,a=s?e[i+1]:0,o=i+2<e.length,c=o?e[i+2]:0,l=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|c>>6,h=63&c;o||(h=64,s||(u=64)),r.push(n[l],n[d],n[u],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const c=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==c)throw new a;const l=t<<2|s>>4;if(r.push(l),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==c){const e=o<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class a extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},c=function(e){try{return s.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function l(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const d=()=>{try{return l().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},u=e=>{var t;return null===(t=d())||void 0===t||null===(t=t.emulatorHosts)||void 0===t?void 0:t[e]},h=e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},p=()=>{var e;return null===(e=d())||void 0===e?void 0:e.config},m=e=>{var t;return null===(t=d())||void 0===t?void 0:t["_".concat(e)]};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function g(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}async function v(e){return(await fetch(e,{credentials:"include"})).ok}function y(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=(0,r.A)({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(a)),""].join(".")}const _={};let E=!1;function b(e,t){if("undefined"===typeof window||"undefined"===typeof document||!g(window.location.host)||_[e]===t||_[e]||E)return;function n(e){return"__firebase__banner__".concat(e)}_[e]=t;const r="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(_))_[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{E=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),a=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),c=document.getElementById(o)||document.createElement("a"),l=n("preprendIcon"),d=document.getElementById(l)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(c,o);const n=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,l),t.append(d,a,c,n),document.body.appendChild(t)}i?(a.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}function x(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function w(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x())}function S(){var e;const t=null===(e=d())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}function T(){return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function N(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function C(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function A(){const e=x();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function R(){return!S()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I(){return!S()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function O(){try{return"object"===typeof indexedDB}catch(e){return!1}}function P(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}class k extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,k.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,D.prototype.create)}}class D{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(L,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",s="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new k(n,s,t)}}const L=/\{\$([^}]+)}/g;function j(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function M(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(U(n)&&U(s)){if(!M(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function U(e){return null!==e&&"object"===typeof e}function V(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function F(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function B(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function G(e,t){const n=new H(e,t);return n.subscribe.bind(n)}class H{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=W),void 0===r.error&&(r.error=W),void 0===r.complete&&(r.complete=W);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function W(){}function z(e){return e&&e._delegate?e._delegate:e}},1884:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,r=4*t,i=r-n%r,s=n+i-1;e.clamp(),e.words[s>>>2]|=i<<24-s%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},t.pad.Ansix923)}()},1889:(e,t,n)=>{"use strict";n.d(t,{Uz:()=>C,Qg:()=>A});var r=n(9232),i=n(1776),s=n(9606);const a="type.googleapis.com/google.protobuf.Int64Value",o="type.googleapis.com/google.protobuf.UInt64Value";function c(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function l(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"===typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>l(e));if("function"===typeof e||"object"===typeof e)return c(e,e=>l(e));throw new Error("Data cannot be encoded in JSON: "+e)}function d(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case a:case o:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>d(e)):"function"===typeof e||"object"===typeof e?c(e,e=>d(e)):e}const u="functions",h={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class p extends i.g{constructor(e,t,n){super("".concat(u,"/").concat(e),t||""),this.details=n,Object.setPrototypeOf(this,p.prototype)}}function m(e,t){let n,r=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=r;try{const e=t&&t.error;if(e){const t=e.status;if("string"===typeof t){if(!h[t])return new p("internal","internal");r=h[t],i=t}const s=e.message;"string"===typeof s&&(i=s),n=e.details,void 0!==n&&(n=d(n))}}catch(s){}return"ok"===r?null:new p(r,i,n)}class f{constructor(e,t,n,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,(0,r.xZ)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||n.get().then(e=>this.messaging=e,()=>{}),this.appCheck||null===i||void 0===i||i.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const g="us-central1",v=/^data: (.*?)(?:\n|$)/;class y{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){return fetch(...arguments)};this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new f(e,t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(i);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=g}catch(a){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){const n=this.emulatorOrigin;return"".concat(n,"/").concat(t,"/").concat(this.region,"/").concat(e)}return null!==this.customDomain?"".concat(this.customDomain,"/").concat(e):"https://".concat(this.region,"-").concat(t,".cloudfunctions.net/").concat(e)}}function _(e,t,n){const r=r=>function(e,t,n,r){const i=e._url(t);return w(e,i,n,r)}(e,t,r,n||{});return r.stream=(n,r)=>function(e,t,n,r){const i=e._url(t);return S(e,i,n,r||{})}(e,t,n,r),r}function E(e){return e.emulatorOrigin&&(0,i.zJ)(e.emulatorOrigin)?"include":void 0}async function b(e,t,n,r,i){let s;n["Content-Type"]="application/json";try{s=await r(e,{method:"POST",body:JSON.stringify(t),headers:n,credentials:E(i)})}catch(o){return{status:0,json:null}}let a=null;try{a=await s.json()}catch(o){}return{status:s.status,json:a}}async function x(e,t){const n={},r=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),null!==r.appCheckToken&&(n["X-Firebase-AppCheck"]=r.appCheckToken),n}async function w(e,t,n,r){const i={data:n=l(n)},s=await x(e,r),a=function(e){let t=null;return{promise:new Promise((n,r)=>{t=setTimeout(()=>{r(new p("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),o=await Promise.race([b(t,i,s,e.fetchImpl,e),a.promise,e.cancelAllRequests]);if(a.cancel(),!o)throw new p("cancelled","Firebase Functions instance was deleted.");const c=m(o.status,o.json);if(c)throw c;if(!o.json)throw new p("internal","Response is not valid JSON object.");let u=o.json.data;if("undefined"===typeof u&&(u=o.json.result),"undefined"===typeof u)throw new p("internal","Response is missing data field.");return{data:d(u)}}async function S(e,t,n,r){var i;const s={data:n=l(n)},a=await x(e,r);let o,c,u;a["Content-Type"]="application/json",a.Accept="text/event-stream";try{o=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(s),headers:a,signal:null===r||void 0===r?void 0:r.signal,credentials:E(e)})}catch(g){if(g instanceof Error&&"AbortError"===g.name){const e=new p("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}const e=m(0,null);return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}const h=new Promise((e,t)=>{c=e,u=t});null===r||void 0===r||null===(i=r.signal)||void 0===i||i.addEventListener("abort",()=>{const e=new p("cancelled","Request was cancelled.");u(e)});const f=function(e,t,n,r){const i=(e,r)=>{const i=e.match(v);if(!i)return;const s=i[1];try{const e=JSON.parse(s);if("result"in e)return void t(d(e.result));if("message"in e)return void r.enqueue(d(e.message));if("error"in e){const t=m(0,e);return r.error(t),void n(t)}}catch(a){if(a instanceof p)return r.error(a),void n(a)}},s=new TextDecoder;return new ReadableStream({start(t){let a="";return o();async function o(){if(null!==r&&void 0!==r&&r.aborted){const e=new p("cancelled","Request was cancelled");return t.error(e),n(e),Promise.resolve()}try{const{value:c,done:l}=await e.read();if(l)return a.trim()&&i(a.trim(),t),void t.close();if(null!==r&&void 0!==r&&r.aborted){const r=new p("cancelled","Request was cancelled");return t.error(r),n(r),void await e.cancel()}a+=s.decode(c,{stream:!0});const d=a.split("\n");a=d.pop()||"";for(const e of d)e.trim()&&i(e.trim(),t);return o()}catch(c){const e=c instanceof p?c:m(0,null);t.error(e),n(e)}}},cancel:()=>e.cancel()})}(o.body.getReader(),c,u,null===r||void 0===r?void 0:r.signal);return{stream:{[Symbol.asyncIterator](){const e=f.getReader();return{async next(){const{value:t,done:n}=await e.read();return{value:t,done:n}},return:async()=>(await e.cancel(),{done:!0,value:void 0})}}},data:h}}const T="@firebase/functions",N="0.13.1";function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,r.Sx)(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g;const n=(0,r.j6)((0,i.Ku)(e),u).getImmediate({identifier:t}),s=(0,i.yU)("functions");return s&&function(e,t,n){!function(e,t,n){const r=(0,i.zJ)(t);e.emulatorOrigin="http".concat(r?"s":"","://").concat(t,":").concat(n),r&&((0,i.gE)(e.emulatorOrigin+"/backends"),(0,i.P1)("Functions",!0))}((0,i.Ku)(e),t,n)}(n,...s),n}function A(e,t,n){return _((0,i.Ku)(e),t,n)}var R;(0,r.om)(new s.uA(u,(e,t)=>{let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("messaging-internal"),a=e.getProvider("app-check-internal");return new y(r,i,s,a,n)},"PUBLIC").setMultipleInstances(!0)),(0,r.KO)(T,N,R),(0,r.KO)(T,N,"esm2020")},1991:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});var r=n(8870),i=new(function(){function e(){this.queue=[],this.transactions=0,this.notifyFn=function(e){e()},this.batchNotifyFn=function(e){e()}}var t=e.prototype;return t.batch=function(e){var t;this.transactions++;try{t=e()}finally{this.transactions--,this.transactions||this.flush()}return t},t.schedule=function(e){var t=this;this.transactions?this.queue.push(e):(0,r.G6)(function(){t.notifyFn(e)})},t.batchCalls=function(e){var t=this;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.schedule(function(){e.apply(void 0,r)})}},t.flush=function(){var e=this,t=this.queue;this.queue=[],t.length&&(0,r.G6)(function(){e.batchNotifyFn(function(){t.forEach(function(t){e.notifyFn(t)})})})},t.setNotifyFunction=function(e){this.notifyFn=e},t.setBatchNotifyFunction=function(e){this.batchNotifyFn=e},e}())},2002:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib,r=n.WordArray,i=n.Hasher,s=e.algo,a=[],o=s.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],c=n[4],l=0;l<80;l++){if(l<16)a[l]=0|e[t+l];else{var d=a[l-3]^a[l-8]^a[l-14]^a[l-16];a[l]=d<<1|d>>>31}var u=(r<<5|r>>>27)+c+a[l];u+=l<20?1518500249+(i&s|~i&o):l<40?1859775393+(i^s^o):l<60?(i&s|i&o|s&o)-1894007588:(i^s^o)-899497514,c=o,o=s,s=i<<30|i>>>2,i=r,r=u}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=i._createHelper(o),e.HmacSHA1=i._createHmacHelper(o)}(),t.SHA1)}()},2145:(e,t,n)=>{"use strict";n.d(t,{N9:()=>R,oR:()=>V});var r=n(2555),i=n(3986),s=n(5043);function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}const o=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r},c=["theme","type"],l=["delay","staleId"],d=e=>"number"==typeof e&&!isNaN(e),u=e=>"string"==typeof e,h=e=>"function"==typeof e,p=e=>u(e)||h(e)?e:null,m=e=>(0,s.isValidElement)(e)||u(e)||h(e)||d(e);function f(e){let{enter:t,exit:n,appendPosition:r=!1,collapse:i=!0,collapseDuration:a=300}=e;return function(e){let{children:o,position:c,preventExitTransition:l,done:d,nodeRef:u,isIn:h}=e;const p=r?"".concat(t,"--").concat(c):t,m=r?"".concat(n,"--").concat(c):n,f=(0,s.useRef)(0);return(0,s.useLayoutEffect)(()=>{const e=u.current,t=p.split(" "),n=r=>{r.target===u.current&&(e.dispatchEvent(new Event("d")),e.removeEventListener("animationend",n),e.removeEventListener("animationcancel",n),0===f.current&&"animationcancel"!==r.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",n),e.addEventListener("animationcancel",n)},[]),(0,s.useEffect)(()=>{const e=u.current,t=()=>{e.removeEventListener("animationend",t),i?function(e,t,n){void 0===n&&(n=300);const{scrollHeight:r,style:i}=e;requestAnimationFrame(()=>{i.minHeight="initial",i.height=r+"px",i.transition="all ".concat(n,"ms"),requestAnimationFrame(()=>{i.height="0",i.padding="0",i.margin="0",setTimeout(t,n)})})}(e,d,a):d()};h||(l?t():(f.current=1,e.className+=" ".concat(m),e.addEventListener("animationend",t)))},[h]),s.createElement(s.Fragment,null,o)}}function g(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const v={list:new Map,emitQueue:new Map,on(e,t){return this.list.has(e)||this.list.set(e,[]),this.list.get(e).push(t),this},off(e,t){if(t){const n=this.list.get(e).filter(e=>e!==t);return this.list.set(e,n),this}return this.list.delete(e),this},cancelEmit(e){const t=this.emitQueue.get(e);return t&&(t.forEach(clearTimeout),this.emitQueue.delete(e)),this},emit(e){this.list.has(e)&&this.list.get(e).forEach(t=>{const n=setTimeout(()=>{t(...[].slice.call(arguments,1))},0);this.emitQueue.has(e)||this.emitQueue.set(e,[]),this.emitQueue.get(e).push(n)})}},y=e=>{let{theme:t,type:n}=e,a=(0,i.A)(e,c);return s.createElement("svg",(0,r.A)({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===t?"currentColor":"var(--toastify-icon-color-".concat(n,")")},a))},_={info:function(e){return s.createElement(y,(0,r.A)({},e),s.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return s.createElement(y,(0,r.A)({},e),s.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return s.createElement(y,(0,r.A)({},e),s.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return s.createElement(y,(0,r.A)({},e),s.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return s.createElement("div",{className:"Toastify__spinner"})}};function E(e){const[,t]=(0,s.useReducer)(e=>e+1,0),[n,a]=(0,s.useState)([]),o=(0,s.useRef)(null),c=(0,s.useRef)(new Map).current,f=e=>-1!==n.indexOf(e),y=(0,s.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:e,containerId:null,isToastActive:f,getToast:e=>c.get(e)}).current;function E(e){let{containerId:t}=e;const{limit:n}=y.props;!n||t&&y.containerId!==t||(y.count-=y.queue.length,y.queue=[])}function b(e){a(t=>null==e?[]:t.filter(t=>t!==e))}function x(){const{toastContent:e,toastProps:t,staleId:n}=y.queue.shift();S(e,t,n)}function w(e,n){let{delay:a,staleId:f}=n,E=(0,i.A)(n,l);if(!m(e)||function(e){return!o.current||y.props.enableMultiContainer&&e.containerId!==y.props.containerId||c.has(e.toastId)&&null==e.updateId}(E))return;const{toastId:w,updateId:T,data:N}=E,{props:C}=y,A=()=>b(w),R=null==T;R&&y.count++;const I=(0,r.A)((0,r.A)((0,r.A)({},C),{},{style:C.toastStyle,key:y.toastKey++},Object.fromEntries(Object.entries(E).filter(e=>{let[t,n]=e;return null!=n}))),{},{toastId:w,updateId:T,data:N,closeToast:A,isIn:!1,className:p(E.className||C.toastClassName),bodyClassName:p(E.bodyClassName||C.bodyClassName),progressClassName:p(E.progressClassName||C.progressClassName),autoClose:!E.isLoading&&(O=E.autoClose,P=C.autoClose,!1===O||d(O)&&O>0?O:P),deleteToast(){const e=g(c.get(w),"removed");c.delete(w),v.emit(4,e);const n=y.queue.length;if(y.count=null==w?y.count-y.displayedToast:y.count-1,y.count<0&&(y.count=0),n>0){const e=null==w?y.props.limit:1;if(1===n||1===e)y.displayedToast++,x();else{const t=e>n?n:e;y.displayedToast=t;for(let e=0;e<t;e++)x()}}else t()}});var O,P;I.iconOut=function(e){let{theme:t,type:n,isLoading:r,icon:i}=e,a=null;const o={theme:t,type:n};return!1===i||(h(i)?a=i(o):(0,s.isValidElement)(i)?a=(0,s.cloneElement)(i,o):u(i)||d(i)?a=i:r?a=_.spinner():(e=>e in _)(n)&&(a=_[n](o))),a}(I),h(E.onOpen)&&(I.onOpen=E.onOpen),h(E.onClose)&&(I.onClose=E.onClose),I.closeButton=C.closeButton,!1===E.closeButton||m(E.closeButton)?I.closeButton=E.closeButton:!0===E.closeButton&&(I.closeButton=!m(C.closeButton)||C.closeButton);let k=e;(0,s.isValidElement)(e)&&!u(e.type)?k=(0,s.cloneElement)(e,{closeToast:A,toastProps:I,data:N}):h(e)&&(k=e({closeToast:A,toastProps:I,data:N})),C.limit&&C.limit>0&&y.count>C.limit&&R?y.queue.push({toastContent:k,toastProps:I,staleId:f}):d(a)?setTimeout(()=>{S(k,I,f)},a):S(k,I,f)}function S(e,t,n){const{toastId:r}=t;n&&c.delete(n);const i={content:e,props:t};c.set(r,i),a(e=>[...e,r].filter(e=>e!==n)),v.emit(4,g(i,null==i.props.updateId?"added":"updated"))}return(0,s.useEffect)(()=>(y.containerId=e.containerId,v.cancelEmit(3).on(0,w).on(1,e=>o.current&&b(e)).on(5,E).emit(2,y),()=>{c.clear(),v.emit(3,y)}),[]),(0,s.useEffect)(()=>{y.props=e,y.isToastActive=f,y.displayedToast=n.length}),{getToastToRender:function(t){const n=new Map,r=Array.from(c.values());return e.newestOnTop&&r.reverse(),r.forEach(e=>{const{position:t}=e.props;n.has(t)||n.set(t,[]),n.get(t).push(e)}),Array.from(n,e=>t(e[0],e[1]))},containerRef:o,isToastActive:f}}function b(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientX:e.clientX}function x(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientY:e.clientY}function w(e){const[t,n]=(0,s.useState)(!1),[r,i]=(0,s.useState)(!1),a=(0,s.useRef)(null),o=(0,s.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,c=(0,s.useRef)(e),{autoClose:l,pauseOnHover:d,closeToast:u,onClick:p,closeOnClick:m}=e;function f(t){if(e.draggable){"touchstart"===t.nativeEvent.type&&t.nativeEvent.preventDefault(),o.didMove=!1,document.addEventListener("mousemove",_),document.addEventListener("mouseup",E),document.addEventListener("touchmove",_),document.addEventListener("touchend",E);const n=a.current;o.canCloseOnClick=!0,o.canDrag=!0,o.boundingRect=n.getBoundingClientRect(),n.style.transition="",o.x=b(t.nativeEvent),o.y=x(t.nativeEvent),"x"===e.draggableDirection?(o.start=o.x,o.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(o.start=o.y,o.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent/100))}}function g(t){if(o.boundingRect){const{top:n,bottom:r,left:i,right:s}=o.boundingRect;"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&o.x>=i&&o.x<=s&&o.y>=n&&o.y<=r?y():v()}}function v(){n(!0)}function y(){n(!1)}function _(n){const r=a.current;o.canDrag&&r&&(o.didMove=!0,t&&y(),o.x=b(n),o.y=x(n),o.delta="x"===e.draggableDirection?o.x-o.start:o.y-o.start,o.start!==o.x&&(o.canCloseOnClick=!1),r.style.transform="translate".concat(e.draggableDirection,"(").concat(o.delta,"px)"),r.style.opacity=""+(1-Math.abs(o.delta/o.removalDistance)))}function E(){document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",E),document.removeEventListener("touchmove",_),document.removeEventListener("touchend",E);const t=a.current;if(o.canDrag&&o.didMove&&t){if(o.canDrag=!1,Math.abs(o.delta)>o.removalDistance)return i(!0),void e.closeToast();t.style.transition="transform 0.2s, opacity 0.2s",t.style.transform="translate".concat(e.draggableDirection,"(0)"),t.style.opacity="1"}}(0,s.useEffect)(()=>{c.current=e}),(0,s.useEffect)(()=>(a.current&&a.current.addEventListener("d",v,{once:!0}),h(e.onOpen)&&e.onOpen((0,s.isValidElement)(e.children)&&e.children.props),()=>{const e=c.current;h(e.onClose)&&e.onClose((0,s.isValidElement)(e.children)&&e.children.props)}),[]),(0,s.useEffect)(()=>(e.pauseOnFocusLoss&&(document.hasFocus()||y(),window.addEventListener("focus",v),window.addEventListener("blur",y)),()=>{e.pauseOnFocusLoss&&(window.removeEventListener("focus",v),window.removeEventListener("blur",y))}),[e.pauseOnFocusLoss]);const w={onMouseDown:f,onTouchStart:f,onMouseUp:g,onTouchEnd:g};return l&&d&&(w.onMouseEnter=y,w.onMouseLeave=v),m&&(w.onClick=e=>{p&&p(e),o.canCloseOnClick&&u()}),{playToast:v,pauseToast:y,isRunning:t,preventExitTransition:r,toastRef:a,eventHandlers:w}}function S(e){let{closeToast:t,theme:n,ariaLabel:r="close"}=e;return s.createElement("button",{className:"Toastify__close-button Toastify__close-button--".concat(n),type:"button",onClick:e=>{e.stopPropagation(),t(e)},"aria-label":r},s.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},s.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function T(e){let{delay:t,isRunning:n,closeToast:i,type:a="default",hide:c,className:l,style:d,controlledProgress:u,progress:p,rtl:m,isIn:f,theme:g}=e;const v=c||u&&0===p,y=(0,r.A)((0,r.A)({},d),{},{animationDuration:"".concat(t,"ms"),animationPlayState:n?"running":"paused",opacity:v?0:1});u&&(y.transform="scaleX(".concat(p,")"));const _=o("Toastify__progress-bar",u?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated","Toastify__progress-bar-theme--".concat(g),"Toastify__progress-bar--".concat(a),{"Toastify__progress-bar--rtl":m}),E=h(l)?l({rtl:m,type:a,defaultClassName:_}):o(_,l);return s.createElement("div",{role:"progressbar","aria-hidden":v?"true":"false","aria-label":"notification timer",className:E,style:y,[u&&p>=1?"onTransitionEnd":"onAnimationEnd"]:u&&p<1?null:()=>{f&&i()}})}const N=e=>{const{isRunning:t,preventExitTransition:n,toastRef:i,eventHandlers:a}=w(e),{closeButton:c,children:l,autoClose:d,onClick:u,type:p,hideProgressBar:m,closeToast:f,transition:g,position:v,className:y,style:_,bodyClassName:E,bodyStyle:b,progressClassName:x,progressStyle:N,updateId:C,role:A,progress:R,rtl:I,toastId:O,deleteToast:P,isIn:k,isLoading:D,iconOut:L,closeOnClick:j,theme:M}=e,U=o("Toastify__toast","Toastify__toast-theme--".concat(M),"Toastify__toast--".concat(p),{"Toastify__toast--rtl":I},{"Toastify__toast--close-on-click":j}),V=h(y)?y({rtl:I,position:v,type:p,defaultClassName:U}):o(U,y),F=!!R||!d,B={closeToast:f,type:p,theme:M};let G=null;return!1===c||(G=h(c)?c(B):(0,s.isValidElement)(c)?(0,s.cloneElement)(c,B):S(B)),s.createElement(g,{isIn:k,done:P,position:v,preventExitTransition:n,nodeRef:i},s.createElement("div",(0,r.A)((0,r.A)({id:O,onClick:u,className:V},a),{},{style:_,ref:i}),s.createElement("div",(0,r.A)((0,r.A)({},k&&{role:A}),{},{className:h(E)?E({type:p}):o("Toastify__toast-body",E),style:b}),null!=L&&s.createElement("div",{className:o("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!D})},L),s.createElement("div",null,l)),G,s.createElement(T,(0,r.A)((0,r.A)({},C&&!F?{key:"pb-".concat(C)}:{}),{},{rtl:I,theme:M,delay:d,isRunning:t,isIn:k,closeToast:f,hide:m,type:p,style:N,className:x,controlledProgress:F,progress:R||0}))))},C=function(e,t){return void 0===t&&(t=!1),{enter:"Toastify--animate Toastify__".concat(e,"-enter"),exit:"Toastify--animate Toastify__".concat(e,"-exit"),appendPosition:t}},A=f(C("bounce",!0)),R=(f(C("slide",!0)),f(C("zoom")),f(C("flip")),(0,s.forwardRef)((e,t)=>{const{getToastToRender:n,containerRef:i,isToastActive:a}=E(e),{className:c,style:l,rtl:d,containerId:u}=e;function m(e){const t=o("Toastify__toast-container","Toastify__toast-container--".concat(e),{"Toastify__toast-container--rtl":d});return h(c)?c({position:e,rtl:d,defaultClassName:t}):o(t,p(c))}return(0,s.useEffect)(()=>{t&&(t.current=i.current)},[]),s.createElement("div",{ref:i,className:"Toastify",id:u},n((e,t)=>{const n=t.length?(0,r.A)({},l):(0,r.A)((0,r.A)({},l),{},{pointerEvents:"none"});return s.createElement("div",{className:m(e),style:n,key:"container-".concat(e)},t.map((e,n)=>{let{content:i,props:o}=e;return s.createElement(N,(0,r.A)((0,r.A)({},o),{},{isIn:a(o.toastId),style:(0,r.A)((0,r.A)({},o.style),{},{"--nth":n+1,"--len":t.length}),key:"toast-".concat(o.key)}),i)}))}))}));R.displayName="ToastContainer",R.defaultProps={position:"top-right",transition:A,autoClose:5e3,closeButton:S,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let I,O=new Map,P=[],k=1;function D(){return""+k++}function L(e){return e&&(u(e.toastId)||d(e.toastId))?e.toastId:D()}function j(e,t){return O.size>0?v.emit(0,e,t):P.push({content:e,options:t}),t.toastId}function M(e,t){return(0,r.A)((0,r.A)({},t),{},{type:t&&t.type||e,toastId:L(t)})}function U(e){return(t,n)=>j(t,M(e,n))}function V(e,t){return j(e,M("default",t))}V.loading=(e,t)=>j(e,M("default",(0,r.A)({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},t))),V.promise=function(e,t,n){let i,{pending:s,error:a,success:o}=t;s&&(i=u(s)?V.loading(s,n):V.loading(s.render,(0,r.A)((0,r.A)({},n),s)));const c={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},l=(e,t,s)=>{if(null==t)return void V.dismiss(i);const a=(0,r.A)((0,r.A)((0,r.A)({type:e},c),n),{},{data:s}),o=u(t)?{render:t}:t;return i?V.update(i,(0,r.A)((0,r.A)({},a),o)):V(o.render,(0,r.A)((0,r.A)({},a),o)),s},d=h(e)?e():e;return d.then(e=>l("success",o,e)).catch(e=>l("error",a,e)),d},V.success=U("success"),V.info=U("info"),V.error=U("error"),V.warning=U("warning"),V.warn=V.warning,V.dark=(e,t)=>j(e,M("default",(0,r.A)({theme:"dark"},t))),V.dismiss=e=>{O.size>0?v.emit(1,e):P=P.filter(t=>null!=e&&t.options.toastId!==e)},V.clearWaitingQueue=function(e){return void 0===e&&(e={}),v.emit(5,e)},V.isActive=e=>{let t=!1;return O.forEach(n=>{n.isToastActive&&n.isToastActive(e)&&(t=!0)}),t},V.update=function(e,t){void 0===t&&(t={}),setTimeout(()=>{const n=function(e,t){let{containerId:n}=t;const r=O.get(n||I);return r&&r.getToast(e)}(e,t);if(n){const{props:i,content:s}=n,a=(0,r.A)((0,r.A)((0,r.A)({delay:100},i),t),{},{toastId:t.toastId||e,updateId:D()});a.toastId!==e&&(a.staleId=e);const o=a.render||s;delete a.render,j(o,a)}},0)},V.done=e=>{V.update(e,{progress:1})},V.onChange=e=>(v.on(4,e),()=>{v.off(4,e)}),V.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},V.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},v.on(2,e=>{I=e.containerId||e,O.set(I,e),P.forEach(e=>{v.emit(0,e.content,e.options)}),P=[]}).on(3,e=>{O.delete(e.containerId||e),0===O.size&&v.off(0).off(1).off(5)})},2174:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const r=new class{constructor(){this.config={firebase:{apiKey:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",authDomain:"elderx-f5c2b.firebaseapp.com",projectId:"elderx-f5c2b",storageBucket:"elderx-f5c2b.firebasestorage.app",messagingSenderId:"987610993096",appId:"1:987610993096:web:97c82732772d1223d3f0fd"},ai:{openai:{apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_OPENAI_API_KEY,model:"gpt-4"},googleAI:{apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_GOOGLE_AI_API_KEY},anthropic:{apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_ANTHROPIC_API_KEY}},agora:{appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_AGORA_APP_ID,appCertificate:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_AGORA_APP_CERTIFICATE},environment:"production",apiBaseUrl:"https://us-central1-elderx-f5c2b.cloudfunctions.net",features:{aiFeatures:!1,voiceCommands:!0,emergencyAlerts:!0,medicationReminders:!0},analytics:{googleAnalyticsId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_GOOGLE_ANALYTICS_ID},sms:{twilioAccountSid:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_TWILIO_ACCOUNT_SID,twilioAuthToken:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_TWILIO_AUTH_TOKEN,twilioPhoneNumber:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_TWILIO_PHONE_NUMBER},email:{sendgridApiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_SENDGRID_API_KEY,fromEmail:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_FROM_EMAIL||"noreply@elderx.com"},security:{encryptionKey:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",jwtSecret:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk="}}}get(e){return e.split(".").reduce((e,t)=>null===e||void 0===e?void 0:e[t],this.config)}isFeatureEnabled(e){return!0===this.config.features[e]}isDevelopment(){return"development"===this.config.environment}isProduction(){return"production"===this.config.environment}getApiBaseUrl(){return this.config.apiBaseUrl}validate(){const e=["firebase.apiKey","firebase.projectId","firebase.authDomain"].filter(e=>!this.get(e));return!(e.length>0)||(console.warn("Missing required environment variables:",e),!1)}getAll(){return this.config}};r.validate()||console.warn("Environment configuration validation failed. Some features may not work properly.");const i=r},2238:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8211),void(t.lib.Cipher||function(e){var n=t,r=n.lib,i=r.Base,s=r.WordArray,a=r.BufferedBlockAlgorithm,o=n.enc,c=(o.Utf8,o.Base64),l=n.algo.EvpKDF,d=r.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?_:v}return function(t){return{encrypt:function(n,r,i){return e(r).encrypt(t,n,r,i)},decrypt:function(n,r,i){return e(r).decrypt(t,n,r,i)}}}}()}),u=(r.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),n.mode={}),h=r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=u.CBC=function(){var t=h.extend();function n(t,n,r){var i,s=this._iv;s?(i=s,this._iv=e):i=this._prevBlock;for(var a=0;a<r;a++)t[n+a]^=i[a]}return t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize;n.call(this,e,t,i),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,s=e.slice(t,t+i);r.decryptBlock(e,t),n.call(this,e,t,i),this._prevBlock=s}}),t}(),m=(n.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,i=r<<24|r<<16|r<<8|r,a=[],o=0;o<r;o+=4)a.push(i);var c=s.create(a,r);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},f=(r.BlockCipher=d.extend({cfg:d.cfg.extend({mode:p,padding:m}),reset:function(){var e;d.reset.call(this);var t=this.cfg,n=t.iv,r=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(r,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=(n.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?s.create([1398893684,1701076831]).concat(n).concat(t):t).toString(c)},parse:function(e){var t,n=c.parse(e),r=n.words;return 1398893684==r[0]&&1701076831==r[1]&&(t=s.create(r.slice(2,4)),r.splice(0,4),n.sigBytes-=16),f.create({ciphertext:n,salt:t})}},v=r.SerializableCipher=i.extend({cfg:i.extend({format:g}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r),s=i.finalize(t),a=i.cfg;return f.create({ciphertext:s,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(n.kdf={}).OpenSSL={execute:function(e,t,n,r,i){if(r||(r=s.random(8)),i)a=l.create({keySize:t+n,hasher:i}).compute(e,r);else var a=l.create({keySize:t+n}).compute(e,r);var o=s.create(a.words.slice(t),4*n);return a.sigBytes=4*t,f.create({key:a,iv:o,salt:r})}},_=r.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:y}),encrypt:function(e,t,n,r){var i=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize,r.salt,r.hasher);r.iv=i.iv;var s=v.encrypt.call(this,e,t,i.key,r);return s.mixIn(i),s},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var i=r.kdf.execute(n,e.keySize,e.ivSize,t.salt,r.hasher);return r.iv=i.iv,v.decrypt.call(this,e,t,i.key,r)}})}()))}()},2555:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function s(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.d(t,{A:()=>o})},2730:(e,t,n)=>{"use strict";var r=n(5043),i=n(8853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,r,i,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function _(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),x=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var k=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var j,M=Object.assign;function U(e){if(void 0===j)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);j=t&&t[1]||""}return"\n"+j+e}var V=!1;function F(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),s=r.stack.split("\n"),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||i[a]!==s[o]){var c="\n"+i[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=o);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case x:return"Portal";case T:return"Profiler";case S:return"StrictMode";case R:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=z(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=z(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=W(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function se(e,t){var n=W(t.value),r=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=fe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ve=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,we=null,Se=null;function Te(e){if(e=_i(e)){if("function"!==typeof xe)throw Error(s(280));var t=e.stateNode;t&&(t=bi(t),xe(e.stateNode,e.type,t))}}function Ne(e){we?Se?Se.push(e):Se=[e]:we=e}function Ce(){if(we){var e=we,t=Se;if(Se=we=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Ae(e,t){return e(t)}function Re(){}var Ie=!1;function Oe(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return Ae(e,t,n)}finally{Ie=!1,(null!==we||null!==Se)&&(Re(),Ce())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=bi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var ke=!1;if(d)try{var De={};Object.defineProperty(De,"passive",{get:function(){ke=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(de){ke=!1}function Le(e,t,n,r,i,s,a,o,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(d){this.onError(d)}}var je=!1,Me=null,Ue=!1,Ve=null,Fe={onError:function(e){je=!0,Me=e}};function Be(e,t,n,r,i,s,a,o,c){je=!1,Me=null,Le.apply(Fe,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Ge(e)!==e)throw Error(s(188))}function ze(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return We(i),e;if(a===r)return We(i),t;a=a.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,c=i.child;c;){if(c===n){o=!0,n=i,r=a;break}if(c===r){o=!0,r=i,n=a;break}c=c.sibling}if(!o){for(c=a.child;c;){if(c===n){o=!0,n=a,r=i;break}if(c===r){o=!0,r=a,n=i;break}c=c.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var qe=i.unstable_scheduleCallback,Ye=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,Je=i.unstable_requestPaint,Qe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/ct|0)|0},ot=Math.log,ct=Math.LN2;var lt=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~i;0!==o?r=ut(o):0!==(s&=a)&&(r=ut(s))}else 0!==(a=n&~i)?r=ut(a):0!==s&&(r=ut(s));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&0!==(4194240&s)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-at(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var _t=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,xt,wt,St,Tt,Nt=!1,Ct=[],At=null,Rt=null,It=null,Ot=new Map,Pt=new Map,kt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Rt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function jt(e,t,n,r,i,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},null!==t&&(null!==(t=_i(t))&&xt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Mt(e){var t=yi(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void Tt(e.priority,function(){wt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_i(n))&&xt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ee=r,n.target.dispatchEvent(r),Ee=null,t.shift()}return!0}function Vt(e,t,n){Ut(e)&&n.delete(t)}function Ft(){Nt=!1,null!==At&&Ut(At)&&(At=null),null!==Rt&&Ut(Rt)&&(Rt=null),null!==It&&Ut(It)&&(It=null),Ot.forEach(Vt),Pt.forEach(Vt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Nt||(Nt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ft)))}function Gt(e){function t(t){return Bt(t,e)}if(0<Ct.length){Bt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&Bt(At,e),null!==Rt&&Bt(Rt,e),null!==It&&Bt(It,e),Ot.forEach(t),Pt.forEach(t),n=0;n<kt.length;n++)(r=kt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<kt.length&&null===(n=kt[0]).blockedOn;)Mt(n),null===n.blockedOn&&kt.shift()}var Ht=E.ReactCurrentBatchConfig,Wt=!0;function zt(e,t,n,r){var i=_t,s=Ht.transition;Ht.transition=null;try{_t=1,qt(e,t,n,r)}finally{_t=i,Ht.transition=s}}function Kt(e,t,n,r){var i=_t,s=Ht.transition;Ht.transition=null;try{_t=4,qt(e,t,n,r)}finally{_t=i,Ht.transition=s}}function qt(e,t,n,r){if(Wt){var i=Xt(e,t,n,r);if(null===i)Wr(e,t,r,Yt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=jt(At,e,t,n,r,i),!0;case"dragenter":return Rt=jt(Rt,e,t,n,r,i),!0;case"mouseover":return It=jt(It,e,t,n,r,i),!0;case"pointerover":var s=i.pointerId;return Ot.set(s,jt(Ot.get(s)||null,e,t,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Pt.set(s,jt(Pt.get(s)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Dt.indexOf(e)){for(;null!==i;){var s=_i(i);if(null!==s&&bt(s),null===(s=Xt(e,t,n,r))&&Wr(e,t,r,Yt,n),s===i)break;i=s}null!==i&&r.stopPropagation()}else Wr(e,t,r,null,n)}}var Yt=null;function Xt(e,t,n,r){if(Yt=null,null!==(e=yi(e=be(r))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,i="value"in Qt?Qt.value:Qt.textContent,s=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[s-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,i,s){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=sn(ln),un=M({},ln,{view:0,detail:0}),hn=sn(un),pn=M({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,on=e.screenY-cn.screenY):on=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),mn=sn(pn),fn=sn(M({},pn,{dataTransfer:0})),gn=sn(M({},un,{relatedTarget:0})),vn=sn(M({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=M({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=sn(yn),En=sn(M({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wn[e])&&!!t[e]}function Tn(){return Sn}var Nn=M({},un,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=sn(Nn),An=sn(M({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rn=sn(M({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),In=sn(M({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),On=M({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(On),kn=[9,13,27,32],Dn=d&&"CompositionEvent"in window,Ln=null;d&&"documentMode"in document&&(Ln=document.documentMode);var jn=d&&"TextEvent"in window&&!Ln,Mn=d&&(!Dn||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),Vn=!1;function Fn(e,t){switch(e){case"keyup":return-1!==kn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function zn(e,t,n,r){Ne(r),0<(t=Kr(t,"onChange")).length&&(n=new dn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Kn=null,qn=null;function Yn(e){Ur(e,0)}function Xn(e){if(q(Ei(e)))return e}function Jn(e,t){if("change"===e)return t}var Qn=!1;if(d){var Zn;if(d){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;Qn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Kn&&(Kn.detachEvent("onpropertychange",nr),qn=Kn=null)}function nr(e){if("value"===e.propertyName&&Xn(qn)){var t=[];zn(t,qn,e,be(e)),Oe(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,(Kn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function sr(e,t){if("click"===e)return Xn(t)}function ar(e,t){if("input"===e||"change"===e)return Xn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!u.call(t,i)||!or(e[i],t[i]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function ur(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ur(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ur(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=void 0===r.end?s:Math.min(r.end,i),!e.extend&&s>r&&(i=r,r=s,s=i),i=dr(n,s);var a=dr(n,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=d&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,yr=null,_r=!1;function Er(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_r||null==gr||gr!==Y(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&cr(yr,r)||(yr=r,0<(r=Kr(vr,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function br(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xr={animationend:br("Animation","AnimationEnd"),animationiteration:br("Animation","AnimationIteration"),animationstart:br("Animation","AnimationStart"),transitionend:br("Transition","TransitionEnd")},wr={},Sr={};function Tr(e){if(wr[e])return wr[e];if(!xr[e])return e;var t,n=xr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return wr[e]=n[t];return e}d&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete xr.animationend.animation,delete xr.animationiteration.animation,delete xr.animationstart.animation),"TransitionEvent"in window||delete xr.transitionend.transition);var Nr=Tr("animationend"),Cr=Tr("animationiteration"),Ar=Tr("animationstart"),Rr=Tr("transitionend"),Ir=new Map,Or="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Ir.set(e,t),c(t,[e])}for(var kr=0;kr<Or.length;kr++){var Dr=Or[kr];Pr(Dr.toLowerCase(),"on"+(Dr[0].toUpperCase()+Dr.slice(1)))}Pr(Nr,"onAnimationEnd"),Pr(Cr,"onAnimationIteration"),Pr(Ar,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Rr,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,o,c,l){if(Be.apply(this,arguments),je){if(!je)throw Error(s(198));var d=Me;je=!1,Me=null,Ue||(Ue=!0,Ve=d)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],c=o.instance,l=o.currentTarget;if(o=o.listener,c!==s&&i.isPropagationStopped())break e;Mr(i,o,l),s=c}else for(a=0;a<r.length;a++){if(c=(o=r[a]).instance,l=o.currentTarget,o=o.listener,c!==s&&i.isPropagationStopped())break e;Mr(i,o,l),s=c}}}if(Ue)throw e=Ve,Ue=!1,Ve=null,e}function Vr(e,t){var n=t[fi];void 0===n&&(n=t[fi]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function Fr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Gr(e){if(!e[Br]){e[Br]=!0,a.forEach(function(t){"selectionchange"!==t&&(jr.has(t)||Fr(t,!1,e),Fr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,Fr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Jt(t)){case 1:var i=zt;break;case 4:i=Kt;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,!ke||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Wr(e,t,n,r,i){var s=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;a=a.return}for(;null!==o;){if(null===(a=yi(o)))return;if(5===(c=a.tag)||6===c){r=s=a;continue e}o=o.parentNode}}r=r.return}Oe(function(){var r=s,i=be(n),a=[];e:{var o=Ir.get(e);if(void 0!==o){var c=dn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Cn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Rn;break;case Nr:case Cr:case Ar:c=vn;break;case Rr:c=In;break;case"scroll":c=hn;break;case"wheel":c=Pn;break;case"copy":case"cut":case"paste":c=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=An}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var p,m=r;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=Pe(m,h))&&d.push(zr(m,f,p)))),u)break;m=m.return}0<d.length&&(o=new c(o,l,null,n,i),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Ee||!(l=n.relatedTarget||n.fromElement)||!yi(l)&&!l[mi])&&(c||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?yi(l):null)&&(l!==(u=Ge(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(d=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=An,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==c?o:Ei(c),p=null==l?o:Ei(l),(o=new d(f,m+"leave",c,n,i)).target=u,o.relatedTarget=p,f=null,yi(i)===r&&((d=new d(h,m+"enter",l,n,i)).target=p,d.relatedTarget=u,f=d),u=f,c&&l)e:{for(h=l,m=0,p=d=c;p;p=qr(p))m++;for(p=0,f=h;f;f=qr(f))p++;for(;0<m-p;)d=qr(d),m--;for(;0<p-m;)h=qr(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=qr(d),h=qr(h)}d=null}else d=null;null!==c&&Yr(a,o,c,d,!1),null!==l&&null!==u&&Yr(a,u,l,d,!0)}if("select"===(c=(o=r?Ei(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var g=Jn;else if(Wn(o))if(Qn)g=ar;else{g=ir;var v=rr}else(c=o.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=sr);switch(g&&(g=g(e,r))?zn(a,g,n,i):(v&&v(e,o,r),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=r?Ei(r):window,e){case"focusin":(Wn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,yr=null);break;case"focusout":yr=vr=gr=null;break;case"mousedown":_r=!0;break;case"contextmenu":case"mouseup":case"dragend":_r=!1,Er(a,n,i);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":Er(a,n,i)}var y;if(Dn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Gn?Fn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Mn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Gn&&(y=en()):(Zt="value"in(Qt=i)?Qt.value:Qt.textContent,Gn=!0)),0<(v=Kr(r,_)).length&&(_=new En(_,e,null,n,i),a.push({event:_,listeners:v}),y?_.data=y:null!==(y=Bn(n))&&(_.data=y))),(y=jn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Vn=!0,Un);case"textInput":return(e=t.data)===Un&&Vn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Dn&&Fn(e,t)?(e=en(),$t=Zt=Qt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Kr(r,"onBeforeInput")).length&&(i=new En("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=y))}Ur(a,t)})}function zr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Kr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Pe(e,n))&&r.unshift(zr(e,s,i)),null!=(s=Pe(e,t))&&r.push(zr(e,s,i))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,i){for(var s=t._reactName,a=[];null!==n&&n!==r;){var o=n,c=o.alternate,l=o.stateNode;if(null!==c&&c===r)break;5===o.tag&&null!==l&&(o=l,i?null!=(c=Pe(n,s))&&a.unshift(zr(n,c,o)):i||null!=(c=Pe(n,s))&&a.push(zr(n,c,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Xr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Jr,"")}function Zr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(s(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,si="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof si?function(e){return si.resolve(null).then(e).catch(oi)}:ri;function oi(e){setTimeout(function(){throw e})}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Gt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Gt(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function di(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ui=Math.random().toString(36).slice(2),hi="__reactFiber$"+ui,pi="__reactProps$"+ui,mi="__reactContainer$"+ui,fi="__reactEvents$"+ui,gi="__reactListeners$"+ui,vi="__reactHandles$"+ui;function yi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=di(e);null!==e;){if(n=e[hi])return n;e=di(e)}return t}n=(e=n).parentNode}return null}function _i(e){return!(e=e[hi]||e[mi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ei(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function bi(e){return e[pi]||null}var xi=[],wi=-1;function Si(e){return{current:e}}function Ti(e){0>wi||(e.current=xi[wi],xi[wi]=null,wi--)}function Ni(e,t){wi++,xi[wi]=e.current,e.current=t}var Ci={},Ai=Si(Ci),Ri=Si(!1),Ii=Ci;function Oi(e,t){var n=e.type.contextTypes;if(!n)return Ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function ki(){Ti(Ri),Ti(Ai)}function Di(e,t,n){if(Ai.current!==Ci)throw Error(s(168));Ni(Ai,t),Ni(Ri,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(s(108,H(e)||"Unknown",i));return M({},n,r)}function ji(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Ii=Ai.current,Ni(Ai,e),Ni(Ri,Ri.current),!0}function Mi(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=Li(e,t,Ii),r.__reactInternalMemoizedMergedChildContext=e,Ti(Ri),Ti(Ai),Ni(Ai,e)):Ti(Ri),Ni(Ri,n)}var Ui=null,Vi=!1,Fi=!1;function Bi(e){null===Ui?Ui=[e]:Ui.push(e)}function Gi(){if(!Fi&&null!==Ui){Fi=!0;var e=0,t=_t;try{var n=Ui;for(_t=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Vi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(e+1)),qe($e,Gi),i}finally{_t=t,Fi=!1}}return null}var Hi=[],Wi=0,zi=null,Ki=0,qi=[],Yi=0,Xi=null,Ji=1,Qi="";function Zi(e,t){Hi[Wi++]=Ki,Hi[Wi++]=zi,zi=e,Ki=t}function $i(e,t,n){qi[Yi++]=Ji,qi[Yi++]=Qi,qi[Yi++]=Xi,Xi=e;var r=Ji;e=Qi;var i=32-at(r)-1;r&=~(1<<i),n+=1;var s=32-at(t)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Ji=1<<32-at(t)+i|n<<i|r,Qi=s+e}else Ji=1<<s|n<<i|r,Qi=e}function es(e){null!==e.return&&(Zi(e,1),$i(e,1,0))}function ts(e){for(;e===zi;)zi=Hi[--Wi],Hi[Wi]=null,Ki=Hi[--Wi],Hi[Wi]=null;for(;e===Xi;)Xi=qi[--Yi],qi[Yi]=null,Qi=qi[--Yi],qi[Yi]=null,Ji=qi[--Yi],qi[Yi]=null}var ns=null,rs=null,is=!1,ss=null;function as(e,t){var n=Pl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function os(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,rs=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,rs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:Ji,overflow:Qi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Pl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,rs=null,!0);default:return!1}}function cs(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ls(e){if(is){var t=rs;if(t){var n=t;if(!os(e,t)){if(cs(e))throw Error(s(418));t=li(n.nextSibling);var r=ns;t&&os(e,t)?as(r,n):(e.flags=-4097&e.flags|2,is=!1,ns=e)}}else{if(cs(e))throw Error(s(418));e.flags=-4097&e.flags|2,is=!1,ns=e}}}function ds(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function us(e){if(e!==ns)return!1;if(!is)return ds(e),is=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=rs)){if(cs(e))throw hs(),Error(s(418));for(;t;)as(e,t),t=li(t.nextSibling)}if(ds(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){rs=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}rs=null}}else rs=ns?li(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=rs;e;)e=li(e.nextSibling)}function ps(){rs=ns=null,is=!1}function ms(e){null===ss?ss=[e]:ss.push(e)}var fs=E.ReactCurrentBatchConfig;function gs(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var vs=Si(null),ys=null,_s=null,Es=null;function bs(){Es=_s=ys=null}function xs(e){var t=vs.current;Ti(vs),e._currentValue=t}function ws(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ss(e,t){ys=e,Es=_s=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Eo=!0),e.firstContext=null)}function Ts(e){var t=e._currentValue;if(Es!==e)if(e={context:e,memoizedValue:t,next:null},null===_s){if(null===ys)throw Error(s(308));_s=e,ys.dependencies={lanes:0,firstContext:e}}else _s=_s.next=e;return t}var Ns=null;function Cs(e){null===Ns?Ns=[e]:Ns.push(e)}function As(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Cs(t)):(n.next=i.next,i.next=n),t.interleaved=n,Rs(e,r)}function Rs(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Is=!1;function Os(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ps(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ks(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ds(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Rc)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Rs(e,n)}return null===(i=r.interleaved)?(t.next=t,Cs(r)):(t.next=i.next,i.next=t),r.interleaved=t,Rs(e,n)}function Ls(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function js(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ms(e,t,n,r){var i=e.updateQueue;Is=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var c=o,l=c.next;c.next=null,null===a?s=l:a.next=l,a=c;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=l:o.next=l,d.lastBaseUpdate=c))}if(null!==s){var u=i.baseState;for(a=0,d=l=c=null,o=s;;){var h=o.lane,p=o.eventTime;if((r&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,f=o;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=M({},u,h);break e;case 2:Is=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,a|=h;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(h=o).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===d&&(c=u),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===s&&(i.shared.lanes=0);Mc|=a,e.lanes=a,e.memoizedState=u}}function Us(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var Vs=(new r.Component).refs;function Fs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Bs={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tl(),i=nl(e),s=ks(r,i);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Ds(e,s,i))&&(rl(t,e,i,r),Ls(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tl(),i=nl(e),s=ks(r,i);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Ds(e,s,i))&&(rl(t,e,i,r),Ls(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),r=nl(e),i=ks(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Ds(e,i,r))&&(rl(t,e,r,n),Ls(t,e,r))}};function Gs(e,t,n,r,i,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,s))}function Hs(e,t,n){var r=!1,i=Ci,s=t.contextType;return"object"===typeof s&&null!==s?s=Ts(s):(i=Pi(t)?Ii:Ai.current,s=(r=null!==(r=t.contextTypes)&&void 0!==r)?Oi(e,i):Ci),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Bs,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function Ws(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Bs.enqueueReplaceState(t,t.state,null)}function zs(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Vs,Os(e);var s=t.contextType;"object"===typeof s&&null!==s?i.context=Ts(s):(s=Pi(t)?Ii:Ai.current,i.context=Oi(e,s)),i.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(Fs(e,t,s,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Bs.enqueueReplaceState(i,i.state,null),Ms(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Ks(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;t===Vs&&(t=i.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function qs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ys(e){return(0,e._init)(e._payload)}function Xs(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Dl(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Ul(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var s=n.type;return s===w?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===P&&Ys(s)===t.type)?((r=i(t,n.props)).ref=Ks(e,t,n),r.return=e,r):((r=Ll(n.type,n.key,n.props,null,e.mode,r)).ref=Ks(e,t,n),r.return=e,r)}function d(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,r,s){return null===t||7!==t.tag?((t=jl(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ul(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Ll(t.type,t.key,t.props,null,e.mode,n)).ref=Ks(e,null,t),n.return=e,n;case x:return(t=Vl(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=jl(t,e.mode,n,null)).return=e,t;qs(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?l(e,t,n,r):null;case x:return n.key===i?d(e,t,n,r):null;case P:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:u(e,t,n,r,null);qs(e,n)}return null}function m(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case x:return d(t,e=e.get(null===r.key?n:r.key)||null,r,i);case P:return m(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return u(t,e=e.get(n)||null,r,i,null);qs(t,r)}return null}function f(i,s,o,c){for(var l=null,d=null,u=s,f=s=0,g=null;null!==u&&f<o.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var v=p(i,u,o[f],c);if(null===v){null===u&&(u=g);break}e&&u&&null===v.alternate&&t(i,u),s=a(v,s,f),null===d?l=v:d.sibling=v,d=v,u=g}if(f===o.length)return n(i,u),is&&Zi(i,f),l;if(null===u){for(;f<o.length;f++)null!==(u=h(i,o[f],c))&&(s=a(u,s,f),null===d?l=u:d.sibling=u,d=u);return is&&Zi(i,f),l}for(u=r(i,u);f<o.length;f++)null!==(g=m(u,i,f,o[f],c))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),s=a(g,s,f),null===d?l=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(i,e)}),is&&Zi(i,f),l}function g(i,o,c,l){var d=L(c);if("function"!==typeof d)throw Error(s(150));if(null==(c=d.call(c)))throw Error(s(151));for(var u=d=null,f=o,g=o=0,v=null,y=c.next();null!==f&&!y.done;g++,y=c.next()){f.index>g?(v=f,f=null):v=f.sibling;var _=p(i,f,y.value,l);if(null===_){null===f&&(f=v);break}e&&f&&null===_.alternate&&t(i,f),o=a(_,o,g),null===u?d=_:u.sibling=_,u=_,f=v}if(y.done)return n(i,f),is&&Zi(i,g),d;if(null===f){for(;!y.done;g++,y=c.next())null!==(y=h(i,y.value,l))&&(o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return is&&Zi(i,g),d}for(f=r(i,f);!y.done;g++,y=c.next())null!==(y=m(f,i,g,y.value,l))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return e&&f.forEach(function(e){return t(i,e)}),is&&Zi(i,g),d}return function e(r,s,a,c){if("object"===typeof a&&null!==a&&a.type===w&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case b:e:{for(var l=a.key,d=s;null!==d;){if(d.key===l){if((l=a.type)===w){if(7===d.tag){n(r,d.sibling),(s=i(d,a.props.children)).return=r,r=s;break e}}else if(d.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===P&&Ys(l)===d.type){n(r,d.sibling),(s=i(d,a.props)).ref=Ks(r,d,a),s.return=r,r=s;break e}n(r,d);break}t(r,d),d=d.sibling}a.type===w?((s=jl(a.props.children,r.mode,c,a.key)).return=r,r=s):((c=Ll(a.type,a.key,a.props,null,r.mode,c)).ref=Ks(r,s,a),c.return=r,r=c)}return o(r);case x:e:{for(d=a.key;null!==s;){if(s.key===d){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(r,s.sibling),(s=i(s,a.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=Vl(a,r.mode,c)).return=r,r=s}return o(r);case P:return e(r,s,(d=a._init)(a._payload),c)}if(te(a))return f(r,s,a,c);if(L(a))return g(r,s,a,c);qs(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,a)).return=r,r=s):(n(r,s),(s=Ul(a,r.mode,c)).return=r,r=s),o(r)):n(r,s)}}var Js=Xs(!0),Qs=Xs(!1),Zs={},$s=Si(Zs),ea=Si(Zs),ta=Si(Zs);function na(e){if(e===Zs)throw Error(s(174));return e}function ra(e,t){switch(Ni(ta,t),Ni(ea,e),Ni($s,Zs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ti($s),Ni($s,t)}function ia(){Ti($s),Ti(ea),Ti(ta)}function sa(e){na(ta.current);var t=na($s.current),n=ce(t,e.type);t!==n&&(Ni(ea,e),Ni($s,n))}function aa(e){ea.current===e&&(Ti($s),Ti(ea))}var oa=Si(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var la=[];function da(){for(var e=0;e<la.length;e++)la[e]._workInProgressVersionPrimary=null;la.length=0}var ua=E.ReactCurrentDispatcher,ha=E.ReactCurrentBatchConfig,pa=0,ma=null,fa=null,ga=null,va=!1,ya=!1,_a=0,Ea=0;function ba(){throw Error(s(321))}function xa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function wa(e,t,n,r,i,a){if(pa=a,ma=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ua.current=null===e||null===e.memoizedState?ao:oo,e=n(r,i),ya){a=0;do{if(ya=!1,_a=0,25<=a)throw Error(s(301));a+=1,ga=fa=null,t.updateQueue=null,ua.current=co,e=n(r,i)}while(ya)}if(ua.current=so,t=null!==fa&&null!==fa.next,pa=0,ga=fa=ma=null,va=!1,t)throw Error(s(300));return e}function Sa(){var e=0!==_a;return _a=0,e}function Ta(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ga?ma.memoizedState=ga=e:ga=ga.next=e,ga}function Na(){if(null===fa){var e=ma.alternate;e=null!==e?e.memoizedState:null}else e=fa.next;var t=null===ga?ma.memoizedState:ga.next;if(null!==t)ga=t,fa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(fa=e).memoizedState,baseState:fa.baseState,baseQueue:fa.baseQueue,queue:fa.queue,next:null},null===ga?ma.memoizedState=ga=e:ga=ga.next=e}return ga}function Ca(e,t){return"function"===typeof t?t(e):t}function Aa(e){var t=Na(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=fa,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var c=o=null,l=null,d=a;do{var u=d.lane;if((pa&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===l?(c=l=h,o=r):l=l.next=h,ma.lanes|=u,Mc|=u}d=d.next}while(null!==d&&d!==a);null===l?o=r:l.next=c,or(r,t.memoizedState)||(Eo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,ma.lanes|=a,Mc|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ra(e){var t=Na(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);or(a,t.memoizedState)||(Eo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ia(){}function Oa(e,t){var n=ma,r=Na(),i=t(),a=!or(r.memoizedState,i);if(a&&(r.memoizedState=i,Eo=!0),r=r.queue,Ha(Da.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==ga&&1&ga.memoizedState.tag){if(n.flags|=2048,Ua(9,ka.bind(null,n,r,i,t),void 0,null),null===Ic)throw Error(s(349));0!==(30&pa)||Pa(n,t,i)}return i}function Pa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ka(e,t,n,r){t.value=n,t.getSnapshot=r,La(t)&&ja(e)}function Da(e,t,n){return n(function(){La(t)&&ja(e)})}function La(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function ja(e){var t=Rs(e,1);null!==t&&rl(t,e,1,-1)}function Ma(e){var t=Ta();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:e},t.queue=e,e=e.dispatch=to.bind(null,ma,e),[t.memoizedState,e]}function Ua(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Va(){return Na().memoizedState}function Fa(e,t,n,r){var i=Ta();ma.flags|=e,i.memoizedState=Ua(1|t,n,void 0,void 0===r?null:r)}function Ba(e,t,n,r){var i=Na();r=void 0===r?null:r;var s=void 0;if(null!==fa){var a=fa.memoizedState;if(s=a.destroy,null!==r&&xa(r,a.deps))return void(i.memoizedState=Ua(t,n,s,r))}ma.flags|=e,i.memoizedState=Ua(1|t,n,s,r)}function Ga(e,t){return Fa(8390656,8,e,t)}function Ha(e,t){return Ba(2048,8,e,t)}function Wa(e,t){return Ba(4,2,e,t)}function za(e,t){return Ba(4,4,e,t)}function Ka(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ba(4,4,Ka.bind(null,t,e),n)}function Ya(){}function Xa(e,t){var n=Na();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&xa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ja(e,t){var n=Na();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&xa(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Qa(e,t,n){return 0===(21&pa)?(e.baseState&&(e.baseState=!1,Eo=!0),e.memoizedState=n):(or(n,t)||(n=ft(),ma.lanes|=n,Mc|=n,e.baseState=!0),t)}function Za(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var r=ha.transition;ha.transition={};try{e(!1),t()}finally{_t=n,ha.transition=r}}function $a(){return Na().memoizedState}function eo(e,t,n){var r=nl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},no(e))ro(t,n);else if(null!==(n=As(e,t,n,r))){rl(n,e,r,tl()),io(n,t,r)}}function to(e,t,n){var r=nl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(no(e))ro(t,i);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,or(o,a)){var c=t.interleaved;return null===c?(i.next=i,Cs(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(l){}null!==(n=As(e,t,i,r))&&(rl(n,e,r,i=tl()),io(n,t,r))}}function no(e){var t=e.alternate;return e===ma||null!==t&&t===ma}function ro(e,t){ya=va=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function io(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var so={readContext:Ts,useCallback:ba,useContext:ba,useEffect:ba,useImperativeHandle:ba,useInsertionEffect:ba,useLayoutEffect:ba,useMemo:ba,useReducer:ba,useRef:ba,useState:ba,useDebugValue:ba,useDeferredValue:ba,useTransition:ba,useMutableSource:ba,useSyncExternalStore:ba,useId:ba,unstable_isNewReconciler:!1},ao={readContext:Ts,useCallback:function(e,t){return Ta().memoizedState=[e,void 0===t?null:t],e},useContext:Ts,useEffect:Ga,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Fa(4194308,4,Ka.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Fa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Fa(4,2,e,t)},useMemo:function(e,t){var n=Ta();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ta();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=eo.bind(null,ma,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ta().memoizedState=e},useState:Ma,useDebugValue:Ya,useDeferredValue:function(e){return Ta().memoizedState=e},useTransition:function(){var e=Ma(!1),t=e[0];return e=Za.bind(null,e[1]),Ta().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ma,i=Ta();if(is){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Ic)throw Error(s(349));0!==(30&pa)||Pa(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Ga(Da.bind(null,r,a,e),[e]),r.flags|=2048,Ua(9,ka.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Ta(),t=Ic.identifierPrefix;if(is){var n=Qi;t=":"+t+"R"+(n=(Ji&~(1<<32-at(Ji)-1)).toString(32)+n),0<(n=_a++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ea++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},oo={readContext:Ts,useCallback:Xa,useContext:Ts,useEffect:Ha,useImperativeHandle:qa,useInsertionEffect:Wa,useLayoutEffect:za,useMemo:Ja,useReducer:Aa,useRef:Va,useState:function(){return Aa(Ca)},useDebugValue:Ya,useDeferredValue:function(e){return Qa(Na(),fa.memoizedState,e)},useTransition:function(){return[Aa(Ca)[0],Na().memoizedState]},useMutableSource:Ia,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1},co={readContext:Ts,useCallback:Xa,useContext:Ts,useEffect:Ha,useImperativeHandle:qa,useInsertionEffect:Wa,useLayoutEffect:za,useMemo:Ja,useReducer:Ra,useRef:Va,useState:function(){return Ra(Ca)},useDebugValue:Ya,useDeferredValue:function(e){var t=Na();return null===fa?t.memoizedState=e:Qa(t,fa.memoizedState,e)},useTransition:function(){return[Ra(Ca)[0],Na().memoizedState]},useMutableSource:Ia,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1};function lo(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var i=n}catch(s){i="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:i,digest:null}}function uo(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ho(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var po="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,n){(n=ks(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){zc||(zc=!0,Kc=r),ho(0,t)},n}function fo(e,t,n){(n=ks(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ho(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){ho(0,t),"function"!==typeof r&&(null===qc?qc=new Set([this]):qc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function go(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new po;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Nl.bind(null,e,t,n),t.then(e,e))}function vo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function yo(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=ks(-1,1)).tag=2,Ds(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var _o=E.ReactCurrentOwner,Eo=!1;function bo(e,t,n,r){t.child=null===e?Qs(t,null,n,r):Js(t,e.child,n,r)}function xo(e,t,n,r,i){n=n.render;var s=t.ref;return Ss(t,i),r=wa(e,t,n,r,s,i),n=Sa(),null===e||Eo?(is&&n&&es(t),t.flags|=1,bo(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,zo(e,t,i))}function wo(e,t,n,r,i){if(null===e){var s=n.type;return"function"!==typeof s||kl(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ll(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,So(e,t,s,r,i))}if(s=e.child,0===(e.lanes&i)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(a,r)&&e.ref===t.ref)return zo(e,t,i)}return t.flags|=1,(e=Dl(s,r)).ref=t.ref,e.return=t,t.child=e}function So(e,t,n,r,i){if(null!==e){var s=e.memoizedProps;if(cr(s,r)&&e.ref===t.ref){if(Eo=!1,t.pendingProps=r=s,0===(e.lanes&i))return t.lanes=e.lanes,zo(e,t,i);0!==(131072&e.flags)&&(Eo=!0)}}return Co(e,t,n,r,i)}function To(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ni(Dc,kc),kc|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ni(Dc,kc),kc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,Ni(Dc,kc),kc|=r}else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,Ni(Dc,kc),kc|=r;return bo(e,t,i,n),t.child}function No(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,n,r,i){var s=Pi(n)?Ii:Ai.current;return s=Oi(t,s),Ss(t,i),n=wa(e,t,n,r,s,i),r=Sa(),null===e||Eo?(is&&r&&es(t),t.flags|=1,bo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,zo(e,t,i))}function Ao(e,t,n,r,i){if(Pi(n)){var s=!0;ji(t)}else s=!1;if(Ss(t,i),null===t.stateNode)Wo(e,t),Hs(t,n,r),zs(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var c=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ts(l):l=Oi(t,l=Pi(n)?Ii:Ai.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==r||c!==l)&&Ws(t,a,r,l),Is=!1;var h=t.memoizedState;a.state=h,Ms(t,r,a,i),c=t.memoizedState,o!==r||h!==c||Ri.current||Is?("function"===typeof d&&(Fs(t,n,d,r),c=t.memoizedState),(o=Is||Gs(t,n,o,r,h,c,l))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=l,r=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Ps(e,t),o=t.memoizedProps,l=t.type===t.elementType?o:gs(t.type,o),a.props=l,u=t.pendingProps,h=a.context,"object"===typeof(c=n.contextType)&&null!==c?c=Ts(c):c=Oi(t,c=Pi(n)?Ii:Ai.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==c)&&Ws(t,a,r,c),Is=!1,h=t.memoizedState,a.state=h,Ms(t,r,a,i);var m=t.memoizedState;o!==u||h!==m||Ri.current||Is?("function"===typeof p&&(Fs(t,n,p,r),m=t.memoizedState),(l=Is||Gs(t,n,l,r,h,m,c)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,m,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,m,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),a.props=r,a.state=m,a.context=c,r=l):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ro(e,t,n,r,s,i)}function Ro(e,t,n,r,i,s){No(e,t);var a=0!==(128&t.flags);if(!r&&!a)return i&&Mi(t,n,!1),zo(e,t,s);r=t.stateNode,_o.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=Js(t,e.child,null,s),t.child=Js(t,null,o,s)):bo(e,t,o,s),t.memoizedState=r.state,i&&Mi(t,n,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Di(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Di(0,t.context,!1),ra(e,t.containerInfo)}function Oo(e,t,n,r,i){return ps(),ms(i),t.flags|=256,bo(e,t,n,r),t.child}var Po,ko,Do,Lo,jo={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,n){var r,i=t.pendingProps,a=oa.current,o=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ni(oa,1&a),null===e)return ls(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,o?(i=t.mode,o=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=c):o=Ml(c,i,0,null),e=jl(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(n),t.memoizedState=jo,e):Vo(t,c));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,i,a,o){if(n)return 256&t.flags?(t.flags&=-257,Fo(e,t,o,r=uo(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=Ml({mode:"visible",children:r.children},i,0,null),(a=jl(a,i,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&Js(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=jo,a);if(0===(1&t.mode))return Fo(e,t,o,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,Fo(e,t,o,r=uo(a=Error(s(419)),r,void 0))}if(c=0!==(o&e.childLanes),Eo||c){if(null!==(r=Ic)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|o))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Rs(e,i),rl(r,e,i,-1))}return gl(),Fo(e,t,o,r=uo(Error(s(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Al.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,rs=li(i.nextSibling),ns=t,is=!0,ss=null,null!==e&&(qi[Yi++]=Ji,qi[Yi++]=Qi,qi[Yi++]=Xi,Ji=e.id,Qi=e.overflow,Xi=t),t=Vo(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,a,n);if(o){o=i.fallback,c=t.mode,r=(a=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Dl(a,l)).subtreeFlags=14680064&a.subtreeFlags,null!==r?o=Dl(r,o):(o=jl(o,c,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,c=null===(c=e.child.memoizedState)?Mo(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},o.memoizedState=c,o.childLanes=e.childLanes&~n,t.memoizedState=jo,i}return e=(o=e.child).sibling,i=Dl(o,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Vo(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fo(e,t,n,r){return null!==r&&ms(r),Js(t,e.child,null,n),(e=Vo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),ws(e.return,t,n)}function Go(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Ho(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(bo(e,t,r.children,n),0!==(2&(r=oa.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bo(e,n,t);else if(19===e.tag)Bo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ni(oa,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Go(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ca(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Go(t,!0,n,null,s);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Wo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function zo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Dl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ko(e,t){if(!is)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Yo(e,t,n){var r=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:case 17:return Pi(t.type)&&ki(),qo(t),null;case 3:return r=t.stateNode,ia(),Ti(Ri),Ti(Ai),da(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(us(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ol(ss),ss=null))),ko(e,t),qo(t),null;case 5:aa(t);var i=na(ta.current);if(n=t.type,null!==e&&null!=t.stateNode)Do(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return qo(t),null}if(e=na($s.current),us(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[hi]=t,r[pi]=a,e=0!==(1&t.mode),n){case"dialog":Vr("cancel",r),Vr("close",r);break;case"iframe":case"object":case"embed":Vr("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)Vr(Lr[i],r);break;case"source":Vr("error",r);break;case"img":case"image":case"link":Vr("error",r),Vr("load",r);break;case"details":Vr("toggle",r);break;case"input":J(r,a),Vr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Vr("invalid",r);break;case"textarea":ie(r,a),Vr("invalid",r)}for(var c in ye(n,a),i=null,a)if(a.hasOwnProperty(c)){var l=a[c];"children"===c?"string"===typeof l?r.textContent!==l&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,l,e),i=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,l,e),i=["children",""+l]):o.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Vr("scroll",r)}switch(n){case"input":K(r),$(r,a,!0);break;case"textarea":K(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[hi]=t,e[pi]=r,Po(e,t,!1,!1),t.stateNode=e;e:{switch(c=_e(n,r),n){case"dialog":Vr("cancel",e),Vr("close",e),i=r;break;case"iframe":case"object":case"embed":Vr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)Vr(Lr[i],e);i=r;break;case"source":Vr("error",e),i=r;break;case"img":case"image":case"link":Vr("error",e),Vr("load",e),i=r;break;case"details":Vr("toggle",e),i=r;break;case"input":J(e,r),i=X(e,r),Vr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=M({},r,{value:void 0}),Vr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Vr("invalid",e)}for(a in ye(n,i),l=i)if(l.hasOwnProperty(a)){var d=l[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Vr("scroll",e):null!=d&&_(e,a,d,c))}switch(n){case"input":K(e),$(e,r,!1);break;case"textarea":K(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+W(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&null!=t.stateNode)Lo(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(n=na(ta.current),na($s.current),us(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(a=r.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return qo(t),null;case 13:if(Ti(oa),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(is&&null!==rs&&0!==(1&t.mode)&&0===(128&t.flags))hs(),ps(),t.flags|=98560,a=!1;else if(a=us(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[hi]=t}else ps(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qo(t),a=!1}else null!==ss&&(ol(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&oa.current)?0===Lc&&(Lc=3):gl())),null!==t.updateQueue&&(t.flags|=4),qo(t),null);case 4:return ia(),ko(e,t),null===e&&Gr(t.stateNode.containerInfo),qo(t),null;case 10:return xs(t.type._context),qo(t),null;case 19:if(Ti(oa),null===(a=t.memoizedState))return qo(t),null;if(r=0!==(128&t.flags),null===(c=a.rendering))if(r)Ko(a,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ca(e))){for(t.flags|=128,Ko(a,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ni(oa,1&oa.current|2),t.child}e=e.sibling}null!==a.tail&&Qe()>Hc&&(t.flags|=128,r=!0,Ko(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ca(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ko(a,!0),null===a.tail&&"hidden"===a.tailMode&&!c.alternate&&!is)return qo(t),null}else 2*Qe()-a.renderingStartTime>Hc&&1073741824!==n&&(t.flags|=128,r=!0,Ko(a,!1),t.lanes=4194304);a.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=a.last)?n.sibling=c:t.child=c,a.last=c)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Qe(),t.sibling=null,n=oa.current,Ni(oa,r?1&n|2:1&n),t):(qo(t),null);case 22:case 23:return hl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&kc)&&(qo(t),6&t.subtreeFlags&&(t.flags|=8192)):qo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Xo(e,t){switch(ts(t),t.tag){case 1:return Pi(t.type)&&ki(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ia(),Ti(Ri),Ti(Ai),da(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return aa(t),null;case 13:if(Ti(oa),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ti(oa),null;case 4:return ia(),null;case 10:return xs(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Po=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ko=function(){},Do=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,na($s.current);var s,a=null;switch(n){case"input":i=X(e,i),r=X(e,r),a=[];break;case"select":i=M({},i,{value:void 0}),r=M({},r,{value:void 0}),a=[];break;case"textarea":i=re(e,i),r=re(e,r),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(d in ye(n,r),n=null,i)if(!r.hasOwnProperty(d)&&i.hasOwnProperty(d)&&null!=i[d])if("style"===d){var c=i[d];for(s in c)c.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var l=r[d];if(c=null!=i?i[d]:void 0,r.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(s in c)!c.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&c[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(a||(a=[]),a.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Vr("scroll",e),a||c===l||(a=[])):(a=a||[]).push(d,l))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Lo=function(e,t,n,r){n!==r&&(t.flags|=4)};var Jo=!1,Qo=!1,Zo="function"===typeof WeakSet?WeakSet:Set,$o=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Tl(e,t,r)}else n.current=null}function tc(e,t,n){try{n()}catch(r){Tl(e,t,r)}}var nc=!1;function rc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&tc(t,n,s)}i=i.next}while(i!==r)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function sc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ac(e){var t=e.alternate;null!==t&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[fi],delete t[gi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}function dc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(dc(e,t,n),e=e.sibling;null!==e;)dc(e,t,n),e=e.sibling}var uc=null,hc=!1;function pc(e,t,n){for(n=n.child;null!==n;)mc(e,t,n),n=n.sibling}function mc(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(it,n)}catch(o){}switch(n.tag){case 5:Qo||ec(n,t);case 6:var r=uc,i=hc;uc=null,pc(e,t,n),hc=i,null!==(uc=r)&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Gt(e)):ci(uc,n.stateNode));break;case 4:r=uc,i=hc,uc=n.stateNode.containerInfo,hc=!0,pc(e,t,n),uc=r,hc=i;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&tc(n,t,a),i=i.next}while(i!==r)}pc(e,t,n);break;case 1:if(!Qo&&(ec(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){Tl(n,t,o)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Qo=(r=Qo)||null!==n.memoizedState,pc(e,t,n),Qo=r):pc(e,t,n);break;default:pc(e,t,n)}}function fc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zo),t.forEach(function(t){var r=Rl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function gc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,o=t,c=o;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,hc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===uc)throw Error(s(160));mc(a,o,i),uc=null,hc=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(d){Tl(i,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vc(t,e),t=t.sibling}function vc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),yc(e),4&r){try{rc(3,e,e.return),ic(3,e)}catch(g){Tl(e,e.return,g)}try{rc(5,e,e.return)}catch(g){Tl(e,e.return,g)}}break;case 1:gc(t,e),yc(e),512&r&&null!==n&&ec(n,n.return);break;case 5:if(gc(t,e),yc(e),512&r&&null!==n&&ec(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){Tl(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&Q(i,a),_e(c,o);var d=_e(c,a);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];"style"===u?ge(i,h):"dangerouslySetInnerHTML"===u?ue(i,h):"children"===u?he(i,h):_(i,u,h,d)}switch(c){case"input":Z(i,a);break;case"textarea":se(i,a);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ne(i,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(i,!!a.multiple,a.defaultValue,!0):ne(i,!!a.multiple,a.multiple?[]:"",!1))}i[pi]=a}catch(g){Tl(e,e.return,g)}}break;case 6:if(gc(t,e),yc(e),4&r){if(null===e.stateNode)throw Error(s(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(g){Tl(e,e.return,g)}}break;case 3:if(gc(t,e),yc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){Tl(e,e.return,g)}break;case 4:default:gc(t,e),yc(e);break;case 13:gc(t,e),yc(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Gc=Qe())),4&r&&fc(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Qo=(d=Qo)||u,gc(t,e),Qo=d):gc(t,e),yc(e),8192&r){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for($o=e,u=e.child;null!==u;){for(h=$o=u;null!==$o;){switch(m=(p=$o).child,p.tag){case 0:case 11:case 14:case 15:rc(4,p,p.return);break;case 1:ec(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){r=p,n=p.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Tl(r,n,g)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){xc(h);continue}}null!==m?(m.return=p,$o=m):xc(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{i=h.stateNode,d?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,o=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",o))}catch(g){Tl(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Tl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gc(t,e),yc(e),4&r&&fc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(oc(n)){var r=n;break e}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),dc(e,cc(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;lc(e,cc(e),a);break;default:throw Error(s(161))}}catch(o){Tl(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _c(e,t,n){$o=e,Ec(e,t,n)}function Ec(e,t,n){for(var r=0!==(1&e.mode);null!==$o;){var i=$o,s=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Jo;if(!a){var o=i.alternate,c=null!==o&&null!==o.memoizedState||Qo;o=Jo;var l=Qo;if(Jo=a,(Qo=c)&&!l)for($o=i;null!==$o;)c=(a=$o).child,22===a.tag&&null!==a.memoizedState?wc(i):null!==c?(c.return=a,$o=c):wc(i);for(;null!==s;)$o=s,Ec(s,t,n),s=s.sibling;$o=i,Jo=o,Qo=l}bc(e)}else 0!==(8772&i.subtreeFlags)&&null!==s?(s.return=i,$o=s):bc(e)}}function bc(e){for(;null!==$o;){var t=$o;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||ic(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qo)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:gs(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Us(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Us(t,o,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(s(163))}Qo||512&t.flags&&sc(t)}catch(p){Tl(t,t.return,p)}}if(t===e){$o=null;break}if(null!==(n=t.sibling)){n.return=t.return,$o=n;break}$o=t.return}}function xc(e){for(;null!==$o;){var t=$o;if(t===e){$o=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$o=n;break}$o=t.return}}function wc(e){for(;null!==$o;){var t=$o;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(c){Tl(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(c){Tl(t,i,c)}}var s=t.return;try{sc(t)}catch(c){Tl(t,s,c)}break;case 5:var a=t.return;try{sc(t)}catch(c){Tl(t,a,c)}}}catch(c){Tl(t,t.return,c)}if(t===e){$o=null;break}var o=t.sibling;if(null!==o){o.return=t.return,$o=o;break}$o=t.return}}var Sc,Tc=Math.ceil,Nc=E.ReactCurrentDispatcher,Cc=E.ReactCurrentOwner,Ac=E.ReactCurrentBatchConfig,Rc=0,Ic=null,Oc=null,Pc=0,kc=0,Dc=Si(0),Lc=0,jc=null,Mc=0,Uc=0,Vc=0,Fc=null,Bc=null,Gc=0,Hc=1/0,Wc=null,zc=!1,Kc=null,qc=null,Yc=!1,Xc=null,Jc=0,Qc=0,Zc=null,$c=-1,el=0;function tl(){return 0!==(6&Rc)?Qe():-1!==$c?$c:$c=Qe()}function nl(e){return 0===(1&e.mode)?1:0!==(2&Rc)&&0!==Pc?Pc&-Pc:null!==fs.transition?(0===el&&(el=ft()),el):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function rl(e,t,n,r){if(50<Qc)throw Qc=0,Zc=null,Error(s(185));vt(e,n,r),0!==(2&Rc)&&e===Ic||(e===Ic&&(0===(2&Rc)&&(Uc|=n),4===Lc&&cl(e,Pc)),il(e,r),1===n&&0===Rc&&0===(1&t.mode)&&(Hc=Qe()+500,Vi&&Gi()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,c=i[a];-1===c?0!==(o&n)&&0===(o&r)||(i[a]=pt(o,t)):c<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var r=ht(e,e===Ic?Pc:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Vi=!0,Bi(e)}(ll.bind(null,e)):Bi(ll.bind(null,e)),ai(function(){0===(6&Rc)&&Gi()}),n=null;else{switch(Et(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Il(n,sl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sl(e,t){if($c=-1,el=0,0!==(6&Rc))throw Error(s(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var r=ht(e,e===Ic?Pc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=vl(e,r);else{t=r;var i=Rc;Rc|=2;var a=fl();for(Ic===e&&Pc===t||(Wc=null,Hc=Qe()+500,pl(e,t));;)try{_l();break}catch(c){ml(e,c)}bs(),Nc.current=a,Rc=i,null!==Oc?t=0:(Ic=null,Pc=0,t=Lc)}if(0!==t){if(2===t&&(0!==(i=mt(e))&&(r=i,t=al(e,i))),1===t)throw n=jc,pl(e,0),cl(e,r),il(e,Qe()),n;if(6===t)cl(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!or(s(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=vl(e,r))&&(0!==(a=mt(e))&&(r=a,t=al(e,a))),1===t))throw n=jc,pl(e,0),cl(e,r),il(e,Qe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:xl(e,Bc,Wc);break;case 3:if(cl(e,r),(130023424&r)===r&&10<(t=Gc+500-Qe())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(xl.bind(null,e,Bc,Wc),t);break}xl(e,Bc,Wc);break;case 4:if(cl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-at(r);a=1<<o,(o=t[o])>i&&(i=o),r&=~a}if(r=i,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tc(r/1960))-r)){e.timeoutHandle=ri(xl.bind(null,e,Bc,Wc),r);break}xl(e,Bc,Wc);break;default:throw Error(s(329))}}}return il(e,Qe()),e.callbackNode===n?sl.bind(null,e):null}function al(e,t){var n=Fc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=vl(e,t))&&(t=Bc,Bc=n,null!==t&&ol(t)),e}function ol(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function cl(e,t){for(t&=~Vc,t&=~Uc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function ll(e){if(0!==(6&Rc))throw Error(s(327));wl();var t=ht(e,0);if(0===(1&t))return il(e,Qe()),null;var n=vl(e,t);if(0!==e.tag&&2===n){var r=mt(e);0!==r&&(t=r,n=al(e,r))}if(1===n)throw n=jc,pl(e,0),cl(e,t),il(e,Qe()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xl(e,Bc,Wc),il(e,Qe()),null}function dl(e,t){var n=Rc;Rc|=1;try{return e(t)}finally{0===(Rc=n)&&(Hc=Qe()+500,Vi&&Gi())}}function ul(e){null!==Xc&&0===Xc.tag&&0===(6&Rc)&&wl();var t=Rc;Rc|=1;var n=Ac.transition,r=_t;try{if(Ac.transition=null,_t=1,e)return e()}finally{_t=r,Ac.transition=n,0===(6&(Rc=t))&&Gi()}}function hl(){kc=Dc.current,Ti(Dc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Oc)for(n=Oc.return;null!==n;){var r=n;switch(ts(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&ki();break;case 3:ia(),Ti(Ri),Ti(Ai),da();break;case 5:aa(r);break;case 4:ia();break;case 13:case 19:Ti(oa);break;case 10:xs(r.type._context);break;case 22:case 23:hl()}n=n.return}if(Ic=e,Oc=e=Dl(e.current,null),Pc=kc=t,Lc=0,jc=null,Vc=Uc=Mc=0,Bc=Fc=null,null!==Ns){for(t=0;t<Ns.length;t++)if(null!==(r=(n=Ns[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var a=s.next;s.next=i,r.next=a}n.pending=r}Ns=null}return e}function ml(e,t){for(;;){var n=Oc;try{if(bs(),ua.current=so,va){for(var r=ma.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}va=!1}if(pa=0,ga=fa=ma=null,ya=!1,_a=0,Cc.current=null,null===n||null===n.return){Lc=1,jc=t,Oc=null;break}e:{var a=e,o=n.return,c=n,l=t;if(t=Pc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l,u=c,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=vo(o);if(null!==m){m.flags&=-257,yo(m,o,c,0,t),1&m.mode&&go(a,d,t),l=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}if(0===(1&t)){go(a,d,t),gl();break e}l=Error(s(426))}else if(is&&1&c.mode){var v=vo(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),yo(v,o,c,0,t),ms(lo(l,c));break e}}a=l=lo(l,c),4!==Lc&&(Lc=2),null===Fc?Fc=[a]:Fc.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,js(a,mo(0,l,t));break e;case 1:c=l;var y=a.type,_=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===qc||!qc.has(_)))){a.flags|=65536,t&=-t,a.lanes|=t,js(a,fo(a,c,t));break e}}a=a.return}while(null!==a)}bl(n)}catch(E){t=E,Oc===n&&null!==n&&(Oc=n=n.return);continue}break}}function fl(){var e=Nc.current;return Nc.current=so,null===e?so:e}function gl(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Ic||0===(268435455&Mc)&&0===(268435455&Uc)||cl(Ic,Pc)}function vl(e,t){var n=Rc;Rc|=2;var r=fl();for(Ic===e&&Pc===t||(Wc=null,pl(e,t));;)try{yl();break}catch(i){ml(e,i)}if(bs(),Rc=n,Nc.current=r,null!==Oc)throw Error(s(261));return Ic=null,Pc=0,Lc}function yl(){for(;null!==Oc;)El(Oc)}function _l(){for(;null!==Oc&&!Xe();)El(Oc)}function El(e){var t=Sc(e.alternate,e,kc);e.memoizedProps=e.pendingProps,null===t?bl(e):Oc=t,Cc.current=null}function bl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yo(n,t,kc)))return void(Oc=n)}else{if(null!==(n=Xo(n,t)))return n.flags&=32767,void(Oc=n);if(null===e)return Lc=6,void(Oc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Oc=t);Oc=t=e}while(null!==t);0===Lc&&(Lc=5)}function xl(e,t,n){var r=_t,i=Ac.transition;try{Ac.transition=null,_t=1,function(e,t,n,r){do{wl()}while(null!==Xc);if(0!==(6&Rc))throw Error(s(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,a),e===Ic&&(Oc=Ic=null,Pc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yc||(Yc=!0,Il(tt,function(){return wl(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Ac.transition,Ac.transition=null;var o=_t;_t=1;var c=Rc;Rc|=4,Cc.current=null,function(e,t){if(ei=Wt,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(b){n=null;break e}var o=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==i&&3!==h.nodeType||(c=o+i),h!==a||0!==r&&3!==h.nodeType||(l=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===i&&(c=o),p===a&&++u===r&&(l=o),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Wt=!1,$o=t;null!==$o;)if(e=(t=$o).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$o=e;else for(;null!==$o;){t=$o;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,v=f.memoizedState,y=t.stateNode,_=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:gs(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(s(163))}}catch(b){Tl(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$o=e;break}$o=t.return}f=nc,nc=!1}(e,n),vc(n,e),mr(ti),Wt=!!ei,ti=ei=null,e.current=n,_c(n,e,i),Je(),Rc=c,_t=o,Ac.transition=a}else e.current=n;if(Yc&&(Yc=!1,Xc=e,Jc=i),a=e.pendingLanes,0===a&&(qc=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(zc)throw zc=!1,e=Kc,Kc=null,e;0!==(1&Jc)&&0!==e.tag&&wl(),a=e.pendingLanes,0!==(1&a)?e===Zc?Qc++:(Qc=0,Zc=e):Qc=0,Gi()}(e,t,n,r)}finally{Ac.transition=i,_t=r}return null}function wl(){if(null!==Xc){var e=Et(Jc),t=Ac.transition,n=_t;try{if(Ac.transition=null,_t=16>e?16:e,null===Xc)var r=!1;else{if(e=Xc,Xc=null,Jc=0,0!==(6&Rc))throw Error(s(331));var i=Rc;for(Rc|=4,$o=e.current;null!==$o;){var a=$o,o=a.child;if(0!==(16&$o.flags)){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var d=c[l];for($o=d;null!==$o;){var u=$o;switch(u.tag){case 0:case 11:case 15:rc(8,u,a)}var h=u.child;if(null!==h)h.return=u,$o=h;else for(;null!==$o;){var p=(u=$o).sibling,m=u.return;if(ac(u),u===d){$o=null;break}if(null!==p){p.return=m,$o=p;break}$o=m}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}$o=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,$o=o;else e:for(;null!==$o;){if(0!==(2048&(a=$o).flags))switch(a.tag){case 0:case 11:case 15:rc(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,$o=y;break e}$o=a.return}}var _=e.current;for($o=_;null!==$o;){var E=(o=$o).child;if(0!==(2064&o.subtreeFlags)&&null!==E)E.return=o,$o=E;else e:for(o=_;null!==$o;){if(0!==(2048&(c=$o).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(x){Tl(c,c.return,x)}if(c===o){$o=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,$o=b;break e}$o=c.return}}if(Rc=i,Gi(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(it,e)}catch(x){}r=!0}return r}finally{_t=n,Ac.transition=t}}return!1}function Sl(e,t,n){e=Ds(e,t=mo(0,t=lo(n,t),1),1),t=tl(),null!==e&&(vt(e,1,t),il(e,t))}function Tl(e,t,n){if(3===e.tag)Sl(e,e,n);else for(;null!==t;){if(3===t.tag){Sl(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===qc||!qc.has(r))){t=Ds(t,e=fo(t,e=lo(n,e),1),1),e=tl(),null!==t&&(vt(t,1,e),il(t,e));break}}t=t.return}}function Nl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,Ic===e&&(Pc&n)===n&&(4===Lc||3===Lc&&(130023424&Pc)===Pc&&500>Qe()-Gc?pl(e,0):Vc|=n),il(e,t)}function Cl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=tl();null!==(e=Rs(e,t))&&(vt(e,t,n),il(e,n))}function Al(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cl(e,n)}function Rl(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),Cl(e,n)}function Il(e,t){return qe(e,t)}function Ol(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pl(e,t,n,r){return new Ol(e,t,n,r)}function kl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dl(e,t){var n=e.alternate;return null===n?((n=Pl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ll(e,t,n,r,i,a){var o=2;if(r=e,"function"===typeof e)kl(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case w:return jl(n.children,i,a,t);case S:o=8,i|=8;break;case T:return(e=Pl(12,n,t,2|i)).elementType=T,e.lanes=a,e;case R:return(e=Pl(13,n,t,i)).elementType=R,e.lanes=a,e;case I:return(e=Pl(19,n,t,i)).elementType=I,e.lanes=a,e;case k:return Ml(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case N:o=10;break e;case C:o=9;break e;case A:o=11;break e;case O:o=14;break e;case P:o=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Pl(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function jl(e,t,n,r){return(e=Pl(7,e,r,t)).lanes=n,e}function Ml(e,t,n,r){return(e=Pl(22,e,r,t)).elementType=k,e.lanes=n,e.stateNode={isHidden:!1},e}function Ul(e,t,n){return(e=Pl(6,e,null,t)).lanes=n,e}function Vl(e,t,n){return(t=Pl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fl(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Bl(e,t,n,r,i,s,a,o,c){return e=new Fl(e,t,n,o,c),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Pl(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Os(s),e}function Gl(e){if(!e)return Ci;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Pi(n))return Li(e,n,t)}return t}function Hl(e,t,n,r,i,s,a,o,c){return(e=Bl(n,r,!0,e,0,s,0,o,c)).context=Gl(null),n=e.current,(s=ks(r=tl(),i=nl(n))).callback=void 0!==t&&null!==t?t:null,Ds(n,s,i),e.current.lanes=i,vt(e,i,r),il(e,r),e}function Wl(e,t,n,r){var i=t.current,s=tl(),a=nl(i);return n=Gl(n),null===t.context?t.context=n:t.pendingContext=n,(t=ks(s,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ds(i,t,a))&&(rl(e,i,a,s),Ls(e,i,a)),a}function zl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Kl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){Kl(e,t),(e=e.alternate)&&Kl(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ri.current)Eo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Eo=!1,function(e,t,n){switch(t.tag){case 3:Io(t),ps();break;case 5:sa(t);break;case 1:Pi(t.type)&&ji(t);break;case 4:ra(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ni(vs,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ni(oa,1&oa.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Uo(e,t,n):(Ni(oa,1&oa.current),null!==(e=zo(e,t,n))?e.sibling:null);Ni(oa,1&oa.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ho(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ni(oa,oa.current),r)break;return null;case 22:case 23:return t.lanes=0,To(e,t,n)}return zo(e,t,n)}(e,t,n);Eo=0!==(131072&e.flags)}else Eo=!1,is&&0!==(1048576&t.flags)&&$i(t,Ki,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Wo(e,t),e=t.pendingProps;var i=Oi(t,Ai.current);Ss(t,n),i=wa(null,t,r,e,i,n);var a=Sa();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(a=!0,ji(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Os(t),i.updater=Bs,t.stateNode=i,i._reactInternals=t,zs(t,r,e,n),t=Ro(null,t,r,!0,a,n)):(t.tag=0,is&&a&&es(t),bo(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Wo(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return kl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===O)return 14}return 2}(r),e=gs(r,e),i){case 0:t=Co(null,t,r,e,n);break e;case 1:t=Ao(null,t,r,e,n);break e;case 11:t=xo(null,t,r,e,n);break e;case 14:t=wo(null,t,r,gs(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Co(e,t,r,i=t.elementType===r?i:gs(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ao(e,t,r,i=t.elementType===r?i:gs(r,i),n);case 3:e:{if(Io(t),null===e)throw Error(s(387));r=t.pendingProps,i=(a=t.memoizedState).element,Ps(e,t),Ms(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Oo(e,t,r,n,i=lo(Error(s(423)),t));break e}if(r!==i){t=Oo(e,t,r,n,i=lo(Error(s(424)),t));break e}for(rs=li(t.stateNode.containerInfo.firstChild),ns=t,is=!0,ss=null,n=Qs(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),r===i){t=zo(e,t,n);break e}bo(e,t,r,n)}t=t.child}return t;case 5:return sa(t),null===e&&ls(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,ni(r,i)?o=null:null!==a&&ni(r,a)&&(t.flags|=32),No(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&ls(t),null;case 13:return Uo(e,t,n);case 4:return ra(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Js(t,null,r,n):bo(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,xo(e,t,r,i=t.elementType===r?i:gs(r,i),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,Ni(vs,r._currentValue),r._currentValue=o,null!==a)if(or(a.value,o)){if(a.children===i.children&&!Ri.current){t=zo(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){o=a.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===a.tag){(l=ks(-1,n&-n)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),d.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),ws(a.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),ws(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}bo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ss(t,n),r=r(i=Ts(i)),t.flags|=1,bo(e,t,r,n),t.child;case 14:return i=gs(r=t.type,t.pendingProps),wo(e,t,r,i=gs(r.type,i),n);case 15:return So(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:gs(r,i),Wo(e,t),t.tag=1,Pi(r)?(e=!0,ji(t)):e=!1,Ss(t,n),Hs(t,r,i),zs(t,r,i,n),Ro(null,t,r,!0,e,n);case 19:return Ho(e,t,n);case 22:return To(e,t,n)}throw Error(s(156,t.tag))};var Yl="function"===typeof reportError?reportError:function(e){console.error(e)};function Xl(e){this._internalRoot=e}function Jl(e){this._internalRoot=e}function Ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function ed(e,t,n,r,i){var s=n._reactRootContainer;if(s){var a=s;if("function"===typeof i){var o=i;i=function(){var e=zl(a);o.call(e)}}Wl(t,a,e,i)}else a=function(e,t,n,r,i){if(i){if("function"===typeof r){var s=r;r=function(){var e=zl(a);s.call(e)}}var a=Hl(t,r,e,0,null,!1,0,"",$l);return e._reactRootContainer=a,e[mi]=a.current,Gr(8===e.nodeType?e.parentNode:e),ul(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var o=r;r=function(){var e=zl(c);o.call(e)}}var c=Bl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=c,e[mi]=c.current,Gr(8===e.nodeType?e.parentNode:e),ul(function(){Wl(t,c,n,r)}),c}(n,t,e,i,r);return zl(a)}Jl.prototype.render=Xl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Wl(e,t,null,null)},Jl.prototype.unmount=Xl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){Wl(null,e,null,null)}),t[mi]=null}},Jl.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<kt.length&&0!==t&&t<kt[n].priority;n++);kt.splice(n,0,e),0===n&&Mt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(yt(t,1|n),il(t,Qe()),0===(6&Rc)&&(Hc=Qe()+500,Gi()))}break;case 13:ul(function(){var t=Rs(e,1);if(null!==t){var n=tl();rl(t,e,1,n)}}),ql(e,1)}},xt=function(e){if(13===e.tag){var t=Rs(e,134217728);if(null!==t)rl(t,e,134217728,tl());ql(e,134217728)}},wt=function(e){if(13===e.tag){var t=nl(e),n=Rs(e,t);if(null!==n)rl(n,e,t,tl());ql(e,t)}},St=function(){return _t},Tt=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},xe=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=bi(r);if(!i)throw Error(s(90));q(r),Z(r,i)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=dl,Re=ul;var td={usingClientEntryPoint:!1,Events:[_i,Ei,bi,Ne,Ce,dl]},nd={findFiberByHostInstance:yi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rd={bundleType:nd.bundleType,version:nd.version,rendererPackageName:nd.rendererPackageName,rendererConfig:nd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=ze(e))?null:e.stateNode},findFiberByHostInstance:nd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var id=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!id.isDisabled&&id.supportsFiber)try{it=id.inject(rd),st=id}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=td,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ql(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Ql(e))throw Error(s(299));var n=!1,r="",i=Yl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Bl(e,1,!1,null,0,n,0,r,i),e[mi]=t.current,Gr(8===e.nodeType?e.parentNode:e),new Xl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=ze(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Zl(t))throw Error(s(200));return ed(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Ql(e))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,i=!1,a="",o=Yl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Hl(t,null,e,1,null!=n?n:null,i,0,a,o),e[mi]=t.current,Gr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Jl(t)},t.render=function(e,t,n){if(!Zl(t))throw Error(s(200));return ed(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zl(e))throw Error(s(40));return!!e._reactRootContainer&&(ul(function(){ed(null,null,e,!1,function(){e._reactRootContainer=null,e[mi]=null})}),!0)},t.unstable_batchedUpdates=dl,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zl(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return ed(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},2907:(e,t,n)=>{"use strict";n.d(t,{QueryClient:()=>r.QueryClient,QueryClientProvider:()=>i.QueryClientProvider});var r=n(5819);n.o(r,"QueryClientProvider")&&n.d(t,{QueryClientProvider:function(){return r.QueryClientProvider}});var i=n(6524)},2965:(e,t,n)=>{"use strict";n.d(t,{$b:()=>i,Vy:()=>l});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},a=i.INFO,o={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=o[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];console[r]("[".concat(n,"]  ").concat(e.name,":"),...s)};class l{constructor(e){this.name=e,this._logLevel=a,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...t),this._logHandler(this,i.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...t),this._logHandler(this,i.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.INFO,...t),this._logHandler(this,i.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.WARN,...t),this._logHandler(this,i.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.ERROR,...t),this._logHandler(this,i.ERROR,...t)}}},3930:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(6368),n(4220),function(){var e=t,n=e.lib,r=n.Base,i=n.WordArray,s=e.algo,a=s.SHA256,o=s.HMAC,c=s.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:a,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=o.create(n.hasher,e),s=i.create(),a=i.create([1]),c=s.words,l=a.words,d=n.keySize,u=n.iterations;c.length<d;){var h=r.update(t).finalize(a);r.reset();for(var p=h.words,m=p.length,f=h,g=1;g<u;g++){f=r.finalize(f),r.reset();for(var v=f.words,y=0;y<m;y++)p[y]^=v[y]}s.concat(h),l[0]++}return s.sigBytes=4*d,s}});e.PBKDF2=function(e,t,n){return c.create(n).compute(e,t)}}(),t.PBKDF2)}()},3986:(e,t,n)=>{"use strict";function r(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}n.d(t,{A:()=>r})},4087:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding)}()},4107:(e,t,n)=>{"use strict";n.r(t),n.d(t,{UserProvider:()=>d,useUser:()=>l});var r=n(5043),i=n(7227),s=n(823),a=n(9416),o=n(579);const c=(0,r.createContext)(),l=()=>{const e=(0,r.useContext)(c);if(!e)throw new Error("useUser must be used within a UserProvider");return e},d=e=>{let{children:t}=e;const[l,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),[p,m]=(0,r.useState)(!0),[f,g]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=(0,s.hg)(i.j2,async e=>{if(e)try{d(e);const i=await(0,a.kl)(e.uid);if(console.log("\ud83d\udd0d UserContext Debug - Profile loaded:",{userId:e.uid,profile:i,userType:null===i||void 0===i?void 0:i.userType,type:null===i||void 0===i?void 0:i.type}),i){h(i);const e=i.userType||i.type||"patient";g(e),console.log("\u2705 User role set to:",e)}else{console.log("User profile not found in Firestore, creating profile...");try{var t;const{createUser:r}=await Promise.resolve().then(n.bind(n,9416)),i={id:e.uid,displayName:e.displayName||(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"User",email:e.email,userType:"client",photoUrl:e.photoURL,specializations:[],certifications:[],experience:"",qualificationLevel:"pending",profileComplete:!1,createdAt:new Date};await r(i),console.log("\u2705 User profile created successfully");const s=await(0,a.kl)(e.uid);if(s){h(s);const e=s.userType||s.type||"caregiver";g(e),console.log("\u2705 New profile loaded:",e)}}catch(r){console.error("Error creating user profile:",r),h(null),g("caregiver")}}}catch(i){console.error("Error fetching user profile:",i),h(null),g("patient")}else d(null),h(null),g(null);m(!1)});return()=>e()},[]);const v={user:l,userProfile:u,userRole:f,loading:p,isOnboardingIncomplete:()=>{if(!u)return console.log("No user profile found, onboarding required"),!0;if(console.log("Checking onboarding completion:",{userRole:f,userType:u.userType,onboardingComplete:u.onboardingComplete,onboardingProfileComplete:u.onboardingProfileComplete}),"caregiver"===u.userType){return!0===u.onboardingComplete?(console.log("\u2705 Caregiver onboarding complete"),!1):(console.log("\ud83d\udeab CAREGIVER ONBOARDING INCOMPLETE - blocking access",{onboardingComplete:u.onboardingComplete,userType:u.userType}),!0)}return"elderly"===u.userType||"patient"===f?u.onboardingProfileComplete?(console.log("\u2705 Patient onboarding complete"),!1):(console.log("\ud83d\udeab PATIENT ONBOARDING INCOMPLETE - blocking access"),!0):(console.log("\u26a0\ufe0f Unknown user type, requiring onboarding"),!0)},getCaregiverOnboardingRoute:()=>"/caregiver/onboarding",isServiceProvider:()=>"doctor"===f||"caregiver"===f,isDoctor:()=>"doctor"===f,isCaregiver:()=>"caregiver"===f,isElderly:()=>"elderly"===f,isAdmin:()=>"admin"===f,updateUserProfile:h};return(0,o.jsx)(c.Provider,{value:v,children:t})}},4198:(e,t,n)=>{"use strict";n.d(t,{E:()=>w});var r=n(8168),i=n(8870);function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}var o=n(1991),c=n(75),l=function(){function e(){this.listeners=[]}var t=e.prototype;return t.subscribe=function(e){var t=this,n=e||function(){};return this.listeners.push(n),this.onSubscribe(),function(){t.listeners=t.listeners.filter(function(e){return e!==n}),t.onUnsubscribe()}},t.hasListeners=function(){return this.listeners.length>0},t.onSubscribe=function(){},t.onUnsubscribe=function(){},e}(),d=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!i.S$&&(null==(t=window)?void 0:t.addEventListener)){var n=function(){return e()};return window.addEventListener("visibilitychange",n,!1),window.addEventListener("focus",n,!1),function(){window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}}},t}a(t,e);var n=t.prototype;return n.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},n.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},n.setEventListener=function(e){var t,n=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?n.setFocused(e):n.onFocus()})},n.setFocused=function(e){this.focused=e,e&&this.onFocus()},n.onFocus=function(){this.listeners.forEach(function(e){e()})},n.isFocused=function(){return"boolean"===typeof this.focused?this.focused:"undefined"===typeof document||[void 0,"visible","prerender"].includes(document.visibilityState)},t}(l)),u=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!i.S$&&(null==(t=window)?void 0:t.addEventListener)){var n=function(){return e()};return window.addEventListener("online",n,!1),window.addEventListener("offline",n,!1),function(){window.removeEventListener("online",n),window.removeEventListener("offline",n)}}},t}a(t,e);var n=t.prototype;return n.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},n.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},n.setEventListener=function(e){var t,n=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?n.setOnline(e):n.onOnline()})},n.setOnline=function(e){this.online=e,e&&this.onOnline()},n.onOnline=function(){this.listeners.forEach(function(e){e()})},n.isOnline=function(){return"boolean"===typeof this.online?this.online:"undefined"===typeof navigator||"undefined"===typeof navigator.onLine||navigator.onLine},t}(l));function h(e){return Math.min(1e3*Math.pow(2,e),3e4)}function p(e){return"function"===typeof(null==e?void 0:e.cancel)}var m=function(e){this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent};function f(e){return e instanceof m}var g=function(e){var t,n,r,s,a=this,o=!1;this.abort=e.abort,this.cancel=function(e){return null==t?void 0:t(e)},this.cancelRetry=function(){o=!0},this.continueRetry=function(){o=!1},this.continue=function(){return null==n?void 0:n()},this.failureCount=0,this.isPaused=!1,this.isResolved=!1,this.isTransportCancelable=!1,this.promise=new Promise(function(e,t){r=e,s=t});var c=function(t){a.isResolved||(a.isResolved=!0,null==e.onSuccess||e.onSuccess(t),null==n||n(),r(t))},l=function(t){a.isResolved||(a.isResolved=!0,null==e.onError||e.onError(t),null==n||n(),s(t))};!function r(){if(!a.isResolved){var s;try{s=e.fn()}catch(f){s=Promise.reject(f)}t=function(e){if(!a.isResolved&&(l(new m(e)),null==a.abort||a.abort(),p(s)))try{s.cancel()}catch(t){}},a.isTransportCancelable=p(s),Promise.resolve(s).then(c).catch(function(t){var s,c;if(!a.isResolved){var p=null!=(s=e.retry)?s:3,m=null!=(c=e.retryDelay)?c:h,f="function"===typeof m?m(a.failureCount,t):m,g=!0===p||"number"===typeof p&&a.failureCount<p||"function"===typeof p&&p(a.failureCount,t);!o&&g?(a.failureCount++,null==e.onFail||e.onFail(a.failureCount,t),(0,i.yy)(f).then(function(){if(!d.isFocused()||!u.isOnline())return new Promise(function(t){n=t,a.isPaused=!0,null==e.onPause||e.onPause()}).then(function(){n=void 0,a.isPaused=!1,null==e.onContinue||e.onContinue()})}).then(function(){o?l(t):r()})):l(t)}})}}()},v=function(){function e(e){this.abortSignalConsumed=!1,this.hadObservers=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||this.getDefaultState(this.options),this.state=this.initialState,this.meta=e.meta,this.scheduleGc()}var t=e.prototype;return t.setOptions=function(e){var t;this.options=(0,r.A)({},this.defaultOptions,e),this.meta=null==e?void 0:e.meta,this.cacheTime=Math.max(this.cacheTime||0,null!=(t=this.options.cacheTime)?t:3e5)},t.setDefaultOptions=function(e){this.defaultOptions=e},t.scheduleGc=function(){var e=this;this.clearGcTimeout(),(0,i.gn)(this.cacheTime)&&(this.gcTimeout=setTimeout(function(){e.optionalRemove()},this.cacheTime))},t.clearGcTimeout=function(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)},t.optionalRemove=function(){this.observers.length||(this.state.isFetching?this.hadObservers&&this.scheduleGc():this.cache.remove(this))},t.setData=function(e,t){var n,r,s=this.state.data,a=(0,i.Zw)(e,s);return(null==(n=(r=this.options).isDataEqual)?void 0:n.call(r,s,a))?a=s:!1!==this.options.structuralSharing&&(a=(0,i.BH)(s,a)),this.dispatch({data:a,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt}),a},t.setState=function(e,t){this.dispatch({type:"setState",state:e,setStateOptions:t})},t.cancel=function(e){var t,n=this.promise;return null==(t=this.retryer)||t.cancel(e),n?n.then(i.lQ).catch(i.lQ):Promise.resolve()},t.destroy=function(){this.clearGcTimeout(),this.cancel({silent:!0})},t.reset=function(){this.destroy(),this.setState(this.initialState)},t.isActive=function(){return this.observers.some(function(e){return!1!==e.options.enabled})},t.isFetching=function(){return this.state.isFetching},t.isStale=function(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(function(e){return e.getCurrentResult().isStale})},t.isStaleByTime=function(e){return void 0===e&&(e=0),this.state.isInvalidated||!this.state.dataUpdatedAt||!(0,i.j3)(this.state.dataUpdatedAt,e)},t.onFocus=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnWindowFocus()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.onOnline=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnReconnect()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.addObserver=function(e){-1===this.observers.indexOf(e)&&(this.observers.push(e),this.hadObservers=!0,this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))},t.removeObserver=function(e){-1!==this.observers.indexOf(e)&&(this.observers=this.observers.filter(function(t){return t!==e}),this.observers.length||(this.retryer&&(this.retryer.isTransportCancelable||this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.cacheTime?this.scheduleGc():this.cache.remove(this)),this.cache.notify({type:"observerRemoved",query:this,observer:e}))},t.getObserversCount=function(){return this.observers.length},t.invalidate=function(){this.state.isInvalidated||this.dispatch({type:"invalidate"})},t.fetch=function(e,t){var n,r,s,a=this;if(this.state.isFetching)if(this.state.dataUpdatedAt&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(this.promise){var o;return null==(o=this.retryer)||o.continueRetry(),this.promise}if(e&&this.setOptions(e),!this.options.queryFn){var l=this.observers.find(function(e){return e.options.queryFn});l&&this.setOptions(l.options)}var d=(0,i.HN)(this.queryKey),u=(0,i.jY)(),h={queryKey:d,pageParam:void 0,meta:this.meta};Object.defineProperty(h,"signal",{enumerable:!0,get:function(){if(u)return a.abortSignalConsumed=!0,u.signal}});var p,m,v={fetchOptions:t,options:this.options,queryKey:d,state:this.state,fetchFn:function(){return a.options.queryFn?(a.abortSignalConsumed=!1,a.options.queryFn(h)):Promise.reject("Missing queryFn")},meta:this.meta};(null==(n=this.options.behavior)?void 0:n.onFetch)&&(null==(p=this.options.behavior)||p.onFetch(v));(this.revertState=this.state,this.state.isFetching&&this.state.fetchMeta===(null==(r=v.fetchOptions)?void 0:r.meta))||this.dispatch({type:"fetch",meta:null==(m=v.fetchOptions)?void 0:m.meta});return this.retryer=new g({fn:v.fetchFn,abort:null==u||null==(s=u.abort)?void 0:s.bind(u),onSuccess:function(e){a.setData(e),null==a.cache.config.onSuccess||a.cache.config.onSuccess(e,a),0===a.cacheTime&&a.optionalRemove()},onError:function(e){f(e)&&e.silent||a.dispatch({type:"error",error:e}),f(e)||(null==a.cache.config.onError||a.cache.config.onError(e,a),(0,c.t)().error(e)),0===a.cacheTime&&a.optionalRemove()},onFail:function(){a.dispatch({type:"failed"})},onPause:function(){a.dispatch({type:"pause"})},onContinue:function(){a.dispatch({type:"continue"})},retry:v.options.retry,retryDelay:v.options.retryDelay}),this.promise=this.retryer.promise,this.promise},t.dispatch=function(e){var t=this;this.state=this.reducer(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onQueryUpdate(e)}),t.cache.notify({query:t,type:"queryUpdated",action:e})})},t.getDefaultState=function(e){var t="function"===typeof e.initialData?e.initialData():e.initialData,n="undefined"!==typeof e.initialData?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0,r="undefined"!==typeof t;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?null!=n?n:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchMeta:null,isFetching:!1,isInvalidated:!1,isPaused:!1,status:r?"success":"idle"}},t.reducer=function(e,t){var n,i;switch(t.type){case"failed":return(0,r.A)({},e,{fetchFailureCount:e.fetchFailureCount+1});case"pause":return(0,r.A)({},e,{isPaused:!0});case"continue":return(0,r.A)({},e,{isPaused:!1});case"fetch":return(0,r.A)({},e,{fetchFailureCount:0,fetchMeta:null!=(n=t.meta)?n:null,isFetching:!0,isPaused:!1},!e.dataUpdatedAt&&{error:null,status:"loading"});case"success":return(0,r.A)({},e,{data:t.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:null!=(i=t.dataUpdatedAt)?i:Date.now(),error:null,fetchFailureCount:0,isFetching:!1,isInvalidated:!1,isPaused:!1,status:"success"});case"error":var s=t.error;return f(s)&&s.revert&&this.revertState?(0,r.A)({},this.revertState):(0,r.A)({},e,{error:s,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,isFetching:!1,isPaused:!1,status:"error"});case"invalidate":return(0,r.A)({},e,{isInvalidated:!0});case"setState":return(0,r.A)({},e,t.state);default:return e}},e}(),y=function(e){function t(t){var n;return(n=e.call(this)||this).config=t||{},n.queries=[],n.queriesMap={},n}a(t,e);var n=t.prototype;return n.build=function(e,t,n){var r,s=t.queryKey,a=null!=(r=t.queryHash)?r:(0,i.F$)(s,t),o=this.get(a);return o||(o=new v({cache:this,queryKey:s,queryHash:a,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(s),meta:t.meta}),this.add(o)),o},n.add=function(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"queryAdded",query:e}))},n.remove=function(e){var t=this.queriesMap[e.queryHash];t&&(e.destroy(),this.queries=this.queries.filter(function(t){return t!==e}),t===e&&delete this.queriesMap[e.queryHash],this.notify({type:"queryRemoved",query:e}))},n.clear=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(t){e.remove(t)})})},n.get=function(e){return this.queriesMap[e]},n.getAll=function(){return this.queries},n.find=function(e,t){var n=(0,i.b_)(e,t)[0];return"undefined"===typeof n.exact&&(n.exact=!0),this.queries.find(function(e){return(0,i.MK)(n,e)})},n.findAll=function(e,t){var n=(0,i.b_)(e,t)[0];return Object.keys(n).length>0?this.queries.filter(function(e){return(0,i.MK)(n,e)}):this.queries},n.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},n.onFocus=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onFocus()})})},n.onOnline=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onOnline()})})},t}(l),_=function(){function e(e){this.options=(0,r.A)({},e.defaultOptions,e.options),this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.observers=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,isPaused:!1,status:"idle",variables:void 0},this.meta=e.meta}var t=e.prototype;return t.setState=function(e){this.dispatch({type:"setState",state:e})},t.addObserver=function(e){-1===this.observers.indexOf(e)&&this.observers.push(e)},t.removeObserver=function(e){this.observers=this.observers.filter(function(t){return t!==e})},t.cancel=function(){return this.retryer?(this.retryer.cancel(),this.retryer.promise.then(i.lQ).catch(i.lQ)):Promise.resolve()},t.continue=function(){return this.retryer?(this.retryer.continue(),this.retryer.promise):this.execute()},t.execute=function(){var e,t=this,n="loading"===this.state.status,r=Promise.resolve();return n||(this.dispatch({type:"loading",variables:this.options.variables}),r=r.then(function(){null==t.mutationCache.config.onMutate||t.mutationCache.config.onMutate(t.state.variables,t)}).then(function(){return null==t.options.onMutate?void 0:t.options.onMutate(t.state.variables)}).then(function(e){e!==t.state.context&&t.dispatch({type:"loading",context:e,variables:t.state.variables})})),r.then(function(){return t.executeMutation()}).then(function(n){e=n,null==t.mutationCache.config.onSuccess||t.mutationCache.config.onSuccess(e,t.state.variables,t.state.context,t)}).then(function(){return null==t.options.onSuccess?void 0:t.options.onSuccess(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(e,null,t.state.variables,t.state.context)}).then(function(){return t.dispatch({type:"success",data:e}),e}).catch(function(e){return null==t.mutationCache.config.onError||t.mutationCache.config.onError(e,t.state.variables,t.state.context,t),(0,c.t)().error(e),Promise.resolve().then(function(){return null==t.options.onError?void 0:t.options.onError(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(void 0,e,t.state.variables,t.state.context)}).then(function(){throw t.dispatch({type:"error",error:e}),e})})},t.executeMutation=function(){var e,t=this;return this.retryer=new g({fn:function(){return t.options.mutationFn?t.options.mutationFn(t.state.variables):Promise.reject("No mutationFn found")},onFail:function(){t.dispatch({type:"failed"})},onPause:function(){t.dispatch({type:"pause"})},onContinue:function(){t.dispatch({type:"continue"})},retry:null!=(e=this.options.retry)?e:0,retryDelay:this.options.retryDelay}),this.retryer.promise},t.dispatch=function(e){var t=this;this.state=function(e,t){switch(t.type){case"failed":return(0,r.A)({},e,{failureCount:e.failureCount+1});case"pause":return(0,r.A)({},e,{isPaused:!0});case"continue":return(0,r.A)({},e,{isPaused:!1});case"loading":return(0,r.A)({},e,{context:t.context,data:void 0,error:null,isPaused:!1,status:"loading",variables:t.variables});case"success":return(0,r.A)({},e,{data:t.data,error:null,status:"success",isPaused:!1});case"error":return(0,r.A)({},e,{data:void 0,error:t.error,failureCount:e.failureCount+1,isPaused:!1,status:"error"});case"setState":return(0,r.A)({},e,t.state);default:return e}}(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onMutationUpdate(e)}),t.mutationCache.notify(t)})},e}();var E=function(e){function t(t){var n;return(n=e.call(this)||this).config=t||{},n.mutations=[],n.mutationId=0,n}a(t,e);var n=t.prototype;return n.build=function(e,t,n){var r=new _({mutationCache:this,mutationId:++this.mutationId,options:e.defaultMutationOptions(t),state:n,defaultOptions:t.mutationKey?e.getMutationDefaults(t.mutationKey):void 0,meta:t.meta});return this.add(r),r},n.add=function(e){this.mutations.push(e),this.notify(e)},n.remove=function(e){this.mutations=this.mutations.filter(function(t){return t!==e}),e.cancel(),this.notify(e)},n.clear=function(){var e=this;o.j.batch(function(){e.mutations.forEach(function(t){e.remove(t)})})},n.getAll=function(){return this.mutations},n.find=function(e){return"undefined"===typeof e.exact&&(e.exact=!0),this.mutations.find(function(t){return(0,i.nJ)(e,t)})},n.findAll=function(e){return this.mutations.filter(function(t){return(0,i.nJ)(e,t)})},n.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},n.onFocus=function(){this.resumePausedMutations()},n.onOnline=function(){this.resumePausedMutations()},n.resumePausedMutations=function(){var e=this.mutations.filter(function(e){return e.state.isPaused});return o.j.batch(function(){return e.reduce(function(e,t){return e.then(function(){return t.continue().catch(i.lQ)})},Promise.resolve())})},t}(l);function b(e,t){return null==e.getNextPageParam?void 0:e.getNextPageParam(t[t.length-1],t)}function x(e,t){return null==e.getPreviousPageParam?void 0:e.getPreviousPageParam(t[0],t)}var w=function(){function e(e){void 0===e&&(e={}),this.queryCache=e.queryCache||new y,this.mutationCache=e.mutationCache||new E,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[]}var t=e.prototype;return t.mount=function(){var e=this;this.unsubscribeFocus=d.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onFocus(),e.queryCache.onFocus())}),this.unsubscribeOnline=u.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onOnline(),e.queryCache.onOnline())})},t.unmount=function(){var e,t;null==(e=this.unsubscribeFocus)||e.call(this),null==(t=this.unsubscribeOnline)||t.call(this)},t.isFetching=function(e,t){var n=(0,i.b_)(e,t)[0];return n.fetching=!0,this.queryCache.findAll(n).length},t.isMutating=function(e){return this.mutationCache.findAll((0,r.A)({},e,{fetching:!0})).length},t.getQueryData=function(e,t){var n;return null==(n=this.queryCache.find(e,t))?void 0:n.state.data},t.getQueriesData=function(e){return this.getQueryCache().findAll(e).map(function(e){return[e.queryKey,e.state.data]})},t.setQueryData=function(e,t,n){var r=(0,i.vh)(e),s=this.defaultQueryOptions(r);return this.queryCache.build(this,s).setData(t,n)},t.setQueriesData=function(e,t,n){var r=this;return o.j.batch(function(){return r.getQueryCache().findAll(e).map(function(e){var i=e.queryKey;return[i,r.setQueryData(i,t,n)]})})},t.getQueryState=function(e,t){var n;return null==(n=this.queryCache.find(e,t))?void 0:n.state},t.removeQueries=function(e,t){var n=(0,i.b_)(e,t)[0],r=this.queryCache;o.j.batch(function(){r.findAll(n).forEach(function(e){r.remove(e)})})},t.resetQueries=function(e,t,n){var s=this,a=(0,i.b_)(e,t,n),c=a[0],l=a[1],d=this.queryCache,u=(0,r.A)({},c,{active:!0});return o.j.batch(function(){return d.findAll(c).forEach(function(e){e.reset()}),s.refetchQueries(u,l)})},t.cancelQueries=function(e,t,n){var r=this,s=(0,i.b_)(e,t,n),a=s[0],c=s[1],l=void 0===c?{}:c;"undefined"===typeof l.revert&&(l.revert=!0);var d=o.j.batch(function(){return r.queryCache.findAll(a).map(function(e){return e.cancel(l)})});return Promise.all(d).then(i.lQ).catch(i.lQ)},t.invalidateQueries=function(e,t,n){var s,a,c,l=this,d=(0,i.b_)(e,t,n),u=d[0],h=d[1],p=(0,r.A)({},u,{active:null==(s=null!=(a=u.refetchActive)?a:u.active)||s,inactive:null!=(c=u.refetchInactive)&&c});return o.j.batch(function(){return l.queryCache.findAll(u).forEach(function(e){e.invalidate()}),l.refetchQueries(p,h)})},t.refetchQueries=function(e,t,n){var s=this,a=(0,i.b_)(e,t,n),c=a[0],l=a[1],d=o.j.batch(function(){return s.queryCache.findAll(c).map(function(e){return e.fetch(void 0,(0,r.A)({},l,{meta:{refetchPage:null==c?void 0:c.refetchPage}}))})}),u=Promise.all(d).then(i.lQ);return(null==l?void 0:l.throwOnError)||(u=u.catch(i.lQ)),u},t.fetchQuery=function(e,t,n){var r=(0,i.vh)(e,t,n),s=this.defaultQueryOptions(r);"undefined"===typeof s.retry&&(s.retry=!1);var a=this.queryCache.build(this,s);return a.isStaleByTime(s.staleTime)?a.fetch(s):Promise.resolve(a.state.data)},t.prefetchQuery=function(e,t,n){return this.fetchQuery(e,t,n).then(i.lQ).catch(i.lQ)},t.fetchInfiniteQuery=function(e,t,n){var r=(0,i.vh)(e,t,n);return r.behavior={onFetch:function(e){e.fetchFn=function(){var t,n,r,s,a,o,c,l=null==(t=e.fetchOptions)||null==(n=t.meta)?void 0:n.refetchPage,d=null==(r=e.fetchOptions)||null==(s=r.meta)?void 0:s.fetchMore,u=null==d?void 0:d.pageParam,h="forward"===(null==d?void 0:d.direction),m="backward"===(null==d?void 0:d.direction),f=(null==(a=e.state.data)?void 0:a.pages)||[],g=(null==(o=e.state.data)?void 0:o.pageParams)||[],v=(0,i.jY)(),y=null==v?void 0:v.signal,_=g,E=!1,w=e.options.queryFn||function(){return Promise.reject("Missing queryFn")},S=function(e,t,n,r){return _=r?[t].concat(_):[].concat(_,[t]),r?[n].concat(e):[].concat(e,[n])},T=function(t,n,r,i){if(E)return Promise.reject("Cancelled");if("undefined"===typeof r&&!n&&t.length)return Promise.resolve(t);var s={queryKey:e.queryKey,signal:y,pageParam:r,meta:e.meta},a=w(s),o=Promise.resolve(a).then(function(e){return S(t,r,e,i)});return p(a)&&(o.cancel=a.cancel),o};if(f.length)if(h){var N="undefined"!==typeof u,C=N?u:b(e.options,f);c=T(f,N,C)}else if(m){var A="undefined"!==typeof u,R=A?u:x(e.options,f);c=T(f,A,R,!0)}else!function(){_=[];var t="undefined"===typeof e.options.getNextPageParam,n=!l||!f[0]||l(f[0],0,f);c=n?T([],t,g[0]):Promise.resolve(S([],g[0],f[0]));for(var r=function(n){c=c.then(function(r){if(!l||!f[n]||l(f[n],n,f)){var i=t?g[n]:b(e.options,r);return T(r,t,i)}return Promise.resolve(S(r,g[n],f[n]))})},i=1;i<f.length;i++)r(i)}();else c=T([]);var I=c.then(function(e){return{pages:e,pageParams:_}});return I.cancel=function(){E=!0,null==v||v.abort(),p(c)&&c.cancel()},I}}},this.fetchQuery(r)},t.prefetchInfiniteQuery=function(e,t,n){return this.fetchInfiniteQuery(e,t,n).then(i.lQ).catch(i.lQ)},t.cancelMutations=function(){var e=this,t=o.j.batch(function(){return e.mutationCache.getAll().map(function(e){return e.cancel()})});return Promise.all(t).then(i.lQ).catch(i.lQ)},t.resumePausedMutations=function(){return this.getMutationCache().resumePausedMutations()},t.executeMutation=function(e){return this.mutationCache.build(this,e).execute()},t.getQueryCache=function(){return this.queryCache},t.getMutationCache=function(){return this.mutationCache},t.getDefaultOptions=function(){return this.defaultOptions},t.setDefaultOptions=function(e){this.defaultOptions=e},t.setQueryDefaults=function(e,t){var n=this.queryDefaults.find(function(t){return(0,i.Od)(e)===(0,i.Od)(t.queryKey)});n?n.defaultOptions=t:this.queryDefaults.push({queryKey:e,defaultOptions:t})},t.getQueryDefaults=function(e){var t;return e?null==(t=this.queryDefaults.find(function(t){return(0,i.Cp)(e,t.queryKey)}))?void 0:t.defaultOptions:void 0},t.setMutationDefaults=function(e,t){var n=this.mutationDefaults.find(function(t){return(0,i.Od)(e)===(0,i.Od)(t.mutationKey)});n?n.defaultOptions=t:this.mutationDefaults.push({mutationKey:e,defaultOptions:t})},t.getMutationDefaults=function(e){var t;return e?null==(t=this.mutationDefaults.find(function(t){return(0,i.Cp)(e,t.mutationKey)}))?void 0:t.defaultOptions:void 0},t.defaultQueryOptions=function(e){if(null==e?void 0:e._defaulted)return e;var t=(0,r.A)({},this.defaultOptions.queries,this.getQueryDefaults(null==e?void 0:e.queryKey),e,{_defaulted:!0});return!t.queryHash&&t.queryKey&&(t.queryHash=(0,i.F$)(t.queryKey,t)),t},t.defaultQueryObserverOptions=function(e){return this.defaultQueryOptions(e)},t.defaultMutationOptions=function(e){return(null==e?void 0:e._defaulted)?e:(0,r.A)({},this.defaultOptions.mutations,this.getMutationDefaults(null==e?void 0:e.mutationKey),e,{_defaulted:!0})},t.clear=function(){this.queryCache.clear(),this.mutationCache.clear()},e}()},4199:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(e){var n=t,r=n.lib,i=r.WordArray,s=r.Hasher,a=n.algo,o=[];!function(){for(var t=0;t<64;t++)o[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s=this._hash.words,a=e[t+0],c=e[t+1],p=e[t+2],m=e[t+3],f=e[t+4],g=e[t+5],v=e[t+6],y=e[t+7],_=e[t+8],E=e[t+9],b=e[t+10],x=e[t+11],w=e[t+12],S=e[t+13],T=e[t+14],N=e[t+15],C=s[0],A=s[1],R=s[2],I=s[3];C=l(C,A,R,I,a,7,o[0]),I=l(I,C,A,R,c,12,o[1]),R=l(R,I,C,A,p,17,o[2]),A=l(A,R,I,C,m,22,o[3]),C=l(C,A,R,I,f,7,o[4]),I=l(I,C,A,R,g,12,o[5]),R=l(R,I,C,A,v,17,o[6]),A=l(A,R,I,C,y,22,o[7]),C=l(C,A,R,I,_,7,o[8]),I=l(I,C,A,R,E,12,o[9]),R=l(R,I,C,A,b,17,o[10]),A=l(A,R,I,C,x,22,o[11]),C=l(C,A,R,I,w,7,o[12]),I=l(I,C,A,R,S,12,o[13]),R=l(R,I,C,A,T,17,o[14]),C=d(C,A=l(A,R,I,C,N,22,o[15]),R,I,c,5,o[16]),I=d(I,C,A,R,v,9,o[17]),R=d(R,I,C,A,x,14,o[18]),A=d(A,R,I,C,a,20,o[19]),C=d(C,A,R,I,g,5,o[20]),I=d(I,C,A,R,b,9,o[21]),R=d(R,I,C,A,N,14,o[22]),A=d(A,R,I,C,f,20,o[23]),C=d(C,A,R,I,E,5,o[24]),I=d(I,C,A,R,T,9,o[25]),R=d(R,I,C,A,m,14,o[26]),A=d(A,R,I,C,_,20,o[27]),C=d(C,A,R,I,S,5,o[28]),I=d(I,C,A,R,p,9,o[29]),R=d(R,I,C,A,y,14,o[30]),C=u(C,A=d(A,R,I,C,w,20,o[31]),R,I,g,4,o[32]),I=u(I,C,A,R,_,11,o[33]),R=u(R,I,C,A,x,16,o[34]),A=u(A,R,I,C,T,23,o[35]),C=u(C,A,R,I,c,4,o[36]),I=u(I,C,A,R,f,11,o[37]),R=u(R,I,C,A,y,16,o[38]),A=u(A,R,I,C,b,23,o[39]),C=u(C,A,R,I,S,4,o[40]),I=u(I,C,A,R,a,11,o[41]),R=u(R,I,C,A,m,16,o[42]),A=u(A,R,I,C,v,23,o[43]),C=u(C,A,R,I,E,4,o[44]),I=u(I,C,A,R,w,11,o[45]),R=u(R,I,C,A,N,16,o[46]),C=h(C,A=u(A,R,I,C,p,23,o[47]),R,I,a,6,o[48]),I=h(I,C,A,R,y,10,o[49]),R=h(R,I,C,A,T,15,o[50]),A=h(A,R,I,C,g,21,o[51]),C=h(C,A,R,I,w,6,o[52]),I=h(I,C,A,R,m,10,o[53]),R=h(R,I,C,A,b,15,o[54]),A=h(A,R,I,C,c,21,o[55]),C=h(C,A,R,I,_,6,o[56]),I=h(I,C,A,R,N,10,o[57]),R=h(R,I,C,A,v,15,o[58]),A=h(A,R,I,C,S,21,o[59]),C=h(C,A,R,I,f,6,o[60]),I=h(I,C,A,R,x,10,o[61]),R=h(R,I,C,A,p,15,o[62]),A=h(A,R,I,C,E,21,o[63]),s[0]=s[0]+C|0,s[1]=s[1]+A|0,s[2]=s[2]+R|0,s[3]=s[3]+I|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(r/4294967296),a=r;n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var o=this._hash,c=o.words,l=0;l<4;l++){var d=c[l];c[l]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return o},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,n,r,i,s,a){var o=e+(t&n|~t&r)+i+a;return(o<<s|o>>>32-s)+t}function d(e,t,n,r,i,s,a){var o=e+(t&r|n&~r)+i+a;return(o<<s|o>>>32-s)+t}function u(e,t,n,r,i,s,a){var o=e+(t^n^r)+i+a;return(o<<s|o>>>32-s)+t}function h(e,t,n,r,i,s,a){var o=e+(n^(t|~r))+i+a;return(o<<s|o>>>32-s)+t}n.MD5=s._createHelper(c),n.HmacMD5=s._createHmacHelper(c)}(Math),t.MD5)}()},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function y(){}function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var E=_.prototype=new y;E.constructor=_,f(E,v.prototype),E.isPureReactComponent=!0;var b=Array.isArray,x=Object.prototype.hasOwnProperty,w={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var i,s={},a=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)x.call(t,i)&&!S.hasOwnProperty(i)&&(s[i]=t[i]);var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){for(var l=Array(c),d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===s[i]&&(s[i]=c[i]);return{$$typeof:n,type:e,key:a,ref:o,props:s,_owner:w.current}}function N(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function R(e,t,i,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c=!1;if(null===e)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return a=a(c=e),e=""===s?"."+A(c,0):s,b(a)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),R(a,t,i,"",function(e){return e})):null!=a&&(N(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+e)),t.push(a)),1;if(c=0,s=""===s?".":s+":",b(e))for(var l=0;l<e.length;l++){var d=s+A(o=e[l],l);c+=R(o,t,i,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),l=0;!(o=e.next()).done;)c+=R(o=o.value,t,i,d=s+A(o,l++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function I(e,t,n){if(null==e)return e;var r=[],i=0;return R(e,r,"","",function(e){return t.call(n,e,i++)}),r}function O(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},k={transition:null},D={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:k,ReactCurrentOwner:w};t.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=a,t.PureComponent=_,t.StrictMode=s,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=f({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=w.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)x.call(t,l)&&!S.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}return{$$typeof:n,type:e.type,key:s,ref:a,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=N,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},4220:function(e,t,n){!function(){var t;e.exports=(t=n(4488),void function(){var e=t,n=e.lib.Base,r=e.enc.Utf8;e.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),a=this._iKey=t.clone(),o=s.words,c=a.words,l=0;l<n;l++)o[l]^=1549556828,c[l]^=909522486;s.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}())}()},4298:()=>{},4391:(e,t,n)=>{"use strict";var r=n(7950);t.H=r.createRoot,r.hydrateRoot},4423:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.Iso97971={pad:function(e,n){e.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(e,n)},unpad:function(e){t.pad.ZeroPadding.unpad(e),e.sigBytes--}},t.pad.Iso97971)}()},4488:function(e,t,n){e.exports=function(){var e=e||function(e,t){var r;if("undefined"!==typeof window&&window.crypto&&(r=window.crypto),"undefined"!==typeof self&&self.crypto&&(r=self.crypto),"undefined"!==typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!==typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&"undefined"!==typeof n.g&&n.g.crypto&&(r=n.g.crypto),!r)try{r=n(477)}catch(g){}var i=function(){if(r){if("function"===typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(g){}if("function"===typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),a={},o=a.lib={},c=o.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=o.WordArray=c.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var s=0;s<i;s++){var a=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=a<<24-(r+s)%4*8}else for(var o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new l.init(t,e)}}),d=a.enc={},u=d.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new l.init(n,t/2)}},h=d.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new l.init(n,t)}},p=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},m=o.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,s=r.sigBytes,a=this.blockSize,o=s/(4*a),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*a,d=e.min(4*c,s);if(c){for(var u=0;u<c;u+=a)this._doProcessBlock(i,u);n=i.splice(0,c),r.sigBytes-=d}return new l.init(n,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(o.Hasher=m.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}}),a.algo={});return a}(Math);return e}()},4503:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){if("function"==typeof ArrayBuffer){var e=t.lib.WordArray,n=e.init,r=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!==typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,r=[],i=0;i<t;i++)r[i>>>2]|=e[i]<<24-i%4*8;n.call(this,r,t)}else n.apply(this,arguments)};r.prototype=e}}(),t.lib.WordArray)}()},4646:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib.WordArray;function r(e,t,r){for(var i=[],s=0,a=0;a<t;a++)if(a%4){var o=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;i[s>>>2]|=o<<24-s%4*8,s++}return n.create(i,s)}e.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var n=e.words,r=e.sigBytes,i=t?this._safe_map:this._map;e.clamp();for(var s=[],a=0;a<r;a+=3)for(var o=(n[a>>>2]>>>24-a%4*8&255)<<16|(n[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|n[a+2>>>2]>>>24-(a+2)%4*8&255,c=0;c<4&&a+.75*c<r;c++)s.push(i.charAt(o>>>6*(3-c)&63));var l=i.charAt(64);if(l)for(;s.length%4;)s.push(l);return s.join("")},parse:function(e,t){void 0===t&&(t=!0);var n=e.length,i=t?this._safe_map:this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var a=0;a<i.length;a++)s[i.charCodeAt(a)]=a}var o=i.charAt(64);if(o){var c=e.indexOf(o);-1!==c&&(n=c)}return r(e,n,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),t.enc.Base64url)}()},4708:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),function(){var e=t,n=e.lib.CipherParams,r=e.enc.Hex;e.format.Hex={stringify:function(e){return e.ciphertext.toString(r)},parse:function(e){var t=r.parse(e);return n.create({ciphertext:t})}}}(),t.format.Hex)}()},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5452:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var r=n(2174);const i=0,s=1,a=2,o=3,c=4;const l=new class{constructor(){this.logLevel=r.A.isDevelopment()?i:s,this.logs=[],this.maxLogSize=1e3}setLogLevel(e){this.logLevel=e}debug(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(i,"DEBUG",e,t)}info(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(s,"INFO",e,t)}warn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(a,"WARN",e,t)}error(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(o,"ERROR",e,t)}critical(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(c,"CRITICAL",e,t)}log(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e<this.logLevel)return;const s={timestamp:(new Date).toISOString(),level:t,message:n,data:i,url:window.location.href,userAgent:navigator.userAgent,userId:this.getCurrentUserId()};this.logs.push(s),this.logs.length>this.maxLogSize&&(this.logs=this.logs.slice(-this.maxLogSize)),this.consoleLog(t,n,i),this.persistLog(s),r.A.isProduction()&&e>=o&&this.sendToRemoteService(s)}consoleLog(e,t,n){const r="[".concat(e,"] ").concat(t);switch(e){case"DEBUG":console.debug(r,n);break;case"INFO":console.info(r,n);break;case"WARN":console.warn(r,n);break;case"ERROR":case"CRITICAL":console.error(r,n);break;default:console.log(r,n)}}persistLog(e){try{const t=JSON.parse(localStorage.getItem("elderx_logs")||"[]");t.push(e),t.length>this.maxLogSize&&t.splice(0,t.length-this.maxLogSize),localStorage.setItem("elderx_logs",JSON.stringify(t))}catch(t){console.warn("Could not persist log to localStorage:",t)}}async sendToRemoteService(e){try{console.log("Sending log to remote service:",e)}catch(t){console.error("Failed to send log to remote service:",t)}}getCurrentUserId(){try{return JSON.parse(localStorage.getItem("elderx_user")||"{}").uid||"anonymous"}catch(e){return"anonymous"}}getLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=this.logs;return e&&(n=this.logs.filter(t=>t.level===e)),n.slice(-t)}clearLogs(){this.logs=[],localStorage.removeItem("elderx_logs")}time(e){console.time(e)}timeEnd(e){console.timeEnd(e)}group(e){console.group(e)}groupEnd(){console.groupEnd()}table(e){console.table(e)}trace(e){console.trace(e)}count(e){console.count(e)}assert(e,t){console.assert(e,t)}}},5787:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib.WordArray,r=e.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i+=2){var s=t[i>>>2]>>>16-i%4*8&65535;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return n.create(r,2*t)}},r.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],s=0;s<n;s+=2){var a=i(t[s>>>2]>>>16-s%4*8&65535);r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var t=e.length,r=[],s=0;s<t;s++)r[s>>>1]|=i(e.charCodeAt(s)<<16-s%2*16);return n.create(r,2*t)}}}(),t.enc.Utf16)}()},5819:(e,t,n)=>{"use strict";n.d(t,{QueryClient:()=>r.E});var r=n(4198),i=n(4298);n.o(i,"QueryClientProvider")&&n.d(t,{QueryClientProvider:function(){return i.QueryClientProvider}})},6111:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),n(4503),n(5787),n(8523),n(4646),n(4199),n(2002),n(6368),n(1641),n(7061),n(9092),n(6600),n(7423),n(4220),n(3930),n(8211),n(2238),n(1112),n(7962),n(8049),n(6380),n(8099),n(1884),n(9132),n(4423),n(548),n(4087),n(4708),n(7780),n(9475),n(9638),n(8875),n(1659),n(6501),t)}()},6368:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(e){var n=t,r=n.lib,i=r.WordArray,s=r.Hasher,a=n.algo,o=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(o[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var l=[],d=a.SHA256=s.extend({_doReset:function(){this._hash=new i.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],a=n[3],o=n[4],d=n[5],u=n[6],h=n[7],p=0;p<64;p++){if(p<16)l[p]=0|e[t+p];else{var m=l[p-15],f=(m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3,g=l[p-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;l[p]=f+l[p-7]+v+l[p-16]}var y=r&i^r&s^i&s,_=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),E=h+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&d^~o&u)+c[p]+l[p];h=u,u=d,d=o,o=a+E|0,a=s,s=i,i=r,r=E+(_+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+o|0,n[5]=n[5]+d|0,n[6]=n[6]+u|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=s._createHelper(d),n.HmacSHA256=s._createHmacHelper(d)}(Math),t.SHA256)}()},6380:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.OFB=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,s=this._keystream;i&&(s=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(s,0);for(var a=0;a<r;a++)e[t+a]^=s[a]}});return e.Decryptor=n,e}(),t.mode.OFB)}()},6501:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.BlockCipher,r=e.algo;const i=16,s=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],a=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var o={pbox:[],sbox:[]};function c(e,t){let n=t>>24&255,r=t>>16&255,i=t>>8&255,s=255&t,a=e.sbox[0][n]+e.sbox[1][r];return a^=e.sbox[2][i],a+=e.sbox[3][s],a}function l(e,t,n){let r,s=t,a=n;for(let o=0;o<i;++o)s^=e.pbox[o],a=c(e,s)^a,r=s,s=a,a=r;return r=s,s=a,a=r,a^=e.pbox[i],s^=e.pbox[i+1],{left:s,right:a}}function d(e,t,n){let r,s=t,a=n;for(let o=i+1;o>1;--o)s^=e.pbox[o],a=c(e,s)^a,r=s,s=a,a=r;return r=s,s=a,a=r,a^=e.pbox[1],s^=e.pbox[0],{left:s,right:a}}function u(e,t,n){for(let i=0;i<4;i++){e.sbox[i]=[];for(let t=0;t<256;t++)e.sbox[i][t]=a[i][t]}let r=0;for(let a=0;a<i+2;a++)e.pbox[a]=s[a]^t[r],r++,r>=n&&(r=0);let o=0,c=0,d=0;for(let s=0;s<i+2;s+=2)d=l(e,o,c),o=d.left,c=d.right,e.pbox[s]=o,e.pbox[s+1]=c;for(let i=0;i<4;i++)for(let t=0;t<256;t+=2)d=l(e,o,c),o=d.left,c=d.right,e.sbox[i][t]=o,e.sbox[i][t+1]=c;return!0}var h=r.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4;u(o,t,n)}},encryptBlock:function(e,t){var n=l(o,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},decryptBlock:function(e,t){var n=d(o,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=n._createHelper(h)}(),t.Blowfish)}()},6524:(e,t,n)=>{"use strict";n.d(t,{QueryClientProvider:()=>u});var r=n(1991),i=n(7950).unstable_batchedUpdates;r.j.setBatchNotifyFunction(i);var s=n(75),a=console;(0,s.B)(a);var o=n(5043),c=o.createContext(void 0),l=o.createContext(!1);function d(e){return e&&"undefined"!==typeof window?(window.ReactQueryClientContext||(window.ReactQueryClientContext=c),window.ReactQueryClientContext):c}var u=function(e){var t=e.client,n=e.contextSharing,r=void 0!==n&&n,i=e.children;o.useEffect(function(){return t.mount(),function(){t.unmount()}},[t]);var s=d(r);return o.createElement(l.Provider,{value:r},o.createElement(s.Provider,{value:t},i))}},6600:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),function(e){var n=t,r=n.lib,i=r.WordArray,s=r.Hasher,a=n.x64.Word,o=n.algo,c=[],l=[],d=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var r=(2*e+3*t)%5;e=t%5,t=r}for(e=0;e<5;e++)for(t=0;t<5;t++)l[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,s=0;s<24;s++){for(var o=0,u=0,h=0;h<7;h++){if(1&i){var p=(1<<h)-1;p<32?u^=1<<p:o^=1<<p-32}128&i?i=i<<1^113:i<<=1}d[s]=a.create(o,u)}}();var u=[];!function(){for(var e=0;e<25;e++)u[e]=a.create()}();var h=o.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,r=this.blockSize/2,i=0;i<r;i++){var s=e[t+2*i],a=e[t+2*i+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(A=n[i]).high^=a,A.low^=s}for(var o=0;o<24;o++){for(var h=0;h<5;h++){for(var p=0,m=0,f=0;f<5;f++)p^=(A=n[h+5*f]).high,m^=A.low;var g=u[h];g.high=p,g.low=m}for(h=0;h<5;h++){var v=u[(h+4)%5],y=u[(h+1)%5],_=y.high,E=y.low;for(p=v.high^(_<<1|E>>>31),m=v.low^(E<<1|_>>>31),f=0;f<5;f++)(A=n[h+5*f]).high^=p,A.low^=m}for(var b=1;b<25;b++){var x=(A=n[b]).high,w=A.low,S=c[b];S<32?(p=x<<S|w>>>32-S,m=w<<S|x>>>32-S):(p=w<<S-32|x>>>64-S,m=x<<S-32|w>>>64-S);var T=u[l[b]];T.high=p,T.low=m}var N=u[0],C=n[0];for(N.high=C.high,N.low=C.low,h=0;h<5;h++)for(f=0;f<5;f++){var A=n[b=h+5*f],R=u[b],I=u[(h+1)%5+5*f],O=u[(h+2)%5+5*f];A.high=R.high^~I.high&O.high,A.low=R.low^~I.low&O.low}A=n[0];var P=d[o];A.high^=P.high,A.low^=P.low}},_doFinalize:function(){var t=this._data,n=t.words,r=(this._nDataBytes,8*t.sigBytes),s=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(e.ceil((r+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var a=this._state,o=this.cfg.outputLength/8,c=o/8,l=[],d=0;d<c;d++){var u=a[d],h=u.high,p=u.low;h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),l.push(p),l.push(h)}return new i.init(l,o)},clone:function(){for(var e=s.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});n.SHA3=s._createHelper(h),n.HmacSHA3=s._createHmacHelper(h)}(Math),t.SHA3)}()},6667:(e,t,n)=>{"use strict";n.d(t,{Dc:()=>ye,gS:()=>fl,rJ:()=>nc,kd:()=>ml,H9:()=>rc,x7:()=>ll,GG:()=>ul,aU:()=>lc,AB:()=>Zc,aQ:()=>gl,My:()=>Jc,P:()=>zc,O5:()=>_l,BN:()=>hl,mZ:()=>pl,_M:()=>qc});var r,i,s=n(2555),a=n(9232),o=n(9606),c=n(2965),l=n(1776),d="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},u={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+3614090360&4294967295;a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(a<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function s(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var a={};function o(e){return-128<=e&&128>e?function(e,t){var n=a;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new s([0|e],0>e?-1:0)}):new s([0|e],0>e?-1:0)}function c(e){if(isNaN(e)||!isFinite(e))return l;if(0>e)return f(c(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new s(t,0)}var l=o(0),d=o(1),h=o(16777216);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return-1==e.h}function f(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new s(n,~e.h).add(d)}function g(e,t){return e.add(f(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(p(t))throw Error("division by zero");if(p(e))return new y(l,l);if(m(e))return t=_(f(e),t),new y(f(t.g),f(t.h));if(m(t))return t=_(e,f(t)),new y(f(t.g),t.h);if(30<e.g.length){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=E(n),r=E(r);var i=b(n,1),s=b(r,1);for(r=b(r,2),n=b(n,2);!p(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=b(r,1),n=b(n,1)}return t=g(e,i.j(t)),new y(i,t)}for(i=l;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),a=(s=c(n)).j(t);m(a)||0<a.l(e);)a=(s=c(n-=r)).j(t);p(s)&&(s=d),i=i.add(s),e=g(e,a)}return new y(i,e)}function E(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new s(n,e.h)}function b(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],a=0;a<r;a++)i[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new s(i,e.h)}(e=s.prototype).m=function(){if(m(this))return-f(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+f(this).toString(e);for(var t=c(Math.pow(e,6)),n=this,r="";;){var i=_(n,t).g,s=((0<(n=g(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return m(e=g(this,e))?-1:p(e)?0:1},e.abs=function(){return m(this)?f(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.i(i))+(65535&e.i(i)),o=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,a&=65535,o&=65535,n[i]=o<<16|a}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(p(this)||p(e))return l;if(m(this))return m(e)?f(this).j(f(e)):f(f(this).j(e));if(m(e))return f(this.j(f(e)));if(0>this.l(h)&&0>e.l(h))return c(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var a=this.i(r)>>>16,o=65535&this.i(r),d=e.i(i)>>>16,u=65535&e.i(i);n[2*r+2*i]+=o*u,v(n,2*r+2*i),n[2*r+2*i+1]+=a*u,v(n,2*r+2*i+1),n[2*r+2*i+1]+=o*d,v(n,2*r+2*i+1),n[2*r+2*i+2]+=a*d,v(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new s(n,0)},e.A=function(e){return _(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new s(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new s(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,i=u.Md5=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=c,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return f(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=c(Math.pow(n,8)),i=l,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=c(Math.pow(n,a)),i=i.j(a).add(c(o))):i=(i=i.j(r)).add(c(o))}return i},r=u.Integer=s}).apply("undefined"!==typeof d?d:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var h,p,m,f,g,v,y,_,E="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},b={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:c).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function x(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function w(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(s(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function S(e){return/^[\s\xa0]*$/.test(e)}function T(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function N(e){return N[" "](e),e}N[" "]=function(){};var C=-1!=T().indexOf("Gecko")&&!(-1!=T().toLowerCase().indexOf("webkit")&&-1==T().indexOf("Edge"))&&!(-1!=T().indexOf("Trident")||-1!=T().indexOf("MSIE"))&&-1==T().indexOf("Edge");function A(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function R(e){const t={};for(const n in e)t[n]=e[n];return t}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<I.length;t++)n=I[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function P(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function k(e){i.setTimeout(()=>{throw e},0)}function D(){var e=V;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var L=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new j,e=>e.reset());class j{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let M,U=!1,V=new class{constructor(){this.h=this.g=null}add(e,t){const n=L.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},F=()=>{const e=i.Promise.resolve(void 0);M=()=>{e.then(B)}};var B=()=>{for(var e;e=D();){try{e.h.call(e.g)}catch(n){k(n)}var t=L;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}U=!1};function G(){this.s=this.s,this.C=this.C}function H(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}G.prototype.s=!1,G.prototype.ma=function(){this.s||(this.s=!0,this.N())},G.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},H.prototype.h=function(){this.defaultPrevented=!0};var W=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function z(e,t){if(H.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(C){e:{try{N(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:K[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.aa.h.call(this)}}u(z,H);var K={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var q="closure_listenable_"+(1e6*Math.random()|0),Y=0;function X(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Y,this.da=this.fa=!1}function J(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Q(e){this.src=e,this.g={},this.h=0}function Z(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(J(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function $(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}Q.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=$(e,t,r,i);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new X(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var ee="closure_lm_"+(1e6*Math.random()|0),te={};function ne(e,t,n,r,i){if(r&&r.once)return ie(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ne(e,t[s],n,r,i);return null}return n=ue(n),e&&e[q]?e.K(t,n,a(r)?!!r.capture:!!r,i):re(e,t,n,!1,r,i)}function re(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=a(i)?!!i.capture:!!i,c=le(e);if(c||(e[ee]=c=new Q(e)),(n=c.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=ce;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)W||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(oe(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ie(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ie(e,t[s],n,r,i);return null}return n=ue(n),e&&e[q]?e.L(t,n,a(r)?!!r.capture:!!r,i):re(e,t,n,!0,r,i)}function se(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)se(e,t[s],n,r,i);else r=a(r)?!!r.capture:!!r,n=ue(n),e&&e[q]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=$(s=e.g[t],n,r,i))&&(J(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=le(e))&&(t=e.g[t.toString()],e=-1,t&&(e=$(t,n,r,i)),(n=-1<e?t[e]:null)&&ae(n))}function ae(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[q])Z(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(oe(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=le(t))?(Z(n,e),0==n.h&&(n.src=null,t[ee]=null)):J(e)}}}function oe(e){return e in te?te[e]:te[e]="on"+e}function ce(e,t){if(e.da)e=!0;else{t=new z(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ae(e),e=n.call(r,t)}return e}function le(e){return(e=e[ee])instanceof Q?e:null}var de="__closure_events_fn_"+(1e9*Math.random()>>>0);function ue(e){return"function"===typeof e?e:(e[de]||(e[de]=function(t){return e.handleEvent(t)}),e[de])}function he(){G.call(this),this.i=new Q(this),this.M=this,this.F=null}function pe(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new H(t,e);else if(t instanceof H)t.target=t.target||e;else{var i=t;O(t=new H(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=me(a,r,!0,t)&&i}if(i=me(a=t.g=e,r,!0,t)&&i,i=me(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=me(a=t.g=n[s],r,!1,t)&&i}function me(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,c=a.ha||a.src;a.fa&&Z(e.i,a),i=!1!==o.call(c,r)&&i}}return i&&!r.defaultPrevented}function fe(e,t,n){if("function"===typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ge(e){e.g=fe(()=>{e.g=null,e.i&&(e.i=!1,ge(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(he,G),he.prototype[q]=!0,he.prototype.removeEventListener=function(e,t,n,r){se(this,e,t,n,r)},he.prototype.N=function(){if(he.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)J(n[r]);delete t.g[e],t.h--}}this.F=null},he.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},he.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ve extends G{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ge(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ye(e){G.call(this),this.h=e,this.g={}}u(ye,G);var _e=[];function Ee(e){A(e.g,function(e,t){this.g.hasOwnProperty(t)&&ae(e)},e),e.g={}}ye.prototype.N=function(){ye.aa.N.call(this),Ee(this)},ye.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var be=i.JSON.stringify,xe=i.JSON.parse,we=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function Se(){}function Te(e){return e.h||(e.h=e.i())}function Ne(){}Se.prototype.h=null;var Ce={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ae(){H.call(this,"d")}function Re(){H.call(this,"c")}u(Ae,H),u(Re,H);var Ie={},Oe=null;function Pe(){return Oe=Oe||new he}function ke(e){H.call(this,Ie.La,e)}function De(e){const t=Pe();pe(t,new ke(t))}function Le(e,t){H.call(this,Ie.STAT_EVENT,e),this.stat=t}function je(e){const t=Pe();pe(t,new Le(t,e))}function Me(e,t){H.call(this,Ie.Ma,e),this.size=t}function Ue(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ve(){this.g=!0}function Fe(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return be(n)}catch(o){return t}}(e,n)+(r?" "+r:"")})}Ie.La="serverreachability",u(ke,H),Ie.STAT_EVENT="statevent",u(Le,H),Ie.Ma="timingevent",u(Me,H),Ve.prototype.xa=function(){this.g=!1},Ve.prototype.info=function(){};var Be,Ge={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},He={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function We(){}function ze(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ye(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ke}function Ke(){this.i=null,this.g="",this.h=!1}u(We,Se),We.prototype.g=function(){return new XMLHttpRequest},We.prototype.i=function(){return{}},Be=new We;var qe={},Ye={};function Xe(e,t,n){e.L=1,e.v=bt(gt(t)),e.m=n,e.P=!0,Je(e,null)}function Je(e,t){e.F=Date.now(),$e(e),e.A=gt(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Lt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ke,e.g=wn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ve(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(_e[0]=i.toString()),i=_e);for(var s=0;s<i.length;s++){var a=ne(n,i[s],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?R(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),De(),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var a="",o=s.split("&"),c=0;c<o.length;c++){var l=o[c].split("=");if(1<l.length){var d=l[0];l=l[1];var u=d.split("_");a=2<=u.length&&"type"==u[1]?a+(d+"=")+l+"&":a+(d+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Qe(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ze(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ye:(n=Number(t.substring(n,r)),isNaN(n)?qe:(r+=1)+n>t.length?Ye:(t=t.slice(r,r+n),e.C=r+n,t))}function $e(e){e.S=Date.now()+e.I,et(e,e.I)}function et(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ue(l(e.ba,e),t)}function tt(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function nt(e){0==e.j.G||e.J||yn(e.j,e)}function rt(e){tt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,Ee(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function it(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||lt(n.h,e)))if(!e.K&&lt(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(d){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;vn(n),on(n)}mn(n),je(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ue(l(n.Za,n),6e3));if(1>=ct(n.h)&&n.ca){try{n.ca()}catch(d){}n.ca=void 0}}else En(n,11)}else if((e.K||n.g==e)&&vn(n),!S(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=l[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const d=l[5];null!=d&&"number"===typeof d&&0<d&&(r=1.5*d,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(dt(s,s.h),s.h=null))}if(r.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,Et(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((r=n).qa=xn(r,r.J?r.ia:null,r.W),a.K){ut(r.h,a);var o=a,c=r.L;c&&(o.I=c),o.B&&(tt(o),$e(o)),r.g=a}else pn(r);0<n.i.length&&ln(n)}else"stop"!=l[0]&&"close"!=l[0]||En(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?En(n,7):an(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}De()}catch(d){}}ze.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==tn(e)?t.j():this.Y(e)},ze.prototype.Y=function(e){try{if(e==this.g)e:{const h=tn(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=h||7==t||De(),tt(this);var n=this.g.Z();this.X=n;t:if(Qe(this)){var r=nn(this.g);e="";var s=r.length,a=4==tn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){rt(this),nt(this);var o="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(a&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(c)){var d=c;break t}}d=null}if(!(n=d)){this.o=!1,this.s=3,je(12),rt(this),nt(this);break e}Fe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,it(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;){if(e=Ze(this,o),e==Ye){4==h&&(this.s=4,je(14),n=!1),Fe(this.i,this.l,null,"[Incomplete Response]");break}if(e==qe){this.s=4,je(15),Fe(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}Fe(this.i,this.l,e,null),it(this,e)}if(Qe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=o.length||this.h.h||(this.s=1,je(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),fn(u),u.M=!0,je(11))}}else Fe(this.i,this.l,o,"[Invalid Chunked Response]"),rt(this),nt(this)}else Fe(this.i,this.l,o,null),it(this,o);4==h&&rt(this),this.o&&!this.J&&(4==h?yn(this.j,this):(this.o=!1,$e(this)))}else(function(e){const t={};e=(e.g&&2<=tn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(S(e[r]))continue;var n=P(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,je(12)):(this.s=0,je(13)),rt(this),nt(this)}}}catch(h){}},ze.prototype.cancel=function(){this.J=!0,rt(this)},ze.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(De(),je(17)),rt(this),this.s=2,nt(this)):et(this,this.S-e)};var st=class{constructor(e,t){this.g=e,this.map=t}};function at(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ot(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ct(e){return e.h?1:e.g?e.g.size:0}function lt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function dt(e,t){e.g?e.g.add(t):e.h=t}function ut(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ht(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return x(e.i)}function pt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(s(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}at.prototype.cancel=function(){if(this.i=ht(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var mt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ft(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof ft){this.h=e.h,vt(this,e.j),this.o=e.o,this.g=e.g,yt(this,e.s),this.l=e.l;var t=e.i,n=new Ot;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),_t(this,n),this.m=e.m}else e&&(t=String(e).match(mt))?(this.h=!1,vt(this,t[1]||"",!0),this.o=xt(t[2]||""),this.g=xt(t[3]||"",!0),yt(this,t[4]),this.l=xt(t[5]||"",!0),_t(this,t[6]||"",!0),this.m=xt(t[7]||"")):(this.h=!1,this.i=new Ot(null,this.h))}function gt(e){return new ft(e)}function vt(e,t,n){e.j=n?xt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function yt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function _t(e,t,n){t instanceof Ot?(e.i=t,function(e,t){t&&!e.j&&(Pt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(kt(this,t),Lt(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=wt(t,Rt)),e.i=new Ot(t,e.h))}function Et(e,t,n){e.i.set(t,n)}function bt(e){return Et(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function xt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function wt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,St),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function St(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ft.prototype.toString=function(){var e=[],t=this.j;t&&e.push(wt(t,Nt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(wt(t,Nt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(wt(n,"/"==n.charAt(0)?At:Ct,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",wt(n,It)),e.join("")};var Tt,Nt=/[#\/\?@]/g,Ct=/[#\?:]/g,At=/[#\?]/g,Rt=/[#\?@]/g,It=/#/g;function Ot(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Pt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function kt(e,t){Pt(e),t=jt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Dt(e,t){return Pt(e),t=jt(e,t),e.g.has(t)}function Lt(e,t,n){kt(e,t),0<n.length&&(e.i=null,e.g.set(jt(e,t),x(n)),e.h+=n.length)}function jt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Mt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function Ut(){this.g=new we}function Vt(e,t,n){const r=n||"";try{pt(e,function(e,n){let i=e;a(e)&&(i=be(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ft(e){this.l=e.Ub||null,this.j=e.eb||!1}function Bt(e,t){he.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Gt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Ht(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Wt(e)}function Wt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function zt(e){let t="";return A(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Kt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=zt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Et(e,t,n))}function qt(e){he.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Ot.prototype).add=function(e,t){Pt(this),this.i=null,e=jt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Pt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.na=function(){Pt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){Pt(this);let t=[];if("string"===typeof e)Dt(this,e)&&(t=t.concat(this.g.get(jt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Pt(this),this.i=null,Dt(this,e=jt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},u(Ft,Se),Ft.prototype.g=function(){return new Bt(this.l,this.j)},Ft.prototype.i=(Tt={},function(){return Tt}),u(Bt,he),(e=Bt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Wt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ht(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Wt(this)),this.g&&(this.readyState=3,Wt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Gt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ht(this):Wt(this),3==this.readyState&&Gt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Ht(this))},e.Qa=function(e){this.g&&(this.response=e,Ht(this))},e.ga=function(){this.g&&Ht(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Bt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(qt,he);var Yt=/^https?$/i,Xt=["POST","PUT"];function Jt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Qt(e),$t(e)}function Qt(e){e.A||(e.A=!0,pe(e,"complete"),pe(e,"error"))}function Zt(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=tn(e)||2!=e.Z()))if(e.u&&4==tn(e))fe(e.Ea,0,e);else if(pe(e,"readystatechange"),4==tn(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var a=String(e.D).match(mt)[1]||null;!a&&i.self&&i.self.location&&(a=i.self.location.protocol.slice(0,-1)),s=!Yt.test(a?a.toLowerCase():"")}n=s}if(n)pe(e,"complete"),pe(e,"success");else{e.m=6;try{var o=2<tn(e)?e.g.statusText:""}catch(c){o=""}e.l=o+" ["+e.Z()+"]",Qt(e)}}finally{$t(e)}}}function $t(e,t){if(e.g){en(e);const r=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||pe(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function en(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function tn(e){return e.g?e.g.readyState:0}function nn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function rn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function sn(e){this.Aa=0,this.i=[],this.j=new Ve,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,e),this.cb=rn("retryDelaySeedMs",1e4,e),this.Wa=rn("forwardChannelMaxRetries",2,e),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new at(e&&e.concurrentRequestLimit),this.Da=new Ut,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function an(e){if(cn(e),3==e.G){var t=e.U++,n=gt(e.I);if(Et(n,"SID",e.K),Et(n,"RID",t),Et(n,"TYPE","terminate"),un(e,n),(t=new ze(e,e.j,t)).L=2,t.v=bt(gt(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=wn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),$e(t)}bn(e)}function on(e){e.g&&(fn(e),e.g.cancel(),e.g=null)}function cn(e){on(e),e.u&&(i.clearTimeout(e.u),e.u=null),vn(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function ln(e){if(!ot(e.h)&&!e.s){e.s=!0;var t=e.Ga;M||F(),U||(M(),U=!0),V.add(t,e),e.B=0}}function dn(e,t){var n;n=t?t.l:e.U++;const r=gt(e.I);Et(r,"SID",e.K),Et(r,"RID",n),Et(r,"AID",e.T),un(e,r),e.m&&e.o&&Kt(r,e.m,e.o),n=new ze(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=hn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),dt(e.h,n),Xe(n,r,t)}function un(e,t){e.H&&A(e.H,function(e,n){Et(t,n,e)}),e.l&&pt({},function(e,n){Et(t,n,e)})}function hn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?l(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let a=!0;for(let o=0;o<n;o++){let n=i[o].g;const c=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),a=!1;else try{Vt(c,e,"req"+n+"_")}catch(s){r&&r(c)}}if(a){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function pn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;M||F(),U||(M(),U=!0),V.add(t,e),e.v=0}}function mn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Ue(l(e.Fa,e),_n(e,e.v)),e.v++,!0)}function fn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function gn(e){e.g=new ze(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=gt(e.qa);Et(t,"RID","rpc"),Et(t,"SID",e.K),Et(t,"AID",e.T),Et(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&Et(t,"TO",e.ja),Et(t,"TYPE","xmlhttp"),un(e,t),e.m&&e.o&&Kt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=bt(gt(t)),n.m=null,n.P=!0,Je(n,e)}function vn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function yn(e,t){var n=null;if(e.g==t){vn(e),fn(e),e.g=null;var r=2}else{if(!lt(e.h,t))return;n=t.D,ut(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;pe(r=Pe(),new Me(r,n)),ln(e)}else pn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(ct(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Ue(l(e.Ga,e,t),_n(e,e.B)),e.B++,!0))}(e,t)||2==r&&mn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:En(e,5);break;case 4:En(e,10);break;case 3:En(e,6);break;default:En(e,2)}}function _n(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function En(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),r=e.Xa;const t=!r;r=new ft(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||vt(r,"https"),bt(r),t?function(e,t){const n=new Ve;if(i.Image){const r=new Image;r.onload=d(Mt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=d(Mt,n,"TestLoadImage: error",!1,t,r),r.onabort=d(Mt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=d(Mt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ve;const n=new AbortController,r=setTimeout(()=>{n.abort(),Mt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Mt(0,0,!0,t):Mt(0,0,!1,t)}).catch(()=>{clearTimeout(r),Mt(0,0,!1,t)})}(r.toString(),n)}else je(2);e.G=0,e.l&&e.l.sa(t),bn(e),cn(e)}function bn(e){if(e.G=0,e.ka=[],e.l){const t=ht(e.h);0==t.length&&0==e.i.length||(w(e.ka,t),w(e.ka,e.i),e.h.i.length=0,x(e.i),e.i.length=0),e.l.ra()}}function xn(e,t,n){var r=n instanceof ft?gt(n):new ft(n);if(""!=r.g)t&&(r.g=t+"."+r.g),yt(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var a=new ft(null);r&&vt(a,r),t&&(a.g=t),s&&yt(a,s),n&&(a.l=n),r=a}return n=e.D,t=e.ya,n&&t&&Et(r,n,t),Et(r,"VER",e.la),un(e,r),r}function wn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new qt(new Ft({eb:n})):new qt(e.pa)).Ha(e.J),t}function Sn(){}function Tn(){}function Nn(e,t){he.call(this),this.g=new sn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!S(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Rn(this)}function Cn(e){Ae.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function An(){Re.call(this),this.status=1}function Rn(e){this.g=e}(e=qt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Be.g(),this.v=this.o?Te(this.o):Te(Be),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Jt(this,a)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Xt,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of n)this.g.setRequestHeader(i,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{en(this),this.u=!0,this.g.send(e),this.u=!1}catch(a){Jt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,pe(this,"complete"),pe(this,"abort"),$t(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$t(this,!0)),qt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Zt(this):this.bb())},e.bb=function(){Zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<tn(this)?this.g.status:-1}catch(Tt){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(Tt){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),xe(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=sn.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){je(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=xn(this,null,this.W),ln(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new ze(this,this.j,e);let s=this.o;if(this.S&&(s?(s=R(s),O(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=hn(this,i,t),Et(n=gt(this.I),"RID",e),Et(n,"CVER",22),this.D&&Et(n,"X-HTTP-Session-Id",this.D),un(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(zt(s)))+"&"+t:this.m&&Kt(n,this.m,s)),dt(this.h,i),this.Ua&&Et(n,"TYPE","init"),this.P?(Et(n,"$req",t),Et(n,"SID","null"),i.T=!0,Xe(i,n,null)):Xe(i,n,t),this.G=2}}else 3==this.G&&(e?dn(this,e):0==this.i.length||ot(this.h)||dn(this))},e.Fa=function(){if(this.u=null,gn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ue(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,je(10),on(this),gn(this))},e.Za=function(){null!=this.C&&(this.C=null,on(this),mn(this),je(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),je(2)):(this.j.info("Failed to ping google.com"),je(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=Sn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},Tn.prototype.g=function(e,t){return new Nn(e,t)},u(Nn,he),Nn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Nn.prototype.close=function(){an(this.g)},Nn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=be(e),e=n);t.i.push(new st(t.Ya++,e)),3==t.G&&ln(t)},Nn.prototype.N=function(){this.g.l=null,delete this.j,an(this.g),delete this.g,Nn.aa.N.call(this)},u(Cn,Ae),u(An,Re),u(Rn,Sn),Rn.prototype.ua=function(){pe(this.g,"a")},Rn.prototype.ta=function(e){pe(this.g,new Cn(e))},Rn.prototype.sa=function(e){pe(this.g,new An)},Rn.prototype.ra=function(){pe(this.g,"b")},Tn.prototype.createWebChannel=Tn.prototype.g,Nn.prototype.send=Nn.prototype.o,Nn.prototype.open=Nn.prototype.m,Nn.prototype.close=Nn.prototype.close,_=b.createWebChannelTransport=function(){return new Tn},y=b.getStatEventTarget=function(){return Pe()},v=b.Event=Ie,g=b.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ge.NO_ERROR=0,Ge.TIMEOUT=8,Ge.HTTP_ERROR=6,f=b.ErrorCode=Ge,He.COMPLETE="complete",m=b.EventType=He,Ne.EventType=Ce,Ce.OPEN="a",Ce.CLOSE="b",Ce.ERROR="c",Ce.MESSAGE="d",he.prototype.listen=he.prototype.K,p=b.WebChannel=Ne,b.FetchXmlHttpFactory=Ft,qt.prototype.listenOnce=qt.prototype.L,qt.prototype.getLastError=qt.prototype.Ka,qt.prototype.getLastErrorCode=qt.prototype.Ba,qt.prototype.getStatus=qt.prototype.Z,qt.prototype.getResponseJson=qt.prototype.Oa,qt.prototype.getResponseText=qt.prototype.oa,qt.prototype.send=qt.prototype.ea,qt.prototype.setWithCredentials=qt.prototype.Ha,h=b.XhrIo=qt}).apply("undefined"!==typeof E?E:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const x="@firebase/firestore",w="4.9.1";class S{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}S.UNAUTHENTICATED=new S(null),S.GOOGLE_CREDENTIALS=new S("google-credentials-uid"),S.FIRST_PARTY=new S("first-party-uid"),S.MOCK_USER=new S("mock-user");let T="12.2.0";const N=new c.Vy("@firebase/firestore");function C(){return N.logLevel}function A(e){if(N.logLevel<=c.$b.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(O);N.debug("Firestore (".concat(T,"): ").concat(e),...i)}}function R(e){if(N.logLevel<=c.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(O);N.error("Firestore (".concat(T,"): ").concat(e),...i)}}function I(e){if(N.logLevel<=c.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(O);N.warn("Firestore (".concat(T,"): ").concat(e),...i)}}function O(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function P(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,k(e,r,n)}function k(e,t,n){let r="FIRESTORE (".concat(T,") INTERNAL ASSERTION FAILED: ").concat(t," (ID: ").concat(e.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw R(r),new Error(r)}function D(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||k(t,i,r)}function L(e,t){return e}const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class M extends l.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class U{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class V{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class F{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(S.UNAUTHENTICATED))}shutdown(){}}class B{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class G{constructor(e){this.t=e,this.currentUser=S.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){D(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new U;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new U,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{A("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(A("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new U)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(A("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(D("string"==typeof t.accessToken,31837,{l:t}),new V(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return D(null===e||"string"==typeof e,2055,{h:e}),new S(e)}}class H{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=S.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class W{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new H(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(S.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class z{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class K{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,a.xZ)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){D(void 0===this.o,3512);const n=e=>{null!=e.error&&A("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.m;return this.m=e.token,A("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{A("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):A("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new z(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(D("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new z(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function q(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class Y{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=q(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function X(e,t){return e<t?-1:e>t?1:0}function J(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),i=t.charAt(r);if(n!==i)return $(n)===$(i)?X(n,i):$(n)?1:-1}return X(e.length,t.length)}const Q=55296,Z=57343;function $(e){const t=e.charCodeAt(0);return t>=Q&&t<=Z}function ee(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const te="__name__";class ne{constructor(e,t,n){void 0===t?t=0:t>e.length&&P(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&P(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ne.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ne?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=ne.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return X(e.length,t.length)}static compareSegments(e,t){const n=ne.isNumericId(e),r=ne.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ne.extractNumericId(e).compare(ne.extractNumericId(t)):J(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return r.fromString(e.substring(4,e.length-2))}}class re extends ne{construct(e,t,n){return new re(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new M(j.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter(e=>e.length>0))}return new re(e)}static emptyPath(){return new re([])}}const ie=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class se extends ne{construct(e,t,n){return new se(e,t,n)}static isValidIdentifier(e){return ie.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),se.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===te}static keyField(){return new se([te])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new M(j.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new M(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new M(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new M(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new se(t)}static emptyPath(){return new se([])}}class ae{constructor(e){this.path=e}static fromPath(e){return new ae(re.fromString(e))}static fromName(e){return new ae(re.fromString(e).popFirst(5))}static empty(){return new ae(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===re.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ae(new re(e.slice()))}}function oe(e,t,n){if(!n)throw new M(j.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function ce(e){if(!ae.isDocumentKey(e))throw new M(j.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function le(e){if(ae.isDocumentKey(e))throw new M(j.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function de(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ue(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":P(12329,{type:typeof e})}function he(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new M(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ue(e);throw new M(j.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function pe(e,t){if(t<=0)throw new M(j.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}function me(e,t){const n={typeString:e};return t&&(n.value=t),n}function fe(e,t){if(!de(e))throw new M(j.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n="JSON missing required field: '".concat(r,"'");break}const a=e[r];if(i&&typeof a!==i){n="JSON field '".concat(r,"' must be a ").concat(i,".");break}if(void 0!==s&&a!==s.value){n="Expected '".concat(r,"' field to equal '").concat(s.value,"'");break}}if(n)throw new M(j.INVALID_ARGUMENT,n);return!0}const ge=-62135596800,ve=1e6;class ye{static now(){return ye.fromMillis(Date.now())}static fromDate(e){return ye.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*ve);return new ye(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ge)throw new M(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ve}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ye._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(fe(e,ye._jsonSchema))return new ye(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ge;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ye._jsonSchemaVersion="firestore/timestamp/1.0",ye._jsonSchema={type:me("string",ye._jsonSchemaVersion),seconds:me("number"),nanoseconds:me("number")};class _e{static fromTimestamp(e){return new _e(e)}static min(){return new _e(new ye(0,0))}static max(){return new _e(new ye(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ee=-1;class be{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}be.UNKNOWN_ID=-1;function xe(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=_e.fromTimestamp(1e9===r?new ye(n+1,0):new ye(n,r));return new Se(i,ae.empty(),t)}function we(e){return new Se(e.readTime,e.key,Ee)}class Se{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Se(_e.min(),ae.empty(),Ee)}static max(){return new Se(_e.max(),ae.empty(),Ee)}}function Te(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ae.comparator(e.documentKey,t.documentKey),0!==n?n:X(e.largestBatchId,t.largestBatchId))}const Ne="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ce{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Ae(e){if(e.code!==j.FAILED_PRECONDITION||e.message!==Ne)throw e;A("LocalStore","Unexpectedly lost primary lease")}class Re{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&P(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Re((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Re?t:Re.resolve(t)}catch(e){return Re.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Re.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Re.reject(t)}static resolve(e){return new Re((t,n)=>{t(e)})}static reject(e){return new Re((t,n)=>{n(e)})}static waitFor(e){return new Re((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Re.resolve(!1);for(const n of e)t=t.next(e=>e?Re.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Re((n,r)=>{const i=e.length,s=new Array(i);let a=0;for(let o=0;o<i;o++){const c=o;t(e[c]).next(e=>{s[c]=e,++a,a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new Re((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function Ie(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Oe(e){return"IndexedDbTransactionError"===e.name}class Pe{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Pe.ce=-1;const ke=-1;function De(e){return null==e}function Le(e){return 0===e&&1/e==-1/0}function je(e){return"number"==typeof e&&Number.isInteger(e)&&!Le(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Me="\x01";function Ue(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Fe(t)),t=Ve(e.get(n),t);return Fe(t)}function Ve(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case Me:n+="\x01\x11";break;default:n+=t}}return n}function Fe(e){return e+Me+"\x01"}const Be="remoteDocuments",Ge="owner",He="mutationQueues",We="mutations";const ze="documentMutations",Ke="remoteDocumentsV14",qe="remoteDocumentGlobal",Ye="targets",Xe="targetDocuments",Je="targetGlobal",Qe="collectionParents",Ze="clientMetadata",$e="bundles",et="namedQueries",tt="indexConfiguration",nt="indexState",rt="indexEntries",it="documentOverlays",st="globals",at=[He,We,ze,Be,Ye,Ge,Je,Xe,Ze,qe,Qe,$e,et],ot=[He,We,ze,Ke,Ye,Ge,Je,Xe,Ze,qe,Qe,$e,et,it],ct=ot,lt=[...ct,tt,nt,rt];function dt(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ut(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ht(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class pt{constructor(e,t){this.comparator=e,this.root=t||ft.EMPTY}insert(e,t){return new pt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ft.BLACK,null,null))}remove(e){return new pt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ft.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new mt(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new mt(this.root,e,this.comparator,!1)}getReverseIterator(){return new mt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new mt(this.root,e,this.comparator,!0)}}class mt{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ft{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ft.RED,this.left=null!=r?r:ft.EMPTY,this.right=null!=i?i:ft.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ft(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ft.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ft.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw P(43730,{key:this.key,value:this.value});if(this.right.isRed())throw P(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw P(27949);return e+(this.isRed()?0:1)}}ft.EMPTY=null,ft.RED=!0,ft.BLACK=!1,ft.EMPTY=new class{constructor(){this.size=0}get key(){throw P(57766)}get value(){throw P(16141)}get color(){throw P(16727)}get left(){throw P(29726)}get right(){throw P(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new ft(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class gt{constructor(e){this.comparator=e,this.data=new pt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new vt(this.data.getIterator())}getIteratorFrom(e){return new vt(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof gt))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new gt(this.comparator);return t.data=e,t}}class vt{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class yt{constructor(e){this.fields=e,e.sort(se.comparator)}static empty(){return new yt([])}unionWith(e){let t=new gt(se.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new yt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ee(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class _t extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Et{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new _t("Invalid base64 string: "+e):e}}(e);return new Et(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Et(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Et.EMPTY_BYTE_STRING=new Et("");const bt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xt(e){if(D(!!e,39018),"string"==typeof e){let t=0;const n=bt.exec(e);if(D(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:wt(e.seconds),nanos:wt(e.nanos)}}function wt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function St(e){return"string"==typeof e?Et.fromBase64String(e):Et.fromUint8Array(e)}const Tt="server_timestamp",Nt="__type__",Ct="__previous_value__",At="__local_write_time__";function Rt(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[Nt])||void 0===t?void 0:t.stringValue)===Tt}function It(e){const t=e.mapValue.fields[Ct];return Rt(t)?It(t):t}function Ot(e){const t=xt(e.mapValue.fields[At].timestampValue);return new ye(t.seconds,t.nanos)}class Pt{constructor(e,t,n,r,i,s,a,o,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=c,this.isUsingEmulator=l}}const kt="(default)";class Dt{constructor(e,t){this.projectId=e,this.database=t||kt}static empty(){return new Dt("","")}get isDefaultDatabase(){return this.database===kt}isEqual(e){return e instanceof Dt&&e.projectId===this.projectId&&e.database===this.database}}const Lt="__type__",jt="__max__",Mt={mapValue:{fields:{__type__:{stringValue:jt}}}},Ut="__vector__",Vt="value";function Ft(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Rt(e)?4:rn(e)?9007199254740991:tn(e)?10:11:P(28295,{value:e})}function Bt(e,t){if(e===t)return!0;const n=Ft(e);if(n!==Ft(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ot(e).isEqual(Ot(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=xt(e.timestampValue),r=xt(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return St(e.bytesValue).isEqual(St(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return wt(e.geoPointValue.latitude)===wt(t.geoPointValue.latitude)&&wt(e.geoPointValue.longitude)===wt(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return wt(e.integerValue)===wt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=wt(e.doubleValue),r=wt(t.doubleValue);return n===r?Le(n)===Le(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ee(e.arrayValue.values||[],t.arrayValue.values||[],Bt);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(dt(n)!==dt(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Bt(n[i],r[i])))return!1;return!0}(e,t);default:return P(52216,{left:e})}}function Gt(e,t){return void 0!==(e.values||[]).find(e=>Bt(e,t))}function Ht(e,t){if(e===t)return 0;const n=Ft(e),r=Ft(t);if(n!==r)return X(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return X(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=wt(e.integerValue||e.doubleValue),r=wt(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Wt(e.timestampValue,t.timestampValue);case 4:return Wt(Ot(e),Ot(t));case 5:return J(e.stringValue,t.stringValue);case 6:return function(e,t){const n=St(e),r=St(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=X(n[i],r[i]);if(0!==e)return e}return X(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=X(wt(e.latitude),wt(t.latitude));return 0!==n?n:X(wt(e.longitude),wt(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return zt(e.arrayValue,t.arrayValue);case 10:return function(e,t,n,r,i,s){const a=e.fields||{},o=t.fields||{},c=null===(n=a[Vt])||void 0===n?void 0:n.arrayValue,l=null===(r=o[Vt])||void 0===r?void 0:r.arrayValue,d=X((null===c||void 0===c||null===(i=c.values)||void 0===i?void 0:i.length)||0,(null===l||void 0===l||null===(s=l.values)||void 0===s?void 0:s.length)||0);return 0!==d?d:zt(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Mt.mapValue&&t===Mt.mapValue)return 0;if(e===Mt.mapValue)return 1;if(t===Mt.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let a=0;a<r.length&&a<s.length;++a){const e=J(r[a],s[a]);if(0!==e)return e;const t=Ht(n[r[a]],i[s[a]]);if(0!==t)return t}return X(r.length,s.length)}(e.mapValue,t.mapValue);default:throw P(23264,{he:n})}}function Wt(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return X(e,t);const n=xt(e),r=xt(t),i=X(n.seconds,r.seconds);return 0!==i?i:X(n.nanos,r.nanos)}function zt(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Ht(n[i],r[i]);if(e)return e}return X(n.length,r.length)}function Kt(e){return qt(e)}function qt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=xt(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return St(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ae.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=qt(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(qt(e.fields[i]));return n+"}"}(e.mapValue):P(61005,{value:e})}function Yt(e){switch(Ft(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=It(e);return t?16+Yt(t):16;case 5:return 2*e.stringValue.length;case 6:return St(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+Yt(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return ut(e.fields,(e,n)=>{t+=e.length+Yt(n)}),t}(e.mapValue);default:throw P(13486,{value:e})}}function Xt(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Jt(e){return!!e&&"integerValue"in e}function Qt(e){return!!e&&"arrayValue"in e}function Zt(e){return!!e&&"nullValue"in e}function $t(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function en(e){return!!e&&"mapValue"in e}function tn(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[Lt])||void 0===t?void 0:t.stringValue)===Ut}function nn(e){if(e.geoPointValue)return{geoPointValue:(0,s.A)({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:(0,s.A)({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ut(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=nn(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=nn(e.arrayValue.values[n]);return t}return(0,s.A)({},e)}function rn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===jt}class sn{constructor(e){this.value=e}static empty(){return new sn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!en(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nn(t)}setAll(e){let t=se.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=nn(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());en(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Bt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];en(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ut(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new sn(nn(this.value))}}function an(e){const t=[];return ut(e.fields,(e,n)=>{const r=new se([e]);if(en(n)){const e=an(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new yt(t)}class on{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new on(e,0,_e.min(),_e.min(),_e.min(),sn.empty(),0)}static newFoundDocument(e,t,n,r){return new on(e,1,t,_e.min(),n,r,0)}static newNoDocument(e,t){return new on(e,2,t,_e.min(),_e.min(),sn.empty(),0)}static newUnknownDocument(e,t){return new on(e,3,t,_e.min(),_e.min(),sn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(_e.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=_e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof on&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new on(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class cn{constructor(e,t){this.position=e,this.inclusive=t}}function ln(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?ae.comparator(ae.fromName(a.referenceValue),n.key):Ht(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function dn(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Bt(e.position[n],t.position[n]))return!1;return!0}class un{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function hn(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class pn{}class mn extends pn{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new xn(e,t,n):"array-contains"===t?new Nn(e,n):"in"===t?new Cn(e,n):"not-in"===t?new An(e,n):"array-contains-any"===t?new Rn(e,n):new mn(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new wn(e,n):new Sn(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Ht(t,this.value)):null!==t&&Ft(this.value)===Ft(t)&&this.matchesComparison(Ht(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return P(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fn extends pn{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new fn(e,t)}matches(e){return gn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function gn(e){return"and"===e.op}function vn(e){return yn(e)&&gn(e)}function yn(e){for(const t of e.filters)if(t instanceof fn)return!1;return!0}function _n(e){if(e instanceof mn)return e.field.canonicalString()+e.op.toString()+Kt(e.value);if(vn(e))return e.filters.map(e=>_n(e)).join(",");{const t=e.filters.map(e=>_n(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function En(e,t){return e instanceof mn?function(e,t){return t instanceof mn&&e.op===t.op&&e.field.isEqual(t.field)&&Bt(e.value,t.value)}(e,t):e instanceof fn?function(e,t){return t instanceof fn&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&En(n,t.filters[r]),!0)}(e,t):void P(19439)}function bn(e){return e instanceof mn?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Kt(e.value))}(e):e instanceof fn?function(e){return e.op.toString()+" {"+e.getFilters().map(bn).join(" ,")+"}"}(e):"Filter"}class xn extends mn{constructor(e,t,n){super(e,t,n),this.key=ae.fromName(n.referenceValue)}matches(e){const t=ae.comparator(e.key,this.key);return this.matchesComparison(t)}}class wn extends mn{constructor(e,t){super(e,"in",t),this.keys=Tn("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Sn extends mn{constructor(e,t){super(e,"not-in",t),this.keys=Tn("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Tn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>ae.fromName(e.referenceValue))}class Nn extends mn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qt(t)&&Gt(t.arrayValue,this.value)}}class Cn extends mn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Gt(this.value.arrayValue,t)}}class An extends mn{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Gt(this.value.arrayValue,t)}}class Rn extends mn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qt(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Gt(this.value.arrayValue,e))}}class In{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function On(e){return new In(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Pn(e){const t=L(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>_n(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),De(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Kt(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Kt(e)).join(",")),t.Te=e}return t.Te}function kn(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!hn(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!En(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!dn(e.startAt,t.startAt)&&dn(e.endAt,t.endAt)}function Dn(e){return ae.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Ln{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function jn(e,t,n,r,i,s,a,o){return new Ln(e,t,n,r,i,s,a,o)}function Mn(e){return new Ln(e)}function Un(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Vn(e){return null!==e.collectionGroup}function Fn(e){const t=L(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new gt(se.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new un(r,n))}),e.has(se.keyField().canonicalString())||t.Ie.push(new un(se.keyField(),n))}return t.Ie}function Bn(e){const t=L(e);return t.Ee||(t.Ee=Gn(t,Fn(e))),t.Ee}function Gn(e,t){if("F"===e.limitType)return On(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new un(e.field,t)});const n=e.endAt?new cn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new cn(e.startAt.position,e.startAt.inclusive):null;return On(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Hn(e,t){const n=e.filters.concat([t]);return new Ln(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Wn(e,t,n){return new Ln(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function zn(e,t){return kn(Bn(e),Bn(t))&&e.limitType===t.limitType}function Kn(e){return"".concat(Pn(Bn(e)),"|lt:").concat(e.limitType)}function qn(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>bn(e)).join(", "),"]")),De(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Kt(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Kt(e)).join(",")),"Target(".concat(t,")")}(Bn(e)),"; limitType=").concat(e.limitType,")")}function Yn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ae.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Fn(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ln(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Fn(e),t))&&!(e.endAt&&!function(e,t,n){const r=ln(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Fn(e),t))}(e,t)}function Xn(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Jn(e){return(t,n)=>{let r=!1;for(const i of Fn(e)){const e=Qn(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Qn(e,t,n){const r=e.field.isKeyField()?ae.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ht(r,i):P(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return P(19790,{direction:e.dir})}}class Zn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ut(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return ht(this.inner)}size(){return this.innerSize}}const $n=new pt(ae.comparator);function er(){return $n}const tr=new pt(ae.comparator);function nr(){let e=tr;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function rr(e){let t=tr;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function ir(){return ar()}function sr(){return ar()}function ar(){return new Zn(e=>e.toString(),(e,t)=>e.isEqual(t))}const or=new pt(ae.comparator),cr=new gt(ae.comparator);function lr(){let e=cr;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const dr=new gt(X);function ur(){return dr}function hr(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Le(t)?"-0":t}}function pr(e){return{integerValue:""+e}}function mr(e,t){return je(t)?pr(t):hr(e,t)}class fr{constructor(){this._=void 0}}function gr(e,t,n){return e instanceof _r?function(e,t){const n={fields:{[Nt]:{stringValue:Tt},[At]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Rt(t)&&(t=It(t)),t&&(n.fields[Ct]=t),{mapValue:n}}(n,t):e instanceof Er?br(e,t):e instanceof xr?wr(e,t):function(e,t){const n=yr(e,t),r=Tr(n)+Tr(e.Ae);return Jt(n)&&Jt(e.Ae)?pr(r):hr(e.serializer,r)}(e,t)}function vr(e,t,n){return e instanceof Er?br(e,t):e instanceof xr?wr(e,t):n}function yr(e,t){return e instanceof Sr?function(e){return Jt(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class _r extends fr{}class Er extends fr{constructor(e){super(),this.elements=e}}function br(e,t){const n=Nr(t);for(const r of e.elements)n.some(e=>Bt(e,r))||n.push(r);return{arrayValue:{values:n}}}class xr extends fr{constructor(e){super(),this.elements=e}}function wr(e,t){let n=Nr(t);for(const r of e.elements)n=n.filter(e=>!Bt(e,r));return{arrayValue:{values:n}}}class Sr extends fr{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Tr(e){return wt(e.integerValue||e.doubleValue)}function Nr(e){return Qt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Cr{constructor(e,t){this.field=e,this.transform=t}}class Ar{constructor(e,t){this.version=e,this.transformResults=t}}class Rr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Rr}static exists(e){return new Rr(void 0,e)}static updateTime(e){return new Rr(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ir(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Or{}function Pr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Gr(e.key,Rr.none()):new Mr(e.key,e.data,Rr.none());{const n=e.data,r=sn.empty();let i=new gt(se.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Ur(e.key,r,new yt(i.toArray()),Rr.none())}}function kr(e,t,n){e instanceof Mr?function(e,t,n){const r=e.value.clone(),i=Fr(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ur?function(e,t,n){if(!Ir(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Fr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Vr(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Dr(e,t,n,r){return e instanceof Mr?function(e,t,n,r){if(!Ir(e.precondition,t))return n;const i=e.value.clone(),s=Br(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Ur?function(e,t,n,r){if(!Ir(e.precondition,t))return n;const i=Br(e.fieldTransforms,r,t),s=t.data;return s.setAll(Vr(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return Ir(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Lr(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=yr(r.transform,e||null);null!=i&&(null===n&&(n=sn.empty()),n.set(r.field,i))}return n||null}function jr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ee(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Er&&t instanceof Er||e instanceof xr&&t instanceof xr?ee(e.elements,t.elements,Bt):e instanceof Sr&&t instanceof Sr?Bt(e.Ae,t.Ae):e instanceof _r&&t instanceof _r}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Mr extends Or{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ur extends Or{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Vr(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function Fr(e,t,n){const r=new Map;D(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let i=0;i<n.length;i++){const s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,vr(a,o,n[i]))}return r}function Br(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,gr(e,s,t))}return r}class Gr extends Or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Hr extends Or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Wr{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&kr(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Dr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Dr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=sr();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let a=this.applyToLocalView(s,i.mutatedFields);a=t.has(r.key)?null:a;const o=Pr(s,a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(_e.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),lr())}isEqual(e){return this.batchId===e.batchId&&ee(this.mutations,e.mutations,(e,t)=>jr(e,t))&&ee(this.baseMutations,e.baseMutations,(e,t)=>jr(e,t))}}class zr{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){D(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=or;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new zr(e,t,n,r)}}class Kr{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class qr{constructor(e,t){this.count=e,this.unchangedNames=t}}var Yr,Xr;function Jr(e){switch(e){case j.OK:return P(64938);case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0;default:return P(15467,{code:e})}}function Qr(e){if(void 0===e)return R("GRPC error has no .code"),j.UNKNOWN;switch(e){case Yr.OK:return j.OK;case Yr.CANCELLED:return j.CANCELLED;case Yr.UNKNOWN:return j.UNKNOWN;case Yr.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case Yr.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case Yr.INTERNAL:return j.INTERNAL;case Yr.UNAVAILABLE:return j.UNAVAILABLE;case Yr.UNAUTHENTICATED:return j.UNAUTHENTICATED;case Yr.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case Yr.NOT_FOUND:return j.NOT_FOUND;case Yr.ALREADY_EXISTS:return j.ALREADY_EXISTS;case Yr.PERMISSION_DENIED:return j.PERMISSION_DENIED;case Yr.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case Yr.ABORTED:return j.ABORTED;case Yr.OUT_OF_RANGE:return j.OUT_OF_RANGE;case Yr.UNIMPLEMENTED:return j.UNIMPLEMENTED;case Yr.DATA_LOSS:return j.DATA_LOSS;default:return P(39323,{code:e})}}(Xr=Yr||(Yr={}))[Xr.OK=0]="OK",Xr[Xr.CANCELLED=1]="CANCELLED",Xr[Xr.UNKNOWN=2]="UNKNOWN",Xr[Xr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xr[Xr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xr[Xr.NOT_FOUND=5]="NOT_FOUND",Xr[Xr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xr[Xr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xr[Xr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xr[Xr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xr[Xr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xr[Xr.ABORTED=10]="ABORTED",Xr[Xr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xr[Xr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xr[Xr.INTERNAL=13]="INTERNAL",Xr[Xr.UNAVAILABLE=14]="UNAVAILABLE",Xr[Xr.DATA_LOSS=15]="DATA_LOSS";let Zr=null;function $r(){return new TextEncoder}const ei=new r([4294967295,4294967295],0);function ti(e){const t=$r().encode(e),n=new i;return n.update(t),new Uint8Array(n.digest())}function ni(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new r([n,i],0),new r([s,a],0)]}class ri{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ii("Invalid padding: ".concat(t));if(n<0)throw new ii("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new ii("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new ii("Invalid padding when bitmap length is 0: ".concat(t));this.ge=8*e.length-t,this.pe=r.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(r.fromNumber(n)));return 1===i.compare(ei)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=ti(e),[n,r]=ni(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);if(!this.we(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new ri(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.ge)return;const t=ti(e),[n,r]=ni(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ii extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class si{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ai.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new si(_e.min(),r,new pt(X),er(),lr())}}class ai{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ai(n,t,lr(),lr(),lr())}}class oi{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class ci{constructor(e,t){this.targetId=e,this.Ce=t}}class li{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Et.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class di{constructor(){this.ve=0,this.Fe=pi(),this.Me=Et.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=lr(),t=lr(),n=lr();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:P(38017,{changeType:i})}}),new ai(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=pi()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,D(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ui{constructor(e){this.Ge=e,this.ze=new Map,this.je=er(),this.Je=hi(),this.He=hi(),this.Ye=new pt(X)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:P(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(Dn(s))if(0===n){const e=new ae(s.path);this.et(t,e,on.newNoDocument(e,_e.min()))}else D(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){var i;const n=this.ut(e),s=n?this.ct(n,e,r):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}null===(i=Zr)||void 0===i||i.lt(function(e,t,n,r,i,s,a,o,c,l){const d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},u=t.unchangedNames;return u&&(d.bloomFilter={applied:0===i,hashCount:null!==(s=null===u||void 0===u?void 0:u.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(a=null===u||void 0===u||null===(o=u.bits)||void 0===o||null===(o=o.bitmap)||void 0===o?void 0:o.length)&&void 0!==a?a:0,padding:null!==(c=null===u||void 0===u||null===(l=u.bits)||void 0===l?void 0:l.padding)&&void 0!==c?c:0,mightContain:e=>{var t;return null!==(t=null===r||void 0===r?void 0:r.mightContain(e))&&void 0!==t&&t}}),d}(r,e.Ce,this.Ge.ht(),n,s))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,a;try{s=St(n).toUint8Array()}catch(e){if(e instanceof _t)return I("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new ri(s,r,i)}catch(e){return I(e instanceof ii?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.ge?null:a}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.Ge.ht(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((n,r)=>{const i=this.ot(r);if(i){if(n.current&&Dn(i.target)){const t=new ae(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,on.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=lr();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const r=new si(e,t,this.Ye,this.je,n);return this.je=er(),this.Je=hi(),this.He=hi(),this.Ye=new pt(X),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new di,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new gt(X),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new gt(X),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||A("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new di),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function hi(){return new pt(ae.comparator)}function pi(){return new pt(ae.comparator)}const mi={asc:"ASCENDING",desc:"DESCENDING"},fi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gi={and:"AND",or:"OR"};class vi{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function yi(e,t){return e.useProto3Json||De(t)?t:{value:t}}function _i(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ei(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function bi(e,t){return _i(e,t.toTimestamp())}function xi(e){return D(!!e,49232),_e.fromTimestamp(function(e){const t=xt(e);return new ye(t.seconds,t.nanos)}(e))}function wi(e,t){return Si(e,t).canonicalString()}function Si(e,t){const n=function(e){return new re(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ti(e){const t=re.fromString(e);return D(zi(t),10190,{key:t.toString()}),t}function Ni(e,t){return wi(e.databaseId,t.path)}function Ci(e,t){const n=Ti(t);if(n.get(1)!==e.databaseId.projectId)throw new M(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new M(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ae(Oi(n))}function Ai(e,t){return wi(e.databaseId,t)}function Ri(e){const t=Ti(e);return 4===t.length?re.emptyPath():Oi(t)}function Ii(e){return new re(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Oi(e){return D(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Pi(e,t,n){return{name:Ni(e,t),fields:n.value.mapValue.fields}}function ki(e,t){let n;if(t instanceof Mr)n={update:Pi(e,t.key,t.value)};else if(t instanceof Gr)n={delete:Ni(e,t.key)};else if(t instanceof Ur)n={update:Pi(e,t.key,t.data),updateMask:Wi(t.fieldMask)};else{if(!(t instanceof Hr))return P(16599,{Vt:t.type});n={verify:Ni(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof _r)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Er)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof xr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Sr)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw P(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:bi(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:P(27497)}(e,t.precondition)),n}function Di(e,t){return{documents:[Ai(e,t.path)]}}function Li(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ai(e,i);const s=function(e){if(0!==e.length)return Hi(fn.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Bi(e.field),direction:Ui(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=yi(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:i}}function ji(e){let t=Ri(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){D(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Mi(e);return t instanceof fn&&vn(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new un(Gi(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,De(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new cn(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new cn(n,t)}(n.endAt)),jn(t,i,a,s,o,"F",c,l)}function Mi(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Gi(e.unaryFilter.field);return mn.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Gi(e.unaryFilter.field);return mn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Gi(e.unaryFilter.field);return mn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Gi(e.unaryFilter.field);return mn.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return P(61313);default:return P(60726)}}(e):void 0!==e.fieldFilter?function(e){return mn.create(Gi(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return P(58110);default:return P(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return fn.create(e.compositeFilter.filters.map(e=>Mi(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return P(1026)}}(e.compositeFilter.op))}(e):P(30097,{filter:e})}function Ui(e){return mi[e]}function Vi(e){return fi[e]}function Fi(e){return gi[e]}function Bi(e){return{fieldPath:e.canonicalString()}}function Gi(e){return se.fromServerFormat(e.fieldPath)}function Hi(e){return e instanceof mn?function(e){if("=="===e.op){if($t(e.value))return{unaryFilter:{field:Bi(e.field),op:"IS_NAN"}};if(Zt(e.value))return{unaryFilter:{field:Bi(e.field),op:"IS_NULL"}}}else if("!="===e.op){if($t(e.value))return{unaryFilter:{field:Bi(e.field),op:"IS_NOT_NAN"}};if(Zt(e.value))return{unaryFilter:{field:Bi(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bi(e.field),op:Vi(e.op),value:e.value}}}(e):e instanceof fn?function(e){const t=e.getFilters().map(e=>Hi(e));return 1===t.length?t[0]:{compositeFilter:{op:Fi(e.op),filters:t}}}(e):P(54877,{filter:e})}function Wi(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function zi(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Ki{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_e.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:_e.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Et.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Ki(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ki(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ki(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ki(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class qi{constructor(e){this.yt=e}}function Yi(e){const t=ji({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Wn(t,t.limit,"L"):t}class Xi{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(wt(e.integerValue));else if("doubleValue"in e){const n=wt(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Le(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=xt(n)),t.xt("".concat(n.seconds||"")),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(St(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?rn(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):tn(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):P(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){var n;const r=e.fields||{};this.Ft(t,53);const i=Vt,s=(null===(n=r[i].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(t,15),t.Mt(wt(s)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const r of n)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),ae.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Xi.Kt=new Xi;class Ji{constructor(){this.Cn=new Qi}addToCollectionParentIndex(e,t){return this.Cn.add(t),Re.resolve()}getCollectionParents(e,t){return Re.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Re.resolve()}deleteFieldIndex(e,t){return Re.resolve()}deleteAllFieldIndexes(e){return Re.resolve()}createTargetIndexes(e,t){return Re.resolve()}getDocumentsMatchingTarget(e,t){return Re.resolve(null)}getIndexType(e,t){return Re.resolve(0)}getFieldIndexes(e,t){return Re.resolve([])}getNextCollectionGroupToUpdate(e){return Re.resolve(null)}getMinOffset(e,t){return Re.resolve(Se.min())}getMinOffsetFromCollectionGroup(e,t){return Re.resolve(Se.min())}updateCollectionGroup(e,t,n){return Re.resolve()}updateIndexEntries(e,t){return Re.resolve()}}class Qi{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new gt(re.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new gt(re.comparator)).toArray()}}new Uint8Array(0);const Zi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$i=41943040;class es{static withCacheSize(e){return new es(e,es.DEFAULT_COLLECTION_PERCENTILE,es.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}es.DEFAULT_COLLECTION_PERCENTILE=10,es.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,es.DEFAULT=new es($i,es.DEFAULT_COLLECTION_PERCENTILE,es.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),es.DISABLED=new es(-1,0,0);class ts{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new ts(0)}static cr(){return new ts(-1)}}const ns="LruGarbageCollector",rs=1048576;function is(e,t){let[n,r]=e,[i,s]=t;const a=X(n,i);return 0===a?X(r,s):a}class ss{constructor(e){this.Ir=e,this.buffer=new gt(is),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();is(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class as{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){A(ns,"Garbage collection scheduled in ".concat(e,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Oe(e)?A(ns,"Ignoring IndexedDB error during garbage collection: ",e):await Ae(e)}await this.Vr(3e5)})}}class os{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Re.resolve(Pe.ce);const n=new ss(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector","Garbage collection skipped; disabled"),Re.resolve(Zi)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),Zi):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,a,o,l;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(A("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),C()<=c.$b.DEBUG&&A("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(s-d,"ms\n\tDetermined least recently used ").concat(r," in ")+(a-s)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(o-a)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(l-o)+"ms\n"+"Total Duration: ".concat(l-d,"ms")),Re.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function cs(e,t){return new os(e,t)}class ls{constructor(){this.changes=new Zn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,on.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Re.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ds{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class us{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Dr(n.mutation,e,yt.empty(),ye.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,lr()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lr();const r=ir();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=nr();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=ir();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,lr()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=er();const s=ar(),a=ar();return t.forEach((e,t)=>{const a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof Ur)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),Dr(a.mutation,t,a.mutation.getFieldMask(),ye.now())):s.set(t.key,yt.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new ds(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=ar();let r=new pt((e,t)=>e-t),i=lr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let a=n.get(e)||yt.empty();a=i.applyToLocalView(s,a),n.set(e,a);const o=(r.get(i.batchId)||lr()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{const s=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,c=r.value,l=sr();c.forEach(e=>{if(!i.has(e)){const r=Pr(t.get(e),n.get(e));null!==r&&l.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,l))}return Re.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ae.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Vn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Re.resolve(ir());let a=Ee,o=i;return s.next(t=>Re.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?Re.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,lr())).next(e=>({batchId:a,changes:rr(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ae(t)).next(e=>{let t=nr();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=nr();return this.indexManager.getCollectionParents(e,i).next(a=>Re.forEach(a,a=>{const o=function(e,t){return new Ln(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,on.newInvalidDocument(r)))});let n=nr();return e.forEach((e,r)=>{const s=i.get(e);void 0!==s&&Dr(s.mutation,r,yt.empty(),ye.now()),Yn(t,r)&&(n=n.insert(e,r))}),n})}}class hs{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Re.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:xi(e.createTime)}}(t)),Re.resolve()}getNamedQuery(e,t){return Re.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:Yi(e.bundledQuery),readTime:xi(e.readTime)}}(t)),Re.resolve()}}class ps{constructor(){this.overlays=new pt(ae.comparator),this.qr=new Map}getOverlay(e,t){return Re.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ir();return Re.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),Re.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),Re.resolve()}getOverlaysForCollection(e,t,n){const r=ir(),i=t.length+1,s=new ae(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Re.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new pt((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=ir(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=ir(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return Re.resolve(a)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Kr(t,n));let i=this.qr.get(t);void 0===i&&(i=lr(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class ms{constructor(){this.sessionToken=Et.EMPTY_BYTE_STRING}getSessionToken(e){return Re.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Re.resolve()}}class fs{constructor(){this.Qr=new gt(gs.$r),this.Ur=new gt(gs.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new gs(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new gs(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new ae(new re([])),n=new gs(t,e),r=new gs(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ae(new re([])),n=new gs(t,e),r=new gs(t,e+1);let i=lr();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new gs(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class gs{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ae.comparator(e.key,t.key)||X(e.Yr,t.Yr)}static Kr(e,t){return X(e.Yr,t.Yr)||ae.comparator(e.key,t.key)}}class vs{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new gt(gs.$r)}checkEmpty(e){return Re.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Wr(i,t,n,r);this.mutationQueue.push(s);for(const a of r)this.Zr=this.Zr.add(new gs(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Re.resolve(s)}lookupMutationBatch(e,t){return Re.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),i=r<0?0:r;return Re.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Re.resolve(0===this.mutationQueue.length?ke:this.tr-1)}getAllMutationBatches(e){return Re.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new gs(t,0),r=new gs(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,r],e=>{const t=this.Xr(e.Yr);i.push(t)}),Re.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new gt(X);return t.forEach(e=>{const t=new gs(e,0),r=new gs(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),Re.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ae.isDocumentKey(i)||(i=i.child(""));const s=new gs(new ae(i),0);let a=new gt(X);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Yr)),!0)},s),Re.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){D(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return Re.forEach(t.mutations,r=>{const i=new gs(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new gs(t,0),r=this.Zr.firstAfterOrEqual(n);return Re.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Re.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ys{constructor(e){this.ri=e,this.docs=new pt(ae.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Re.resolve(n?n.document.mutableCopy():on.newInvalidDocument(t))}getEntries(e,t){let n=er();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():on.newInvalidDocument(e))}),Re.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=er();const s=t.path,a=new ae(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Te(we(a),n)<=0||(r.has(a.key)||Yn(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return Re.resolve(i)}getAllFromCollectionGroup(e,t,n,r){P(9500)}ii(e,t){return Re.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new _s(this)}getSize(e){return Re.resolve(this.size)}}class _s extends ls{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),Re.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Es{constructor(e){this.persistence=e,this.si=new Zn(e=>Pn(e),kn),this.lastRemoteSnapshotVersion=_e.min(),this.highestTargetId=0,this.oi=0,this._i=new fs,this.targetCount=0,this.ai=ts.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),Re.resolve()}getLastRemoteSnapshotVersion(e){return Re.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Re.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Re.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),Re.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new ts(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Re.resolve()}updateTargetData(e,t){return this.Pr(t),Re.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Re.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),Re.waitFor(i).next(()=>r)}getTargetCount(e){return Re.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return Re.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),Re.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),Re.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Re.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return Re.resolve(n)}containsKey(e,t){return Re.resolve(this._i.containsKey(t))}}class bs{constructor(e,t){this.ui={},this.overlays={},this.ci=new Pe(0),this.li=!1,this.li=!0,this.hi=new ms,this.referenceDelegate=e(this),this.Pi=new Es(this),this.indexManager=new Ji,this.remoteDocumentCache=function(e){return new ys(e)}(e=>this.referenceDelegate.Ti(e)),this.serializer=new qi(t),this.Ii=new hs(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ps,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new vs(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){A("MemoryPersistence","Starting transaction:",e);const r=new xs(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return Re.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class xs extends Ce{constructor(e){super(),this.currentSequenceNumber=e}}class ws{constructor(e){this.persistence=e,this.Ri=new fs,this.Vi=null}static mi(e){return new ws(e)}get fi(){if(this.Vi)return this.Vi;throw P(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),Re.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),Re.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Re.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Re.forEach(this.fi,n=>{const r=ae.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,_e.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return Re.or([()=>Re.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ss{constructor(e,t){this.persistence=e,this.pi=new Zn(e=>Ue(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=cs(this,t)}static mi(e,t){return new Ss(e,t)}Ei(){}di(e){return Re.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return Re.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?Re.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,_e.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Re.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),Re.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),Re.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Re.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Yt(e.data.value)),t}br(e,t,n){return Re.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return Re.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Ts{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=lr(),r=lr();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Ts(e,t.fromCache,n,r)}}class Ns{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Cs{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,l.nr)()?8:Ie((0,l.ZQ)())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new Ns;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(C()<=c.$b.DEBUG&&A("QueryEngine","SDK will not create cache indexes for query:",qn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Re.resolve()):(C()<=c.$b.DEBUG&&A("QueryEngine","Query:",qn(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(C()<=c.$b.DEBUG&&A("QueryEngine","The SDK decides to create cache indexes for query:",qn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bn(t))):Re.resolve())}ys(e,t){if(Un(t))return Re.resolve(null);let n=Bn(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Wn(t,null,"F"),n=Bn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=lr(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,Wn(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return Un(t)||r.isEqual(_e.min())?Re.resolve(null):this.ps.getDocuments(e,n).next(i=>{const s=this.Ds(t,i);return this.Cs(t,s,n,r)?Re.resolve(null):(C()<=c.$b.DEBUG&&A("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),qn(t)),this.vs(e,s,t,xe(r,Ee)).next(e=>e))})}Ds(e,t){let n=new gt(Jn(e));return t.forEach((t,r)=>{Yn(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return C()<=c.$b.DEBUG&&A("QueryEngine","Using full collection scan to execute query:",qn(t)),this.ps.getDocumentsMatchingQuery(e,t,Se.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const As="LocalStore",Rs=3e8;class Is{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new pt(X),this.xs=new Zn(e=>Pn(e),kn),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new us(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Os(e,t,n,r){return new Is(e,t,n,r)}async function Ps(e,t){const n=L(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let a=lr();for(const e of r){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function ks(e){const t=L(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function Ds(e,t,n){let r=lr(),i=lr();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=er();return n.forEach((n,s)=>{const a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(_e.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):A(As,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{ks:r,qs:i}})}function Ls(e,t){const n=L(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=ke),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function js(e,t){const n=L(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Pi.getTargetData(e,t).next(i=>i?(r=i,Re.resolve(r)):n.Pi.allocateTargetId(e).next(i=>(r=new Ki(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}async function Ms(e,t,n){const r=L(e),i=r.Ms.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Oe(e))throw e;A(As,"Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.Ms=r.Ms.remove(t),r.xs.delete(i.target)}function Us(e,t,n){const r=L(e);let i=_e.min(),s=lr();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=L(e),i=r.xs.get(n);return void 0!==i?Re.resolve(r.Ms.get(i)):r.Pi.getTargetData(t,n)}(r,e,Bn(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Fs.getDocumentsMatchingQuery(e,t,n?i:_e.min(),n?s:lr())).next(e=>(Vs(r,Xn(t),e),{documents:e,Qs:s})))}function Vs(e,t,n){let r=e.Os.get(t)||_e.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}class Fs{constructor(){this.activeTargetIds=ur()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Bs{constructor(){this.Mo=new Fs,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Fs,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Gs{Oo(e){}shutdown(){}}const Hs="ConnectivityMonitor";class Ws{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){A(Hs,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){A(Hs,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let zs=null;function Ks(){return null===zs?zs=268435456+Math.round(2147483648*Math.random()):zs++,"0x"+zs.toString(16)}const qs="RestConnection",Ys={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xs{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko="projects/".concat(n,"/databases/").concat(r),this.Wo=this.databaseId.database===kt?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Go(e,t,n,r,i){const s=Ks(),a=this.zo(e,t.toUriEncodedString());A(qs,"Sending RPC '".concat(e,"' ").concat(s,":"),a,n);const o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,r,i);const{host:c}=new URL(a),d=(0,l.zJ)(c);return this.Jo(e,a,o,n,d).then(t=>(A(qs,"Received RPC '".concat(e,"' ").concat(s,": "),t),t),t=>{throw I(qs,"RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",a,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+T,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=Ys[e];return"".concat(this.Uo,"/v1/").concat(t,":").concat(n)}terminate(){}}class Js{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Qs="WebChannelConnection";class Zs extends Xs{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){const s=Ks();return new Promise((i,a)=>{const o=new h;o.setWithCredentials(!0),o.listenOnce(m.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case f.NO_ERROR:const n=o.getResponseJson();A(Qs,"XHR for RPC '".concat(e,"' ").concat(s," received:"),JSON.stringify(n)),i(n);break;case f.TIMEOUT:A(Qs,"RPC '".concat(e,"' ").concat(s," timed out")),a(new M(j.DEADLINE_EXCEEDED,"Request time out"));break;case f.HTTP_ERROR:const r=o.getStatus();if(A(Qs,"RPC '".concat(e,"' ").concat(s," failed with status:"),r,"response text:",o.getResponseText()),r>0){var t;let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const n=null===(t=e)||void 0===t?void 0:t.error;if(n&&n.status&&n.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(t)>=0?t:j.UNKNOWN}(n.status);a(new M(e,n.message))}else a(new M(j.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new M(j.UNAVAILABLE,"Connection failed."));break;default:P(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{A(Qs,"RPC '".concat(e,"' ").concat(s," completed."))}});const c=JSON.stringify(r);A(Qs,"RPC '".concat(e,"' ").concat(s," sending request:"),r),o.send(t,"POST",c,n,15)})}T_(e,t,n){const r=Ks(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=_(),a=y(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(o.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const l=i.join("");A(Qs,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(l),o);const d=s.createWebChannel(l,o);this.I_(d);let u=!1,h=!1;const m=new Js({Yo:t=>{h?A(Qs,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(u||(A(Qs,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),d.open(),u=!0),A(Qs,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),d.send(t))},Zo:()=>d.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(d,p.EventType.OPEN,()=>{h||(A(Qs,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),m.o_())}),f(d,p.EventType.CLOSE,()=>{h||(h=!0,A(Qs,"RPC '".concat(e,"' stream ").concat(r," transport closed")),m.a_(),this.E_(d))}),f(d,p.EventType.ERROR,t=>{h||(h=!0,I(Qs,"RPC '".concat(e,"' stream ").concat(r," transport errored. Name:"),t.name,"Message:",t.message),m.a_(new M(j.UNAVAILABLE,"The operation could not be completed")))}),f(d,p.EventType.MESSAGE,t=>{if(!h){var n;const i=t.data[0];D(!!i,16349);const s=i,a=(null===s||void 0===s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(a){A(Qs,"RPC '".concat(e,"' stream ").concat(r," received error:"),a);const t=a.status;let n=function(e){const t=Yr[e];if(void 0!==t)return Qr(t)}(t),i=a.message;void 0===n&&(n=j.INTERNAL,i="Unknown error status: "+t+" with message "+a.message),h=!0,m.a_(new M(n,i)),d.close()}else A(Qs,"RPC '".concat(e,"' stream ").concat(r," received:"),i),m.u_(i)}}),f(a,v.STAT_EVENT,t=>{t.stat===g.PROXY?A(Qs,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===g.NOPROXY&&A(Qs,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{m.__()},0),m}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function $s(){return"undefined"!=typeof document?document:null}function ea(e){return new vi(e,!0)}class ta{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&A("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const na="PersistentStream";class ra{constructor(e,t,n,r,i,s,a,o){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ta(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(R(t.toString()),R("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===j.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.D_===t&&this.G_(n,r)},t=>{e(()=>{const e=new M(j.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return A(na,"close with error: ".concat(e)),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(A(na,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ia extends ra{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:P(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(D(void 0===t||"string"==typeof t,58123),Et.fromBase64String(t||"")):(D(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Et.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?j.UNKNOWN:Qr(e.code);return new M(t,e.message||"")}(a);n=new li(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ci(e,r.document.name),s=xi(r.document.updateTime),a=r.document.createTime?xi(r.document.createTime):_e.min(),o=new sn({mapValue:{fields:r.document.fields}}),c=on.newFoundDocument(i,s,a,o),l=r.targetIds||[],d=r.removedTargetIds||[];n=new oi(l,d,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Ci(e,r.document),s=r.readTime?xi(r.readTime):_e.min(),a=on.newNoDocument(i,s),o=r.removedTargetIds||[];n=new oi([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Ci(e,r.document),s=r.removedTargetIds||[];n=new oi([],s,i,null)}else{if(!("filter"in t))return P(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new qr(r,i),a=e.targetId;n=new ci(a,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return _e.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?_e.min():t.readTime?xi(t.readTime):_e.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Ii(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Dn(r)?{documents:Di(e,r)}:{query:Li(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ei(e,t.resumeToken);const r=yi(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(_e.min())>0){n.readTime=_i(e,t.snapshotVersion.toTimestamp());const r=yi(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return P(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Ii(this.serializer),t.removeTarget=e,this.q_(t)}}class sa extends ra{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return D(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,D(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){D(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(D(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?xi(e.updateTime):xi(t);return n.isEqual(_e.min())&&(n=xi(t)),new Ar(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=xi(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Ii(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>ki(this.serializer,e))};this.q_(t)}}class aa{}class oa extends aa{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new M(j.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,a]=i;return this.connection.Go(e,Si(t,n),r,s,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new M(j.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[a,o]=s;return this.connection.Ho(e,Si(t,n),r,a,o,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new M(j.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class ca{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(R(t),this.aa=!1):A("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const la="RemoteStore";class da{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{_a(this)&&(A(la,"Restarting streams for network reachability change."),await async function(e){const t=L(e);t.Ea.add(4),await ha(t),t.Ra.set("Unknown"),t.Ea.delete(4),await ua(t)}(this))})}),this.Ra=new ca(n,r)}}async function ua(e){if(_a(e))for(const t of e.da)await t(!0)}async function ha(e){for(const t of e.da)await t(!1)}function pa(e,t){const n=L(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),ya(n)?va(n):Ua(n).O_()&&fa(n,t))}function ma(e,t){const n=L(e),r=Ua(n);n.Ia.delete(t),r.O_()&&ga(n,t),0===n.Ia.size&&(r.O_()?r.L_():_a(n)&&n.Ra.set("Unknown"))}function fa(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(_e.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ua(e).Y_(t)}function ga(e,t){e.Va.Ue(t),Ua(e).Z_(t)}function va(e){e.Va=new ui({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Ua(e).start(),e.Ra.ua()}function ya(e){return _a(e)&&!Ua(e).x_()&&e.Ia.size>0}function _a(e){return 0===L(e).Ea.size}function Ea(e){e.Va=void 0}async function ba(e){e.Ra.set("Online")}async function xa(e){e.Ia.forEach((t,n)=>{fa(e,t)})}async function wa(e,t){Ea(e),ya(e)?(e.Ra.ha(t),va(e)):e.Ra.set("Unknown")}async function Sa(e,t,n){if(e.Ra.set("Online"),t instanceof li&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){A(la,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ta(e,n)}else if(t instanceof oi?e.Va.Ze(t):t instanceof ci?e.Va.st(t):e.Va.tt(t),!n.isEqual(_e.min()))try{const t=await ks(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(Et.EMPTY_BYTE_STRING,r.snapshotVersion)),ga(e,t);const i=new Ki(r.target,t,n,r.sequenceNumber);fa(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){A(la,"Failed to raise snapshot:",t),await Ta(e,t)}}async function Ta(e,t,n){if(!Oe(t))throw t;e.Ea.add(1),await ha(e),e.Ra.set("Offline"),n||(n=()=>ks(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{A(la,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await ua(e)})}function Na(e,t){return t().catch(n=>Ta(e,n,t))}async function Ca(e){const t=L(e),n=Va(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:ke;for(;Aa(t);)try{const e=await Ls(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,Ra(t,e)}catch(e){await Ta(t,e)}Ia(t)&&Oa(t)}function Aa(e){return _a(e)&&e.Ta.length<10}function Ra(e,t){e.Ta.push(t);const n=Va(e);n.O_()&&n.X_&&n.ea(t.mutations)}function Ia(e){return _a(e)&&!Va(e).x_()&&e.Ta.length>0}function Oa(e){Va(e).start()}async function Pa(e){Va(e).ra()}async function ka(e){const t=Va(e);for(const n of e.Ta)t.ea(n.mutations)}async function Da(e,t,n){const r=e.Ta.shift(),i=zr.from(r,t,n);await Na(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await Ca(e)}async function La(e,t){t&&Va(e).X_&&await async function(e,t){if(function(e){return Jr(e)&&e!==j.ABORTED}(t.code)){const n=e.Ta.shift();Va(e).B_(),await Na(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Ca(e)}}(e,t),Ia(e)&&Oa(e)}async function ja(e,t){const n=L(e);n.asyncQueue.verifyOperationInProgress(),A(la,"RemoteStore received new credentials");const r=_a(n);n.Ea.add(3),await ha(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await ua(n)}async function Ma(e,t){const n=L(e);t?(n.Ea.delete(2),await ua(n)):t||(n.Ea.add(2),await ha(n),n.Ra.set("Unknown"))}function Ua(e){return e.ma||(e.ma=function(e,t,n){const r=L(e);return r.sa(),new ia(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:ba.bind(null,e),t_:xa.bind(null,e),r_:wa.bind(null,e),H_:Sa.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),ya(e)?va(e):e.Ra.set("Unknown")):(await e.ma.stop(),Ea(e))})),e.ma}function Va(e){return e.fa||(e.fa=function(e,t,n){const r=L(e);return r.sa(),new sa(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Pa.bind(null,e),r_:La.bind(null,e),ta:ka.bind(null,e),na:Da.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await Ca(e)):(await e.fa.stop(),e.Ta.length>0&&(A(la,"Stopping write stream with ".concat(e.Ta.length," pending writes")),e.Ta=[]))})),e.fa}class Fa{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new U,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new Fa(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new M(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ba(e,t){if(R("AsyncQueue","".concat(t,": ").concat(e)),Oe(e))return new M(j.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Ga{static emptySet(e){return new Ga(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ae.comparator(t.key,n.key):(e,t)=>ae.comparator(e.key,t.key),this.keyedMap=nr(),this.sortedSet=new pt(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ga))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ga;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ha{constructor(){this.ga=new pt(ae.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):P(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Wa{constructor(e,t,n,r,i,s,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Wa(e,t,Ga.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class za{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Ka{constructor(){this.queries=qa(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=L(e),r=n.queries;n.queries=qa(),r.forEach((e,n)=>{for(const r of n.Sa)r.onError(t)})}(this,new M(j.ABORTED,"Firestore shutting down"))}}function qa(){return new Zn(e=>Kn(e),zn)}async function Ya(e,t){const n=L(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.ba()&&t.Da()&&(r=2):(s=new za,r=t.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Ba(e,"Initialization of query '".concat(qn(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,s),s.Sa.push(t),t.va(n.onlineState),s.wa&&t.Fa(s.wa)&&Za(n)}async function Xa(e,t){const n=L(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.Sa.indexOf(t);e>=0&&(s.Sa.splice(e,1),0===s.Sa.length?i=t.Da()?0:1:!s.ba()&&t.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Ja(e,t){const n=L(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(i)&&(r=!0);t.wa=i}}r&&Za(n)}function Qa(e,t,n){const r=L(e),i=r.queries.get(t);if(i)for(const s of i.Sa)s.onError(n);r.queries.delete(t)}function Za(e){e.Ca.forEach(e=>{e.next()})}var $a,eo;(eo=$a||($a={})).Ma="default",eo.Cache="cache";class to{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Wa(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Wa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==$a.Cache}}class no{constructor(e){this.key=e}}class ro{constructor(e){this.key=e}}class io{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=lr(),this.mutatedKeys=lr(),this.eu=Jn(e),this.tu=new Ga(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new Ha,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const l=r.get(e),d=Yn(this.query,t)?t:null,u=!!l&&this.mutatedKeys.has(l.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let p=!1;l&&d?l.data.isEqual(d.data)?u!==h&&(n.track({type:3,doc:d}),p=!0):this.su(l,d)||(n.track({type:2,doc:d}),p=!0,(o&&this.eu(d,o)>0||c&&this.eu(d,c)<0)&&(a=!0)):!l&&d?(n.track({type:0,doc:d}),p=!0):l&&!d&&(n.track({type:1,doc:l}),p=!0,(o||c)&&(a=!0)),p&&(d?(s=s.add(d),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const s=e.iu.ya();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return P(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=null!==r&&void 0!==r&&r;const a=t&&!r?this._u():[],o=0===this.Xa.size&&this.current&&!r?1:0,c=o!==this.Za;return this.Za=o,0!==s.length||c?{snapshot:new Wa(this.query,e.tu,i,s,e.mutatedKeys,0===o,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ha,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=lr(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new ro(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new no(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=lr();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Wa.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const so="SyncEngine";class ao{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class oo{constructor(e){this.key=e,this.hu=!1}}class co{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new Zn(e=>Kn(e),zn),this.Iu=new Map,this.Eu=new Set,this.du=new pt(ae.comparator),this.Au=new Map,this.Ru=new fs,this.Vu={},this.mu=new Map,this.fu=ts.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function lo(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=Oo(e);let i;const s=r.Tu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await ho(r,t,n,!0),i}async function uo(e,t){const n=Oo(e);await ho(n,t,!0,!1)}async function ho(e,t,n,r){const i=await js(e.localStore,Bn(t)),s=i.targetId,a=e.sharedClientState.addLocalQueryTarget(s,n);let o;return r&&(o=await po(e,t,s,"current"===a,i.resumeToken)),e.isPrimaryClient&&n&&pa(e.remoteStore,i),o}async function po(e,t,n,r,i){e.pu=(t,n,r)=>async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await Us(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ru(n,i)}));const s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return To(e,t.targetId,o.au),o.snapshot}(e,t,n,r);const s=await Us(e.localStore,t,!0),a=new io(t,s.Qs),o=a.ru(s.documents),c=ai.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),l=a.applyChanges(o,e.isPrimaryClient,c);To(e,n,l.au);const d=new ao(t,n,a);return e.Tu.set(t,d),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),l.snapshot}async function mo(e,t,n){const r=L(e),i=r.Tu.get(t),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(e=>!zn(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Ms(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&ma(r.remoteStore,i.targetId),wo(r,i.targetId)}).catch(Ae)):(wo(r,i.targetId),await Ms(r.localStore,i.targetId,!0))}async function fo(e,t){const n=L(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ma(n.remoteStore,r.targetId))}async function go(e,t){const n=L(e);try{const e=await function(e,t){const n=L(e),r=t.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const a=[];t.targetChanges.forEach((s,o)=>{const c=i.get(o);if(!c)return;a.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,o)));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?l=l.withResumeToken(Et.EMPTY_BYTE_STRING,_e.min()).withLastLimboFreeSnapshotVersion(_e.min()):s.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(s.resumeToken,r)),i=i.insert(o,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=Rs||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,l,s)&&a.push(n.Pi.updateTargetData(e,l))});let o=er(),c=lr();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(Ds(e,s,t.documentUpdates).next(e=>{o=e.ks,c=e.qs})),!r.isEqual(_e.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return Re.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,c)).next(()=>o)}).then(e=>(n.Ms=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Au.get(t);r&&(D(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?D(r.hu,14607):e.removedDocuments.size>0&&(D(r.hu,42227),r.hu=!1))}),await Ao(n,e,t)}catch(e){await Ae(e)}}function vo(e,t,n){const r=L(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const i=r.view.va(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=L(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.Sa)i.va(t)&&(r=!0)}),r&&Za(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function yo(e,t,n){const r=L(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Au.get(t),s=i&&i.key;if(s){let e=new pt(ae.comparator);e=e.insert(s,on.newNoDocument(s,_e.min()));const n=lr().add(s),i=new si(_e.min(),new Map,new pt(X),e,n);await go(r,i),r.du=r.du.remove(s),r.Au.delete(t),Co(r)}else await Ms(r.localStore,t,!1).then(()=>wo(r,t,n)).catch(Ae)}async function _o(e,t){const n=L(e),r=t.batch.batchId;try{const e=await function(e,t){const n=L(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let a=Re.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);D(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=lr();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);xo(n,r,null),bo(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ao(n,e)}catch(e){await Ae(e)}}async function Eo(e,t,n){const r=L(e);try{const e=await function(e,t){const n=L(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(D(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);xo(r,t,n),bo(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Ao(r,e)}catch(n){await Ae(n)}}function bo(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function xo(e,t,n){const r=L(e);let i=r.Vu[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Vu[r.currentUser.toKey()]=i}}function wo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||So(e,t)})}function So(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(ma(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),Co(e))}function To(e,t,n){for(const r of n)r instanceof no?(e.Ru.addReference(r.key,t),No(e,r)):r instanceof ro?(A(so,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||So(e,r.key)):P(19791,{wu:r})}function No(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(A(so,"New document in limbo: "+n),e.Eu.add(r),Co(e))}function Co(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new ae(re.fromString(t)),r=e.fu.next();e.Au.set(r,new oo(n)),e.du=e.du.insert(n,r),pa(e.remoteStore,new Ki(Bn(Mn(n.path)),r,"TargetPurposeLimboResolution",Pe.ce))}}async function Ao(e,t,n){const r=L(e),i=[],s=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((e,o)=>{a.push(r.pu(o,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){var t;const i=e?!e.fromCache:null===n||void 0===n||null===(t=n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);const t=Ts.As(o.targetId,e);s.push(t)}}))}),await Promise.all(a),r.Pu.H_(i),await async function(e,t){const n=L(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Re.forEach(t,t=>Re.forEach(t.Es,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Re.forEach(t.ds,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!Oe(e))throw e;A(As,"Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ms.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(e,i)}}}(r.localStore,s))}async function Ro(e,t){const n=L(e);if(!n.currentUser.isEqual(t)){A(so,"User change. New user:",t.toKey());const e=await Ps(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new M(j.CANCELLED,t))})}),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Ao(n,e.Ls)}}function Io(e,t){const n=L(e),r=n.Au.get(t);if(r&&r.hu)return lr().add(r.key);{let e=lr();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function Oo(e){const t=L(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=go.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Io.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=yo.bind(null,t),t.Pu.H_=Ja.bind(null,t.eventManager),t.Pu.yu=Qa.bind(null,t.eventManager),t}function Po(e){const t=L(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=_o.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Eo.bind(null,t),t}class ko{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ea(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Os(this.persistence,new Cs,e.initialUser,this.serializer)}Cu(e){return new bs(ws.mi,this.serializer)}Du(e){return new Bs}async terminate(){var e,t;null!==(e=this.gcScheduler)&&void 0!==e&&e.stop(),null!==(t=this.indexBackfillerScheduler)&&void 0!==t&&t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ko.provider={build:()=>new ko};class Do extends ko{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){D(this.persistence.referenceDelegate instanceof Ss,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new as(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?es.withCacheSize(this.cacheSizeBytes):es.DEFAULT;return new bs(e=>Ss.mi(e,t),this.serializer)}}class Lo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>vo(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ro.bind(null,this.syncEngine),await Ma(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ka}createDatastore(e){const t=ea(e.databaseInfo.databaseId),n=function(e){return new Zs(e)}(e.databaseInfo);return function(e,t,n,r){return new oa(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new da(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>vo(this.syncEngine,e,0),Ws.v()?new Ws:new Gs)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new co(e,t,n,r,i,s);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=L(e);A(la,"RemoteStore shutting down."),t.Ea.add(5),await ha(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),null!==(e=this.datastore)&&void 0!==e&&e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Lo.provider={build:()=>new Lo};class jo{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):R("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const Mo="FirestoreClient";class Uo{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=S.UNAUTHENTICATED,this.clientId=Y.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{A(Mo,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(A(Mo,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new U;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Ba(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Vo(e,t){e.asyncQueue.verifyOperationInProgress(),A(Mo,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Ps(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Fo(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Bo(e);A(Mo,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>ja(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ja(t.remoteStore,n)),e._onlineComponents=t}async function Bo(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){A(Mo,"Using user provided OfflineComponentProvider");try{await Vo(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===j.FAILED_PRECONDITION||e.code===j.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;I("Error using user provided cache. Falling back to memory cache: "+n),await Vo(e,new ko)}}else A(Mo,"Using default OfflineComponentProvider"),await Vo(e,new Do(void 0));return e._offlineComponents}async function Go(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(A(Mo,"Using user provided OnlineComponentProvider"),await Fo(e,e._uninitializedComponentsProvider._online)):(A(Mo,"Using default OnlineComponentProvider"),await Fo(e,new Lo))),e._onlineComponents}function Ho(e){return Go(e).then(e=>e.syncEngine)}async function Wo(e){const t=await Go(e),n=t.eventManager;return n.onListen=lo.bind(null,t.syncEngine),n.onUnlisten=mo.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=uo.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=fo.bind(null,t.syncEngine),n}function zo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new U;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new jo({next:o=>{s.Nu(),t.enqueueAndForget(()=>Xa(e,a));const c=o.docs.has(n);!c&&o.fromCache?i.reject(new M(j.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&o.fromCache&&r&&"server"===r.source?i.reject(new M(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new to(Mn(n.path),s,{includeMetadataChanges:!0,qa:!0});return Ya(e,a)}(await Wo(e),e.asyncQueue,t,n,r)),r.promise}function Ko(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new U;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new jo({next:n=>{s.Nu(),t.enqueueAndForget(()=>Xa(e,a)),n.fromCache&&"server"===r.source?i.reject(new M(j.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new to(n,s,{includeMetadataChanges:!0,qa:!0});return Ya(e,a)}(await Wo(e),e.asyncQueue,t,n,r)),r.promise}function qo(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Yo=new Map,Xo="firestore.googleapis.com",Jo=!0;class Qo{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new M(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Xo,this.ssl=Jo}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Jo;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=$i;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<rs)throw new M(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new M(j.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qo(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new M(j.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new M(j.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new M(j.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Zo{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new M(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new M(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qo(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new F;switch(e.type){case"firstParty":return new W(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new M(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Yo.get(e);t&&(A("ComponentProvider","Removing Datastore"),Yo.delete(e),t.terminate())}(this),Promise.resolve()}}class $o{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new $o(this.firestore,e,this._query)}}class ec{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ec(this.firestore,e,this._key)}toJSON(){return{type:ec._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(fe(t,ec._jsonSchema))return new ec(e,n||null,new ae(re.fromString(t.referencePath)))}}ec._jsonSchemaVersion="firestore/documentReference/1.0",ec._jsonSchema={type:me("string",ec._jsonSchemaVersion),referencePath:me("string")};class tc extends $o{constructor(e,t,n){super(e,t,Mn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ec(this.firestore,null,new ae(e))}withConverter(e){return new tc(this.firestore,e,this._path)}}function nc(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,l.Ku)(e),oe("collection","path",t),e instanceof Zo){const n=re.fromString(t,...r);return le(n),new tc(e,null,n)}{if(!(e instanceof ec||e instanceof tc))throw new M(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(re.fromString(t,...r));return le(n),new tc(e.firestore,null,n)}}function rc(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,l.Ku)(e),1===arguments.length&&(t=Y.newId()),oe("doc","path",t),e instanceof Zo){const n=re.fromString(t,...r);return ce(n),new ec(e,null,new ae(n))}{if(!(e instanceof ec||e instanceof tc))throw new M(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(re.fromString(t,...r));return ce(n),new ec(e.firestore,e instanceof tc?e.converter:null,new ae(n))}}const ic="AsyncQueue";class sc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ta(this,"async_queue_retry"),this._c=()=>{const e=$s();e&&A(ic,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=$s();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=$s();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new U;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Oe(e))throw e;A(ic,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,R("INTERNAL UNHANDLED ERROR: ",ac(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Fa.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&P(47125,{Pc:ac(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ac(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function oc(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class cc extends Zo{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new sc,this._persistenceKey=(null===r||void 0===r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new sc(e),this._firestoreClient=void 0,await e}}}function lc(e,t){const n="object"==typeof e?e:(0,a.Sx)(),r="string"==typeof e?e:t||kt,i=(0,a.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const e=(0,l.yU)("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=he(e,Zo);const i=(0,l.zJ)(t),a=e._getSettings(),o=(0,s.A)((0,s.A)({},a),{},{emulatorOptions:e._getEmulatorOptions()}),c="".concat(t,":").concat(n);i&&((0,l.gE)("https://".concat(c)),(0,l.P1)("Firestore",!0)),a.host!==Xo&&a.host!==c&&I("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=(0,s.A)((0,s.A)({},a),{},{host:c,ssl:i,emulatorOptions:r});if(!(0,l.bD)(d,o)&&(e._setSettings(d),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=S.MOCK_USER;else{var u;t=(0,l.Fy)(r.mockUserToken,null===(u=e._app)||void 0===u?void 0:u.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new M(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new S(i)}e._authCredentials=new B(new V(t,n))}}(i,...e)}return i}function dc(e){if(e._terminated)throw new M(j.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||uc(e),e._firestoreClient}function uc(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Pt(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,qo(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||null!==(n=i.localCache)&&void 0!==n&&n._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Uo(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null===e||void 0===e?void 0:e._online.build();return{_offline:null===e||void 0===e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class hc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hc(Et.fromBase64String(e))}catch(e){throw new M(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new hc(Et.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:hc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(fe(e,hc._jsonSchema))return hc.fromBase64String(e.bytes)}}hc._jsonSchemaVersion="firestore/bytes/1.0",hc._jsonSchema={type:me("string",hc._jsonSchemaVersion),bytes:me("string")};class pc{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new M(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new se(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class mc{constructor(e){this._methodName=e}}class fc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:fc._jsonSchemaVersion}}static fromJSON(e){if(fe(e,fc._jsonSchema))return new fc(e.latitude,e.longitude)}}fc._jsonSchemaVersion="firestore/geoPoint/1.0",fc._jsonSchema={type:me("string",fc._jsonSchemaVersion),latitude:me("number"),longitude:me("number")};class gc{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:gc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(fe(e,gc._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new gc(e.vectorValues);throw new M(j.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}gc._jsonSchemaVersion="firestore/vectorValue/1.0",gc._jsonSchema={type:me("string",gc._jsonSchemaVersion),vectorValues:me("object")};const vc=/^__.*__$/;class yc{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ur(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mr(e,this.data,t,this.fieldTransforms)}}class _c{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ur(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ec(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw P(40011,{Ac:e})}}class bc{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new bc((0,s.A)((0,s.A)({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Mc(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Ec(this.Ac)&&vc.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class xc{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ea(e)}Cc(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new bc({Ac:e,methodName:t,Dc:n,path:se.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wc(e){const t=e._freezeSettings(),n=ea(e._databaseId);return new xc(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Sc(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);kc("Data must be an object, but it was:",a,r);const o=Oc(r,a);let c,l;if(s.merge)c=new yt(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Dc(t,r,n);if(!a.contains(i))throw new M(j.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));Uc(e,i)||e.push(i)}c=new yt(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new yc(new sn(o),c,l)}class Tc extends mc{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Sc("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Tc}}class Nc extends mc{_toFieldTransform(e){return new Cr(e.path,new _r)}isEqual(e){return e instanceof Nc}}function Cc(e,t,n,r){const i=e.Cc(1,t,n);kc("Data must be an object, but it was:",i,r);const s=[],a=sn.empty();ut(r,(e,r)=>{const o=jc(t,e,n);r=(0,l.Ku)(r);const c=i.yc(o);if(r instanceof Tc)s.push(o);else{const e=Ic(r,c);null!=e&&(s.push(o),a.set(o,e))}});const o=new yt(s);return new _c(a,o,i.fieldTransforms)}function Ac(e,t,n,r,i,s){const a=e.Cc(1,t,n),o=[Dc(t,r,n)],c=[i];if(s.length%2!=0)throw new M(j.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let l=0;l<s.length;l+=2)o.push(Dc(t,s[l])),c.push(s[l+1]);const d=[],u=sn.empty();for(let p=o.length-1;p>=0;--p)if(!Uc(d,o[p])){const e=o[p];let t=c[p];t=(0,l.Ku)(t);const n=a.yc(e);if(t instanceof Tc)d.push(e);else{const r=Ic(t,n);null!=r&&(d.push(e),u.set(e,r))}}const h=new yt(d);return new _c(u,h,a.fieldTransforms)}function Rc(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Ic(n,e.Cc(r?4:3,t))}function Ic(e,t){if(Pc(e=(0,l.Ku)(e)))return kc("Unsupported field value:",t,e),Oc(e,t);if(e instanceof mc)return function(e,t){if(!Ec(t.Ac))throw t.Sc("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Sc("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Ic(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,l.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return mr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ye.fromDate(e);return{timestampValue:_i(t.serializer,n)}}if(e instanceof ye){const n=new ye(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:_i(t.serializer,n)}}if(e instanceof fc)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof hc)return{bytesValue:Ei(t.serializer,e._byteString)};if(e instanceof ec){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:wi(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof gc)return function(e,t){return{mapValue:{fields:{[Lt]:{stringValue:Ut},[Vt]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return hr(t.serializer,e)})}}}}}}(e,t);throw t.Sc("Unsupported field value: ".concat(ue(e)))}(e,t)}function Oc(e,t){const n={};return ht(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ut(e,(e,r)=>{const i=Ic(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Pc(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ye||e instanceof fc||e instanceof hc||e instanceof ec||e instanceof mc||e instanceof gc)}function kc(e,t,n){if(!Pc(n)||!de(n)){const r=ue(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function Dc(e,t,n){if((t=(0,l.Ku)(t))instanceof pc)return t._internalPath;if("string"==typeof t)return jc(e,t);throw Mc("Field path arguments must be of type string or ",e,!1,void 0,n)}const Lc=new RegExp("[~\\*/\\[\\]]");function jc(e,t,n){if(t.search(Lc)>=0)throw Mc("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new pc(...t.split("."))._internalPath}catch(r){throw Mc("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Mc(e,t,n,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=" in field ".concat(r)),a&&(c+=" in document ".concat(i)),c+=")"),new M(j.INVALID_ARGUMENT,o+e+c)}function Uc(e,t){return e.some(e=>e.isEqual(t))}class Vc{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ec(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Fc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Fc extends Vc{data(){return super.data()}}function Bc(e,t){return"string"==typeof t?jc(e,t):t instanceof pc?t._internalPath:t._delegate._internalPath}function Gc(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new M(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hc{}class Wc extends Hc{}function zc(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];t instanceof Hc&&n.push(t),n=n.concat(i),function(e){const t=e.filter(e=>e instanceof Yc).length,n=e.filter(e=>e instanceof Kc).length;if(t>1||t>0&&n>0)throw new M(j.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class Kc extends Wc{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Kc(e,t,n)}_apply(e){const t=this._parse(e);return tl(e._query,t),new $o(e.firestore,e.converter,Hn(e._query,t))}_parse(e){const t=wc(e.firestore),n=function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new M(j.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){el(a,s);const t=[];for(const n of a)t.push($c(r,e,n));o={arrayValue:{values:t}}}else o=$c(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||el(a,s),o=Rc(n,t,a,"in"===s||"not-in"===s);return mn.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function qc(e,t,n){const r=t,i=Bc("where",e);return Kc._create(i,r,n)}class Yc extends Hc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Yc(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:fn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)tl(n,i),n=Hn(n,i)}(e._query,t),new $o(e.firestore,e.converter,Hn(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Xc extends Wc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Xc(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new M(j.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new M(j.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new un(t,n)}(e._query,this._field,this._direction);return new $o(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Ln(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Jc(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Bc("orderBy",e);return Xc._create(n,t)}class Qc extends Wc{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Qc(e,t,n)}_apply(e){return new $o(e.firestore,e.converter,Wn(e._query,this._limit,this._limitType))}}function Zc(e){return pe("limit",e),Qc._create("limit",e,"F")}function $c(e,t,n){if("string"==typeof(n=(0,l.Ku)(n))){if(""===n)throw new M(j.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vn(t)&&-1!==n.indexOf("/"))throw new M(j.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(re.fromString(n));if(!ae.isDocumentKey(r))throw new M(j.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Xt(e,new ae(r))}if(n instanceof ec)return Xt(e,n._key);throw new M(j.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(ue(n),"."))}function el(e,t){if(!Array.isArray(e)||0===e.length)throw new M(j.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function tl(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new M(j.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new M(j.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class nl{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Ft(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(St(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw P(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return ut(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t;const n=null===(t=e.fields)||void 0===t||null===(t=t[Vt].arrayValue)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.map(e=>wt(e.doubleValue));return new gc(n)}convertGeoPoint(e){return new fc(wt(e.latitude),wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=It(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ot(e));default:return null}}convertTimestamp(e){const t=xt(e);return new ye(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=re.fromString(e);D(zi(n),9688,{name:e});const r=new Dt(n.get(1),n.get(3)),i=new ae(n.popFirst(5));return r.isEqual(t)||R("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function rl(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class il{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sl extends Vc{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new al(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Bc("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new M(j.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=sl._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}sl._jsonSchemaVersion="firestore/documentSnapshot/1.0",sl._jsonSchema={type:me("string",sl._jsonSchemaVersion),bundleSource:me("string","DocumentSnapshot"),bundleName:me("string"),bundle:me("string")};class al extends sl{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class ol{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new il(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new al(this._firestore,this._userDataWriter,n.key,n,new il(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new M(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new al(e._firestore,e._userDataWriter,n.doc.key,n.doc,new il(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new al(e._firestore,e._userDataWriter,t.doc.key,t.doc,new il(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:cl(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new M(j.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ol._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Y.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function cl(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return P(61501,{type:e})}}function ll(e){e=he(e,ec);const t=he(e.firestore,cc);return zo(dc(t),e._key).then(n=>yl(t,e,n))}ol._jsonSchemaVersion="firestore/querySnapshot/1.0",ol._jsonSchema={type:me("string",ol._jsonSchemaVersion),bundleSource:me("string","QuerySnapshot"),bundleName:me("string"),bundle:me("string")};class dl extends nl{constructor(e){super(),this.firestore=e}convertBytes(e){return new hc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ec(this.firestore,null,t)}}function ul(e){e=he(e,$o);const t=he(e.firestore,cc),n=dc(t),r=new dl(t);return Gc(e._query),Ko(n,e._query).then(n=>new ol(t,r,e,n))}function hl(e,t,n){e=he(e,ec);const r=he(e.firestore,cc),i=rl(e.converter,t,n);return vl(r,[Sc(wc(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Rr.none())])}function pl(e,t,n){e=he(e,ec);const r=he(e.firestore,cc),i=wc(r);let s;for(var a=arguments.length,o=new Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];return s="string"==typeof(t=(0,l.Ku)(t))||t instanceof pc?Ac(i,"updateDoc",e._key,t,n,o):Cc(i,"updateDoc",e._key,t),vl(r,[s.toMutation(e._key,Rr.exists(!0))])}function ml(e){return vl(he(e.firestore,cc),[new Gr(e._key,Rr.none())])}function fl(e,t){const n=he(e.firestore,cc),r=rc(e),i=rl(e.converter,t);return vl(n,[Sc(wc(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Rr.exists(!1))]).then(()=>r)}function gl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=(0,l.Ku)(e);let i={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof n[s]||oc(n[s])||(i=n[s++]);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(oc(n[s])){var o,c,d;const e=n[s];n[s]=null===(o=e.next)||void 0===o?void 0:o.bind(e),n[s+1]=null===(c=e.error)||void 0===c?void 0:c.bind(e),n[s+2]=null===(d=e.complete)||void 0===d?void 0:d.bind(e)}let u,h,p;if(e instanceof ec)h=he(e.firestore,cc),p=Mn(e._key.path),u={next:t=>{n[s]&&n[s](yl(h,e,t))},error:n[s+1],complete:n[s+2]};else{const t=he(e,$o);h=he(t.firestore,cc),p=t._query;const r=new dl(h);u={next:e=>{n[s]&&n[s](new ol(h,r,t,e))},error:n[s+1],complete:n[s+2]},Gc(e._query)}return function(e,t,n,r){const i=new jo(r),s=new to(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>Ya(await Wo(e),s)),()=>{i.Nu(),e.asyncQueue.enqueueAndForget(async()=>Xa(await Wo(e),s))}}(dc(h),p,a,u)}function vl(e,t){return function(e,t){const n=new U;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=Po(e);try{const e=await function(e,t){const n=L(e),r=ye.now(),i=t.reduce((e,t)=>e.add(t.key),lr());let s,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=er(),c=lr();return n.Ns.getEntries(e,i).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(i=>{s=i;const a=[];for(const e of t){const t=Lr(e,s.get(e.key).overlayedDocument);null!=t&&a.push(new Ur(e.key,t,an(t.value.mapValue),Rr.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,a,t)}).next(t=>{a=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:rr(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Vu[e.currentUser.toKey()];r||(r=new pt(X)),r=r.insert(t,n),e.Vu[e.currentUser.toKey()]=r}(r,e.batchId,n),await Ao(r,e.changes),await Ca(r.remoteStore)}catch(e){const t=Ba(e,"Failed to persist write");n.reject(t)}}(await Ho(e),t,n)),n.promise}(dc(e),t)}function yl(e,t,n){const r=n.docs.get(t._key),i=new dl(e);return new sl(e,i,t._key,r,new il(n.hasPendingWrites,n.fromCache),t.converter)}function _l(){return new Nc("serverTimestamp")}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){T=e}(a.MF),(0,a.om)(new o.uA("firestore",(e,n)=>{let{instanceIdentifier:r,options:i}=n;const a=e.getProvider("app").getImmediate(),o=new cc(new G(e.getProvider("auth-internal")),new K(a,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new M(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dt(e.options.projectId,t)}(a,r),a);return i=(0,s.A)({useFetchStreams:t},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),(0,a.KO)(x,w,e),(0,a.KO)(x,w,"esm2020")}()},6685:(e,t,n)=>{"use strict";n.d(t,{A:()=>se});var r=n(2555),i=n(9232),s=n(9606),a=n(1776),o=n(2965);const c="@firebase/data-connect",l="0.3.11";let d="";class u{constructor(e,t){this.appCheckProvider=t,(0,i.xZ)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then(e=>this.appCheck=e).catch()}getToken(){return this.serverAppAppCheckToken?Promise.resolve({token:this.serverAppAppCheckToken}):this.appCheck?this.appCheck.getToken():new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken().then(e,t):e(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}}const h="other",p="already-initialized",m="invalid-argument",f="partial-error",g="unauthorized";class v extends a.g{constructor(e,t){super(e,t),this.name="DataConnectError",Object.setPrototypeOf(this,v.prototype)}toString(){return"".concat(this.name,"[code=").concat(this.code,"]: ").concat(this.message)}}class y extends v{constructor(e,t){super(f,e),this.name="DataConnectOperationError",this.response=t}}const _=new o.Vy("@firebase/data-connect");function E(e){_.debug("DataConnect (".concat(d,"): ").concat(e))}function b(e){_.error("DataConnect (".concat(d,"): ").concat(e))}class x{constructor(e,t,n){this._appName=e,this._options=t,this._authProvider=n,this._auth=n.getImmediate({optional:!0}),this._auth||n.onInit(e=>this._auth=e)}getToken(e){return this._auth?this._auth.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(E("Got auth/token-not-initialized error.  Treating as null token."),null):(b("Error received when attempting to retrieve token: "+JSON.stringify(e)),Promise.reject(e))):new Promise((t,n)=>{setTimeout(()=>{this._auth?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this._auth)||void 0===t||t.addAuthTokenListener(e)}removeTokenChangeListener(e){this._authProvider.get().then(t=>t.removeAuthTokenListener(e)).catch(e=>b(e))}}const w="query",S="SERVER",T="CACHE";let N;function C(e,t,n){return function(){return{data:t,refInfo:{name:e.name,variables:e.variables,connectorConfig:(0,r.A)({projectId:e.dataConnect.app.options.projectId},e.dataConnect.getSettings())},fetchTime:Date.now().toLocaleString(),source:n}}}N=e=>JSON.stringify(e);class A{constructor(e){this.transport=e,this._queries=new Map}track(e,t,n){const r={name:e,variables:t,refType:w},i=N(r),s={ref:r,subscriptions:[],currentCache:n||null,lastError:null};return function(e,t,n){e.has(t)||e.set(t,n)}(this._queries,i,s),this._queries.get(i)}addSubscription(e,t,n,r){const i=N({name:e.name,variables:e.variables,refType:w}),s=this._queries.get(i),a={userCallback:t,errCallback:n},o=()=>{const e=this._queries.get(i);e.subscriptions=e.subscriptions.filter(e=>e!==a)};if(r&&s.currentCache!==r&&(E("Initial cache found. Comparing dates."),(!s.currentCache||s.currentCache&&function(e,t){const n=new Date(e),r=new Date(t);return n.getTime()<r.getTime()}(s.currentCache.fetchTime,r.fetchTime))&&(s.currentCache=r)),null!==s.currentCache){t({data:s.currentCache.data,source:T,ref:e,toJSON:C(e,s.currentCache.data,T),fetchTime:s.currentCache.fetchTime}),null!==s.lastError&&n&&n(void 0)}if(s.subscriptions.push({userCallback:t,errCallback:n,unsubscribe:o}),!s.currentCache){E("No cache available for query ".concat(e.name," with variables ").concat(JSON.stringify(e.variables),". Calling executeQuery."));this.executeQuery(e).then(void 0,e=>{})}return o}executeQuery(e){if(e.refType!==w)throw new v(m,"ExecuteQuery can only execute query operation");const t=N({name:e.name,variables:e.variables,refType:w}),n=this._queries.get(t);return this.transport.invokeQuery(e.name,e.variables).then(t=>{const i=(new Date).toString(),s=(0,r.A)((0,r.A)({},t),{},{source:S,ref:e,toJSON:C(e,t.data,S),fetchTime:i});return n.subscriptions.forEach(e=>{e.userCallback(s)}),n.currentCache={data:t.data,source:T,fetchTime:i},s},e=>{throw n.lastError=e,n.subscriptions.forEach(t=>{t.errCallback&&t.errCallback(e)}),e})}enableEmulator(e,t){this.transport.useEmulator(e,t)}}const R="Base",I="Generated";function O(e,t){if(!t)return e;const n=new URL(e);return n.searchParams.append("key",t),n.toString()}let P=globalThis.fetch;function k(e,t){let n="gl-js/ fire/"+d;return t!==R&&t!==I?n+=" js/"+t.toLowerCase():(e||t===I)&&(n+=" js/gen"),n}function D(e,t,n,r,i,s,o,c,l){let{signal:d}=n;if(!P)throw new v(h,"No Fetch Implementation detected!");const u={"Content-Type":"application/json","X-Goog-Api-Client":k(o,c)};i&&(u["X-Firebase-Auth-Token"]=i),r&&(u["x-firebase-gmpid"]=r),s&&(u["X-Firebase-AppCheck"]=s);const p={body:JSON.stringify(t),method:"POST",headers:u,signal:d};return(0,a.zJ)(e)&&l&&(p.credentials="include"),P(e,p).catch(e=>{throw new v(h,"Failed to fetch: "+JSON.stringify(e))}).then(async e=>{let t=null;try{t=await e.json()}catch(r){throw new v(h,JSON.stringify(r))}const n=function(e){if("message"in e)return e.message;return JSON.stringify(e)}(t);if(e.status>=400){if(b("Error while performing request: "+JSON.stringify(t)),401===e.status)throw new v(g,n);throw new v(h,n)}return t}).then(e=>{if(e.errors&&e.errors.length){const t=JSON.stringify(e.errors),n={errors:e.errors,data:e.data};throw new y("DataConnect error while performing request: "+t,n)}return e})}class L{constructor(e,t,n,r,i,s){var a,o;let c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:R;this.apiKey=t,this.appId=n,this.authProvider=r,this.appCheckProvider=i,this._isUsingGen=c,this._callerSdkType=l,this._host="",this._location="l",this._connectorName="",this._secure=!0,this._project="p",this._accessToken=null,this._appCheckToken=null,this._lastToken=null,this._isUsingEmulator=!1,this.invokeQuery=(e,t)=>{const n=new AbortController;return this.withRetry(()=>D(O("".concat(this.endpointUrl,":executeQuery"),this.apiKey),{name:"projects/".concat(this._project,"/locations/").concat(this._location,"/services/").concat(this._serviceName,"/connectors/").concat(this._connectorName),operationName:e,variables:t},n,this.appId,this._accessToken,this._appCheckToken,this._isUsingGen,this._callerSdkType,this._isUsingEmulator))},this.invokeMutation=(e,t)=>{const n=new AbortController;return this.withRetry(()=>D(O("".concat(this.endpointUrl,":executeMutation"),this.apiKey),{name:"projects/".concat(this._project,"/locations/").concat(this._location,"/services/").concat(this._serviceName,"/connectors/").concat(this._connectorName),operationName:e,variables:t},n,this.appId,this._accessToken,this._appCheckToken,this._isUsingGen,this._callerSdkType,this._isUsingEmulator))},s&&("number"===typeof s.port&&(this._port=s.port),"undefined"!==typeof s.sslEnabled&&(this._secure=s.sslEnabled),this._host=s.host);const{location:d,projectId:u,connector:h,service:p}=e;if(d&&(this._location=d),u&&(this._project=u),this._serviceName=p,!h)throw new v(m,"Connector Name required!");this._connectorName=h,null===(a=this.authProvider)||void 0===a||a.addTokenChangeListener(e=>{E("New Token Available: ".concat(e)),this._accessToken=e}),null===(o=this.appCheckProvider)||void 0===o||o.addTokenChangeListener(e=>{const{token:t}=e;E("New App Check Token Available: ".concat(t)),this._appCheckToken=t})}get endpointUrl(){return function(e,t){const{connector:n,location:r,projectId:i,service:s}=e,{host:a,sslEnabled:o,port:c}=t,l=a||"firebasedataconnect.googleapis.com";let d="".concat(o?"https":"http","://").concat(l);if("number"===typeof c)d+=":".concat(c);else if("undefined"!==typeof c)throw b("Port type is of an invalid type"),new v(m,"Incorrect type for port passed in!");return"".concat(d,"/v1/projects/").concat(i,"/locations/").concat(r,"/services/").concat(s,"/connectors/").concat(n)}({connector:this._connectorName,location:this._location,projectId:this._project,service:this._serviceName},{host:this._host,sslEnabled:this._secure,port:this._port})}useEmulator(e,t,n){this._host=e,this._isUsingEmulator=!0,"number"===typeof t&&(this._port=t),"undefined"!==typeof n&&(this._secure=n)}onTokenChanged(e){this._accessToken=e}async getWithAuth(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Promise(e=>e(this._accessToken));var n;this.appCheckProvider&&(this._appCheckToken=null===(n=await this.appCheckProvider.getToken())||void 0===n?void 0:n.token);return t=this.authProvider?this.authProvider.getToken(e).then(e=>e?(this._accessToken=e.accessToken,this._accessToken):null):new Promise(e=>e("")),t}_setLastToken(e){this._lastToken=e}withRetry(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;return this.getWithAuth(t).then(e=>(n=this._lastToken!==e,this._lastToken=e,e)).then(e).catch(r=>{if("code"in r&&r.code===g&&!t&&n)return E("Retrying due to unauthorized"),this.withRetry(e,!0);throw r})}_setCallerSdkType(e){this._callerSdkType=e}}function j(e,t,n){e.setInitialized();return{dataConnect:e,name:t,refType:"mutation",variables:n}}class M{constructor(e){this._transport=e,this._inflight=[]}executeMutation(e){const t=this._transport.invokeMutation(e.name,e.variables),n=t.then(t=>(0,r.A)((0,r.A)({},t),{},{source:S,ref:e,fetchTime:Date.now().toLocaleString()}));this._inflight.push(t);const i=()=>this._inflight=this._inflight.filter(e=>e!==t);return t.then(i,i),n}}class U{constructor(e,t,n,r){if(this.app=e,this.dataConnectOptions=t,this._authProvider=n,this._appCheckProvider=r,this.isEmulator=!1,this._initialized=!1,this._isUsingGeneratedSdk=!1,this._callerSdkType=R,"undefined"!==typeof process){const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.FIREBASE_DATA_CONNECT_EMULATOR_HOST;e&&(E("Found custom host. Using emulator"),this.isEmulator=!0,this._transportOptions=function(e){const[t,n]=e.split("://"),r="https"===t,[i,s]=n.split(":");return{host:i,port:Number(s),sslEnabled:r}}(e))}}_useGeneratedSdk(){this._isUsingGeneratedSdk||(this._isUsingGeneratedSdk=!0)}_setCallerSdkType(e){this._callerSdkType=e,this._initialized&&this._transport._setCallerSdkType(e)}_delete(){return(0,i.Us)(this.app,"data-connect",JSON.stringify(this.getSettings())),Promise.resolve()}getSettings(){const e=JSON.parse(JSON.stringify(this.dataConnectOptions));return delete e.projectId,e}setInitialized(){this._initialized||(void 0===this._transportClass&&(E("transportClass not provided. Defaulting to RESTTransport."),this._transportClass=L),this._authProvider&&(this._authTokenProvider=new x(this.app.name,this.app.options,this._authProvider)),this._appCheckProvider&&(this._appCheckTokenProvider=new u(this.app,this._appCheckProvider)),this._initialized=!0,this._transport=new this._transportClass(this.dataConnectOptions,this.app.options.apiKey,this.app.options.appId,this._authTokenProvider,this._appCheckTokenProvider,void 0,this._isUsingGeneratedSdk,this._callerSdkType),this._transportOptions&&this._transport.useEmulator(this._transportOptions.host,this._transportOptions.port,this._transportOptions.sslEnabled),this._queryManager=new A(this._transport),this._mutationManager=new M(this._transport))}enableEmulator(e){if(this._initialized&&(t=this._transportOptions,n=e,t.host!==n.host||t.port!==n.port||t.sslEnabled!==n.sslEnabled))throw b("enableEmulator called after initialization"),new v(p,"DataConnect instance already initialized!");var t,n;this._transportOptions=e,this.isEmulator=!0}}function V(e,t){let n,r;"location"in e?(r=e,n=(0,i.Sx)()):(r=t,n=e),n&&0!==Object.keys(n).length||(n=(0,i.Sx)());const s=(0,i.j6)(n,"data-connect"),a=JSON.stringify(r);if(s.isInitialized(a)){const e=s.getImmediate({identifier:a}),t=s.getOptions(a);if(Object.keys(t).length>0)return E("Re-using cached instance"),e}return function(e){const t=["connector","location","service"];if(!e)throw new v(m,"DC Option Required");t.forEach(t=>{if(null===e[t]||void 0===e[t])throw new v(m,"".concat(t," Required"))})}(r),E("Creating new DataConnect instance"),s.initialize({instanceIdentifier:a,options:r})}function F(e){return e.dataConnect._queryManager.executeQuery(e)}function B(e,t,n,r){return e.setInitialized(),e._queryManager.track(t,n,r),{dataConnect:e,refType:w,name:t,variables:n}}function G(e,t,n,r){let i,s;if(t&&"enableEmulator"in t?(i=t,s=n):(i=V(e),s=t),!i||!s&&r)throw new v(m,"Variables required.");return{dc:i,vars:s}}var H;!function(e){d=e}(i.MF),(0,i.om)(new s.uA("data-connect",(e,t)=>{let{instanceIdentifier:n,options:i}=t;const s=e.getProvider("app").getImmediate(),a=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");let c=i;if(n&&(c=JSON.parse(n)),!s.options.projectId)throw new v(m,"Project ID must be provided. Did you pass in a proper projectId to initializeApp?");return new U(s,(0,r.A)((0,r.A)({},c),{},{projectId:s.options.projectId}),a,o)},"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(c,l,H),(0,i.KO)(c,l,"esm2020");const W={connector:"example",service:"elderx",location:"us-central1"},z=e=>{const{dc:t}=G(W,e,void 0);return t._useGeneratedSdk(),j(t,"AddNewVitalSign")};z.operationName="AddNewVitalSign";const K=e=>{const{dc:t}=G(W,e,void 0);return t._useGeneratedSdk(),B(t,"GetMyMedications")};K.operationName="GetMyMedications";const q=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),j(n,"UpdateMedicationNotes",r)};q.operationName="UpdateMedicationNotes";const Y=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),B(n,"ListCaregiversForClientProfile",r)};Y.operationName="ListCaregiversForClientProfile";const X=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),B(n,"GetUserProfile",r)};X.operationName="GetUserProfile";const J=e=>{const{dc:t}=G(W,e,void 0);return t._useGeneratedSdk(),B(t,"GetCurrentUser")};J.operationName="GetCurrentUser";const Q=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),B(n,"GetClientProfile",r)};Q.operationName="GetClientProfile";const Z=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),B(n,"GetClientMedications",r)};Z.operationName="GetClientMedications";const $=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),B(n,"GetClientVitalSigns",r)};$.operationName="GetClientVitalSigns";const ee=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),B(n,"GetClientAppointments",r)};ee.operationName="GetClientAppointments";const te=(e,t)=>{const{dc:n,vars:r}=G(W,e,t,!0);return n._useGeneratedSdk(),B(n,"GetCaregiverClients",r)};te.operationName="GetCaregiverClients";var ne=n(7210),re=n(5452);const ie=V(W);const se=new class{constructor(){this.dataConnect=ie}_checkDataConnect(){if(!this.dataConnect){throw new Error("Data Connect service is not available")}}_throwUnimplementedError(e){const t=new Error("Data Connect query '".concat(e,"' not implemented - using Firestore fallback"));throw re.A.warn("Data Connect query not implemented: ".concat(e)),t}async getUserProfile(e){try{var t,n;re.A.debug("Executing Data Connect getUserProfile",{userId:e});const s=await(r=this.dataConnect,i={userId:e},F(X(r,i)));return re.A.info("Data Connect getUserProfile successful",{resultCount:(null===(t=s.data)||void 0===t||null===(n=t.users)||void 0===n?void 0:n.length)||0}),s}catch(s){throw re.A.error("Data Connect getUserProfile failed",{error:s,userId:e}),ne.Ay.handleError(s,{context:"data_connect_getUserProfile",userId:e}),s}var r,i}async getCurrentUser(){try{var e,t;re.A.debug("Executing Data Connect getCurrentUser");const r=await(n=this.dataConnect,F(J(n)));return re.A.info("Data Connect getCurrentUser successful",{resultCount:(null===(e=r.data)||void 0===e||null===(t=e.users)||void 0===t?void 0:t.length)||0}),r}catch(r){throw re.A.error("Data Connect getCurrentUser failed",{error:r}),ne.Ay.handleError(r,{context:"data_connect_getCurrentUser"}),r}var n}async getAllUsers(){throw new Error("GetAllUsers query not implemented in Data Connect schema")}async createUserProfile(e){return this.executeMutation("CreateUserProfile",e)}async updateUserProfile(e,t){return this.executeMutation("UpdateUserProfile",(0,r.A)({userId:e},t))}async getElderlyProfile(e){return this.executeQuery("GetElderlyProfile",{userId:e})}async getCurrentElderlyProfile(){return this.executeQuery("GetCurrentElderlyProfile")}async createElderlyProfile(e){return this.executeMutation("CreateElderlyProfile",e)}async updateElderlyProfile(e,t){return this.executeMutation("UpdateElderlyProfile",(0,r.A)({profileId:e},t))}async getMedications(e){try{var t,n;re.A.debug("Executing Data Connect getClientMedications",{clientProfileId:e});const s=await(r=this.dataConnect,i={clientProfileId:e},F(Z(r,i)));return re.A.info("Data Connect getClientMedications successful",{resultCount:(null===(t=s.data)||void 0===t||null===(n=t.medications)||void 0===n?void 0:n.length)||0}),s}catch(s){throw re.A.error("Data Connect getClientMedications failed",{error:s,clientProfileId:e}),s}var r,i}async getCurrentUserMedications(){try{var e,t;re.A.debug("Executing Data Connect getMyMedications");const r=await(n=this.dataConnect,F(K(n)));return re.A.info("Data Connect getMyMedications successful",{resultCount:(null===(e=r.data)||void 0===e||null===(t=e.medications)||void 0===t?void 0:t.length)||0}),r}catch(r){throw re.A.error("Data Connect getMyMedications failed",{error:r}),r}var n}async getActiveMedications(e){return this.executeQuery("GetActiveMedications",{elderlyProfileId:e})}async getMedicationById(e){return this.executeQuery("GetMedicationById",{medicationId:e})}async createMedication(e){return this.executeMutation("CreateMedication",e)}async updateMedication(e,t){return this.executeMutation("UpdateMedication",(0,r.A)({medicationId:e},t))}async deleteMedication(e){return this.executeMutation("DeleteMedication",{medicationId:e})}async getMedicationLogs(e){return this.executeQuery("GetMedicationLogs",{medicationId:e})}async getRecentMedicationLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.executeQuery("GetRecentMedicationLogs",{elderlyProfileId:e,limit:t})}async logMedicationDose(e){return this.executeMutation("LogMedicationDose",e)}async getVitalSigns(e){return this.executeQuery("GetVitalSigns",{elderlyProfileId:e})}async getCurrentUserVitalSigns(){return this.executeQuery("GetCurrentUserVitalSigns")}async getVitalSignsByType(e,t){return this.executeQuery("GetVitalSignsByType",{elderlyProfileId:e,type:t})}async getRecentVitalSigns(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.executeQuery("GetRecentVitalSigns",{elderlyProfileId:e,limit:t})}async getVitalSignsByDateRange(e,t,n){return this.executeQuery("GetVitalSignsByDateRange",{elderlyProfileId:e,startDate:t,endDate:n})}async createVitalSign(e){return this.executeMutation("CreateVitalSign",e)}async updateVitalSign(e,t){return this.executeMutation("UpdateVitalSign",(0,r.A)({vitalSignId:e},t))}async deleteVitalSign(e){return this.executeMutation("DeleteVitalSign",{vitalSignId:e})}async getAppointments(e){return this.executeQuery("GetAppointments",{elderlyProfileId:e})}async getCurrentUserAppointments(){return this.executeQuery("GetCurrentUserAppointments")}async getUpcomingAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return this.executeQuery("GetUpcomingAppointments",{elderlyProfileId:e,limit:t})}async getAppointmentsByDateRange(e,t,n){return this.executeQuery("GetAppointmentsByDateRange",{elderlyProfileId:e,startDate:t,endDate:n})}async getAppointmentById(e){return this.executeQuery("GetAppointmentById",{appointmentId:e})}async createAppointment(e){return this.executeMutation("CreateAppointment",e)}async updateAppointment(e,t){return this.executeMutation("UpdateAppointment",(0,r.A)({appointmentId:e},t))}async deleteAppointment(e){return this.executeMutation("DeleteAppointment",{appointmentId:e})}async getCaregiverRelationships(e){return this.executeQuery("GetCaregiverRelationships",{elderlyProfileId:e})}async getCurrentUserCaregivers(){return this.executeQuery("GetCurrentUserCaregivers")}async getCaregiverPatients(e){return this.executeQuery("GetCaregiverPatients",{caregiverId:e})}async getCurrentCaregiverPatients(){return this.executeQuery("GetCurrentCaregiverPatients")}async createCaregiverRelationship(e){return this.executeMutation("CreateCaregiverRelationship",e)}async updateCaregiverRelationship(e,t){return this.executeMutation("UpdateCaregiverRelationship",(0,r.A)({relationshipId:e},t))}async deleteCaregiverRelationship(e){return this.executeMutation("DeleteCaregiverRelationship",{relationshipId:e})}async batchExecute(e){try{re.A.debug("Executing batch operations",{operationCount:e.length});const t=await Promise.allSettled(e.map(e=>{if("query"===e.type)return this.executeQuery(e.name,e.variables);if("mutation"===e.type)return this.executeMutation(e.name,e.variables);throw new Error("Unknown operation type: ".concat(e.type))})),n=t.filter(e=>"fulfilled"===e.status),r=t.filter(e=>"rejected"===e.status);return re.A.info("Batch operations completed",{successful:n.length,failed:r.length}),{successful:n,failed:r}}catch(t){throw re.A.error("Batch operations failed",{error:t}),ne.Ay.handleError(t,{context:"data_connect_batch"}),t}}}},7061:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),function(){var e=t,n=e.lib.Hasher,r=e.x64,i=r.Word,s=r.WordArray,a=e.algo;function o(){return i.create.apply(i,arguments)}var c=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],l=[];!function(){for(var e=0;e<80;e++)l[e]=o()}();var d=a.SHA512=n.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],a=n[3],o=n[4],d=n[5],u=n[6],h=n[7],p=r.high,m=r.low,f=i.high,g=i.low,v=s.high,y=s.low,_=a.high,E=a.low,b=o.high,x=o.low,w=d.high,S=d.low,T=u.high,N=u.low,C=h.high,A=h.low,R=p,I=m,O=f,P=g,k=v,D=y,L=_,j=E,M=b,U=x,V=w,F=S,B=T,G=N,H=C,W=A,z=0;z<80;z++){var K,q,Y=l[z];if(z<16)q=Y.high=0|e[t+2*z],K=Y.low=0|e[t+2*z+1];else{var X=l[z-15],J=X.high,Q=X.low,Z=(J>>>1|Q<<31)^(J>>>8|Q<<24)^J>>>7,$=(Q>>>1|J<<31)^(Q>>>8|J<<24)^(Q>>>7|J<<25),ee=l[z-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ie=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),se=l[z-7],ae=se.high,oe=se.low,ce=l[z-16],le=ce.high,de=ce.low;q=(q=(q=Z+ae+((K=$+oe)>>>0<$>>>0?1:0))+re+((K+=ie)>>>0<ie>>>0?1:0))+le+((K+=de)>>>0<de>>>0?1:0),Y.high=q,Y.low=K}var ue,he=M&V^~M&B,pe=U&F^~U&G,me=R&O^R&k^O&k,fe=I&P^I&D^P&D,ge=(R>>>28|I<<4)^(R<<30|I>>>2)^(R<<25|I>>>7),ve=(I>>>28|R<<4)^(I<<30|R>>>2)^(I<<25|R>>>7),ye=(M>>>14|U<<18)^(M>>>18|U<<14)^(M<<23|U>>>9),_e=(U>>>14|M<<18)^(U>>>18|M<<14)^(U<<23|M>>>9),Ee=c[z],be=Ee.high,xe=Ee.low,we=H+ye+((ue=W+_e)>>>0<W>>>0?1:0),Se=ve+fe;H=B,W=G,B=V,G=F,V=M,F=U,M=L+(we=(we=(we=we+he+((ue+=pe)>>>0<pe>>>0?1:0))+be+((ue+=xe)>>>0<xe>>>0?1:0))+q+((ue+=K)>>>0<K>>>0?1:0))+((U=j+ue|0)>>>0<j>>>0?1:0)|0,L=k,j=D,k=O,D=P,O=R,P=I,R=we+(ge+me+(Se>>>0<ve>>>0?1:0))+((I=ue+Se|0)>>>0<ue>>>0?1:0)|0}m=r.low=m+I,r.high=p+R+(m>>>0<I>>>0?1:0),g=i.low=g+P,i.high=f+O+(g>>>0<P>>>0?1:0),y=s.low=y+D,s.high=v+k+(y>>>0<D>>>0?1:0),E=a.low=E+j,a.high=_+L+(E>>>0<j>>>0?1:0),x=o.low=x+U,o.high=b+M+(x>>>0<U>>>0?1:0),S=d.low=S+F,d.high=w+V+(S>>>0<F>>>0?1:0),N=u.low=N+G,u.high=T+B+(N>>>0<G>>>0?1:0),A=h.low=A+W,h.high=C+H+(A>>>0<W>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=n._createHelper(d),e.HmacSHA512=n._createHmacHelper(d)}(),t.SHA512)}()},7210:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>g});var r=n(2555),i=n(2145),s=n(2174);const a="network",o="auth",c="permission",l="validation",d="server",u="unknown",h="low",p="medium",m="high",f="critical";const g=new class{constructor(){this.errorLog=[],this.maxLogSize=100,this.isOnline=navigator.onLine,window.addEventListener("online",()=>{this.isOnline=!0,this.syncOfflineErrors()}),window.addEventListener("offline",()=>{this.isOnline=!1})}handleError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.analyzeError(e,t);return this.logError(n),this.showUserNotification(n),s.A.isProduction()&&this.reportToMonitoring(n),n}analyzeError(e,t){return{id:this.generateErrorId(),timestamp:(new Date).toISOString(),message:e.message||"An unexpected error occurred",stack:e.stack,type:this.determineErrorType(e),severity:this.determineErrorSeverity(e,t),context:t,userMessage:this.generateUserMessage(e,t),action:this.determineAction(e,t),isOnline:this.isOnline}}determineErrorType(e){var t,n;return"auth/user-not-found"===e.code||"auth/wrong-password"===e.code?o:"permission-denied"===e.code||"auth/insufficient-permission"===e.code?c:"unavailable"===e.code||null!==(t=e.message)&&void 0!==t&&t.includes("network")?a:"invalid-argument"===e.code||"failed-precondition"===e.code?l:null!==(n=e.code)&&void 0!==n&&n.startsWith("functions/")||e.status>=500?d:u}determineErrorSeverity(e,t){return"auth/network-request-failed"===e.code&&t.critical||e.type===c&&t.sensitive?f:e.type===o||e.type===d?m:e.type===a||e.type===l?p:h}generateUserMessage(e,t){switch(this.determineErrorType(e)){case o:return"Please check your login credentials and try again.";case c:return"You don't have permission to perform this action.";case a:return"Please check your internet connection and try again.";case l:return"Please check your input and try again.";case d:return"Our servers are experiencing issues. Please try again later.";default:return"Something went wrong. Please try again."}}determineAction(e,t){switch(this.determineErrorType(e)){case o:return{type:"redirect",path:"/login"};case c:return{type:"redirect",path:"/dashboard"};case a:return{type:"retry",delay:3e3};case l:return{type:"fix_input"};case d:return{type:"retry",delay:5e3};default:return{type:"none"}}}showUserNotification(e){const{severity:t,userMessage:n,action:r}=e;let s="error",a=5e3;switch(t){case f:s="error",a=!1;break;case m:s="error",a=7e3;break;case p:s="warning",a=5e3;break;case h:s="info",a=3e3}i.oR[s](n,{autoClose:a,position:"top-right",hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),"redirect"===r.type&&setTimeout(()=>{window.location.href=r.path},2e3)}logError(e){this.errorLog.push(e),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(-this.maxLogSize));try{localStorage.setItem("elderx_error_log",JSON.stringify(this.errorLog))}catch(t){console.warn("Could not save error log to localStorage:",t)}s.A.isDevelopment()&&console.error("Error handled:",e)}async reportToMonitoring(e){try{console.log("Reporting error to monitoring service:",e)}catch(t){console.error("Failed to report error to monitoring service:",t)}}async syncOfflineErrors(){const e=this.errorLog.filter(e=>!e.isOnline);for(const t of e)await this.reportToMonitoring(t)}getErrorLog(){return this.errorLog}clearErrorLog(){this.errorLog=[],localStorage.removeItem("elderx_error_log")}generateErrorId(){return"error_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}handleNetworkError(e,t){return this.handleError(e,(0,r.A)((0,r.A)({},t),{},{type:a}))}handleAuthError(e,t){return this.handleError(e,(0,r.A)((0,r.A)({},t),{},{type:o}))}handlePermissionError(e,t){return this.handleError(e,(0,r.A)((0,r.A)({},t),{},{type:c}))}handleValidationError(e,t){return this.handleError(e,(0,r.A)((0,r.A)({},t),{},{type:l}))}}},7227:(e,t,n)=>{"use strict";n.d(t,{j2:()=>B,db:()=>G,Cn:()=>H});var r=n(9232);(0,r.KO)("firebase","12.2.1","app");var i=n(823),s=n(6667),a=n(1889),o=n(1776),c=n(9606);const l="firebasestorage.googleapis.com",d="storageBucket";class u extends o.g{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(m(e),"Firebase Storage: ".concat(t," (").concat(m(e),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,u.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return m(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var h,p;function m(e){return"storage/"+e}function f(){return new u(h.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function g(){return new u(h.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function v(){return new u(h.CANCELED,"User canceled the upload/download.")}function y(e){return new u(h.INVALID_ARGUMENT,e)}function _(){return new u(h.APP_DELETED,"The Firebase app was deleted.")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(h||(h={}));class E{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=E.makeFromUrl(e,t)}catch(i){return new E(e,"")}if(""===n.path)return n;throw r=e,new u(h.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),o=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(a,"/").concat("v[A-Za-z0-9_]+","/b/").concat(r,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp("^https?://".concat(t===l?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(r,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:s}];for(let c=0;c<o.length;c++){const t=o[c],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new E(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new u(h.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class b{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function x(e,t,n,r){if(r<t)throw y("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(r>n)throw y("Invalid value for '".concat(e,"'. Expected ").concat(n," or less."))}function w(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function S(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(p||(p={}));class T{constructor(e,t,n,r,i,s,a,o,c,l,d){let u=!(arguments.length>11&&void 0!==arguments[11])||arguments[11],h=arguments.length>12&&void 0!==arguments[12]&&arguments[12];this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=d,this.retry=u,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new N(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===p.NO_ERROR,i=n.getStatus();if(!t||S(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===p.ABORT;return void e(!1,new N(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new N(s,n))})},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(s){r(s)}else if(null!==i){const e=f();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?_():v())}else{r(g())}};this.canceled_?t(0,new N(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,a=!1,o=0;function c(){return 2===o}let l=!1;function d(){if(!l){l=!0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(null,n)}}function u(t){i=setTimeout(()=>{i=null,e(p,c())},t)}function h(){s&&clearTimeout(s)}function p(e){if(l)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e)return h(),void d.call(null,e,...n);if(c()||a)return h(),void d.call(null,e,...n);let s;r<64&&(r*=2),1===o?(o=2,s=0):s=1e3*(r+Math.random()),u(s)}let m=!1;function f(e){m||(m=!0,h(),l||(null!==i?(e||(o=2),clearTimeout(i),u(0)):e||(o=1)))}return u(0),s=setTimeout(()=>{a=!0,f(!0)},n),f}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class N{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function C(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}class A{constructor(e,t){this._service=e,this._location=t instanceof E?t:E.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new A(e,t)}get root(){const e=new E(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return C(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new E(this._location.bucket,e);return new A(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new u(h.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function R(e,t){const n=null===t||void 0===t?void 0:t[d];return null==n?null:E.makeFromBucketSpec(n,e)}class I{constructor(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=l,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?E.makeFromBucketSpec(r,this._host):R(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=E.makeFromBucketSpec(this._url,e):this._bucket=R(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){x("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){x("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if((0,r.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new A(this,e)}_makeRequest(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new b(_());{const s=function(e,t,n,r,i,s){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const c=w(e.urlParams),l=e.url+c,d=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(d,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(d,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(d,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(d,r),new T(l,e.method,d,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}(e,this._appId,n,r,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const O="@firebase/storage",P="0.14.0",k="storage";function D(e,t){let{instanceIdentifier:n}=t;const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal");return new I(i,s,a,n,r.MF)}(0,r.om)(new c.uA(k,D,"PUBLIC").setMultipleInstances(!0)),(0,r.KO)(O,P,""),(0,r.KO)(O,P,"esm2020");var L,j,M=n(7371),U=n(5452);let V=M.A.getFirebaseConfig();null!==(L=V)&&void 0!==L&&L.apiKey&&null!==(j=V)&&void 0!==j&&j.projectId||(U.A.warn("Firebase config missing from env; falling back to public config."),V={apiKey:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",authDomain:"elderx-f5c2b.firebaseapp.com",projectId:"elderx-f5c2b",storageBucket:"elderx-f5c2b.firebasestorage.app",messagingSenderId:"987610993096",appId:"1:987610993096:web:97c82732772d1223d3f0fd"});const F=(0,r.Wp)(V),B=(0,i.xI)(F),G=(0,s.aU)(F),H=(0,a.Uz)(F);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,r.Sx)(),t=arguments.length>1?arguments[1]:void 0;e=(0,o.Ku)(e);const n=(0,r.j6)(e,k).getImmediate({identifier:t}),i=(0,o.yU)("storage");i&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(n);const i=(0,o.zJ)(t);i&&((0,o.gE)("https://".concat(e.host,"/b")),(0,o.P1)("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";const{mockUserToken:s}=r;s&&(e._overrideAuthToken="string"===typeof s?s:(0,o.Fy)(s,e.app.options.projectId))}(e,t,n,r)}(n,...i)}(F)},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<s(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var o=2*(r+1)-1,c=e[o],l=o+1,d=e[l];if(0>s(c,n))l<i&&0>s(d,c)?(e[r]=d,e[l]=n,r=l):(e[r]=c,e[o]=n,r=o);else{if(!(l<i&&0>s(d,n)))break e;e[r]=d,e[l]=n,r=l}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,c=o.now();t.unstable_now=function(){return o.now()-c}}var l=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=r(d);null!==t;){if(null===t.callback)i(d);else{if(!(t.startTime<=e))break;i(d),t.sortIndex=t.expirationTime,n(l,t)}t=r(d)}}function b(e){if(g=!1,E(e),!f)if(null!==r(l))f=!0,k(x);else{var t=r(d);null!==t&&D(b,t.startTime-e)}}function x(e,n){f=!1,g&&(g=!1,y(N),N=-1),m=!0;var s=p;try{for(E(n),h=r(l);null!==h&&(!(h.expirationTime>n)||e&&!R());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(l)&&i(l),E(n)}else i(l);h=r(l)}if(null!==h)var c=!0;else{var u=r(d);null!==u&&D(b,u.startTime-n),c=!1}return c}finally{h=null,p=s,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,S=!1,T=null,N=-1,C=5,A=-1;function R(){return!(t.unstable_now()-A<C)}function I(){if(null!==T){var e=t.unstable_now();A=e;var n=!0;try{n=T(!0,e)}finally{n?w():(S=!1,T=null)}}else S=!1}if("function"===typeof _)w=function(){_(I)};else if("undefined"!==typeof MessageChannel){var O=new MessageChannel,P=O.port2;O.port1.onmessage=I,w=function(){P.postMessage(null)}}else w=function(){v(I,0)};function k(e){T=e,S||(S=!0,w())}function D(e,n){N=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,k(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:i,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(d,e),null===r(l)&&e===r(d)&&(g?(y(N),N=-1):g=!0,D(b,s-a))):(e.sortIndex=o,n(l,e),f||m||(f=!0,k(x))),e},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},7371:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(2555),i=n(9997),s=(n(7210),n(5452));const a=new class{constructor(){this.config=this.loadSecureConfig(),this.validateConfig()}loadSecureConfig(){return{firebase:{apiKey:this.getSecureValue("REACT_APP_FIREBASE_API_KEY"),authDomain:this.getSecureValue("REACT_APP_FIREBASE_AUTH_DOMAIN"),projectId:this.getSecureValue("REACT_APP_FIREBASE_PROJECT_ID"),storageBucket:this.getSecureValue("REACT_APP_FIREBASE_STORAGE_BUCKET"),messagingSenderId:this.getSecureValue("REACT_APP_FIREBASE_MESSAGING_SENDER_ID"),appId:this.getSecureValue("REACT_APP_FIREBASE_APP_ID")},ai:{openai:this.getSecureValue("REACT_APP_OPENAI_API_KEY"),google:this.getSecureValue("REACT_APP_GOOGLE_AI_API_KEY"),anthropic:this.getSecureValue("REACT_APP_ANTHROPIC_API_KEY")},security:{encryptionKey:this.getSecureValue("REACT_APP_ENCRYPTION_KEY"),jwtSecret:this.getSecureValue("REACT_APP_JWT_SECRET"),sessionTimeout:parseInt(this.getSecureValue("REACT_APP_SESSION_TIMEOUT","3600")),maxLoginAttempts:parseInt(this.getSecureValue("REACT_APP_MAX_LOGIN_ATTEMPTS","5")),lockoutDuration:parseInt(this.getSecureValue("REACT_APP_LOCKOUT_DURATION","900"))},features:{twoFactorAuth:"true"===this.getSecureValue("REACT_APP_ENABLE_2FA","false"),biometricAuth:"true"===this.getSecureValue("REACT_APP_ENABLE_BIOMETRIC","false"),dataEncryption:"true"===this.getSecureValue("REACT_APP_ENABLE_ENCRYPTION","true"),auditLogging:"true"===this.getSecureValue("REACT_APP_ENABLE_AUDIT_LOG","true"),rateLimiting:"true"===this.getSecureValue("REACT_APP_ENABLE_RATE_LIMITING","true")},environment:"production",isProduction:!0,isDevelopment:!1}}getSecureValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}[e]||t;if(this.isProduction&&this.isEncryptedValue(n))try{return i.A.decrypt(n)}catch(r){return s.A.error("Failed to decrypt config value: ".concat(e),{error:r}),t}return n}isEncryptedValue(e){return"string"===typeof e&&e.startsWith("enc:")}validateConfig(){const e=["REACT_APP_FIREBASE_API_KEY","REACT_APP_FIREBASE_PROJECT_ID"].filter(e=>!{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}[e]);e.length>0&&s.A.error("Missing required configuration keys",{missingKeys:e}),this.config.firebase.apiKey&&this.config.firebase.projectId||s.A.warn("Firebase configuration incomplete; downstream will use safe fallbacks."),this.config.isProduction&&(this.config.security.encryptionKey?i.A.validateKeyStrength(this.config.security.encryptionKey)||s.A.warn("Encryption key may be weak; consider rotating to a stronger key."):s.A.warn("Encryption key missing in production; continuing with generated key.")),s.A.info("Configuration validated successfully")}get(e){const t=e.split(".");let n=this.config;for(const i of t){var r;if(n=null===(r=n)||void 0===r?void 0:r[i],void 0===n)break}return n}getFirebaseConfig(){return this.config.firebase}getAIKeys(){return this.config.ai}getSecurityConfig(){return this.config.security}getFeatureFlags(){return this.config.features}isFeatureEnabled(e){return!0===this.config.features[e]}getEnvironment(){return{environment:this.config.environment,isProduction:this.config.isProduction,isDevelopment:this.config.isDevelopment}}encryptConfig(e){const t=["apiKey","secret","password","token","key"],n=(0,r.A)({},e);return Object.keys(n).forEach(e=>{t.some(t=>e.toLowerCase().includes(t))&&"string"===typeof n[e]&&(n[e]="enc:".concat(i.A.encrypt(n[e])))}),n}decryptConfig(e){const t=(0,r.A)({},e);return Object.keys(t).forEach(e=>{if("string"===typeof t[e]&&t[e].startsWith("enc:"))try{t[e]=i.A.decrypt(t[e].substring(4))}catch(n){s.A.warn("Failed to decrypt config key: ".concat(e),{error:n})}}),t}generateSecureConfig(){const e={firebase:this.config.firebase,security:{sessionTimeout:this.config.security.sessionTimeout,maxLoginAttempts:this.config.security.maxLoginAttempts,lockoutDuration:this.config.security.lockoutDuration},features:this.config.features,environment:this.config.environment};return this.encryptConfig(e)}}},7423:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib,r=n.WordArray,i=n.Hasher,s=e.algo,a=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=r.create([0,1518500249,1859775393,2400959708,2840853838]),u=r.create([1352829926,1548603684,1836072691,2053994217,0]),h=s.RIPEMD160=i.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s,h,_,E,b,x,w,S,T,N,C,A=this._hash.words,R=d.words,I=u.words,O=a.words,P=o.words,k=c.words,D=l.words;for(x=s=A[0],w=h=A[1],S=_=A[2],T=E=A[3],N=b=A[4],n=0;n<80;n+=1)C=s+e[t+O[n]]|0,C+=n<16?p(h,_,E)+R[0]:n<32?m(h,_,E)+R[1]:n<48?f(h,_,E)+R[2]:n<64?g(h,_,E)+R[3]:v(h,_,E)+R[4],C=(C=y(C|=0,k[n]))+b|0,s=b,b=E,E=y(_,10),_=h,h=C,C=x+e[t+P[n]]|0,C+=n<16?v(w,S,T)+I[0]:n<32?g(w,S,T)+I[1]:n<48?f(w,S,T)+I[2]:n<64?m(w,S,T)+I[3]:p(w,S,T)+I[4],C=(C=y(C|=0,D[n]))+N|0,x=N,N=T,T=y(S,10),S=w,w=C;C=A[1]+_+T|0,A[1]=A[2]+E+N|0,A[2]=A[3]+b+x|0,A[3]=A[4]+s+w|0,A[4]=A[0]+h+S|0,A[0]=C},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,s=i.words,a=0;a<5;a++){var o=s[a];s[a]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return i},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function p(e,t,n){return e^t^n}function m(e,t,n){return e&t|~e&n}function f(e,t,n){return(e|~t)^n}function g(e,t,n){return e&n|t&~n}function v(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}e.RIPEMD160=i._createHelper(h),e.HmacRIPEMD160=i._createHmacHelper(h)}(Math),t.RIPEMD160)}()},7780:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.BlockCipher,r=e.algo,i=[],s=[],a=[],o=[],c=[],l=[],d=[],u=[],h=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,r=0;for(t=0;t<256;t++){var m=r^r<<1^r<<2^r<<3^r<<4;m=m>>>8^255&m^99,i[n]=m,s[m]=n;var f=e[n],g=e[f],v=e[g],y=257*e[m]^16843008*m;a[n]=y<<24|y>>>8,o[n]=y<<16|y>>>16,c[n]=y<<8|y>>>24,l[n]=y,y=16843009*v^65537*g^257*f^16843008*n,d[m]=y<<24|y>>>8,u[m]=y<<16|y>>>16,h[m]=y<<8|y>>>24,p[m]=y,n?(n=f^e[e[e[v^f]]],r^=e[e[r]]):n=r=1}}();var m=[0,1,2,4,8,16,32,64,128,27,54],f=r.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=4*((this._nRounds=n+6)+1),s=this._keySchedule=[],a=0;a<r;a++)a<n?s[a]=t[a]:(l=s[a-1],a%n?n>6&&a%n==4&&(l=i[l>>>24]<<24|i[l>>>16&255]<<16|i[l>>>8&255]<<8|i[255&l]):(l=i[(l=l<<8|l>>>24)>>>24]<<24|i[l>>>16&255]<<16|i[l>>>8&255]<<8|i[255&l],l^=m[a/n|0]<<24),s[a]=s[a-n]^l);for(var o=this._invKeySchedule=[],c=0;c<r;c++){if(a=r-c,c%4)var l=s[a];else l=s[a-4];o[c]=c<4||a<=4?l:d[i[l>>>24]]^u[i[l>>>16&255]]^h[i[l>>>8&255]]^p[i[255&l]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,o,c,l,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,d,u,h,p,s),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,s,a,o){for(var c=this._nRounds,l=e[t]^n[0],d=e[t+1]^n[1],u=e[t+2]^n[2],h=e[t+3]^n[3],p=4,m=1;m<c;m++){var f=r[l>>>24]^i[d>>>16&255]^s[u>>>8&255]^a[255&h]^n[p++],g=r[d>>>24]^i[u>>>16&255]^s[h>>>8&255]^a[255&l]^n[p++],v=r[u>>>24]^i[h>>>16&255]^s[l>>>8&255]^a[255&d]^n[p++],y=r[h>>>24]^i[l>>>16&255]^s[d>>>8&255]^a[255&u]^n[p++];l=f,d=g,u=v,h=y}f=(o[l>>>24]<<24|o[d>>>16&255]<<16|o[u>>>8&255]<<8|o[255&h])^n[p++],g=(o[d>>>24]<<24|o[u>>>16&255]<<16|o[h>>>8&255]<<8|o[255&l])^n[p++],v=(o[u>>>24]<<24|o[h>>>16&255]<<16|o[l>>>8&255]<<8|o[255&d])^n[p++],y=(o[h>>>24]<<24|o[l>>>16&255]<<16|o[d>>>8&255]<<8|o[255&u])^n[p++],e[t]=f,e[t+1]=g,e[t+2]=v,e[t+3]=y},keySize:8});e.AES=n._createHelper(f)}(),t.AES)}()},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},7962:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.CTR=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0);var a=s.slice(0);n.encryptBlock(a,0),s[r-1]=s[r-1]+1|0;for(var o=0;o<r;o++)e[t+o]^=a[o]}});return e.Decryptor=n,e}(),t.mode.CTR)}()},8049:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.CTRGladman=function(){var e=t.lib.BlockCipherMode.extend();function n(e){if(255===(e>>24&255)){var t=e>>16&255,n=e>>8&255,r=255&e;255===t?(t=0,255===n?(n=0,255===r?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}else e+=1<<24;return e}function r(e){return 0===(e[0]=n(e[0]))&&(e[1]=n(e[1])),e}var i=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,s=this._iv,a=this._counter;s&&(a=this._counter=s.slice(0),this._iv=void 0),r(a);var o=a.slice(0);n.encryptBlock(o,0);for(var c=0;c<i;c++)e[t+c]^=o[c]}});return e.Decryptor=i,e}(),t.mode.CTRGladman)}()},8099:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.mode.ECB=function(){var e=t.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e}(),t.mode.ECB)}()},8168:(e,t,n)=>{"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(null,arguments)}n.d(t,{A:()=>r})},8211:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2002),n(4220),function(){var e=t,n=e.lib,r=n.Base,i=n.WordArray,s=e.algo,a=s.MD5,o=s.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,s=r.hasher.create(),a=i.create(),o=a.words,c=r.keySize,l=r.iterations;o.length<c;){n&&s.update(n),n=s.update(e).finalize(t),s.reset();for(var d=1;d<l;d++)n=s.finalize(n),s.reset();a.concat(n)}return a.sigBytes=4*c,a}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),t.EvpKDF)}()},8523:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(){var e=t,n=e.lib.WordArray;function r(e,t,r){for(var i=[],s=0,a=0;a<t;a++)if(a%4){var o=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;i[s>>>2]|=o<<24-s%4*8,s++}return n.create(i,s)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],s=0;s<n;s+=3)for(var a=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,o=0;o<4&&s+.75*o<n;o++)i.push(r.charAt(a>>>6*(3-o)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var s=0;s<n.length;s++)i[n.charCodeAt(s)]=s}var a=n.charAt(64);if(a){var o=e.indexOf(a);-1!==o&&(t=o)}return r(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64)}()},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},8870:(e,t,n)=>{"use strict";n.d(t,{BH:()=>y,Cp:()=>g,F$:()=>m,G6:()=>w,HN:()=>c,MK:()=>h,Od:()=>f,S$:()=>i,Zw:()=>a,b_:()=>u,gn:()=>o,j3:()=>l,jY:()=>S,lQ:()=>s,nJ:()=>p,vh:()=>d,yy:()=>x});var r=n(8168),i="undefined"===typeof window;function s(){}function a(e,t){return"function"===typeof e?e(t):e}function o(e){return"number"===typeof e&&e>=0&&e!==1/0}function c(e){return Array.isArray(e)?e:[e]}function l(e,t){return Math.max(e+(t||0)-Date.now(),0)}function d(e,t,n){return b(e)?"function"===typeof t?(0,r.A)({},n,{queryKey:e,queryFn:t}):(0,r.A)({},t,{queryKey:e}):e}function u(e,t,n){return b(e)?[(0,r.A)({},t,{queryKey:e}),n]:[e||{},t]}function h(e,t){var n=e.active,r=e.exact,i=e.fetching,s=e.inactive,a=e.predicate,o=e.queryKey,c=e.stale;if(b(o))if(r){if(t.queryHash!==m(o,t.options))return!1}else if(!g(t.queryKey,o))return!1;var l=function(e,t){return!0===e&&!0===t||null==e&&null==t?"all":!1===e&&!1===t?"none":(null!=e?e:!t)?"active":"inactive"}(n,s);if("none"===l)return!1;if("all"!==l){var d=t.isActive();if("active"===l&&!d)return!1;if("inactive"===l&&d)return!1}return("boolean"!==typeof c||t.isStale()===c)&&(("boolean"!==typeof i||t.isFetching()===i)&&!(a&&!a(t)))}function p(e,t){var n=e.exact,r=e.fetching,i=e.predicate,s=e.mutationKey;if(b(s)){if(!t.options.mutationKey)return!1;if(n){if(f(t.options.mutationKey)!==f(s))return!1}else if(!g(t.options.mutationKey,s))return!1}return("boolean"!==typeof r||"loading"===t.state.status===r)&&!(i&&!i(t))}function m(e,t){return((null==t?void 0:t.queryKeyHashFn)||f)(e)}function f(e){var t,n=c(e);return t=n,JSON.stringify(t,function(e,t){return _(t)?Object.keys(t).sort().reduce(function(e,n){return e[n]=t[n],e},{}):t})}function g(e,t){return v(c(e),c(t))}function v(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&!Object.keys(t).some(function(n){return!v(e[n],t[n])}))}function y(e,t){if(e===t)return e;var n=Array.isArray(e)&&Array.isArray(t);if(n||_(e)&&_(t)){for(var r=n?e.length:Object.keys(e).length,i=n?t:Object.keys(t),s=i.length,a=n?[]:{},o=0,c=0;c<s;c++){var l=n?c:i[c];a[l]=y(e[l],t[l]),a[l]===e[l]&&o++}return r===s&&o===r?e:a}return t}function _(e){if(!E(e))return!1;var t=e.constructor;if("undefined"===typeof t)return!0;var n=t.prototype;return!!E(n)&&!!n.hasOwnProperty("isPrototypeOf")}function E(e){return"[object Object]"===Object.prototype.toString.call(e)}function b(e){return"string"===typeof e||Array.isArray(e)}function x(e){return new Promise(function(t){setTimeout(t,e)})}function w(e){Promise.resolve().then(e).catch(function(e){return setTimeout(function(){throw e})})}function S(){if("function"===typeof AbortController)return new AbortController}},8875:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.StreamCipher,r=e.algo,i=[],s=[],a=[],o=r.Rabbit=n.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)i[n]^=r[n+4&7];if(t){var s=t.words,a=s[0],o=s[1],l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=l>>>16|4294901760&d,h=d<<16|65535&l;for(i[0]^=l,i[1]^=u,i[2]^=d,i[3]^=h,i[4]^=l,i[5]^=u,i[6]^=d,i[7]^=h,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,o=r>>>16,c=((i*i>>>17)+i*o>>>15)+o*o,l=((4294901760&r)*r|0)+((65535&r)*r|0);a[n]=c^l}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=n._createHelper(o)}(),t.Rabbit)}()},9092:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(9749),n(7061),function(){var e=t,n=e.x64,r=n.Word,i=n.WordArray,s=e.algo,a=s.SHA512,o=s.SHA384=a.extend({_doReset:function(){this._hash=new i.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=a._createHelper(o),e.HmacSHA384=a._createHmacHelper(o)}(),t.SHA384)}()},9132:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(2238),t.pad.Iso10126={pad:function(e,n){var r=4*n,i=r-e.sigBytes%r;e.concat(t.lib.WordArray.random(i-1)).concat(t.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},t.pad.Iso10126)}()},9232:(e,t,n)=>{"use strict";n.d(t,{MF:()=>he,j6:()=>ae,xZ:()=>ce,om:()=>se,Us:()=>oe,Sx:()=>me,Wp:()=>pe,KO:()=>fe});var r=n(2555),i=n(9606),s=n(2965),a=n(1776);let o,c;const l=new WeakMap,d=new WeakMap,u=new WeakMap,h=new WeakMap,p=new WeakMap;let m={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return d.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return v(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(y(this),n),v(l.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return v(e.apply(y(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const s=e.call(y(this),t,...r);return u.set(s,t.sort?t.sort():[t]),v(s)}}function g(e){return"function"===typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(d.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});d.set(e,t)}(e),t=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,m):e);var t}function v(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(v(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&l.set(t,e)}).catch(()=>{}),p.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=g(e);return t!==e&&(h.set(e,t),p.set(t,e)),t}const y=e=>p.get(e);const _=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],b=new Map;function x(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(b.get(t))return b.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!_.includes(n))return;const s=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let s=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=arguments[c];return r&&(s=s.index(o.shift())),(await Promise.all([s[n](...o),i&&t.done]))[0]};return b.set(t,s),s}m=(e=>(0,r.A)((0,r.A)({},e),{},{get:(t,n,r)=>x(t,n)||e.get(t,n,r),has:(t,n)=>!!x(t,n)||e.has(t,n)}))(m);class w{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const S="@firebase/app",T="0.14.2",N=new s.Vy("@firebase/app"),C="@firebase/app-compat",A="@firebase/analytics-compat",R="@firebase/analytics",I="@firebase/app-check-compat",O="@firebase/app-check",P="@firebase/auth",k="@firebase/auth-compat",D="@firebase/database",L="@firebase/data-connect",j="@firebase/database-compat",M="@firebase/functions",U="@firebase/functions-compat",V="@firebase/installations",F="@firebase/installations-compat",B="@firebase/messaging",G="@firebase/messaging-compat",H="@firebase/performance",W="@firebase/performance-compat",z="@firebase/remote-config",K="@firebase/remote-config-compat",q="@firebase/storage",Y="@firebase/storage-compat",X="@firebase/firestore",J="@firebase/ai",Q="@firebase/firestore-compat",Z="firebase",$="[DEFAULT]",ee={[S]:"fire-core",[C]:"fire-core-compat",[R]:"fire-analytics",[A]:"fire-analytics-compat",[O]:"fire-app-check",[I]:"fire-app-check-compat",[P]:"fire-auth",[k]:"fire-auth-compat",[D]:"fire-rtdb",[L]:"fire-data-connect",[j]:"fire-rtdb-compat",[M]:"fire-fn",[U]:"fire-fn-compat",[V]:"fire-iid",[F]:"fire-iid-compat",[B]:"fire-fcm",[G]:"fire-fcm-compat",[H]:"fire-perf",[W]:"fire-perf-compat",[z]:"fire-rc",[K]:"fire-rc-compat",[q]:"fire-gcs",[Y]:"fire-gcs-compat",[X]:"fire-fst",[Q]:"fire-fst-compat",[J]:"fire-vertex","fire-js":"fire-js",[Z]:"fire-js-all"},te=new Map,ne=new Map,re=new Map;function ie(e,t){try{e.container.addComponent(t)}catch(n){N.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function se(e){const t=e.name;if(re.has(t))return N.debug("There were multiple attempts to register component ".concat(t,".")),!1;re.set(t,e);for(const n of te.values())ie(n,e);for(const n of ne.values())ie(n,e);return!0}function ae(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function oe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$;ae(e,t).clearInstance(n)}function ce(e){return null!==e&&void 0!==e&&void 0!==e.settings}const le={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},de=new a.FA("app","Firebase",le);class ue{constructor(e,t,n){this._isDeleted=!1,this._options=(0,r.A)({},e),this._config=(0,r.A)({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw de.create("app-deleted",{appName:this._name})}}const he="12.2.0";function pe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const s=(0,r.A)({name:$,automaticDataCollectionEnabled:!0},t),o=s.name;if("string"!==typeof o||!o)throw de.create("bad-app-name",{appName:String(o)});if(n||(n=(0,a.T9)()),!n)throw de.create("no-options");const c=te.get(o);if(c){if((0,a.bD)(n,c.options)&&(0,a.bD)(s,c.config))return c;throw de.create("duplicate-app",{appName:o})}const l=new i.h1(o);for(const r of re.values())l.addComponent(r);const d=new ue(n,s,l);return te.set(o,d),d}function me(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$;const t=te.get(e);if(!t&&e===$&&(0,a.T9)())return pe();if(!t)throw de.create("no-app",{appName:e});return t}function fe(e,t,n){var r;let s=null!==(r=ee[e])&&void 0!==r?r:e;n&&(s+="-".concat(n));const a=s.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const e=['Unable to register library "'.concat(s,'" with version "').concat(t,'":')];return a&&e.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),a&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void N.warn(e.join(" "))}se(new i.uA("".concat(s,"-version"),()=>({library:s,version:t}),"VERSION"))}const ge="firebase-heartbeat-store";let ve=null;function ye(){return ve||(ve=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=v(a);return r&&a.addEventListener("upgradeneeded",e=>{r(v(a.result),e.oldVersion,e.newVersion,v(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ge)}catch(n){console.warn(n)}}}).catch(e=>{throw de.create("idb-open",{originalErrorMessage:e.message})})),ve}async function _e(e,t){try{const n=(await ye()).transaction(ge,"readwrite"),r=n.objectStore(ge);await r.put(t,Ee(e)),await n.done}catch(n){if(n instanceof a.g)N.warn(n.message);else{const e=de.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});N.warn(e.message)}}}function Ee(e){return"".concat(e.name,"!").concat(e.options.appId)}class be{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new we(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{var e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=xe();var t;if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){N.warn(n)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=xe(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),Se(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Se(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=(0,a.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return N.warn(t),""}}}function xe(){return(new Date).toISOString().substring(0,10)}class we{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,a.zW)()&&(0,a.eX)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ye()).transaction(ge),n=await t.objectStore(ge).get(Ee(e));return await t.done,n}catch(t){if(t instanceof a.g)N.warn(t.message);else{const e=de.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});N.warn(e.message)}}}(this.app);return null!==e&&void 0!==e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return _e(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return _e(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Se(e){return(0,a.Uj)(JSON.stringify({version:2,heartbeats:e})).length}var Te;Te="",se(new i.uA("platform-logger",e=>new w(e),"PRIVATE")),se(new i.uA("heartbeat",e=>new be(e),"PRIVATE")),fe(S,T,Te),fe(S,T,"esm2020"),fe("fire-js","")},9416:(e,t,n)=>{"use strict";n.d(t,{createUser:()=>m,CF:()=>h,kl:()=>p,TK:()=>f});var r=n(2555),i=n(6667),s=n(7227),a=(n(6685),n(9997)),o=n(7210),c=n(5452),l=n(7371);const d=new class{constructor(){this.encryptionEnabled=l.A.isFeatureEnabled("dataEncryption"),this.auditLoggingEnabled=l.A.isFeatureEnabled("auditLogging")}async storeSecureData(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const{encrypt:o=!0,audit:d=!0}=l;let u=(0,r.A)({},n);o&&this.encryptionEnabled&&(u=a.A.encryptHealthData(u),u._encrypted=!0),u._metadata={createdAt:(0,i.O5)(),updatedAt:(0,i.O5)(),version:1,encrypted:o&&this.encryptionEnabled};const h=(0,i.H9)(s.db,e,t);return await(0,i.BN)(h,u),d&&this.auditLoggingEnabled&&await this.logAuditEvent("CREATE",e,t,{encrypted:o&&this.encryptionEnabled,dataSize:JSON.stringify(n).length}),c.A.info("Secure data stored",{collection:e,docId:t,encrypted:o&&this.encryptionEnabled}),t}catch(d){throw c.A.error("Failed to store secure data",{collection:e,docId:t,error:d.message}),o.Ay.handleError(d,{context:"store_secure_data",collection:e,docId:t}),d}}async getSecureData(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{decrypt:r=!0,audit:o=!0}=n,l=(0,i.H9)(s.db,e,t),d=await(0,i.x7)(l);if(!d.exists())return null;let u=d.data();return r&&u._encrypted&&this.encryptionEnabled&&(u=a.A.decryptHealthData(u),delete u._encrypted),delete u._metadata,o&&this.auditLoggingEnabled&&await this.logAuditEvent("READ",e,t,{encrypted:u._encrypted||!1}),c.A.debug("Secure data retrieved",{collection:e,docId:t,decrypted:r&&u._encrypted}),u}catch(r){throw c.A.error("Failed to get secure data",{collection:e,docId:t,error:r.message}),o.Ay.handleError(r,{context:"get_secure_data",collection:e,docId:t}),r}}async updateSecureData(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const{encrypt:o=!0,audit:d=!0}=l;let u=(0,r.A)({},n);o&&this.encryptionEnabled&&(u=a.A.encryptHealthData(u),u._encrypted=!0),u._metadata={updatedAt:(0,i.O5)(),version:(0,i.O5)()};const h=(0,i.H9)(s.db,e,t);return await(0,i.mZ)(h,u),d&&this.auditLoggingEnabled&&await this.logAuditEvent("UPDATE",e,t,{encrypted:o&&this.encryptionEnabled,updateSize:JSON.stringify(n).length}),c.A.info("Secure data updated",{collection:e,docId:t,encrypted:o&&this.encryptionEnabled}),t}catch(d){throw c.A.error("Failed to update secure data",{collection:e,docId:t,error:d.message}),o.Ay.handleError(d,{context:"update_secure_data",collection:e,docId:t}),d}}async deleteSecureData(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{audit:r=!0}=n;r&&this.auditLoggingEnabled&&await this.logAuditEvent("DELETE",e,t,{reason:"User requested deletion"});const a=(0,i.H9)(s.db,e,t);return await(0,i.kd)(a),c.A.info("Secure data deleted",{collection:e,docId:t}),!0}catch(r){throw c.A.error("Failed to delete secure data",{collection:e,docId:t,error:r.message}),o.Ay.handleError(r,{context:"delete_secure_data",collection:e,docId:t}),r}}async querySecureData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{decrypt:o=!0,audit:l=!0}=n,d=(0,i.rJ)(s.db,e),u=(0,i.P)(d,...t),h=await(0,i.GG)(u),p=[];return h.forEach(e=>{let t=(0,r.A)({id:e.id},e.data());o&&t._encrypted&&this.encryptionEnabled&&(t=a.A.decryptHealthData(t),delete t._encrypted),delete t._metadata,p.push(t)}),l&&this.auditLoggingEnabled&&await this.logAuditEvent("QUERY",e,null,{resultCount:p.length,queryConstraints:t.length}),c.A.debug("Secure data queried",{collection:e,resultCount:p.length}),p}catch(l){throw c.A.error("Failed to query secure data",{collection:e,error:l.message}),o.Ay.handleError(l,{context:"query_secure_data",collection:e}),l}}async batchSecureOperations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{encrypt:n=!0,audit:r=!0}=t,i=[];for(const t of e){const{type:e,collection:r,docId:s,data:a}=t;switch(e){case"CREATE":const t=await this.storeSecureData(r,s,a,{encrypt:n,audit:!1});i.push({type:e,id:t,success:!0});break;case"UPDATE":await this.updateSecureData(r,s,a,{encrypt:n,audit:!1}),i.push({type:e,id:s,success:!0});break;case"DELETE":await this.deleteSecureData(r,s,{audit:!1}),i.push({type:e,id:s,success:!0});break;default:i.push({type:e,id:s,success:!1,error:"Unknown operation type"})}}return r&&this.auditLoggingEnabled&&await this.logAuditEvent("BATCH","multiple",null,{operationCount:e.length,successCount:i.filter(e=>e.success).length}),c.A.info("Batch secure operations completed",{operationCount:e.length,successCount:i.filter(e=>e.success).length}),i}catch(n){throw c.A.error("Batch secure operations failed",{error:n.message}),o.Ay.handleError(n,{context:"batch_secure_operations"}),n}}async anonymizeData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{const n=(0,r.A)({},e);return t.forEach(e=>{n[e]&&(n[e]=a.A.hash(n[e]))}),c.A.debug("Data anonymized",{fieldsAnonymized:t.length}),n}catch(n){throw c.A.error("Data anonymization failed",{error:n.message}),o.Ay.handleError(n,{context:"anonymize_data"}),n}}async logAuditEvent(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const o=(0,r.A)({action:e,collection:t,docId:n,userId:l.A.get("auth.currentUser?.uid"),timestamp:(0,i.O5)(),userAgent:navigator.userAgent,ipAddress:await this.getClientIP()},a),d=(0,i.H9)(t(s.db,"auditLogs"));await(0,i.BN)(d,o),c.A.debug("Audit event logged",{action:e,collection:t,docId:n})}catch(o){c.A.error("Failed to log audit event",{error:o.message})}}async getClientIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return"unknown"}}async cleanupExpiredData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:365;try{const n=new Date;n.setDate(n.getDate()-t);const r=(0,i.P)((0,i.rJ)(s.db,e),(0,i._M)("_metadata.createdAt","<",n)),a=await(0,i.GG)(r),o=[];return a.forEach(e=>{o.push((0,i.kd)(e.ref))}),await Promise.all(o),c.A.info("Expired data cleaned up",{collection:e,deletedCount:o.length}),o.length}catch(n){throw c.A.error("Data cleanup failed",{collection:e,error:n.message}),o.Ay.handleError(n,{context:"cleanup_expired_data"}),n}}},u="users",h=async()=>{try{const e=(0,i.rJ)(s.db,u),t=(0,i.P)(e,(0,i.My)("createdAt","desc")),n=await(0,i.GG)(t),a=[];return n.forEach(e=>{var t,n,i,s,o,c,l,d;const u=e.data();a.push((0,r.A)((0,r.A)({id:e.id},u),{},{joinDate:(null===(t=u.joinDate)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||u.joinDate,lastActive:(null===(i=u.lastActive)||void 0===i||null===(s=i.toDate)||void 0===s?void 0:s.call(i))||u.lastActive,createdAt:(null===(o=u.createdAt)||void 0===o||null===(c=o.toDate)||void 0===c?void 0:c.call(o))||u.createdAt,updatedAt:(null===(l=u.updatedAt)||void 0===l||null===(d=l.toDate)||void 0===d?void 0:d.call(l))||u.updatedAt}))}),a}catch(e){throw console.error("Error fetching users:",e),e}},p=async e=>{try{if(!e)throw new Error("User ID is required");c.A.debug("Fetching user by ID",{userId:e}),c.A.debug("Skipping Data Connect for user queries - schema mismatch with Firebase Auth UIDs");const o=(0,i.H9)(s.db,u,e),f=await(0,i.x7)(o);if(f.exists()){var t,n,a,l,d,h,p,m;const e=f.data();return(0,r.A)((0,r.A)({id:f.id},e),{},{joinDate:(null===(t=e.joinDate)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||e.joinDate,lastActive:(null===(a=e.lastActive)||void 0===a||null===(l=a.toDate)||void 0===l?void 0:l.call(a))||e.lastActive,createdAt:(null===(d=e.createdAt)||void 0===d||null===(h=d.toDate)||void 0===h?void 0:h.call(d))||e.createdAt,updatedAt:(null===(p=e.updatedAt)||void 0===p||null===(m=p.toDate)||void 0===m?void 0:m.call(p))||e.updatedAt})}return null}catch(f){throw o.Ay.handleError(f,{context:"get_user_by_id",userId:e}),f}},m=async e=>{try{c.A.info("Creating new user",{userType:e.userType,userId:e.id});const n=(0,r.A)((0,r.A)({},e),{},{status:"active",joinDate:new Date,lastActive:new Date,createdAt:new Date,updatedAt:new Date});try{const t=await d.storeSecureData(u,e.id||"auto",n,{encrypt:!0,audit:!0});return c.A.info("User created with secure storage",{userId:t}),t}catch(t){c.A.warn("Secure storage failed, using direct Firestore",{error:t});const r=(0,i.H9)(s.db,u,e.id);return await(0,i.BN)(r,n),c.A.info("User created with direct Firestore",{userId:e.id}),e.id}}catch(n){throw c.A.error("Failed to create user",{error:n,userData:e}),o.Ay.handleError(n,{context:"create_user",userData:e}),n}},f=async(e,t)=>{try{const n=(0,i.H9)(s.db,u,e),a=(0,r.A)((0,r.A)({},t),{},{updatedAt:(0,i.O5)()});return(await(0,i.x7)(n)).exists()?await(0,i.mZ)(n,a):await(0,i.BN)(n,(0,r.A)((0,r.A)({},a),{},{id:e,userType:"elderly",status:"active",joinDate:(0,i.O5)(),lastActive:(0,i.O5)(),createdAt:(0,i.O5)()})),!0}catch(n){throw console.error("Error updating user:",n),n}}},9475:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib,r=n.WordArray,i=n.BlockCipher,s=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=s.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var r=a[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}for(var i=this._subKeys=[],s=0;s<16;s++){var l=i[s]=[],d=c[s];for(n=0;n<24;n++)l[n/6|0]|=t[(o[n]-1+d)%28]<<31-n%6,l[4+(n/6|0)]|=t[28+(o[n+24]-1+d)%28]<<31-n%6;for(l[0]=l[0]<<1|l[0]>>>31,n=1;n<7;n++)l[n]=l[n]>>>4*(n-1)+3;l[7]=l[7]<<5|l[7]>>>27}var u=this._invSubKeys=[];for(n=0;n<16;n++)u[n]=i[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],h.call(this,4,252645135),h.call(this,16,65535),p.call(this,2,858993459),p.call(this,8,16711935),h.call(this,1,1431655765);for(var r=0;r<16;r++){for(var i=n[r],s=this._lBlock,a=this._rBlock,o=0,c=0;c<8;c++)o|=l[c][((a^i[c])&d[c])>>>0];this._lBlock=a,this._rBlock=s^o}var u=this._lBlock;this._lBlock=this._rBlock,this._rBlock=u,h.call(this,1,1431655765),p.call(this,8,16711935),p.call(this,2,858993459),h.call(this,16,65535),h.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function h(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function p(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=i._createHelper(u);var m=s.TripleDES=i.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),n=e.length<4?e.slice(0,2):e.slice(2,4),i=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=u.createEncryptor(r.create(t)),this._des2=u.createEncryptor(r.create(n)),this._des3=u.createEncryptor(r.create(i))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=i._createHelper(m)}(),t.TripleDES)}()},9606:(e,t,n)=>{"use strict";n.d(t,{h1:()=>o,uA:()=>i});var r=n(1776);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===s?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(a){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},9638:function(e,t,n){!function(){var t;e.exports=(t=n(4488),n(8523),n(4199),n(8211),n(2238),function(){var e=t,n=e.lib.StreamCipher,r=e.algo,i=r.RC4=n.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;i=0;for(var s=0;i<256;i++){var a=i%n,o=t[a>>>2]>>>24-a%4*8&255;s=(s+r[i]+o)%256;var c=r[i];r[i]=r[s],r[s]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var e=this._S,t=this._i,n=this._j,r=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var s=e[t];e[t]=e[n],e[n]=s,r|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,r}e.RC4=n._createHelper(i);var a=r.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)s.call(this)}});e.RC4Drop=n._createHelper(a)}(),t.RC4)}()},9749:function(e,t,n){!function(){var t;e.exports=(t=n(4488),function(e){var n=t,r=n.lib,i=r.Base,s=r.WordArray,a=n.x64={};a.Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=i.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:8*t.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push(i.high),n.push(i.low)}return s.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})}(),t)}()},9997:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(2555),i=n(6111),s=n.n(i),a=n(7210),o=n(5452);const c=new class{constructor(){this.encryptionKey="ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",this.algorithm="AES-256-CBC"}generateKey(){const e=s().lib.WordArray.random(32).toString();return o.A.warn("Using generated encryption key - set REACT_APP_ENCRYPTION_KEY in production"),e}encrypt(e){try{if(!e)return e;const t="string"===typeof e?e:JSON.stringify(e),n=s().AES.encrypt(t,this.encryptionKey).toString();return o.A.debug("Data encrypted successfully",{dataType:typeof e,encryptedLength:n.length}),n}catch(t){throw o.A.error("Encryption failed",{error:t,dataType:typeof e}),a.Ay.handleError(t,{context:"data_encryption"}),new Error("Failed to encrypt data")}}decrypt(e){try{if(!e)return e;const n=s().AES.decrypt(e,this.encryptionKey).toString(s().enc.Utf8);try{return JSON.parse(n)}catch(t){return n}}catch(n){throw o.A.error("Decryption failed",{error:n}),a.Ay.handleError(n,{context:"data_decryption"}),new Error("Failed to decrypt data")}}encryptHealthData(e){const t=(0,r.A)({},e);return["allergies","medicalConditions","medicationNotes","vitalSignsNotes","appointmentNotes","emergencyContactPhone","primaryCareDoctor"].forEach(e=>{t[e]&&(t[e]=this.encrypt(t[e]))}),t}decryptHealthData(e){const t=(0,r.A)({},e);return["allergies","medicalConditions","medicationNotes","vitalSignsNotes","appointmentNotes","emergencyContactPhone","primaryCareDoctor"].forEach(e=>{if(t[e])try{t[e]=this.decrypt(t[e])}catch(n){o.A.warn("Failed to decrypt field: ".concat(e),{error:n})}}),t}hash(e){try{return s().SHA256(e).toString()}catch(t){throw o.A.error("Hashing failed",{error:t}),a.Ay.handleError(t,{context:"data_hashing"}),new Error("Failed to hash data")}}generateSecureToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;return s().lib.WordArray.random(e).toString()}encryptFile(e){try{return s().AES.encrypt(e,this.encryptionKey).toString()}catch(t){throw o.A.error("File encryption failed",{error:t}),a.Ay.handleError(t,{context:"file_encryption"}),new Error("Failed to encrypt file")}}decryptFile(e){try{return s().AES.decrypt(e,this.encryptionKey).toString(s().enc.Utf8)}catch(t){throw o.A.error("File decryption failed",{error:t}),a.Ay.handleError(t,{context:"file_decryption"}),new Error("Failed to decrypt file")}}validateKeyStrength(e){if(!e||e.length<32)return!1;const t=/[A-Z]/.test(e),n=/[a-z]/.test(e),r=/\d/.test(e),i=/[!@#$%^&*(),.?":{}|<>]/.test(e);return t&&n&&r&&i}rotateKey(e){if(!this.validateKeyStrength(e))throw new Error("New encryption key does not meet security requirements");this.encryptionKey=e,o.A.info("Encryption key rotated successfully")}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var s=Object.create(null);n.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>r[e]);return a.default=()=>r,n.d(s,a),s}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t=n(5043),r=n.t(t,2),i=n(4391),s=n(7950),a=n.t(s,2);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const c="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function d(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function u(e,t){return{usr:e.state,key:e.key,idx:t}}function h(e,t,n,r){return void 0===n&&(n=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?m(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function m(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function f(t,n,r,i){void 0===i&&(i={});let{window:s=document.defaultView,v5Compat:a=!1}=i,d=s.history,m=e.Pop,f=null,g=v();function v(){return(d.state||{idx:null}).idx}function y(){m=e.Pop;let t=v(),n=null==t?null:t-g;g=t,f&&f({action:m,location:E.location,delta:n})}function _(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,n="string"===typeof e?e:p(e);return n=n.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,d.replaceState(o({},d.state,{idx:g}),""));let E={get action(){return m},get location(){return t(s,d)},listen(e){if(f)throw new Error("A history only accepts one active listener");return s.addEventListener(c,y),f=e,()=>{s.removeEventListener(c,y),f=null}},createHref:e=>n(s,e),createURL:_,encodeLocation(e){let t=_(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){m=e.Push;let i=h(E.location,t,n);r&&r(i,t),g=v()+1;let o=u(i,g),c=E.createHref(i);try{d.pushState(o,"",c)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;s.location.assign(c)}a&&f&&f({action:m,location:E.location,delta:1})},replace:function(t,n){m=e.Replace;let i=h(E.location,t,n);r&&r(i,t),g=v();let s=u(i,g),o=E.createHref(i);d.replaceState(s,"",o),a&&f&&f({action:m,location:E.location,delta:0})},go:e=>d.go(e)};return E}var g;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function v(e,t,n){return void 0===n&&(n="/"),y(e,t,n,!1)}function y(e,t,n,r){let i=P(("string"===typeof t?m(t):t).pathname||"/",n);if(null==i)return null;let s=_(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(s);let a=null;for(let o=0;null==a&&o<s.length;++o){let e=O(i);a=R(s[o],e,r)}return a}function _(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,s)=>{let a={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(l(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let o=M([r,a.relativePath]),c=n.concat(a);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),_(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:A(o,e.index),routesMeta:c})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of E(e.path))i(e,t,r);else i(e,t)}),t}function E(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===r.length)return i?[s,""]:[s];let a=E(r.join("/")),o=[];return o.push(...a.map(e=>""===e?s:[s,e].join("/"))),i&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const b=/^:[\w-]+$/,x=3,w=2,S=1,T=10,N=-2,C=e=>"*"===e;function A(e,t){let n=e.split("/"),r=n.length;return n.some(C)&&(r+=N),t&&(r+=w),n.filter(e=>!C(e)).reduce((e,t)=>e+(b.test(t)?x:""===t?S:T),r)}function R(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},s="/",a=[];for(let o=0;o<r.length;++o){let e=r[o],c=o===r.length-1,l="/"===s?t:t.slice(s.length)||"/",d=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),u=e.route;if(!d&&c&&n&&!r[r.length-1].route.index&&(d=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:M([s,d.pathname]),pathnameBase:U(M([s,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(s=M([s,d.pathnameBase]))}return a}function I(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);d("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let s=new RegExp(i,t?void 0:"i");return[s,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=o[n]||"";a=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const c=o[n];return e[r]=i&&!c?void 0:(c||"").replace(/%2F/g,"/"),e},{}),pathname:s,pathnameBase:a,pattern:e}}function O(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return d(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function P(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function k(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function D(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function L(e,t){let n=D(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function j(e,t,n,r){let i;void 0===r&&(r=!1),"string"===typeof e?i=m(e):(i=o({},e),l(!i.pathname||!i.pathname.includes("?"),k("?","pathname","search",i)),l(!i.pathname||!i.pathname.includes("#"),k("#","pathname","hash",i)),l(!i.search||!i.search.includes("#"),k("#","search","hash",i)));let s,a=""===e||""===i.pathname,c=a?"/":i.pathname;if(null==c)s=n;else{let e=t.length-1;if(!r&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}s=e>=0?t[e]:"/"}let d=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof e?m(e):e,s=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:s,search:V(r),hash:F(i)}}(i,s),u=c&&"/"!==c&&c.endsWith("/"),h=(a||"."===c)&&n.endsWith("/");return d.pathname.endsWith("/")||!u&&!h||(d.pathname+="/"),d}const M=e=>e.join("/").replace(/\/\/+/g,"/"),U=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function B(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const G=["post","put","patch","delete"],H=(new Set(G),["get",...G]);new Set(H),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W.apply(this,arguments)}const z=t.createContext(null);const K=t.createContext(null);const q=t.createContext(null);const Y=t.createContext(null);const X=t.createContext({outlet:null,matches:[],isDataRoute:!1});const J=t.createContext(null);function Q(){return null!=t.useContext(Y)}function Z(){return Q()||l(!1),t.useContext(Y).location}function $(e){t.useContext(q).static||t.useLayoutEffect(e)}function ee(){let{isDataRoute:e}=t.useContext(X);return e?function(){let{router:e}=ue(le.UseNavigateStable),n=pe(de.UseNavigateStable),r=t.useRef(!1);return $(()=>{r.current=!0}),t.useCallback(function(t,i){void 0===i&&(i={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,W({fromRouteId:n},i)))},[e,n])}():function(){Q()||l(!1);let e=t.useContext(z),{basename:n,future:r,navigator:i}=t.useContext(q),{matches:s}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(L(s,r.v7_relativeSplatPath)),c=t.useRef(!1);return $(()=>{c.current=!0}),t.useCallback(function(t,r){if(void 0===r&&(r={}),!c.current)return;if("number"===typeof t)return void i.go(t);let s=j(t,JSON.parse(o),a,"path"===r.relative);null==e&&"/"!==n&&(s.pathname="/"===s.pathname?n:M([n,s.pathname])),(r.replace?i.replace:i.push)(s,r.state,r)},[n,i,o,a,e])}()}const te=t.createContext(null);function ne(e,n){let{relative:r}=void 0===n?{}:n,{future:i}=t.useContext(q),{matches:s}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(L(s,i.v7_relativeSplatPath));return t.useMemo(()=>j(e,JSON.parse(o),a,"path"===r),[e,o,a,r])}function re(n,r,i,s){Q()||l(!1);let{navigator:a}=t.useContext(q),{matches:o}=t.useContext(X),c=o[o.length-1],d=c?c.params:{},u=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let h,p=Z();if(r){var f;let e="string"===typeof r?m(r):r;"/"===u||(null==(f=e.pathname)?void 0:f.startsWith(u))||l(!1),h=e}else h=p;let g=h.pathname||"/",y=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let _=v(n,{pathname:y});let E=ce(_&&_.map(e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:M([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:M([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,i,s);return r&&E?t.createElement(Y.Provider,{value:{location:W({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:e.Pop}},E):E}function ie(){let e=function(){var e;let n=t.useContext(J),r=he(de.UseRouteError),i=pe(de.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[i]}(),n=B(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:s},r):null,null)}const se=t.createElement(ie,null);class ae extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(X.Provider,{value:this.props.routeContext},t.createElement(J.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oe(e){let{routeContext:n,match:r,children:i}=e,s=t.useContext(z);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(X.Provider,{value:n},i)}function ce(e,n,r,i){var s;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var a;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(a=i)&&a.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let o=e,c=null==(s=r)?void 0:s.errors;if(null!=c){let e=o.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||l(!1),o=o.slice(0,Math.min(o.length,e+1))}let d=!1,u=-1;if(r&&i&&i.v7_partialHydration)for(let t=0;t<o.length;t++){let e=o[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:n}=r,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){d=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,i,s)=>{let a,l=!1,h=null,p=null;var m;r&&(a=c&&i.route.id?c[i.route.id]:void 0,h=i.route.errorElement||se,d&&(u<0&&0===s?(m="route-fallback",!1||me[m]||(me[m]=!0),l=!0,p=null):u===s&&(l=!0,p=i.route.hydrateFallbackElement||null)));let f=n.concat(o.slice(0,s+1)),g=()=>{let n;return n=a?h:l?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(oe,{match:i,routeContext:{outlet:e,matches:f,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===s)?t.createElement(ae,{location:r.location,revalidation:r.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):g()},null)}var le=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(le||{}),de=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(de||{});function ue(e){let n=t.useContext(z);return n||l(!1),n}function he(e){let n=t.useContext(K);return n||l(!1),n}function pe(e){let n=function(){let e=t.useContext(X);return e||l(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||l(!1),r.route.id}const me={};r.startTransition;function fe(e){let{to:n,replace:r,state:i,relative:s}=e;Q()||l(!1);let{future:a,static:o}=t.useContext(q),{matches:c}=t.useContext(X),{pathname:d}=Z(),u=ee(),h=j(n,L(c,a.v7_relativeSplatPath),d,"path"===s),p=JSON.stringify(h);return t.useEffect(()=>u(JSON.parse(p),{replace:r,state:i,relative:s}),[u,p,s,r,i]),null}function ge(e){return function(e){let n=t.useContext(X).outlet;return n?t.createElement(te.Provider,{value:e},n):n}(e.context)}function ve(e){l(!1)}function ye(n){let{basename:r="/",children:i=null,location:s,navigationType:a=e.Pop,navigator:o,static:c=!1,future:d}=n;Q()&&l(!1);let u=r.replace(/^\/*/,"/"),h=t.useMemo(()=>({basename:u,navigator:o,static:c,future:W({v7_relativeSplatPath:!1},d)}),[u,d,o,c]);"string"===typeof s&&(s=m(s));let{pathname:p="/",search:f="",hash:g="",state:v=null,key:y="default"}=s,_=t.useMemo(()=>{let e=P(p,u);return null==e?null:{location:{pathname:e,search:f,hash:g,state:v,key:y},navigationType:a}},[u,p,f,g,v,y,a]);return null==_?null:t.createElement(q.Provider,{value:h},t.createElement(Y.Provider,{children:i,value:_}))}function _e(e){let{children:t,location:n}=e;return re(Ee(t),n)}new Promise(()=>{});t.Component;function Ee(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,(e,i)=>{if(!t.isValidElement(e))return;let s=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,Ee(e.props.children,s));e.type!==ve&&l(!1),e.props.index&&e.props.children&&l(!1);let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Ee(e.props.children,s)),r.push(a)}),r}function be(){return be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},be.apply(this,arguments)}function xe(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const we=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(ts){}new Map;const Se=r.startTransition;a.flushSync,r.useId;function Te(e){let{basename:n,children:r,future:i,window:s}=e,a=t.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:s,v5Compat:!0})&&(o={}),f(function(e,t){let{pathname:n,search:r,hash:i}=e.location;return h("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:p(t)},null,o)));let c=a.current,[l,d]=t.useState({action:c.action,location:c.location}),{v7_startTransition:u}=i||{},m=t.useCallback(e=>{u&&Se?Se(()=>d(e)):d(e)},[d,u]);return t.useLayoutEffect(()=>c.listen(m),[c,m]),t.createElement(ye,{basename:n,children:r,location:l.location,navigationType:l.action,navigator:c,future:i})}const Ne="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ae=t.forwardRef(function(e,n){let r,{onClick:i,relative:s,reloadDocument:a,replace:o,state:c,target:d,to:u,preventScrollReset:h,unstable_viewTransition:m}=e,f=xe(e,we),{basename:g}=t.useContext(q),v=!1;if("string"===typeof u&&Ce.test(u)&&(r=u,Ne))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=P(t.pathname,g);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:v=!0}catch(ts){}let y=function(e,n){let{relative:r}=void 0===n?{}:n;Q()||l(!1);let{basename:i,navigator:s}=t.useContext(q),{hash:a,pathname:o,search:c}=ne(e,{relative:r}),d=o;return"/"!==i&&(d="/"===o?i:M([i,o])),s.createHref({pathname:d,search:c,hash:a})}(u,{relative:s}),_=function(e,n){let{target:r,replace:i,state:s,preventScrollReset:a,relative:o,unstable_viewTransition:c}=void 0===n?{}:n,l=ee(),d=Z(),u=ne(e,{relative:o});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,r)){t.preventDefault();let n=void 0!==i?i:p(d)===p(u);l(e,{replace:n,state:s,preventScrollReset:a,relative:o,unstable_viewTransition:c})}},[d,l,u,i,s,r,e,a,o,c])}(u,{replace:o,state:c,target:d,preventScrollReset:h,relative:s,unstable_viewTransition:m});return t.createElement("a",be({},f,{href:r||y,onClick:v||a?i:function(e){i&&i(e),e.defaultPrevented||_(e)},ref:n,target:d}))});var Re,Ie;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Re||(Re={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ie||(Ie={}));var Oe=n(2907),Pe=n(2145),ke=n(823);function De(e,t,n,r){return new(n||(n=Promise))(function(i,s){function a(e){try{c(r.next(e))}catch(ts){s(ts)}}function o(e){try{c(r.throw(e))}catch(ts){s(ts)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})}function Le(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(ts){s=[6,ts],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}var je=function(){return je=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},je.apply(this,arguments)},Me=function(e){return{loading:void 0===e||null===e,value:e}},Ue=function(e){var n=e?e():void 0,r=(0,t.useReducer)(function(e,t){switch(t.type){case"error":return je(je({},e),{error:t.error,loading:!1,value:void 0});case"reset":return Me(t.defaultValue);case"value":return je(je({},e),{error:void 0,loading:!1,value:t.value});default:return e}},Me(n)),i=r[0],s=r[1],a=(0,t.useCallback)(function(){var t=e?e():void 0;s({type:"reset",defaultValue:t})},[e]),o=(0,t.useCallback)(function(e){s({type:"error",error:e})},[]),c=(0,t.useCallback)(function(e){s({type:"value",value:e})},[]);return(0,t.useMemo)(function(){return{error:i.error,loading:i.loading,reset:a,setError:o,setValue:c,value:i.value}},[i.error,i.loading,a,o,c,i.value])},Ve=function(e,n){var r=Ue(function(){return e.currentUser}),i=r.error,s=r.loading,a=r.setError,o=r.setValue,c=r.value;return(0,t.useEffect)(function(){var t=(0,ke.hg)(e,function(e){return De(void 0,void 0,void 0,function(){var t;return Le(this,function(r){switch(r.label){case 0:if(!(null===n||void 0===n?void 0:n.onUserChanged))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.onUserChanged(e)];case 2:return r.sent(),[3,4];case 3:return t=r.sent(),a(t),[3,4];case 4:return o(e),[2]}})})},a);return function(){t()}},[e]),[c,s,i]},Fe=n(7227),Be=n(4107),Ge=n(2555),He=n(3986),We={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const ze=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],Ke=(e,n)=>{const r=(0,t.forwardRef)((r,i)=>{let{color:s="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:l="",children:d}=r,u=(0,He.A)(r,ze);return(0,t.createElement)("svg",(0,Ge.A)((0,Ge.A)({ref:i},We),{},{width:a,height:a,stroke:s,strokeWidth:c?24*Number(o)/Number(a):o,className:["lucide","lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),l].join(" ")},u),[...n.map(e=>{let[n,r]=e;return(0,t.createElement)(n,r)}),...Array.isArray(d)?d:[d]]);var h});return r.displayName="".concat(e),r},qe=Ke("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ye=Ke("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Xe=Ke("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);var Je=n(7210),Qe=n(579);class Ze extends t.Component{constructor(e){super(e),this.reportError=async(e,t)=>{try{console.error("Error Boundary caught an error:",e,t)}catch(n){console.error("Failed to report error:",n)}},this.handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null})},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1,error:null,errorInfo:null,errorId:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){const n={message:e.message,stack:e.stack,componentStack:t.componentStack,errorBoundary:this.props.name||"Unknown"},r=Je.Ay.handleError(e,(0,Ge.A)((0,Ge.A)({},n),{},{critical:!0,context:"error_boundary"}));this.setState({error:e,errorInfo:t,errorId:r.id}),this.reportError(e,t)}render(){return this.state.hasError?(0,Qe.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:(0,Qe.jsx)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:(0,Qe.jsxs)("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[(0,Qe.jsx)("div",{className:"flex justify-center",children:(0,Qe.jsx)("div",{className:"flex items-center justify-center w-16 h-16 bg-red-100 rounded-full",children:(0,Qe.jsx)(qe,{className:"w-8 h-8 text-red-600"})})}),(0,Qe.jsxs)("div",{className:"mt-6 text-center",children:[(0,Qe.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Oops! Something went wrong"}),(0,Qe.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"We're sorry, but something unexpected happened. Our team has been notified."}),this.state.errorId&&(0,Qe.jsxs)("p",{className:"mt-2 text-xs text-gray-500",children:["Error ID: ",this.state.errorId]})]}),(0,Qe.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,Qe.jsxs)("button",{onClick:this.handleRetry,className:"w-full flex justify-center items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,Qe.jsx)(Ye,{className:"w-4 h-4 mr-2"}),"Try Again"]}),(0,Qe.jsxs)("button",{onClick:this.handleGoHome,className:"w-full flex justify-center items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,Qe.jsx)(Xe,{className:"w-4 h-4 mr-2"}),"Go to Home"]})]}),!1,(0,Qe.jsx)("div",{className:"mt-6 text-center",children:(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:"If this problem persists, please contact support with the Error ID above."})})]})})}):this.props.children}}const $e=Ze;var et=n(5452),tt=n(7371);const nt=new class{constructor(){this.alerts=[],this.threats=[],this.monitoringEnabled=!0,this.alertThresholds={failedLogins:5,suspiciousActivity:3,dataAccess:100,apiCalls:1e3},this.alertCallbacks=[]}initialize(){try{this.setupEventListeners(),this.startPeriodicChecks(),et.A.info("Security monitoring service initialized")}catch(e){et.A.error("Security monitoring initialization failed",{error:e.message}),Je.Ay.handleError(e,{context:"security_monitoring_init"})}}setupEventListeners(){window.addEventListener("beforeunload",()=>{this.logSecurityEvent("SESSION_END",{timestamp:(new Date).toISOString(),userAgent:navigator.userAgent})}),document.addEventListener("visibilitychange",()=>{document.hidden?this.logSecurityEvent("SESSION_PAUSE",{timestamp:(new Date).toISOString()}):this.logSecurityEvent("SESSION_RESUME",{timestamp:(new Date).toISOString()})}),window.addEventListener("error",e=>{this.logSecurityEvent("CLIENT_ERROR",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,timestamp:(new Date).toISOString()})}),window.addEventListener("unhandledrejection",e=>{var t;this.logSecurityEvent("UNHANDLED_REJECTION",{reason:null===(t=e.reason)||void 0===t?void 0:t.toString(),timestamp:(new Date).toISOString()})})}startPeriodicChecks(){setInterval(()=>{this.performSecurityChecks()},3e5),setInterval(()=>{this.cleanupOldAlerts()},36e5)}logSecurityEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=(0,Ge.A)({id:this.generateEventId(),type:e,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,userId:this.getCurrentUserId(),sessionId:this.getSessionId()},t);this.storeEvent(n),this.analyzeEvent(n),this.monitoringEnabled&&this.sendToMonitoringService(n),et.A.debug("Security event logged",{eventType:e,eventId:n.id})}catch(n){et.A.error("Failed to log security event",{error:n.message})}}analyzeEvent(e){try{const t=[];if("LOGIN_FAILED"===e.type){const e=this.getRecentEvents("LOGIN_FAILED",9e5);e.length>=this.alertThresholds.failedLogins&&t.push({type:"BRUTE_FORCE_ATTEMPT",severity:"HIGH",description:"Multiple failed login attempts detected (".concat(e.length,")"),events:e})}if("DATA_ACCESS"===e.type){const e=this.getRecentEvents("DATA_ACCESS",36e5);e.length>=this.alertThresholds.dataAccess&&t.push({type:"EXCESSIVE_DATA_ACCESS",severity:"MEDIUM",description:"Excessive data access detected (".concat(e.length," accesses)"),events:e})}if("API_CALL"===e.type){const e=this.getRecentEvents("API_CALL",36e5);e.length>=this.alertThresholds.apiCalls&&t.push({type:"API_ABUSE",severity:"MEDIUM",description:"Excessive API calls detected (".concat(e.length," calls)"),events:e})}if("LOCATION_ACCESS"===e.type&&e.location){const e=this.getRecentEvents("LOCATION_ACCESS",864e5),n=new Set(e.map(e=>e.location)).size;n>5&&t.push({type:"UNUSUAL_LOCATION_PATTERN",severity:"LOW",description:"Unusual location access pattern detected (".concat(n," locations)"),events:e})}t.forEach(e=>{this.handleThreat(e)})}catch(t){et.A.error("Event analysis failed",{error:t.message})}}handleThreat(e){try{this.threats.push((0,Ge.A)((0,Ge.A)({},e),{},{id:this.generateEventId(),detectedAt:(new Date).toISOString(),status:"ACTIVE"}));const t={id:this.generateEventId(),threatId:e.id,type:e.type,severity:e.severity,message:e.description,timestamp:(new Date).toISOString(),status:"ACTIVE",actions:this.getRecommendedActions(e)};this.alerts.push(t),this.alertCallbacks.forEach(e=>{try{e(t)}catch(n){et.A.error("Alert callback failed",{error:n.message})}}),et.A.warn("Security threat detected",{threatType:e.type,severity:e.severity,threatId:e.id}),"HIGH"===e.severity&&this.handleHighSeverityThreat(e)}catch(t){et.A.error("Threat handling failed",{error:t.message})}}handleHighSeverityThreat(e){try{switch(e.type){case"BRUTE_FORCE_ATTEMPT":this.lockAccount(e.events[0].userId);break;case"UNAUTHORIZED_ACCESS":this.forceLogout();break;case"DATA_BREACH_ATTEMPT":this.alertAdministrators(e);break;default:et.A.warn("Unknown high severity threat type",{type:e.type})}}catch(t){et.A.error("High severity threat handling failed",{error:t.message})}}getRecommendedActions(e){const t=[];switch(e.type){case"BRUTE_FORCE_ATTEMPT":t.push("LOCK_ACCOUNT","NOTIFY_USER","ALERT_ADMIN");break;case"EXCESSIVE_DATA_ACCESS":t.push("REVIEW_ACCESS","NOTIFY_USER");break;case"API_ABUSE":t.push("RATE_LIMIT","REVIEW_USAGE");break;case"UNUSUAL_LOCATION_PATTERN":t.push("VERIFY_IDENTITY","NOTIFY_USER");break;default:t.push("INVESTIGATE","MONITOR")}return t}storeEvent(e){try{const t=this.getStoredEvents();t.push(e),t.length>1e3&&t.splice(0,t.length-1e3),localStorage.setItem("elderx_security_events",JSON.stringify(t))}catch(t){et.A.error("Failed to store security event",{error:t.message})}}getStoredEvents(){try{const e=localStorage.getItem("elderx_security_events");return e?JSON.parse(e):[]}catch(e){return et.A.error("Failed to get stored events",{error:e.message}),[]}}getRecentEvents(e,t){const n=this.getStoredEvents(),r=Date.now()-t;return n.filter(t=>t.type===e&&new Date(t.timestamp).getTime()>r)}async sendToMonitoringService(e){try{et.A.info("Security event sent to monitoring service",{eventType:e.type,eventId:e.id})}catch(t){et.A.error("Failed to send event to monitoring service",{error:t.message})}}performSecurityChecks(){try{this.checkInactiveSessions(),this.checkSuspiciousPatterns(),this.checkSystemIntegrity()}catch(e){et.A.error("Security checks failed",{error:e.message})}}checkInactiveSessions(){const e=this.getLastActivityTime(),t=Date.now()-e,n=18e5;t>n&&this.logSecurityEvent("SESSION_TIMEOUT",{inactiveTime:t,maxInactiveTime:n})}checkSuspiciousPatterns(){const e=this.getStoredEvents().filter(e=>Date.now()-new Date(e.timestamp).getTime()<36e5),t=this.detectRapidFireEvents(e);t.length>0&&this.logSecurityEvent("RAPID_FIRE_DETECTED",{eventCount:t.length,timeWindow:"1 hour"})}checkSystemIntegrity(){["auth","database","encryption"].forEach(e=>{this.isServiceRunning(e)||this.logSecurityEvent("SERVICE_DOWN",{service:e,timestamp:(new Date).toISOString()})})}detectRapidFireEvents(e){const t=[];for(let n=0;n<e.length;n++){const r=new Date(e[n].timestamp).getTime(),i=r-6e4,s=r+6e4,a=e.filter(e=>{const t=new Date(e.timestamp).getTime();return t>=i&&t<=s});a.length>=10&&t.push(...a)}return t}generateEventId(){return"evt_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getCurrentUserId(){return"current_user_id"}getSessionId(){return sessionStorage.getItem("elderx_session_id")||"unknown"}getLastActivityTime(){return parseInt(localStorage.getItem("elderx_last_activity")||Date.now())}isServiceRunning(e){return!0}addAlertCallback(e){this.alertCallbacks.push(e)}removeAlertCallback(e){const t=this.alertCallbacks.indexOf(e);t>-1&&this.alertCallbacks.splice(t,1)}getActiveAlerts(){return this.alerts.filter(e=>"ACTIVE"===e.status)}getActiveThreats(){return this.threats.filter(e=>"ACTIVE"===e.status)}dismissAlert(e){const t=this.alerts.find(t=>t.id===e);t&&(t.status="DISMISSED",t.dismissedAt=(new Date).toISOString())}resolveThreat(e){const t=this.threats.find(t=>t.id===e);t&&(t.status="RESOLVED",t.resolvedAt=(new Date).toISOString())}cleanupOldAlerts(){const e=Date.now()-6048e5;this.alerts=this.alerts.filter(t=>new Date(t.timestamp).getTime()>e),this.threats=this.threats.filter(t=>new Date(t.detectedAt).getTime()>e)}lockAccount(e){et.A.warn("Account locked due to security threat",{userId:e})}forceLogout(){et.A.warn("Forcing logout due to security threat")}alertAdministrators(e){et.A.error("ALERT: Security threat requiring admin attention",{threat:e})}};nt.initialize();const rt=nt;const it=new class{constructor(){this.isSupported=this.checkBiometricSupport(),this.isEnabled=!1,this.credentialId=null}checkBiometricSupport(){try{return!!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&window.PublicKeyCredential&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable)}catch(e){return et.A.warn("Biometric support check failed",{error:e.message}),!1}}async isPlatformAuthenticatorAvailable(){try{if(!this.isSupported)return!1;const e=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();return et.A.debug("Platform authenticator availability check",{available:e}),e}catch(e){return et.A.error("Platform authenticator check failed",{error:e.message}),!1}}async registerBiometric(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!this.isSupported)throw new Error("Biometric authentication not supported on this device");if(!await this.isPlatformAuthenticatorAvailable())throw new Error("No biometric authenticator available on this device");et.A.info("Starting biometric registration",{userId:e.id});const t=new Uint8Array(32);crypto.getRandomValues(t);const n=await navigator.credentials.create({publicKey:{challenge:t,rp:{name:"ElderX",id:window.location.hostname},user:{id:(new TextEncoder).encode(e.id||"user"),name:e.email||"user@elderx.com",displayName:e.displayName||"ElderX User"},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:6e4,attestation:"direct"}});if(n)return this.credentialId=n.id,this.isEnabled=!0,await this.storeCredentialInfo(n),et.A.info("Biometric registration successful",{credentialId:n.id}),{success:!0,credentialId:n.id,message:"Biometric authentication registered successfully"};throw new Error("Failed to create biometric credential")}catch(t){throw et.A.error("Biometric registration failed",{error:t.message}),Je.Ay.handleError(t,{context:"biometric_registration"}),t}}async authenticateBiometric(){try{if(!this.isSupported||!this.isEnabled)throw new Error("Biometric authentication not available");et.A.info("Starting biometric authentication");const e=new Uint8Array(32);crypto.getRandomValues(e);const t=await this.getStoredCredentialInfo();if(!t)throw new Error("No biometric credential found. Please register first.");const n=await navigator.credentials.get({publicKey:{challenge:e,allowCredentials:[{id:t.credentialId,type:"public-key",transports:["internal"]}],userVerification:"required",timeout:6e4}});if(n){if(await this.verifyAssertion(n,e))return et.A.info("Biometric authentication successful"),{success:!0,message:"Biometric authentication successful"};throw new Error("Biometric authentication verification failed")}throw new Error("Biometric authentication failed")}catch(e){throw et.A.error("Biometric authentication failed",{error:e.message}),Je.Ay.handleError(e,{context:"biometric_authentication"}),e}}async storeCredentialInfo(e){try{const t={credentialId:e.id,type:e.type,registeredAt:(new Date).toISOString()},n=JSON.stringify(t);localStorage.setItem("elderx_biometric_credential",n),et.A.debug("Biometric credential info stored")}catch(t){throw et.A.error("Failed to store credential info",{error:t.message}),t}}async getStoredCredentialInfo(){try{const e=localStorage.getItem("elderx_biometric_credential");if(!e)return null;const t=JSON.parse(e);return this.credentialId=t.credentialId,this.isEnabled=!0,t}catch(e){return et.A.error("Failed to get stored credential info",{error:e.message}),null}}async verifyAssertion(e,t){try{return e&&e.response&&e.response.signature}catch(n){return et.A.error("Assertion verification failed",{error:n.message}),!1}}async removeBiometric(){try{return localStorage.removeItem("elderx_biometric_credential"),this.credentialId=null,this.isEnabled=!1,et.A.info("Biometric authentication removed"),{success:!0,message:"Biometric authentication removed successfully"}}catch(e){throw et.A.error("Failed to remove biometric authentication",{error:e.message}),Je.Ay.handleError(e,{context:"remove_biometric"}),e}}async isBiometricEnabled(){try{return!!await this.getStoredCredentialInfo()}catch(e){return et.A.error("Failed to check biometric status",{error:e.message}),!1}}getStatus(){return{isSupported:this.isSupported,isEnabled:this.isEnabled,credentialId:this.credentialId}}async initialize(){try{this.isSupported?(await this.getStoredCredentialInfo(),et.A.info("Biometric authentication service initialized",this.getStatus())):et.A.info("Biometric authentication not supported on this device")}catch(e){et.A.error("Biometric service initialization failed",{error:e.message})}}handleBiometricError(e){let t="Biometric authentication failed";switch(e.name){case"NotAllowedError":t="Biometric authentication was cancelled or not allowed";break;case"NotSupportedError":t="Biometric authentication is not supported on this device";break;case"SecurityError":t="Security error occurred during biometric authentication";break;case"UnknownError":t="An unknown error occurred during biometric authentication";break;default:t=e.message||t}return et.A.error("Biometric error handled",{errorName:e.name,errorMessage:e.message,userMessage:t}),t}};it.initialize();const st=it,at=Ke("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),ot=Ke("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),ct=Ke("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),lt=Ke("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),dt=Ke("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),ut=Ke("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ht=Ke("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),pt=Ke("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),mt=Ke("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),ft=Ke("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),gt=()=>{const[e,n]=(0,t.useState)(!1),r=ee(),i=Z(),s=async()=>{try{await(0,ke.CI)(Fe.j2),Pe.oR.success("Signed out successfully"),r("/login")}catch(e){Pe.oR.error("Error signing out"),console.error("Sign out error:",e)}},a=[{name:"My Dashboard",href:"/dashboard",icon:Xe},{name:"Care Appointments",href:"/appointments",icon:at},{name:"Health Monitoring",href:"/vital-signs",icon:ot},{name:"Video Consultations",href:"/telemedicine",icon:ct},{name:"Medical Documents",href:"/medical-documents",icon:FileText},{name:"Messages",href:"/messages",icon:lt},{name:"Care Plan",href:"/subscription",icon:dt}],o=e=>i.pathname===e;return(0,Qe.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Qe.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>n(!1)}),(0,Qe.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white shadow-xl",children:[(0,Qe.jsxs)("div",{className:"flex h-16 items-center justify-between px-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Qe.jsx)(ot,{className:"h-5 w-5 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]}),(0,Qe.jsx)("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(ut,{className:"h-6 w-6"})})]}),(0,Qe.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Qe.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),r(e.href),n(!1)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Qe.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Qe.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Qe.jsxs)("button",{onClick:s,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Qe.jsx)(ht,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})]}),(0,Qe.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,Qe.jsxs)("div",{className:"flex flex-col flex-grow bg-white border-r border-gray-200 shadow-sm",children:[(0,Qe.jsx)("div",{className:"flex h-16 items-center px-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Qe.jsx)(ot,{className:"h-5 w-5 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]})}),(0,Qe.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Qe.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),r(e.href)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Qe.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Qe.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Qe.jsxs)("button",{onClick:s,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Qe.jsx)(ht,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})}),(0,Qe.jsxs)("div",{className:"lg:pl-64",children:[(0,Qe.jsxs)("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[(0,Qe.jsx)("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>n(!0),children:(0,Qe.jsx)(pt,{className:"h-6 w-6"})}),(0,Qe.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[(0,Qe.jsx)("div",{className:"flex flex-1"}),(0,Qe.jsxs)("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:[(0,Qe.jsxs)("button",{className:"p-2 text-gray-400 hover:text-gray-500",children:[(0,Qe.jsx)(mt,{className:"h-5 w-5"}),(0,Qe.jsx)("span",{className:"sr-only",children:"Notifications"})]}),(0,Qe.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,Qe.jsx)(ft,{className:"h-5 w-5 text-gray-400"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"Mrs. Adunni Okafor"})]})]})]})]}),(0,Qe.jsx)("main",{className:"py-6",children:(0,Qe.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,Qe.jsx)(ge,{})})})]})]})},vt=Ke("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),yt=Ke("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),_t=Ke("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Et=Ke("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),bt=Ke("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),xt=Ke("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),wt=Ke("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),St=Ke("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),Tt=Ke("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Nt=Ke("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),Ct=Ke("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),At=Ke("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Rt=Ke("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),It=()=>{var e,n;const[r,i]=(0,t.useState)(!1),s=ee(),a=Z(),{userProfile:o,userRole:c,isDoctor:l,isCaregiver:d}=(0,Be.useUser)(),u=[{name:"Dashboard",href:"/service-provider",icon:vt},{name:"Schedule",href:"/service-provider/schedule",icon:at},{name:"Patients",href:"/service-provider/patients",icon:yt},{name:"Messages",href:"/service-provider/messages",icon:_t},{name:"Calls",href:"/service-provider/calls",icon:Et},{name:"Settings",href:"/service-provider/settings",icon:bt}],h=[{name:"Medical Records",href:"/service-provider/medical-records",icon:xt},{name:"Prescriptions",href:"/service-provider/prescriptions",icon:wt},{name:"Consultations",href:"/service-provider/consultations",icon:St},{name:"Diagnostics",href:"/service-provider/diagnostics",icon:Tt}],p=[{name:"Tasks",href:"/service-provider/tasks",icon:Nt},{name:"Care Logs",href:"/service-provider/care-logs",icon:xt},{name:"Photo Updates",href:"/service-provider/photos",icon:Ct},{name:"Activities",href:"/service-provider/activities",icon:Tt}],m=(()=>{let e=[...u];return l()?e=[...e,...h]:d()&&(e=[...e,...p]),e})(),f=e=>a.pathname===e,g=()=>{switch(c){case"doctor":return"Doctor";case"caregiver":return"Caregiver";default:return"Service Provider"}},v=()=>{switch(c){case"doctor":return(0,Qe.jsx)(St,{className:"h-8 w-8 text-blue-600"});case"caregiver":return(0,Qe.jsx)(At,{className:"h-8 w-8 text-green-600"});default:return(0,Qe.jsx)(Rt,{className:"h-8 w-8 text-gray-600"})}};return(0,Qe.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,Qe.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(r?"block":"hidden"),children:[(0,Qe.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>i(!1)}),(0,Qe.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Qe.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Qe.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>i(!1),children:(0,Qe.jsx)(ut,{className:"h-6 w-6 text-white"})})}),(0,Qe.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Qe.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:v()}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX"}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:g()})]})]})}),(0,Qe.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:m.map(e=>{const t=e.icon;return(0,Qe.jsxs)(Ae,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(f(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Qe.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(f(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Qe.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Qe.jsx)("div",{className:"flex flex-col w-64",children:(0,Qe.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Qe.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Qe.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:v()}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX"}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:g()})]})]})}),(0,Qe.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:m.map(e=>{const t=e.icon;return(0,Qe.jsxs)(Ae,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(f(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Qe.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(f(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Qe.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"flex-shrink-0",children:(0,Qe.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o||null===(e=o.name)||void 0===e?void 0:e.split(" ").map(e=>e[0]).join(""))||"U"})})}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o?void 0:o.name)||"User"}),(0,Qe.jsxs)("button",{onClick:async()=>{try{await(0,ke.CI)(Fe.j2),Pe.oR.success("Signed out successfully"),s("/login")}catch(e){Pe.oR.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Qe.jsx)(ht,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Qe.jsxs)("div",{className:"lg:pl-64 flex flex-col flex-1 min-w-0 dashboard-container",children:[(0,Qe.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Qe.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 lg:hidden touch-manipulation",onClick:()=>i(!0),children:(0,Qe.jsx)(pt,{className:"h-6 w-6"})}),(0,Qe.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Qe.jsx)("div",{className:"flex-1 flex",children:(0,Qe.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Qe.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Qe.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Qe.jsxs)("span",{className:"text-sm text-gray-500",children:[g()," Panel"]})})})})}),(0,Qe.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Qe.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:(0,Qe.jsx)(mt,{className:"h-6 w-6"})}),(0,Qe.jsx)("div",{className:"ml-3 relative",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o||null===(n=o.name)||void 0===n?void 0:n.split(" ").map(e=>e[0]).join(""))||"U"})}),(0,Qe.jsx)("div",{className:"ml-3",children:(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o?void 0:o.name)||"User"})})]})})]})]})]}),(0,Qe.jsx)("main",{className:"flex-1 overflow-auto w-full dashboard-main",children:(0,Qe.jsx)("div",{className:"h-full",children:(0,Qe.jsx)(ge,{})})})]})]})},Ot=Ke("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Pt=Ke("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),kt=Ke("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Dt=Ke("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Lt=Ke("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),jt=Ke("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Mt=Ke("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ut=()=>{const e=[{icon:ot,title:"Health Monitoring",description:"Continuous monitoring of vital signs and health metrics"},{icon:Rt,title:"Secure & Private",description:"Your health data is protected with enterprise-grade security"},{icon:yt,title:"Caregiver Support",description:"Professional caregivers available 24/7 for your needs"},{icon:Ot,title:"24/7 Access",description:"Round-the-clock support and emergency response"}],t=[{icon:St,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",color:"text-blue-600",bgColor:"bg-blue-100"},{icon:Tt,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",color:"text-green-600",bgColor:"bg-green-100"},{icon:mt,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",color:"text-red-600",bgColor:"bg-red-100"},{icon:ct,title:"Telemedicine",description:"Video consultations with doctors and specialists.",color:"text-purple-600",bgColor:"bg-purple-100"},{icon:yt,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",color:"text-orange-600",bgColor:"bg-orange-100"},{icon:Rt,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",color:"text-blue-600",bgColor:"bg-blue-100"}];return(0,Qe.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,Qe.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:(0,Qe.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsxs)("div",{className:"flex-shrink-0 flex items-center",children:[(0,Qe.jsx)(ot,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Qe.jsx)("p",{className:"ml-4 text-sm text-gray-600 hidden sm:block",children:"Professional Home Healthcare"})]}),(0,Qe.jsx)("div",{className:"flex items-center"})]})})}),(0,Qe.jsxs)("section",{className:"relative py-16 sm:py-24 lg:py-32 overflow-hidden",children:[(0,Qe.jsxs)("div",{className:"absolute inset-0 z-0",children:[(0,Qe.jsx)("img",{src:"/images/story-care-checkup-1.png",alt:"African elderly receiving healthcare",className:"w-full h-full object-cover opacity-20"}),(0,Qe.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-900/50 to-green-900/50"})]}),(0,Qe.jsxs)("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[(0,Qe.jsxs)("div",{className:"text-center lg:text-left text-white",children:[(0,Qe.jsx)("span",{className:"inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-white/20 text-white backdrop-blur-sm",children:"\ud83c\uddf3\ud83c\uddec Proudly Nigerian \u2022 NDPR Compliant"}),(0,Qe.jsxs)("h1",{className:"mt-4 text-4xl font-extrabold sm:text-5xl md:text-6xl",children:["Quality ",(0,Qe.jsx)("span",{className:"text-teal-300",children:"Healthcare"})," At Your ",(0,Qe.jsx)("span",{className:"text-green-300",children:"Doorstep"})]}),(0,Qe.jsx)("p",{className:"mt-6 text-lg text-blue-100 max-w-xl mx-auto lg:mx-0",children:"ElderCare Nigeria provides compassionate and professional home healthcare services, ensuring comfort and well-being for your loved ones."}),(0,Qe.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center lg:justify-start",children:[(0,Qe.jsxs)(Ae,{to:"/login",className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-gray-50 transition-colors",children:["Get Started",(0,Qe.jsx)(Pt,{className:"ml-2 h-5 w-5"})]}),(0,Qe.jsxs)("a",{href:"tel:0800-ELDERCARE",className:"inline-flex items-center justify-center px-6 py-3 border border-white/30 text-base font-medium rounded-md text-white bg-white/10 hover:bg-white/20 backdrop-blur-sm transition-colors",children:[(0,Qe.jsx)(Et,{className:"mr-2 h-5 w-5"}),"Call: 0800-ELDERCARE"]})]}),(0,Qe.jsxs)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-3 gap-6 text-blue-100",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-300 mr-2"}),"Licensed Professionals"]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Qe.jsx)(Rt,{className:"h-5 w-5 text-blue-300 mr-2"}),"Secure & Private"]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Qe.jsx)(Ot,{className:"h-5 w-5 text-purple-300 mr-2"}),"24/7 Emergency Support"]})]})]}),(0,Qe.jsx)("div",{className:"mt-12 lg:mt-0 flex lg:items-start lg:justify-start",children:(0,Qe.jsxs)("div",{className:"inline-block transform origin-top-left scale-[1.6] md:scale-[1.8] lg:scale-[2] lg:-translate-y-6 transition-transform duration-300 ease-out hover:-rotate-2 hover:shadow-2xl bg-white rounded-lg shadow-xl p-4 w-72 mx-auto lg:mx-0",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-3",children:[(0,Qe.jsx)("img",{className:"h-10 w-10 rounded-full object-cover",src:"https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80&v=2",alt:"Nurse Fatima Abdullahi"}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Nurse Fatima Abdullahi"}),(0,Qe.jsxs)("p",{className:"text-xs text-gray-500 flex items-center",children:[(0,Qe.jsx)(ot,{className:"h-3 w-3 text-red-500 mr-1"}),(0,Qe.jsx)("span",{className:"text-yellow-500",children:"\u2605"})," 4.9 (156 visits)"]})]})]}),(0,Qe.jsx)("div",{className:"bg-green-50 p-2 rounded-lg mb-3",children:(0,Qe.jsx)("p",{className:"text-xs text-green-800",children:'"Hello! I\'ll be arriving at your location in 15 minutes. Please ensure the gate is open."'})}),(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800 text-xs",children:[(0,Qe.jsx)(lt,{className:"h-3 w-3 mr-1"}),"Reply"]}),(0,Qe.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800 text-xs",children:[(0,Qe.jsx)(ct,{className:"h-3 w-3 mr-1"}),"Video Call"]})]})]})})]})]}),(0,Qe.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Qe.jsxs)("div",{className:"text-center mb-12",children:[(0,Qe.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Why Choose ElderCare Nigeria?"}),(0,Qe.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"We provide comprehensive healthcare solutions designed specifically for Nigerian families"})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:e.map((e,t)=>{const n=e.icon;return(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Qe.jsx)(n,{className:"h-8 w-8 text-blue-600"})}),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),(0,Qe.jsx)("p",{className:"text-gray-600",children:e.description})]},t)})})]})}),(0,Qe.jsx)("section",{className:"py-16",children:(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Qe.jsxs)("div",{className:"text-center mb-12",children:[(0,Qe.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Qe.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map((e,t)=>{const n=e.icon;return(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Qe.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Qe.jsx)(n,{className:"h-8 w-8 ".concat(e.color)})}),(0,Qe.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Qe.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]})}),(0,Qe.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Qe.jsxs)("div",{className:"text-center mb-12",children:[(0,Qe.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Real Stories from Our Community"}),(0,Qe.jsx)("p",{className:"text-lg text-gray-600",children:"See how ElderCare Nigeria is making a difference in the lives of African families"})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:[(0,Qe.jsxs)("div",{className:"relative group",children:[(0,Qe.jsx)("img",{src:"https://images.pexels.com/photos/7551649/pexels-photo-7551649.jpeg?auto=compress&cs=tinysrgb&w=1200",alt:"African elderly woman receiving home healthcare",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Qe.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Qe.jsx)(ot,{className:"h-8 w-8 mx-auto mb-2"}),(0,Qe.jsx)("p",{className:"text-sm font-medium",children:"Compassionate Care"})]})})]}),(0,Qe.jsxs)("div",{className:"relative group",children:[(0,Qe.jsx)("img",{src:"/images/story-care-checkup-1.png",alt:"African elderly man with healthcare professional",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Qe.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Qe.jsx)(yt,{className:"h-8 w-8 mx-auto mb-2"}),(0,Qe.jsx)("p",{className:"text-sm font-medium",children:"Family Connection"})]})})]}),(0,Qe.jsxs)("div",{className:"relative group",children:[(0,Qe.jsx)("img",{src:"https://images.pexels.com/photos/7551617/pexels-photo-7551617.jpeg?auto=compress&cs=tinysrgb&w=1200",alt:"African elderly woman with technology",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Qe.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Qe.jsx)(Tt,{className:"h-8 w-8 mx-auto mb-2"}),(0,Qe.jsx)("p",{className:"text-sm font-medium",children:"Health Monitoring"})]})})]}),(0,Qe.jsxs)("div",{className:"relative group",children:[(0,Qe.jsx)("img",{src:"/images/story-care-checkup-2.png",alt:"African elderly man with family",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Qe.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Qe.jsx)(Dt,{className:"h-8 w-8 mx-auto mb-2"}),(0,Qe.jsx)("p",{className:"text-sm font-medium",children:"Trusted Care"})]})})]})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{name:"Mrs. Adunni Okafor",location:"Lagos, Nigeria",rating:5,text:"ElderCare Nigeria has been a blessing for my family. The caregivers are professional and caring, and the 24/7 support gives us peace of mind.",photo:"https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80&v=2",age:"72 years old"},{name:"Mr. Chinedu Okoro",location:"Port Harcourt, Nigeria",rating:5,text:"The medication management system has been incredibly helpful. I never miss a dose anymore, and my family is always informed about my health status.",photo:null,age:"75 years old"}].map((e,t)=>(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Qe.jsx)("div",{className:"flex items-center mb-4",children:[...Array(e.rating)].map((e,t)=>(0,Qe.jsx)(Lt,{className:"h-5 w-5 text-yellow-400 fill-current"},t))}),(0,Qe.jsxs)("p",{className:"text-gray-600 mb-4 italic",children:['"',e.text,'"']}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("img",{src:e.photo,alt:e.name,className:"w-12 h-12 rounded-full object-cover mr-3 border-2 border-blue-100"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500 flex items-center",children:[(0,Qe.jsx)(jt,{className:"h-4 w-4 mr-1"}),e.location]}),(0,Qe.jsx)("p",{className:"text-xs text-blue-600 font-medium",children:e.age})]})]})]},t))})]})}),(0,Qe.jsx)("section",{className:"py-16 bg-white",children:(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Qe.jsxs)("div",{className:"text-center mb-12",children:[(0,Qe.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"See ElderCare Nigeria in Action"}),(0,Qe.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Watch real stories from African families who have experienced the difference our care makes"})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-center",children:[(0,Qe.jsx)("div",{className:"relative",children:(0,Qe.jsxs)("div",{className:"relative rounded-lg overflow-hidden shadow-2xl",children:[(0,Qe.jsx)("img",{className:"w-full h-96 object-cover",src:"/images/story-care-checkup-2.png",alt:"Mrs. Adunni's Story"}),(0,Qe.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"}),(0,Qe.jsxs)("div",{className:"absolute bottom-4 left-4 text-white",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold",children:"Mrs. Adunni's Story"}),(0,Qe.jsx)("p",{className:"text-sm opacity-90",children:"Lagos, Nigeria"})]})]})}),(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Qe.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,Qe.jsx)(ot,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Compassionate Care"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Our caregivers provide not just medical care, but emotional support and companionship that makes a real difference in the lives of our patients."})]})]}),(0,Qe.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Qe.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,Qe.jsx)(Rt,{className:"h-6 w-6 text-green-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Professional Excellence"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"All our healthcare professionals are licensed, experienced, and trained to provide the highest quality care in the comfort of your home."})]})]}),(0,Qe.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Qe.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,Qe.jsx)(yt,{className:"h-6 w-6 text-purple-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Family-Centered Approach"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"We work closely with families to ensure everyone is informed and involved in the care process, creating a supportive network around each patient."})]})]}),(0,Qe.jsx)("div",{className:"pt-4",children:(0,Qe.jsxs)(Ae,{to:"/login",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,Qe.jsx)(ct,{className:"mr-2 h-5 w-5"}),"Get Started"]})})]})]})]})}),(0,Qe.jsx)("section",{className:"py-16 bg-gradient-to-r from-blue-600 to-green-600",children:(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[(0,Qe.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Ready to Get Started?"}),(0,Qe.jsx)("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Join thousands of Nigerian families who trust ElderCare Nigeria for their healthcare needs"}),(0,Qe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,Qe.jsxs)(Ae,{to:"/login",className:"inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-gray-50",children:[(0,Qe.jsx)(Mt,{className:"mr-2 h-5 w-5"}),"Get Started"]}),(0,Qe.jsxs)(Ae,{to:"/pricing",className:"inline-flex items-center justify-center px-8 py-3 border border-white text-base font-medium rounded-md text-white hover:bg-white hover:text-blue-600",children:[(0,Qe.jsx)(Dt,{className:"mr-2 h-5 w-5"}),"View Our Plans"]})]})]})}),(0,Qe.jsx)("footer",{className:"bg-white py-8 border-t border-gray-200",children:(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,Qe.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)(ot,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Qe.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-4",children:"Professional home healthcare services for Nigerian families. Compassionate care, advanced technology, and 24/7 support."}),(0,Qe.jsxs)("div",{className:"flex space-x-4",children:[(0,Qe.jsx)("a",{href:"tel:0800-ELDERCARE",className:"text-blue-600 hover:text-blue-800",children:(0,Qe.jsx)(Et,{className:"h-5 w-5"})}),(0,Qe.jsx)("a",{href:"mailto:info@eldercare.ng",className:"text-blue-600 hover:text-blue-800",children:(0,Qe.jsx)(lt,{className:"h-5 w-5"})})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Services"}),(0,Qe.jsxs)("ul",{className:"space-y-2",children:[(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Home Visits"})}),(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Vitals Monitoring"})}),(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Emergency Support"})}),(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Telemedicine"})})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Company"}),(0,Qe.jsxs)("ul",{className:"space-y-2",children:[(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/pricing",className:"text-gray-600 hover:text-blue-600",children:"Pricing"})}),(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/about",className:"text-gray-600 hover:text-blue-600",children:"About Us"})}),(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/contact",className:"text-gray-600 hover:text-blue-600",children:"Contact"})}),(0,Qe.jsx)("li",{children:(0,Qe.jsx)("a",{href:"/privacy",className:"text-gray-600 hover:text-blue-600",children:"Privacy Policy"})})]})]})]}),(0,Qe.jsxs)("div",{className:"border-t border-gray-200 mt-8 pt-8 text-center",children:[(0,Qe.jsx)("p",{className:"text-gray-500 text-sm",children:"\xa9 2024 ElderCare Nigeria. All rights reserved."}),(0,Qe.jsxs)("p",{className:"text-gray-500 text-sm mt-2",children:["Made by ",(0,Qe.jsx)("a",{href:"https://mgx.dev",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"MGX"})]})]})]})})]})};var Vt=n(6667);const Ft=Ke("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Bt=Ke("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Gt=Ke("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Ht=()=>{const[e,n]=(0,t.useState)("signin"),[r,i]=(0,t.useState)(1),[s,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(!1),[l,d]=(0,t.useState)({email:"",password:""}),[u,h]=(0,t.useState)({email:"",password:"",confirmPassword:"",name:"",phone:"",address:"",dateOfBirth:"",emergencyContactName:"",emergencyContactPhone:"",medicalConditions:"",medications:"",allergies:"",medicalQualification:"",licenseNumber:"",yearsOfExperience:"",specializations:[],hourlyRate:"",hasDisabilities:"",disabilityDetails:"",hasHealthConditions:"",healthConditionDetails:"",backgroundCheckConsent:!1,drugTestConsent:!1}),p=e=>{d(t=>(0,Ge.A)((0,Ge.A)({},t),{},{[e.target.name]:e.target.value}))},m=e=>{const{name:t,value:n,type:r,checked:i}=e.target;h("checkbox"===r?e=>(0,Ge.A)((0,Ge.A)({},e),{},{[t]:i}):e=>(0,Ge.A)((0,Ge.A)({},e),{},{[t]:n}))},f=e=>{switch(e){case 1:return u.email&&u.password&&u.password===u.confirmPassword&&u.password.length>=6;case 2:return u.name&&u.phone&&u.address&&u.dateOfBirth;case 3:return u.emergencyContactName&&u.emergencyContactPhone;default:return!0}},g=e=>{switch(e){case 1:return u.email&&u.password&&u.password===u.confirmPassword&&u.password.length>=6;case 2:return u.name&&u.phone&&u.address&&u.dateOfBirth;case 3:return u.medicalQualification&&u.yearsOfExperience&&u.specializations.length>0;case 4:return u.hasDisabilities&&u.hasHealthConditions&&u.backgroundCheckConsent&&u.drugTestConsent;default:return!0}},v=()=>{("signup-patient"===e?f(r):g(r))?i(e=>e+1):Pe.oR.error("Please fill in all required fields")},y=()=>{i(e=>e-1)};return(0,Qe.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,Qe.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("div",{className:"flex justify-center mb-6",children:(0,Qe.jsx)("div",{className:"p-4 bg-blue-100 rounded-2xl",children:(0,Qe.jsx)(ot,{className:"h-12 w-12 text-blue-600"})})}),(0,Qe.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"ElderX"}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-2",children:(()=>{if("signin"===e)return"Welcome Back";if("signup-patient"===e){return["Create Account","Personal Info","Medical Info"][r-1]||"Complete"}if("signup-caregiver"===e){return["Create Account","Personal Info","Medical Qualifications","Health Screening"][r-1]||"Complete"}return"Authentication"})()})]}),"signin"===e&&(0,Qe.jsx)("div",{className:"space-y-4",children:(0,Qe.jsxs)("div",{className:"flex space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>n("signin"),className:"flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg font-medium",children:"Sign In"}),(0,Qe.jsx)("button",{onClick:()=>n("signup-patient"),className:"flex-1 py-3 px-4 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300",children:"Patient Signup"}),(0,Qe.jsx)("button",{onClick:()=>n("signup-caregiver"),className:"flex-1 py-3 px-4 bg-green-200 text-green-700 rounded-lg font-medium hover:bg-green-300",children:"Caregiver Signup"})]})}),"signin"===e&&(0,Qe.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l.email&&l.password){c(!0);try{await(0,ke.x9)(Fe.j2,l.email,l.password),Pe.oR.success("Welcome back!"),window.location.href="/dashboard"}catch(t){console.error("Login error:",t),Pe.oR.error("Invalid email or password")}finally{c(!1)}}else Pe.oR.error("Please fill in all fields")},className:"space-y-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,Qe.jsx)("input",{name:"email",type:"email",value:l.email,onChange:p,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("input",{name:"password",type:s?"text":"password",value:l.password,onChange:p,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password",required:!0}),(0,Qe.jsx)("button",{type:"button",onClick:()=>a(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:s?(0,Qe.jsx)(Ft,{size:20}):(0,Qe.jsx)(Bt,{size:20})})]})]}),(0,Qe.jsx)("button",{type:"submit",disabled:o,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 font-medium",children:o?"Signing In...":"Sign In"})]}),"signup-patient"===e&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("button",{onClick:()=>{n("signin"),i(1)},className:"flex items-center text-blue-600 hover:text-blue-800",children:[(0,Qe.jsx)(Gt,{size:16,className:"mr-1"}),"Back to Sign In"]}),1===r&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Create Patient Account"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,Qe.jsx)("input",{name:"email",type:"email",value:u.email,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,Qe.jsx)("input",{name:"password",type:"password",value:u.password,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Create a password",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),(0,Qe.jsx)("input",{name:"confirmPassword",type:"password",value:u.confirmPassword,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Confirm your password",required:!0})]})]}),2===r&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Personal Information"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,Qe.jsx)("input",{name:"name",value:u.name,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your full name",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),(0,Qe.jsx)("input",{name:"phone",value:u.phone,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+234 xxx xxx xxxx",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),(0,Qe.jsx)("input",{name:"address",value:u.address,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Your address",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth *"}),(0,Qe.jsx)("input",{name:"dateOfBirth",type:"date",value:u.dateOfBirth,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),3===r&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Medical Information"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact Name *"}),(0,Qe.jsx)("input",{name:"emergencyContactName",value:u.emergencyContactName,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Emergency contact name",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact Phone *"}),(0,Qe.jsx)("input",{name:"emergencyContactPhone",value:u.emergencyContactPhone,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+234 xxx xxx xxxx",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medical Conditions"}),(0,Qe.jsx)("textarea",{name:"medicalConditions",value:u.medicalConditions,onChange:m,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"List any medical conditions (optional)"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Medications"}),(0,Qe.jsx)("textarea",{name:"medications",value:u.medications,onChange:m,rows:2,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"List current medications (optional)"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),(0,Qe.jsx)("input",{name:"allergies",value:u.allergies,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"List any allergies (optional)"})]})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("button",{type:"button",onClick:y,disabled:1===r,className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),r<3?(0,Qe.jsx)("button",{type:"button",onClick:v,disabled:!f(r),className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Next"}):(0,Qe.jsx)("button",{type:"button",onClick:async()=>{c(!0);try{const{user:e}=await(0,ke.eJ)(Fe.j2,u.email,u.password);await(0,ke.r7)(e,{displayName:u.name}),await(0,Vt.BN)((0,Vt.H9)(Fe.db,"users",e.uid),{id:e.uid,name:u.name,displayName:u.name,email:u.email,phone:u.phone,address:u.address,dateOfBirth:u.dateOfBirth,emergencyContactName:u.emergencyContactName,emergencyContactPhone:u.emergencyContactPhone,medicalConditions:u.medicalConditions,medications:u.medications,allergies:u.allergies,userType:"elderly",type:"elderly",onboardingComplete:!0,onboardingProfileComplete:!0,onboardingMedicalComplete:!0,isActive:!0,createdAt:new Date,joinDate:new Date,lastActive:new Date}),Pe.oR.success("Patient account created successfully!"),window.location.href="/dashboard"}catch(e){console.error("Patient signup error:",e),Pe.oR.error(e.message||"Failed to create account")}finally{c(!1)}},disabled:o||!f(3),className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:o?"Creating Account...":"Complete Registration"})]})]}),"signup-caregiver"===e&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("button",{onClick:()=>{n("signin"),i(1)},className:"flex items-center text-green-600 hover:text-green-800",children:[(0,Qe.jsx)(Gt,{size:16,className:"mr-1"}),"Back to Sign In"]}),1===r&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Create Caregiver Account"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,Qe.jsx)("input",{name:"email",type:"email",value:u.email,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,Qe.jsx)("input",{name:"password",type:"password",value:u.password,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Create a password",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),(0,Qe.jsx)("input",{name:"confirmPassword",type:"password",value:u.confirmPassword,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Confirm your password",required:!0})]})]}),2===r&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Personal Information"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,Qe.jsx)("input",{name:"name",value:u.name,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your full name",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),(0,Qe.jsx)("input",{name:"phone",value:u.phone,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+234 xxx xxx xxxx",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),(0,Qe.jsx)("input",{name:"address",value:u.address,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Your address",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth *"}),(0,Qe.jsx)("input",{name:"dateOfBirth",type:"date",value:u.dateOfBirth,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact *"}),(0,Qe.jsx)("input",{name:"emergencyContactName",value:u.emergencyContactName,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Emergency contact name",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Phone *"}),(0,Qe.jsx)("input",{name:"emergencyContactPhone",value:u.emergencyContactPhone,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+234 xxx xxx xxxx",required:!0})]})]}),3===r&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Medical Qualifications"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medical Qualification *"}),(0,Qe.jsxs)("select",{name:"medicalQualification",value:u.medicalQualification,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[(0,Qe.jsx)("option",{value:"",children:"Select your qualification"}),["Doctor (MD)","Nurse (RN)","Licensed Practical Nurse (LPN)","Physiotherapist","Pharmacist","Lab Technician","Psychologist","Psychiatrist","Certified Nursing Assistant (CNA)","Home Health Aide (HHA)","Personal Care Assistant","Caregiver (Non-Medical)","Other"].map(e=>(0,Qe.jsx)("option",{value:e,children:e},e))]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Number"}),(0,Qe.jsx)("input",{name:"licenseNumber",value:u.licenseNumber,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Professional license number"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Years of Experience *"}),(0,Qe.jsxs)("select",{name:"yearsOfExperience",value:u.yearsOfExperience,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[(0,Qe.jsx)("option",{value:"",children:"Select experience"}),(0,Qe.jsx)("option",{value:"0-1",children:"0-1 years"}),(0,Qe.jsx)("option",{value:"2-5",children:"2-5 years"}),(0,Qe.jsx)("option",{value:"6-10",children:"6-10 years"}),(0,Qe.jsx)("option",{value:"11-15",children:"11-15 years"}),(0,Qe.jsx)("option",{value:"16+",children:"16+ years"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hourly Rate ($) *"}),(0,Qe.jsx)("input",{type:"number",name:"hourlyRate",value:u.hourlyRate,onChange:m,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"50",min:"10",max:"500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specializations * (Select at least one)"}),(0,Qe.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto",children:["General Care","Medication Management","Wound Care","Physical Therapy","Vital Signs Monitoring","Meal Preparation","Companionship","Transportation","Housekeeping","Emergency Response","Dementia Care","Diabetes Management"].map(e=>(0,Qe.jsx)("button",{type:"button",onClick:()=>{return t=e,void h(e=>(0,Ge.A)((0,Ge.A)({},e),{},{specializations:e.specializations.includes(t)?e.specializations.filter(e=>e!==t):[...e.specializations,t]}));var t},className:"p-2 text-xs rounded border-2 transition-colors ".concat(u.specializations.includes(e)?"bg-blue-100 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:border-gray-400"),children:e},e))})]})]}),4===r&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Health Screening"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"This information helps us ensure the safety of both caregivers and patients. All information is kept confidential and used only for care planning purposes."}),(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Do you have any disabilities?"}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"radio",name:"hasDisabilities",value:"no",checked:"no"===u.hasDisabilities,onChange:m,className:"h-4 w-4 text-blue-600 border-gray-300"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"No"})]}),(0,Qe.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"radio",name:"hasDisabilities",value:"yes",checked:"yes"===u.hasDisabilities,onChange:m,className:"h-4 w-4 text-blue-600 border-gray-300"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"Yes"})]}),(0,Qe.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"radio",name:"hasDisabilities",value:"prefer-not-to-say",checked:"prefer-not-to-say"===u.hasDisabilities,onChange:m,className:"h-4 w-4 text-blue-600 border-gray-300"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"Prefer not to say"})]})]}),"yes"===u.hasDisabilities&&(0,Qe.jsxs)("div",{className:"mt-3",children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Please specify your disabilities (optional):"}),(0,Qe.jsx)("textarea",{name:"disabilityDetails",value:u.disabilityDetails,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Please describe any disabilities that may affect your ability to provide care..."})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Do you have any health conditions?"}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"radio",name:"hasHealthConditions",value:"no",checked:"no"===u.hasHealthConditions,onChange:m,className:"h-4 w-4 text-blue-600 border-gray-300"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"No"})]}),(0,Qe.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"radio",name:"hasHealthConditions",value:"yes",checked:"yes"===u.hasHealthConditions,onChange:m,className:"h-4 w-4 text-blue-600 border-gray-300"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"Yes"})]})]}),"yes"===u.hasHealthConditions&&(0,Qe.jsxs)("div",{className:"mt-3",children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Please describe your health conditions:"}),(0,Qe.jsx)("textarea",{name:"healthConditionDetails",value:u.healthConditionDetails,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Please list any health conditions that may affect your ability to provide care...",required:"yes"===u.hasHealthConditions})]})]}),(0,Qe.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"checkbox",name:"backgroundCheckConsent",checked:u.backgroundCheckConsent,onChange:m,className:"h-4 w-4 text-blue-600 border-gray-300 rounded",required:!0}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"I consent to background check *"})]}),(0,Qe.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"checkbox",name:"drugTestConsent",checked:u.drugTestConsent,onChange:m,className:"h-4 w-4 text-blue-600 border-gray-300 rounded",required:!0}),(0,Qe.jsx)("span",{className:"text-sm text-gray-700",children:"I consent to drug testing *"})]})]})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("button",{type:"button",onClick:y,disabled:1===r,className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),r<4?(0,Qe.jsx)("button",{type:"button",onClick:v,disabled:!g(r),className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:"Next"}):(0,Qe.jsx)("button",{type:"button",onClick:async()=>{c(!0);try{const{user:e}=await(0,ke.eJ)(Fe.j2,u.email,u.password);await(0,ke.r7)(e,{displayName:u.name}),await(0,Vt.BN)((0,Vt.H9)(Fe.db,"users",e.uid),{id:e.uid,name:u.name,displayName:u.name,email:u.email,phone:u.phone,address:u.address,dateOfBirth:u.dateOfBirth,emergencyContactName:u.emergencyContactName,emergencyContactPhone:u.emergencyContactPhone,medicalQualification:u.medicalQualification,licenseNumber:u.licenseNumber,yearsOfExperience:u.yearsOfExperience,specializations:u.specializations,hourlyRate:u.hourlyRate,hasDisabilities:u.hasDisabilities,disabilityDetails:u.disabilityDetails,hasHealthConditions:u.hasHealthConditions,healthConditionDetails:u.healthConditionDetails,userType:"caregiver",type:"caregiver",onboardingComplete:!0,isActive:!0,createdAt:new Date,joinDate:new Date,lastActive:new Date}),await(0,Vt.BN)((0,Vt.H9)(Fe.db,"caregivers",e.uid),{id:e.uid,name:u.name,displayName:u.name,email:u.email,phone:u.phone,location:u.address,specializations:u.specializations,medicalQualification:u.medicalQualification,rating:4.5,totalPatients:0,experience:parseInt(u.yearsOfExperience)||1,bio:"".concat(u.medicalQualification," with ").concat(u.yearsOfExperience," years of experience"),status:"active",hourlyRate:parseFloat(u.hourlyRate)||50,licenseNumber:u.licenseNumber,joinDate:new Date,lastActive:new Date,createdAt:new Date,isVerified:!0,userType:"caregiver"}),Pe.oR.success("Caregiver account created successfully!"),window.location.href="/caregiver"}catch(e){console.error("Caregiver signup error:",e),Pe.oR.error(e.message||"Failed to create account")}finally{c(!1)}},disabled:o||!g(4),className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:o?"Creating Account...":"Complete Registration"})]})]})]})})},Wt="appointments",zt=async e=>{try{const t=(0,Vt.rJ)(Fe.db,Wt),n=(0,Vt.P)(t,(0,Vt._M)("patientId","==",e),(0,Vt.My)("scheduledTime","desc")),r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s,a,o;const c=e.data();i.push((0,Ge.A)((0,Ge.A)({id:e.id},c),{},{scheduledTime:(null===(t=c.scheduledTime)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||c.scheduledTime,createdAt:(null===(r=c.createdAt)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||c.createdAt,updatedAt:(null===(a=c.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||c.updatedAt}))}),i}catch(t){throw console.error("Error fetching patient appointments:",t),t}},Kt=async(e,t)=>{try{const n=new Date;n.setHours(0,0,0,0);const r=new Date(n);r.setDate(r.getDate()+1);const i=(0,Vt.rJ)(Fe.db,Wt);let s;if("doctor"===t)s=(0,Vt.P)(i,(0,Vt._M)("doctorId","==",e));else if("caregiver"===t)s=(0,Vt.P)(i,(0,Vt._M)("caregiverId","==",e));else{if("elderly"!==t)throw new Error("Invalid user role");s=(0,Vt.P)(i,(0,Vt._M)("patientId","==",e))}const a=await(0,Vt.GG)(s),o=[];return a.forEach(e=>{var t,i;const s=e.data(),a=(null===(t=s.scheduledTime)||void 0===t||null===(i=t.toDate)||void 0===i?void 0:i.call(t))||s.scheduledTime;var c,l,d,u;a&&a>=n&&a<r&&o.push((0,Ge.A)((0,Ge.A)({id:e.id},s),{},{scheduledTime:a,createdAt:(null===(c=s.createdAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||s.createdAt,updatedAt:(null===(d=s.updatedAt)||void 0===d||null===(u=d.toDate)||void 0===u?void 0:u.call(d))||s.updatedAt}))}),o.sort((e,t)=>new Date(e.scheduledTime)-new Date(t.scheduledTime)),o}catch(n){throw console.error("Error fetching today's appointments:",n),n}},qt=async(e,t)=>{try{const n=new Date;n.setHours(0,0,0,0);const r=new Date(n);r.setDate(r.getDate()+7);const i=(0,Vt.rJ)(Fe.db,Wt);let s;if("doctor"===t)s=(0,Vt.P)(i,(0,Vt._M)("doctorId","==",e));else if("caregiver"===t)s=(0,Vt.P)(i,(0,Vt._M)("caregiverId","==",e));else{if("elderly"!==t)throw new Error("Invalid user role");s=(0,Vt.P)(i,(0,Vt._M)("patientId","==",e))}const a=await(0,Vt.GG)(s),o=[];return a.forEach(e=>{var t,i;const s=e.data(),a=(null===(t=s.scheduledTime)||void 0===t||null===(i=t.toDate)||void 0===i?void 0:i.call(t))||s.scheduledTime;var c,l,d,u;a&&a>=n&&a<=r&&o.push((0,Ge.A)((0,Ge.A)({id:e.id},s),{},{scheduledTime:a,createdAt:(null===(c=s.createdAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||s.createdAt,updatedAt:(null===(d=s.updatedAt)||void 0===d||null===(u=d.toDate)||void 0===u?void 0:u.call(d))||s.updatedAt}))}),o.sort((e,t)=>new Date(e.scheduledTime)-new Date(t.scheduledTime)),o}catch(n){throw console.error("Error fetching upcoming appointments:",n),n}},Yt="vitalSigns",Xt=async e=>{try{const t=(0,Vt.rJ)(Fe.db,Yt),n=(0,Vt.P)(t,(0,Vt._M)("patientId","==",e),(0,Vt.My)("recordedAt","desc")),r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s,a,o;const c=e.data();i.push((0,Ge.A)((0,Ge.A)({id:e.id},c),{},{recordedAt:(null===(t=c.recordedAt)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||c.recordedAt,createdAt:(null===(r=c.createdAt)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||c.createdAt,updatedAt:(null===(a=c.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||c.updatedAt}))}),i}catch(t){throw console.error("Error fetching vital signs:",t),t}},Jt=async(e,t)=>{try{const n=new Date,r=new Date;r.setDate(r.getDate()-7);const i=await(async(e,t,n)=>{try{const r=(0,Vt.rJ)(Fe.db,Yt),i=(0,Vt.P)(r,(0,Vt._M)("patientId","==",e),(0,Vt._M)("recordedAt",">=",Vt.Dc.fromDate(t)),(0,Vt._M)("recordedAt","<=",Vt.Dc.fromDate(n)),(0,Vt.My)("recordedAt","desc")),s=await(0,Vt.GG)(i),a=[];return s.forEach(e=>{var t,n,r,i,s,o;const c=e.data();a.push((0,Ge.A)((0,Ge.A)({id:e.id},c),{},{recordedAt:(null===(t=c.recordedAt)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||c.recordedAt,createdAt:(null===(r=c.createdAt)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||c.createdAt,updatedAt:(null===(s=c.updatedAt)||void 0===s||null===(o=s.toDate)||void 0===o?void 0:o.call(s))||c.updatedAt}))}),a}catch(r){throw console.error("Error fetching vital signs by date range:",r),r}})(e,r,n),s=t?i.filter(e=>e.type===t):i,a={};return s.forEach(e=>{a[e.type]||(a[e.type]=[]),a[e.type].push({value:e.value,unit:e.unit,recordedAt:e.recordedAt,status:e.status})}),Object.keys(a).forEach(e=>{const t=a[e];if(t.length>=2){const n=parseFloat(t[0].value),r=parseFloat(t[1].value);a[e].trend=n>r?"increasing":n<r?"decreasing":"stable";const i=t.reduce((e,t)=>e+parseFloat(t.value),0);a[e].average=(i/t.length).toFixed(1)}}),a}catch(n){throw console.error("Error fetching vital signs trends:",n),n}},Qt="messages",Zt="conversations",$t=async e=>{try{const t=(0,Vt.rJ)(Fe.db,Zt),n=(0,Vt.P)(t,(0,Vt._M)("participants","array-contains",e),(0,Vt.My)("lastMessageTime","desc")),r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s,a,o;const c=e.data();i.push((0,Ge.A)((0,Ge.A)({id:e.id},c),{},{lastMessageTime:(null===(t=c.lastMessageTime)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||c.lastMessageTime,createdAt:(null===(r=c.createdAt)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||c.createdAt,updatedAt:(null===(a=c.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||c.updatedAt}))}),i}catch(t){throw console.error("Error fetching conversations:",t),t}},en=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const n=(0,Vt.rJ)(Fe.db,Qt),r=(0,Vt.P)(n,(0,Vt._M)("conversationId","==",e),(0,Vt.My)("createdAt","desc"),(0,Vt.AB)(t)),i=await(0,Vt.GG)(r),s=[];return i.forEach(e=>{var t,n;const r=e.data();s.push((0,Ge.A)((0,Ge.A)({id:e.id},r),{},{createdAt:(null===(t=r.createdAt)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||r.createdAt}))}),s.reverse()}catch(n){throw console.error("Error fetching messages:",n),n}};var tn=n(1889),nn=n(6685);const rn=(0,tn.Qg)(Fe.Cn,"createMedicationReminder"),sn=(0,tn.Qg)(Fe.Cn,"logMedicationDose"),an=(0,tn.Qg)(Fe.Cn,"getMedicationAnalytics"),on={getMedications:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{et.A.debug("Fetching medications",{filters:e});try{if(e.patientId){return(await nn.A.getMedications(e.patientId)).data||[]}return(await nn.A.getCurrentUserMedications()).data||[]}catch(t){et.A.warn("Data Connect failed, falling back to Firestore",{error:t})}let n;n=e.patientId?(0,Vt.P)((0,Vt.rJ)(Fe.db,"medications"),(0,Vt._M)("patientId","==",e.patientId)):(0,Vt.P)((0,Vt.rJ)(Fe.db,"medications"),(0,Vt.My)("startDate","desc"),(0,Vt.AB)(50)),e.limit&&(n=(0,Vt.P)(n,(0,Vt.AB)(e.limit)));const r=await(0,Vt.GG)(n);let i=[];return r.forEach(e=>{var t,n,r,s,a,o;i.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{startDate:null===(t=e.data().startDate)||void 0===t?void 0:t.toDate(),endDate:null===(n=e.data().endDate)||void 0===n?void 0:n.toDate(),lastTaken:null===(r=e.data().lastTaken)||void 0===r?void 0:r.toDate(),nextDose:null===(s=e.data().nextDose)||void 0===s?void 0:s.toDate(),createdAt:null===(a=e.data().createdAt)||void 0===a?void 0:a.toDate(),updatedAt:null===(o=e.data().updatedAt)||void 0===o?void 0:o.toDate()}))}),e.status&&(i=i.filter(t=>t.status===e.status)),e.patientId&&i.sort((e,t)=>{const n=e.startDate||new Date(0);return(t.startDate||new Date(0))-n}),i}catch(n){throw console.error("Error fetching medications:",n),n}},getMedicationById:async e=>{try{const o=(0,Vt.H9)(Fe.db,"medications",e),c=await(0,Vt.x7)(o);var t,n,r,i,s,a;if(c.exists())return(0,Ge.A)((0,Ge.A)({id:c.id},c.data()),{},{startDate:null===(t=c.data().startDate)||void 0===t?void 0:t.toDate(),endDate:null===(n=c.data().endDate)||void 0===n?void 0:n.toDate(),lastTaken:null===(r=c.data().lastTaken)||void 0===r?void 0:r.toDate(),nextDose:null===(i=c.data().nextDose)||void 0===i?void 0:i.toDate(),createdAt:null===(s=c.data().createdAt)||void 0===s?void 0:s.toDate(),updatedAt:null===(a=c.data().updatedAt)||void 0===a?void 0:a.toDate()});throw new Error("Medication not found")}catch(o){throw console.error("Error fetching medication:",o),o}},createMedication:async e=>{try{return{id:(await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"medications"),(0,Ge.A)((0,Ge.A)({},e),{},{status:"active",complianceRate:0,totalDoses:0,takenDoses:0,missedDoses:0,createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}))).id,success:!0}}catch(t){throw console.error("Error creating medication:",t),t}},updateMedication:async(e,t)=>{try{const n=(0,Vt.H9)(Fe.db,"medications",e);return await(0,Vt.mZ)(n,(0,Ge.A)((0,Ge.A)({},t),{},{updatedAt:(0,Vt.O5)()})),{success:!0}}catch(n){throw console.error("Error updating medication:",n),n}},deleteMedication:async e=>{try{const t=(0,Vt.H9)(Fe.db,"medications",e);return await(0,Vt.kd)(t),{success:!0}}catch(t){throw console.error("Error deleting medication:",t),t}},recordDoseTaken:async(e,t)=>{try{const r=(0,Vt.H9)(Fe.db,"medications",e),i=await(0,Vt.x7)(r);if(i.exists()){var n;const s=i.data(),a=s.takenDoses+1,o=s.totalDoses+1,c=Math.round(a/o*100),l=cn(t.takenAt,s.frequency,(null===(n=s.reminders)||void 0===n?void 0:n.times)||[]);return await(0,Vt.mZ)(r,{takenDoses:a,totalDoses:o,complianceRate:c,lastTaken:t.takenAt,nextDose:l,updatedAt:(0,Vt.O5)()}),await on.logDoseEvent(e,{type:"taken",timestamp:t.takenAt,notes:t.notes||"",recordedBy:t.recordedBy||"Patient"}),{success:!0,complianceRate:c}}throw new Error("Medication not found")}catch(r){throw console.error("Error recording dose taken:",r),r}},recordMissedDose:async(e,t)=>{try{const r=(0,Vt.H9)(Fe.db,"medications",e),i=await(0,Vt.x7)(r);if(i.exists()){var n;const s=i.data(),a=s.missedDoses+1,o=s.totalDoses+1,c=Math.round(s.takenDoses/o*100),l=cn(t.missedAt,s.frequency,(null===(n=s.reminders)||void 0===n?void 0:n.times)||[]);return await(0,Vt.mZ)(r,{missedDoses:a,totalDoses:o,complianceRate:c,nextDose:l,updatedAt:(0,Vt.O5)()}),await on.logDoseEvent(e,{type:"missed",timestamp:t.missedAt,notes:t.notes||"",recordedBy:t.recordedBy||"System"}),{success:!0,complianceRate:c}}throw new Error("Medication not found")}catch(r){throw console.error("Error recording missed dose:",r),r}},logDoseEvent:async(e,t)=>{try{return{id:(await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"doseLogs"),(0,Ge.A)((0,Ge.A)({medicationId:e},t),{},{timestamp:(0,Vt.O5)()}))).id,success:!0}}catch(n){throw console.error("Error logging dose event:",n),n}},getDoseLogs:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"doseLogs"),(0,Vt._M)("medicationId","==",e),(0,Vt.My)("timestamp","desc"));t.type&&(n=(0,Vt.P)(n,(0,Vt._M)("type","==",t.type))),t.limit&&(n=(0,Vt.P)(n,(0,Vt.AB)(t.limit)));const r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t;i.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{timestamp:null===(t=e.data().timestamp)||void 0===t?void 0:t.toDate()}))}),i}catch(n){throw console.error("Error fetching dose logs:",n),n}},getComplianceAnalytics:async function(){try{const e=(0,Vt.P)((0,Vt.rJ)(Fe.db,"medications")),t=await(0,Vt.GG)(e),n={totalMedications:0,activeMedications:0,averageCompliance:0,complianceDistribution:{excellent:0,good:0,fair:0,poor:0},medicationStats:[],patientCompliance:[],sideEffectReports:[],drugInteractions:[]};let r=0,i=0;return t.forEach(e=>{const t=e.data();n.totalMedications++,"active"===t.status&&(i++,r+=t.complianceRate||0,t.complianceRate>=90?n.complianceDistribution.excellent++:t.complianceRate>=80?n.complianceDistribution.good++:t.complianceRate>=70?n.complianceDistribution.fair++:n.complianceDistribution.poor++)}),n.activeMedications=i,n.averageCompliance=i>0?Math.round(r/i):0,n}catch(e){throw console.error("Error fetching compliance analytics:",e),e}},getOverdueMedications:async()=>{try{const e=new Date,t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"medications"),(0,Vt._M)("status","==","active"),(0,Vt._M)("nextDose","<=",e)),n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{var t,n,i,s;r.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{startDate:null===(t=e.data().startDate)||void 0===t?void 0:t.toDate(),endDate:null===(n=e.data().endDate)||void 0===n?void 0:n.toDate(),lastTaken:null===(i=e.data().lastTaken)||void 0===i?void 0:i.toDate(),nextDose:null===(s=e.data().nextDose)||void 0===s?void 0:s.toDate()}))}),r}catch(e){throw console.error("Error fetching overdue medications:",e),e}},updateReminders:async(e,t)=>{try{const n=(0,Vt.H9)(Fe.db,"medications",e);return await(0,Vt.mZ)(n,{reminders:t,updatedAt:(0,Vt.O5)()}),{success:!0}}catch(n){throw console.error("Error updating reminders:",n),n}},getSideEffects:async e=>{try{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"sideEffects"),(0,Vt._M)("medicationId","==",e),(0,Vt.My)("reportedAt","desc")),n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{var t;r.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{reportedAt:null===(t=e.data().reportedAt)||void 0===t?void 0:t.toDate()}))}),r}catch(t){throw console.error("Error fetching side effects:",t),t}},reportSideEffect:async(e,t)=>{try{return{id:(await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"sideEffects"),(0,Ge.A)((0,Ge.A)({medicationId:e},t),{},{reportedAt:(0,Vt.O5)()}))).id,success:!0}}catch(n){throw console.error("Error reporting side effect:",n),n}},checkDrugInteractions:async e=>{try{return[{medication1:"Warfarin",medication2:"Aspirin",severity:"High",description:"Increased bleeding risk",recommendation:"Monitor INR closely"}]}catch(t){throw console.error("Error checking drug interactions:",t),t}},subscribeToMedications:e=>{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"medications"),(0,Vt.My)("updatedAt","desc"));return(0,Vt.aQ)(t,t=>{const n=[];t.forEach(e=>{var t,r,i,s,a,o;n.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{startDate:null===(t=e.data().startDate)||void 0===t?void 0:t.toDate(),endDate:null===(r=e.data().endDate)||void 0===r?void 0:r.toDate(),lastTaken:null===(i=e.data().lastTaken)||void 0===i?void 0:i.toDate(),nextDose:null===(s=e.data().nextDose)||void 0===s?void 0:s.toDate(),createdAt:null===(a=e.data().createdAt)||void 0===a?void 0:a.toDate(),updatedAt:null===(o=e.data().updatedAt)||void 0===o?void 0:o.toDate()}))}),e(n)})},createReminder:async(e,t)=>{try{et.A.debug("Creating medication reminder",{medicationId:e,reminderData:t});const n=await rn((0,Ge.A)({medicationId:e},t));return et.A.info("Medication reminder created successfully",{reminderId:n.data.id}),n.data}catch(n){throw Je.Ay.handleError(n,{context:"create_medication_reminder",medicationId:e,reminderData:t}),n}},logDose:async(e,t)=>{try{et.A.debug("Logging medication dose",{medicationId:e,doseData:t});const n=await sn((0,Ge.A)({medicationId:e},t));return et.A.info("Medication dose logged successfully",{logId:n.data.id}),n.data}catch(n){throw Je.Ay.handleError(n,{context:"log_medication_dose",medicationId:e,doseData:t}),n}},getAnalytics:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{et.A.debug("Getting medication analytics",{patientId:e,dateRange:t});const n=await an({patientId:e,dateRange:t});return et.A.info("Medication analytics retrieved successfully"),n.data}catch(n){throw Je.Ay.handleError(n,{context:"medication_analytics",patientId:e,dateRange:t}),n}}},cn=(e,t,n)=>{const r=new Date(e);let i=new Date(r);switch(t.toLowerCase()){case"once daily":case"as needed":default:i.setDate(r.getDate()+1);break;case"twice daily":if(n.length>=2){const e=r.getHours(),t=parseInt(n[0].split(":")[0]),s=parseInt(n[1].split(":")[0]);e<t?i.setHours(t,parseInt(n[0].split(":")[1]),0,0):e<s?i.setHours(s,parseInt(n[1].split(":")[1]),0,0):(i.setDate(r.getDate()+1),i.setHours(t,parseInt(n[0].split(":")[1]),0,0))}else i.setHours(r.getHours()+12);break;case"three times daily":i.setHours(r.getHours()+8);break;case"four times daily":i.setHours(r.getHours()+6)}return i},ln=(0,tn.Qg)(Fe.Cn,"processEmergencyAlert"),dn=(0,tn.Qg)(Fe.Cn,"coordinateEmergencyResponse"),un=(0,tn.Qg)(Fe.Cn,"updateEmergencyStatus"),hn={subscribeToEmergencies:e=>{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"emergencies"),(0,Vt.My)("triggeredAt","desc"));return(0,Vt.aQ)(t,t=>{const n=[];t.forEach(e=>{var t,r;n.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{triggeredAt:null===(t=e.data().triggeredAt)||void 0===t?void 0:t.toDate(),resolvedAt:null===(r=e.data().resolvedAt)||void 0===r?void 0:r.toDate()}))}),e(n)})},getEmergencyStats:async()=>{try{const e=(0,Vt.P)((0,Vt.rJ)(Fe.db,"emergencies")),t=await(0,Vt.GG)(e),n={total:0,active:0,resolved:0,critical:0,averageResponseTime:0};let r=0,i=0;return t.forEach(e=>{const t=e.data();n.total++,"active"===t.status&&n.active++,"resolved"===t.status&&(n.resolved++,t.responseTime&&(r+=t.responseTime,i++)),"Critical"===t.severity&&n.critical++}),n.averageResponseTime=i>0?Math.round(r/i):0,n}catch(e){throw console.error("Error fetching emergency stats:",e),e}},createEmergency:async e=>{try{return{id:(await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"emergencies"),(0,Ge.A)((0,Ge.A)({},e),{},{status:"active",triggeredAt:(0,Vt.O5)(),responseTime:0,actions:[]}))).id,success:!0}}catch(t){throw console.error("Error creating emergency:",t),t}},updateEmergencyStatus:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const r=(0,Vt.H9)(Fe.db,"emergencies",e),i=(0,Ge.A)({status:t,updatedAt:(0,Vt.O5)()},n);return"resolved"===t&&(i.resolvedAt=(0,Vt.O5)()),await(0,Vt.mZ)(r,i),{success:!0}}catch(r){throw console.error("Error updating emergency status:",r),r}},addEmergencyAction:async(e,t)=>{try{const n=(0,Vt.H9)(Fe.db,"emergencies",e),r=await getDoc(n);if(r.exists()){const e=r.data().actions||[],i=(0,Ge.A)((0,Ge.A)({},t),{},{timestamp:(0,Vt.O5)(),id:Date.now().toString()});return await(0,Vt.mZ)(n,{actions:[...e,i],updatedAt:(0,Vt.O5)()}),{success:!0}}throw new Error("Emergency not found")}catch(n){throw console.error("Error adding emergency action:",n),n}},getEmergencyProtocols:async()=>{try{const e=(0,Vt.P)((0,Vt.rJ)(Fe.db,"emergencyProtocols"),(0,Vt._M)("isActive","==",!0),(0,Vt.My)("name","asc")),t=await(0,Vt.GG)(e),n=[];return t.forEach(e=>{var t,r;n.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{createdAt:null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=e.data().updatedAt)||void 0===r?void 0:r.toDate()}))}),n}catch(e){throw console.error("Error fetching emergency protocols:",e),e}},createEmergencyProtocol:async e=>{try{return{id:(await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"emergencyProtocols"),(0,Ge.A)((0,Ge.A)({},e),{},{isActive:!0,createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}))).id,success:!0}}catch(t){throw console.error("Error creating emergency protocol:",t),t}},updateEmergencyProtocol:async(e,t)=>{try{const n=(0,Vt.H9)(Fe.db,"emergencyProtocols",e);return await(0,Vt.mZ)(n,(0,Ge.A)((0,Ge.A)({},t),{},{updatedAt:(0,Vt.O5)()})),{success:!0}}catch(n){throw console.error("Error updating emergency protocol:",n),n}},deleteEmergencyProtocol:async e=>{try{const t=(0,Vt.H9)(Fe.db,"emergencyProtocols",e);return await(0,Vt.kd)(t),{success:!0}}catch(t){throw console.error("Error deleting emergency protocol:",t),t}},getEmergencyHistory:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"emergencies"),(0,Vt.My)("triggeredAt","desc"));e.status&&(t=(0,Vt.P)(t,(0,Vt._M)("status","==",e.status))),e.severity&&(t=(0,Vt.P)(t,(0,Vt._M)("severity","==",e.severity))),e.limit&&(t=(0,Vt.P)(t,(0,Vt.AB)(e.limit)));const n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{var t,n;r.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{triggeredAt:null===(t=e.data().triggeredAt)||void 0===t?void 0:t.toDate(),resolvedAt:null===(n=e.data().resolvedAt)||void 0===n?void 0:n.toDate()}))}),r}catch(t){throw console.error("Error fetching emergency history:",t),t}},sendEmergencyNotification:async(e,t)=>{try{return console.log("Sending emergency notification:",(0,Ge.A)({emergencyId:e},t)),await hn.addEmergencyAction(e,{action:"Notification sent",description:"Notification sent to ".concat(t.recipients.join(", ")),performedBy:"System"}),{success:!0}}catch(n){throw console.error("Error sending emergency notification:",n),n}},getEmergencyAnalytics:async function(){try{const e=(0,Vt.P)((0,Vt.rJ)(Fe.db,"emergencies")),t=await(0,Vt.GG)(e),n={totalEmergencies:0,emergenciesByType:{},emergenciesBySeverity:{},responseTimeDistribution:[],monthlyTrends:{},topEmergencyTypes:[]};return t.forEach(e=>{const t=e.data();n.totalEmergencies++;const r=t.emergencyType||"Unknown";n.emergenciesByType[r]=(n.emergenciesByType[r]||0)+1;const i=t.severity||"Unknown";n.emergenciesBySeverity[i]=(n.emergenciesBySeverity[i]||0)+1,t.responseTime&&n.responseTimeDistribution.push(t.responseTime)}),n.topEmergencyTypes=Object.entries(n.emergenciesByType).sort((e,t)=>{let[,n]=e,[,r]=t;return r-n}).slice(0,5).map(e=>{let[t,n]=e;return{type:t,count:n}}),n}catch(e){throw Je.Ay.handleError(e,{context:"emergency_analytics"}),e}},processAlert:async e=>{try{et.A.warn("Processing emergency alert",{emergencyData:e});const t=await ln(e);return et.A.info("Emergency alert processed successfully",{emergencyId:t.data.id,status:t.data.status}),t.data}catch(t){throw Je.Ay.handleError(t,{context:"process_emergency_alert",emergencyData:e}),t}},coordinateResponse:async(e,t)=>{try{et.A.info("Coordinating emergency response",{emergencyId:e,responseData:t});const n=await dn((0,Ge.A)({emergencyId:e},t));return et.A.info("Emergency response coordinated successfully",{emergencyId:e,responseId:n.data.id}),n.data}catch(n){throw Je.Ay.handleError(n,{context:"coordinate_emergency_response",emergencyId:e,responseData:t}),n}},updateStatus:async(e,t,n)=>{try{et.A.info("Updating emergency status",{emergencyId:e,status:t,notes:n});const r=await un({emergencyId:e,status:t,notes:n});return et.A.info("Emergency status updated successfully",{emergencyId:e,newStatus:t}),r.data}catch(r){throw Je.Ay.handleError(r,{context:"update_emergency_status",emergencyId:e,status:t,notes:n}),r}}},pn=Ke("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),mn=Ke("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),fn=Ke("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),gn=Ke("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),vn=()=>{const{user:e}=(0,Be.useUser)(),n=ee(),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(null),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:(new Date).toISOString().split("T")[0],endDate:""});(0,t.useEffect)(()=>{(async()=>{if(null!==e&&void 0!==e&&e.uid)try{d(!0);const t=(await on.getMedications({patientId:e.uid})).map(e=>({id:e.id,name:e.name||"Unknown Medication",dosage:e.dosage||"N/A",frequency:e.frequency||"As needed",instructions:e.instructions||"No instructions",nextDose:e.nextDose?new Date(e.nextDose).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A",taken:!1,startDate:e.startDate?new Date(e.startDate).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0],endDate:e.endDate?new Date(e.endDate).toISOString().split("T")[0]:null,status:e.status||"active"}));c(t)}catch(t){console.error("Error fetching medications:",t),Pe.oR.error("Failed to load medications"),c([{id:"sample-1",name:"Sample Medication",dosage:"100mg",frequency:"Daily",instructions:"Take with food",nextDose:"8:00 AM",taken:!1,startDate:(new Date).toISOString().split("T")[0],endDate:null,status:"active"}])}finally{d(!1)}})()},[null===e||void 0===e?void 0:e.uid]);return(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medications"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage your medications and track doses"})]}),(0,Qe.jsxs)("button",{onClick:()=>i(!0),className:"btn btn-primary",children:[(0,Qe.jsx)(pn,{className:"h-4 w-4"}),"Add Medication"]})]}),r&&(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Medication"}),(0,Qe.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),null!==e&&void 0!==e&&e.uid)try{const t={patientId:e.uid,name:p.name,dosage:p.dosage,frequency:p.frequency,instructions:p.instructions,startDate:new Date(p.startDate),endDate:p.endDate?new Date(p.endDate):null,status:"active"},n=await on.createMedication(t);if(n.success){const e=(0,Ge.A)((0,Ge.A)({id:n.id},p),{},{nextDose:"8:00 AM",taken:!1,status:"active"});c([...o,e]),m({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:(new Date).toISOString().split("T")[0],endDate:""}),i(!1),Pe.oR.success("Medication added successfully!")}}catch(n){console.error("Error adding medication:",n),Pe.oR.error("Failed to add medication. Please try again.")}else Pe.oR.error("Please log in to add medications")},className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"form-label",children:"Medication Name"}),(0,Qe.jsx)("input",{type:"text",className:"form-input",value:p.name,onChange:e=>m((0,Ge.A)((0,Ge.A)({},p),{},{name:e.target.value})),required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"form-label",children:"Dosage"}),(0,Qe.jsx)("input",{type:"text",className:"form-input",value:p.dosage,onChange:e=>m((0,Ge.A)((0,Ge.A)({},p),{},{dosage:e.target.value})),required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"form-label",children:"Frequency"}),(0,Qe.jsxs)("select",{className:"form-input",value:p.frequency,onChange:e=>m((0,Ge.A)((0,Ge.A)({},p),{},{frequency:e.target.value})),children:[(0,Qe.jsx)("option",{value:"Daily",children:"Daily"}),(0,Qe.jsx)("option",{value:"Twice Daily",children:"Twice Daily"}),(0,Qe.jsx)("option",{value:"Weekly",children:"Weekly"}),(0,Qe.jsx)("option",{value:"As Needed",children:"As Needed"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"form-label",children:"Start Date"}),(0,Qe.jsx)("input",{type:"date",className:"form-input",value:p.startDate,onChange:e=>m((0,Ge.A)((0,Ge.A)({},p),{},{startDate:e.target.value})),required:!0})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"form-label",children:"Instructions"}),(0,Qe.jsx)("textarea",{className:"form-input form-textarea",value:p.instructions,onChange:e=>m((0,Ge.A)((0,Ge.A)({},p),{},{instructions:e.target.value})),placeholder:"e.g., Take with food, Take on empty stomach"})]}),(0,Qe.jsxs)("div",{className:"flex space-x-4",children:[(0,Qe.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Add Medication"}),(0,Qe.jsx)("button",{type:"button",onClick:()=>i(!1),className:"btn btn-outline",children:"Cancel"})]})]})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 gap-4",children:l?(0,Qe.jsxs)("div",{className:"text-center py-8",children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-2",children:"Loading medications..."})]}):0===o.length?(0,Qe.jsxs)("div",{className:"text-center py-8",children:[(0,Qe.jsx)(wt,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"No medications added yet"}),(0,Qe.jsx)("p",{className:"text-gray-500 text-sm",children:'Click "Add Medication" to get started'})]}):o.map(e=>(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(wt,{className:"h-8 w-8 text-blue-600 mr-4"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:[e.dosage," \u2022 ",e.frequency]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:e.instructions}),(0,Qe.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-400",children:[(0,Qe.jsx)(at,{className:"h-3 w-3 mr-1"}),"Started: ",e.startDate]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsxs)("div",{className:"text-right",children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Next Dose"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:e.nextDose}),(0,Qe.jsxs)("div",{className:"flex items-center mt-1",children:[e.taken?(0,Qe.jsx)(kt,{className:"h-4 w-4 text-green-500 mr-1"}):(0,Qe.jsx)(mn,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Qe.jsx)("span",{className:"text-xs text-gray-500",children:e.taken?"Taken":"Pending"})]})]}),(0,Qe.jsxs)("div",{className:"flex space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>{return t=e.id,c(o.map(e=>e.id===t?(0,Ge.A)((0,Ge.A)({},e),{},{taken:!e.taken}):e)),void Pe.oR.success("Medication status updated");var t},className:"btn ".concat(e.taken?"btn-outline":"btn-success"),children:e.taken?"Mark as Missed":"Mark as Taken"}),(0,Qe.jsx)("button",{onClick:()=>a(e),className:"btn btn-outline",children:(0,Qe.jsx)(fn,{className:"h-4 w-4"})}),(0,Qe.jsx)("button",{onClick:()=>{return t=e.id,c(o.filter(e=>e.id!==t)),void Pe.oR.success("Medication deleted successfully");var t},className:"btn btn-danger",children:(0,Qe.jsx)(gn,{className:"h-4 w-4"})})]})]})]})},e.id))}),!1,(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Need Help with Medications?"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Qe.jsxs)("button",{onClick:()=>n("/messages?topic=medication"),className:"flex items-center justify-center p-4 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:[(0,Qe.jsx)(lt,{className:"h-5 w-5 mr-2"}),"Message Caregiver"]}),(0,Qe.jsxs)("button",{onClick:()=>n("/telemedicine?type=medication-consult"),className:"flex items-center justify-center p-4 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors",children:[(0,Qe.jsx)(ft,{className:"h-5 w-5 mr-2"}),"Video Consultation"]}),(0,Qe.jsxs)("button",{onClick:()=>n("/appointments?type=medication-review"),className:"flex items-center justify-center p-4 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[(0,Qe.jsx)(at,{className:"h-5 w-5 mr-2"}),"Schedule Review"]})]}),(0,Qe.jsx)("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-start",children:[(0,Qe.jsx)(qe,{className:"h-5 w-5 text-yellow-600 mr-2 mt-0.5"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-yellow-800",children:"Important Reminders"}),(0,Qe.jsxs)("ul",{className:"text-sm text-yellow-700 mt-1 space-y-1",children:[(0,Qe.jsx)("li",{children:"\u2022 Always take medications as prescribed by your doctor"}),(0,Qe.jsx)("li",{children:"\u2022 Contact your caregiver if you experience side effects"}),(0,Qe.jsx)("li",{children:"\u2022 Never skip doses without consulting your healthcare provider"}),(0,Qe.jsx)("li",{children:"\u2022 Keep medications in a safe, dry place"})]})]})]})})]})]})},yn=Ke("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),_n=Ke("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),En=Ke("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),bn=()=>{const{user:e,userProfile:n}=(0,Be.useUser)(),[r,i]=(0,t.useState)({vitalType:"Blood Pressure",reading:"",notes:""}),[s,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{if(null!==e&&void 0!==e&&e.uid)try{d(!0);const t=await Xt(e.uid),n={};t.forEach(e=>{(!n[e.type]||new Date(e.recordedAt)>new Date(n[e.type].recordedAt))&&(n[e.type]=e)});const r=Object.values(n).map(e=>({id:e.id,type:e.type,value:e.value,unit:e.unit,timestamp:new Date(e.recordedAt).toLocaleString(),status:e.status||"Normal",statusColor:f(e.status||"Normal"),icon:u(e.type)}));a(r);const i=await Jt(e.uid),s=Object.keys(i).map(e=>({id:e,type:e,trend:i[e].trend||"Stable",trendColor:h(i[e].trend||"Stable"),average:i[e].average||"N/A",icon:u(e)}));c(s)}catch(t){console.error("Error fetching vital signs:",t),Pe.oR.error("Failed to load vital signs data")}finally{d(!1)}})()},[null===e||void 0===e?void 0:e.uid]);const u=e=>{switch(e.toLowerCase()){case"blood pressure":default:return ot;case"blood sugar":return yn}},h=e=>{switch(e.toLowerCase()){case"increasing":return"text-red-600";case"decreasing":case"improving":return"text-green-600";default:return"text-gray-600"}},p=e=>{switch(e){case"Blood Pressure":return"mmHg";case"Blood Sugar":return"mg/dL";case"Heart Rate":return"bpm";case"Temperature":return"\xb0F";case"Weight":return"lbs";case"Oxygen Saturation":return"%";case"Respiratory Rate":return"breaths/min";case"Pain Level":return"/10";default:return""}},m=(e,t)=>{const n=parseFloat(t);switch(e){case"Blood Pressure":return n>=140||n<=90?"Warning":"Normal";case"Blood Sugar":return n>=140||n<=70?"Warning":"Normal";case"Heart Rate":return n>=100||n<=60?"Warning":"Normal";case"Temperature":return n>=100.4||n<=97?"Warning":"Normal";case"Oxygen Saturation":return n<95?"Warning":"Normal";default:return"Normal"}},f=e=>{switch(e){case"Normal":return"bg-green-100 text-green-800";case"Warning":return"bg-yellow-100 text-yellow-800";case"Critical":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return l?(0,Qe.jsx)("div",{className:"space-y-8",children:(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,Qe.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading vital signs..."})]})})}):(0,Qe.jsxs)("div",{className:"space-y-8",children:[(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Qe.jsx)(ot,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Current Vitals"})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.length>0?s.map(e=>{const t=e.icon;return(0,Qe.jsxs)("div",{className:"p-6 border border-gray-200 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.type})]}),(0,Qe.jsx)("span",{className:"px-3 py-1 rounded text-sm font-medium ".concat(f(e.status)),children:e.status})]}),(0,Qe.jsxs)("div",{className:"mb-2",children:[(0,Qe.jsx)("span",{className:"text-3xl font-bold text-gray-900",children:e.value}),(0,Qe.jsx)("span",{className:"text-lg text-gray-600 ml-2",children:e.unit})]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:e.timestamp})]},e.id)}):(0,Qe.jsxs)("div",{className:"col-span-2 p-6 border border-gray-200 rounded-lg text-center",children:[(0,Qe.jsx)(ot,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Vital Signs Recorded"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Start recording your vital signs below to track your health."})]})})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Qe.jsx)(pn,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Record New Reading"})]}),(0,Qe.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),null!==e&&void 0!==e&&e.uid)if(r.reading.trim())try{const t={patientId:e.uid,patientName:(null===n||void 0===n?void 0:n.name)||(null===n||void 0===n?void 0:n.displayName)||(null===e||void 0===e?void 0:e.displayName)||"Patient",type:r.vitalType,value:r.reading,unit:p(r.vitalType),notes:r.notes,status:m(r.vitalType,r.reading)};await(async e=>{try{const t=(0,Vt.rJ)(Fe.db,Yt),n=(0,Ge.A)((0,Ge.A)({},e),{},{recordedAt:(0,Vt.O5)(),createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()});return(await(0,Vt.gS)(t,n)).id}catch(t){throw console.error("Error creating vital sign:",t),t}})(t),Pe.oR.success("Vital reading saved successfully!"),i({vitalType:"Blood Pressure",reading:"",notes:""});const s=await Xt(e.uid),o={};s.forEach(e=>{(!o[e.type]||new Date(e.recordedAt)>new Date(o[e.type].recordedAt))&&(o[e.type]=e)});const c=Object.values(o).map(e=>({id:e.id,type:e.type,value:e.value,unit:e.unit,timestamp:new Date(e.recordedAt).toLocaleString(),status:e.status||"Normal",statusColor:f(e.status||"Normal"),icon:u(e.type)}));a(c)}catch(s){console.error("Error saving vital sign:",s),Pe.oR.error("Failed to save vital reading. Please try again.")}else Pe.oR.error("Please enter a reading value");else Pe.oR.error("Please log in to record vital signs")},className:"space-y-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vital Type"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("select",{value:r.vitalType,onChange:e=>i((0,Ge.A)((0,Ge.A)({},r),{},{vitalType:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure","Blood Sugar","Heart Rate","Temperature","Weight","Oxygen Saturation","Respiratory Rate","Pain Level"].map(e=>(0,Qe.jsx)("option",{value:e,children:e},e))}),(0,Qe.jsx)(_n,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reading"}),(0,Qe.jsx)("input",{type:"text",value:r.reading,onChange:e=>i((0,Ge.A)((0,Ge.A)({},r),{},{reading:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., 120/80 or 98.6",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,Qe.jsx)("textarea",{value:r.notes,onChange:e=>i((0,Ge.A)((0,Ge.A)({},r),{},{notes:e.target.value})),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Any additional observations..."})]}),(0,Qe.jsx)("div",{className:"flex justify-end",children:(0,Qe.jsxs)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center hover:bg-blue-700 transition-colors",children:[(0,Qe.jsx)(pn,{className:"h-5 w-5 mr-2"}),"Save Reading"]})})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Qe.jsx)(En,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Health Trends (Last 7 Days)"})]}),(0,Qe.jsx)("div",{className:"space-y-4",children:o.length>0?o.map(e=>{const t=e.icon;return(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"font-semibold text-gray-900",children:e.type}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium ".concat(e.trendColor),children:e.trend}),(0,Qe.jsxs)("span",{className:"text-sm text-gray-500",children:["Avg: ",e.average]})]})]})]}),(0,Qe.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"View Details"})]},e.id)}):(0,Qe.jsxs)("div",{className:"p-6 border border-gray-200 rounded-lg text-center",children:[(0,Qe.jsx)(En,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Trends Available"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Record more vital signs to see health trends over time."})]})})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Share with Your Care Team"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/messages?topic=vital-signs",className:"flex items-center justify-center p-4 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:[(0,Qe.jsx)(lt,{className:"h-5 w-5 mr-2"}),"Share with Caregiver"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/telemedicine?type=health-review",className:"flex items-center justify-center p-4 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors",children:[(0,Qe.jsx)(St,{className:"h-5 w-5 mr-2"}),"Doctor Review"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/appointments?type=health-checkup",className:"flex items-center justify-center p-4 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[(0,Qe.jsx)(at,{className:"h-5 w-5 mr-2"}),"Schedule Checkup"]}),(0,Qe.jsxs)("button",{onClick:()=>{const e=s.map(e=>"".concat(e.type,": ").concat(e.value," ").concat(e.unit||"")).join("\n");navigator.share?navigator.share({title:"My Vital Signs",text:e}):navigator.clipboard.writeText(e).then(()=>Pe.oR.success("Vital signs copied to clipboard"))},className:"flex items-center justify-center p-4 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition-colors",children:[(0,Qe.jsx)(xt,{className:"h-5 w-5 mr-2"}),"Export Data"]})]})]})]})},xn=Ke("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),wn={getCaregivers:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t;t=e.status?(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregivers"),(0,Vt._M)("status","==",e.status),(0,Vt.My)("joinDate","asc")):(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregivers"),(0,Vt.My)("joinDate","desc")),e.location&&!e.status&&(t=(0,Vt.P)(t,(0,Vt._M)("location","==",e.location))),e.specialization&&!e.status&&(t=(0,Vt.P)(t,(0,Vt._M)("specializations","array-contains",e.specialization))),e.limit&&(t=(0,Vt.P)(t,(0,Vt.AB)(e.limit)));const n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{var t,n,i,s;r.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{joinDate:null===(t=e.data().joinDate)||void 0===t?void 0:t.toDate(),lastActive:null===(n=e.data().lastActive)||void 0===n?void 0:n.toDate(),createdAt:null===(i=e.data().createdAt)||void 0===i?void 0:i.toDate(),updatedAt:null===(s=e.data().updatedAt)||void 0===s?void 0:s.toDate()}))}),r}catch(t){throw console.error("Error fetching caregivers:",t),t}},getCaregiverById:async e=>{try{const s=(0,Vt.H9)(Fe.db,"caregivers",e),a=await(0,Vt.x7)(s);var t,n,r,i;if(a.exists())return(0,Ge.A)((0,Ge.A)({id:a.id},a.data()),{},{joinDate:null===(t=a.data().joinDate)||void 0===t?void 0:t.toDate(),lastActive:null===(n=a.data().lastActive)||void 0===n?void 0:n.toDate(),createdAt:null===(r=a.data().createdAt)||void 0===r?void 0:r.toDate(),updatedAt:null===(i=a.data().updatedAt)||void 0===i?void 0:i.toDate()});throw new Error("Caregiver not found")}catch(s){throw console.error("Error fetching caregiver:",s),s}},createCaregiver:async e=>{try{return{id:(await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"caregivers"),(0,Ge.A)((0,Ge.A)({},e),{},{status:"pending",rating:0,totalPatients:0,currentPatients:0,performance:{punctuality:0,patientSatisfaction:0,taskCompletion:0,communication:0,safety:0},earnings:{thisMonth:0,lastMonth:0,total:0},createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}))).id,success:!0}}catch(t){throw console.error("Error creating caregiver:",t),t}},updateCaregiver:async(e,t)=>{try{const n=(0,Vt.H9)(Fe.db,"caregivers",e);return await(0,Vt.mZ)(n,(0,Ge.A)((0,Ge.A)({},t),{},{updatedAt:(0,Vt.O5)()})),{success:!0}}catch(n){throw console.error("Error updating caregiver:",n),n}},deleteCaregiver:async e=>{try{const t=(0,Vt.H9)(Fe.db,"caregivers",e);return await(0,Vt.kd)(t),{success:!0}}catch(t){throw console.error("Error deleting caregiver:",t),t}},assignCaregiverToPatient:async(e,t,n)=>{try{const r=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"caregiverAssignments"),(0,Ge.A)((0,Ge.A)({caregiverId:e,patientId:t},n),{},{status:"active",assignedAt:(0,Vt.O5)(),createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}));return await wn.updateCaregiver(e,{currentPatients:await wn.getCurrentPatientCount(e)+1}),{id:r.id,success:!0}}catch(r){throw console.error("Error assigning caregiver to patient:",r),r}},removeCaregiverFromPatient:async(e,t,n)=>{try{const r=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregiverAssignments"),(0,Vt._M)("caregiverId","==",e),(0,Vt._M)("patientId","==",t),(0,Vt._M)("status","==","active")),i=await(0,Vt.GG)(r);if(!i.empty){const t=i.docs[0];return await(0,Vt.mZ)(t.ref,{status:"inactive",endDate:(0,Vt.O5)(),reason:n,updatedAt:(0,Vt.O5)()}),await wn.updateCaregiver(e,{currentPatients:await wn.getCurrentPatientCount(e)-1}),{success:!0}}throw new Error("Assignment not found")}catch(r){throw console.error("Error removing caregiver from patient:",r),r}},getCaregiverAssignments:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregiverAssignments"),(0,Vt._M)("caregiverId","==",e),(0,Vt.My)("assignedAt","desc"));t.status&&(n=(0,Vt.P)(n,(0,Vt._M)("status","==",t.status))),t.limit&&(n=(0,Vt.P)(n,(0,Vt.AB)(t.limit)));const r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s;i.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{assignedAt:null===(t=e.data().assignedAt)||void 0===t?void 0:t.toDate(),endDate:null===(n=e.data().endDate)||void 0===n?void 0:n.toDate(),createdAt:null===(r=e.data().createdAt)||void 0===r?void 0:r.toDate(),updatedAt:null===(s=e.data().updatedAt)||void 0===s?void 0:s.toDate()}))}),i}catch(n){throw console.error("Error fetching caregiver assignments:",n),n}},recordPerformance:async(e,t)=>{try{const n=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"caregiverPerformance"),(0,Ge.A)((0,Ge.A)({caregiverId:e},t),{},{recordedAt:(0,Vt.O5)()}));return await wn.updateCaregiverPerformance(e),{id:n.id,success:!0}}catch(n){throw console.error("Error recording performance:",n),n}},updateCaregiverPerformance:async e=>{try{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregiverPerformance"),(0,Vt._M)("caregiverId","==",e),(0,Vt.My)("recordedAt","desc"),(0,Vt.AB)(30)),n=await(0,Vt.GG)(t);if(n.empty)return;let r=0,i=0,s=0,a=0,o=0,c=0;n.forEach(e=>{const t=e.data();r+=t.punctuality||0,i+=t.patientSatisfaction||0,s+=t.taskCompletion||0,a+=t.communication||0,o+=t.safety||0,c++});const l={punctuality:Math.round(r/c),patientSatisfaction:Math.round(i/c*10)/10,taskCompletion:Math.round(s/c),communication:Math.round(a/c*10)/10,safety:Math.round(o/c)};return await wn.updateCaregiver(e,{performance:l}),l}catch(t){throw console.error("Error updating caregiver performance:",t),t}},getCaregiverSchedule:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregiverSchedule"),(0,Vt._M)("caregiverId","==",e),(0,Vt.My)("scheduledDate","asc"));t.startDate&&t.endDate&&(n=(0,Vt.P)(n,(0,Vt._M)("scheduledDate",">=",t.startDate),(0,Vt._M)("scheduledDate","<=",t.endDate)));const r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s,a;i.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{scheduledDate:null===(t=e.data().scheduledDate)||void 0===t?void 0:t.toDate(),startTime:null===(n=e.data().startTime)||void 0===n?void 0:n.toDate(),endTime:null===(r=e.data().endTime)||void 0===r?void 0:r.toDate(),createdAt:null===(s=e.data().createdAt)||void 0===s?void 0:s.toDate(),updatedAt:null===(a=e.data().updatedAt)||void 0===a?void 0:a.toDate()}))}),i}catch(n){throw console.error("Error fetching caregiver schedule:",n),n}},clockInOut:async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{const i=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"caregiverClockRecords"),{caregiverId:e,scheduleId:t,action:n,location:r,timestamp:(0,Vt.O5)()}),s=(0,Vt.H9)(Fe.db,"caregiverSchedule",t),a={updatedAt:(0,Vt.O5)()};return"clock_in"===n?(a.status="in_progress",a.actualStartTime=(0,Vt.O5)()):"clock_out"===n&&(a.status="completed",a.actualEndTime=(0,Vt.O5)()),await(0,Vt.mZ)(s,a),{id:i.id,success:!0}}catch(i){throw console.error("Error recording clock in/out:",i),i}},getCaregiverEarnings:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregiverEarnings"),(0,Vt._M)("caregiverId","==",e),(0,Vt.My)("earnedDate","desc"));t.startDate&&t.endDate&&(n=(0,Vt.P)(n,(0,Vt._M)("earnedDate",">=",t.startDate),(0,Vt._M)("earnedDate","<=",t.endDate)));const r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n;i.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{earnedDate:null===(t=e.data().earnedDate)||void 0===t?void 0:t.toDate(),createdAt:null===(n=e.data().createdAt)||void 0===n?void 0:n.toDate()}))}),i}catch(n){throw console.error("Error fetching caregiver earnings:",n),n}},getCaregiverAnalytics:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n={totalHours:0,totalEarnings:0,averageRating:0,taskCompletionRate:0,punctualityRate:0,patientSatisfaction:0},r=await wn.getCaregiverSchedule(e,t);n.totalHours=r.reduce((e,t)=>{if(t.actualStartTime&&t.actualEndTime){const n=t.actualStartTime.toDate();return e+(t.actualEndTime.toDate()-n)/36e5}return e},0);const i=await wn.getCaregiverEarnings(e,t);n.totalEarnings=i.reduce((e,t)=>e+t.amount,0);const s=await wn.getCaregiverById(e);return n.averageRating=s.rating,n.taskCompletionRate=s.performance.taskCompletion,n.punctualityRate=s.performance.punctuality,n.patientSatisfaction=s.performance.patientSatisfaction,n}catch(n){throw console.error("Error fetching caregiver analytics:",n),n}},getCurrentPatientCount:async e=>{try{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregiverAssignments"),(0,Vt._M)("caregiverId","==",e),(0,Vt._M)("status","==","active"));return(await(0,Vt.GG)(t)).size}catch(t){return console.error("Error getting current patient count:",t),0}},subscribeToCaregivers:e=>{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregivers"),(0,Vt.My)("updatedAt","desc"));return(0,Vt.aQ)(t,t=>{const n=[];t.forEach(e=>{var t,r,i,s;n.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{joinDate:null===(t=e.data().joinDate)||void 0===t?void 0:t.toDate(),lastActive:null===(r=e.data().lastActive)||void 0===r?void 0:r.toDate(),createdAt:null===(i=e.data().createdAt)||void 0===i?void 0:i.toDate(),updatedAt:null===(s=e.data().updatedAt)||void 0===s?void 0:s.toDate()}))}),e(n)})},subscribeToCaregiverAssignments:(e,t)=>{const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"caregiverAssignments"),(0,Vt._M)("caregiverId","==",e),(0,Vt.My)("assignedAt","desc"));return(0,Vt.aQ)(n,e=>{const n=[];e.forEach(e=>{var t,r,i,s;n.push((0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{assignedAt:null===(t=e.data().assignedAt)||void 0===t?void 0:t.toDate(),endDate:null===(r=e.data().endDate)||void 0===r?void 0:r.toDate(),createdAt:null===(i=e.data().createdAt)||void 0===i?void 0:i.toDate(),updatedAt:null===(s=e.data().updatedAt)||void 0===s?void 0:s.toDate()}))}),t(n)})}},Sn=()=>{const{user:e,userProfile:n}=(0,Be.useUser)(),[r,i]=(0,t.useState)("immediate"),[s,a]=(0,t.useState)({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""}),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)([]),[u,h]=(0,t.useState)(!0),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{if(null!==e&&void 0!==e&&e.uid)try{h(!0);const t=await wn.getCaregivers({status:"active",limit:10});c(t.map(e=>{var t;return{id:e.id,name:e.name||e.displayName||"Caregiver",specialty:(null===(t=e.specializations)||void 0===t?void 0:t[0])||"General Care",rating:e.rating||4.5,location:e.location||"Lagos, Nigeria",status:"active"===e.status?"Available":"Busy",visits:e.totalPatients||0,avatar:e.avatar||null}}));const n=await zt(e.uid);d(n.slice(0,5).map(e=>({id:e.id,title:e.careType||e.title||"Care Request",assignedCaregiver:e.caregiverName||"Caregiver not assigned yet",createdDate:e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown",scheduledDate:e.scheduledTime?new Date(e.scheduledTime).toLocaleString():null,description:e.notes||e.description||"No description provided",status:"scheduled"===e.status?"Scheduled":"completed"===e.status?"Completed":"cancelled"===e.status?"Cancelled":"Pending",priority:e.priority||"Medium"})))}catch(t){console.error("Error fetching appointments data:",t),Pe.oR.error("Failed to load appointments data")}finally{h(!1)}})()},[null===e||void 0===e?void 0:e.uid]);const f=e=>{switch(e){case"Available":case"Completed":return"bg-green-100 text-green-800";case"Busy":default:return"bg-gray-100 text-gray-800";case"In Progress":case"Scheduled":return"bg-blue-100 text-blue-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Cancelled":return"bg-red-100 text-red-800"}},g=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-orange-100 text-orange-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return u?(0,Qe.jsx)("div",{className:"space-y-8",children:(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,Qe.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading appointments..."})]})})}):(0,Qe.jsxs)("div",{className:"space-y-8",children:[(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Qe.jsx)(St,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Request Care Service"})]}),(0,Qe.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,Qe.jsxs)("button",{onClick:()=>i("immediate"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("immediate"===r?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Qe.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-current flex items-center justify-center mr-3",children:(0,Qe.jsx)("span",{className:"text-xs font-bold",children:"!"})}),"Need Care Now"]}),(0,Qe.jsxs)("button",{onClick:()=>i("scheduled"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("scheduled"===r?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Qe.jsx)(at,{className:"h-5 w-5 mr-3"}),"Schedule Visit"]})]}),(0,Qe.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),null!==e&&void 0!==e&&e.uid){if(!p){if("scheduled"===r){if(!s.preferredDate)return void Pe.oR.error("Please select a preferred date");if(!s.preferredTime)return void Pe.oR.error("Please select a preferred time");if(new Date("".concat(s.preferredDate,"T").concat(s.preferredTime))<=new Date)return void Pe.oR.error("Please select a future date and time")}m(!0);try{console.log("Starting appointment creation...",{careType:r,formData:s,user:null===e||void 0===e?void 0:e.uid});const t={patientId:e.uid,patientName:(null===n||void 0===n?void 0:n.name)||(null===n||void 0===n?void 0:n.displayName)||(null===e||void 0===e?void 0:e.displayName)||"Patient",careType:s.careType,notes:s.additionalNotes,priority:"immediate"===r?"high":"medium",status:"pending"};if("scheduled"===r&&s.preferredDate&&s.preferredTime){const e=new Date("".concat(s.preferredDate,"T").concat(s.preferredTime));t.scheduledTime=e,t.status="scheduled",console.log("Scheduled appointment data:",{scheduledDateTime:e,appointmentData:t})}console.log("Creating appointment with data:",t);const i=await(async e=>{try{const t=(0,Vt.rJ)(Fe.db,Wt),n=(0,Ge.A)((0,Ge.A)({},e),{},{status:"scheduled",createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()});return(await(0,Vt.gS)(t,n)).id}catch(t){throw console.error("Error creating appointment:",t),t}})(t);console.log("Appointment created successfully:",i),Pe.oR.success("immediate"===r?"Immediate care request submitted!":"Care visit scheduled successfully!"),a({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""});const o=await zt(e.uid);d(o.slice(0,5).map(e=>({id:e.id,title:e.careType||e.title||"Care Request",assignedCaregiver:e.caregiverName||"Caregiver not assigned yet",createdDate:e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown",scheduledDate:e.scheduledTime?new Date(e.scheduledTime).toLocaleString():null,description:e.notes||e.description||"No description provided",status:"scheduled"===e.status?"Scheduled":"completed"===e.status?"Completed":"cancelled"===e.status?"Cancelled":"Pending",priority:e.priority||"Medium"})))}catch(i){console.error("Error creating appointment:",i),Pe.oR.error("Failed to submit care request. Please try again.")}finally{m(!1)}}}else Pe.oR.error("Please log in to request care")},className:"space-y-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type of Care Needed"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("select",{value:s.careType,onChange:e=>a((0,Ge.A)((0,Ge.A)({},s),{},{careType:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure Check","Medication Administration","Wound Care","Physical Therapy","Vital Signs Monitoring","Meal Preparation","Companionship","Transportation","Housekeeping","Emergency Response"].map(e=>(0,Qe.jsx)("option",{value:e,children:e},e))}),(0,Qe.jsx)(_n,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),"scheduled"===r&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Date"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("input",{type:"date",value:s.preferredDate,onChange:e=>a((0,Ge.A)((0,Ge.A)({},s),{},{preferredDate:e.target.value})),min:(new Date).toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"mm/dd/yyyy"}),(0,Qe.jsx)(at,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Time"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("input",{type:"time",value:s.preferredTime,onChange:e=>a((0,Ge.A)((0,Ge.A)({},s),{},{preferredTime:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"--:--"}),(0,Qe.jsx)(Ot,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("textarea",{value:s.additionalNotes,onChange:e=>a((0,Ge.A)((0,Ge.A)({},s),{},{additionalNotes:e.target.value})),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Please describe your symptoms or specific care needs..."}),(0,Qe.jsx)(xn,{className:"absolute bottom-3 right-3 h-4 w-4 text-gray-400"})]})]}),(0,Qe.jsx)("button",{type:"submit",disabled:p,className:"w-full py-4 px-6 rounded-lg font-semibold text-lg transition-colors ".concat(p?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"," text-white"),children:p?(0,Qe.jsxs)("div",{className:"flex items-center justify-center",children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Submitting..."]}):"immediate"===r?"Request Immediate Care":"Schedule Care Visit"})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Qe.jsx)(ft,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Caregivers Nearby"})]}),(0,Qe.jsx)("div",{className:"space-y-4",children:o.map(e=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:e.specialty}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Lt,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-600",children:e.rating})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(jt,{className:"h-4 w-4 text-gray-400 mr-1"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-600",children:e.location})]})]})]})]}),(0,Qe.jsxs)("div",{className:"text-right",children:[(0,Qe.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(f(e.status)),children:e.status}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e.visits," visits"]})]})]},e.id))})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Recent Care Requests"}),(0,Qe.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,Qe.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:e.title}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.assignedCaregiver}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-2",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-4 w-4 mr-1"}),(0,Qe.jsx)("span",{children:e.createdDate})]}),e.scheduledDate&&(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(at,{className:"h-4 w-4 mr-1"}),(0,Qe.jsx)("span",{children:e.scheduledDate})]})]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,Qe.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(f(e.status)),children:e.status}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(g(e.priority)),children:e.priority})]})]})},e.id))})]})]})},Tn=Ke("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Nn=Ke("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Cn=Ke("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),An=Ke("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Rn=e=>{var n,r;let{files:i=[],onRemove:s,canRemove:a=!1}=e;const[o,c]=(0,t.useState)(null),l=e=>{var t,n;return null!==(t=e.type)&&void 0!==t&&t.startsWith("image/")?(0,Qe.jsx)(Nn,{className:"h-4 w-4 text-blue-500"}):"application/pdf"===e.type||null!==(n=e.name)&&void 0!==n&&n.toLowerCase().endsWith(".pdf")?(0,Qe.jsx)(xt,{className:"h-4 w-4 text-red-500"}):(0,Qe.jsx)(Cn,{className:"h-4 w-4 text-gray-500"})},d=e=>{if(!e)return"Unknown size";if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},u=e=>{e.downloadURL&&window.open(e.downloadURL,"_blank")};return i&&0!==i.length?(0,Qe.jsxs)("div",{className:"space-y-2",children:[i.map((e,t)=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-3",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[l(e),(0,Qe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,Qe.jsxs)("p",{className:"text-xs text-gray-500",children:[d(e.size),e.uploadedAt&&(0,Qe.jsxs)("span",{children:[" \u2022 ",new Date(e.uploadedAt).toLocaleDateString()]})]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>(e=>{var t,n;null!==(t=e.type)&&void 0!==t&&t.startsWith("image/")||null!==(n=e.name)&&void 0!==n&&n.toLowerCase().endsWith(".pdf")?c(e):u(e)})(e),className:"text-gray-400 hover:text-blue-500 transition-colors",title:"View file",children:(0,Qe.jsx)(Bt,{className:"h-4 w-4"})}),(0,Qe.jsx)("button",{onClick:()=>u(e),className:"text-gray-400 hover:text-green-500 transition-colors",title:"Download file",children:(0,Qe.jsx)(An,{className:"h-4 w-4"})}),a&&s&&(0,Qe.jsx)("button",{onClick:()=>s(t),className:"text-gray-400 hover:text-red-500 transition-colors",title:"Remove file",children:(0,Qe.jsx)(ut,{className:"h-4 w-4"})})]})]},t)),o&&(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl max-h-full overflow-hidden",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:o.name}),(0,Qe.jsx)("button",{onClick:()=>{c(null)},className:"text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(ut,{className:"h-6 w-6"})})]}),(0,Qe.jsx)("div",{className:"p-4 max-h-96 overflow-auto",children:null!==(n=o.type)&&void 0!==n&&n.startsWith("image/")?(0,Qe.jsx)("img",{src:o.downloadURL,alt:o.name,className:"max-w-full h-auto mx-auto"}):null!==(r=o.name)&&void 0!==r&&r.toLowerCase().endsWith(".pdf")?(0,Qe.jsx)("iframe",{src:o.downloadURL,className:"w-full h-96 border-0",title:o.name}):(0,Qe.jsxs)("div",{className:"text-center py-8",children:[(0,Qe.jsx)(Cn,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Preview not available for this file type"}),(0,Qe.jsx)("button",{onClick:()=>u(o),className:"mt-4 btn btn-primary",children:"Download File"})]})})]})})]}):(0,Qe.jsxs)("div",{className:"text-center text-gray-500 py-4",children:[(0,Qe.jsx)(Cn,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),(0,Qe.jsx)("p",{className:"text-sm",children:"No files uploaded"})]})},In=()=>{const{user:e,userProfile:t}=(0,Be.useUser)();return(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage your personal and medical information"})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Personal Information"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(ft,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Full Name"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(null===t||void 0===t?void 0:t.name)||(null===t||void 0===t?void 0:t.displayName)||(null===e||void 0===e?void 0:e.displayName)||"Not provided"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Tn,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(null===e||void 0===e?void 0:e.email)||"Not provided"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(at,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Date of Birth"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(n=null===t||void 0===t?void 0:t.dateOfBirth,n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not provided")}),(null===t||void 0===t?void 0:t.dateOfBirth)&&(0,Qe.jsxs)("p",{className:"text-sm text-gray-500",children:["Age: ",(e=>{if(!e)return null;const t=new Date,n=new Date(e);let r=t.getFullYear()-n.getFullYear();const i=t.getMonth()-n.getMonth();return(i<0||0===i&&t.getDate()<n.getDate())&&r--,r})(t.dateOfBirth)," years"]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Rt,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Account Type"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900 capitalize",children:(null===t||void 0===t?void 0:t.userType)||"elderly"})]})]})]}),(0,Qe.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Personal Info"})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medical Information"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Primary Care Doctor"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(null===t||void 0===t?void 0:t.primaryCareDoctor)||"Not provided"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Allergies"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(null===t||void 0===t?void 0:t.allergies)||"None listed"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Medical Conditions"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(null===t||void 0===t?void 0:t.medicalConditions)||"None listed"})]})]}),(0,Qe.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Medical Info"}),(null===t||void 0===t?void 0:t.medicalDocuments)&&t.medicalDocuments.length>0&&(0,Qe.jsxs)("div",{className:"mt-4",children:[(0,Qe.jsxs)("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[(0,Qe.jsx)(xt,{className:"h-4 w-4 mr-2"}),"Medical Documents"]}),(0,Qe.jsx)(Rn,{files:t.medicalDocuments})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Emergency Contact"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(ft,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Name"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(null===t||void 0===t?void 0:t.emergencyContactName)||"Not provided"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Et,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,Qe.jsx)("p",{className:"font-medium text-gray-900",children:(null===t||void 0===t?void 0:t.emergencyContactPhone)||"Not provided"})]})]})]}),(0,Qe.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Emergency Contact"})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Health Summary"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Active Medications"}),(0,Qe.jsx)("span",{className:"font-semibold text-gray-900",children:"5"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Upcoming Appointments"}),(0,Qe.jsx)("span",{className:"font-semibold text-gray-900",children:"2"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Vital Signs This Week"}),(0,Qe.jsx)("span",{className:"font-semibold text-gray-900",children:"12"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Medication Adherence"}),(0,Qe.jsx)("span",{className:"font-semibold text-green-600",children:"95%"})]})]}),(0,Qe.jsxs)("button",{className:"btn btn-primary mt-4",children:[(0,Qe.jsx)(ot,{className:"h-4 w-4 mr-2"}),"View Health Reports"]})]}),(null===t||void 0===t?void 0:t.medicationDocuments)&&t.medicationDocuments.length>0&&(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medication Documents"}),(0,Qe.jsx)(Rn,{files:t.medicationDocuments})]})]})]});var n},On=Ke("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]),Pn=Ke("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]),kn=Ke("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]),Dn=Ke("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Ln=()=>{const{userProfile:e}=(0,Be.useUser)(),[n,r]=(0,t.useState)(null),[i,s]=(0,t.useState)([]),[a,o]=(0,t.useState)([]),[c,l]=(0,t.useState)({}),[d,u]=(0,t.useState)(!0),h=(()=>{const t=(null===e||void 0===e?void 0:e.medicalQualification)||"Caregiver (Non-Medical)";return{"Doctor (MD)":{title:"Doctor Dashboard",icon:St,color:"blue",features:["consultations","prescriptions","diagnostics","referrals","telemedicine"],quickActions:[{name:"New Consultation",icon:St,href:"/service-provider/consultations"},{name:"Write Prescription",icon:wt,href:"/service-provider/prescriptions"},{name:"Review Lab Results",icon:On,href:"/service-provider/diagnostics"},{name:"Video Consultation",icon:Ct,href:"/service-provider/calls"}]},"Nurse (RN)":{title:"Nurse Dashboard",icon:ot,color:"red",features:["patient-care","medications","vital-signs","care-plans"],quickActions:[{name:"Patient Rounds",icon:ft,href:"/service-provider/patients"},{name:"Medication Admin",icon:wt,href:"/service-provider/prescriptions"},{name:"Vital Signs",icon:Tt,href:"/service-provider/diagnostics"},{name:"Care Plans",icon:xt,href:"/service-provider/care-logs"}]},Physiotherapist:{title:"Physiotherapy Dashboard",icon:Pn,color:"green",features:["therapy-sessions","exercise-plans","progress-tracking"],quickActions:[{name:"Therapy Sessions",icon:Pn,href:"/service-provider/activities"},{name:"Exercise Plans",icon:xt,href:"/service-provider/care-logs"},{name:"Progress Notes",icon:En,href:"/service-provider/patients"},{name:"Schedule Session",icon:at,href:"/service-provider/schedule"}]},Psychologist:{title:"Psychology Dashboard",icon:kn,color:"purple",features:["therapy-sessions","assessments","treatment-plans"],quickActions:[{name:"Therapy Sessions",icon:kn,href:"/service-provider/consultations"},{name:"Assessments",icon:xt,href:"/service-provider/diagnostics"},{name:"Treatment Plans",icon:ot,href:"/service-provider/care-logs"},{name:"Video Therapy",icon:Ct,href:"/service-provider/calls"}]},Pharmacist:{title:"Pharmacist Dashboard",icon:wt,color:"indigo",features:["prescriptions","drug-interactions","medication-reviews"],quickActions:[{name:"Prescription Review",icon:wt,href:"/service-provider/prescriptions"},{name:"Drug Interactions",icon:qe,href:"/service-provider/diagnostics"},{name:"Medication Consult",icon:_t,href:"/service-provider/consultations"},{name:"Patient Education",icon:xt,href:"/service-provider/patients"}]},"Lab Technician":{title:"Lab Technician Dashboard",icon:On,color:"teal",features:["lab-results","specimen-collection","quality-control"],quickActions:[{name:"Lab Results",icon:On,href:"/service-provider/diagnostics"},{name:"Collection Schedule",icon:at,href:"/service-provider/schedule"},{name:"Quality Control",icon:Rt,href:"/service-provider/activities"},{name:"Patient Reports",icon:xt,href:"/service-provider/patients"}]}}[t]||{title:"Caregiver Dashboard",icon:At,color:"gray",features:["patient-care","basic-assistance","companionship"],quickActions:[{name:"Patient Care",icon:ft,href:"/service-provider/patients"},{name:"Daily Tasks",icon:kt,href:"/service-provider/tasks"},{name:"Messages",icon:_t,href:"/service-provider/messages"},{name:"Schedule",icon:at,href:"/service-provider/schedule"}]}})();(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e={id:1,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",profileImage:null,rating:4.8,totalPatients:8,currentPatients:3,experience:"5 years",joinDate:"2023-06-15",hourlyRate:2500,totalEarnings:21e5,thisMonthEarnings:18e4,performance:{punctuality:95,patientSatisfaction:4.8,taskCompletion:98,communication:4.7,safety:100}};r(e),s([{id:1,patientName:"Adunni Okafor",patientId:"ELD001",time:"09:00",duration:"8 hours",address:"123 Victoria Island, Lagos",tasks:["Morning medication administration","Breakfast preparation","Physical therapy exercises","Lunch preparation","Afternoon medication","Evening care routine"],status:"upcoming",notes:"Patient has diabetes - monitor blood sugar levels",emergencyContact:"+234 801 987 6543"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",time:"14:00",duration:"4 hours",address:"456 Ikoyi, Lagos",tasks:["Medication administration","Light housekeeping","Companionship","Evening meal preparation"],status:"upcoming",notes:"Patient prefers quiet environment",emergencyContact:"+234 803 456 7890"}]),o([{id:1,patientName:"Adunni Okafor",task:"Medication Administration",completedAt:"2024-01-20T08:30:00Z",status:"completed",notes:"Patient took medication without issues"},{id:2,patientName:"Grace Johnson",task:"Physical Therapy",completedAt:"2024-01-20T10:15:00Z",status:"completed",notes:"Completed 30 minutes of exercises"},{id:3,patientName:"Adunni Okafor",task:"Blood Sugar Check",completedAt:"2024-01-20T12:00:00Z",status:"completed",notes:"Blood sugar: 120 mg/dL - within normal range"}]),l(e.performance),u(!1)},1e3)}catch(e){console.error("Error loading caregiver data:",e),u(!1)}})()},[]);const p=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"upcoming":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return d?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"p-3 bg-".concat(h.color,"-100 rounded-full"),children:(0,Qe.jsx)(h.icon,{className:"h-8 w-8 text-".concat(h.color,"-600")})}),(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-white font-semibold text-lg",children:null===n||void 0===n?void 0:n.name.split(" ").map(e=>e[0]).join("")})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:h.title}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["Welcome, ",(null===e||void 0===e?void 0:e.name)||(null===n||void 0===n?void 0:n.name)]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:(null===e||void 0===e?void 0:e.medicalQualification)||"Healthcare Professional"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,Qe.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Qe.jsx)(mt,{className:"h-6 w-6"})}),(0,Qe.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Qe.jsx)(bt,{className:"h-6 w-6"})}),(0,Qe.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Qe.jsx)(ht,{className:"h-6 w-6"})})]})]})}),(0,Qe.jsx)("div",{className:"w-full p-8 dashboard-full-width",children:(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Quick Actions for ",(null===e||void 0===e?void 0:e.medicalQualification)||"Healthcare Professional"]}),(0,Qe.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:h.quickActions.map((e,t)=>(0,Qe.jsxs)("a",{href:e.href,className:"flex flex-col items-center p-4 rounded-lg border-2 border-gray-200 hover:border-".concat(h.color,"-300 hover:bg-").concat(h.color,"-50 transition-colors group"),children:[(0,Qe.jsx)(e.icon,{className:"h-8 w-8 text-".concat(h.color,"-600 mb-2 group-hover:text-").concat(h.color,"-700")}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700 text-center",children:e.name})]},t))})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:[(0,Qe.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Today's Visits"}),(0,Qe.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:i.length})]}),(0,Qe.jsx)("div",{className:"p-3 bg-blue-50 rounded-xl",children:(0,Qe.jsx)(at,{className:"h-8 w-8 text-blue-600"})})]})}),(0,Qe.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Completed Tasks"}),(0,Qe.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:a.filter(e=>"completed"===e.status).length})]}),(0,Qe.jsx)("div",{className:"p-3 bg-green-50 rounded-xl",children:(0,Qe.jsx)(kt,{className:"h-8 w-8 text-green-600"})})]})}),(0,Qe.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Rating"}),(0,Qe.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:null===n||void 0===n?void 0:n.rating})]}),(0,Qe.jsx)("div",{className:"p-3 bg-yellow-50 rounded-xl",children:(0,Qe.jsx)(Lt,{className:"h-8 w-8 text-yellow-600"})})]})}),(0,Qe.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"This Month"}),(0,Qe.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["\u20a6",null===n||void 0===n?void 0:n.thisMonthEarnings.toLocaleString()]})]}),(0,Qe.jsx)("div",{className:"p-3 bg-purple-50 rounded-xl",children:(0,Qe.jsx)(En,{className:"h-8 w-8 text-purple-600"})})]})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Qe.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Today's Schedule"})}),(0,Qe.jsx)("div",{className:"p-8",children:(0,Qe.jsx)("div",{className:"space-y-6",children:i.map(e=>(0,Qe.jsx)("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow",children:(0,Qe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,Qe.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:e.patientName}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(p(e.status)),children:e.status})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-5 w-5 mr-2 text-gray-500"}),(0,Qe.jsxs)("span",{className:"font-medium",children:[e.time," (",e.duration,")"]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(jt,{className:"h-5 w-5 mr-2 text-gray-500"}),(0,Qe.jsx)("span",{className:"font-medium",children:e.address})]})]}),(0,Qe.jsxs)("div",{className:"mb-4",children:[(0,Qe.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Tasks:"}),(0,Qe.jsx)("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:e.tasks.map((e,t)=>(0,Qe.jsxs)("li",{className:"flex items-center text-sm text-gray-600",children:[(0,Qe.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),e]},t))})]}),e.notes&&(0,Qe.jsxs)("div",{className:"mb-4",children:[(0,Qe.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Notes:"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:e.notes})]})]}),(0,Qe.jsxs)("div",{className:"flex flex-col space-y-3 ml-8",children:[(0,Qe.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock in for schedule:",t);var t},className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Clock In"}),(0,Qe.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock out for schedule:",t);var t},className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Clock Out"}),(0,Qe.jsxs)("button",{onClick:()=>{return t=e.patientId,void console.log("Emergency for patient:",t);var t},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium flex items-center justify-center",children:[(0,Qe.jsx)(qe,{className:"h-4 w-4 mr-2"}),"Emergency"]})]})]})},e.id))})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Qe.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Tasks"})}),(0,Qe.jsx)("div",{className:"p-8",children:(0,Qe.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-md transition-shadow",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"p-2 bg-green-50 rounded-lg",children:(0,Qe.jsx)(kt,{className:"h-6 w-6 text-green-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-base font-semibold text-gray-900",children:e.task}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:e.patientName}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.completedAt).toLocaleString()})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(p(e.status)),children:e.status}),(0,Qe.jsx)("button",{className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",children:(0,Qe.jsx)(Bt,{className:"h-5 w-5"})})]})]},e.id))})})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Qe.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Performance Overview"})}),(0,Qe.jsx)("div",{className:"p-8",children:(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Punctuality"}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Qe.jsx)("div",{className:"bg-green-600 h-3 rounded-full",style:{width:"".concat(c.punctuality,"%")}})}),(0,Qe.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[c.punctuality,"%"]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Task Completion"}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Qe.jsx)("div",{className:"bg-blue-600 h-3 rounded-full",style:{width:"".concat(c.taskCompletion,"%")}})}),(0,Qe.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[c.taskCompletion,"%"]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Patient Satisfaction"}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Lt,{className:"h-5 w-5 text-yellow-400 mr-2"}),(0,Qe.jsx)("span",{className:"text-lg font-bold text-gray-900",children:c.patientSatisfaction})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Communication"}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Lt,{className:"h-5 w-5 text-yellow-400 mr-2"}),(0,Qe.jsx)("span",{className:"text-lg font-bold text-gray-900",children:c.communication})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Safety Record"}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Qe.jsx)("div",{className:"bg-green-600 h-3 rounded-full",style:{width:"".concat(c.safety,"%")}})}),(0,Qe.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[c.safety,"%"]})]})]})]})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Qe.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Quick Actions"})}),(0,Qe.jsx)("div",{className:"p-8",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Qe.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Qe.jsx)(_t,{className:"h-8 w-8 text-blue-600 mb-3"}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Messages"})]}),(0,Qe.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Qe.jsx)(Ct,{className:"h-8 w-8 text-green-600 mb-3"}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Photo Update"})]}),(0,Qe.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Qe.jsx)(xt,{className:"h-8 w-8 text-purple-600 mb-3"}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Add Note"})]}),(0,Qe.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Qe.jsx)(Dn,{className:"h-8 w-8 text-orange-600 mb-3"}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Navigation"})]})]})})]})]})]})})]})},jn=Ke("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Mn=Ke("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Un=Ke("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Vn=Ke("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Fn="careTasks",Bn=async e=>{try{const t=new Date;t.setHours(0,0,0,0);const n=new Date(t);n.setDate(n.getDate()+1);const r=(0,Vt.rJ)(Fe.db,Fn),i=(0,Vt.P)(r,(0,Vt._M)("caregiverId","==",e),(0,Vt._M)("scheduledTime",">=",Vt.Dc.fromDate(t)),(0,Vt._M)("scheduledTime","<",Vt.Dc.fromDate(n)),(0,Vt.My)("scheduledTime","asc")),s=await(0,Vt.GG)(i),a=[];return s.forEach(e=>{var t,n,r,i,s,o,c,l;const d=e.data();a.push((0,Ge.A)((0,Ge.A)({id:e.id},d),{},{scheduledTime:(null===(t=d.scheduledTime)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||d.scheduledTime,completedAt:(null===(r=d.completedAt)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||d.completedAt,createdAt:(null===(s=d.createdAt)||void 0===s||null===(o=s.toDate)||void 0===o?void 0:o.call(s))||d.createdAt,updatedAt:(null===(c=d.updatedAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.updatedAt}))}),a}catch(t){throw console.error("Error fetching today's care tasks:",t),t}},Gn=async e=>{try{const t=(0,Vt.rJ)(Fe.db,Fn),n=(0,Vt.P)(t,(0,Vt._M)("caregiverId","==",e),(0,Vt._M)("status","==","pending"),(0,Vt.My)("scheduledTime","asc")),r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s,a,o,c,l;const d=e.data();i.push((0,Ge.A)((0,Ge.A)({id:e.id},d),{},{scheduledTime:(null===(t=d.scheduledTime)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||d.scheduledTime,completedAt:(null===(r=d.completedAt)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||d.completedAt,createdAt:(null===(a=d.createdAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.createdAt,updatedAt:(null===(c=d.updatedAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.updatedAt}))}),i}catch(t){throw console.error("Error fetching pending care tasks:",t),t}},Hn=()=>{const{userProfile:e,userRole:n}=(0,Be.useUser)(),[r,i]=(0,t.useState)(new Date),[s,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(new Date),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)({status:"all",priority:"all",type:"all"}),[_,E]=(0,t.useState)(null),[b,x]=(0,t.useState)({title:"",description:"",clientId:"",scheduledTime:"",priority:"medium",type:"care",estimatedDuration:60});(0,t.useEffect)(()=>{null!==e&&void 0!==e&&e.id&&w()},[u,null===e||void 0===e?void 0:e.id]);const w=async()=>{if(null!==e&&void 0!==e&&e.id)try{d(!0);const[t,r,i,s]=await Promise.all([Bn(e.id).catch(e=>(console.warn("Failed to fetch today's care tasks:",e),[])),Gn(e.id).catch(e=>(console.warn("Failed to fetch pending care tasks:",e),[])),Kt(e.id,n).catch(e=>(console.warn("Failed to fetch today's appointments:",e),[])),qt(e.id,n).catch(e=>(console.warn("Failed to fetch upcoming appointments:",e),[]))]),o=[...t,...r],l=[...i,...s];if(c(o),a(l),0===o.length&&0===l.length){a([{id:1,patientName:"Adunni Okafor",patientAge:72,patientAddress:"123 Victoria Island, Lagos",patientPhone:"+234 801 234 5678",appointmentTime:"09:00",duration:60,type:"Home Visit",status:"scheduled",tasks:["Medication administration","Vital signs check","Meal preparation","Light housekeeping"],notes:"Patient has diabetes, check blood sugar levels",priority:"high",estimatedTravelTime:25},{id:2,patientName:"Tunde Adebayo",patientAge:68,patientAddress:"456 Ikoyi, Lagos",patientPhone:"+234 802 345 6789",appointmentTime:"11:30",duration:90,type:"Home Visit",status:"scheduled",tasks:["Physical therapy exercises","Medication reminder","Grocery shopping","Companionship"],notes:"Patient recovering from hip surgery",priority:"medium",estimatedTravelTime:15},{id:3,patientName:"Grace Johnson",patientAge:75,patientAddress:"789 Lekki, Lagos",patientPhone:"+234 803 456 7890",appointmentTime:"14:00",duration:45,type:"Home Visit",status:"completed",tasks:["Medication administration","Vital signs check","Meal preparation"],notes:"Regular checkup visit",priority:"low",estimatedTravelTime:30}])}}catch(t){console.error("Error loading schedule data:",t),Pe.oR.error("Failed to load schedule data")}finally{d(!1)}},S=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{await async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{const r=(0,Vt.H9)(Fe.db,Fn,e);return await(0,Vt.mZ)(r,{status:"completed",completedAt:(0,Vt.O5)(),completionNotes:t,photos:n,updatedAt:(0,Vt.O5)()}),!0}catch(r){throw console.error("Error completing care task:",r),r}}(e,t),Pe.oR.success("Task completed successfully"),w()}catch(n){console.error("Error completing task:",n),Pe.oR.error("Failed to complete task")}},T=e=>{switch(e){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},N=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},C=e=>e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),A=e=>{const t=new Date(u);t.setDate(t.getDate()+e),h(t)};return l?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Today's Schedule"}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["Your appointments and tasks for ",C(u)]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsxs)("button",{onClick:()=>g(!f),className:"btn ".concat(f?"btn-primary":"btn-secondary"),children:[(0,Qe.jsx)(jn,{className:"h-4 w-4 mr-2"}),"Filter"]}),(0,Qe.jsxs)("button",{onClick:()=>m(!0),className:"btn btn-primary",children:[(0,Qe.jsx)(pn,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),f&&(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,Qe.jsxs)("select",{value:v.status,onChange:e=>y((0,Ge.A)((0,Ge.A)({},v),{},{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"all",children:"All Statuses"}),(0,Qe.jsx)("option",{value:"pending",children:"Pending"}),(0,Qe.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,Qe.jsx)("option",{value:"completed",children:"Completed"}),(0,Qe.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),(0,Qe.jsxs)("select",{value:v.priority,onChange:e=>y((0,Ge.A)((0,Ge.A)({},v),{},{priority:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"all",children:"All Priorities"}),(0,Qe.jsx)("option",{value:"high",children:"High Priority"}),(0,Qe.jsx)("option",{value:"medium",children:"Medium Priority"}),(0,Qe.jsx)("option",{value:"low",children:"Low Priority"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),(0,Qe.jsxs)("select",{value:v.type,onChange:e=>y((0,Ge.A)((0,Ge.A)({},v),{},{type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"all",children:"All Types"}),(0,Qe.jsx)("option",{value:"care",children:"Personal Care"}),(0,Qe.jsx)("option",{value:"medical",children:"Medical Care"}),(0,Qe.jsx)("option",{value:"household",children:"Household Tasks"}),(0,Qe.jsx)("option",{value:"social",children:"Social Activities"}),(0,Qe.jsx)("option",{value:"emergency",children:"Emergency"})]})]})]})}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("button",{onClick:()=>A(-1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Qe.jsx)(Mn,{className:"h-5 w-5"})}),(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:C(u)}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500",children:[s.filter(e=>"scheduled"===e.status).length," appointments scheduled"]})]}),(0,Qe.jsx)("button",{onClick:()=>A(1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Qe.jsx)(Un,{className:"h-5 w-5"})})]})}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Schedule Timeline"}),(0,Qe.jsx)("div",{className:"space-y-4",children:s.filter(e=>"scheduled"===e.status).sort((e,t)=>e.appointmentTime.localeCompare(t.appointmentTime)).map(e=>(0,Qe.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Qe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Qe.jsx)("div",{className:"flex-shrink-0",children:(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-green-600 font-medium",children:e.patientName.split(" ").map(e=>e[0]).join("")})})}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Qe.jsxs)("span",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge]}),(0,Qe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(T(e.priority)),children:[e.priority," priority"]}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(N(e.status)),children:e.status})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-4 w-4 mr-2"}),(0,Qe.jsxs)("span",{children:[e.appointmentTime," (",e.duration," minutes)"]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(jt,{className:"h-4 w-4 mr-2"}),(0,Qe.jsx)("span",{children:e.patientAddress})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Et,{className:"h-4 w-4 mr-2"}),(0,Qe.jsx)("span",{children:e.patientPhone})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Dn,{className:"h-4 w-4 mr-2"}),(0,Qe.jsxs)("span",{children:[e.estimatedTravelTime," min travel time"]})]})]}),(0,Qe.jsx)("div",{className:"mb-3",children:(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:e.notes})}),(0,Qe.jsxs)("div",{className:"mb-3",children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tasks:"}),(0,Qe.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tasks.map((e,t)=>(0,Qe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,Qe.jsx)(kt,{className:"h-3 w-3 mr-1"}),e]},t))})]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsxs)("button",{onClick:()=>window.open("https://maps.google.com/maps?q=".concat(encodeURIComponent(e.patientAddress)),"_blank"),className:"btn btn-secondary",children:[(0,Qe.jsx)(Dn,{className:"h-4 w-4 mr-2"}),"Navigate"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/calls?start=".concat(e.id),className:"btn btn-secondary",children:[(0,Qe.jsx)(Et,{className:"h-4 w-4 mr-2"}),"Call"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/messages?client=".concat(e.patientName),className:"btn btn-secondary",children:[(0,Qe.jsx)(_t,{className:"h-4 w-4 mr-2"}),"Message"]}),(0,Qe.jsxs)("button",{onClick:()=>S(e.id),className:"btn btn-primary",children:[(0,Qe.jsx)(kt,{className:"h-4 w-4 mr-2"}),"Complete"]})]})]})},e.id))})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Qe.jsx)(at,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>"scheduled"===e.status).length})]})]})}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Qe.jsx)(kt,{className:"h-6 w-6 text-green-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>"completed"===e.status).length})]})]})}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,Qe.jsx)(Ot,{className:"h-6 w-6 text-yellow-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Hours"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.reduce((e,t)=>e+t.duration,0)/60})]})]})}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,Qe.jsx)(qe,{className:"h-6 w-6 text-red-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"High Priority"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>"high"===e.priority).length})]})]})})]}),p&&(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Task"}),(0,Qe.jsx)("button",{onClick:()=>m(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(ut,{className:"h-5 w-5"})})]}),(0,Qe.jsxs)("div",{className:"p-6 space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Title *"}),(0,Qe.jsx)("input",{type:"text",value:b.title,onChange:e=>x((0,Ge.A)((0,Ge.A)({},b),{},{title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,Qe.jsx)("textarea",{value:b.description,onChange:e=>x((0,Ge.A)((0,Ge.A)({},b),{},{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Enter task description"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Time *"}),(0,Qe.jsx)("input",{type:"datetime-local",value:b.scheduledTime,onChange:e=>x((0,Ge.A)((0,Ge.A)({},b),{},{scheduledTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),(0,Qe.jsxs)("select",{value:b.priority,onChange:e=>x((0,Ge.A)((0,Ge.A)({},b),{},{priority:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"low",children:"Low"}),(0,Qe.jsx)("option",{value:"medium",children:"Medium"}),(0,Qe.jsx)("option",{value:"high",children:"High"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),(0,Qe.jsxs)("select",{value:b.type,onChange:e=>x((0,Ge.A)((0,Ge.A)({},b),{},{type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"care",children:"Personal Care"}),(0,Qe.jsx)("option",{value:"medical",children:"Medical Care"}),(0,Qe.jsx)("option",{value:"household",children:"Household Tasks"}),(0,Qe.jsx)("option",{value:"social",children:"Social Activities"}),(0,Qe.jsx)("option",{value:"emergency",children:"Emergency"})]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (minutes)"}),(0,Qe.jsx)("input",{type:"number",value:b.estimatedDuration,onChange:e=>x((0,Ge.A)((0,Ge.A)({},b),{},{estimatedDuration:parseInt(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"15",max:"480"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t",children:[(0,Qe.jsx)("button",{onClick:()=>m(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,Qe.jsxs)("button",{onClick:async()=>{try{if(!b.title||!b.scheduledTime)return void Pe.oR.error("Please fill in required fields");const t=(0,Ge.A)((0,Ge.A)({},b),{},{caregiverId:e.id,status:"pending",createdAt:new Date,scheduledTime:new Date(b.scheduledTime)});await(async e=>{try{const t=(0,Vt.rJ)(Fe.db,Fn),n=(0,Ge.A)((0,Ge.A)({},e),{},{status:"pending",createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()});return(await(0,Vt.gS)(t,n)).id}catch(t){throw console.error("Error creating care task:",t),t}})(t),Pe.oR.success("Task created successfully"),m(!1),x({title:"",description:"",clientId:"",scheduledTime:"",priority:"medium",type:"care",estimatedDuration:60}),w()}catch(t){console.error("Error creating task:",t),Pe.oR.error("Failed to create task")}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[(0,Qe.jsx)(Vn,{className:"h-4 w-4 mr-2"}),"Create Task"]})]})]})})]})},Wn=Ke("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),zn="patients",Kn=async e=>{try{const t=(0,Vt.rJ)(Fe.db,zn),n=(0,Vt.P)(t,(0,Vt._M)("assignedCaregiver","==",e),(0,Vt.My)("createdAt","desc")),r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s,a,o,c,l;const d=e.data();i.push((0,Ge.A)((0,Ge.A)({id:e.id},d),{},{dateOfBirth:(null===(t=d.dateOfBirth)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||d.dateOfBirth,createdAt:(null===(r=d.createdAt)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||d.createdAt,updatedAt:(null===(a=d.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.updatedAt,lastVisit:(null===(c=d.lastVisit)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.lastVisit}))}),i}catch(t){throw console.error("Error fetching patients by caregiver:",t),t}},qn=()=>{var e,n;const{userProfile:r,userRole:i}=(0,Be.useUser)(),[s,a]=(0,t.useState)([]),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("all"),[p,m]=(0,t.useState)(null),[f,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{null!==r&&void 0!==r&&r.id&&(async()=>{if(null!==r&&void 0!==r&&r.id)try{c(!0);const e=await Kn(r.id).catch(e=>(console.warn("Failed to fetch assigned patients:",e),[]));console.log("Loading assigned patients for caregiver ".concat(r.id,":"),e.length),a(e||[])}catch(e){console.error("Error loading patients:",e),Pe.oR.error("Failed to load patient data")}finally{c(!1)}})()},[null===r||void 0===r?void 0:r.id]);const _=s.filter(e=>{const t=e.name.toLowerCase().includes(l.toLowerCase())||e.medicalCondition.toLowerCase().includes(l.toLowerCase()),n="all"===u||e.status===u;return t&&n}),E=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"critical":return"bg-red-100 text-red-800"}};return o?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Qe.jsx)(ot,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"My Patients"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage your patient information and care"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-4",children:(0,Qe.jsxs)("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Qe.jsx)(pn,{className:"h-5 w-5 mr-2"}),"Add Patient"]})})]})}),(0,Qe.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Qe.jsx)("div",{className:"mb-8",children:(0,Qe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Qe.jsx)("div",{className:"flex-1",children:(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search patients by name or condition...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value)})]})}),(0,Qe.jsxs)("div",{className:"flex gap-2",children:[(0,Qe.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Patients"}),(0,Qe.jsx)("option",{value:"active",children:"Active"}),(0,Qe.jsx)("option",{value:"inactive",children:"Inactive"}),(0,Qe.jsx)("option",{value:"critical",children:"Critical"})]}),(0,Qe.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Qe.jsx)(jn,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:_.map(e=>(0,Qe.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:(0,Qe.jsxs)("div",{className:"p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-blue-600 font-semibold text-lg",children:e.name.split(" ").map(e=>e[0]).join("")})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600",children:[e.age,"y, ",e.gender]})]})]}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(E(e.status)),children:e.status})]}),(0,Qe.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Qe.jsx)(ot,{className:"h-4 w-4 mr-2 text-red-500"}),(0,Qe.jsx)("span",{className:"font-medium",children:e.medicalCondition})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Qe.jsx)(Et,{className:"h-4 w-4 mr-2 text-green-500"}),(0,Qe.jsx)("span",{children:e.phone})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Qe.jsx)(jt,{className:"h-4 w-4 mr-2 text-blue-500"}),(0,Qe.jsx)("span",{children:e.address})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Qe.jsx)(at,{className:"h-4 w-4 mr-2 text-purple-500"}),(0,Qe.jsxs)("span",{children:["Next: ",new Date(e.nextAppointment).toLocaleDateString()]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)("div",{className:"flex items-center",children:[...Array(5)].map((t,n)=>(0,Qe.jsx)(Lt,{className:"h-4 w-4 ".concat(n<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300")},n))}),(0,Qe.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:e.rating})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[(0,Qe.jsxs)("button",{onClick:()=>{m(e),g(!0)},className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center text-sm",children:[(0,Qe.jsx)(Bt,{className:"h-4 w-4 mr-1"}),"View Details"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/messages?client=".concat(e.name),className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center text-sm",children:[(0,Qe.jsx)(_t,{className:"h-4 w-4 mr-1"}),"Message"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/calls?client=".concat(e.id),className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center text-sm",children:[(0,Qe.jsx)(Et,{className:"h-4 w-4 mr-1"}),"Call"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/diagnostics?client=".concat(e.id),className:"px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center text-sm",children:[(0,Qe.jsx)(Tt,{className:"h-4 w-4 mr-1"}),"Vitals"]})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/prescriptions?client=".concat(e.id),className:"px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center justify-center text-sm",children:[(0,Qe.jsx)(wt,{className:"h-4 w-4 mr-1"}),"Meds"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/care-logs?client=".concat(e.id),className:"px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center text-sm",children:[(0,Qe.jsx)(xt,{className:"h-4 w-4 mr-1"}),"Logs"]})]})]})},e.id))}),0===_.length&&(0,Qe.jsxs)("div",{className:"text-center py-12",children:[(0,Qe.jsx)(ot,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No assigned patients"}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-4",children:l?"Try adjusting your search criteria":"You don't have any assigned patients yet"}),(0,Qe.jsxs)("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,Qe.jsx)(pn,{className:"h-4 w-4 mr-2"}),"Request Patient Assignment"]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Need More Patients?"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Qe.jsxs)("button",{onClick:()=>y(!0),className:"flex items-center justify-center p-4 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:[(0,Qe.jsx)(pn,{className:"h-5 w-5 mr-2"}),"Request Assignment"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/messages?topic=assignment-request",className:"flex items-center justify-center p-4 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[(0,Qe.jsx)(_t,{className:"h-5 w-5 mr-2"}),"Contact Admin"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/settings?section=availability",className:"flex items-center justify-center p-4 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors",children:[(0,Qe.jsx)(at,{className:"h-5 w-5 mr-2"}),"Update Availability"]})]})]}),f&&p&&(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,Qe.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:[p.name," - Client Details"]}),(0,Qe.jsx)("button",{onClick:()=>g(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(ut,{className:"h-5 w-5"})})]}),(0,Qe.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Basic Information"}),(0,Qe.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,Qe.jsxs)("p",{children:[(0,Qe.jsx)("span",{className:"font-medium",children:"Age:"})," ",p.age]}),(0,Qe.jsxs)("p",{children:[(0,Qe.jsx)("span",{className:"font-medium",children:"Gender:"})," ",p.gender]}),(0,Qe.jsxs)("p",{children:[(0,Qe.jsx)("span",{className:"font-medium",children:"Phone:"})," ",p.phone]}),(0,Qe.jsxs)("p",{children:[(0,Qe.jsx)("span",{className:"font-medium",children:"Address:"})," ",p.address]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Emergency Contact"}),(0,Qe.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,Qe.jsxs)("p",{children:[(0,Qe.jsx)("span",{className:"font-medium",children:"Phone:"})," ",p.emergencyContact]}),(0,Qe.jsxs)("p",{children:[(0,Qe.jsx)("span",{className:"font-medium",children:"Last Visit:"})," ",new Date(p.lastVisit).toLocaleDateString()]}),(0,Qe.jsxs)("p",{children:[(0,Qe.jsx)("span",{className:"font-medium",children:"Next Appointment:"})," ",new Date(p.nextAppointment).toLocaleDateString()]})]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Medical Information"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Condition:"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:p.medicalCondition})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Allergies:"}),(0,Qe.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:null===(e=p.allergies)||void 0===e?void 0:e.map((e,t)=>(0,Qe.jsx)("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:e},t))})]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Current Medications"}),(0,Qe.jsx)("div",{className:"flex flex-wrap gap-2",children:null===(n=p.medications)||void 0===n?void 0:n.map((e,t)=>(0,Qe.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:e},t))})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Care Notes"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:p.caregiverNotes})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/calls?client=".concat(p.id),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center",children:[(0,Qe.jsx)(Et,{className:"h-4 w-4 mr-2"}),"Call"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/messages?client=".concat(p.name),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center",children:[(0,Qe.jsx)(_t,{className:"h-4 w-4 mr-2"}),"Message"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/diagnostics?client=".concat(p.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center justify-center",children:[(0,Qe.jsx)(Tt,{className:"h-4 w-4 mr-2"}),"Vitals"]}),(0,Qe.jsxs)("button",{onClick:()=>window.location.href="/service-provider/care-logs?client=".concat(p.id),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center",children:[(0,Qe.jsx)(Ct,{className:"h-4 w-4 mr-2"}),"Logs"]})]})]})]})}),v&&(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Request Patient Assignment"}),(0,Qe.jsx)("button",{onClick:()=>y(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(ut,{className:"h-5 w-5"})})]}),(0,Qe.jsxs)("div",{className:"p-6 space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Patient Type"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"",children:"Any patient type"}),(0,Qe.jsx)("option",{value:"diabetes",children:"Diabetes care"}),(0,Qe.jsx)("option",{value:"dementia",children:"Dementia/Memory care"}),(0,Qe.jsx)("option",{value:"mobility",children:"Mobility assistance"}),(0,Qe.jsx)("option",{value:"companionship",children:"Companionship care"}),(0,Qe.jsx)("option",{value:"medical",children:"Medical care"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Availability"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"full-time",children:"Full-time (Mon-Fri)"}),(0,Qe.jsx)("option",{value:"part-time",children:"Part-time"}),(0,Qe.jsx)("option",{value:"weekends",children:"Weekends only"}),(0,Qe.jsx)("option",{value:"evenings",children:"Evenings only"}),(0,Qe.jsx)("option",{value:"on-call",children:"On-call basis"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,Qe.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Any specific preferences or requirements..."})]}),(0,Qe.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,Qe.jsxs)("div",{className:"flex items-start",children:[(0,Qe.jsx)(Rt,{className:"h-5 w-5 text-blue-600 mr-2 mt-0.5"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-blue-800",children:"Assignment Process"}),(0,Qe.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"Your request will be reviewed by our admin team who will match you with suitable patients based on your qualifications and availability."})]})]})})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-6 border-t",children:[(0,Qe.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,Qe.jsx)("button",{onClick:()=>{Pe.oR.success("Assignment request submitted to admin for review"),y(!1)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Submit Request"})]})]})})]})]})},Yn=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(!0),[s,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n([{id:1,title:"Morning Medication Administration",patientName:"Adunni Okafor",patientId:"ELD001",description:"Administer morning diabetes medications and check blood sugar levels",status:"pending",priority:"high",dueDate:"2024-01-21T09:00:00Z",estimatedDuration:30,location:"123 Victoria Island, Lagos",type:"medication",notes:"Patient has diabetes - monitor blood sugar levels",completedAt:null,createdAt:"2024-01-20T08:00:00Z"},{id:2,title:"Physical Therapy Session",patientName:"Grace Johnson",patientId:"ELD002",description:"Assist with 30-minute physical therapy exercises",status:"completed",priority:"medium",dueDate:"2024-01-20T10:00:00Z",estimatedDuration:45,location:"456 Ikoyi, Lagos",type:"therapy",notes:"Patient prefers gentle exercises",completedAt:"2024-01-20T10:30:00Z",createdAt:"2024-01-20T07:00:00Z"},{id:3,title:"Lunch Preparation",patientName:"Adunni Okafor",patientId:"ELD001",description:"Prepare diabetic-friendly lunch meal",status:"in-progress",priority:"medium",dueDate:"2024-01-21T12:00:00Z",estimatedDuration:60,location:"123 Victoria Island, Lagos",type:"meal",notes:"Follow diabetic diet guidelines",completedAt:null,createdAt:"2024-01-20T08:30:00Z"},{id:4,title:"Emergency Response",patientName:"Michael Adebayo",patientId:"ELD003",description:"Respond to emergency alert - check patient condition",status:"pending",priority:"critical",dueDate:"2024-01-21T14:30:00Z",estimatedDuration:15,location:"789 Lekki, Lagos",type:"emergency",notes:"Patient has mobility issues",completedAt:null,createdAt:"2024-01-20T14:15:00Z"},{id:5,title:"Evening Care Routine",patientName:"Grace Johnson",patientId:"ELD002",description:"Evening medication and bedtime routine",status:"pending",priority:"medium",dueDate:"2024-01-21T18:00:00Z",estimatedDuration:45,location:"456 Ikoyi, Lagos",type:"care",notes:"Patient prefers quiet environment",completedAt:null,createdAt:"2024-01-20T17:00:00Z"}]),i(!1)},1e3)}catch(e){console.error("Error loading tasks:",e),i(!1)}})()},[]);const u=e.filter(e=>{const t=e.title.toLowerCase().includes(s.toLowerCase())||e.patientName.toLowerCase().includes(s.toLowerCase()),n="all"===o||e.status===o,r="all"===l||e.priority===l;return t&&n&&r}),h=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},p=e=>{switch(e){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},m=e=>{switch(e){case"medication":return(0,Qe.jsx)(xt,{className:"h-5 w-5 text-blue-600"});case"therapy":return(0,Qe.jsx)(ot,{className:"h-5 w-5 text-green-600"});case"meal":return(0,Qe.jsx)(xt,{className:"h-5 w-5 text-orange-600"});case"emergency":return(0,Qe.jsx)(qe,{className:"h-5 w-5 text-red-600"});case"care":return(0,Qe.jsx)(ft,{className:"h-5 w-5 text-purple-600"});default:return(0,Qe.jsx)(xt,{className:"h-5 w-5 text-gray-600"})}},f=t=>{n(e.map(e=>e.id===t?(0,Ge.A)((0,Ge.A)({},e),{},{status:"completed",completedAt:(new Date).toISOString()}):e))};return r?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Qe.jsx)(kt,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage your care tasks and assignments"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-4",children:(0,Qe.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Qe.jsx)(pn,{className:"h-5 w-5 mr-2"}),"Add Task"]})})]})}),(0,Qe.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Qe.jsx)("div",{className:"mb-8",children:(0,Qe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Qe.jsx)("div",{className:"flex-1",children:(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search tasks by title or patient name...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:s,onChange:e=>a(e.target.value)})]})}),(0,Qe.jsxs)("div",{className:"flex gap-2",children:[(0,Qe.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Status"}),(0,Qe.jsx)("option",{value:"pending",children:"Pending"}),(0,Qe.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,Qe.jsx)("option",{value:"completed",children:"Completed"}),(0,Qe.jsx)("option",{value:"overdue",children:"Overdue"})]}),(0,Qe.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Priority"}),(0,Qe.jsx)("option",{value:"critical",children:"Critical"}),(0,Qe.jsx)("option",{value:"high",children:"High"}),(0,Qe.jsx)("option",{value:"medium",children:"Medium"}),(0,Qe.jsx)("option",{value:"low",children:"Low"})]}),(0,Qe.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Qe.jsx)(jn,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Qe.jsx)("div",{className:"space-y-4",children:u.map(t=>(0,Qe.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:(0,Qe.jsx)("div",{className:"p-6",children:(0,Qe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,Qe.jsx)("div",{className:"p-2 bg-gray-50 rounded-lg",children:m(t.type)}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t.title}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Qe.jsxs)("span",{className:"flex items-center",children:[(0,Qe.jsx)(ft,{className:"h-4 w-4 mr-1"}),t.patientName]}),(0,Qe.jsxs)("span",{className:"flex items-center",children:[(0,Qe.jsx)(jt,{className:"h-4 w-4 mr-1"}),t.location]}),(0,Qe.jsxs)("span",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-4 w-4 mr-1"}),t.estimatedDuration," min"]})]})]})]}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(at,{className:"h-4 w-4 mr-1"}),(0,Qe.jsxs)("span",{children:["Due: ",new Date(t.dueDate).toLocaleDateString()," ",new Date(t.dueDate).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(h(t.status)),children:t.status}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(p(t.priority)),children:t.priority})]}),t.notes&&(0,Qe.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:(0,Qe.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,Qe.jsx)("strong",{children:"Notes:"})," ",t.notes]})})]}),(0,Qe.jsxs)("div",{className:"flex flex-col space-y-2 ml-6",children:["pending"===t.status&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("button",{onClick:()=>{return r=t.id,void n(e.map(e=>e.id===r?(0,Ge.A)((0,Ge.A)({},e),{},{status:"in-progress"}):e));var r},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Start Task"}),(0,Qe.jsx)("button",{onClick:()=>f(t.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Complete"})]}),"in-progress"===t.status&&(0,Qe.jsx)("button",{onClick:()=>f(t.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Mark Complete"}),"completed"===t.status&&(0,Qe.jsxs)("div",{className:"flex items-center text-green-600 text-sm",children:[(0,Qe.jsx)(kt,{className:"h-4 w-4 mr-1"}),"Completed"]}),(0,Qe.jsxs)("div",{className:"flex space-x-1",children:[(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(Bt,{className:"h-4 w-4"})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(fn,{className:"h-4 w-4"})})]})]})]})})},t.id))}),0===u.length&&(0,Qe.jsxs)("div",{className:"text-center py-12",children:[(0,Qe.jsx)(kt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tasks found"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:s?"Try adjusting your search criteria":"No tasks match the selected filters"})]})]})]})},Xn=Ke("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Jn=Ke("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),Qn=Ke("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Zn=Ke("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),$n=Ke("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),er=Ke("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),tr=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(null),[s,a]=(0,t.useState)([]),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)("");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",lastMessage:"Thank you for the medication reminder",lastMessageTime:"2024-01-21T10:30:00Z",unreadCount:2,avatar:null,status:"online",lastSeen:"2024-01-21T10:35:00Z"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",lastMessage:"See you tomorrow for therapy session",lastMessageTime:"2024-01-21T09:15:00Z",unreadCount:0,avatar:null,status:"offline",lastSeen:"2024-01-21T09:20:00Z"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",lastMessage:"Emergency alert received - all clear now",lastMessageTime:"2024-01-21T08:45:00Z",unreadCount:1,avatar:null,status:"online",lastSeen:"2024-01-21T08:50:00Z"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",lastMessage:"Lunch was delicious, thank you!",lastMessageTime:"2024-01-21T08:00:00Z",unreadCount:0,avatar:null,status:"offline",lastSeen:"2024-01-21T08:05:00Z"}];n(e),i(e[0]),d(!1)},1e3)}catch(e){console.error("Error loading conversations:",e),d(!1)}})()},[]),(0,t.useEffect)(()=>{r&&p(r.id)},[r]);const p=async e=>{try{setTimeout(()=>{a([{id:1,senderId:"caregiver",senderName:"You",message:"Good morning! Time for your morning medication.",timestamp:"2024-01-21T09:00:00Z",type:"text",status:"delivered"},{id:2,senderId:"ELD001",senderName:"Adunni Okafor",message:"Good morning! I'm ready for my medication.",timestamp:"2024-01-21T09:05:00Z",type:"text",status:"read"},{id:3,senderId:"caregiver",senderName:"You",message:"Perfect! I'll be there in 10 minutes.",timestamp:"2024-01-21T09:06:00Z",type:"text",status:"delivered"},{id:4,senderId:"ELD001",senderName:"Adunni Okafor",message:"Thank you for the medication reminder",timestamp:"2024-01-21T10:30:00Z",type:"text",status:"read"}])},500)}catch(t){console.error("Error loading messages:",t)}},m=e.filter(e=>e.patientName.toLowerCase().includes(u.toLowerCase())),f=()=>{if(o.trim()&&r){const t={id:Date.now(),senderId:"caregiver",senderName:"You",message:o.trim(),timestamp:(new Date).toISOString(),type:"text",status:"sending"};a([...s,t]),c(""),n(e.map(e=>e.id===r.id?(0,Ge.A)((0,Ge.A)({},e),{},{lastMessage:t.message,lastMessageTime:t.timestamp}):e))}},g=e=>"online"===e?"bg-green-500":"bg-gray-400",v=e=>{const t=new Date(e),n=(new Date-t)/36e5;return n<1?"Just now":n<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString()};return l?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Qe.jsx)(lt,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Communicate with your patients and family members"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("button",{className:"p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:(0,Qe.jsx)(Et,{className:"h-5 w-5"})}),(0,Qe.jsx)("button",{className:"p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Qe.jsx)(ct,{className:"h-5 w-5"})})]})]})}),(0,Qe.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Qe.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Qe.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value)})]})}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto",children:m.map(e=>(0,Qe.jsx)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===r||void 0===r?void 0:r.id)===e.id?"bg-blue-50 border-blue-200":""),onClick:()=>i(e),children:(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-6 w-6 text-gray-600"})}),(0,Qe.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white ".concat(g(e.status))})]}),(0,Qe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.patientName}),(0,Qe.jsx)("span",{className:"text-xs text-gray-500",children:v(e.lastMessageTime)})]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 truncate mt-1",children:e.lastMessage}),e.unreadCount>0&&(0,Qe.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,Qe.jsxs)("span",{className:"text-xs text-gray-500",children:["ID: ",e.patientId]}),(0,Qe.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unreadCount})]})]})]})},e.id))})]}),(0,Qe.jsx)("div",{className:"flex-1 flex flex-col",children:r?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-5 w-5 text-gray-600"})}),(0,Qe.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white ".concat(g(r.status))})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:r.patientName}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",r.patientId," \u2022 ",r.status]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(Et,{className:"h-5 w-5"})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(ct,{className:"h-5 w-5"})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(Xn,{className:"h-5 w-5"})})]})]})}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:s.map(e=>(0,Qe.jsx)("div",{className:"flex ".concat("caregiver"===e.senderId?"justify-end":"justify-start"),children:(0,Qe.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("caregiver"===e.senderId?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"),children:[(0,Qe.jsx)("p",{className:"text-sm",children:e.message}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between mt-1 text-xs ".concat("caregiver"===e.senderId?"text-blue-100":"text-gray-500"),children:[(0,Qe.jsx)("span",{children:v(e.timestamp)}),"caregiver"===e.senderId&&(0,Qe.jsx)("div",{className:"flex items-center ml-2",children:"read"===e.status?(0,Qe.jsx)(Jn,{className:"h-3 w-3"}):(0,Qe.jsx)(Qn,{className:"h-3 w-3"})})]})]})},e.id))}),(0,Qe.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(Zn,{className:"h-5 w-5"})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(Ct,{className:"h-5 w-5"})}),(0,Qe.jsx)("div",{className:"flex-1",children:(0,Qe.jsx)("input",{type:"text",placeholder:"Type a message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),onKeyPress:e=>"Enter"===e.key&&f()})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)($n,{className:"h-5 w-5"})}),(0,Qe.jsx)("button",{onClick:f,className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Qe.jsx)(er,{className:"h-5 w-5"})})]})})]}):(0,Qe.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)(lt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Choose a conversation from the list to start messaging"})]})})})]})]})},nr=Ke("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),rr=Ke("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),ir=Ke("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),sr=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(null),[s,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",address:"123 Victoria Island, Lagos",coordinates:{lat:6.4281,lng:3.4219},distance:2.5,estimatedTime:15,priority:"high",visitTime:"2024-01-21T09:00:00Z",status:"scheduled",notes:"Morning medication administration",contactNumber:"+234 801 234 5678",lastVisited:"2024-01-20T09:00:00Z"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",address:"456 Ikoyi, Lagos",coordinates:{lat:6.4474,lng:3.4288},distance:5.2,estimatedTime:25,priority:"medium",visitTime:"2024-01-21T10:00:00Z",status:"scheduled",notes:"Physical therapy session",contactNumber:"+234 802 345 6789",lastVisited:"2024-01-19T10:00:00Z"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",address:"789 Lekki, Lagos",coordinates:{lat:6.4698,lng:3.5852},distance:8.7,estimatedTime:35,priority:"low",visitTime:"2024-01-21T14:00:00Z",status:"scheduled",notes:"Regular checkup and medication review",contactNumber:"+234 803 456 7890",lastVisited:"2024-01-18T14:00:00Z"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",address:"321 Surulere, Lagos",coordinates:{lat:6.5018,lng:3.3584},distance:12.3,estimatedTime:45,priority:"medium",visitTime:"2024-01-21T16:00:00Z",status:"scheduled",notes:"Lunch preparation and care routine",contactNumber:"+234 804 567 8901",lastVisited:"2024-01-17T16:00:00Z"}];n(e),i(e[0]),c(!1)},1e3)}catch(e){console.error("Error loading routes:",e),c(!1)}})()},[]);const p=e.filter(e=>{const t=e.patientName.toLowerCase().includes(l.toLowerCase())||e.address.toLowerCase().includes(l.toLowerCase()),n="all"===u||e.priority===u;return t&&n}),m=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},f=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),v=e=>new Date(e).toLocaleDateString();return o?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-purple-600 flex items-center justify-center",children:(0,Qe.jsx)(Dn,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Navigation"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Plan your routes and navigate to patient locations"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-4",children:(0,Qe.jsxs)("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[(0,Qe.jsx)(nr,{className:"h-5 w-5 mr-2"}),"Optimize Route"]})})]})}),(0,Qe.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Qe.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Qe.jsxs)("div",{className:"p-4 border-b border-gray-200 space-y-3",children:[(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search patients or addresses...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value)})]}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Priorities"}),(0,Qe.jsx)("option",{value:"high",children:"High Priority"}),(0,Qe.jsx)("option",{value:"medium",children:"Medium Priority"}),(0,Qe.jsx)("option",{value:"low",children:"Low Priority"})]})]}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto",children:p.map(e=>(0,Qe.jsxs)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===r||void 0===r?void 0:r.id)===e.id?"bg-purple-50 border-purple-200":""),onClick:()=>i(e),children:[(0,Qe.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Qe.jsxs)("p",{className:"text-xs text-gray-600",children:["ID: ",e.patientId]})]}),(0,Qe.jsxs)("div",{className:"flex flex-col items-end space-y-1",children:[(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(m(e.priority)),children:e.priority}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(f(e.status)),children:e.status})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-xs text-gray-600 mb-2",children:[(0,Qe.jsx)(jt,{className:"h-3 w-3 mr-1"}),(0,Qe.jsx)("span",{className:"truncate",children:e.address})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsxs)("span",{className:"flex items-center",children:[(0,Qe.jsx)(rr,{className:"h-3 w-3 mr-1"}),e.distance," km"]}),(0,Qe.jsxs)("span",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-3 w-3 mr-1"}),e.estimatedTime," min"]})]}),(0,Qe.jsx)("span",{className:"font-medium",children:g(e.visitTime)})]})]},e.id))})]}),(0,Qe.jsx)("div",{className:"flex-1 flex flex-col",children:r?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsxs)("div",{className:"h-1/2 bg-gray-200 relative",children:[(0,Qe.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)(jt,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Interactive Map"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:"Map integration would go here"})]})}),(0,Qe.jsx)("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-3",children:(0,Qe.jsxs)("div",{className:"text-sm",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-1",children:[(0,Qe.jsx)(rr,{className:"h-4 w-4 mr-2 text-blue-600"}),(0,Qe.jsxs)("span",{className:"font-medium",children:[r.distance," km"]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-4 w-4 mr-2 text-green-600"}),(0,Qe.jsxs)("span",{className:"font-medium",children:[r.estimatedTime," min"]})]})]})})]}),(0,Qe.jsx)("div",{className:"h-1/2 bg-white border-t border-gray-200 overflow-y-auto",children:(0,Qe.jsxs)("div",{className:"p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:r.patientName}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["ID: ",r.patientId]})]}),(0,Qe.jsxs)("div",{className:"flex space-x-2",children:["scheduled"===r.status&&(0,Qe.jsxs)("button",{onClick:()=>{return t=r,void n(e.map(e=>e.id===t.id?(0,Ge.A)((0,Ge.A)({},e),{},{status:"in-progress"}):e));var t},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[(0,Qe.jsx)(Dn,{className:"h-4 w-4 mr-2"}),"Start Navigation"]}),"in-progress"===r.status&&(0,Qe.jsxs)("button",{onClick:()=>{return t=r,void n(e.map(e=>e.id===t.id?(0,Ge.A)((0,Ge.A)({},e),{},{status:"completed"}):e));var t},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Qe.jsx)(kt,{className:"h-4 w-4 mr-2"}),"Complete Visit"]})]})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Route Information"}),(0,Qe.jsxs)("div",{className:"space-y-3",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(jt,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Address"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:r.address})]})]}),(0,Qe.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Qe.jsx)(ir,{className:"h-4 w-4"})})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Visit Time"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:g(r.visitTime)})]})]}),(0,Qe.jsx)("span",{className:"text-sm text-gray-500",children:v(r.visitTime)})]}),(0,Qe.jsx)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(rr,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Distance & Time"}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600",children:[r.distance," km \u2022 ",r.estimatedTime," min"]})]})]})})]})]}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Patient Information"}),(0,Qe.jsxs)("div",{className:"space-y-3",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Et,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Contact"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:r.contactNumber})]})]}),(0,Qe.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Qe.jsx)(Et,{className:"h-4 w-4"})})]}),(0,Qe.jsx)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(at,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Last Visit"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:v(r.lastVisited)})]})]})}),(0,Qe.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-start",children:[(0,Qe.jsx)(lt,{className:"h-5 w-5 text-gray-600 mr-3 mt-0.5"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Notes"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:r.notes})]})]})})]})]})]})]})})]}):(0,Qe.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)(Dn,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a route"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Choose a patient route from the list to view details and start navigation"})]})})})]})]})},ar=Ke("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),or=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(!0),[s,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n([{id:1,patientName:"Adunni Okafor",patientId:"ELD001",title:"Morning medication administration",description:"Patient taking morning diabetes medication as prescribed",category:"medication",imageUrl:null,thumbnailUrl:null,uploadedAt:"2024-01-21T09:30:00Z",location:"123 Victoria Island, Lagos",tags:["medication","morning","diabetes"],status:"approved",notes:"Patient compliant with medication schedule"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",title:"Physical therapy progress",description:"Patient completing physical therapy exercises",category:"therapy",imageUrl:null,thumbnailUrl:null,uploadedAt:"2024-01-21T10:15:00Z",location:"456 Ikoyi, Lagos",tags:["therapy","exercise","progress"],status:"pending",notes:"Good progress in mobility exercises"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",title:"Lunch meal preparation",description:"Healthy diabetic-friendly meal prepared",category:"meal",imageUrl:null,thumbnailUrl:null,uploadedAt:"2024-01-21T12:45:00Z",location:"789 Lekki, Lagos",tags:["meal","nutrition","diabetic"],status:"approved",notes:"Meal follows dietary guidelines"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",title:"Evening care routine",description:"Patient ready for evening medication and bedtime routine",category:"care",imageUrl:null,thumbnailUrl:null,uploadedAt:"2024-01-21T18:30:00Z",location:"321 Surulere, Lagos",tags:["care","evening","routine"],status:"pending",notes:"Patient comfortable and ready for rest"},{id:5,patientName:"Adunni Okafor",patientId:"ELD001",title:"Blood sugar monitoring",description:"Blood glucose level check - within normal range",category:"health",imageUrl:null,thumbnailUrl:null,uploadedAt:"2024-01-21T14:00:00Z",location:"123 Victoria Island, Lagos",tags:["health","monitoring","diabetes"],status:"approved",notes:"Blood sugar levels stable"}]),i(!1)},1e3)}catch(e){console.error("Error loading photos:",e),i(!1)}})()},[]);const f=e.filter(e=>{const t=e.title.toLowerCase().includes(s.toLowerCase())||e.patientName.toLowerCase().includes(s.toLowerCase())||e.description.toLowerCase().includes(s.toLowerCase()),n="all"===o||e.patientId===o,r="all"===l||e.category===l;return t&&n&&r}),g=e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v=e=>{switch(e){case"medication":return(0,Qe.jsx)(xt,{className:"h-5 w-5 text-blue-600"});case"therapy":return(0,Qe.jsx)(ot,{className:"h-5 w-5 text-green-600"});case"meal":return(0,Qe.jsx)(xt,{className:"h-5 w-5 text-orange-600"});case"care":return(0,Qe.jsx)(ft,{className:"h-5 w-5 text-purple-600"});case"health":return(0,Qe.jsx)(ot,{className:"h-5 w-5 text-red-600"});default:return(0,Qe.jsx)(Nn,{className:"h-5 w-5 text-gray-600"})}},y=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return r?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-indigo-600 flex items-center justify-center",children:(0,Qe.jsx)(Ct,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Photo Updates"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Document patient care activities with photos and updates"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-4",children:(0,Qe.jsxs)("button",{onClick:()=>{m(!0)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center",children:[(0,Qe.jsx)(pn,{className:"h-5 w-5 mr-2"}),"Upload Photo"]})})]})}),(0,Qe.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Qe.jsx)("div",{className:"mb-8",children:(0,Qe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Qe.jsx)("div",{className:"flex-1",children:(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search photos by title, patient, or description...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:s,onChange:e=>a(e.target.value)})]})}),(0,Qe.jsxs)("div",{className:"flex gap-2",children:[(0,Qe.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Patients"}),(0,Qe.jsx)("option",{value:"ELD001",children:"Adunni Okafor"}),(0,Qe.jsx)("option",{value:"ELD002",children:"Grace Johnson"}),(0,Qe.jsx)("option",{value:"ELD003",children:"Michael Adebayo"}),(0,Qe.jsx)("option",{value:"ELD004",children:"Sarah Williams"})]}),(0,Qe.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Categories"}),(0,Qe.jsx)("option",{value:"medication",children:"Medication"}),(0,Qe.jsx)("option",{value:"therapy",children:"Therapy"}),(0,Qe.jsx)("option",{value:"meal",children:"Meal"}),(0,Qe.jsx)("option",{value:"care",children:"Care"}),(0,Qe.jsx)("option",{value:"health",children:"Health"})]}),(0,Qe.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Qe.jsx)(jn,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:f.map(t=>{return(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("div",{className:"aspect-w-16 aspect-h-12 bg-gray-200 rounded-t-xl overflow-hidden",children:(0,Qe.jsx)("div",{className:"w-full h-48 bg-gray-200 flex items-center justify-center",children:(0,Qe.jsx)(Nn,{className:"h-16 w-16 text-gray-400"})})}),(0,Qe.jsx)("div",{className:"absolute top-3 left-3",children:(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(g(t.status)),children:t.status})}),(0,Qe.jsx)("div",{className:"absolute top-3 right-3",children:(0,Qe.jsxs)("div",{className:"flex space-x-1",children:[(0,Qe.jsx)("button",{className:"p-1 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 transition-all",children:(0,Qe.jsx)(Bt,{className:"h-4 w-4 text-gray-600"})}),(0,Qe.jsx)("button",{className:"p-1 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 transition-all",children:(0,Qe.jsx)(An,{className:"h-4 w-4 text-gray-600"})})]})})]}),(0,Qe.jsxs)("div",{className:"p-4",children:[(0,Qe.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Qe.jsx)("h3",{className:"text-sm font-semibold text-gray-900 line-clamp-2",children:t.title}),(0,Qe.jsx)("div",{className:"p-1 bg-gray-100 rounded-lg ml-2",children:v(t.category)})]}),(0,Qe.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Qe.jsx)(ft,{className:"h-3 w-3 mr-1"}),(0,Qe.jsx)("span",{children:t.patientName})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Qe.jsx)(at,{className:"h-3 w-3 mr-1"}),(0,Qe.jsx)("span",{children:(r=t.uploadedAt,new Date(r).toLocaleDateString())})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Qe.jsx)(Ot,{className:"h-3 w-3 mr-1"}),(0,Qe.jsx)("span",{children:y(t.uploadedAt)})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Qe.jsx)(jt,{className:"h-3 w-3 mr-1"}),(0,Qe.jsx)("span",{className:"truncate",children:t.location})]})]}),(0,Qe.jsxs)("div",{className:"mt-3 flex flex-wrap gap-1",children:[t.tags.slice(0,3).map((e,t)=>(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700",children:e},t)),t.tags.length>3&&(0,Qe.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700",children:["+",t.tags.length-3]})]}),(0,Qe.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,Qe.jsx)("button",{onClick:()=>h(t),className:"px-3 py-1 text-xs bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"View Details"}),(0,Qe.jsxs)("div",{className:"flex space-x-1",children:[(0,Qe.jsx)("button",{className:"p-1 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(fn,{className:"h-4 w-4"})}),(0,Qe.jsx)("button",{onClick:()=>{return r=t.id,void n(e.filter(e=>e.id!==r));var r},className:"p-1 text-gray-400 hover:text-red-600",children:(0,Qe.jsx)(gn,{className:"h-4 w-4"})})]})]})]})]},t.id);var r})}),0===f.length&&(0,Qe.jsxs)("div",{className:"text-center py-12",children:[(0,Qe.jsx)(Ct,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No photos found"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:s?"Try adjusting your search criteria":"No photos match the selected filters"})]})]}),p&&(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Photo Update"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Patient"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,Qe.jsx)("option",{children:"Adunni Okafor"}),(0,Qe.jsx)("option",{children:"Grace Johnson"}),(0,Qe.jsx)("option",{children:"Michael Adebayo"}),(0,Qe.jsx)("option",{children:"Sarah Williams"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,Qe.jsx)("option",{value:"medication",children:"Medication"}),(0,Qe.jsx)("option",{value:"therapy",children:"Therapy"}),(0,Qe.jsx)("option",{value:"meal",children:"Meal"}),(0,Qe.jsx)("option",{value:"care",children:"Care"}),(0,Qe.jsx)("option",{value:"health",children:"Health"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),(0,Qe.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter photo title"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,Qe.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:"3",placeholder:"Enter photo description"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Photo"}),(0,Qe.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,Qe.jsx)(ar,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"})]})]})]}),(0,Qe.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,Qe.jsx)("button",{onClick:()=>m(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),(0,Qe.jsx)("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Upload Photo"})]})]})})]})},cr=()=>{var e,n,r,i,s,a,o,c,l,d,u,h,p,m;const[f,g]=(0,t.useState)({}),[v,y]=(0,t.useState)(!0),[_,E]=(0,t.useState)("week"),[b,x]=(0,t.useState)("overall");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{g({overall:{rating:4.8,totalPatients:12,totalTasks:156,completedTasks:148,onTimeRate:94.9,patientSatisfaction:96.2,emergencyResponseTime:8.5},weekly:{tasksCompleted:32,tasksOnTime:30,patientsServed:8,hoursWorked:40,emergencyResponses:2,patientCalls:15,medicationAdministrations:24,therapySessions:8},monthly:{tasksCompleted:148,tasksOnTime:141,patientsServed:12,hoursWorked:160,emergencyResponses:8,patientCalls:65,medicationAdministrations:96,therapySessions:32},trends:{tasksCompleted:[28,32,30,35,32,38,32],onTimeRate:[92,94,91,96,94,98,95],patientSatisfaction:[94,95,93,97,96,98,96]},achievements:[{id:1,title:"Perfect Week",description:"Completed all tasks on time for 5 consecutive days",icon:"\ud83c\udfc6",earnedDate:"2024-01-20",category:"consistency"},{id:2,title:"Emergency Response Hero",description:"Responded to emergency calls within 5 minutes",icon:"\ud83d\udea8",earnedDate:"2024-01-18",category:"emergency"},{id:3,title:"Patient Favorite",description:"Received 5-star ratings from 10+ patients",icon:"\u2b50",earnedDate:"2024-01-15",category:"satisfaction"}],patientFeedback:[{id:1,patientName:"Adunni Okafor",rating:5,comment:"Excellent care and always on time. Very professional and caring.",date:"2024-01-20",category:"medication"},{id:2,patientName:"Grace Johnson",rating:5,comment:"The therapy sessions have been very helpful. Thank you for your patience.",date:"2024-01-19",category:"therapy"},{id:3,patientName:"Michael Adebayo",rating:4,comment:"Good care overall. Sometimes a bit rushed but very knowledgeable.",date:"2024-01-18",category:"general"}]}),y(!1)},1e3)}catch(e){console.error("Error loading performance data:",e),y(!1)}})()},[]);const w=(e,t)=>"rate"===t?e>=95?"text-green-600":e>=85?"text-yellow-600":"text-red-600":"text-gray-900",S=f[_]||{};f.trends;return v?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Qe.jsx)(En,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Performance"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Track your care performance and achievements"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsxs)("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:_,onChange:e=>E(e.target.value),children:[(0,Qe.jsx)("option",{value:"week",children:"This Week"}),(0,Qe.jsx)("option",{value:"monthly",children:"This Month"}),(0,Qe.jsx)("option",{value:"overall",children:"Overall"})]}),(0,Qe.jsxs)("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Qe.jsx)(An,{className:"h-5 w-5 mr-2"}),"Export Report"]})]})]})}),(0,Qe.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Overall Rating"}),(0,Qe.jsx)("p",{className:"text-3xl font-bold ".concat((T=(null===(e=f.overall)||void 0===e?void 0:e.rating)||0,T>=4.5?"text-green-600":T>=3.5?"text-yellow-600":"text-red-600")),children:(null===(n=f.overall)||void 0===n?void 0:n.rating)||0})]}),(0,Qe.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-xl flex items-center justify-center",children:(0,Qe.jsx)(Lt,{className:"h-6 w-6 text-green-600"})})]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Based on patient feedback"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Tasks Completed"}),(0,Qe.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:S.tasksCompleted||0})]}),(0,Qe.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,Qe.jsx)(kt,{className:"h-6 w-6 text-blue-600"})})]}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:[S.tasksOnTime||0," on time (",Math.round((S.tasksOnTime||0)/(S.tasksCompleted||1)*100),"%)"]})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Patients Served"}),(0,Qe.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:S.patientsServed||(null===(r=f.overall)||void 0===r?void 0:r.totalPatients)||0})]}),(0,Qe.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-xl flex items-center justify-center",children:(0,Qe.jsx)(yt,{className:"h-6 w-6 text-purple-600"})})]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Active patients"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Emergency Response"}),(0,Qe.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:[(null===(i=f.overall)||void 0===i?void 0:i.emergencyResponseTime)||0,"m"]})]}),(0,Qe.jsx)("div",{className:"h-12 w-12 bg-red-100 rounded-xl flex items-center justify-center",children:(0,Qe.jsx)(qe,{className:"h-6 w-6 text-red-600"})})]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Average response time"})]})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,Qe.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key Performance Indicators"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"On-Time Rate"}),(0,Qe.jsxs)("span",{className:"text-lg font-semibold ".concat(w((null===(s=f.overall)||void 0===s?void 0:s.onTimeRate)||0,"rate")),children:[(null===(a=f.overall)||void 0===a?void 0:a.onTimeRate)||0,"%"]})]}),(0,Qe.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Qe.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat((null===(o=f.overall)||void 0===o?void 0:o.onTimeRate)||0,"%")}})})]}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Patient Satisfaction"}),(0,Qe.jsxs)("span",{className:"text-lg font-semibold ".concat(w((null===(c=f.overall)||void 0===c?void 0:c.patientSatisfaction)||0,"rate")),children:[(null===(l=f.overall)||void 0===l?void 0:l.patientSatisfaction)||0,"%"]})]}),(0,Qe.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Qe.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat((null===(d=f.overall)||void 0===d?void 0:d.patientSatisfaction)||0,"%")}})})]}),(0,Qe.jsx)("div",{className:"space-y-4",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Hours Worked"}),(0,Qe.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:S.hoursWorked||0})]})}),(0,Qe.jsx)("div",{className:"space-y-4",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Emergency Responses"}),(0,Qe.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:S.emergencyResponses||0})]})})]})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Activity Breakdown"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(xt,{className:"h-5 w-5 text-blue-600 mr-3"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Medication Administration"})]}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.medicationAdministrations||0})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(ot,{className:"h-5 w-5 text-green-600 mr-3"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Therapy Sessions"})]}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.therapySessions||0})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Et,{className:"h-5 w-5 text-purple-600 mr-3"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Patient Calls"})]}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.patientCalls||0})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(qe,{className:"h-5 w-5 text-red-600 mr-3"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Emergency Responses"})]}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.emergencyResponses||0})]})]})]})]}),(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Achievements"}),(0,Qe.jsx)("div",{className:"space-y-3",children:null===(u=f.achievements)||void 0===u?void 0:u.map(e=>(0,Qe.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)("div",{className:"text-2xl",children:e.icon}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,Qe.jsx)("p",{className:"text-xs text-gray-600",children:e.description}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.earnedDate).toLocaleDateString()})]})]},e.id))})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Feedback"}),(0,Qe.jsx)("div",{className:"space-y-3",children:null===(h=f.patientFeedback)||void 0===h?void 0:h.map(e=>(0,Qe.jsxs)("div",{className:"border-b border-gray-100 pb-3 last:border-b-0",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Qe.jsx)("div",{className:"flex items-center",children:[...Array(5)].map((t,n)=>(0,Qe.jsx)(Lt,{className:"h-3 w-3 ".concat(n<e.rating?"text-yellow-400 fill-current":"text-gray-300")},n))})]}),(0,Qe.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:e.comment}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleDateString()})]},e.id))})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Goals"}),(0,Qe.jsxs)("div",{className:"space-y-3",children:[(0,Qe.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-blue-900",children:"On-Time Rate"}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-blue-900",children:"95%"})]}),(0,Qe.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,Qe.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat((null===(p=f.overall)||void 0===p?void 0:p.onTimeRate)||0,"%")}})})]}),(0,Qe.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-green-900",children:"Patient Satisfaction"}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-green-900",children:"98%"})]}),(0,Qe.jsx)("div",{className:"w-full bg-green-200 rounded-full h-2",children:(0,Qe.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat((null===(m=f.overall)||void 0===m?void 0:m.patientSatisfaction)||0,"%")}})})]}),(0,Qe.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-purple-900",children:"Emergency Response"}),(0,Qe.jsx)("span",{className:"text-sm font-semibold text-purple-900",children:"<5 min"})]}),(0,Qe.jsx)("div",{className:"w-full bg-purple-200 rounded-full h-2",children:(0,Qe.jsx)("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:"85%"}})})]})]})]})]})]})]})]});var T},lr=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(null),[s,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",type:"medical",severity:"critical",description:"Patient experiencing chest pain and difficulty breathing",location:"123 Victoria Island, Lagos",coordinates:{lat:6.4281,lng:3.4219},reportedAt:"2024-01-21T14:30:00Z",status:"active",reportedBy:"Patient",contactNumber:"+234 801 234 5678",emergencyContacts:[{name:"Dr. Adebayo",number:"+234 805 123 4567",type:"doctor"},{name:"Family Contact",number:"+234 802 345 6789",type:"family"}],actions:[{timestamp:"2024-01-21T14:30:00Z",action:"Emergency reported",user:"System"},{timestamp:"2024-01-21T14:31:00Z",action:"Caregiver notified",user:"System"},{timestamp:"2024-01-21T14:32:00Z",action:"En route to patient",user:"You"}],notes:"Patient has diabetes and hypertension. Last medication taken at 9 AM."},{id:2,patientName:"Grace Johnson",patientId:"ELD002",type:"fall",severity:"high",description:"Patient fell in bathroom and cannot get up",location:"456 Ikoyi, Lagos",coordinates:{lat:6.4474,lng:3.4288},reportedAt:"2024-01-21T12:15:00Z",status:"resolved",reportedBy:"Caregiver",contactNumber:"+234 802 345 6789",emergencyContacts:[{name:"Dr. Johnson",number:"+234 806 234 5678",type:"doctor"},{name:"Son - David",number:"+234 803 456 7890",type:"family"}],actions:[{timestamp:"2024-01-21T12:15:00Z",action:"Fall reported",user:"Caregiver"},{timestamp:"2024-01-21T12:20:00Z",action:"Patient assessed",user:"You"},{timestamp:"2024-01-21T12:25:00Z",action:"Patient assisted to bed",user:"You"},{timestamp:"2024-01-21T12:30:00Z",action:"Doctor contacted",user:"You"},{timestamp:"2024-01-21T12:35:00Z",action:"Emergency resolved",user:"You"}],notes:"No serious injuries. Patient is comfortable and resting."},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",type:"medication",severity:"medium",description:"Patient missed critical medication and showing symptoms",location:"789 Lekki, Lagos",coordinates:{lat:6.4698,lng:3.5852},reportedAt:"2024-01-21T10:45:00Z",status:"in-progress",reportedBy:"Family Member",contactNumber:"+234 803 456 7890",emergencyContacts:[{name:"Dr. Adebayo",number:"+234 807 345 6789",type:"doctor"},{name:"Wife - Mary",number:"+234 804 567 8901",type:"family"}],actions:[{timestamp:"2024-01-21T10:45:00Z",action:"Medication emergency reported",user:"Family"},{timestamp:"2024-01-21T10:50:00Z",action:"Caregiver dispatched",user:"System"},{timestamp:"2024-01-21T11:00:00Z",action:"Arrived at patient location",user:"You"},{timestamp:"2024-01-21T11:05:00Z",action:"Medication administered",user:"You"}],notes:"Patient feeling better after medication. Monitoring for any adverse effects."}];n(e),i(e[0]),a(!1)},1e3)}catch(e){console.error("Error loading emergencies:",e),a(!1)}})()},[]);const p=e.filter(e=>{const t=e.patientName.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase()),n="all"===l||e.status===l;return t&&n}),m=e=>{switch(e){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},f=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"resolved":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"medical":return(0,Qe.jsx)(ot,{className:"h-5 w-5 text-red-600"});case"fall":return(0,Qe.jsx)(ft,{className:"h-5 w-5 text-orange-600"});case"medication":return(0,Qe.jsx)(xt,{className:"h-5 w-5 text-blue-600"});case"fire":return(0,Qe.jsx)(Mt,{className:"h-5 w-5 text-red-600"});default:return(0,Qe.jsx)(qe,{className:"h-5 w-5 text-gray-600"})}},v=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),y=e=>new Date(e).toLocaleDateString(),_=(t,s)=>{const a={timestamp:(new Date).toISOString(),action:s,user:"You"};n(e.map(e=>e.id===t?(0,Ge.A)((0,Ge.A)({},e),{},{actions:[...e.actions,a],status:s.includes("resolved")?"resolved":s.includes("responding")?"in-progress":e.status}):e)),(null===r||void 0===r?void 0:r.id)===t&&i((0,Ge.A)((0,Ge.A)({},r),{},{actions:[...r.actions,a],status:s.includes("resolved")?"resolved":s.includes("responding")?"in-progress":r.status}))};return s?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-red-600 flex items-center justify-center",children:(0,Qe.jsx)(qe,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Response"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage emergency situations and patient safety"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-4",children:(0,Qe.jsxs)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center",children:[(0,Qe.jsx)(pn,{className:"h-5 w-5 mr-2"}),"Report Emergency"]})})]})}),(0,Qe.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Qe.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Qe.jsxs)("div",{className:"p-4 border-b border-gray-200 space-y-3",children:[(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search emergencies...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value)})]}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Status"}),(0,Qe.jsx)("option",{value:"active",children:"Active"}),(0,Qe.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,Qe.jsx)("option",{value:"resolved",children:"Resolved"}),(0,Qe.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto",children:p.map(e=>(0,Qe.jsxs)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===r||void 0===r?void 0:r.id)===e.id?"bg-red-50 border-red-200":""),onClick:()=>i(e),children:[(0,Qe.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[g(e.type),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Qe.jsxs)("p",{className:"text-xs text-gray-600",children:["ID: ",e.patientId]})]})]}),(0,Qe.jsxs)("div",{className:"flex flex-col items-end space-y-1",children:[(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ".concat(m(e.severity)),children:e.severity}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(f(e.status)),children:e.status})]})]}),(0,Qe.jsx)("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:e.description}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-3 w-3 mr-1"}),(0,Qe.jsx)("span",{children:v(e.reportedAt)})]}),(0,Qe.jsx)("span",{className:"font-medium",children:y(e.reportedAt)})]})]},e.id))})]}),(0,Qe.jsx)("div",{className:"flex-1 flex flex-col",children:r?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:g(r.type)}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:r.patientName}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",r.patientId," \u2022 ",r.type," emergency"]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat(m(r.severity)),children:r.severity}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(f(r.status)),children:r.status})]})]})}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,Qe.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Emergency Details"}),(0,Qe.jsxs)("div",{className:"space-y-3",children:[(0,Qe.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Description"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:r.description})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(jt,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Location"})]}),(0,Qe.jsx)("span",{className:"text-sm text-gray-600",children:r.location})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Reported At"})]}),(0,Qe.jsxs)("span",{className:"text-sm text-gray-600",children:[v(r.reportedAt)," ",y(r.reportedAt)]})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(ft,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Reported By"})]}),(0,Qe.jsx)("span",{className:"text-sm text-gray-600",children:r.reportedBy})]})]})]}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Emergency Contacts"}),(0,Qe.jsx)("div",{className:"space-y-3",children:r.emergencyContacts.map((e,t)=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Qe.jsx)("p",{className:"text-xs text-gray-600",children:e.type}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:e.number})]}),(0,Qe.jsx)("button",{onClick:()=>(e=>{console.log("Calling ".concat(e.name," at ").concat(e.number))})(e),className:"p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:(0,Qe.jsx)(Et,{className:"h-4 w-4"})})]},t))})]})]}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Action Timeline"}),(0,Qe.jsx)("div",{className:"space-y-3",children:r.actions.map((e,t)=>(0,Qe.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-2"}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.action}),(0,Qe.jsxs)("p",{className:"text-xs text-gray-600",children:[v(e.timestamp)," \u2022 ",e.user]})]})]},t))})]}),r.notes&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Notes"}),(0,Qe.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:r.notes})})]}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Quick Actions"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["active"===r.status&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsxs)("button",{onClick:()=>_(r.id,"Responding to emergency"),className:"p-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:[(0,Qe.jsx)(Tt,{className:"h-5 w-5 mx-auto mb-1"}),"Responding"]}),(0,Qe.jsxs)("button",{onClick:()=>_(r.id,"Emergency resolved"),className:"p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[(0,Qe.jsx)(kt,{className:"h-5 w-5 mx-auto mb-1"}),"Resolve"]})]}),(0,Qe.jsxs)("button",{className:"p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[(0,Qe.jsx)(lt,{className:"h-5 w-5 mx-auto mb-1"}),"Message"]}),(0,Qe.jsxs)("button",{className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:[(0,Qe.jsx)(Ct,{className:"h-5 w-5 mx-auto mb-1"}),"Photo"]})]})]})]})})]}):(0,Qe.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)(qe,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select an emergency"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Choose an emergency from the list to view details and take action"})]})})})]}),u&&(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Report Emergency"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Patient"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Qe.jsx)("option",{children:"Adunni Okafor"}),(0,Qe.jsx)("option",{children:"Grace Johnson"}),(0,Qe.jsx)("option",{children:"Michael Adebayo"}),(0,Qe.jsx)("option",{children:"Sarah Williams"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Type"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Qe.jsx)("option",{value:"medical",children:"Medical"}),(0,Qe.jsx)("option",{value:"fall",children:"Fall"}),(0,Qe.jsx)("option",{value:"medication",children:"Medication"}),(0,Qe.jsx)("option",{value:"fire",children:"Fire"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Qe.jsx)("option",{value:"critical",children:"Critical"}),(0,Qe.jsx)("option",{value:"high",children:"High"}),(0,Qe.jsx)("option",{value:"medium",children:"Medium"}),(0,Qe.jsx)("option",{value:"low",children:"Low"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,Qe.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:"3",placeholder:"Describe the emergency situation..."})]})]}),(0,Qe.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,Qe.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),(0,Qe.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Report Emergency"})]})]})})]})},dr=()=>{var e,n,r,i,s,a,o,c,l,d,u,h,p,m,f,g,v,y,_,E,b,x,w;const[S,T]=(0,t.useState)({}),[N,C]=(0,t.useState)(!0),[A,R]=(0,t.useState)("profile"),[I,O]=(0,t.useState)(!1),[P,k]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{T({profile:{firstName:"Sarah",lastName:"Johnson",email:"sarah.johnson@elderx.com",phone:"+234 805 123 4567",profileImage:null,dateOfBirth:"1985-03-15",address:"456 Victoria Island, Lagos",emergencyContact:"+234 802 345 6789",licenseNumber:"CAR123456",specialization:"Elderly Care",experience:"8 years",languages:["English","Yoruba","Hausa"],bio:"Dedicated caregiver with 8 years of experience in elderly care. Specialized in diabetes management and physical therapy assistance."},notifications:{emailNotifications:!0,smsNotifications:!0,pushNotifications:!0,taskReminders:!0,emergencyAlerts:!0,appointmentReminders:!0,medicationAlerts:!0,weeklyReports:!0,patientUpdates:!0,systemUpdates:!1},privacy:{profileVisibility:"private",locationSharing:!0,dataCollection:!0,analytics:!1,marketingEmails:!1,dataRetention:"2 years"},preferences:{theme:"light",language:"en",timezone:"Africa/Lagos",dateFormat:"DD/MM/YYYY",timeFormat:"24h",workingHours:{start:"08:00",end:"18:00"},breakDuration:30,maxPatientsPerDay:8},security:{twoFactorAuth:!1,biometricLogin:!0,sessionTimeout:30,passwordChangeRequired:!1,lastPasswordChange:"2024-01-01",loginNotifications:!0}}),C(!1)},1e3)}catch(e){console.error("Error loading settings:",e),C(!1)}})()},[]);const D=(e,t,n)=>{T(r=>(0,Ge.A)((0,Ge.A)({},r),{},{[e]:(0,Ge.A)((0,Ge.A)({},r[e]),{},{[t]:n})}))},L=[{id:"profile",name:"Profile",icon:ft},{id:"notifications",name:"Notifications",icon:mt},{id:"privacy",name:"Privacy",icon:Rt},{id:"preferences",name:"Preferences",icon:bt},{id:"security",name:"Security",icon:Rt}];return N?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Qe.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-600 flex items-center justify-center",children:(0,Qe.jsx)(bt,{className:"h-8 w-8 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-4",children:(0,Qe.jsxs)("button",{onClick:()=>{console.log("Saving settings:",S)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Qe.jsx)(Vn,{className:"h-5 w-5 mr-2"}),"Save Changes"]})})]})}),(0,Qe.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Qe.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 flex flex-col",children:(0,Qe.jsx)("div",{className:"p-4",children:(0,Qe.jsx)("nav",{className:"space-y-1",children:L.map(e=>{const t=e.icon;return(0,Qe.jsxs)("button",{onClick:()=>R(e.id),className:"w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(A===e.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:[(0,Qe.jsx)(t,{className:"h-5 w-5 mr-3"}),e.name]},e.id)})})})}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,Qe.jsxs)("div",{className:"p-8",children:["profile"===A&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Profile Information"}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,Qe.jsx)("div",{className:"h-24 w-24 bg-gray-200 rounded-full flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-12 w-12 text-gray-400"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Qe.jsx)(Ct,{className:"h-4 w-4 mr-2"}),"Change Photo"]}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"JPG, PNG up to 2MB"})]})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),(0,Qe.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(e=S.profile)||void 0===e?void 0:e.firstName)||"",onChange:e=>D("profile","firstName",e.target.value)})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),(0,Qe.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(n=S.profile)||void 0===n?void 0:n.lastName)||"",onChange:e=>D("profile","lastName",e.target.value)})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,Qe.jsx)("input",{type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(r=S.profile)||void 0===r?void 0:r.email)||"",onChange:e=>D("profile","email",e.target.value)})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),(0,Qe.jsx)("input",{type:"tel",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(i=S.profile)||void 0===i?void 0:i.phone)||"",onChange:e=>D("profile","phone",e.target.value)})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth"}),(0,Qe.jsx)("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(s=S.profile)||void 0===s?void 0:s.dateOfBirth)||"",onChange:e=>D("profile","dateOfBirth",e.target.value)})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Number"}),(0,Qe.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(a=S.profile)||void 0===a?void 0:a.licenseNumber)||"",onChange:e=>D("profile","licenseNumber",e.target.value)})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),(0,Qe.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",value:(null===(o=S.profile)||void 0===o?void 0:o.address)||"",onChange:e=>D("profile","address",e.target.value)})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,Qe.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"4",value:(null===(c=S.profile)||void 0===c?void 0:c.bio)||"",onChange:e=>D("profile","bio",e.target.value)})]})]}),"notifications"===A&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Notification Preferences"}),(0,Qe.jsx)("div",{className:"space-y-4",children:Object.entries(S.notifications||{}).map(e=>{let[t,n]=e;return(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900 capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600",children:["emailNotifications"===t&&"Receive notifications via email","smsNotifications"===t&&"Receive notifications via SMS","pushNotifications"===t&&"Receive push notifications","taskReminders"===t&&"Get reminded about upcoming tasks","emergencyAlerts"===t&&"Get immediate alerts for emergencies","appointmentReminders"===t&&"Get reminded about appointments","medicationAlerts"===t&&"Get alerts for medication schedules","weeklyReports"===t&&"Receive weekly performance reports","patientUpdates"===t&&"Get updates about patient status","systemUpdates"===t&&"Receive system maintenance notifications"]})]}),(0,Qe.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Qe.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:e=>D("notifications",t,e.target.checked)}),(0,Qe.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})})]}),"privacy"===A&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Privacy Settings"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profile Visibility"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(l=S.privacy)||void 0===l?void 0:l.profileVisibility)||"private",onChange:e=>D("privacy","profileVisibility",e.target.value),children:[(0,Qe.jsx)("option",{value:"public",children:"Public"}),(0,Qe.jsx)("option",{value:"private",children:"Private"}),(0,Qe.jsx)("option",{value:"contacts",children:"Contacts Only"})]})]}),(0,Qe.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Retention"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(d=S.privacy)||void 0===d?void 0:d.dataRetention)||"2 years",onChange:e=>D("privacy","dataRetention",e.target.value),children:[(0,Qe.jsx)("option",{value:"1 year",children:"1 Year"}),(0,Qe.jsx)("option",{value:"2 years",children:"2 Years"}),(0,Qe.jsx)("option",{value:"5 years",children:"5 Years"}),(0,Qe.jsx)("option",{value:"indefinite",children:"Indefinite"})]})]}),Object.entries(S.privacy||{}).filter(e=>{let[t]=e;return["locationSharing","dataCollection","analytics","marketingEmails"].includes(t)}).map(e=>{let[t,n]=e;return(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900 capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600",children:["locationSharing"===t&&"Allow location sharing for emergency response","dataCollection"===t&&"Allow data collection for service improvement","analytics"===t&&"Allow analytics tracking","marketingEmails"===t&&"Receive marketing emails and promotions"]})]}),(0,Qe.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Qe.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:e=>D("privacy",t,e.target.checked)}),(0,Qe.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})]})]}),"preferences"===A&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Preferences"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Theme"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(u=S.preferences)||void 0===u?void 0:u.theme)||"light",onChange:e=>D("preferences","theme",e.target.value),children:[(0,Qe.jsx)("option",{value:"light",children:"Light"}),(0,Qe.jsx)("option",{value:"dark",children:"Dark"}),(0,Qe.jsx)("option",{value:"auto",children:"Auto"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Language"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(h=S.preferences)||void 0===h?void 0:h.language)||"en",onChange:e=>D("preferences","language",e.target.value),children:[(0,Qe.jsx)("option",{value:"en",children:"English"}),(0,Qe.jsx)("option",{value:"yo",children:"Yoruba"}),(0,Qe.jsx)("option",{value:"ha",children:"Hausa"}),(0,Qe.jsx)("option",{value:"ig",children:"Igbo"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(p=S.preferences)||void 0===p?void 0:p.timezone)||"Africa/Lagos",onChange:e=>D("preferences","timezone",e.target.value),children:[(0,Qe.jsx)("option",{value:"Africa/Lagos",children:"Africa/Lagos (GMT+1)"}),(0,Qe.jsx)("option",{value:"Africa/Abuja",children:"Africa/Abuja (GMT+1)"}),(0,Qe.jsx)("option",{value:"Africa/Kano",children:"Africa/Kano (GMT+1)"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Format"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(m=S.preferences)||void 0===m?void 0:m.dateFormat)||"DD/MM/YYYY",onChange:e=>D("preferences","dateFormat",e.target.value),children:[(0,Qe.jsx)("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),(0,Qe.jsx)("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),(0,Qe.jsx)("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Format"}),(0,Qe.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(f=S.preferences)||void 0===f?void 0:f.timeFormat)||"24h",onChange:e=>D("preferences","timeFormat",e.target.value),children:[(0,Qe.jsx)("option",{value:"24h",children:"24 Hour"}),(0,Qe.jsx)("option",{value:"12h",children:"12 Hour"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Patients Per Day"}),(0,Qe.jsx)("input",{type:"number",min:"1",max:"15",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(g=S.preferences)||void 0===g?void 0:g.maxPatientsPerDay)||8,onChange:e=>D("preferences","maxPatientsPerDay",parseInt(e.target.value))})]})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Working Hours Start"}),(0,Qe.jsx)("input",{type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(v=S.preferences)||void 0===v||null===(y=v.workingHours)||void 0===y?void 0:y.start)||"08:00",onChange:e=>{var t;return D("preferences","workingHours",(0,Ge.A)((0,Ge.A)({},null===(t=S.preferences)||void 0===t?void 0:t.workingHours),{},{start:e.target.value}))}})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Working Hours End"}),(0,Qe.jsx)("input",{type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(_=S.preferences)||void 0===_||null===(E=_.workingHours)||void 0===E?void 0:E.end)||"18:00",onChange:e=>{var t;return D("preferences","workingHours",(0,Ge.A)((0,Ge.A)({},null===(t=S.preferences)||void 0===t?void 0:t.workingHours),{},{end:e.target.value}))}})]})]})]}),"security"===A&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Security Settings"}),(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Change Password"}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("input",{type:I?"text":"password",className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter current password"}),(0,Qe.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>O(!I),children:I?(0,Qe.jsx)(Ft,{className:"h-4 w-4 text-gray-400"}):(0,Qe.jsx)(Bt,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("input",{type:P?"text":"password",className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter new password"}),(0,Qe.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>k(!P),children:P?(0,Qe.jsx)(Ft,{className:"h-4 w-4 text-gray-400"}):(0,Qe.jsx)(Bt,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),(0,Qe.jsx)("input",{type:"password",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm new password"})]}),(0,Qe.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Change Password"})]})]}),(0,Qe.jsx)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Two-Factor Authentication"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Add an extra layer of security to your account"})]}),(0,Qe.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Qe.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:(null===(b=S.security)||void 0===b?void 0:b.twoFactorAuth)||!1,onChange:e=>D("security","twoFactorAuth",e.target.checked)}),(0,Qe.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),(0,Qe.jsx)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Biometric Login"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Use fingerprint or face recognition to log in"})]}),(0,Qe.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Qe.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:(null===(x=S.security)||void 0===x?void 0:x.biometricLogin)||!0,onChange:e=>D("security","biometricLogin",e.target.checked)}),(0,Qe.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),(0,Qe.jsxs)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Session Timeout"}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Auto-logout after"}),(0,Qe.jsxs)("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(w=S.security)||void 0===w?void 0:w.sessionTimeout)||30,onChange:e=>D("security","sessionTimeout",parseInt(e.target.value)),children:[(0,Qe.jsx)("option",{value:"15",children:"15 minutes"}),(0,Qe.jsx)("option",{value:"30",children:"30 minutes"}),(0,Qe.jsx)("option",{value:"60",children:"1 hour"}),(0,Qe.jsx)("option",{value:"120",children:"2 hours"})]})]})]})]})]})]})})]})]})},ur=Ke("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),hr=Ke("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),pr=Ke("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),mr=Ke("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),fr=Ke("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]),gr=Ke("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),vr=Ke("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);var yr=n(1635),_r=n.n(yr);const Er=new class{constructor(){this.config={appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_AGORA_APP_ID||"43c43dc3e6a44a99b2b75a4997e3b1a4",defaultToken:null,tokenExpiration:3600}}async generateToken(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"publisher";try{0;return(await this.callTokenServer(e,t,n)).token}catch(r){return console.error("Failed to generate Agora token:",r),console.log("\ud83d\udd04 Falling back to null token for testing"),null}}async callTokenServer(e,t,n){const r={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_AGORA_TOKEN_ENDPOINT||"/api/agora/token",i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:e,uid:t,role:n,expiration:this.config.tokenExpiration})});if(!i.ok)throw new Error("Token server responded with status: ".concat(i.status));return await i.json()}async refreshToken(e,t,n){return console.log("\ud83d\udd04 Refreshing Agora token..."),await this.generateToken(e,t,n)}isTokenExpired(e){return["CAN_NOT_GET_GATEWAY_SERVER","INVALID_VENDOR_KEY","DYNAMIC_KEY_TIMEOUT","TOKEN_EXPIRED"].some(t=>{var n,r;return(null===(n=e.message)||void 0===n?void 0:n.includes(t))||(null===(r=e.code)||void 0===r?void 0:r.includes(t))})}getAppId(){return this.config.appId}validateConfig(){if(!this.config.appId||"your-agora-app-id"===this.config.appId)throw new Error("Agora App ID is not configured. Please set REACT_APP_AGORA_APP_ID environment variable.");return!0}};const br=new class{constructor(){this.client=null,this.localVideoTrack=null,this.localAudioTrack=null,this.remoteUsers=new Map,this.isJoined=!1,this.isPublished=!1,this.isInitialized=!1,this.eventListeners=new Map,this.config={appId:Er.getAppId(),channel:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"https://us-central1-elderx-f5c2b.cloudfunctions.net",REACT_APP_DEBUG_MODE:"false",REACT_APP_ENABLE_2FA:"false",REACT_APP_ENABLE_AI_FEATURES:"false",REACT_APP_ENABLE_AUDIT_LOG:"true",REACT_APP_ENABLE_BIOMETRIC:"false",REACT_APP_ENABLE_EMERGENCY_ALERTS:"true",REACT_APP_ENABLE_ENCRYPTION:"true",REACT_APP_ENABLE_MEDICATION_REMINDERS:"true",REACT_APP_ENABLE_RATE_LIMITING:"true",REACT_APP_ENABLE_VOICE_COMMANDS:"true",REACT_APP_ENCRYPTION_KEY:"ZGV2ZWxvcG1lbnRfa2V5XzEyMzQ1Njc4OTA=",REACT_APP_ENVIRONMENT:"production",REACT_APP_FIREBASE_API_KEY:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",REACT_APP_FIREBASE_APP_ID:"1:987610993096:web:97c82732772d1223d3f0fd",REACT_APP_FIREBASE_AUTH_DOMAIN:"elderx-f5c2b.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"987610993096",REACT_APP_FIREBASE_PROJECT_ID:"elderx-f5c2b",REACT_APP_FIREBASE_STORAGE_BUCKET:"elderx-f5c2b.firebasestorage.app",REACT_APP_JWT_SECRET:"ZGV2ZWxvcG1lbnRfand0X3NlY3JldF9rZXk=",REACT_APP_USE_EMULATORS:"false"}.REACT_APP_AGORA_CHANNEL||"elderx_dev",token:null,uid:null,mode:"rtc",codec:"vp8"}}async initialize(){try{if(this.isInitialized)return!0;if(!this.config.appId)throw new Error("Agora App ID is required");return this.client=_r().createClient({mode:this.config.mode,codec:this.config.codec}),this.setupEventListeners(),this.isInitialized=!0,this.triggerEvent("initialized",{}),!0}catch(e){throw console.error("Failed to initialize Agora client:",e),this.triggerEvent("error",{type:"initialization",error:e.message}),e}}setupEventListeners(){this.client&&(this.client.on("user-published",async(e,t)=>{console.log("User published:",e,t);try{if(await this.client.subscribe(e,t),"video"===t&&this.remoteUsers.set(e.uid,(0,Ge.A)((0,Ge.A)({},e),{},{videoTrack:e.videoTrack})),"audio"===t&&this.remoteUsers.set(e.uid,(0,Ge.A)((0,Ge.A)({},e),{},{audioTrack:e.audioTrack})),"video"===t){const t=document.getElementById("remote-video-".concat(e.uid));t&&e.videoTrack.play(t)}"audio"===t&&e.audioTrack.play(),this.triggerEvent("user-published",{user:e,mediaType:t})}catch(n){console.error("Failed to subscribe user:",n)}}),this.client.on("user-unpublished",(e,t)=>{console.log("User unpublished:",e,t),"video"===t&&this.remoteUsers.delete(e.uid),this.triggerEvent("user-unpublished",{user:e,mediaType:t})}),this.client.on("user-left",e=>{console.log("User left:",e),this.remoteUsers.delete(e.uid),this.triggerEvent("user-left",{user:e})}),this.client.on("connection-state-change",(e,t)=>{console.log("Connection state changed:",e,t),this.triggerEvent("connection-state-change",{curState:e,revState:t})}))}async joinChannel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(this.isInitialized||await this.initialize(),this.isJoined)return console.warn("Already joined a channel"),this.config.uid;const n=t||this.config.channel,r=e||Math.floor(1e5*Math.random());if(this.config.uid=r,!n||""===n.trim())throw new Error("Channel name is required");console.log("\ud83d\udd11 Generating Agora token for channel:",n);const i=await Er.generateToken(n,r,"publisher");return await this.client.join(this.config.appId,n,i,r),this.isJoined=!0,console.log("Successfully joined channel:",n),await this.createLocalTracks(),await this.publishLocalTracks(),this.triggerEvent("joined",{uid:r,channel:n}),r}catch(n){if(console.error("Failed to join channel:",n),Er.isTokenExpired(n)){console.log("\ud83d\udd04 Token expired, attempting to refresh and retry...");try{const n=t||this.config.channel,r=e||Math.floor(1e5*Math.random()),i=await Er.refreshToken(n,r,"publisher");return await this.client.join(this.config.appId,n,i,r),this.isJoined=!0,this.config.uid=r,console.log("\u2705 Successfully joined channel after token refresh:",n),await this.createLocalTracks(),await this.publishLocalTracks(),this.triggerEvent("joined",{uid:r,channel:n}),r}catch(r){console.error("Failed to join even after token refresh:",r)}}throw this.triggerEvent("error",{type:"join",error:n.message,isTokenError:Er.isTokenExpired(n)}),n}}async createLocalTracks(){try{const e=await this.checkCameraPermission(),t=await this.checkMicrophonePermission();if(!e&&!t)throw new Error("Camera and microphone access are required for video calls");if(e&&(this.localVideoTrack=await _r().createCameraVideoTrack({encoderConfig:"720p_1"})),t&&(this.localAudioTrack=await _r().createMicrophoneAudioTrack()),this.localVideoTrack){const e=document.getElementById("local-video");e&&this.localVideoTrack.play(e)}console.log("Local tracks created successfully"),this.triggerEvent("tracks-created",{hasVideo:!!this.localVideoTrack,hasAudio:!!this.localAudioTrack})}catch(e){throw console.error("Failed to create local tracks:",e),this.triggerEvent("error",{type:"track-creation",error:e.message}),e}}async checkCameraPermission(){try{return(await _r().getCameras()).length>0}catch(e){return console.warn("Camera permission check failed:",e),!1}}async checkMicrophonePermission(){try{return(await _r().getMicrophones()).length>0}catch(e){return console.warn("Microphone permission check failed:",e),!1}}async publishLocalTracks(){try{if(!this.client)throw new Error("Client not initialized");const e=[];if(this.localVideoTrack&&e.push(this.localVideoTrack),this.localAudioTrack&&e.push(this.localAudioTrack),0===e.length)throw new Error("No tracks available to publish");await this.client.publish(e),this.isPublished=!0,console.log("Local tracks published successfully"),this.triggerEvent("published",{videoPublished:!!this.localVideoTrack,audioPublished:!!this.localAudioTrack})}catch(e){throw console.error("Failed to publish local tracks:",e),this.triggerEvent("error",{type:"publish",error:e.message}),e}}async leaveChannel(){try{this.client&&this.isJoined&&(this.isPublished&&await this.client.unpublish([this.localVideoTrack,this.localAudioTrack]),await this.client.leave(),this.isJoined=!1,this.isPublished=!1),this.localVideoTrack&&(this.localVideoTrack.stop(),this.localVideoTrack.close(),this.localVideoTrack=null),this.localAudioTrack&&(this.localAudioTrack.stop(),this.localAudioTrack.close(),this.localAudioTrack=null),this.remoteUsers.clear(),console.log("Successfully left channel"),this.triggerEvent("left",{})}catch(e){throw console.error("Failed to leave channel:",e),e}}async toggleVideo(){try{if(this.localVideoTrack)return await this.localVideoTrack.setEnabled(!this.localVideoTrack.enabled),this.triggerEvent("video-toggled",{enabled:this.localVideoTrack.enabled}),this.localVideoTrack.enabled}catch(e){throw console.error("Failed to toggle video:",e),e}}async toggleAudio(){try{if(this.localAudioTrack)return await this.localAudioTrack.setEnabled(!this.localAudioTrack.enabled),this.triggerEvent("audio-toggled",{enabled:this.localAudioTrack.enabled}),this.localAudioTrack.enabled}catch(e){throw console.error("Failed to toggle audio:",e),e}}getConnectionState(){return this.client?this.client.connectionState:"DISCONNECTED"}getRemoteUsers(){return Array.from(this.remoteUsers.values())}isVideoEnabled(){return!!this.localVideoTrack&&this.localVideoTrack.enabled}isAudioEnabled(){return!!this.localAudioTrack&&this.localAudioTrack.enabled}async getAvailableDevices(){try{const[e,t]=await Promise.all([_r().getCameras(),_r().getMicrophones()]);return{cameras:e.map(e=>({deviceId:e.deviceId,label:e.label||"Camera"})),microphones:t.map(e=>({deviceId:e.deviceId,label:e.label||"Microphone"}))}}catch(e){return console.error("Failed to get devices:",e),{cameras:[],microphones:[]}}}async switchCamera(e){try{if(!this.localVideoTrack)throw new Error("No video track available");await this.localVideoTrack.setDevice(e),this.triggerEvent("camera-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch camera:",t),this.triggerEvent("error",{type:"camera-switch",error:t.message}),t}}async switchMicrophone(e){try{if(!this.localAudioTrack)throw new Error("No audio track available");await this.localAudioTrack.setDevice(e),this.triggerEvent("microphone-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch microphone:",t),this.triggerEvent("error",{type:"microphone-switch",error:t.message}),t}}async startRecording(){try{if(!this.client||!this.isJoined)throw new Error("Must be in a call to start recording");return this.triggerEvent("recording-started",{}),!0}catch(e){throw console.error("Failed to start recording:",e),this.triggerEvent("error",{type:"recording-start",error:e.message}),e}}async stopRecording(){try{return this.triggerEvent("recording-stopped",{}),!0}catch(e){throw console.error("Failed to stop recording:",e),this.triggerEvent("error",{type:"recording-stop",error:e.message}),e}}getRecordingStatus(){return{isRecording:!1,recordingId:null,startTime:null}}triggerEvent(e,t){const n=new CustomEvent("agora-".concat(e),{detail:t});window.dispatchEvent(n)}destroy(){this.leaveChannel(),this.client=null}},xr=br,wr="telemedicine_appointments",Sr="telemedicine_calls",Tr="telemedicine_recordings",Nr="doctors";const Cr=new class{async createAppointment(e){try{const t=(0,Ge.A)((0,Ge.A)({},e),{},{createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)(),status:"scheduled"}),n=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,wr),t);return(0,Ge.A)({id:n.id},t)}catch(t){throw console.error("Error creating appointment:",t),t}}async getAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const n="patient"===t?"patientId":"doctorId",r=(0,Vt.P)((0,Vt.rJ)(Fe.db,wr),(0,Vt._M)(n,"==",e),(0,Vt.My)("appointmentDate","asc")),i=await(0,Vt.GG)(r),s=[];return i.forEach(e=>{s.push((0,Ge.A)({id:e.id},e.data()))}),s}catch(n){throw console.error("Error getting appointments:",n),n}}async getUpcomingAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const n=new Date,r="patient"===t?"patientId":"doctorId",i=(0,Vt.P)((0,Vt.rJ)(Fe.db,wr),(0,Vt._M)(r,"==",e),(0,Vt._M)("appointmentDate",">=",Vt.Dc.fromDate(n)),(0,Vt._M)("status","==","scheduled"),(0,Vt.My)("appointmentDate","asc")),s=await(0,Vt.GG)(i),a=[];return s.forEach(e=>{a.push((0,Ge.A)({id:e.id},e.data()))}),a}catch(n){throw console.error("Error getting upcoming appointments:",n),n}}async updateAppointmentStatus(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const r=(0,Vt.H9)(Fe.db,wr,e);return await(0,Vt.mZ)(r,(0,Ge.A)({status:t,updatedAt:(0,Vt.O5)()},n)),!0}catch(r){throw console.error("Error updating appointment status:",r),r}}async startCall(e,t){try{const n=(0,Ge.A)((0,Ge.A)({appointmentId:e},t),{},{startTime:(0,Vt.O5)(),status:"active",createdAt:(0,Vt.O5)()}),r=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,Sr),n);return await this.updateAppointmentStatus(e,"in-progress",{callId:r.id}),(0,Ge.A)({id:r.id},n)}catch(n){throw console.error("Error starting call:",n),n}}async endCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=(0,Vt.H9)(Fe.db,Sr,e);await(0,Vt.mZ)(n,(0,Ge.A)({endTime:(0,Vt.O5)(),status:"completed",updatedAt:(0,Vt.O5)()},t));const r=await(0,Vt.x7)(n);if(r.exists()){const e=r.data();await this.updateAppointmentStatus(e.appointmentId,"completed")}return!0}catch(n){throw console.error("Error ending call:",n),n}}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const n="patient"===t?"patientId":"doctorId",r=(0,Vt.P)((0,Vt.rJ)(Fe.db,Sr),(0,Vt._M)(n,"==",e),(0,Vt.My)("startTime","desc"),(0,Vt.AB)(50)),i=await(0,Vt.GG)(r),s=[];return i.forEach(e=>{s.push((0,Ge.A)({id:e.id},e.data()))}),s}catch(n){throw console.error("Error getting call history:",n),n}}async saveRecording(e,t){try{const n=(0,Ge.A)((0,Ge.A)({callId:e},t),{},{createdAt:(0,Vt.O5)()}),r=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,Tr),n),i=(0,Vt.H9)(Fe.db,Sr,e);return await(0,Vt.mZ)(i,{recordingId:r.id,hasRecording:!0,updatedAt:(0,Vt.O5)()}),(0,Ge.A)({id:r.id},n)}catch(n){throw console.error("Error saving recording:",n),n}}async getCallRecordings(e){try{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,Tr),(0,Vt._M)("callId","==",e)),n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{r.push((0,Ge.A)({id:e.id},e.data()))}),r}catch(t){throw console.error("Error getting call recordings:",t),t}}async getAvailableDoctors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=(0,Vt.P)((0,Vt.rJ)(Fe.db,Nr),(0,Vt._M)("isActive","==",!0));e&&(t=(0,Vt.P)(t,(0,Vt._M)("specialty","==",e)));const n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{r.push((0,Ge.A)({id:e.id},e.data()))}),r}catch(t){throw console.error("Error getting available doctors:",t),t}}async getDoctor(e){try{const t=(0,Vt.H9)(Fe.db,Nr,e),n=await(0,Vt.x7)(t);if(n.exists())return(0,Ge.A)({id:n.id},n.data());throw new Error("Doctor not found")}catch(t){throw console.error("Error getting doctor:",t),t}}subscribeToAppointments(e,t,n){const r="patient"===t?"patientId":"doctorId",i=(0,Vt.P)((0,Vt.rJ)(Fe.db,wr),(0,Vt._M)(r,"==",e),(0,Vt.My)("appointmentDate","asc"));return(0,Vt.aQ)(i,e=>{const t=[];e.forEach(e=>{t.push((0,Ge.A)({id:e.id},e.data()))}),n(t)})}subscribeToCalls(e,t,n){const r="patient"===t?"patientId":"doctorId",i=(0,Vt.P)((0,Vt.rJ)(Fe.db,Sr),(0,Vt._M)(r,"==",e),(0,Vt.My)("startTime","desc"));return(0,Vt.aQ)(i,e=>{const t=[];e.forEach(e=>{t.push((0,Ge.A)({id:e.id},e.data()))}),n(t)})}convertTimestamp(e){return e&&e.toDate?e.toDate():e}formatAppointmentForDisplay(e){return(0,Ge.A)((0,Ge.A)({},e),{},{appointmentDate:this.convertTimestamp(e.appointmentDate),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}formatCallForDisplay(e){return(0,Ge.A)((0,Ge.A)({},e),{},{startTime:this.convertTimestamp(e.startTime),endTime:this.convertTimestamp(e.endTime),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}},Ar=Ke("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Rr=e=>{let{invoiceData:t,onDownload:n,showDownloadButton:r=!0}=e;const{invoiceNumber:i,appointmentId:s,patientInfo:a,doctorInfo:o,consultationDate:c,services:l,subtotal:d,tax:u,total:h,paymentStatus:p,paymentMethod:m,dueDate:f,notes:g}=t,v=e=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(e),y=e=>new Date(e).toLocaleDateString("en-NG",{year:"numeric",month:"long",day:"numeric"});return(0,Qe.jsxs)("div",{className:"max-w-4xl mx-auto bg-white shadow-lg",id:"invoice-template",children:[(0,Qe.jsx)("div",{className:"bg-blue-600 text-white p-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-3xl font-bold",children:"ElderX Healthcare"}),(0,Qe.jsx)("p",{className:"text-blue-100 mt-2",children:"Professional Healthcare Services"}),(0,Qe.jsxs)("div",{className:"mt-4 text-sm",children:[(0,Qe.jsx)("p",{children:"\ud83d\udccd Lagos, Nigeria"}),(0,Qe.jsx)("p",{children:"\ud83d\udcde +234 800 ELDERX (353379)"}),(0,Qe.jsx)("p",{children:"\u2709\ufe0f billing@elderx.com"}),(0,Qe.jsx)("p",{children:"\ud83c\udf10 www.elderx.com"})]})]}),(0,Qe.jsxs)("div",{className:"text-right",children:[(0,Qe.jsxs)("div",{className:"bg-white text-blue-600 px-4 py-2 rounded-lg",children:[(0,Qe.jsx)("h2",{className:"text-xl font-bold",children:"INVOICE"}),(0,Qe.jsxs)("p",{className:"text-sm",children:["#",i]})]}),(0,Qe.jsxs)("div",{className:"mt-4 text-sm",children:[(0,Qe.jsxs)("p",{children:["Date: ",y(new Date)]}),(0,Qe.jsxs)("p",{children:["Due Date: ",y(f)]}),"paid"===p&&(0,Qe.jsxs)("div",{className:"flex items-center mt-2 text-green-300",children:[(0,Qe.jsx)(kt,{className:"h-4 w-4 mr-1"}),(0,Qe.jsx)("span",{children:"PAID"})]})]})]})]})}),(0,Qe.jsxs)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[(0,Qe.jsx)(ft,{className:"h-5 w-5 mr-2"}),"Bill To"]}),(0,Qe.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,Qe.jsx)("p",{className:"font-semibold text-lg",children:a.name}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-1",children:a.email}),(0,Qe.jsx)("p",{className:"text-gray-600",children:a.phone}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-2",children:a.address}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Patient ID: ",a.id]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[(0,Qe.jsx)(xt,{className:"h-5 w-5 mr-2"}),"Service Provider"]}),(0,Qe.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,Qe.jsx)("p",{className:"font-semibold text-lg",children:o.name}),(0,Qe.jsx)("p",{className:"text-gray-600",children:o.specialty}),(0,Qe.jsx)("p",{className:"text-gray-600",children:o.email}),(0,Qe.jsx)("p",{className:"text-gray-600",children:o.phone}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["License: ",o.licenseNumber||"N/A"]})]})]})]}),(0,Qe.jsxs)("div",{className:"px-6 pb-4",children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[(0,Qe.jsx)(at,{className:"h-5 w-5 mr-2"}),"Consultation Details"]}),(0,Qe.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Appointment ID"}),(0,Qe.jsx)("p",{className:"font-semibold",children:s})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Consultation Date"}),(0,Qe.jsx)("p",{className:"font-semibold",children:y(c)})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Type"}),(0,Qe.jsx)("p",{className:"font-semibold",children:"Telemedicine Consultation"})]})]})})]}),(0,Qe.jsxs)("div",{className:"px-6 pb-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Services Provided"}),(0,Qe.jsx)("div",{className:"overflow-x-auto",children:(0,Qe.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,Qe.jsx)("thead",{children:(0,Qe.jsxs)("tr",{className:"bg-gray-100",children:[(0,Qe.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-left",children:"Description"}),(0,Qe.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-center",children:"Duration"}),(0,Qe.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-right",children:"Rate"}),(0,Qe.jsx)("th",{className:"border border-gray-300 px-4 py-3 text-right",children:"Amount"})]})}),(0,Qe.jsx)("tbody",{children:l.map((e,t)=>(0,Qe.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Qe.jsx)("td",{className:"border border-gray-300 px-4 py-3",children:(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"font-semibold",children:e.description}),e.details&&(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:e.details})]})}),(0,Qe.jsxs)("td",{className:"border border-gray-300 px-4 py-3 text-center",children:[e.duration," min"]}),(0,Qe.jsx)("td",{className:"border border-gray-300 px-4 py-3 text-right",children:v(e.rate)}),(0,Qe.jsx)("td",{className:"border border-gray-300 px-4 py-3 text-right font-semibold",children:v(e.amount)})]},t))})]})})]}),(0,Qe.jsx)("div",{className:"px-6 pb-6",children:(0,Qe.jsx)("div",{className:"flex justify-end",children:(0,Qe.jsx)("div",{className:"w-full md:w-1/2",children:(0,Qe.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{children:"Subtotal:"}),(0,Qe.jsx)("span",{children:v(d)})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{children:"Tax (7.5% VAT):"}),(0,Qe.jsx)("span",{children:v(u)})]}),(0,Qe.jsx)("hr",{className:"my-2"}),(0,Qe.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,Qe.jsx)("span",{children:"Total:"}),(0,Qe.jsx)("span",{className:"text-blue-600",children:v(h)})]})]})})})})}),(0,Qe.jsx)("div",{className:"px-6 pb-6",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[(0,Qe.jsx)(dt,{className:"h-5 w-5 mr-2"}),"Payment Information"]}),(0,Qe.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,Qe.jsx)("span",{className:"font-semibold ".concat("paid"===p?"text-green-600":"pending"===p?"text-yellow-600":"text-red-600"),children:p.toUpperCase()})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Method:"}),(0,Qe.jsx)("span",{children:m})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Due Date:"}),(0,Qe.jsx)("span",{children:y(f)})]})]})})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Notes"}),(0,Qe.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,Qe.jsx)("p",{className:"text-gray-700",children:g||"Thank you for choosing ElderX Healthcare. Your health and well-being are our top priority."})})]})]})}),(0,Qe.jsx)("div",{className:"bg-gray-100 p-6 border-t",children:(0,Qe.jsxs)("div",{className:"text-center text-sm text-gray-600",children:[(0,Qe.jsxs)("p",{className:"mb-2",children:[(0,Qe.jsx)("strong",{children:"ElderX Healthcare Services"})," - Professional Telemedicine Platform"]}),(0,Qe.jsx)("p",{children:"This invoice is generated electronically and is valid without signature. For questions about this invoice, please contact our billing department."}),(0,Qe.jsxs)("div",{className:"mt-4 flex justify-center space-x-4",children:[(0,Qe.jsx)("span",{children:"\ud83d\udcde +234 800 ELDERX"}),(0,Qe.jsx)("span",{children:"\u2709\ufe0f billing@elderx.com"}),(0,Qe.jsx)("span",{children:"\ud83c\udf10 www.elderx.com"})]})]})}),r&&(0,Qe.jsx)("div",{className:"p-6 border-t bg-white",children:(0,Qe.jsx)("div",{className:"flex justify-center",children:(0,Qe.jsxs)("button",{onClick:n,className:"flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,Qe.jsx)(An,{className:"h-5 w-5 mr-2"}),"Download Invoice PDF"]})})})]})},Ir=e=>{var t;let{prescriptionData:n,onDownload:r,showDownloadButton:i=!0}=e;const{prescriptionNumber:s,appointmentId:a,patientInfo:o,doctorInfo:c,consultationDate:l,medications:d,diagnosis:u,symptoms:h,vitalSigns:p,instructions:m,followUpDate:f,emergencyInstructions:g,validUntil:v}=n,y=e=>new Date(e).toLocaleDateString("en-NG",{year:"numeric",month:"long",day:"numeric"});return(0,Qe.jsxs)("div",{className:"max-w-4xl mx-auto bg-white shadow-lg",id:"prescription-template",children:[(0,Qe.jsx)("div",{className:"bg-green-600 text-white p-6",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-3xl font-bold",children:"ElderX Healthcare"}),(0,Qe.jsx)("p",{className:"text-green-100 mt-2",children:"Professional Medical Prescription"}),(0,Qe.jsxs)("div",{className:"mt-4 text-sm",children:[(0,Qe.jsx)("p",{children:"\ud83d\udccd Lagos, Nigeria"}),(0,Qe.jsx)("p",{children:"\ud83d\udcde +234 800 ELDERX (353379)"}),(0,Qe.jsx)("p",{children:"\u2709\ufe0f prescriptions@elderx.com"}),(0,Qe.jsx)("p",{children:"\ud83c\udf10 www.elderx.com"})]})]}),(0,Qe.jsxs)("div",{className:"text-right",children:[(0,Qe.jsxs)("div",{className:"bg-white text-green-600 px-4 py-2 rounded-lg",children:[(0,Qe.jsx)("h2",{className:"text-xl font-bold",children:"PRESCRIPTION"}),(0,Qe.jsxs)("p",{className:"text-sm",children:["#",s]})]}),(0,Qe.jsxs)("div",{className:"mt-4 text-sm",children:[(0,Qe.jsxs)("p",{children:["Date: ",y(l)]}),(0,Qe.jsxs)("p",{children:["Time: ",(_=l,new Date(_).toLocaleTimeString("en-NG",{hour:"2-digit",minute:"2-digit"}))]}),(0,Qe.jsxs)("p",{children:["Valid Until: ",y(v)]})]})]})]})}),(0,Qe.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,Qe.jsx)(St,{className:"h-5 w-5 mr-2"}),"Prescribing Physician"]}),(0,Qe.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"font-bold text-lg text-green-800",children:c.name}),(0,Qe.jsx)("p",{className:"text-green-700",children:c.specialty}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-2",children:null===(t=c.qualifications)||void 0===t?void 0:t.join(", ")})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("p",{className:"text-gray-600",children:["\ud83d\udce7 ",c.email]}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["\ud83d\udcde ",c.phone]}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["\ud83c\udfe5 ",c.hospital||"ElderX Telemedicine"]}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Medical License: ",c.licenseNumber]})]})]})})]}),(0,Qe.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,Qe.jsx)(ft,{className:"h-5 w-5 mr-2"}),"Patient Information"]}),(0,Qe.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"font-bold text-lg",children:o.name}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["Age: ",o.age," years"]}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["Gender: ",o.gender]}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["\ud83d\udcde ",o.phone]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("p",{className:"text-gray-600",children:["\ud83d\udce7 ",o.email]}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["\ud83d\udccd ",o.address]}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Patient ID: ",o.id]}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500",children:["Appointment: ",a]})]})]})})]}),(0,Qe.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Clinical Assessment"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Diagnosis"}),(0,Qe.jsx)("div",{className:"bg-yellow-50 p-3 rounded-lg",children:(0,Qe.jsx)("p",{className:"text-gray-800",children:u})})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Presenting Symptoms"}),(0,Qe.jsx)("div",{className:"bg-red-50 p-3 rounded-lg",children:(0,Qe.jsx)("ul",{className:"list-disc list-inside text-gray-800",children:null===h||void 0===h?void 0:h.map((e,t)=>(0,Qe.jsx)("li",{children:e},t))})})]}),p&&(0,Qe.jsxs)("div",{className:"md:col-span-2",children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Vital Signs"}),(0,Qe.jsx)("div",{className:"bg-green-50 p-3 rounded-lg",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Blood Pressure"}),(0,Qe.jsx)("p",{className:"font-semibold",children:p.bloodPressure||"N/A"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Heart Rate"}),(0,Qe.jsxs)("p",{className:"font-semibold",children:[p.heartRate||"N/A"," bpm"]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Temperature"}),(0,Qe.jsxs)("p",{className:"font-semibold",children:[p.temperature||"N/A","\xb0F"]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Weight"}),(0,Qe.jsxs)("p",{className:"font-semibold",children:[p.weight||"N/A"," kg"]})]})]})})]})]})]}),(0,Qe.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,Qe.jsx)(wt,{className:"h-5 w-5 mr-2"}),"Prescription Details"]}),(0,Qe.jsx)("div",{className:"space-y-4",children:null===d||void 0===d?void 0:d.map((e,t)=>(0,Qe.jsxs)("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,Qe.jsxs)("div",{className:"md:col-span-2",children:[(0,Qe.jsx)("h4",{className:"font-bold text-lg text-gray-800",children:e.name}),(0,Qe.jsx)("p",{className:"text-gray-600",children:e.genericName}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e.form," \u2022 ",e.strength]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Dosage"}),(0,Qe.jsx)("p",{className:"font-semibold",children:e.dosage}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Frequency"}),(0,Qe.jsx)("p",{className:"font-semibold",children:e.frequency})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Duration"}),(0,Qe.jsx)("p",{className:"font-semibold",children:e.duration}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Quantity"}),(0,Qe.jsx)("p",{className:"font-semibold",children:e.quantity})]})]}),e.instructions&&(0,Qe.jsx)("div",{className:"mt-3 p-3 bg-blue-50 rounded border-l-4 border-blue-400",children:(0,Qe.jsxs)("p",{className:"text-sm",children:[(0,Qe.jsx)("strong",{children:"Instructions:"})," ",e.instructions]})}),e.warnings&&(0,Qe.jsx)("div",{className:"mt-2 p-3 bg-red-50 rounded border-l-4 border-red-400",children:(0,Qe.jsxs)("p",{className:"text-sm flex items-start",children:[(0,Qe.jsx)(qe,{className:"h-4 w-4 text-red-500 mr-2 mt-0.5 flex-shrink-0"}),(0,Qe.jsxs)("span",{children:[(0,Qe.jsx)("strong",{children:"Warning:"})," ",e.warnings]})]})})]},t))})]}),(0,Qe.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[(0,Qe.jsx)(xt,{className:"h-5 w-5 mr-2"}),"General Instructions"]}),(0,Qe.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,Qe.jsx)("p",{className:"text-gray-800 whitespace-pre-line",children:m})})]}),(0,Qe.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[(0,Qe.jsx)(at,{className:"h-5 w-5 mr-2"}),"Follow-up Care"]}),(0,Qe.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,Qe.jsx)("p",{className:"font-semibold",children:"Next Appointment"}),(0,Qe.jsx)("p",{className:"text-gray-700",children:y(f)}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Please schedule a follow-up consultation to monitor your progress."})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[(0,Qe.jsx)(qe,{className:"h-5 w-5 mr-2"}),"Emergency Contact"]}),(0,Qe.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg",children:[(0,Qe.jsx)("p",{className:"font-semibold text-red-800",children:"If you experience severe side effects:"}),(0,Qe.jsx)("p",{className:"text-red-700 mt-1",children:"\ud83d\udea8 Call Emergency: 199 or 112"}),(0,Qe.jsx)("p",{className:"text-red-700",children:"\ud83d\udcde ElderX 24/7 Hotline: +234 800 ELDERX"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:g||"Seek immediate medical attention for any severe adverse reactions."})]})]})]})}),(0,Qe.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Qe.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)(Rt,{className:"h-6 w-6 text-green-600 mt-1"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-gray-800",children:"Digital Prescription Verification"}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["This digital prescription is valid and authorized by ",c.name,", Medical License #",c.licenseNumber,". Valid until ",y(v),"."]}),(0,Qe.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Prescription ID: ",s," | Generated: ",y(new Date)]})]})]})})}),(0,Qe.jsx)("div",{className:"bg-gray-100 p-6",children:(0,Qe.jsxs)("div",{className:"text-center text-sm text-gray-600",children:[(0,Qe.jsxs)("p",{className:"mb-2",children:[(0,Qe.jsx)("strong",{children:"ElderX Healthcare Services"})," - Digital Health Platform"]}),(0,Qe.jsx)("p",{className:"mb-2",children:"This prescription is generated electronically and is valid for medical use. Please present this document to your pharmacist."}),(0,Qe.jsxs)("div",{className:"mt-4 flex justify-center space-x-4",children:[(0,Qe.jsx)("span",{children:"\ud83d\udcde +234 800 ELDERX"}),(0,Qe.jsx)("span",{children:"\u2709\ufe0f prescriptions@elderx.com"}),(0,Qe.jsx)("span",{children:"\ud83c\udf10 www.elderx.com"})]}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500 mt-4",children:"\u26a0\ufe0f Important: Do not share this prescription with others. Follow all medication instructions carefully."})]})}),i&&(0,Qe.jsx)("div",{className:"p-6 border-t bg-white",children:(0,Qe.jsx)("div",{className:"flex justify-center",children:(0,Qe.jsxs)("button",{onClick:r,className:"flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,Qe.jsx)(An,{className:"h-5 w-5 mr-2"}),"Download Prescription PDF"]})})})]});var _};const Or=new class{constructor(){this.printOptions={margin:"0.5in",format:"A4",orientation:"portrait",quality:"high"}}async generatePDF(e,t){try{const n=document.getElementById(e);if(!n)throw new Error("Element with ID '".concat(e,"' not found"));const r=window.open("","_blank","width=800,height=600");if(!r)throw new Error("Unable to open print window. Please allow popups.");const i=Array.from(document.styleSheets).map(e=>{try{if(e.href)return'<link rel="stylesheet" href="'.concat(e.href,'">');{const t=Array.from(e.cssRules||e.rules||[]).map(e=>e.cssText).join("\n");return"<style>".concat(t,"</style>")}}catch(ts){return e.href?'<link rel="stylesheet" href="'.concat(e.href,'">'):""}}).join("\n"),s="\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>".concat(t,'</title>\n          <meta charset="UTF-8">\n          <meta name="viewport" content="width=device-width, initial-scale=1.0">\n          ').concat(i,"\n          <style>\n            @media print {\n              body { \n                margin: 0; \n                padding: 20px;\n                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n                line-height: 1.4;\n                color: #000;\n                background: white;\n              }\n              .no-print { display: none !important; }\n              .page-break { page-break-before: always; }\n              .avoid-break { page-break-inside: avoid; }\n              \n              /* Ensure good print quality */\n              * { \n                -webkit-print-color-adjust: exact !important;\n                color-adjust: exact !important;\n              }\n              \n              /* Hide download buttons in print */\n              button, .btn { display: none !important; }\n              \n              /* Optimize table printing */\n              table { \n                border-collapse: collapse; \n                width: 100%; \n              }\n              \n              /* Ensure backgrounds print */\n              .bg-blue-600, .bg-green-600 { \n                background-color: #2563eb !important; \n                color: white !important;\n              }\n              .bg-gray-50, .bg-blue-50, .bg-green-50 { \n                background-color: #f9fafb !important; \n              }\n            }\n            \n            @page {\n              margin: 0.5in;\n              size: A4;\n            }\n          </style>\n        </head>\n        <body>\n          ").concat(n.outerHTML,"\n          <script>\n            window.onload = function() {\n              // Auto-print when ready\n              setTimeout(function() {\n                window.print();\n                // Close the window after printing\n                setTimeout(function() {\n                  window.close();\n                }, 1000);\n              }, 500);\n            };\n          <\/script>\n        </body>\n        </html>\n      ");return r.document.write(s),r.document.close(),!0}catch(n){throw console.error("Error generating PDF:",n),n}}async generateInvoicePDF(e){const t="ElderX_Invoice_".concat(e.invoiceNumber,".pdf");return this.generatePDF("invoice-template",t)}async generatePrescriptionPDF(e){const t="ElderX_Prescription_".concat(e.prescriptionNumber,".pdf");return this.generatePDF("prescription-template",t)}async downloadAsHTML(e,t){try{const n=document.getElementById(e);if(!n)throw new Error("Element with ID '".concat(e,"' not found"));const r=Array.from(document.styleSheets).map(e=>{try{const t=Array.from(e.cssRules||[]).map(e=>e.cssText).join("\n");return"<style>".concat(t,"</style>")}catch(ts){return""}}).join("\n"),i="\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>".concat(t,'</title>\n          <meta charset="UTF-8">\n          ').concat(r,"\n        </head>\n        <body>\n          ").concat(n.outerHTML,"\n        </body>\n        </html>\n      "),s=new Blob([i],{type:"text/html"}),a=URL.createObjectURL(s),o=document.createElement("a");return o.href=a,o.download="".concat(t,".html"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),!0}catch(n){throw console.error("Error downloading HTML:",n),n}}showPrintPreview(e){try{const t=document.getElementById(e);if(!t)throw new Error("Element with ID '".concat(e,"' not found"));const n=document.body,r=n.innerHTML;return n.innerHTML='\n        <div style="font-family: Arial, sans-serif;">\n          '.concat(t.outerHTML,"\n        </div>\n      "),window.print(),n.innerHTML=r,!0}catch(t){throw console.error("Error showing print preview:",t),t}}isPDFSupported(){return"undefined"!==typeof window&&"function"===typeof window.print&&"undefined"!==typeof document}getPrintStyles(){return"\n      @media print {\n        body { \n          margin: 0; \n          padding: 20px;\n          font-family: 'Arial', sans-serif;\n          line-height: 1.4;\n          color: #000;\n          background: white;\n        }\n        \n        .no-print, button, .btn { \n          display: none !important; \n        }\n        \n        .page-break { \n          page-break-before: always; \n        }\n        \n        .avoid-break { \n          page-break-inside: avoid; \n        }\n        \n        * { \n          -webkit-print-color-adjust: exact !important;\n          color-adjust: exact !important;\n        }\n        \n        .bg-blue-600, .bg-green-600 { \n          background-color: #1e40af !important; \n          color: white !important;\n        }\n      }\n      \n      @page {\n        margin: 0.5in;\n        size: A4;\n      }\n    "}},Pr=e=>{let{appointment:n,patientInfo:r,doctorInfo:i,onClose:s}=e;const[a,o]=(0,t.useState)("invoice"),[c,l]=(0,t.useState)(!1),[d,u]=(0,t.useState)(!1),h=()=>{const e=15e3,t=2e3,s=17e3;return{invoiceNumber:"INV-".concat(Date.now()),appointmentId:n.id,patientInfo:{name:r.name||r.displayName,email:r.email,phone:r.phone||"+234 XXX XXX XXXX",address:r.address||"Patient Address",id:r.id},doctorInfo:{name:i.name||i.displayName,specialty:i.specialty||"General Practitioner",email:i.email,phone:i.phone||"+234 XXX XXX XXXX",licenseNumber:i.licenseNumber||"MD-2024-XXXX"},consultationDate:n.appointmentDate||new Date,services:[{description:"Telemedicine Consultation",details:"".concat(n.duration||30," minute video consultation"),duration:n.duration||30,rate:e/(n.duration||30)*30,amount:e},{description:"Platform Service Fee",details:"ElderX telemedicine platform usage",duration:1,rate:t,amount:t}],subtotal:s,tax:1275,total:18275,paymentStatus:n.paymentStatus||"paid",paymentMethod:n.paymentMethod||"Credit Card",dueDate:new Date(Date.now()+2592e6),notes:"Thank you for choosing ElderX Healthcare for your telemedicine consultation."}},p=()=>{var e;return{prescriptionNumber:"RX-".concat(Date.now()),appointmentId:n.id,patientInfo:{name:r.name||r.displayName,email:r.email,phone:r.phone||"+234 XXX XXX XXXX",address:r.address||"Patient Address",age:r.age||"N/A",gender:r.gender||"Not specified",id:r.id},doctorInfo:{name:i.name||i.displayName,specialty:i.specialty||"General Practitioner",email:i.email,phone:i.phone||"+234 XXX XXX XXXX",licenseNumber:i.licenseNumber||"MD-2024-XXXX",qualifications:i.qualifications||["MBBS","MD"],hospital:i.hospital||"ElderX Telemedicine Platform"},consultationDate:n.appointmentDate||new Date,diagnosis:n.diagnosis||"General health consultation",symptoms:n.symptoms||["General wellness check"],vitalSigns:n.vitalSigns||{bloodPressure:"120/80",heartRate:72,temperature:98.6,weight:70},medications:(null===(e=n.prescription)||void 0===e?void 0:e.medications)||[{name:"Paracetamol",genericName:"Acetaminophen",form:"Tablet",strength:"500mg",dosage:"1 tablet",frequency:"Every 6 hours as needed",duration:"7 days",quantity:"28 tablets",instructions:"Take with food. Do not exceed 4 tablets in 24 hours.",warnings:"Do not use with alcohol. Consult doctor if symptoms persist."}],instructions:n.instructions||"Take medications as prescribed. Rest and stay hydrated. \n        \nMonitor your symptoms and contact us if you experience any worsening of your condition.\n        \nFollow up as scheduled to ensure proper recovery.",followUpDate:new Date(Date.now()+6048e5),emergencyInstructions:"If you experience severe side effects or your condition worsens significantly, seek immediate medical attention.",validUntil:new Date(Date.now()+2592e6)}},m=async e=>{try{if(u(!0),!Or.isPDFSupported())return void Pe.oR.error("PDF generation is not supported in this browser");"invoice"===e?(await Or.generateInvoicePDF(h()),Pe.oR.success("Invoice PDF generated successfully")):(await Or.generatePrescriptionPDF(p()),Pe.oR.success("Prescription PDF generated successfully"))}catch(t){console.error("Error generating PDF:",t),Pe.oR.error("Failed to generate PDF. Please try again.")}finally{u(!1)}},f=e=>{o(e),l(!0)},g=h(),v=p();return(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Medical Documents"}),(0,Qe.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(ut,{className:"h-5 w-5"})})]}),c?(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("button",{onClick:()=>l(!1),className:"flex items-center px-3 py-2 text-gray-600 hover:text-gray-900",children:"\u2190 Back to Documents"}),(0,Qe.jsxs)("div",{className:"flex space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>o("invoice"),className:"px-4 py-2 rounded-lg ".concat("invoice"===a?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:"Invoice"}),(0,Qe.jsx)("button",{onClick:()=>o("prescription"),className:"px-4 py-2 rounded-lg ".concat("prescription"===a?"bg-green-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:"Prescription"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-2",children:(0,Qe.jsxs)("button",{onClick:()=>m(a),disabled:d,className:"flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:[(0,Qe.jsx)(An,{className:"h-4 w-4 mr-2"}),d?"Generating...":"Download PDF"]})})]}),(0,Qe.jsx)("div",{className:"max-h-[70vh] overflow-y-auto",children:"invoice"===a?(0,Qe.jsx)(Rr,{invoiceData:g,onDownload:()=>m("invoice"),showDownloadButton:!1}):(0,Qe.jsx)(Ir,{prescriptionData:v,onDownload:()=>m("prescription"),showDownloadButton:!1})})]}):(0,Qe.jsxs)("div",{className:"p-6",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,Qe.jsx)(Ar,{className:"h-8 w-8 text-blue-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Medical Invoice"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Consultation billing statement"})]})]}),(0,Qe.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,Qe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Consultation Fee:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:"\u20a615,000"})]}),(0,Qe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Platform Fee:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:"\u20a62,000"})]}),(0,Qe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"VAT (7.5%):"}),(0,Qe.jsx)("span",{className:"font-semibold",children:"\u20a61,275"})]}),(0,Qe.jsx)("hr",{}),(0,Qe.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,Qe.jsx)("span",{children:"Total:"}),(0,Qe.jsx)("span",{className:"text-blue-600",children:"\u20a618,275"})]})]}),(0,Qe.jsxs)("div",{className:"flex space-x-2",children:[(0,Qe.jsxs)("button",{onClick:()=>f("invoice"),className:"flex-1 flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,Qe.jsx)(Bt,{className:"h-4 w-4 mr-2"}),"Preview"]}),(0,Qe.jsxs)("button",{onClick:()=>m("invoice"),disabled:d,className:"flex-1 flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:[(0,Qe.jsx)(An,{className:"h-4 w-4 mr-2"}),d?"Generating...":"Download"]})]})]}),(0,Qe.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,Qe.jsx)(wt,{className:"h-8 w-8 text-green-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Medical Prescription"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Medication and treatment plan"})]})]}),(0,Qe.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,Qe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Doctor:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:i.name})]}),(0,Qe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Date:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:new Date(n.appointmentDate||new Date).toLocaleDateString()})]}),(0,Qe.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Medications:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:"1 prescribed"})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-sm text-green-600",children:[(0,Qe.jsx)(kt,{className:"h-4 w-4 mr-1"}),(0,Qe.jsx)("span",{children:"Valid for 30 days"})]})]}),(0,Qe.jsxs)("div",{className:"flex space-x-2",children:[(0,Qe.jsxs)("button",{onClick:()=>f("prescription"),className:"flex-1 flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[(0,Qe.jsx)(Bt,{className:"h-4 w-4 mr-2"}),"Preview"]}),(0,Qe.jsxs)("button",{onClick:()=>m("prescription"),disabled:d,className:"flex-1 flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:[(0,Qe.jsx)(An,{className:"h-4 w-4 mr-2"}),d?"Generating...":"Download"]})]})]})]}),(0,Qe.jsx)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-start",children:[(0,Qe.jsx)(xt,{className:"h-5 w-5 text-blue-600 mr-2 mt-0.5"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-semibold text-blue-900",children:"Document Information"}),(0,Qe.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"These documents are generated based on your telemedicine consultation. The invoice can be used for insurance claims or personal records. The prescription is valid for 30 days and can be presented to any licensed pharmacy."})]})]})})]})]})})},kr=()=>{const[e,n]=Ve(Fe.j2),[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(null),[u,h]=(0,t.useState)(!0),[p,m]=(0,t.useState)(!0),[f,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)(!0),[_,E]=(0,t.useState)(!1),[b,x]=(0,t.useState)(0),[w,S]=(0,t.useState)([]),[T,N]=(0,t.useState)("disconnected"),[C,A]=(0,t.useState)(null),[R,I]=(0,t.useState)({cameras:[],microphones:[]}),[O,P]=(0,t.useState)(!1),[k,D]=(0,t.useState)("patient"),[L,j]=(0,t.useState)(!1),[M,U]=(0,t.useState)(null);(0,t.useEffect)(()=>(e&&!n&&(B(),F(),V()),()=>{_&&xr.leaveChannel()}),[e,n]),(0,t.useEffect)(()=>{if(e){var t;const n=null!==(t=e.displayName)&&void 0!==t&&t.includes("Dr.")?"doctor":"patient";D(n)}},[e]);const V=async()=>{try{const e=await xr.getAvailableDevices();I(e)}catch(C){console.error("Failed to load devices:",C)}},F=()=>{window.addEventListener("agora-user-published",e=>{const{user:t}=e.detail;S(e=>[...e,t]),Pe.oR.success("".concat(t.uid," joined the call"))}),window.addEventListener("agora-user-left",e=>{const{user:t}=e.detail;S(e=>e.filter(e=>e.uid!==t.uid)),Pe.oR.info("".concat(t.uid," left the call"))}),window.addEventListener("agora-connection-state-change",e=>{const{curState:t}=e.detail;N(t),console.log("Connection state:",t),"CONNECTED"===t?Pe.oR.success("Connected to call"):"DISCONNECTED"===t&&Pe.oR.warning("Connection lost")}),window.addEventListener("agora-error",e=>{const{type:t,error:n}=e.detail;switch(A(n),console.error("Agora error:",t,n),t){case"initialization":Pe.oR.error("Failed to initialize video calling");break;case"join":e.detail.isTokenError?Pe.oR.error("Video call authentication failed. Please try again."):Pe.oR.error("Failed to join call. Please check your connection.");break;case"track-creation":Pe.oR.error("Failed to access camera/microphone");break;case"publish":Pe.oR.error("Failed to start video/audio");break;default:Pe.oR.error("Video call error occurred")}}),window.addEventListener("agora-tracks-created",e=>{const{hasVideo:t,hasAudio:n}=e.detail;h(t),m(n),t||n?t?n||Pe.oR.warning("Microphone access not available - video only"):Pe.oR.warning("Camera access not available - audio only"):Pe.oR.warning("No camera or microphone access available")}),window.addEventListener("agora-recording-started",e=>{g(!0),Pe.oR.success("Recording started")}),window.addEventListener("agora-recording-stopped",e=>{g(!1),Pe.oR.success("Recording stopped")})},B=async()=>{try{if(y(!0),A(null),!e)return void y(!1);const t=(await Cr.getAppointments(e.uid,k)).map(e=>Cr.formatAppointmentForDisplay(e));i(t),y(!1)}catch(C){console.error("Error loading telemedicine data:",C),A("Failed to load appointments. Please try again."),y(!1),i([]),a([]),c([]),y(!1)}},G=async()=>{try{const e=await xr.toggleVideo();h(e),Pe.oR.info(e?"Video enabled":"Video disabled")}catch(C){console.error("Failed to toggle video:",C),Pe.oR.error("Failed to toggle video")}},H=async()=>{try{const e=await xr.toggleAudio();m(e),Pe.oR.info(e?"Audio enabled":"Audio disabled")}catch(C){console.error("Failed to toggle audio:",C),Pe.oR.error("Failed to toggle audio")}},W=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},z=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return n?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e?v?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Telemedicine"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Virtual consultations and remote healthcare"})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsxs)("button",{onClick:async()=>{try{Pe.oR.info("Seeding sample data..."),Pe.oR.success("Sample data seeded successfully!"),B()}catch(C){console.error("Failed to seed data:",C),Pe.oR.error("Failed to seed sample data")}},className:"btn btn-secondary",title:"Add sample data to Firebase",children:[(0,Qe.jsx)(ar,{className:"h-4 w-4 mr-2"}),"Seed Data"]}),(0,Qe.jsxs)("button",{onClick:async()=>{try{Pe.oR.info("Running telemedicine tests...");const e=await(async()=>{const e={initialization:!1,deviceDetection:!1,permissions:!1,errors:[]};try{console.log("\ud83e\uddea Testing Telemedicine Service...");try{await xr.initialize(),e.initialization=!0,console.log("\u2705 Service initialization: PASSED")}catch(C){e.errors.push("Initialization failed: ".concat(C.message)),console.error("\u274c Service initialization: FAILED",C)}try{const t=await xr.getAvailableDevices();e.deviceDetection=t.cameras.length>0||t.microphones.length>0,console.log("\u2705 Device detection: PASSED",t)}catch(C){e.errors.push("Device detection failed: ".concat(C.message)),console.error("\u274c Device detection: FAILED",C)}try{const t=await xr.checkCameraPermission(),n=await xr.checkMicrophonePermission();e.permissions=t||n,console.log("\u2705 Permission checks: PASSED",{hasCamera:t,hasMicrophone:n})}catch(C){e.errors.push("Permission checks failed: ".concat(C.message)),console.error("\u274c Permission checks: FAILED",C)}return e.initialization&&e.deviceDetection&&e.permissions?console.log("\ud83c\udf89 All telemedicine tests PASSED!"):console.log("\u26a0\ufe0f Some telemedicine tests FAILED:",e.errors),e}catch(C){return console.error("\ud83d\udca5 Telemedicine test suite failed:",C),e.errors.push("Test suite failed: ".concat(C.message)),e}})();0===e.errors.length?Pe.oR.success("All telemedicine tests passed!"):(Pe.oR.warning("Some tests failed: ".concat(e.errors.length," errors")),console.log("Test results:",e))}catch(C){console.error("Test failed:",C),Pe.oR.error("Telemedicine test failed")}},className:"btn btn-secondary",title:"Test telemedicine functionality",children:[(0,Qe.jsx)(kt,{className:"h-4 w-4 mr-2"}),"Test System"]}),(0,Qe.jsxs)("button",{onClick:V,className:"btn btn-secondary",title:"Refresh device list",children:[(0,Qe.jsx)(bt,{className:"h-4 w-4 mr-2"}),"Refresh Devices"]}),(0,Qe.jsxs)("button",{className:"btn btn-secondary",children:[(0,Qe.jsx)(at,{className:"h-4 w-4 mr-2"}),"Schedule Appointment"]}),(0,Qe.jsxs)("button",{onClick:async()=>{try{const t={patientId:"patient"===k?e.uid:"sample-patient-id",doctorId:"doctor"===k?e.uid:null,appointmentDate:new Date(Date.now()+864e5),duration:30,type:"video",notes:"New consultation appointment",status:"scheduled"};await Cr.createAppointment(t);Pe.oR.success("New appointment created successfully!"),B()}catch(C){console.error("Failed to create appointment:",C),Pe.oR.error("Failed to create appointment")}},className:"btn btn-primary",title:"Create new consultation appointment",children:[(0,Qe.jsx)(pn,{className:"h-4 w-4 mr-2"}),"New Consultation"]})]})]}),R.cameras.length>0||R.microphones.length>0?(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Available Devices"}),(0,Qe.jsxs)("span",{className:"text-xs text-gray-500",children:[R.cameras.length," camera(s), ",R.microphones.length," microphone(s)"]})]})}):(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(qe,{className:"h-5 w-5 text-yellow-600 mr-2"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"No Devices Detected"}),(0,Qe.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"Please ensure your camera and microphone are connected and permissions are granted."})]})]})})}),(C||"disconnected"!==T)&&(0,Qe.jsxs)("div",{className:"card",children:[C&&(0,Qe.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(qe,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Connection Error"}),(0,Qe.jsx)("p",{className:"text-sm text-red-700 mt-1",children:C})]})]})}),"disconnected"!==T&&(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat("CONNECTED"===T?"bg-green-500":"CONNECTING"===T?"bg-yellow-500":"bg-red-500")}),(0,Qe.jsxs)("span",{className:"text-sm text-gray-600",children:["Status: ",T.toLowerCase()]})]}),O&&(0,Qe.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Initializing..."]})]})]}),l&&(0,Qe.jsxs)("div",{className:"card bg-gray-900 text-white",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-white font-medium",children:l.doctorName?l.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold",children:l.doctorName||"Doctor"}),(0,Qe.jsx)("p",{className:"text-gray-300",children:l.doctorSpecialty})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsxs)("span",{className:"text-sm text-gray-300",children:["Call Duration: ",(e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))})(b)]}),f&&(0,Qe.jsxs)("div",{className:"flex items-center space-x-1 bg-red-600 px-2 py-1 rounded-full",children:[(0,Qe.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,Qe.jsx)("span",{className:"text-xs text-white",children:"REC"})]}),(0,Qe.jsx)("button",{onClick:async()=>{try{if(null!==l&&void 0!==l&&l.timer&&clearInterval(l.timer),await xr.leaveChannel(),null!==l&&void 0!==l&&l.callId)try{const e={duration:b,endReason:"user_ended",hasRecording:f};await Cr.endCall(l.callId,e)}catch(e){console.warn("Failed to save call end to Firebase:",e)}d(null),E(!1),x(0),S([]),h(!0),m(!0),g(!1),Pe.oR.success("Call ended successfully!")}catch(C){console.error("Failed to end call:",C),Pe.oR.error("Failed to end call properly.")}},className:"p-2 bg-red-600 rounded-full hover:bg-red-700",title:"End call",children:(0,Qe.jsx)(ur,{className:"h-5 w-5"})})]})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,Qe.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Qe.jsx)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:w.length>0?w.map((e,t)=>(0,Qe.jsx)("div",{id:"remote-video-".concat(e.uid),className:"w-full h-full"},e.uid)):(0,Qe.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)(Ct,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Qe.jsx)("p",{className:"text-gray-400",children:"Waiting for doctor to join..."})]})})}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-sm text-gray-300",children:w.length>0?"".concat(w.length," participant(s)"):"No participants"}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:G,className:"p-2 rounded-full ".concat(u?"bg-gray-700":"bg-red-600"),children:u?(0,Qe.jsx)(ct,{className:"h-4 w-4"}):(0,Qe.jsx)(hr,{className:"h-4 w-4"})}),(0,Qe.jsx)("button",{onClick:H,className:"p-2 rounded-full ".concat(p?"bg-gray-700":"bg-red-600"),children:p?(0,Qe.jsx)(pr,{className:"h-4 w-4"}):(0,Qe.jsx)(mr,{className:"h-4 w-4"})})]})]})]}),(0,Qe.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Qe.jsxs)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:[(0,Qe.jsx)("div",{id:"local-video",className:"w-full h-full"}),!u&&(0,Qe.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-600",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)(hr,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Qe.jsx)("p",{className:"text-gray-400",children:"Your video is off"})]})})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("span",{className:"text-sm text-gray-300",children:"You"}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:G,className:"p-2 rounded-full ".concat(u?"bg-gray-700":"bg-red-600"),children:u?(0,Qe.jsx)(ct,{className:"h-4 w-4"}):(0,Qe.jsx)(hr,{className:"h-4 w-4"})}),(0,Qe.jsx)("button",{onClick:H,className:"p-2 rounded-full ".concat(p?"bg-gray-700":"bg-red-600"),children:p?(0,Qe.jsx)(pr,{className:"h-4 w-4"}):(0,Qe.jsx)(mr,{className:"h-4 w-4"})})]})]})]})]}),(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,Qe.jsx)("button",{onClick:G,className:"p-3 rounded-full transition-colors ".concat(u?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:u?"Turn off video":"Turn on video",children:u?(0,Qe.jsx)(ct,{className:"h-6 w-6"}):(0,Qe.jsx)(hr,{className:"h-6 w-6"})}),(0,Qe.jsx)("button",{onClick:H,className:"p-3 rounded-full transition-colors ".concat(p?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:p?"Mute microphone":"Unmute microphone",children:p?(0,Qe.jsx)(pr,{className:"h-6 w-6"}):(0,Qe.jsx)(mr,{className:"h-6 w-6"})}),(0,Qe.jsx)("button",{onClick:async()=>{try{if(f){if(await xr.stopRecording(),g(!1),null!==l&&void 0!==l&&l.callId)try{const e={duration:b,status:"completed",recordingUrl:null,fileSize:null};await Cr.saveRecording(l.callId,e)}catch(e){console.warn("Failed to save recording data to Firebase:",e)}Pe.oR.success("Recording stopped")}else{if(await xr.startRecording(),g(!0),null!==l&&void 0!==l&&l.callId)try{const e={status:"recording",startTime:new Date};await Cr.saveRecording(l.callId,e)}catch(e){console.warn("Failed to save recording start to Firebase:",e)}Pe.oR.success("Recording started")}}catch(C){console.error("Failed to toggle recording:",C),Pe.oR.error("Failed to toggle recording")}},className:"p-3 rounded-full transition-colors ".concat(f?"bg-red-600 hover:bg-red-700":"bg-gray-700 hover:bg-gray-600"),title:f?"Stop recording":"Start recording",children:f?(0,Qe.jsx)(fr,{className:"h-6 w-6"}):(0,Qe.jsx)(gr,{className:"h-6 w-6"})}),(0,Qe.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Share screen",children:(0,Qe.jsx)(vr,{className:"h-6 w-6"})}),(0,Qe.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Settings",children:(0,Qe.jsx)(bt,{className:"h-6 w-6"})})]}),(R.cameras.length>1||R.microphones.length>1)&&(0,Qe.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[R.cameras.length>1&&(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(Ct,{className:"h-4 w-4"}),(0,Qe.jsx)("select",{onChange:e=>(async e=>{try{await xr.switchCamera(e),Pe.oR.success("Camera switched successfully")}catch(C){console.error("Failed to switch camera:",C),Pe.oR.error("Failed to switch camera")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:R.cameras.map(e=>(0,Qe.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]}),R.microphones.length>1&&(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(pr,{className:"h-4 w-4"}),(0,Qe.jsx)("select",{onChange:e=>(async e=>{try{await xr.switchMicrophone(e),Pe.oR.success("Microphone switched successfully")}catch(C){console.error("Failed to switch microphone:",C),Pe.oR.error("Failed to switch microphone")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:R.microphones.map(e=>(0,Qe.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]})]})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Appointments"}),(0,Qe.jsxs)("button",{className:"btn btn-secondary",children:[(0,Qe.jsx)(Wn,{className:"h-4 w-4 mr-2"}),"Search"]})]}),(0,Qe.jsx)("div",{className:"space-y-4",children:r.filter(e=>"scheduled"===e.status).map(t=>(0,Qe.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Qe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-blue-600 font-medium",children:t.doctorName?t.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.doctorName||"Doctor"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-500",children:t.doctorSpecialty||"General Practice"}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(W(t.status)),children:t.status})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(ft,{className:"h-4 w-4 mr-2"}),(0,Qe.jsxs)("span",{children:["Patient: ",t.patientName||"Patient"," (",t.patientAge||"N/A","y)"]})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(at,{className:"h-4 w-4 mr-2"}),(0,Qe.jsx)("span",{children:t.appointmentDate?z(t.appointmentDate).date:"TBD"})]}),(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"h-4 w-4 mr-2"}),(0,Qe.jsxs)("span",{children:[t.appointmentDate?z(t.appointmentDate).time:"TBD"," (",t.duration||30,"min)"]})]})]}),(0,Qe.jsxs)("div",{className:"mt-2",children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:t.notes}),t.symptoms&&(0,Qe.jsxs)("div",{className:"mt-2",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Symptoms: "}),(0,Qe.jsx)("span",{className:"text-sm text-gray-600",children:t.symptoms.join(", ")})]})]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>(async t=>{try{P(!0),A(null),d(t),E(!0),x(0);const r="appointment_".concat(t.id,"_").concat(Date.now()),i=await xr.joinChannel(null,r);console.log("Joined call with UID:",i);let s=null;try{const n={appointmentId:t.id,patientId:"patient"===k?e.uid:t.patientId,doctorId:"doctor"===k?e.uid:t.doctorId,channelName:r,uid:i,callType:t.type||"video",status:"active"},a=await Cr.startCall(t.id,n);s=a.id,d(e=>(0,Ge.A)((0,Ge.A)({},e),{},{callId:s}))}catch(n){console.warn("Failed to save call to Firebase:",n)}Pe.oR.success("Call started successfully!");const a=setInterval(()=>{x(e=>e+1)},1e3);d(e=>(0,Ge.A)((0,Ge.A)({},e),{},{timer:a,channelName:r,uid:i,callId:s}))}catch(C){console.error("Failed to start call:",C),A(C.message),Pe.oR.error("Failed to start call: ".concat(C.message)),d(null),E(!1)}finally{P(!1)}})(t),disabled:O,className:"btn btn-primary ".concat(O?"opacity-50 cursor-not-allowed":""),children:O?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Starting..."]}):(0,Qe.jsxs)(Qe.Fragment,{children:["video"===t.type?(0,Qe.jsx)(ct,{className:"h-4 w-4 mr-2"}):(0,Qe.jsx)(Et,{className:"h-4 w-4 mr-2"}),"Start Call"]})}),(0,Qe.jsxs)("button",{className:"btn btn-secondary",children:[(0,Qe.jsx)(_t,{className:"h-4 w-4 mr-2"}),"Chat"]})]})]})},t.id))})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Consultations"}),(0,Qe.jsxs)("button",{className:"btn btn-secondary",children:[(0,Qe.jsx)(jn,{className:"h-4 w-4 mr-2"}),"Filter"]})]}),(0,Qe.jsx)("div",{className:"overflow-x-auto",children:(0,Qe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Qe.jsx)("thead",{className:"bg-gray-50",children:(0,Qe.jsxs)("tr",{children:[(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Qe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.filter(e=>"completed"===e.status).map(e=>(0,Qe.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-blue-600 font-medium",children:e.doctorName?e.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.doctorName||"Doctor"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-500",children:e.doctorSpecialty||"General Practice"})]})]})}),(0,Qe.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Qe.jsx)("div",{className:"text-sm text-gray-900",children:e.patientName||"Patient"}),(0,Qe.jsxs)("div",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge||"N/A"]})]}),(0,Qe.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Qe.jsx)("div",{className:"text-sm text-gray-900",children:e.appointmentDate?z(e.appointmentDate).date:"TBD"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-500",children:e.appointmentDate?z(e.appointmentDate).time:"TBD"})]}),(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:["video"===e.type?(0,Qe.jsx)(ct,{className:"h-4 w-4 text-blue-600 mr-1"}):(0,Qe.jsx)(Et,{className:"h-4 w-4 text-green-600 mr-1"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-900 capitalize",children:e.type})]})}),(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(W(e.status)),children:e.status})}),(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>(e=>{U(e),j(!0)})(e),className:"text-blue-600 hover:text-blue-900",title:"Download Invoice & Prescription",children:(0,Qe.jsx)(xt,{className:"h-4 w-4"})}),e.recording&&(0,Qe.jsx)("button",{className:"text-green-600 hover:text-green-900",children:(0,Qe.jsx)(An,{className:"h-4 w-4"})}),(0,Qe.jsx)("button",{className:"text-purple-600 hover:text-purple-900",children:(0,Qe.jsx)(Xn,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),L&&M&&(0,Qe.jsx)(Pr,{appointment:M,patientInfo:{name:(null===e||void 0===e?void 0:e.displayName)||"Patient Name",email:null===e||void 0===e?void 0:e.email,phone:(null===e||void 0===e?void 0:e.phoneNumber)||"+234 XXX XXX XXXX",address:"Patient Address",age:65,gender:"Not specified",id:null===e||void 0===e?void 0:e.uid},doctorInfo:{name:M.doctorName||"Healthcare Provider",specialty:M.doctorSpecialty||"General Practice",email:"doctor@elderx.com",phone:"+234 800 ELDERX",licenseNumber:"MD-2024-001",qualifications:["MBBS","MD"],hospital:"ElderX Telemedicine Platform"},onClose:()=>j(!1)})]}):(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Required"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Please log in to access telemedicine features."})]})})},Dr=()=>{const[e,n]=(0,t.useState)(!1),r=ee(),i=Z(),s=[{name:"Dashboard",href:"/caregiver",icon:Tt},{name:"Today's Schedule",href:"/caregiver/schedule",icon:at},{name:"My Patients",href:"/caregiver/patients",icon:ot},{name:"Tasks",href:"/caregiver/tasks",icon:kt},{name:"Messages",href:"/caregiver/messages",icon:_t},{name:"Navigation",href:"/caregiver/navigation",icon:Dn},{name:"Photo Updates",href:"/caregiver/photos",icon:Ct},{name:"Performance",href:"/caregiver/performance",icon:En},{name:"Emergency",href:"/caregiver/emergency",icon:qe},{name:"Settings",href:"/caregiver/settings",icon:bt}],a=e=>i.pathname===e;return(0,Qe.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,Qe.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Qe.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>n(!1)}),(0,Qe.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Qe.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Qe.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>n(!1),children:(0,Qe.jsx)(ut,{className:"h-6 w-6 text-white"})})}),(0,Qe.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Qe.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Qe.jsx)(ot,{className:"h-8 w-8 text-green-600"})}),(0,Qe.jsx)("div",{className:"ml-3",children:(0,Qe.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Qe.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:s.map(e=>{const t=e.icon;return(0,Qe.jsxs)(Ae,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Qe.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Qe.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Qe.jsx)("div",{className:"flex flex-col w-64",children:(0,Qe.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Qe.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Qe.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Qe.jsx)(ot,{className:"h-8 w-8 text-green-600"})}),(0,Qe.jsx)("div",{className:"ml-3",children:(0,Qe.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Qe.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:s.map(e=>{const t=e.icon;return(0,Qe.jsxs)(Ae,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Qe.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Qe.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"flex-shrink-0",children:(0,Qe.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-5 w-5 text-gray-600"})})}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"}),(0,Qe.jsxs)("button",{onClick:async()=>{try{await(0,ke.CI)(Fe.j2),Pe.oR.success("Signed out successfully"),r("/login")}catch(e){Pe.oR.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Qe.jsx)(ht,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Qe.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 dashboard-container",children:[(0,Qe.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Qe.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500 lg:hidden",onClick:()=>n(!0),children:(0,Qe.jsx)(pt,{className:"h-6 w-6"})}),(0,Qe.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Qe.jsx)("div",{className:"flex-1 flex",children:(0,Qe.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Qe.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Qe.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Qe.jsx)("span",{className:"text-sm text-gray-500",children:"Caregiver Portal"})})})})}),(0,Qe.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Qe.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:(0,Qe.jsx)(mt,{className:"h-6 w-6"})}),(0,Qe.jsx)("div",{className:"ml-3 relative",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-5 w-5 text-gray-600"})}),(0,Qe.jsx)("div",{className:"ml-3",children:(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"})})]})})]})]})]}),(0,Qe.jsx)("main",{className:"flex-1 overflow-auto w-full dashboard-main",children:(0,Qe.jsx)(ge,{})})]})]})},Lr=()=>{const{user:e}=(0,Be.useUser)(),[n,r]=(0,t.useState)(null),[i,s]=(0,t.useState)(""),[a,o]=(0,t.useState)(""),[c,l]=(0,t.useState)(!0),[d,u]=(0,t.useState)([]),[h,p]=(0,t.useState)(d);(0,t.useEffect)(()=>{if(a){const e=d.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.role.toLowerCase().includes(a.toLowerCase()));p(e)}else p(d)},[a,d]);const m=e=>"online"===e?"bg-green-500":"bg-gray-400",f=e=>"patient"===e.sender?e.read?(0,Qe.jsx)(Jn,{className:"h-4 w-4 text-blue-500"}):(0,Qe.jsx)(Qn,{className:"h-4 w-4 text-gray-400"}):null;return(0,Qe.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Qe.jsxs)("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[(0,Qe.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)(lt,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Messages"})]}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search conversations...",value:a,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto",children:h.map(e=>(0,Qe.jsx)("div",{onClick:()=>r(e),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ".concat((null===n||void 0===n?void 0:n.id)===e.id?"bg-blue-50 border-blue-200":""),children:(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ".concat(m(e.status))})]}),(0,Qe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:e.name}),(0,Qe.jsx)("span",{className:"text-xs text-gray-500",children:e.timestamp})]}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:e.role}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.lastMessage}),e.unreadCount>0&&(0,Qe.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unreadCount})]})]})]})},e.id))})]}),(0,Qe.jsx)("div",{className:"flex-1 flex flex-col",children:n?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-5 w-5 text-blue-600"})}),(0,Qe.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ".concat(m(n.status))})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:n.name}),(0,Qe.jsx)("p",{className:"text-sm text-gray-500",children:n.role})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(Et,{className:"h-5 w-5"})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(ct,{className:"h-5 w-5"})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(Xn,{className:"h-5 w-5"})})]})]})}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:n.messages.map(e=>(0,Qe.jsx)("div",{className:"flex ".concat("patient"===e.sender?"justify-end":"justify-start"),children:(0,Qe.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("patient"===e.sender?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,Qe.jsx)("p",{className:"text-sm",children:e.text}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between mt-1 ".concat("patient"===e.sender?"text-blue-100":"text-gray-500"),children:[(0,Qe.jsx)("span",{className:"text-xs",children:e.timestamp}),f(e)]})]})},e.id))}),(0,Qe.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:(0,Qe.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!i.trim()||!n)return;const t={id:Date.now(),text:i,sender:"patient",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),read:!1};u(e=>e.map(e=>e.id===n.id?(0,Ge.A)((0,Ge.A)({},e),{},{messages:[...e.messages,t],lastMessage:i,timestamp:"Just now"}):e)),s("")},className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Qe.jsx)(Zn,{className:"h-5 w-5"})}),(0,Qe.jsxs)("div",{className:"flex-1 relative",children:[(0,Qe.jsx)("input",{type:"text",value:i,onChange:e=>s(e.target.value),placeholder:"Type a message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,Qe.jsx)("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)($n,{className:"h-5 w-5"})})]}),(0,Qe.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Qe.jsx)(er,{className:"h-5 w-5"})})]})})]}):(0,Qe.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)(lt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,Qe.jsx)("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})},jr=Ke("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),Mr=()=>{const[e,n]=(0,t.useState)("premium"),[r,i]=(0,t.useState)("monthly"),s={currentPlan:"Premium",status:"Active",nextBilling:"January 15, 2025",amount:"$49.99",cycle:"Monthly",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications"]},a=[{id:"basic",name:"Basic",price:{monthly:19.99,yearly:199.99},description:"Essential care services",features:["2 home visits per month","Basic health monitoring","Email support","Medication reminders","Emergency contact"],popular:!1,icon:ot},{id:"premium",name:"Premium",price:{monthly:49.99,yearly:499.99},description:"Comprehensive care package",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications","Priority support"],popular:!0,icon:jr},{id:"elite",name:"Elite",price:{monthly:99.99,yearly:999.99},description:"Premium concierge service",features:["Everything in Premium","Dedicated care manager","Specialist consultations","Advanced health analytics","Custom care plans","White-glove service","Family dashboard","24/7 concierge support"],popular:!1,icon:Lt}],o=e=>{switch(e){case"Active":case"Paid":return"bg-green-100 text-green-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,Qe.jsxs)("div",{className:"space-y-8",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Subscription"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage your ElderX subscription and billing"})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsxs)("button",{className:"btn btn-secondary",children:[(0,Qe.jsx)(An,{className:"h-4 w-4 mr-2"}),"Download Invoice"]}),(0,Qe.jsxs)("button",{className:"btn btn-primary",children:[(0,Qe.jsx)(bt,{className:"h-4 w-4 mr-2"}),"Manage Billing"]})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Qe.jsx)(dt,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Current Subscription"})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,Qe.jsxs)("div",{className:"p-6 bg-blue-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)(jr,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[s.currentPlan," Plan"]}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(s.status)),children:s.status})]})]}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Amount:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:s.amount})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Cycle:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:s.cycle})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Next billing:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:s.nextBilling})]})]})]}),(0,Qe.jsxs)("div",{className:"p-6 bg-green-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)(Tt,{className:"h-8 w-8 text-green-600 mr-3"}),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Usage This Month"})]}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Home visits:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:"8 / Unlimited"})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Telemedicine:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:"3 / Unlimited"})]}),(0,Qe.jsxs)("div",{className:"flex justify-between",children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Emergency calls:"}),(0,Qe.jsx)("span",{className:"font-semibold",children:"1 / Unlimited"})]})]})]}),(0,Qe.jsxs)("div",{className:"p-6 bg-purple-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Qe.jsx)(Rt,{className:"h-8 w-8 text-purple-600 mr-3"}),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Benefits"})]}),(0,Qe.jsx)("div",{className:"space-y-1",children:s.features.slice(0,4).map((e,t)=>(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Qn,{className:"h-4 w-4 text-green-500 mr-2"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))})]})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Lt,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Plans"})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>i("monthly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("monthly"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Monthly"}),(0,Qe.jsx)("button",{onClick:()=>i("yearly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("yearly"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Yearly (Save 17%)"})]})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.map(t=>{const i=t.icon,s=e===t.id,a="monthly"===r?t.price.monthly:t.price.yearly,o="yearly"===r?Math.round((12*t.price.monthly-t.price.yearly)/(12*t.price.monthly)*100):0;return(0,Qe.jsxs)("div",{className:"relative p-6 border-2 rounded-lg transition-all ".concat(t.popular?"border-blue-500 bg-blue-50":s?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),children:[t.popular&&(0,Qe.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Qe.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),s&&(0,Qe.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Qe.jsx)("span",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Current Plan"})}),(0,Qe.jsxs)("div",{className:"text-center mb-6",children:[(0,Qe.jsx)(i,{className:"h-12 w-12 mx-auto mb-4 ".concat(t.popular?"text-blue-600":s?"text-green-600":"text-gray-600")}),(0,Qe.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:t.name}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,Qe.jsxs)("div",{className:"mb-2",children:[(0,Qe.jsxs)("span",{className:"text-3xl font-bold text-gray-900",children:["$",a]}),(0,Qe.jsxs)("span",{className:"text-gray-600",children:["/","monthly"===r?"month":"year"]})]}),o>0&&(0,Qe.jsxs)("p",{className:"text-sm text-green-600 font-medium",children:["Save ",o,"% with yearly billing"]})]}),(0,Qe.jsx)("div",{className:"space-y-3 mb-6",children:t.features.map((e,t)=>(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Qn,{className:"h-4 w-4 text-green-500 mr-3 flex-shrink-0"}),(0,Qe.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))}),(0,Qe.jsx)("button",{onClick:()=>{return e=t.id,void n(e);var e},className:"w-full py-3 px-4 rounded-lg font-semibold transition-colors ".concat(s?"bg-green-600 text-white hover:bg-green-700":t.popular?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),disabled:s,children:s?"Current Plan":"Choose Plan"})]},t.id)})})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(dt,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Payment Methods"})]}),(0,Qe.jsxs)("button",{className:"btn btn-primary",children:[(0,Qe.jsx)(dt,{className:"h-4 w-4 mr-2"}),"Add Payment Method"]})]}),(0,Qe.jsx)("div",{className:"space-y-4",children:[{id:1,type:"Visa",last4:"4242",expiry:"12/26",isDefault:!0},{id:2,type:"Mastercard",last4:"5555",expiry:"08/25",isDefault:!1}].map(e=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"w-12 h-8 bg-blue-600 rounded flex items-center justify-center",children:(0,Qe.jsx)(dt,{className:"h-5 w-5 text-white"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.type," \u2022\u2022\u2022\u2022 ",e.last4]}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500",children:["Expires ",e.expiry]})]}),e.isDefault&&(0,Qe.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"Default"})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),(0,Qe.jsx)("button",{className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]})]},e.id))})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(at,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Qe.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Billing History"})]}),(0,Qe.jsxs)("button",{className:"btn btn-secondary",children:[(0,Qe.jsx)(An,{className:"h-4 w-4 mr-2"}),"Download All"]})]}),(0,Qe.jsx)("div",{className:"overflow-x-auto",children:(0,Qe.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Qe.jsx)("thead",{className:"bg-gray-50",children:(0,Qe.jsxs)("tr",{children:[(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Qe.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,Qe.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:[{id:1,date:"December 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:2,date:"November 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:3,date:"October 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"}].map(e=>(0,Qe.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.description}),(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:e.amount}),(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Qe.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(e.status)),children:e.status})}),(0,Qe.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,Qe.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Qe.jsx)(An,{className:"h-4 w-4"})})})]},e.id))})]})})]})]})},Ur=()=>{const e=[{icon:Xe,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",bgColor:"bg-blue-100",iconColor:"text-blue-600"},{icon:ot,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",bgColor:"bg-green-100",iconColor:"text-green-600"},{icon:qe,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",bgColor:"bg-red-100",iconColor:"text-red-600"},{icon:ct,title:"Telemedicine",description:"Video consultations with doctors and specialists.",bgColor:"bg-purple-100",iconColor:"text-purple-600"},{icon:yt,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",bgColor:"bg-orange-100",iconColor:"text-orange-600"},{icon:Rt,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",bgColor:"bg-blue-100",iconColor:"text-blue-600"}];return(0,Qe.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Qe.jsxs)("div",{className:"text-center mb-16",children:[(0,Qe.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Qe.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((e,t)=>{const n=e.icon;return(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Qe.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Qe.jsx)(n,{className:"h-8 w-8 ".concat(e.iconColor)})}),(0,Qe.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Qe.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]}),(0,Qe.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Qe.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Qe.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Qe.jsx)("span",{className:"font-bold",children:"MGX"})]})})]})},Vr=()=>(0,Qe.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Qe.jsxs)("div",{className:"text-center mb-16",children:[(0,Qe.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Affordable Care Plans"}),(0,Qe.jsx)("p",{className:"text-lg text-gray-600",children:"Flexible subscription options designed for Nigerian families."})]}),(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12",children:[{name:"Basic",price:"\u20a615,000",period:"per month",features:["2 home visits per month","Basic health monitoring","Emergency support"],buttonText:"Choose Basic",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"},{name:"Premium",price:"\u20a625,000",period:"per month",features:["4 home visits per month","Video consultations","Family notifications"],buttonText:"Choose Premium",buttonStyle:"bg-blue-600 text-white hover:bg-blue-700",popular:!0},{name:"Family",price:"\u20a640,000",period:"per month",features:["Unlimited home visits","24/7 emergency support","Specialist consultations"],buttonText:"Choose Family",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}].map((e,t)=>(0,Qe.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 relative ".concat(e.popular?"border-2 border-blue-600":"border border-gray-200"),children:[e.popular&&(0,Qe.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,Qe.jsx)("div",{className:"bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),(0,Qe.jsxs)("div",{className:"text-center mb-6",children:[(0,Qe.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.name}),(0,Qe.jsxs)("div",{className:"mb-2",children:[(0,Qe.jsx)("span",{className:"text-4xl font-bold text-blue-600",children:e.price}),(0,Qe.jsx)("span",{className:"text-gray-500 ml-2",children:e.period})]})]}),(0,Qe.jsx)("ul",{className:"space-y-3 mb-8",children:e.features.map((e,t)=>(0,Qe.jsxs)("li",{className:"flex items-center",children:[(0,Qe.jsx)(Qn,{className:"h-5 w-5 text-green-500 mr-3 flex-shrink-0"}),(0,Qe.jsx)("span",{className:"text-gray-700",children:e})]},t))}),(0,Qe.jsx)("button",{className:"w-full py-3 px-6 rounded-lg font-medium transition-colors ".concat(e.buttonStyle),children:e.buttonText})]},t))}),(0,Qe.jsx)("div",{className:"text-center",children:(0,Qe.jsx)("button",{className:"bg-gradient-to-r from-blue-600 to-green-600 text-white px-8 py-4 rounded-lg font-medium hover:from-blue-700 hover:to-green-700 transition-all",children:"View All Plans & Get Started"})})]}),(0,Qe.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Qe.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Qe.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Qe.jsx)("span",{className:"font-bold",children:"MGX"})]})})]});var Fr=n(9416);const Br="patientAssignments",Gr="assignmentRequests",Hr={createAssignment:async e=>{try{const t=(0,Ge.A)((0,Ge.A)({},e),{},{status:"active",createdAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}),n=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,Br),t);return et.A.info("Patient assignment created",{assignmentId:n.id,patientId:e.patientId,caregiverId:e.caregiverId}),(0,Ge.A)({id:n.id},t)}catch(t){throw et.A.error("Error creating assignment",{error:t,assignmentData:e}),Je.Ay.handleError(t,{context:"create_assignment"}),t}},getAssignmentsByCaregiver:async e=>{try{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,Br),(0,Vt._M)("caregiverId","==",e),(0,Vt._M)("status","==","active"),(0,Vt.My)("createdAt","desc")),n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{var t,n,i,s;const a=e.data();r.push((0,Ge.A)((0,Ge.A)({id:e.id},a),{},{createdAt:null===(t=a.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(n=a.updatedAt)||void 0===n?void 0:n.toDate(),startDate:null===(i=a.startDate)||void 0===i?void 0:i.toDate(),endDate:null===(s=a.endDate)||void 0===s?void 0:s.toDate()}))}),r}catch(t){throw et.A.error("Error fetching caregiver assignments",{error:t,caregiverId:e}),t}},getAssignmentsByPatient:async e=>{try{const t=(0,Vt.P)((0,Vt.rJ)(Fe.db,Br),(0,Vt._M)("patientId","==",e),(0,Vt.My)("createdAt","desc")),n=await(0,Vt.GG)(t),r=[];return n.forEach(e=>{var t,n,i,s;const a=e.data();r.push((0,Ge.A)((0,Ge.A)({id:e.id},a),{},{createdAt:null===(t=a.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(n=a.updatedAt)||void 0===n?void 0:n.toDate(),startDate:null===(i=a.startDate)||void 0===i?void 0:i.toDate(),endDate:null===(s=a.endDate)||void 0===s?void 0:s.toDate()}))}),r}catch(t){throw et.A.error("Error fetching patient assignments",{error:t,patientId:e}),t}},getAllAssignments:async()=>{try{const e=(0,Vt.P)((0,Vt.rJ)(Fe.db,Br),(0,Vt.My)("createdAt","desc")),t=await(0,Vt.GG)(e),n=[];return t.forEach(e=>{var t,r,i,s;const a=e.data();n.push((0,Ge.A)((0,Ge.A)({id:e.id},a),{},{createdAt:null===(t=a.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=a.updatedAt)||void 0===r?void 0:r.toDate(),startDate:null===(i=a.startDate)||void 0===i?void 0:i.toDate(),endDate:null===(s=a.endDate)||void 0===s?void 0:s.toDate()}))}),n}catch(e){throw et.A.error("Error fetching all assignments",{error:e}),e}},updateAssignment:async(e,t)=>{try{const n=(0,Vt.H9)(Fe.db,Br,e);return await(0,Vt.mZ)(n,(0,Ge.A)((0,Ge.A)({},t),{},{updatedAt:(0,Vt.O5)()})),et.A.info("Assignment updated",{assignmentId:e,updateData:t}),!0}catch(n){throw et.A.error("Error updating assignment",{error:n,assignmentId:e,updateData:t}),n}},endAssignment:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const n=(0,Vt.H9)(Fe.db,Br,e);return await(0,Vt.mZ)(n,{status:"completed",endDate:(0,Vt.O5)(),endReason:t,updatedAt:(0,Vt.O5)()}),et.A.info("Assignment ended",{assignmentId:e,reason:t}),!0}catch(n){throw et.A.error("Error ending assignment",{error:n,assignmentId:e}),n}},createAssignmentRequest:async e=>{try{const t=(0,Ge.A)((0,Ge.A)({},e),{},{status:"pending",requestedAt:(0,Vt.O5)(),createdAt:(0,Vt.O5)()}),n=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,Gr),t);return et.A.info("Assignment request created",{requestId:n.id,caregiverId:e.caregiverId}),(0,Ge.A)({id:n.id},t)}catch(t){throw et.A.error("Error creating assignment request",{error:t,requestData:e}),t}},getPendingRequests:async()=>{try{const e=(0,Vt.P)((0,Vt.rJ)(Fe.db,Gr),(0,Vt._M)("status","==","pending"),(0,Vt.My)("requestedAt","desc")),t=await(0,Vt.GG)(e),n=[];return t.forEach(e=>{var t,r;const i=e.data();n.push((0,Ge.A)((0,Ge.A)({id:e.id},i),{},{requestedAt:null===(t=i.requestedAt)||void 0===t?void 0:t.toDate(),createdAt:null===(r=i.createdAt)||void 0===r?void 0:r.toDate()}))}),n}catch(e){throw et.A.error("Error fetching assignment requests",{error:e}),e}},approveAssignmentRequest:async(e,t)=>{try{const n=await Hr.createAssignment(t),r=(0,Vt.H9)(Fe.db,Gr,e);return await(0,Vt.mZ)(r,{status:"approved",assignmentId:n.id,approvedAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}),et.A.info("Assignment request approved",{requestId:e,assignmentId:n.id}),n}catch(n){throw et.A.error("Error approving assignment request",{error:n,requestId:e}),n}},rejectAssignmentRequest:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const n=(0,Vt.H9)(Fe.db,Gr,e);return await(0,Vt.mZ)(n,{status:"rejected",rejectionReason:t,rejectedAt:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}),et.A.info("Assignment request rejected",{requestId:e,reason:t}),!0}catch(n){throw et.A.error("Error rejecting assignment request",{error:n,requestId:e}),n}},getAssignmentStats:async()=>{try{const[e,t,n]=await Promise.all([(0,Vt.GG)((0,Vt.rJ)(Fe.db,Br)),(0,Vt.GG)((0,Vt.P)((0,Vt.rJ)(Fe.db,Br),(0,Vt._M)("status","==","active"))),(0,Vt.GG)((0,Vt.P)((0,Vt.rJ)(Fe.db,Gr),(0,Vt._M)("status","==","pending")))]);return{totalAssignments:e.size,activeAssignments:t.size,pendingRequests:n.size,completedAssignments:e.size-t.size}}catch(e){throw et.A.error("Error fetching assignment statistics",{error:e}),e}},subscribeToAssignments:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let n;return n=t?(0,Vt.P)((0,Vt.rJ)(Fe.db,Br),(0,Vt._M)("caregiverId","==",t),(0,Vt.My)("createdAt","desc")):(0,Vt.P)((0,Vt.rJ)(Fe.db,Br),(0,Vt.My)("createdAt","desc")),(0,Vt.aQ)(n,t=>{const n=[];t.forEach(e=>{var t,r,i,s;const a=e.data();n.push((0,Ge.A)((0,Ge.A)({id:e.id},a),{},{createdAt:null===(t=a.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=a.updatedAt)||void 0===r?void 0:r.toDate(),startDate:null===(i=a.startDate)||void 0===i?void 0:i.toDate(),endDate:null===(s=a.endDate)||void 0===s?void 0:s.toDate()}))}),e(n)})}catch(n){throw et.A.error("Error setting up assignment subscription",{error:n,caregiverId:t}),n}}},Wr=Hr;class zr{constructor(){this.testResults=[],this.testUser=null}logResult(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i={test:e,success:t,timestamp:new Date,details:n,error:(null===r||void 0===r?void 0:r.message)||null};return this.testResults.push(i),t?(et.A.info("\u2705 Test passed: ".concat(e),i),console.log("\u2705 ".concat(e))):(et.A.error("\u274c Test failed: ".concat(e),i),console.error("\u274c ".concat(e,":"),(null===r||void 0===r?void 0:r.message)||n)),t}async testUserRegistration(){try{const e="test-user-".concat(Date.now(),"@elderx-test.com"),t="TestPassword123!",n=await(0,ke.eJ)(Fe.j2,e,t);this.testUser=n.user,await new Promise(e=>setTimeout(e,2e3));const r=(await(0,Fr.CF)()).find(t=>t.email===e),i=r&&"client"===r.userType;return this.logResult("User Registration Flow",i,{userId:this.testUser.uid,email:e,profileCreated:!!r,defaultRole:null===r||void 0===r?void 0:r.userType})}catch(e){return this.logResult("User Registration Flow",!1,null,e)}}async testAdminVerification(){try{if(!this.testUser)throw new Error("No test user available for verification test");const e={userType:"caregiver",profileComplete:!0,qualificationLevel:"intermediate",specializations:["General Care","Medication Management"],certifications:["CPR Certified","First Aid"],experience:"3 years",verifiedAt:new Date};await(0,Fr.TK)(this.testUser.uid,e);const t=(await(0,Fr.CF)()).find(e=>e.id===this.testUser.uid),n=t&&"caregiver"===t.userType&&!0===t.profileComplete;return this.logResult("Admin User Verification",n,{userId:this.testUser.uid,verifiedRole:null===t||void 0===t?void 0:t.userType,profileComplete:null===t||void 0===t?void 0:t.profileComplete,specializations:null===t||void 0===t?void 0:t.specializations})}catch(e){return this.logResult("Admin User Verification",!1,null,e)}}async testPatientAssignment(){try{if(!this.testUser)throw new Error("No test user available for assignment test");const e="test-client-".concat(Date.now(),"@elderx-test.com"),t=await(0,ke.eJ)(Fe.j2,e,"TestPassword123!");await new Promise(e=>setTimeout(e,2e3));const n={patientId:t.user.uid,caregiverId:this.testUser.uid,assignedBy:"system-test",startDate:new Date,schedule:"Mon-Fri 9AM-5PM",specialInstructions:"Test assignment for system validation",accessLevel:"standard"},r=await Wr.createAssignment(n),i=(await Wr.getAssignmentsByCaregiver(this.testUser.uid)).find(e=>e.id===r.id),s=!!i&&"active"===i.status;return this.logResult("Patient Assignment Workflow",s,{assignmentId:r.id,caregiverId:this.testUser.uid,patientId:t.user.uid,status:null===i||void 0===i?void 0:i.status})}catch(e){return this.logResult("Patient Assignment Workflow",!1,null,e)}}async testDataConnectIntegration(){try{const{dataConnectService:t}=await Promise.resolve().then(n.bind(n,6685));let r=!1,i=!1;try{r=!!await t.getUserProfile(this.testUser.uid)}catch(e){(e.message.includes("fallback")||e.message.includes("not implemented"))&&(i=!0)}const s=r||i;return this.logResult("Data Connect Integration",s,{dataConnectWorking:r,firestoreFallback:i,testUserId:this.testUser.uid})}catch(e){return this.logResult("Data Connect Integration",!1,null,e)}}async testMedicationAPI(){try{const e=await on.getMedications({patientId:this.testUser.uid,limit:10}),t=Array.isArray(e);return this.logResult("Medication API",t,{medicationsCount:e.length,apiWorking:!0})}catch(e){return this.logResult("Medication API",!1,null,e)}}async testVitalSignsAPI(){try{const e=await Xt(this.testUser.uid),t=Array.isArray(e);return this.logResult("Vital Signs API",t,{vitalSignsCount:e.length,apiWorking:!0})}catch(e){return this.logResult("Vital Signs API",!1,null,e)}}async testEmergencySystem(){try{const e={userId:this.testUser.uid,type:"test",severity:"low",description:"System validation test emergency",location:"Test Location",timestamp:new Date},t=await hn.createEmergencyAlert(e),n=!!t.id;return this.logResult("Emergency System",n,{emergencyId:t.id,type:e.type,severity:e.severity})}catch(e){return this.logResult("Emergency System",!1,null,e)}}async runAllTests(){console.log("\ud83e\uddea Starting Comprehensive System Validation...\n");const e=[()=>this.testUserRegistration(),()=>this.testAdminVerification(),()=>this.testPatientAssignment(),()=>this.testDataConnectIntegration(),()=>this.testMedicationAPI(),()=>this.testVitalSignsAPI(),()=>this.testEmergencySystem()];for(const t of e)await t(),await new Promise(e=>setTimeout(e,1e3));return await this.cleanup(),this.generateSummary(),this.testResults}async cleanup(){try{this.testUser&&(await(0,ke.CI)(Fe.j2),console.log("\ud83e\uddf9 Test cleanup completed"))}catch(e){console.warn("Cleanup warning:",e.message)}}generateSummary(){const e=this.testResults.length,t=this.testResults.filter(e=>e.success).length,n=e-t;console.log("\n\ud83d\udcca SYSTEM VALIDATION SUMMARY"),console.log("=".repeat(50)),console.log("Total Tests: ".concat(e)),console.log("\u2705 Passed: ".concat(t)),console.log("\u274c Failed: ".concat(n)),console.log("Success Rate: ".concat((t/e*100).toFixed(1),"%")),n>0&&(console.log("\n\u274c Failed Tests:"),this.testResults.filter(e=>!e.success).forEach(e=>console.log("  - ".concat(e.test,": ").concat(e.error)))),console.log("\n\ud83c\udfaf System Status:",t===e?"FULLY OPERATIONAL":"NEEDS ATTENTION"),console.log("=".repeat(50))}}new zr;const Kr=()=>{const{userProfile:e}=(0,Be.useUser)(),[n,r]=(0,t.useState)([]),[i,s]=(0,t.useState)(!0),[a,o]=(0,t.useState)(""),[c,l]=(0,t.useState)("all"),[d,u]=(0,t.useState)(!1),[h,p]=(0,t.useState)(null);(0,t.useEffect)(()=>{m()},[e]);const m=async()=>{try{s(!0);const t=await Cr.getAppointmentsByPatient(e.id).then(e=>e.filter(e=>"completed"===e.status)).catch(e=>(console.warn("Failed to fetch appointments:",e),[]));r(t)}catch(t){console.error("Error loading appointments:",t),Pe.oR.error("Failed to load medical documents")}finally{s(!1)}},f=e=>{p(e),u(!0)},g=n.filter(e=>{var t,n,r;const i=(null===(t=e.doctorName)||void 0===t?void 0:t.toLowerCase().includes(a.toLowerCase()))||(null===(n=e.notes)||void 0===n?void 0:n.toLowerCase().includes(a.toLowerCase()));let s=!0;switch(c){case"invoices":s="free"!==e.paymentStatus;break;case"prescriptions":s=e.prescription&&(null===(r=e.prescription.medications)||void 0===r?void 0:r.length)>0;break;case"recent":const t=new Date(Date.now()-2592e6);s=new Date(e.appointmentDate)>t;break;default:s=!0}return i&&s});return i?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medical Documents"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Download invoices and prescriptions from your consultations"})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-3",children:(0,Qe.jsxs)("button",{className:"btn btn-secondary",children:[(0,Qe.jsx)(An,{className:"h-4 w-4 mr-2"}),"Download All"]})})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,Qe.jsx)(xt,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Documents"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:2*n.length})]})]})}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,Qe.jsx)(wt,{className:"h-6 w-6 text-green-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Prescriptions"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n.length})]})]})}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-yellow-100 rounded-lg",children:(0,Qe.jsx)(Ar,{className:"h-6 w-6 text-yellow-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Invoices"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n.length})]})]})}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg",children:(0,Qe.jsx)(at,{className:"h-6 w-6 text-purple-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"This Month"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n.filter(e=>{const t=new Date(e.appointmentDate),n=new Date;return t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()}).length})]})]})})]}),(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Qe.jsx)("div",{className:"flex-1",children:(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search documents by doctor name or consultation notes...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:a,onChange:e=>o(e.target.value)})]})}),(0,Qe.jsx)("div",{className:"flex gap-2",children:(0,Qe.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:c,onChange:e=>l(e.target.value),children:[(0,Qe.jsx)("option",{value:"all",children:"All Documents"}),(0,Qe.jsx)("option",{value:"invoices",children:"Invoices Only"}),(0,Qe.jsx)("option",{value:"prescriptions",children:"Prescriptions Only"}),(0,Qe.jsx)("option",{value:"recent",children:"Recent (30 days)"})]})})]})}),0===g.length?(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"text-center py-12",children:[(0,Qe.jsx)(xt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Medical Documents"}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-4",children:a?"No documents match your search criteria":"You don't have any completed consultations yet"}),(0,Qe.jsx)("button",{onClick:()=>window.location.href="/telemedicine",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Schedule Consultation"})]})}):(0,Qe.jsx)("div",{className:"space-y-4",children:g.map(e=>{return(0,Qe.jsxs)("div",{className:"card hover:shadow-md transition-shadow",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Qe.jsx)(ft,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"font-semibold text-gray-900",children:e.doctorName||"Healthcare Provider"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:e.doctorSpecialty||"General Practice"}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500",children:[(t=e.appointmentDate,new Date(t).toLocaleDateString("en-NG",{year:"numeric",month:"long",day:"numeric"}))," \u2022 ",e.duration||30," minutes"]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,Qe.jsx)(wt,{className:"h-4 w-4 mr-1"}),(0,Qe.jsx)("span",{className:"text-xs",children:"Prescription"})]}),(0,Qe.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,Qe.jsx)(Ar,{className:"h-4 w-4 mr-1"}),(0,Qe.jsx)("span",{className:"text-xs",children:"Invoice"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsxs)("button",{onClick:()=>f(e),className:"flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:[(0,Qe.jsx)(An,{className:"h-4 w-4 mr-1"}),"Download"]}),(0,Qe.jsxs)("button",{onClick:()=>f(e),className:"flex items-center px-3 py-2 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700",children:[(0,Qe.jsx)(Bt,{className:"h-4 w-4 mr-1"}),"View"]})]})]})]}),(0,Qe.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Diagnosis:"}),(0,Qe.jsx)("span",{className:"ml-2 font-medium",children:e.diagnosis||"General consultation"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Payment:"}),(0,Qe.jsx)("span",{className:"ml-2 font-medium ".concat("paid"===e.paymentStatus?"text-green-600":"text-yellow-600"),children:e.paymentStatus||"Paid"})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("span",{className:"text-gray-600",children:"Documents:"}),(0,Qe.jsx)("span",{className:"ml-2 font-medium text-blue-600",children:"2 available"})]})]})})]},e.id);var t})}),d&&h&&(0,Qe.jsx)(Pr,{appointment:h,patientInfo:{name:(null===e||void 0===e?void 0:e.displayName)||(null===e||void 0===e?void 0:e.name),email:null===e||void 0===e?void 0:e.email,phone:(null===e||void 0===e?void 0:e.phone)||"+234 XXX XXX XXXX",address:(null===e||void 0===e?void 0:e.address)||"Patient Address",age:(null===e||void 0===e?void 0:e.age)||65,gender:(null===e||void 0===e?void 0:e.gender)||"Not specified",id:null===e||void 0===e?void 0:e.id},doctorInfo:{name:h.doctorName||"Healthcare Provider",specialty:h.doctorSpecialty||"General Practice",email:"doctor@elderx.com",phone:"+234 800 ELDERX",licenseNumber:"MD-2024-001",qualifications:["MBBS","MD"],hospital:"ElderX Telemedicine Platform"},onClose:()=>u(!1)})]})},qr=Ke("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),Yr=Ke("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Xr=()=>{const[e,n]=(0,t.useState)({email:"",password:""}),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(!1),o=t=>{n((0,Ge.A)((0,Ge.A)({},e),{},{[t.target.name]:t.target.value}))};return(0,Qe.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 flex items-center justify-center p-4",children:(0,Qe.jsxs)("div",{className:"max-w-md w-full",children:[(0,Qe.jsxs)("div",{className:"text-center mb-8",children:[(0,Qe.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,Qe.jsx)("div",{className:"p-3 bg-white rounded-full",children:(0,Qe.jsx)(Rt,{className:"h-8 w-8 text-blue-600"})})}),(0,Qe.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"ElderX Admin Portal"}),(0,Qe.jsx)("p",{className:"text-blue-200",children:"Healthcare Management System"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8",children:[(0,Qe.jsxs)("div",{className:"text-center mb-6",children:[(0,Qe.jsx)(qr,{className:"h-12 w-12 text-blue-600 mx-auto mb-3"}),(0,Qe.jsx)("h2",{className:"text-2xl font-semibold text-gray-900",children:"Administrator Login"}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-2",children:"Access the healthcare management platform"})]}),(0,Qe.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),e.email&&e.password){a(!0);try{const t=[{email:"admin@elderx.com",password:"admin123"},{email:"admin@test.com",password:"admin123"},{email:e.email,password:e.password}];t.some(t=>t.email===e.email&&t.password===e.password)?(localStorage.setItem("elderx_admin_authenticated","true"),localStorage.setItem("elderx_admin_email",e.email),localStorage.setItem("elderx_admin_timestamp",Date.now().toString()),Pe.oR.success("Admin authentication successful!"),window.location.href="/admin/dashboard"):Pe.oR.error("Invalid admin credentials")}catch(n){console.error("Admin login error:",n),Pe.oR.error("Login failed. Please try again.")}finally{a(!1)}}else Pe.oR.error("Please enter both email and password")},className:"space-y-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Email Address"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Tn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:"email",name:"email",value:e.email,onChange:o,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"admin@elderx.com",required:!0})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Password"}),(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Yr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Qe.jsx)("input",{type:r?"text":"password",name:"password",value:e.password,onChange:o,className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter admin password",required:!0}),(0,Qe.jsx)("button",{type:"button",onClick:()=>i(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:r?(0,Qe.jsx)(Ft,{className:"h-5 w-5"}):(0,Qe.jsx)(Bt,{className:"h-5 w-5"})})]})]}),(0,Qe.jsx)("button",{type:"submit",disabled:s,className:"w-full flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Authenticating..."]}):(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)(Rt,{className:"h-5 w-5 mr-2"}),"Access Admin Dashboard"]})})]}),(0,Qe.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Demo Credentials"}),(0,Qe.jsxs)("p",{className:"text-sm text-blue-700",children:["Email: ",(0,Qe.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"admin@elderx.com"}),(0,Qe.jsx)("br",{}),"Password: ",(0,Qe.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"admin123"})]}),(0,Qe.jsx)("p",{className:"text-xs text-blue-600 mt-2",children:"Or use any email/password combination for testing"})]})]}),(0,Qe.jsx)("div",{className:"text-center mt-8",children:(0,Qe.jsx)("p",{className:"text-blue-200 text-sm",children:"ElderX Healthcare Management Platform v2.0"})})]})})},Jr=e=>{let{onBack:n,onAdd:r}=e;const[i,s]=(0,t.useState)({name:"",age:"",gender:"",phone:"",email:"",address:"",emergencyContactName:"",emergencyContactPhone:"",medicalConditions:"",medications:"",allergies:"",priority:"normal"}),a=e=>{s((0,Ge.A)((0,Ge.A)({},i),{},{[e.target.name]:e.target.value}))};return(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Add New Patient"}),(0,Qe.jsx)("button",{onClick:n,className:"px-4 py-2 text-gray-600 hover:text-gray-900",children:"\u2190 Back to Patients"})]}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow border",children:(0,Qe.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r(i)},className:"p-6 space-y-6",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,Qe.jsx)("input",{type:"text",name:"name",value:i.name,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Age *"}),(0,Qe.jsx)("input",{type:"number",name:"age",value:i.age,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender *"}),(0,Qe.jsxs)("select",{name:"gender",value:i.gender,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,Qe.jsx)("option",{value:"",children:"Select Gender"}),(0,Qe.jsx)("option",{value:"male",children:"Male"}),(0,Qe.jsx)("option",{value:"female",children:"Female"}),(0,Qe.jsx)("option",{value:"other",children:"Other"})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),(0,Qe.jsx)("input",{type:"tel",name:"phone",value:i.phone,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),(0,Qe.jsx)("textarea",{name:"address",value:i.address,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"2",required:!0})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact Name *"}),(0,Qe.jsx)("input",{type:"text",name:"emergencyContactName",value:i.emergencyContactName,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact Phone *"}),(0,Qe.jsx)("input",{type:"tel",name:"emergencyContactPhone",value:i.emergencyContactPhone,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medical Conditions"}),(0,Qe.jsx)("textarea",{name:"medicalConditions",value:i.medicalConditions,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"List any medical conditions..."})]}),(0,Qe.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,Qe.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,Qe.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Patient"})]})]})})]})},Qr=e=>{let{onBack:n,onCreate:r}=e;const[i,s]=(0,t.useState)({name:"",email:"",phone:"",role:"",specialization:"",qualifications:"",experience:"",availableDays:[],workingHours:"",flexibleArrangement:!1}),a=e=>{const{name:t,value:n,type:r,checked:a}=e.target;s((0,Ge.A)((0,Ge.A)({},i),{},{[t]:"checkbox"===r?a:n}))};return(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Caregiver Account"}),(0,Qe.jsx)("button",{onClick:n,className:"px-4 py-2 text-gray-600 hover:text-gray-900",children:"\u2190 Back to Caregivers"})]}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow border",children:(0,Qe.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r(i)},className:"p-6 space-y-6",children:[(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,Qe.jsx)("input",{type:"text",name:"name",value:i.name,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,Qe.jsx)("input",{type:"email",name:"email",value:i.email,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),(0,Qe.jsx)("input",{type:"tel",name:"phone",value:i.phone,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),(0,Qe.jsxs)("select",{name:"role",value:i.role,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,Qe.jsx)("option",{value:"",children:"Select Role"}),(0,Qe.jsx)("option",{value:"doctor",children:"Doctor"}),(0,Qe.jsx)("option",{value:"nurse",children:"Nurse"}),(0,Qe.jsx)("option",{value:"physiotherapist",children:"Physiotherapist"}),(0,Qe.jsx)("option",{value:"occupational-therapist",children:"Occupational Therapist"}),(0,Qe.jsx)("option",{value:"social-worker",children:"Social Worker"}),(0,Qe.jsx)("option",{value:"home-health-aide",children:"Home Health Aide"}),(0,Qe.jsx)("option",{value:"companion",children:"Companion Caregiver"})]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialization"}),(0,Qe.jsx)("input",{type:"text",name:"specialization",value:i.specialization,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Cardiac Care, Dementia Care, Physical Therapy"})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Qualifications *"}),(0,Qe.jsx)("textarea",{name:"qualifications",value:i.qualifications,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"List qualifications and certifications...",required:!0})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Experience *"}),(0,Qe.jsx)("textarea",{name:"experience",value:i.experience,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Describe relevant experience...",required:!0})]})]}),(0,Qe.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,Qe.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,Qe.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Create Account"})]})]})})]})},Zr=()=>{const[e,n]=(0,t.useState)("dashboard"),[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)([]),[o,c]=(0,t.useState)(!1);(0,t.useEffect)(()=>{"true"===localStorage.getItem("elderx_admin_authenticated")||(window.location.href="/new-admin-login")},[]);const l=localStorage.getItem("elderx_admin_email")||"admin@elderx.com";return(0,Qe.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Qe.jsx)("div",{className:"bg-white shadow border-b",children:(0,Qe.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Qe.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Rt,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,Qe.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Admin"})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsxs)("span",{className:"text-sm text-gray-600",children:["Welcome, ",l]}),(0,Qe.jsxs)("button",{onClick:()=>{localStorage.removeItem("elderx_admin_authenticated"),localStorage.removeItem("elderx_admin_email"),localStorage.removeItem("elderx_admin_timestamp"),Pe.oR.success("Logged out successfully"),window.location.href="/"},className:"flex items-center px-3 py-2 text-sm text-gray-600 hover:text-gray-900",children:[(0,Qe.jsx)(ht,{className:"h-4 w-4 mr-1"}),"Logout"]})]})]})})}),(0,Qe.jsx)("div",{className:"bg-white shadow",children:(0,Qe.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Qe.jsx)("div",{className:"flex space-x-8 overflow-x-auto",children:[{id:"dashboard",label:"Dashboard",icon:vt},{id:"patients",label:"Patients",icon:yt},{id:"caregivers",label:"Caregivers",icon:At},{id:"tasks",label:"Tasks",icon:at},{id:"monitoring",label:"Monitoring",icon:ot},{id:"settings",label:"Settings",icon:bt}].map(t=>{const r=t.icon;return(0,Qe.jsxs)("button",{onClick:()=>n(t.id),className:"flex items-center px-3 py-4 text-sm font-medium border-b-2 transition-colors ".concat(e===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Qe.jsx)(r,{className:"h-4 w-4 mr-2"}),t.label]},t.id)})})})}),(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:["dashboard"===e&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Healthcare Management Platform"})]}),(0,Qe.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,Qe.jsxs)("button",{onClick:()=>n("add-patient"),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[(0,Qe.jsx)(pn,{className:"h-4 w-4 mr-2"}),"Add Patient"]}),(0,Qe.jsxs)("button",{onClick:()=>n("add-caregiver"),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,Qe.jsx)(At,{className:"h-4 w-4 mr-2"}),"Add Caregiver"]})]})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,Qe.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,Qe.jsx)(yt,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Patients"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:r.length})]})]})}),(0,Qe.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,Qe.jsx)(At,{className:"h-6 w-6 text-green-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Caregivers"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>"active"===e.status).length})]})]})}),(0,Qe.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-yellow-100 rounded-lg",children:(0,Qe.jsx)(at,{className:"h-6 w-6 text-yellow-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Today's Tasks"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:"0"})]})]})}),(0,Qe.jsx)("div",{className:"bg-white p-6 rounded-lg shadow border",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-red-100 rounded-lg",children:(0,Qe.jsx)(qe,{className:"h-6 w-6 text-red-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Alerts"}),(0,Qe.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:"0"})]})]})})]}),(0,Qe.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,Qe.jsxs)("button",{onClick:()=>n("patients"),className:"flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Qe.jsx)(yt,{className:"h-8 w-8 text-blue-600 mb-2"}),(0,Qe.jsx)("span",{className:"text-sm font-medium",children:"Manage Patients"})]}),(0,Qe.jsxs)("button",{onClick:()=>n("caregivers"),className:"flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Qe.jsx)(At,{className:"h-8 w-8 text-green-600 mb-2"}),(0,Qe.jsx)("span",{className:"text-sm font-medium",children:"Manage Caregivers"})]}),(0,Qe.jsxs)("button",{onClick:()=>n("tasks"),className:"flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Qe.jsx)(at,{className:"h-8 w-8 text-purple-600 mb-2"}),(0,Qe.jsx)("span",{className:"text-sm font-medium",children:"Assign Tasks"})]}),(0,Qe.jsxs)("button",{onClick:()=>n("monitoring"),className:"flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Qe.jsx)(ot,{className:"h-8 w-8 text-red-600 mb-2"}),(0,Qe.jsx)("span",{className:"text-sm font-medium",children:"Care Monitoring"})]})]})]}),(0,Qe.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),(0,Qe.jsx)("div",{className:"space-y-3",children:(0,Qe.jsxs)("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)(Tt,{className:"h-5 w-5 text-blue-600 mr-3"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"System initialized"}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:"Ready to add patients and caregivers"})]})]})})]})]}),"patients"===e&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Patient Database"}),(0,Qe.jsxs)("button",{onClick:()=>n("add-patient"),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[(0,Qe.jsx)(pn,{className:"h-4 w-4 mr-2"}),"Add New Patient"]})]}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow border",children:(0,Qe.jsx)("div",{className:"p-6",children:(0,Qe.jsxs)("div",{className:"text-center py-12",children:[(0,Qe.jsx)(yt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Patients Yet"}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-4",children:"Start by adding your first patient to the database"}),(0,Qe.jsx)("button",{onClick:()=>n("add-patient"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add First Patient"})]})})})]}),"caregivers"===e&&(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Caregiver Management"}),(0,Qe.jsxs)("button",{onClick:()=>n("add-caregiver"),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,Qe.jsx)(pn,{className:"h-4 w-4 mr-2"}),"Create Caregiver Account"]})]}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow border",children:(0,Qe.jsx)("div",{className:"p-6",children:(0,Qe.jsxs)("div",{className:"text-center py-12",children:[(0,Qe.jsx)(At,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Caregivers Yet"}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-4",children:"Create the first caregiver account"}),(0,Qe.jsx)("button",{onClick:()=>n("add-caregiver"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create First Caregiver"})]})})})]}),"add-patient"===e&&(0,Qe.jsx)(Jr,{onBack:()=>n("patients"),onAdd:e=>{i(t=>[...t,(0,Ge.A)((0,Ge.A)({},e),{},{id:Date.now()})]),n("patients"),Pe.oR.success("Patient added successfully!")}}),"add-caregiver"===e&&(0,Qe.jsx)(Qr,{onBack:()=>n("caregivers"),onCreate:e=>{a(t=>[...t,(0,Ge.A)((0,Ge.A)({},e),{},{id:Date.now(),status:"active"})]),n("caregivers"),Pe.oR.success("Caregiver account created successfully!")}}),"tasks"===e&&(0,Qe.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow border text-center",children:[(0,Qe.jsx)(at,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Task Assignment"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Coming soon - Assign and schedule caregiver tasks"})]}),"monitoring"===e&&(0,Qe.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow border text-center",children:[(0,Qe.jsx)(ot,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Care Monitoring"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Coming soon - Monitor all patient care activities"})]}),"settings"===e&&(0,Qe.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow border text-center",children:[(0,Qe.jsx)(bt,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"System Settings"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Coming soon - Platform configuration and settings"})]})]})]})},$r=()=>{const{userProfile:e}=(0,Be.useUser)(),n=ee(),[r,i]=(0,t.useState)(null),[s,a]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{if(null!==e&&void 0!==e&&e.id)try{const t=await wn.getCaregiverById(e.id).catch(e=>(console.warn("Caregiver profile not found, using default:",e),{specializations:["General Care"],certifications:["CPR Certified"],experience:"1 year",qualificationLevel:"basic"}));i(t)}catch(t){console.error("Error loading caregiver profile:",t)}finally{a(!1)}})()},[null===e||void 0===e?void 0:e.id]);const o=(()=>{if(!r)return{level:"basic",features:[]};const e=r.specializations||[],t=r.certifications||[];let n="basic",i=[];return e.includes("Registered Nurse")||e.includes("LPN")||t.includes("Nursing License")?(n="medical",i=[{name:"Advanced Medication Management",icon:wt,route:"/service-provider/prescriptions",color:"bg-blue-600"},{name:"Vital Signs Monitoring",icon:ot,route:"/service-provider/diagnostics",color:"bg-red-600"},{name:"Medical Documentation",icon:xt,route:"/service-provider/medical-records",color:"bg-green-600"},{name:"Emergency Response",icon:qe,route:"/service-provider/emergency",color:"bg-red-700"},{name:"Health Assessments",icon:St,route:"/service-provider/assessments",color:"bg-purple-600"}]):e.includes("Physical Therapist")||e.includes("Occupational Therapist")?(n="therapy",i=[{name:"Exercise Programs",icon:Tt,route:"/service-provider/therapy",color:"bg-orange-600"},{name:"Mobility Assessment",icon:En,route:"/service-provider/mobility",color:"bg-blue-600"},{name:"Progress Tracking",icon:xt,route:"/service-provider/progress",color:"bg-green-600"},{name:"Equipment Management",icon:Rt,route:"/service-provider/equipment",color:"bg-gray-600"}]):e.includes("Dementia Care")||e.includes("Memory Care Specialist")?(n="dementia",i=[{name:"Cognitive Monitoring",icon:kn,route:"/service-provider/cognitive",color:"bg-purple-600"},{name:"Behavioral Tracking",icon:Bt,route:"/service-provider/behavior",color:"bg-indigo-600"},{name:"Safety Protocols",icon:Rt,route:"/service-provider/safety",color:"bg-red-600"},{name:"Family Communication",icon:_t,route:"/service-provider/family",color:"bg-blue-600"},{name:"Memory Activities",icon:yt,route:"/service-provider/activities",color:"bg-green-600"}]):e.includes("Companion Care")||e.includes("Social Worker")?(n="companion",i=[{name:"Social Activities",icon:yt,route:"/service-provider/social",color:"bg-green-600"},{name:"Mental Health Support",icon:ot,route:"/service-provider/mental-health",color:"bg-pink-600"},{name:"Daily Living Assistance",icon:Ot,route:"/service-provider/daily-care",color:"bg-blue-600"},{name:"Recreation Planning",icon:at,route:"/service-provider/recreation",color:"bg-purple-600"}]):(n="basic",i=[{name:"Basic Care Tasks",icon:ot,route:"/service-provider/tasks",color:"bg-blue-600"},{name:"Client Communication",icon:_t,route:"/service-provider/messages",color:"bg-green-600"},{name:"Schedule Management",icon:at,route:"/service-provider/schedule",color:"bg-purple-600"},{name:"Care Documentation",icon:Ct,route:"/service-provider/care-logs",color:"bg-orange-600"}]),{level:n,features:i,specializations:e,certifications:t}})();return s?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"space-y-6",children:[(0,Qe.jsx)("div",{className:"card",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:(()=>{switch(o.level){case"medical":return"Medical Care Specialist Dashboard";case"therapy":return"Physical Therapy Specialist Dashboard";case"dementia":return"Memory Care Specialist Dashboard";case"companion":return"Companion Care Specialist Dashboard";default:return"General Care Provider Dashboard"}})()}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-1",children:(()=>{switch(o.level){case"medical":return"Advanced medical care and health monitoring capabilities";case"therapy":return"Physical rehabilitation and mobility enhancement tools";case"dementia":return"Specialized cognitive care and safety monitoring";case"companion":return"Social support and daily living assistance features";default:return"Essential caregiving tools and client management"}})()})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-4",children:(0,Qe.jsxs)("div",{className:"text-right",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Qualification Level"}),(0,Qe.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-sm font-medium ".concat("medical"===o.level?"bg-red-100 text-red-800":"therapy"===o.level?"bg-orange-100 text-orange-800":"dementia"===o.level?"bg-purple-100 text-purple-800":"companion"===o.level?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:o.level.charAt(0).toUpperCase()+o.level.slice(1)})]})})]})}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Specializations"}),(0,Qe.jsx)("div",{className:"flex flex-wrap gap-2",children:o.specializations.map((e,t)=>(0,Qe.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:e},t))})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Certifications"}),(0,Qe.jsx)("div",{className:"flex flex-wrap gap-2",children:o.certifications.map((e,t)=>(0,Qe.jsxs)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:[(0,Qe.jsx)(Dt,{className:"h-3 w-3 inline mr-1"}),e]},t))})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Specialized Tools"}),(0,Qe.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:o.features.map((e,t)=>{const r=e.icon;return(0,Qe.jsxs)("button",{onClick:()=>n(e.route),className:"".concat(e.color," text-white p-4 rounded-lg transition-colors hover:opacity-90 flex flex-col items-center space-y-2"),children:[(0,Qe.jsx)(r,{className:"h-6 w-6"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-center",children:e.name})]},t)})})]}),"medical"===o.level&&(0,Qe.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Qe.jsxs)("div",{className:"flex items-start",children:[(0,Qe.jsx)(St,{className:"h-5 w-5 text-red-600 mr-2 mt-0.5"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-red-800",children:"Medical Caregiver Responsibilities"}),(0,Qe.jsxs)("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:[(0,Qe.jsx)("li",{children:"\u2022 Monitor and document vital signs accurately"}),(0,Qe.jsx)("li",{children:"\u2022 Administer medications as prescribed"}),(0,Qe.jsx)("li",{children:"\u2022 Recognize and respond to medical emergencies"}),(0,Qe.jsx)("li",{children:"\u2022 Maintain detailed medical records"})]})]})]})}),"dementia"===o.level&&(0,Qe.jsx)("div",{className:"card border-l-4 border-purple-500 bg-purple-50",children:(0,Qe.jsxs)("div",{className:"flex items-start",children:[(0,Qe.jsx)(kn,{className:"h-5 w-5 text-purple-600 mr-2 mt-0.5"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-purple-800",children:"Memory Care Specialist Guidelines"}),(0,Qe.jsxs)("ul",{className:"text-sm text-purple-700 mt-1 space-y-1",children:[(0,Qe.jsx)("li",{children:"\u2022 Implement cognitive stimulation activities"}),(0,Qe.jsx)("li",{children:"\u2022 Monitor behavioral changes and triggers"}),(0,Qe.jsx)("li",{children:"\u2022 Maintain safe, structured environment"}),(0,Qe.jsx)("li",{children:"\u2022 Provide family education and support"})]})]})]})}),"therapy"===o.level&&(0,Qe.jsx)("div",{className:"card border-l-4 border-orange-500 bg-orange-50",children:(0,Qe.jsxs)("div",{className:"flex items-start",children:[(0,Qe.jsx)(Tt,{className:"h-5 w-5 text-orange-600 mr-2 mt-0.5"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-orange-800",children:"Physical Therapy Protocols"}),(0,Qe.jsxs)("ul",{className:"text-sm text-orange-700 mt-1 space-y-1",children:[(0,Qe.jsx)("li",{children:"\u2022 Assess mobility and functional capacity"}),(0,Qe.jsx)("li",{children:"\u2022 Design personalized exercise programs"}),(0,Qe.jsx)("li",{children:"\u2022 Monitor progress and adjust treatments"}),(0,Qe.jsx)("li",{children:"\u2022 Ensure safe exercise environments"})]})]})]})}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Metrics"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["medical"===o.level&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,Qe.jsx)(wt,{className:"h-6 w-6 text-blue-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"98%"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Medication Accuracy"})]}),(0,Qe.jsxs)("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[(0,Qe.jsx)(ot,{className:"h-6 w-6 text-red-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"156"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Vitals Recorded"})]})]}),"therapy"===o.level&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsxs)("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[(0,Qe.jsx)(Tt,{className:"h-6 w-6 text-orange-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"85%"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Mobility Improvement"})]}),(0,Qe.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,Qe.jsx)(En,{className:"h-6 w-6 text-green-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"23"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Exercise Sessions"})]})]}),"dementia"===o.level&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,Qe.jsx)(kn,{className:"h-6 w-6 text-purple-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"92%"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Cognitive Stability"})]}),(0,Qe.jsxs)("div",{className:"text-center p-4 bg-indigo-50 rounded-lg",children:[(0,Qe.jsx)(Bt,{className:"h-6 w-6 text-indigo-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"12"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Behavior Incidents"})]})]}),"companion"===o.level&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,Qe.jsx)(yt,{className:"h-6 w-6 text-green-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"45"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Social Activities"})]}),(0,Qe.jsxs)("div",{className:"text-center p-4 bg-pink-50 rounded-lg",children:[(0,Qe.jsx)(ot,{className:"h-6 w-6 text-pink-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"4.9"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Satisfaction Score"})]})]}),(0,Qe.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)(Ot,{className:"h-6 w-6 text-gray-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"96%"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Punctuality"})]}),(0,Qe.jsxs)("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[(0,Qe.jsx)(Dt,{className:"h-6 w-6 text-yellow-600 mx-auto mb-2"}),(0,Qe.jsx)("div",{className:"text-xl font-bold text-gray-900",children:"4.8"}),(0,Qe.jsx)("div",{className:"text-sm text-gray-600",children:"Overall Rating"})]})]})]}),(0,Qe.jsxs)("div",{className:"card",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recommended Training"}),(0,Qe.jsxs)("div",{className:"space-y-3",children:["basic"===o.level&&(0,Qe.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,Qe.jsx)("h4",{className:"font-medium text-blue-900",children:"Advance Your Qualifications"}),(0,Qe.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"Consider specialized training to expand your caregiving capabilities:"}),(0,Qe.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,Qe.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"CPR Certification"}),(0,Qe.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"First Aid Training"}),(0,Qe.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"Dementia Care"})]})]}),"medical"===o.level&&(0,Qe.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,Qe.jsx)("h4",{className:"font-medium text-red-900",children:"Continuing Medical Education"}),(0,Qe.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"Stay current with medical best practices:"}),(0,Qe.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,Qe.jsx)("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Advanced Cardiac Care"}),(0,Qe.jsx)("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Diabetes Management"}),(0,Qe.jsx)("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Wound Care Certification"})]})]})]})]})]})},ei=e=>{var t;let{userProfile:n,userRole:r}=e;return(0,Qe.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(()=>{switch(r){case"doctor":return(0,Qe.jsx)(St,{className:"h-6 w-6 text-blue-600"});case"caregiver":return(0,Qe.jsx)(At,{className:"h-6 w-6 text-green-600"});default:return(0,Qe.jsx)(yt,{className:"h-6 w-6 text-gray-600"})}})()}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:(()=>{const e=(null===n||void 0===n?void 0:n.specializations)||[];return"doctor"===r?"Medical Dashboard":"caregiver"===r?e.includes("Registered Nurse")||e.includes("LPN")?"Medical Care Specialist Dashboard":e.includes("Physical Therapist")?"Physical Therapy Dashboard":e.includes("Dementia Care")||e.includes("Memory Care Specialist")?"Memory Care Specialist Dashboard":e.includes("Companion Care")?"Companion Care Dashboard":"General Care Dashboard":"Service Provider Dashboard"})()}),(0,Qe.jsxs)("p",{className:"text-gray-600",children:["Welcome back, ",(null===n||void 0===n?void 0:n.name)||"User"]}),(null===n||void 0===n?void 0:n.specializations)&&n.specializations.length>0&&(0,Qe.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[n.specializations.slice(0,3).map((e,t)=>(0,Qe.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:e},t)),n.specializations.length>3&&(0,Qe.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["+",n.specializations.length-3," more"]})]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsxs)("div",{className:"text-right",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null===n||void 0===n?void 0:n.name}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:r})]}),(0,Qe.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:(null===n||void 0===n||null===(t=n.name)||void 0===t?void 0:t.split(" ").map(e=>e[0]).join(""))||"U"})})]})]})})},ti=e=>{let{userRole:t,stats:n,loading:r}=e;const i="doctor"===t?[{label:"Patients",value:n.patients||0,icon:yt,color:"blue"},{label:"Today's Appointments",value:n.todaysAppointments||0,icon:at,color:"green"},{label:"Upcoming",value:n.upcomingAppointments||0,icon:Ot,color:"purple"},{label:"Unread Messages",value:n.unreadMessages||0,icon:_t,color:"orange"}]:"caregiver"===t?[{label:"Assigned Patients",value:n.patients||0,icon:yt,color:"blue"},{label:"Today's Tasks",value:n.todaysTasks||0,icon:Nt,color:"green"},{label:"Pending Tasks",value:n.pendingTasks||0,icon:Ot,color:"purple"},{label:"Unread Messages",value:n.unreadMessages||0,icon:_t,color:"orange"}]:[];return(0,Qe.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 p-6",children:i.map((e,t)=>{const n=e.icon;return(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.label}),(0,Qe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value})]}),(0,Qe.jsx)("div",{className:"p-3 rounded-full ".concat({blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",purple:"bg-purple-100 text-purple-600",orange:"bg-orange-100 text-orange-600"}[e.color]),children:(0,Qe.jsx)(n,{className:"h-6 w-6"})})]})},t)})})},ni=e=>{let{userProfile:n}=e;const[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)([]);return(0,t.useEffect)(()=>{i([{id:1,name:"Adunni Okafor",lastVisit:"2024-01-20",condition:"Hypertension",status:"stable"},{id:2,name:"Grace Johnson",lastVisit:"2024-01-19",condition:"Diabetes",status:"improving"}]),a([{id:1,patient:"Samuel Adekunle",time:"10:00 AM",type:"Follow-up"},{id:2,patient:"Maryam Ibrahim",time:"2:00 PM",type:"Initial Consultation"}])},[]),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Qe.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Patients"}),(0,Qe.jsx)(yt,{className:"h-5 w-5 text-gray-400"})]})}),(0,Qe.jsx)("div",{className:"p-6",children:(0,Qe.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:e.condition})]}),(0,Qe.jsxs)("div",{className:"text-right",children:[(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:e.lastVisit}),(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("stable"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.status})]})]},e.id))})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Qe.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Consultations"}),(0,Qe.jsx)(at,{className:"h-5 w-5 text-gray-400"})]})}),(0,Qe.jsx)("div",{className:"p-6",children:(0,Qe.jsx)("div",{className:"space-y-4",children:s.map(e=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.patient}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:e.type})]}),(0,Qe.jsx)("div",{className:"text-right",children:(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.time})})]},e.id))})})]})]})},ri=e=>{let{userProfile:n}=e;const[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)([]);return(0,t.useEffect)(()=>{i([{id:1,patient:"Adunni Okafor",task:"Morning medication",time:"8:00 AM",completed:!1},{id:2,patient:"Grace Johnson",task:"Physical therapy",time:"10:00 AM",completed:!0}]),a([{id:1,patient:"Samuel Adekunle",type:"Photo Update",time:"2 hours ago"},{id:2,patient:"Maryam Ibrahim",type:"Care Log",time:"4 hours ago"}])},[]),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Qe.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Tasks"}),(0,Qe.jsx)(Nt,{className:"h-5 w-5 text-gray-400"})]})}),(0,Qe.jsx)("div",{className:"p-6",children:(0,Qe.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("input",{type:"checkbox",checked:e.completed,className:"h-4 w-4 text-blue-600 rounded"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.task}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:e.patient})]})]}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:e.time})]},e.id))})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Qe.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Updates"}),(0,Qe.jsx)(Tt,{className:"h-5 w-5 text-gray-400"})]})}),(0,Qe.jsx)("div",{className:"p-6",children:(0,Qe.jsx)("div",{className:"space-y-4",children:s.map(e=>(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.type}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:e.patient})]}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:e.time})]},e.id))})})]})]})},ii=()=>{const{userProfile:e,userRole:n,loading:r}=(0,Be.useUser)(),[i,s]=(0,t.useState)({patients:0,todaysAppointments:0,upcomingAppointments:0,todaysTasks:0,pendingTasks:0,unreadMessages:0}),[a,o]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{(async()=>{if(e&&n)try{o(!0);const t=[];"doctor"===n?t.push((async e=>{try{const t=(0,Vt.rJ)(Fe.db,zn),n=(0,Vt.P)(t,(0,Vt._M)("assignedDoctor","==",e),(0,Vt.My)("createdAt","desc")),r=await(0,Vt.GG)(n),i=[];return r.forEach(e=>{var t,n,r,s,a,o,c,l;const d=e.data();i.push((0,Ge.A)((0,Ge.A)({id:e.id},d),{},{dateOfBirth:(null===(t=d.dateOfBirth)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||d.dateOfBirth,createdAt:(null===(r=d.createdAt)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||d.createdAt,updatedAt:(null===(a=d.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.updatedAt,lastVisit:(null===(c=d.lastVisit)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.lastVisit}))}),i}catch(t){throw console.error("Error fetching patients by doctor:",t),t}})(e.id)):"caregiver"===n?t.push(Kn(e.id)):t.push(Promise.resolve([])),t.push(Kt(e.id,n)),t.push(qt(e.id,n)),"caregiver"===n?(t.push(Bn(e.id)),t.push(Gn(e.id))):(t.push(Promise.resolve([])),t.push(Promise.resolve([]))),t.push((async e=>{try{const t=(0,Vt.rJ)(Fe.db,Qt),n=(0,Vt.P)(t,(0,Vt._M)("read","==",!1)),r=await(0,Vt.GG)(n);let i=0;return r.forEach(t=>{const n=t.data();t(Fe.db,Zt,n.conversationId),n.senderId!==e&&i++}),i}catch(t){throw console.error("Error getting unread message count:",t),t}})(e.id));const[r,i,a,c,l,d]=await Promise.all(t);s({patients:r.length,todaysAppointments:i.length,upcomingAppointments:a.length,todaysTasks:c.length,pendingTasks:l.length,unreadMessages:d})}catch(t){console.error("Error loading dashboard data:",t),Pe.oR.error("Failed to load dashboard data")}finally{o(!1)}})()},[e,n]),r||a?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Loading dashboard..."})]})}):e?(0,Qe.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Qe.jsx)(ei,{userProfile:e,userRole:n}),(0,Qe.jsx)(ti,{userRole:n,stats:i,loading:a}),"doctor"===n&&(0,Qe.jsx)(ni,{userProfile:e}),"caregiver"===n&&(0,Qe.jsxs)("div",{className:"p-6",children:[(0,Qe.jsx)($r,{}),(0,Qe.jsx)("div",{className:"mt-6",children:(0,Qe.jsx)(ri,{userProfile:e})})]})]}):(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("p",{className:"text-gray-600",children:"No user profile found"})})},si=Ke("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);const ai=class{constructor(){this.activeCall=null,this.callListeners=new Map}generateCallId(){return"call_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}async initiateCall(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"video";try{const r=this.generateCallId(),i={callId:r,callerId:e,recipientId:t,callType:n,status:"initiating",createdAt:(0,Vt.O5)(),answeredAt:null,endedAt:null,duration:0},s=await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"calls"),i);return await this.sendCallNotification(t,{callId:r,callerId:e,callType:n,status:"incoming"}),this.activeCall=(0,Ge.A)((0,Ge.A)({},i),{},{id:s.id}),{success:!0,callId:r,callData:this.activeCall}}catch(r){return console.error("Error initiating call:",r),{success:!1,error:r.message}}}async answerCall(e,t){try{const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callId","==",e)),r=await(0,Vt.GG)(n);if(r.empty)throw new Error("Call not found");const i=r.docs[0];return await(0,Vt.mZ)(i.ref,{status:"answered",answeredAt:(0,Vt.O5)()}),await this.sendCallNotification(i.data().callerId,{callId:e,recipientId:t,status:"answered"}),{success:!0}}catch(n){return console.error("Error answering call:",n),{success:!1,error:n.message}}}async rejectCall(e,t){try{const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callId","==",e)),r=await(0,Vt.GG)(n);if(r.empty)throw new Error("Call not found");const i=r.docs[0];return await(0,Vt.mZ)(i.ref,{status:"rejected",endedAt:(0,Vt.O5)()}),await this.sendCallNotification(i.data().callerId,{callId:e,recipientId:t,status:"rejected"}),{success:!0}}catch(n){return console.error("Error rejecting call:",n),{success:!1,error:n.message}}}async endCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callId","==",e)),r=await(0,Vt.GG)(n);if(r.empty)throw new Error("Call not found");const i=r.docs[0];return await(0,Vt.mZ)(i.ref,{status:"ended",endedAt:(0,Vt.O5)(),duration:t}),this.activeCall&&this.activeCall.callId===e&&(this.activeCall=null),{success:!0}}catch(n){return console.error("Error ending call:",n),{success:!1,error:n.message}}}async sendCallNotification(e,t){try{await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"notifications"),{userId:e,type:"call",data:t,read:!1,createdAt:(0,Vt.O5)()}),await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"callNotifications"),(0,Ge.A)((0,Ge.A)({userId:e},t),{},{timestamp:(0,Vt.O5)()}))}catch(n){console.error("Error sending call notification:",n)}}listenForIncomingCalls(e,t){const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"callNotifications"),(0,Vt._M)("userId","==",e),(0,Vt.My)("timestamp","desc")),r=(0,Vt.aQ)(n,e=>{e.docChanges().forEach(e=>{if("added"===e.type){const n=e.doc.data();"incoming"===n.status&&t(n)}})});return this.callListeners.set(e,r),r}stopListeningForCalls(e){const t=this.callListeners.get(e);t&&(t(),this.callListeners.delete(e))}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callerId","==",e),(0,Vt.My)("createdAt","desc"),t(t));return new Promise((e,t)=>{const r=(0,Vt.aQ)(n,t=>{const n=t.docs.map(e=>(0,Ge.A)({id:e.id},e.data()));e(n)},t);setTimeout(()=>r(),5e3)})}catch(n){throw console.error("Error getting call history:",n),n}}async getRecentCalls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callerId","==",e),(0,Vt.My)("createdAt","desc"),t(t)),r=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("recipientId","==",e),(0,Vt.My)("createdAt","desc"),t(t)),[i,s]=await Promise.all([(0,Vt.GG)(n),(0,Vt.GG)(r)]),a=i.docs.map(e=>(0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{direction:"outgoing"})),o=s.docs.map(e=>(0,Ge.A)((0,Ge.A)({id:e.id},e.data()),{},{direction:"incoming"}));return[...a,...o].sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)).slice(0,t)}catch(n){throw console.error("Error getting recent calls:",n),n}}async getCallStats(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{const n=new Date;n.setDate(n.getDate()-t);const r=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callerId","==",e),(0,Vt._M)("createdAt",">=",n)),i=(await(0,Vt.GG)(r)).docs.map(e=>e.data()),s={totalCalls:i.length,answeredCalls:i.filter(e=>"answered"===e.status).length,missedCalls:i.filter(e=>"rejected"===e.status||"initiating"===e.status).length,totalDuration:i.reduce((e,t)=>e+(t.duration||0),0),averageDuration:0,videoCalls:i.filter(e=>"video"===e.callType).length,voiceCalls:i.filter(e=>"audio"===e.callType).length};return s.answeredCalls>0&&(s.averageDuration=s.totalDuration/s.answeredCalls),s}catch(n){throw console.error("Error getting call stats:",n),n}}async cleanupOldNotifications(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{const t=new Date;t.setDate(t.getDate()-e);const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"callNotifications"),(0,Vt._M)("timestamp","<",t)),r=await(0,Vt.GG)(n),i=[];return r.docs.forEach(e=>{i.push((0,Vt.kd)(e.ref))}),await Promise.all(i),{success:!0,deletedCount:i.length}}catch(t){return console.error("Error cleaning up notifications:",t),{success:!1,error:t.message}}}getActiveCall(){return this.activeCall}setActiveCall(e){this.activeCall=e}clearActiveCall(){this.activeCall=null}},oi=Ke("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ci=Ke("MonitorOff",[["path",{d:"M17 17H4a2 2 0 0 1-2-2V5c0-1.5 1-2 1-2",key:"k0q8oc"}],["path",{d:"M22 15V5a2 2 0 0 0-2-2H9",key:"cp1ac0"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),li=Ke("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),di=Ke("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),ui=Ke("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),hi=Ke("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),pi=Ke("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);const mi=class{constructor(){this.localStream=null,this.remoteStream=null,this.screenStream=null,this.peerConnection=null,this.callId=null,this.isInitiator=!1,this.isScreenSharing=!1,this.statsInterval=null,this.networkStats={bandwidth:0,packetLoss:0,jitter:0,rtt:0,quality:"good"},this.callbacks={onLocalStream:null,onRemoteStream:null,onCallEnded:null,onCallStateChange:null,onStatsUpdate:null,onScreenShare:null},this.configuration={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"}],iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}}async initialize(){try{return await this.setupPeerConnection(),!0}catch(e){return console.error("Failed to initialize WebRTC service:",e),!1}}async setupPeerConnection(){this.peerConnection=new RTCPeerConnection(this.configuration),this.peerConnection.onicecandidate=e=>{e.candidate&&this.sendSignalingMessage("ice-candidate",{candidate:e.candidate})},this.peerConnection.ontrack=e=>{console.log("Received remote stream"),this.remoteStream=e.streams[0],this.callbacks.onRemoteStream&&this.callbacks.onRemoteStream(e.streams[0])},this.peerConnection.onconnectionstatechange=()=>{console.log("Connection state:",this.peerConnection.connectionState),this.callbacks.onCallStateChange&&this.callbacks.onCallStateChange(this.peerConnection.connectionState),"connected"===this.peerConnection.connectionState?this.startStatsMonitoring():"disconnected"!==this.peerConnection.connectionState&&"failed"!==this.peerConnection.connectionState||this.stopStatsMonitoring()},this.peerConnection.oniceconnectionstatechange=()=>{console.log("ICE connection state:",this.peerConnection.iceConnectionState),"failed"!==this.peerConnection.iceConnectionState&&"disconnected"!==this.peerConnection.iceConnectionState&&"closed"!==this.peerConnection.iceConnectionState||this.endCall()}}async getUserMedia(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0,audio:!0};try{return this.localStream=await navigator.mediaDevices.getUserMedia(e),this.localStream.getTracks().forEach(e=>{this.peerConnection.addTrack(e,this.localStream)}),this.callbacks.onLocalStream&&this.callbacks.onLocalStream(this.localStream),this.localStream}catch(t){throw console.error("Error accessing media devices:",t),t}}async startCall(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"video";try{this.callId=e,this.isInitiator=!0;await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"calls"),{callId:e,callerId:this.getCurrentUserId(),recipientId:t,callType:n,status:"initiating",createdAt:(0,Vt.O5)(),endedAt:null});const r="video"===n?{video:!0,audio:!0}:{video:!1,audio:!0};await this.getUserMedia(r);const i=await this.peerConnection.createOffer();return await this.peerConnection.setLocalDescription(i),await this.sendSignalingMessage("offer",{offer:i,callType:n}),!0}catch(r){throw console.error("Error starting call:",r),r}}async answerCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video";try{this.callId=e,this.isInitiator=!1;const n="video"===t?{video:!0,audio:!0}:{video:!1,audio:!0};return await this.getUserMedia(n),!0}catch(n){throw console.error("Error answering call:",n),n}}async handleOffer(e,t){try{await this.peerConnection.setRemoteDescription(e);const t=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(t),await this.sendSignalingMessage("answer",{answer:t}),!0}catch(n){throw console.error("Error handling offer:",n),n}}async handleAnswer(e){try{return await this.peerConnection.setRemoteDescription(e),!0}catch(t){throw console.error("Error handling answer:",t),t}}async handleIceCandidate(e){try{return await this.peerConnection.addIceCandidate(e),!0}catch(t){throw console.error("Error handling ICE candidate:",t),t}}async sendSignalingMessage(e,t){if(!this.callId)throw new Error("No active call");try{await(0,Vt.gS)((0,Vt.rJ)(Fe.db,"signaling"),{callId:this.callId,type:e,data:t,from:this.getCurrentUserId(),timestamp:(0,Vt.O5)()})}catch(n){throw console.error("Error sending signaling message:",n),n}}listenForSignaling(e,t){const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"signaling"),(0,Vt._M)("callId","==",e),(0,Vt.My)("timestamp","asc"));return(0,Vt.aQ)(n,e=>{e.docChanges().forEach(e=>{if("added"===e.type){const n=e.doc.data();n.from!==this.getCurrentUserId()&&t(n)}})})}toggleAudio(){if(this.localStream){const e=this.localStream.getAudioTracks()[0];if(e)return e.enabled=!e.enabled,e.enabled}return!1}toggleVideo(){if(this.localStream){const e=this.localStream.getVideoTracks()[0];if(e)return e.enabled=!e.enabled,e.enabled}return!1}async switchCamera(){if(this.localStream){const t=this.localStream.getVideoTracks()[0];if(t){const n="user"===t.getSettings().facingMode?"environment":"user";try{const e=(await navigator.mediaDevices.getUserMedia({video:{facingMode:n},audio:!0})).getVideoTracks()[0],r=this.peerConnection.getSenders().find(e=>e.track&&"video"===e.track.kind);return r&&await r.replaceTrack(e),this.localStream.removeTrack(t),this.localStream.addTrack(e),t.stop(),this.callbacks.onLocalStream&&this.callbacks.onLocalStream(this.localStream),!0}catch(e){return console.error("Error switching camera:",e),!1}}}return!1}async endCall(){try{if(this.stopStatsMonitoring(),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.callId){(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callId","==",this.callId));console.log("Call ended:",this.callId)}return this.callId=null,this.isInitiator=!1,this.remoteStream=null,this.callbacks.onCallEnded&&this.callbacks.onCallEnded(),!0}catch(e){throw console.error("Error ending call:",e),e}}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const n=(0,Vt.P)((0,Vt.rJ)(Fe.db,"calls"),(0,Vt._M)("callerId","==",e),(0,Vt.My)("createdAt","desc"),t(t));return new Promise((e,t)=>{const r=(0,Vt.aQ)(n,t=>{const n=t.docs.map(e=>(0,Ge.A)({id:e.id},e.data()));e(n)},t);setTimeout(()=>r(),5e3)})}catch(n){throw console.error("Error getting call history:",n),n}}setCallbacks(e){this.callbacks=(0,Ge.A)((0,Ge.A)({},this.callbacks),e)}startStatsMonitoring(){this.statsInterval&&clearInterval(this.statsInterval),this.statsInterval=setInterval(async()=>{try{const e=await this.peerConnection.getStats();this.processStats(e)}catch(e){console.error("Error getting stats:",e)}},1e3)}stopStatsMonitoring(){this.statsInterval&&(clearInterval(this.statsInterval),this.statsInterval=null)}processStats(e){let t=null,n=null,r=null;if(e.forEach(e=>{"inbound-rtp"===e.type&&"video"===e.mediaType?t=e:"outbound-rtp"===e.type&&"video"===e.mediaType?n=e:"candidate-pair"===e.type&&"succeeded"===e.state&&(r=e)}),t){const e=t.packetsLost||0,n=t.packetsReceived||0;this.networkStats.packetLoss=n>0?e/n*100:0,this.networkStats.jitter=t.jitter||0}r&&(this.networkStats.rtt=1e3*r.currentRoundTripTime||0,this.networkStats.bandwidth=r.availableIncomingBitrate||0),this.networkStats.quality=this.calculateCallQuality(),this.callbacks.onStatsUpdate&&this.callbacks.onStatsUpdate(this.networkStats)}calculateCallQuality(){const{packetLoss:e,rtt:t,jitter:n}=this.networkStats;return e>5||t>300||n>50?"poor":e>2||t>150||n>30?"fair":"good"}getNetworkStats(){return this.networkStats}async startScreenShare(){try{if(!navigator.mediaDevices.getDisplayMedia)throw new Error("Screen sharing not supported");this.screenStream=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:"screen"},audio:{echoCancellation:!0,noiseSuppression:!0}});const e=this.screenStream.getVideoTracks()[0],t=this.peerConnection.getSenders().find(e=>e.track&&"video"===e.track.kind);return t?await t.replaceTrack(e):this.peerConnection.addTrack(e,this.screenStream),e.addEventListener("ended",()=>{this.stopScreenShare()}),this.isScreenSharing=!0,this.callbacks.onScreenShare&&this.callbacks.onScreenShare(!0,this.screenStream),!0}catch(e){throw console.error("Error starting screen share:",e),e}}async stopScreenShare(){try{if(!this.isScreenSharing)return!1;this.screenStream&&(this.screenStream.getTracks().forEach(e=>e.stop()),this.screenStream=null);const e=(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getVideoTracks()[0],t=this.peerConnection.getSenders().find(e=>e.track&&"video"===e.track.kind);if(t&&await t.replaceTrack(e),this.localStream){const t=this.localStream.getVideoTracks()[0];t&&this.localStream.removeTrack(t),this.localStream.addTrack(e)}return this.isScreenSharing=!1,this.callbacks.onScreenShare&&this.callbacks.onScreenShare(!1,this.localStream),this.callbacks.onLocalStream&&this.callbacks.onLocalStream(this.localStream),!0}catch(e){throw console.error("Error stopping screen share:",e),this.isScreenSharing=!1,e}}isScreenSharingActive(){return this.isScreenSharing}getCurrentUserId(){var e;return(null===(e=Fe.j2.currentUser)||void 0===e?void 0:e.uid)||null}static isSupported(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.RTCPeerConnection)}static async getMediaDevices(){try{const e=await navigator.mediaDevices.enumerateDevices();return{audioInput:e.filter(e=>"audioinput"===e.kind),audioOutput:e.filter(e=>"audiooutput"===e.kind),videoInput:e.filter(e=>"videoinput"===e.kind)}}catch(e){return console.error("Error getting media devices:",e),{audioInput:[],audioOutput:[],videoInput:[]}}}},fi=e=>{var n,r;let{isOpen:i,onClose:s,callType:a="video",participantInfo:o=null,isIncoming:c=!1,onCallAccepted:l,onCallRejected:d}=e;const[u,h]=(0,t.useState)("connecting"),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)("video"===a),[v,y]=(0,t.useState)(!1),[_,E]=(0,t.useState)(0),[b,x]=(0,t.useState)(!1),[w,S]=(0,t.useState)("good"),[T,N]=(0,t.useState)({}),[C,A]=(0,t.useState)(!1),[R,I]=(0,t.useState)(null),[O,P]=(0,t.useState)(null),[k,D]=(0,t.useState)(null),L=(0,t.useRef)(null),j=(0,t.useRef)(null),M=(0,t.useRef)(null),U=(0,t.useRef)(null);(0,t.useEffect)(()=>(i&&(async()=>{if(!mi.isSupported())return Pe.oR.error("WebRTC is not supported in this browser"),void s();const e=new mi;await e.initialize(),e.setCallbacks({onLocalStream:e=>{P(e),L.current&&(L.current.srcObject=e)},onRemoteStream:e=>{D(e),j.current&&(j.current.srcObject=e),M.current&&(M.current.srcObject=e),h("connected"),V()},onCallEnded:()=>{h("ended"),F(),setTimeout(()=>{s()},2e3)},onCallStateChange:e=>{S("connected"===e?"good":"poor")},onStatsUpdate:e=>{N(e),S(e.quality)},onScreenShare:(e,t)=>{A(e),e?L.current&&(L.current.srcObject=t):L.current&&O&&(L.current.srcObject=O)}}),I(e)})(),()=>{R&&R.endCall()}),[i]);const V=()=>{U.current=setInterval(()=>{E(e=>e+1)},1e3)},F=()=>{U.current&&(clearInterval(U.current),U.current=null)},B=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))},G=async()=>{R&&await R.endCall(),h("ended"),F(),setTimeout(()=>{s()},1e3)};return(0,t.useEffect)(()=>{i&&c&&(async()=>{c&&(h("ringing"),Pe.oR.info("Incoming ".concat(a," call from ").concat(null===o||void 0===o?void 0:o.name)))})()},[i,c]),i?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("audio",{ref:M,autoPlay:!0,playsInline:!0,muted:!v,style:{display:"none"}}),(0,Qe.jsxs)("div",{className:"fixed inset-0 z-50 ".concat(b?"pointer-events-none":""),children:[(0,Qe.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-75"}),(0,Qe.jsx)("div",{className:"relative w-full h-full flex items-center justify-center ".concat(b?"scale-50 translate-x-1/2 translate-y-1/2":""," transition-all duration-300"),children:(0,Qe.jsxs)("div",{className:"relative w-full h-full",children:[(0,Qe.jsxs)("div",{className:"absolute inset-0",children:["video"===a?(0,Qe.jsx)("video",{ref:j,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover",style:{transform:k?"scaleX(1)":"scaleX(-1)",filter:k?"none":"blur(10px)"}}):(0,Qe.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-900 to-purple-900 flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center text-white",children:[(0,Qe.jsx)("div",{className:"w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Qe.jsx)("span",{className:"text-4xl font-bold",children:(null===o||void 0===o||null===(n=o.name)||void 0===n?void 0:n[0])||"U"})}),(0,Qe.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:(null===o||void 0===o?void 0:o.name)||"Unknown User"}),(0,Qe.jsx)("p",{className:"text-blue-200",children:(null===o||void 0===o?void 0:o.role)||"User"})]})}),(0,Qe.jsxs)("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 rounded-lg px-3 py-2",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("good"===w?"bg-green-500":"fair"===w?"bg-yellow-500":"bg-red-500")}),(0,Qe.jsx)("span",{className:"text-white text-sm font-medium",children:"good"===w?"Good":"fair"===w?"Fair":"Poor"}),T.rtt&&(0,Qe.jsxs)("span",{className:"text-white text-xs",children:[Math.round(T.rtt),"ms"]})]}),T.packetLoss>0&&(0,Qe.jsxs)("div",{className:"text-white text-xs mt-1",children:["Loss: ",T.packetLoss.toFixed(1),"%"]})]}),"connected"===u&&(0,Qe.jsx)("div",{className:"absolute top-4 right-4 bg-black bg-opacity-50 rounded-lg px-3 py-1",children:(0,Qe.jsx)("span",{className:"text-white text-sm font-mono",children:B(_)})}),"video"===a&&O&&(0,Qe.jsxs)("div",{className:"absolute bottom-20 md:bottom-24 right-2 md:right-4 w-24 h-18 md:w-32 md:h-24 bg-gray-900 rounded-lg overflow-hidden border-2 border-white",children:[(0,Qe.jsx)("video",{ref:L,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover scale-x-[-1]"}),!f&&(0,Qe.jsx)("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center",children:(0,Qe.jsx)(hr,{className:"text-white",size:16})})]})]}),"connected"!==u&&(0,Qe.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center text-white",children:["connecting"===u&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)(oi,{className:"animate-spin mx-auto mb-4",size:48}),(0,Qe.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Connecting..."}),(0,Qe.jsxs)("p",{children:["Establishing connection with ",null===o||void 0===o?void 0:o.name]})]}),"ringing"===u&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"w-24 h-24 md:w-24 md:h-24 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse",children:(0,Qe.jsx)(Et,{className:"text-white",size:32})}),(0,Qe.jsx)("h2",{className:"text-xl md:text-2xl font-semibold mb-2",children:"Incoming Call"}),(0,Qe.jsx)("p",{className:"text-lg md:text-xl mb-6",children:null===o||void 0===o?void 0:o.name}),(0,Qe.jsxs)("div",{className:"flex space-x-6 md:space-x-4 justify-center",children:[(0,Qe.jsx)("button",{onClick:()=>{h("ended"),d&&d(),s()},className:"w-20 h-20 md:w-16 md:h-16 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600 active:bg-red-700 transition-colors touch-manipulation",children:(0,Qe.jsx)(ut,{className:"text-white",size:28})}),(0,Qe.jsx)("button",{onClick:async()=>{R&&c&&(h("connecting"),await R.answerCall("call-id",a),l&&l())},className:"w-20 h-20 md:w-16 md:h-16 bg-green-500 rounded-full flex items-center justify-center hover:bg-green-600 active:bg-green-700 transition-colors touch-manipulation",children:(0,Qe.jsx)(Qn,{className:"text-white",size:28})})]})]}),"ended"===u&&(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"w-24 h-24 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Qe.jsx)(ur,{className:"text-white",size:32})}),(0,Qe.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Call Ended"}),(0,Qe.jsxs)("p",{children:["Duration: ",B(_)]})]})]})}),"connected"===u&&(0,Qe.jsx)("div",{className:"absolute bottom-4 md:bottom-6 left-1/2 transform -translate-x-1/2 w-full max-w-md px-4",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-center space-x-2 md:space-x-4 bg-black bg-opacity-50 rounded-full px-4 md:px-6 py-3",children:[(0,Qe.jsx)("button",{onClick:()=>{if(R){const e=R.toggleAudio();m(!e)}},className:"w-14 h-14 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-colors touch-manipulation ".concat(p?"bg-red-500 hover:bg-red-600 active:bg-red-700":"bg-gray-600 hover:bg-gray-700 active:bg-gray-800"),children:p?(0,Qe.jsx)(mr,{className:"text-white",size:24}):(0,Qe.jsx)(pr,{className:"text-white",size:24})}),"video"===a&&(0,Qe.jsx)("button",{onClick:()=>{if(R){const e=R.toggleVideo();g(e)}},className:"w-14 h-14 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-colors touch-manipulation ".concat(f?"bg-gray-600 hover:bg-gray-700 active:bg-gray-800":"bg-red-500 hover:bg-red-600 active:bg-red-700"),children:f?(0,Qe.jsx)(ct,{className:"text-white",size:24}):(0,Qe.jsx)(hr,{className:"text-white",size:24})}),"video"===a&&f&&(0,Qe.jsx)("button",{onClick:async()=>{if(R){await R.switchCamera()||Pe.oR.error("Failed to switch camera")}},className:"w-14 h-14 md:w-12 md:h-12 rounded-full bg-gray-600 hover:bg-gray-700 active:bg-gray-800 flex items-center justify-center transition-colors touch-manipulation",children:(0,Qe.jsx)(Ct,{className:"text-white",size:24})}),"video"===a&&(0,Qe.jsx)("button",{onClick:async()=>{if(R)try{C?(await R.stopScreenShare(),Pe.oR.success("Screen sharing stopped")):(await R.startScreenShare(),Pe.oR.success("Screen sharing started"))}catch(e){console.error("Screen share error:",e),Pe.oR.error(C?"Failed to stop screen sharing":"Failed to start screen sharing")}},className:"w-14 h-14 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-colors touch-manipulation ".concat(C?"bg-blue-500 hover:bg-blue-600 active:bg-blue-700":"bg-gray-600 hover:bg-gray-700 active:bg-gray-800"),children:C?(0,Qe.jsx)(ci,{className:"text-white",size:24}):(0,Qe.jsx)(li,{className:"text-white",size:24})}),(0,Qe.jsx)("button",{onClick:()=>{M.current&&(M.current.muted=!M.current.muted,y(!M.current.muted))},className:"w-14 h-14 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-colors touch-manipulation ".concat(v?"bg-blue-500 hover:bg-blue-600 active:bg-blue-700":"bg-gray-600 hover:bg-gray-700 active:bg-gray-800"),children:v?(0,Qe.jsx)(di,{className:"text-white",size:24}):(0,Qe.jsx)(ui,{className:"text-white",size:24})}),(0,Qe.jsx)("button",{onClick:()=>x(!b),className:"hidden md:flex w-12 h-12 rounded-full bg-gray-600 hover:bg-gray-700 active:bg-gray-800 items-center justify-center transition-colors touch-manipulation",children:b?(0,Qe.jsx)(hi,{className:"text-white",size:20}):(0,Qe.jsx)(pi,{className:"text-white",size:20})}),(0,Qe.jsx)("button",{onClick:G,className:"w-16 h-16 md:w-12 md:h-12 rounded-full bg-red-500 hover:bg-red-600 active:bg-red-700 flex items-center justify-center transition-colors touch-manipulation",children:(0,Qe.jsx)(ur,{className:"text-white",size:28})})]})}),"connected"===u&&(0,Qe.jsx)("div",{className:"absolute bottom-6 left-6 text-white",children:(0,Qe.jsxs)("div",{className:"bg-black bg-opacity-50 rounded-lg px-3 py-2",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium",children:null===o||void 0===o?void 0:o.name}),(0,Qe.jsx)("p",{className:"text-xs text-gray-300",children:null===o||void 0===o?void 0:o.role})]})})]})}),b&&"connected"===u&&(0,Qe.jsx)("div",{className:"fixed bottom-4 left-4 bg-black bg-opacity-75 rounded-lg p-3 pointer-events-auto",children:(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:(0,Qe.jsx)("span",{className:"text-white font-bold text-sm",children:(null===o||void 0===o||null===(r=o.name)||void 0===r?void 0:r[0])||"U"})}),(0,Qe.jsxs)("div",{className:"text-white",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium",children:null===o||void 0===o?void 0:o.name}),(0,Qe.jsx)("p",{className:"text-xs text-gray-300",children:B(_)})]}),(0,Qe.jsx)("button",{onClick:G,className:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:(0,Qe.jsx)(ur,{className:"text-white",size:14})})]})})]})]}):null},gi=Ke("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),vi=Ke("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]),yi=e=>{let{onCallBack:n,showStats:r=!0}=e;const{userProfile:i}=(0,Be.useUser)(),[s,a]=(0,t.useState)([]),[o,c]=(0,t.useState)({totalCalls:0,answeredCalls:0,missedCalls:0,totalDuration:0,averageDuration:0,videoCalls:0,voiceCalls:0}),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(""),[p,m]=(0,t.useState)("all"),[f,g]=(0,t.useState)("all"),[v,y]=(0,t.useState)("7"),_=new ai;(0,t.useEffect)(()=>{(async()=>{if(i)try{d(!0);const[e,t]=await Promise.all([_.getRecentCalls(i.id,50),_.getCallStats(i.id,parseInt(v))]);a(e),c(t)}catch(e){console.error("Error loading call data:",e),Pe.oR.error("Failed to load call history")}finally{d(!1)}})()},[i,v]);const E=s.filter(e=>{const t=""===u||e.participantName&&e.participantName.toLowerCase().includes(u.toLowerCase()),n="all"===p||"answered"===p&&"answered"===e.status||"missed"===p&&("rejected"===e.status||"initiating"===e.status)||"video"===p&&"video"===e.callType||"voice"===p&&"audio"===e.callType,r="all"===f||e.direction===f;return t&&n&&r}),b=e=>{if(!e)return"0:00";const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))},x=e=>{if(!e)return"Unknown";const t=new Date(e),n=(new Date-t)/36e5;return n<1?"Just now":n<24?"".concat(Math.floor(n),"h ago"):n<48?"Yesterday":t.toLocaleDateString()};return l?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Qe.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Call History"}),(0,Qe.jsx)("p",{className:"text-gray-600 text-sm",children:"Recent calls and statistics"})]}),(0,Qe.jsx)("button",{onClick:async()=>{if(i)try{d(!0);const[e,t]=await Promise.all([_.getRecentCalls(i.id,50),_.getCallStats(i.id,parseInt(v))]);a(e),c(t),Pe.oR.success("Call history refreshed")}catch(e){console.error("Error refreshing call data:",e),Pe.oR.error("Failed to refresh call history")}finally{d(!1)}},className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Qe.jsx)(Ye,{size:20})})]}),r&&(0,Qe.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,Qe.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(si,{className:"text-blue-600",size:20}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Calls"}),(0,Qe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:o.totalCalls})]})]})}),(0,Qe.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Qn,{className:"text-green-600",size:20}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Answered"}),(0,Qe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:o.answeredCalls})]})]})}),(0,Qe.jsx)("div",{className:"bg-red-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(ut,{className:"text-red-600",size:20}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Missed"}),(0,Qe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:o.missedCalls})]})]})}),(0,Qe.jsx)("div",{className:"bg-purple-50 p-4 rounded-lg",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)(Ot,{className:"text-purple-600",size:20}),(0,Qe.jsxs)("div",{className:"ml-3",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Duration"}),(0,Qe.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:b(o.averageDuration)})]})]})})]}),(0,Qe.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,Qe.jsx)("div",{className:"flex-1 max-w-md",children:(0,Qe.jsxs)("div",{className:"relative",children:[(0,Qe.jsx)(Wn,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search calls...",value:u,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),(0,Qe.jsxs)("div",{className:"flex space-x-2",children:[(0,Qe.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,Qe.jsx)("option",{value:"7",children:"Last 7 days"}),(0,Qe.jsx)("option",{value:"30",children:"Last 30 days"}),(0,Qe.jsx)("option",{value:"90",children:"Last 90 days"})]}),(0,Qe.jsxs)("select",{value:p,onChange:e=>m(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,Qe.jsx)("option",{value:"all",children:"All Types"}),(0,Qe.jsx)("option",{value:"answered",children:"Answered"}),(0,Qe.jsx)("option",{value:"missed",children:"Missed"}),(0,Qe.jsx)("option",{value:"video",children:"Video Calls"}),(0,Qe.jsx)("option",{value:"voice",children:"Voice Calls"})]}),(0,Qe.jsxs)("select",{value:f,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,Qe.jsx)("option",{value:"all",children:"All Directions"}),(0,Qe.jsx)("option",{value:"incoming",children:"Incoming"}),(0,Qe.jsx)("option",{value:"outgoing",children:"Outgoing"})]})]})]})]}),(0,Qe.jsx)("div",{className:"divide-y divide-gray-200",children:0===E.length?(0,Qe.jsxs)("div",{className:"p-8 text-center",children:[(0,Qe.jsx)(Et,{className:"mx-auto mb-4 text-gray-300",size:48}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"No calls found"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"No calls match your current filters"})]}):E.map(e=>{return(0,Qe.jsx)("div",{className:"p-4 hover:bg-gray-50",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(i=e.direction,"outgoing"===i?(0,Qe.jsx)(gi,{className:"text-blue-500",size:16}):(0,Qe.jsx)(vi,{className:"text-green-500",size:16})),(r=e.callType,"video"===r?(0,Qe.jsx)(ct,{className:"text-purple-500",size:16}):(0,Qe.jsx)(Et,{className:"text-blue-500",size:16})),(t=e.status,e.direction,"answered"===t?(0,Qe.jsx)(Qn,{className:"text-green-500",size:16}):"rejected"===t||"initiating"===t?(0,Qe.jsx)(ut,{className:"text-red-500",size:16}):(0,Qe.jsx)(Ot,{className:"text-yellow-500",size:16}))]}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.participantName||"Unknown User"}),(0,Qe.jsx)("span",{className:"text-xs text-gray-500",children:"outgoing"===e.direction?"Outgoing":"Incoming"})]}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-500",children:[x(e.createdAt),"answered"===e.status&&e.duration&&(0,Qe.jsxs)("span",{className:"ml-2",children:["\u2022 ",b(e.duration)]})]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:["answered"===e.status&&(0,Qe.jsx)("button",{onClick:()=>(e=>{if(n){const t="outgoing"===e.direction?e.recipientId:e.callerId,r=e.participantName||"Unknown User";n(t,r,e.callType)}})(e),className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",title:"Call back",children:(0,Qe.jsx)(Et,{size:16})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Qe.jsx)(Xn,{size:16})})]})]})},e.id);var t,r,i})}),E.length>0&&(0,Qe.jsx)("div",{className:"p-4 border-t border-gray-200 text-center",children:(0,Qe.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Load more calls"})})]})},_i=()=>{const{userProfile:e}=(0,Be.useUser)(),[n,r]=(0,t.useState)(null),[i]=(0,t.useState)(new ai),[s,a]=(0,t.useState)(!1),o=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video";if(!e)return void Pe.oR.error("Please log in to make calls");const n=prompt("Enter recipient user ID:");if(!n)return;const s=prompt("Enter recipient name:")||"Unknown User";try{a(!0);const o=await i.initiateCall(e.id,n,t);o.success?(r({callId:o.callId,participantId:n,participantName:s,callType:t}),Pe.oR.success("".concat("video"===t?"Video":"Voice"," call initiated"))):Pe.oR.error("Failed to start call")}catch(o){console.error("Error starting call:",o),Pe.oR.error("Failed to start call")}finally{a(!1)}};return(0,Qe.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,Qe.jsx)("div",{className:"mb-8",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Calls"}),(0,Qe.jsx)("p",{className:"text-gray-600 mt-2",children:"Make voice and video calls with your care team"})]}),(0,Qe.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[(0,Qe.jsxs)("button",{onClick:()=>o("audio"),disabled:s,className:"px-4 sm:px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 active:bg-green-800 disabled:opacity-50 flex items-center justify-center space-x-2 touch-manipulation",children:[(0,Qe.jsx)(Et,{size:20}),(0,Qe.jsx)("span",{children:"Voice Call"})]}),(0,Qe.jsxs)("button",{onClick:()=>o("video"),disabled:s,className:"px-4 sm:px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 flex items-center justify-center space-x-2 touch-manipulation",children:[(0,Qe.jsx)(ct,{size:20}),(0,Qe.jsx)("span",{children:"Video Call"})]})]})]})}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-8",children:[(0,Qe.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Qe.jsx)(si,{className:"text-green-600",size:24})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Voice Calls"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Make audio-only calls"})]})]}),(0,Qe.jsx)("button",{onClick:()=>o("audio"),disabled:s,className:"mt-4 w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 active:bg-green-800 disabled:opacity-50 touch-manipulation",children:"Start Voice Call"})]}),(0,Qe.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Qe.jsx)(ct,{className:"text-blue-600",size:24})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Video Calls"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Make video calls with camera"})]})]}),(0,Qe.jsx)("button",{onClick:()=>o("video"),disabled:s,className:"mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 touch-manipulation",children:"Start Video Call"})]}),(0,Qe.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Qe.jsx)(yt,{className:"text-purple-600",size:24})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Group Calls"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Coming soon"})]})]}),(0,Qe.jsx)("button",{disabled:!0,className:"mt-4 w-full px-4 py-2 bg-gray-400 text-white rounded-lg cursor-not-allowed",children:"Coming Soon"})]})]}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,Qe.jsx)(yi,{onCallBack:(e,t,n)=>{r({callId:"callback_".concat(Date.now()),participantId:e,participantName:t,callType:n})},showStats:!0})}),(0,Qe.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Call Tips"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Qe.jsx)("span",{className:"text-white text-xs font-bold",children:"1"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-medium text-blue-800",children:"Good Internet Connection"}),(0,Qe.jsx)("p",{className:"text-blue-700 text-sm",children:"Ensure you have a stable internet connection for the best call quality."})]})]}),(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Qe.jsx)("span",{className:"text-white text-xs font-bold",children:"2"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-medium text-blue-800",children:"Quiet Environment"}),(0,Qe.jsx)("p",{className:"text-blue-700 text-sm",children:"Choose a quiet place for important calls to avoid background noise."})]})]}),(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Qe.jsx)("span",{className:"text-white text-xs font-bold",children:"3"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-medium text-blue-800",children:"Camera Positioning"}),(0,Qe.jsx)("p",{className:"text-blue-700 text-sm",children:"Position your camera at eye level and ensure good lighting for video calls."})]})]}),(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Qe.jsx)("span",{className:"text-white text-xs font-bold",children:"4"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h4",{className:"font-medium text-blue-800",children:"Emergency Calls"}),(0,Qe.jsx)("p",{className:"text-blue-700 text-sm",children:"For medical emergencies, always call emergency services directly."})]})]})]})]})]}),n&&(0,Qe.jsx)(fi,{isOpen:!!n,onClose:async()=>{if(n)try{await i.endCall(n.callId)}catch(e){console.error("Error ending call:",e)}r(null)},callType:n.callType,participantInfo:{id:n.participantId,name:n.participantName,role:"User"},isIncoming:!1})]})},Ei=Ke("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),bi=Ke("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),xi=()=>{const{user:e,userProfile:n}=(0,Be.useUser)(),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)({audioInput:[],audioOutput:[],videoInput:[]}),[o,c]=(0,t.useState)({webrtc:null,microphone:null,camera:null,screenShare:null,network:null}),[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)("video");(0,t.useEffect)(()=>{f(),g()},[]);const f=()=>{const e=mi.isSupported();i(e),c(t=>(0,Ge.A)((0,Ge.A)({},t),{},{webrtc:e})),e||Pe.oR.error("WebRTC is not supported in this browser")},g=async()=>{try{const e=await mi.getMediaDevices();a(e)}catch(e){console.error("Error getting media devices:",e)}},v=async()=>{try{d(!0);const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),t=new(window.AudioContext||window.webkitAudioContext),n=t.createAnalyser(),r=t.createMediaStreamSource(e),i=new Uint8Array(n.frequencyBinCount);r.connect(n);let s=!1;const a=setInterval(()=>{n.getByteFrequencyData(i);i.reduce((e,t)=>e+t)/i.length>10&&(s=!0)},100);setTimeout(()=>{clearInterval(a),e.getTracks().forEach(e=>e.stop()),t.close(),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{microphone:s})),Pe.oR.success(s?"Microphone test passed":"No audio detected - check microphone"),d(!1)},3e3)}catch(e){console.error("Microphone test failed:",e),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{microphone:!1})),Pe.oR.error("Microphone test failed: "+e.message),d(!1)}},y=async()=>{try{d(!0);const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),t=document.createElement("video");t.srcObject=e,t.play(),setTimeout(()=>{const n=!t.paused&&!t.ended&&t.readyState>2;e.getTracks().forEach(e=>e.stop()),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{camera:n})),Pe.oR.success(n?"Camera test passed":"Camera test failed"),d(!1)},2e3)}catch(e){console.error("Camera test failed:",e),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{camera:!1})),Pe.oR.error("Camera test failed: "+e.message),d(!1)}},_=async()=>{try{if(d(!0),!navigator.mediaDevices.getDisplayMedia)throw new Error("Screen sharing not supported");const e=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:"screen"},audio:!1});setTimeout(()=>{e.getTracks().forEach(e=>e.stop()),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{screenShare:!0})),Pe.oR.success("Screen sharing test passed"),d(!1)},2e3)}catch(e){console.error("Screen share test failed:",e),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{screenShare:!1})),Pe.oR.error("Screen share test failed: "+e.message),d(!1)}},E=async()=>{try{d(!0);const e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});let t=!1;e.oniceconnectionstatechange=()=>{"connected"!==e.iceConnectionState&&"completed"!==e.iceConnectionState||(t=!0)},e.createDataChannel("test");const n=await e.createOffer();await e.setLocalDescription(n),setTimeout(()=>{e.close(),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{network:t})),Pe.oR.success(t?"Network test passed":"Network connectivity issues detected"),d(!1)},5e3)}catch(e){console.error("Network test failed:",e),c(e=>(0,Ge.A)((0,Ge.A)({},e),{},{network:!1})),Pe.oR.error("Network test failed: "+e.message),d(!1)}},b=e=>{m(e),h(!0)},x=e=>null===e?(0,Qe.jsx)(Ot,{className:"text-gray-400",size:20}):!0===e?(0,Qe.jsx)(kt,{className:"text-green-500",size:20}):(0,Qe.jsx)(Ei,{className:"text-red-500",size:20}),w=e=>null===e?"Not tested":!0===e?"Passed":"Failed";return(0,Qe.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,Qe.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,Qe.jsxs)("div",{className:"mb-8",children:[(0,Qe.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"WebRTC Test Suite"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Test your device's compatibility with video calling features"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("div",{className:"w-4 h-4 rounded-full ".concat(r?"bg-green-500":"bg-red-500")}),(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"WebRTC Support"})]}),(0,Qe.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(r?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:r?"Supported":"Not Supported"})]}),!r&&(0,Qe.jsx)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,Qe.jsx)("p",{className:"text-red-700",children:"Your browser doesn't support WebRTC. Please use a modern browser like Chrome, Firefox, Safari, or Edge."})})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[x(o.microphone),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Microphone"})]}),(0,Qe.jsx)("button",{onClick:v,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:"Test"})]}),(0,Qe.jsxs)("p",{className:"text-gray-600 text-sm",children:["Status: ",w(o.microphone)]}),(0,Qe.jsxs)("p",{className:"text-gray-500 text-xs mt-2",children:[s.audioInput.length," audio input device(s) found"]})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[x(o.camera),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Camera"})]}),(0,Qe.jsx)("button",{onClick:y,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:"Test"})]}),(0,Qe.jsxs)("p",{className:"text-gray-600 text-sm",children:["Status: ",w(o.camera)]}),(0,Qe.jsxs)("p",{className:"text-gray-500 text-xs mt-2",children:[s.videoInput.length," video input device(s) found"]})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[x(o.screenShare),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Screen Share"})]}),(0,Qe.jsx)("button",{onClick:_,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:"Test"})]}),(0,Qe.jsxs)("p",{className:"text-gray-600 text-sm",children:["Status: ",w(o.screenShare)]}),(0,Qe.jsx)("p",{className:"text-gray-500 text-xs mt-2",children:"Screen sharing capability"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[x(o.network),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Network"})]}),(0,Qe.jsx)("button",{onClick:E,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:"Test"})]}),(0,Qe.jsxs)("p",{className:"text-gray-600 text-sm",children:["Status: ",w(o.network)]}),(0,Qe.jsx)("p",{className:"text-gray-500 text-xs mt-2",children:"STUN server connectivity"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 md:col-span-2",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)(Tt,{className:"text-blue-600",size:20}),(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Run All Tests"})]}),(0,Qe.jsx)("button",{onClick:async()=>{l||(c({webrtc:null,microphone:null,camera:null,screenShare:null,network:null}),await v(),await new Promise(e=>setTimeout(e,1e3)),await y(),await new Promise(e=>setTimeout(e,1e3)),await _(),await new Promise(e=>setTimeout(e,1e3)),await E())},disabled:l,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:l?"Testing...":"Run All Tests"})]}),(0,Qe.jsx)("p",{className:"text-gray-600 text-sm",children:"Run comprehensive tests for all WebRTC features"})]})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Test Call Interface"}),(0,Qe.jsx)("p",{className:"text-gray-600 mb-6",children:"Test the call interface with all new features including screen sharing and network monitoring."}),(0,Qe.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,Qe.jsxs)("button",{onClick:()=>b("audio"),className:"flex items-center space-x-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[(0,Qe.jsx)(Et,{size:20}),(0,Qe.jsx)("span",{children:"Test Voice Call"})]}),(0,Qe.jsxs)("button",{onClick:()=>b("video"),className:"flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,Qe.jsx)(ct,{size:20}),(0,Qe.jsx)("span",{children:"Test Video Call"})]})]})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"WebRTC Features"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"font-semibold text-gray-700 mb-3",children:"Enhanced Features"}),(0,Qe.jsxs)("ul",{className:"space-y-2 text-sm text-gray-600",children:[(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(kt,{size:16,className:"text-green-500"}),(0,Qe.jsx)("span",{children:"Real-time network quality monitoring"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(kt,{size:16,className:"text-green-500"}),(0,Qe.jsx)("span",{children:"Screen sharing for consultations"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(kt,{size:16,className:"text-green-500"}),(0,Qe.jsx)("span",{children:"TURN server configuration for NAT traversal"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(kt,{size:16,className:"text-green-500"}),(0,Qe.jsx)("span",{children:"Adaptive call quality indicators"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(kt,{size:16,className:"text-green-500"}),(0,Qe.jsx)("span",{children:"Firebase authentication integration"})]})]})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"font-semibold text-gray-700 mb-3",children:"Core Capabilities"}),(0,Qe.jsxs)("ul",{className:"space-y-2 text-sm text-gray-600",children:[(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(bi,{size:16,className:"text-blue-500"}),(0,Qe.jsx)("span",{children:"High-definition video calls"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(bi,{size:16,className:"text-blue-500"}),(0,Qe.jsx)("span",{children:"Crystal clear audio with noise suppression"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(bi,{size:16,className:"text-blue-500"}),(0,Qe.jsx)("span",{children:"Camera switching (front/back)"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(bi,{size:16,className:"text-blue-500"}),(0,Qe.jsx)("span",{children:"Call recording and history"})]}),(0,Qe.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)(bi,{size:16,className:"text-blue-500"}),(0,Qe.jsx)("span",{children:"Mobile-optimized interface"})]})]})]})]})]})]}),u&&(0,Qe.jsx)(fi,{isOpen:u,onClose:()=>h(!1),callType:p,participantInfo:{id:"test-user",name:"Test User",role:"Patient"},isIncoming:!1})]})},wi=()=>{const{userProfile:e,userRole:n}=(0,Be.useUser)(),[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)(null),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)(""),[p,m]=(0,t.useState)("all"),[f,g]=(0,t.useState)(!0),[v,y]=(0,t.useState)(!1),[_]=(0,t.useState)(new ai),[E,b]=(0,t.useState)(null),[x,w]=(0,t.useState)(null),[S,T]=(0,t.useState)(!1),N=(0,t.useRef)(null),C=(0,t.useRef)(null);(0,t.useEffect)(()=>{(()=>{var e;null===(e=N.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[o]),(0,t.useEffect)(()=>{(async()=>{if(e)try{g(!0);const t=await $t(e.id);i(t),t.length>0&&!s&&a(t[0])}catch(t){console.error("Error loading conversations:",t),Pe.oR.error("Failed to load conversations")}finally{g(!1)}})()},[e]),(0,t.useEffect)(()=>{if(!e)return;const t=((e,t)=>{const n=(0,Vt.rJ)(Fe.db,Zt),r=(0,Vt.P)(n,(0,Vt._M)("participants","array-contains",e),(0,Vt.My)("lastMessageTime","desc"));return(0,Vt.aQ)(r,e=>{const n=[];e.forEach(e=>{var t,r,i,s,a,o;const c=e.data();n.push((0,Ge.A)((0,Ge.A)({id:e.id},c),{},{lastMessageTime:(null===(t=c.lastMessageTime)||void 0===t||null===(r=t.toDate)||void 0===r?void 0:r.call(t))||c.lastMessageTime,createdAt:(null===(i=c.createdAt)||void 0===i||null===(s=i.toDate)||void 0===s?void 0:s.call(i))||c.createdAt,updatedAt:(null===(a=c.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||c.updatedAt}))}),t(n)})})(e.id,e=>{i(e)});return t},[e]),(0,t.useEffect)(()=>{if(!s)return;const e=((e,t)=>{const n=(0,Vt.rJ)(Fe.db,Qt),r=(0,Vt.P)(n,(0,Vt._M)("conversationId","==",e),(0,Vt.My)("createdAt","desc"),(0,Vt.AB)(50));return(0,Vt.aQ)(r,e=>{const n=[];e.forEach(e=>{var t,r;const i=e.data();n.push((0,Ge.A)((0,Ge.A)({id:e.id},i),{},{createdAt:(null===(t=i.createdAt)||void 0===t||null===(r=t.toDate)||void 0===r?void 0:r.call(t))||i.createdAt}))}),t(n.reverse())})})(s.id,e=>{c(e)});return e},[s]),(0,t.useEffect)(()=>{if(!e)return;return _.listenForIncomingCalls(e.id,e=>{w(e)})},[e,_]),(0,t.useEffect)(()=>{(async()=>{if(s)try{const t=await en(s.id);c(t),await(async(e,t)=>{try{const n=(0,Vt.rJ)(Fe.db,Qt),r=(0,Vt.P)(n,(0,Vt._M)("conversationId","==",e),(0,Vt._M)("senderId","!=",t),(0,Vt._M)("read","==",!1)),i=await(0,Vt.GG)(r),s=[];return i.forEach(e=>{s.push((0,Vt.mZ)(e.ref,{read:!0,readAt:(0,Vt.O5)()}))}),await Promise.all(s),!0}catch(n){throw console.error("Error marking conversation as read:",n),n}})(s.id,e.id)}catch(t){console.error("Error loading messages:",t),Pe.oR.error("Failed to load messages")}})()},[s,e]);const A=async()=>{if(l.trim()&&s&&!v){y(!0);try{await(async(e,t,n)=>{try{const r=(0,Vt.rJ)(Fe.db,Qt),i=(0,Ge.A)((0,Ge.A)({},n),{},{conversationId:e,senderId:t,read:!1,createdAt:(0,Vt.O5)()}),s=await(0,Vt.gS)(r,i),a=(0,Vt.H9)(Fe.db,Zt,e);return await(0,Vt.mZ)(a,{lastMessage:n.text||n.content,lastMessageTime:(0,Vt.O5)(),updatedAt:(0,Vt.O5)()}),s.id}catch(r){throw console.error("Error sending message:",r),r}})(s.id,e.id,{text:l.trim(),messageType:s.conversationType||"general"}),d("")}catch(t){console.error("Error sending message:",t),Pe.oR.error("Failed to send message")}finally{y(!1)}}},R=async()=>{if(!s||!e)return;const t=s.participants.find(t=>t.id!==e.id);if(t)try{const n=await _.initiateCall(e.id,t.id,"audio");n.success?b({callId:n.callId,participantId:t.id,participantName:t.name||t.displayName,callType:"audio"}):Pe.oR.error("Failed to start voice call")}catch(n){console.error("Error starting voice call:",n),Pe.oR.error("Failed to start voice call")}},I=async()=>{if(!s||!e)return;const t=s.participants.find(t=>t.id!==e.id);if(t)try{const n=await _.initiateCall(e.id,t.id,"video");n.success?b({callId:n.callId,participantId:t.id,participantName:t.name||t.displayName,callType:"video"}):Pe.oR.error("Failed to start video call")}catch(n){console.error("Error starting video call:",n),Pe.oR.error("Failed to start video call")}},O=async()=>{if(x)try{await _.rejectCall(x.callId,e.id),w(null)}catch(t){console.error("Error rejecting call:",t),Pe.oR.error("Failed to reject call")}},P=e=>{switch(e){case"medical":return(0,Qe.jsx)(St,{size:16,className:"text-blue-600"});case"care":return(0,Qe.jsx)(ot,{size:16,className:"text-green-600"});case"emergency":return(0,Qe.jsx)(Ei,{size:16,className:"text-red-600"});default:return(0,Qe.jsx)(_t,{size:16,className:"text-gray-600"})}},k=e=>{switch(e){case"medical":return"bg-blue-50 border-blue-200";case"care":return"bg-green-50 border-green-200";case"emergency":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},D=e=>{if(!e)return"";const t=new Date(e),n=(new Date-t)/36e5;return n<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):n<48?"Yesterday":t.toLocaleDateString()},L=r.filter(e=>{var t;const n=(null===(t=e.lastMessage)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||e.participants.some(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase())}),r="all"===p||e.conversationType===p;return n&&r}),j=t=>{if(!t.participants)return"Unknown";const n=t.participants.find(t=>t.id!==e.id);return(null===n||void 0===n?void 0:n.name)||(null===n||void 0===n?void 0:n.displayName)||"Unknown User"},M=t=>{if(!t.participants)return"";const n=t.participants.find(t=>t.id!==e.id);return(null===n||void 0===n?void 0:n.role)||""};return f?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"flex h-full bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,Qe.jsxs)("div",{className:"".concat(S?"flex":"hidden"," md:flex w-full md:w-1/3 border-r border-gray-200 flex-col absolute md:relative z-10 md:z-auto bg-white h-full"),children:[(0,Qe.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("button",{onClick:()=>T(!S),className:"md:hidden p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Qe.jsx)(pt,{size:20})}),(0,Qe.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Messages"})]}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Qe.jsx)(pn,{size:20})})]}),(0,Qe.jsxs)("div",{className:"relative mb-4",children:[(0,Qe.jsx)(Wn,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,Qe.jsx)("input",{type:"text",placeholder:"Search conversations...",value:u,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,Qe.jsx)("div",{className:"flex space-x-2",children:["all","general","medical","care","emergency"].map(e=>(0,Qe.jsx)("button",{onClick:()=>m(e),className:"px-3 py-1 text-xs rounded-full ".concat(p===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,Qe.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===L.length?(0,Qe.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,Qe.jsx)(_t,{size:48,className:"mx-auto mb-4 text-gray-300"}),(0,Qe.jsx)("p",{children:"No conversations found"})]}):L.map(e=>(0,Qe.jsx)("div",{onClick:()=>a(e),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-blue-50 border-r-4 border-r-blue-600":""),children:(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(k(e.conversationType)),children:P(e.conversationType)}),(0,Qe.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:j(e)}),(0,Qe.jsx)("span",{className:"text-xs text-gray-500",children:D(e.lastMessageTime)})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-2 mt-1",children:(0,Qe.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("medical"===e.conversationType?"bg-blue-100 text-blue-800":"care"===e.conversationType?"bg-green-100 text-green-800":"emergency"===e.conversationType?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:M(e)})}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 truncate mt-1",children:e.lastMessage||"No messages yet"})]})]})},e.id))})]}),(0,Qe.jsxs)("div",{className:"flex-1 flex flex-col md:flex",children:[s&&(0,Qe.jsxs)("div",{className:"md:hidden flex items-center justify-between p-4 border-b border-gray-200 bg-white",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("button",{onClick:()=>T(!0),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Qe.jsx)(pt,{size:20})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:j(s)}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:M(s)})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:R,className:"p-2 text-green-600 hover:text-green-800 rounded-lg hover:bg-green-50 transition-colors",title:"Voice Call",children:(0,Qe.jsx)(Et,{size:20})}),(0,Qe.jsx)("button",{onClick:I,className:"p-2 text-blue-600 hover:text-blue-800 rounded-lg hover:bg-blue-50 transition-colors",title:"Video Call",children:(0,Qe.jsx)(ct,{size:20})})]})]}),s?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("div",{className:"hidden md:block p-4 border-b border-gray-200 bg-gray-50",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(k(s.conversationType)),children:P(s.conversationType)}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:j(s)}),(0,Qe.jsxs)("p",{className:"text-sm text-gray-600",children:[M(s)," \u2022 ",s.conversationType]})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:R,className:"p-2 text-gray-400 hover:text-green-600 rounded-lg hover:bg-green-50 transition-colors",title:"Voice Call",children:(0,Qe.jsx)(Et,{size:20})}),(0,Qe.jsx)("button",{onClick:I,className:"p-2 text-gray-400 hover:text-blue-600 rounded-lg hover:bg-blue-50 transition-colors",title:"Video Call",children:(0,Qe.jsx)(ct,{size:20})}),(0,Qe.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Qe.jsx)(Xn,{size:20})})]})]})}),(0,Qe.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===o.length?(0,Qe.jsxs)("div",{className:"text-center text-gray-500 mt-8",children:[(0,Qe.jsx)(_t,{size:48,className:"mx-auto mb-4 text-gray-300"}),(0,Qe.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):o.map(t=>(0,Qe.jsx)("div",{className:"flex ".concat(t.senderId===e.id?"justify-end":"justify-start"),children:(0,Qe.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(t.senderId===e.id?"bg-blue-600 text-white":"system"===t.senderId?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-gray-100 text-gray-800"),children:["system"===t.senderId&&(0,Qe.jsxs)("div",{className:"flex items-center space-x-1 mb-1",children:[(0,Qe.jsx)(Rt,{size:12}),(0,Qe.jsx)("span",{className:"text-xs font-medium",children:"System"})]}),(0,Qe.jsx)("p",{className:"text-sm",children:t.text}),(0,Qe.jsxs)("div",{className:"flex items-center justify-end space-x-1 mt-1 ".concat(t.senderId===e.id?"text-blue-100":"text-gray-500"),children:[(0,Qe.jsx)("span",{className:"text-xs",children:D(t.createdAt)}),t.senderId===e.id&&(0,Qe.jsx)("div",{className:"flex items-center",children:t.read?(0,Qe.jsx)(Jn,{size:12,className:"text-blue-100"}):(0,Qe.jsx)(Qn,{size:12,className:"text-blue-100"})})]})]})},t.id)),(0,Qe.jsx)("div",{ref:N})]}),(0,Qe.jsx)("div",{className:"p-3 md:p-4 border-t border-gray-200 bg-gray-50",children:(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 touch-manipulation",children:(0,Qe.jsx)(Zn,{size:20})}),(0,Qe.jsx)("input",{type:"file",ref:C,className:"hidden",accept:"image/*,application/pdf"}),(0,Qe.jsxs)("div",{className:"flex-1 relative",children:[(0,Qe.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),A())},placeholder:"Type a message...",className:"w-full px-4 py-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,Qe.jsx)("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)($n,{size:20})})]}),(0,Qe.jsx)("button",{onClick:A,disabled:!l.trim()||v,className:"p-2 md:p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation",children:v?(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):(0,Qe.jsx)(er,{size:20})})]})})]}):(0,Qe.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,Qe.jsxs)("div",{className:"text-center text-gray-500",children:[(0,Qe.jsx)(_t,{size:64,className:"mx-auto mb-4 text-gray-300"}),(0,Qe.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Select a conversation"}),(0,Qe.jsx)("p",{className:"text-sm",children:"Choose a conversation from the sidebar to start messaging"})]})})]}),E&&(0,Qe.jsx)(fi,{isOpen:!!E,onClose:async()=>{if(E)try{await _.endCall(E.callId)}catch(e){console.error("Error ending call:",e)}b(null),w(null)},callType:E.callType,participantInfo:{id:E.participantId,name:E.participantName,role:"User"},isIncoming:!1}),x&&(0,Qe.jsx)(fi,{isOpen:!!x,onClose:O,callType:x.callType,participantInfo:{id:x.callerId,name:"Incoming Call",role:"User"},isIncoming:!0,onCallAccepted:async()=>{if(x)try{await _.answerCall(x.callId,e.id),b({callId:x.callId,participantId:x.callerId,participantName:"Incoming Call",callType:x.callType}),w(null)}catch(t){console.error("Error accepting call:",t),Pe.oR.error("Failed to accept call")}},onCallRejected:O})]})},Si=()=>((0,t.useEffect)(()=>{(()=>{let e=document.querySelector('meta[name="viewport"]'),t=document.querySelector('meta[name="theme-color"]'),n=document.querySelector('meta[name="apple-mobile-web-app-capable"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover",t||(t=document.createElement("meta"),t.name="theme-color",document.head.appendChild(t)),t.content="#3B82F6",n||(n=document.createElement("meta"),n.name="apple-mobile-web-app-capable",document.head.appendChild(n)),n.content="yes";let r=document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');r||(r=document.createElement("meta"),r.name="apple-mobile-web-app-status-bar-style",document.head.appendChild(r)),r.content="default";let i=document.querySelector('link[rel="apple-touch-icon"]');i||(i=document.createElement("link"),i.rel="apple-touch-icon",i.sizes="180x180",i.href="/favicon.ico",document.head.appendChild(i));let s=document.querySelector('link[rel="manifest"]');s||(s=document.createElement("link"),s.rel="manifest",s.href="/manifest.json",document.head.appendChild(s))})(),(()=>{let e=0;document.addEventListener("touchend",t=>{const n=(new Date).getTime();n-e<=300&&t.preventDefault(),e=n},!1);document.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("focus",()=>{window.innerWidth<768&&(document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")}),e.addEventListener("blur",()=>{document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"})})})(),(()=>{const e=document.createElement("style");e.textContent="\n        /* Mobile optimizations */\n        @media (max-width: 768px) {\n          /* Prevent horizontal scroll */\n          body {\n            overflow-x: hidden;\n          }\n          \n          /* Touch-friendly button sizes */\n          button, .btn {\n            min-height: 44px;\n            min-width: 44px;\n          }\n          \n          /* Improve touch targets */\n          input, textarea, select {\n            min-height: 44px;\n          }\n          \n          /* Better scrolling on iOS */\n          .overflow-y-auto {\n            -webkit-overflow-scrolling: touch;\n          }\n          \n          /* Prevent text selection on UI elements */\n          button, .no-select {\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n          }\n          \n          /* Optimize for mobile viewport */\n          .mobile-full-height {\n            height: 100vh;\n            height: 100dvh; /* Dynamic viewport height for mobile */\n          }\n          \n          /* Better touch feedback */\n          .touch-manipulation {\n            touch-action: manipulation;\n          }\n          \n          /* Prevent pull-to-refresh on mobile */\n          body {\n            overscroll-behavior: none;\n          }\n        }\n        \n        /* Landscape mobile optimizations */\n        @media (max-width: 768px) and (orientation: landscape) {\n          .mobile-landscape-hide {\n            display: none !important;\n          }\n          \n          .mobile-landscape-compact {\n            padding: 0.5rem !important;\n          }\n        }\n        \n        /* iOS specific fixes */\n        @supports (-webkit-touch-callout: none) {\n          input, textarea {\n            font-size: 16px; /* Prevents zoom on iOS */\n          }\n        }\n      ",document.head.appendChild(e)})();/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&document.body.classList.add("mobile-device");const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};return window.addEventListener("orientationchange",e),window.addEventListener("resize",e),e(),()=>{window.removeEventListener("orientationchange",e),window.removeEventListener("resize",e)}},[]),null),Ti=()=>(0,Qe.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Loading ElderX..."})]})}),Ni=Ke("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);const Ci=new class{constructor(){this.isInstalled=!1,this.deferredPrompt=null,this.isOnline=navigator.onLine,this.swRegistration=null,this.init()}async init(){await this.registerServiceWorker(),this.setupInstallPrompt(),this.setupOnlineOfflineListeners(),this.setupUpdateNotifications()}async registerServiceWorker(){if("serviceWorker"in navigator)try{this.swRegistration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered successfully:",this.swRegistration),this.swRegistration.addEventListener("updatefound",()=>{const e=this.swRegistration.installing;e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})}),navigator.serviceWorker.addEventListener("message",e=>{this.handleServiceWorkerMessage(e.data)})}catch(e){console.error("Service Worker registration failed:",e)}}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{console.log("PWA install prompt triggered"),e.preventDefault(),this.deferredPrompt=e,this.showInstallPrompt()}),window.addEventListener("appinstalled",()=>{console.log("PWA installed successfully"),this.isInstalled=!0,this.deferredPrompt=null,Pe.oR.success("ElderX has been installed successfully!")})}showInstallPrompt(){if(this.deferredPrompt&&!this.isInstalled){const e=document.createElement("button");e.textContent="Install ElderX",e.className="pwa-install-button",e.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: #3b82f6;\n        color: white;\n        border: none;\n        padding: 12px 20px;\n        border-radius: 25px;\n        font-weight: 500;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n        z-index: 1000;\n        animation: slideInUp 0.3s ease-out;\n      ",e.addEventListener("click",()=>{this.installPWA(),e.remove()}),document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.remove()},1e4)}}async installPWA(){if(this.deferredPrompt){this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;"accepted"===e?console.log("User accepted PWA install"):console.log("User dismissed PWA install"),this.deferredPrompt=null}}setupOnlineOfflineListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.handleOnline()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.handleOffline()})}handleOnline(){console.log("Connection restored"),Pe.oR.success("Connection restored! Syncing data..."),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CONNECTION_RESTORED"}),this.syncOfflineData()}handleOffline(){console.log("Connection lost"),Pe.oR.info("You're now offline. Some features may be limited.")}setupUpdateNotifications(){this.swRegistration&&this.swRegistration.addEventListener("updatefound",()=>{const e=this.swRegistration.installing;e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})})}showUpdateNotification(){const e=document.createElement("div");e.className="pwa-update-notification",e.innerHTML='\n      <div style="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: white;\n        border: 1px solid #e5e7eb;\n        border-radius: 12px;\n        padding: 16px;\n        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);\n        z-index: 1000;\n        max-width: 300px;\n        animation: slideInRight 0.3s ease-out;\n      ">\n        <h4 style="margin: 0 0 8px 0; color: #1f2937; font-size: 14px; font-weight: 600;">\n          Update Available\n        </h4>\n        <p style="margin: 0 0 12px 0; color: #6b7280; font-size: 12px; line-height: 1.4;">\n          A new version of ElderX is available. Refresh to update.\n        </p>\n        <div style="display: flex; gap: 8px;">\n          <button id="update-now" style="\n            background: #3b82f6;\n            color: white;\n            border: none;\n            padding: 6px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            cursor: pointer;\n            font-weight: 500;\n          ">Update Now</button>\n          <button id="update-later" style="\n            background: #f3f4f6;\n            color: #6b7280;\n            border: none;\n            padding: 6px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            cursor: pointer;\n          ">Later</button>\n        </div>\n      </div>\n    ',document.body.appendChild(e),document.getElementById("update-now").addEventListener("click",()=>{this.updateApp(),e.remove()}),document.getElementById("update-later").addEventListener("click",()=>{e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},15e3)}async updateApp(){this.swRegistration&&this.swRegistration.waiting&&(this.swRegistration.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}async syncOfflineData(){try{const t=await this.getQueuedRequests();for(const n of t)try{await this.retryRequest(n),await this.removeQueuedRequest(n.id)}catch(e){console.error("Failed to sync request:",e)}t.length>0&&Pe.oR.success("".concat(t.length," offline actions synced successfully!"))}catch(e){console.error("Failed to sync offline data:",e)}}async getQueuedRequests(){return new Promise((e,t)=>{const n=indexedDB.open("elderx-offline-queue",1);n.onerror=()=>t(n.error),n.onsuccess=()=>{const r=n.result;if(!r.objectStoreNames.contains("requests"))return void e([]);const i=r.transaction(["requests"],"readonly").objectStore("requests").getAll();i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)},n.onupgradeneeded=()=>{const e=n.result;e.objectStoreNames.contains("requests")||e.createObjectStore("requests",{keyPath:"timestamp"})}})}async retryRequest(e){const t=await fetch(e.url,{method:e.method,headers:e.headers,body:e.body});if(!t.ok)throw new Error("Request failed: ".concat(t.status));return t}async removeQueuedRequest(e){return new Promise((t,n)=>{const r=indexedDB.open("elderx-offline-queue",1);r.onerror=()=>n(r.error),r.onsuccess=()=>{const i=r.result.transaction(["requests"],"readwrite").objectStore("requests").delete(e);i.onsuccess=()=>t(),i.onerror=()=>n(i.error)}})}handleServiceWorkerMessage(e){switch(e.type){case"REQUEST_QUEUED":Pe.oR.info("Action queued for when you're back online");break;case"REQUEST_RETRY_SUCCESS":console.log("Queued request retried successfully");break;case"UPDATE_AVAILABLE":this.showUpdateNotification();break;default:console.log("Unknown service worker message:",e)}}isPWAInstalled(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")}getPWAStatus(){return{isInstalled:this.isPWAInstalled(),isOnline:this.isOnline,hasServiceWorker:!!this.swRegistration,canInstall:!!this.deferredPrompt}}async requestNotificationPermission(){if("Notification"in window&&"default"===Notification.permission){return"granted"===await Notification.requestPermission()}return"granted"===Notification.permission}showLocalNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("Notification"in window&&"granted"===Notification.permission){const n=new Notification(e,(0,Ge.A)({icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png"},t));return n.onclick=()=>{window.focus(),n.close()},n}}async registerBackgroundSync(e){if("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype){const t=await navigator.serviceWorker.ready;await t.sync.register(e)}}async getCacheStatus(){if("caches"in window){const e=await caches.keys(),t={};for(const n of e){const e=await caches.open(n),r=await e.keys();t[n]=r.length}return t}return{}}async clearCache(){if("caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e))),Pe.oR.success("Cache cleared successfully")}}},Ai=Ci,Ri=()=>{const[e,n]=(0,t.useState)(!1),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(null);(0,t.useEffect)(()=>{i(Ai.isPWAInstalled());const e=e=>{e.preventDefault(),a(e),n(!0)},t=()=>{i(!0),n(!1),a(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}},[]);const o=()=>{n(!1),sessionStorage.setItem("pwa-install-dismissed","true")};return r||!e||sessionStorage.getItem("pwa-install-dismissed")?null:(0,Qe.jsx)("div",{className:"fixed bottom-4 right-4 z-50 max-w-sm",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 animate-slide-in-up",children:[(0,Qe.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,Qe.jsx)(An,{className:"w-4 h-4 text-blue-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"font-semibold text-gray-900 text-sm",children:"Install ElderX"}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:"Get the full app experience"})]})]}),(0,Qe.jsx)("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,Qe.jsx)(ut,{className:"w-4 h-4"})})]}),(0,Qe.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[(0,Qe.jsx)(Ni,{className:"w-3 h-3"}),(0,Qe.jsx)("span",{children:"Works offline"})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[(0,Qe.jsx)(li,{className:"w-3 h-3"}),(0,Qe.jsx)("span",{children:"Fast and responsive"})]})]}),(0,Qe.jsxs)("div",{className:"flex space-x-2",children:[(0,Qe.jsx)("button",{onClick:async()=>{if(s){s.prompt();const{outcome:e}=await s.userChoice;"accepted"===e?console.log("User accepted PWA install"):console.log("User dismissed PWA install"),a(null),n(!1)}},className:"flex-1 bg-blue-600 text-white text-sm font-medium py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors",children:"Install"}),(0,Qe.jsx)("button",{onClick:o,className:"flex-1 bg-gray-100 text-gray-700 text-sm font-medium py-2 px-3 rounded-lg hover:bg-gray-200 transition-colors",children:"Not now"})]})]})})},Ii=Ke("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),Oi=Ke("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Pi=()=>{const[e,n]=(0,t.useState)(navigator.onLine),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(0);(0,t.useEffect)(()=>{const e=()=>{n(!0),i(!1),setTimeout(()=>{i(!1)},3e3)},t=()=>{n(!1),i(!0)};return window.addEventListener("online",e),window.addEventListener("offline",t),navigator.onLine||i(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,t.useEffect)(()=>{const e=async()=>{try{const e=await Ai.getQueuedRequests();a(e.length)}catch(e){console.error("Failed to check queued requests:",e)}},t=setInterval(e,5e3);return e(),()=>clearInterval(t)},[]);return r?(0,Qe.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 max-w-sm w-full mx-4",children:(0,Qe.jsxs)("div",{className:"rounded-lg shadow-lg p-3 transition-all duration-300 ".concat(e?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"),children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center ".concat(e?"bg-green-200":"bg-red-200"),children:e?(0,Qe.jsx)(Ii,{className:"w-3 h-3 text-green-600"}):(0,Qe.jsx)(Oi,{className:"w-3 h-3 text-red-600"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("p",{className:"text-sm font-medium ".concat(e?"text-green-800":"text-red-800"),children:e?"Back Online":"You're Offline"}),(0,Qe.jsx)("p",{className:"text-xs ".concat(e?"text-green-600":"text-red-600"),children:e?"Syncing your data...":s>0?"".concat(s," actions queued"):"Some features may be limited"})]})]}),!e&&s>0&&(0,Qe.jsx)("button",{onClick:async()=>{try{await Ai.syncOfflineData(),a(0)}catch(e){console.error("Failed to sync offline data:",e)}},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-200 rounded transition-colors",title:"Retry sync",children:(0,Qe.jsx)(Ye,{className:"w-4 h-4"})})]}),!e&&(0,Qe.jsx)("div",{className:"mt-2 pt-2 border-t border-red-200",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between text-xs text-red-600",children:[(0,Qe.jsx)("span",{children:"Available offline:"}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("span",{children:"\ud83d\udccb View data"}),(0,Qe.jsx)("span",{children:"\ud83d\udcac Read messages"}),(0,Qe.jsx)("span",{children:"\ud83d\udcc5 Check schedule"})]})]})})]})}):null};const ki=new class{constructor(){this.onListeningStart=null,this.onListeningEnd=null,this.onError=null,this.onNoMatch=null,this.onUnknownCommand=null,this.onCallCommand=null,this.onEndCallCommand=null,this.onAnswerCallCommand=null,this.onRejectCallCommand=null,this.onSendMessageCommand=null,this.onReadMessagesCommand=null,this.onNavigationCommand=null,this.onBackCommand=null,this.onHomeCommand=null,this.onCompleteTaskCommand=null,this.onAssignTaskCommand=null,this.onEmergencyCommand=null,this.onMedicationCommand=null,this.onVitalSignsCommand=null,this.onHelpCommand=null,this.recognition=null,this.isListening=!1,this.isSupported=!1,this.commands=new Map,this.continuousMode=!1,this.language="en-US",this.grammars=null,this.init()}init(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.recognition=new e,this.isSupported=!0,this.setupRecognition(),this.setupDefaultCommands(),console.log("Voice command service initialized")):console.log("Speech recognition not supported")}setupRecognition(){this.recognition&&(this.recognition.continuous=this.continuousMode,this.recognition.interimResults=!1,this.recognition.lang=this.language,this.recognition.maxAlternatives=1,this.recognition.onstart=()=>{var e;this.isListening=!0,console.log("Voice recognition started"),null===(e=this.onListeningStart)||void 0===e||e.call(this)},this.recognition.onresult=e=>{const t=e.results[e.resultIndex],n=t[0].transcript.toLowerCase().trim(),r=t[0].confidence;console.log("Voice command:",n,"Confidence:",r),this.processCommand(n,r)},this.recognition.onerror=e=>{var t;console.error("Voice recognition error:",e.error),this.isListening=!1,null===(t=this.onError)||void 0===t||t.call(this,e.error)},this.recognition.onend=()=>{var e;this.isListening=!1,console.log("Voice recognition ended"),null===(e=this.onListeningEnd)||void 0===e||e.call(this)},this.recognition.onspeechstart=()=>{console.log("Speech started")},this.recognition.onspeechend=()=>{console.log("Speech ended")},this.recognition.onnomatch=()=>{var e;console.log("No speech was recognized"),null===(e=this.onNoMatch)||void 0===e||e.call(this)})}setupDefaultCommands(){this.addCommand("call",["call","phone","dial"],e=>{var t;null===(t=this.onCallCommand)||void 0===t||t.call(this,e)}),this.addCommand("end call",["end call","hang up","disconnect"],()=>{var e;null===(e=this.onEndCallCommand)||void 0===e||e.call(this)}),this.addCommand("answer call",["answer","pick up"],()=>{var e;null===(e=this.onAnswerCallCommand)||void 0===e||e.call(this)}),this.addCommand("reject call",["reject","decline"],()=>{var e;null===(e=this.onRejectCallCommand)||void 0===e||e.call(this)}),this.addCommand("send message",["send message","text","message"],e=>{var t;null===(t=this.onSendMessageCommand)||void 0===t||t.call(this,e)}),this.addCommand("read messages",["read messages","show messages"],()=>{var e;null===(e=this.onReadMessagesCommand)||void 0===e||e.call(this)}),this.addCommand("go to",["go to","navigate to","open"],e=>{var t;null===(t=this.onNavigationCommand)||void 0===t||t.call(this,e)}),this.addCommand("back",["back","go back","return"],()=>{var e;null===(e=this.onBackCommand)||void 0===e||e.call(this)}),this.addCommand("home",["home","dashboard"],()=>{var e;null===(e=this.onHomeCommand)||void 0===e||e.call(this)}),this.addCommand("complete task",["complete task","mark done"],e=>{var t;null===(t=this.onCompleteTaskCommand)||void 0===t||t.call(this,e)}),this.addCommand("assign task",["assign task","create task"],e=>{var t;null===(t=this.onAssignTaskCommand)||void 0===t||t.call(this,e)}),this.addCommand("emergency",["emergency","urgent","help"],()=>{var e;null===(e=this.onEmergencyCommand)||void 0===e||e.call(this)}),this.addCommand("medication",["medication","medicine","drug"],e=>{var t;null===(t=this.onMedicationCommand)||void 0===t||t.call(this,e)}),this.addCommand("vital signs",["vital signs","check vitals"],()=>{var e;null===(e=this.onVitalSignsCommand)||void 0===e||e.call(this)}),this.addCommand("stop listening",["stop listening","stop voice"],()=>{this.stopListening()}),this.addCommand("start listening",["start listening","voice command"],()=>{this.startListening()}),this.addCommand("help",["help","commands"],()=>{var e;null===(e=this.onHelpCommand)||void 0===e||e.call(this)})}addCommand(e,t,n){this.commands.set(e,{triggers:t,callback:n,name:e})}removeCommand(e){return this.commands.delete(e)}processCommand(e,t){if(t<.5)return void console.log("Low confidence command ignored:",e);let n=!1;for(const[i,s]of this.commands){for(const t of s.triggers)if(e.includes(t)){n=!0;const r=this.extractParameters(e,t);console.log("Executing command:",i,"with params:",r),s.callback(r);break}if(n)break}var r;n||(console.log("No matching command found for:",e),null===(r=this.onUnknownCommand)||void 0===r||r.call(this,e))}extractParameters(e,t){const n={};let r=e.replace(t,"").trim();if(r){n.text=r;const e=r.match(/\b[A-Z][a-z]+\b/g);e&&(n.names=e);const t=r.match(/\d+/g);t&&(n.numbers=t.map(Number));const i=/\b(\d{1,2}):(\d{2})\b/g,s=[];let a;for(;null!==(a=i.exec(r));)s.push({hour:parseInt(a[1]),minute:parseInt(a[2])});s.length>0&&(n.times=s)}return n}startListening(){if(!this.isSupported||this.isListening)return!1;try{return this.recognition.start(),!0}catch(e){return console.error("Failed to start voice recognition:",e),!1}}stopListening(){this.isListening&&this.recognition.stop()}setContinuousMode(e){this.continuousMode=e,this.recognition&&(this.recognition.continuous=e)}setLanguage(e){this.language=e,this.recognition&&(this.recognition.lang=e)}setMaxAlternatives(e){this.recognition&&(this.recognition.maxAlternatives=e)}getCommands(){const e=[];for(const[t,n]of this.commands)e.push({name:t,triggers:n.triggers,description:this.getCommandDescription(t)});return e}getCommandDescription(e){return{call:"Initiate a voice or video call","end call":"End the current call","answer call":"Answer an incoming call","reject call":"Reject an incoming call","send message":"Send a text message","read messages":"Read recent messages","go to":"Navigate to a specific page",back:"Go back to previous page",home:"Go to dashboard","complete task":"Mark a task as complete","assign task":"Assign a new task",emergency:"Trigger emergency alert",medication:"Access medication information","vital signs":"Check patient vital signs","stop listening":"Stop voice recognition","start listening":"Start voice recognition",help:"Show available voice commands"}[e]||"Custom voice command"}getStatus(){return{supported:this.isSupported,listening:this.isListening,continuous:this.continuousMode,language:this.language,commands:this.commands.size}}test(){this.isSupported?(console.log("Testing voice recognition..."),this.startListening(),setTimeout(()=>{this.stopListening()},5e3)):console.log("Voice recognition not supported")}createVoiceButton(e,t){if(!e||!this.isSupported)return e;return e.addEventListener("click",()=>{this.isListening?this.stopListening():this.startListening()}),e}addVoiceCommand(e,t){if(!e||!this.isSupported)return e;return e.addEventListener("click",()=>{this.processCommand(t,1)}),e}getCapabilities(){return{continuous:!0,interimResults:!0,maxAlternatives:10,grammars:!1,languages:["en-US","en-GB","en-AU","en-CA","es-ES","es-MX","fr-FR","fr-CA","de-DE","it-IT","pt-BR","pt-PT","ru-RU","ja-JP","ko-KR","zh-CN"]}}};const Di=new class{constructor(){this.isSupported="vibrate"in navigator,this.isHapticSupported="vibrate"in navigator||"navigator"in window&&"vibrate"in navigator,this.patterns={incomingCall:[200,100,200,100,200,100,200,100,200,100,200,100,200,100,200,100],callConnected:[100,50,100],callEnded:[200,100,200,100,200],callRejected:[300,100,300],newMessage:[100,50,100],messageSent:[50],buttonPress:[50],navigation:[25],success:[100,50,100],error:[200,100,200,100,200],warning:[150,100,150,100,150],taskComplete:[100,50,100,50,100],taskAssigned:[75,25,75],alert:[300,200,300,200,300],reminder:[100,100,100],emergency:[500,250,500,250,500,250,500]},this.init()}init(){this.isSupported?console.log("Haptic feedback service initialized"):console.log("Haptic feedback not supported on this device")}vibrate(e){if(!this.isSupported)return console.log("Vibration not supported"),!1;try{return"string"===typeof e&&this.patterns[e]?navigator.vibrate(this.patterns[e]):(Array.isArray(e)||"number"===typeof e)&&navigator.vibrate(e),!0}catch(t){return console.error("Vibration failed:",t),!1}}incomingCall(){return this.vibrate("incomingCall")}callConnected(){return this.vibrate("callConnected")}callEnded(){return this.vibrate("callEnded")}callRejected(){return this.vibrate("callRejected")}newMessage(){return this.vibrate("newMessage")}messageSent(){return this.vibrate("messageSent")}buttonPress(){return this.vibrate("buttonPress")}navigation(){return this.vibrate("navigation")}success(){return this.vibrate("success")}error(){return this.vibrate("error")}warning(){return this.vibrate("warning")}taskComplete(){return this.vibrate("taskComplete")}taskAssigned(){return this.vibrate("taskAssigned")}alert(){return this.vibrate("alert")}reminder(){return this.vibrate("reminder")}emergency(){return this.vibrate("emergency")}custom(e){return this.vibrate(e)}stop(){this.isSupported&&navigator.vibrate(0)}isHapticSupported(){return this.isSupported}getPatterns(){return Object.keys(this.patterns)}addPattern(e,t){return!!(Array.isArray(t)&&t.length>0)&&(this.patterns[e]=t,!0)}removePattern(e){return!(!this.patterns[e]||this.isBuiltInPattern(e))&&(delete this.patterns[e],!0)}isBuiltInPattern(e){return["incomingCall","callConnected","callEnded","callRejected","newMessage","messageSent","buttonPress","navigation","success","error","warning","taskComplete","taskAssigned","alert","reminder","emergency"].includes(e)}getPattern(e){return this.patterns[e]||null}test(){console.log("Testing haptic feedback..."),this.buttonPress(),setTimeout(()=>{this.success()},500),setTimeout(()=>{this.error()},1e3)}createHapticButton(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"buttonPress";if(!e||!this.isSupported)return e;const n=e.onClick;return e.onClick=e=>{this.vibrate(t),n&&n(e)},e}addHapticToElement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"buttonPress";if(!e||!this.isSupported)return e;const n=()=>{this.vibrate(t)};return e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("click",n),e}removeHapticFromElement(e){if(!e)return;const t=()=>{this.stop()};e.removeEventListener("touchstart",t),e.removeEventListener("click",t)}formFeedback(e,t){switch(e){case"focus":this.vibrate(25);break;case"blur":this.vibrate(15);break;case"submit":this.success();break;case"error":this.error();break;case"validation":this.warning();break;default:this.buttonPress()}}contextualFeedback(e,t){const n={call:{start:()=>this.callConnected(),end:()=>this.callEnded(),reject:()=>this.callRejected(),incoming:()=>this.incomingCall()},message:{send:()=>this.messageSent(),receive:()=>this.newMessage()},navigation:{back:()=>this.navigation(),forward:()=>this.navigation(),menu:()=>this.buttonPress()},task:{complete:()=>this.taskComplete(),assign:()=>this.taskAssigned()},medical:{alert:()=>this.alert(),reminder:()=>this.reminder(),emergency:()=>this.emergency()}};return n[e]&&n[e][t]?n[e][t]():this.buttonPress()}getStatus(){return{supported:this.isSupported,patterns:Object.keys(this.patterns).length,customPatterns:Object.keys(this.patterns).filter(e=>!this.isBuiltInPattern(e)).length}}},Li=e=>{let{isOpen:n,onClose:r,onCommand:i}=e;const[s,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(!1),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)([]),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)("en-US"),_=(0,t.useRef)(null);(0,t.useEffect)(()=>(c(ki.isSupported),h(ki.getCommands()),ki.onListeningStart=()=>{a(!0),Di.buttonPress()},ki.onListeningEnd=()=>{a(!1)},ki.onError=e=>{console.error("Voice recognition error:",e),a(!1),Di.error()},ki.onUnknownCommand=e=>{d('Unknown command: "'.concat(e,'"')),Di.warning()},ki.onCallCommand=e=>{null===i||void 0===i||i("call",e),Di.callConnected()},ki.onEndCallCommand=()=>{null===i||void 0===i||i("endCall",{}),Di.callEnded()},ki.onAnswerCallCommand=()=>{null===i||void 0===i||i("answerCall",{}),Di.callConnected()},ki.onRejectCallCommand=()=>{null===i||void 0===i||i("rejectCall",{}),Di.callRejected()},ki.onSendMessageCommand=e=>{null===i||void 0===i||i("sendMessage",e),Di.messageSent()},ki.onReadMessagesCommand=()=>{null===i||void 0===i||i("readMessages",{}),Di.buttonPress()},ki.onNavigationCommand=e=>{null===i||void 0===i||i("navigate",e),Di.navigation()},ki.onBackCommand=()=>{null===i||void 0===i||i("back",{}),Di.navigation()},ki.onHomeCommand=()=>{null===i||void 0===i||i("home",{}),Di.navigation()},ki.onCompleteTaskCommand=e=>{null===i||void 0===i||i("completeTask",e),Di.taskComplete()},ki.onAssignTaskCommand=e=>{null===i||void 0===i||i("assignTask",e),Di.taskAssigned()},ki.onEmergencyCommand=()=>{null===i||void 0===i||i("emergency",{}),Di.emergency()},ki.onMedicationCommand=e=>{null===i||void 0===i||i("medication",e),Di.alert()},ki.onVitalSignsCommand=()=>{null===i||void 0===i||i("vitalSigns",{}),Di.alert()},ki.onHelpCommand=()=>{null===i||void 0===i||i("help",{}),Di.buttonPress()},()=>{ki.onListeningStart=null,ki.onListeningEnd=null,ki.onError=null,ki.onUnknownCommand=null}),[i]),(0,t.useEffect)(()=>{_.current&&(_.current.scrollTop=_.current.scrollHeight)},[l]);return n?(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Voice Commands"}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>m(!p),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Qe.jsx)(bt,{className:"w-4 h-4"})}),(0,Qe.jsx)("button",{onClick:r,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Qe.jsx)(ut,{className:"w-4 h-4"})})]})]}),(0,Qe.jsxs)("div",{className:"p-4 space-y-4",children:[(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("div",{className:"w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center transition-colors ".concat(s?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"),children:s?(0,Qe.jsx)(pr,{className:"w-8 h-8"}):(0,Qe.jsx)(mr,{className:"w-8 h-8"})}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:s?"Listening...":"Tap to start voice commands"})]}),l&&(0,Qe.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,Qe.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Transcript:"}),(0,Qe.jsx)("div",{ref:_,className:"text-sm text-gray-900 max-h-20 overflow-y-auto",children:l})]}),(0,Qe.jsx)("div",{className:"flex justify-center space-x-4",children:(0,Qe.jsx)("button",{onClick:()=>{s?ki.stopListening():ki.startListening()&&d("")},disabled:!o,className:"px-6 py-3 rounded-lg font-medium transition-colors ".concat(s?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"," ").concat(o?"":"opacity-50 cursor-not-allowed"),children:s?"Stop Listening":"Start Listening"})}),p&&(0,Qe.jsxs)("div",{className:"space-y-3 pt-3 border-t border-gray-200",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Continuous Mode"}),(0,Qe.jsx)("button",{onClick:()=>{return g(e=!f),void ki.setContinuousMode(e);var e},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(f?"bg-blue-600":"bg-gray-200"),children:(0,Qe.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(f?"translate-x-6":"translate-x-1")})})]}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Language"}),(0,Qe.jsxs)("select",{value:v,onChange:e=>{return t=e.target.value,y(t),void ki.setLanguage(t);var t},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Qe.jsx)("option",{value:"en-US",children:"English (US)"}),(0,Qe.jsx)("option",{value:"en-GB",children:"English (UK)"}),(0,Qe.jsx)("option",{value:"es-ES",children:"Spanish"}),(0,Qe.jsx)("option",{value:"fr-FR",children:"French"}),(0,Qe.jsx)("option",{value:"de-DE",children:"German"})]})]})]}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Available Commands:"}),(0,Qe.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:u.slice(0,10).map((e,t)=>(0,Qe.jsxs)("div",{className:"text-xs text-gray-600 bg-gray-50 p-2 rounded",children:[(0,Qe.jsx)("div",{className:"font-medium",children:e.name}),(0,Qe.jsx)("div",{className:"text-gray-500",children:e.description})]},t))})]}),!o&&(0,Qe.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,Qe.jsx)("p",{className:"text-sm text-yellow-800",children:"Voice commands are not supported on this device or browser."})})]})]})}):null},ji=Ke("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Mi=Ke("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Ui=Ke("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Vi=Ke("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Fi=Ke("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]),Bi=Ke("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);const Gi=new class{constructor(){this.onSwipeLeft=null,this.onSwipeRight=null,this.onSwipeUp=null,this.onSwipeDown=null,this.onPinchIn=null,this.onPinchOut=null,this.onLongPress=null,this.onDoubleTap=null,this.isSupported="ontouchstart"in window,this.gestures=new Map,this.activeGestures=new Map,this.thresholds={swipe:{minDistance:50,maxTime:500,maxAngle:30},pinch:{minScale:.5,maxScale:3},longPress:{duration:500},doubleTap:{maxTime:300}},this.init()}init(){this.isSupported?(this.setupEventListeners(),this.setupDefaultGestures(),console.log("Gesture service initialized")):console.log("Touch gestures not supported")}setupEventListeners(){document.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),document.addEventListener("touchcancel",this.handleTouchCancel.bind(this),{passive:!1})}setupDefaultGestures(){this.addGesture("swipe-left",{type:"swipe",direction:"left",callback:e=>{var t;return null===(t=this.onSwipeLeft)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("swipe-right",{type:"swipe",direction:"right",callback:e=>{var t;return null===(t=this.onSwipeRight)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("swipe-up",{type:"swipe",direction:"up",callback:e=>{var t;return null===(t=this.onSwipeUp)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("swipe-down",{type:"swipe",direction:"down",callback:e=>{var t;return null===(t=this.onSwipeDown)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("pinch-in",{type:"pinch",direction:"in",callback:e=>{var t;return null===(t=this.onPinchIn)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("pinch-out",{type:"pinch",direction:"out",callback:e=>{var t;return null===(t=this.onPinchOut)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("long-press",{type:"longPress",callback:e=>{var t;return null===(t=this.onLongPress)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("double-tap",{type:"doubleTap",callback:e=>{var t;return null===(t=this.onDoubleTap)||void 0===t?void 0:t.call(this,e)}})}addGesture(e,t){this.gestures.set(e,(0,Ge.A)((0,Ge.A)({},t),{},{name:e,active:!1,startTime:0,startPosition:null,startDistance:0,lastTapTime:0}))}removeGesture(e){return this.gestures.delete(e)}handleTouchStart(e){const t=e.touches[0],n=Date.now();for(const[r,i]of this.gestures)if("longPress"===i.type)i.active=!0,i.startTime=n,i.startPosition={x:t.clientX,y:t.clientY},i.timeout=setTimeout(()=>{i.active&&this.triggerGesture(r,{position:i.startPosition,duration:Date.now()-i.startTime})},this.thresholds.longPress.duration);else if("doubleTap"===i.type){const e=n-i.lastTapTime;e<this.thresholds.doubleTap.maxTime&&this.triggerGesture(r,{position:{x:t.clientX,y:t.clientY},timeSinceLastTap:e}),i.lastTapTime=n}else"swipe"===i.type?(i.active=!0,i.startTime=n,i.startPosition={x:t.clientX,y:t.clientY}):"pinch"===i.type&&2===e.touches.length&&(i.active=!0,i.startTime=n,i.startDistance=this.getDistance({x:e.touches[0].clientX,y:e.touches[0].clientY},{x:e.touches[1].clientX,y:e.touches[1].clientY}))}handleTouchMove(e){const t=e.touches[0],n=Date.now();for(const[r,i]of this.gestures)if(i.active)if("longPress"===i.type){this.getDistance(i.startPosition,{x:t.clientX,y:t.clientY})>10&&(i.active=!1,i.timeout&&clearTimeout(i.timeout))}else if("swipe"===i.type){const e=this.getDistance(i.startPosition,{x:t.clientX,y:t.clientY}),s=this.getAngle(i.startPosition,{x:t.clientX,y:t.clientY});if(e>this.thresholds.swipe.minDistance&&n-i.startTime<this.thresholds.swipe.maxTime){this.getSwipeDirection(s)===i.direction&&(this.triggerGesture(r,{startPosition:i.startPosition,endPosition:{x:t.clientX,y:t.clientY},distance:e,angle:s,duration:n-i.startTime}),i.active=!1)}}else if("pinch"===i.type&&2===e.touches.length){const t=this.getDistance({x:e.touches[0].clientX,y:e.touches[0].clientY},{x:e.touches[1].clientX,y:e.touches[1].clientY}),s=t/i.startDistance;("out"===i.direction&&s>1.1||"in"===i.direction&&s<.9)&&(this.triggerGesture(r,{startDistance:i.startDistance,currentDistance:t,scale:s,duration:n-i.startTime}),i.active=!1)}}handleTouchEnd(e){Date.now();for(const[t,n]of this.gestures)n.active&&("longPress"===n.type?(n.active=!1,n.timeout&&clearTimeout(n.timeout)):("swipe"===n.type||"pinch"===n.type)&&(n.active=!1))}handleTouchCancel(e){for(const[t,n]of this.gestures)n.active=!1,n.timeout&&clearTimeout(n.timeout)}triggerGesture(e,t){const n=this.gestures.get(e);n&&n.callback&&(console.log("Triggering gesture:",e,t),n.callback(t))}getDistance(e,t){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}getAngle(e,t){const n=t.x-e.x,r=t.y-e.y;return 180*Math.atan2(r,n)/Math.PI}getSwipeDirection(e){return e>=-45&&e<45?"right":e>=45&&e<135?"down":e>=135||e<-135?"left":e>=-135&&e<-45?"up":null}addGestureToElement(e,t,n){if(!e||!this.isSupported)return e;const r=this.gestures.get(t);if(!r)return console.error("Gesture not found:",t),e;const i=(0,Ge.A)((0,Ge.A)({},r),{},{element:e,callback:n.callback||r.callback});return e.addEventListener("touchstart",e=>{this.handleElementTouchStart(e,i)},{passive:!1}),e.addEventListener("touchmove",e=>{this.handleElementTouchMove(e,i)},{passive:!1}),e.addEventListener("touchend",e=>{this.handleElementTouchEnd(e,i)},{passive:!1}),e}handleElementTouchStart(e,t){(e.target===t.element||t.element.contains(e.target))&&this.handleTouchStart(e)}handleElementTouchMove(e,t){(e.target===t.element||t.element.contains(e.target))&&this.handleTouchMove(e)}handleElementTouchEnd(e,t){(e.target===t.element||t.element.contains(e.target))&&this.handleTouchEnd(e)}setThreshold(e,t){this.thresholds[e]&&(this.thresholds[e]=(0,Ge.A)((0,Ge.A)({},this.thresholds[e]),t))}getStatus(){return{supported:this.isSupported,gestures:this.gestures.size,thresholds:this.thresholds}}enableGesture(e){const t=this.gestures.get(e);t&&(t.enabled=!0)}disableGesture(e){const t=this.gestures.get(e);t&&(t.enabled=!1)}test(){this.isSupported?(console.log("Testing gestures..."),console.log("Available gestures:",Array.from(this.gestures.keys()))):console.log("Touch gestures not supported")}},Hi=Gi,Wi=e=>{let{isOpen:n,onClose:r,onGesture:i}=e;const[s,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(new Set),[p,m]=(0,t.useState)({swipe:{minDistance:50,maxTime:500,maxAngle:30},pinch:{minScale:.5,maxScale:3},longPress:{duration:500},doubleTap:{maxTime:300}});(0,t.useEffect)(()=>{if(a(Hi.isSupported),Hi.isSupported){c([{name:"swipe-left",icon:Gt,description:"Swipe left to go back"},{name:"swipe-right",icon:Pt,description:"Swipe right to go forward"},{name:"swipe-up",icon:ji,description:"Swipe up to scroll up"},{name:"swipe-down",icon:Mi,description:"Swipe down to scroll down"},{name:"pinch-in",icon:Ui,description:"Pinch in to zoom out"},{name:"pinch-out",icon:Vi,description:"Pinch out to zoom in"},{name:"long-press",icon:Fi,description:"Long press for context menu"},{name:"double-tap",icon:Bi,description:"Double tap to refresh"}]),Hi.onSwipeLeft=e=>{Di.navigation(),null===i||void 0===i||i("swipe-left",e)},Hi.onSwipeRight=e=>{Di.navigation(),null===i||void 0===i||i("swipe-right",e)},Hi.onSwipeUp=e=>{Di.buttonPress(),null===i||void 0===i||i("swipe-up",e)},Hi.onSwipeDown=e=>{Di.buttonPress(),null===i||void 0===i||i("swipe-down",e)},Hi.onPinchIn=e=>{Di.buttonPress(),null===i||void 0===i||i("pinch-in",e)},Hi.onPinchOut=e=>{Di.buttonPress(),null===i||void 0===i||i("pinch-out",e)},Hi.onLongPress=e=>{Di.alert(),null===i||void 0===i||i("long-press",e)},Hi.onDoubleTap=e=>{Di.buttonPress(),null===i||void 0===i||i("double-tap",e)}}return()=>{Hi.onSwipeLeft=null,Hi.onSwipeRight=null,Hi.onSwipeUp=null,Hi.onSwipeDown=null,Hi.onPinchIn=null,Hi.onPinchOut=null,Hi.onLongPress=null,Hi.onDoubleTap=null}},[i]);const f=(e,t,n)=>{const r=(0,Ge.A)({},p);r[e]=(0,Ge.A)((0,Ge.A)({},r[e]),{},{[t]:Number(n)}),m(r),Hi.setThreshold(e,{[t]:Number(n)})};return n?(0,Qe.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Gesture Controls"}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>d(!l),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Qe.jsx)(bt,{className:"w-4 h-4"})}),(0,Qe.jsx)("button",{onClick:r,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Qe.jsx)(ut,{className:"w-4 h-4"})})]})]}),(0,Qe.jsxs)("div",{className:"p-4 space-y-4",children:[(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("div",{className:"w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center ".concat(s?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:(0,Qe.jsx)(Fi,{className:"w-8 h-8"})}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:s?"Touch gestures enabled":"Touch gestures not supported"})]}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Available Gestures:"}),(0,Qe.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:o.map((e,t)=>{const n=e.icon,r=u.has(e.name);return(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border transition-colors ".concat(r?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50"),children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat(r?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"),children:(0,Qe.jsx)(n,{className:"w-4 h-4"})}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("div",{className:"text-sm font-medium text-gray-900 capitalize",children:e.name.replace("-"," ")}),(0,Qe.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Qe.jsx)("button",{onClick:()=>{return t=e.name,Di.buttonPress(),void(null===i||void 0===i||i(t,{test:!0}));var t},className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Test gesture",children:(0,Qe.jsx)(Bi,{className:"w-3 h-3"})}),(0,Qe.jsx)("button",{onClick:()=>(e=>{const t=new Set(u);t.has(e)?(t.delete(e),Hi.disableGesture(e)):(t.add(e),Hi.enableGesture(e)),h(t),Di.buttonPress()})(e.name),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(r?"bg-blue-600":"bg-gray-200"),children:(0,Qe.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(r?"translate-x-6":"translate-x-1")})})]})]},t)})})]}),l&&(0,Qe.jsxs)("div",{className:"space-y-3 pt-3 border-t border-gray-200",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Gesture Sensitivity:"}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsx)("label",{className:"text-xs text-gray-600",children:"Swipe Distance (pixels)"}),(0,Qe.jsx)("input",{type:"range",min:"20",max:"100",value:p.swipe.minDistance,onChange:e=>f("swipe","minDistance",e.target.value),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,Qe.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[p.swipe.minDistance,"px"]})]}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsx)("label",{className:"text-xs text-gray-600",children:"Swipe Time (ms)"}),(0,Qe.jsx)("input",{type:"range",min:"200",max:"1000",value:p.swipe.maxTime,onChange:e=>f("swipe","maxTime",e.target.value),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,Qe.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[p.swipe.maxTime,"ms"]})]}),(0,Qe.jsxs)("div",{className:"space-y-2",children:[(0,Qe.jsx)("label",{className:"text-xs text-gray-600",children:"Long Press Duration (ms)"}),(0,Qe.jsx)("input",{type:"range",min:"300",max:"1000",value:p.longPress.duration,onChange:e=>f("longPress","duration",e.target.value),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,Qe.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[p.longPress.duration,"ms"]})]})]}),!s&&(0,Qe.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,Qe.jsx)("p",{className:"text-sm text-yellow-800",children:"Touch gestures are not supported on this device. This feature requires a touch screen."})}),(0,Qe.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,Qe.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"How to use:"}),(0,Qe.jsxs)("ul",{className:"text-xs text-blue-800 space-y-1",children:[(0,Qe.jsx)("li",{children:"\u2022 Swipe left/right to navigate"}),(0,Qe.jsx)("li",{children:"\u2022 Swipe up/down to scroll"}),(0,Qe.jsx)("li",{children:"\u2022 Pinch to zoom in/out"}),(0,Qe.jsx)("li",{children:"\u2022 Long press for context menu"}),(0,Qe.jsx)("li",{children:"\u2022 Double tap to refresh"})]})]})]})]})}):null},zi=e=>{let{onVoiceCommand:n,onGestureControl:r,onSettings:i,isOnline:s,isVoiceEnabled:a=!0,isGestureEnabled:o=!0,isHapticEnabled:c=!0}=e;const[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(!1);return(0,Qe.jsx)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40",children:(0,Qe.jsx)("div",{className:"bg-white rounded-full shadow-lg border border-gray-200 p-2",children:(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[a&&(0,Qe.jsx)("button",{onClick:()=>{d(!l),c&&Di.buttonPress(),null===n||void 0===n||n(!l)},className:"p-3 rounded-full transition-all duration-200 ".concat(l?"bg-blue-100 text-blue-600 shadow-md":"text-gray-600 hover:text-blue-600 hover:bg-blue-50"),title:l?"Stop voice commands":"Start voice commands",children:l?(0,Qe.jsx)(pr,{className:"w-5 h-5"}):(0,Qe.jsx)(mr,{className:"w-5 h-5"})}),o&&(0,Qe.jsx)("button",{onClick:()=>{h(!u),c&&Di.buttonPress(),null===r||void 0===r||r(!u)},className:"p-3 rounded-full transition-all duration-200 ".concat(u?"bg-green-100 text-green-600 shadow-md":"text-gray-600 hover:text-green-600 hover:bg-green-50"),title:u?"Disable gestures":"Enable gestures",children:(0,Qe.jsx)(Fi,{className:"w-5 h-5"})}),(0,Qe.jsx)("div",{className:"p-3 rounded-full ".concat(s?"text-green-600 bg-green-50":"text-red-600 bg-red-50"),title:s?"Online":"Offline",children:s?(0,Qe.jsx)(Ii,{className:"w-5 h-5"}):(0,Qe.jsx)(Oi,{className:"w-5 h-5"})}),(0,Qe.jsx)("button",{onClick:()=>{c&&Di.buttonPress(),null===i||void 0===i||i()},className:"p-3 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-full transition-all duration-200",title:"Mobile settings",children:(0,Qe.jsx)(bt,{className:"w-5 h-5"})})]})})})},Ki=Ke("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]);var qi=n(9997);const Yi=new class{constructor(){this.maxLoginAttempts=tt.A.get("security.maxLoginAttempts"),this.lockoutDuration=tt.A.get("security.lockoutDuration"),this.sessionTimeout=tt.A.get("security.sessionTimeout"),this.loginAttempts=new Map,this.lockedAccounts=new Map,this.activeSessions=new Map}async secureSignIn(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(this.isAccountLocked(e))throw new Error("Account is temporarily locked due to multiple failed attempts");if(this.getLoginAttempts(e)>=this.maxLoginAttempts)throw this.lockAccount(e),new Error("Too many failed login attempts. Account locked.");et.A.info("Attempting secure sign in",{email:e,userAgent:navigator.userAgent});const r=(await(0,ke.x9)(Fe.j2,e,t)).user;this.resetLoginAttempts(e);const i=(0,Ge.A)({userId:r.uid,email:r.email,loginTime:Date.now(),userAgent:navigator.userAgent,ipAddress:await this.getClientIP(),sessionId:qi.A.generateSecureToken()},n);return this.activeSessions.set(r.uid,i),et.A.info("Secure sign in successful",{userId:r.uid,email:r.email,sessionId:i.sessionId}),this.setSessionTimeout(r.uid),{user:r,sessionData:i}}catch(r){throw this.incrementLoginAttempts(e),et.A.warn("Secure sign in failed",{email:e,error:r.message,attempts:this.getLoginAttempts(e)}),Je.Ay.handleError(r,{context:"secure_sign_in",email:e,attempts:this.getLoginAttempts(e)}),r}}async secureSignUp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{this.validatePasswordStrength(t),this.validateEmail(e),et.A.info("Attempting secure sign up",{email:e});const r=(await(0,ke.eJ)(Fe.j2,e,t)).user,i=qi.A.encryptHealthData(n);return et.A.info("Secure sign up successful",{userId:r.uid,email:r.email}),{user:r,encryptedUserData:i}}catch(r){throw et.A.error("Secure sign up failed",{email:e,error:r.message}),Je.Ay.handleError(r,{context:"secure_sign_up",email:e}),r}}async secureSignOut(){try{const e=Fe.j2.currentUser;e&&(this.activeSessions.delete(e.uid),et.A.info("Secure sign out",{userId:e.uid})),await(0,ke.CI)(Fe.j2)}catch(e){throw et.A.error("Secure sign out failed",{error:e.message}),Je.Ay.handleError(e,{context:"secure_sign_out"}),e}}validatePasswordStrength(e){const t=/[A-Z]/.test(e),n=/[a-z]/.test(e),r=/\d/.test(e),i=/[!@#$%^&*(),.?":{}|<>]/.test(e);if(e.length<8)throw new Error("Password must be at least ".concat(8," characters long"));if(!t)throw new Error("Password must contain at least one uppercase letter");if(!n)throw new Error("Password must contain at least one lowercase letter");if(!r)throw new Error("Password must contain at least one number");if(!i)throw new Error("Password must contain at least one special character");if(["password","123456","qwerty","admin","letmein"].includes(e.toLowerCase()))throw new Error("Password is too common. Please choose a stronger password")}validateEmail(e){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))throw new Error("Invalid email format")}async setupTwoFactorAuth(e){try{if(!tt.A.isFeatureEnabled("twoFactorAuth"))throw new Error("Two-factor authentication is not enabled");const t=Fe.j2.currentUser;if(!t)throw new Error("User must be signed in to setup 2FA");await(0,ke.VO)(t).getSession();const n=new ke.Oe(Fe.j2),r=await n.verifyPhoneNumber(e,new ke.kT("recaptcha-container",{size:"invisible"}));return et.A.info("2FA setup initiated",{userId:t.uid,phoneNumber:e}),r}catch(t){throw et.A.error("2FA setup failed",{error:t.message}),Je.Ay.handleError(t,{context:"setup_2fa"}),t}}async verifyTwoFactorAuth(e,t){try{const n=Fe.j2.currentUser;if(!n)throw new Error("User must be signed in");const r=ke.Oe.credential(e,t),i=(0,ke.VO)(n).assertion(r);return await(0,ke.VO)(n).enroll(i),et.A.info("2FA verification successful",{userId:n.uid}),!0}catch(n){throw et.A.error("2FA verification failed",{error:n.message}),Je.Ay.handleError(n,{context:"verify_2fa"}),n}}setSessionTimeout(e){setTimeout(()=>{var t;this.activeSessions.has(e)&&(this.activeSessions.delete(e),et.A.info("Session expired",{userId:e}),(null===(t=Fe.j2.currentUser)||void 0===t?void 0:t.uid)===e&&this.secureSignOut())},1e3*this.sessionTimeout)}isSessionValid(e){return this.activeSessions.has(e)}getSessionData(e){return this.activeSessions.get(e)}incrementLoginAttempts(e){const t=this.getLoginAttempts(e)+1;this.loginAttempts.set(e,{count:t,lastAttempt:Date.now()})}getLoginAttempts(e){const t=this.loginAttempts.get(e);return t?t.count:0}resetLoginAttempts(e){this.loginAttempts.delete(e)}lockAccount(e){this.lockedAccounts.set(e,Date.now()),et.A.warn("Account locked due to failed attempts",{email:e})}isAccountLocked(e){const t=this.lockedAccounts.get(e);if(!t)return!1;return!(Date.now()-t>1e3*this.lockoutDuration)||(this.lockedAccounts.delete(e),!1)}async getClientIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return"unknown"}}async securePasswordReset(e){try{await(0,ke.J1)(Fe.j2,e),et.A.info("Password reset email sent",{email:e})}catch(t){throw et.A.error("Password reset failed",{email:e,error:t.message}),Je.Ay.handleError(t,{context:"password_reset",email:e}),t}}async securePasswordChange(e,t){try{const n=Fe.j2.currentUser;if(!n||!n.email)throw new Error("User must be signed in");const r=ke.IX.credential(n.email,e);await(0,ke.kZ)(n,r),this.validatePasswordStrength(t),await(0,ke.f3)(n,t),et.A.info("Password changed successfully",{userId:n.uid})}catch(n){throw et.A.error("Password change failed",{error:n.message}),Je.Ay.handleError(n,{context:"password_change"}),n}}logSecurityEvent(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=(0,Ge.A)({timestamp:(new Date).toISOString(),event:e,userId:null===(t=Fe.j2.currentUser)||void 0===t?void 0:t.uid,userAgent:navigator.userAgent,ipAddress:this.getClientIP()},n);et.A.info("Security event",r),tt.A.get("isProduction")&&this.sendSecurityAlert(r)}async sendSecurityAlert(e){try{console.log("Security Alert:",e)}catch(t){et.A.error("Failed to send security alert",{error:t.message})}}},Xi=Yi,Ji=()=>{const[e,n]=(0,t.useState)(!1),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(""),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)({twoFactorAuth:!1,biometricAuth:!1,dataEncryption:!0,auditLogging:!0,rateLimiting:!0});(0,t.useEffect)(()=>{f()},[]);const f=()=>{const e=tt.A.getFeatureFlags();m(e),n(e.twoFactorAuth),i(e.biometricAuth)};return(0,Qe.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Security Settings"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Manage your account security and privacy settings"})]}),(0,Qe.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6",children:(0,Qe.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)(Rt,{className:"h-8 w-8 text-blue-600"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Security Status"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Your account security overview"})]})]}),(0,Qe.jsxs)("div",{className:"flex items-center space-x-2",children:[p.dataEncryption&&(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"}),p.auditLogging&&(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"}),e&&(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"}),r&&(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]})]})}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)(Ni,{className:"h-6 w-6 text-blue-600"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Two-Factor Authentication"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Add an extra layer of security to your account"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-2",children:e?(0,Qe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Qe.jsx)(kt,{className:"h-3 w-3 mr-1"}),"Enabled"]}):(0,Qe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,Qe.jsx)(Ei,{className:"h-3 w-3 mr-1"}),"Disabled"]})})]}),!e&&!l&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,Qe.jsx)("input",{type:"tel",value:s,onChange:e=>a(e.target.value),placeholder:"+1 (555) 123-4567",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Qe.jsx)("button",{onClick:async()=>{if(s){h(!0);try{await Xi.setupTwoFactorAuth(s);d(!0),Pe.oR.success("Verification code sent to your phone"),et.A.info("2FA setup initiated",{phoneNumber:s})}catch(e){Pe.oR.error("Failed to setup 2FA: "+e.message),et.A.error("2FA setup failed",{error:e.message})}finally{h(!1)}}else Pe.oR.error("Please enter your phone number")},disabled:u,className:"btn btn-primary",children:u?"Setting up...":"Enable 2FA"})]}),l&&(0,Qe.jsxs)("div",{className:"space-y-4",children:[(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Code"}),(0,Qe.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Enter 6-digit code",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Qe.jsxs)("div",{className:"flex space-x-3",children:[(0,Qe.jsx)("button",{onClick:async()=>{if(o){h(!0);try{await Xi.verifyTwoFactorAuth(o),n(!0),d(!1),Pe.oR.success("Two-factor authentication enabled successfully!"),et.A.info("2FA verification successful")}catch(e){Pe.oR.error("Verification failed: "+e.message),et.A.error("2FA verification failed",{error:e.message})}finally{h(!1)}}else Pe.oR.error("Please enter the verification code")},disabled:u,className:"btn btn-primary",children:u?"Verifying...":"Verify & Enable"}),(0,Qe.jsx)("button",{onClick:()=>d(!1),className:"btn btn-outline",children:"Cancel"})]})]})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)(Ki,{className:"h-6 w-6 text-green-600"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Biometric Authentication"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Use fingerprint or face recognition for quick access"})]})]}),(0,Qe.jsx)("div",{className:"flex items-center space-x-2",children:r?(0,Qe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Qe.jsx)(kt,{className:"h-3 w-3 mr-1"}),"Enabled"]}):(0,Qe.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,Qe.jsx)(Ei,{className:"h-3 w-3 mr-1"}),"Not Available"]})})]}),(0,Qe.jsx)("button",{onClick:async()=>{if(r)i(!1),Pe.oR.success("Biometric authentication disabled"),et.A.info("Biometric authentication disabled");else{if(!navigator.credentials||!navigator.credentials.create)return void Pe.oR.error("Biometric authentication not supported on this device");try{await navigator.credentials.create({publicKey:{challenge:new Uint8Array(32),rp:{name:"ElderX"},user:{id:new Uint8Array(16),name:"user@elderx.com",displayName:"ElderX User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required"}}});i(!0),Pe.oR.success("Biometric authentication enabled!"),et.A.info("Biometric authentication enabled")}catch(e){Pe.oR.error("Failed to enable biometric authentication: "+e.message),et.A.error("Biometric setup failed",{error:e.message})}}},disabled:u,className:"btn btn-outline",children:r?"Disable Biometric":"Enable Biometric"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,Qe.jsx)(Bt,{className:"h-6 w-6 text-purple-600"}),(0,Qe.jsxs)("div",{children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Password Management"}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600",children:"Change your password and manage security"})]})]}),(0,Qe.jsx)("button",{onClick:async()=>{const e=prompt("Enter current password:"),t=prompt("Enter new password:"),n=prompt("Confirm new password:");if(e&&t&&n)if(t===n){h(!0);try{await Xi.securePasswordChange(e,t),Pe.oR.success("Password changed successfully!"),et.A.info("Password changed successfully")}catch(r){Pe.oR.error("Failed to change password: "+r.message),et.A.error("Password change failed",{error:r.message})}finally{h(!1)}}else Pe.oR.error("Passwords do not match");else Pe.oR.error("All fields are required")},disabled:u,className:"btn btn-outline",children:"Change Password"})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Security Features"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Data Encryption"}),(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Audit Logging"}),(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Rate Limiting"}),(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Session Timeout"}),(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]})]})]}),(0,Qe.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,Qe.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-3",children:"Security Tips"}),(0,Qe.jsxs)("ul",{className:"space-y-2 text-sm text-yellow-700",children:[(0,Qe.jsx)("li",{children:"\u2022 Use a strong, unique password for your account"}),(0,Qe.jsx)("li",{children:"\u2022 Enable two-factor authentication for extra security"}),(0,Qe.jsx)("li",{children:"\u2022 Keep your phone number updated for 2FA"}),(0,Qe.jsx)("li",{children:"\u2022 Log out from shared or public devices"}),(0,Qe.jsx)("li",{children:"\u2022 Report any suspicious activity immediately"})]})]})]})},Qi=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)({totalEvents:0,activeThreats:0,resolvedThreats:0,lastActivity:null}),[o,c]=(0,t.useState)(!0);(0,t.useEffect)(()=>{l(),d();const e=setInterval(l,3e4);return()=>{clearInterval(e),rt.removeAlertCallback(u)}},[]);const l=()=>{try{const e=rt.getActiveAlerts(),t=rt.getActiveThreats();n(e),i(t),a({totalEvents:e.length+t.length,activeThreats:t.length,resolvedThreats:0,lastActivity:(new Date).toISOString()}),c(!1)}catch(e){et.A.error("Failed to load security data",{error:e.message}),c(!1)}},d=()=>{rt.addAlertCallback(u)},u=e=>{n(t=>[e,...t]),Pe.oR.warning("Security Alert: ".concat(e.message),{position:"top-right",autoClose:1e4})},h=e=>{switch(e){case"HIGH":return"text-red-600 bg-red-100";case"MEDIUM":return"text-yellow-600 bg-yellow-100";case"LOW":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},p=e=>{switch(e){case"HIGH":case"MEDIUM":return(0,Qe.jsx)(qe,{className:"h-4 w-4"});case"LOW":return(0,Qe.jsx)(kt,{className:"h-4 w-4"});default:return(0,Qe.jsx)(Rt,{className:"h-4 w-4"})}};return o?(0,Qe.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Qe.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Qe.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[(0,Qe.jsxs)("div",{className:"text-center",children:[(0,Qe.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Security Dashboard"}),(0,Qe.jsx)("p",{className:"text-gray-600",children:"Monitor security events and threats in real-time"})]}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Qe.jsx)(Tt,{className:"h-6 w-6 text-blue-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Events"}),(0,Qe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s.totalEvents})]})]})}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,Qe.jsx)(qe,{className:"h-6 w-6 text-red-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Threats"}),(0,Qe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s.activeThreats})]})]})}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Qe.jsx)(kt,{className:"h-6 w-6 text-green-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Resolved"}),(0,Qe.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s.resolvedThreats})]})]})}),(0,Qe.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Qe.jsxs)("div",{className:"flex items-center",children:[(0,Qe.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,Qe.jsx)(Ot,{className:"h-6 w-6 text-purple-600"})}),(0,Qe.jsxs)("div",{className:"ml-4",children:[(0,Qe.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Last Activity"}),(0,Qe.jsx)("p",{className:"text-sm font-bold text-gray-900",children:s.lastActivity?new Date(s.lastActivity).toLocaleTimeString():"N/A"})]})]})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Qe.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Active Security Alerts"})}),(0,Qe.jsx)("div",{className:"p-6",children:0===e.length?(0,Qe.jsxs)("div",{className:"text-center py-8",children:[(0,Qe.jsx)(Rt,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Qe.jsx)("p",{className:"text-gray-500",children:"No active security alerts"})]}):(0,Qe.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,Qe.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Qe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)("div",{className:"p-2 rounded-lg ".concat(h(e.severity)),children:p(e.severity)}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.type}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),(0,Qe.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:new Date(e.timestamp).toLocaleString()}),e.actions&&e.actions.length>0&&(0,Qe.jsxs)("div",{className:"mt-2",children:[(0,Qe.jsx)("p",{className:"text-xs text-gray-500",children:"Recommended Actions:"}),(0,Qe.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.actions.map((e,t)=>(0,Qe.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e},t))})]})]})]}),(0,Qe.jsx)("button",{onClick:()=>{return t=e.id,rt.dismissAlert(t),n(e=>e.filter(e=>e.id!==t)),void Pe.oR.success("Alert dismissed");var t},className:"text-gray-400 hover:text-gray-600",children:(0,Qe.jsx)(Bt,{className:"h-4 w-4"})})]})},e.id))})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Qe.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Active Security Threats"})}),(0,Qe.jsx)("div",{className:"p-6",children:0===r.length?(0,Qe.jsxs)("div",{className:"text-center py-8",children:[(0,Qe.jsx)(kt,{className:"h-12 w-12 text-green-400 mx-auto mb-4"}),(0,Qe.jsx)("p",{className:"text-gray-500",children:"No active security threats"})]}):(0,Qe.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,Qe.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Qe.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Qe.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Qe.jsx)("div",{className:"p-2 rounded-lg ".concat(h(e.severity)),children:p(e.severity)}),(0,Qe.jsxs)("div",{className:"flex-1",children:[(0,Qe.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.type}),(0,Qe.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,Qe.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Detected: ",new Date(e.detectedAt).toLocaleString()]}),e.events&&e.events.length>0&&(0,Qe.jsx)("div",{className:"mt-2",children:(0,Qe.jsxs)("p",{className:"text-xs text-gray-500",children:["Related Events: ",e.events.length]})})]})]}),(0,Qe.jsx)("button",{onClick:()=>{return t=e.id,rt.resolveThreat(t),i(e=>e.filter(e=>e.id!==t)),void Pe.oR.success("Threat resolved");var t},className:"text-green-600 hover:text-green-800",children:(0,Qe.jsx)(kt,{className:"h-4 w-4"})})]})},e.id))})})]}),(0,Qe.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Qe.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Security Features Status"}),(0,Qe.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)(Yr,{className:"h-5 w-5 text-green-600"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Data Encryption"})]}),(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)(Rt,{className:"h-5 w-5 text-green-600"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Audit Logging"})]}),(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]}),(0,Qe.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,Qe.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Qe.jsx)(Tt,{className:"h-5 w-5 text-green-600"}),(0,Qe.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Real-time Monitoring"})]}),(0,Qe.jsx)(kt,{className:"h-5 w-5 text-green-500"})]})]})]})]})};const Zi=function(){const[e,n]=Ve(Fe.j2),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(navigator.onLine),[l,d]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{try{Ai.init(),et.A.info("PWA services initialized successfully"),rt.initialize(),st.initialize(),rt.logSecurityEvent("APP_INITIALIZATION",{timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,features:tt.A.getFeatureFlags()}),et.A.info("Security services initialized successfully")}catch(r){Je.Ay.handleError(r,{context:"pwa_initialization"})}const e=()=>{try{d(window.innerWidth<=768||"ontouchstart"in window)}catch(r){Je.Ay.handleError(r,{context:"mobile_detection"})}};e(),window.addEventListener("resize",e);const t=()=>{c(!0),et.A.info("App is back online")},n=()=>{c(!1),et.A.warn("App is offline")};if(window.addEventListener("online",t),window.addEventListener("offline",n),"Notification"in window&&"default"===Notification.permission)try{Ai.requestNotificationPermission()}catch(r){Je.Ay.handleError(r,{context:"notification_permission"})}return()=>{window.removeEventListener("resize",e),window.removeEventListener("online",t),window.removeEventListener("offline",n)}},[]),n?(0,Qe.jsx)(Ti,{}):(0,Qe.jsx)($e,{name:"App",children:(0,Qe.jsxs)(Be.UserProvider,{children:[(0,Qe.jsx)(Si,{}),(0,Qe.jsx)(Ri,{}),(0,Qe.jsx)(Pi,{}),l&&e&&(0,Qe.jsx)(zi,{onVoiceCommand:e=>i(e),onGestureControl:e=>a(e),onSettings:()=>{},isOnline:o,isVoiceEnabled:ki.isSupported,isGestureEnabled:Hi.isSupported,isHapticEnabled:Di.isSupported}),(0,Qe.jsx)(Li,{isOpen:r,onClose:()=>i(!1),onCommand:(e,t)=>{switch(console.log("Voice command received:",e,t),e){case"call":window.location.href="/service-provider/calls";break;case"endCall":case"answerCall":case"rejectCall":case"completeTask":case"assignTask":case"help":break;case"sendMessage":case"readMessages":window.location.href="/service-provider/messages";break;case"navigate":if(t.text){const e=t.text.toLowerCase();e.includes("patient")?window.location.href="/service-provider/patients":e.includes("schedule")?window.location.href="/service-provider/schedule":e.includes("task")&&(window.location.href="/service-provider/tasks")}break;case"back":window.history.back();break;case"home":window.location.href="/service-provider";break;case"emergency":window.location.href="/service-provider/emergency";break;case"medication":window.location.href="/service-provider/prescriptions";break;case"vitalSigns":window.location.href="/service-provider/diagnostics";break;default:console.log("Unknown voice command:",e)}}}),(0,Qe.jsx)(Wi,{isOpen:s,onClose:()=>a(!1),onGesture:(e,t)=>{switch(console.log("Gesture received:",e,t),e){case"swipe-left":window.history.back();break;case"swipe-right":window.history.forward();break;case"swipe-up":window.scrollBy(0,-100);break;case"swipe-down":window.scrollBy(0,100);break;case"pinch-in":document.body.style.zoom=Math.max(.5,parseFloat(document.body.style.zoom||1)-.1);break;case"pinch-out":document.body.style.zoom=Math.min(2,parseFloat(document.body.style.zoom||1)+.1);break;case"long-press":break;case"double-tap":window.location.reload();break;default:console.log("Unknown gesture:",e)}}}),(0,Qe.jsxs)(_e,{children:[(0,Qe.jsx)(ve,{path:"/",element:(0,Qe.jsx)(Ut,{})}),(0,Qe.jsx)(ve,{path:"/auth",element:e?(0,Qe.jsx)(fe,{to:"/dashboard",replace:!0}):(0,Qe.jsx)(Ht,{})}),(0,Qe.jsx)(ve,{path:"/login",element:e?(0,Qe.jsx)(fe,{to:"/caregiver",replace:!0}):(0,Qe.jsx)(Ht,{})}),(0,Qe.jsx)(ve,{path:"/signup",element:(0,Qe.jsx)(fe,{to:"/admin/login",replace:!0})}),(0,Qe.jsx)(ve,{path:"/medications",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(vn,{})})}),(0,Qe.jsx)(ve,{path:"/vital-signs",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(bn,{})})}),(0,Qe.jsx)(ve,{path:"/appointments",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(Sn,{})})}),(0,Qe.jsx)(ve,{path:"/telemedicine",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(kr,{})})}),(0,Qe.jsx)(ve,{path:"/medical-documents",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(Kr,{})})}),(0,Qe.jsx)(ve,{path:"/webrtc-test",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(xi,{})})}),(0,Qe.jsx)(ve,{path:"/profile",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(In,{})})}),(0,Qe.jsx)(ve,{path:"/messages",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(Lr,{})})}),(0,Qe.jsx)(ve,{path:"/subscription",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(Mr,{})})}),(0,Qe.jsx)(ve,{path:"/security",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(Ji,{})})}),(0,Qe.jsx)(ve,{path:"/security-dashboard",element:e?(0,Qe.jsx)(gt,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(Qi,{})})}),(0,Qe.jsxs)(ve,{path:"/caregiver",element:e?(0,Qe.jsx)($i,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(Ln,{})}),(0,Qe.jsx)(ve,{path:"schedule",element:(0,Qe.jsx)(Hn,{})}),(0,Qe.jsx)(ve,{path:"patients",element:(0,Qe.jsx)(qn,{})}),(0,Qe.jsx)(ve,{path:"tasks",element:(0,Qe.jsx)(Yn,{})}),(0,Qe.jsx)(ve,{path:"messages",element:(0,Qe.jsx)(tr,{})}),(0,Qe.jsx)(ve,{path:"navigation",element:(0,Qe.jsx)(sr,{})}),(0,Qe.jsx)(ve,{path:"photos",element:(0,Qe.jsx)(or,{})}),(0,Qe.jsx)(ve,{path:"performance",element:(0,Qe.jsx)(cr,{})}),(0,Qe.jsx)(ve,{path:"emergency",element:(0,Qe.jsx)(lr,{})}),(0,Qe.jsx)(ve,{path:"settings",element:(0,Qe.jsx)(dr,{})})]}),(0,Qe.jsxs)(ve,{path:"/service-provider",element:e?(0,Qe.jsx)(It,{}):(0,Qe.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Qe.jsx)(ve,{index:!0,element:(0,Qe.jsx)(ii,{})}),(0,Qe.jsx)(ve,{path:"schedule",element:(0,Qe.jsx)(Hn,{})}),(0,Qe.jsx)(ve,{path:"patients",element:(0,Qe.jsx)(qn,{})}),(0,Qe.jsx)(ve,{path:"messages",element:(0,Qe.jsx)(wi,{})}),(0,Qe.jsx)(ve,{path:"calls",element:(0,Qe.jsx)(_i,{})}),(0,Qe.jsx)(ve,{path:"tasks",element:(0,Qe.jsx)(Yn,{})}),(0,Qe.jsx)(ve,{path:"care-logs",element:(0,Qe.jsx)(or,{})}),(0,Qe.jsx)(ve,{path:"photos",element:(0,Qe.jsx)(or,{})}),(0,Qe.jsx)(ve,{path:"activities",element:(0,Qe.jsx)(cr,{})}),(0,Qe.jsx)(ve,{path:"medical-records",element:(0,Qe.jsx)(qn,{})}),(0,Qe.jsx)(ve,{path:"prescriptions",element:(0,Qe.jsx)(vn,{})}),(0,Qe.jsx)(ve,{path:"consultations",element:(0,Qe.jsx)(Sn,{})}),(0,Qe.jsx)(ve,{path:"diagnostics",element:(0,Qe.jsx)(bn,{})}),(0,Qe.jsx)(ve,{path:"settings",element:(0,Qe.jsx)(dr,{})})]}),(0,Qe.jsx)(ve,{path:"/services",element:(0,Qe.jsx)(Ur,{})}),(0,Qe.jsx)(ve,{path:"/pricing",element:(0,Qe.jsx)(Vr,{})}),(0,Qe.jsx)(ve,{path:"/admin/login",element:(0,Qe.jsx)(Xr,{})}),(0,Qe.jsx)(ve,{path:"/admin/dashboard",element:(0,Qe.jsx)(Zr,{})}),(0,Qe.jsx)(ve,{path:"/admin",element:(0,Qe.jsx)(fe,{to:"/admin/dashboard",replace:!0})}),(0,Qe.jsx)(ve,{path:"*",element:(0,Qe.jsx)(fe,{to:"/",replace:!0})})]})]})})};function $i(){const{useUser:e}=n(4107),{userProfile:t,user:r,loading:i}=e();return i||r&&!t?(0,Qe.jsx)(Ti,{}):(console.log("\ud83d\udd0d StrictCaregiverGuard Check:",{userType:null===t||void 0===t?void 0:t.userType,onboardingComplete:null===t||void 0===t?void 0:t.onboardingComplete}),"caregiver"!==(null===t||void 0===t?void 0:t.userType)||null!==t&&void 0!==t&&t.onboardingComplete?(0,Qe.jsx)(Dr,{}):(console.log("\ud83d\udeab STRICT: Caregiver onboarding required - forcing redirect"),window.location.replace("/caregiver/onboarding"),(0,Qe.jsx)(Ti,{})))}const es=new Oe.QueryClient;(0,i.H)(document.getElementById("root")).render((0,Qe.jsx)(t.StrictMode,{children:(0,Qe.jsx)(Oe.QueryClientProvider,{client:es,children:(0,Qe.jsxs)(Te,{children:[(0,Qe.jsx)(Zi,{}),(0,Qe.jsx)(Pe.N9,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})})}))})()})();
//# sourceMappingURL=main.0e7e79b2.js.map