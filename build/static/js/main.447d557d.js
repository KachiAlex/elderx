/*! For license information please see main.447d557d.js.LICENSE.txt */
(()=>{var e={43:(e,t,n)=>{"use strict";e.exports=n(202)},75:(e,t,n)=>{"use strict";n.d(t,{B:()=>r,t:()=>s});var i=console;function s(){return i}function r(e){i=e}},153:(e,t,n)=>{"use strict";var i=n(43),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,r={},l=null,d=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,i)&&!c.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:l,ref:d,props:r,_owner:o.current}}t.Fragment=r,t.jsx=l,t.jsxs=l},168:(e,t,n)=>{"use strict";function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i.apply(null,arguments)}n.d(t,{A:()=>i})},198:(e,t,n)=>{"use strict";n.d(t,{E:()=>x});var i=n(168),s=n(870);function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}var o=n(991),c=n(75),l=function(){function e(){this.listeners=[]}var t=e.prototype;return t.subscribe=function(e){var t=this,n=e||function(){};return this.listeners.push(n),this.onSubscribe(),function(){t.listeners=t.listeners.filter(function(e){return e!==n}),t.onUnsubscribe()}},t.hasListeners=function(){return this.listeners.length>0},t.onSubscribe=function(){},t.onUnsubscribe=function(){},e}(),d=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!s.S$&&(null==(t=window)?void 0:t.addEventListener)){var n=function(){return e()};return window.addEventListener("visibilitychange",n,!1),window.addEventListener("focus",n,!1),function(){window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}}},t}a(t,e);var n=t.prototype;return n.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},n.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},n.setEventListener=function(e){var t,n=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?n.setFocused(e):n.onFocus()})},n.setFocused=function(e){this.focused=e,e&&this.onFocus()},n.onFocus=function(){this.listeners.forEach(function(e){e()})},n.isFocused=function(){return"boolean"===typeof this.focused?this.focused:"undefined"===typeof document||[void 0,"visible","prerender"].includes(document.visibilityState)},t}(l)),u=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!s.S$&&(null==(t=window)?void 0:t.addEventListener)){var n=function(){return e()};return window.addEventListener("online",n,!1),window.addEventListener("offline",n,!1),function(){window.removeEventListener("online",n),window.removeEventListener("offline",n)}}},t}a(t,e);var n=t.prototype;return n.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},n.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},n.setEventListener=function(e){var t,n=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?n.setOnline(e):n.onOnline()})},n.setOnline=function(e){this.online=e,e&&this.onOnline()},n.onOnline=function(){this.listeners.forEach(function(e){e()})},n.isOnline=function(){return"boolean"===typeof this.online?this.online:"undefined"===typeof navigator||"undefined"===typeof navigator.onLine||navigator.onLine},t}(l));function h(e){return Math.min(1e3*Math.pow(2,e),3e4)}function p(e){return"function"===typeof(null==e?void 0:e.cancel)}var m=function(e){this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent};function f(e){return e instanceof m}var g=function(e){var t,n,i,r,a=this,o=!1;this.abort=e.abort,this.cancel=function(e){return null==t?void 0:t(e)},this.cancelRetry=function(){o=!0},this.continueRetry=function(){o=!1},this.continue=function(){return null==n?void 0:n()},this.failureCount=0,this.isPaused=!1,this.isResolved=!1,this.isTransportCancelable=!1,this.promise=new Promise(function(e,t){i=e,r=t});var c=function(t){a.isResolved||(a.isResolved=!0,null==e.onSuccess||e.onSuccess(t),null==n||n(),i(t))},l=function(t){a.isResolved||(a.isResolved=!0,null==e.onError||e.onError(t),null==n||n(),r(t))};!function i(){if(!a.isResolved){var r;try{r=e.fn()}catch(f){r=Promise.reject(f)}t=function(e){if(!a.isResolved&&(l(new m(e)),null==a.abort||a.abort(),p(r)))try{r.cancel()}catch(t){}},a.isTransportCancelable=p(r),Promise.resolve(r).then(c).catch(function(t){var r,c;if(!a.isResolved){var p=null!=(r=e.retry)?r:3,m=null!=(c=e.retryDelay)?c:h,f="function"===typeof m?m(a.failureCount,t):m,g=!0===p||"number"===typeof p&&a.failureCount<p||"function"===typeof p&&p(a.failureCount,t);!o&&g?(a.failureCount++,null==e.onFail||e.onFail(a.failureCount,t),(0,s.yy)(f).then(function(){if(!d.isFocused()||!u.isOnline())return new Promise(function(t){n=t,a.isPaused=!0,null==e.onPause||e.onPause()}).then(function(){n=void 0,a.isPaused=!1,null==e.onContinue||e.onContinue()})}).then(function(){o?l(t):i()})):l(t)}})}}()},_=function(){function e(e){this.abortSignalConsumed=!1,this.hadObservers=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||this.getDefaultState(this.options),this.state=this.initialState,this.meta=e.meta,this.scheduleGc()}var t=e.prototype;return t.setOptions=function(e){var t;this.options=(0,i.A)({},this.defaultOptions,e),this.meta=null==e?void 0:e.meta,this.cacheTime=Math.max(this.cacheTime||0,null!=(t=this.options.cacheTime)?t:3e5)},t.setDefaultOptions=function(e){this.defaultOptions=e},t.scheduleGc=function(){var e=this;this.clearGcTimeout(),(0,s.gn)(this.cacheTime)&&(this.gcTimeout=setTimeout(function(){e.optionalRemove()},this.cacheTime))},t.clearGcTimeout=function(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)},t.optionalRemove=function(){this.observers.length||(this.state.isFetching?this.hadObservers&&this.scheduleGc():this.cache.remove(this))},t.setData=function(e,t){var n,i,r=this.state.data,a=(0,s.Zw)(e,r);return(null==(n=(i=this.options).isDataEqual)?void 0:n.call(i,r,a))?a=r:!1!==this.options.structuralSharing&&(a=(0,s.BH)(r,a)),this.dispatch({data:a,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt}),a},t.setState=function(e,t){this.dispatch({type:"setState",state:e,setStateOptions:t})},t.cancel=function(e){var t,n=this.promise;return null==(t=this.retryer)||t.cancel(e),n?n.then(s.lQ).catch(s.lQ):Promise.resolve()},t.destroy=function(){this.clearGcTimeout(),this.cancel({silent:!0})},t.reset=function(){this.destroy(),this.setState(this.initialState)},t.isActive=function(){return this.observers.some(function(e){return!1!==e.options.enabled})},t.isFetching=function(){return this.state.isFetching},t.isStale=function(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(function(e){return e.getCurrentResult().isStale})},t.isStaleByTime=function(e){return void 0===e&&(e=0),this.state.isInvalidated||!this.state.dataUpdatedAt||!(0,s.j3)(this.state.dataUpdatedAt,e)},t.onFocus=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnWindowFocus()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.onOnline=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnReconnect()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.addObserver=function(e){-1===this.observers.indexOf(e)&&(this.observers.push(e),this.hadObservers=!0,this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))},t.removeObserver=function(e){-1!==this.observers.indexOf(e)&&(this.observers=this.observers.filter(function(t){return t!==e}),this.observers.length||(this.retryer&&(this.retryer.isTransportCancelable||this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.cacheTime?this.scheduleGc():this.cache.remove(this)),this.cache.notify({type:"observerRemoved",query:this,observer:e}))},t.getObserversCount=function(){return this.observers.length},t.invalidate=function(){this.state.isInvalidated||this.dispatch({type:"invalidate"})},t.fetch=function(e,t){var n,i,r,a=this;if(this.state.isFetching)if(this.state.dataUpdatedAt&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(this.promise){var o;return null==(o=this.retryer)||o.continueRetry(),this.promise}if(e&&this.setOptions(e),!this.options.queryFn){var l=this.observers.find(function(e){return e.options.queryFn});l&&this.setOptions(l.options)}var d=(0,s.HN)(this.queryKey),u=(0,s.jY)(),h={queryKey:d,pageParam:void 0,meta:this.meta};Object.defineProperty(h,"signal",{enumerable:!0,get:function(){if(u)return a.abortSignalConsumed=!0,u.signal}});var p,m,_={fetchOptions:t,options:this.options,queryKey:d,state:this.state,fetchFn:function(){return a.options.queryFn?(a.abortSignalConsumed=!1,a.options.queryFn(h)):Promise.reject("Missing queryFn")},meta:this.meta};(null==(n=this.options.behavior)?void 0:n.onFetch)&&(null==(p=this.options.behavior)||p.onFetch(_));(this.revertState=this.state,this.state.isFetching&&this.state.fetchMeta===(null==(i=_.fetchOptions)?void 0:i.meta))||this.dispatch({type:"fetch",meta:null==(m=_.fetchOptions)?void 0:m.meta});return this.retryer=new g({fn:_.fetchFn,abort:null==u||null==(r=u.abort)?void 0:r.bind(u),onSuccess:function(e){a.setData(e),null==a.cache.config.onSuccess||a.cache.config.onSuccess(e,a),0===a.cacheTime&&a.optionalRemove()},onError:function(e){f(e)&&e.silent||a.dispatch({type:"error",error:e}),f(e)||(null==a.cache.config.onError||a.cache.config.onError(e,a),(0,c.t)().error(e)),0===a.cacheTime&&a.optionalRemove()},onFail:function(){a.dispatch({type:"failed"})},onPause:function(){a.dispatch({type:"pause"})},onContinue:function(){a.dispatch({type:"continue"})},retry:_.options.retry,retryDelay:_.options.retryDelay}),this.promise=this.retryer.promise,this.promise},t.dispatch=function(e){var t=this;this.state=this.reducer(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onQueryUpdate(e)}),t.cache.notify({query:t,type:"queryUpdated",action:e})})},t.getDefaultState=function(e){var t="function"===typeof e.initialData?e.initialData():e.initialData,n="undefined"!==typeof e.initialData?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0,i="undefined"!==typeof t;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?null!=n?n:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchMeta:null,isFetching:!1,isInvalidated:!1,isPaused:!1,status:i?"success":"idle"}},t.reducer=function(e,t){var n,s;switch(t.type){case"failed":return(0,i.A)({},e,{fetchFailureCount:e.fetchFailureCount+1});case"pause":return(0,i.A)({},e,{isPaused:!0});case"continue":return(0,i.A)({},e,{isPaused:!1});case"fetch":return(0,i.A)({},e,{fetchFailureCount:0,fetchMeta:null!=(n=t.meta)?n:null,isFetching:!0,isPaused:!1},!e.dataUpdatedAt&&{error:null,status:"loading"});case"success":return(0,i.A)({},e,{data:t.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:null!=(s=t.dataUpdatedAt)?s:Date.now(),error:null,fetchFailureCount:0,isFetching:!1,isInvalidated:!1,isPaused:!1,status:"success"});case"error":var r=t.error;return f(r)&&r.revert&&this.revertState?(0,i.A)({},this.revertState):(0,i.A)({},e,{error:r,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,isFetching:!1,isPaused:!1,status:"error"});case"invalidate":return(0,i.A)({},e,{isInvalidated:!0});case"setState":return(0,i.A)({},e,t.state);default:return e}},e}(),y=function(e){function t(t){var n;return(n=e.call(this)||this).config=t||{},n.queries=[],n.queriesMap={},n}a(t,e);var n=t.prototype;return n.build=function(e,t,n){var i,r=t.queryKey,a=null!=(i=t.queryHash)?i:(0,s.F$)(r,t),o=this.get(a);return o||(o=new _({cache:this,queryKey:r,queryHash:a,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r),meta:t.meta}),this.add(o)),o},n.add=function(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"queryAdded",query:e}))},n.remove=function(e){var t=this.queriesMap[e.queryHash];t&&(e.destroy(),this.queries=this.queries.filter(function(t){return t!==e}),t===e&&delete this.queriesMap[e.queryHash],this.notify({type:"queryRemoved",query:e}))},n.clear=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(t){e.remove(t)})})},n.get=function(e){return this.queriesMap[e]},n.getAll=function(){return this.queries},n.find=function(e,t){var n=(0,s.b_)(e,t)[0];return"undefined"===typeof n.exact&&(n.exact=!0),this.queries.find(function(e){return(0,s.MK)(n,e)})},n.findAll=function(e,t){var n=(0,s.b_)(e,t)[0];return Object.keys(n).length>0?this.queries.filter(function(e){return(0,s.MK)(n,e)}):this.queries},n.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},n.onFocus=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onFocus()})})},n.onOnline=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onOnline()})})},t}(l),v=function(){function e(e){this.options=(0,i.A)({},e.defaultOptions,e.options),this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.observers=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,isPaused:!1,status:"idle",variables:void 0},this.meta=e.meta}var t=e.prototype;return t.setState=function(e){this.dispatch({type:"setState",state:e})},t.addObserver=function(e){-1===this.observers.indexOf(e)&&this.observers.push(e)},t.removeObserver=function(e){this.observers=this.observers.filter(function(t){return t!==e})},t.cancel=function(){return this.retryer?(this.retryer.cancel(),this.retryer.promise.then(s.lQ).catch(s.lQ)):Promise.resolve()},t.continue=function(){return this.retryer?(this.retryer.continue(),this.retryer.promise):this.execute()},t.execute=function(){var e,t=this,n="loading"===this.state.status,i=Promise.resolve();return n||(this.dispatch({type:"loading",variables:this.options.variables}),i=i.then(function(){null==t.mutationCache.config.onMutate||t.mutationCache.config.onMutate(t.state.variables,t)}).then(function(){return null==t.options.onMutate?void 0:t.options.onMutate(t.state.variables)}).then(function(e){e!==t.state.context&&t.dispatch({type:"loading",context:e,variables:t.state.variables})})),i.then(function(){return t.executeMutation()}).then(function(n){e=n,null==t.mutationCache.config.onSuccess||t.mutationCache.config.onSuccess(e,t.state.variables,t.state.context,t)}).then(function(){return null==t.options.onSuccess?void 0:t.options.onSuccess(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(e,null,t.state.variables,t.state.context)}).then(function(){return t.dispatch({type:"success",data:e}),e}).catch(function(e){return null==t.mutationCache.config.onError||t.mutationCache.config.onError(e,t.state.variables,t.state.context,t),(0,c.t)().error(e),Promise.resolve().then(function(){return null==t.options.onError?void 0:t.options.onError(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(void 0,e,t.state.variables,t.state.context)}).then(function(){throw t.dispatch({type:"error",error:e}),e})})},t.executeMutation=function(){var e,t=this;return this.retryer=new g({fn:function(){return t.options.mutationFn?t.options.mutationFn(t.state.variables):Promise.reject("No mutationFn found")},onFail:function(){t.dispatch({type:"failed"})},onPause:function(){t.dispatch({type:"pause"})},onContinue:function(){t.dispatch({type:"continue"})},retry:null!=(e=this.options.retry)?e:0,retryDelay:this.options.retryDelay}),this.retryer.promise},t.dispatch=function(e){var t=this;this.state=function(e,t){switch(t.type){case"failed":return(0,i.A)({},e,{failureCount:e.failureCount+1});case"pause":return(0,i.A)({},e,{isPaused:!0});case"continue":return(0,i.A)({},e,{isPaused:!1});case"loading":return(0,i.A)({},e,{context:t.context,data:void 0,error:null,isPaused:!1,status:"loading",variables:t.variables});case"success":return(0,i.A)({},e,{data:t.data,error:null,status:"success",isPaused:!1});case"error":return(0,i.A)({},e,{data:void 0,error:t.error,failureCount:e.failureCount+1,isPaused:!1,status:"error"});case"setState":return(0,i.A)({},e,t.state);default:return e}}(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onMutationUpdate(e)}),t.mutationCache.notify(t)})},e}();var E=function(e){function t(t){var n;return(n=e.call(this)||this).config=t||{},n.mutations=[],n.mutationId=0,n}a(t,e);var n=t.prototype;return n.build=function(e,t,n){var i=new v({mutationCache:this,mutationId:++this.mutationId,options:e.defaultMutationOptions(t),state:n,defaultOptions:t.mutationKey?e.getMutationDefaults(t.mutationKey):void 0,meta:t.meta});return this.add(i),i},n.add=function(e){this.mutations.push(e),this.notify(e)},n.remove=function(e){this.mutations=this.mutations.filter(function(t){return t!==e}),e.cancel(),this.notify(e)},n.clear=function(){var e=this;o.j.batch(function(){e.mutations.forEach(function(t){e.remove(t)})})},n.getAll=function(){return this.mutations},n.find=function(e){return"undefined"===typeof e.exact&&(e.exact=!0),this.mutations.find(function(t){return(0,s.nJ)(e,t)})},n.findAll=function(e){return this.mutations.filter(function(t){return(0,s.nJ)(e,t)})},n.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},n.onFocus=function(){this.resumePausedMutations()},n.onOnline=function(){this.resumePausedMutations()},n.resumePausedMutations=function(){var e=this.mutations.filter(function(e){return e.state.isPaused});return o.j.batch(function(){return e.reduce(function(e,t){return e.then(function(){return t.continue().catch(s.lQ)})},Promise.resolve())})},t}(l);function b(e,t){return null==e.getNextPageParam?void 0:e.getNextPageParam(t[t.length-1],t)}function S(e,t){return null==e.getPreviousPageParam?void 0:e.getPreviousPageParam(t[0],t)}var x=function(){function e(e){void 0===e&&(e={}),this.queryCache=e.queryCache||new y,this.mutationCache=e.mutationCache||new E,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[]}var t=e.prototype;return t.mount=function(){var e=this;this.unsubscribeFocus=d.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onFocus(),e.queryCache.onFocus())}),this.unsubscribeOnline=u.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onOnline(),e.queryCache.onOnline())})},t.unmount=function(){var e,t;null==(e=this.unsubscribeFocus)||e.call(this),null==(t=this.unsubscribeOnline)||t.call(this)},t.isFetching=function(e,t){var n=(0,s.b_)(e,t)[0];return n.fetching=!0,this.queryCache.findAll(n).length},t.isMutating=function(e){return this.mutationCache.findAll((0,i.A)({},e,{fetching:!0})).length},t.getQueryData=function(e,t){var n;return null==(n=this.queryCache.find(e,t))?void 0:n.state.data},t.getQueriesData=function(e){return this.getQueryCache().findAll(e).map(function(e){return[e.queryKey,e.state.data]})},t.setQueryData=function(e,t,n){var i=(0,s.vh)(e),r=this.defaultQueryOptions(i);return this.queryCache.build(this,r).setData(t,n)},t.setQueriesData=function(e,t,n){var i=this;return o.j.batch(function(){return i.getQueryCache().findAll(e).map(function(e){var s=e.queryKey;return[s,i.setQueryData(s,t,n)]})})},t.getQueryState=function(e,t){var n;return null==(n=this.queryCache.find(e,t))?void 0:n.state},t.removeQueries=function(e,t){var n=(0,s.b_)(e,t)[0],i=this.queryCache;o.j.batch(function(){i.findAll(n).forEach(function(e){i.remove(e)})})},t.resetQueries=function(e,t,n){var r=this,a=(0,s.b_)(e,t,n),c=a[0],l=a[1],d=this.queryCache,u=(0,i.A)({},c,{active:!0});return o.j.batch(function(){return d.findAll(c).forEach(function(e){e.reset()}),r.refetchQueries(u,l)})},t.cancelQueries=function(e,t,n){var i=this,r=(0,s.b_)(e,t,n),a=r[0],c=r[1],l=void 0===c?{}:c;"undefined"===typeof l.revert&&(l.revert=!0);var d=o.j.batch(function(){return i.queryCache.findAll(a).map(function(e){return e.cancel(l)})});return Promise.all(d).then(s.lQ).catch(s.lQ)},t.invalidateQueries=function(e,t,n){var r,a,c,l=this,d=(0,s.b_)(e,t,n),u=d[0],h=d[1],p=(0,i.A)({},u,{active:null==(r=null!=(a=u.refetchActive)?a:u.active)||r,inactive:null!=(c=u.refetchInactive)&&c});return o.j.batch(function(){return l.queryCache.findAll(u).forEach(function(e){e.invalidate()}),l.refetchQueries(p,h)})},t.refetchQueries=function(e,t,n){var r=this,a=(0,s.b_)(e,t,n),c=a[0],l=a[1],d=o.j.batch(function(){return r.queryCache.findAll(c).map(function(e){return e.fetch(void 0,(0,i.A)({},l,{meta:{refetchPage:null==c?void 0:c.refetchPage}}))})}),u=Promise.all(d).then(s.lQ);return(null==l?void 0:l.throwOnError)||(u=u.catch(s.lQ)),u},t.fetchQuery=function(e,t,n){var i=(0,s.vh)(e,t,n),r=this.defaultQueryOptions(i);"undefined"===typeof r.retry&&(r.retry=!1);var a=this.queryCache.build(this,r);return a.isStaleByTime(r.staleTime)?a.fetch(r):Promise.resolve(a.state.data)},t.prefetchQuery=function(e,t,n){return this.fetchQuery(e,t,n).then(s.lQ).catch(s.lQ)},t.fetchInfiniteQuery=function(e,t,n){var i=(0,s.vh)(e,t,n);return i.behavior={onFetch:function(e){e.fetchFn=function(){var t,n,i,r,a,o,c,l=null==(t=e.fetchOptions)||null==(n=t.meta)?void 0:n.refetchPage,d=null==(i=e.fetchOptions)||null==(r=i.meta)?void 0:r.fetchMore,u=null==d?void 0:d.pageParam,h="forward"===(null==d?void 0:d.direction),m="backward"===(null==d?void 0:d.direction),f=(null==(a=e.state.data)?void 0:a.pages)||[],g=(null==(o=e.state.data)?void 0:o.pageParams)||[],_=(0,s.jY)(),y=null==_?void 0:_.signal,v=g,E=!1,x=e.options.queryFn||function(){return Promise.reject("Missing queryFn")},T=function(e,t,n,i){return v=i?[t].concat(v):[].concat(v,[t]),i?[n].concat(e):[].concat(e,[n])},w=function(t,n,i,s){if(E)return Promise.reject("Cancelled");if("undefined"===typeof i&&!n&&t.length)return Promise.resolve(t);var r={queryKey:e.queryKey,signal:y,pageParam:i,meta:e.meta},a=x(r),o=Promise.resolve(a).then(function(e){return T(t,i,e,s)});return p(a)&&(o.cancel=a.cancel),o};if(f.length)if(h){var N="undefined"!==typeof u,C=N?u:b(e.options,f);c=w(f,N,C)}else if(m){var R="undefined"!==typeof u,I=R?u:S(e.options,f);c=w(f,R,I,!0)}else!function(){v=[];var t="undefined"===typeof e.options.getNextPageParam,n=!l||!f[0]||l(f[0],0,f);c=n?w([],t,g[0]):Promise.resolve(T([],g[0],f[0]));for(var i=function(n){c=c.then(function(i){if(!l||!f[n]||l(f[n],n,f)){var s=t?g[n]:b(e.options,i);return w(i,t,s)}return Promise.resolve(T(i,g[n],f[n]))})},s=1;s<f.length;s++)i(s)}();else c=w([]);var A=c.then(function(e){return{pages:e,pageParams:v}});return A.cancel=function(){E=!0,null==_||_.abort(),p(c)&&c.cancel()},A}}},this.fetchQuery(i)},t.prefetchInfiniteQuery=function(e,t,n){return this.fetchInfiniteQuery(e,t,n).then(s.lQ).catch(s.lQ)},t.cancelMutations=function(){var e=this,t=o.j.batch(function(){return e.mutationCache.getAll().map(function(e){return e.cancel()})});return Promise.all(t).then(s.lQ).catch(s.lQ)},t.resumePausedMutations=function(){return this.getMutationCache().resumePausedMutations()},t.executeMutation=function(e){return this.mutationCache.build(this,e).execute()},t.getQueryCache=function(){return this.queryCache},t.getMutationCache=function(){return this.mutationCache},t.getDefaultOptions=function(){return this.defaultOptions},t.setDefaultOptions=function(e){this.defaultOptions=e},t.setQueryDefaults=function(e,t){var n=this.queryDefaults.find(function(t){return(0,s.Od)(e)===(0,s.Od)(t.queryKey)});n?n.defaultOptions=t:this.queryDefaults.push({queryKey:e,defaultOptions:t})},t.getQueryDefaults=function(e){var t;return e?null==(t=this.queryDefaults.find(function(t){return(0,s.Cp)(e,t.queryKey)}))?void 0:t.defaultOptions:void 0},t.setMutationDefaults=function(e,t){var n=this.mutationDefaults.find(function(t){return(0,s.Od)(e)===(0,s.Od)(t.mutationKey)});n?n.defaultOptions=t:this.mutationDefaults.push({mutationKey:e,defaultOptions:t})},t.getMutationDefaults=function(e){var t;return e?null==(t=this.mutationDefaults.find(function(t){return(0,s.Cp)(e,t.mutationKey)}))?void 0:t.defaultOptions:void 0},t.defaultQueryOptions=function(e){if(null==e?void 0:e._defaulted)return e;var t=(0,i.A)({},this.defaultOptions.queries,this.getQueryDefaults(null==e?void 0:e.queryKey),e,{_defaulted:!0});return!t.queryHash&&t.queryKey&&(t.queryHash=(0,s.F$)(t.queryKey,t)),t},t.defaultQueryObserverOptions=function(e){return this.defaultQueryOptions(e)},t.defaultMutationOptions=function(e){return(null==e?void 0:e._defaulted)?e:(0,i.A)({},this.defaultOptions.mutations,this.getMutationDefaults(null==e?void 0:e.mutationKey),e,{_defaulted:!0})},t.clear=function(){this.queryCache.clear(),this.mutationCache.clear()},e}()},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var E=v.prototype=new y;E.constructor=v,f(E,_.prototype),E.isPureReactComponent=!0;var b=Array.isArray,S=Object.prototype.hasOwnProperty,x={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,i){var s,r={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,s)&&!T.hasOwnProperty(s)&&(r[s]=t[s]);var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){for(var l=Array(c),d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}if(e&&e.defaultProps)for(s in c=e.defaultProps)void 0===r[s]&&(r[s]=c[s]);return{$$typeof:n,type:e,key:a,ref:o,props:r,_owner:x.current}}function N(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,s,r,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c=!1;if(null===e)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case i:c=!0}}if(c)return a=a(c=e),e=""===r?"."+R(c,0):r,b(a)?(s="",null!=e&&(s=e.replace(C,"$&/")+"/"),I(a,t,s,"",function(e){return e})):null!=a&&(N(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+e)),t.push(a)),1;if(c=0,r=""===r?".":r+":",b(e))for(var l=0;l<e.length;l++){var d=r+R(o=e[l],l);c+=I(o,t,s,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),l=0;!(o=e.next()).done;)c+=I(o=o.value,t,s,d=r+R(o,l++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function A(e,t,n){if(null==e)return e;var i=[],s=0;return I(e,i,"","",function(e){return t.call(n,e,s++)}),i}function O(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},k={transition:null},P={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:k,ReactCurrentOwner:x};t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=s,t.Profiler=a,t.PureComponent=v,t.StrictMode=r,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=f({},e.props),r=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=x.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)S.call(t,l)&&!T.hasOwnProperty(l)&&(s[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}return{$$typeof:n,type:e.type,key:r,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=N,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.2.0"},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,s=e[i];if(!(0<r(s,t)))break e;e[i]=t,e[n]=s,n=i}}function i(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,s=e.length,a=s>>>1;i<a;){var o=2*(i+1)-1,c=e[o],l=o+1,d=e[l];if(0>r(c,n))l<s&&0>r(d,c)?(e[i]=d,e[l]=n,i=l):(e[i]=c,e[o]=n,i=o);else{if(!(l<s&&0>r(d,n)))break e;e[i]=d,e[l]=n,i=l}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,c=o.now();t.unstable_now=function(){return o.now()-c}}var l=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,_="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=i(d);null!==t;){if(null===t.callback)s(d);else{if(!(t.startTime<=e))break;s(d),t.sortIndex=t.expirationTime,n(l,t)}t=i(d)}}function b(e){if(g=!1,E(e),!f)if(null!==i(l))f=!0,k(S);else{var t=i(d);null!==t&&P(b,t.startTime-e)}}function S(e,n){f=!1,g&&(g=!1,y(N),N=-1),m=!0;var r=p;try{for(E(n),h=i(l);null!==h&&(!(h.expirationTime>n)||e&&!I());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===i(l)&&s(l),E(n)}else s(l);h=i(l)}if(null!==h)var c=!0;else{var u=i(d);null!==u&&P(b,u.startTime-n),c=!1}return c}finally{h=null,p=r,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x,T=!1,w=null,N=-1,C=5,R=-1;function I(){return!(t.unstable_now()-R<C)}function A(){if(null!==w){var e=t.unstable_now();R=e;var n=!0;try{n=w(!0,e)}finally{n?x():(T=!1,w=null)}}else T=!1}if("function"===typeof v)x=function(){v(A)};else if("undefined"!==typeof MessageChannel){var O=new MessageChannel,D=O.port2;O.port1.onmessage=A,x=function(){D.postMessage(null)}}else x=function(){_(A,0)};function k(e){w=e,T||(T=!0,x())}function P(e,n){N=_(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,k(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,s,r){var a=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?a+r:a:r=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>a?(e.sortIndex=r,n(d,e),null===i(l)&&e===i(d)&&(g?(y(N),N=-1):g=!0,P(b,r-a))):(e.sortIndex=o,n(l,e),f||m||(f=!0,k(S))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},298:()=>{},391:(e,t,n)=>{"use strict";var i=n(950);t.H=i.createRoot,i.hydrateRoot},524:(e,t,n)=>{"use strict";n.d(t,{QueryClientProvider:()=>u});var i=n(991),s=n(950).unstable_batchedUpdates;i.j.setBatchNotifyFunction(s);var r=n(75),a=console;(0,r.B)(a);var o=n(43),c=o.createContext(void 0),l=o.createContext(!1);function d(e){return e&&"undefined"!==typeof window?(window.ReactQueryClientContext||(window.ReactQueryClientContext=c),window.ReactQueryClientContext):c}var u=function(e){var t=e.client,n=e.contextSharing,i=void 0!==n&&n,s=e.children;o.useEffect(function(){return t.mount(),function(){t.unmount()}},[t]);var r=d(i);return o.createElement(l.Provider,{value:i},o.createElement(r.Provider,{value:t},s))}},579:(e,t,n)=>{"use strict";e.exports=n(153)},635:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s=function(e){try{return!!e()}catch(e){return!0}},r=!s(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),a=r,o=Function.prototype,c=o.call,l=a&&o.bind.bind(c,c),d=a?l:function(e){return function(){return c.apply(e,arguments)}},u=d({}.isPrototypeOf),h=function(e){return e&&e.Math===Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof t&&t)||h("object"==typeof t&&t)||function(){return this}()||Function("return this")(),m=r,f=Function.prototype,g=f.apply,_=f.call,y="object"==typeof Reflect&&Reflect.apply||(m?_.bind(g):function(){return _.apply(g,arguments)}),v=d,E=v({}.toString),b=v("".slice),S=function(e){return b(E(e),8,-1)},x=S,T=d,w=function(e){if("Function"===x(e))return T(e)},N="object"==typeof document&&document.all,C=void 0===N&&void 0!==N?function(e){return"function"==typeof e||e===N}:function(e){return"function"==typeof e},R={},I=!s(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),A=r,O=Function.prototype.call,D=A?O.bind(O):function(){return O.apply(O,arguments)},k={},P={}.propertyIsEnumerable,L=Object.getOwnPropertyDescriptor,j=L&&!P.call({1:2},1);k.f=j?function(e){var t=L(this,e);return!!t&&t.enumerable}:P;var M,U,V=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},F=s,B=S,G=Object,W=d("".split),H=F(function(){return!G("z").propertyIsEnumerable(0)})?function(e){return"String"===B(e)?W(e,""):G(e)}:G,K=function(e){return null==e},z=K,q=TypeError,Y=function(e){if(z(e))throw new q("Can't call method on "+e);return e},X=H,J=Y,Q=function(e){return X(J(e))},Z=C,$=function(e){return"object"==typeof e?null!==e:Z(e)},ee={},te=ee,ne=p,ie=C,se=function(e){return ie(e)?e:void 0},re=function(e,t){return arguments.length<2?se(te[e])||se(ne[e]):te[e]&&te[e][t]||ne[e]&&ne[e][t]},ae=p.navigator,oe=ae&&ae.userAgent,ce=oe?String(oe):"",le=p,de=ce,ue=le.process,he=le.Deno,pe=ue&&ue.versions||he&&he.version,me=pe&&pe.v8;me&&(U=(M=me.split("."))[0]>0&&M[0]<4?1:+(M[0]+M[1])),!U&&de&&(!(M=de.match(/Edge\/(\d+)/))||M[1]>=74)&&(M=de.match(/Chrome\/(\d+)/))&&(U=+M[1]);var fe=U,ge=fe,_e=s,ye=p.String,ve=!!Object.getOwnPropertySymbols&&!_e(function(){var e=Symbol("symbol detection");return!ye(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ge&&ge<41}),Ee=ve&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,be=re,Se=C,xe=u,Te=Object,we=Ee?function(e){return"symbol"==typeof e}:function(e){var t=be("Symbol");return Se(t)&&xe(t.prototype,Te(e))},Ne=String,Ce=function(e){try{return Ne(e)}catch(e){return"Object"}},Re=C,Ie=Ce,Ae=TypeError,Oe=function(e){if(Re(e))return e;throw new Ae(Ie(e)+" is not a function")},De=Oe,ke=K,Pe=function(e,t){var n=e[t];return ke(n)?void 0:De(n)},Le=D,je=C,Me=$,Ue=TypeError,Ve={exports:{}},Fe=p,Be=Object.defineProperty,Ge=p,We=function(e,t){try{Be(Fe,e,{value:t,configurable:!0,writable:!0})}catch(i){Fe[e]=t}return t},He="__core-js_shared__",Ke=Ve.exports=Ge[He]||We(He,{});(Ke.versions||(Ke.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ze=Ve.exports,qe=ze,Ye=function(e,t){return qe[e]||(qe[e]=t||{})},Xe=Y,Je=Object,Qe=function(e){return Je(Xe(e))},Ze=Qe,$e=d({}.hasOwnProperty),et=Object.hasOwn||function(e,t){return $e(Ze(e),t)},tt=d,nt=0,it=Math.random(),st=tt(1..toString),rt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+st(++nt+it,36)},at=Ye,ot=et,ct=rt,lt=ve,dt=Ee,ut=p.Symbol,ht=at("wks"),pt=dt?ut.for||ut:ut&&ut.withoutSetter||ct,mt=function(e){return ot(ht,e)||(ht[e]=lt&&ot(ut,e)?ut[e]:pt("Symbol."+e)),ht[e]},ft=D,gt=$,_t=we,yt=Pe,vt=function(e,t){var n,i;if("string"===t&&je(n=e.toString)&&!Me(i=Le(n,e)))return i;if(je(n=e.valueOf)&&!Me(i=Le(n,e)))return i;if("string"!==t&&je(n=e.toString)&&!Me(i=Le(n,e)))return i;throw new Ue("Can't convert object to primitive value")},Et=TypeError,bt=mt("toPrimitive"),St=function(e,t){if(!gt(e)||_t(e))return e;var n,i=yt(e,bt);if(i){if(void 0===t&&(t="default"),n=ft(i,e,t),!gt(n)||_t(n))return n;throw new Et("Can't convert object to primitive value")}return void 0===t&&(t="number"),vt(e,t)},xt=we,Tt=function(e){var t=St(e,"string");return xt(t)?t:t+""},wt=$,Nt=p.document,Ct=wt(Nt)&&wt(Nt.createElement),Rt=function(e){return Ct?Nt.createElement(e):{}},It=Rt,At=!I&&!s(function(){return 7!==Object.defineProperty(It("div"),"a",{get:function(){return 7}}).a}),Ot=I,Dt=D,kt=k,Pt=V,Lt=Q,jt=Tt,Mt=et,Ut=At,Vt=Object.getOwnPropertyDescriptor;R.f=Ot?Vt:function(e,t){if(e=Lt(e),t=jt(t),Ut)try{return Vt(e,t)}catch(e){}if(Mt(e,t))return Pt(!Dt(kt.f,e,t),e[t])};var Ft=s,Bt=C,Gt=/#|\.prototype\./,Wt=function(e,t){var n=Kt[Ht(e)];return n===qt||n!==zt&&(Bt(t)?Ft(t):!!t)},Ht=Wt.normalize=function(e){return String(e).replace(Gt,".").toLowerCase()},Kt=Wt.data={},zt=Wt.NATIVE="N",qt=Wt.POLYFILL="P",Yt=Wt,Xt=Oe,Jt=r,Qt=w(w.bind),Zt=function(e,t){return Xt(e),void 0===t?e:Jt?Qt(e,t):function(){return e.apply(t,arguments)}},$t={},en=I&&s(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),tn=$,nn=String,sn=TypeError,rn=function(e){if(tn(e))return e;throw new sn(nn(e)+" is not an object")},an=I,on=At,cn=en,ln=rn,dn=Tt,un=TypeError,hn=Object.defineProperty,pn=Object.getOwnPropertyDescriptor,mn="enumerable",fn="configurable",gn="writable";$t.f=an?cn?function(e,t,n){if(ln(e),t=dn(t),ln(n),"function"==typeof e&&"prototype"===t&&"value"in n&&gn in n&&!n[gn]){var i=pn(e,t);i&&i[gn]&&(e[t]=n.value,n={configurable:fn in n?n[fn]:i[fn],enumerable:mn in n?n[mn]:i[mn],writable:!1})}return hn(e,t,n)}:hn:function(e,t,n){if(ln(e),t=dn(t),ln(n),on)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new un("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var _n=$t,yn=V,vn=I?function(e,t,n){return _n.f(e,t,yn(1,n))}:function(e,t,n){return e[t]=n,e},En=p,bn=y,Sn=w,xn=C,Tn=R.f,wn=Yt,Nn=ee,Cn=Zt,Rn=vn,In=et,An=function(e){var t=function(n,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,s)}return bn(e,this,arguments)};return t.prototype=e.prototype,t},On=function(e,t){var n,i,s,r,a,o,c,l,d,u=e.target,h=e.global,p=e.stat,m=e.proto,f=h?En:p?En[u]:En[u]&&En[u].prototype,g=h?Nn:Nn[u]||Rn(Nn,u,{})[u],_=g.prototype;for(r in t)i=!(n=wn(h?r:u+(p?".":"#")+r,e.forced))&&f&&In(f,r),o=g[r],i&&(c=e.dontCallGetSet?(d=Tn(f,r))&&d.value:f[r]),a=i&&c?c:t[r],(n||m||typeof o!=typeof a)&&(l=e.bind&&i?Cn(a,En):e.wrap&&i?An(a):m&&xn(a)?Sn(a):a,(e.sham||a&&a.sham||o&&o.sham)&&Rn(l,"sham",!0),Rn(g,r,l),m&&(In(Nn,s=u+"Prototype")||Rn(Nn,s,{}),Rn(Nn[s],r,a),e.real&&_&&(n||!_[r])&&Rn(_,r,a)))},Dn=Math.ceil,kn=Math.floor,Pn=Math.trunc||function(e){var t=+e;return(t>0?kn:Dn)(t)},Ln=Pn,jn=function(e){var t=+e;return t!=t||0===t?0:Ln(t)},Mn=jn,Un=Math.max,Vn=Math.min,Fn=function(e,t){var n=Mn(e);return n<0?Un(n+t,0):Vn(n,t)},Bn=jn,Gn=Math.min,Wn=function(e){var t=Bn(e);return t>0?Gn(t,9007199254740991):0},Hn=Wn,Kn=function(e){return Hn(e.length)},zn=Q,qn=Fn,Yn=Kn,Xn=function(e){return function(t,n,i){var s=zn(t),r=Yn(s);if(0===r)return!e&&-1;var a,o=qn(i,r);if(e&&n!=n){for(;r>o;)if((a=s[o++])!=a)return!0}else for(;r>o;o++)if((e||o in s)&&s[o]===n)return e||o||0;return!e&&-1}},Jn={includes:Xn(!0),indexOf:Xn(!1)},Qn=Jn.includes;On({target:"Array",proto:!0,forced:s(function(){return!Array(1).includes()})},{includes:function(e){return Qn(this,e,arguments.length>1?arguments[1]:void 0)}});var Zn=p,$n=ee,ei=function(e,t){var n=$n[e+"Prototype"],i=n&&n[t];if(i)return i;var s=Zn[e],r=s&&s.prototype;return r&&r[t]},ti=ei("Array","includes"),ni=$,ii=S,si=mt("match"),ri=function(e){var t;return ni(e)&&(void 0!==(t=e[si])?!!t:"RegExp"===ii(e))},ai=ri,oi=TypeError,ci={};ci[mt("toStringTag")]="z";var li="[object z]"===String(ci),di=li,ui=C,hi=S,pi=mt("toStringTag"),mi=Object,fi="Arguments"===hi(function(){return arguments}()),gi=di?hi:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=mi(e),pi))?n:fi?hi(t):"Object"===(i=hi(t))&&ui(t.callee)?"Arguments":i},_i=gi,yi=String,vi=function(e){if("Symbol"===_i(e))throw new TypeError("Cannot convert a Symbol value to a string");return yi(e)},Ei=mt("match"),bi=On,Si=function(e){if(ai(e))throw new oi("The method doesn't accept regular expressions");return e},xi=Y,Ti=vi,wi=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[Ei]=!1,"/./"[e](t)}catch(e){}}return!1},Ni=d("".indexOf);bi({target:"String",proto:!0,forced:!wi("includes")},{includes:function(e){return!!~Ni(Ti(xi(this)),Ti(Si(e)),arguments.length>1?arguments[1]:void 0)}});var Ci=ei("String","includes"),Ri=u,Ii=ti,Ai=Ci,Oi=Array.prototype,Di=String.prototype,ki=function(e){var t=e.includes;return e===Oi||Ri(Oi,e)&&t===Oi.includes?Ii:"string"==typeof e||e===Di||Ri(Di,e)&&t===Di.includes?Ai:t},Pi=i(ki),Li=Oe,ji=Qe,Mi=H,Ui=Kn,Vi=TypeError,Fi="Reduce of empty array with no initial value",Bi=function(e){return function(t,n,i,s){var r=ji(t),a=Mi(r),o=Ui(r);if(Li(n),0===o&&i<2)throw new Vi(Fi);var c=e?o-1:0,l=e?-1:1;if(i<2)for(;;){if(c in a){s=a[c],c+=l;break}if(c+=l,e?c<0:o<=c)throw new Vi(Fi)}for(;e?c>=0:o>c;c+=l)c in a&&(s=n(s,a[c],c,r));return s}},Gi={left:Bi(!1),right:Bi(!0)},Wi=s,Hi=function(e,t){var n=[][e];return!!n&&Wi(function(){n.call(null,t||function(){return 1},1)})},Ki=p,zi=ce,qi=S,Yi=function(e){return zi.slice(0,e.length)===e},Xi=Yi("Bun/")?"BUN":Yi("Cloudflare-Workers")?"CLOUDFLARE":Yi("Deno/")?"DENO":Yi("Node.js/")?"NODE":Ki.Bun&&"string"==typeof Bun.version?"BUN":Ki.Deno&&"object"==typeof Deno.version?"DENO":"process"===qi(Ki.process)?"NODE":Ki.window&&Ki.document?"BROWSER":"REST",Ji="NODE"===Xi,Qi=Gi.left;On({target:"Array",proto:!0,forced:!Ji&&fe>79&&fe<83||!Hi("reduce")},{reduce:function(e){var t=arguments.length;return Qi(this,e,t,t>1?arguments[1]:void 0)}});var Zi=ei("Array","reduce"),$i=u,es=Zi,ts=Array.prototype,ns=function(e){var t=e.reduce;return e===ts||$i(ts,e)&&t===ts.reduce?es:t},is=ns,ss=i(is),rs=S,as=Array.isArray||function(e){return"Array"===rs(e)},os=On,cs=as,ls=d([].reverse),ds=[1,2];os({target:"Array",proto:!0,forced:String(ds)===String(ds.reverse())},{reverse:function(){return cs(this)&&(this.length=this.length),ls(this)}});var us=ei("Array","reverse"),hs=u,ps=us,ms=Array.prototype,fs=function(e){var t=e.reverse;return e===ms||hs(ms,e)&&t===ms.reverse?ps:t},gs=fs,_s=i(gs),ys=rt,vs=Ye("keys"),Es=function(e){return vs[e]||(vs[e]=ys(e))},bs=!s(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Ss=et,xs=C,Ts=Qe,ws=bs,Ns=Es("IE_PROTO"),Cs=Object,Rs=Cs.prototype,Is=ws?Cs.getPrototypeOf:function(e){var t=Ts(e);if(Ss(t,Ns))return t[Ns];var n=t.constructor;return xs(n)&&t instanceof n?n.prototype:t instanceof Cs?Rs:null},As=d,Os=Oe,Ds=$,ks=function(e){return Ds(e)||null===e},Ps=String,Ls=TypeError,js=function(e,t,n){try{return As(Os(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Ms=$,Us=Y,Vs=function(e){if(ks(e))return e;throw new Ls("Can't set "+Ps(e)+" as a prototype")},Fs=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=js(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,i){return Us(n),Vs(i),Ms(n)?(t?e(n,i):n.__proto__=i,n):n}}():void 0),Bs={},Gs={},Ws=et,Hs=Q,Ks=Jn.indexOf,zs=Gs,qs=d([].push),Ys=function(e,t){var n,i=Hs(e),s=0,r=[];for(n in i)!Ws(zs,n)&&Ws(i,n)&&qs(r,n);for(;t.length>s;)Ws(i,n=t[s++])&&(~Ks(r,n)||qs(r,n));return r},Xs=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Js=Ys,Qs=Xs.concat("length","prototype");Bs.f=Object.getOwnPropertyNames||function(e){return Js(e,Qs)};var Zs={};Zs.f=Object.getOwnPropertySymbols;var $s=re,er=Bs,tr=Zs,nr=rn,ir=d([].concat),sr=$s("Reflect","ownKeys")||function(e){var t=er.f(nr(e)),n=tr.f;return n?ir(t,n(e)):t},rr=et,ar=sr,or=R,cr=$t,lr={},dr=Ys,ur=Xs,hr=Object.keys||function(e){return dr(e,ur)},pr=I,mr=en,fr=$t,gr=rn,_r=Q,yr=hr;lr.f=pr&&!mr?Object.defineProperties:function(e,t){gr(e);for(var n,i=_r(t),s=yr(t),r=s.length,a=0;r>a;)fr.f(e,n=s[a++],i[n]);return e};var vr,Er=re("document","documentElement"),br=rn,Sr=lr,xr=Xs,Tr=Gs,wr=Er,Nr=Rt,Cr="prototype",Rr="script",Ir=Es("IE_PROTO"),Ar=function(){},Or=function(e){return"<"+Rr+">"+e+"</"+Rr+">"},Dr=function(e){e.write(Or("")),e.close();var t=e.parentWindow.Object;return e=null,t},kr=function(){try{vr=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;kr="undefined"!=typeof document?document.domain&&vr?Dr(vr):(t=Nr("iframe"),n="java"+Rr+":",t.style.display="none",wr.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Or("document.F=Object")),e.close(),e.F):Dr(vr);for(var i=xr.length;i--;)delete kr[Cr][xr[i]];return kr()};Tr[Ir]=!0;var Pr=Object.create||function(e,t){var n;return null!==e?(Ar[Cr]=br(e),n=new Ar,Ar[Cr]=null,n[Ir]=e):n=kr(),void 0===t?n:Sr.f(n,t)},Lr=$,jr=vn,Mr=Error,Ur=d("".replace),Vr=String(new Mr("zxcasd").stack),Fr=/\n\s*at [^:]*:[^\n]*/,Br=Fr.test(Vr),Gr=V,Wr=!s(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Gr(1,7)),7!==e.stack)}),Hr=vn,Kr=function(e,t){if(Br&&"string"==typeof e&&!Mr.prepareStackTrace)for(;t--;)e=Ur(e,Fr,"");return e},zr=Wr,qr=Error.captureStackTrace,Yr={},Xr=Yr,Jr=mt("iterator"),Qr=Array.prototype,Zr=function(e){return void 0!==e&&(Xr.Array===e||Qr[Jr]===e)},$r=gi,ea=Pe,ta=K,na=Yr,ia=mt("iterator"),sa=function(e){if(!ta(e))return ea(e,ia)||ea(e,"@@iterator")||na[$r(e)]},ra=D,aa=Oe,oa=rn,ca=Ce,la=sa,da=TypeError,ua=function(e,t){var n=arguments.length<2?la(e):t;if(aa(n))return oa(ra(n,e));throw new da(ca(e)+" is not iterable")},ha=D,pa=rn,ma=Pe,fa=function(e,t,n){var i,s;pa(e);try{if(!(i=ma(e,"return"))){if("throw"===t)throw n;return n}i=ha(i,e)}catch(e){s=!0,i=e}if("throw"===t)throw n;if(s)throw i;return pa(i),n},ga=Zt,_a=D,ya=rn,va=Ce,Ea=Zr,ba=Kn,Sa=u,xa=ua,Ta=sa,wa=fa,Na=TypeError,Ca=function(e,t){this.stopped=e,this.result=t},Ra=Ca.prototype,Ia=function(e,t,n){var i,s,r,a,o,c,l,d=n&&n.that,u=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),m=!(!n||!n.INTERRUPTED),f=ga(t,d),g=function(e){return i&&wa(i,"normal",e),new Ca(!0,e)},_=function(e){return u?(ya(e),m?f(e[0],e[1],g):f(e[0],e[1])):m?f(e,g):f(e)};if(h)i=e.iterator;else if(p)i=e;else{if(!(s=Ta(e)))throw new Na(va(e)+" is not iterable");if(Ea(s)){for(r=0,a=ba(e);a>r;r++)if((o=_(e[r]))&&Sa(Ra,o))return o;return new Ca(!1)}i=xa(e,s)}for(c=h?e.next:i.next;!(l=_a(c,i)).done;){try{o=_(l.value)}catch(e){wa(i,"throw",e)}if("object"==typeof o&&o&&Sa(Ra,o))return o}return new Ca(!1)},Aa=vi,Oa=On,Da=u,ka=Is,Pa=Fs,La=function(e,t,n){for(var i=ar(t),s=cr.f,r=or.f,a=0;a<i.length;a++){var o=i[a];rr(e,o)||n&&rr(n,o)||s(e,o,r(t,o))}},ja=Pr,Ma=vn,Ua=V,Va=function(e,t){Lr(t)&&"cause"in t&&jr(e,"cause",t.cause)},Fa=function(e,t,n,i){zr&&(qr?qr(e,t):Hr(e,"stack",Kr(n,i)))},Ba=Ia,Ga=function(e,t){return void 0===e?arguments.length<2?"":t:Aa(e)},Wa=mt("toStringTag"),Ha=Error,Ka=[].push,za=function(e,t){var n,i=Da(qa,this);Pa?n=Pa(new Ha,i?ka(this):qa):(n=i?this:ja(qa),Ma(n,Wa,"Error")),void 0!==t&&Ma(n,"message",Ga(t)),Fa(n,za,n.stack,1),arguments.length>2&&Va(n,arguments[2]);var s=[];return Ba(e,Ka,{that:s}),Ma(n,"errors",s),n};Pa?Pa(za,Ha):La(za,Ha,{name:!0});var qa=za.prototype=ja(Ha.prototype,{constructor:Ua(1,za),message:Ua(1,""),name:Ua(1,"AggregateError")});Oa({global:!0,constructor:!0,arity:2},{AggregateError:za});var Ya,Xa,Ja,Qa=C,Za=p.WeakMap,$a=Qa(Za)&&/native code/.test(String(Za)),eo=p,to=$,no=vn,io=et,so=ze,ro=Es,ao=Gs,oo="Object already initialized",co=eo.TypeError,lo=eo.WeakMap;if($a||so.state){var uo=so.state||(so.state=new lo);uo.get=uo.get,uo.has=uo.has,uo.set=uo.set,Ya=function(e,t){if(uo.has(e))throw new co(oo);return t.facade=e,uo.set(e,t),t},Xa=function(e){return uo.get(e)||{}},Ja=function(e){return uo.has(e)}}else{var ho=ro("state");ao[ho]=!0,Ya=function(e,t){if(io(e,ho))throw new co(oo);return t.facade=e,no(e,ho,t),t},Xa=function(e){return io(e,ho)?e[ho]:{}},Ja=function(e){return io(e,ho)}}var po,mo,fo,go={set:Ya,get:Xa,has:Ja,enforce:function(e){return Ja(e)?Xa(e):Ya(e,{})},getterFor:function(e){return function(t){var n;if(!to(t)||(n=Xa(t)).type!==e)throw new co("Incompatible receiver, "+e+" required");return n}}},_o=I,yo=et,vo=Function.prototype,Eo=_o&&Object.getOwnPropertyDescriptor,bo=yo(vo,"name"),So={EXISTS:bo,PROPER:bo&&"something"===function(){}.name,CONFIGURABLE:bo&&(!_o||_o&&Eo(vo,"name").configurable)},xo=vn,To=function(e,t,n,i){return i&&i.enumerable?e[t]=n:xo(e,t,n),e},wo=s,No=C,Co=$,Ro=Pr,Io=Is,Ao=To,Oo=mt("iterator"),Do=!1;[].keys&&("next"in(fo=[].keys())?(mo=Io(Io(fo)))!==Object.prototype&&(po=mo):Do=!0);var ko=!Co(po)||wo(function(){var e={};return po[Oo].call(e)!==e});No((po=ko?{}:Ro(po))[Oo])||Ao(po,Oo,function(){return this});var Po={IteratorPrototype:po,BUGGY_SAFARI_ITERATORS:Do},Lo=gi,jo=li?{}.toString:function(){return"[object "+Lo(this)+"]"},Mo=li,Uo=$t.f,Vo=vn,Fo=et,Bo=jo,Go=mt("toStringTag"),Wo=function(e,t,n,i){var s=n?e:e&&e.prototype;s&&(Fo(s,Go)||Uo(s,Go,{configurable:!0,value:t}),i&&!Mo&&Vo(s,"toString",Bo))},Ho=Po.IteratorPrototype,Ko=Pr,zo=V,qo=Wo,Yo=Yr,Xo=function(){return this},Jo=function(e,t,n,i){var s=t+" Iterator";return e.prototype=Ko(Ho,{next:zo(+!i,n)}),qo(e,s,!1,!0),Yo[s]=Xo,e},Qo=On,Zo=D,$o=Jo,ec=Is,tc=Wo,nc=To,ic=Yr,sc=Po,rc=So.PROPER,ac=sc.BUGGY_SAFARI_ITERATORS,oc=mt("iterator"),cc="keys",lc="values",dc="entries",uc=function(){return this},hc=function(e,t,n,i,s,r,a){$o(n,t,i);var o,c,l,d=function(e){if(e===s&&f)return f;if(!ac&&e&&e in p)return p[e];switch(e){case cc:case lc:case dc:return function(){return new n(this,e)}}return function(){return new n(this)}},u=t+" Iterator",h=!1,p=e.prototype,m=p[oc]||p["@@iterator"]||s&&p[s],f=!ac&&m||d(s),g="Array"===t&&p.entries||m;if(g&&(o=ec(g.call(new e)))!==Object.prototype&&o.next&&(tc(o,u,!0,!0),ic[u]=uc),rc&&s===lc&&m&&m.name!==lc&&(h=!0,f=function(){return Zo(m,this)}),s)if(c={values:d(lc),keys:r?f:d(cc),entries:d(dc)},a)for(l in c)(ac||h||!(l in p))&&nc(p,l,c[l]);else Qo({target:t,proto:!0,forced:ac||h},c);return a&&p[oc]!==f&&nc(p,oc,f,{name:s}),ic[t]=f,c},pc=function(e,t){return{value:e,done:t}},mc=Q,fc=Yr,gc=go;$t.f;var _c=hc,yc=pc,vc="Array Iterator",Ec=gc.set,bc=gc.getterFor(vc);_c(Array,"Array",function(e,t){Ec(this,{type:vc,target:mc(e),index:0,kind:t})},function(){var e=bc(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,yc(void 0,!0);switch(e.kind){case"keys":return yc(n,!1);case"values":return yc(t[n],!1)}return yc([n,t[n]],!1)},"values"),fc.Arguments=fc.Array;var Sc=$t,xc=function(e,t,n){return Sc.f(e,t,n)},Tc=re,wc=xc,Nc=I,Cc=mt("species"),Rc=u,Ic=TypeError,Ac=function(e,t){if(Rc(t,e))return e;throw new Ic("Incorrect invocation")},Oc=C,Dc=ze,kc=d(Function.toString);Oc(Dc.inspectSource)||(Dc.inspectSource=function(e){return kc(e)});var Pc=Dc.inspectSource,Lc=d,jc=s,Mc=C,Uc=gi,Vc=Pc,Fc=function(){},Bc=re("Reflect","construct"),Gc=/^\s*(?:class|function)\b/,Wc=Lc(Gc.exec),Hc=!Gc.test(Fc),Kc=function(e){if(!Mc(e))return!1;try{return Bc(Fc,[],e),!0}catch(e){return!1}},zc=function(e){if(!Mc(e))return!1;switch(Uc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Hc||!!Wc(Gc,Vc(e))}catch(e){return!0}};zc.sham=!0;var qc,Yc,Xc,Jc,Qc=!Bc||jc(function(){var e;return Kc(Kc.call)||!Kc(Object)||!Kc(function(){e=!0})||e})?zc:Kc,Zc=Qc,$c=Ce,el=TypeError,tl=rn,nl=function(e){if(Zc(e))return e;throw new el($c(e)+" is not a constructor")},il=K,sl=mt("species"),rl=function(e,t){var n,i=tl(e).constructor;return void 0===i||il(n=tl(i)[sl])?t:nl(n)},al=d([].slice),ol=TypeError,cl=function(e,t){if(e<t)throw new ol("Not enough arguments");return e},ll=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),dl=p,ul=y,hl=Zt,pl=C,ml=et,fl=s,gl=Er,_l=al,yl=Rt,vl=cl,El=ll,bl=Ji,Sl=dl.setImmediate,xl=dl.clearImmediate,Tl=dl.process,wl=dl.Dispatch,Nl=dl.Function,Cl=dl.MessageChannel,Rl=dl.String,Il=0,Al={},Ol="onreadystatechange";fl(function(){qc=dl.location});var Dl=function(e){if(ml(Al,e)){var t=Al[e];delete Al[e],t()}},kl=function(e){return function(){Dl(e)}},Pl=function(e){Dl(e.data)},Ll=function(e){dl.postMessage(Rl(e),qc.protocol+"//"+qc.host)};Sl&&xl||(Sl=function(e){vl(arguments.length,1);var t=pl(e)?e:Nl(e),n=_l(arguments,1);return Al[++Il]=function(){ul(t,void 0,n)},Yc(Il),Il},xl=function(e){delete Al[e]},bl?Yc=function(e){Tl.nextTick(kl(e))}:wl&&wl.now?Yc=function(e){wl.now(kl(e))}:Cl&&!El?(Jc=(Xc=new Cl).port2,Xc.port1.onmessage=Pl,Yc=hl(Jc.postMessage,Jc)):dl.addEventListener&&pl(dl.postMessage)&&!dl.importScripts&&qc&&"file:"!==qc.protocol&&!fl(Ll)?(Yc=Ll,dl.addEventListener("message",Pl,!1)):Yc=Ol in yl("script")?function(e){gl.appendChild(yl("script"))[Ol]=function(){gl.removeChild(this),Dl(e)}}:function(e){setTimeout(kl(e),0)});var jl={set:Sl,clear:xl},Ml=p,Ul=I,Vl=Object.getOwnPropertyDescriptor,Fl=function(e){if(!Ul)return Ml[e];var t=Vl(Ml,e);return t&&t.value},Bl=function(){this.head=null,this.tail=null};Bl.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Gl,Wl,Hl,Kl,zl,ql=Bl,Yl=/ipad|iphone|ipod/i.test(ce)&&"undefined"!=typeof Pebble,Xl=/web0s(?!.*chrome)/i.test(ce),Jl=p,Ql=Fl,Zl=Zt,$l=jl.set,ed=ql,td=ll,nd=Yl,id=Xl,sd=Ji,rd=Jl.MutationObserver||Jl.WebKitMutationObserver,ad=Jl.document,od=Jl.process,cd=Jl.Promise,ld=Ql("queueMicrotask");if(!ld){var dd=new ed,ud=function(){var e,t;for(sd&&(e=od.domain)&&e.exit();t=dd.get();)try{t()}catch(e){throw dd.head&&Gl(),e}e&&e.enter()};td||sd||id||!rd||!ad?!nd&&cd&&cd.resolve?((Kl=cd.resolve(void 0)).constructor=cd,zl=Zl(Kl.then,Kl),Gl=function(){zl(ud)}):sd?Gl=function(){od.nextTick(ud)}:($l=Zl($l,Jl),Gl=function(){$l(ud)}):(Wl=!0,Hl=ad.createTextNode(""),new rd(ud).observe(Hl,{characterData:!0}),Gl=function(){Hl.data=Wl=!Wl}),ld=function(e){dd.head||Gl(),dd.add(e)}}var hd=ld,pd=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},md=p.Promise,fd=p,gd=md,_d=C,yd=Yt,vd=Pc,Ed=mt,bd=Xi,Sd=fe,xd=gd&&gd.prototype,Td=Ed("species"),wd=!1,Nd=_d(fd.PromiseRejectionEvent),Cd=yd("Promise",function(){var e=vd(gd),t=e!==String(gd);if(!t&&66===Sd)return!0;if(!xd.catch||!xd.finally)return!0;if(!Sd||Sd<51||!/native code/.test(e)){var n=new gd(function(e){e(1)}),i=function(e){e(function(){},function(){})};if((n.constructor={})[Td]=i,!(wd=n.then(function(){})instanceof i))return!0}return!(t||"BROWSER"!==bd&&"DENO"!==bd||Nd)}),Rd={CONSTRUCTOR:Cd,REJECTION_EVENT:Nd,SUBCLASSING:wd},Id={},Ad=Oe,Od=TypeError,Dd=function(e){var t,n;this.promise=new e(function(e,i){if(void 0!==t||void 0!==n)throw new Od("Bad Promise constructor");t=e,n=i}),this.resolve=Ad(t),this.reject=Ad(n)};Id.f=function(e){return new Dd(e)};var kd,Pd,Ld=On,jd=Ji,Md=p,Ud=D,Vd=To,Fd=Wo,Bd=function(e){var t=Tc(e);Nc&&t&&!t[Cc]&&wc(t,Cc,{configurable:!0,get:function(){return this}})},Gd=Oe,Wd=C,Hd=$,Kd=Ac,zd=rl,qd=jl.set,Yd=hd,Xd=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}},Jd=pd,Qd=ql,Zd=go,$d=md,eu=Rd,tu=Id,nu="Promise",iu=eu.CONSTRUCTOR,su=eu.REJECTION_EVENT,ru=Zd.getterFor(nu),au=Zd.set,ou=$d&&$d.prototype,cu=$d,lu=ou,du=Md.TypeError,uu=Md.document,hu=Md.process,pu=tu.f,mu=pu,fu=!!(uu&&uu.createEvent&&Md.dispatchEvent),gu="unhandledrejection",_u=function(e){var t;return!(!Hd(e)||!Wd(t=e.then))&&t},yu=function(e,t){var n,i,s,r=t.value,a=1===t.state,o=a?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{o?(a||(2===t.rejection&&xu(t),t.rejection=1),!0===o?n=r:(d&&d.enter(),n=o(r),d&&(d.exit(),s=!0)),n===e.promise?l(new du("Promise-chain cycle")):(i=_u(n))?Ud(i,n,c,l):c(n)):l(r)}catch(e){d&&!s&&d.exit(),l(e)}},vu=function(e,t){e.notified||(e.notified=!0,Yd(function(){for(var n,i=e.reactions;n=i.get();)yu(n,e);e.notified=!1,t&&!e.rejection&&bu(e)}))},Eu=function(e,t,n){var i,s;fu?((i=uu.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Md.dispatchEvent(i)):i={promise:t,reason:n},!su&&(s=Md["on"+e])?s(i):e===gu&&Xd("Unhandled promise rejection",n)},bu=function(e){Ud(qd,Md,function(){var t,n=e.facade,i=e.value;if(Su(e)&&(t=Jd(function(){jd?hu.emit("unhandledRejection",i,n):Eu(gu,n,i)}),e.rejection=jd||Su(e)?2:1,t.error))throw t.value})},Su=function(e){return 1!==e.rejection&&!e.parent},xu=function(e){Ud(qd,Md,function(){var t=e.facade;jd?hu.emit("rejectionHandled",t):Eu("rejectionhandled",t,e.value)})},Tu=function(e,t,n){return function(i){e(t,i,n)}},wu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,vu(e,!0))},Nu=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new du("Promise can't be resolved itself");var i=_u(t);i?Yd(function(){var n={done:!1};try{Ud(i,t,Tu(Nu,n,e),Tu(wu,n,e))}catch(t){wu(n,t,e)}}):(e.value=t,e.state=1,vu(e,!1))}catch(t){wu({done:!1},t,e)}}};iu&&(lu=(cu=function(e){Kd(this,lu),Gd(e),Ud(kd,this);var t=ru(this);try{e(Tu(Nu,t),Tu(wu,t))}catch(e){wu(t,e)}}).prototype,(kd=function(e){au(this,{type:nu,done:!1,notified:!1,parent:!1,reactions:new Qd,rejection:!1,state:0,value:null})}).prototype=Vd(lu,"then",function(e,t){var n=ru(this),i=pu(zd(this,cu));return n.parent=!0,i.ok=!Wd(e)||e,i.fail=Wd(t)&&t,i.domain=jd?hu.domain:void 0,0===n.state?n.reactions.add(i):Yd(function(){yu(i,n)}),i.promise}),Pd=function(){var e=new kd,t=ru(e);this.promise=e,this.resolve=Tu(Nu,t),this.reject=Tu(wu,t)},tu.f=pu=function(e){return e===cu||void 0===e?new Pd(e):mu(e)}),Ld({global:!0,constructor:!0,wrap:!0,forced:iu},{Promise:cu}),Fd(cu,nu,!1,!0),Bd(nu);var Cu=mt("iterator"),Ru=!1;try{var Iu=0,Au={next:function(){return{done:!!Iu++}},return:function(){Ru=!0}};Au[Cu]=function(){return this},Array.from(Au,function(){throw 2})}catch(e){}var Ou=md,Du=function(e,t){try{if(!t&&!Ru)return!1}catch(e){return!1}var n=!1;try{var i={};i[Cu]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(e){}return n},ku=Rd.CONSTRUCTOR||!Du(function(e){Ou.all(e).then(void 0,function(){})}),Pu=D,Lu=Oe,ju=Id,Mu=pd,Uu=Ia;On({target:"Promise",stat:!0,forced:ku},{all:function(e){var t=this,n=ju.f(t),i=n.resolve,s=n.reject,r=Mu(function(){var n=Lu(t.resolve),r=[],a=0,o=1;Uu(e,function(e){var c=a++,l=!1;o++,Pu(n,t,e).then(function(e){l||(l=!0,r[c]=e,--o||i(r))},s)}),--o||i(r)});return r.error&&s(r.value),n.promise}});var Vu=On,Fu=Rd.CONSTRUCTOR;md&&md.prototype,Vu({target:"Promise",proto:!0,forced:Fu,real:!0},{catch:function(e){return this.then(void 0,e)}});var Bu=D,Gu=Oe,Wu=Id,Hu=pd,Ku=Ia;On({target:"Promise",stat:!0,forced:ku},{race:function(e){var t=this,n=Wu.f(t),i=n.reject,s=Hu(function(){var s=Gu(t.resolve);Ku(e,function(e){Bu(s,t,e).then(n.resolve,i)})});return s.error&&i(s.value),n.promise}});var zu=Id;On({target:"Promise",stat:!0,forced:Rd.CONSTRUCTOR},{reject:function(e){var t=zu.f(this);return(0,t.reject)(e),t.promise}});var qu=rn,Yu=$,Xu=Id,Ju=function(e,t){if(qu(e),Yu(t)&&t.constructor===e)return t;var n=Xu.f(e);return(0,n.resolve)(t),n.promise},Qu=On,Zu=md,$u=Rd.CONSTRUCTOR,eh=Ju,th=re("Promise"),nh=!$u;Qu({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return eh(nh&&this===th?Zu:this,e)}});var ih=D,sh=Oe,rh=Id,ah=pd,oh=Ia;On({target:"Promise",stat:!0,forced:ku},{allSettled:function(e){var t=this,n=rh.f(t),i=n.resolve,s=n.reject,r=ah(function(){var n=sh(t.resolve),s=[],r=0,a=1;oh(e,function(e){var o=r++,c=!1;a++,ih(n,t,e).then(function(e){c||(c=!0,s[o]={status:"fulfilled",value:e},--a||i(s))},function(e){c||(c=!0,s[o]={status:"rejected",reason:e},--a||i(s))})}),--a||i(s)});return r.error&&s(r.value),n.promise}});var ch=D,lh=Oe,dh=re,uh=Id,hh=pd,ph=Ia,mh="No one promise resolved";On({target:"Promise",stat:!0,forced:ku},{any:function(e){var t=this,n=dh("AggregateError"),i=uh.f(t),s=i.resolve,r=i.reject,a=hh(function(){var i=lh(t.resolve),a=[],o=0,c=1,l=!1;ph(e,function(e){var d=o++,u=!1;c++,ch(i,t,e).then(function(e){u||l||(l=!0,s(e))},function(e){u||l||(u=!0,a[d]=e,--c||r(new n(a,mh)))})}),--c||r(new n(a,mh))});return a.error&&r(a.value),i.promise}});var fh=On,gh=y,_h=al,yh=Id,vh=Oe,Eh=pd,bh=p.Promise,Sh=!1;fh({target:"Promise",stat:!0,forced:!bh||!bh.try||Eh(function(){bh.try(function(e){Sh=8===e},8)}).error||!Sh},{try:function(e){var t=arguments.length>1?_h(arguments,1):[],n=yh.f(this),i=Eh(function(){return gh(vh(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var xh=Id;On({target:"Promise",stat:!0},{withResolvers:function(){var e=xh.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Th=On,wh=md,Nh=s,Ch=re,Rh=C,Ih=rl,Ah=Ju,Oh=wh&&wh.prototype;Th({target:"Promise",proto:!0,real:!0,forced:!!wh&&Nh(function(){Oh.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=Ih(this,Ch("Promise")),n=Rh(e);return this.then(n?function(n){return Ah(t,e()).then(function(){return n})}:e,n?function(n){return Ah(t,e()).then(function(){throw n})}:e)}});var Dh=d,kh=jn,Ph=vi,Lh=Y,jh=Dh("".charAt),Mh=Dh("".charCodeAt),Uh=Dh("".slice),Vh=function(e){return function(t,n){var i,s,r=Ph(Lh(t)),a=kh(n),o=r.length;return a<0||a>=o?e?"":void 0:(i=Mh(r,a))<55296||i>56319||a+1===o||(s=Mh(r,a+1))<56320||s>57343?e?jh(r,a):i:e?Uh(r,a,a+2):s-56320+(i-55296<<10)+65536}},Fh={codeAt:Vh(!1),charAt:Vh(!0)},Bh=Fh.charAt,Gh=vi,Wh=go,Hh=hc,Kh=pc,zh="String Iterator",qh=Wh.set,Yh=Wh.getterFor(zh);Hh(String,"String",function(e){qh(this,{type:zh,string:Gh(e),index:0})},function(){var e,t=Yh(this),n=t.string,i=t.index;return i>=n.length?Kh(void 0,!0):(e=Bh(n,i),t.index+=e.length,Kh(e,!1))});var Xh=ee.Promise,Jh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Qh=p,Zh=Wo,$h=Yr;for(var ep in Jh)Zh(Qh[ep],ep),$h[ep]=$h.Array;var tp=Xh,np=i(tp),ip=ei("Array","values"),sp=gi,rp=et,ap=u,op=ip,cp=Array.prototype,lp={DOMTokenList:!0,NodeList:!0},dp=function(e){var t=e.values;return e===cp||ap(cp,e)&&t===cp.values||rp(lp,sp(e))?op:t},up=i(dp),hp=Ce,pp=TypeError,mp=al,fp=Math.floor,gp=function(e,t){var n=e.length;if(n<8)for(var i,s,r=1;r<n;){for(s=r,i=e[r];s&&t(e[s-1],i)>0;)e[s]=e[--s];s!==r++&&(e[s]=i)}else for(var a=fp(n/2),o=gp(mp(e,0,a),t),c=gp(mp(e,a),t),l=o.length,d=c.length,u=0,h=0;u<l||h<d;)e[u+h]=u<l&&h<d?t(o[u],c[h])<=0?o[u++]:c[h++]:u<l?o[u++]:c[h++];return e},_p=gp,yp=ce.match(/firefox\/(\d+)/i),vp=!!yp&&+yp[1],Ep=/MSIE|Trident/.test(ce),bp=ce.match(/AppleWebKit\/(\d+)\./),Sp=!!bp&&+bp[1],xp=On,Tp=d,wp=Oe,Np=Qe,Cp=Kn,Rp=function(e,t){if(!delete e[t])throw new pp("Cannot delete property "+hp(t)+" of "+hp(e))},Ip=vi,Ap=s,Op=_p,Dp=Hi,kp=vp,Pp=Ep,Lp=fe,jp=Sp,Mp=[],Up=Tp(Mp.sort),Vp=Tp(Mp.push),Fp=Ap(function(){Mp.sort(void 0)}),Bp=Ap(function(){Mp.sort(null)}),Gp=Dp("sort"),Wp=!Ap(function(){if(Lp)return Lp<70;if(!(kp&&kp>3)){if(Pp)return!0;if(jp)return jp<603;var e,t,n,i,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Mp.push({k:t+i,v:n})}for(Mp.sort(function(e,t){return t.v-e.v}),i=0;i<Mp.length;i++)t=Mp[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return"DGBEFHACIJK"!==s}});xp({target:"Array",proto:!0,forced:Fp||!Bp||!Gp||!Wp},{sort:function(e){void 0!==e&&wp(e);var t=Np(this);if(Wp)return void 0===e?Up(t):Up(t,e);var n,i,s=[],r=Cp(t);for(i=0;i<r;i++)i in t&&Vp(s,t[i]);for(Op(s,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Ip(t)>Ip(n)?1:-1}}(e)),n=Cp(s),i=0;i<n;)t[i]=s[i++];for(;i<r;)Rp(t,i++);return t}});var Hp=ei("Array","sort"),Kp=u,zp=Hp,qp=Array.prototype,Yp=function(e){var t=e.sort;return e===qp||Kp(qp,e)&&t===qp.sort?zp:t},Xp=i(Yp),Jp=On,Qp=d,Zp=Fn,$p=RangeError,em=String.fromCharCode,tm=String.fromCodePoint,nm=Qp([].join);Jp({target:"String",stat:!0,arity:1,forced:!!tm&&1!==tm.length},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,s=0;i>s;){if(t=+arguments[s++],Zp(t,1114111)!==t)throw new $p(t+" is not a valid code point");n[s]=t<65536?em(t):em(55296+((t-=65536)>>10),t%1024+56320)}return nm(n,"")}});var im=s,sm=mt("iterator"),rm=!im(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(e,n){t.delete("b"),i+=n+e}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[sm]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("https://a#\u0431").hash||"a1c3"!==i||"x"!==new URL("https://x",void 0).host}),am=To,om=On,cm=p,lm=Fl,dm=re,um=D,hm=d,pm=I,mm=rm,fm=To,gm=xc,_m=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:am(e,i,t[i],n);return e},ym=Wo,vm=Jo,Em=go,bm=Ac,Sm=C,xm=et,Tm=Zt,wm=gi,Nm=rn,Cm=$,Rm=vi,Im=Pr,Am=V,Om=ua,Dm=sa,km=pc,Pm=cl,Lm=_p,jm=mt("iterator"),Mm="URLSearchParams",Um=Mm+"Iterator",Vm=Em.set,Fm=Em.getterFor(Mm),Bm=Em.getterFor(Um),Gm=lm("fetch"),Wm=lm("Request"),Hm=lm("Headers"),Km=Wm&&Wm.prototype,zm=Hm&&Hm.prototype,qm=cm.TypeError,Ym=cm.encodeURIComponent,Xm=String.fromCharCode,Jm=dm("String","fromCodePoint"),Qm=parseInt,Zm=hm("".charAt),$m=hm([].join),ef=hm([].push),tf=hm("".replace),nf=hm([].shift),sf=hm([].splice),rf=hm("".split),af=hm("".slice),of=hm(/./.exec),cf=/\+/g,lf=/^[0-9a-f]+$/i,df=function(e,t){var n=af(e,t,t+2);return of(lf,n)?Qm(n,16):NaN},uf=function(e){for(var t=0,n=128;n>0&&0!=(e&n);n>>=1)t++;return t},hf=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},pf=function(e){for(var t=(e=tf(e,cf," ")).length,n="",i=0;i<t;){var s=Zm(e,i);if("%"===s){if("%"===Zm(e,i+1)||i+3>t){n+="%",i++;continue}var r=df(e,i+1);if(r!=r){n+=s,i++;continue}i+=2;var a=uf(r);if(0===a)s=Xm(r);else{if(1===a||a>4){n+="\ufffd",i++;continue}for(var o=[r],c=1;c<a&&!(3+ ++i>t||"%"!==Zm(e,i));){var l=df(e,i+1);if(l!=l){i+=3;break}if(l>191||l<128)break;ef(o,l),i+=2,c++}if(o.length!==a){n+="\ufffd";continue}var d=hf(o);null===d?n+="\ufffd":s=Jm(d)}}n+=s,i++}return n},mf=/[!'()~]|%20/g,ff={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},gf=function(e){return ff[e]},_f=function(e){return tf(Ym(e),mf,gf)},yf=vm(function(e,t){Vm(this,{type:Um,target:Fm(e).entries,index:0,kind:t})},Mm,function(){var e=Bm(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,km(void 0,!0);var i=t[n];switch(e.kind){case"keys":return km(i.key,!1);case"values":return km(i.value,!1)}return km([i.key,i.value],!1)},!0),vf=function(e){this.entries=[],this.url=null,void 0!==e&&(Cm(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Zm(e,0)?af(e,1):e:Rm(e)))};vf.prototype={type:Mm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,s,r,a,o,c=this.entries,l=Dm(e);if(l)for(n=(t=Om(e,l)).next;!(i=um(n,t)).done;){if(r=(s=Om(Nm(i.value))).next,(a=um(r,s)).done||(o=um(r,s)).done||!um(r,s).done)throw new qm("Expected sequence with length 2");ef(c,{key:Rm(a.value),value:Rm(o.value)})}else for(var d in e)xm(e,d)&&ef(c,{key:d,value:Rm(e[d])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,s=rf(e,"&"),r=0;r<s.length;)(t=s[r++]).length&&(n=rf(t,"="),ef(i,{key:pf(nf(n)),value:pf($m(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],ef(n,_f(e.key)+"="+_f(e.value));return $m(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ef=function(){bm(this,bf);var e=Vm(this,new vf(arguments.length>0?arguments[0]:void 0));pm||(this.size=e.entries.length)},bf=Ef.prototype;if(_m(bf,{append:function(e,t){var n=Fm(this);Pm(arguments.length,2),ef(n.entries,{key:Rm(e),value:Rm(t)}),pm||this.length++,n.updateURL()},delete:function(e){for(var t=Fm(this),n=Pm(arguments.length,1),i=t.entries,s=Rm(e),r=n<2?void 0:arguments[1],a=void 0===r?r:Rm(r),o=0;o<i.length;){var c=i[o];if(c.key!==s||void 0!==a&&c.value!==a)o++;else if(sf(i,o,1),void 0!==a)break}pm||(this.size=i.length),t.updateURL()},get:function(e){var t=Fm(this).entries;Pm(arguments.length,1);for(var n=Rm(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=Fm(this).entries;Pm(arguments.length,1);for(var n=Rm(e),i=[],s=0;s<t.length;s++)t[s].key===n&&ef(i,t[s].value);return i},has:function(e){for(var t=Fm(this).entries,n=Pm(arguments.length,1),i=Rm(e),s=n<2?void 0:arguments[1],r=void 0===s?s:Rm(s),a=0;a<t.length;){var o=t[a++];if(o.key===i&&(void 0===r||o.value===r))return!0}return!1},set:function(e,t){var n=Fm(this);Pm(arguments.length,1);for(var i,s=n.entries,r=!1,a=Rm(e),o=Rm(t),c=0;c<s.length;c++)(i=s[c]).key===a&&(r?sf(s,c--,1):(r=!0,i.value=o));r||ef(s,{key:a,value:o}),pm||(this.size=s.length),n.updateURL()},sort:function(){var e=Fm(this);Lm(e.entries,function(e,t){return e.key>t.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Fm(this).entries,i=Tm(e,arguments.length>1?arguments[1]:void 0),s=0;s<n.length;)i((t=n[s++]).value,t.key,this)},keys:function(){return new yf(this,"keys")},values:function(){return new yf(this,"values")},entries:function(){return new yf(this,"entries")}},{enumerable:!0}),fm(bf,jm,bf.entries,{name:"entries"}),fm(bf,"toString",function(){return Fm(this).serialize()},{enumerable:!0}),pm&&gm(bf,"size",{get:function(){return Fm(this).entries.length},configurable:!0,enumerable:!0}),ym(Ef,Mm),om({global:!0,constructor:!0,forced:!mm},{URLSearchParams:Ef}),!mm&&Sm(Hm)){var Sf=hm(zm.has),xf=hm(zm.set),Tf=function(e){if(Cm(e)){var t,n=e.body;if(wm(n)===Mm)return t=e.headers?new Hm(e.headers):new Hm,Sf(t,"content-type")||xf(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Im(e,{body:Am(0,Rm(n)),headers:Am(0,t)})}return e};if(Sm(Gm)&&om({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Gm(e,arguments.length>1?Tf(arguments[1]):{})}}),Sm(Wm)){var wf=function(e){return bm(this,Km),new Wm(e,arguments.length>1?Tf(arguments[1]):{})};Km.constructor=wf,wf.prototype=Km,om({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:wf})}}var Nf,Cf={URLSearchParams:Ef,getState:Fm},Rf=ee.URLSearchParams,If=I,Af=d,Of=D,Df=s,kf=hr,Pf=Zs,Lf=k,jf=Qe,Mf=H,Uf=Object.assign,Vf=Object.defineProperty,Ff=Af([].concat),Bf=!Uf||Df(function(){if(If&&1!==Uf({b:1},Uf(Vf({},"a",{enumerable:!0,get:function(){Vf(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(e){t[e]=e}),7!==Uf({},e)[n]||kf(Uf({},t)).join("")!==i})?function(e,t){for(var n=jf(e),i=arguments.length,s=1,r=Pf.f,a=Lf.f;i>s;)for(var o,c=Mf(arguments[s++]),l=r?Ff(kf(c),r(c)):kf(c),d=l.length,u=0;d>u;)o=l[u++],If&&!Of(a,c,o)||(n[o]=c[o]);return n}:Uf,Gf=rn,Wf=fa,Hf=I,Kf=$t,zf=V,qf=function(e,t,n){Hf?Kf.f(e,t,zf(0,n)):e[t]=n},Yf=Zt,Xf=D,Jf=Qe,Qf=function(e,t,n,i){try{return i?t(Gf(n)[0],n[1]):t(n)}catch(t){Wf(e,"throw",t)}},Zf=Zr,$f=Qc,eg=Kn,tg=qf,ng=ua,ig=sa,sg=Array,rg=d,ag=2147483647,og=/[^\0-\u007E]/,cg=/[.\u3002\uFF0E\uFF61]/g,lg="Overflow: input needs wider integers to process",dg=RangeError,ug=rg(cg.exec),hg=Math.floor,pg=String.fromCharCode,mg=rg("".charCodeAt),fg=rg([].join),gg=rg([].push),_g=rg("".replace),yg=rg("".split),vg=rg("".toLowerCase),Eg=function(e){return e+22+75*(e<26)},bg=function(e,t,n){var i=0;for(e=n?hg(e/700):e>>1,e+=hg(e/t);e>455;)e=hg(e/35),i+=36;return hg(i+36*e/(e+38))},Sg=function(e){var t=[];e=function(e){for(var t=[],n=0,i=e.length;n<i;){var s=mg(e,n++);if(s>=55296&&s<=56319&&n<i){var r=mg(e,n++);56320==(64512&r)?gg(t,((1023&s)<<10)+(1023&r)+65536):(gg(t,s),n--)}else gg(t,s)}return t}(e);var n,i,s=e.length,r=128,a=0,o=72;for(n=0;n<e.length;n++)(i=e[n])<128&&gg(t,pg(i));var c=t.length,l=c;for(c&&gg(t,"-");l<s;){var d=ag;for(n=0;n<e.length;n++)(i=e[n])>=r&&i<d&&(d=i);var u=l+1;if(d-r>hg((ag-a)/u))throw new dg(lg);for(a+=(d-r)*u,r=d,n=0;n<e.length;n++){if((i=e[n])<r&&++a>ag)throw new dg(lg);if(i===r){for(var h=a,p=36;;){var m=p<=o?1:p>=o+26?26:p-o;if(h<m)break;var f=h-m,g=36-m;gg(t,pg(Eg(m+f%g))),h=hg(f/g),p+=36}gg(t,pg(Eg(h))),o=bg(a,u,l===c),a=0,l++}}a++,r++}return fg(t,"")},xg=On,Tg=I,wg=rm,Ng=p,Cg=Zt,Rg=d,Ig=To,Ag=xc,Og=Ac,Dg=et,kg=Bf,Pg=function(e){var t=Jf(e),n=$f(this),i=arguments.length,s=i>1?arguments[1]:void 0,r=void 0!==s;r&&(s=Yf(s,i>2?arguments[2]:void 0));var a,o,c,l,d,u,h=ig(t),p=0;if(!h||this===sg&&Zf(h))for(a=eg(t),o=n?new this(a):sg(a);a>p;p++)u=r?s(t[p],p):t[p],tg(o,p,u);else for(o=n?new this:[],d=(l=ng(t,h)).next;!(c=Xf(d,l)).done;p++)u=r?Qf(l,s,[c.value,p],!0):c.value,tg(o,p,u);return o.length=p,o},Lg=al,jg=Fh.codeAt,Mg=function(e){var t,n,i=[],s=yg(_g(vg(e),cg,"."),".");for(t=0;t<s.length;t++)n=s[t],gg(i,ug(og,n)?"xn--"+Sg(n):n);return fg(i,".")},Ug=vi,Vg=Wo,Fg=cl,Bg=Cf,Gg=go,Wg=Gg.set,Hg=Gg.getterFor("URL"),Kg=Bg.URLSearchParams,zg=Bg.getState,qg=Ng.URL,Yg=Ng.TypeError,Xg=Ng.parseInt,Jg=Math.floor,Qg=Math.pow,Zg=Rg("".charAt),$g=Rg(/./.exec),e_=Rg([].join),t_=Rg(1..toString),n_=Rg([].pop),i_=Rg([].push),s_=Rg("".replace),r_=Rg([].shift),a_=Rg("".split),o_=Rg("".slice),c_=Rg("".toLowerCase),l_=Rg([].unshift),d_="Invalid scheme",u_="Invalid host",h_="Invalid port",p_=/[a-z]/i,m_=/[\d+-.a-z]/i,f_=/\d/,g_=/^0x/i,__=/^[0-7]+$/,y_=/^\d+$/,v_=/^[\da-f]+$/i,E_=/[\0\t\n\r #%/:<>?@[\\\]^|]/,b_=/[\0\t\n\r #/:<>?@[\\\]^|]/,S_=/^[\u0000-\u0020]+/,x_=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,T_=/[\t\n\r]/g,w_=function(e){var t,n,i,s;if("number"==typeof e){for(t=[],n=0;n<4;n++)l_(t,e%256),e=Jg(e/256);return e_(t,".")}if("object"==typeof e){for(t="",i=function(e){for(var t=null,n=1,i=null,s=0,r=0;r<8;r++)0!==e[r]?(s>n&&(t=i,n=s),i=null,s=0):(null===i&&(i=r),++s);return s>n?i:t}(e),n=0;n<8;n++)s&&0===e[n]||(s&&(s=!1),i===n?(t+=n?":":"::",s=!0):(t+=t_(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},N_={},C_=kg({},N_,{" ":1,'"':1,"<":1,">":1,"`":1}),R_=kg({},C_,{"#":1,"?":1,"{":1,"}":1}),I_=kg({},R_,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),A_=function(e,t){var n=jg(e,0);return n>32&&n<127&&!Dg(t,e)?e:encodeURIComponent(e)},O_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},D_=function(e,t){var n;return 2===e.length&&$g(p_,Zg(e,0))&&(":"===(n=Zg(e,1))||!t&&"|"===n)},k_=function(e){var t;return e.length>1&&D_(o_(e,0,2))&&(2===e.length||"/"===(t=Zg(e,2))||"\\"===t||"?"===t||"#"===t)},P_=function(e){return"."===e||"%2e"===c_(e)},L_={},j_={},M_={},U_={},V_={},F_={},B_={},G_={},W_={},H_={},K_={},z_={},q_={},Y_={},X_={},J_={},Q_={},Z_={},$_={},ey={},ty={},ny=function(e,t,n){var i,s,r,a=Ug(e);if(t){if(s=this.parse(a))throw new Yg(s);this.searchParams=null}else{if(void 0!==n&&(i=new ny(n,!0)),s=this.parse(a,null,i))throw new Yg(s);(r=zg(new Kg)).bindURL(this),this.searchParams=r}};ny.prototype={type:"URL",parse:function(e,t,n){var i,s,r,a,o,c=this,l=t||L_,d=0,u="",h=!1,p=!1,m=!1;for(e=Ug(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=s_(e,S_,""),e=s_(e,x_,"$1")),e=s_(e,T_,""),i=Pg(e);d<=i.length;){switch(s=i[d],l){case L_:if(!s||!$g(p_,s)){if(t)return d_;l=M_;continue}u+=c_(s),l=j_;break;case j_:if(s&&($g(m_,s)||"+"===s||"-"===s||"."===s))u+=c_(s);else{if(":"!==s){if(t)return d_;u="",l=M_,d=0;continue}if(t&&(c.isSpecial()!==Dg(O_,u)||"file"===u&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&O_[c.scheme]===c.port&&(c.port=null));u="","file"===c.scheme?l=Y_:c.isSpecial()&&n&&n.scheme===c.scheme?l=U_:c.isSpecial()?l=G_:"/"===i[d+1]?(l=V_,d++):(c.cannotBeABaseURL=!0,i_(c.path,""),l=$_)}break;case M_:if(!n||n.cannotBeABaseURL&&"#"!==s)return d_;if(n.cannotBeABaseURL&&"#"===s){c.scheme=n.scheme,c.path=Lg(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=ty;break}l="file"===n.scheme?Y_:F_;continue;case U_:if("/"!==s||"/"!==i[d+1]){l=F_;continue}l=W_,d++;break;case V_:if("/"===s){l=H_;break}l=Z_;continue;case F_:if(c.scheme=n.scheme,s===Nf)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.query=n.query;else if("/"===s||"\\"===s&&c.isSpecial())l=B_;else if("?"===s)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.query="",l=ey;else{if("#"!==s){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.path.length--,l=Z_;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Lg(n.path),c.query=n.query,c.fragment="",l=ty}break;case B_:if(!c.isSpecial()||"/"!==s&&"\\"!==s){if("/"!==s){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=Z_;continue}l=H_}else l=W_;break;case G_:if(l=W_,"/"!==s||"/"!==Zg(u,d+1))continue;d++;break;case W_:if("/"!==s&&"\\"!==s){l=H_;continue}break;case H_:if("@"===s){h&&(u="%40"+u),h=!0,r=Pg(u);for(var f=0;f<r.length;f++){var g=r[f];if(":"!==g||m){var _=A_(g,I_);m?c.password+=_:c.username+=_}else m=!0}u=""}else if(s===Nf||"/"===s||"?"===s||"#"===s||"\\"===s&&c.isSpecial()){if(h&&""===u)return"Invalid authority";d-=Pg(u).length+1,u="",l=K_}else u+=s;break;case K_:case z_:if(t&&"file"===c.scheme){l=J_;continue}if(":"!==s||p){if(s===Nf||"/"===s||"?"===s||"#"===s||"\\"===s&&c.isSpecial()){if(c.isSpecial()&&""===u)return u_;if(t&&""===u&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(u))return a;if(u="",l=Q_,t)return;continue}"["===s?p=!0:"]"===s&&(p=!1),u+=s}else{if(""===u)return u_;if(a=c.parseHost(u))return a;if(u="",l=q_,t===z_)return}break;case q_:if(!$g(f_,s)){if(s===Nf||"/"===s||"?"===s||"#"===s||"\\"===s&&c.isSpecial()||t){if(""!==u){var y=Xg(u,10);if(y>65535)return h_;c.port=c.isSpecial()&&y===O_[c.scheme]?null:y,u=""}if(t)return;l=Q_;continue}return h_}u+=s;break;case Y_:if(c.scheme="file","/"===s||"\\"===s)l=X_;else{if(!n||"file"!==n.scheme){l=Z_;continue}switch(s){case Nf:c.host=n.host,c.path=Lg(n.path),c.query=n.query;break;case"?":c.host=n.host,c.path=Lg(n.path),c.query="",l=ey;break;case"#":c.host=n.host,c.path=Lg(n.path),c.query=n.query,c.fragment="",l=ty;break;default:k_(e_(Lg(i,d),""))||(c.host=n.host,c.path=Lg(n.path),c.shortenPath()),l=Z_;continue}}break;case X_:if("/"===s||"\\"===s){l=J_;break}n&&"file"===n.scheme&&!k_(e_(Lg(i,d),""))&&(D_(n.path[0],!0)?i_(c.path,n.path[0]):c.host=n.host),l=Z_;continue;case J_:if(s===Nf||"/"===s||"\\"===s||"?"===s||"#"===s){if(!t&&D_(u))l=Z_;else if(""===u){if(c.host="",t)return;l=Q_}else{if(a=c.parseHost(u))return a;if("localhost"===c.host&&(c.host=""),t)return;u="",l=Q_}continue}u+=s;break;case Q_:if(c.isSpecial()){if(l=Z_,"/"!==s&&"\\"!==s)continue}else if(t||"?"!==s)if(t||"#"!==s){if(s!==Nf&&(l=Z_,"/"!==s))continue}else c.fragment="",l=ty;else c.query="",l=ey;break;case Z_:if(s===Nf||"/"===s||"\\"===s&&c.isSpecial()||!t&&("?"===s||"#"===s)){if(".."===(o=c_(o=u))||"%2e."===o||".%2e"===o||"%2e%2e"===o?(c.shortenPath(),"/"===s||"\\"===s&&c.isSpecial()||i_(c.path,"")):P_(u)?"/"===s||"\\"===s&&c.isSpecial()||i_(c.path,""):("file"===c.scheme&&!c.path.length&&D_(u)&&(c.host&&(c.host=""),u=Zg(u,0)+":"),i_(c.path,u)),u="","file"===c.scheme&&(s===Nf||"?"===s||"#"===s))for(;c.path.length>1&&""===c.path[0];)r_(c.path);"?"===s?(c.query="",l=ey):"#"===s&&(c.fragment="",l=ty)}else u+=A_(s,R_);break;case $_:"?"===s?(c.query="",l=ey):"#"===s?(c.fragment="",l=ty):s!==Nf&&(c.path[0]+=A_(s,N_));break;case ey:t||"#"!==s?s!==Nf&&("'"===s&&c.isSpecial()?c.query+="%27":c.query+="#"===s?"%23":A_(s,N_)):(c.fragment="",l=ty);break;case ty:s!==Nf&&(c.fragment+=A_(s,C_))}d++}},parseHost:function(e){var t,n,i;if("["===Zg(e,0)){if("]"!==Zg(e,e.length-1))return u_;if(t=function(e){var t,n,i,s,r,a,o,c=[0,0,0,0,0,0,0,0],l=0,d=null,u=0,h=function(){return Zg(e,u)};if(":"===h()){if(":"!==Zg(e,1))return;u+=2,d=++l}for(;h();){if(8===l)return;if(":"!==h()){for(t=n=0;n<4&&$g(v_,h());)t=16*t+Xg(h(),16),u++,n++;if("."===h()){if(0===n)return;if(u-=n,l>6)return;for(i=0;h();){if(s=null,i>0){if(!("."===h()&&i<4))return;u++}if(!$g(f_,h()))return;for(;$g(f_,h());){if(r=Xg(h(),10),null===s)s=r;else{if(0===s)return;s=10*s+r}if(s>255)return;u++}c[l]=256*c[l]+s,2!=++i&&4!==i||l++}if(4!==i)return;break}if(":"===h()){if(u++,!h())return}else if(h())return;c[l++]=t}else{if(null!==d)return;u++,d=++l}}if(null!==d)for(a=l-d,l=7;0!==l&&a>0;)o=c[l],c[l--]=c[d+a-1],c[d+--a]=o;else if(8!==l)return;return c}(o_(e,1,-1)),!t)return u_;this.host=t}else if(this.isSpecial()){if(e=Mg(e),$g(E_,e))return u_;if(t=function(e){var t,n,i,s,r,a,o,c=a_(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],i=0;i<t;i++){if(""===(s=c[i]))return e;if(r=10,s.length>1&&"0"===Zg(s,0)&&(r=$g(g_,s)?16:8,s=o_(s,8===r?1:2)),""===s)a=0;else{if(!$g(10===r?y_:8===r?__:v_,s))return e;a=Xg(s,r)}i_(n,a)}for(i=0;i<t;i++)if(a=n[i],i===t-1){if(a>=Qg(256,5-t))return null}else if(a>255)return null;for(o=n_(n),i=0;i<n.length;i++)o+=n[i]*Qg(256,3-i);return o}(e),null===t)return u_;this.host=t}else{if($g(b_,e))return u_;for(t="",n=Pg(e),i=0;i<n.length;i++)t+=A_(n[i],N_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return Dg(O_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&D_(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,s=e.host,r=e.port,a=e.path,o=e.query,c=e.fragment,l=t+":";return null!==s?(l+="//",e.includesCredentials()&&(l+=n+(i?":"+i:"")+"@"),l+=w_(s),null!==r&&(l+=":"+r)):"file"===t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+e_(a,"/"):"",null!==o&&(l+="?"+o),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw new Yg(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new iy(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+w_(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ug(e)+":",L_)},getUsername:function(){return this.username},setUsername:function(e){var t=Pg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=A_(t[n],I_)}},getPassword:function(){return this.password},setPassword:function(e){var t=Pg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=A_(t[n],I_)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?w_(e):w_(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,K_)},getHostname:function(){var e=this.host;return null===e?"":w_(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,z_)},getPort:function(){var e=this.port;return null===e?"":Ug(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=Ug(e))?this.port=null:this.parse(e,q_))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+e_(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Q_))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=Ug(e))?this.query=null:("?"===Zg(e,0)&&(e=o_(e,1)),this.query="",this.parse(e,ey)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=Ug(e))?("#"===Zg(e,0)&&(e=o_(e,1)),this.fragment="",this.parse(e,ty)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var iy=function(e){var t=Og(this,sy),n=Fg(arguments.length,1)>1?arguments[1]:void 0,i=Wg(t,new ny(e,!1,n));Tg||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},sy=iy.prototype,ry=function(e,t){return{get:function(){return Hg(this)[e]()},set:t&&function(e){return Hg(this)[t](e)},configurable:!0,enumerable:!0}};if(Tg&&(Ag(sy,"href",ry("serialize","setHref")),Ag(sy,"origin",ry("getOrigin")),Ag(sy,"protocol",ry("getProtocol","setProtocol")),Ag(sy,"username",ry("getUsername","setUsername")),Ag(sy,"password",ry("getPassword","setPassword")),Ag(sy,"host",ry("getHost","setHost")),Ag(sy,"hostname",ry("getHostname","setHostname")),Ag(sy,"port",ry("getPort","setPort")),Ag(sy,"pathname",ry("getPathname","setPathname")),Ag(sy,"search",ry("getSearch","setSearch")),Ag(sy,"searchParams",ry("getSearchParams")),Ag(sy,"hash",ry("getHash","setHash"))),Ig(sy,"toJSON",function(){return Hg(this).serialize()},{enumerable:!0}),Ig(sy,"toString",function(){return Hg(this).serialize()},{enumerable:!0}),qg){var ay=qg.createObjectURL,oy=qg.revokeObjectURL;ay&&Ig(iy,"createObjectURL",Cg(ay,qg)),oy&&Ig(iy,"revokeObjectURL",Cg(oy,qg))}Vg(iy,"URL"),xg({global:!0,constructor:!0,forced:!wg,sham:!Tg},{URL:iy});var cy=On,ly=s,dy=cl,uy=vi,hy=rm,py=re("URL"),my=hy&&ly(function(){py.canParse()}),fy=ly(function(){return 1!==py.canParse.length});cy({target:"URL",stat:!0,forced:!my||fy},{canParse:function(e){var t=dy(arguments.length,1),n=uy(e),i=t<2||void 0===arguments[1]?void 0:uy(arguments[1]);try{return!!new py(n,i)}catch(e){return!1}}});var gy=On,_y=cl,yy=vi,vy=rm,Ey=re("URL");gy({target:"URL",stat:!0,forced:!vy},{parse:function(e){var t=_y(arguments.length,1),n=yy(e),i=t<2||void 0===arguments[1]?void 0:yy(arguments[1]);try{return new Ey(n,i)}catch(e){return null}}});var by=i(ee.URL);let Sy=!0,xy=!0;function Ty(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function wy(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return s.apply(this,arguments);const r=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,r),s.apply(this,[e,r])};const r=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(n))return r.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,r.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Ny(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Sy=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Cy(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(xy=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ry(){if("object"==typeof window){if(Sy)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Iy(e,t){xy&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Ay(e){return"[object Object]"===Object.prototype.toString.call(e)}function Oy(e){var t;return Ay(e)?ss(t=Object.keys(e)).call(t,function(t,n){const i=Ay(e[n]),s=i?Oy(e[n]):e[n],r=i&&!Object.keys(s).length;return void 0===s||r?t:Object.assign(t,{[n]:s})},{}):e}function Dy(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?Dy(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(t=>{Dy(e,e.get(t),n)})}))}function ky(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",s=new Map;if(null===t)return s;const r=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&r.push(e)}),r.forEach(t=>{e.forEach(n=>{n.type===i&&n.trackId===t.id&&Dy(e,n,s)})}),s}const Py=Ry;function Ly(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[s("min",n)]=i.ideal,t.optional.push(e),e={},e[s("max",n)]=i.ideal,t.optional.push(e)):(e[s("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",n)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,n)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,s){if(t.version>=61)return s(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let r=e.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});const a=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===r.exact||"environment"===r.ideal?t=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{n=n.filter(e=>"videoinput"===e.kind);let a=n.find(e=>t.some(t=>{var n;return Pi(n=e.label.toLowerCase()).call(n,t)}));return!a&&n.length&&Pi(t).call(t,"back")&&(a=n[n.length-1]),a&&(e.video.deviceId=r.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),Py("chrome: "+JSON.stringify(e)),s(e)})}e.video=i(e.video)}return Py("chrome: "+JSON.stringify(e)),s(e)},r=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){s(e,e=>{n.webkitGetUserMedia(e,t,e=>{i&&i(r(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return s(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>np.reject(r(e))))}}}function jy(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function My(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const s=new Event("track");s.track=n.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)}),t.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wy(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Uy(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let s=n.apply(this,arguments);return s||(s=t(this,e),this._senders.push(s)),s};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vy(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const s=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},r=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const i=function(e){n(r(s(e)))};return t.apply(this,[i,e])}return new np((e,n)=>{t.apply(this,[function(t){e(r(s(t)))},n])}).then(n,i)}}function Fy(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ky(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),wy(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ky(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach(n=>{n.track===e&&(t?i=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?i=!0:n=t),t.track===e)),i||t&&n?np.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():np.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function By(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),s.apply(this,arguments)}}function Gy(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return By(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const s=e.RTCPeerConnection.prototype.removeStream;function r(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],s=e._streams[i.id];n=n.replace(new RegExp(s.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const s=this.getSenders().find(e=>e.track===t);if(s)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),np.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=r(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>r(this,e))}};e.RTCPeerConnection.prototype[t]=i[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],s=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:r(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wy(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]})}function Hy(e,t){wy(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var Ky=Object.freeze({__proto__:null,fixNegotiationNeeded:Hy,shimAddTrackRemoveTrack:Gy,shimAddTrackRemoveTrackWithNative:By,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,r=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:r||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Uy,shimGetStats:Vy,shimGetUserMedia:Ly,shimMediaStream:jy,shimOnTrack:My,shimPeerConnection:Wy,shimSenderReceiverGetStats:Fy});function zy(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){Iy("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function qy(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Yy(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,s,r]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!s)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(s,r)}}function Xy(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):np.resolve(new Map)}}function Jy(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),wy(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Qy(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Iy("removeStream","removeTrack"),this.getSenders().forEach(t=>{var n;t.track&&Pi(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function Zy(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $y(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function ev(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function tv(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function nv(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var iv=Object.freeze({__proto__:null,shimAddTransceiver:$y,shimCreateAnswer:nv,shimCreateOffer:tv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,np.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:ev,shimGetUserMedia:zy,shimOnTrack:qy,shimPeerConnection:Yy,shimRTCDataChannel:Zy,shimReceiverGetStats:Jy,shimRemoveStream:Qy,shimSenderGetStats:Xy});function sv(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Pi(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i&&i.forEach(e=>{var t;this._localStreams?Pi(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{Pi(n).call(n,e.track)&&this.removeTrack(e)})})}}function rv(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Pi(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function av(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[i]);return t?(s.then(e,t),np.resolve()):s},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],s=i.apply(this,[n]);return t?(s.then(e,t),np.resolve()):s};let o=function(e,t,n){const i=s.apply(this,[e]);return n?(i.then(t,n),np.resolve()):i};t.setLocalDescription=o,o=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),np.resolve()):i},t.setRemoteDescription=o,o=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),np.resolve()):i},t.addIceCandidate=o}function ov(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(cv(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function cv(e){return e&&void 0!==e.video?Object.assign({},e,{video:Oy(e.video)}):e}function lv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(Iy("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function dv(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uv(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function hv(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var pv=Object.freeze({__proto__:null,shimAudioContext:hv,shimCallbacksAPI:av,shimConstraints:cv,shimCreateOfferLegacy:uv,shimGetUserMedia:ov,shimLocalStreamsAPI:sv,shimRTCIceServerUrls:lv,shimRemoteStreamsAPI:rv,shimTrackEventTransceiver:dv}),mv="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",fv=Y,gv=vi,_v=mv,yv=d("".replace),vv=RegExp("^["+_v+"]+"),Ev=RegExp("(^|[^"+_v+"])["+_v+"]+$"),bv=function(e){return function(t){var n=gv(fv(t));return 1&e&&(n=yv(n,vv,"")),2&e&&(n=yv(n,Ev,"$1")),n}},Sv={start:bv(1),end:bv(2),trim:bv(3)},xv=So.PROPER,Tv=s,wv=mv,Nv=Sv.trim;On({target:"String",proto:!0,forced:function(e){return Tv(function(){return!!wv[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||xv&&wv[e].name!==e})}("trim")},{trim:function(){return Nv(this)}});var Cv=ei("String","trim"),Rv=u,Iv=Cv,Av=String.prototype,Ov=function(e){var t=e.trim;return"string"==typeof e||e===Av||Rv(Av,e)&&t===Av.trim?Iv:t},Dv=i(Ov),kv={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let s=0;s<i.length;s++)n=i[s].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],s=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let r=3;r<i.length;r++){const s=i[r],a=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){const i=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const s=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{s.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let s=0;return n.codecs.forEach(e=>{e.maxptime>s&&(s=e.maxptime)}),s>0&&(i+="a=maxptime:"+s+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),s=-1!==i.fecMechanisms.indexOf("RED"),r=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),o=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===o&&(c=l[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&c&&(t.rtx={ssrc:c}),n.push(t),s&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:r?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&o&&n.push({ssrc:o});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=d})),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const s=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=0===s.length;const r=t.matchPrefix(e,"a=rtcp-mux");return n.mux=r.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const s=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return s.length>0?(n=s[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const r=t.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substring(12),10),protocol:n.fmt,maxMessageSize:s};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:s}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let s;const r=void 0!==n?n:2;return s=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+s+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(kv);var Pv=kv.exports,Lv=i(Pv),jv=e({__proto__:null,default:Lv},[Pv]);function Mv(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Lv.parseCandidate(e.candidate),s=Object.assign(n,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,wy(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Uv(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||wy(e,"icecandidate",e=>{if(e.candidate){const t=Lv.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Vv(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Lv.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Lv.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},i=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},s=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},r=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const s=Lv.matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?i=parseInt(s[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=i(arguments[0]),t=s(e),n=r(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>a}),this._sctp=o}return a.apply(this,arguments)}}function Fv(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],s=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&s>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},wy(e,"datachannel",e=>(t(e.channel,e.target),e))}function Bv(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Gv(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==Dv(e).call(e)).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Wv(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?np.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),np.resolve())})}function Hv(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var Kv=Object.freeze({__proto__:null,removeExtmapAllowMixed:Gv,shimAddIceCandidateNullOrEmpty:Wv,shimConnectionState:Bv,shimMaxMessageSize:Vv,shimParameterlessSetLocalDescription:Hv,shimRTCIceCandidate:Mv,shimRTCIceCandidateRelayProtocol:Uv,shimSendThrowTypeError:Fv});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Ry,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Ty(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Ty(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Ty(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),s={browserDetails:i,commonShim:Kv,extractVersion:Ty,disableLog:Ny,disableWarnings:Cy,sdp:jv};switch(i.browser){case"chrome":if(!Ky||!Wy||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=Ky,Wv(e,i),Hv(e),Ly(e,i),jy(e),Wy(e,i),My(e),Gy(e,i),Uy(e),Vy(e),Fy(e),Hy(e,i),Mv(e),Uv(e),Bv(e),Vv(e,i),Fv(e),Gv(e,i);break;case"firefox":if(!iv||!Yy||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=iv,Wv(e,i),Hv(e),zy(e,i),Yy(e,i),qy(e),Qy(e),Xy(e),Jy(e),Zy(e),$y(e),ev(e),tv(e),nv(e),Mv(e),Bv(e),Vv(e,i),Fv(e);break;case"safari":if(!pv||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=pv,Wv(e,i),Hv(e),lv(e),uv(e),av(e),sv(e),rv(e),dv(e),ov(e),hv(e),Mv(e),Uv(e),Vv(e,i),Fv(e),Gv(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var zv=p;On({global:!0,forced:zv.globalThis!==zv},{globalThis:zv});var qv=i(p),Yv={exports:{}};!function(e,n){!function(t,i){var s="function",r="undefined",a="object",o="string",c="major",l="model",d="name",u="type",h="vendor",p="version",m="architecture",f="console",g="mobile",_="tablet",y="smarttv",v="wearable",E="embedded",b="Amazon",S="Apple",x="ASUS",T="BlackBerry",w="Browser",N="Chrome",C="Firefox",R="Google",I="Huawei",A="LG",O="Microsoft",D="Motorola",k="Opera",P="Samsung",L="Sharp",j="Sony",M="Xiaomi",U="Zebra",V="Facebook",F="Chromium OS",B="Mac OS",G=" Browser",W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},H=function(e,t){return typeof e===o&&-1!==K(t).indexOf(K(e))},K=function(e){return e.toLowerCase()},z=function(e,t){if(typeof e===o)return e=e.replace(/^\s\s*/,""),typeof t===r?e:e.substring(0,500)},q=function(e,t){for(var n,r,o,c,l,d,u=0;u<t.length&&!l;){var h=t[u],p=t[u+1];for(n=r=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(e))for(o=0;o<p.length;o++)d=l[++r],typeof(c=p[o])===a&&c.length>0?2===c.length?typeof c[1]==s?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==s||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):i:this[c[0]]=d?c[1].call(this,d,c[2]):i:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):i):this[c]=d||i;u+=2}},Y=function(e,t){for(var n in t)if(typeof t[n]===a&&t[n].length>0){for(var s=0;s<t[n].length;s++)if(H(t[n][s],e))return"?"===n?i:n}else if(H(t[n],e))return"?"===n?i:n;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,p],[/opios[\/ ]+([\w\.]+)/i],[p,[d,k+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[d,k+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[d,k]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[p,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[d,"UC"+w]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[d,"Smart Lenovo "+w]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+w],p],[/\bfocus\/([\w\.]+)/i],[p,[d,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[d,k+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[d,k+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI"+G]],[/fxios\/([\w\.-]+)/i],[p,[d,C]],[/\bqihoobrowser\/?([\w\.]*)/i],[p,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+G],p],[/samsungbrowser\/([\w\.]+)/i],[p,[d,P+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[p,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,p],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[p,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,V],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[d,N+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,N+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[d,"Android "+w]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[p,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],p],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[d,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,K]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",K]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,K]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,P],[u,_]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,P],[u,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[h,S],[u,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,S],[u,_]],[/(macintosh);/i],[l,[h,S]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,L],[u,g]],[/(?:honor)([-\w ]+)[;\)]/i],[l,[h,"Honor"],[u,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,I],[u,_]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,I],[u,g]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,g]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[u,g]],[/\b(opd2\d{3}a?) bui/i],[l,[h,"OPPO"],[u,_]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[u,g]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[u,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,D],[u,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,D],[u,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,A],[u,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,A],[u,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[u,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[u,g]],[/(pixel c)\b/i],[l,[h,R],[u,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,R],[u,g]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,j],[u,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,j],[u,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[u,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,b],[u,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,b],[u,g]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[u,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,T],[u,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,x],[u,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,x],[u,g]],[/(nexus 9)/i],[l,[h,"HTC"],[u,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[u,g]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[l,[h,"TCL"],[u,_]],[/(itel) ((\w+))/i],[[h,K],l,[u,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[u,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[u,g]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[h,"Ulefone"],[u,g]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[h,"Energizer"],[u,g]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[h,"Cat"],[u,g]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[h,"Smartfren"],[u,g]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[h,"Nothing"],[u,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[u,g]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[u,_]],[/(surface duo)/i],[l,[h,O],[u,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[u,g]],[/(u304aa)/i],[l,[h,"AT&T"],[u,g]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[u,g]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[u,_]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[u,_]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[u,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[u,_]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[u,_]],[/\b(k88) b/i],[l,[h,"ZTE"],[u,_]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[u,g]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[u,g]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[u,_]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[u,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[u,_]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[u,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[u,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[u,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[u,g]],[/\b(ph-1) /i],[l,[h,"Essential"],[u,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[u,_]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[u,_]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[u,_]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[u,_]],[/(sprint) (\w+)/i],[h,l,[u,g]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,O],[u,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,U],[u,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,U],[u,g]],[/smart-tv.+(samsung)/i],[h,[u,y]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,P],[u,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,A],[u,y]],[/(apple) ?tv/i],[h,[l,S+" TV"],[u,y]],[/crkey/i],[[l,N+"cast"],[h,R],[u,y]],[/droid.+aft(\w+)( bui|\))/i],[l,[h,b],[u,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,L],[u,y]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,j],[u,y]],[/(mitv-\w{5}) bui/i],[l,[h,M],[u,y]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[u,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,z],[l,z],[u,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[u,f]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[u,f]],[/(playstation [345portablevi]+)/i],[l,[h,j],[u,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,O],[u,f]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[l,[h,P],[u,v]],[/((pebble))app/i],[h,l,[u,v]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,S],[u,v]],[/droid.+; (glass) \d/i],[l,[h,R],[u,v]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,U],[u,v]],[/droid.+; (glass) \d/i],[l,[h,R],[u,v]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,l,[u,v]],[/; (quest( \d| pro)?)/i],[l,[h,V],[u,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[u,E]],[/(aeobc)\b/i],[l,[h,b],[u,E]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[l,[u,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[u,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,g]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,p],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[p,Y,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,Y,X],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,p],[/\(bb(10);/i],[p,[d,T]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[d,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[d,N+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,F],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,p],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,p]]},Q=function(e,n){if(typeof e===a&&(n=e,e=i),!(this instanceof Q))return new Q(e,n).getResult();var f=typeof t!==r&&t.navigator?t.navigator:i,y=e||(f&&f.userAgent?f.userAgent:""),v=f&&f.userAgentData?f.userAgentData:i,E=n?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(J,n):J,b=f&&f.userAgent==y;return this.getBrowser=function(){var e={};return e[d]=i,e[p]=i,q.call(e,y,E.browser),e[c]=function(e){return typeof e===o?e.replace(/[^\d\.]/g,"").split(".")[0]:i}(e[p]),b&&f&&f.brave&&typeof f.brave.isBrave==s&&(e[d]="Brave"),e},this.getCPU=function(){var e={};return e[m]=i,q.call(e,y,E.cpu),e},this.getDevice=function(){var e={};return e[h]=i,e[l]=i,e[u]=i,q.call(e,y,E.device),b&&!e[u]&&v&&v.mobile&&(e[u]=g),b&&"Macintosh"==e[l]&&f&&typeof f.standalone!==r&&f.maxTouchPoints&&f.maxTouchPoints>2&&(e[l]="iPad",e[u]=_),e},this.getEngine=function(){var e={};return e[d]=i,e[p]=i,q.call(e,y,E.engine),e},this.getOS=function(){var e={};return e[d]=i,e[p]=i,q.call(e,y,E.os),b&&!e[d]&&v&&v.platform&&"Unknown"!=v.platform&&(e[d]=v.platform.replace(/chrome os/i,F).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return y},this.setUA=function(e){return y=typeof e===o&&e.length>500?z(e,500):e,this},this.setUA(y),this};Q.VERSION="0.7.40",Q.BROWSER=W([d,p,c]),Q.CPU=W([m]),Q.DEVICE=W([l,h,u,f,g,y,_,v,E]),Q.ENGINE=Q.OS=W([d,p]),e.exports&&(n=e.exports=Q),n.UAParser=Q;var Z=typeof t!==r&&(t.jQuery||t.Zepto);if(Z&&!Z.ua){var $=new Q;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==typeof window?window:t)}(Yv,Yv.exports);var Xv=i(Yv.exports),Jv=jl.clear;On({global:!0,bind:!0,enumerable:!0,forced:p.clearImmediate!==Jv},{clearImmediate:Jv});var Qv=p,Zv=y,$v=C,eE=Xi,tE=ce,nE=al,iE=cl,sE=Qv.Function,rE=/MSIE .\./.test(tE)||"BUN"===eE&&function(){var e=Qv.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}(),aE=On,oE=p,cE=jl.set,lE=function(e,t){var n=t?2:1;return rE?function(i,s){var r=iE(arguments.length,1)>n,a=$v(i)?i:sE(i),o=r?nE(arguments,n):[],c=r?function(){Zv(a,this,o)}:a;return t?e(c,s):e(c)}:e},dE=oE.setImmediate?lE(cE,!1):cE;aE({global:!0,bind:!0,enumerable:!0,forced:oE.setImmediate!==dE},{setImmediate:dE});var uE=i(ee.setImmediate),hE=p,pE=hd,mE=Oe,fE=cl,gE=I;On({global:!0,enumerable:!0,dontCallGetSet:!0,forced:s(function(){return gE&&1!==Object.getOwnPropertyDescriptor(hE,"queueMicrotask").value.length})},{queueMicrotask:function(e){fE(arguments.length,1),pE(mE(e))}});var _E=i(ee.queueMicrotask);function yE(e,t){return function(){return e.apply(t,arguments)}}const{toString:vE}=Object.prototype,{getPrototypeOf:EE}=Object,{iterator:bE,toStringTag:SE}=Symbol,xE=(TE=Object.create(null),e=>{const t=vE.call(e);return TE[t]||(TE[t]=t.slice(8,-1).toLowerCase())});var TE;const wE=e=>(e=e.toLowerCase(),t=>xE(t)===e),NE=e=>t=>typeof t===e,{isArray:CE}=Array,RE=NE("undefined"),IE=wE("ArrayBuffer"),AE=NE("string"),OE=NE("function"),DE=NE("number"),kE=e=>null!==e&&"object"==typeof e,PE=e=>{if("object"!==xE(e))return!1;const t=EE(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||SE in e||bE in e)},LE=wE("Date"),jE=wE("File"),ME=wE("Blob"),UE=wE("FileList"),VE=wE("URLSearchParams"),[FE,BE,GE,WE]=["ReadableStream","Request","Response","Headers"].map(wE);function HE(e,t){let n,i,{allOwnKeys:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),CE(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=s?Object.getOwnPropertyNames(e):Object.keys(e),r=i.length;let a;for(n=0;n<r;n++)a=i[n],t.call(null,e[a],a,e)}}function KE(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,s=n.length;for(;s-- >0;)if(i=n[s],t===i.toLowerCase())return i;return null}const zE=void 0!==qv?qv:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,qE=e=>!RE(e)&&e!==zE,YE=(XE="undefined"!=typeof Uint8Array&&EE(Uint8Array),e=>XE&&e instanceof XE);var XE;const JE=wE("HTMLFormElement"),QE=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),ZE=wE("RegExp"),$E=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};HE(n,(n,s)=>{let r;!1!==(r=t(n,s,e))&&(i[s]=r||n)}),Object.defineProperties(e,i)},eb=wE("AsyncFunction"),tb=(nb="function"==typeof uE,ib=OE(zE.postMessage),nb?uE:ib?(sb="axios@".concat(Math.random()),rb=[],zE.addEventListener("message",e=>{let{source:t,data:n}=e;t===zE&&n===sb&&rb.length&&rb.shift()()},!1),e=>{rb.push(e),zE.postMessage(sb,"*")}):e=>setTimeout(e));var nb,ib,sb,rb;const ab=void 0!==_E?_E.bind(zE):"undefined"!=typeof process&&process.nextTick||tb;var ob={isArray:CE,isArrayBuffer:IE,isBuffer:function(e){return null!==e&&!RE(e)&&null!==e.constructor&&!RE(e.constructor)&&OE(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||OE(e.append)&&("formdata"===(t=xE(e))||"object"===t&&OE(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&IE(e.buffer),t},isString:AE,isNumber:DE,isBoolean:e=>!0===e||!1===e,isObject:kE,isPlainObject:PE,isReadableStream:FE,isRequest:BE,isResponse:GE,isHeaders:WE,isUndefined:RE,isDate:LE,isFile:jE,isBlob:ME,isRegExp:ZE,isFunction:OE,isStream:e=>kE(e)&&OE(e.pipe),isURLSearchParams:VE,isTypedArray:YE,isFileList:UE,forEach:HE,merge:function e(){const{caseless:t}=qE(this)&&this||{},n={},i=(i,s)=>{const r=t&&KE(n,s)||s;PE(n[r])&&PE(i)?n[r]=e(n[r],i):PE(i)?n[r]=e({},i):CE(i)?n[r]=i.slice():n[r]=i};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&HE(arguments[s],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return HE(t,(t,i)=>{n&&OE(t)?e[i]=yE(t,n):e[i]=t},{allOwnKeys:i}),e},trim:e=>Dv(e)?Dv(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let s,r,a;const o={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),r=s.length;r-- >0;)a=s[r],i&&!i(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==n&&EE(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:xE,kindOfTest:wE,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return-1!==i&&i===n},toArray:e=>{if(!e)return null;if(CE(e))return e;let t=e.length;if(!DE(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[bE]).call(e);let i;for(;(i=n.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const i=[];for(;null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:JE,hasOwnProperty:QE,hasOwnProp:QE,reduceDescriptors:$E,freezeMethods:e=>{$E(e,(t,n)=>{if(OE(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const i=e[n];OE(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=e=>{e.forEach(e=>{n[e]=!0})};return CE(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:KE,global:zE,isContextDefined:qE,isSpecCompliantForm:function(e){return!!(e&&OE(e.append)&&"FormData"===e[SE]&&e[bE])},toJSONObject:e=>{const t=new Array(10),n=(e,i)=>{if(kE(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[i]=e;const s=CE(e)?[]:{};return HE(e,(e,t)=>{const r=n(e,i+1);!RE(r)&&(s[t]=r)}),t[i]=void 0,s}}return e};return n(e,0)},isAsyncFn:eb,isThenable:e=>e&&(kE(e)||OE(e))&&OE(e.then)&&OE(e.catch),setImmediate:tb,asap:ab,isIterable:e=>null!=e&&OE(e[bE])};function cb(e,t,n,i,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),s&&(this.response=s,this.status=s.status?s.status:null)}ob.inherits(cb,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ob.toJSONObject(this.config),code:this.code,status:this.status}}});const lb=cb.prototype,db={};function ub(e){return ob.isPlainObject(e)||ob.isArray(e)}function hb(e){return ob.endsWith(e,"[]")?e.slice(0,-2):e}function pb(e,t,n){return e?e.concat(t).map(function(e,t){return e=hb(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{db[e]={value:e}}),Object.defineProperties(cb,db),Object.defineProperty(lb,"isAxiosError",{value:!0}),cb.from=(e,t,n,i,s,r)=>{const a=Object.create(lb);return ob.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),cb.call(a,e.message,t,n,i,s),a.cause=e,a.name=e.name,r&&Object.assign(a,r),a};const mb=ob.toFlatObject(ob,{},null,function(e){return/^is[A-Z]/.test(e)});function fb(e,t,n){if(!ob.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=ob.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!ob.isUndefined(t[e])})).metaTokens,s=n.visitor||l,r=n.dots,a=n.indexes,o=(n.Blob||"undefined"!=typeof Blob&&Blob)&&ob.isSpecCompliantForm(t);if(!ob.isFunction(s))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(ob.isDate(e))return e.toISOString();if(!o&&ob.isBlob(e))throw new cb("Blob is not supported. Use a Buffer instead.");return ob.isArrayBuffer(e)||ob.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,s){let o=e;if(e&&!s&&"object"==typeof e)if(ob.endsWith(n,"{}"))n=i?n:n.slice(0,-2),e=JSON.stringify(e);else if(ob.isArray(e)&&function(e){return ob.isArray(e)&&!e.some(ub)}(e)||(ob.isFileList(e)||ob.endsWith(n,"[]"))&&(o=ob.toArray(e)))return n=hb(n),o.forEach(function(e,i){!ob.isUndefined(e)&&null!==e&&t.append(!0===a?pb([n],i,r):null===a?n:n+"[]",c(e))}),!1;return!!ub(e)||(t.append(pb(s,n,r),c(e)),!1)}const d=[],u=Object.assign(mb,{defaultVisitor:l,convertValue:c,isVisitable:ub});if(!ob.isObject(e))throw new TypeError("data must be an object");return function e(n,i){if(!ob.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+i.join("."));d.push(n),ob.forEach(n,function(n,r){!0===(!(ob.isUndefined(n)||null===n)&&s.call(t,n,ob.isString(r)?Dv(r).call(r):r,i,u))&&e(n,i?i.concat(r):[r])}),d.pop()}}(e),t}function gb(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function _b(e,t){this._pairs=[],e&&fb(e,this,t)}const yb=_b.prototype;function vb(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Eb(e,t,n){if(!t)return e;const i=n&&n.encode||vb;ob.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let r;if(r=s?s(t,n):ob.isURLSearchParams(t)?t.toString():new _b(t,n).toString(i),r){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}yb.append=function(e,t){this._pairs.push([e,t])},yb.toString=function(e){const t=e?function(t){return e.call(this,t,gb)}:gb;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var bb=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ob.forEach(this.handlers,function(t){null!==t&&e(t)})}},Sb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xb={exports:{}},Tb=On,wb=I,Nb=$t.f;Tb({target:"Object",stat:!0,forced:Object.defineProperty!==Nb,sham:!wb},{defineProperty:Nb});var Cb=ee.Object,Rb=xb.exports=function(e,t,n){return Cb.defineProperty(e,t,n)};Cb.defineProperty.sham&&(Rb.sham=!0);var Ib=i(xb.exports),Ab=TypeError,Ob=as,Db=Qc,kb=$,Pb=mt("species"),Lb=Array,jb=function(e){var t;return Ob(e)&&(t=e.constructor,(Db(t)&&(t===Lb||Ob(t.prototype))||kb(t)&&null===(t=t[Pb]))&&(t=void 0)),void 0===t?Lb:t},Mb=function(e,t){return new(jb(e))(0===t?0:t)},Ub=s,Vb=fe,Fb=mt("species"),Bb=function(e){return Vb>=51||!Ub(function(){var t=[];return(t.constructor={})[Fb]=function(){return{foo:1}},1!==t[e](Boolean).foo})},Gb=On,Wb=s,Hb=as,Kb=$,zb=Qe,qb=Kn,Yb=function(e){if(e>9007199254740991)throw Ab("Maximum allowed index exceeded");return e},Xb=qf,Jb=Mb,Qb=Bb,Zb=fe,$b=mt("isConcatSpreadable"),eS=Zb>=51||!Wb(function(){var e=[];return e[$b]=!1,e.concat()[0]!==e}),tS=function(e){if(!Kb(e))return!1;var t=e[$b];return void 0!==t?!!t:Hb(e)};Gb({target:"Array",proto:!0,arity:1,forced:!eS||!Qb("concat")},{concat:function(e){var t,n,i,s,r,a=zb(this),o=Jb(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(tS(r=-1===t?a:arguments[t]))for(s=qb(r),Yb(c+s),n=0;n<s;n++,c++)n in r&&Xb(o,c,r[n]);else Yb(c+1),Xb(o,c++,r);return o.length=c,o}});var nS={},iS=S,sS=Q,rS=Bs.f,aS=al,oS="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];nS.f=function(e){return oS&&"Window"===iS(e)?function(e){try{return rS(e)}catch(e){return aS(oS)}}(e):rS(sS(e))};var cS={},lS=mt;cS.f=lS;var dS=ee,uS=et,hS=cS,pS=$t.f,mS=function(e){var t=dS.Symbol||(dS.Symbol={});uS(t,e)||pS(t,e,{value:hS.f(e)})},fS=D,gS=re,_S=mt,yS=To,vS=function(){var e=gS("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=_S("toPrimitive");t&&!t[i]&&yS(t,i,function(e){return fS(n,this)},{arity:1})},ES=Zt,bS=H,SS=Qe,xS=Kn,TS=Mb,wS=d([].push),NS=function(e){var t=1===e,n=2===e,i=3===e,s=4===e,r=6===e,a=7===e,o=5===e||r;return function(c,l,d,u){for(var h,p,m=SS(c),f=bS(m),g=xS(f),_=ES(l,d),y=0,v=u||TS,E=t?v(c,g):n||a?v(c,0):void 0;g>y;y++)if((o||y in f)&&(p=_(h=f[y],y,m),e))if(t)E[y]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return y;case 2:wS(E,h)}else switch(e){case 4:return!1;case 7:wS(E,h)}return r?-1:i||s?s:E}},CS={forEach:NS(0),map:NS(1),filter:NS(2),some:NS(3),every:NS(4),find:NS(5),findIndex:NS(6),filterReject:NS(7)},RS=On,IS=p,AS=D,OS=d,DS=I,kS=ve,PS=s,LS=et,jS=u,MS=rn,US=Q,VS=Tt,FS=vi,BS=V,GS=Pr,WS=hr,HS=Bs,KS=nS,zS=Zs,qS=R,YS=$t,XS=lr,JS=k,QS=To,ZS=xc,$S=Ye,ex=Gs,tx=rt,nx=mt,ix=cS,sx=mS,rx=vS,ax=Wo,ox=go,cx=CS.forEach,lx=Es("hidden"),dx="Symbol",ux="prototype",hx=ox.set,px=ox.getterFor(dx),mx=Object[ux],fx=IS.Symbol,gx=fx&&fx[ux],_x=IS.RangeError,yx=IS.TypeError,vx=IS.QObject,Ex=qS.f,bx=YS.f,Sx=KS.f,xx=JS.f,Tx=OS([].push),wx=$S("symbols"),Nx=$S("op-symbols"),Cx=$S("wks"),Rx=!vx||!vx[ux]||!vx[ux].findChild,Ix=function(e,t,n){var i=Ex(mx,t);i&&delete mx[t],bx(e,t,n),i&&e!==mx&&bx(mx,t,i)},Ax=DS&&PS(function(){return 7!==GS(bx({},"a",{get:function(){return bx(this,"a",{value:7}).a}})).a})?Ix:bx,Ox=function(e,t){var n=wx[e]=GS(gx);return hx(n,{type:dx,tag:e,description:t}),DS||(n.description=t),n},Dx=function(e,t,n){e===mx&&Dx(Nx,t,n),MS(e);var i=VS(t);return MS(n),LS(wx,i)?(n.enumerable?(LS(e,lx)&&e[lx][i]&&(e[lx][i]=!1),n=GS(n,{enumerable:BS(0,!1)})):(LS(e,lx)||bx(e,lx,BS(1,GS(null))),e[lx][i]=!0),Ax(e,i,n)):bx(e,i,n)},kx=function(e,t){MS(e);var n=US(t),i=WS(n).concat(Mx(n));return cx(i,function(t){DS&&!AS(Px,n,t)||Dx(e,t,n[t])}),e},Px=function(e){var t=VS(e),n=AS(xx,this,t);return!(this===mx&&LS(wx,t)&&!LS(Nx,t))&&(!(n||!LS(this,t)||!LS(wx,t)||LS(this,lx)&&this[lx][t])||n)},Lx=function(e,t){var n=US(e),i=VS(t);if(n!==mx||!LS(wx,i)||LS(Nx,i)){var s=Ex(n,i);return!s||!LS(wx,i)||LS(n,lx)&&n[lx][i]||(s.enumerable=!0),s}},jx=function(e){var t=Sx(US(e)),n=[];return cx(t,function(e){LS(wx,e)||LS(ex,e)||Tx(n,e)}),n},Mx=function(e){var t=e===mx,n=Sx(t?Nx:US(e)),i=[];return cx(n,function(e){!LS(wx,e)||t&&!LS(mx,e)||Tx(i,wx[e])}),i};kS||(fx=function(){if(jS(gx,this))throw new yx("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?FS(arguments[0]):void 0,t=tx(e),n=function(e){var i=void 0===this?IS:this;i===mx&&AS(n,Nx,e),LS(i,lx)&&LS(i[lx],t)&&(i[lx][t]=!1);var s=BS(1,e);try{Ax(i,t,s)}catch(e){if(!(e instanceof _x))throw e;Ix(i,t,s)}};return DS&&Rx&&Ax(mx,t,{configurable:!0,set:n}),Ox(t,e)},QS(gx=fx[ux],"toString",function(){return px(this).tag}),QS(fx,"withoutSetter",function(e){return Ox(tx(e),e)}),JS.f=Px,YS.f=Dx,XS.f=kx,qS.f=Lx,HS.f=KS.f=jx,zS.f=Mx,ix.f=function(e){return Ox(nx(e),e)},DS&&ZS(gx,"description",{configurable:!0,get:function(){return px(this).description}})),RS({global:!0,constructor:!0,wrap:!0,forced:!kS,sham:!kS},{Symbol:fx}),cx(WS(Cx),function(e){sx(e)}),RS({target:dx,stat:!0,forced:!kS},{useSetter:function(){Rx=!0},useSimple:function(){Rx=!1}}),RS({target:"Object",stat:!0,forced:!kS,sham:!DS},{create:function(e,t){return void 0===t?GS(e):kx(GS(e),t)},defineProperty:Dx,defineProperties:kx,getOwnPropertyDescriptor:Lx}),RS({target:"Object",stat:!0,forced:!kS},{getOwnPropertyNames:jx}),rx(),ax(fx,dx),ex[lx]=!0;var Ux=ve&&!!Symbol.for&&!!Symbol.keyFor,Vx=On,Fx=re,Bx=et,Gx=vi,Wx=Ye,Hx=Ux,Kx=Wx("string-to-symbol-registry"),zx=Wx("symbol-to-string-registry");Vx({target:"Symbol",stat:!0,forced:!Hx},{for:function(e){var t=Gx(e);if(Bx(Kx,t))return Kx[t];var n=Fx("Symbol")(t);return Kx[t]=n,zx[n]=t,n}});var qx=On,Yx=et,Xx=we,Jx=Ce,Qx=Ux,Zx=Ye("symbol-to-string-registry");qx({target:"Symbol",stat:!0,forced:!Qx},{keyFor:function(e){if(!Xx(e))throw new TypeError(Jx(e)+" is not a symbol");if(Yx(Zx,e))return Zx[e]}});var $x=as,eT=C,tT=S,nT=vi,iT=d([].push),sT=On,rT=re,aT=y,oT=D,cT=d,lT=s,dT=C,uT=we,hT=al,pT=function(e){if(eT(e))return e;if($x(e)){for(var t=e.length,n=[],i=0;i<t;i++){var s=e[i];"string"==typeof s?iT(n,s):"number"!=typeof s&&"Number"!==tT(s)&&"String"!==tT(s)||iT(n,nT(s))}var r=n.length,a=!0;return function(e,t){if(a)return a=!1,t;if($x(this))return t;for(var i=0;i<r;i++)if(n[i]===e)return t}}},mT=ve,fT=String,gT=rT("JSON","stringify"),_T=cT(/./.exec),yT=cT("".charAt),vT=cT("".charCodeAt),ET=cT("".replace),bT=cT(1..toString),ST=/[\uD800-\uDFFF]/g,xT=/^[\uD800-\uDBFF]$/,TT=/^[\uDC00-\uDFFF]$/,wT=!mT||lT(function(){var e=rT("Symbol")("stringify detection");return"[null]"!==gT([e])||"{}"!==gT({a:e})||"{}"!==gT(Object(e))}),NT=lT(function(){return'"\\udf06\\ud834"'!==gT("\udf06\ud834")||'"\\udead"'!==gT("\udead")}),CT=function(e,t){var n=hT(arguments),i=pT(t);if(dT(i)||void 0!==e&&!uT(e))return n[1]=function(e,t){if(dT(i)&&(t=oT(i,this,fT(e),t)),!uT(t))return t},aT(gT,null,n)},RT=function(e,t,n){var i=yT(n,t-1),s=yT(n,t+1);return _T(xT,e)&&!_T(TT,s)||_T(TT,e)&&!_T(xT,i)?"\\u"+bT(vT(e,0),16):e};gT&&sT({target:"JSON",stat:!0,arity:3,forced:wT||NT},{stringify:function(e,t,n){var i=hT(arguments),s=aT(wT?CT:gT,null,i);return NT&&"string"==typeof s?ET(s,ST,RT):s}});var IT=Zs,AT=Qe;On({target:"Object",stat:!0,forced:!ve||s(function(){IT.f(1)})},{getOwnPropertySymbols:function(e){var t=IT.f;return t?t(AT(e)):[]}}),mS("asyncIterator"),mS("hasInstance"),mS("isConcatSpreadable"),mS("iterator"),mS("match"),mS("matchAll"),mS("replace"),mS("search"),mS("species"),mS("split");var OT=vS;mS("toPrimitive"),OT();var DT=re,kT=Wo;mS("toStringTag"),kT(DT("Symbol"),"Symbol"),mS("unscopables"),Wo(p.JSON,"JSON",!0);var PT=ee.Symbol,LT=mt,jT=$t.f,MT=LT("metadata"),UT=Function.prototype;void 0===UT[MT]&&jT(UT,MT,{value:null}),mS("asyncDispose"),mS("dispose"),mS("metadata");var VT=PT,FT=d,BT=re("Symbol"),GT=BT.keyFor,WT=FT(BT.prototype.valueOf),HT=BT.isRegisteredSymbol||function(e){try{return void 0!==GT(WT(e))}catch(e){return!1}};On({target:"Symbol",stat:!0},{isRegisteredSymbol:HT});for(var KT=Ye,zT=re,qT=d,YT=we,XT=mt,JT=zT("Symbol"),QT=JT.isWellKnownSymbol,ZT=zT("Object","getOwnPropertyNames"),$T=qT(JT.prototype.valueOf),ew=KT("wks"),tw=0,nw=ZT(JT),iw=nw.length;tw<iw;tw++)try{var sw=nw[tw];YT(JT[sw])&&XT(sw)}catch(e){}var rw=function(e){if(QT&&QT(e))return!0;try{for(var t=$T(e),n=0,i=ZT(ew),s=i.length;n<s;n++)if(ew[i[n]]==t)return!0}catch(e){}return!1};On({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:rw}),mS("customMatcher"),mS("observable"),On({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:HT}),On({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:rw}),mS("matcher"),mS("metadataKey"),mS("patternMatch"),mS("replaceAll");var aw=i(VT),ow=i(cS.f("iterator"));function cw(e){return cw="function"==typeof aw&&"symbol"==typeof ow?function(e){return typeof e}:function(e){return e&&"function"==typeof aw&&e.constructor===aw&&e!==aw.prototype?"symbol":typeof e},cw(e)}var lw=i(cS.f("toPrimitive"));function dw(e){var t=function(e,t){if("object"!=cw(e)||!e)return e;var n=e[lw];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=cw(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==cw(t)?t:t+""}function uw(e,t,n){return(t=dw(t))in e?Ib(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hw=i(Rf),pw={isBrowser:!0,classes:{URLSearchParams:void 0!==hw?hw:_b,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const mw="undefined"!=typeof window&&"undefined"!=typeof document,fw="object"==typeof navigator&&navigator||void 0,gw=mw&&(!fw||["ReactNative","NativeScript","NS"].indexOf(fw.product)<0),_w="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,yw=mw&&window.location.href||"http://localhost";function vw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function Ew(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vw(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vw(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var bw=Ew(Ew({},Object.freeze({__proto__:null,hasBrowserEnv:mw,hasStandardBrowserEnv:gw,hasStandardBrowserWebWorkerEnv:_w,navigator:fw,origin:yw})),pw),Sw=rn,xw=D,Tw=et,ww=u,Nw=function(){var e=Sw(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Cw=RegExp.prototype,Rw=function(e){var t=e.flags;return void 0!==t||"flags"in Cw||Tw(e,"flags")||!ww(Cw,e)?t:xw(Nw,e)},Iw=Fh.charAt,Aw=D,Ow=rn,Dw=C,kw=S,Pw=/./.exec,Lw=TypeError,jw=On,Mw=D,Uw=w,Vw=Jo,Fw=pc,Bw=Y,Gw=Wn,Ww=vi,Hw=rn,Kw=$,zw=S,qw=ri,Yw=Rw,Xw=Pe,Jw=s,Qw=rl,Zw=function(e,t,n){return t+(n?Iw(e,t).length:1)},$w=function(e,t){var n=e.exec;if(Dw(n)){var i=Aw(n,e,t);return null!==i&&Ow(i),i}if("RegExp"===kw(e))return Aw(Pw,e,t);throw new Lw("RegExp#exec called on incompatible receiver")},eN=go,tN=mt("matchAll"),nN="RegExp String",iN=nN+" Iterator",sN=eN.set,rN=eN.getterFor(iN),aN=TypeError,oN=Uw("".indexOf),cN=Uw("".matchAll),lN=!!cN&&!Jw(function(){cN("a",/./)}),dN=Vw(function(e,t,n,i){sN(this,{type:iN,regexp:e,string:t,global:n,unicode:i,done:!1})},nN,function(){var e=rN(this);if(e.done)return Fw(void 0,!0);var t=e.regexp,n=e.string,i=$w(t,n);return null===i?(e.done=!0,Fw(void 0,!0)):e.global?(""===Ww(i[0])&&(t.lastIndex=Zw(n,Gw(t.lastIndex),e.unicode)),Fw(i,!1)):(e.done=!0,Fw(i,!1))}),uN=function(e){var t,n,i,s=Hw(this),r=Ww(e),a=Qw(s,RegExp),o=Ww(Yw(s));return t=new a(a===RegExp?s.source:s,o),n=!!~oN(o,"g"),i=!!~oN(o,"u"),t.lastIndex=Gw(s.lastIndex),new dN(t,r,n,i)};jw({target:"String",proto:!0,forced:lN},{matchAll:function(e){var t,n,i,s,r=Bw(this);if(Kw(e)){if(qw(e)&&(t=Ww(Bw(Yw(e))),!~oN(t,"g")))throw new aN("`.matchAll` does not allow non-global regexes");if(lN)return cN(r,e);if(void 0===(i=Xw(e,tN))&&"RegExp"===zw(e)&&(i=uN),i)return Mw(i,e,r)}else if(lN)return cN(r,e);return n=Ww(r),s=new RegExp(e,"g"),Mw(uN,s,n)}});var hN=ei("String","matchAll"),pN=u,mN=hN,fN=String.prototype,gN=function(e){var t=e.matchAll;return"string"==typeof e||e===fN||pN(fN,e)&&t===fN.matchAll?mN:t},_N=i(gN);function yN(e){function t(e,n,i,s){let r=e[s++];if("__proto__"===r)return!0;const a=Number.isFinite(+r),o=s>=e.length;return r=!r&&ob.isArray(i)?i.length:r,o?(ob.hasOwnProp(i,r)?i[r]=[i[r],n]:i[r]=n,!a):(i[r]&&ob.isObject(i[r])||(i[r]=[]),t(e,n,i[r],s)&&ob.isArray(i[r])&&(i[r]=function(e){const t={},n=Object.keys(e);let i;const s=n.length;let r;for(i=0;i<s;i++)r=n[i],t[r]=e[r];return t}(i[r])),!a)}if(ob.isFormData(e)&&ob.isFunction(e.entries)){const n={};return ob.forEachEntry(e,(e,i)=>{t(function(e){return _N(ob).call(ob,/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),i,n,0)}),n}return null}const vN={transitional:Sb,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=ob.isObject(e);if(s&&ob.isHTMLForm(e)&&(e=new FormData(e)),ob.isFormData(e))return i?JSON.stringify(yN(e)):e;if(ob.isArrayBuffer(e)||ob.isBuffer(e)||ob.isStream(e)||ob.isFile(e)||ob.isBlob(e)||ob.isReadableStream(e))return e;if(ob.isArrayBufferView(e))return e.buffer;if(ob.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let r;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return fb(e,new bw.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,i){return bw.isNode&&ob.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((r=ob.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return fb(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),function(e,t,n){if(ob.isString(e))try{return(t||JSON.parse)(e),Dv(ob).call(ob,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||vN.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(ob.isResponse(e)||ob.isReadableStream(e))return e;if(e&&ob.isString(e)&&(n&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw cb.from(e,cb.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bw.classes.FormData,Blob:bw.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ob.forEach(["delete","get","head","post","put","patch"],e=>{vN.headers[e]={}});var EN=vN;const bN=ob.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SN=Symbol("internals");function xN(e){var t;return e&&Dv(t=String(e)).call(t).toLowerCase()}function TN(e){return!1===e||null==e?e:ob.isArray(e)?e.map(TN):String(e)}function wN(e,t,n,i,s){return ob.isFunction(i)?i.call(this,t,n):(s&&(t=n),ob.isString(t)?ob.isString(i)?-1!==t.indexOf(i):ob.isRegExp(i)?i.test(t):void 0:void 0)}class NN{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(e,t,n){const s=xN(t);if(!s)throw new Error("header name must be a non-empty string");const r=ob.findKey(i,s);(!r||void 0===i[r]||!0===n||void 0===n&&!1!==i[r])&&(i[r||t]=TN(e))}const r=(e,t)=>ob.forEach(e,(e,n)=>s(e,n,t));if(ob.isPlainObject(e)||e instanceof this.constructor)r(e,t);else if(ob.isString(e)&&(e=Dv(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Dv(a=e).call(a)))r((e=>{const t={};let n,i,s;return e&&e.split("\n").forEach(function(e){var r,a;s=e.indexOf(":"),n=Dv(r=e.substring(0,s)).call(r).toLowerCase(),i=Dv(a=e.substring(s+1)).call(a),!n||t[n]&&bN[n]||("set-cookie"===n?t[n]?t[n].push(i):t[n]=[i]:t[n]=t[n]?t[n]+", "+i:i)}),t})(e),t);else if(ob.isObject(e)&&ob.isIterable(e)){let n,i,s={};for(const t of e){if(!ob.isArray(t))throw TypeError("Object iterator must return a key-value pair");s[i=t[0]]=(n=s[i])?ob.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}r(s,t)}else null!=e&&s(t,e,n);var a;return this}get(e,t){if(e=xN(e)){const n=ob.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(e);)t[i[1]]=i[2];return t}(e);if(ob.isFunction(t))return t.call(this,e,n);if(ob.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=xN(e)){const n=ob.findKey(this,e);return!(!n||void 0===this[n]||t&&!wN(0,this[n],n,t))}return!1}delete(e,t){const n=this;let i=!1;function s(e){if(e=xN(e)){const s=ob.findKey(n,e);!s||t&&!wN(0,n[s],s,t)||(delete n[s],i=!0)}}return ob.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];e&&!wN(0,this[s],s,e,!0)||(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return ob.forEach(this,(i,s)=>{var r;const a=ob.findKey(n,s);if(a)return t[a]=TN(i),void delete t[s];const o=e?function(e){return Dv(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(s):Dv(r=String(s)).call(r);o!==s&&delete t[s],t[o]=TN(i),n[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return ob.forEach(this,(n,i)=>{null!=n&&!1!==n&&(t[i]=e&&ob.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[SN]=this[SN]={accessors:{}}).accessors,n=this.prototype;function i(e){const i=xN(e);t[i]||(function(e,t){const n=ob.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+n,{value:function(e,n,s){return this[i].call(this,t,e,n,s)},configurable:!0})})}(n,e),t[i]=!0)}return ob.isArray(e)?e.forEach(i):i(e),this}}NN.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ob.reduceDescriptors(NN.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[i]=e}}}),ob.freezeMethods(NN);var CN=NN;function RN(e,t){const n=this||EN,i=t||n,s=CN.from(i.headers);let r=i.data;return ob.forEach(e,function(e){r=e.call(n,r,s.normalize(),t?t.status:void 0)}),s.normalize(),r}function IN(e){return!(!e||!e.__CANCEL__)}function AN(e,t,n){cb.call(this,null==e?"canceled":e,cb.ERR_CANCELED,t,n),this.name="CanceledError"}function ON(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new cb("Request failed with status code "+n.status,[cb.ERR_BAD_REQUEST,cb.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}ob.inherits(AN,cb,{__CANCEL__:!0});const DN=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0;const s=function(e,t){e=e||10;const n=new Array(e),i=new Array(e);let s,r=0,a=0;return t=void 0!==t?t:1e3,function(o){const c=Date.now(),l=i[a];s||(s=c),n[r]=o,i[r]=c;let d=a,u=0;for(;d!==r;)u+=n[d++],d%=e;if(r=(r+1)%e,r===a&&(a=(a+1)%e),c-s<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let n,i,s=0,r=1e3/t;const a=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();s=r,n=null,i&&(clearTimeout(i),i=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-s;for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];t>=r?a(c,e):(n=c,i||(i=setTimeout(()=>{i=null,a(n)},r-t)))},()=>n&&a(n)]}(n=>{const r=n.loaded,a=n.lengthComputable?n.total:void 0,o=r-i,c=s(o);i=r,e({loaded:r,total:a,progress:a?r/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&r<=a?(a-r)/c:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},kN=(e,t)=>{const n=null!=e;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},PN=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return ob.asap(()=>e(...n))};var LN=bw.hasStandardBrowserEnv?((e,t)=>n=>(n=new by(n,bw.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new by(bw.origin),bw.navigator&&/(msie|trident)/i.test(bw.navigator.userAgent)):()=>!0,jN=bw.hasStandardBrowserEnv?{write(e,t,n,i,s,r){const a=[e+"="+encodeURIComponent(t)];ob.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),ob.isString(i)&&a.push("path="+i),ob.isString(s)&&a.push("domain="+s),!0===r&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function MN(e,t,n){let i=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(i||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function UN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}const VN=e=>e instanceof CN?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UN(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UN(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e):e;function FN(e,t){t=t||{};const n={};function i(e,t,n,i){return ob.isPlainObject(e)&&ob.isPlainObject(t)?ob.merge.call({caseless:i},e,t):ob.isPlainObject(t)?ob.merge({},t):ob.isArray(t)?t.slice():t}function s(e,t,n,s){return ob.isUndefined(t)?ob.isUndefined(e)?void 0:i(void 0,e,0,s):i(e,t,0,s)}function r(e,t){if(!ob.isUndefined(t))return i(void 0,t)}function a(e,t){return ob.isUndefined(t)?ob.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function o(n,s,r){return r in t?i(n,s):r in e?i(void 0,n):void 0}const c={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,n)=>s(VN(e),VN(t),0,!0)};return ob.forEach(Object.keys(Object.assign({},e,t)),function(i){const r=c[i]||s,a=r(e[i],t[i],i);ob.isUndefined(a)&&r!==o||(n[i]=a)}),n}var BN=e=>{const t=FN({},e);let n,{data:i,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:a,headers:o,auth:c}=t;if(t.headers=o=CN.from(o),t.url=Eb(MN(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),ob.isFormData(i))if(bw.hasStandardBrowserEnv||bw.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(n=o.getContentType())){const[e,...t]=n?n.split(";").map(e=>Dv(e).call(e)).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(bw.hasStandardBrowserEnv&&(s&&ob.isFunction(s)&&(s=s(t)),s||!1!==s&&LN(t.url))){const e=r&&a&&jN.read(a);e&&o.set(r,e)}return t},GN="undefined"!=typeof XMLHttpRequest&&function(e){return new np(function(t,n){const i=BN(e);let s=i.data;const r=CN.from(i.headers).normalize();let a,o,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=i;function m(){l&&l(),d&&d(),i.cancelToken&&i.cancelToken.unsubscribe(a),i.signal&&i.signal.removeEventListener("abort",a)}let f=new XMLHttpRequest;function g(){if(!f)return;const i=CN.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());ON(function(e){t(e),m()},function(e){n(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:i,config:e,request:f}),f=null}f.open(i.method.toUpperCase(),i.url,!0),f.timeout=i.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(n(new cb("Request aborted",cb.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new cb("Network Error",cb.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const s=i.transitional||Sb;i.timeoutErrorMessage&&(t=i.timeoutErrorMessage),n(new cb(t,s.clarifyTimeoutError?cb.ETIMEDOUT:cb.ECONNABORTED,e,f)),f=null},void 0===s&&r.setContentType(null),"setRequestHeader"in f&&ob.forEach(r.toJSON(),function(e,t){f.setRequestHeader(t,e)}),ob.isUndefined(i.withCredentials)||(f.withCredentials=!!i.withCredentials),u&&"json"!==u&&(f.responseType=i.responseType),p&&([c,d]=DN(p,!0),f.addEventListener("progress",c)),h&&f.upload&&([o,l]=DN(h),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",l)),(i.cancelToken||i.signal)&&(a=t=>{f&&(n(!t||t.type?new AN(null,e,f):t),f.abort(),f=null)},i.cancelToken&&i.cancelToken.subscribe(a),i.signal&&(i.signal.aborted?a():i.signal.addEventListener("abort",a)));const _=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(i.url);_&&-1===bw.protocols.indexOf(_)?n(new cb("Unsupported protocol "+_+":",cb.ERR_BAD_REQUEST,e)):f.send(s||null)})},WN=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,i=new AbortController;const s=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;i.abort(t instanceof cb?t:new AN(t instanceof Error?t.message:t))}};let r=t&&setTimeout(()=>{r=null,s(new cb("timeout ".concat(t," of ms exceeded"),cb.ETIMEDOUT))},t);const a=()=>{e&&(r&&clearTimeout(r),r=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(s):e.removeEventListener("abort",s)}),e=null)};e.forEach(e=>e.addEventListener("abort",s));const{signal:o}=i;return o.unsubscribe=()=>ob.asap(a),o}},HN=i(tp),KN=cS.f("asyncIterator"),zN=i(KN);function qN(e,t){this.v=e,this.k=t}function YN(e){return function(){return new XN(e.apply(this,arguments))}}function XN(e){var t,n;function i(t,n){try{var r=e[t](n),a=r.value,o=a instanceof qN;HN.resolve(o?a.v:a).then(function(n){if(o){var c="return"===t?"return":"next";if(!a.k||n.done)return i(c,n);n=e[c](n).value}s(r.done?"return":"normal",n)},function(e){i("throw",e)})}catch(e){s("throw",e)}}function s(e,s){switch(e){case"return":t.resolve({value:s,done:!0});break;case"throw":t.reject(s);break;default:t.resolve({value:s,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,s){return new HN(function(r,a){var o={key:e,arg:s,resolve:r,reject:a,next:null};n?n=n.next=o:(t=n=o,i(e,s))})},"function"!=typeof e.return&&(this.return=void 0)}function JN(e){return new qN(e,0)}function QN(e){var t={},n=!1;function i(t,i){return n=!0,i=new HN(function(n){n(e[t](i))}),{done:!1,value:new qN(i,1)}}return t[void 0!==aw&&ow||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):i("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return i("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):i("return",e)}),t}XN.prototype["function"==typeof aw&&zN||"@@asyncIterator"]=function(){return this},XN.prototype.next=function(e){return this._invoke("next",e)},XN.prototype.throw=function(e){return this._invoke("throw",e)},XN.prototype.return=function(e){return this._invoke("return",e)};var ZN=i(KN);function $N(e){var t,n,i,s=2;for("undefined"!=typeof Symbol&&(n=ZN,i=Symbol.iterator);s--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new eC(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function eC(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then(function(e){return{value:e,done:t}})}return eC=function(e){this.s=e,this.n=e.next},eC.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new eC(e)}const tC=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,s=0;for(;s<n;)i=s+t,yield e.slice(s,i),s=i},nC=function(){var e=YN(function*(e,t){var n,i=!1,s=!1;try{for(var r,a=$N(iC(e));i=!(r=yield JN(a.next())).done;i=!1){const e=r.value;yield*QN($N(tC(e,t)))}}catch(e){s=!0,n=e}finally{try{i&&null!=a.return&&(yield JN(a.return()))}finally{if(s)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),iC=function(){var e=YN(function*(e){if(e[ZN])return void(yield*QN($N(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield JN(t.read());if(e)break;yield n}}finally{yield JN(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),sC=(e,t,n,i)=>{const s=nC(e,t);let r,a=0,o=e=>{r||(r=!0,i&&i(e))};return new ReadableStream({async pull(e){try{const{done:t,value:i}=await s.next();if(t)return o(),void e.close();let r=i.byteLength;if(n){let e=a+=r;n(e)}e.enqueue(new Uint8Array(i))}catch(e){throw o(e),e}},cancel:e=>(o(e),s.return())},{highWaterMark:2})};function rC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function aC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rC(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const oC="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,cC=oC&&"function"==typeof ReadableStream,lC=oC&&("function"==typeof TextEncoder?(dC=new TextEncoder,e=>dC.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var dC;const uC=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch(e){return!1}},hC=cC&&uC(()=>{let e=!1;const t=new Request(bw.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),pC=cC&&uC(()=>ob.isReadableStream(new Response("").body)),mC={stream:pC&&(e=>e.body)};var fC;oC&&(fC=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!mC[e]&&(mC[e]=ob.isFunction(fC[e])?t=>t[e]():(t,n)=>{throw new cb("Response type '".concat(e,"' is not supported"),cb.ERR_NOT_SUPPORT,n)})}));const gC=async(e,t)=>{const n=ob.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(ob.isBlob(e))return e.size;if(ob.isSpecCompliantForm(e)){const t=new Request(bw.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return ob.isArrayBufferView(e)||ob.isArrayBuffer(e)?e.byteLength:(ob.isURLSearchParams(e)&&(e+=""),ob.isString(e)?(await lC(e)).byteLength:void 0)})(t):n};var _C=oC&&(async e=>{let{url:t,method:n,data:i,signal:s,cancelToken:r,timeout:a,onDownloadProgress:o,onUploadProgress:c,responseType:l,headers:d,withCredentials:u="same-origin",fetchOptions:h}=BN(e);l=l?(l+"").toLowerCase():"text";let p,m=WN([s,r&&r.toAbortSignal()],a);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(c&&hC&&"get"!==n&&"head"!==n&&0!==(g=await gC(d,i))){let e,n=new Request(t,{method:"POST",body:i,duplex:"half"});if(ob.isFormData(i)&&(e=n.headers.get("content-type"))&&d.setContentType(e),n.body){const[e,t]=kN(g,DN(PN(c)));i=sC(n.body,65536,e,t)}}ob.isString(u)||(u=u?"include":"omit");const s="credentials"in Request.prototype;p=new Request(t,aC(aC({},h),{},{signal:m,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:i,duplex:"half",credentials:s?u:void 0}));let r=await fetch(p);const a=pC&&("stream"===l||"response"===l);if(pC&&(o||a&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=r[t]});const t=ob.toFiniteNumber(r.headers.get("content-length")),[n,i]=o&&kN(t,DN(PN(o),!0))||[];r=new Response(sC(r.body,65536,n,()=>{i&&i(),f&&f()}),e)}l=l||"text";let _=await mC[ob.findKey(mC,l)||"text"](r,e);return!a&&f&&f(),await new np((t,n)=>{ON(t,n,{data:_,headers:CN.from(r.headers),status:r.status,statusText:r.statusText,config:e,request:p})})}catch(t){if(f&&f(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new cb("Network Error",cb.ERR_NETWORK,e,p),{cause:t.cause||t});throw cb.from(t,t&&t.code,e,p)}});const yC={http:null,xhr:GN,fetch:_C};ob.forEach(yC,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const vC=e=>"- ".concat(e),EC=e=>ob.isFunction(e)||null===e||!1===e;var bC={getAdapter:e=>{e=ob.isArray(e)?e:[e];const{length:t}=e;let n,i;const s={};for(let r=0;r<t;r++){let t;if(n=e[r],i=n,!EC(n)&&(i=yC[(t=String(n)).toLowerCase()],void 0===i))throw new cb("Unknown adapter '".concat(t,"'"));if(i)break;s[t||"#"+r]=i}if(!i){const e=Object.entries(s).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});throw new cb("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(vC).join("\n"):" "+vC(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:yC};function SC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new AN(null,e)}function xC(e){return SC(e),e.headers=CN.from(e.headers),e.data=RN.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),bC.getAdapter(e.adapter||EN.adapter)(e).then(function(t){return SC(e),t.data=RN.call(e,e.transformResponse,t),t.headers=CN.from(t.headers),t},function(t){return IN(t)||(SC(e),t&&t.response&&(t.response.data=RN.call(e,e.transformResponse,t.response),t.response.headers=CN.from(t.response.headers))),np.reject(t)})}const TC="1.9.0",wC={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{wC[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const NC={};wC.transitional=function(e,t,n){function i(e,t){return"[Axios v"+TC+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,s,r)=>{if(!1===e)throw new cb(i(s," has been removed"+(t?" in "+t:"")),cb.ERR_DEPRECATED);return t&&!NC[s]&&(NC[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,s,r)}},wC.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var CC={assertOptions:function(e,t,n){if("object"!=typeof e)throw new cb("options must be an object",cb.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let s=i.length;for(;s-- >0;){const r=i[s],a=t[r];if(a){const t=e[r],n=void 0===t||a(t,r,e);if(!0!==n)throw new cb("option "+r+" must be "+n,cb.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new cb("Unknown option "+r,cb.ERR_BAD_OPTION)}},validators:wC};const RC=CC.validators;let IC=class{constructor(e){this.defaults=e||{},this.interceptors={request:new bb,response:new bb}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=FN(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;void 0!==n&&CC.assertOptions(n,{silentJSONParsing:RC.transitional(RC.boolean),forcedJSONParsing:RC.transitional(RC.boolean),clarifyTimeoutError:RC.transitional(RC.boolean)},!1),null!=i&&(ob.isFunction(i)?t.paramsSerializer={serialize:i}:CC.assertOptions(i,{encode:RC.function,serialize:RC.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),CC.assertOptions(t,{baseUrl:RC.spelling("baseURL"),withXsrfToken:RC.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let r=s&&ob.merge(s.common,s[t.method]);s&&ob.forEach(["delete","get","head","post","put","patch","common"],e=>{delete s[e]}),t.headers=CN.concat(r,s);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const c=[];let l;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let d,u=0;if(!o){const e=[xC.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),d=e.length,l=np.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=a.length;let h=t;for(u=0;u<d;){const t=a[u++],n=a[u++];try{h=t(h)}catch(e){n.call(this,e);break}}try{l=xC.call(this,h)}catch(e){return np.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return Eb(MN((e=FN(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ob.forEach(["delete","get","head","options"],function(e){IC.prototype[e]=function(t,n){return this.request(FN(n||{},{method:e,url:t,data:(n||{}).data}))}}),ob.forEach(["post","put","patch"],function(e){function t(t){return function(n,i,s){return this.request(FN(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}IC.prototype[e]=t(),IC.prototype[e+"Form"]=t(!0)});var AC=IC;class OC{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new np(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const i=new np(e=>{n.subscribe(e),t=e}).then(e);return i.cancel=function(){n.unsubscribe(t)},i},e(function(e,i,s){n.reason||(n.reason=new AN(e,i,s),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new OC(function(t){e=t}),cancel:e}}}var DC=OC;const kC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kC).forEach(e=>{let[t,n]=e;kC[n]=t});var PC=kC;const LC=function e(t){const n=new AC(t),i=yE(AC.prototype.request,n);return ob.extend(i,AC.prototype,n,{allOwnKeys:!0}),ob.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(FN(t,n))},i}(EN);LC.Axios=AC,LC.CanceledError=AN,LC.CancelToken=DC,LC.isCancel=IN,LC.VERSION=TC,LC.toFormData=fb,LC.AxiosError=cb,LC.Cancel=LC.CanceledError,LC.all=function(e){return np.all(e)},LC.spread=function(e){return function(t){return e.apply(null,t)}},LC.isAxiosError=function(e){return ob.isObject(e)&&!0===e.isAxiosError},LC.mergeConfig=FN,LC.AxiosHeaders=CN,LC.formToJSON=e=>yN(ob.isHTMLForm(e)?new FormData(e):e),LC.getAdapter=bC.getAdapter,LC.HttpStatusCode=PC,LC.default=LC;var jC=LC;const MC=()=>{};function UC(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:MC};return e.promise=new np((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}}),e}const VC=new Map,FC=new Map,BC=new Map;let GC=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),WC=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const HC=new Xv;let KC=HC.getResult(),zC=null;function qC(e){if(!zC){e&&HC.setUA(e),KC=HC.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return WC.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return WC.CHROME;case"Safari":case"Mobile Safari":return WC.SAFARI;case"Edge":return WC.EDGE;case"Firefox":return WC.FIREFOX;case"QQ":case"QQBrowser":return WC.QQ;case"Opera":return WC.OPERA;case"WeChat":return WC.WECHAT;default:return e.browser.name||""}}(KC),n=YC(KC),i=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(KC),s=KC.os.version,r=YC(KC,!1),a=KC.device.type;if(!(t&&n&&i&&s))return{name:t,version:n,os:i,osVersion:s,browserVersion:r,deviceType:a};zC={name:t,version:n,os:i,osVersion:s,browserVersion:r,deviceType:a}}return zC}function YC(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function XC(){return qC().os}function JC(){const e=qC();return"".concat(e.os," ").concat(e.osVersion)}function QC(){const e=qC();return!!("WebKit"===KC.engine.name&&e.os===GC.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==WC.SAFARI||iR()&&e.name!==WC.SAFARI)}function ZC(){return qC().name===WC.CHROME}function $C(){return qC().name===WC.SAFARI}function eR(){const e=qC();if(e.name!==WC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}function tR(){return qC().name===WC.EDGE}function nR(){return qC().name===WC.FIREFOX}function iR(){return qC().os===GC.IOS}function sR(e){const t=qC();return!(t.name!==WC.CHROME||!t.osVersion)&&Number(t.version)>=e}function rR(e){const t=qC();return!(t.name!==WC.CHROME||!t.osVersion)&&Number(t.version)<e}function aR(e,t,n){const i=qC();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function oR(e){const t=qC();return!(t.name!==WC.EDGE||!t.osVersion)&&Number(t.version)>=e}function cR(e){const t=qC();return!(t.name!==WC.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function lR(e){const t=qC();return!(t.name!==WC.SAFARI||!t.osVersion)&&Number(t.version)>=e}function dR(e,t,n){const i=qC();if(i.os!==GC.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return n?t&&Number(s[0])===e&&Number(s[1])>t||Number(s[0])>e:t?Number(s[0])===e&&Number(s[1])>=t||Number(s[0])>e:Number(s[0])>=e}function uR(e,t,n){const i=qC();if(i.os!==GC.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return n?t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e:t?Number(s[0])===e&&Number(s[1])<=t||Number(s[0])<e:Number(s[0])<=e}function hR(e,t,n){const i=qC();if(i.name!==WC.SAFARI||!i.osVersion||!i.browserVersion)return!1;const s=i.browserVersion.split(".");return n?t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e:t?Number(s[0])===e&&Number(s[1])<=t||Number(s[0])<e:Number(s[0])<=e}function pR(e){const t=qC();return!(t.name!==WC.OPERA||!t.osVersion)&&Number(t.version)>=e}function mR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function fR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function gR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function _R(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function yR(){return $C()&&navigator.maxTouchPoints>0}function vR(){return qC().name===WC.WECHAT}function ER(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function bR(){const e=XC();return function(){const{deviceType:e}=qC();return"mobile"===e||"tablet"===e}()||e===GC.ANDROID||e===GC.IOS||e===GC.HARMONY_OS}function SR(){const e=qC();return e.name!==WC.EDGE&&e.name!==WC.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function xR(){return XC()===GC.ANDROID}function TR(){const e=qC();return xR()&&(e.name===WC.CHROME||e.name===WC.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function wR(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function CR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NR(Object(n),!0).forEach(function(t){wR(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NR(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let RR=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),IR=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),wR(this,"code",void 0),wR(this,"message",void 0),wR(this,"data",void 0),wR(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function AR(e,t){if("boolean"!=typeof e)throw new IR(RR.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function OR(e,t,n){if(!Pi(n).call(n,e))throw new IR(RR.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function DR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new IR(RR.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function kR(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new IR(RR.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&DR(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&DR(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&DR(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&DR(e.ideal,"".concat(t,".ideal"),1,1/0)}else DR(e,t,1,1/0)}function PR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new IR(RR.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!MR(e,n,i,s))throw new IR(RR.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function LR(e,t){if(!Array.isArray(e))throw new IR(RR.INVALID_PARAMS,"".concat(t," should be an array"))}function jR(e){return null==e}function MR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!i||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var UR=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(UR||{}),VR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(VR||{});const FR=new class{constructor(){wR(this,"_clientSize",null),wR(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),wR(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),wR(this,"getStyle",e=>window.getComputedStyle(e,null)),wR(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:s,visibility:r,opacity:a,filter:o}=i;return("none"===s||Pi(t=["hidden","collapse"]).call(t,r)||Number(a)<.1)&&(n=!1),!!n&&(o&&o.split(" ").filter(e=>{var t;const n=e.split("(")[0];return Pi(t=["brightness","blur","opacity"]).call(t,n)}).map(e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]}).forEach(e=>{const[t,i]=e;switch(t){case"brightness":(i<.1||i>3)&&(n=!1);break;case"blur":i>3&&(n=!1);break;case"opacity":i<.1&&(n=!1)}}),n)}),wR(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const s=e=>t(e);let r=e;for(;r&&i;)s(r)||(n=!1,i=!1),r=r.parentElement,r||(i=!1);return n}),wR(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),wR(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:s,top:r,bottom:a}=e.getBoundingClientRect(),o=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:i,right:s,top:r,bottom:a,clientWidth:o,clientHeight:c,clientMin:Math.min(o,c)}}),wR(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),wR(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),wR(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return null!==i&&i!==n}),wR(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,s=e/6,r=t/6,a=[],o=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*o+(0===c?.1:4===c?(s*c*o-1e5)/o:s*c)*o)/o,l=(i*o+(0===e?.1:4===e?(r*e*o-1e5)/o:r*e)*o)/o;a.push({x:t,y:l})}return[...a]}),wR(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(e=>!!e).length>6),wR(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),wR(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:s,clientWidth:r,clientMin:a}=this._clientSize;let o,c,l,d;if(e<0)o=0;else{if(!(e<r))return!1;o=e}if(t<0)return!1;if(c=t<r?t:r,n<0)l=0;else{if(!(n<s))return!1;l=n}if(i<0)return!1;d=i<s?i:s;const u=c-o,h=d-l;return this.checkSizeIsVisible(u,h,a)}),wR(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),wR(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(UR.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(UR.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(UR.SIZE)}}return this.returnHiddenResult(UR.STYLE)}return this.returnHiddenResult(VR.UNMOUNTED)}return this.returnHiddenResult(VR.INVALID_HTML_ELEMENT)}),wR(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))}};function BR(e){return(new TextEncoder).encode(e)}const GR=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},WR=async e=>function(e,t){let n="";return new Uint8Array(e).forEach(e=>{n+=e.toString(t).padStart(2,"0")}),n}(await crypto.subtle.digest("SHA-256",BR(e)),16);class HR{constructor(){wR(this,"_events",{}),wR(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],i=this._indexOfListener(n,t);-1!==i&&n.splice(i,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(e=>e);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];for(let r=0;r<t.length;r+=1){const n=t[r];n.once&&this.off(e,n.listener),n.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}let KR=null;function zR(){if(KR)return KR;if(window.electron)return KR=window.electron;if(!window.require)return null;try{return KR=window.require("electron"),KR}catch(e){return null}}let qR=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),YR=function(e){return e.TRACER="tracer",e}({});function XR(e){return DR(e.timeout,"config.timeout",0,1e5),DR(e.timeoutFactor,"config.timeoutFactor",0,100,!1),DR(e.maxRetryCount,"config.maxRetryConfig",0,1/0),DR(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let JR=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),QR=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ZR(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(e=>{if(!e.urls)throw Error()})}catch(e){return!1}return!0}function $R(e){return PR(e.turnServerURL,"turnServerURL"),PR(e.username,"username"),PR(e.password,"password"),e.udpport&&DR(e.udpport,"udpport",1,99999,!0),e.forceturn&&AR(e.forceturn,"forceturn"),e.security&&AR(e.security,"security"),e.tcpport&&DR(e.tcpport,"tcpport",1,99999,!0),!0}function eI(e){return void 0!==e.level&&OR(e.level,"level",[1,2,3]),void 0!==e.delay&&DR(e.delay,"delay",0,3e3,!0),!0}let tI=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),nI=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),iI=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),sI=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function rI(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return 0===e.getListeners(t).length?np.reject(new IR(RR.UNEXPECTED_ERROR,"can not emit promise")):new np((n,s)=>{e.emit(t,...i,n,s)})}function aI(e,t){if(0===e.getListeners(t).length)return np.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return rI(e,t,...i)}function oI(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return cI(e,t,...i)}function cI(e,t){let n=null,i=null;for(var s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];if(e.emit(t,...r,e=>{n=e},e=>{i=e}),null!==i)throw i;if(null===n)throw new IR(RR.UNEXPECTED_ERROR,"handler is not sync");return n}const lI=new class extends HR{set networkState(e){this.emit(sI.NETWORK_STATE_CHANGE,e,this._networkState),e===iI.ONLINE?this.emit(sI.ONLINE):e===iI.OFFLINE&&(this.onlineWaiter=new np(e=>{this.once(sI.ONLINE,()=>{this.onlineWaiter=void 0,e(iI.ONLINE)})}),this.emit(sI.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===iI.ONLINE}constructor(){super(),wR(this,"_moduleName","network-indicator"),wR(this,"_networkState",iI.ONLINE),wR(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=iI.ONLINE}),window.addEventListener("offline",()=>{this.networkState=iI.OFFLINE})}};function dI(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function uI(e){const t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function hI(e){void 0!==np?np.resolve().then(e):setTimeout(e,0)}function pI(e){return JSON.parse(JSON.stringify(e))}function mI(e){try{return pI(e)}catch(t){return e}}const fI={};function gI(e,t){fI[t]||(fI[t]=!0,e())}function _I(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function yI(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function vI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function EI(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=ss(t).call(t,(e,t)=>e+t.length,0),s=new Uint8Array(new ArrayBuffer(i));let r=0;return t.forEach(e=>{s.set(e,r),r+=e.length}),s}function bI(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function SI(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(e=>{t+="string"==typeof e?bI(e):e.size}),t+138}function xI(e){const t=new IR(RR.TIMEOUT,"timeout");return new np((n,i)=>{window.setTimeout(()=>i(t),e)})}function TI(e){return new np(t=>{window.setTimeout(t,e)})}function wI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+wI(e-n.length,"")}function NI(){return wI(32,"").toUpperCase()}const CI=()=>{},RI=new class{constructor(){wR(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var s=arguments.length,r=new Array(s>4?s-4:0),a=4;a<s;a++)r[a-4]=arguments[a];if(this.fnMap.has(t)){const s=this.fnMap.get(t);if(s.threshold!==n){s.fn(...s.args),clearTimeout(s.timer);const a=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:r,skipFn:i})}else s.skipFn&&s.skipFn(...s.args),this.fnMap.set(t,CR(CR({},s),{},{fn:e,args:r,skipFn:i}))}else{const s=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:s,args:r,skipFn:i})}}},II=RI.throttleByKey.bind(RI);function AI(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function OI(e,t){if(!AI(e)||!AI(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=OI(e[i],t[i]);return n}{const n=CR({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=OI(e[i],t[i]):n[i]=t[i]);return n}}function DI(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,!t||i!==t););return n}function kI(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function PI(e){return ss(e).call(e,(e,t)=>e+t,0)}function LI(e){const t="0123456789abcdef";function n(e){let n,i="";for(n=0;n<=3;n++)i+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return i}function i(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,s,r,a){return i(function(e,t){return e<<t|e>>>32-t}(i(i(t,e),i(s,a)),r),n)}function r(e,t,n,i,r,a,o){return s(t&n|~t&i,e,t,r,a,o)}function a(e,t,n,i,r,a,o){return s(t&i|n&~i,e,t,r,a,o)}function o(e,t,n,i,r,a,o){return s(t^n^i,e,t,r,a,o)}function c(e,t,n,i,r,a,o){return s(n^(t|~i),e,t,r,a,o)}const l=function(e){let t;const n=1+(e.length+8>>6),i=new Array(16*n);for(t=0;t<16*n;t++)i[t]=0;for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<t%4*8;return i[t>>2]|=128<<t%4*8,i[16*n-2]=8*e.length,i}(e);let d,u,h,p,m,f=1732584193,g=-271733879,_=-1732584194,y=271733878;for(d=0;d<l.length;d+=16)u=f,h=g,p=_,m=y,f=r(f,g,_,y,l[d+0],7,-680876936),y=r(y,f,g,_,l[d+1],12,-389564586),_=r(_,y,f,g,l[d+2],17,606105819),g=r(g,_,y,f,l[d+3],22,-1044525330),f=r(f,g,_,y,l[d+4],7,-176418897),y=r(y,f,g,_,l[d+5],12,1200080426),_=r(_,y,f,g,l[d+6],17,-1473231341),g=r(g,_,y,f,l[d+7],22,-45705983),f=r(f,g,_,y,l[d+8],7,1770035416),y=r(y,f,g,_,l[d+9],12,-1958414417),_=r(_,y,f,g,l[d+10],17,-42063),g=r(g,_,y,f,l[d+11],22,-1990404162),f=r(f,g,_,y,l[d+12],7,1804603682),y=r(y,f,g,_,l[d+13],12,-40341101),_=r(_,y,f,g,l[d+14],17,-1502002290),g=r(g,_,y,f,l[d+15],22,1236535329),f=a(f,g,_,y,l[d+1],5,-165796510),y=a(y,f,g,_,l[d+6],9,-1069501632),_=a(_,y,f,g,l[d+11],14,643717713),g=a(g,_,y,f,l[d+0],20,-373897302),f=a(f,g,_,y,l[d+5],5,-701558691),y=a(y,f,g,_,l[d+10],9,38016083),_=a(_,y,f,g,l[d+15],14,-660478335),g=a(g,_,y,f,l[d+4],20,-405537848),f=a(f,g,_,y,l[d+9],5,568446438),y=a(y,f,g,_,l[d+14],9,-1019803690),_=a(_,y,f,g,l[d+3],14,-187363961),g=a(g,_,y,f,l[d+8],20,1163531501),f=a(f,g,_,y,l[d+13],5,-1444681467),y=a(y,f,g,_,l[d+2],9,-51403784),_=a(_,y,f,g,l[d+7],14,1735328473),g=a(g,_,y,f,l[d+12],20,-1926607734),f=o(f,g,_,y,l[d+5],4,-378558),y=o(y,f,g,_,l[d+8],11,-2022574463),_=o(_,y,f,g,l[d+11],16,1839030562),g=o(g,_,y,f,l[d+14],23,-35309556),f=o(f,g,_,y,l[d+1],4,-1530992060),y=o(y,f,g,_,l[d+4],11,1272893353),_=o(_,y,f,g,l[d+7],16,-155497632),g=o(g,_,y,f,l[d+10],23,-1094730640),f=o(f,g,_,y,l[d+13],4,681279174),y=o(y,f,g,_,l[d+0],11,-358537222),_=o(_,y,f,g,l[d+3],16,-722521979),g=o(g,_,y,f,l[d+6],23,76029189),f=o(f,g,_,y,l[d+9],4,-640364487),y=o(y,f,g,_,l[d+12],11,-421815835),_=o(_,y,f,g,l[d+15],16,530742520),g=o(g,_,y,f,l[d+2],23,-995338651),f=c(f,g,_,y,l[d+0],6,-198630844),y=c(y,f,g,_,l[d+7],10,1126891415),_=c(_,y,f,g,l[d+14],15,-1416354905),g=c(g,_,y,f,l[d+5],21,-57434055),f=c(f,g,_,y,l[d+12],6,1700485571),y=c(y,f,g,_,l[d+3],10,-1894986606),_=c(_,y,f,g,l[d+10],15,-1051523),g=c(g,_,y,f,l[d+1],21,-2054922799),f=c(f,g,_,y,l[d+8],6,1873313359),y=c(y,f,g,_,l[d+15],10,-30611744),_=c(_,y,f,g,l[d+6],15,-1560198380),g=c(g,_,y,f,l[d+13],21,1309151649),f=c(f,g,_,y,l[d+4],6,-145523070),y=c(y,f,g,_,l[d+11],10,-1120210379),_=c(_,y,f,g,l[d+2],15,718787259),g=c(g,_,y,f,l[d+9],21,-343485551),f=i(f,u),g=i(g,h),_=i(_,p),y=i(y,m);return n(f)+n(g)+n(_)+n(y)}let jI=1,MI=console,UI=class{static setLogger(e){MI=e}constructor(e,t){wR(this,"id",void 0),wR(this,"lockingPromise",np.resolve()),wR(this,"locks",0),wR(this,"name",""),wR(this,"lockId",void 0),this.lockId=jI++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");MI.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new np(n=>{t=()=>{this.locks-=1,this.logger("unlocked",e),n()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function VI(e,t){return function(n,i,s){const r=s.value;if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return s.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const s=await n.lock("From ".concat(e,".").concat(i));try{for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return await r.apply(this,o)}finally{s()}},s}}const FI={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function BI(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function GI(e,t,n,i){const s=Object.assign({},FI,i);let r=s.timeout;const a=async()=>{await function(e){return new np(t=>{window.setTimeout(t,e)})}(r),r*=s.timeoutFactor,r=Math.min(s.maxRetryTimeout,r)};let o=!1;const c=new np(async(i,r)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<s.maxRetryCount;c+=1){if(o)return r(new IR(RR.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return i(n);if(c+1===s.maxRetryCount)return i(n);await a()}catch(e){if(!n(e,c))return r(e);if(c+1===s.maxRetryCount)return r(e);await a()}}});return c.cancel=()=>o=!0,c}let WI,HI=class{constructor(e){wR(this,"input",[]),wR(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:ss(e=this.input).call(e,(e,t)=>e+t)/this.input.length}},KI=0,zI=0;function qI(e,t,n,i){return new np((s,r)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),KI+=bI(t.data)):n&&(t.data.size?KI+=t.data.size:t.data instanceof FormData?KI+=SI(t.data):KI+=bI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,jC.request(t).then(e=>{"string"==typeof e.data?zI+=bI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?zI+=e.data.byteLength:zI+=bI(JSON.stringify(e.data)),i&&s({data:e.data,headers:e.headers}),s(e.data)}).catch(e=>{jC.isCancel(e)?r(new IR(RR.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?r(new IR(RR.NETWORK_TIMEOUT,e.message)):e.response?r(new IR(RR.NETWORK_RESPONSE_ERROR,e.response.status)):r(new IR(RR.NETWORK_ERROR,e.message))})})}async function YI(e,t){const n=new Blob([t.data],{type:"buffer"});return await qI(e,CR(CR({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XI=()=>void 0!==window.isSecureContext;function JI(e){if(Array.isArray(e))return e.map(e=>e);if(!QI(e))return e;const t={};for(const n in e){const i=e[n];QI(i)||Array.isArray(i)?t[n]=JI(i):t[n]=i}return t}function QI(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let ZI=class{constructor(e){wR(this,"input",[]),wR(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const $I={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},eA={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:$I,remoteCandidate:$I},updateInterval:0},tA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},nA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},iA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},sA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let rA=class{constructor(e,t){wR(this,"onFirstVideoReceived",void 0),wR(this,"onFirstVideoDecoded",void 0),wR(this,"onFirstAudioReceived",void 0),wR(this,"onFirstVideoDecodedTimeout",void 0),wR(this,"onFirstAudioDecoded",void 0),wR(this,"onSelectedLocalCandidateChanged",void 0),wR(this,"onSelectedRemoteCandidateChanged",void 0),wR(this,"videoIsReady",!1),wR(this,"videoIsReady2",{}),wR(this,"pc",void 0),wR(this,"options",void 0),wR(this,"intervalTimer",void 0),wR(this,"stats",JI(eA)),wR(this,"isFirstVideoReceived",{}),wR(this,"isFirstVideoDecoded",{}),wR(this,"isFirstAudioReceived",{}),wR(this,"isFirstAudioDecoded",{}),wR(this,"isFirstVideoDecodedTimeout",{}),wR(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new np(e=>{e({local:CR({},$I),remote:CR({},$I)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,s=0,r=0,a=0;for(const o of n)e[o].forEach((e,n)=>{if(!this.lossRateWindowStats[t-1][o][n]||!this.lossRateWindowStats[0][o][n])return;const c=this.lossRateWindowStats[t-1][o][n].packets-this.lossRateWindowStats[0][o][n].packets,l=this.lossRateWindowStats[t-1][o][n].packetsLost-this.lossRateWindowStats[0][o][n].packetsLost;"videoSend"===o||"audioSend"===o?(i+=c,r+=l):(s+=c,a+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)});e.sendPacketLossRate=i<=0||r<=0?0:r/(i+r),e.recvPacketLossRate=s<=0||a<=0?0:a/(s+a)}},aA=class extends rA{constructor(){super(...arguments),wR(this,"_stats",eA),wR(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=JI(eA);const n=t.filter(e=>"ssrc"===e.type);this.processSSRCStats(n);const i=t.find(e=>"VideoBwe"===e.type);i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(e=>{var t;const n=Pi(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=JI(nA);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=JI(tA),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const i=n.stats,s=Date.now()-n.lts;t.framesDecodeFreezeTime=i.framesDecodeFreezeTime,t.framesDecodeInterval=i.framesDecodeInterval,t.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=s,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CR({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=JI(sA);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=JI(iA);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}})}_getStats(){return new np((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t.push(n)}),t}},oA=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),cA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),lA=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),dA=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var uA=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(uA||{});function hA(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:uA.kNone;if(!t)return;const r=Number(t[n]);if("number"!=typeof r)return;const a=Number(t[i]);if("number"!=typeof a)return;if(!e)return a?r/a*s:void 0;const o=Number(e[n]);if("number"!=typeof o)return;const c=Number(e[i]);if("number"!=typeof c)return;const l=a-c;return l?(r-o)/l*s:void 0}let pA=class extends rA{constructor(){super(...arguments),wR(this,"_stats",eA),wR(this,"report",void 0),wR(this,"lastDecodeVideoReceiverStats",new Map),wR(this,"lastVideoFramesRecv",new Map),wR(this,"lastVideoFramesSent",new Map),wR(this,"lastVideoFramesDecode",new Map),wR(this,"lastVideoFramesOutput",new Map),wR(this,"lastVideoJBDelay",new Map),wR(this,"lastAudioJBDelay",new Map),wR(this,"mediaBytesSent",new Map),wR(this,"mediaBytesRetransmit",new Map),wR(this,"mediaBytesTargetEncode",new Map),wR(this,"lastDecodeAudioReceiverStats",new Map),wR(this,"lastAudioConcealment",new Map),wR(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=JI(eA),this.report.forEach(e=>{switch(e.type){case dA.OUTBOUND:case dA.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===dA.OUTBOUND?"audio"===t||i?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===dA.INBOUND&&("audio"===t||i?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case dA.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case dA.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:CR({},$I),remote:CR({},$I)};return e.forEach(n=>{let i;if(n.type===dA.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===dA.CANDIDATE_PAIR&&n.selected&&(i=n),i){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(i.localCandidateId){const s=e.get(i.localCandidateId);s&&n(t.local,s)}if(i.remoteCandidateId){const s=e.get(i.remoteCandidateId);s&&n(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===dA.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===dA.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===dA.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(CR({},t),CR({},this.stats.selectedCandidatePair.localCandidate)),e.type===dA.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(CR({},t),CR({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(t=>t.ssrc===e.ssrc);t||(t=JI(sA),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=hA(n,t,"totalProcessingDelay","jitterBufferEmittedCount",uA.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,CR({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(null!=t&&null!=i){const s=i.lts,r=n.timestamp,a=r-s;if(a<=0)return;const o=e.concealedSamples-t.concealedSamples-0,c=i.nonSilent+o,l=e.totalSamplesReceived-t.totalSamplesReceived;if(l<=0)return;const d=80*l/a,u=200*l/a,h=a/l;let p=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,c>d&&(i.plc80>0?(e.freezeSamples80+=o,e.freezeMs80+=Math.round(o*h)):(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*h)),p=i.plc80+1);let m=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,c>u&&(i.plc200>0?(e.freezeSamples200+=o,e.freezeMs200+=Math.round(o*h)):(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*h)),m=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:o,lts:r,plc80:p,plc200:m})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(t=>t.ssrc===e.ssrc);t||(t=JI(tA),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),s=this.lastVideoFramesOutput.get(t.ssrc),r=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const i=n.stats,s=r-n.lts;t.framesDecodeFreezeTime=i.framesDecodeFreezeTime,t.framesDecodeInterval=i.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&s>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=s,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<i.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=hA(null==n?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=hA(null==n?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",uA.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=hA(null==n?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",uA.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=hA(null==n?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",uA.kMillisecondsFromSeconds),i&&r-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((r-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:r,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:r,rate:0}),t.framesDroppedCount&&e.framesReceived&&(s&&r-s.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-s.count)/((r-s.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:r,rate:Math.max(t.outputFrameRate,0)})):s?t.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:r,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CR({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(t=>t.ssrc===e.ssrc);t||(t=JI(nA),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new ZI(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new ZI(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new ZI(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-n.lastFrameCount,s=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dA.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(t=>t.ssrc===e.ssrc);if(t||(t=JI(iA),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dA.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const i=Array.from(up(n=this.report).call(n)).find(n=>n.type===t&&n.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,s,r,a;const o=t?this.report.get(t):void 0,c=null!==(i=null==o?void 0:o.framesSent)&&void 0!==i?i:e.framesSent;if("number"!=typeof c)return;let l=null!==(s=null==o?void 0:o.frameWidth)&&void 0!==s?s:e.frameWidth,d=null!==(r=null==o?void 0:o.frameHeight)&&void 0!==r?r:e.frameHeight,u=null!==(a=null==o?void 0:o.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof l&&"number"==typeof d||(l=0,d=0),null==u){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(u=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:u})):t?u=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:l,height:d,frameRate:Math.max(0,u)}}processVideoTrackReceiverStats(e,t,n){var i,s,r,a,o;const c=t?this.report.get(t):void 0,l=null!==(i=null==c?void 0:c.framesReceived)&&void 0!==i?i:e.framesReceived,d=null!==(s=null==c?void 0:c.frameWidth)&&void 0!==s?s:e.frameWidth,u=null!==(r=null==c?void 0:c.frameHeight)&&void 0!==r?r:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(o=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let i=0;e&&t-e.lts>=800?(i=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:i})):e?i=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:d||0,height:u||0,frameRate:i||0},n.decodedFrame={width:d||0,height:u||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:d||0,height:u||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const i=p-e.jitterBufferEmittedCount;i>0&&(t=1e3*(h-e.jitterBufferDelay)/i),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,s,r,a;const o=t?this.report.get(t):void 0,c=null!==(i=null!==(s=null==o?void 0:o.echoReturnLoss)&&void 0!==s?s:e.echoReturnLoss)&&void 0!==i?i:0,l=null!==(r=null!==(a=null==o?void 0:o.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==r?r:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var i,s,r,a,o,c,l,d,u;const h=t?this.report.get(t):void 0,p=null!==(i=null==h?void 0:h.removedSamplesForAcceleration)&&void 0!==i?i:e.removedSamplesForAcceleration,m=null!==(s=null==h?void 0:h.totalSamplesReceived)&&void 0!==s?s:e.totalSamplesReceived,f=null!==(r=null==h?void 0:h.jitterBufferDelay)&&void 0!==r?r:e.jitterBufferDelay,g=null!==(a=null==h?void 0:h.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,_=null!==(o=null==h?void 0:h.audioLevel)&&void 0!==o?o:null==e?void 0:e.audioLevel,y=null!==(c=null==h?void 0:h.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,v=null!==(l=null==h?void 0:h.concealedSamples)&&void 0!==l?l:e.concealedSamples,E=null!==(d=null==h?void 0:h.silentConcealedSamples)&&void 0!==d?d:e.silentConcealedSamples,b=null!==(u=null==h?void 0:h.concealmentEvents)&&void 0!==u?u:e.concealmentEvents;if("number"==typeof m&&(n.totalSamplesReceived=m),"number"==typeof E&&(n.silentConcealedSamples=E),"number"==typeof b&&(n.concealmentEvents=b),"number"==typeof v&&(n.concealedSamples=v),p&&m&&(n.accelerateRate=p/m),f&&g){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const i=g-e.jitterBufferEmittedCount;i>0&&(t=1e3*(f-e.jitterBufferDelay)/i),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:f,jitterBufferEmittedCount:g,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=_;let S=1920;y&&m&&(S=m/y/50,n.receivedFrames=Math.round(m/S)),v&&(n.droppedFrames=Math.round(v/S))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(t=>{e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(e=>{t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(e=>{n=null===n?e.diffMean():n+e.diffMean()});const i=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},mA=class extends rA{updateStats(){return np.resolve()}};function fA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const r=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return r?r<76?new aA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new pA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof np||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new pA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new mA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s})}const gA="websdk_ng_install_id";function _A(){try{if(RA("INSTALL_ID"))return RA("INSTALL_ID");let e=window.localStorage.getItem(gA);return e||(e=NI(),window.localStorage.setItem(gA,e)),CA("INSTALL_ID",e),e}catch(e){return}}const yA=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}return"4.0.0.999"}("4.24.0"),vA=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let EA=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const bA=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),s=[];for(let o=0;o<6;o++)s.push("1");const r=s.join(""),a={};return a[e]=i,a[t]=r,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=bA;const SA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},xA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},TA="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",wA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},NA=CR(CR(CR(CR({},wA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:xA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},SA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function CA(e,t,n){var i,s,r;Pi(i=Object.keys(NA)).call(i,e)&&(!n&&Pi(s=Object.keys(AA)).call(s,e)||(NA[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS"!==e||!0!==t||(NA.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(r=!!t,NA.USE_NEW_NETWORK_CONFIG=r,r&&(NA.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],NA.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],NA.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],NA.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],NA.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",NA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",NA.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(NA.ENABLE_INSTANT_VIDEO=!0,NA.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(NA.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(NA.NEW_TURN_MODE||(NA.NEW_TURN_MODE=4))))}function RA(e){return NA[e]}vA||(NA.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],NA.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],NA.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],NA.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],NA.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],NA.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],NA.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",NA.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",NA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",NA.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",NA.AREAS=["NORTH_AMERICA","OVERSEA"]);let IA=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const AA={};var OA=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(OA||{});let DA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const kA=128,PA=96,LA=1e3,jA=10;let MA=0;var UA=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>S,Printer:()=>C,parse:()=>O,print:()=>D});const i="\n",s="".concat("\r").concat(i),r=" ";let a;function o(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function m(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function f(e){return h(e)||o(e)||"+"===e||"/"===e}function g(e){return o(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function _(e){return h(e)||o(e)||"+"===e||"/"===e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){E(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));class b{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===i)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,r)}consumeOneOrMore(e,t,n){let i=t;for(;n(e[i]);)i++;if(i-t==0)throw new Error("Invalid rule at ".concat(t,"."));return i}consumeSpace(e,t){if(e[t]===r)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let i=0;i<4;i++)if(n=this.consumeDecimalUChar(e,n),3!==i){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let s=0;s<3&&o(e[n]);s++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const i=parseInt(e.slice(t,n));if(i>=0&&i<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((i=e[t+n])>="0"&&i<="9"||i>="a"&&i<="f"||i>="A"&&i<="F")){if(0===n)throw new Error("Invalid hex 4");break}var i;return t+n}consumeFQDN(e,t){let n=t;for(;o(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const i=e.slice(t,n),s=parseInt(i);if(s<224||s>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let r=0;r<3;r++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!u(e[t]))throw new Error("Invalid integer.");for(t+=1;o(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&o(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(u(e[n])&&(n+=1);o(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,r)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,o),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!u(e[t]))throw new Error("Invalid repeat interval");for(t+=1;o(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,o)}consume(e,t,n){for(let i=0;i<n.length;i++){if(t+i>=e.length)throw new Error("consume exceeding value length");if(e[t+i]!==n[i])throw new Error("consume ".concat(n," failed at ").concat(i))}return t+n.length}consumeTill(e,t,n){let i=t;for(;i<e.length&&("string"!=typeof n||e[i]!==n)&&("function"!=typeof n||!n(e[i]));)i++;return i}}class S extends b{constructor(){super(),E(this,"records",[]),E(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter(e=>!!Dv(e).call(e)).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),i=this.parseOrigin(),s=this.parseSessionName(),r=this.parseInformation(),a=this.parseUri(),o=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),d=this.parseBandWidth(),u=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),m=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:i,sessionName:s,information:r,uri:a,emails:o,phones:c,connection:l,bandwidths:d,timeFields:u,key:h,attributes:p,mediaDescriptions:m}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===i)return"\r"===e[t-1]?s:i;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new T;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,e=>d(e)&&":"!==e),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,m)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new w(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,e=>d(e)&&":"!==e),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,m)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let i=!1;"-"===e.value[e.cur]&&(i=!0,e.cur+=1);const s=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:s,back:i})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),i=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:i}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;{const n=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const i=this.extractOneOrMore(t,o);e.push({bwtype:n,bandwidth:i}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,o));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const s=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:i,nettype:s,addrtype:r,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==a.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===a.CONNECTION){const t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const i=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:i}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const i=[];for(i.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,i.push(this.extract(e,this.consumeToken));if(0===i.length)throw new Error("Invalid proto");const s=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:i,fmts:s}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===a.TIME;){const t=this.parseTime(),n=this.parseRepeat(),i=this.parseZone();e.push({time:t,repeats:n,zones:i})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),i=this.parseConnections(),s=this.parseBandWidth(),r=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:i,bandwidths:s,key:r,attributes:a})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];const r=t.call(this,e.value,e.cur,...i),a=e.value.slice(e.cur,r);return e.cur=r,a}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),i=e.value.slice(e.cur,n);return e.cur=n,i}consumeSpaceForRecord(e){if(e.value[e.cur]!==r)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class x extends b{constructor(){super(...arguments),E(this,"attributes",void 0),E(this,"digested",!1)}extractOneOrMore(e,t,n){const i=this.consumeOneOrMore(e.attValue,e._cur,t),s=e.attValue.slice(e._cur,i),[r,a]=n||[];if("number"==typeof r&&s.length<r)throw new Error("error in length, should be more or equal than ".concat(r," characters."));if("number"==typeof a&&s.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=i,s}consumeAttributeSpace(e){if(e.attValue[e._cur]!==r)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];const r=t.call(this,e.attValue,e._cur,...i),a=e.attValue.slice(e._cur,r);return e._cur=r,a}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,o);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const i=this.extract(e,this.consumeTill,r),s=v(v({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:i});this.peekChar(e)===r&&(this.consumeAttributeSpace(e),s.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(s)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class T extends x{constructor(){super(...arguments),E(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===r;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,_),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===r;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const i=this.extractOneOrMore(e,e=>e!==r&&m(e));n.push({name:t,value:i})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===r&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,r);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class w extends x{constructor(e){super(),E(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const s=this.extractOneOrMore(e,o,[1,10]);this.consumeAttributeSpace(e);const a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const d={foundation:t,componentId:n,transport:i,priority:s,connectionAddress:a,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));this.peekChar(e)===r;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:i,port:s});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const i={encodingName:n,clockRate:this.extractOneOrMore(e,o)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),i.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const s=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));s?s.rtpMap=i:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:i,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let i;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),i=this.extract(e,this.consumeTill));const s=this.attributes.ssrcs.find(e=>e.ssrcId===parseInt(t,10));s?s.attributes[n]=i:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:i}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,r);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),i={};n.split(";").forEach(e=>{let[t,n]=e.split("=");t=Dv(t).call(t);const s="string"==typeof n?Dv(n).call(n):null;"string"==typeof t&&t.length>0&&(i[t]=s)});const s=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));s?s.fmtp={parameters:i}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:i}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const i=this.extract(e,this.consumeTill,";");for(t[n]=i;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const i=this.extract(e,this.consumeTill,";");t[n]=i}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,r),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,r);let i;if("trr-int"===n)i={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===r&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===r&&(t.additional=this.extract(e,this.consumeTill))),i=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(i);else{const e=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));e?e.rtcpFeedbacks.push(i):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[i]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===r&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,d,[1,64])};this.peekChar(e)===r&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,e=>h(e)||o(e)||"_"===e||"-"===e);this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===r){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===r&&this.extract(e,this.consume,r)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const i={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(i);break}default:{const i={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),i.val=this.extract(e,this.consumeTill,";")),n.params.push(i)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,o,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,o,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C{constructor(){N(this,"eol",s)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map(e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new I(this.eol).print(e)}printMediaAttributes(e){return new A(this.eol).print(e)}}class R{constructor(e){N(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(r)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(e=>"a=fingerprint:".concat(e.hashFunction).concat(r).concat(e.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(r).concat(e.extensionName).concat(e.extensionAttributes?"".concat(r).concat(e.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol)).join("")}}class I extends R{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map(e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map(e=>"".concat(r).concat(e)).join("")).concat(this.eol)).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map(e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map(e=>"".concat(r).concat(e.name).concat(e.value?"=".concat(e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(r,"*"):e.identifierList.length>0&&(t+=e.identifierList.map(e=>"".concat(r).concat(e))),t+this.eol}}class A extends R{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map(e=>"a=candidate:".concat(e.foundation).concat(r).concat(e.componentId).concat(r).concat(e.transport).concat(r).concat(e.priority).concat(r).concat(e.connectionAddress).concat(r).concat(e.port).concat(r,"typ").concat(r).concat(e.type).concat(e.relAddr?"".concat(r,"raddr").concat(r).concat(e.relAddr):"").concat(e.relPort?"".concat(r,"rport").concat(r).concat(e.relPort):"").concat(Object.keys(e.extension).map(t=>"".concat(r).concat(t).concat(r).concat(e.extension[t])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(e=>"a=remote-candidates:".concat(e.join(r)).concat(this.eol)).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map(e=>this.printRTCPFeedback("*",e)).join("");for(const i of t)n+=this.printRtpMap(i.payloadType,i.rtpMap),n+=this.printFmtp(i.payloadType,i.fmtp),n+=i.rtcpFeedbacks.map(e=>this.printRTCPFeedback(i.payloadType,e)).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(r).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(r).concat(Object.keys(t.parameters).map(e=>"".concat(e,"=").concat(t.parameters[e])).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(r).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(r),i=t;return"trr-int"===i.type?n+="ttr-int".concat(r).concat(i.interval):(n+="".concat(i.type),i.parameter&&(n+="".concat(r).concat(i.parameter),i.additional&&(n+="".concat(r).concat(i.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(e=>Object.keys(e.attributes).map(t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(r).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(r).concat(e.netType)),e.addressType&&(t+="".concat(r).concat(e.addressType)),e.address&&(t+="".concat(r).concat(e.address)),t+this.eol}printMSId(e){return e.map(e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(r).concat(e.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(e=>"a=imageattr:".concat(e).concat(this.eol)).join("")}printRid(e){return e.map(e=>{let t="a=rid:".concat(e.id).concat(r).concat(e.direction);return e.payloads&&(t+="".concat(r,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(r).concat(e.params.map(e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)).join(";"))),t+this.eol}).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map(e=>"".concat(r).concat(e.toString(10))).join("")).concat(this.eol)).join("")}}function O(e){return(new S).parse(e)}function D(e,t){return(new C).print(e,t)}}},t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}return n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();function VA(e){return UA.parse(e)}function FA(e,t){return UA.print(e,t)}var BA=ei("Array","keys"),GA=gi,WA=et,HA=u,KA=BA,zA=Array.prototype,qA={DOMTokenList:!0,NodeList:!0},YA=function(e){var t=e.keys;return e===zA||HA(zA,e)&&t===zA.keys||WA(qA,GA(e))?KA:t},XA=i(YA);function JA(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ZA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QA(Object(n),!0).forEach(function(t){JA(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const $A=new class extends HR{constructor(){super(...arguments),JA(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class eO{constructor(e){JA(this,"logger",void 0),JA(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function nO(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const iO={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},sO=Date.now(),rO=e=>{for(const t in iO)if(Object.prototype.hasOwnProperty.call(iO,t)&&iO[t]===e)return t;return"DEFAULT"},aO=new class{constructor(){JA(this,"proxyServerURL",void 0),JA(this,"logLevel",iO.DEBUG),JA(this,"uploadState","collecting"),JA(this,"uploadLogWaitingList",[]),JA(this,"uploadLogUploadingList",[]),JA(this,"uploadErrorCount",0),JA(this,"currentLogID",0),JA(this,"url",void 0),JA(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[iO.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[iO.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[iO.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[iO.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[iO.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){CA("UPLOAD_LOG",!0)}disableLogUpload(){CA("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new eO(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-sO<100)return void setTimeout(()=>{this.log(...t)},Date.now()-sO);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=tO()+" Agora-SDK [".concat(rO(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const s=tO()+" %cAgora-SDK [".concat(rO(i),"]:");let r=[];if(!RA("USE_NEW_LOG"))switch(i){case iO.DEBUG:r=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,r);break;case iO.INFO:r=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,r);break;case iO.WARNING:r=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,r);break;case iO.ERROR:r=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,r)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-sO<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-sO);const i=Math.max(0,Math.min(4,t[0]));t[0]=tO()+" Agora-SDK [".concat(rO(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!RA("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=nO()+" Agora-SDK [".concat(rO(e),"]:"):n[0]=nO()+" Agora-SDK [".concat(rO(e),"]:");let s="";n.forEach(e=>{"object"==typeof e&&(e=JSON.stringify(e)),s+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:yA,process_id:RA("PROCESS_ID"),payload:JSON.stringify(e)};return GI(async()=>{const e=await jC.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(RA("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(RA("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}},()=>(this.uploadLogUploadingList=[],!1),t=>{const n={status:-1,message:t.message,errorRange:e.map(e=>e.log_item_id)};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),$A.reportLogUploadError(n),!0},{timeout:RA("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:RA("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,RA("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var oO;function cO(e){return PR(e.reportId,"params.reportId",0,100,!1),PR(e.category,"params.category",0,100,!1),PR(e.event,"params.event",0,100,!1),PR(e.label,"params.label",0,100,!1),DR(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(oO={}).FREE="free",oO.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const lO={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let dO=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),uO=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let hO=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function pO(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,i){const s=i.value;if("function"==typeof s){const r=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);i.value=function(){for(var t,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];let c=a;if(e.argsMap)try{c=e.argsMap(this,...a)}catch(e){aO.warning(e),c=[]}try{JSON.stringify(c)}catch(e){aO.warning("arguments for method ".concat(r,".").concat(String(n)," not serializable for apiInvoke.")),c=[]}const l=(e.report||mO).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(r,".").concat(String(n)),options:c,tag:YR.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=s.apply(this,a);return t instanceof np?t.then(t=>(l.onSuccess(e.reportResult&&t),t)).catch(e=>{throw l.onError(e),e}):(l.onSuccess(e.reportResult&&t),t)}catch(e){throw l.onError(e),e}}}return i}}const mO=new class{constructor(){JA(this,"baseInfoMap",new Map),JA(this,"proxyServer",void 0),JA(this,"eventUploadTimer",void 0),JA(this,"setSessionIdTimer",void 0),JA(this,"url",void 0),JA(this,"sids",new Set),JA(this,"backupUrl",void 0),JA(this,"_appId",void 0),JA(this,"_aid",0),JA(this,"keyEventUploadPendingItems",[]),JA(this,"normalEventUploadPendingItems",[]),JA(this,"apiInvokeUploadPendingItems",[]),JA(this,"apiInvokeCount",0),JA(this,"apiInvokeLoggedCount",0),JA(this,"ltsList",[]),JA(this,"lastSendNormalEventTime",Date.now()),JA(this,"customReportCounterTimer",void 0),JA(this,"customReportCount",0),JA(this,"extApiInvoke",async e=>{for(const t of e){const e=ZA(ZA({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:YR.TRACER});this.sendApiInvoke(e)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),RA("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),RA("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,n]=e;return t+n}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,r=!!RA("SHOW_REPORT_INVOKER_LOG"),a=!!RA("SHOW_REPORT_USER_INVOKER_LOG"),o=r||a&&t.id;o&&(this.apiInvokeLoggedCount+=1);const c=this.apiInvokeLoggedCount;function l(e,n){if(o){let i="[apiInvoke-".concat(c,"]");if(t.id&&(i+="[".concat(t.id,"]")),t.name&&(i+="[".concat(t.name,"]"),t.name===qR.JOIN))return aO.info("".concat(i," ").concat(e));aO.info("".concat(i," ").concat(e),"start"===e?t.options:n||"")}}const d=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});l("start");let u=!1;TI(t.timeout).then(()=>{u||(this.sendApiInvoke(ZA(ZA({},d()),{},{error:RR.API_INVOKE_TIMEOUT,success:!1})),l("timeout"))});const h=new IR(RR.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const i=()=>{if(u)throw h;return u=!0,this.sendApiInvoke(ZA(ZA({},d()),{},{success:!0},t.reportResult&&{result:e})),l("onSuccess"),e};return n?II(i,t.name+"Success",n,()=>u=!0):i()},onError:e=>{const i=()=>{if(u)throw e;u=!0,this.sendApiInvoke(ZA(ZA({},d()),{},{success:!1,error:e})),l("onFailure",e.toString())};return n?II(i,t.name+"Error",n,()=>u=!0):i()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const s=Object.assign({},{willUploadConsoleLog:RA("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:vA?"global":"oversea",areas:RA("AREAS")&&RA("AREAS").join(",")},t.extend),{stringUid:r,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientRole:d}=t,u=Date.now(),h=ZA(ZA({},i),{},{eventType:dO.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:TA,lts:u,elapse:u-n,extend:JSON.stringify(s),mode:t.mode,process:RA("PROCESS_ID"),appType:RA("APP_TYPE"),success:!0,version:yA,stringUid:r,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientType:Pi(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:d,serviceId:RA("PROCESS_ID"),extensionID:RA("PLUGIN_INFO").join(",")||""});var p;this.send({type:uO.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA({},i),{},{role:t.role,eventType:dO.JOIN_CHOOSE_SERVER,lts:s,eventElapse:t.elapse||s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:uO.JOIN_CHOOSE_SERVER,data:r},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA({},i),{},{eventType:dO.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||s-n.startTime,eventElapse:s-t.lts,extend:JSON.stringify(t.extend)});this.send({type:uO.REQ_USER_ACCOUNT,data:r},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const s=Date.now(),{firstSuccess:r,addr:a,isProxy:o}=t,c=s-n.startTime,l=ZA(ZA({},i),{},{eventType:dO.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:s-t.lts,firstSuccess:r,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:_A(),isABTestSuccess:t.isABTestSuccess?1:0}),d=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=s),r)this.send({type:uO.JOIN_GATEWAY,data:l},!0);else{let e;if(a)if(o){const t=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=a.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:o?1:0}}else{const t=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=a.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:o?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:o?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const t=Object.assign({},l,e,{eventType:dO.REJOIN_GATEWAY});this.send({type:uO.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),s=ZA(ZA({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:uO.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA({},i),{},{eventType:dO.PUBLISH,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:uO.PUBLISH,data:r},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,r=Date.now(),a=ZA(ZA({},s),{},{eventType:dO.SUBSCRIBE,lts:r,eventElapse:t.eventElapse,elapse:r-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:uO.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...XA(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",s=this.baseInfoMap.get(i);if(!s)return;const r=s.info,a=Date.now(),o=ZA(ZA({},r),{},{eventType:dO.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-s.startTime,status:e.status?1:2});this.send({type:uO.WS_COMPRESSOR_INIT,data:o},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=t.peerPubStatusMs-(n.lastJoinSuccessTime||s),a=ZA(ZA({},i),{},{elapse:s-n.startTime,eventType:dO.XLA_PEER_FIRST_VIDEO_FRAME,lts:s,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:r,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>r?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:uO.XLA_PEER_FIRST_VIDEO_FRAME,data:a},!0)}firstRemoteVideoDecode(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,a=Date.now(),o=ZA(ZA(ZA({},r),i),{},{elapse:a-s.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((i.firstFrame||a)-s.startTime,0),apEnd:Math.max(i.apEnd-s.startTime,0),apStart:Math.max(i.apStart-s.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-s.startTime,0),joinGwStart:Math.max(i.joinGwStart-s.startTime,0),pcEnd:Math.max(i.pcEnd-s.startTime,0),pcStart:Math.max(i.pcStart-s.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-s.startTime,0),subscriberStart:Math.max(i.subscriberStart-s.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-s.startTime,0)});this.send({type:n,data:o},!0)}firstRemoteFrame(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,a=Date.now(),o=ZA(ZA(ZA({},r),i),{},{elapse:a-s.startTime,eventType:t,lts:a});this.send({type:n,data:o},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA(ZA({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:s-n.startTime,eventType:dO.AB_TEST,lts:s});this.send({type:uO.AB_TEST,data:r},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA(ZA({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:s-n.startTime,eventType:dO.PC_STATS,lts:s,preallocation:t.preallocation?1:0});this.send({type:uO.PC_STATS,data:r},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA(ZA({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),eventType:dO.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:uO.UPDATE_REMOTE_RTPCAPABILITIES,data:r},!0)}}onGatewayStream(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,a=Date.now(),o=ZA(ZA(ZA({},r),i),{},{eventType:t,lts:a});this.send({type:n,data:o},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA({},i),{},{eventType:dO.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-n.startTime,success:t.succ});this.send({type:uO.STREAM_SWITCH,data:r},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA({},i),{},{eventType:dO.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_APPCENTER,data:r},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA({},i),{},{eventType:dO.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_WORKER_MANAGER,data:r},!0)}setProxyServer(e){this.proxyServer=e,e?aO.debug("reportProxyServerurl: ".concat(e)):aO.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-n.startTime,joinChannelSuccessElapse:s-(n.lastJoinSuccessTime||s),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:uO.PEER_PUBLISH_STATUS,data:r},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now();(function(e,t,n){const i=e[t];if(!i||"string"!=typeof i)return[e];e[t]="";const s=bI(JSON.stringify(e));let r=0;const a=[];let o=0;for(let c=0;c<i.length;c++)o+=i.charCodeAt(c)<=127?1:3,o<=n-s||(a[a.length]=CR(CR({},e),{},{[t]:i.substring(r,c)}),r=c,o=i.charCodeAt(c)<=127?1:3);return r!==i.length-1&&(a[a.length]=CR(CR({},e),{},{[t]:i.substring(r)})),a})(ZA(ZA(ZA({},i),t),{},{elapse:s-n.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(e=>this.send({type:uO.WORKER_EVENT,data:e},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA(ZA({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:uO.AP_WORKER_EVENT,data:r},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA(ZA({},i),t),{},{elapse:s-n.startTime,lts:s,extend:t.extend||void 0});this.send({type:uO.JOIN_WEB_PROXY_AP,data:r},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),r=ZA(ZA(ZA({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:uO.WEBSOCKET_QUIT,data:r},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>RA("CUSTOM_REPORT_LIMIT"))throw new IR(RR.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(t=>({type:uO.USER_ANALYTICS,data:ZA(ZA({sid:e},t),{},{lts:n})}));try{RA("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(e){throw aO.error("send custom report message failed",e.toString()),new IR(RR.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=RA("NOT_REPORT_EVENT");if(e.tag&&Pi(t)&&Pi(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:r}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof IR){const{code:t,message:n}=e.error;a=t||n||e.error.toString()}else a=e.error.toString();const o={invokeId:e.invokeId,sid:e.sid,cname:i,cid:r,uid:s,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:uO.API_INVOKE,data:o},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find(e=>null!==e);t&&e.forEach(e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>RA("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):i.push(t)}e.push(...i);for(const r of[...n]){var s;-1!==this.ltsList.indexOf(r.data.lts)?(r.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(r.data.lts)):(this.ltsList.push(r.data.lts),Xp(s=this.ltsList).call(s,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=Date.now()),RA("ENABLE_EVENT_REPORT")?(n.length&&(RA("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{RA("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>RA("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-RA("NORMAL_EVENT_QUEUE_CAPACITY")),aO.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){lI.networkState===iI.OFFLINE&&await np.race([lI.onlineWaiter,TI(2*FI.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach(e=>{const n=BR(JSON.stringify(e.data)),i=new ArrayBuffer(5),s=(e=>{let t=0;return Object.entries(uO).forEach(n=>{let[i,s]=n;s===e.type&&(t=hO[i])}),t})(e),r=new DataView(i);r.setUint16(0,n.byteLength,!0),r.setUint8(2,255&s),r.setUint8(3,s>>>8&255),r.setUint8(4,s>>>16&255),t=GR(t,new Uint8Array(i)),t=GR(t,n)}),t},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(RA("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let s=0;s<2;s+=1){1===s&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(RA("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await qI(i,{timeout:1e4,data:t(e),headers:ZA(ZA({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===s)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),i=n?void 0:this._aid,s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(e=>JSON.stringify(e)),vid:n,aid:i};lI.networkState===iI.OFFLINE&&await np.race([lI.onlineWaiter,TI(2*FI.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("EVENT_REPORT_DOMAIN"),"&p=").concat(RA("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(RA("EVENT_REPORT_DOMAIN"),":").concat(RA("STATS_COLLECTOR_PORT")).concat(r));for(let o=0;o<2;o+=1){1===o&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(RA("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(RA("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(RA("STATS_COLLECTOR_PORT")).concat(r)));try{t?await YI(a,{timeout:1e4,data:s}):await qI(a,{timeout:1e4,data:s})}catch(t){if(1===o)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},lO);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:YR.TRACER}).onSuccess()}};$A.on("REPORT_LOG_UPLOAD",e=>{e.networkState=lI.networkState,mO.reportApiInvoke(null,{name:"logUploadError",options:e,tag:YR.TRACER}).onSuccess("logUploadError")});class fO extends IR{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),JA(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,aO)}throw(){super.throw(aO)}}const gO={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function _O(){return gO}function yO(){return"setSinkId"in HTMLAudioElement.prototype&&(!RA("RESTRICTION_SET_PLAYBACK_DEVICE")||(ZC()||tR())&&!bR())}function vO(){return!gO.supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&SR()}function EO(e){return!(nR()||rR(87)||vO()||!RA("ENABLE_PRE_SUB")&&(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB")))}function bO(e){return!!RA("ENABLE_INSTANT_VIDEO")||!(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB"))}let SO=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function xO(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function TO(e,t,n,i,s){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:s}}function wO(e,t,n,i,s){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:s}}function NO(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const CO={"90p":TO(160,90),"90p_1":TO(160,90),"120p":TO(160,120,15,30,65),"120p_1":TO(160,120,15,30,65),"120p_3":TO(120,120,15,30,50),"120p_4":TO(212,120),"180p":TO(320,180,15,30,140),"180p_1":TO(320,180,15,30,140),"180p_3":TO(180,180,15,30,100),"180p_4":TO(240,180,15,30,120),"240p":TO(320,240,15,40,200),"240p_1":TO(320,240,15,40,200),"240p_3":TO(240,240,15,40,140),"240p_4":TO(424,240,15,40,220),"360p":TO(640,360,15,80,400),"360p_1":TO(640,360,15,80,400),"360p_3":TO(360,360,15,80,260),"360p_4":TO(640,360,30,80,600),"360p_6":TO(360,360,30,80,400),"360p_7":TO(480,360,15,80,320),"360p_8":TO(480,360,30,80,490),"360p_9":TO(640,360,15,80,800),"360p_10":TO(640,360,24,80,800),"360p_11":TO(640,360,24,80,1e3),"480p":TO(640,480,15,100,500),"480p_1":TO(640,480,15,100,500),"480p_2":TO(640,480,30,100,1e3),"480p_3":TO(480,480,15,100,400),"480p_4":TO(640,480,30,100,750),"480p_6":TO(480,480,30,100,600),"480p_8":TO(848,480,15,100,610),"480p_9":TO(848,480,30,100,930),"480p_10":TO(640,480,10,100,400),"720p":TO(1280,720,15,120,1130),"720p_auto":TO(1280,720,30,900,3e3),"720p_1":TO(1280,720,15,120,1130),"720p_2":TO(1280,720,30,120,2e3),"720p_3":TO(1280,720,30,120,1710),"720p_5":TO(960,720,15,120,910),"720p_6":TO(960,720,30,120,1380),"1080p":TO(1920,1080,15,120,2080),"1080p_1":TO(1920,1080,15,120,2080),"1080p_2":TO(1920,1080,30,120,3e3),"1080p_3":TO(1920,1080,30,120,3150),"1080p_5":TO(1920,1080,60,120,4780),"1440p":TO(2560,1440,30,120,4850),"1440p_1":TO(2560,1440,30,120,4850),"1440p_2":TO(2560,1440,60,120,7350),"4k":TO(3840,2160,30,120,8910),"4k_1":TO(3840,2160,30,120,8910),"4k_3":TO(3840,2160,60,120,13500)},RO={"480p":wO(640,480,5),"480p_1":wO(640,480,5),"480p_2":wO(640,480,30),"480p_3":wO(640,480,15),"720p":wO(1280,720,5),"720p_auto":TO(1280,720,30,900,3e3),"720p_1":wO(1280,720,5),"720p_2":wO(1280,720,30),"720p_3":wO(1280,720,15),"1080p":wO(1920,1080,5),"1080p_1":wO(1920,1080,5),"1080p_2":wO(1920,1080,30),"1080p_3":wO(1920,1080,15)},IO={"1SL1TL":NO(1,1),"3SL3TL":NO(3,3),"2SL3TL":NO(2,3)};function AO(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},CO[e]):e}function OO(e){return"string"==typeof e?Object.assign({},RO[e]):e}function DO(e){return"string"==typeof e?Object.assign({},IO[e]):e}const kO={speech_low_quality:xO(16e3,!1),speech_standard:xO(32e3,!1,18),music_standard:xO(48e3,!1),standard_stereo:xO(48e3,!0,56),high_quality:xO(48e3,!1,128),high_quality_stereo:xO(48e3,!0,192)};function PO(e){return"string"==typeof e?Object.assign({},kO[e]):e}const LO=[];function jO(e){return OR(e,"mediaSource",["screen","window","application"]),!0}let MO=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),UO=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),VO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),FO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),BO=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),GO=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),WO=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),HO=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),KO=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),zO=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const qO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},XO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},JO={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ZO=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),$O=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),eD=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),tD=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),nD=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),iD=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const sD={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let rD=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function aD(e,t,n,i,s){var r,a,o={};return Object.keys(i).forEach(function(e){o[e]=i[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=ss(r=_s(a=n.slice()).call(a)).call(r,function(n,i){return i(e,t,n)||n},o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function oD(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function lD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cD(Object(n),!0).forEach(function(t){oD(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cD(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class dD extends HR{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(GO.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),oD(this,"trackMediaType",void 0),oD(this,"_ID",void 0),oD(this,"_rtpTransceiver",void 0),oD(this,"_lowRtpTransceiver",void 0),oD(this,"_hints",[]),oD(this,"_isClosed",!1),oD(this,"_originMediaStreamTrack",void 0),oD(this,"mediaStreamTrack",void 0),oD(this,"_external",{}),this._ID=t||wI(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Pi(LO).call(LO,e)||LO.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||gI(()=>{var e;mO.reportApiInvoke(null,{name:qR.GET_MEDIA_STREAM_TRACK,options:[],tag:YR.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===VO.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=LO.indexOf(e);-1!==t&&LO.splice(t,1)}(this),this.emit(WO.CLOSED),this.removeAllListeners(GO.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===VO.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(GO.TRANSCEIVER_UPDATED,e,t)}}class uD extends dD{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),oD(this,"_enabled",!0),oD(this,"_muted",!1),oD(this,"_isExternalTrack",!1),oD(this,"_isClosed",!1),oD(this,"_enabledMutex",void 0),oD(this,"processor",void 0),oD(this,"_processorContext",void 0),oD(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new UI("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,aO.debug("[".concat(this.getTrackId(),"] close")),this.emit(MO.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}stateCheck(e,t){if(aO.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),AR(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new IR(RR.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",aO);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new IR(RR.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",aO)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():np.resolve([])}}const hD=window.AudioContext||window.webkitAudioContext;let pD=null;const mD=new class extends HR{constructor(){super(...arguments),oD(this,"prevState",void 0),oD(this,"curState",void 0),oD(this,"currentTime",void 0),oD(this,"currentTimeStuckAt",void 0),oD(this,"interruptDetectorTrack",void 0),oD(this,"onLocalAudioTrackMute",()=>{aO.info("ios15-interruption-start"),this.emit(SO.IOS_15_16_INTERRUPTION_START)}),oD(this,"onLocalAudioTrackUnmute",async()=>{aO.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?aO.info("ios15-interruption-end-canceled"):(pD&&await pD.suspend(),this.emit(SO.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){aO.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){aO.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function fD(){if(!pD){if(function(){if(!hD)return void aO.error("your browser is not support web audio");aO.info("create audio context");const e=lD({},RA("WEBAUDIO_INIT_OPTIONS"));aO.debug("audio context init option:",JSON.stringify(e)),pD=new hD(e),mD.curState=pD.state,pD.onstatechange=()=>{mD.prevState=mD.curState,mD.curState=pD?pD.state:void 0;const{prevState:e,curState:t}=mD,n="running"===t,i="interrupted"===t,s="running"===e,r="suspended"===e,a="interrupted"===e,o=qC().osVersion;(iR()||yR())&&s&&i&&(aO.info("ios".concat(o,"-interruption-start")),mD.emit(SO.IOS_INTERRUPTION_START)),(iR()||yR())&&(r||a)&&n&&(aO.info("ios".concat(o,"-interruption-end")),mD.emit(SO.IOS_INTERRUPTION_END)),e!==t&&mD.emit(SO.STATE_CHANGE,t,e)},setInterval(()=>{var e;const t=null===(e=pD)||void 0===e?void 0:e.currentTime;mD.currentTime!==t?(mD.currentTimeStuckAt&&(aO.debug("AudioContext current time resume at ".concat(t)),mD.currentTimeStuckAt=void 0),mD.currentTime=t):(t!==mD.currentTimeStuckAt&&(mO.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:YR.TRACER}).onSuccess(),aO.warning("AudioContext current time stuck at ".concat(t))),mD.currentTimeStuckAt=t)},5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,i=!1,s=!1,r=!1;function a(t){"running"===e.state?o(!1):iR()||yR()?"suspended"===e.state&&(o(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(o(!0),t&&e.resume().then(c,c))}function o(e){if(i!==e){i=e;for(let n=0,i=t;n<i.length;n+=1){const t=i[n];e?window.addEventListener(t,l,{capture:!0,passive:!0}):window.removeEventListener(t,l,{capture:!0,passive:!0})}}}function c(){a(!1)}function l(){a(!0)}function d(e){if(!r)if(n.paused)if(e){let t;u(!1),r=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else u(!0);else u(!1)}function u(e){if(s!==e){s=e;for(let n=0,i=t;n<i.length;n++){const t=i[n];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),r=!1,d(!1)}function p(){d(!0)}if(iR()){const t=e.createMediaStreamDestination(),i=document.createElement("div");i.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=i.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,d(!0)}mD.on(SO.STATE_CHANGE,function(){a(!0)}),a(!1)}(pD)}(),!pD)throw new IR(RR.NOT_SUPPORTED,"can not create audio context");return pD}return pD}function gD(e){if(function(){if(null!==_D)return _D;const e=fD(),t=e.createBufferSource(),n=e.createGain(),i=e.createGain();t.connect(n),t.connect(i),t.disconnect(n);let s=!1;try{t.disconnect(n)}catch(e){s=!0}return t.disconnect(),_D=s,s}())return;const t=e.connect,n=e.disconnect;e.connect=(n,i,s)=>{var r;return e._inputNodes||(e._inputNodes=[]),Pi(r=e._inputNodes).call(r,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,i,s)):t.call(e,n,i)),e},e.disconnect=(i,s,r)=>{n.call(e),i?dI(e._inputNodes,i):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let _D=null;function yD(e,t){let n=!1;const i=1/t;if(RA("DISABLE_WEBAUDIO")){const t=window.setInterval(()=>{n?window.clearInterval(t):e(performance.now()/1e3)},1e3*i)}else{const t=fD();let s=t.createGain();s.gain.value=0,s.connect(t.destination);const r=()=>{if(n)return void(s=null);const a=t.createOscillator();a.onended=r,a.connect(s),a.start(0),a.stop(t.currentTime+i),e(t.currentTime)};r()}return()=>{n=!0}}class vD{constructor(){oD(this,"context",void 0),oD(this,"analyserNode",void 0),oD(this,"sourceNode",void 0),this.context=fD(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||iR()||yR()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=ss(e).call(e,(e,t)=>e+t*t,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){aO.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class ED extends HR{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),oD(this,"outputNode",void 0),oD(this,"outputTrack",void 0),oD(this,"isPlayed",!1),oD(this,"sourceNode",void 0),oD(this,"context",void 0),oD(this,"audioBufferNode",void 0),oD(this,"destNode",void 0),oD(this,"audioOutputLevel",0),oD(this,"volumeLevelAnalyser",void 0),oD(this,"_processedNode",void 0),oD(this,"playNode",void 0),oD(this,"isDestroyed",!1),oD(this,"onNoAudioInput",void 0),oD(this,"isNoAudioInput",!1),oD(this,"_noAudioInputCount",0),this.context=fD(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),gD(this.outputNode),this.volumeLevelAnalyser=new vD}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(zO.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!_O().webAudioMediaStreamDest)throw new IR(RR.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&hI(()=>{mD.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;iR()||yR()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let i=!1;for(let s=0;s<n.length;s++)0!==n[s]&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await TI(200),await this.checkHasAudioInput(e?e+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bD extends ED{get isFreeze(){return!1}constructor(e,t,n){var i;if(super(),oD(this,"sourceNode",void 0),oD(this,"track",void 0),oD(this,"clonedTrack",void 0),oD(this,"audioElement",void 0),oD(this,"isCurrentTrackCloned",!1),oD(this,"isRemoteTrack",!1),oD(this,"originVolumeLevelAnalyser",void 0),oD(this,"rebuildWebAudio",async()=>{if(aO.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void aO.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>aO.info("resume success")),aO.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),gD(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),gD(this.outputNode),this.emit(zO.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),"audio"!==e.kind)throw new IR(RR.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(s),gD(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,aO.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));gD(t),this.originVolumeLevelAnalyser=new vD,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const r=qC();t&&r.os===GC.IOS&&Number(null===(i=r.osVersion)||void 0===i?void 0:i.split(".")[0])<15&&(mD.on(SO.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),gD(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(zO.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),mD.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),aO.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));gD(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function SD(e,t,n){const i=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,s={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function xD(e,t){const n=await TD(e.mediaSource),{sourceId:i,audio:s}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new np((n,i)=>{const s=document.createElement("div");s.innerText="share screen",s.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const r=document.createElement("div");r.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",i(e)};let d=t;const u=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=d,e.onchange=()=>{d=e.checked},u.appendChild(e),u.appendChild(t)}c.appendChild(u),c.appendChild(l),r.appendChild(a),r.appendChild(o),r.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(s),h.appendChild(r),document.body.appendChild(h),e.map(e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let i=e.thumbnail;try{const{width:e}=i.getSize();e>1920&&(i=i.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+i.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:d})},o.appendChild(t)}})})}(n,t);return await SD(i,e,s)}async function TD(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=zR();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new IR(RR.ELECTRON_IS_NULL);let i=null;try{var s;i=(null===(s=n.desktopCapturer)||void 0===s?void 0:s.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){i=null}i&&i.then||(i=new np((e,i)=>{n.desktopCapturer.getSources({types:t},(t,n)=>{t?i(t):e(n)})}));try{return await i}catch(e){throw new IR(RR.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const wD=new UI("safari");let ND=!1,CD=!1;async function RD(e,t){let n=0,i=null;for(;n<2;)try{i=await ID(e,t,n>0);break}catch(e){if(e instanceof IR)throw aO.error("[".concat(t,"] ").concat(e.toString())),e;const i=AD(e.name||e.code||e,e.message);if(i.code===RR.MEDIA_OPTION_INVALID){aO.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await TI(500);continue}throw aO.error("[".concat(t,"] ").concat(i.toString())),i}if(!i)throw new IR(RR.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function ID(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new IR(RR.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=_O(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return aO.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(zR())e.screen.sourceId?OD(s,await SD(e.screen.sourceId,e.screen,!!e.screenAudio)):OD(s,await xD(e.screen,!!e.screenAudio));else if(ZC()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new IR(RR.NOT_SUPPORTED,"This browser does not support screen sharing");aO.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(a=e.screen.extensionId,o=t,new np((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},n=>{if(!n||!n.streamId)return aO.error("[".concat(o,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new IR(RR.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)})}catch(e){aO.error("[".concat(o,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),e.toString()),t(new IR(RR.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=n,OD(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var r;e.screen.mediaSource&&jO(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(r=e.screen.displaySurface)&&void 0!==r?r:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:i,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c}=e.screen,l={selfBrowserSurface:i,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c};!i&&delete l.selfBrowserSurface,!a&&delete l.surfaceSwitching,!o&&delete l.systemAudio,!c&&delete l.preferCurrentTab,aO.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:e.screenAudio,controls:l})),OD(s,await navigator.mediaDevices.getDisplayMedia(lD({video:n,audio:e.screenAudio},l)))}else{if(!nR())throw aO.error("[".concat(t,"] This browser does not support screenSharing")),new IR(RR.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&jO(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};aO.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),OD(s,await navigator.mediaDevices.getUserMedia(n))}}var a,o;if(!e.video&&!e.audio)return s;let c={video:e.video,audio:e.audio},l=RA("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=OI(c,l)}catch(e){}aO.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),qC();let d,u=null;($C()||iR()||QC())&&(u=await wD.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw u&&u(),e}return c.audio&&(ND=!0),c.video&&(CD=!0),OD(s,d),u&&u(),s}function AD(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new IR(RR.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new IR(RR.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new IR(RR.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new IR(RR.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new IR(RR.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new IR(RR.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return aO.error("getUserMedia unexpected error",e),new IR(RR.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function OD(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],s=t.getVideoTracks()[0],r=t.getAudioTracks()[0];r&&(i&&e.removeTrack(i),e.addTrack(r)),s&&(n&&e.removeTrack(n),e.addTrack(s))}const DD=new class extends HR{get state(){return this._state}set state(e){e!==this._state&&(this.emit(tD.STATE_CHANGE,e),this._state=e)}constructor(){super(),oD(this,"_state",eD.IDLE),oD(this,"isAccessMicrophonePermission",!1),oD(this,"isAccessCameraPermission",!1),oD(this,"lastAccessMicrophonePermission",!1),oD(this,"lastAccessCameraPermission",!1),oD(this,"checkdeviceMatched",!1),oD(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(RA("ENUMERATE_DEVICES_INTERVAL")||(xR()||XC()===GC.HARMONY_OS)&&SR())&&this.updateDevicesInfo()},RA("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>aO.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new IR(RR.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let r=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;s.audio&&(r=!1),s.video&&(a=!1);let o=null,c=null,l=null;if(!n&&(r||a)){if(wD.isLocked&&(aO.debug("[device manager] wait GUM lock"),(await wD.lock())(),aO.debug("[device manager] GUM unlock")),ND&&(r=!1,this.isAccessMicrophonePermission=!0),CD&&(a=!1,this.isAccessCameraPermission=!0),aO.debug("[device manager] check media device permissions",e,t,r,a),r&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=AD(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(r){try{o=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=AD(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=AD(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}aO.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,e}catch(e){return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,new IR(RR.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audioinput"===e.kind)}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(e=>"videoinput"===e.kind)}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audiooutput"===e.kind)}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===e);if(!t)throw new IR(RR.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=eD.INITING;try{await this.updateDevicesInfo(),this.state=eD.INITEND}catch(e){throw aO.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=eD.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new IR(RR.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find(e=>"audioinput"===e.kind&&"default"===e.deviceId),n=e.find(e=>"audiooutput"===e.kind&&"default"===e.deviceId);t&&n?n.groupId===t.groupId?aO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):aO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):aO.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(e=>{if(!e.deviceId)return;const i=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(i?i.state:"INACTIVE")){const i={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),i),n.push(i)}i&&(i.updateAt=t)}),this.deviceInfoMap.forEach((e,i)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))}),this.state!==eD.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tD.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(tD.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tD.PLAYOUT_DEVICE_CHANGED,e)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(e=>"audioinput"===e.kind),n=e.filter(e=>"videoinput"===e.kind),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of n)if(s.label&&s.deviceId){i.video=!0;break}return i}};let kD=!1;const PD=new class extends HR{constructor(){super(...arguments),oD(this,"onAutoplayFailed",void 0),oD(this,"onAudioAutoplayFailed",void 0)}};function LD(){if(qC(),!kD){const e=t=>{t.preventDefault(),kD=!1,TR()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};kD=!0,TR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),aO.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),PD.onAutoplayFailed?PD.onAutoplayFailed():PD.onAudioAutoplayFailed?aO.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):aO.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),PD.emit("autoplay-failed")}}function jD(e,t,n,i){if(!e)return;const s=mO.getBaseInfoBySessionId(e);if(!s)return;const r=s.info,a=Date.now(),o=lD(lD({},r),{},{vid:void 0===r.vid?0:Number(r.vid),lts:a,elapse:a-s.startTime,cbRegistered:PD.onAutoplayFailed||PD.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});mO.send({type:uO.AUTOPLAY_FAILED,data:o},!0)}const MD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],UD=new class{constructor(){oD(this,"onAutoplayFailed",void 0),oD(this,"elementMap",new Map),oD(this,"elementStateMap",new Map),oD(this,"elementsNeedToResume",[]),oD(this,"sinkIdMap",new Map),oD(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,i]=t;const s=this.elementStateMap.get(n),r=i.srcObject.getAudioTracks()[0],a=r&&r.readyState;if(aO.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return i.pause(),void i.play();if("running"===mD.curState)return fR()?(i.pause(),void i.play()):void(s&&"paused"===s&&i.play())}})}),oD(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&"live"===i.readyState&&(aO.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),mD.on(SO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mD.on(SO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),mD.on(SO.STATE_CHANGE,()=>{iR()&&"suspended"===mD.prevState&&"running"===mD.curState&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new IR(RR.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,nD.INIT),this.setVolume(t,n);const r=this.sinkIdMap.get(t);if(r)try{s.setSinkId(r).catch(e=>{aO.warning("[".concat(t,"] set sink id failed"),e.toString())})}catch(e){aO.warning("[".concat(t,"] set sink id failed"),e.toString())}const a=s.play();a&&a.then&&a.catch(e=>{i&&jD(i,"audio",e.message,t),aO.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(aO.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),hI(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),LD()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){MD.forEach(n=>{t.addEventListener(n,n=>{const i=this.elementStateMap.get(e),s="pause"===n.type?"paused":n.type;if(aO.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),"error"===n.type){const n=null==t?void 0:t.error;n&&aO.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(e=>{aO.debug("Auto resume audio element success")}).catch(e=>{aO.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new np(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{TR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function VD(){return function(e,t,n){const i=n.value;return"function"==typeof i&&(n.value=function(){this._isClosed&&new IR(RR.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",aO);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=i.apply(this,t);return s instanceof np?new np((e,t)=>{s.then(e).catch(t)}):s}),n}}class FD extends HR{constructor(e){super(),oD(this,"name","VideoProcessorDestination"),oD(this,"ID","0"),oD(this,"_source",void 0),oD(this,"videoContext",void 0),oD(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new IR(RR.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new IR(RR.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ZO.ON_TRACK,void 0)}}class BD extends HR{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),oD(this,"constraintsMap",new Map),oD(this,"statsRegistry",[]),oD(this,"usageRegistry",[]),oD(this,"trackId",void 0),oD(this,"direction",void 0),oD(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await rI(this,$O.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return aO.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:i,cb:s}of this.statsRegistry)try{const r=s();e.push({processorID:t,processorName:n,type:i,stats:r})}catch(e){aO.error(new IR(RR.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(lD(lD({},n),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class GD extends HR{constructor(e){super(),oD(this,"name","AudioProcessorDestination"),oD(this,"ID","0"),oD(this,"inputTrack",void 0),oD(this,"inputNode",void 0),oD(this,"audioProcessorContext",void 0),oD(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new IR(RR.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new IR(RR.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ZO.ON_TRACK,void 0),this.emit(ZO.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(ZO.ON_NODE,this.inputNode))}}class WD extends HR{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),oD(this,"constraintsMap",new Map),oD(this,"statsRegistry",[]),oD(this,"audioContext",void 0),oD(this,"trackId",void 0),oD(this,"direction",void 0),oD(this,"usageRegistry",[]),oD(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return rI(this,$O.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:i,cb:s}of this.statsRegistry)try{const r=s();e.push({processorID:t,processorName:n,type:i,stats:r})}catch(e){aO.error(new IR(RR.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(lD(lD({},n),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class HD extends HR{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),oD(this,"context",void 0),oD(this,"processSourceNode",void 0),oD(this,"outputTrack",void 0),oD(this,"processedNode",void 0),oD(this,"clonedTrack",void 0),oD(this,"outputNode",void 0),this.outputNode=new KD}setVolume(){}createOutputTrack(){throw new IR(RR.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class KD{disconnect(){}connect(){}}function zD(e){return new np((t,n)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const r=iR()?"canplay":"playing";s.addEventListener(r,()=>{const e=s.videoWidth,n=s.videoHeight;!e&&nR()||(i=!0,s.srcObject=null,s.remove(),t([e,n]))}),s.srcObject=new MediaStream([e]),s.play().catch(CI),setTimeout(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}function qD(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=AO(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!ER()&&n.frameRate&&(t.frameRate=n.frameRate),tR()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),nR()&&(t.frameRate={ideal:30,max:30}),t}function YD(e){const t={};return ER()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,ZC()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function XD(e){const t=YD(e);if(e.encoderConfig){const n=PO(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),xR()&&(t.sampleRate=void 0),t}const JD=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:s}=e.getMediaStreamTrackSettings();let{frameRate:r=n,width:a=i,height:o=s}=t;if(!r||!a||!o)return;a=kI(a),o=kI(o),r=kI(r);const{max:c,min:l}=function(e,t,n){const i=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(i),max:Math.floor(4*i)}}(a,o,r),{bitrateMax:d,bitrateMin:u}=t||{};d||aO.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(o,", fps: ").concat(r,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));const{maxFramerate:h}=RA("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(r=Math.min(r,h)),{frameRate:r,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}},QD=async(e,t,n)=>await(async(e,t,n)=>{const i=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(LI(""+t+n)).slice(0,16),s=i.slice(0,12),r=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},r,e))})(e.buffer,t,n),ZD=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new np((n,i)=>{t.toBlob(async e=>{if(t.remove(),e){const i=await $D(e);n({buffer:i,width:t.width,height:t.height})}else i(new IR(RR.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},$D=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var ek,tk,nk,ik,sk,rk,ak,ok,ck,lk,dk,uk,hk,pk,mk,fk,gk,_k,yk,vk,Ek,bk,Sk,xk,Tk,wk,Nk,Ck,Rk,Ik,Ak,Ok,Dk,kk,Pk,Lk,jk,Mk,Uk,Vk;let Fk=(ek=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tk=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),nk=VD(),ik=VI("LocalAudioTrack","_enabledMutex"),sk=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),rk=VD(),ak=VI("LocalAudioTrack","_enabledMutex"),ok=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),ck=VD(),lk=VD(),dk=VD(),uk=pO({argsMap:e=>[e.getTrackId()]}),hk=VD(),pk=pO({argsMap:e=>[e.getTrackId()]}),mk=VD(),fk=pO({argsMap:e=>[e.getTrackId()]}),gk=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_k=pO({argsMap:e=>[e.getTrackId()]}),aD((yk=class extends uD{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?UD.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),oD(this,"trackMediaType",KO.AUDIO),oD(this,"_encoderConfig",void 0),oD(this,"_trackSource",void 0),oD(this,"metadata",[]),oD(this,"_enabled",!0),oD(this,"_volume",100),oD(this,"_useAudioElement",!0),oD(this,"_bypassWebAudio",!1),oD(this,"processor",void 0),oD(this,"_processorContext",void 0),oD(this,"_processorDestination",void 0),oD(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new HD,RA("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),RA("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$C()&&!pD?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){DR(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&UD.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void aO.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,aI(this,MO.NEED_REPLACE_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!yO())throw new IR(RR.NOT_SUPPORTED,"your browser does not support setting the audio output device");await UD.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await aI(this,MO.NEED_ENABLE_TRACK,this),aO.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aI(this,MO.NEED_MUTE_TRACK,this):await aI(this,MO.NEED_UNMUTE_TRACK,this))}getStats(){return gI(()=>{aO.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lD({},qO)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),this._source.on(zO.ON_AUDIO_BUFFER,t=>e(t))}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] start audio playback in element")),UD.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?UD.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&UD.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return np.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new IR(RR.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this))}),e.on(ZO.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ZO.ON_TRACK),e.removeAllListeners(ZO.ON_NODE)}bindProcessorContextEvents(e){e.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners($O.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof HD&&(this._trackSource=new bD(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new WD(this._source.context,this.getTrackId(),"local"),t=new GD(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(zO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(UD.stop(this.getTrackId()),this._source.play()),aI(this,MO.NEED_REPLACE_MIXING_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[ek],Object.getOwnPropertyDescriptor(yk.prototype,"setVolume"),yk.prototype),aD(yk.prototype,"setPlaybackDevice",[tk,nk],Object.getOwnPropertyDescriptor(yk.prototype,"setPlaybackDevice"),yk.prototype),aD(yk.prototype,"setEnabled",[ik,sk,rk],Object.getOwnPropertyDescriptor(yk.prototype,"setEnabled"),yk.prototype),aD(yk.prototype,"setMuted",[ak,ok,ck],Object.getOwnPropertyDescriptor(yk.prototype,"setMuted"),yk.prototype),aD(yk.prototype,"getStats",[lk],Object.getOwnPropertyDescriptor(yk.prototype,"getStats"),yk.prototype),aD(yk.prototype,"setAudioFrameCallback",[dk],Object.getOwnPropertyDescriptor(yk.prototype,"setAudioFrameCallback"),yk.prototype),aD(yk.prototype,"play",[uk,hk],Object.getOwnPropertyDescriptor(yk.prototype,"play"),yk.prototype),aD(yk.prototype,"stop",[pk,mk],Object.getOwnPropertyDescriptor(yk.prototype,"stop"),yk.prototype),aD(yk.prototype,"close",[fk],Object.getOwnPropertyDescriptor(yk.prototype,"close"),yk.prototype),aD(yk.prototype,"pipe",[gk],Object.getOwnPropertyDescriptor(yk.prototype,"pipe"),yk.prototype),aD(yk.prototype,"unpipe",[_k],Object.getOwnPropertyDescriptor(yk.prototype,"unpipe"),yk.prototype),yk),Bk=(vk=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),Ek=VD(),bk=VI("MicrophoneAudioTrack","_enabledMutex"),Sk=pO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),xk=VD(),Tk=pO({argsMap:e=>[e.getTrackId()]}),aD((wk=class extends Fk{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?PO(t.encoderConfig):{},i,RA("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),oD(this,"_config",void 0),oD(this,"_deviceName","default"),oD(this,"_constraints",void 0),oD(this,"_originalConstraints",void 0),oD(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(fR()||gR())&&mD.bindInterruptDetectorTrack(this)}async setDevice(e){if(aO.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await DD.getDeviceById(e),n={};n.audio=lD({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await RD(n,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),i=await RD({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await DD.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return aO.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),RA("AUTO_RESET_AUDIO_ROUTE")&&(iR()||yR())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(i=this._source.clonedTrack)||void 0===i||i.stop(),n||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const s=lD({},this._constraints),r=DD.searchDeviceIdByName(this._deviceName);r&&!s.deviceId&&(s.deviceId=r);try{n||(this._enabled=!0);const e=await RD({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(fR()||gR())&&mD.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((iR()||yR())&&this._enabled&&!this._isClosed&&mD.duringInterruption){const e=async()=>{mD.off(SO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mD.on(SO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=DD.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await RD({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[vk,Ek],Object.getOwnPropertyDescriptor(wk.prototype,"setDevice"),wk.prototype),aD(wk.prototype,"setEnabled",[bk,Sk,xk],Object.getOwnPropertyDescriptor(wk.prototype,"setEnabled"),wk.prototype),aD(wk.prototype,"close",[Tk],Object.getOwnPropertyDescriptor(wk.prototype,"close"),wk.prototype),wk),Gk=(Nk=pO({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Ck=VD(),Rk=pO({argsMap:e=>[e.getTrackId()]}),Ik=VD(),Ak=pO({argsMap:e=>[e.getTrackId()]}),Ok=VD(),Dk=pO({argsMap:e=>[e.getTrackId()]}),kk=VD(),Pk=pO({argsMap:e=>[e.getTrackId()]}),Lk=VD(),jk=pO({argsMap:e=>[e.getTrackId()]}),Mk=pO({argsMap:e=>[e.getTrackId()]}),Uk=VD(),aD((Vk=class extends Fk{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),oD(this,"source",void 0),oD(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(zO.AUDIO_SOURCE_STATE_CHANGE,e=>{this.safeEmit(WO.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){DR(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Nk,Ck],Object.getOwnPropertyDescriptor(Vk.prototype,"startProcessAudioBuffer"),Vk.prototype),aD(Vk.prototype,"pauseProcessAudioBuffer",[Rk,Ik],Object.getOwnPropertyDescriptor(Vk.prototype,"pauseProcessAudioBuffer"),Vk.prototype),aD(Vk.prototype,"seekAudioBuffer",[Ak,Ok],Object.getOwnPropertyDescriptor(Vk.prototype,"seekAudioBuffer"),Vk.prototype),aD(Vk.prototype,"resumeProcessAudioBuffer",[Dk,kk],Object.getOwnPropertyDescriptor(Vk.prototype,"resumeProcessAudioBuffer"),Vk.prototype),aD(Vk.prototype,"stopProcessAudioBuffer",[Pk,Lk],Object.getOwnPropertyDescriptor(Vk.prototype,"stopProcessAudioBuffer"),Vk.prototype),aD(Vk.prototype,"close",[jk],Object.getOwnPropertyDescriptor(Vk.prototype,"close"),Vk.prototype),aD(Vk.prototype,"setAudioBufferPlaybackSpeed",[Mk,Uk],Object.getOwnPropertyDescriptor(Vk.prototype,"setAudioBufferPlaybackSpeed"),Vk.prototype),Vk);class Wk extends Fk{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=fD().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,wI(8,"track-mix-")),oD(this,"trackList",void 0),oD(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(aO.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):aO.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){aO.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}dI(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof Wk?t.emit(GO.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class Hk extends ED{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(zO.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),oD(this,"audioBuffer",void 0),oD(this,"sourceNode",void 0),oD(this,"startPlayTime",0),oD(this,"startPlayOffset",0),oD(this,"pausePlayTime",0),oD(this,"options",void 0),oD(this,"currentLoopCount",0),oD(this,"currentPlaybackSpeed",100),oD(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):aO.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Kk=new Map;function zk(e,t){if(0===e.length||0===t.length)return 1/0;const n=PI(e),i=PI(t);return Math.floor(i/n)}class qk{get rendFrameRate(){const e=Math.max(1,zk(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:nD.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(aO.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){oD(this,"trackId",void 0),oD(this,"config",void 0),oD(this,"onFirstVideoFrameDecoded",void 0),oD(this,"onFirstVideoFrameRender",void 0),oD(this,"onVideoStateChanged",void 0),oD(this,"freezeTimeCounterList",[]),oD(this,"renderFreezeAccTime",0),oD(this,"renderFreezeAccTime2",0),oD(this,"isKeepLastFrame",!1),oD(this,"isDestroyed",!1),oD(this,"timeUpdatedCount",0),oD(this,"freezeTime",0),oD(this,"playbackTime",0),oD(this,"lastTimeUpdatedTime",0),oD(this,"autoplayFailed",!1),oD(this,"videoTrack",void 0),oD(this,"videoElement",void 0),oD(this,"cacheVideoElement",void 0),oD(this,"internal",!1),oD(this,"_render_interframe_delays",[]),oD(this,"_render_interframe_delays_sizes",[]),oD(this,"_videoState",iD.VideoStateStopped),oD(this,"videoElementCheckInterval",void 0),oD(this,"videoElementFreezeTimeout",void 0),oD(this,"_videoElementStatus",nD.NONE),oD(this,"_isInPage",!0),oD(this,"isGettingVideoDimensions",!1),oD(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return aO.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),oD(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===mD.curState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),_R()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),oD(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":"play"===e.type&&aO.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=nD.PLAYING;break;case"loadeddata":if(this.videoState=iD.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=nD.CANPLAY;break;case"stalled":this.videoElementStatus=nD.STALLED;break;case"suspend":this.videoElementStatus=nD.SUSPEND;break;case"pause":this.videoElementStatus=nD.PAUSED,iR()||yR()||$C()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=nD.WAITING;break;case"abort":this.videoElementStatus=nD.ABORT;break;case"ended":this.videoElementStatus=nD.ENDED;break;case"emptied":this.videoElementStatus=nD.EMPTIED;break;case"error":{const e=this.videoElement.error;e&&(this.videoElementStatus=nD.ERROR,aO.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,ZP.lastVisibleTime<ZP.lastHiddenTime||n<ZP.lastHiddenTime||n<ZP.lastVisibleTime)return;if(this.isSkipCalcRenderFreezeTime())return;for(t>RA("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),oD(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),_R()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),mD.on(SO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mD.on(SO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch(t=>{e&&jD(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(aO.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):aO.warning("[".concat(this.trackId,"] play warning: "),t)});const n=qC();if(("Safari"===n.name&&15===Number(n.version)||fR())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return aO.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,n.width,n.height),new np((i,s)=>{n.toBlob(async e=>{if(n.remove(),e){const t=await $D(e);i({buffer:t,width:n.width,height:n.height})}else s(new IR(RR.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await ZD(e)}destroy(){this.isDestroyed=!0,mD.off(SO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mD.off(SO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=iD.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=nD.INIT,!this.videoElementCheckInterval&&(Yk.forEach(e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(e){return e!==document.body&&document.body.contains(e)}(this.videoElement)},1e3),RA("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const i=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",i),this.videoElementFreezeTimeout=window.setTimeout(s,RA("VIDEO_FREEZE_DURATION")))},s=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===iD.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=iD.VideoStateFrozen:document.addEventListener("visibilitychange",i))},r=(e,t)=>{if(this.videoElementStatus===nD.PLAYING){if(n){const e=t.presentationTime-n.presentationTime,i=t.presentedFrames-n.presentedFrames;this._render_interframe_delays_sizes.push(i),this._render_interframe_delays.push(e);const r=PI(this._render_interframe_delays_sizes),a=r-this._render_interframe_delays_sizes[0];if(r>30&&a>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===iD.VideoStateStarting&&(this.videoState=iD.VideoStateDecoding),this.videoState===iD.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(s,RA("VIDEO_FREEZE_DURATION"))),e<RA("VIDEO_FREEZE_DURATION")&&this.videoState===iD.VideoStateFrozen&&(this.videoState=iD.VideoStateDecoding),e>RA("VIDEO_FREEZE_DURATION")&&ZP.lastVisibleTime>=ZP.lastHiddenTime&&n.timestamp>ZP.lastVisibleTime&&n.timestamp>ZP.lastHiddenTime){const t=Math.min(66,zk(this._render_interframe_delays_sizes,this._render_interframe_delays)),n=Math.max(0,e-(i-1)*t);this.renderFreezeAccTime2+=n>t?n:0,this.renderFreezeAccTime+=e}}n=lD(lD({},t),{},{timestamp:e})}else this.isSkipCalcRenderFreezeTime()&&(n=lD(lD({},t),{},{timestamp:e}));var i,a;RA("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(i=(a=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(a,r))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,r)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),xR()&&!RA("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=qC();"Safari"===n.name&&15===Number(n.version)||fR()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nR()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nR()&&this.videoElement.load());const i=this.videoElement.play();void 0!==i&&i.catch(e=>{aO.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}resetVideoElement(){Yk.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=nD.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===nD.DESTROYED||this.internal}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{aO.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(e=>{aO.error(e)}),this.autoplayFailed=!1,TR()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};TR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),LD()}}const Yk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Xk extends qk{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),oD(this,"container",void 0),oD(this,"slot",void 0),this.slot=e.element,this.internal=t,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;var n;!this.internal||this.slot?(t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()):(this.slot=t,t&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",null===(n=this.slot)||void 0===n||n.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await ZD(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),null===(e=this.slot)||void 0===e||e.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",RA("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),null===(e=this.slot)||void 0===e||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Jk,Qk,Zk,$k,eP,tP,nP,iP,sP,rP,aP,oP,cP,lP,dP,uP,hP,pP,mP,fP,gP,_P,yP,vP,EP,bP,SP,xP,TP,wP,NP,CP,RP,IP,AP,OP,DP,kP;let PP=(Jk=pO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Qk=VD(),Zk=pO({argsMap:e=>[e.getTrackId()]}),$k=VI("LocalVideoTrack","_enabledMutex"),eP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),tP=VD(),nP=VI("LocalVideoTrack","_enabledMutex"),iP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),sP=VD(),rP=pO({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),aP=VD(),oP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),cP=VD(),lP=VD(),dP=pO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),uP=VD(),hP=VD(),pP=VD(),mP=pO({argsMap:e=>[e.getTrackId()]}),fP=VD(),gP=VD(),_P=VD(),yP=VD(),vP=VD(),EP=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),bP=pO({argsMap:e=>[e.getTrackId()]}),SP=pO({argsMap:e=>[e.getTrackId()]}),xP=pO({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),TP=class e extends uD{get videoHeight(){if($C()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if($C()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nD.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,i,s,r){if(super(e,s),oD(this,"trackMediaType",KO.VIDEO),oD(this,"_player",void 0),oD(this,"isUseScaleResolutionDownBy",!1),oD(this,"_videoVisibleTimer",null),oD(this,"_previousVideoVisibleStatus",void 0),oD(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oD(this,"_encoderConfig",void 0),oD(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),oD(this,"_optimizationMode",void 0),oD(this,"_saveEncodeBitrateRatio",1),oD(this,"_videoHeight",void 0),oD(this,"_videoWidth",void 0),oD(this,"_forceBitrateLimit",void 0),oD(this,"_enabled",!0),oD(this,"_processorDestination",void 0),oD(this,"_processorContext",void 0),$C()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=i,this._hints=r||[],t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)?this._encoderConfig=pI(t):this._encoderConfig=t,-1===this._hints.indexOf(UO.SCREEN_TRACK))this.updateBitrateFromProfile();else if(aR(WC.CHROME,115)&&-1!==XC().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&_O().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),i=new MediaStreamTrackGenerator({kind:"video"});let s,r,a=Date.now();const o=()=>{c&&(clearInterval(c),c=void 0),s&&(s.close(),s=void 0),e.stop(),r=void 0,i.removeEventListener("ended",o)};let c=window.setInterval(()=>{if(r&&s&&Date.now()-a>(null!=t?t:1e3))try{"live"===i.readyState?r.enqueue(s.clone()):o()}catch(e){o()}},null!=t?t:1e3);const l=new TransformStream({transform:(e,t)=>{"live"===i.readyState?(r=t,a=Date.now(),void 0===s?(s=e,t.enqueue(e.clone())):(t.enqueue(s),s=e)):e.close()}});return i.addEventListener("ended",o),n.readable.pipeThrough(l).pipeTo(i.writable),i}}(e);t&&(aO.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new BD(this.getTrackId(),"local"),this._processorDestination=new FD(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=lD(lD(lD({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new qk(n):this._player=new Xk(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(WO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},RA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aI(this,MO.NEED_MUTE_TRACK,this):await aI(this,MO.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._saveEncodeBitrateRatio;if(1!==this._saveEncodeBitrateRatio&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),aO.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=AO(e),RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=qD({encoderConfig:e});($C()||iR()||yR())&&(t.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new IR(RR.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}getStats(){return gI(()=>{aO.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lD({},YO)}async setBeautyEffect(e){aO.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await ZD(e)}async findClosestProfile(){const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:r}=this._encoderConfig||{},a=kI(this._videoWidth||e||i||0),o=kI(this._videoHeight||t||s||0),c=function(e,t,n){if(!Array.isArray(RA("VIDEO_ENCODER_CONFIG_LIST")))return!1;if(0===RA("VIDEO_ENCODER_CONFIG_LIST").length)return!1;const i=Math.min(e,t);return!(i>=480)&&lD(lD({},RA("VIDEO_ENCODER_CONFIG_LIST").find(e=>e.height>i)),{},{frameRate:n})}(a,o,kI(n||r||15));if(c)return aO.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(a,"x").concat(o," => ").concat(JSON.stringify(c))),this.setEncoderConfiguration(c)}async setBitrateLimit(e){aO.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void aO.error(RR.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await aI(this,MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,aO.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return aO.error(RR.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,aO.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){zD(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(CI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");aO.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=AO(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(null==s||null==i){const{max:r,min:a}=function(e,t,n,i,s){const r=RA("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===r)return{min:i,max:s};if(void 0===s){const a=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));s="STANDARD_BITRATE"===r?4*a:2*a,i=null!=i?i:a}else i=null!=i?i:Math.floor(s/10);return{min:i,max:s}}(e,t,n,s,i);if(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=r,RA("VIDEO_STANDARD_BITRATE_VERSION")&&null==s&&null==i){const[i,s]=function(e,t,n){const i=4*Math.floor(2e5*Math.pow(n/15,.6)*Math.pow(e*t/230400,.75)),s=e*t,r=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),a=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let o=up(r).call(r).next().value,c=1;if(r.has(s))o=r.get(s);else{var l;const e=Xp(l=Array.from(r.entries())).call(l,(e,t)=>{let[n]=e,[i]=t;return n-i}),t=e.find(e=>{let[t]=e;return t>s});if(t){const n=e.indexOf(t);if(n>0){const i=e[n-1],r=(s-i[0])/(t[0]-i[0]);o=i[1]+r*(t[1]-i[1])}else o=t[1]}else o=e[e.length-1][1]}if(a.has(s))c=a.get(s);else{var d;const e=Xp(d=Array.from(a.entries())).call(d,(e,t)=>{let[n]=e,[i]=t;return n-i}),t=e.find(e=>{let[t]=e;return t>s});if(t){const n=e.indexOf(t);if(n>0){const i=e[n-1],r=(s-i[0])/(t[0]-i[0]);c=i[1]+r*(t[1]-i[1])}else c=t[1]}else c=e[e.length-1][1]}const u=RA("VIDEO_NEW_BITRATE_RATIO");u&&u>0&&(o=u/100);const h=Math.floor(i*o),p=Math.floor(65e4*Math.pow(e*t/230400,.5)*Math.pow(n/15,.69));let m=h;const f=RA("VIDEO_STANDARD_BITRATE_VERSION");return f&&f>0&&(1===f?m=i:2===f?m=h:3===f&&(m=p)),[Math.floor(m/1e3),c]}(e,t,n);this._encoderConfig.bitrateMax=i,this._encoderConfig.bitrateMin=a?Math.min(a,i):i,this._saveEncodeBitrateRatio=s,aO.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else aO.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(r,", brMin: ").concat(a,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),i={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:s,slot:r}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&r instanceof HTMLElement){const e=FR.checkOneElementVisible(s),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new IR(RR.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=lD(lD({},i),AO(t))),i=mI(i);const s=wI(8,"track-video-cloned-"),r=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,mI(this._scalabilityMode),this._optimizationMode,s,mI(this._hints));return t&&i&&r.setEncoderConfiguration(i),aO.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),r}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new IR(RR.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new IR(RR.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(gI(()=>{mO.reportApiInvoke(null,{name:qR.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:YR.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!RA("ENABLE_VIDEO_SEI")||!RA("ENABLE_ENCODED_TRANSFORM"))return void aO.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new IR(RR.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void aO.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const i=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===i||"video/h265"===i?this.safeEmit("sei-to-send",e):aO.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($O.REQUEST_CONSTRAINTS)}},aD(TP.prototype,"play",[Jk,Qk],Object.getOwnPropertyDescriptor(TP.prototype,"play"),TP.prototype),aD(TP.prototype,"stop",[Zk],Object.getOwnPropertyDescriptor(TP.prototype,"stop"),TP.prototype),aD(TP.prototype,"setEnabled",[$k,eP,tP],Object.getOwnPropertyDescriptor(TP.prototype,"setEnabled"),TP.prototype),aD(TP.prototype,"setMuted",[nP,iP,sP],Object.getOwnPropertyDescriptor(TP.prototype,"setMuted"),TP.prototype),aD(TP.prototype,"setSaveEncodeBitrateRatio",[rP,aP],Object.getOwnPropertyDescriptor(TP.prototype,"setSaveEncodeBitrateRatio"),TP.prototype),aD(TP.prototype,"setEncoderConfiguration",[oP,cP],Object.getOwnPropertyDescriptor(TP.prototype,"setEncoderConfiguration"),TP.prototype),aD(TP.prototype,"getStats",[lP],Object.getOwnPropertyDescriptor(TP.prototype,"getStats"),TP.prototype),aD(TP.prototype,"setBeautyEffect",[dP,uP],Object.getOwnPropertyDescriptor(TP.prototype,"setBeautyEffect"),TP.prototype),aD(TP.prototype,"getCurrentFrameData",[hP],Object.getOwnPropertyDescriptor(TP.prototype,"getCurrentFrameData"),TP.prototype),aD(TP.prototype,"getCurrentFrameImage",[pP],Object.getOwnPropertyDescriptor(TP.prototype,"getCurrentFrameImage"),TP.prototype),aD(TP.prototype,"findClosestProfile",[mP,fP],Object.getOwnPropertyDescriptor(TP.prototype,"findClosestProfile"),TP.prototype),aD(TP.prototype,"setBitrateLimit",[gP],Object.getOwnPropertyDescriptor(TP.prototype,"setBitrateLimit"),TP.prototype),aD(TP.prototype,"setOptimizationMode",[_P],Object.getOwnPropertyDescriptor(TP.prototype,"setOptimizationMode"),TP.prototype),aD(TP.prototype,"setScalabiltyMode",[yP],Object.getOwnPropertyDescriptor(TP.prototype,"setScalabiltyMode"),TP.prototype),aD(TP.prototype,"updateMediaStreamTrackResolution",[vP],Object.getOwnPropertyDescriptor(TP.prototype,"updateMediaStreamTrackResolution"),TP.prototype),aD(TP.prototype,"pipe",[EP],Object.getOwnPropertyDescriptor(TP.prototype,"pipe"),TP.prototype),aD(TP.prototype,"unpipe",[bP],Object.getOwnPropertyDescriptor(TP.prototype,"unpipe"),TP.prototype),aD(TP.prototype,"close",[SP],Object.getOwnPropertyDescriptor(TP.prototype,"close"),TP.prototype),aD(TP.prototype,"replaceTrack",[xP],Object.getOwnPropertyDescriptor(TP.prototype,"replaceTrack"),TP.prototype),TP),LP=(wP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),NP=VD(),CP=VI("CameraVideoTrack","_enabledMutex"),RP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),IP=VD(),AP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),OP=VD(),DP=pO({argsMap:e=>[e.getTrackId()]}),kP=class e extends PP{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,i,s,r){super(e,AO(t.encoderConfig),i,s,r),oD(this,"_config",void 0),oD(this,"_originalConstraints",void 0),oD(this,"_constraints",void 0),oD(this,"_enabled",!0),oD(this,"_deviceName","default"),oD(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(fR()||gR())&&!function(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&vR()&&this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=AO(this._config.encoderConfig),mD.on(SO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mD.on(SO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await DD.getDeviceById(e),n={};n.video=lD({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await RD(n,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),i=await RD({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await DD.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){aO.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:lD(lD({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await RD(t,this.getTrackId())}catch(t){throw aO.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await RD({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=lD({},t.video),aO.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await RD({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=AO(e),RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=pI(this._config);n.encoderConfig=e;const i=qD(n);($C()||iR()||yR())&&(i.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(e){const t=new IR(RR.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((iR()||yR())&&this._enabled&&!this._isClosed&&mD.duringInterruption){const e=async()=>{mD.off(SO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mD.on(SO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=DD.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await RD({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),mD.off(SO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mD.off(SO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=lD(lD({},i),AO(t))),i=mI(i);const s=wI(8,"track-cam-cloned-"),r=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,mI(lD(lD({},this._config),{},{encoderConfig:i})),mI(this._constraints),mI(this._scalabilityMode),this._optimizationMode,s);return t&&i&&r.setEncoderConfiguration(i),aO.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),r}bindProcessorContextEvents(){this.processorContext.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}),this.processorContext.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},aD(kP.prototype,"setDevice",[wP,NP],Object.getOwnPropertyDescriptor(kP.prototype,"setDevice"),kP.prototype),aD(kP.prototype,"setEnabled",[CP,RP,IP],Object.getOwnPropertyDescriptor(kP.prototype,"setEnabled"),kP.prototype),aD(kP.prototype,"setEncoderConfiguration",[AP,OP],Object.getOwnPropertyDescriptor(kP.prototype,"setEncoderConfiguration"),kP.prototype),aD(kP.prototype,"close",[DP],Object.getOwnPropertyDescriptor(kP.prototype,"close"),kP.prototype),kP);function jP(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=lD(lD({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?aO.debug("[".concat(e,"] set content hint to"),n.optimizationMode):aO.debug("[".concat(e,"] set content hint failed")))):aO.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MP,UP,VP,FP,BP,GP,WP,HP,KP,zP,qP,YP;class XP extends dD{getUserId(){return this._userId}constructor(e,t,n,i){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(i.clientId,"_").concat(wI(5,""))),oD(this,"_userId",void 0),oD(this,"_uintId",void 0),oD(this,"_isDestroyed",!1),oD(this,"store",void 0),oD(this,"processor",void 0),oD(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,aO.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let JP=(MP=pO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),UP=pO({argsMap:e=>[e.getTrackId()]}),VP=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FP=pO({argsMap:e=>[e.getTrackId()]}),aD((BP=class extends XP{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nD.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,s){super(e,t,n,i),oD(this,"_videoVisibleTimer",null),oD(this,"_previousVideoVisibleStatus",void 0),oD(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oD(this,"trackMediaType",KO.VIDEO),oD(this,"_videoWidth",void 0),oD(this,"_videoHeight",void 0),oD(this,"_player",void 0),oD(this,"_prePlayer",void 0),oD(this,"processorDestination",void 0),oD(this,"processorContext",void 0),this._prePlayer=s,this.updateMediaStreamTrackResolution(),this.processorContext=new BD(this.getTrackId(),"remote"),this.processorDestination=new FD(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return gI(()=>{aO.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lD({},QO)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.safeEmit(HO.PLAY_START),"string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=lD(lD({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let t=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new qk(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,t=this._player.videoState>0,this._player.updateConfig(n)):this._player=new Xk(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(HO.FIRST_FRAME_DECODED),i&&this.safeEmit(HO.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=e=>{this.safeEmit(HO.VIDEO_STATE_CHANGED,e)},t&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(HO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},RA("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(HO.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){zD(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(CI)}_updatePlayerSource(){aO.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),i={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:s,slot:r}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&r instanceof HTMLElement){const e=FR.checkOneElementVisible(s),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new IR(RR.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(GO.SEI_RECEIVED,e)}}).prototype,"play",[MP],Object.getOwnPropertyDescriptor(BP.prototype,"play"),BP.prototype),aD(BP.prototype,"stop",[UP],Object.getOwnPropertyDescriptor(BP.prototype,"stop"),BP.prototype),aD(BP.prototype,"pipe",[VP],Object.getOwnPropertyDescriptor(BP.prototype,"pipe"),BP.prototype),aD(BP.prototype,"unpipe",[FP],Object.getOwnPropertyDescriptor(BP.prototype,"unpipe"),BP.prototype),BP),QP=(GP=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),WP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),HP=pO({argsMap:e=>[e.getTrackId()]}),KP=pO({argsMap:e=>[e.getTrackId()]}),zP=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),qP=pO({argsMap:e=>[e.getTrackId()]}),aD((YP=class extends XP{get isPlaying(){return this._useAudioElement?UD.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),oD(this,"trackMediaType",KO.AUDIO),oD(this,"_source",void 0),oD(this,"_useAudioElement",!0),oD(this,"_volume",100),oD(this,"processorContext",void 0),oD(this,"processorDestination",void 0),oD(this,"_played",!1),oD(this,"_bypassWebAudio",!1),RA("DISABLE_WEBAUDIO")?(this._source=new HD,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bD(e,!0),RA("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(zO.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(HO.FIRST_FRAME_DECODED)}),this.processorContext=new WD(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new GD(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(zO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),this._source.on(zO.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){this._volume=e,this._useAudioElement?UD.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!yO())throw new IR(RR.NOT_SUPPORTED,"your browser does not support setting the audio output device");await UD.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return gI(()=>{aO.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lD({},XO)}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] use audio element to play")),UD.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?UD.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&UD.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ZO.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK),this.processorDestination.removeAllListeners(ZO.ON_NODE)}}).prototype,"setVolume",[GP],Object.getOwnPropertyDescriptor(YP.prototype,"setVolume"),YP.prototype),aD(YP.prototype,"setPlaybackDevice",[WP],Object.getOwnPropertyDescriptor(YP.prototype,"setPlaybackDevice"),YP.prototype),aD(YP.prototype,"play",[HP],Object.getOwnPropertyDescriptor(YP.prototype,"play"),YP.prototype),aD(YP.prototype,"stop",[KP],Object.getOwnPropertyDescriptor(YP.prototype,"stop"),YP.prototype),aD(YP.prototype,"pipe",[zP],Object.getOwnPropertyDescriptor(YP.prototype,"pipe"),YP.prototype),aD(YP.prototype,"unpipe",[qP],Object.getOwnPropertyDescriptor(YP.prototype,"unpipe"),YP.prototype),YP);const ZP=new class extends HR{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),oD(this,"_lastHiddenTime",0),oD(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),aO.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class $P extends HR{constructor(e,t){super(),oD(this,"trackMediaType",KO.DATA),oD(this,"_version",1),oD(this,"_type",3),oD(this,"_config",void 0),oD(this,"_originDataChannel",void 0),oD(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),oD(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),oD(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return RA("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new np((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout(()=>{var e;t(new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[rD.OPEN,rD.CLOSE,rD.ERROR].forEach(t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[n,i]=t;e.removeEventListener(n,i)}),this._datachannelEventMap.clear()}}class eL extends $P{constructor(e){super(e),oD(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(RA("SHOW_DATASTREAM2_LOG")&&aO.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let i=e.data.slice(this._dataStreamPacketHeader.byteLength);i=this._dataStreamPacketHandler.deserialize(i),this.emit(rD.MESSAGE,i)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class tL extends $P{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function nL(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>by.revokeObjectURL(e),0),new Worker(by.createObjectURL(e))}const iL=71,sL=1,rL=2,aL=1,oL=2;var cL=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(cL||{});function lL(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.getUint8(0);if(n!==iL)return;const i=e.getUint16(1),s=sL+rL+i,r=new Uint8Array(e.byteLength-s);r.set(new Uint8Array(e.buffer,s,e.byteLength-s));const a={m:n,tlvLen:i,tlv:[],frame:r};let o=sL+rL;for(;o<s;){const n=e.getUint8(o),i=e.getUint16(o+aL),s=aL+oL;if(n===cL.AUDIO_LEVEL){let r=e.getUint8(o+s);for(let t=1;t<i;t++)r=r<<8|e.getUint8(o+s+t);a.tlv.push({tag:n,length:i,value:t?127^r>>1:127&r})}else if(n===cL.METADATA||n===cL.AUDIO_64_BIT_PTS){const t=new Uint8Array(i);for(let n=0;n<i;n++)t[n]=e.getUint8(o+s+n);a.tlv.push({tag:n,length:i,value:t})}o+=s+i}return a}const dL=new Map,uL=127,hL=1e-10,pL=139/13,mL=new Map;function fL(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let s=0;if(mL.has(i))s=mL.get(i);else{const r=.5;s=Math.log(function(e,t){const n=e-t;t<n&&(t=n);let i=1;for(let s=e,r=1;s>t;s--,r++)i=i*s/r;return i}(t,e))+e*Math.log(r)+(t-e)*Math.log(1-r)-Math.log(n)+n*e,mL.set(i,s)}return s<hL&&(s=hL),s}function gL(e,t,n){const i=t.length,s=e.length/i;let r=!1;for(let a=0,o=0;a<i;a++){let i=0;for(let t=o+s;o<t;o++)e[o]>n&&i++;t[a]!==i&&(t[a]=i,r=!0)}return r}window.cache=mL;let _L=0;class yL{constructor(e){oD(this,"id",void 0),oD(this,"immediates",[]),oD(this,"lastNonSilence",-1),oD(this,"immediateSpeechActivityScore",hL),oD(this,"lastLevelChangedTime",Date.now()),oD(this,"levels",[]),oD(this,"longs",[]),oD(this,"longSpeechActivityScore",hL),oD(this,"mediums",[]),oD(this,"mediumSpeechActivityScore",hL),oD(this,"minLevel",0),oD(this,"nextMinLevel",0),oD(this,"nextMinLevelWindowLength",0),oD(this,"energyScore",0),this.id=e||"".concat(_L++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,t=this.levels,n=this.minLevel+pL;let i=!1;for(let s=0;s<e.length;++s){let r=t[s];r<n&&(r=0);const a=Math.floor(r/pL);e[s]!==a&&(e[s]=a,i=!0)}return i}computeLongs(){return gL(this.mediums,this.longs,4)}computeMediums(){return gL(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=fL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=fL(this.longs[0],10,47),this.longSpeechActivityScore>hL&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=fL(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(_s(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let n=e;return e<0&&(n=0),e>uL&&(n=uL),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+pL?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>uL&&(e=uL),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class vL{constructor(e){oD(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class EL{constructor(e,t,n){oD(this,"isDominant",void 0),oD(this,"energyRanking",void 0),oD(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n}}class bL extends HR{constructor(e){super(),oD(this,"dominantId",null),oD(this,"lastDecisionTime",0),oD(this,"lastLevelChangedTime",0),oD(this,"lastLevelIdleTime",0),oD(this,"relativeSpeechActivities",[]),oD(this,"speakers",new Map),oD(this,"enableSilence",!1),oD(this,"timeoutToSilenceInterval",0),oD(this,"decisionMaker",null),oD(this,"loudest",[]),oD(this,"numLoudestToTrack",3),oD(this,"energyExpireTimeMs",250),oD(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=n&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(t=>t.id===e)}levelChanged(e,t){const n=Date.now(),i=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());const s=i.levelChanged(t,n);return this.updateLoudestList(i,s,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)})}removeSpeakers(e){e.forEach(e=>{this.speakers.delete(e.id)})}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new yL(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,n){const i=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new EL(i,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new EL(i,0,e.energyScore);const s=n-this.energyExpireTimeMs;let r=0;for(;r<this.loudest.length;){const t=this.loudest[r];if(t.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(r,1);else if(t.id!==e.id)++r;else if(this.loudest.splice(r,1),this.loudest.length<this.numLoudestToTrack)break}let a=0;for(;a<this.loudest.length&&!(this.loudest[a].energyScore<e.energyScore);)++a;return a<this.numLoudestToTrack&&(this.loudest.splice(a,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new EL(i,a,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new vL(this),this.decisionMaker.execute())}makeDecision(e){let t=null,n=null;const i=this.speakers.size;let s=null;if(0===i)s=null;else if(1===i){var r;const t=up(r=this.speakers).call(r).next().value;this.enableSilence&&t&&(s=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){const e=this.speakers.entries().next();e.value&&(s=e.value[0],t=e.value[1])}else s=t.id;null!=t&&t.evaluateSpeechActivityScores(e);const n=this.relativeSpeechActivities;let i=2;for(const r of this.speakers.entries()){const[a,o]=r;if(o===t)continue;o.evaluateSpeechActivityScores(e);for(let e=0;e<n.length;++e){const i=null==t?hL:t.getSpeechActivityScore(e);n[e]=Math.log(o.getSpeechActivityScore(e)/i)}const c=n[0],l=n[1],d=n[2];c>3&&l>2&&d>0&&l>i&&(i=l,s=a)}this.enableSilence&&null!=t&&s===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}null==s&&!this.enableSilence||s===this.dominantId||(t=this.dominantId,this.dominantId=s,n=this.dominantId),null==n&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){const e=Date.now(),t=300-(e-this.lastLevelIdleTime);let n=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;let i=300-(e-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=e,this.makeDecision(e),i=300-(Date.now()-e)),i>0&&n>i&&(n=i),n}timeoutIdleLevels(e){const t=[];for(const i of up(n=this.speakers).call(n)){var n;const s=e-i.getLastLevelChangedTime();36e5<s&&(null==this.dominantId||i.id!==this.dominantId)?t.push(i.id):300<s&&i.levelTimedOut()}t.forEach(e=>this.speakers.delete(e))}}const SL=new Map;let xL=null,TL=null;const wL=3;let NL=[];const CL=new Map,RL=new Map;class IL{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){oD(this,"id",void 0),oD(this,"track",void 0),oD(this,"score",0),oD(this,"active",!0),oD(this,"muted",!1),oD(this,"timer",0),oD(this,"actives",0),oD(this,"inactives",0),this.id=e,this.track=t,this.setActive(CL.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:t,inactives:n}=function(){const e=[],t=[];return Array.from(up(CL).call(CL)).forEach(n=>{n.active?e.push(n):t.push(n)}),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach(t=>{(!e||e.score>t.score)&&(e=t)}),e&&e.setActive(!1)}if(t.length<3&&n.length>0){let t;n.forEach(e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)}),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(e){let t;return Array.from(up(CL).call(CL)).forEach(n=>{!n.active||n.id===e||n.samples<40||(!t||n.score<t.score)&&(t=n)}),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(e){let t;return Array.from(up(CL).call(CL)).forEach(n=>{n.active||n.id===e||n.samples<40||(!t||n.score>t.score)&&(t=n)}),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let AL;function OL(e){const t=CL.get(e);t&&(CL.delete(e),t.clearTimer())}const DL=new Map,kL=new Map,PL="video/h264",LL="video/h265";function jL(e,t,n){let i=new Uint8Array(e,t,n),s=[],r=0;for(;s.length<n;)r+3<n&&0===i[r]&&0===i[r+1]&&3===i[r+2]&&(0===i[r+3]||1===i[r+3]||2===i[r+3]||3===i[r+3])?(s.push(i[r],i[r+1],i[r+3]),r+=4):(s.push(i[r]),r++);return new Uint8Array(s)}function ML(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&0===e[i]&&0===e[i+1]&&(0===e[i+2]||1===e[i+2]||2===e[i+2]||3===e[i+2])?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function UL(e){if(e.length<5)return"";let t=-1;for(let s=0;s<e.length-3;s++){if(0===e[s]&&0===e[s+1]&&1===e[s+2]){t=s;break}if(s<e.length-4&&0===e[s]&&0===e[s+1]&&0===e[s+2]&&1===e[s+3]){t=s;break}}if(-1===t)return"";const n=t+(0===e[t+2]?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&0==(248&e[n+1])?LL:(31&i)<=31?PL:""}const VL=new Map,FL=new Map;!function(){const e=qC();gO.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gO.getStreamFromExtension=e.name===WC.CHROME&&Number(e.version)>34,gO.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),gO.supportMinBitrate=e.name===WC.CHROME||e.name===WC.EDGE,gO.supportSetRtpSenderParameters=function(){const e=qC();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!SR()||!(!$C()&&!QC())||e.name===WC.FIREFOX&&Number(e.version)>=64)}(),e.name===WC.SAFARI&&(Number(e.version)>=14?gO.supportDualStream=!0:gO.supportDualStream=!1),gO.webAudioMediaStreamDest=function(){const e=qC();return!(e.name===WC.SAFARI&&Number(e.version)<12)}(),gO.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,gO.supportWebGL="undefined"!=typeof WebGLRenderingContext,gO.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,SR()||(gO.webAudioWithAEC=!0),gO.supportShareAudio=function(){const e=qC();return(e.os===GC.WIN_10||e.os===GC.WIN_81||e.os===GC.WIN_7||e.os===GC.LINUX||e.os===GC.MAC_OS||e.os===GC.CHROMIUM_OS)&&e.name===WC.CHROME&&Number(e.version)>=74}(),gO.supportDataChannel=!!(sR(76)||cR(68)||lR(14)),gO.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!nR()&&!!e&&e.prototype.setConfiguration instanceof Function}(),gO.supportWebRTCEncodedTransform=sR(87)||eR()||cR(117),gO.supportWebRTCInsertableStream=function(){const e=qC();return(e.name===WC.CHROME||e.name===WC.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gO.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gO.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,hI(()=>{gO.supportDualStreamEncoding=function(){const e=qC();return!!RA("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&RA("CHROME_DUAL_STREAM_USE_ENCODING"))}(),aO.debug("browser ua: ",navigator.userAgent),aO.info("browser info: ",e),aO.info("browser compatibility: ",gO)})}();const BL=["CHINA","GLOBAL"],GL=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],WL=[],HL=[];function KL(e,t){return!!t&&WL.some(n=>n.uid===e&&n.channelName===t)}function zL(){return HL.length>0}var qL=CS.forEach,YL=Hi("forEach")?[].forEach:function(e){return qL(this,e,arguments.length>1?arguments[1]:void 0)};On({target:"Array",proto:!0,forced:[].forEach!==YL},{forEach:YL});var XL=ei("Array","forEach"),JL=gi,QL=et,ZL=u,$L=XL,ej=Array.prototype,tj={DOMTokenList:!0,NodeList:!0},nj=function(e){var t=e.forEach;return e===ej||ZL(ej,e)&&t===ej.forEach||QL(tj,JL(e))?$L:t},ij=i(nj),sj=Qe,rj=hr;On({target:"Object",stat:!0,forced:s(function(){rj(1)})},{keys:function(e){return rj(sj(e))}});var aj=i(ee.Object.keys),oj=i(is),cj=i(gs),lj=On,dj=as,uj=Qc,hj=$,pj=Fn,mj=Kn,fj=Q,gj=qf,_j=mt,yj=al,vj=Bb("slice"),Ej=_j("species"),bj=Array,Sj=Math.max;lj({target:"Array",proto:!0,forced:!vj},{slice:function(e,t){var n,i,s,r=fj(this),a=mj(r),o=pj(e,a),c=pj(void 0===t?a:t,a);if(dj(r)&&(n=r.constructor,(uj(n)&&(n===bj||dj(n.prototype))||hj(n)&&null===(n=n[Ej]))&&(n=void 0),n===bj||void 0===n))return yj(r,o,c);for(i=new(void 0===n?bj:n)(Sj(c-o,0)),s=0;o<c;o++,s++)o in r&&gj(i,s,r[o]);return i.length=s,i}});var xj=ei("Array","slice"),Tj=u,wj=xj,Nj=Array.prototype,Cj=function(e){var t=e.slice;return e===Nj||Tj(Nj,e)&&t===Nj.slice?wj:t},Rj=i(Cj);function Ij(e,t,n,i,s){var r,a,o,c={};return ij(r=aj(i)).call(r,function(e){c[e]=i[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=oj(a=cj(o=Rj(n).call(n)).call(o)).call(a,function(n,i){return i(e,t,n)||n},c),s&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(s):void 0,c.initializer=void 0),void 0===c.initializer?(Ib(e,t,c),null):c}let Aj=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Oj=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Dj=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),kj=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Pj=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Lj=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),jj=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Mj=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Uj=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Vj=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Fj=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Bj=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Gj(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw aO.error("Invalid Channel Name ".concat(e)),new fO(RR.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Wj(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||MR(e,1,255)))throw new fO(RR.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&aO.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Hj=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Kj={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},zj={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qj(e,t){PR(e.url,"".concat(t,".url"),1,1e3,!1),jR(e.x)||DR(e.x,"".concat(t,".x"),0,1e4),jR(e.y)||DR(e.y,"".concat(t,".y"),0,1e4),jR(e.width)||DR(e.width,"".concat(t,".width"),0,1e4),jR(e.height)||DR(e.height,"".concat(t,".height"),0,1e4),jR(e.zOrder)||DR(e.zOrder,"".concat(t,".zOrder"),0,255),jR(e.alpha)||DR(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Yj={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Xj=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Jj=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Qj=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Zj(e){if(!e.channelName)throw new fO(RR.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new fO(RR.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&PR(e.token,"info.token",1,2047),Wj(e.uid),Gj(e.channelName),!0}let $j=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),eM=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),tM=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),nM=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),iM=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),sM=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),rM=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),aM=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),oM=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const cM=[oM.AFRICA,oM.ASIA,oM.CHINA,oM.EUROPE,oM.GLOBAL,oM.INDIA,oM.JAPAN,oM.NORTH_AMERICA,oM.OCEANIA,oM.OVERSEA,oM.SOUTH_AMERICA];let lM=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const dM={CHINA:{},ASIA:{CODE:lM.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:lM.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:lM.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:lM.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:lM.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:lM.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:lM.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:lM.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:lM.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:lM.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:lM.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:lM.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:lM.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};vA&&(dM.CHINA={CODE:lM.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let uM=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function hM(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class pM extends HR{constructor(e,t){super(),uw(this,"onICEConnectionStateChange",void 0),uw(this,"onConnectionStateChange",void 0),uw(this,"onDTLSTransportStateChange",void 0),uw(this,"onDTLSTransportError",void 0),uw(this,"onICETransportStateChange",void 0),uw(this,"onFirstAudioReceived",void 0),uw(this,"onFirstVideoReceived",void 0),uw(this,"onFirstAudioDecoded",void 0),uw(this,"onFirstVideoDecoded",void 0),uw(this,"onFirstVideoRender",void 0),uw(this,"onFirstVideoDecodedTimeout",void 0),uw(this,"onSelectedLocalCandidateChanged",void 0),uw(this,"onSelectedRemoteCandidateChanged",void 0),uw(this,"onICECandidateError",void 0),uw(this,"getLocalVideoStats",void 0)}}class mM extends pM{constructor(e,t){super(e,t),uw(this,"establishPromise",void 0)}}let fM=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),gM=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),_M=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const yM=["disconnected","failed"];let vM=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),EM=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),bM=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),SM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),xM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),TM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),wM=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),NM=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),CM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),RM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),IM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),AM=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),OM=function(e){return e.ABORT="abort",e}({}),DM=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),kM=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const PM={[Aj.ACCESS_POINT]:{[kj.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[kj.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[kj.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[kj.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[kj.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[kj.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[kj.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Aj.UNILBS]:{[Dj.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Dj.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Dj.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Dj.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Dj.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Dj.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Dj.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Dj.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Dj.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Dj.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Dj.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Dj.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Aj.STRING_UID_ALLOCATOR]:{[Oj.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Oj.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Oj.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function LM(e){const t=PM[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Aj.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const jM={[Pj.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Pj.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Pj.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Pj.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Pj.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Pj.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Pj.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Pj.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Pj.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Pj.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Pj.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Pj.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Pj.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Pj.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Pj.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Pj.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Pj.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Pj.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Pj.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Pj.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Pj.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Pj.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Pj.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Pj.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Pj.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Pj.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Pj.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Pj.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Pj.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Pj.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Pj.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Pj.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Pj.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Pj.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Pj.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Pj.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Pj.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Pj.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Pj.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Pj.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Pj.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Pj.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Pj.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Pj.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Pj.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Pj.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Pj.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Pj.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Pj.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Pj.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Pj.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Pj.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Pj.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Pj.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Pj.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Pj.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Pj.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Pj.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Pj.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Pj.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Pj.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Pj.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Pj.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Pj.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function MM(e){return jM[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function UM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function VM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UM(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function FM(e,t){if("string"==typeof e)return e;const{proxy:n,host:i,port:s}=e;if(t){const e=RA("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(e,"/ws/?p=").concat(Number(s)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}const BM=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,GM=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,WM=/wss:\/\/(.+):([0-9]+)\/?/,HM=/wss:\/\/(.[^\/]+)\/?/;let KM=0;class zM{constructor(e,t){uw(this,"id",0),uw(this,"store",void 0),uw(this,"recordIndex",void 0),uw(this,"websockets",[]),uw(this,"try443PortDuration",2e3),uw(this,"forceCloseWSDuration",5e3),uw(this,"try443PortTimeout",null),uw(this,"forceCloseTimeout",null),uw(this,"isTry443PortFailed",!1),uw(this,"isNormalPortFailed",!1),uw(this,"useDoubleDomain",!1),uw(this,"useProxy",!1),uw(this,"startTime",Date.now()),this.id=++KM,this.try443PortDuration=RA("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];aO.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...i)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const i=RA("GATEWAY_DOMAINS"),s=Date.now(),r=[],a=i.find(t=>{var n;return Pi(n=e.host).call(n,t)});a||(this.useDoubleDomain=!1);const o=[];if(this.useDoubleDomain)i.forEach(n=>{o.push(FM(VM(VM({},e),{},{host:e.host.replace(a,n)}),t))});else{const n=VM({},e);if(t&&a){const e=i.find(e=>e!==a);e&&(n.host=n.host.replace(a,e))}o.push(FM(n,t))}try{o.forEach(e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",r.push(t),this.logger("ws is connecting:",t.url)})}catch(i){if(this.logger("ws create failed"),r.forEach(e=>e.close()),r.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new fO(RR.WS_ERR,"init websocket failed! Error: ".concat(i.toString()))}const c=UC();this.store&&this.store.recordJoinChannelService({urls:r.map(e=>e.url),service:"gateway"},this.recordIndex),r.forEach(e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))}),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(e.readyState));const i=r.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(i)),i&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:rM.A_ROUND_WS_FAILED})):!t&&i&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),d()),t?this.isTry443PortFailed=i:this.isNormalPortFailed=i},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))}),this.websockets.push(...r);const l=()=>{this.websockets.forEach(e=>e.readyState!==WebSocket.OPEN&&e.close())},d=()=>{if(c.isResolved)return l();qC().os===GC.MAC_OS&&nR()&&l(),this.createWebSocket(e,!0,!0).then(e=>{c.resolve(e)}).catch(e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,l()},this.forceCloseWSDuration)};return n||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,l()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,d()},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,i){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,i;return[,t,n,i]=e.match(BM)||[],t||([,n,i]=e.match(GM)||[]),n&&i||([,n,i]=e.match(WM)||[]),n&&i||([,n]=e.match(HM)||[]),n||aO.warning("un-destructible url: ",e),{proxy:t,host:n,port:i||"443"}}(e)),this.recordIndex=i,this.useProxy=!!e.proxy,n&&this.useProxy&&(aO.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally(()=>this.clearTimeout())}}function qM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}class YM extends HR{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Pi(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Bj.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Bj.CONNECTED):"closed"===this._state?this.emit(Bj.CLOSED):"failed"===this._state&&this.emit(Bj.FAILED))}resetReconnectCount(e){aO.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5?arguments[5]:void 0;super(),uw(this,"_websocketUrl",null),uw(this,"connectionID",0),uw(this,"currentURLIndex",0),uw(this,"urls",[]),uw(this,"_reconnectMode","tryNext"),uw(this,"reconnectReason",void 0),uw(this,"_initMutex",void 0),uw(this,"name",void 0),uw(this,"_state","closed"),uw(this,"reconnectInterrupter",void 0),uw(this,"websocket",void 0),uw(this,"retryConfig",void 0),uw(this,"reconnectCount",0),uw(this,"forceCloseTimeout",5e3),uw(this,"onlineReconnectListener",void 0),uw(this,"useCompress",void 0),uw(this,"tryDoubleDomain",!1),uw(this,"use443PortOnly",!1),uw(this,"wsInflateLength",0),uw(this,"wsDeflateLength",0),uw(this,"closeEstablishingWs",()=>{}),uw(this,"store",void 0),uw(this,"joinGatewayRecordIndex",void 0),this.store=r,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qM(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t),this.useCompress=n,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new UI("websocket",r?r.clientId:void 0);const{timeout:a,timeoutFactor:o}=t,c=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*o)/10);iI.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),lI.on(sI.NETWORK_STATE_CHANGE,(e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===iI.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=o))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{var i;const e=UC(),t=this.urls[this.currentURLIndex];null===(i=this.store)||void 0===i||i.beforeConnect(),function(e){return!(vO()||RA("USE_NEW_TOKEN")||!RA("ENABLE_PREALLOC_PC")&&(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(wM.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(Bj.CLOSED,()=>{e.reject(new IR(RR.WS_DISCONNECT))}),this.once(Bj.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout(()=>e.close(),500):e.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void aO.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),aO.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new IR(RR.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new IR(RR.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=UC();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),aO.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},s=async e=>{var t;if(aO.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new IR(RR.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=oI(this,Bj.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,i=await this.reconnectWithAction(t);if("closed"===this.state)return void aO.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!i)return n.reject(new IR(RR.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},r=e=>{this.emit(Bj.ON_MESSAGE,e)},a=e=>{aO.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),RA("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=RA("GATEWAY_WSS_ADDRESS")),aO.debug("[".concat(this.name,"] start connect, url:"),e);const o=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;this._websocketUrl=FM(e);const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=r,this.websocket.onerror=a,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},o),this.joinGatewayRecordIndex=o}catch(e){const t="closed"===this.state,i=e instanceof IR,r=i&&e.code===RR.WS_ABORT,a=i&&e.code===RR.WS_ERR,c=i?e.message:e&&(e.reason||e.toString());aO.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:r?"aborted":"error",errors:[e]},o),t||a?(n.reject(t?new IR(RR.WS_DISCONNECT,"websocket is closed: ".concat(c)):new IR(RR.WS_ERR,"init websocket failed: ".concat(c))),a&&aO.error("[".concat(this.name,"] init websocket failed: ").concat(c))):s&&s(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;aO.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||lI.isOnline||!lI.onlineWaiter||(this.onlineReconnectListener=lI.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=BI(this.reconnectCount,this.retryConfig);aO.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await np.race([TI(t),this.onlineReconnectListener||new np(()=>{})])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const i=async(e,t)=>{this.emit(Bj.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await i(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);aO.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],e)}else"recover"===e&&(aO.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await rI(this,Bj.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(n){var s;aO.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const i=null==n||null===(s=n.data)||void 0===s?void 0:s.desc;return Array.isArray(i)&&Pi(i).call(i,"dynamic key expired")?(this.emit(Bj.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class XM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=UC(),i=function(e,t){return new zM(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),n.reject(new IR(RR.WS_ABORT,"choose best websocket aborted"))};const s=RA("GATEWAY_DOMAINS");return aO.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class JM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new np((n,i)=>{let s=!1;const r=[];this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),r.forEach(e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()}),i(new IR(RR.WS_ABORT,"choose best websocket aborted"))};const a=RA("GATEWAY_DOMAINS");let o;const c=e.indexOf("?h="),l=a.find(t=>-1!==c?Pi(e).call(e,t,c):Pi(e).call(e,t));aO.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let d=!this.tryDoubleDomain||!l;if(!d&&l){var u;const h=Date.now();try{a.forEach(t=>{const n=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),i=new WebSocket(n);i.binaryType="arraybuffer",r.push(i),aO.debug("[choose-best-ws] ws is connecting:",i.url)})}catch(e){for(aO.debug("[choose-best-ws] ws create failed, fallback to single url"),r.forEach(e=>e.close());r.length;)r.pop();d=!0}null===(u=this.store)||void 0===u||u.recordJoinChannelService({urls:r.map(e=>e.url),service:"gateway"},t),r.forEach(e=>{e.onopen=()=>{if(s)return;const t=Date.now()-h;aO.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),r.filter(t=>t!==e).forEach(e=>{aO.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()}),s=!0,n(e)},e.onclose=e=>{o=e,s||r.find(e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))||(aO.debug("[choose-best-ws] all websocket is closed"),s=!0,i(o))},e.onmessage=t=>{aO.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}}),TI(this.forceCloseTimeout).then(()=>{r.forEach(e=>{e.readyState!==WebSocket.OPEN&&e.close()})})}if(d){var h;let s;aO.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{s=new WebSocket(e),r.push(s),s.binaryType="arraybuffer"}catch(e){const n=new IR(RR.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return aO.error("[".concat(this.name,"]").concat(n)),void i(n)}s.onopen=()=>{n(s)},s.onclose=e=>{i(e)},s.onmessage=e=>{aO.debug("[choose-best-ws]".concat(s.url," onmessage: ").concat(e.data))},TI(this.forceCloseTimeout).then(()=>{s&&s.readyState!==WebSocket.OPEN&&s.close()})}}).then(e=>(this.closeEstablishingWs=void 0,e)).catch(e=>{throw this.closeEstablishingWs=void 0,e})}}class QM extends HR{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Lj.CONNECTED?this.emit(jj.WS_CONNECTED):e===Lj.RECONNECTING?this.emit(jj.WS_RECONNECTING,this._websocketReconnectReason):e===Lj.CLOSED&&this.emit(jj.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uw(this,"_disconnectedReason",void 0),uw(this,"_websocketReconnectReason",void 0),uw(this,"_connectionState",Lj.CLOSED),uw(this,"reconnectToken",void 0),uw(this,"websocket",void 0),uw(this,"openConnectionTime",void 0),uw(this,"clientId",void 0),uw(this,"lastMsgTime",Date.now()),uw(this,"uploadCache",[]),uw(this,"uploadCacheInterval",void 0),uw(this,"rttRolling",new HI(5)),uw(this,"pingpongTimer",void 0),uw(this,"wsInflateDataTimer",void 0),uw(this,"pingpongTimeoutCount",0),uw(this,"ortc",void 0),uw(this,"joinResponse",void 0),uw(this,"multiIpOption",void 0),uw(this,"initError",void 0),uw(this,"spec",void 0),uw(this,"store",void 0),uw(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(jj.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===Vj.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===Vj.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QR.UID_BANNED);break;case 15:this.close(QR.IP_BANNED);break;case 16:this.close(QR.CHANNEL_BANNED)}if(t._type===Vj.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Pj.ERR_LICENSE_MISSING:this.close(QR.LICENSE_MISSING);break;case Pj.ERR_LICENSE_EXPIRED:this.close(QR.LICENSE_EXPIRED);break;case Pj.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QR.LICENSE_MINUTES_EXCEEDED);break;case Pj.ERR_LICENSE_PERIOD_INVALID:this.close(QR.LICENSE_PERIOD_INVALID);break;case Pj.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QR.LICENSE_MULTIPLE_SDK_SERVICE);break;case Pj.ERR_LICENSE_ILLEGAL:this.close(QR.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,RA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),RA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lj.CONNECTED&&this.reconnect("retry",nI.OFFLINE)})}async request(e,t,n,i){const s=wI(6,""),r={_id:s,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new np((t,n)=>{if(this.connectionState===Lj.CONNECTED)return t();const i=()=>{this.off(jj.WS_CLOSED,s),t()},s=()=>{this.off(jj.WS_CONNECTED,i),n(new fO(RR.WS_ABORT))};this.once(jj.WS_CONNECTED,i),this.once(jj.WS_CLOSED,s),e!==Mj.PUBLISH&&e!==Mj.PUBLISH_DATASTREAM&&e!==Mj.SUBSCRIBE&&e!==Mj.SUBSCRIBE_DATASTREAM&&e!==Mj.UNSUBSCRIBE&&e!==Mj.UNSUBSCRIBE_DATASTREAM&&e!==Mj.UNPUBLISH&&e!==Mj.UNPUBLISH_DATASTREAM&&e!==Mj.CONTROL&&e!==Mj.RESTART_ICE||this.once(jj.DISCONNECT_P2P,()=>{n(new fO(RR.DISCONNECT_P2P))}),e!==Mj.PUBLISH&&e!==Mj.RESTART_ICE||this.once(jj.ABORT_P2P_EXECUTION,()=>{n(new fO(RR.DISCONNECT_P2P))})});if(this.connectionState!==Lj.CONNECTING&&this.connectionState!==Lj.RECONNECTING||e===Mj.JOIN||e===Mj.REJOIN||await o(),this.websocket.sendMessage(r,!0),i)return;const c=new np((n,i)=>{let r=!1;const o=(i,s)=>{r=!0,n({isSuccess:"success"===i,message:s||{}}),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.emit(jj.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(s),o);const c=()=>{i(new fO(RR.WS_ABORT,"type: ".concat(e))),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.off("res-@".concat(s),o)};this.once(jj.WS_CLOSED,c),this.once(jj.WS_RECONNECTING,c),TI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||r||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(jj.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(i){if(this.connectionState===Lj.CLOSED||e===Mj.LEAVE)throw new fO(RR.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?i.throw():e===Mj.JOIN||e===Mj.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new fO(RR.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===Pj.ERR_TOO_MANY_BROADCASTERS?e===Mj.JOIN||e===Mj.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===Pj.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nI.MULTI_IP)):this.reconnect(u.action,nI.SERVER_ERROR),e===Mj.JOIN||e===Mj.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np(n=>{const i=s=>{(!t||t(s))&&(this.off(e,i),n(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Uj.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=RA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lj.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},RA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np((t,n)=>{this.once(jj.WS_CONNECTED,()=>t(this.joinResponse)),this.once(jj.WS_CLOSED,e=>n(this.initError||new fO(RR.WS_ABORT,e))),this.connectionState=Lj.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||QR.LEAVE,this.connectionState=Lj.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(jj.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await rI(this,jj.REQUEST_JOIN_INFO);this.store.joinReq();const t=await this.request(Mj.JOIN,e);if(this.ortc=null==e?void 0:e.ortc,this.store.joinRep(),!t)return this.emit(jj.REPORT_JOIN_GATEWAY,rM.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(jj.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lj.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new fO(RR.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=cI(this,jj.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(Mj.REJOIN,e);return!!t&&(this.connectionState=Lj.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(e=>{this.emit(Vj.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(Vj.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(Vj.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(Vj.MUTE_AUDIO,{uid:e.uid}):this.emit(Vj.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(Vj.MUTE_VIDEO,{uid:e.uid}):this.emit(Vj.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(Vj.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(Vj.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(Vj.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(Vj.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(Vj.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){if(!this.ortc)return!1;const t={downgrade_codec:e,ortc:this.ortc};return!!await this.request(Mj.DOWNGRADE_CODEC,t)}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if(28===e.code&&"detail"in e&&(aO.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(jj.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QR.UID_BANNED),void this.close()):void this.reconnect(t.action,nI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=RA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>RA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nI.TIMEOUT):this.request(Mj.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),RA("REPORT_STATS")&&this.send(Mj.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(Uj.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Bj.RECONNECT_CREATE_CONNECTION,e=>{this.emit(jj.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Bj.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bj.CLOSED,()=>{this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.FAILED,()=>{this._disconnectedReason=QR.NETWORK_ERROR,this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Lj.CONNECTED?this.connectionState=Lj.RECONNECTING:this.connectionState=Lj.CONNECTING}),this.websocket.on(Bj.WILL_RECONNECT,(e,t,n)=>{const i=cI(this,jj.IS_P2P_DISCONNECTED),s=i||"retry"!==e;i&&"retry"===e&&(aO.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=rM.P2P_DISCONNECTED),s&&(aO.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(jj.REPORT_JOIN_GATEWAY,t||rM.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(jj.DISCONNECT_P2P)),n(e)}),this.websocket.on(Bj.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{aO.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",nI.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(jj.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof fO){if(e.code===RR.UNEXPECTED_RESPONSE&&e.data.code===Pj.ERR_NO_AUTHORIZED)return this.initError=new fO(RR.TOKEN_EXPIRE,"dynamic key expired"),void this.close(QR.TOKEN_EXPIRE);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nI.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Bj.REQUEST_NEW_URLS,(e,t)=>{rI(this,jj.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Bj.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Vj.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(wM.PRE_CONNECT_PC,()=>{this.emit(jj.PRE_CONNECT_PC)})}}let ZM=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),$M=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function eU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function tU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eU(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nU(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(RA("TURN_DOMAIN")):(aO.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function iU(e){try{const t=RA("GATEWAY_DOMAINS").concat(RA("TURN_DOMAIN")).find(t=>Pi(e).call(e,t));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch(t){return aO.debug("serverUrlToIp error, fallback to url",e),e}}function sU(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(RA("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map(e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}});const n=RA("GATEWAY_DOMAINS");let i=n[1]&&Pi(t).call(t,n[1])?1:0;return e.map(e=>{let{domain_prefix:t,port:s,ip:r}=e;if(t)return{address:"".concat(t,".").concat(n[i++%n.length],":").concat(s)};const a=/^[\.\:\d]+$/.test(r),o=a?"".concat(r.replace(/[^\d]/g,"-"),".").concat(n[i++%n.length],":").concat(s):"".concat(r,":").concat(s);return a||aO.debug("Cannot recognized as ip address: ".concat(r,", use as host3")),{ip:r,port:s,address:o}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&"string"==typeof i){const e=i.split(";");for(let t=0;t<e.length;t++){var s;const i=Dv(s=e[t]).call(s);n[t]&&i&&(n[t].ip6=i)}}const r=e.detail&&e.detail.candidate;let a;if(r){const[e,t]=r.split(":");e&&t&&(a={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function rU(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function aU(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(rU(t.width),"x").concat(rU(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function oU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function cU(e,t){let n,i,s;switch(t){case $M.CHOOSE_SERVER:i=4096,s="choose server";break;case $M.CLOUD_PROXY:i=1048576,s="proxy";break;case $M.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case $M.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new fO(RR.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(t=>{t.buffer&&t.buffer.flag===i&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map(e=>tU(tU({},e),{},{ticket:t.buffer.cert})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:tU(tU({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})}),!n)throw new fO(RR.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function lU(e,t){return await np.all(e.addresses.map(async e=>({address:nU(e.ip),tcpport:e.port,udpport:e.port,username:t&&RA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():bA.username,password:t&&RA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await WR(t.toString()):bA.password})))}function dU(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,s=t.videoWidth||n.width;return i&&s?Math.max(Math.min(i,s)/Math.min(rU(e.height),rU(e.width)),1):(aO.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function uU(e){let{candidateType:t,relayProtocol:n,type:i,address:s,port:r,protocol:a}=e;const o={candidateType:t,relayProtocol:n,protocol:a};if("local-candidate"!==i){const e=s.split(".");e.length>=4&&(e[1]="*",e[2]="*"),o.address=e.join("."),o.port=r}return o}function hU(e){const t=e.split(":"),n=e.split(/[-.]/),i=Pi(e).call(e,"-")?"-":".";let s=e;return t.length>1?n.length>1?(n[1]="**",s=n[0]+i+"**:"+t[t.length-1]):s=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(s=n[0]+i+"**"),s}function pU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RA("SVC_MODE");if(RA("ENABLE_SVC"))return function(e){return e in cA}(e)?e:cA.L1T3}const mU={[fM.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[fM.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function fU(e,t,n){t.forEach(t=>{var i;const s=mU[e].find(e=>{var n;let{key:i}=e;return Pi(n=t.extensionName).call(n,i)});if(!s)return;const r=n.find(e=>{let{extensionName:t}=e;return Pi(t).call(t,s.key)});r&&Pi(i=r.extensionName).call(i,"gdpr_forbidden")&&(t.extensionName=r.extensionName)})}function gU(e,t){t.forEach(t=>{var n;const i=mU[e].find(e=>{var n;let{key:i}=e;return Pi(n=t.extensionName).call(n,i)});Pi(n=t.extensionName).call(n,"gdpr_forbidden")&&i&&(t.extensionName=i.extensionName)})}function _U(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Pi(e).call(e,"abs-send-time")}function yU(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Pi(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function vU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function EU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vU(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function bU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:r,filterAudioFec:a,filterAudioCodec:o,filterVideoCodec:c,unsupportedVideoUplinkCodec:l,unsupportedVideoDownlinkCodec:d}=t,{useXR:u}=n;let h=[],p=[],m=[],f=[],g=!1,_=!1;if(VA(e).mediaDescriptions.forEach(e=>{i&&i!==e.attributes.direction||("video"!==e.media.mediaType||g||(p=e.attributes.payloads,f=e.attributes.extmaps,g=!0),"audio"!==e.media.mediaType||_||(h=e.attributes.payloads,m=e.attributes.extmaps,_=!0))}),!f||0===p.length)throw new Error("Cannot get video capabilities from SDP.");if(!m||0===h.length)throw new Error("Cannot get audio capabilities from SDP.");if(p.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),h.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),s&&(h=h.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}),p=p.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),r){const e=p.filter(e=>{var t;return/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}),t=VU(e,p).map(e=>e.payloadType),n=[...e.map(e=>e.payloadType),...t];p=p.filter(e=>!Pi(n).call(n,e.payloadType))}if(a&&(h=h.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),o&&(null==o?void 0:o.length)>0&&(h=h.filter(e=>{var t;return Pi(o).call(o,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})),c&&(null==c?void 0:c.length)>0){const e=p.filter(e=>{var t;return Pi(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")});p=e.concat(s?[]:VU(e,p))}const y=RA("UNSUPPORTED_VIDEO_CODEC");if(y&&y.length>0){const e=p.filter(e=>e.rtpMap&&Pi(y).call(y,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Pi(n).call(n,e.payloadType)),aO.debug("unsupportedVideoCodec: ".concat(y,", toBeRemoved: ").concat(n))}if(l&&l.length>0&&"sendonly"===i){const e=p.filter(e=>e.rtpMap&&Pi(l).call(l,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Pi(n).call(n,e.payloadType)),aO.debug("unsupportedVideoUplinkCodec: ".concat(l,", toBeRemoved: ").concat(n))}if(d&&d.length>0&&"recvonly"===i){const e=p.filter(e=>e.rtpMap&&Pi(d).call(d,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Pi(n).call(n,e.payloadType)),aO.debug("unsupportedVideoDownlinkCodec: ".concat(d,", toBeRemoved: ").concat(n))}return{audioCodecs:h,videoCodecs:p,audioExtensions:m,videoExtensions:f}}function SU(e){const t=VA(e);let n,i;for(const s of t.mediaDescriptions){if(!n){const e=s.attributes.iceUfrag,t=s.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!i){const e=s.attributes.fingerprints;e.length>0&&(i={fingerprints:e})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function xU(e,t){const n=[],i=e.attributes.ssrcGroups.filter(e=>"FID"===e.semantic),s=e.attributes.ssrcGroups.find(e=>"SIM"===e.semantic),r=e.attributes.ssrcs;if(s)s.ssrcIds.forEach(e=>{var s;const r=null===(s=i.find(t=>t.ssrcIds[0]===e))||void 0===s?void 0:s.ssrcIds[1];n.push({ssrcId:e,rtx:t?r:void 0})});else if(i.length>0){const e=i[0].ssrcIds[0],s=i[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?s:void 0})}else{if(0===r.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:r[0].ssrcId})}return n}function TU(e,t,n){const{cname:i}=e;let s=[];t&&(s=wU(t)),0===s.length&&(s=e.iceParameters.candidates.map(e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})),aO.debug("Using candidates from gateway."));const r={fingerprints:e.dtlsParameters.fingerprints.map(e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let o;switch(e.dtlsParameters.role){case"server":o="passive";break;case"client":o="active";break;case"auto":o="actpass"}const c=jU(e.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach(e=>{l.push({kind:fM.VIDEO,ssrcMsg:[{ssrcId:e.v,rtx:e.v_rtx}],mslabel:"".concat(e.v,"_").concat(e.a)},{kind:fM.AUDIO,ssrcMsg:[{ssrcId:e.a}],mslabel:"".concat(e.v,"_").concat(e.a)})}),{dtlsParameters:r,iceParameters:a,candidates:s,rtpCapabilities:c,setup:o,cname:i,preSSRCs:l}}function wU(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],aO.debug("Using remote candidate from AP ".concat(hU(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),aO.debug("Using IPV6 remote candidate from AP ".concat(hU(e.ip6),":").concat(e.port)))),t}function NU(e,t,n){const i=[],s=[];return e.forEach(e=>{let{ssrcId:r,rtx:a}=e;const o=wI(8,"track-"),c={ssrcId:r,attributes:EU({label:o,mslabel:n=n||wI(10,""),msid:"".concat(n," ").concat(o)},t&&{cname:t})};if(i.push(c),void 0!==a){const e={ssrcId:a,attributes:EU({label:o,mslabel:n,msid:"".concat(n," ").concat(o)},t&&{cname:t})};i.push(e),s.push({semantic:"FID",ssrcIds:[r,a]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map(e=>{let{ssrcId:t}=e;return t})}),{ssrcs:i,ssrcGroups:s}}function CU(e,t){t instanceof Fk&&e.attributes.payloads.forEach(e=>{var n;const i=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!i||-1===["opus","pcmu","pcma","g722"].indexOf(i))return;e.fmtp||(e.fmtp={parameters:{}}),"opus"===i&&"number"==typeof RA("OPUS_PTIME")?e.fmtp.parameters.ptime=RA("OPUS_PTIME"):e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&("pcmu"!==i&&"pcma"!==i&&"g722"!==i&&(s.bitrate&&!nR()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1")),t instanceof Bk&&"opus"===i&&t._config.DTX&&(e.fmtp.parameters.usedtx="1"))})}function RU(e){const t=e.attributes.unrecognized.findIndex(e=>"x-google-flag"===e.attField&&"conference"===e.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}function IU(e,t){var n;if(!(t instanceof PP&&t._encoderConfig&&-1===t._hints.indexOf(UO.SCREEN_TRACK)))return;const i=t._encoderConfig;_O().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(e=>{var t,n;Pi(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),_O().supportMinBitrate&&!Pi(n=t._hints).call(n,UO.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(e=>{var t,n;Pi(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(RA("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function AU(e){if("video"!==e.media.mediaType)return;const t=qC();if(t.name!==WC.SAFARI&&t.os!==GC.IOS)return;const n=e.attributes.extmaps.findIndex(e=>/video-orientation/g.test(e.extensionName));-1!==n&&e.attributes.extmaps.splice(n,1)}function OU(e,t,n){if(!t)return;let i,s;if("video"===e.media.mediaType?(i=n.videoExtensions,s=n.videoCodecs):(i=n.audioExtensions,s=n.audioCodecs),!0===t.twcc){const t=i.find(e=>yU(e.extensionName));if(t){const n=t.extensionName;e.attributes.extmaps.find(e=>yU(e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const i=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)))}(s,e.attributes.payloads);i.forEach(e=>{e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)||e.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex(e=>yU(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}if(!0===t.remb){const t=i.find(e=>_U(e.extensionName));if(t){const n=t.extensionName;e.attributes.extmaps.find(e=>e.extensionName===n)||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const i=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)))}(s,e.attributes.payloads);i.forEach(e=>{e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)||e.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex(e=>_U(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"goog-remb"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}}function DU(e,t,n){if(nR())return;if("video"!==e.media.mediaType)return;if(!(t instanceof PP))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!RA("SIMULCAST"))return;if("vp9"===n&&RA("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const i="vp8"===n?2:t._scalabilityMode.numSpatialLayers,s=e.attributes.ssrcs[0],r=e.attributes.ssrcGroups.find(e=>"FID"===e.semantic&&e.ssrcIds[0]===s.ssrcId),a={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let o=1;o<i;o++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+o,attributes:pI(s.attributes)}),a.ssrcIds.push(s.ssrcId+o),r&&(e.attributes.ssrcs.push({ssrcId:r.ssrcIds[1]+o,attributes:pI(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+o,r.ssrcIds[1]+o]}));e.attributes.ssrcGroups.unshift(a)}async function kU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:s,recv:r,sendrecv:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=bU(n,e,t,"sendonly"),s=bU(n,e,t,"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(LU(i,s,"videoExtensions",r,a,o),LU(i,s,"videoCodecs",r,a,o),LU(i,s,"audioExtensions",r,a,o),LU(i,s,"audioCodecs",r,a,o),RA("RAISE_H264_BASELINE_PRIORITY")){const e=[],t=[];if(o.videoCodecs.forEach((n,i)=>{var s;if("h264"===(null===(s=n.rtpMap)||void 0===s?void 0:s.encodingName.toLocaleLowerCase())){var r,a;const s=o.videoCodecs[i+1],c=s&&HU(n,s),l=null===(r=n.fmtp)||void 0===r?void 0:r.parameters["profile-level-id"],d=null===(a=n.fmtp)||void 0===a?void 0:a.parameters["packetization-mode"];!l||l!==RA("FIRST_H264_PROFILE_LEVEL_ID")||RA("FIRST_PACKETIZATION_MODE")&&d!==RA("FIRST_PACKETIZATION_MODE")?c?t.push([n,s]):t.push([n]):c?e.push([n,s]):e.push([n])}}),e.length>0&&t.length>0){aO.debug("raising H264 baseline profile priority"),o.videoCodecs.forEach((n,i)=>{var s;if("h264"===(null===(s=n.rtpMap)||void 0===s?void 0:s.encodingName.toLocaleLowerCase())){const s=HU(n,o.videoCodecs[i+1]),r=e.shift()||t.shift()||[];r.length>0&&(s?o.videoCodecs.splice(i,2,...r):o.videoCodecs.splice(i,1,...r))}});const n=a.videoCodecs.filter(e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==RA("FIRST_H264_PROFILE_LEVEL_ID")});if(n.length>0){const e=VU(n,a.videoCodecs).map(e=>e.payloadType),t=[...n.map(e=>e.payloadType),...e];a.videoCodecs=a.videoCodecs.filter(e=>!Pi(t).call(t,e.payloadType))}RA("FILTER_SEND_H264_BASELINE")&&(r.videoCodecs=r.videoCodecs.filter(e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==RA("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:r,recv:a,sendrecv:o}}return{send:r,recv:a,sendrecv:o}}(e,t,i);try{n.close()}catch(e){}return{send:s,recv:r,sendrecv:a}}function PU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(LU(e,t,"videoExtensions",n,i,s),LU(e,t,"videoCodecs",n,i,s),LU(e,t,"audioExtensions",n,i,s),LU(e,t,"audioCodecs",n,i,s),RA("RAISE_H264_BASELINE_PRIORITY")){const e=s.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=s.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const n=s.videoCodecs[e];s.videoCodecs.splice(e,1),s.videoCodecs.splice(t,0,n)}-1!==t&&(i.videoCodecs=i.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:i,sendrecv:s}}function LU(e,t,n,i,s,r){if("videoExtensions"===n||"audioExtensions"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0})?r[n].push(e):i[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&s[n].push(e)})}if("videoCodecs"===n||"audioCodecs"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(n),!0})?r[n].push(e):i[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&s[n].push(e)})}}function jU(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let s,r;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,n?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...n.audioCodecs,...i.audioCodecs],r.videoCodecs=[...n.videoCodecs,...i.videoCodecs],r.audioExtensions=[...n.audioExtensions,...i.audioExtensions],r.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):r=i,{send:s,recv:r}}function MU(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function UU(e,t,n,i){let s=[];if(e===fM.VIDEO){if(RA("H264_PROFILE_LEVEL_ID")&&"h264"===i&&(s=t.videoCodecs.filter(e=>{var t;return Pi(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,i)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===RA("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||0===s.length){let e=[];const r=[],a=[],o=[];if(n.videoCodecs.forEach(t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Pi(n).call(n,i)?e.push(t):Pi(n).call(n,"vp9")?r.push(t):Pi(n).call(n,"vp8")?a.push(t):Pi(n).call(n,"h264")&&o.push(t)}),0===e.length){let t="";0!==r.length?(e=r,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==o.length&&(e=o,t="h264"),aO.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(s=t.videoCodecs.filter(t=>e.some(e=>e.payloadType===t.payloadType)))}if(0===s.length&&(aO.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),s=t.videoCodecs),RA("USE_PUB_RTX")||RA("USE_SUB_RTX")){const e=VU(s,t.videoCodecs);s=[...s,...e]}}else{s=t.audioCodecs.filter(e=>{var t;return Pi(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,i)});const e=t.audioCodecs.filter(e=>{var t;return Pi(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"red")});0===s.length&&(aO.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),s=t.audioCodecs.filter(e=>{var t;return Pi(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})),RA("ENABLE_AUDIO_RED")&&0!==e.length&&(s=[...e,...s])}return s}function VU(e,t){const n=e.map(e=>e.payloadType.toString());return t.filter(e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Pi(n).call(n,e.fmtp&&e.fmtp.parameters.apt))}async function FU(e,t,n){const i=t.toString(),s=GU(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const r=await e.createAnswer();if(!r.sdp)throw new Error("cannot get answer sdp");let a=r.sdp;a=BU(a,n||{}),null==s||s(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function BU(e,t,n){const i=VA(e),{useXR:s}=t;return i.mediaDescriptions.forEach(e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!Pi(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&MU(e),s&&Pi(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach(e=>{-1===e.rtcpFeedbacks.findIndex(e=>"rrtr"===e.type)&&e.rtcpFeedbacks.push({type:"rrtr"})})))}),FA(i)}function GU(e,t,n,i){if(RA("SDP_LOGGING"))return aO.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,"\n"),e),"offer"===t?e=>{GU(e,"answer","local"===n?"remote":"local",i)}:void 0}function WU(e){const t=RA("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(t=>Pi(e).call(e,t))}function HU(e,t){try{var n;return(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function KU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function zU(e,t){return typeof RA(e)===t?RA(e):void 0}function qU(){try{const e=RA("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KU(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e)}catch(e){return aO.debug("handle gateway attributes failed: ",e),{}}}const YU={};function XU(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&aO.debug("install service ".concat(e.name)),YU[e.name]=e}function JU(e){const t=YU[e];if(!t)throw new IR(RR.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function QU(e,t){return JU("DataStream").create(e,t)}function ZU(){return JU("InterceptFrame").create()}function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function eV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$U(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const tV=new Map;class nV extends HR{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(sM.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(sM.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){aO.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var n,i,s;super(),uw(this,"store",void 0),uw(this,"joinInfo",void 0),uw(this,"key",void 0),uw(this,"ntpOffset",0),uw(this,"signal",void 0),uw(this,"role",void 0),uw(this,"isPreallocation",void 0),uw(this,"isPreSub",void 0),uw(this,"inChannelInfo",{joinAt:null,duration:0}),uw(this,"spec",void 0),uw(this,"_state","DISCONNECTED"),uw(this,"_statsCollector",void 0),uw(this,"_disconnectedReason",void 0),uw(this,"isSignalRecover",!1),uw(this,"hasChangeBGPAddress",!1),uw(this,"trafficStatsInterval",void 0),uw(this,"networkQualityInterval",void 0),uw(this,"_joinGatewayStartTime",0),uw(this,"_signalTimeout",!1),uw(this,"_clientRoleOptions",void 0),uw(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(n={spec:eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(i=(s=JU("P2PChannel")).createSubmodule)||void 0===i?void 0:i.call(s,n)):new QM(eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=tV.get(e.cname);if(s||(s=new Map,tV.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const t=new fO(RR.UID_CONFLICT);throw mO.joinGateway(e.sid,{lts:i,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}s.set(e.uid,!0),this.joinInfo=e,this.key=t;let r=0;this.joinGatewayStartTime=i;const a=e.proxyServer;try{aO.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(r));const t=e.gatewayAddrs.map(t=>{let{address:n}=t;const[i,s]=n.split(":"),r={host:i,port:s};return e.proxyServer&&(r.proxy=e.proxyServer),r});r=(await this.signal.init(t)).uid,aO.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(r," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var o;throw aO.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),mO.joinGateway(e.sid,{lts:i,succ:!1,ec:(null===(o=t.data)||void 0===o?void 0:o.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!a,signalChannel:"0",preload:e.preload}),s.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),aO.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{aO.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(sM.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(sM.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(sM.NETWORK_QUALITY,{uplinkNetworkQuality:oU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:oU(this._statsCollector.trafficStats.B_dnq)}):this.emit(sM.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),r}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==QR.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Lj.CONNECTED||await function(e,t){return t===1/0?e:np.race([e,xI(t)])}(this.signal.request(Mj.LEAVE,void 0,!0),3e3)}catch(e){aO.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==QR.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:RA("PUB_EXTEND"),twcc:!!RA("PUBLISH_TWCC"),rtx:!!RA("USE_PUB_RTX")};try{return(await this.signal.request(Mj.PUBLISH,i,!0))._message}catch(i){if(n&&i.data&&i.data.code===Pj.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),i.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw i}}async publishDataChannel(e,t,n){var i;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(i=t.maxRetransmits)&&void 0!==i?i:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(Mj.PUBLISH_DATASTREAM,s,!0)}catch(i){if(n&&i.data&&i.data.code===Pj.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),i.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw i}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Mj.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map(e=>this.signal.request(Mj.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){aO.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!RA("SUBSCRIBE_TWCC"),rtx:!!RA("USE_SUB_RTX")||void 0,extend:RA("SUB_EXTEND"),svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return await this.signal.request(Mj.PRE_SUBSCRIBE,i,!0)}catch(i){if(n&&i.data&&i.data.code===Pj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),i.toString()),this.presubscribe(e,t,!1);throw i}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!RA("SUBSCRIBE_TWCC"),rtx:!!RA("USE_SUB_RTX"),extend:RA("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return(await this.signal.request(Mj.SUBSCRIBE,i,!0))._message}catch(i){if(n&&i.data&&i.data.code===Pj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),i.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw i}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(Mj.SUBSCRIBE_DATASTREAM,i,!0)}catch(i){if(n&&i.data&&i.data.code===Pj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),i.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw i}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!RA("USE_SUB_RTX"),twcc:!!RA("SUBSCRIBE_TWCC"),svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return await this.signal.request(Mj.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===Pj.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,i=e.height,s=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(s=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(s=!1)),"number"!=typeof i&&(i=i.exact||i.ideal||i.max||i.min||0,t||(s=!1)),s?{stream_type:0,width:n,height:i,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(Mj.SET_VIDEO_PROFILE,t);aO.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(Mj.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map(e=>this.signal.request(Mj.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0)))}catch(e){aO.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(Mj.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(Mj.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Mj.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Mj.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),RA("CLIENT_ROLE_OPTIONS")&&(aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(RA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},RA("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),RA("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},RA("CLIENT_ROLE_OPTIONS")),aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(RA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let n,i=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},t);delete s.delay,delete s.level,await this.signal.request(Mj.SET_CLIENT_ROLE,eV(eV({role:e,level:i,delay:n},s),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(Mj.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Mj.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(Mj.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(Mj.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Mj.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),eV({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Mj.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=tV.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:bA.username,password:bA.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(eV(eV({},bA),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(Mj.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(t=>t.peer_uid===e.peer_uid);t&&t.B_st!==e.B_st&&hI(()=>{this.emit(sM.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t,n;if(!this.joinInfo||!this.key)throw new fO(RR.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=RA("REPORT_APP_SCENARIO");if("string"!=typeof s)try{s=JSON.stringify(s)}catch(e){s=void 0}var r;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(sM.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,Pi(HL).call(HL,r)||HL.push(r);const a=EO(this.store),o=!(null===(t=this.isPreallocation)||void 0===t||!t.call(this)),c=bO(this.store),l=qU(),d=sR(87)||eR()||cR(117),u=(function(){const e=qC();if(e.name!==WC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>18||18===Number(t[0])&&Number(t[1])>=4}()||dR(18,4,!1))&&hR(18,6,!0)&&"h264"===this.spec.codec&&RA("ENABLE_ABSSENDTIME_AS_SENTTS"),h=eV({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:yA,browser:navigator.userAgent,process_id:RA("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:RA("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:eV(eV({enableEncodedTransform:(!!RA("ENABLE_AUDIO_METADATA")||!!RA("ENABLE_AUDIO_PTS"))&&d||!!RA("ENABLE_AUDIO_TOPN")&&aR(WC.CHROME,87,116)||void 0,enableAudioMetadata:!!RA("ENABLE_AUDIO_METADATA")&&d,enableAudioPts:!!RA("ENABLE_AUDIO_PTS")&&d,topnSmoothLevel:RA("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:RA("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:RA("TOPN_SWITCH_HOLD_MS"),topnAudioGain:RA("TOPN_AUDIO_GAIN"),enablePublishedUserList:RA("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:RA("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:zU("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:zU("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:zU("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===RA("USE_PUB_RTX")||!0===RA("USE_SUB_RTX")||void 0,disableFEC:RA("DISABLE_FEC"),enableNTPReport:!!RA("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:c,enableFulllinkAvSync:!!RA("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:zU("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!RA("FORCE_ENABLE_AUT_CC")||!vO()&&(!!RA("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!RA("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:zU("USE_XR","boolean"),enableLossbasedBwe:zU("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!RA("FORCE_ENABLE_AUT_CC")||!vO()&&(!!RA("ENABLE_AUT_CC")||void 0),enableCCFallback:zU("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:a?zU("PRE_SUB_NUM","number"):void 0,enablePubTWCC:zU("PUBLISH_TWCC","boolean"),enableSubTWCC:zU("SUBSCRIBE_TWCC","boolean"),enablePubRTX:zU("USE_PUB_RTX","boolean"),enableSubRTX:zU("USE_SUB_RTX","boolean"),enableSubSVC:RA("ENABLE_SVC")?RA("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0,enableSvcExtended:RA("ENABLE_SVC")&&Array.isArray(RA("SVC_EXTENDED"))&&0!==RA("SVC_EXTENDED").length?RA("SVC_EXTENDED"):void 0},l),{},{audioDuplicate:zU("ENABLE_AUDIO_RED","boolean")?null!==(n=zU("AUDIO_DUPLICATE_NUM","number"))&&void 0!==n?n:2:void 0,senttsUsesAbsSendTime:!!u||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,RA("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),void 0!==this.joinInfo.defaultVideoStream&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new fO(RR.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(jj.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(jj.WS_RECONNECTING,e=>{this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||nI.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",mO.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(jj.WS_CLOSED,e=>{let t;switch(e){case QR.LEAVE:t=nI.LEAVE;break;case QR.UID_BANNED:case QR.IP_BANNED:case QR.CHANNEL_BANNED:case QR.SERVER_ERROR:t=nI.SERVER_ERROR;break;case QR.FALLBACK:t=nI.FALLBACK;break;case QR.LICENSE_MISSING:case QR.LICENSE_EXPIRED:case QR.LICENSE_MINUTES_EXCEEDED:case QR.LICENSE_PERIOD_INVALID:case QR.LICENSE_MULTIPLE_SDK_SERVICE:case QR.LICENSE_ILLEGAL:case QR.TOKEN_EXPIRE:t=e;break;default:t=nI.NETWORK_ERROR}aO.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+nI.NETWORK_ERROR)),this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===QR.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==QR.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(jj.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){const e=RA("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(aO.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void aO.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));CA("EVENT_REPORT_DOMAIN",e[1]),CA("EVENT_REPORT_BACKUP_DOMAIN",e[1]),CA("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(Vj.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(jj.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new fO(RR.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,rI(this,sM.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(jj.REQUEST_JOIN_INFO,async(e,t,n)=>{var i,s,r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const a=pI(null===(i=this.joinInfo)||void 0===i?void 0:i.turnServer);if(RA("NEW_TURN_MODE")&&a&&"disabled"===(null===(s=this.joinInfo)||void 0===s?void 0:s.cloudProxyServer)){var o;let e=a.servers.map(e=>"turnServerURL"in e&&RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:iU(e.turnServerURL)}):e),t=null===(o=a.serversFromGateway)||void 0===o?void 0:o.map(e=>RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:iU(e.turnServerURL)}):e);const n=this.signal.currentURLIndex;e.length>0&&(e=[e[n%e.length]],a.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],a.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(n))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await rI(this,sM.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:a,cloudProxyServer:null===(r=this.joinInfo)||void 0===r?void 0:r.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(e){t(e)}}),this.signal.on(jj.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(jj.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let n,i="";var s;e instanceof fO?(n=(null===(s=e.data)||void 0===s?void 0:s.desc)||e.code,i=e.message):n=e,mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:i,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(jj.IS_P2P_DISCONNECTED,e=>{e(cI(this,sM.IS_P2P_DISCONNECTED))}),this.signal.on(jj.DISCONNECT_P2P,()=>{this.emit(sM.DISCONNECT_P2P)}),this.signal.on(jj.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(jj.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(jj.JOIN_RESPONSE,e=>{const t=this.getCurrentGatewayAddress();this.emit(sM.JOIN_RESPONSE,e,t)}),this.signal.on(jj.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,t;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=pI(null===(e=this.joinInfo)||void 0===e?void 0:e.turnServer);if(RA("NEW_TURN_MODE")&&s&&"disabled"===(null===(t=this.joinInfo)||void 0===t?void 0:t.cloudProxyServer)){var n;let e=s.servers.map(e=>"turnServerURL"in e&&RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:iU(e.turnServerURL)}):e),t=null===(n=s.serversFromGateway)||void 0===n?void 0:n.map(e=>RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:iU(e.turnServerURL)}):e);const i=this.signal.currentURLIndex;e.length>0&&(e=[e[i%e.length]],s.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],s.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(i,",in pre pc"))}const r=RA("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&r){const e=wU(i);this.emit(sM.PRE_CONNECT_PC,{candidates:e,fingerprint:r,turnServer:s})}}}),this.signal.on(jj.RECOVER_NOTIFICATION,e=>{this.joinInfo&&"string"==typeof RA("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(RA("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(Mj.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(Mj.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw aO.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(Mj.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(Mj.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw aO.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map(e=>({stream_id:e.stream_id,stream_type:e.stream_type}))};try{await this.signal.request(Mj.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find(e=>e.stream_type===iM.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find(e=>e.stream_type===iM.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===fM.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===fM.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Mj.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Mj.RESTART_ICE,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||nI.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!RA("GATEWAY_WSS_ADDRESS"))return RA("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(aO.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Mj.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let iV=0,sV=0;function rV(e,t,n,i){return new np((s,r)=>{t.timeout=t.timeout||RA("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),iV+=bI(t.data)):n&&(t.data.size?iV+=t.data.size:t.data instanceof FormData?iV+=SI(t.data):iV+=bI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,jC.request(t).then(e=>{"string"==typeof e.data?sV+=bI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?sV+=e.data.byteLength:sV+=bI(JSON.stringify(e.data)),i&&s({data:e.data,headers:e.headers}),s(e.data)}).catch(e=>{jC.isCancel(e)?r(new fO(RR.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?r(new fO(RR.NETWORK_TIMEOUT,e.message)):e.response?r(new fO(RR.NETWORK_RESPONSE_ERROR,e.response.status)):r(new fO(RR.NETWORK_ERROR,e.message))})})}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var i,s="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var i=e[n];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=r;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in n))break e;n=n[a]}(t=t(i=n[e=e[e.length-1]]))!=i&&null!=t&&s(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(a("Symbol",function(e){function t(e,t){this.A=e,s(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(s){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(s||"")+"_"+i++,s)}}),a("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<t.length;i++){var a=r[t[i]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&s(a.prototype,e,{configurable:!0,writable:!0,value:function(){return o(n(this))}})}return e}),"function"==typeof Object.setPrototypeOf)i=Object.setPrototypeOf;else{var l;e:{var d={};try{d.__proto__={a:!0},l=d.a;break e}catch(e){}l=!1}i=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var u=i;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function m(e,t){return e.h=3,{value:t}}function f(e){this.g=new h,this.G=e}function g(e,t,n,i){try{var s=t.call(e.g.j,n);if(!(s instanceof Object))throw new TypeError("Iterator result "+s+" is not an object");if(!s.done)return e.g.m=!1,s;var r=s.value}catch(t){return e.g.j=null,e.g.s(t),_(e)}return e.g.j=null,i.call(e.g,r),_(e)}function _(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function y(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),_(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function v(e,t){return t=new y(new f(t)),u&&e.prototype&&u(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return p(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),_(this))},f.prototype.s=function(e){return p(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),_(this))},a("Array.prototype.entries",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,s={next:function(){if(!i&&n<e.length){var s=n++;return{value:t(s,e[s]),done:!1}}return i=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,function(e,t){return[e,t]})}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var E=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},b=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},S=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},x=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},T="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,w=T.FormData,N=T.XMLHttpRequest&&T.XMLHttpRequest.prototype.send,C=T.Request&&T.fetch,R=T.navigator&&T.navigator.sendBeacon,I=T.Element&&T.Element.prototype,A=T.Symbol&&Symbol.toStringTag;A&&(Blob.prototype[A]||(Blob.prototype[A]="Blob"),"File"in T&&!File.prototype[A]&&(File.prototype[A]="File"));try{new File([],"")}catch(e){T.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),A&&Object.defineProperty(e,A,{value:"File"}),e}}var O=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},D=function(e){this.i=[];var t=this;e&&E(e.elements,function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];E(n,function(n){t.append(e.name,n)})}else"select-multiple"===e.type||"select-one"===e.type?E(e.options,function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)}):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?b(e.value):e.value,t.append(e.name,n))})};if((e=D.prototype).append=function(e,t,n){x(arguments,2),this.i.push(S(e,t,n))},e.delete=function(e){x(arguments,1);var t=[];e=String(e),E(this.i,function(n){n[0]!==e&&t.push(n)}),this.i=t},e.entries=function e(){var t,n=this;return v(e,function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=m(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2})},e.forEach=function(e,t){x(arguments,1);for(var n=c(this),i=n.next();!i.done;i=n.next()){var s=c(i.value);i=s.next().value,s=s.next().value,e.call(t,s,i,this)}},e.get=function(e){x(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){x(arguments,1);var t=[];return e=String(e),E(this.i,function(n){n[0]===e&&t.push(n[1])}),t},e.has=function(e){x(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,i,s=this;return v(e,function(e){if(1==e.h&&(t=c(s),n=t.next()),3!=e.h)return n.done?void(e.h=0):(i=n.value,m(e,c(i).next().value));n=t.next(),e.h=2})},e.set=function(e,t,n){x(arguments,2),e=String(e);var i=[],s=S(e,t,n),r=!0;E(this.i,function(t){t[0]===e?r&&(r=!i.push(s)):i.push(t)}),r&&i.push(s),this.i=i},e.values=function e(){var t,n,i,s,r=this;return v(e,function(e){if(1==e.h&&(t=c(r),n=t.next()),3!=e.h)return n.done?void(e.h=0):(i=n.value,(s=c(i)).next(),m(e,s.next().value));n=t.next(),e.h=2})},D.prototype._asNative=function(){for(var e=new w,t=c(this),n=t.next();!n.done;n=t.next()){var i=c(n.value);n=i.next().value,i=i.next().value,e.append(n,i)}return e},D.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(e,i){return"string"==typeof e?t.push(n+O(b(i))+'"\r\n\r\n'+b(e)+"\r\n"):t.push(n+O(b(i))+'"; filename="'+O(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")}),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},D.prototype[Symbol.iterator]=function(){return this.entries()},D.prototype.toString=function(){return"[object FormData]"},I&&!I.matches&&(I.matches=I.matchesSelector||I.mozMatchesSelector||I.msMatchesSelector||I.oMatchesSelector||I.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),A&&(D.prototype[A]="FormData"),N){var k=T.XMLHttpRequest.prototype.setRequestHeader;T.XMLHttpRequest.prototype.setRequestHeader=function(e,t){k.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},T.XMLHttpRequest.prototype.send=function(e){e instanceof D?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),N.call(this,e)):N.call(this,e)}}C&&(T.fetch=function(e,t){return t&&t.body&&t.body instanceof D&&(t.body=t.body._blob()),C.call(this,e,t)}),R&&(T.navigator.sendBeacon=function(e,t){return t instanceof D&&(t=t._asNative()),R.call(this,e,t)}),T.FormData=D}}();const aV=()=>{const e=RA("AREAS");return 0===e.length&&e.push(oM.GLOBAL),ss(e).call(e,(e,t,n)=>{const i=oV(t);return i?0===n?i:"".concat(e,",").concat(i):e},"")},oV=e=>e===oM.OVERSEA?"".concat(lM.ASIA,",").concat(lM.EUROPE,",").concat(lM.AFRICA,",").concat(lM.NORTH_AMERICA,",").concat(lM.SOUTH_AMERICA,",").concat(lM.OCEANIA):lM[e],cV=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(e=>{const n=dM[e],i=Object.keys(n);i&&i.map(e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))})}),t},lV={GLOBAL:{ASIA:[oM.CHINA,oM.JAPAN,oM.INDIA,oM.KOREA,oM.HKMC],EUROPE:[],NORTH_AMERICA:[oM.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dV=Object.keys(lV[oM.GLOBAL]),uV=[oM.CHINA,oM.NORTH_AMERICA,oM.EUROPE,oM.ASIA,oM.JAPAN,oM.INDIA,oM.OCEANIA,oM.SOUTH_AMERICA,oM.AFRICA,oM.KOREA,oM.HKMC,oM.US],hV=function(e,t){let n=[];if(Pi(e).call(e,oM.GLOBAL)){const r=[oM.GLOBAL,oM.OVERSEA],a=Object.keys(dM);if(t===oM.GLOBAL)throw new fO(RR.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===oM.CHINA)n=[oM.OVERSEA];else if(s=t,Pi(dV).call(dV,s)){const e=(i=t,lV[oM.GLOBAL][i]||[]),s=[...r,t,...e];n=a.filter(e=>!Pi(s).call(s,e))}else if(function(e){let t=!1;return dV.forEach(n=>{var i;Pi(i=lV[oM.GLOBAL][n]).call(i,e)&&(t=!0)}),t}(t)){const e=function(e){let t;return dV.forEach(n=>{var i;Pi(i=lV[oM.GLOBAL][n]).call(i,e)&&(t=n)}),t}(t),i=[...r,e,t];n=a.filter(e=>!Pi(i).call(i,e))}else n=e;n=function(e){const t=[];return uV.forEach(n=>{Pi(e).call(e,n)&&t.push(n)}),t.concat(e.filter(e=>!Pi(uV).call(uV,e)))}(n)}else n=e;var i,s;return n};function pV(e){var t,n;if(!e&&Pi(t=RA("AREAS")).call(t,oM.EXTENSIONS))return aO.debug("update area from ap : reset"),void mV(BL,!0);if(!Pi(n=RA("AREAS")).call(n,oM.GLOBAL)||!e)return;let i=dM.EXTENSIONS;i&&(i={CODE:oV(oM.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},aO.debug("update area from ap success: ".concat(e,",config is "),i),CA("AREAS",[oM.EXTENSIONS],!0),Object.keys(i).map(e=>{CA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])}))}function mV(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=mO.reportApiInvoke(null,{name:qR.SET_AREA,options:e,tag:YR.TRACER});try{let i=[];if("string"==typeof e&&(i=[e]),Array.isArray(e)&&(e.forEach(e=>{if(!Pi(cM).call(cM,e))throw new fO(RR.INVALID_PARAMS,"invalid area code")}),i=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new fO(RR.INVALID_PARAMS,"area code is needed");let s=t;"string"==typeof t&&(s=[t]),i=n?hV(s,n):s}if(!t){if(AA.AREAS){const e=new fO(RR.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void aO.warning("setArea is prohibited because of config-distribute")}if(Pi(i).call(i,oM.GLOBAL)&&RA("AREAS")===oM.EXTENSIONS){const e=new fO(RR.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void aO.warning("setArea is prohibited because of ap extensions")}}CA("AREAS",i,t);const s=cV(i);Object.keys(s).map(e=>{CA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?s[e][0]:s[e])}),aO.debug("set area success:",i.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function fV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function gV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fV(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let _V=1;function yV(e,t,n,i,s){_V+=1;const r={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:_V,requestId:_V,version:yA,cname:n.cname},a={service_name:t,json_body:JSON.stringify(r)};let o,c,l=e[0];return GI(async()=>{o=Date.now();const e=await rV(l,{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-o,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw aO.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw aO.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw aO.error(e.toString()),e}const s=function(e,t){return{addressList:e.servers.map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(RA("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))),workerToken:e.workerToken,vid:e.vid}}(n,t);return RA("LIVE_STREAMING_ADDRESS")&&(s.addressList=RA("LIVE_STREAMING_ADDRESS")instanceof Array?RA("LIVE_STREAMING_ADDRESS"):[RA("LIVE_STREAMING_ADDRESS")]),gV(gV({},s),{},{responseTime:c})},(i,s)=>(mO.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(i.addressList),firstSuccess:0===s,responseTime:c,serverIp:e[s%e.length]}),!1),(i,s)=>(mO.apworkerEvent(n.sid,{success:!1,sc:i.data&&i.data.code||200,serviceName:t,responseTime:c,serverIp:e[s%e.length]}),!!(i.code!==RR.OPERATION_ABORTED&&i.code!==RR.UNEXPECTED_RESPONSE||i.data&&i.data.retry)&&(l=e[(s+1)%e.length],!0)),s)}let vV=1;function EV(e,t,n,i){let{url:s,areaCode:r}=e;const{clientId:a,sid:o}=t,c=Date.now();let l;const d=t.role,[u,h]=wV(t,r,[$M.CHOOSE_SERVER]);let p=lI.networkState;return GI(async()=>{p&&lI.networkState===iI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,TI(i&&i.maxRetryTimeout||FI.maxRetryTimeout)]),p=lI.networkState;const{data:e,headers:r}=await rV(s,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===r.http3?1:-1,mO.reportResourceTiming(s,o),SV(e,s,t,c,[$M.CHOOSE_SERVER],l);const a=cU(e,$M.CHOOSE_SERVER);return xV(a),sU(a,s)},e=>(e&&mO.joinChooseServer(o,{role:d,lts:c,succ:!0,csAddr:s,opid:h,serverList:e.gatewayAddrs.map(e=>e.address),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1),e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinChooseServer(o,{role:d,lts:c,succ:!1,csAddr:s,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),aO.warning("[".concat(a||"sid-".concat(o.slice(0,6)),"] Choose server network error, retry"),e),!0)),i)}function bV(e,t,n,i){let s,{url:r,areaCode:a,serviceIds:o}=e;const c=Date.now(),l=t.role,[d,u]=wV(t,a,o);let h;return GI(async()=>{h&&lI.networkState===iI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,TI(i&&i.maxRetryTimeout||FI.maxRetryTimeout)]),h=lI.networkState;const{data:e,headers:a}=await rV(r,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s="1"===a.http3?1:-1,mO.reportResourceTiming(r,t.sid),SV(e,r,t,c,o,s);const l=cU(e,$M.CHOOSE_SERVER),u=cU(e,"proxy5"===t.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK),p=performance.getEntriesByName(r),m=p[p.length-1];let f;return m&&(f={name:m.name,protocol:"nextHopProtocol"in m?m.nextHopProtocol:"",dnscost:"domainLookupEnd"in m&&"domainLookupStart"in m&&"number"==typeof m.domainLookupEnd&&"number"==typeof m.domainLookupStart?m.domainLookupEnd-m.domainLookupStart:-1,tcpTlsCost:"connectEnd"in m&&"connectStart"in m&&"number"==typeof m.connectEnd&&"number"==typeof m.connectStart?m.connectEnd-m.connectStart:-1,reqCost:"requestStart"in m&&"number"==typeof m.requestStart&&"responseEnd"in m&&"number"==typeof m.responseEnd?m.responseEnd-m.requestStart:-1,handleCost:"leave_ts"in e&&"enter_ts"in e&&"number"==typeof e.leave_ts&&"number"==typeof e.enter_ts?e.leave_ts-e.enter_ts:-1}),xV(l),{gatewayInfo:sU(l,r),proxyInfo:u,url:r,resourceTimingInfo:f}},e=>(e.gatewayInfo&&mO.joinChooseServer(t.sid,{role:l,lts:c,succ:!0,csAddr:r,serverList:e.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,opid:u,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:o.toString(),isHttp3:s,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38],resourceTimingInfo:e.resourceTimingInfo?JSON.stringify(e.resourceTimingInfo):void 0}),e.proxyInfo&&mO.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:r,turnServerAddrList:e.proxyInfo.addresses.map(e=>e.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:o.toString()}),!1),e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:o.toString(),extend:JSON.stringify({networkState:h})}),aO.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0)),i)}const SV=(e,t,n,i,s,r)=>{const{sid:a,clientId:o,cloudProxyServer:c}=n,l=[],d=o=>{4096===o.flag?mO.joinChooseServer(a,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:o.error.message,csIp:o.error.data&&o.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:r,corssRegionTagReq:n.apRequestDetail}):1048576!==o.flag&&4194304!==o.flag&&4194310!==o.flag||mO.joinWebProxyAP(a,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:o.error.code,eventType:c,unilbsServerIds:s.toString()})};if(e.response_body.forEach(t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};l.push(n),d(n)}if(0!==n){const i=LM(n),s={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?aO.warning(s.error.toString()):l.push(s),d(s)}}),l.length)throw aO.warning("[".concat(o||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)).join(" | "))),new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!l.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(l.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})},xV=e=>{var t,n,i,s;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(RA("AP_AREA")&&(null!==(i=e.detail)&&void 0!==i&&i[23]&&"string"==typeof(null===(s=e.detail)||void 0===s?void 0:s[23])?pV(e.detail[23].toLowerCase()):pV()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let i=0;i<n.length;i++){var r;const t=Dv(r=n[i]).call(r);e.addresses[i]&&n&&(e.addresses[i].fingerprint=t)}}if(RA("GATEWAY_ADDRESS")&&RA("GATEWAY_ADDRESS").length>0){aO.debug("assign gateway address to",RA("GATEWAY_ADDRESS"));const t=RA("GATEWAY_ADDRESS").map(t=>{var n,i;const s=null!==(n=null===(i=e.addresses.find(e=>e.ip===t.ip&&e.port===t.port))||void 0===i?void 0:i.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:s}});e.addresses=t}},TV=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=LM(t.buffer.code);throw new fO(RR.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw aO.debug("update ticket request received ap response without response body:",t),new fO(RR.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},wV=(e,t,n)=>{const i=Math.floor(Math.random()*10**12),s="host"===e.role?"1":"audience"===e.role?"2":void 0,r={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:gV(gV(gV({6:e.stringUid,11:t,12:RA("USE_NEW_TOKEN")?"1":void 0},s?{17:s}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};r.request_bodies.forEach(t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(r)),[a,i]},NV=(e,t)=>{const n=Math.floor(Math.random()*10**12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(e=>({ip:e.ip,port:e.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,n]};let CV=0;function RV(e){return np.all(e.map(e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}const IV=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:s,promisesCollector:r}=e,a=0;const o=t;let c,l=0;const d=async()=>{const e=(()=>{const e=a*o,t=e+o;return n.slice(e,t).map(i)})();r&&r.push(...e);try{c=await RV(e)}catch(e){if(l+=o,a++,!(l>=n.length))return void await d();s(e)}e.forEach(e=>e.cancel())};return await d(),c},AV=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const s=t.length;let r=0;const a=async()=>{const e=n(t.shift());try{return await e}catch(e){if(r++,r>=s||null!=i&&i(e))throw e;return a()}};return a()};async function OV(){if("undefined"==typeof VideoDecoder)return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],s=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],r=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],a=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128],o=await new np((o,c)=>{let l;!async function(){e&&"closed"!==e.state||await async function(){e=new VideoDecoder({output:e=>{e.close(),clearTimeout(l),o(!0)},error:e=>{clearTimeout(l),o(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const c=[t,n,i,s,r,a];for(let t=0;t<c.length;t++){const n=new EncodedVideoChunk({type:0==t?"key":"delta",timestamp:33333*t,duration:33333,data:new Uint8Array(c[t])});try{await e.decode(n)}catch(e){return void o(!1)}}}(),l=setTimeout(()=>{o(!1)},5e3)});return o}async function DV(e,t,n,i){const s=async function(e,t,n,i){let s=null;const r=[],a=async()=>{const s=RA("WEBCS_DOMAIN").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),a=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map(e=>e.url)}),o=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:i=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),i.url),EV(i,e,t,n)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:r});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},a),o},o=async()=>{if(await TI(1e3),null!==s)return s;const a=RA("WEBCS_DOMAIN_BACKUP_LIST").map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),o=i.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map(e=>e.url)}),c=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:i=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),i.url),EV(i,e,t,n)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:r});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},o),c};try{return s=await RV([a(),o()]),r.length&&r.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),s}catch(e){throw e[0]}}(e,t,n,i);return{gatewayInfo:await s}}async function kV(e,t,n,i,s){const r=e.cloudProxyServer;if("disabled"===r){if(!i)return;if(e.useLocalAccessPoint)return await DV(e,t,n,s);if(RA("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:i,proxyInfo:r}=await UV(e,t,n,s);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:i};const o=r.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bA.tcpport,udpport:e.udpport||bA.udpport,username:e.username||bA.username,password:e.password||bA.password,forceturn:!1,security:!0}));if(s.useP2P){var a;const t=null!==(a=e.uid)&&void 0!==a?a:i.uid,n="glb:".concat(t.toString()),s=await WR(n),c=r.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bA.tcpport,udpport:e.udpport||bA.udpport,username:n,password:s,forceturn:!1,security:!0}));o.push(...c)}return e.turnServer={mode:"manual",servers:o},{gatewayInfo:i}}return await DV(e,t,n,s)}const{proxyInfo:o,gatewayInfo:c}=await UV(e,t,n,s),l={gatewayInfo:c},d=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===r?void 0:e.tcpport?e.tcpport:bA.tcpport,udpport:"proxy4"===r?void 0:e.udpport?e.udpport:bA.udpport,username:e.username||bA.username,password:e.password||bA.password,forceturn:"proxy4"!==r,security:"proxy5"===r}));if(s.useP2P){var u;const t=null!==(u=e.uid)&&void 0!==u?u:c.uid,n="glb:".concat(t.toString()),i=await WR(n),s=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===r?void 0:e.tcpport||bA.tcpport,udpport:"proxy4"===r?void 0:e.udpport||bA.udpport,username:n,password:i,forceturn:"proxy4"!==r,security:"proxy5"===r}));d.push(...s)}return e.turnServer={mode:"manual",servers:d},aO.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(r)),l}async function PV(e,t,n,i,s){const r=RA("ACCOUNT_REGISTER").slice(0,RA("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?r.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):r.map(e=>"https://".concat(e,"/api/v1"));const o=null==s?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const r=await async function(e,t,n,i,s){const r=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let o=e[0];const c=await GI(()=>rV(o+"".concat(-1===o.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(n,i)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw aO.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),mO.reqUserAccount(a.sid,{lts:r,success:!1,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:RR.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new fO(RR.INVALID_UINT_UID_FROM_STRING_UID);return mO.reqUserAccount(a.sid,{lts:r,success:!0,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:null,extend:a}),!1}const s=LM(n.code);return s.retry&&(o=e[(i+1)%e.length]),mO.reqUserAccount(a.sid,{lts:r,success:!1,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:s.desc,extend:a}),s.retry},(t,n)=>t.code!==RR.OPERATION_ABORTED&&(mO.reqUserAccount(a.sid,{lts:r,success:!1,serverAddr:o,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),o=e[(n+1)%e.length],!0),s);if(0!==c.code){const e=LM(c.code);throw new fO(RR.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,n,i);return null==s||s.recordJoinChannelService({status:"success",endTs:Date.now()},o),r.uid}catch(e){throw null==s||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},o),e}}async function LV(e,t,n){const i=RA("ACCOUNT_REGISTER");let s=[];s=t.proxyServer?i.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):i.map(e=>"https://".concat(e,"/api/v1"));try{const i=await AV({referenceList:s,asyncMapHandler:i=>async function(e,t,n,i){const s=Date.now(),r={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await rV(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:r,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=LM(t.code);throw new fO(RR.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new fO(RR.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:s,url:e,req:r,uid:t.uid,elapse:Date.now()-s}}catch(e){throw e}}(i,e,t,n),closeFn:e=>e.code===RR.OPERATION_ABORTED||e.code===RR.UNEXPECTED_RESPONSE&&!e.data.retry});return i}catch(e){throw e}}async function jV(e,t,n){const i=RA("CDS_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")),s=i.map(i=>function(e,t,n,i){const s=qC(),r={flag:64,cipher_method:0,features:gV(gV(gV(gV(gV({install_id:_A(),device:s.name,system:s.os,system_general:navigator.userAgent,vendor:t.appId,version:yA,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:ZM.WEB_RTC,browser_name:s.name,browser_version:s.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),s.os&&{os_name:s.os}),s.osVersion&&{os_version:s.osVersion}),{},{detail:""})};return GI(()=>rV(e,{data:r,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==RR.OPERATION_ABORTED,i)}(i,e,t,n));let r=null,a=null,o={};try{r=await RV(s)}catch(e){if(e.code===RR.OPERATION_ABORTED)throw e;a=e}if(s.forEach(e=>e.cancel()),mO.reportApiInvoke(e.sid,{name:qR.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:r}}).onSuccess(),r&&r.test_tags)try{o=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),i={};return n.forEach(e=>{var n;const s=Dv(n=e.slice(4)).call(n),r=JSON.parse(t[e]),a=r[1];i[s]={tag:r[0]||"",value:a}}),i}(r)}catch(e){}return o}async function MV(e,t){const n=RA("WEBCS_DOMAIN").concat(RA("WEBCS_DOMAIN_BACKUP_LIST")).map(e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK]}));try{const i=await AV({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let i,{url:s,areaCode:r,serviceIds:a}=e;const o=Date.now(),[c,l]=wV(t,r,a);let d=lI.networkState;try{d&&lI.networkState===iI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,TI(FI.maxRetryTimeout)]),d=lI.networkState;const{data:e,headers:t}=await rV(s,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===t.http3?1:-1;const r=e=>{const t=[];if(e.response_body.forEach(n=>{const i=n.buffer.code;if(23===n.uri&&0===i&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const i={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(i)}if(0!==i){const s=LM(i),r={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,s.desc,{desc:s.desc,retry:s.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?aO.warning(r.error.toString()):t.push(r)}}),t.length)throw new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,t.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!t.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(t.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})};r(e);const a=cU(e,$M.CHOOSE_SERVER),u=cU(e,$M.CLOUD_PROXY_FALLBACK);return xV(a),{gatewayInfo:sU(a,s),proxyInfo:u,opid:l,requestTime:o,url:s,isHttp3:i,elapse:Date.now()-o}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===RR.OPERATION_ABORTED||e.code===RR.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return i}catch(e){throw e}}async function UV(e,t,n,i){const s=RA("PROXY_SERVER_TYPE3"),r=(e,t,n)=>{let i=n||s;return Array.isArray(i)&&(i=t%2==0&&s[1]||s[0]),"https://".concat(i,"/ap/?url=").concat(e)};let a=null;const o=[],c=async()=>{const s=RA("WEBCS_DOMAIN").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map((t,n)=>{let i;return i="disabled"===e.cloudProxyServer&&e.proxyServer?r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:i,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),a=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map(e=>e.url)}),c=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:i=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),i.url),bV(i,e,t,n)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c},l=async()=>{if(await TI(1e3),null!==a)return a;const s=RA("WEBCS_DOMAIN_BACKUP_LIST").map((t,n)=>{let i;return i="disabled"===e.cloudProxyServer&&e.proxyServer?r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:i,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),c=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map(e=>e.url)}),l=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:i=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),i.url),bV(i,e,t,n)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let d,u,h;try{({gatewayInfo:d,proxyInfo:u,url:h}=await RV([c(),l()]))}catch(e){throw e[0]}if(o.length&&o.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),!d||!u)throw new fO(RR.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(s)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Pi(s).call(s,t)&&(e.proxyServer=t,aO.setProxyServer(t),mO.setProxyServer(t))}return a={gatewayInfo:d,proxyInfo:await lU(u,d.uid)},a}async function VV(e,t,n){const i=RA("UAP_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")),s=i.map(i=>function(e,t,n,i){const s={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:yA,cname:t.cname,uid:t.uid.toString(),requestId:vV,seq:vV};vV+=1;const r={service_name:"tele_channel",json_body:JSON.stringify(s)};return GI(async()=>{const t=await rV(e,{data:r,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw aO.error(e.toString()),e}const i=JSON.parse(t.json_body);if(200!==i.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(i.code,", reason: ").concat(i.reason));throw aO.error(e.toString()),e}if(!i.servers||0===i.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw aO.error(e.toString()),e}return{vid:i.vid,workerToken:i.workerToken,addressList:(RA("CHANNEL_MEDIA_RELAY_SERVERS")||i.servers).map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(RA("WORKER_DOMAIN"),":").concat(e.wss))}},void 0,e=>!!(e.code!==RR.OPERATION_ABORTED&&e.code!==RR.UNEXPECTED_RESPONSE||e.data&&e.data.retry),i)}(i,e,t,n));try{const e=await RV(s);return s.forEach(e=>e.cancel()),e}catch(e){throw e[0]}}async function FV(e,t,n){let i=null;const s=[],r=async r=>{const a=RA(r?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"));return r&&(await TI(1e3),null!==i)?i:await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:i=>(aO.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(r?"backup":""," choose_server:"),i),function(e,t,n,i){const[s]=NV(t,[$M.CHOOSE_SERVER]);let r=lI.networkState;return GI(async()=>{r&&lI.networkState===iI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,TI(i&&i.maxRetryTimeout||FI.maxRetryTimeout)]),r=lI.networkState;const t=await rV(e,{data:s,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return TV(t,e)},()=>!1,e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.UPDATE_TICKET_FAILED?e.data.retry:(aO.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0)),i)}(i,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:s})};try{return i=await RV([r(!1),r(!0)]),s.length&&s.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),i}catch(e){throw e[0]}}function BV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function GV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BV(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class WV extends HR{get isSuccess(){return!!this.configs}constructor(e,t){super(),uw(this,"configs",void 0),uw(this,"store",void 0),uw(this,"joinInfo",void 0),uw(this,"cancelToken",void 0),uw(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),uw(this,"interval",void 0),uw(this,"mutex",void 0),uw(this,"mutableParamsRead",!1),uw(this,"configCache",{}),uw(this,"limit_bitrate",void 0),this.mutex=new UI("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),RA("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},RA("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,mO.reportApiInvoke(null,{options:void 0,name:qR.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:YR.TRACER}).onSuccess(JSON.stringify(AA))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void aO.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await jV(this.joinInfo,this.cancelToken,this.retryConfig),aO.debug("[config-distribute] get config distribute",JSON.stringify(e));const t=function(e){var t;const n=Xp(t=Object.keys(e).filter(e=>/^webrtc_ng_global_parameter/.test(e))).call(t);for(let r=0;r<n.length;r++)for(let t=n.length-1;t>r;t--){const i=n[t],s=e[i].value;if("number"==typeof s.__priority){const r=s.__priority,a=n[t-1],o=e[a].value;if("number"==typeof o.__priority){if(!(r>o.__priority))continue;{const e=i;n[t]=n[t-1],n[t-1]=e}}else{const e=i;n[t]=n[t-1],n[t-1]=e}}}const i=Date.now();let s={};return n.forEach(t=>{const n=e[t].value.__expires;n&&n<=i||(s[t]=e[t])}),s}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(e){const t=new fO(RR.NETWORK_RESPONSE_ERROR,e);aO.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){hM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(uM.UPDATE_BITRATE_LIMIT,e):this.emit(uM.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&GV({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const t={},n=Object.keys(e),i=[];n.forEach(n=>{const s=e[n].value;t[n]=s;const r=s.__id;if(r&&this.configCache[n]&&this.configCache[n].__id===r)return;const a=s.__type,o=e[n].value,c=e[n].tag;let l=0;a?a===IA.REALTIME&&(l=1):Object.keys(o).some(e=>Object.prototype.hasOwnProperty.call(wA,e)||!zL()&&Object.prototype.hasOwnProperty.call(SA,e)?(l=1,!0):void 0),i.push({tag:c,isApplied:l,feature:n,params:JSON.stringify(s)})}),i.forEach(e=>{let{tag:t,feature:n,params:i,isApplied:s}=e;this.store.sessionId&&mO.abTest(this.store.sessionId,{intSucc:1,isApplied:s,tag:t,feature:n,params:i,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(e){aO.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){const t=function(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n].value,s=i.__expires,r=i.__type;Object.keys(i).forEach(e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=GV(GV({value:i[e]},s&&{expires:s}),r&&{type:r}))})}),t}(e);try{var n;const i=null===(n=t.LIMIT_BITRATE)||void 0===n?void 0:n.value;delete t.LIMIT_BITRATE,i&&hM(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{const t=Date.now();Object.keys(e).forEach(n=>{const{value:i,type:s,expires:r}=e[n];r&&r<=t||((s===IA.REALTIME||Object.prototype.hasOwnProperty.call(wA,n))&&(AA[n]=i,NA[n]=i,aO.debug("Update realtime parameters from config distribute",n,i)),s||zL()||!Object.prototype.hasOwnProperty.call(SA,n)||(AA[n]=i,NA[n]=i,aO.debug("Update gateway parameters from config distribute",n,i)))})}catch(t){aO.error("Error update config immediately: ".concat(e),t.message)}}(t);const s=JSON.stringify(t),r=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",r),aO.debug("Caching global parameters ".concat(s))}catch(e){aO.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{const t=Date.now();Object.keys(e).forEach(n=>{if("CLIENT_ROLE_OPTIONS"===n&&Object.prototype.hasOwnProperty.call(NA,n)){const{value:i,expires:s}=e[n];if(s&&s<=t)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(NA[n],i)||(AA[n]=i,NA[n]=i,this.emit(uM.UPDATE_CLIENT_ROLE_OPTIONS,i),aO.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(e){aO.error("Error handling global parameter config:",e.message)}}}class HV extends HR{constructor(){super(...arguments),uw(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n)),!t.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(RA("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(e);if(!i)return;i.result.push(n);const s="VIDEO_ENCODE_FAILED"===e?RA("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var r;const n=Pi(r=i.result).call(r,!0);i.isPrevNormal&&!n&&this.emit("exception",KV[e],e,t),!i.isPrevNormal&&n&&this.emit("exception",KV[e]+2e3,e+"_RECOVER",t),i.isPrevNormal=n,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof Wk&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=rU(t._encoderConfig.frameRate));const i=e.captureFrameRate;return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var t;return!(!e.codecType||Pi(t=RA("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(t,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||0!==e.sendFrameRate||0!==e.sendResolutionWidth||0!==e.sendResolutionHeight}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof Wk&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const KV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},zV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function qV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function YV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qV(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class XV{constructor(e){uw(this,"store",void 0),uw(this,"onStatsException",void 0),uw(this,"onUploadPublishDuration",void 0),uw(this,"onStatsChanged",void 0),uw(this,"onVideoCodecChanged",void 0),uw(this,"localStats",new Map),uw(this,"remoteStats",new Map),uw(this,"updateStatsInterval",void 0),uw(this,"trafficStats",void 0),uw(this,"trafficStatsPeerList",[]),uw(this,"uplinkStats",void 0),uw(this,"exceptionMonitor",void 0),uw(this,"p2pChannel",void 0),uw(this,"scalabilityMode",cA.L1T1),uw(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new HV,this.exceptionMonitor.on("exception",(e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(vM.LocalAudioTrack)||YV({},qO)}getLocalVideoTrackStats(){return this.localStats.get(vM.LocalVideoTrack)||YV({},YO)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var i;const s=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.audioStats;s&&(n[e]=t(e,s))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{audioStats:s}]=e;s&&(n[i]=t(i,s))});return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const i=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;i&&(t[e]=i)}else Array.from(this.remoteStats.entries()).forEach(e=>{let[n,{networkStats:i}]=e;i&&(t[n]=i)});return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var i;const s=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.videoStats;s&&(n[e]=t(e,s))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{videoStats:s}]=e;s&&(n[i]=t(i,s))});return n}getRTCStats(){let e=0,t=0,n=0,i=0;const s=this.localStats.get(vM.LocalAudioTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate);const r=this.localStats.get(vM.LocalVideoTrack);r&&(e+=r.sendBytes,t+=r.sendBitrate);const a=this.localStats.get(vM.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach(e=>{let{audioStats:t,videoStats:s}=e;t&&(n+=t.receiveBytes,i+=t.receiveBitrate),s&&(n+=s.receiveBytes,i+=s.receiveBitrate)});let o=1;return this.trafficStats&&(o+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:o,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(e=>void 0!==e.B_ppad||void 0!==e.B_ppvd),e.peer_delay.filter(e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid)).forEach(e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),i=null!=n&&n.videoSSRC?zV.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,s=null!=n&&n.audioSSRC?zV.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,i>s?i:s),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&aO.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const i=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,s=!n||t.framesDecodeCount>n.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[n,i]=t;switch(n){case vM.LocalVideoTrack:case vM.LocalVideoLowTrack:{const t=i,a=YV({},YO),o=e.getStats(),c=e.getLocalMedia(n);if(o){const n=o.videoSend.find(e=>e.ssrc===(null==c?void 0:c.ssrcs[0].ssrcId));if(n){const i=e.getLocalVideoSize(),r=e.getEncoderConfig(vM.LocalVideoTrack);var s;"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(a.codecType=n.codec,(null==t?void 0:t.codecType)!==n.codec&&(null===(s=this.onVideoCodecChanged)||void 0===s||s.call(this,n.codec.toLocaleLowerCase()))),a.sendBytes=n.bytes,a.sendBitrate=t?8*Math.max(0,a.sendBytes-t.sendBytes):0,n.inputFrame?(a.captureFrameRate=n.inputFrame.frameRate,a.captureResolutionHeight=n.inputFrame.height,a.captureResolutionWidth=n.inputFrame.width):i&&(a.captureResolutionWidth=i.width,a.captureResolutionHeight=i.height),n.sentFrame?(a.sendFrameRate=n.sentFrame.frameRate,a.sendResolutionHeight=n.sentFrame.height,a.sendResolutionWidth=n.sentFrame.width):i&&(a.sendResolutionWidth=i.width,a.sendResolutionHeight=i.height),n.avgEncodeMs&&(a.encodeDelay=n.avgEncodeMs),r&&r.bitrateMax?a.targetSendBitrate=1e3*r.bitrateMax:n.targetBitrate&&(a.targetSendBitrate=n.targetBitrate),a.sendPackets=n.packets,a.sendPacketsLost=n.packetsLost,a.sendJitterMs=n.jitterMs,a.sendRttMs=n.rttMs,a.totalDuration=t?t.totalDuration+1:1,a.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(a.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(aO.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var r;this.localStats.set(n,a),((null==t?void 0:t.sendResolutionWidth)!==a.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==a.sendResolutionHeight)&&(null===(r=this.onStatsChanged)||void 0===r||r.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&c&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,c.track,a);break}case vM.LocalAudioTrack:{const t=i,s=YV({},qO),r=e.getStats(),a=e.getLocalMedia(n);if(r){const n=r.audioSend.find(e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(s.codecType=n.codec),n.inputLevel)s.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(s.sendVolumeLevel=Math.round(32767*t))}s.sendBytes=n.bytes,s.sendPackets=n.packets,s.sendPacketsLost=n.packetsLost,s.sendJitterMs=n.jitterMs,s.sendRttMs=n.rttMs,s.sendBitrate=t?8*Math.max(0,s.sendBytes-t.sendBytes):0}}this.trafficStats&&(s.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(vM.LocalAudioTrack,s),s&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,s);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var n,i;let[s,{videoStats:r,audioStats:a,videoPcStats:o}]=t;const c=a,l=r,d=o,u=YV({},XO),h=YV({},QO),p=YV({},JO),{audioTrack:m,videoTrack:f,audioSSRC:g,videoSSRC:_}=e.getRemoteMedia(s);let y;y=this.store.useP2P?e.getStats(!0):e.getStats();const v=null===(n=y)||void 0===n?void 0:n.audioRecv.find(e=>e.ssrc===g),E=null===(i=y)||void 0===i?void 0:i.videoRecv.find(e=>e.ssrc===_),b=this.trafficStats&&this.trafficStats.peer_delay.find(e=>e.peer_uid===s);if(v&&("opus"!==v.codec&&"aac"!==v.codec&&"PCMU"!==v.codec&&"PCMA"!==v.codec&&"G722"!==v.codec||(u.codecType=v.codec),v.outputLevel?u.receiveLevel=Math.round(32767*v.outputLevel):m&&(u.receiveLevel=Math.round(32767*m.getVolumeLevel())),u.receiveBytes=v.bytes,u.receivePackets=v.packets,u.receivePacketsLost=v.packetsLost,u.receivePacketsDiscarded=v.packetsDiscarded,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.receiveBitrate=c?8*Math.max(0,u.receiveBytes-c.receiveBytes):0,u.totalDuration=c?c.totalDuration+1:1,u.totalFreezeTime=c?c.totalFreezeTime:0,u.freezeRate=u.totalFreezeTime/u.totalDuration,u.receiveDelay=v.jitterBufferMs,u.totalDuration>10&&XV.isRemoteAudioFreeze(m)&&(u.totalFreezeTime+=1)),E){var S;"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(h.codecType=E.codec),h.receiveBytes=E.bytes,h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.decodeFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,h.renderFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,E.outputFrame&&(h.renderFrameRate=E.outputFrame.frameRate),E.receivedFrame?(h.receiveFrameRate=E.receivedFrame.frameRate,h.receiveResolutionHeight=E.receivedFrame.height,h.receiveResolutionWidth=E.receivedFrame.width):f&&(h.receiveResolutionHeight=f._videoHeight||0,h.receiveResolutionWidth=f._videoWidth||0),void 0!==E.framesRateFirefox&&(h.receiveFrameRate=Math.round(E.framesRateFirefox)),h.receivePackets=E.packets,h.receivePacketsLost=E.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost);const t=l?l.totalFreezeTime:0,n=l?l.totalDuration:0;h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=null!==(S=E.totalFreezesDuration)&&void 0!==S?S:t||0,h.receiveDelay=E.jitterBufferMs||0;const i=!!_&&e.getRemoteVideoIsReady(_);void 0===E.totalFreezesDuration&&f&&i&&XV.isRemoteVideoFreeze(f,E,d)&&(h.totalFreezeTime+=1),h.freezeRate=Math.max(0,Math.min((h.totalFreezeTime-t)/(h.totalDuration-n),1))}b&&(u.end2EndDelay=b.B_ad,h.end2EndDelay=b.B_vd,u.transportDelay=b.B_ed,h.transportDelay=b.B_ed,u.currentPacketLossRate=b.B_ealr4/100,h.currentPacketLossRate=b.B_evlr4/100,p.uplinkNetworkQuality=b.B_punq?b.B_punq:0,p.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(s,{audioStats:u,videoStats:h,videoPcStats:E,networkStats:p}),m&&this.exceptionMonitor.setRemoteAudioStats(m,u),f&&this.exceptionMonitor.setRemoteVideoStats(f,h)})}}class JV{constructor(){uw(this,"destChannelMediaInfos",new Map),uw(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Zj(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Zj(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Gj(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QV(e){if(!(e instanceof JV))return new fO(RR.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new fO(RR.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new fO(RR.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class ZV{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){uw(this,"uid",void 0),uw(this,"_uintid",void 0),uw(this,"_trust_in_room_",!0),uw(this,"_trust_audio_enabled_state_",!0),uw(this,"_trust_video_enabled_state_",!0),uw(this,"_trust_audio_mute_state_",!0),uw(this,"_trust_video_mute_state_",!0),uw(this,"_audio_muted_",!1),uw(this,"_video_muted_",!1),uw(this,"_audio_enabled_",!0),uw(this,"_video_enabled_",!0),uw(this,"_audio_added_",!1),uw(this,"_video_added_",!1),uw(this,"_is_pre_created",!1),uw(this,"_video_pre_subscribed",!1),uw(this,"_audio_pre_subscribed",!1),uw(this,"_trust_video_stream_added_state_",!0),uw(this,"_trust_audio_stream_added_state_",!0),uw(this,"_audioTrack",void 0),uw(this,"_videoTrack",void 0),uw(this,"_dataChannels",[]),uw(this,"_audioSSRC",void 0),uw(this,"_videoSSRC",void 0),uw(this,"_audioOrtc",void 0),uw(this,"_videoOrtc",void 0),uw(this,"_cname",void 0),uw(this,"_rtxSsrcId",void 0),uw(this,"_videoMid",void 0),uw(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function $V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function eF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$V(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$V(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const tF="9",nF=2e4,iF=4e4;function sF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function rF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sF(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var aF=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(aF||{});const oF=new Map;function cF(e,t,n,i){let{scale:s}=e;if(0===s&&i===aF.UP||s>=t.length-1&&i===aF.DOWN)return e;let r=rF(rF({},e),{},{scale:i===aF.DOWN?++s:--s});switch(n){case"maintain-framerate":r=rF(rF({},r),t[s].motion);break;case"maintain-resolution":r=rF(rF({},r),t[s].detail);break;case"balanced":r=rF(rF({},r),t[s].balanced)}return r}function lF(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:dF(t)};oF.set(e,n)}else oF.delete(e)}function dF(e){const t=rF({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:s,bitrateMin:r}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:o,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:m,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:_,MOTION_RESOLUTION_FACTOR:y,MOTION_BITRATE_FACTOR:v,DETAIL_FRAMERATE_FACTOR:E,DETAIL_BITRATE_FACTOR:b}=xA,S=Math.min(t.frameRate,o),x=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*S),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:r},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:r},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:r}}];for(let T=1;T<=c;T++){const e={bwe_up:Math.round(Math.pow(u,T)*n),bwe_down:Math.round(Math.pow(h,T+1)*n),fps_up:Math.round(Math.pow(m,T)*S),fps_down:Math.round(Math.pow(p,T+1)*S)},t={scaleResolutionDownBy:s/Math.pow(_,T),frameRate:Math.max(Math.round(Math.pow(g,T)*i),a),bitrateMax:Math.max(Math.round(Math.pow(f,T)*n),d),bitrateMin:Math.max(Math.round(Math.pow(f,T)*r),l)},o={scaleResolutionDownBy:s/Math.pow(y,T),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(v,T)*n),d),bitrateMin:Math.max(Math.round(Math.pow(v,T)*r),l)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(E,T)*i),a),bitrateMax:Math.max(Math.round(Math.pow(b,T)*n),d),bitrateMin:Math.max(Math.round(Math.pow(b,T)*r),l)};x.push({scale:T,threshold:e,balanced:t,motion:o,detail:c})}return x}function uF(e,t,n,i,s,r){const a=oF.get(e)||{overUse:0,underUse:0,adaptationList:dF(s)},{adaptationList:o}=a;oF.set(e,a);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=xA,{scale:d}=i;let u,h;return"number"==typeof t&&t>0&&function(e,t,n,i){if(t>=n.length)return!1;let{threshold:{fps_down:s}}=n[t];return RA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===i&&(s=n[0].threshold.fps_down),e<s}(t,d,o,r)&&(a.overUse++,h=oA.CPU,a.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:i}}=n[t];return e<i}(n,d,o)&&(a.overUse++,h=oA.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,u=cF(i,o,r,aF.DOWN),[u,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,i){if(0===t)return;let{threshold:{fps_up:s}}=n[t];return RA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===i&&(s=n[1].threshold.fps_up),e>s}(t,d,o,r)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:i}}=n[t];return e>i}(n,d,o)&&(a.underUse++,a.underUse>l&&(a.overUse=0,a.underUse=0,u=cF(i,o,r,aF.UP),0===u.scale&&(h=oA.NONE))),[u,h])}function hF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function pF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hF(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const mF=new Map;function fF(e,t){const n=mF.get(e);if(n){const{timer:t}=n;window.clearTimeout(t),mF.delete(e)}t.qualityLimitationReason=oA.NONE,lF(e)}function gF(e,t){var n;let i;switch(t){case vM.LocalAudioTrack:i=iM.Audio;break;case vM.LocalVideoTrack:i=Pi(n=e._hints).call(n,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalVideoLowTrack:i=iM.Low}return i}function _F(e){const t=_O();if(e.some(e=>e._bypassWebAudio))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function yF(e,t){_F(e);const n=t||new Wk;return e.forEach(e=>n.addAudioTrack(e)),n}const vF=!_O().supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&SR();function EF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return vF?(n={spec:t,store:e},JU("PlanBConnection").create(n)):new NF(t,e)}function bF(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function SF(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(ZR(e.turnServer.servers))return!1;if(RA("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch(e){return!1}}var xF;function TF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function wF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TF(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let NF=(xF=class e extends mM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Pi(t=Object.keys(DA)).call(t,e)}))]}constructor(t,n){super(t,n),uw(this,"id",wI(5,"connection-")),uw(this,"store",void 0),uw(this,"peerConnection",void 0),uw(this,"forceTurn",!1),uw(this,"remoteSDP",void 0),uw(this,"initialOffer",void 0),uw(this,"transportEventReceiver",void 0),uw(this,"statsFilter",void 0),uw(this,"extension",{useXR:RA("USE_XR")}),uw(this,"localCapabilities",void 0),uw(this,"remoteCodecs",void 0),uw(this,"localCandidateCount",0),uw(this,"allCandidatesReceived",!1),uw(this,"isPreallocation",!1),uw(this,"preMediaMap",new Map),uw(this,"dataStreamChannelMap",new Map),uw(this,"establishPromise",void 0),uw(this,"recoveredDataChannelIds",[]),uw(this,"currentDataChannelId",1),uw(this,"supportAV1RtpSpec",!1),uw(this,"mutex",void 0),uw(this,"qualityLimitationReason",oA.NONE),uw(this,"isFirstConnected",!1),this.store=n,this.forceTurn=SF(t),this.mutex=new UI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,nR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else aO.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else aO.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=SU(n.sdp),s=await kU({filterRTX:!RA("USE_PUB_RTX")&&!RA("USE_SUB_RTX"),filterVideoFec:RA("FILTER_VIDEO_FEC"),filterAudioFec:RA("FILTER_AUDIO_FEC"),filterVideoCodec:RA("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:RA("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:RA("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=jU(s),this.initialOffer=n,RA("ENABLE_SVC")&&"av1"==this.store.codec){const t=await async function(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:cA.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=VA(t.sdp).mediaDescriptions[0];if(!n)return;const i=n.attributes.extmaps.find(e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName);return e.close(),i}catch(e){return}}();var e;t&&(this.supportAV1RtpSpec=!0,null===(e=s.send)||void 0===e||e.videoExtensions.push(t))}let r;return n.sdp&&WU(n.sdp)&&(r=pI(s),(t=r).send&&(gU(fM.VIDEO,t.send.videoExtensions),gU(fM.AUDIO,t.send.audioExtensions)),t.recv&&(gU(fM.VIDEO,t.recv.videoExtensions),gU(fM.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(gU(fM.VIDEO,t.sendrecv.videoExtensions),gU(fM.AUDIO,t.sendrecv.audioExtensions))),wF(wF({},i),{},{rtpCapabilities:r||s,offerSDP:n.sdp})}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&WU(this.initialOffer.sdp)&&(t=e.rtpCapabilities,n=this.localCapabilities,t.send&&(fU(fM.VIDEO,t.send.videoExtensions,n.send.videoExtensions),fU(fM.AUDIO,t.send.audioExtensions,n.send.audioExtensions)),t.recv&&(fU(fM.VIDEO,t.recv.videoExtensions,n.recv.videoExtensions),fU(fM.AUDIO,t.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return pI(this._localCapabilities)}get rtpCapabilities(){return pI(this._rtpCapabilities)}get candidates(){return pI(this._candidates)}get iceParameters(){return pI(this._iceParameters)}get dtlsParameters(){return pI(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];uw(this,"sessionDesc",void 0),uw(this,"_localCapabilities",void 0),uw(this,"_rtpCapabilities",void 0),uw(this,"_candidates",void 0),uw(this,"_originCandidates",void 0),uw(this,"_iceParameters",void 0),uw(this,"_isUseExtmapAllowMixed",void 0),uw(this,"_isUseLocalCodecs",void 0),uw(this,"_dtlsParameters",void 0),uw(this,"setup",void 0),uw(this,"currentMidIndex",void 0),uw(this,"cname",void 0),uw(this,"useLocalCodecsMids",[]),uw(this,"preloadSsrcs",[]),uw(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,e=pI(e);const{iceParameters:i,dtlsParameters:s,candidates:r,rtpCapabilities:a,setup:o,localCapabilities:c,cname:l}=e;this._rtpCapabilities=a,this._candidates=r,this._originCandidates=pI(r),this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=c,this.setup=o,this.cname=l,[this.sessionDesc]=this.updateRemoteRTPCapabilities(a),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(e=>{var t;return Pi(t=this.preloadSsrcs).call(t,e)})}preloadRemoteMedia(e){let t=0;const n=[],i=[];for(;e>0;){const s=[eF({ssrcId:iF+t},RA("USE_SUB_RTX")?{rtx:iF+t+1}:{})],r="".concat(iF+t,"_").concat(nF+t),{ssrcs:a,ssrcGroups:o}=NU(s,this.cname,RA("SYNC_GROUP")?r:void 0),c=this.preCreateOrRecycleSendMedia("video",a,o,void 0),l=[{ssrcId:nF+t}],d="".concat(iF+t,"_").concat(nF+t),{ssrcs:u,ssrcGroups:h}=NU(l,this.cname,RA("SYNC_GROUP")?d:void 0),p=this.preCreateOrRecycleSendMedia("audio",u,h,void 0);e--,t+=2,n.push(c,p),i.push(a[0].ssrcId,u[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=i,{mids:n,preSSRCs:i,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,i){const s=this.rtpCapabilities.send.videoCodecs,r=this._isUseLocalCodecs||0===s.length?this.localCapabilities.recv:this.rtpCapabilities.send;aO.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const a=e===fM.VIDEO?r.videoCodecs:r.audioCodecs,o=e===fM.VIDEO?r.videoExtensions:r.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:o,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};return l=this.mungSendMediaDesc(l,i),this.sessionDesc.mediaDescriptions.push(l),this.updateBundleMids(),c}toString(){return FA(this.sessionDesc)}send(e,t,n,i){const{ssrcs:s,ssrcGroups:r}=NU(t,this.cname,RA("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(s);if(a){if(nR()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,s);let n;return-1===t||1===t&&($C()||function(){const e=qC();return!(e.name!==WC.CHROME||!e.osVersion)&&Number(e.version)<=90}()||RA("ENABLE_ENCODED_TRANSFORM")&&ZC())||0===t&&!function(e){const t=qC();return!(t.name!==WC.FIREFOX||!t.osVersion)&&Number(t.version)===e}(138)&&RA("USE_SUB_RTX")||mR()?(n=this.createOrRecycleSendMedia(e,s,r,"sendonly",i),this.updateBundleMids()):(n=pI(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=s,n.attributes.ssrcGroups=r,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),nR()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(e=>{let{kind:t,ssrcMsg:n,mslabel:i}=e;return this.send(t,n,i)}),n=[];let i=!1;return t.forEach(e=>{let{mid:t,needExchangeSDP:s}=e;s&&(i=!0),n.push(t)}),{mids:n,needExchangeSDP:i}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{"0"===e.attributes.mid||nR()||mR()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Pi(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Pi(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}receive(e,t,n,i){e.forEach((e,s)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,i[s])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||VA((n=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(n?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));var n;this._rtpCapabilities=e;let i=!1;const s=this.rtpCapabilities.send,r=this.localCapabilities.send,a=this.localCapabilities.recv,o=a.videoCodecs,c=a.audioCodecs,l=a.videoExtensions,d=a.audioExtensions;for(const m of t.mediaDescriptions){var u;if("sendonly"!==m.attributes.direction||"string"!=typeof m.attributes.mid||!Pi(u=this.useLocalCodecsMids).call(u,m.attributes.mid)){if(i=!0,m.attributes.iceUfrag=this._iceParameters.iceUfrag,m.attributes.icePwd=this._iceParameters.icePwd,m.attributes.fingerprints=this._dtlsParameters.fingerprints,m.attributes.candidates=this._candidates,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var h;m.media.fmts=o.map(e=>e.payloadType.toString(10)),m.attributes.payloads=o,m.attributes.extmaps=l;const e=m.attributes.mid;"string"!=typeof e||Pi(h=this.useLocalCodecsMids).call(h,e)||this.useLocalCodecsMids.push(e)}else if(0===s.videoCodecs.length){const e=r.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Pi(n=t.encodingName.toLowerCase()).call(n,"vp8")})||[r.videoCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=s.videoCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=s.videoCodecs,m.attributes.extmaps=s.videoExtensions;if("audio"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var p;m.media.fmts=c.map(e=>e.payloadType.toString(10)),m.attributes.payloads=c,m.attributes.extmaps=d;const e=m.attributes.mid;"string"!=typeof e||Pi(p=this.useLocalCodecsMids).call(p,e)||this.useLocalCodecsMids.push(e)}else if(0===s.audioCodecs.length){const e=r.audioCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Pi(n=t.encodingName.toLowerCase()).call(n,"opus")})||[r.audioCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=s.audioCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=s.audioCodecs,m.attributes.extmaps=s.audioExtensions,MU(m)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,i]}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),n=[];if(t.forEach(e=>{n.push(eF(eF({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this._candidates=n;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(nR()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:tF,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,i,s,r){const a=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=UU(a,o,this.localCapabilities.send,a===fM.VIDEO?i:s),l=a===fM.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let u={media:{mediaType:a,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e,r);const h=this.findFirstClosedMedia(a);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(e=>e.fingerprint)),n=new Set(e.map(e=>e.fingerprint));let i=!1;t.size!==n.size&&(i=!0);for(const s of t)n.has(s)||(i=!0);return i}updateRemoteCodec(e,t,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Pi(t=Object.keys(DA)).call(t,e)}))],s=new Set(t);if(i.every(e=>s.has(e)))return aO.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const r=this._rtpCapabilities.recv.videoCodecs.filter(e=>t.some(t=>{var n;return Pi(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}));if(0===r.length)return aO.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(t)),!1;const a=[...new Set(r.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""))];let o;if(aO.debug("updateRemoteCodec, from ".concat(i," to ").concat(a)),0===e.length)o=this.sessionDesc.mediaDescriptions.filter(e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction);else if(o=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&"video"===t.media.mediaType&&Pi(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction),o.length!==e.length)return aO.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(RA("USE_PUB_RTX")||RA("USE_SUB_RTX")){const e=VU(r,this.rtpCapabilities.recv.videoCodecs);r.push(...e)}this._rtpCapabilities.recv.videoCodecs=r;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,d=UU(fM.VIDEO,l,c,n);return o.forEach(e=>{const t=d.map(e=>e.payloadType.toString(10));aO.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",d),e.attributes.payloads=d,e.media.fmts=t}),!0}createOrRecycleSendMedia(e,t,n,i,s){const r=this.rtpCapabilities.send.videoCodecs,a=this._isUseLocalCodecs||0===r.length?this.localCapabilities.recv:this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungSendMediaDesc(d,s);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const i=pI(e);return RU(i),CU(i,t),IU(i,t),AU(i),OU(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=pI(e);return OU(n,t,this.localCapabilities.recv),MU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>nR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===t?void 0:t.attributes.ssrcs}}(wF(wF({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!RA("ENABLE_PRE_SUB_WITH_PRE_PC")||!RA("PRE_USE_LOCAL_CODECS"))&&EO(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=BU(this.initialOffer.sdp,this.extension),r=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const a=this.peerConnection.getTransceivers()[0];if(null!=a&&a.receiver&&this.tryBindTransportEvents(a.receiver),EO(this.store))if(e.preallocation&&RA("ENABLE_PRE_SUB_WITH_PRE_PC")){const e=RA("PRE_SUB_NUM"),{mids:t,preSSRCs:n}=this.remoteSDP.preloadRemoteMedia(e);await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(n)),this.presetMedia(t,n)}else{const{preSSRCs:t=[]}=e,n=t.map(e=>e.ssrcMsg[0].ssrcId);if(0===t.length)return;const{mids:i}=this.remoteSDP.batchSend(t.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(n)),this.presetMedia(i,n)}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}var t,n}presetMedia(e,t){e.forEach((e,n)=>{this.peerConnection.getTransceivers().forEach(i=>{if(null!=i.mid&&e===i.mid&&i.receiver.track){const s=i.receiver.track;let r;"video"===s.kind&&RA("ENABLE_PRE_RENDER")&&(r=new Xk({trackId:"track-".concat(s.kind,"-unknown-").concat(this.store.clientId,"_").concat(wI(5,""))},!0),r.updateVideoTrack(s),r.onFirstVideoFrameRender=()=>{var e;const i=this.preMediaMap.get(t[n]);i&&(i.firstVideoRender=Date.now()),null===(e=this.onFirstVideoRender)||void 0===e||e.call(this,t[n])},r.play(this.store.sessionId||void 0)),this.preMediaMap.set(t[n],{mid:e,track:s,player:r,transceiver:i})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let t=!1;const{rtpCapabilities:n}=e;if([,t]=this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const e=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);t=t||e}const{preSSRCs:i=[]}=e,s=i.map(e=>e.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const e=[],t=[];if(Array.from(this.preMediaMap.entries()).every(n=>{let[i,{mid:s,player:r,track:a}]=n;return e.push(s),t.push(i),this.preMediaMap.delete(i),r&&r.destroy(),!0}),e.length>0&&(this.remoteSDP.stopSending(e),await FU(this.peerConnection,this.remoteSDP,this.extension),aO.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(t)),mO.reportApiInvoke(this.store.sessionId,{name:qR.PRELOAD_MEDIA_FAILED,options:[i,t],tag:YR.TRACER}).onSuccess()),i.length>0){const{mids:e}=this.remoteSDP.batchSend(i.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(e,s)}}t?(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):aO.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,n){var i=this;return YN(function*(){const s=yield JN(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=[],a=pU();e.forEach(e=>{const t=i.peerConnection.addTransceiver(e._mediaStreamTrack,wF({direction:"sendonly"},"video"===e.trackMediaType&&i.supportAV1RtpSpec&&a?{sendEncodings:[{scalabilityMode:a}]}:{}));r.push(t),e._updateRtpTransceiver(t)}),nR()&&!0===RA("SIMULCAST")&&(yield JN(i.applySimulcastForFirefox(r,e)));const o=yield JN(i.peerConnection.createOffer()),c=i.remoteSDP.predictReceivingMids(e.length),l=i.mungSendOfferSDP(o.sdp,e,c),d=VA(l),u=c.map(e=>{const t=d.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return xU(t,RA("USE_PUB_RTX"))});let h;try{h=yield u}catch(s){h=[],i.remoteSDP.receive(e,t,n,h);const r=i.remoteSDP.toString();throw yield JN(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JN(i.peerConnection.setRemoteDescription({type:"answer",sdp:r})),yield JN(i.stopSending(c,!0)),s}i.remoteSDP.receive(e,t,n,h);const p=i.remoteSDP.toString(),m=i.logSDPExchange(l,"offer","local","send");return yield JN(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JN(i.applySimulcastEncodings(r,e)),yield JN(i.applySendEncodings(r,e)),null==m||m(p),yield JN(i.peerConnection.setRemoteDescription({type:"answer",sdp:p})),r.map((e,t)=>{const n=c[t];return{localSSRC:u[t],id:n,transceiver:e}})}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{s()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)aO.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:RA("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach(e=>{e._updateOriginDataChannel(n)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),aO.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else aO.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof IR?e:new IR(RR.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{var t;fF(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const s=this.remoteSDP.toString();null==i||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:r}=this.remoteSDP.send(e,t,n,i);r&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(e=>e.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s,transceiver:a}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(e=>{const t=this.peerConnection.getTransceivers().find(t=>t.mid===e);if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(e=>{Array.from(this.preMediaMap.entries()).some(t=>{let[n,{mid:i,player:s}]=t;if(i===e)return this.preMediaMap.delete(n),s&&s.destroy(),!0})}),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();null==i||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(e,t)=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();null==i||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YN(function*(){const n=yield JN(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=_O().supportPCSetConfiguration,i=RA("FORCE_TURN_TCP")||t.forceTurn;if(e===gM.RELAY&&!n)return;if(n&&!i){const n=e===gM.RELAY?"relay":"all",i=t.peerConnection.getConfiguration();i.iceTransportPolicy!==n&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(i.iceTransportPolicy,"] to [").concat(n,"]")),i.iceTransportPolicy=n,t.peerConnection.setConfiguration(i))}t.remoteSDP.updateCandidates(e);const s=yield JN(t.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=SU(s.sdp),{remoteIceParameters:a}=yield r.iceParameters;t.remoteSDP.restartICE(a);const o=t.remoteSDP.toString(),c=t.logSDPExchange(s.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield JN(t.peerConnection.setLocalDescription(s)),null==c||c(o),yield JN(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(gM.TCP_RELAY),await FU(this.peerConnection,this.remoteSDP,this.extension)}catch(e){aO.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(e=>{fF(this.id+e.mid,this)}),this.preMediaMap.forEach(e=>{let{player:t}=e;t&&t.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return wF(wF({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==r||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?nR()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:i}=t.getSelectedCandidatePair();return{local:wF(wF({},$I),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:wF(wF({},$I),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;const n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),i=e.port?"local: ".concat(e.port):"",s=hU(e.url||"");aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(s||"",", host_candidate:").concat(i)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},RA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(ZR(t.turnServer.servers)?n.iceServers=t.turnServer.servers:RA("NEW_TURN_MODE")&&n.iceServers&&"disabled"===i?(RA("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),RA("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),RA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),RA("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),RA("ENABLE_ENCODED_TRANSFORM")&&_O().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!RA("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{const n=RA("NEW_TURN_MODE");1===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":443?transport=tcp")}):4===n&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair()||{};if(e&&t){const n=e.address+":"+e.port,i=t.address+":"+t.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(n)),", remote ").concat(JSON.stringify(hU(i))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,i;if(!t){const n=this.peerConnection.getSenders();t=n.find(t=>t.track===e._mediaStreamTrack)}if(!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!_O().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},r={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const a=function(e,t){return e.getTransceivers().find(e=>e.sender.track===t||e.receiver.track===t)}(this.peerConnection,e._mediaStreamTrack),o=JD(e);if(function(e){var t;return!(!RA("ENABLE_AG_ADAPTATION")||!(e instanceof LP||Pi(t=e._hints).call(t,UO.CUSTOM_TRACK))||!RA("FORCE_SUPPORT_AG_ADAPTATION")&&!(dR(14,0,!1)&&uR(17,4,!0)||lR(14)&&hR(17,4,!0)))}(e)&&a&&t&&o&&this.getLocalVideoStats&&Pi(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=s.degradationPreference||(Pi(c=e._hints).call(c,UO.CUSTOM_TRACK)?RA("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,i,s,r){if(fF(e,n),s(t),"balanced"!==i&&"maintain-framerate"!==i&&"maintain-resolution"!==i)return;let a=-1;lF(e,t);const o=window.setInterval(()=>{const o=mF.get(e);if(!RA("ENABLE_AG_ADAPTATION")||!o)return fF(e,n),void s(t);const c=r();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;const r=c.sendFrameRate,l=c.OutgoingAvailableBandwidth,[d,u]=uF(e,r,l,o.adaptationConfig,t,i);u&&(n.qualityLimitationReason=u),d&&o.adaptationConfig.scale!==d.scale&&(aO.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(r,", bwe ").concat(l,", switch from ").concat(o.adaptationConfig.scale," to ").concat(d.scale," ")),o.adaptationConfig=pF(pF({},o.adaptationConfig),d),s(d))}},RA("CHECK_LOCAL_STATS_INTERVAL")),c=pF({},t);mF.set(e,{timer:o,adaptationConfig:c,originConfig:t,adaptationFunc:s}),aO.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(i))}(this.id+a.mid,o,this,n,e=>{t&&this.updateAdaptation(t,e)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:i}=e._encoderConfig;t&&(r.maxBitrate=1e3*t),(Pi(l=e._hints).call(l,UO.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(r.maxFramerate=rU(n)),i&&i>=1&&(r.scaleResolutionDownBy=i))}const{maxFramerate:d}=RA("ENCODER_CONFIG_LIMIT");if(d&&"number"==typeof d&&(r.maxFramerate=r.maxFramerate?Math.min(r.maxFramerate,d):d),RA("DSCP_TYPE")&&SR()){var u;const e=RA("DSCP_TYPE");Pi(u=["very-low","low","medium","high"]).call(u,e)&&(r.networkPriority=e)}const h=t.getParameters(),p=null===(i=h.encodings)||void 0===i?void 0:i[0];nR()&&!p&&(s.encodings=[r]),p&&Object.assign(p,r),Object.assign(h,s),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,n){try{var i;if(!_O().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e||"av1"===e}(e)||!RA("ENABLE_SVC"))return;const s={},r={},a=t.getParameters(),o=null===(i=a.encodings)||void 0===i?void 0:i[0];r.scalabilityMode=pU(n),o&&Object.assign(o,r),Object.assign(a,s),await t.setParameters(a),aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,RA("SVC_MODE"))}async updateAdaptation(e,t){var n,i;if(!e)return aO.debug("[updateAdaptation] no rtpSender found");if(!_O().supportSetRtpSenderParameters)return aO.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:r,frameRate:a,scaleResolutionDownBy:o}=t;r&&(s.maxBitrate=1e3*r),a&&(s.maxFramerate=rU(a)),o&&o>=1&&Pi(n=["vp8","vp9"]).call(n,this.store.codec)&&(s.scaleResolutionDownBy=o);const c=e.getParameters(),l=null===(i=c.encodings)||void 0===i?void 0:i[0];l&&Object.assign(l,s),Object.assign(c,{});try{await e.setParameters(c),aO.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?aO.debug("[updateAdaptation] peerConnection not connected}"):aO.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):aO.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!_O().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const i=e[n],s=t[n];s instanceof PP&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const i=VA(e);return t.forEach((e,t)=>{const s=n[t],r=i.mediaDescriptions.find(e=>e.attributes.mid===s);r&&(CU(r,e),DU(r,e,this.store.codec))}),FA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var n,i,s,r,a;const c=e[o],l=t[o];if(l instanceof PP&&!Pi(n=l._hints).call(n,UO.LOW_STREAM)&&null!==(i=l._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(s=l._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(r=l._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nR()&&e.length===t.length)for(let n=0;n<e.length;n++){const i=t[n];if(i instanceof PP&&this.isVP8Simulcast(i)){const t=e[n],s={},r={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:r.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:r.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,s))}}}isVP8Simulcast(e){var t,n,i,s,r;return!!(e instanceof PP&&RA("SIMULCAST")&&"vp8"===this.store.codec&&!Pi(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(i=e._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(s=e._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(r=e._scalabilityMode)||void 0===r?void 0:r.numSpatialLayers)>1)}logSDPExchange(e,t,n,i){if(RA("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(i,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(_O().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ij(xF.prototype,"updateRemoteRTPCapabilities",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"updateRemoteRTPCapabilities"),xF.prototype),Ij(xF.prototype,"connect",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"connect"),xF.prototype),Ij(xF.prototype,"updateRemoteConnect",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"updateRemoteConnect"),xF.prototype),Ij(xF.prototype,"createDataChannels",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"createDataChannels"),xF.prototype),Ij(xF.prototype,"receive",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"receive"),xF.prototype),Ij(xF.prototype,"batchReceive",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"batchReceive"),xF.prototype),Ij(xF.prototype,"stopReceiving",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"stopReceiving"),xF.prototype),Ij(xF.prototype,"muteRemote",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"muteRemote"),xF.prototype),Ij(xF.prototype,"unmuteRemote",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"unmuteRemote"),xF.prototype),Ij(xF.prototype,"muteLocal",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"muteLocal"),xF.prototype),Ij(xF.prototype,"unmuteLocal",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"unmuteLocal"),xF.prototype),Ij(xF.prototype,"close",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"close"),xF.prototype),Ij(xF.prototype,"updateEncoderConfig",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"updateEncoderConfig"),xF.prototype),Ij(xF.prototype,"updateSendParameters",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"updateSendParameters"),xF.prototype),Ij(xF.prototype,"replaceTrack",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"replaceTrack"),xF.prototype),Ij(xF.prototype,"updateAdaptation",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"updateAdaptation"),xF.prototype),Ij(xF.prototype,"getRemoteSSRC",[CF],Object.getOwnPropertyDescriptor(xF.prototype,"getRemoteSSRC"),xF.prototype),xF);function CF(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return await i.apply(this,r)}finally{n()}},n}function RF(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=rU(t.width),i.height=rU(t.height);const s=rU(t.framerate||15);document.body.append(n),document.body.append(i);let r=e._mediaStreamTrack;n.srcObject=new MediaStream([r]),n.play();const a=i.getContext("2d");if(!a)throw new fO(RR.UNEXPECTED_ERROR,"can not get canvas context");const o=_O(),c=i.captureStream(o.supportRequestFrame?0:s).getVideoTracks()[0];c.canvas||(c.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,s=i.width*t;Math.abs(s-i.height)>=2&&(aO.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(s)),i.height=s)}a.drawImage(n,0,0,i.width,i.height),c.requestFrame&&c.requestFrame(),r!==e._mediaStreamTrack&&(r=e._mediaStreamTrack,n.srcObject=new MediaStream([r]))},i.stopCapture=yD(()=>i.startCapture&&i.startCapture(),s);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),aO.debug("clean low stream renderer")},c}var IF=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(IF||{}),AF=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(AF||{}),OF=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(OF||{}),DF=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(DF||{}),kF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(kF||{}),PF=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(PF||{});const LF=1e3,jF=6,MF=3,UF=Math.max(jF,MF,60);function VF(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function FF(e){const t={[kF.CONN_TYPE]:0,[kF.RTT]:e.rtt,[kF.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[kF.CONN_TYPE]=1),"tcp"===n&&(t[kF.CONN_TYPE]=3),"tls"===n&&(t[kF.CONN_TYPE]=4);break}case"srflx":t[kF.CONN_TYPE]=2;break;case"unknown":t[kF.CONN_TYPE]=5;break;default:t[kF.CONN_TYPE]=0}return t}function BF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class GF extends HR{constructor(e){super(),uw(this,"store",void 0),uw(this,"uploadWRTCStatsTimer",void 0),uw(this,"uploadOutboundDenoiserStatsTimer",void 0),uw(this,"uploadExtStatsTimer",void 0),uw(this,"uploadExtUsageStatsTimer",void 0),uw(this,"uploadInboundExtStatsTimer",void 0),uw(this,"requestStats",void 0),uw(this,"requestTransportStats",void 0),uw(this,"requestLocalMedia",void 0),uw(this,"requestRemoteMedia",void 0),uw(this,"requestAllTracks",void 0),uw(this,"requestVideoIsReady",void 0),uw(this,"requestUploadStats",void 0),uw(this,"requestUpload",void 0),uw(this,"uploadOutboundStarted",!1),uw(this,"uploadInboundStarted",!1),uw(this,"uploadTransportStarted",!1),uw(this,"uploadBaseStatsStarted",!1),uw(this,"uploadExtensionUsageStarted",!1),uw(this,"lastRecvStats",void 0),uw(this,"lastSendStats",void 0),uw(this,"lastRefRecvStats",void 0),uw(this,"lastRefSendStats",void 0),uw(this,"lastNormalRecvStats",void 0),uw(this,"lastNormalSendStats",void 0),uw(this,"lastExtendStats",{}),uw(this,"needUploadStats",{}),uw(this,"needUploadRenderFreezeTime",!0),uw(this,"lastUploadCompensateTime",-1),uw(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const t=e%MF==0,n=e%jF==0,i=e%60==0;let s,r;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),s||r){var a;const o={};if(this.uploadTransportStarted&&s){const e=this.getTransportStats(s,r,t);e&&(o.misc=[e])}if(this.uploadOutboundStarted&&s){const e=this.getOutboundStats(s,n?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats,i);e&&(o.outbound=[e])}if(this.uploadInboundStarted&&r){this.uploadCompensateStats(e);const i=this.getInboundStats(r,n?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);i&&(o.inbound=i)}const c=null===(a=this.requestTransportStats)||void 0===a?void 0:a.call(this).connectState;c&&(Array.isArray(o.misc)?o.misc[0]&&o.misc[0].addition&&(o.misc[0].addition[PF.RTC_PEER_CONNECTION_STATE]=lA[c]):o.misc=[{addition:{[PF.RTC_PEER_CONNECTION_STATE]:lA[c]}}]),this.needUploadStats.sendType&&(Array.isArray(o.outbound)&&o.outbound[0]&&o.outbound[0].high&&(o.outbound[0].high[IF.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(o)}this.lastRecvStats=r,this.lastSendStats=s,n&&(this.lastNormalRecvStats=r,this.lastNormalSendStats=s),t&&(this.lastRefRecvStats=r,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,n;const e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(n=this.requestUploadStats)||void 0===n||n.call(this,{misc:[{addition:{[PF.RTC_PEER_CONNECTION_STATE]:lA[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===UF+1&&(e=1)},LF)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const t=e%MF==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(-1===this.lastUploadCompensateTime)return void(this.lastUploadCompensateTime=Date.now());const n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const e={};if(this.uploadInboundStarted&&s){const t=this.requestRemoteMedia()||[],n=[];t.forEach(e=>{let[t,i]=e;const r={peer:t.uid};if(t._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(t._videoSSRC)&&i.has(fM.VIDEO)&&t.videoTrack){const e=function(e,t,n){if(!t.videoRecv.find(t=>t.ssrc===e))return;const i={};if(n&&n._player){const e=n._player,{renderFreezeAccTime2:t,videoElementStatus:s}=e;if("visible"===ZP.visibility&&s===nD.PLAYING&&_O().supportRequestVideoFrameCallback){const n=Math.min(6e3,t);e.renderFreezeAccTime2=Math.max(0,t-n),VF(i,AF.Video_Render_Freeze_Time_Render2,n),RA("USE_NEW_RENDER_FREEZE_TIME")&&VF(i,AF.Video_Render_Freeze_Time_Render,n)}}return i}(t._videoSSRC,s,t.videoTrack);e&&(r.video=e)}r.video&&n.push(r)}),n.length>0&&(e.inbound=n,this.requestUploadStats(e))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,n){if(!this.requestStats)return;if(!n)return null==e.rtt?void 0:{addition:{[kF.RTT]:e.rtt,[kF.CONN_TYPE]:void 0,[kF.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const i=FF(e);if(this.store.useP2P){if(t){const e=FF(t);i[kF.CONN_TYPE]+=e[kF.CONN_TYPE]<<3}i[kF.CONN_TYPE]+=110}else i[kF.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,t,n,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const r=this.requestLocalMedia();if(!r||0===r.length)return;let a,o,c;return r.forEach(i=>{let[r,{track:l,ssrcs:d}]=i;switch(r){case vM.LocalVideoLowTrack:case vM.LocalVideoTrack:if(r===vM.LocalVideoTrack){var u;const i=function(e,t,n,i,s){const r=t.videoSend.find(t=>t.ssrc===e);if(!r)return;const a={},{sentFrame:o,inputFrame:c}=r;if(i&&(VF(a,AF.Video_Send_Qp_Sum,r.qpSumPerFrame),c&&o)){const e=c.frameRate,t=o.frameRate;a[AF.Video_Send_Freeze]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(s){switch(o&&(VF(a,OF.Video_Send_Height,o.height),VF(a,OF.Video_Send_Width,o.width),VF(a,OF.Video_Send_Frame_Rate,o.frameRate)),a[OF.Video_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0,r.adaptionChangeReason){case"none":a[OF.Video_Send_Adaptation]=0;break;case"cpu":a[OF.Video_Send_Adaptation]=1;break;case"bandwidth":a[OF.Video_Send_Adaptation]=2;break;case"other":a[OF.Video_Send_Adaptation]=3}let i=0;r.adaptionChangeReason&&(i+=BF(r.adaptionChangeReason)),t.qualityLimitationReason&&(i+=BF(t.qualityLimitationReason)<<3),a[OF.Video_Send_Adaptation]=i,a[OF.Video_Send_Player_Status]=sD[n._player?n._player.videoElementStatus:"uninit"],VF(a,OF.Video_Send_Nacks,r.nacksCount),VF(a,OF.Video_Send_Plis,r.plisCount),VF(a,OF.Video_Send_Firs,r.firsCount),VF(a,OF.Video_Send_Avg_Encode,r.avgEncodeMs),VF(a,OF.Video_Send_Huge_Frame_Sent,r.hugeFramesSent),VF(a,OF.Video_Send_Bytes_Retransmit,r.retransmittedBytesSent),VF(a,OF.Video_Send_Packages_Retransmit,r.retransmittedPacketsSent),VF(a,OF.Video_Send_Key_Frames_Encoded,r.keyFramesEncoded);const c=s.videoSend.find(t=>t.ssrc===e);if(c){let e=LF*MF;c.timestamp&&r.timestamp&&(e=r.timestamp-c.timestamp),null!=c.packets&&null!=r.packets&&VF(a,OF.Video_Send_Package_Rate,1e3*(r.packets-c.packets)/e),null!=r.packetsLost&&null!=c.packetsLost&&VF(a,OF.Video_Send_Package_Lost,r.packetsLost-c.packetsLost),null!=c.bytes&&null!=r.bytes&&VF(a,OF.Video_Send_Bitrate,8*(r.bytes-c.bytes)/e)}}return a}(d[0].ssrcId,e,l,t,n),r="CameraVideoTrack"===l.__className__?3:Pi(u=l._hints).call(u,UO.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==r||s)&&(this.needUploadStats={sendType:r},this.lastExtendStats.sendType=r);const a=l&&function(e,t,n,i){const s=t.videoSend.find(t=>t.ssrc===e);if(!s)return null;const r={};if(i){const e=s.inputFrame,t=e&&e.height||n.videoHeight||0,i=e&&e.width||n.videoWidth||0,a=e&&e.frameRate||0;VF(r,OF.Video_Capture_Height,t),VF(r,OF.Video_Capture_Width,i),VF(r,OF.Video_Capture_Frame_Rate,a)}return r}(d[0].ssrcId,e,l,!!n),c=function(e,t){const n={};return t&&(VF(n,OF.Video_Send_Retransmit,e.bitrate.retransmit),VF(n,OF.Video_Send_Target_Encoded,e.bitrate.targetEncoded),VF(n,OF.Video_Send_Actual_Encoded,e.bitrate.actualEncoded),VF(n,OF.Video_Send_Transmit,e.bitrate.transmit),VF(n,OF.Video_Send_Bandwidth,e.sendBandwidth)),n}(e,!!n);o=Object.assign({},i,a,c)}else c=function(e,t,n,i){const s=t.videoSend.find(t=>t.ssrc===e);if(!s)return;const r={};if(i){const t=s.sentFrame;t&&(VF(r,OF.Video_Send_Low_Height,t.height),VF(r,OF.Video_Send_Low_Width,t.width),VF(r,OF.Video_Send_Low_Frame_Rate,t.frameRate));const n=i.videoSend.find(t=>t.ssrc===e);if(n){let e=LF*jF;n.timestamp&&s.timestamp&&(e=s.timestamp-n.timestamp),null!=n.packets&&null!=s.packets&&VF(r,OF.Video_Send_Low_Package_Rate,1e3*(s.packets-n.packets)/e),null!=s.packetsLost&&null!=n.packetsLost&&VF(r,OF.Video_Send_Low_Package_Lost,s.packetsLost-n.packetsLost),null!=n.bytes&&null!=s.bytes&&VF(r,OF.Video_Send_Low_Bitrate,8*(s.bytes-n.bytes)/e)}}return r}(d[0].ssrcId,e,0,n);break;case vM.LocalAudioTrack:a=l&&function(e,t,n,i,s){const r=t.audioSend.find(t=>t.ssrc===e);if(!r)return;const a={};if(s){a[OF.Audio_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0;const t=100*n._source.getAccurateVolumeLevel(),i=r.inputLevel;if(null!=i){const e=Math.ceil(50*Math.log10(100*i+1));VF(a,OF.Audio_Send_Level,e)}VF(a,OF.Audio_Capture_PCM_Level,t),VF(a,OF.Audio_Send_AEC_Return_Loss,r.aecReturnLoss),VF(a,OF.Audio_Send_AEC_Return_Loss_Enhancement,r.aecReturnLossEnhancement),VF(a,OF.Audio_Send_Bytes_Retransmit,r.retransmittedBytesSent),VF(a,OF.Audio_Send_Packages_Retransmit,r.retransmittedPacketsSent),a[OF.Audio_Send_Freeze]=0;const o=s.audioSend.find(t=>t.ssrc===e);if(o){let e=LF*jF;o.timestamp&&r.timestamp&&(e=r.timestamp-o.timestamp),null!=o.bytes&&null!=r.bytes&&VF(a,OF.Audio_Send_Bitrate,8*(r.bytes-o.bytes)/e),null!=o.packets&&null!=r.packets&&VF(a,OF.Audio_Send_Package_Rate,1e3*(r.packets-o.packets)/e)}}return a}(d[0].ssrcId,e,l,0,n)}}),{high:o,low:c,audio:a}}getInboundStats(e,t,n,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],r=[];return s.forEach(s=>{let[a,o]=s;const c={peer:a.uid};if(o.has(fM.VIDEO)&&a.videoTrack){const s=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,r=a.videoTrack?function(e,t,n,i,s,r,a,o){const c=t.videoRecv.find(t=>t.ssrc===e);if(!c)return;const l={},{receivedFrame:d,outputFrame:u,decodeFrameRate:h}=c;VF(l,DF.Video_Render_Frame_Rate_Decode,h),c.framesRateFirefox&&VF(l,DF.Video_Recv_Frame_Rate,c.framesRateFirefox),d&&VF(l,DF.Video_Recv_Frame_Rate,d.frameRate),VF(l,DF.Video_Recv_Frame_Dropped,c.framesDroppedCount),VF(l,DF.Video_Recv_Bytes_Retransmit,c.retransmittedBytesReceived),VF(l,DF.Video_Recv_Packages_Retransmit,c.retransmittedPacketsReceived),VF(l,DF.Video_Recv_Packages_Discarded,c.packetsDiscarded),VF(l,DF.Video_Recv_Avg_Decode,c.avgDecodeMs),VF(l,DF.Video_Recv_Avg_Processing_Delay,c.avgProcessingDelayMs),VF(l,DF.Video_Recv_Avg_Assembly_Time,c.avgFramesAssembledFromMultiplePacketsMs),VF(l,DF.Video_Recv_Avg_Inter_Frame_Delay,c.avgInterFrameDelayMs),VF(l,DF.Video_Recv_Key_Frames_Decoded,c.keyFramesDecoded);const p=o&&o.videoRecv.find(t=>t.ssrc===e);if(p){const e=t.timestamp-o.timestamp||LF;null!=c.packetsLost&&null!=p.packetsLost&&VF(l,DF.Video_Recv_Package_Lost,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&VF(l,DF.Video_Recv_Bitrate,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&VF(l,DF.Video_Recv_Package_Rate,1e3*(c.packets-p.packets)/e)}const m=r&&r.videoRecv.find(t=>t.ssrc===e);if(m&&(VF(l,AF.Video_Recv_Qp_Sum,c.qpSumPerFrame),l[AF.Video_Recv_Freeze]=i&&XV.isRemoteVideoFreeze(n,c,m)?1:0),a){var f;const t=a.videoRecv.find(t=>t.ssrc===e);d?(VF(l,OF.Video_Recv_Height,d.height),VF(l,OF.Video_Recv_Width,d.width)):n&&(VF(l,OF.Video_Recv_Height,n._videoHeight||0),VF(l,OF.Video_Recv_Width,n._videoWidth||0)),u&&VF(l,OF.Video_Recv_Frame_Rate_Output,u.frameRate);const i=null===(f=n._player)||void 0===f?void 0:f.rendFrameRate.toFixed(0);if(i&&VF(l,OF.Video_Render_Frame_Rate_Render,+i),VF(l,OF.Video_Recv_Jitter_Buffer,c.jitterBufferMs),VF(l,OF.Video_Recv_Current_Delay,c.currentDelayMs),VF(l,OF.Video_Recv_Firs,c.firsCount),VF(l,OF.Video_Recv_Nacks,c.nacksCount),VF(l,OF.Video_Recv_Plis,c.plisCount),n){l[OF.Video_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1;const e=n._player;if(e){const{freezeTimeCounterList:n,renderFreezeAccTime:i,renderFreezeAccTime2:r,videoElementStatus:a}=e;if(n&&n.length>0&&VF(l,AF.Video_Render_Freeze_Time,n.splice(0,1)[0]),s&&"visible"===ZP.visibility&&a===nD.PLAYING&&_O().supportRequestVideoFrameCallback){const t=Math.min(6e3,r);e.renderFreezeAccTime2=Math.max(0,r-t),VF(l,AF.Video_Render_Freeze_Time_Render2,t);const n=Math.min(6e3,i);e.renderFreezeAccTime=Math.max(0,i-n),VF(l,AF.Video_Render_Freeze_Time_Render,RA("USE_NEW_RENDER_FREEZE_TIME")?t:n)}if("number"==typeof c.totalFreezesDuration){const e=t&&t.totalFreezesDuration?c.totalFreezesDuration-t.totalFreezesDuration:c.totalFreezesDuration;VF(l,OF.Video_Render_Freeze_Duration,1e3*e)}}}if(l[OF.Video_Recv_Player_Status]=sD[n._player?n._player.videoElementStatus:"uninit"],t&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-t.totalInterFrameDelay,n=c.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,i=c.framesDecodeCount-t.framesDecodeCount,s=e/i*1e3,r=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/i)/i));!isNaN(r)&&s+r>Math.max(3*s,s+150)&&(l[OF.Video_Recv_I_Frame_Delay]=r)}}return l}(a._videoSSRC,e,a.videoTrack,!0===s,this.needUploadRenderFreezeTime,t,n,i):void 0;r&&(c.video=r)}if(o.has(fM.AUDIO)&&a.audioTrack){const s=a.audioTrack?function(e,t,n,i,s,r){const a=t.audioRecv.find(t=>t.ssrc===e);if(!a)return;const o={};VF(o,DF.Audio_Recv_Jitter,a.jitterMs),VF(o,DF.Audio_Recv_Bytes_Retransmit,a.retransmittedBytesReceived),VF(o,DF.Audio_Recv_Packages_Retransmit,a.retransmittedPacketsReceived),VF(o,DF.Audio_Recv_Packages_Discarded,a.packetsDiscarded),VF(o,DF.Audio_Recv_Avg_Processing_Delay,a.avgProcessingDelayMs);const c=r&&r.audioRecv.find(t=>t.ssrc===e);if(c){const e=LF;null!=a.packets&&null!=c.packets&&VF(o,DF.Audio_Recv_Package_Rate,1e3*(a.packets-c.packets)/e),null!=a.packetsLost&&null!=c.packetsLost&&VF(o,DF.Audio_Recv_Package_Lost,a.packetsLost-c.packetsLost)}if(i){const{receivedFrames:e,droppedFrames:t}=a;null!=e&&null!=t&&(o[AF.Audio_Recv_Freeze]=0===(l=e)||100*t/l>20?1:0)}var l;if(s){const t=100*n._source.getAccurateVolumeLevel(),i=a.outputLevel;if(null!=i){const e=Math.ceil(50*Math.log10(100*i+1));VF(o,OF.Audio_Render_Level,e)}VF(o,OF.Audio_Recv_PCM_Level,t),n&&(o[OF.Audio_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1),VF(o,OF.Audio_Recv_Jitter_Buffer,a.jitterBufferMs),VF(o,OF.Audio_Recv_Current_Delay,a.jitterBufferMs),o[OF.Audio_Recv_Player_Status]=sD[UD.getPlayerState(n.getTrackId())];const r=s.audioRecv.find(t=>t.ssrc===e);if(r){null!=r.bytes&&null!=a.bytes&&VF(o,OF.Audio_Recv_Bitrate,8*(a.bytes-r.bytes)/(LF*MF));const e=a.concealedSamples-r.concealedSamples;e>0&&VF(o,OF.Audio_Recv_Concealed_Samples,e);const t=a.totalSamplesReceived-r.totalSamplesReceived;t>0&&VF(o,OF.Audio_Recv_Total_Samples_Received,t);const n=a.freezeSamples80-r.freezeSamples80;n>0&&VF(o,OF.Audio_Render_Freeze_Samples_80ms,n);const i=a.freezeSamples200-r.freezeSamples200;i>0&&VF(o,OF.Audio_Render_Freeze_Samples_200ms,i);const s=a.freezeMs80-r.freezeMs80;VF(o,OF.Audio_Render_Freeze_Time_80ms,s<0?0:s);const c=a.freezeMs200-r.freezeMs200;VF(o,OF.Audio_Render_Freeze_Time_200ms,c<0?0:c)}}return o}(a._audioSSRC,e,a.audioTrack,t,n,i):void 0;s&&(c.audio=s)}(c.video||c.audio)&&r.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,r}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(e=>e instanceof Bk);if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(Uj.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach(e=>{let[t,n]=e;n.has(fM.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}),n.has(fM.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const t=Date.now(),n={connectionInterval:RA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of s)!e.muted&&e.enabled&&(i=i.concat(await e.getProcessorUsage()));const r=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of r)c.has(fM.VIDEO)&&e.videoTrack&&(i=i.concat(await e.videoTrack.getProcessorUsage())),c.has(fM.AUDIO)&&e.audioTrack&&(i=i.concat(await e.audioTrack.getProcessorUsage()));if(0===i.length)return;n.details=function(e,t){const n={};for(const{id:a,value:o,level:c,direction:l}of e){var i;const e=null!==(i=t.get(a))&&void 0!==i?i:0,d=2===o?e+RA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var s,r;t.set(a,d),n[a]?(2===o&&(n[a].value=o),c>n[a].level&&(n[a].level=c),"remote"===l&&(n[a].remoteUidCount+=1),n[a].totalTs=null!==(s=t.get(a))&&void 0!==s?s:0):n[a]={value:o,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(r=t.get(a))&&void 0!==r?r:0}}return Object.keys(n).map(e=>{const{level:t,value:i,totalTs:s}=n[e];return{id:e,level:t,value:i,totalTs:s}})}(i,e);const a=Date.now(),o=a>t?a:t+1;this.requestUpload&&this.requestUpload(Uj.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:o})},RA("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const WF=RA("ICE_RESTART_INTERVAL");let HF=new Map,KF=new Map,zF=[gM.UDP_TCP_RELAY,gM.TCP_RELAY,gM.RELAY],qF=RA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&_O().supportPCSetConfiguration;function YF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=HF.get(e.id);n&&(window.clearTimeout(n),HF.delete(e.id));const i=KF.get(e.id);t&&i&&i.index===zF.length-1&&(aO.debug("[".concat(e.id,"] reset ICE restart policy")),KF.delete(e.id))}function XF(e,t,n){if(0===HF.size&&0===KF.size&&(Array.isArray(RA("RESTART_SEQUENCE"))&&RA("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const i=e[n];if(e.filter(e=>e===i).length!==t.filter(e=>e===i).length)return!1}return!0}(zF,RA("RESTART_SEQUENCE"))&&(zF=RA("RESTART_SEQUENCE").filter(e=>{var t;if(Pi(t=Object.values(gM)).call(t,e))return!0}),aO.debug("use reconnection policy from config distribution, queues: ".concat(zF.join(" => ")))),qF=RA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&_O().supportPCSetConfiguration),0===zF.length)return void n();let i,{index:s=0,type:r}=KF.get(e.id)||{};if(qF&&r===gM.RELAY)return void n();let a=r&&s>=zF.length-1;if(qF)r=gM.RELAY;else{if(a)return void n();r?(s++,r=zF[s]):(r=zF[0],s=0)}aO.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(r,", index: ").concat(s)),t(r),KF.set(e.id,{index:s,type:r}),i=window.setTimeout(()=>XF(e,t,n),WF),HF.set(e.id,i)}var JF;function QF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ZF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QF(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $F(e){var t,n,i,s=2;for("undefined"!=typeof Symbol&&(n=ZN,i=Symbol.iterator);s--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new eB(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function eB(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then(function(e){return{value:e,done:t}})}return eB=function(e){this.s=e,this.n=e.next},eB.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new eB(e)}let tB=(JF=class extends HR{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(bM.StateChange,t,this._state)}constructor(e,t){super(),uw(this,"isPlanB",void 0),uw(this,"store",void 0),uw(this,"statsUploader",void 0),uw(this,"connection",void 0),uw(this,"localTrackMap",new Map),uw(this,"remoteUserMap",new Map),uw(this,"localDataChannels",[]),uw(this,"remoteDataChannelMap",new Map),uw(this,"pendingLocalTracks",[]),uw(this,"pendingRemoteTracks",[]),uw(this,"pendingLocalDataChannels",[]),uw(this,"pendingRemoteDataChannels",[]),uw(this,"statsCollector",void 0),uw(this,"shouldForwardP2PCreation",void 0),uw(this,"iceFailedCount",0),uw(this,"dtlsFailedCount",0),uw(this,"mutex",void 0),uw(this,"_state",EM.Disconnected),uw(this,"_pcStatsUploadType",RA("NEW_ICE_RESTART")?_M.FIRST_CONNECTION:_M.OLD_FIRST_CONNECTION),uw(this,"_isStartRestartIce",!1),uw(this,"_restartTimer",void 0),uw(this,"_isTryConnecting",!1),uw(this,"_iceError",null),uw(this,"_forceTurn",!1),uw(this,"_isWaitPcToRePub",!1),uw(this,"handleMuteLocalTrack",async(e,t,n)=>{const i=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const i=this.filterTobeMutedTracks(e);if(0===i.length)return void t();const s=i.find(e=>"videoLowTrack"===e[0]);if(s){const e=s[1];this.store.enableInstantMuteRestore?(e.track._originMediaStreamTrack.enabled=!1,aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):e.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(i.map(e=>{let[,{id:t}]=e;return t}));const r=this.createMuteMessage(i);await aI(this,bM.RequestMuteLocal,r),t()}catch(e){n(e)}finally{i()}}),uw(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const i=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const i=this.filterTobeUnmutedTracks(e);if(0===i.length)return void t();const s=i.find(e=>"videoLowTrack"===e[0]);if(s){const t=s[1];if(this.store.enableInstantMuteRestore)t.track._originMediaStreamTrack.enabled=!0,aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(t.track._originMediaStreamTrack.stop(),!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&_O().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=RF(e,cI(this,bM.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t}));const r=this.createUnmuteMessage(i);await aI(this,bM.RequestUnmuteLocal,r),t()}catch(e){n(e)}finally{i()}}),uw(this,"handleUpdateVideoEncoder",async(e,t,n,i)=>{let s;i||(s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(vM.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:i,track:s}=n;await this.connection.updateSendParameters(i,s),await this.connection.updateEncoderConfig(i,s),this.emit(bM.UpdateVideoEncoder,s),t()}catch(e){n(e)}finally{var r;null===(r=s)||void 0===r||r()}}),uw(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(vM.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:i,track:s}=n;await this.connection.updateSendParameters(i,s),t()}catch(e){n(e)}finally{i()}}),uw(this,"handleReplaceMixingTrack",async(e,t,n,i)=>{if(!this.connection||this.state!==EM.Connected)return void t();const s=yF([e]);let r;aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(s.getTrackId(),"]")),"boolean"==typeof i&&i||(r=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,s),t()}catch(e){n(e)}finally{var a;null===(a=r)||void 0===a||a()}}),uw(this,"handleReplaceTrack",async(e,t,n,i)=>{let s;aO.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof i&&i||(s=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var r;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.connection||!n||this.state!==EM.Connected)return void t();if(await(null===(r=this.connection)||void 0===r?void 0:r.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===vM.LocalVideoTrack&&!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&_O().supportDualStreamEncoding){const t=this.localTrackMap.get(vM.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=s)||void 0===a||a()}}),uw(this,"handleGetRTCStats",e=>{e(this.statsCollector.getRTCStats())}),uw(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uw(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uw(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uw(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(this.store),this.bindStatsUploaderEvents(),this.mutex=new UI("P2PChannel-mutex",this.store.clientId),this.isPlanB=!_O().supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&SR(),this.shouldForwardP2PCreation=RA("FORWARD_P2P_CREATION")&&_O().supportPCSetConfiguration&&bR(),this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=EM.New,this._forceTurn=SF(e),aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=EF(this.store,e),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=RA("NEW_ICE_RESTART")?_M.FIRST_CONNECTION:_M.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===EM.Connected){if(this.connection instanceof NF&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),mO.reportApiInvoke(this.store.sessionId,{name:qR.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:YR.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(bM.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EM.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(e=>{var t;let[n]=e;return Pi(t=[vM.LocalVideoLowTrack,vM.LocalVideoTrack]).call(t,n)}),n=t.map(e=>{let[,{id:t}]=e;return t}),i=t.map(e=>{let[t]=e;return t});if(this.connection instanceof NF){if(mO.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Pi(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find(t=>Pi(e).call(e,t));t&&(this.store.codec=t,aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof NF&&"closed"!==this.connection.peerConnectionState&&Pi(e=[EM.New,EM.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==EM.Connected){if(this.state===EM.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(e=>{var t;Pi(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach(e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)}),e.map(e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId})))}publish(e,t,n){var i=this;return YN(function*(){const s=yield JN(i.mutex.lock("From P2PChannel.publish"));try{var r;const s=i.connection&&Pi(r=["disconnected","failed"]).call(r,i.connection.peerConnectionState);if(!i.connection||i.state!==EM.Connected||s){if(i.state===EM.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===i.pendingLocalTracks.indexOf(e));return i.pendingLocalTracks=i.pendingLocalTracks.concat(t),void(s&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,zV.markPublishStart(i.store.clientId,i.store.pubId);const a=i.filterTobePublishedTracks(e,t,n);if(0===a.length)return void(yield JN(i.tryToUnmuteAudio(e)));yield*QN($F(i.doPublish(i.connection,a)))}finally{s()}})()}doPublish(e,t){var n=this;return YN(function*(){t.forEach(e=>{let{track:t,type:i}=e;const s=Date.now();n.store.publish(t.getTrackId(),i===vM.LocalAudioTrack?"audio":"video",s)}),n.bindLocalTrackEvents(t);const i=t.map(e=>{let{track:t}=e;return t}),s=yield JN(e.send(i,n.store.codec,n.store.audioCodec)),r=(yield JN(s.next())).value,a=n.createGatewayPublishMessage(t,r);let o;try{o=yield a}catch(e){throw s.throw(e),(null==e?void 0:e.code)===RR.WS_ABORT&&t.forEach(e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)}),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(a,o,i),l=(yield JN(s.next(c))).value;if(n.state===EM.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");RA("ENABLE_VIDEO_SEI");const d=RA("ENABLE_ENCODED_TRANSFORM"),u=RA("ENABLE_AUDIO_METADATA");i.forEach(async e=>{const t=e.getRTCRtpTransceiver();if(!t||!d)return;const{interceptLocalVideoFrame:n,interceptLocalAudioFrame:i}=ZU();e.trackMediaType===fM.VIDEO?await n(t.sender,e):e.trackMediaType===fM.AUDIO&&await i(t.sender,{metadata:u?()=>{const t=e.metadata.shift();return t&&t.value}:void 0})}),t.forEach(e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)}),n.assignLocalTracks(t,l),n.statsUploader.startUploadOutboundStats(),t.forEach(e=>{let{track:t,type:i}=e;const s=Date.now();n.store.publish(t.getTrackId(),i===vM.LocalAudioTrack?"audio":"video",void 0,s)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof PP))return aO.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,s=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=dU(e,t)),n.maxFramerate=e.framerate?rU(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==vM.LocalVideoLowTrack||!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&_O().supportDualStreamEncoding)null!=s.scaleResolutionDownBy&&(i._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{const t=i._originMediaStreamTrack;if(!t.canvas)return aO.warn("[".concat(i.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=rU(t.width)),t.height&&(n.height=rU(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=yD(()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()},rU(t.framerate)))}(t,e)}null!=s.maxBitrate&&(i._encoderConfig.bitrateMax=s.maxBitrate/1e3),null!=s.maxFramerate&&(i._encoderConfig.frameRate&&"object"==typeof i._encoderConfig.frameRate?i._encoderConfig.frameRate.max=s.maxFramerate:i._encoderConfig.frameRate={max:s.maxFramerate}),aO.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return YN(function*(){if(!t.connection||t.state!==EM.Connected)return;const n=yield JN(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(vM.LocalVideoTrack);if(!n)throw new IR(RR.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(vM.LocalVideoLowTrack))throw new IR(RR.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(n.track,e),type:vM.LocalVideoLowTrack}];if(yield*QN($F(t.doPublish(t.connection,s))),n.track.muted||!n.track.enabled){var i;const e=null===(i=t.localTrackMap.get(vM.LocalVideoLowTrack))||void 0===i?void 0:i.id;void 0!==e&&(yield JN(t.connection.muteLocal([e])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rI(this,bM.RequestRePublish,this.pendingLocalTracks),this.emit(bM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(aO.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await rI(this,bM.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==fM.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==fM.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await rI(this,bM.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===fM.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(bM.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==EM.Connected)return void e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)});const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==EM.Connected)return void e.forEach(e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)});const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach(e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)}),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map(e=>e.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==EM.Connected)return;const e=this.localTrackMap.get(vM.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[vM.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==EM.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))});if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach(t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const i=this.pendingRemoteDataChannels.findIndex(n=>{let{user:i,id:s}=n;return i.uid===e.uid&&s===t.id});-1!==i&&this.pendingRemoteDataChannels.splice(i,1)}),n.map(e=>e.id)}async subscribe(e,t,n,i,s){var r;if(!this.connection||this.state!==EM.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(r=this.remoteUserMap.get(e))&&void 0!==r&&r.has(t))return;let a,o,c,l;const d=this.connection.getPreMedia(n);if(d)aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=d.transceiver,a=d.track,o=d.mid,l=d.player,d.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:d.firstVideoRender});else if(s){const n=s.find(e=>{let{stream_type:n}=e;return n===t});if(!n)throw new IR(RR.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const i=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof NF&&(c=i.transceiver),a=i.track,o=i.id}else{const s=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof NF&&(c=s.transceiver),a=s.track,o=s.id}if(t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new QP(a,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new JP(a,e.uid,e._uintid,this.store,l),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(HO.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(HO.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),l?e._videoTrack.once(HO.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(HO.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&RA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:n,interceptRemoteAudioFrame:i}=ZU();t==fM.VIDEO?await n(c.receiver,{onSei:RA("ENABLE_VIDEO_SEI")&&(t=>{var n;return null===(n=e._videoTrack)||void 0===n?void 0:n._onSei(t)})}):t==fM.AUDIO&&await i(c.receiver,{enableTopn:!!RA("ENABLE_AUDIO_TOPN"),enableMetadata:!!RA("ENABLE_AUDIO_METADATA"),enablePts:!!RA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(bM.AudioMetadata,e)},onPts:e=>{this.safeEmit(bM.AudioPts,e)}})}const u=this.remoteUserMap.get(e);u?u.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const h=this.pendingRemoteTracks.findIndex(n=>{let{user:i,kind:s}=n;return i.uid===e.uid&&t===s});-1!==h&&(this.pendingRemoteTracks.splice(h,1),this.emit(bM.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==EM.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(e=>{var t;let{user:n,mediaType:i}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(i))});const t=[],n=new Map;e.forEach(e=>{if(!this.connection)return;const i=this.connection.getPreMedia(e.ssrcId);if(i){const{track:t,mid:s,transceiver:r,player:a}=i;n.set(e.ssrcId,{track:t,id:s,transceiver:r,player:a})}else t.push(e)});const i=await this.connection.batchReceive(t.map(e=>{let{user:t,mediaType:n,ssrcId:i,rtxSsrcId:s}=e;return{kind:n,ssrcMsg:[{ssrcId:i,rtx:s}],mslabel:String(t._uintid)}}));t.forEach((e,t)=>{n.set(e.ssrcId,i[t])});for(const{user:s,mediaType:r,ssrcId:a}of e){const e=n.get(a);if(!e)return void aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(r,", ").concat(a));const{track:t,id:i,transceiver:o,player:c}=e;if(o&&RA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();r==fM.VIDEO?await e(o.receiver,{onSei:RA("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=s._videoTrack)||void 0===t?void 0:t._onSei(e)})}):r==fM.AUDIO&&await t(o.receiver,{enableTopn:!!RA("ENABLE_AUDIO_TOPN"),enableMetadata:!!RA("ENABLE_AUDIO_METADATA"),enablePts:!!RA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(bM.AudioMetadata,e)},onPts:e=>{this.safeEmit(bM.AudioPts,e)}})}if(r===fM.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(t):(s._audioTrack=new QP(t,s.uid,s._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),o&&s._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(t):(s._videoTrack=new JP(t,s.uid,s._uintid,this.store,c),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),o&&s._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(s,s._videoTrack)),RA("ENABLE_VIDEO_SEI")&&o){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();r==fM.VIDEO?await e(o.receiver,{onSei:e=>{var t;null===(t=s._videoTrack)||void 0===t||t._onSei(e)}}):r==fM.AUDIO&&await t(o.receiver)}const l=this.remoteUserMap.get(s);l?l.set(r,i):this.remoteUserMap.set(s,new Map([[r,i]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const d=this.pendingRemoteTracks.findIndex(e=>{let{user:t,kind:n}=e;return t.uid===s.uid&&r===n});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(bM.MediaReconnectEnd,s.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(n=>{let{user:i,kind:s}=n;return void 0!==t?i.uid===e.uid&&t===s:i.uid===e.uid});if(i.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.connection&&this.state===EM.Connected||n||i.forEach(t=>{let{kind:n}=t;var i;if(n===fM.AUDIO)null===(i=e._audioTrack)||void 0===i||i._destroy(),e._audioTrack=void 0;else if(n===fM.VIDEO){var s;null===(s=e._videoTrack)||void 0===s||s._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==EM.Connected)return;const s=this.filterTobeUnSubscribedTracks(e,t);if(0===s.length)return;await this.connection.stopReceiving(s.map(e=>{let[,{id:t}]=e;return t}));const r=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),s.forEach(e=>{let[t,{kind:i}]=e;var s,r;if(i===fM.VIDEO&&t._videoSSRC&&(null===(s=this.connection)||void 0===s||s.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),i===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0);else if(i===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),r}async unsubscribeDataChannel(e,t){if(t.forEach(e=>{const t=this.pendingRemoteDataChannels.findIndex(t=>t.id===e.id);-1!==t&&this.pendingRemoteDataChannels.splice(t,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach(e=>{e._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(e=>{i&&i.delete(e.id)}),i&&0===i.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(e=>e.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:s,mediaType:r}of e){const e=this.pendingRemoteTracks.filter(e=>{let{user:t,kind:n}=e;return void 0!==r?t.uid===s.uid&&r===n:t.uid===s.uid});e.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),t=t.concat(e)}if(!this.connection||this.state!==EM.Connected)return void t.forEach(e=>{let{user:t,kind:n}=e;var i;if(n===fM.AUDIO)null===(i=t._audioTrack)||void 0===i||i._destroy(),t._audioTrack=void 0;else if(n===fM.VIDEO){var s;null===(s=t._videoTrack)||void 0===s||s._destroy(),t._videoTrack=void 0}});const n=ss(e).call(e,(e,t)=>{let{user:n,mediaType:i}=t;const s=this.filterTobeUnSubscribedTracks(n,i);return e.concat(s)},[]);if(0===n.length)return;await this.connection.stopReceiving(n.map(e=>{let[,{id:t}]=e;return t}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach(e=>{let[t,{kind:n}]=e;var i,s;if(n===fM.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(s=t._videoTrack)||void 0===s||s._destroy(),t._videoTrack=void 0;else if(n===fM.AUDIO){var r;this.unbindRemoteTrackEvents(t._audioTrack),null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0}}),i}isPreSubScribe(e){return!(!this.connection||this.state!==EM.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==i&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(vM.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(vM.LocalAudioTrack);if((null==t?void 0:t.track)instanceof Wk){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==vM.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===vM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===vM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,s){if(e){const n=this.localTrackMap.get(vM.LocalAudioTrack),r=i?this.localTrackMap.get(vM.LocalVideoLowTrack):this.localTrackMap.get(vM.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==r?void 0:r.track.getTrackLabel(),screenshare:-1!==(null==r?void 0:r.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!n,video:!!r,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var r;n||(n=[]);const a=n.find(e=>e instanceof Fk),o=i?null===(r=this.localTrackMap.get(vM.LocalVideoTrack))||void 0===r?void 0:r.track:n.find(e=>e instanceof PP);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,i){const s=i===fM.VIDEO?n._videoSSRC:n._audioSSRC;s&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===fM.VIDEO,audio:i===fM.AUDIO,peerid:n.uid,subscribeRequestid:s,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,s),preSsrc:this.isPreSubScribe(s)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new UI("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(vM.LocalAudioTrack);if((null==e?void 0:e.track)instanceof Wk){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=EM.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(vM.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(vM.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof PP||t&&t.track instanceof Fk?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(vM.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.connection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=EM.Reconnecting,RA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case vM.LocalVideoTrack:Pi(t=i._hints).call(t,UO.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case vM.LocalAudioTrack:i instanceof Wk?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case vM.LocalVideoLowTrack:}}),this.emit(bM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(bM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach(e=>{this.setPendingRemoteDataChannel(t,e)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:s}=n;if((e instanceof ZV?e.uid:e)===i.uid&&s===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:s}=n;if((e instanceof ZV?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return YN(function*(){if(!t.connection||t.state!==EM.Connected)return;const n=yield JN(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield JN(t.connection.restartICE(e));const n=yield JN(i.next());if(n.done)return;const s=n.value,r=yield s;switch(bF(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case gM.UDP_TCP_RELAY:t._pcStatsUploadType=_M.UDP_TCP_RESTART;break;case gM.TCP_RELAY:t._pcStatsUploadType=_M.TCP_RESTART;break;case gM.RELAY:t._pcStatsUploadType=_M.RELAY_RESTART;break;default:t._pcStatsUploadType=_M.OLD_RESTART}t._isTryConnecting=!0,i.next(r)}catch(e){var s;null===(s=i)||void 0===s||s.throw(e)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(vM.LocalVideoTrack),n=this.localTrackMap.get(vM.LocalAudioTrack),i=e.videoSend.find(e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)),s=e.audioSend.find(e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId));if(!i||!s)return 1;const r=oI(this,bM.NeedSignalRTT),a=i?i.rttMs:void 0,o=s?s.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&r?(c+r)/2:c||r)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return GL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const s=i._audioSSRC,r=i._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===s),o=e.videoRecv.find(e=>e.ssrc===r);if(!a&&!o)return void(t+=1);const c=oI(this,bM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(aO.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==EM.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!i)return;const s=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:s}]),this.bindLocalTrackEvents([{track:t,type:s}]),i[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const e=i[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(s,e)}if(s===vM.LocalVideoTrack&&!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&_O().supportDualStreamEncoding){const t=this.localTrackMap.get(vM.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],s=this.getAllTracks();e=uI(e=e.filter(e=>-1===s.indexOf(e)));let r,a=!1;const o=this.localTrackMap.get(vM.LocalAudioTrack);for(const c of e){if(c instanceof PP&&(this.localTrackMap.has(vM.LocalVideoTrack)||a?new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:vM.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);i.push({track:e,type:vM.LocalVideoLowTrack})}if(c instanceof Fk)if(o){const e=o.track;if(e instanceof Wk)_F([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=yF([e,c]);aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else r instanceof Wk?(_F([c]),r.addAudioTrack(c)):r=r||!c._useAudioElement&&_O().webAudioMediaStreamDest&&!c._bypassWebAudio?yF(r?[c,r]:[c]):c}return r&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(r.getTrackId(),"]")),i.push({track:r,type:vM.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=uI(e=e.filter(e=>-1!==n.indexOf(e)));for(const i of e){if(i instanceof Fk){const e=this.localTrackMap.get(vM.LocalAudioTrack);if(!e)continue;e.track instanceof Wk?(e.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),0===e.track.trackList.length&&(t.push([vM.LocalAudioTrack,e]),e.track.close())):t.push([vM.LocalAudioTrack,e])}if(i instanceof PP){const e=this.localTrackMap.get(vM.LocalVideoTrack);if(!e)continue;t.push([vM.LocalVideoTrack,e]);const n=this.localTrackMap.get(vM.LocalVideoLowTrack);n&&t.push([vM.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=uI(e)).filter(e=>-1===this.localDataChannels.findIndex(t=>t.id===e.id))}filterTobeUnpublishedDataChannels(e){return(e=(e=uI(e)).filter(e=>-1!==this.localDataChannels.indexOf(e))).filter(e=>e._originDataChannel)}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case vM.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case vM.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case vM.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Wk?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case vM.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.GET_RTC_STATS,this.handleGetRTCStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case vM.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case vM.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Wk?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var i;let s,r,{track:a,type:o}=e;switch(o){case vM.LocalAudioTrack:s=iM.Audio,r={dtx:a instanceof Bk&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case vM.LocalVideoTrack:s=Pi(i=a._hints).call(i,UO.SCREEN_TRACK)?iM.Screen:iM.High,r=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()});break;case vM.LocalVideoLowTrack:s=iM.Low,r=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()})}return{stream_type:s,attributes:r,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[i,{track:s,ssrcs:r,id:a}]=e;switch(i){case vM.LocalVideoTrack:n=Pi(t=s._hints).call(t,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalAudioTrack:n=iM.Audio;break;case vM.LocalVideoLowTrack:n=iM.Low}return{stream_type:n,ssrcs:r,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:i,type:s}=e;this.localTrackMap.set(s,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(bM.PeerConnectionStateChange,t),"connecting"===t&&e instanceof NF&&!nR()&&RA("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{"connecting"===t&&e.extendCandidate()},RA("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof NF&&YF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=_M.DISCONNECTED_OR_FAILED,"CONNECTED"===oI(this,bM.QueryClientConnectionState)&&this._isWaitPcToRePub)){const e=this.pendingLocalTracks.map(e=>e.getTrackId()),t=this.pendingLocalDataChannels.map(e=>"dc_".concat(e.id));mO.reportApiInvoke(this.store.sessionId,{name:qR.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:YR.TRACER}).onSuccess(),this.republish()}if(RA("NEW_ICE_RESTART")&&e instanceof NF&&!nR()&&!this._forceTurn){if(Pi(yM).call(yM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{bF(e)&&(aO.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===oI(this,bM.QueryClientConnectionState)&&this.emit(bM.RequestRestartICE,t))},n=()=>{bF(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),aO.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{XF(e,t,n)},800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&RA("ICE_RESTART")&&"CONNECTED"===oI(this,bM.QueryClientConnectionState)&&this.emit(bM.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);"failed"===t&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YR.TRACER}).onSuccess(),this.emit(bM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(i=n.audioTrack)||void 0===i||i.emit(HO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{var i;const s=Array.from(XA(i=this.remoteUserMap).call(i)).find(t=>t._videoSSRC===e);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoRender=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(n))},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstReceived:Date.now()}),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,i="relay"===t.candidateType;"unknown"!==t.candidateType&&n===i||this.emit(bM.ConnectionTypeChange,n),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return ZF(ZF({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){e instanceof NF&&function(e){KF.delete(e.id),YF(e)}(e),e.close(),this.emit(bM.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(vM.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Wk)return n.track.isActive||t.push([vM.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(i&&(t.push(i),i[0]===vM.LocalVideoTrack)){const e=this.localTrackMap.get(vM.LocalVideoLowTrack);e&&t.push([vM.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(vM.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Wk)return n.track.isActive&&t.push([vM.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(i)if(i[0]===vM.LocalVideoTrack){t.push(i);const e=this.localTrackMap.get(vM.LocalVideoLowTrack);e&&t.push([vM.LocalVideoLowTrack,e])}else t.push(i);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[i,{track:s,ssrcs:r,id:a}]=e;switch(i){case vM.LocalAudioTrack:n=iM.Audio;break;case vM.LocalVideoTrack:n=Pi(t=s._hints).call(t,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalVideoLowTrack:n=iM.Low}return{stream_type:n,ssrcs:r,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[i,{track:s,ssrcs:r,id:a}]=e;switch(i){case vM.LocalAudioTrack:n=iM.Audio;break;case vM.LocalVideoTrack:n=Pi(t=s._hints).call(t,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalVideoLowTrack:n=iM.Low}return{stream_type:n,ssrcs:r,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const s=i.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach(t=>{let[i,s]=t;n.push([e,{kind:i,id:s}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(t=>{var i;null!==(i=this.remoteDataChannelMap.get(e))&&void 0!==i&&i.has(t.id)&&n.push(t)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:i,id:s}]=e;switch(i){case fM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:n._videoSSRC}));case fM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(e=>{let[n,{kind:i}]=e;if(t.has(n)){let e=t.get(n);i===fM.VIDEO?e|=aM.Video:e|=aM.Audio,t.set(n,e)}else i===fM.VIDEO?t.set(n,aM.Video):t.set(n,aM.Audio)}),{users:Array.from(t.entries()).map(e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}})}}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const i=this.remoteUserMap.get(t);i&&(i.delete(n),0===Array.from(i.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(vM.LocalVideoTrack),n=this.localTrackMap.get(vM.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)}))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}isPreallocation(){return this.connection instanceof NF&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof NF&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((e,i)=>{var s;let{stream_type:r}=e;const a=null===(s=t.find(e=>{let{stream_type:t}=e;return r===t}))||void 0===s?void 0:s.attributes;if(a&&RA("DISABLE_SCREEN_SHARE_REMB")){const e=n[i]._hints;(Pi(e).call(e,UO.SCREEN_TRACK)||Pi(e).call(e,UO.SCREEN_LOW_TRACK))&&(a.remb=!1,aO.debug("disable remb for screen share, hints:",e))}return a})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Fk){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(0===i.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t})));const s=this.createUnmuteMessage(i);return void await aI(this,bM.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(bM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(bM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await TI(BI(this.dtlsFailedCount,FI)),this.emit(bM.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await rI(this,bM.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(bM.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(vM.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof PP)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof PP).length>1)throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Fk).length>1&&(e.some(e=>e instanceof Fk&&e._bypassWebAudio)||!_O().webAudioMediaStreamDest))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof PP&&this.pendingLocalTracks.some(e=>e instanceof PP))throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fk&&this.pendingLocalTracks.some(e=>e instanceof Fk)&&(!_O().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Fk&&e._bypassWebAudio)))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&_O().supportDualStreamEncoding,s=ZF(ZF({},{width:160,height:120,framerate:15,bitrate:50}),t);let r;r=i?e._mediaStreamTrack.clone():RF(e,s);const a=wI(8,"track-low-"),o=new PP(r,ZF(ZF({},i&&{scaleResolutionDownBy:dU(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,a);return o.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),o._hints.push(UO.LOW_STREAM),Pi(n=e._hints).call(n,UO.SCREEN_TRACK)&&o._hints.push(UO.SCREEN_LOW_TRACK),e.on("sei-to-send",e=>{o.emit("sei-to-send",e)}),e.addListener(MO.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof NF){var s,r,a,o;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();mO.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:null!==(s=null==h?void 0:h.protocol)&&void 0!==s?s:"",selectedLocalCandidateType:null!==(r=h.candidateType)&&void 0!==r?r:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(o=p.candidateType)&&void 0!==o?o:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(t=>t.userId===e.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:s}=n;if(i&&s)return;const{subscribeEnd:r,firstPreRender:a,peerPublishDuration:o,peerPubStatusMs:c}=n;let{firstRender:l=0}=n;if(r&&(l||a)&&o&&c){n.isInternalUpload=!0;const{playEnd:i}=n;i&&(n.isExternalUpload=!0);const{firstPreRender:s=0}=n;l=s||l;const a=e.videoTrack,d={peer:e._uintid,width:(null==a?void 0:a._videoWidth)||0,height:(null==a?void 0:a._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:o,peerPubStatusMs:c,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:s||0,firstRender:i?Math.max(l,i):Math.max(l,r),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:bO(this.store)};mO.firstXLAPeerFirstVideoFrame(this.store.sessionId,d)}}reportVideoFirstFrameDecoded(e,t,n,i){var s;const r=Array.from(XA(s=this.remoteUserMap).call(s)).find(t=>t._videoSSRC===e);if(r){i||this.store.subscribe(r.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,a=s.subscribe.find(e=>e.userId===r.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:r._uintid,videowidth:t,videoheight:n,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:i?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const s=i.get(t);if(!s)return!1;const r=await this.connection.getRemoteSSRC(s);return void 0!==r&&r!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===vM.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VO.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ij(JF.prototype,"startP2PConnection",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"startP2PConnection"),JF.prototype),Ij(JF.prototype,"connect",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"connect"),JF.prototype),Ij(JF.prototype,"updateRemoteRTPCapabilities",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"updateRemoteRTPCapabilities"),JF.prototype),Ij(JF.prototype,"publishDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"publishDataChannel"),JF.prototype),Ij(JF.prototype,"unpublish",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublish"),JF.prototype),Ij(JF.prototype,"unpublishDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishDataChannel"),JF.prototype),Ij(JF.prototype,"unpublishLowStream",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishLowStream"),JF.prototype),Ij(JF.prototype,"subscribeDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribeDataChannel"),JF.prototype),Ij(JF.prototype,"subscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribe"),JF.prototype),Ij(JF.prototype,"massSubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"massSubscribe"),JF.prototype),Ij(JF.prototype,"unsubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribe"),JF.prototype),Ij(JF.prototype,"unsubscribeDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribeDataChannel"),JF.prototype),Ij(JF.prototype,"massUnsubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"massUnsubscribe"),JF.prototype),Ij(JF.prototype,"muteRemote",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"muteRemote"),JF.prototype),Ij(JF.prototype,"unmuteRemote",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unmuteRemote"),JF.prototype),Ij(JF.prototype,"hasRemoteMediaWithLock",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"hasRemoteMediaWithLock"),JF.prototype),Ij(JF.prototype,"disconnectForReconnect",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"disconnectForReconnect"),JF.prototype),Ij(JF.prototype,"updateBitrateLimit",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"updateBitrateLimit"),JF.prototype),Ij(JF.prototype,"remoteMediaSsrcChanged",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"remoteMediaSsrcChanged"),JF.prototype),JF);function nB(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return await i.apply(this,r)}finally{n()}},n}function iB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function sB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iB(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const rB=Date.now(),aB=20,oB=new Map,cB=new Map;async function lB(e){const t=oB.get(e),n=Array.isArray(t)&&t[t.length-1],i=cB.get(e);if(!n)return void(i.isSyncing=!1);const s={uid:n.uid,payload:n.payload};0===i.firstRecvTs&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const r=n.sendTs-i.firstSendTs,a=r-(Date.now()-i.firstRecvTs);a>0&&(i.firstRecvTs=Date.now()-r);let o=n.mediaDelay+a;o<=0?(t.pop(),dB(n.context,s),o=0):o=Math.min(o,aB),setTimeout(()=>t.length&&lB(e),o)}function dB(e,t){e.safeEmit(tI.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function uB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return dB(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),s=oB.get(i)||[],r=s.findIndex(t=>e.sendTs>=t.sendTs),a=sB(sB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===r?s.push(a):s.splice(r,0,a),oB.set(i,s);let o=!1;var c;cB.has(i)?o=!(null===(c=cB.get(i))||void 0===c||!c.isSyncing):cB.set(i,{isSyncing:o,firstRecvTs:0,firstSendTs:0}),o||lB(i)}const hB=qC().name;function pB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function mB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pB(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const fB="websdk_ng_cache_parameter",gB=RA("MAX_PRELOAD_ASYNC_LENGTH"),_B=1e4,yB=new Map,vB=[];let EB=null,bB=0,SB=0;const xB=new Map,TB=function(e,t){const n=[];let i=0;const s=async()=>{const e=n.shift();e&&await e(),n.length>0&&i<t?s():i--};return async function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return new np(async(r,o)=>{n.push(async()=>{try{const t=await e(...a);r(t)}catch(e){o(e)}}),i<t&&(i++,s())})}}(NB,gB),wB=jC.CancelToken.source();async function NB(e,t,n,i,s,r){try{if(!RA("ENABLE_PRELOAD"))return;if(!_O().supportWebCrypto)return void gI(()=>{aO.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&null!==n)throw new IR(RR.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&PR(n,"token",1,2047),PR(e,"appid",1,2047),Gj(t),i&&Wj(i);const a=NI();aO.debug("preload channel ".concat(t,", uid is ").concat(i));const o={appId:e,cname:t,token:n||e,uid:"string"!=typeof i?i:null,sid:a,proxyServer:s};let c,l;"string"==typeof i?(o.stringUid=i,[l,c]=await np.all([LV(i,{sid:a,appId:e},wB.token),MV(mB(mB({},o),{},{token:n||e,uid:0}),wB.token)]),o.uid=l.uid,c.gatewayInfo.uid=o.uid,c.gatewayInfo.res.uid=o.uid):(r&&(o.stringUid=r),c=await MV(o,wB.token));const d={sid:a,appId:e,cname:t,token:n||e,uid:o.stringUid||i,intUid:o.uid||c.gatewayInfo.uid,stringUid:o.stringUid,ts:Date.now(),sua:l,ap:c};await async function(e){let t;try{e.uid&&RB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=PB(e),i=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",vI(t),"AES-GCM",!1,["encrypt"]),i=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,_I(window.btoa(JSON.stringify(e))));return yI(new Uint8Array(i))}catch(e){return}}(e,e.token||e.appId);if(!i)return;t=DB(fB);const s=t?JSON.parse(t):[];s.push({[n]:i}),s.length>RA("AP_CACHE_NUM")&&s.shift(),kB(fB,JSON.stringify(s))}catch(e){aO.warn("Error caching server parameters:",e.message),kB(fB,"")}}(d),bB++}catch(e){throw SB++,function(e){EB||(EB=window.setTimeout(()=>{let t="";xB.forEach((e,n)=>{t+="".concat(n,": ").concat(e," ;")}),mO.reportApiInvoke(null,{name:qR.PRELOAD,options:{success:bB,failed:SB,err:t}}).onError(e),bB=0,SB=0,xB.clear(),EB=null},_B));const t=xB.get(e.code)||0;xB.set(e.code,t+1)}(e),e}}async function CB(e){try{if(RA("AP_REQUEST_DETAIL")||RA("ENABLE_ROLE_SELECT_EDGE"))return;const t=RB(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",vI(t),"AES-GCM",!1,["decrypt"]),i=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,_I(e));return JSON.parse(window.atob(yI(new Uint8Array(i))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<RA("AP_CACHE_LIFETIME"))return n}catch(e){aO.warn("Error get preloadInfo",e.message)}}function RB(e){let t;try{if(t=DB(fB),!t)return;const n=JSON.parse(t),i=PB(e),s=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,e=>i in e);if(-1===s)return;const r=n.splice(s,1)[0];return kB(fB,JSON.stringify(n)),r[i]}catch(e){aO.warn("Error delete preload info: ".concat(t),e.message),kB(fB,"")}}function IB(e){if(e){let t=yB.get(e);t&&(window.clearTimeout(t),t=null,yB.delete(e)),Pi(vB).call(vB,e)||"disabled"!==e.cloudProxyServer||vB.push(e)}if(yB.size<RA("AP_CACHE_NUM")&&vB.length>0){const e=vB.shift();yB.set(e,window.setTimeout(async()=>{const{appId:t,cname:n,token:i,stringUid:s,uid:r,proxyServer:a}=e;try{await TB(t,n,i,r,a,s),yB.has(e)&&IB(e)}catch(t){aO.warn("update preload failed",t.message),AB(e)}},RA("AP_UPDATE_INTERVAL")))}}function AB(e){const t=vB.indexOf(e);-1!==t&&vB.splice(t,1);let n=yB.get(e);n&&(window.clearTimeout(n),n=null,yB.delete(e),IB())}function OB(e,t){const n=e.sua,i=e.ap;t&&n&&mO.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),mO.reportResourceTiming(e.ap.url,e.sid),mO.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(e=>e.ip).join(","),eventType:"disabled",unilbsServerIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK].toString()}),mO.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function DB(e){return window.atob(window.localStorage.getItem(e)||"")}function kB(e,t){window.localStorage.setItem(e,window.btoa(t))}function PB(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),LI(t)}function LB(e){let t=function(){const e=VB.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(JB(t,10),zB(t,n));let i=e.cid;void 0!==i&&(JB(t,16),JB(t,i));let s=e.cname;void 0!==s&&(JB(t,26),zB(t,s));let r=e.deviceId;void 0!==r&&(JB(t,34),zB(t,r));let a=e.elapse;void 0!==a&&(JB(t,40),ZB(t,a));let o=e.fileSize;void 0!==o&&(JB(t,48),ZB(t,UB(o)));let c=e.height;void 0!==c&&(JB(t,56),ZB(t,UB(c)));let l=e.jpg;void 0!==l&&(JB(t,66),JB(t,l.length),HB(t,l));let d=e.networkType;void 0!==d&&(JB(t,72),ZB(t,UB(d)));let u=e.osType;void 0!==u&&(JB(t,80),ZB(t,UB(u)));let h=e.requestId;void 0!==h&&(JB(t,90),zB(t,h));let p=e.sdkVersion;void 0!==p&&(JB(t,98),zB(t,p));let m=e.sequence;void 0!==m&&(JB(t,104),ZB(t,UB(m)));let f=e.sid;void 0!==f&&(JB(t,114),zB(t,f));let g=e.timestamp;void 0!==g&&(JB(t,120),ZB(t,g));let _=e.uid;void 0!==_&&(JB(t,128),JB(t,_));let y=e.vid;void 0!==y&&(JB(t,136),JB(t,y));let v=e.width;void 0!==v&&(JB(t,144),ZB(t,UB(v)));let E=e.service;void 0!==E&&(JB(t,152),JB(t,E));let b=e.callbackData;void 0!==b&&(JB(t,162),JB(t,b.length),HB(t,b));let S=e.ticket;void 0!==S&&(JB(t,170),zB(t,S));let x=e.vendorConfigs;void 0!==x&&(JB(t,178),zB(t,x))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function jB(e){return function(e){let t={};e:for(;!BB(e);){let n=XB(e);switch(n>>>3){case 0:break e;case 1:t.code=XB(e);break;case 2:t.msg=KB(e,XB(e));break;case 3:t.requestId=KB(e,XB(e));break;case 4:t.timestamp=QB(e,!1);break;default:MB(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function MB(e,t){switch(t){case 0:for(;128&qB(e););break;case 2:FB(e,XB(e));break;case 5:FB(e,4);break;case 1:FB(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function UB(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let VB=[];function FB(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function BB(e){return e.offset>=e.limit}function GB(e,t){let n=e.bytes,i=e.offset,s=e.limit,r=i+t;if(r>n.length){let t=new Uint8Array(2*r);t.set(n),e.bytes=t}return e.offset=r,r>s&&(e.limit=r),i}function WB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function HB(e,t){let n=GB(e,t.length);e.bytes.set(t,n)}function KB(e,t){let n=WB(e,t),i=String.fromCharCode,s=e.bytes,r="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=s[o+n];0==(128&u)?a+=i(u):192==(224&u)?o+1>=t?a+=r:(e=s[o+n+1],128!=(192&e)?a+=r:(d=(31&u)<<6|63&e,d<128?a+=r:(a+=i(d),o++))):224==(240&u)?o+2>=t?a+=r:(e=s[o+n+1],c=s[o+n+2],32896!=(49344&(e|c<<8))?a+=r:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=r:(a+=i(d),o+=2))):240==(248&u)?o+3>=t?a+=r:(e=s[o+n+1],c=s[o+n+2],l=s[o+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=r:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=r:(d-=65536,a+=i(55296+(d>>10),56320+(1023&d)),o+=3))):a+=r}return a}function zB(e,t){let n=t.length,i=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),i+=e<128?1:e<2048?2:e<65536?3:4}JB(e,i);let s=GB(e,i),r=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?r[s++]=e:(e<2048?r[s++]=e>>6&31|192:(e<65536?r[s++]=e>>12&15|224:(r[s++]=e>>18&7|240,r[s++]=e>>12&63|128),r[s++]=e>>6&63|128),r[s++]=63&e|128)}}function qB(e){return e.bytes[WB(e,1)]}function YB(e,t){let n=GB(e,1);e.bytes[n]=t}function XB(e){let t,n=0,i=0;do{t=qB(e),n<32&&(i|=(127&t)<<n),n+=7}while(128&t);return i}function JB(e,t){for(t>>>=0;t>=128;)YB(e,127&t|128),t>>>=7;YB(e,t)}function QB(e,t){let n,i=0,s=0,r=0;return n=qB(e),i=127&n,128&n&&(n=qB(e),i|=(127&n)<<7,128&n&&(n=qB(e),i|=(127&n)<<14,128&n&&(n=qB(e),i|=(127&n)<<21,128&n&&(n=qB(e),s=127&n,128&n&&(n=qB(e),s|=(127&n)<<7,128&n&&(n=qB(e),s|=(127&n)<<14,128&n&&(n=qB(e),s|=(127&n)<<21,128&n&&(n=qB(e),r=127&n,128&n&&(n=qB(e),r|=(127&n)<<7))))))))),{low:i|s<<28,high:s>>>4|r<<24,unsigned:t}}function ZB(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,r=0===s?0===i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,a=GB(e,r),o=e.bytes;switch(r){case 10:o[a+9]=s>>>7&1;case 9:o[a+8]=9!==r?128|s:127&s;case 8:o[a+7]=8!==r?i>>>21|128:i>>>21&127;case 7:o[a+6]=7!==r?i>>>14|128:i>>>14&127;case 6:o[a+5]=6!==r?i>>>7|128:i>>>7&127;case 5:o[a+4]=5!==r?128|i:127&i;case 4:o[a+3]=4!==r?n>>>21|128:n>>>21&127;case 3:o[a+2]=3!==r?n>>>14|128:n>>>14&127;case 2:o[a+1]=2!==r?n>>>7|128:n>>>7&127;case 1:o[a]=1!==r?128|n:127&n}}const $B={},eG={},tG=4294967296,nG=tG*tG,iG=nG/2,sG=lG(0,!0),rG=lG(0),aG=dG(0,-2147483648,!1),oG=dG(-1,2147483647,!1),cG=dG(-1,-1,!0);function lG(e,t){let n,i,s;return t?(s=0<=(e>>>=0)&&e<256)&&(i=eG[e],i)?i:(n=dG(e,0,!0),s&&(eG[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(i=$B[e],i)?i:(n=dG(e,e<0?-1:0,!1),s&&($B[e]=n),n)}function dG(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function uG(e,t){if(isNaN(e))return t?sG:rG;if(t){if(e<0)return sG;if(e>=nG)return cG}else{if(e<=-iG)return aG;if(e+1>=iG)return oG}return e<0?t?sG:rG:dG(e%tG|0,e/tG|0,t)}function hG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}class pG extends HR{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(RM.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),uw(this,"name","AgoraRTCImageModeration"),uw(this,"_connectionState",CM.CONNECTING),uw(this,"_sequence",0),uw(this,"_moderationStartTime",void 0),uw(this,"_workerConnection",void 0),uw(this,"_workerMessageLengthLimit",void 0),uw(this,"_qualityRatio",void 0),uw(this,"_connectInfo",void 0),uw(this,"_cancelTokenSource",jC.CancelToken.source()),uw(this,"_retryConfig",void 0),uw(this,"_moderationInterval",void 0),uw(this,"_moderationTimer",null),uw(this,"_moderationMode",1),uw(this,"_quality",1),uw(this,"_qualityTimer",null),uw(this,"_ticket",void 0),uw(this,"_moderationIntervalMinimum",void 0),uw(this,"_uploadFailedNum",0),uw(this,"_uploadNum",0),uw(this,"_uploadTimer",null),uw(this,"_extraInfo",void 0),uw(this,"_vendor",""),uw(this,"_encoder",new TextEncoder),uw(this,"_moderationId",void 0),uw(this,"inspectImage",()=>{if(this.connectionState!==CM.CONNECTED)throw new fO(RR.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===CM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=wI(5,"image-moderation-"),this._workerMessageLengthLimit=RA("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=RA("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=RA("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new JM("worker-"+this._moderationId,FI),this.on(RM.STATE_CHANGE,(e,t)=>{aO.debug("[".concat(this._moderationId,"] Moderation operation :").concat(IM[e]," ").concat(t||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(RM.STATE_CHANGE,IM.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np((i,s)=>{this.on(RM.CONNECTION_STATE_CHANGE,(e,t)=>{e===CM.CONNECTED&&i()}),this.requestAP(e,n,t).then(e=>{this.connectWorker(e)}).catch(e=>{s(e)})})}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),aO.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===CM.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const i=RA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),s=await function(e,t,n,i){let{appId:s,areaCode:r,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="moderation_plugin",u={service_name:d,json_body:JSON.stringify({appId:s,areaCode:r,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,appToken:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GI(async()=>{h=Date.now();const e=await rV(m,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers.some(e=>!!e.wss)){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const i=RA("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(i,":").concat(n,"/moderation")}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}},(t,n)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==RR.OPERATION_ABORTED&&t.code!==RR.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)),i)}(i,e,t,n);this.emit(RM.STATE_CHANGE,IM.AP_CONNECTED);const{addressList:r,ticket:a}=s;return this._ticket=a,r}async connectWorker(e){this.emit(RM.STATE_CHANGE,IM.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Bj.CONNECTED,async()=>{this.emit(RM.STATE_CHANGE,IM.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=CM.CONNECTED}),this._workerConnection.on(Bj.CLOSED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(Bj.FAILED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(Bj.RECONNECTING,()=>{this.connectionState=this.connectionState===CM.CONNECTED?CM.RECONNECTING:CM.CONNECTING}),this._workerConnection.on(Bj.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const t=jB(new Uint8Array(e.data));RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,aO.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{mO.reportApiInvoke(this._connectInfo.sid||null,{name:qR.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:YR.TRACER}).onError(new fO(RR.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},RA("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else aO.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Bj.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this._workerConnection.on(Bj.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=oI(this,RM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:i,cid:s,vid:r,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await QD(l,n,i),u=this._sequence+"-"+s+"-"+o+"-"+c+"-"+wI(12,""),h={appId:n,cid:s,cname:i,deviceId:"",elapse:pG.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this._sequence,sid:a,timestamp:uG(c),uid:o,vid:r,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=LB(h);if(p.byteLength<this._workerMessageLengthLimit){if(RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hG(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:i,cid:s,vid:r,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=jC.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=CM.CLOSED,this.emit(RM.STATE_CHANGE,IM.CLOSED)}}function mG(e){if(DR(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(RR.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new fO(RR.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fG={name:"ImageModeration",create:function(e){let{config:t}=e;return mG(t),new pG(t)}};var gG,_G,yG,vG,EG,bG,SG,xG,TG,wG,NG,CG,RG,IG,AG,OG,DG,kG,PG,LG,jG,MG,UG,VG,FG,BG,GG,WG,HG,KG,zG,qG,YG,XG,JG,QG,ZG,$G,eW,tW,nW,iW;function sW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function rW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sW(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}UI.setLogger(aO);let aW=(gG=pO(),_G=pO({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof uD))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),yG=pO({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==KO.DATA?(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())):[t.getChannelId()])}),vG=pO({argsMap:(e,t,n,i)=>["object"==typeof t?t.uid:t,n,i]}),EG=pO({argsMap:(e,t,n)=>[t,n]}),bG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]})}),SG=pO({argsMap:(e,t,n,i)=>["object"==typeof t?t.uid:t,n,i]}),xG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}})}),TG=pO(),wG=pO(),NG=pO(),CG=pO(),RG=pO(),IG=pO(),AG=pO(),OG=pO(),DG=pO(),kG=pO(),PG=pO(),LG=pO(),jG=pO(),MG=pO(),UG=pO(),VG=pO({argsMap:(e,t)=>[t]}),FG=pO(),BG=pO(),GG=pO(),WG=pO(),HG=pO(),KG=pO(),zG=pO(),qG=pO(),YG=pO({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),XG=pO(),JG=pO(),QG=pO(),ZG=pO(),$G=pO(),eW=pO(),tW=pO({reportResult:!0}),nW=pO(),iW=class extends HR{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),uw(this,"store",void 0),uw(this,"_uid",void 0),uw(this,"_channelName",void 0),uw(this,"_uintUid",void 0),uw(this,"_users",[]),uw(this,"_config",void 0),uw(this,"_clientId",void 0),uw(this,"_appId",void 0),uw(this,"_sessionId",null),uw(this,"_key",void 0),uw(this,"_rtmConfig",{}),uw(this,"_joinInfo",void 0),uw(this,"_gateway",void 0),uw(this,"_statsCollector",void 0),uw(this,"_configDistribute",void 0),uw(this,"_leaveMutex",void 0),uw(this,"_publishMutex",void 0),uw(this,"_renewTokenMutex",void 0),uw(this,"_subscribeMutex",void 0),uw(this,"_encryptionMode","none"),uw(this,"_encryptionSecret",null),uw(this,"_encryptionSalt",null),uw(this,"_encryptDataStream",!1),uw(this,"_encryptDataStreamKey",null),uw(this,"_encryptDataStreamIv",null),uw(this,"_proxyServer",void 0),uw(this,"_turnServer",{servers:[],mode:"auto"}),uw(this,"_cloudProxyServerMode","disabled"),uw(this,"_isDualStreamEnabled",!1),uw(this,"_defaultStreamFallbackType",void 0),uw(this,"_lowStreamParameter",void 0),uw(this,"_streamFallbackTypeCacheMap",new Map),uw(this,"_remoteStreamTypeCacheMap",new Map),uw(this,"_axiosCancelSource",jC.CancelToken.source()),uw(this,"_audioVolumeIndicationInterval",void 0),uw(this,"_networkQualityInterval",void 0),uw(this,"_userOfflineTimeout",void 0),uw(this,"_streamRemovedTimeout",void 0),uw(this,"_liveTranscodeStreamingClient",void 0),uw(this,"_liveRawStreamingClient",void 0),uw(this,"_channelMediaRelayClient",void 0),uw(this,"_networkQualitySensitivity","normal"),uw(this,"_p2pChannel",void 0),uw(this,"_useLocalAccessPoint",!1),uw(this,"_setLocalAPVersion",void 0),uw(this,"_joinAndNotLeaveYet",!1),uw(this,"_numberOfJoinCount",0),uw(this,"_joinResponse",null),uw(this,"_remoteDefaultVideoStreamType",void 0),uw(this,"_inspect",void 0),uw(this,"_moderation",void 0),uw(this,"_license",void 0),uw(this,"_pendingPublishedUsers",[]),uw(this,"ntpAlignErrorCount",0),uw(this,"remoteInboundOffset",0),uw(this,"_peerConnectionState",void 0),uw(this,"_handleLocalTrackEnable",(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),uw(this,"_handleLocalTrackDisable",(e,t,n)=>{this.unpublish(e).then(t).catch(n)}),uw(this,"_handleUserOnline",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&KL(e.uid,this.channelName))return void aO.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&aO.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find(t=>t.uid===e.uid);if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(tI.USER_JOINED,t));else{const t=new ZV(e.uid,e.uint_id||e.uid);this._users.push(t),aO.debug("[".concat(this._clientId,"] user online"),e.uid),this.store.firstVideoFrameDecoded(t.uid,{userJoinNotify:Date.now()}),this.safeEmit(tI.USER_JOINED,t)}}),uw(this,"_handleUserOffline",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&KL(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:dI(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),aO.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(tI.USER_LEAVED,t,e.reason))}),uw(this,"_handleAddAudioOrVideoStream",(e,t,n,i,s,r,a,o)=>{if(RA("BLOCK_LOCAL_CLIENT")&&KL(t,this.channelName))return;const c=this._users.find(e=>e.uid===t);if(!c)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now()),"video"===e&&this.store.firstVideoFrameDecoded(c.uid,{videoAddNotify:Date.now()});const l="audio"===e?c.hasAudio:c.hasVideo;if(c._uintid||(c._uintid=r||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==n&&(c._audioSSRC=n),void 0!==i&&(c._cname=i),a&&(c._audioOrtc=a)):(c._video_added_=!0,void 0!==n&&(c._videoSSRC=n),void 0!==i&&(c._cname=i),void 0!==o&&(c._rtxSsrcId=o),a&&(c._videoOrtc=a)),("audio"===e?c.hasAudio:c.hasVideo)&&!l&&(aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(e)),this.safeEmit(tI.USER_PUBLISHED,c,e)),"video"===e?mO.onGatewayStream(this._sessionId,dO.ON_ADD_VIDEO_STREAM,uO.ON_ADD_VIDEO_STREAM,{peer:r||t,ssrc:c._videoSSRC}):mO.onGatewayStream(this._sessionId,dO.ON_ADD_AUDIO_STREAM,uO.ON_ADD_AUDIO_STREAM,{peer:r||t,ssrc:c._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(c,e,n).then(t=>{if(t&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tB))return this._p2pChannel.unsubscribe(c,e,!0).then(()=>this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(c,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})),"video"===e&&!$C()&&!iR()){const e=this._getEncodingName(s);(null==e?void 0:e.toLocaleLowerCase())==DA.av1&&OV().then(t=>{t||this._gateway.downgradeCodec(e)})}}),uw(this,"_handleRemoveStream",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&KL(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);if(!t)return void aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));aO.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"audio"),aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof tB&&this._p2pChannel.unsubscribe(t).then(e=>{if(e)return this._gateway.unsubscribe(e,t.uid)}),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),mO.onGatewayStream(this._sessionId,dO.ON_REMOVE_STREAM,uO.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()}),uw(this,"_handleSetStreamLocalEnable",(e,t,n)=>{if(RA("BLOCK_LOCAL_CLIENT")&&KL(t,this.channelName))return;const i=this._users.find(e=>e.uid===t);if(!i)return void aO.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));aO.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const s="audio"===e?i.hasAudio:i.hasVideo;if("audio"===e){i._trust_audio_enabled_state_=!0;const e=i._audio_enabled_;if(i._audio_enabled_=n,i._audio_enabled_===e)return;{const e=i._audio_enabled_?"enable-local-audio":"disable-local-audio";aO.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tI.USER_INFO_UPDATED,t,e)}}else{i._trust_video_enabled_state_=!0;const e=i._video_enabled_;if(i._video_enabled_=n,i._video_enabled_===e)return;{const e=i._video_enabled_?"enable-local-video":"disable-local-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tI.USER_INFO_UPDATED,t,e)}}const r="audio"===e?i.hasAudio:i.hasVideo;return s!==r?!s&&r?(aO.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(tI.USER_PUBLISHED,i,e)):("video"===e&&i._videoTrack&&i._videoTrack._destroy(),"audio"===e&&i._audioTrack,this._p2pChannel.muteRemote(i,e),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(tI.USER_UNPUBLISHED,i,e)):void 0}),uw(this,"_handleMuteStream",(e,t,n)=>{if(RA("BLOCK_LOCAL_CLIENT")&&KL(e,this.channelName))return;aO.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const i=this._users.find(t=>t.uid===e);if(!i)return void aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const s="audio"===t?i.hasAudio:i.hasVideo;if("audio"===t){i._trust_audio_mute_state_=!0;const t=i._audio_muted_;if(i._audio_muted_=n,i._audio_muted_===t)return;{const t=i._audio_muted_?"mute-audio":"unmute-audio";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tI.USER_INFO_UPDATED,e,t)}}else{i._trust_video_mute_state_=!0;const t=i._video_muted_;if(i._video_muted_=n,i._video_muted_===t)return;{const t=i._video_muted_?"mute-video":"unmute-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tI.USER_INFO_UPDATED,e,t)}}const r="audio"===t?i.hasAudio:i.hasVideo;if(s!==r){if(!s&&r)return("audio"===t?i._audioSSRC:i._videoSSRC)?(aO.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(tI.USER_PUBLISHED,i,t)):void aO.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&i._videoTrack&&!i._video_pre_subscribed&&i._videoTrack._destroy(),"audio"===t&&i._audioTrack,this._p2pChannel.muteRemote(i,t),aO.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(tI.USER_UNPUBLISHED,i,t)}}),uw(this,"_handleP2PLost",async e=>{aO.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():aO.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)}),uw(this,"_handleTokenWillExpire",()=>{aO.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(tI.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),uw(this,"_handleBeforeUnload",e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),aO.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),uw(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(tI.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(tI.NETWORK_QUALITY,e)}),uw(this,"_handleP2PAddAudioOrVideoStream",(e,t,n,i)=>{const s=this._users.find(e=>e.uid===t);if(!s)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());const r="audio"===e?s.hasAudio:s.hasVideo;"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==n&&(s._audioSSRC=n),void 0!==i&&(s._audioMid=i)):(s._video_added_=!0,void 0!==n&&(s._videoSSRC=n),void 0!==i&&(s._videoMid=i)),("audio"===e?s.hasAudio:s.hasVideo)&&!r&&(aO.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(tI.USER_PUBLISHED,s,e)),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._config=e,this._clientId=t||wI(5,"client-"),this.store=new class{constructor(e,t,n,i){wR(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:EA.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case OA.SET_SESSION_ID:return CR(CR({},e),{},{sessionId:t.sessionId});case OA.SET_P2P_ID:return CR(CR({},e),{},{p2pId:t.p2pId});case OA.SET_UID:return CR(CR({},e),{},{uid:t.uid});case OA.SET_INT_UID:return CR(CR({},e),{},{intUid:t.intUid});case OA.SET_PUB_ID:return CR(CR({},e),{},{pubId:t.pubId});case OA.KEY_METRIC_CLIENT_CREATED:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{clientCreated:t.metric})});case OA.KEY_METRIC_JOIN_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinStart:t.metric})});case OA.KEY_METRIC_PRELOAD_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{preloadStart:t.metric})});case OA.KEY_METRIC_PRELOAD_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{preloadEnd:t.metric})});case OA.KEY_METRIC_JOIN_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinEnd:t.metric})});case OA.KEY_METRIC_REQUEST_AP_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestAPStart:t.metric})});case OA.KEY_METRIC_REQUEST_AP_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestAPEnd:t.metric})});case OA.KEY_METRIC_REQUEST_SUA_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestSUAEnd:t.metric})});case OA.KEY_METRIC_BEFORE_CONNECT:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{beforeConnect:t.metric})});case OA.KEY_METRIC_PEER_RECEIVER:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerReceiver:t.metric})});case OA.KEY_METRIC_SIGNAL_CONNECTED:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{signalConnected:t.metric})});case OA.KEY_METRIC_JOIN_REQ:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinReq:t.metric})});case OA.KEY_METRIC_JOIN_REP:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinRep:t.metric})});case OA.KEY_METRIC_JOIN_GATEWAY_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case OA.KEY_METRIC_JOIN_GATEWAY_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case OA.KEY_METRIC_PEER_CONNECTION_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case OA.KEY_METRIC_PEER_CONNECTION_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case OA.KEY_METRIC_DESCRIPTION_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{descriptionStart:t.metric})});case OA.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case OA.KEY_METRIC_ICE_CONNECTION_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case OA.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,i=n.findIndex(e=>e.trackId===t.metric.trackId);return-1!==i?(n[i]=CR(CR({},n[i]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{publish:[...n]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case OA.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,i=n.findIndex(e=>e.userId===t.metric.userId&&e.type===t.metric.type);return-1!==i?(n[i]=CR(CR({},n[i]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{subscribe:[...n]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case OA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const n=e.keyMetrics.firstVideoFrameDecoded,i=n.findIndex(e=>e.userId===t.metric.userId);return-1!==i?(n[i]=CR(CR({},n[i]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{firstVideoFrameDecoded:[...n]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{firstVideoFrameDecoded:[...e.keyMetrics.firstVideoFrameDecoded,t.metric]})})}case OA.RESET_FIRST_VIDEO_FRAME_DECODED:return e.keyMetrics.firstVideoFrameDecoded=[],e;case OA.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case OA.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=CR(CR({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case OA.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case OA.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},e;case OA.SET_USE_P2P:return CR(CR({},e),{},{useP2P:t.val});case OA.SET_TRANSPORT_TYPE:return CR(CR({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set autoSubscribe(e){this.state.autoSubscribe=e}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(e){this.state.enableInstantMuteRestore=e}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(e){this.dispatch({type:OA.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:OA.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:OA.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:OA.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:OA.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:OA.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:OA.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:OA.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:OA.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:OA.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:OA.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:OA.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:OA.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:OA.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:OA.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:OA.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:OA.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:OA.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:OA.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:OA.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:OA.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:OA.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:OA.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:OA.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:OA.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:OA.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(e,t){this.dispatch({type:OA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:CR({userId:e},t)})}descriptionStart(){this.dispatch({type:OA.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:OA.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:OA.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,i){this.dispatch({type:OA.KEY_METRIC_PUBLISH,metric:CR(CR({trackId:e,type:t},n&&{publishStart:n}),i&&{publishEnd:i})})}subscribe(e,t,n,i,s,r,a){this.dispatch({type:OA.KEY_METRIC_SUBSCRIBE,metric:CR(CR(CR(CR(CR({userId:e,type:t},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),s&&{firstFrame:s}),r&&{streamAdded:r}),a&&{firstDecoded:a})})}massSubscribe(e,t,n,i){e.forEach(e=>{this.dispatch({type:OA.KEY_METRIC_SUBSCRIBE,metric:CR(CR(CR({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map(e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof t?(this.dispatch({type:OA.RECORD_JOIN_CHANNEL_SERVICE,record:CR(CR({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:OA.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:OA.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:OA.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:OA.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new UI("client-leave",this._clientId),this._publishMutex=new UI("client-publish",this._clientId),this._renewTokenMutex=new UI("client-renewtoken",this._clientId),this._subscribeMutex=new UI("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),aO.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(yA," build: ").concat(TA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{eI(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(e){aO.warning("[".concat(this._clientId,"] ").concat(e.toString()))}var i;this._statsCollector=new XV(this.store),this._statsCollector.onStatsException=(e,t,n)=>{aO.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),e===KV.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(e=>{e instanceof LP&&RA("ENABLE_ENCODE_EXCEPTION")&&e.findClosestProfile()}),this.safeEmit(tI.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,i)=>{const s=this._users.find(t=>t.uid===e);s&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(s._uintid,{peerPublishDuration:n,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(s)),mO.peerPublishStatus(this._sessionId,{subscribeElapse:i,audioPublishDuration:t,videoPublishDuration:n,peer:s._uintid}))},this._statsCollector.onVideoCodecChanged=e=>{if(RA("VIDEO_STANDARD_BITRATE_VERSION")&&("av1"===e||"h265"===e||"h264"===e)){const t=this.localTracks.find(e=>e instanceof PP);t&&1!==t._saveEncodeBitrateRatio&&t.setSaveEncodeBitrateRatio("h264"===e?RA("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P="p2p"===e.mode,this._gateway=new nV(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||FI,httpRetryConfig:e.httpRetryConfig||FI,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new WV(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},JU("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new tB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,s){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];CA("JOIN_GATEWAY_USE_443PORT_ONLY",r),CA("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const o=this._gateway.signal.websocket;return o instanceof XM&&(o.use443PortOnly=r,o.tryDoubleDomain=a),async function(e,t,n){VC.get(e)||VC.set(e,[]),FC.get(e)||FC.set(e,t),BC.get(e)||BC.set(e,0);const i=VC.get(e),s=FC.get(e);if(!i||!s)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(BC.get(e)===s){const e=UC();i.push(e),await e.promise}BC.set(e,BC.get(e)+1);for(var r=arguments.length,a=new Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];const c=await n(...a);return BC.set(e,BC.get(e)-1),BC.get(e)===s-1&&i.length>0&&(i[0].resolve(),i.shift()),0===BC.get(e)&&(VC.set(e,[]),FC.set(e,0),BC.set(e,0)),c}("client.join",RA("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,s)}async join(e,t,n,i,s){const r=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const a="HTTPS"===(WI||WI||(WI=(window.location.protocol.split(":")[0]||"").toUpperCase(),WI)),o=XI()?window.isSecureContext:"Browser Not Support";if(!XI()&&!a||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";aO.warning(e)}let c;mO.setAppId(e);try{if(!n&&null!==n)throw new fO(RR.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&PR(n,"token",1,2047),PR(e,"appid",1,2047),Gj(t),i&&Wj(i),s)if("string"==typeof s)PR(s,"optionalInfo",1,256),c=s;else{if("object"!=typeof s)throw new fO(RR.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:e,enableInstantMuteRestore:t}=s;e&&(AR(e,"autoSubscribe"),aO.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(e)),this.store.autoSubscribe=e),t&&(AR(t,"enableInstantMuteRestore"),aO.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(t)),this.store.enableInstantMuteRestore=t)}}}catch(s){throw mO.reportApiInvoke(NI(),{name:qR.JOIN,options:[e,t,n,i],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}).onError(s),s}if(this._leaveMutex.isLocked&&(aO.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),aO.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const s=new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw mO.reportApiInvoke(NI(),{name:qR.JOIN,options:[e,t,n,i],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}).onError(s),s}this._gateway.state="CONNECTING",this.store.preloadStart();const l=await CB({appId:e,cname:t,uid:i,stringUid:"string"==typeof i?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const d=(null==l?void 0:l.sid)||NI();aO.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(r)),this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId);const u=mO.reportApiInvoke(d,{id:this._clientId,name:qR.JOIN,options:[e,t,n,i],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}),h=rW(rW(rW({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof i?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!l},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:RA("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(h.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof i&&(h.stringUid=i,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(h.aesmode=this._encryptionMode,h.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=BR(e),s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,i);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(s))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(h.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=RA("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(h.appId+this._encryptionSecret+this._encryptionSecret):e.encode(h.appId+h.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const i=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),s="aes-128-gcm2"===e?128:256,r=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:LA,hash:"SHA-256",salt:n},i,s+PA);return new Uint8Array(r).subarray(s/8)}(this._encryptionMode,t,_I(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const i=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),s="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:LA,hash:"SHA-256",salt:n},i,{name:"AES-GCM",length:s},!0,["encrypt","decrypt"])}(this._encryptionMode,t,_I(this._encryptionSalt))}else o?aO.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):aO.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,aO.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:h.stringUid});const p=this._sessionId;setTimeout(()=>{"CONNECTING"===this.connectionState&&p===this._sessionId&&mO.joinChannelTimeout(this._sessionId,5)},5e3);try{var m;let i;const s=h.cloudProxyServer;if(Pi(m=["proxy3","proxy4","proxy5"]).call(m,s)){const e=RA("PROXY_SERVER_TYPE3");Array.isArray(e)?h.proxyServer=e[0]:h.proxyServer=e}if(mO.setProxyServer(h.proxyServer),aO.setProxyServer(h.proxyServer),this.store.requestAPStart(),l){if(aO.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(h.stringUid?", ".concat(h.stringUid," => ").concat(l.intUid):""," ")),h.stringUid&&!h.uid&&(h.uid=l.intUid),i={gatewayInfo:l.ap.gatewayInfo},RA("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===h.turnServer.mode)if(0===l.ap.proxyInfo.addresses.length)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await lU(l.ap.proxyInfo,l.ap.gatewayInfo.uid)).map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bA.tcpport,udpport:e.udpport||bA.udpport,username:e.username||bA.username,password:e.password||bA.password,forceturn:!1,security:!0}));h.turnServer={mode:"manual",servers:e}}OB(l,h.stringUid)}else{if(h.stringUid&&!h.uid){let e;[e,i]=await np.all([PV(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,this.store).finally(()=>{this.store.requestSUAEnd()}),kV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),aO.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(h.stringUid," => ").concat(e)),h.uid=e,i.gatewayInfo.uid=e,i.gatewayInfo.res.uid=e}else i=await kV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,!0,this.store);if(!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(uM.UPDATE_BITRATE_LIMIT,e=>{this._p2pChannel.updateBitrateLimit(e)}),this._configDistribute.on(uM.UPDATE_CLIENT_ROLE_OPTIONS,e=>{this._setClientRoleOptions(e)})},0),this._key=n||e;const r=i.gatewayInfo,a=h.uid?h.uid:r.uid;this._joinInfo=rW(rW({},h),{},{cid:r.cid,uid:a,vid:r.vid,apResponse:r.res,apGatewayAddress:r.apGatewayAddress,uni_lbs_ip:r.uni_lbs_ip,gatewayAddrs:r.gatewayAddrs}),this.store.intUid=a,this.store.cid=r.cid;const o=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(o),this._appId=e,this._channelName=h.cname,this._uid=o,this.store.uid=o,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const c=h.stringUid?"string uid: ".concat(h.stringUid,",uid: ").concat(h.uid):"uid: ".concat(this._uid);return aO.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(c)),setTimeout(()=>{aO.startUpload()},5e3),this.store.joinEnd(),f=this,Pi(WL).call(WL,f)||WL.push(f),"disabled"===this._cloudProxyServerMode&&_O().supportWebCrypto&&RA("ENABLE_PRELOAD")&&IB(this._joinInfo),o}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===RR.OPERATION_ABORTED?aO.warning("[".concat(this._clientId,"] join number: ").concat(r,", Joining channel failed, rollback"),t):aO.error("[".concat(this._clientId,"] join number: ").concat(r,", Joining channel failed, rollback"),t),t.code!==RR.OPERATION_ABORTED&&this._numberOfJoinCount===r&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(t),t}var f}_joinGateway(){if(!this._joinInfo||!this._key)throw new fO(RR.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!RA("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){aO.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=WL.indexOf(e);-1!==t&&WL.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return aO.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,QR.LEAVE),aO.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof uD))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new fO(RR.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new fO(RR.INVALID_OPERATION,"audience can not publish stream");for(const s of n){if(!(s instanceof uD))throw new fO(RR.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&t)throw new fO(RR.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}aO.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(e=>{const t=this._configDistribute.getBitrateLimit();e instanceof PP&&t&&e.setBitrateLimit(t.uplink)});try{await this._publishHighStream(n),aO.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))))}catch(e){throw aO.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{i()}}async _publishDataChannel(e){if(null==e)throw new fO(RR.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));DR(e.id,"id",0,65535,!0),AR(e.ordered,"ordered"),PR(e.metadata,"metadata",0,512),aO.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex(t=>t.id===e.id))throw new fO(RR.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&RA("FORCE_TURN")&&!RA("TURN_ENABLE_TCP")&&!RA("TURN_ENABLE_UDP"))throw new fO(RR.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return QU(e,!1)}(e),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if("number"!=typeof t._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new fO(RR.CREATE_DATACHANNEL_ERROR);try{await np.all(n.map(e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0))),await t._waitTillOpen()}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw e}}return aO.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw aO.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof uD))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);aO.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(e=>"".concat(e.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(AM.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),aO.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(e=>"".concat(e.getTrackId()))))}}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),aO.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(e=>"".concat(e.id," "))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),aO.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(e=>"".concat(e.id))))}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(OR(t,"mediaType",["audio","video"]),this.store.useP2P)throw new fO(RR.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===fM.AUDIO,i=t===fM.VIDEO,s=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:r,rtxSsrcId:a,cname:o,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==s)throw new fO(RR.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(t=>t.uid===e);l||(l=new ZV(e,c||e),l._is_pre_created=!0,this._users.push(l)),o&&(l._cname=o),l._uintid||(l._uintid=c||e),n&&(l._audioSSRC=s,l._audio_pre_subscribed=!0,r&&(l._audioOrtc=r)),i&&(l._videoSSRC=s,l._video_pre_subscribed=!0,r&&(l._videoOrtc=r),null!=a&&(l._rtxSsrcId=a)),aO.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(l,t,s,a,r);const d=n?l._audioTrack:l._videoTrack;if(!d)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),i&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),d}catch(t){throw aO.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{s()}}async _subscribeDataChannel(e,t){var n;if(DR(t,"channelId",0,65535,!0),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const i=this._users.find(t=>t===e);if(!i)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new fO(RR.INVALID_REMOTE_USER,"user is not published");const s=null===(n=e._dataChannels)||void 0===n?void 0:n.find(e=>e.id===t);if(!s)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);const r=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[s]);if(n&&Pi(n).call(n,s.id))try{var a;if("number"!=typeof s._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new fO(RR.CREATE_DATACHANNEL_ERROR);const t={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:null!==(a=s.metadata)&&void 0!==a?a:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await s._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==RR.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),t;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{r()}}async _p2pSubscribe(e,t,n){if(OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const i=this._users.find(t=>t===e);if(!i){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(RR.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const s=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,n,i)}catch(e){throw e}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{s()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const i=this._users.find(t=>t===e);if(!i){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(RR.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let s="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:s};"video"===t&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const c=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const i="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==i&&i!==s&&(s=i,r="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:s}),zV.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,s,a,r);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(e.uid,o,!0)}catch(n){if((null==n?void 0:n.code)!==RR.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const i="audio"===t?e._audioTrack:e._videoTrack;if(!i)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user object");return"video"===t&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),i}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(LR(e,"subscribeList"),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; ")));const s=(e=[...e]).map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}}),r=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){const i=e[t],{user:r,mediaType:a}=i;if(OR(a,"mediaType",["audio","video"]),!r){const e=new fO(RR.INVALID_PARAMS,"user property does not exist in subscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const o=this._users.find(e=>e===r);if(!o){const n=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");aO.error("[".concat(this._clientId,"] can not massSubscribe ").concat(r.uid,", this user is not in the channel")),s[t].error=n,e.splice(t,1);continue}if("audio"===a&&(!r.hasAudio||void 0===r._audioSSRC)||"video"===a&&(!r.hasVideo||void 0===r._videoSSRC)){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);aO.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(a,", remote user is not published")),s[t].error=n,e.splice(t,1);continue}const c=aM.Video|aM.LwoVideo,l=n.get(r);if(l){if("video"===a?l&c:l&aM.Audio){e.splice(t,1),aO.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(r.uid,", mediaType:").concat(a," twice"));continue}n.set(r,l|("video"===a?c:aM.Audio))}else n.set(r,"video"===a?c:aM.Audio)}for(let t=e.length-1;t>=0;t--){const i=e[t],{user:s,mediaType:r}=i,a=aM.Video|aM.LwoVideo;if(this._p2pChannel.hasRemoteMedia(s,r)){await this._p2pChannel.unmuteRemoteNoLock(s,r);const i=n.get(s);n.set(s,"video"===r?i^a:i^aM.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map(e=>({userId:e.user.uid,type:e.mediaType})),t);let i=ss(a=Array.from(n.entries())).call(a,(e,t)=>{let[n,i]=t;if(0===i)return e;const s={stream_id:n.uid,stream_type:i};return i&aM.Audio&&(s.audio_ssrc=n._audioSSRC),i&aM.Video&&(s.video_ssrc=n._videoSSRC),e.push(s),e},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===fM.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===fM.VIDEO?t._rtxSsrcId:void 0}}));const n=new Map;if(i=i.filter(e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc),i.length>0){const e=await this._gateway.subscribeAll(i,!0);((null==e?void 0:e.users)||[]).forEach(e=>{let{stream_id:t,video_error_code:i,audio_error_code:s,error_code:r}=e;(i||s||r)&&n.set(t,{video_error_code:i,audio_error_code:s,error_code:r})})}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach(t=>{let[n,i]=t;const s=this.remoteUsers.find(e=>e.uid===n);if(s){let t;i.error_code||i.video_error_code&&i.audio_error_code?t=void 0:i.video_error_code?t=fM.VIDEO:i.audio_error_code&&(t=fM.AUDIO),e.push({user:s,mediaType:t})}}),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of s){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=MM(n);aO.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new fO(RR.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(s.filter(e=>!e.error).map(e=>({userId:e.user.uid,type:e.mediaType})),void 0,Date.now()),s.forEach(e=>{var n;mO.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===fM.VIDEO,audio:e.mediaType===fM.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===fM.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)}),aO.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; "))),s}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{r(),i()}}async unsubscribe(e,t,n){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const i=this._users.find(t=>t===e);if(!i){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const s=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&dI(this._users,e),aO.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===RR.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{s()}}async _unsubscribeDataChannel(e,t){if(t&&DR(t,"id",0,65535,!0),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find(t=>t===e);if(!n){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let i;if("number"==typeof t){const n=e._dataChannels.find(e=>e.id===t);n&&(i=[n])}else i=e._dataChannels;if(void 0===i){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(e=>e.id)));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,i);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),aO.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===RR.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(LR(e,"unsubscribeList"),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");aO.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:s}=e[n];if(!i){const e=new fO(RR.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}OR(s,"mediaType",["video","audio",void 0]);const r=this._users.find(e=>e===i);if(!r){aO.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const a=aM.Video|aM.LwoVideo;if(t.has(i)){const r=t.get(i);let o;switch(s){case"video":o=r&a;break;case"audio":o=r&aM.Audio;break;default:o=r&(aM.Audio|a)}if(o){aO.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(s," twice.")),e.splice(n,1);continue}s?"audio"===s?t.set(i,r|aM.Audio):"video"===s&&t.set(i,r|a):t.set(i,r|aM.Audio|a)}else s?"audio"===s?t.set(i,aM.Audio):"video"===s&&t.set(i,a):t.set(i,aM.Audio|a)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),aO.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join()))}catch(e){if(e.code===RR.DISCONNECT_P2P)return void aO.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw aO.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new IR(RR.INVALID_PARAMS);jR(e.width)||kR(e.width,"streamParameter.width"),jR(e.height)||kR(e.height,"streamParameter.height"),jR(e.framerate)||kR(e.framerate,"streamParameter.framerate"),jR(e.bitrate)||DR(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&aO.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),aO.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,vM.LocalVideoLowTrack)}async enableDualStream(){if(!_O().supportDualStream)throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new fO(RR.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new fO(RR.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),aO.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(vM.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),aO.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){OR(e,"role",["audience","host"])}(e),t&&eI(t),"rtc"===this.mode||"p2p"===this.mode)throw aO.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new fO(RR.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new fO(RR.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new fO(RR.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&RA("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",nI.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),aO.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode)return;if("audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&eI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{aO.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(PR(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,mO.setProxyServer(this._proxyServer),aO.setProxyServer(this._proxyServer),aO.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy")}if(ZR(e))return this._turnServer={servers:e,mode:"original-manual"},void aO.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(e=>e.urls).join(","),"."));e.forEach(e=>$R(e)),this._turnServer={servers:e,mode:"manual"},aO.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"you should set license before join channel");if(PR(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new fO(RR.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,aO.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new fO(RR.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new fO(RR.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Stop proxy server after leave channel");mO.setProxyServer(),aO.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new fO(RR.INVALID_PARAMS,"accessPoints is required.");LR(e.accessPoints.serverList,"accessPoints.serverList"),PR(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{DR(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(RR.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");RA("CLOSE_AFB_FOR_LOCAL_AP")&&(CA("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),CA("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,r=e.accessPoints.serverList.map(e=>i.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(s):e),a=r.map(e=>"".concat(e,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,CA("WEBCS_DOMAIN",a),CA("WEBCS_DOMAIN_BACKUP_LIST",a),CA("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(LR(e.report.hostname,"report.hostname"),CA("EVENT_REPORT_DOMAIN",e.report.hostname[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(CA("EVENT_REPORT_DOMAIN",r[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]));let o=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),o=e.report.port),CA("STATS_COLLECTOR_PORT",o),e.report?CA("ENABLE_EVENT_REPORT",!0):CA("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(LR(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=r[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),CA("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(LR(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=r;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),CA("CDS_AP",d.map(e=>"".concat(e,":").concat(u))),e.cds?CA("ENABLE_CONFIG_DISTRIBUTE",!0):CA("ENABLE_CONFIG_DISTRIBUTE",!1),aO.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(LR(e,"serverList"),PR(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(RR.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,CA("WEBCS_DOMAIN",e),CA("WEBCS_DOMAIN_BACKUP_LIST",e),CA("GATEWAY_DOMAINS",[t]),CA("EVENT_REPORT_DOMAIN",e[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),CA("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),aO.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(OR(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw aO.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else aO.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){OR(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const t=this._users.find(t=>t.uid===e);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(e){throw aO.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){OR(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){!function(e){OR(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),PR(t,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(Pi(s).call(s,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new fO(RR.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new fO(RR.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(AR(i,"encryptDataStream"),!Pi(s).call(s,e))throw new fO(RR.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||aO.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=yI(n))}async renewToken(e){if(PR(e,"token",1,2047),!this._key||!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(RA("USE_NEW_TOKEN")){aO.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await FV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FI);aO.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else aO.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});aO.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,aO.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?aO.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(tI.VOLUME_INDICATOR,e)},RA("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new fO(RR.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new fO(RR.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new fO(RR.LIVE_STREAMING_TASK_CONFLICT);const n=t?Hj.TRANSCODE:Hj.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Hj.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(e));if(!t.length)throw new fO(RR.INVALID_PARAMS,"can not find live streaming url to stop");await np.all(t.map(t=>t&&t.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof tB&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Pi(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(e,t,n){var i;const s=ss(i=Array.from(n)).call(i,(e,t)=>e+t,0),r={serverTs:0,seq:MA++,length:n.length,checkSum:s},a=new Uint8Array(DI(s,2)),o=new ArrayBuffer(jA),c=new DataView(o);c.setUint32(0,r.serverTs),c.setUint16(4,r.seq),c.setUint16(6,r.length),c.setUint16(8,r.checkSum);const l=16-n.length%16;n=EI(n,new Uint8Array(l));const d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:kA,additionalData:a},t,n);return EI(new Uint8Array(o),new Uint8Array(d))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new fO(RR.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Mj.DATA_STREAM,{payload:yI(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-rB},!n)}sendMetadata(e){if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new fO(RR.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Mj.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:yI(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(cO),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send custom report, not joined");await mO.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(RA("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(e=>e.uid+"");Object.keys(e).forEach(n=>{Pi(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){OR(t.spatialLayer,"spatialLayer",[0,1,2,3]),OR(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(AR(t,"apRTM"),DR(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,aO.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(aO.debug("[".concat(this._clientId,"] reset client")),function(e){const t=HL.indexOf(e);-1!==t&&HL.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=jC.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&AB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&mO.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(e=>e._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new UI("client-publish",this._clientId),this._subscribeMutex=new UI("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const i=e||NI();e?aO.debug("[".concat(this._clientId,"] new Session ").concat(i)):aO.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const s=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,mO.addSid(i);const r={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:"audience"===this.role?2:1};mO.sessionInit(this._sessionId,rW({cname:t.channel,appid:t.appId},r)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&RA("FORCE_TURN")&&!RA("TURN_ENABLE_TCP")&&!RA("TURN_ENABLE_UDP"))throw new fO(RR.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");aO.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(AM.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=s)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof PP&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch(e=>{aO.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===RR.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));aO.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==RR.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=i)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===RR.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new fO(RR.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},JU("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qR.ON_LIVE_STREAM_ERROR,options:[e,t],tag:YR.TRACER}).onSuccess(),this.safeEmit(tI.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qR.ON_LIVE_STREAM_WARNING,options:[e,t],tag:YR.TRACER}).onSuccess(),this.safeEmit(tI.LIVE_STREAMING_WARNING,e,t)},e.on(Jj.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new fO(RR.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,i){const s=RA("UAP_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"));return await yV(s,e,t,n,i)})(e,this._joinInfo,this._axiosCancelSource.token,FI).then(t).catch(n)}),e};return e===Hj.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new fO(RR.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},JU("ChannelMediaRelay").create(e));i.on("state",e=>{e===tM.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(tI.CHANNEL_MEDIA_RELAY_STATE,e)}),i.on("event",e=>{this.safeEmit(tI.CHANNEL_MEDIA_RELAY_EVENT,e)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,s=[];if(t){const e=[];this._users.forEach(t=>{t._dataChannels.forEach(i=>{n.every(e=>e.uid!==t._uintid||e.stream_id!==i.id)&&e.push({uid:t._uintid,stream_id:i.id,ordered:i.ordered,max_retrans_times:i.maxRetransmits,metadata:i.metadata})})}),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach(e=>{const{uid:n,stream_id:i,ordered:r,max_retrans_times:a,metadata:o}=e,c=this._users.find(e=>e._uintid===n);if(c){if(aO.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Pi(s).call(s,c)||s.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex(t=>t.id===e.stream_id)){const e={id:i,ordered:!!r,maxRetransmits:a,metadata:o},n=function(e){return QU(e,!0)}(e);c._dataChannels.push(n),aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(tI.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(aO.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())}))}else aO.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),t&&(this.safeEmit(tI.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(e=>{const{uid:t,stream_id:n}=e,i=this._users.find(e=>e._uintid===t);if(!i)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const s=i._dataChannels.find(t=>t.id===e.stream_id);s&&(aO.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(i,[s]).then(e=>{if(i._dataChannels=i._dataChannels.filter(e=>e!==s),e)return this._gateway.unsubscribeDataChannel(e,i.uid)}),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(s.id)),this.safeEmit(tI.USER_UNPUBLISHED,i,"datachannel",s._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=null===(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)||void 0===t?void 0:t.videoCodecs;if(n)for(const s of n){var i;if(s.payloadType===e)return null==s||null===(i=s.rtpMap)||void 0===i?void 0:i.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(t=>t.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){aO.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(e=>{this.safeEmit(tI.USER_UNPUBLISHED,t,"datachannel",e._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)}),n()}}else aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(sM.UPDATE_GATEWAY_CONFIG,()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(e=>{const{value:i,type:s,expires:r}=t[e];r&&r<=n||s||zL()||!Object.prototype.hasOwnProperty.call(SA,e)||(AA[e]=i,NA[e]=i,aO.debug("Update gateway parameters from config distribute",e,i))})}catch(e){aO.error("Error update config from local cache",e.message)}}()}),this._gateway.on(sM.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(sM.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===QR.FALLBACK)return;const s=()=>{this.safeEmit(tI.CONNECTION_STATE_CHANGE,e,t,n)};if(mO.reportApiInvoke(this._sessionId||(null===(i=this._gateway.joinInfo)||void 0===i?void 0:i.sid)||null,{name:qR.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:YR.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),aO.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void s();if("RECONNECTING"===e)this._users.forEach(e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var r;this._streamFallbackTypeCacheMap.forEach((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)})}),this._remoteStreamTypeCacheMap.forEach((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(r=this._joinInfo)||void 0===r?void 0:r.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{aO.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(e=>{aO.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(e=>!e._trust_in_room_).forEach(e=>{aO.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(e=>{e._trust_audio_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.AUDIO,!1)),e._trust_video_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.VIDEO,!1)),e._trust_audio_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(aO.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3))}s()}),this._gateway.on(sM.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new fO(RR.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const n=await CB(rW(rW({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,OB(n),this._joinInfo.preload=!0):(t=await DV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const i=[];t.gatewayInfo.gatewayAddrs.forEach(e=>{let{address:t}=e;const[n,s]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:n,port:s}):i.push({host:n,port:s})}),e(i)}catch(e){t(e)}}),this._gateway.on(sM.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(tI.NETWORK_QUALITY,e)}),this._gateway.on(sM.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(tI.STREAM_TYPE_CHANGED,e,t),mO.reportApiInvoke(this._sessionId,{name:qR.STREAM_TYPE_CHANGE,options:[e,t],tag:YR.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(sM.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(sM.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();n&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(e){n(e)}}),this._gateway.on(sM.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:aO.debug("no attributes in joinResponse");const i=TU(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(sM.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:i}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:r,cid:a}=this._joinInfo.apResponse,o="".concat(a,"_").concat(r);if(o.length<4||o.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var s;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(r),icePwd:"".concat(a,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(s=RA("FINGERPRINT"))&&void 0!==s?s:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(e){e.code&&e.code===RR.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Vj.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Vj.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Vj.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Vj.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Vj.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Vj.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Vj.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Vj.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Vj.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!0)),this._gateway.signal.on(Vj.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!1)),this._gateway.signal.on(Vj.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!0)),this._gateway.signal.on(Vj.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!1)),this._gateway.signal.on(Vj.RECEIVE_METADATA,e=>{const t=_I(e.metadata);this.safeEmit(tI.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Vj.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=_I(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Pi(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<jA)throw new fO(RR.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(jA));const t=await async function(e,t,n){const i=n.subarray(0,jA),s=i.slice(8,jA),r=(s[0]<<8)+s[1],a=(i[6]<<8)+i[7],o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:kA,additionalData:new Uint8Array(DI(r,2))},t,n.subarray(jA));return new Uint8Array(o).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let i=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find(t=>t.uid===e.uid),s=null==t?void 0:t.audioRecv.find(e=>e.ssrc===(null==n?void 0:n._audioSSRC));i=null==s?void 0:s.jitterBufferMs}(null==i||Number.isNaN(i))&&(i=0),uB(rW(rW({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Vj.ON_CRYPT_ERROR,()=>{gI(()=>{aO.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(tI.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Vj.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Vj.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{aO.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,QR.TOKEN_EXPIRE),this.safeEmit(tI.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Vj.ON_STREAM_FALLBACK_UPDATE,e=>{aO.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(tI.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(Vj.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),aO.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Vj.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Vj.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(jj.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Mj.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,i;const s=e.some(e=>{let{stream_type:t}=e;return t===iM.Audio}),r=e.some(e=>{let{stream_type:t}=e;return t!==iM.Audio}),a=e.some(e=>{let{stream_type:t}=e;return t===iM.Screen||t===iM.ScreenLow});"offer"===t.state&&mO.publish(this._joinInfo.sid,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:RR.TIMEOUT,audio:s,video:r,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:s?null===(n=e.find(e=>{let{stream_type:t}=e;return t===iM.Audio}))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:r?null===(i=e.find(e=>{let{stream_type:t}=e;return t!==iM.Audio}))||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId.toString():void 0})}break}case Mj.SUBSCRIBE:t&&mO.subscribe(this._joinInfo.sid,{succ:!1,ec:RR.TIMEOUT,audio:t.stream_type===fM.AUDIO,video:t.stream_type===fM.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Vj.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Vj.ON_PUBLISHED_USER_LIST,e=>{if(null==e||!e.users)return;RA("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(e=>!KL(e.string_id||e.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let e=this._users.find(e=>e._uintid===i.stream_id);e?e._trust_in_room_=!0:(e=new ZV(i.string_id||i.stream_id,i.stream_id),this._users.push(e),this.store.firstVideoFrameDecoded(e.uid,{userJoinNotify:Date.now()}),0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(tI.USER_JOINED,e)));const s=aM.Audio&i.stream_type,r=(aM.Video|aM.LwoVideo)&i.stream_type,a=0!=(65280&i.stream_type),o=s&&e.hasAudio,c=r&&e.hasVideo;r&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=i.video_ssrc,e._rtxSsrcId=i.video_rtx),s&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=i.audio_ssrc),s&&!o&&0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(tI.USER_PUBLISHED,e,"audio")),r&&!c&&0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(tI.USER_PUBLISHED,e,"video")),(s&&!o||r&&!c||a)&&t.push(e),r&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(aO.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(e=>{aO.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())})),this.getListeners(tI.PUBLISHED_USER_LIST).length>0?RA("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(aO.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(e=>e.uid).join(", "))),this.safeEmit(tI.PUBLISHED_USER_LIST,t)):aO.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(e=>e.uid).join(", ")))}),this._gateway.signal.on(Vj.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof tB&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(e=>e.toLowerCase()).filter(e=>{var t;return Pi(t=Object.keys(DA)).call(t,e)}))})}_handleP2PEvents(){this._gateway.signal.on(Vj.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(AM.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(e=>{const{kind:s,ssrcs:r,mid:a,isMuted:o}=e;this._handleP2PAddAudioOrVideoStream(s,i,r[0].ssrcId,a);const c=this._users.find(e=>e.uid===i);return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,s,r[0].ssrcId,a).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,s,!!o)})}),this._gateway.signal.on(AM.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},e))}catch(e){n(e)}}),this._gateway.signal.on(jj.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(AM.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:s}=e,r=this._users.find(e=>e.uid===s);if(!r)return aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void t();try{i.forEach(async e=>{let{stream_type:t}=e;const n=t===iM.Audio?fM.AUDIO:fM.VIDEO;await this._p2pChannel.unsubscribe(r,n),this._handleMuteStream(s,n,!0)}),t()}catch(e){n(e)}}}),this._gateway.signal.on(AM.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case DM.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,fM.VIDEO,!0);break;case DM.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,fM.AUDIO,!0);break;case DM.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,fM.VIDEO,!1);break;case DM.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,fM.AUDIO,!1)}}),this._gateway.signal.on(AM.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:n,iceParameter:i}=e;n!==Fj.SEND_ONLY||i?t(await this._p2pChannel.restartICE(n,i)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}}),this._gateway.signal.on(AM.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(bM.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(AM.RESTART_ICE,e,n===Fj.SEND_ONLY))}catch(e){n(e)}}),this._p2pChannel.on(bM.LocalCandidate,e=>{this._gateway.sendExtensionMessage(AM.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(bM.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(AM.CONTROL,e,!0),t()}catch(e){n(e)}}),this._p2pChannel.on(bM.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.StateChange,(e,t)=>{t===EM.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(bM.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(tI.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(bM.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(bM.RequestRePublishDataChannel,(e,t,n)=>{np.all(e.map(async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach(e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)})}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw e}})).then(t).catch(n)}),this._p2pChannel.on(bM.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===fM.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}}),this._p2pChannel.on(bM.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(bM.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(bM.MediaReconnectStart,e=>{this.safeEmit(tI.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(bM.MediaReconnectEnd,e=>{this.safeEmit(tI.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(bM.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(bM.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let s;try{s=await this._gateway.restartICE({iceParameters:i})}catch(e){return void t.throw(e)}const{iceParameters:r}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(s);await t.next({remoteIceParameters:r})}),this._p2pChannel.on(bM.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(bM.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:r}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),a=TU(s,r);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(bM.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(bM.P2PLost,()=>{this.safeEmit(tI.P2P_LOST,this.store.uid)}),this._p2pChannel.on(bM.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(bM.ConnectionTypeChange,e=>{this.safeEmit(tI.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(bM.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(bM.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(bM.AudioMetadata,e=>{this.safeEmit(tI.AUDIO_METADATA,e)}),this._p2pChannel.on(bM.AudioPts,e=>{this.safeEmit(tI.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},JU("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:s,sid:r,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:s,sid:r,token:a,uid:o,cid:c,vid:l?Number(l):0},FI)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(TM.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(tI.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===SM.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(tI.CONTENT_INSPECT_ERROR,new fO(RR.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(TM.INSPECT_RESULT,(e,t)=>{var n;if((null==t?void 0:t.code)===RR.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return aO.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(tI.CONTENT_INSPECT_RESULT,e,t)}),e.on(TM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}async disableContentInspect(){if(!this._inspect)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(AR(e,"enabled"),e){if(!t)throw new fO(RR.INVALID_PARAMS,"config is required");if(mG(t),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(n={config:t},JU("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);const{appId:i,cname:s,sid:r,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await e.init({appId:i,areaCode:"",cname:s,sid:r,token:a,uid:o,cid:c,vid:l?Number(l):0},FI)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var n;if(!this._moderation)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(RM.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(tI.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===CM.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new fO(RR.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(RM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}setP2PTransport(e){if(function(e){OR(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new fO(RR.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,aO.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return aO.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){AR(e,"enabled"),CA("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ij(iW.prototype,"leave",[gG],Object.getOwnPropertyDescriptor(iW.prototype,"leave"),iW.prototype),Ij(iW.prototype,"publish",[_G],Object.getOwnPropertyDescriptor(iW.prototype,"publish"),iW.prototype),Ij(iW.prototype,"unpublish",[yG],Object.getOwnPropertyDescriptor(iW.prototype,"unpublish"),iW.prototype),Ij(iW.prototype,"subscribe",[vG],Object.getOwnPropertyDescriptor(iW.prototype,"subscribe"),iW.prototype),Ij(iW.prototype,"presubscribe",[EG],Object.getOwnPropertyDescriptor(iW.prototype,"presubscribe"),iW.prototype),Ij(iW.prototype,"massSubscribe",[bG],Object.getOwnPropertyDescriptor(iW.prototype,"massSubscribe"),iW.prototype),Ij(iW.prototype,"unsubscribe",[SG],Object.getOwnPropertyDescriptor(iW.prototype,"unsubscribe"),iW.prototype),Ij(iW.prototype,"massUnsubscribe",[xG],Object.getOwnPropertyDescriptor(iW.prototype,"massUnsubscribe"),iW.prototype),Ij(iW.prototype,"setLowStreamParameter",[TG],Object.getOwnPropertyDescriptor(iW.prototype,"setLowStreamParameter"),iW.prototype),Ij(iW.prototype,"enableDualStream",[wG],Object.getOwnPropertyDescriptor(iW.prototype,"enableDualStream"),iW.prototype),Ij(iW.prototype,"disableDualStream",[NG],Object.getOwnPropertyDescriptor(iW.prototype,"disableDualStream"),iW.prototype),Ij(iW.prototype,"setClientRole",[CG],Object.getOwnPropertyDescriptor(iW.prototype,"setClientRole"),iW.prototype),Ij(iW.prototype,"_setClientRoleOptions",[RG],Object.getOwnPropertyDescriptor(iW.prototype,"_setClientRoleOptions"),iW.prototype),Ij(iW.prototype,"setProxyServer",[IG],Object.getOwnPropertyDescriptor(iW.prototype,"setProxyServer"),iW.prototype),Ij(iW.prototype,"setTurnServer",[AG],Object.getOwnPropertyDescriptor(iW.prototype,"setTurnServer"),iW.prototype),Ij(iW.prototype,"setLicense",[OG],Object.getOwnPropertyDescriptor(iW.prototype,"setLicense"),iW.prototype),Ij(iW.prototype,"startProxyServer",[DG],Object.getOwnPropertyDescriptor(iW.prototype,"startProxyServer"),iW.prototype),Ij(iW.prototype,"stopProxyServer",[kG],Object.getOwnPropertyDescriptor(iW.prototype,"stopProxyServer"),iW.prototype),Ij(iW.prototype,"setLocalAccessPointsV2",[PG],Object.getOwnPropertyDescriptor(iW.prototype,"setLocalAccessPointsV2"),iW.prototype),Ij(iW.prototype,"setLocalAccessPoints",[LG],Object.getOwnPropertyDescriptor(iW.prototype,"setLocalAccessPoints"),iW.prototype),Ij(iW.prototype,"setRemoteDefaultVideoStreamType",[jG],Object.getOwnPropertyDescriptor(iW.prototype,"setRemoteDefaultVideoStreamType"),iW.prototype),Ij(iW.prototype,"setRemoteVideoStreamType",[MG],Object.getOwnPropertyDescriptor(iW.prototype,"setRemoteVideoStreamType"),iW.prototype),Ij(iW.prototype,"setStreamFallbackOption",[UG],Object.getOwnPropertyDescriptor(iW.prototype,"setStreamFallbackOption"),iW.prototype),Ij(iW.prototype,"setEncryptionConfig",[VG],Object.getOwnPropertyDescriptor(iW.prototype,"setEncryptionConfig"),iW.prototype),Ij(iW.prototype,"renewToken",[FG],Object.getOwnPropertyDescriptor(iW.prototype,"renewToken"),iW.prototype),Ij(iW.prototype,"enableAudioVolumeIndicator",[BG],Object.getOwnPropertyDescriptor(iW.prototype,"enableAudioVolumeIndicator"),iW.prototype),Ij(iW.prototype,"startLiveStreaming",[GG],Object.getOwnPropertyDescriptor(iW.prototype,"startLiveStreaming"),iW.prototype),Ij(iW.prototype,"setLiveTranscoding",[WG],Object.getOwnPropertyDescriptor(iW.prototype,"setLiveTranscoding"),iW.prototype),Ij(iW.prototype,"stopLiveStreaming",[HG],Object.getOwnPropertyDescriptor(iW.prototype,"stopLiveStreaming"),iW.prototype),Ij(iW.prototype,"startChannelMediaRelay",[KG],Object.getOwnPropertyDescriptor(iW.prototype,"startChannelMediaRelay"),iW.prototype),Ij(iW.prototype,"updateChannelMediaRelay",[zG],Object.getOwnPropertyDescriptor(iW.prototype,"updateChannelMediaRelay"),iW.prototype),Ij(iW.prototype,"stopChannelMediaRelay",[qG],Object.getOwnPropertyDescriptor(iW.prototype,"stopChannelMediaRelay"),iW.prototype),Ij(iW.prototype,"sendCustomReportMessage",[YG],Object.getOwnPropertyDescriptor(iW.prototype,"sendCustomReportMessage"),iW.prototype),Ij(iW.prototype,"pickSVCLayer",[XG],Object.getOwnPropertyDescriptor(iW.prototype,"pickSVCLayer"),iW.prototype),Ij(iW.prototype,"setRTMConfig",[JG],Object.getOwnPropertyDescriptor(iW.prototype,"setRTMConfig"),iW.prototype),Ij(iW.prototype,"enableContentInspect",[QG],Object.getOwnPropertyDescriptor(iW.prototype,"enableContentInspect"),iW.prototype),Ij(iW.prototype,"disableContentInspect",[ZG],Object.getOwnPropertyDescriptor(iW.prototype,"disableContentInspect"),iW.prototype),Ij(iW.prototype,"setImageModeration",[$G],Object.getOwnPropertyDescriptor(iW.prototype,"setImageModeration"),iW.prototype),Ij(iW.prototype,"setP2PTransport",[eW],Object.getOwnPropertyDescriptor(iW.prototype,"setP2PTransport"),iW.prototype),Ij(iW.prototype,"getJoinChannelServiceRecords",[tW],Object.getOwnPropertyDescriptor(iW.prototype,"getJoinChannelServiceRecords"),iW.prototype),Ij(iW.prototype,"setPublishAudioFilterEnabled",[nW],Object.getOwnPropertyDescriptor(iW.prototype,"setPublishAudioFilterEnabled"),iW.prototype),iW);class oW{constructor(e,t){uw(this,"id",0),uw(this,"element",void 0),uw(this,"peerPair",void 0),uw(this,"context",void 0),uw(this,"audioPlayerElement",void 0),uw(this,"audioTrack",void 0),oW.count+=1,this.id=oW.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new np(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const i=await e(this.peerPair[1],"answer");await t(this.peerPair[0],i)}catch(e){throw new fO(RR.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new fO(RR.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new fO(RR.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){aO.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var cW,lW;uw(oW,"count",0);const dW=window.AudioContext||window.webkitAudioContext,uW=new(cW=pO({report:mO}),Ij((lW=class{constructor(){uw(this,"units",[]),uw(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return aO.debug("the system does not need to process local aec"),-1;this.context||(this.context=new dW);let t=this.units.find(t=>t&&t.getElement()===e);return t||(t=new oW(e,this.context),this.units.push(t)),t.startEchoCancellation(),aO.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qC().name!==WC.SAFARI}}).prototype,"processExternalMediaAEC",[cW],Object.getOwnPropertyDescriptor(lW.prototype,"processExternalMediaAEC"),lW.prototype),lW);function hW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function pW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hW(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const mW=window||document;function fW(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!mW)return;const n=LY._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=e=>{if(!(e&&e.blockedURI&&(LY.onSecurityPolicyViolation||LY.getListeners(NM.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;RA("CSP_DETECTED_HOSTNAME_LIST").some(e=>Pi(t).call(t,e))&&(LY.onSecurityPolicyViolation&&"function"==typeof LY.onSecurityPolicyViolation&&LY.onSecurityPolicyViolation(e),LY.getListeners(NM.SECURITY_POLICY_VIOLATION).length>0&&LY.safeEmit(NM.SECURITY_POLICY_VIOLATION,e))};n&&mW.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||LY.getListeners(NM.SECURITY_POLICY_VIOLATION).length>0)&&mW.addEventListener("securitypolicyviolation",i),LY._cspEventHandlerPointer=i}var gW=u,_W=Rw,yW=RegExp.prototype,vW=function(e){return e===yW||gW(yW,e)?_W(e):e.flags},EW=i(vW);function bW(e){let t=e.length;for(;--t>=0;)e[t]=0}const SW=256,xW=286,TW=30,wW=15,NW=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),CW=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),RW=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),IW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AW=new Array(576);bW(AW);const OW=new Array(60);bW(OW);const DW=new Array(512);bW(DW);const kW=new Array(256);bW(kW);const PW=new Array(29);bW(PW);const LW=new Array(TW);function jW(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let MW,UW,VW;function FW(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}bW(LW);const BW=e=>e<256?DW[e]:DW[256+(e>>>7)],GW=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},WW=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,GW(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},HW=(e,t,n)=>{WW(e,n[2*t],n[2*t+1])},KW=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},zW=(e,t,n)=>{const i=new Array(16);let s,r,a=0;for(s=1;s<=wW;s++)a=a+n[s-1]<<1,i[s]=a;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=KW(i[t]++,t))}},qW=e=>{let t;for(t=0;t<xW;t++)e.dyn_ltree[2*t]=0;for(t=0;t<TW;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},YW=e=>{e.bi_valid>8?GW(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},XW=(e,t,n,i)=>{const s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&i[t]<=i[n]},JW=(e,t,n)=>{const i=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&XW(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!XW(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i},QW=(e,t,n)=>{let i,s,r,a,o=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+o++],i+=(255&e.pending_buf[e.sym_buf+o++])<<8,s=e.pending_buf[e.sym_buf+o++],0===i?HW(e,s,t):(r=kW[s],HW(e,r+SW+1,t),a=NW[r],0!==a&&(s-=PW[r],WW(e,s,a)),i--,r=BW(i),HW(e,r,n),a=CW[r],0!==a&&(i-=LW[r],WW(e,i,a)))}while(o<e.sym_next);HW(e,256,t)},ZW=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let a,o,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<r;a++)0!==n[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,s&&(e.static_len-=i[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)JW(e,n,a);c=r;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],JW(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,n[2*c]=n[2*a]+n[2*o],e.depth[c]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,n[2*a+1]=n[2*o+1]=c,e.heap[1]=c++,JW(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,i=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,d,u,h,p,m,f=0;for(h=0;h<=wW;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)d=e.heap[l],h=n[2*n[2*d+1]+1]+1,h>c&&(h=c,f++),n[2*d+1]=h,d>i||(e.bl_count[h]++,p=0,d>=o&&(p=a[d-o]),m=n[2*d],e.opt_len+=m*(h+p),r&&(e.static_len+=m*(s[2*d+1]+p)));if(0!==f){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,f-=2}while(f>0);for(h=c;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--l],u>i||(n[2*u+1]!==h&&(e.opt_len+=(h-n[2*u+1])*n[2*u],n[2*u+1]=h),d--)}})(e,t),zW(n,l,e.bl_count)},$W=(e,t,n)=>{let i,s,r=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=a,a=t[2*(i+1)+1],++o<c&&s===a||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=s,0===a?(c=138,l=3):s===a?(c=6,l=3):(c=7,l=4))},eH=(e,t,n)=>{let i,s,r=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),i=0;i<=n;i++)if(s=a,a=t[2*(i+1)+1],!(++o<c&&s===a)){if(o<l)do{HW(e,s,e.bl_tree)}while(0!=--o);else 0!==s?(s!==r&&(HW(e,s,e.bl_tree),o--),HW(e,16,e.bl_tree),WW(e,o-3,2)):o<=10?(HW(e,17,e.bl_tree),WW(e,o-3,3)):(HW(e,18,e.bl_tree),WW(e,o-11,7));o=0,r=s,0===a?(c=138,l=3):s===a?(c=6,l=3):(c=7,l=4)}};let tH=!1;const nH=(e,t,n,i)=>{WW(e,0+(i?1:0),3),YW(e),GW(e,n),GW(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var iH=e=>{tH||((()=>{let e,t,n,i,s;const r=new Array(16);for(n=0,i=0;i<28;i++)for(PW[i]=n,e=0;e<1<<NW[i];e++)kW[n++]=i;for(kW[n-1]=i,s=0,i=0;i<16;i++)for(LW[i]=s,e=0;e<1<<CW[i];e++)DW[s++]=i;for(s>>=7;i<TW;i++)for(LW[i]=s<<7,e=0;e<1<<CW[i]-7;e++)DW[256+s++]=i;for(t=0;t<=wW;t++)r[t]=0;for(e=0;e<=143;)AW[2*e+1]=8,e++,r[8]++;for(;e<=255;)AW[2*e+1]=9,e++,r[9]++;for(;e<=279;)AW[2*e+1]=7,e++,r[7]++;for(;e<=287;)AW[2*e+1]=8,e++,r[8]++;for(zW(AW,287,r),e=0;e<TW;e++)OW[2*e+1]=5,OW[2*e]=KW(e,5);MW=new jW(AW,NW,257,xW,wW),UW=new jW(OW,CW,0,TW,wW),VW=new jW(new Array(0),RW,0,19,7)})(),tH=!0),e.l_desc=new FW(e.dyn_ltree,MW),e.d_desc=new FW(e.dyn_dtree,UW),e.bl_desc=new FW(e.bl_tree,VW),e.bi_buf=0,e.bi_valid=0,qW(e)},sH=(e,t,n,i)=>{let s,r,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<SW;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ZW(e,e.l_desc),ZW(e,e.d_desc),a=(e=>{let t;for($W(e,e.dyn_ltree,e.l_desc.max_code),$W(e,e.dyn_dtree,e.d_desc.max_code),ZW(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*IW[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?nH(e,t,n,i):4===e.strategy||r===s?(WW(e,2+(i?1:0),3),QW(e,AW,OW)):(WW(e,4+(i?1:0),3),((e,t,n,i)=>{let s;for(WW(e,t-257,5),WW(e,n-1,5),WW(e,i-4,4),s=0;s<i;s++)WW(e,e.bl_tree[2*IW[s]+1],3);eH(e,e.dyn_ltree,t-1),eH(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),QW(e,e.dyn_ltree,e.dyn_dtree)),qW(e),i&&YW(e)},rH=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(kW[n]+SW+1)]++,e.dyn_dtree[2*BW(t)]++),e.sym_next===e.sym_end),aH=e=>{WW(e,2,3),HW(e,256,AW),(e=>{16===e.bi_valid?(GW(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},oH={_tr_init:iH,_tr_stored_block:nH,_tr_flush_block:sH,_tr_tally:rH,_tr_align:aH},cH=(e,t,n,i)=>{let s=65535&e,r=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{s=s+t[i++]|0,r=r+s|0}while(--a);s%=65521,r%=65521}return s|r<<16};const lH=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var dH=(e,t,n,i)=>{const s=lH,r=i+n;e^=-1;for(let a=i;a<r;a++)e=e>>>8^s[255&(e^t[a])];return-1^e},uH={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},hH={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:pH,_tr_stored_block:mH,_tr_flush_block:fH,_tr_tally:gH,_tr_align:_H}=oH,{Z_NO_FLUSH:yH,Z_PARTIAL_FLUSH:vH,Z_FULL_FLUSH:EH,Z_FINISH:bH,Z_BLOCK:SH,Z_OK:xH,Z_STREAM_END:TH,Z_STREAM_ERROR:wH,Z_DATA_ERROR:NH,Z_BUF_ERROR:CH,Z_DEFAULT_COMPRESSION:RH,Z_FILTERED:IH,Z_HUFFMAN_ONLY:AH,Z_RLE:OH,Z_FIXED:DH,Z_DEFAULT_STRATEGY:kH,Z_UNKNOWN:PH,Z_DEFLATED:LH}=hH,jH=286,MH=30,UH=19,VH=2*jH+1,FH=15,BH=258,GH=262,WH=42,HH=113,KH=666,zH=(e,t)=>(e.msg=uH[t],t),qH=e=>2*e-(e>4?9:0),YH=e=>{let t=e.length;for(;--t>=0;)e[t]=0},XH=e=>{let t,n,i,s=e.w_size;t=e.hash_size,i=t;do{n=e.head[--i],e.head[i]=n>=s?n-s:0}while(--t);t=s,i=t;do{n=e.prev[--i],e.prev[i]=n>=s?n-s:0}while(--t)};let JH=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const QH=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},ZH=(e,t)=>{fH(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,QH(e.strm)},$H=(e,t)=>{e.pending_buf[e.pending++]=t},eK=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},tK=(e,t,n,i)=>{let s=e.avail_in;return s>i&&(s=i),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),1===e.state.wrap?e.adler=cH(e.adler,t,s,n):2===e.state.wrap&&(e.adler=dH(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},nK=(e,t)=>{let n,i,s=e.max_chain_length,r=e.strstart,a=e.prev_length,o=e.nice_match;const c=e.strstart>e.w_size-GH?e.strstart-(e.w_size-GH):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+BH;let p=l[r+a-1],m=l[r+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,l[n+a]===m&&l[n+a-1]===p&&l[n]===l[r]&&l[++n]===l[r+1]){r+=2,n++;do{}while(l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&r<h);if(i=BH-(h-r),r=h-BH,i>a){if(e.match_start=t,a=i,i>=o)break;p=l[r+a-1],m=l[r+a]}}}while((t=u[t&d])>c&&0!=--s);return a<=e.lookahead?a:e.lookahead},iK=e=>{const t=e.w_size;let n,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-GH)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),XH(e),i+=t),0===e.strm.avail_in)break;if(n=tK(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=JH(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=JH(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<GH&&0!==e.strm.avail_in)},sK=(e,t)=>{let n,i,s,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>s&&(n=s),n<r&&(0===n&&t!==bH||t===yH||n!==i+e.strm.avail_in))break;a=t===bH&&n===i+e.strm.avail_in?1:0,mH(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,QH(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(tK(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==yH&&t!==bH&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(tK(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,i=e.strstart-e.block_start,(i>=r||(i||t===bH)&&t!==yH&&0===e.strm.avail_in&&i<=s)&&(n=i>s?s:i,a=t===bH&&0===e.strm.avail_in&&n===i?1:0,mH(e,e.block_start,n,a),e.block_start+=n,QH(e.strm)),a?3:1)},rK=(e,t)=>{let n,i;for(;;){if(e.lookahead<GH){if(iK(e),e.lookahead<GH&&t===yH)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-GH&&(e.match_length=nK(e,n)),e.match_length>=3)if(i=gH(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=JH(e,e.ins_h,e.window[e.strstart+1]);else i=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2},aK=(e,t)=>{let n,i,s;for(;;){if(e.lookahead<GH){if(iK(e),e.lookahead<GH&&t===yH)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-GH&&(e.match_length=nK(e,n),e.match_length<=5&&(e.strategy===IH||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=gH(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(ZH(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=gH(e,0,e.window[e.strstart-1]),i&&ZH(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=gH(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2};function oK(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}const cK=[new oK(0,0,0,0,sK),new oK(4,4,8,4,rK),new oK(4,5,16,8,rK),new oK(4,6,32,32,rK),new oK(4,4,16,16,aK),new oK(8,16,32,32,aK),new oK(8,16,128,128,aK),new oK(8,32,128,256,aK),new oK(32,128,258,1024,aK),new oK(32,258,258,4096,aK)];function lK(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=LH,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*VH),this.dyn_dtree=new Uint16Array(2*(2*MH+1)),this.bl_tree=new Uint16Array(2*(2*UH+1)),YH(this.dyn_ltree),YH(this.dyn_dtree),YH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(FH+1),this.heap=new Uint16Array(2*jH+1),YH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jH+1),YH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dK=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==WH&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==HH&&t.status!==KH?1:0},uK=e=>{if(dK(e))return zH(e,wH);e.total_in=e.total_out=0,e.data_type=PH;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?WH:HH,e.adler=2===t.wrap?0:1,t.last_flush=-2,pH(t),xH},hK=e=>{const t=uK(e);return t===xH&&(e=>{e.window_size=2*e.w_size,YH(e.head),e.max_lazy_match=cK[e.level].max_lazy,e.good_match=cK[e.level].good_length,e.nice_match=cK[e.level].nice_length,e.max_chain_length=cK[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},pK=(e,t,n,i,s,r)=>{if(!e)return wH;let a=1;if(t===RH&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),s<1||s>9||n!==LH||i<8||i>15||t<0||t>9||r<0||r>DH||8===i&&1!==a)return zH(e,wH);8===i&&(i=9);const o=new lK;return e.state=o,o.strm=e,o.status=WH,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=r,o.method=n,hK(e)};var mK=(e,t)=>{if(dK(e)||t>SH||t<0)return e?zH(e,wH):wH;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===KH&&t!==bH)return zH(e,0===e.avail_out?CH:wH);const i=n.last_flush;if(n.last_flush=t,0!==n.pending){if(QH(e),0===e.avail_out)return n.last_flush=-1,xH}else if(0===e.avail_in&&qH(t)<=qH(i)&&t!==bH)return zH(e,CH);if(n.status===KH&&0!==e.avail_in)return zH(e,CH);if(n.status===WH&&0===n.wrap&&(n.status=HH),n.status===WH){let t=LH+(n.w_bits-8<<4)<<8,i=-1;if(i=n.strategy>=AH||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=i<<6,0!==n.strstart&&(t|=32),t+=31-t%31,eK(n,t),0!==n.strstart&&(eK(n,e.adler>>>16),eK(n,65535&e.adler)),e.adler=1,n.status=HH,QH(e),0!==n.pending)return n.last_flush=-1,xH}if(57===n.status)if(e.adler=0,$H(n,31),$H(n,139),$H(n,8),n.gzhead)$H(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),$H(n,255&n.gzhead.time),$H(n,n.gzhead.time>>8&255),$H(n,n.gzhead.time>>16&255),$H(n,n.gzhead.time>>24&255),$H(n,9===n.level?2:n.strategy>=AH||n.level<2?4:0),$H(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&($H(n,255&n.gzhead.extra.length),$H(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=dH(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if($H(n,0),$H(n,0),$H(n,0),$H(n,0),$H(n,0),$H(n,9===n.level?2:n.strategy>=AH||n.level<2?4:0),$H(n,3),n.status=HH,QH(e),0!==n.pending)return n.last_flush=-1,xH;if(69===n.status){if(n.gzhead.extra){let t=n.pending,i=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+i>n.pending_buf_size;){let s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=dH(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=s,QH(e),0!==n.pending)return n.last_flush=-1,xH;t=0,i-=s}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending+=i,n.gzhead.hcrc&&n.pending>t&&(e.adler=dH(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=dH(e.adler,n.pending_buf,n.pending-i,i)),QH(e),0!==n.pending)return n.last_flush=-1,xH;i=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,$H(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>i&&(e.adler=dH(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=dH(e.adler,n.pending_buf,n.pending-i,i)),QH(e),0!==n.pending)return n.last_flush=-1,xH;i=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,$H(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>i&&(e.adler=dH(e.adler,n.pending_buf,n.pending-i,i))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(QH(e),0!==n.pending))return n.last_flush=-1,xH;$H(n,255&e.adler),$H(n,e.adler>>8&255),e.adler=0}if(n.status=HH,QH(e),0!==n.pending)return n.last_flush=-1,xH}if(0!==e.avail_in||0!==n.lookahead||t!==yH&&n.status!==KH){let i=0===n.level?sK(n,t):n.strategy===AH?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(iK(e),0===e.lookahead)){if(t===yH)return 1;break}if(e.match_length=0,n=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===OH?((e,t)=>{let n,i,s,r;const a=e.window;for(;;){if(e.lookahead<=BH){if(iK(e),e.lookahead<=BH&&t===yH)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,i=a[s],i===a[++s]&&i===a[++s]&&i===a[++s])){r=e.strstart+BH;do{}while(i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&s<r);e.match_length=BH-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=gH(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2})(n,t):cK[n.level].func(n,t);if(3!==i&&4!==i||(n.status=KH),1===i||3===i)return 0===e.avail_out&&(n.last_flush=-1),xH;if(2===i&&(t===vH?_H(n):t!==SH&&(mH(n,0,0,!1),t===EH&&(YH(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),QH(e),0===e.avail_out))return n.last_flush=-1,xH}return t!==bH?xH:n.wrap<=0?TH:(2===n.wrap?($H(n,255&e.adler),$H(n,e.adler>>8&255),$H(n,e.adler>>16&255),$H(n,e.adler>>24&255),$H(n,255&e.total_in),$H(n,e.total_in>>8&255),$H(n,e.total_in>>16&255),$H(n,e.total_in>>24&255)):(eK(n,e.adler>>>16),eK(n,65535&e.adler)),QH(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?xH:TH)},fK=(e,t)=>{let n=t.length;if(dK(e))return wH;const i=e.state,s=i.wrap;if(2===s||1===s&&i.status!==WH||i.lookahead)return wH;if(1===s&&(e.adler=cH(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){0===s&&(YH(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(n-i.w_size,n),0),t=e,n=i.w_size}const r=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,iK(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=JH(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,iK(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=a,e.input=o,e.avail_in=r,i.wrap=s,xH},gK={deflateInit:(e,t)=>pK(e,t,LH,15,8,kH),deflateInit2:pK,deflateReset:hK,deflateResetKeep:uK,deflateSetHeader:(e,t)=>dK(e)||2!==e.state.wrap?wH:(e.state.gzhead=t,xH),deflate:mK,deflateEnd:e=>{if(dK(e))return wH;const t=e.state.status;return e.state=null,t===HH?zH(e,NH):xH},deflateSetDictionary:fK,deflateInfo:"pako deflate (from Nodeca project)"};const _K=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var yK={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)_K(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,s=0,r=e.length;i<r;i++){let t=e[i];n.set(t,s),s+=t.length}return n}};let vK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){vK=!1}const EK=new Uint8Array(256);for(let n=0;n<256;n++)EK[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;EK[254]=EK[254]=1;var bK={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,s,r,a=e.length,o=0;for(s=0;s<a;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<a&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),r=0,s=0;r<o;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<a&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,s;const r=new Array(2*n);for(s=0,i=0;i<n;){let t=e[i++];if(t<128){r[s++]=t;continue}let a=EK[t];if(a>4)r[s++]=65533,i+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&i<n;)t=t<<6|63&e[i++],a--;a>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&vK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n})(r,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+EK[e[n]]>t?n:t}},SK=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xK=Object.prototype.toString,{Z_NO_FLUSH:TK,Z_SYNC_FLUSH:wK,Z_FULL_FLUSH:NK,Z_FINISH:CK,Z_OK:RK,Z_STREAM_END:IK,Z_DEFAULT_COMPRESSION:AK,Z_DEFAULT_STRATEGY:OK,Z_DEFLATED:DK}=hH;function kK(e){this.options=yK.assign({level:AK,method:DK,chunkSize:16384,windowBits:15,memLevel:8,strategy:OK},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SK,this.strm.avail_out=0;let n=gK.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==RK)throw new Error(uH[n]);if(t.header&&gK.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?bK.string2buf(t.dictionary):"[object ArrayBuffer]"===xK.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=gK.deflateSetDictionary(this.strm,e),n!==RK)throw new Error(uH[n]);this._dict_set=!0}}function PK(e,t){const n=new kK(t);if(n.push(e,!0),n.err)throw n.msg||uH[n.err];return n.result}kK.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?CK:TK,"string"==typeof e?n.input=bK.string2buf(e):"[object ArrayBuffer]"===xK.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(r===wK||r===NK)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=gK.deflate(n,r),s===IK)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=gK.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===RK;if(0!==n.avail_out){if(r>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},kK.prototype.onData=function(e){this.chunks.push(e)},kK.prototype.onEnd=function(e){e===RK&&(this.result=yK.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var LK={Deflate:kK,deflate:PK,deflateRaw:function(e,t){return(t=t||{}).raw=!0,PK(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,PK(e,t)},constants:hH};const jK=16209;var MK=function(e,t){let n,i,s,r,a,o,c,l,d,u,h,p,m,f,g,_,y,v,E,b,S,x,T,w;const N=e.state;n=e.next_in,T=e.input,i=n+(e.avail_in-5),s=e.next_out,w=e.output,r=s-(t-e.avail_out),a=s+(e.avail_out-257),o=N.dmax,c=N.wsize,l=N.whave,d=N.wnext,u=N.window,h=N.hold,p=N.bits,m=N.lencode,f=N.distcode,g=(1<<N.lenbits)-1,_=(1<<N.distbits)-1;e:do{p<15&&(h+=T[n++]<<p,p+=8,h+=T[n++]<<p,p+=8),y=m[h&g];t:for(;;){if(v=y>>>24,h>>>=v,p-=v,v=y>>>16&255,0===v)w[s++]=65535&y;else{if(!(16&v)){if(0==(64&v)){y=m[(65535&y)+(h&(1<<v)-1)];continue t}if(32&v){N.mode=16191;break e}e.msg="invalid literal/length code",N.mode=jK;break e}E=65535&y,v&=15,v&&(p<v&&(h+=T[n++]<<p,p+=8),E+=h&(1<<v)-1,h>>>=v,p-=v),p<15&&(h+=T[n++]<<p,p+=8,h+=T[n++]<<p,p+=8),y=f[h&_];n:for(;;){if(v=y>>>24,h>>>=v,p-=v,v=y>>>16&255,!(16&v)){if(0==(64&v)){y=f[(65535&y)+(h&(1<<v)-1)];continue n}e.msg="invalid distance code",N.mode=jK;break e}if(b=65535&y,v&=15,p<v&&(h+=T[n++]<<p,p+=8,p<v&&(h+=T[n++]<<p,p+=8)),b+=h&(1<<v)-1,b>o){e.msg="invalid distance too far back",N.mode=jK;break e}if(h>>>=v,p-=v,v=s-r,b>v){if(v=b-v,v>l&&N.sane){e.msg="invalid distance too far back",N.mode=jK;break e}if(S=0,x=u,0===d){if(S+=c-v,v<E){E-=v;do{w[s++]=u[S++]}while(--v);S=s-b,x=w}}else if(d<v){if(S+=c+d-v,v-=d,v<E){E-=v;do{w[s++]=u[S++]}while(--v);if(S=0,d<E){v=d,E-=v;do{w[s++]=u[S++]}while(--v);S=s-b,x=w}}}else if(S+=d-v,v<E){E-=v;do{w[s++]=u[S++]}while(--v);S=s-b,x=w}for(;E>2;)w[s++]=x[S++],w[s++]=x[S++],w[s++]=x[S++],E-=3;E&&(w[s++]=x[S++],E>1&&(w[s++]=x[S++]))}else{S=s-b;do{w[s++]=w[S++],w[s++]=w[S++],w[s++]=w[S++],E-=3}while(E>2);E&&(w[s++]=w[S++],E>1&&(w[s++]=w[S++]))}break}}break}}while(n<i&&s<a);E=p>>3,n-=E,p-=E<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<a?a-s+257:257-(s-a),N.hold=h,N.bits=p};const UK=15,VK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),FK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),BK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),GK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var WK=(e,t,n,i,s,r,a,o)=>{const c=o.bits;let l,d,u,h,p,m,f=0,g=0,_=0,y=0,v=0,E=0,b=0,S=0,x=0,T=0,w=null;const N=new Uint16Array(16),C=new Uint16Array(16);let R,I,A,O=null;for(f=0;f<=UK;f++)N[f]=0;for(g=0;g<i;g++)N[t[n+g]]++;for(v=c,y=UK;y>=1&&0===N[y];y--);if(v>y&&(v=y),0===y)return s[r++]=20971520,s[r++]=20971520,o.bits=1,0;for(_=1;_<y&&0===N[_];_++);for(v<_&&(v=_),S=1,f=1;f<=UK;f++)if(S<<=1,S-=N[f],S<0)return-1;if(S>0&&(0===e||1!==y))return-1;for(C[1]=0,f=1;f<UK;f++)C[f+1]=C[f]+N[f];for(g=0;g<i;g++)0!==t[n+g]&&(a[C[t[n+g]]++]=g);if(0===e?(w=O=a,m=20):1===e?(w=VK,O=FK,m=257):(w=BK,O=GK,m=0),T=0,g=0,f=_,p=r,E=v,b=0,u=-1,x=1<<v,h=x-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){R=f-b,a[g]+1<m?(I=0,A=a[g]):a[g]>=m?(I=O[a[g]-m],A=w[a[g]-m]):(I=96,A=0),l=1<<f-b,d=1<<E,_=d;do{d-=l,s[p+(T>>b)+d]=R<<24|I<<16|A}while(0!==d);for(l=1<<f-1;T&l;)l>>=1;if(0!==l?(T&=l-1,T+=l):T=0,g++,0==--N[f]){if(f===y)break;f=t[n+a[g]]}if(f>v&&(T&h)!==u){for(0===b&&(b=v),p+=_,E=f-b,S=1<<E;E+b<y&&(S-=N[E+b],!(S<=0));)E++,S<<=1;if(x+=1<<E,1===e&&x>852||2===e&&x>592)return 1;u=T&h,s[u]=v<<24|E<<16|p-r}}return 0!==T&&(s[p+T]=f-b<<24|64<<16),o.bits=v,0};const{Z_FINISH:HK,Z_BLOCK:KK,Z_TREES:zK,Z_OK:qK,Z_STREAM_END:YK,Z_NEED_DICT:XK,Z_STREAM_ERROR:JK,Z_DATA_ERROR:QK,Z_MEM_ERROR:ZK,Z_BUF_ERROR:$K,Z_DEFLATED:ez}=hH,tz=16180,nz=16190,iz=16191,sz=16192,rz=16194,az=16199,oz=16200,cz=16206,lz=16209,dz=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function uz(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const hz=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<tz||t.mode>16211?1:0},pz=e=>{if(hz(e))return JK;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=tz,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qK},mz=e=>{if(hz(e))return JK;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,pz(e)},fz=(e,t)=>{let n;if(hz(e))return JK;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?JK:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,mz(e))},gz=(e,t)=>{if(!e)return JK;const n=new uz;e.state=n,n.strm=e,n.window=null,n.mode=tz;const i=fz(e,t);return i!==qK&&(e.state=null),i};let _z,yz,vz=!0;const Ez=e=>{if(vz){_z=new Int32Array(512),yz=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(WK(1,e.lens,0,288,_z,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;WK(2,e.lens,0,32,yz,0,e.work,{bits:5}),vz=!1}e.lencode=_z,e.lenbits=9,e.distcode=yz,e.distbits=5},bz=(e,t,n,i)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>i&&(s=i),r.window.set(t.subarray(n-i,n-i+s),r.wnext),(i-=s)?(r.window.set(t.subarray(n-i,n),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var Sz=(e,t)=>{let n,i,s,r,a,o,c,l,d,u,h,p,m,f,g,_,y,v,E,b,S,x,T=0;const w=new Uint8Array(4);let N,C;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(hz(e)||!e.output||!e.input&&0!==e.avail_in)return JK;n=e.state,n.mode===iz&&(n.mode=sz),a=e.next_out,s=e.output,c=e.avail_out,r=e.next_in,i=e.input,o=e.avail_in,l=n.hold,d=n.bits,u=o,h=c,x=qK;e:for(;;)switch(n.mode){case tz:if(0===n.wrap){n.mode=sz;break}for(;d<16;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,w[0]=255&l,w[1]=l>>>8&255,n.check=dH(n.check,w,2,0),l=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=lz;break}if((15&l)!==ez){e.msg="unknown compression method",n.mode=lz;break}if(l>>>=4,d-=4,S=8+(15&l),0===n.wbits&&(n.wbits=S),S>15||S>n.wbits){e.msg="invalid window size",n.mode=lz;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:iz,l=0,d=0;break;case 16181:for(;d<16;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(n.flags=l,(255&EW(n))!==ez){e.msg="unknown compression method",n.mode=lz;break}if(57344&EW(n)){e.msg="unknown header flags set",n.mode=lz;break}n.head&&(n.head.text=l>>8&1),512&EW(n)&&4&n.wrap&&(w[0]=255&l,w[1]=l>>>8&255,n.check=dH(n.check,w,2,0)),l=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}n.head&&(n.head.time=l),512&EW(n)&&4&n.wrap&&(w[0]=255&l,w[1]=l>>>8&255,w[2]=l>>>16&255,w[3]=l>>>24&255,n.check=dH(n.check,w,4,0)),l=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&EW(n)&&4&n.wrap&&(w[0]=255&l,w[1]=l>>>8&255,n.check=dH(n.check,w,2,0)),l=0,d=0,n.mode=16184;case 16184:if(1024&EW(n)){for(;d<16;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}n.length=l,n.head&&(n.head.extra_len=l),512&EW(n)&&4&n.wrap&&(w[0]=255&l,w[1]=l>>>8&255,n.check=dH(n.check,w,2,0)),l=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&EW(n)&&(p=n.length,p>o&&(p=o),p&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(r,r+p),S)),512&EW(n)&&4&n.wrap&&(n.check=dH(n.check,i,p,r)),o-=p,r+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&EW(n)){if(0===o)break e;p=0;do{S=i[r+p++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&p<o);if(512&EW(n)&&4&n.wrap&&(n.check=dH(n.check,i,p,r)),o-=p,r+=p,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&EW(n)){if(0===o)break e;p=0;do{S=i[r+p++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&p<o);if(512&EW(n)&&4&n.wrap&&(n.check=dH(n.check,i,p,r)),o-=p,r+=p,S)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&EW(n)){for(;d<16;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=lz;break}l=0,d=0}n.head&&(n.head.hcrc=EW(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=iz;break;case 16189:for(;d<32;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}e.adler=n.check=dz(l),l=0,d=0,n.mode=nz;case nz:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=o,n.hold=l,n.bits=d,XK;e.adler=n.check=1,n.mode=iz;case iz:if(t===KK||t===zK)break e;case sz:if(n.last){l>>>=7&d,d-=7&d,n.mode=cz;break}for(;d<3;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}switch(n.last=1&l,l>>>=1,d-=1,3&l){case 0:n.mode=16193;break;case 1:if(Ez(n),n.mode=az,t===zK){l>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=lz}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=lz;break}if(n.length=65535&l,l=0,d=0,n.mode=rz,t===zK)break e;case rz:n.mode=16195;case 16195:if(p=n.length,p){if(p>o&&(p=o),p>c&&(p=c),0===p)break e;s.set(i.subarray(r,r+p),a),o-=p,r+=p,c-=p,a+=p,n.length-=p;break}n.mode=iz;break;case 16196:for(;d<14;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(n.nlen=257+(31&l),l>>>=5,d-=5,n.ndist=1+(31&l),l>>>=5,d-=5,n.ncode=4+(15&l),l>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=lz;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}n.lens[R[n.have++]]=7&l,l>>>=3,d-=3}for(;n.have<19;)n.lens[R[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,N={bits:n.lenbits},x=WK(0,n.lens,0,19,n.lencode,0,n.work,N),n.lenbits=N.bits,x){e.msg="invalid code lengths set",n.mode=lz;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;T=n.lencode[l&(1<<n.lenbits)-1],g=T>>>24,_=T>>>16&255,y=65535&T,!(g<=d);){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(y<16)l>>>=g,d-=g,n.lens[n.have++]=y;else{if(16===y){for(C=g+2;d<C;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(l>>>=g,d-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=lz;break}S=n.lens[n.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===y){for(C=g+3;d<C;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}l>>>=g,d-=g,S=0,p=3+(7&l),l>>>=3,d-=3}else{for(C=g+7;d<C;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}l>>>=g,d-=g,S=0,p=11+(127&l),l>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=lz;break}for(;p--;)n.lens[n.have++]=S}}if(n.mode===lz)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=lz;break}if(n.lenbits=9,N={bits:n.lenbits},x=WK(1,n.lens,0,n.nlen,n.lencode,0,n.work,N),n.lenbits=N.bits,x){e.msg="invalid literal/lengths set",n.mode=lz;break}if(n.distbits=6,n.distcode=n.distdyn,N={bits:n.distbits},x=WK(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,N),n.distbits=N.bits,x){e.msg="invalid distances set",n.mode=lz;break}if(n.mode=az,t===zK)break e;case az:n.mode=oz;case oz:if(o>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=o,n.hold=l,n.bits=d,MK(e,h),a=e.next_out,s=e.output,c=e.avail_out,r=e.next_in,i=e.input,o=e.avail_in,l=n.hold,d=n.bits,n.mode===iz&&(n.back=-1);break}for(n.back=0;T=n.lencode[l&(1<<n.lenbits)-1],g=T>>>24,_=T>>>16&255,y=65535&T,!(g<=d);){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(_&&0==(240&_)){for(v=g,E=_,b=y;T=n.lencode[b+((l&(1<<v+E)-1)>>v)],g=T>>>24,_=T>>>16&255,y=65535&T,!(v+g<=d);){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}l>>>=v,d-=v,n.back+=v}if(l>>>=g,d-=g,n.back+=g,n.length=y,0===_){n.mode=16205;break}if(32&_){n.back=-1,n.mode=iz;break}if(64&_){e.msg="invalid literal/length code",n.mode=lz;break}n.extra=15&_,n.mode=16201;case 16201:if(n.extra){for(C=n.extra;d<C;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;T=n.distcode[l&(1<<n.distbits)-1],g=T>>>24,_=T>>>16&255,y=65535&T,!(g<=d);){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(0==(240&_)){for(v=g,E=_,b=y;T=n.distcode[b+((l&(1<<v+E)-1)>>v)],g=T>>>24,_=T>>>16&255,y=65535&T,!(v+g<=d);){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}l>>>=v,d-=v,n.back+=v}if(l>>>=g,d-=g,n.back+=g,64&_){e.msg="invalid distance code",n.mode=lz;break}n.offset=y,n.extra=15&_,n.mode=16203;case 16203:if(n.extra){for(C=n.extra;d<C;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=lz;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=lz;break}p>n.wnext?(p-=n.wnext,m=n.wsize-p):m=n.wnext-p,p>n.length&&(p=n.length),f=n.window}else f=s,m=a-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{s[a++]=f[m++]}while(--p);0===n.length&&(n.mode=oz);break;case 16205:if(0===c)break e;s[a++]=n.length,c--,n.mode=oz;break;case cz:if(n.wrap){for(;d<32;){if(0===o)break e;o--,l|=i[r++]<<d,d+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=EW(n)?dH(n.check,s,h,a-h):cH(n.check,s,h,a-h)),h=c,4&n.wrap&&(EW(n)?l:dz(l))!==n.check){e.msg="incorrect data check",n.mode=lz;break}l=0,d=0}n.mode=16207;case 16207:if(n.wrap&&EW(n)){for(;d<32;){if(0===o)break e;o--,l+=i[r++]<<d,d+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=lz;break}l=0,d=0}n.mode=16208;case 16208:x=YK;break e;case lz:x=QK;break e;case 16210:return ZK;default:return JK}return e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=o,n.hold=l,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<lz&&(n.mode<cz||t!==HK))&&bz(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=EW(n)?dH(n.check,s,h,e.next_out-h):cH(n.check,s,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===iz?128:0)+(n.mode===az||n.mode===rz?256:0),(0===u&&0===h||t===HK)&&x===qK&&(x=$K),x},xz={inflateReset:mz,inflateReset2:fz,inflateResetKeep:pz,inflateInit:e=>gz(e,15),inflateInit2:gz,inflate:Sz,inflateEnd:e=>{if(hz(e))return JK;let t=e.state;return t.window&&(t.window=null),e.state=null,qK},inflateGetHeader:(e,t)=>{if(hz(e))return JK;const n=e.state;return 0==(2&n.wrap)?JK:(n.head=t,t.done=!1,qK)},inflateSetDictionary:(e,t)=>{const n=t.length;let i,s,r;return hz(e)?JK:(i=e.state,0!==i.wrap&&i.mode!==nz?JK:i.mode===nz&&(s=1,s=cH(s,t,n,0),s!==i.check)?QK:(r=bz(e,t,n,n),r?(i.mode=16210,ZK):(i.havedict=1,qK)))},inflateInfo:"pako inflate (from Nodeca project)"},Tz=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const wz=Object.prototype.toString,{Z_NO_FLUSH:Nz,Z_FINISH:Cz,Z_OK:Rz,Z_STREAM_END:Iz,Z_NEED_DICT:Az,Z_STREAM_ERROR:Oz,Z_DATA_ERROR:Dz,Z_MEM_ERROR:kz}=hH;function Pz(e){this.options=yK.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SK,this.strm.avail_out=0;let n=xz.inflateInit2(this.strm,t.windowBits);if(n!==Rz)throw new Error(uH[n]);if(this.header=new Tz,xz.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=bK.string2buf(t.dictionary):"[object ArrayBuffer]"===wz.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=xz.inflateSetDictionary(this.strm,t.dictionary),n!==Rz)))throw new Error(uH[n])}function Lz(e,t){const n=new Pz(t);if(n.push(e),n.err)throw n.msg||uH[n.err];return n.result}Pz.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let r,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Cz:Nz,"[object ArrayBuffer]"===wz.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),r=xz.inflate(n,a),r===Az&&s&&(r=xz.inflateSetDictionary(n,s),r===Rz?r=xz.inflate(n,a):r===Dz&&(r=Az));n.avail_in>0&&r===Iz&&n.state.wrap>0&&0!==e[n.next_in];)xz.inflateReset(n),r=xz.inflate(n,a);switch(r){case Oz:case Dz:case Az:case kz:return this.onEnd(r),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||r===Iz))if("string"===this.options.to){let e=bK.utf8border(n.output,n.next_out),t=n.next_out-e,s=bK.buf2string(n.output,e);n.next_out=t,n.avail_out=i-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==Rz||0!==o){if(r===Iz)return r=xz.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Pz.prototype.onData=function(e){this.chunks.push(e)},Pz.prototype.onEnd=function(e){e===Rz&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=yK.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jz={Inflate:Pz,inflate:Lz,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Lz(e,t)},ungzip:Lz,constants:hH};const{Deflate:Mz,deflate:Uz,deflateRaw:Vz,gzip:Fz}=LK,{Inflate:Bz,inflate:Gz,inflateRaw:Wz,ungzip:Hz}=jz;var Kz=Uz,zz=Gz,qz=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(qz||{});class Yz{constructor(){uw(this,"_sequence",0),uw(this,"_startTime",Date.now()),uw(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const i={id:0,length:4,data:n.buffer},s={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[i]};t.commonPacketHeader.extension=1,t.extension=s,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;RA("SHOW_DATASTREAM2_LOG")&&aO.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),i=new Uint8Array(n),s=new DataView(n);let r=0;if(s.setUint16(r,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),r+=2,s.setUint32(r,t.commonPacketHeader.sequence,!0),r+=4,s.setUint16(r,t.commonStreamHeader,!0),r+=2,t.extension){const e=this.serializeExtension(t.extension);i.set(new Uint8Array(e),r),r+=e.byteLength}if(i.set(new Uint8Array(t.payload),r),r+=t.payload.byteLength,r!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const i=t.getUint16(n,!0);n+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let r,a;if(n+=4,RA("SHOW_DATASTREAM2_LOG")&&aO.debug("receive data header: ".concat(JSON.stringify(s))),t.getUint16(n,!0),n+=2,s.extension){a=this.deserializeExtension(e.slice(n)),n+=2+a.length,r=e.slice(n);let t=!1;if(a.datas.length>0){const e=a.datas.find(e=>0===e.id);e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}r=t?this.decompress(r):r}else r=e.slice(8);return r}serializeExtension(e){const{profile:t,length:n,datas:i}=e,s=new ArrayBuffer(n+2),r=new Uint8Array(s),a=new DataView(s);let o=0;if(a.setUint8(o++,t),a.setUint8(o++,n),i.forEach(e=>{t?(a.setUint8(o++,e.id),a.setUint8(o++,e.length),r.set(new Uint8Array(e.data),o),o+=e.data.byteLength):(a.setUint8(o++,e.id|e.length<<4),r.set(new Uint8Array(e.data),o),o+=e.data.byteLength)}),o!==n+2)throw Error("serialize extension error, is ".concat(o,"!==").concat(n+2));return s}deserializeExtension(e){const t=new DataView(e);let n=0;const i=t.getUint8(n);n++;const s=t.getUint8(n);n++;const r=i===qz.TWO_BYTE,a=[],o=new DataView(e,2);let c=0;for(;c<s;){let e=0,t=0,n=new ArrayBuffer(0);r?(e=o.getUint8(c),c++,t=o.getUint8(c),c++):(e=15&o.getUint8(c),t=o.getUint8(c)>>4,c++),t>0&&(n=o.buffer.slice(c+2,c+2+t),c+=n.byteLength),a.push({id:e,length:t,data:n})}if(c!==s)throw Error("parse error");return{profile:i,length:s,datas:a}}decompress(e){return zz(new Uint8Array(e))}compress(e){return Kz(new Uint8Array(e))}}const Xz={name:"DataStream",create:(e,t)=>{const n=t?new eL(e):new tL(e);return n.useDataStream(new Yz),n}};class Jz extends HR{constructor(e,t,n){super(),uw(this,"ws",void 0),uw(this,"requestId",1),uw(this,"heartBeatTimer",void 0),uw(this,"joinInfo",void 0),uw(this,"clientId",void 0),uw(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),uw(this,"onClose",e=>{this.emit("close"),this.dispose()}),uw(this,"onMessage",e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)}),this.joinInfo=e,this.clientId=t,this.ws=new JM("cross-channel-".concat(this.clientId),n),this.ws.on(Bj.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Bj.CONNECTED,this.onOpen),this.ws.on(Bj.ON_MESSAGE,this.onMessage),this.ws.on(Bj.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new np((t,n)=>{const i=window.setTimeout(()=>{n(new fO(RR.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(i),s.state&&0!==s.state?n(new fO(RR.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),n(new fO(RR.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new fO(RR.WS_DISCONNECT);const t=()=>new np((e,t)=>{this.ws.once(Bj.CLOSED,()=>t(new fO(RR.WS_ABORT))),this.ws.once(Bj.CONNECTED,e)});"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),i=new np((e,t)=>{const i=()=>{t(new fO(RR.WS_ABORT))};this.ws.once(Bj.RECONNECTING,i),this.ws.once(Bj.CLOSED,i),this.once("req_".concat(n),e),TI(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(Bj.RECONNECTING,i),this.ws.off(Bj.CLOSED,i),t(new fO(RR.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||200!==s.code)throw new fO(RR.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners(Bj.REQUEST_NEW_URLS),this.ws.on(Bj.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Qz extends HR{set state(e){e!==this._state&&(e!==tM.RELAY_STATE_FAILURE&&(this.errorCode=nM.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,i,s){super(),uw(this,"joinInfo",void 0),uw(this,"sid",void 0),uw(this,"clientId",void 0),uw(this,"cancelToken",jC.CancelToken.source()),uw(this,"workerToken",void 0),uw(this,"requestId",0),uw(this,"signal",void 0),uw(this,"prevChannelMediaConfig",void 0),uw(this,"httpRetryConfig",void 0),uw(this,"_resolution",void 0),uw(this,"_state",tM.RELAY_STATE_IDLE),uw(this,"errorCode",nM.RELAY_OK),uw(this,"onStatus",e=>{aO.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nM.SRC_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nM.DEST_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE))}),uw(this,"onReconnect",async()=>{aO.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",eM.NETWORK_DISCONNECTED),this.state=tM.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{this.state!==tM.RELAY_STATE_IDLE&&(aO.error("auto restart channel media relay failed",e.toString()),this.errorCode=nM.SERVER_CONNECTION_LOST,this.state=tM.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=NI(),this.signal=new Jz(this.joinInfo,this.clientId,n),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_IDLE)throw new fO(RR.INVALID_OPERATION);this.state=tM.RELAY_STATE_CONNECTING,await this.connect(),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_RUNNING)throw new fO(RR.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==tM.RELAY_STATE_RUNNING)throw new fO(RR.INVALID_OPERATION);const t=this.genMessage($j.SetVideoProfile);await this.signal.request(t),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),aO.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tM.RELAY_STATE_IDLE,this.dispose()}dispose(){aO.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=jC.CancelToken.source(),this.state=tM.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await VV(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",eM.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage($j.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage($j.SetSdkProfile,e);await this.signal.request(n),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage($j.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",eM.PACKET_JOINED_SRC_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage($j.SetSourceUserId,e);await this.signal.request(s),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const r=this.genMessage($j.SetDestChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",eM.PACKET_JOINED_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage($j.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",eM.PACKET_SENT_TO_DEST_CHANNEL),this.state=tM.RELAY_STATE_RUNNING,aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage($j.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",eM.PACKET_UPDATE_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage($j.StopPacketTransfer);await this.signal.request(e),aO.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],i=[],s=[];this.requestId+=1;const r={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:yA,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.24.0"===r.sdkVersion&&(r.sdkVersion="0.0.1");let a=null,o=null;switch(e){case $j.SetSdkProfile:return r.clientRequest={command:"SetSdkProfile",type:"multi_channel"},r;case $j.SetSourceChannel:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(RR.UNEXPECTED_ERROR,"can not find source config");return r.clientRequest={command:"SetSourceChannel",uid:"0",channelName:o.channelName,token:o.token||this.joinInfo.appId},r;case $j.SetSourceUserId:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(RR.UNEXPECTED_ERROR,"can not find source config");return r.clientRequest={command:"SetSourceUserId",uid:o.uid+""},r;case $j.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(RR.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),i.push(e.uid+""),s.push(e.token||this.joinInfo.appId)}),r.clientRequest={command:"SetDestChannel",channelName:n,uid:i,token:s},r;case $j.StartPacketTransfer:return r.clientRequest={command:"StartPacketTransfer"},r;case $j.Reconnect:return r.clientRequest={command:"Reconnect"},r;case $j.StopPacketTransfer:return r.clientRequest={command:"StopPacketTransfer"},r;case $j.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(RR.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),i.push(e.uid+""),s.push(e.token||this.joinInfo.appId)}),r.clientRequest={command:"UpdateDestChannel",channelName:n,uid:i,token:s},r;case $j.SetVideoProfile:r.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return r}}const Zz={name:"ChannelMediaRelay",create:function(e){return new Qz(e.joinInfo,e.clientId,e.websocketRetryConfig||FI,e.httpRetryConfig||FI,e.resolution)}};function $z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function eq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$z(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class tq extends HR{constructor(e,t,n,i){super(),uw(this,"spec",void 0),uw(this,"token",void 0),uw(this,"websocket",void 0),uw(this,"pingpongTimer",void 0),uw(this,"reconnectMode","retry"),uw(this,"serviceMode",void 0),uw(this,"reqId",0),uw(this,"commandReqId",0),uw(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),uw(this,"handleWebSocketMessage",e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(mO.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===Hj.TRANSCODE?1:2}),this.emit(Xj.PUBLISH_STREAM_STATUS,t))}),this.spec=t,this.token=e,this.serviceMode=i,this.websocket=new JM("live-streaming",n),this.websocket.on(Bj.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Bj.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Bj.REQUEST_NEW_URLS,(e,t)=>{rI(this,Xj.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(Bj.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,n,i){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const s=this.commandReqId,r=this.reqId;if(!r||!this.websocket)throw new fO(RR.UNEXPECTED_ERROR);const a=eq({command:e,sdkVersion:"4.24.0"===yA?"0.0.1":yA,seq:r,requestId:r,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new fO(RR.WS_DISCONNECT);const o=()=>new np((e,t)=>{this.websocket.once(Bj.CLOSED,()=>t(new fO(RR.WS_ABORT))),this.websocket.once(Bj.CONNECTED,e)});"connected"!==this.websocket.state&&await o(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const c=new np((e,t)=>{const n=()=>{t(new fO(RR.WS_ABORT))};this.websocket.once(Bj.RECONNECTING,n),this.websocket.once(Bj.CLOSED,n),this.once("@".concat(r,"-").concat(this.spec.sid),t=>{e(t)})});i&&mO.workerEvent(this.spec.sid,eq(eq({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let d=null;try{d=await c}catch(i){if("closed"===this.websocket.state)throw i;return await o(),await this.request(e,t,n)}return i&&mO.workerEvent(this.spec.sid,eq(eq({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-l})),200!==d.code&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.24.0"===yA?"0.0.1":yA;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Qj.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void aO.warning("live stream response already exists stream");case Qj.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Qj.LIVE_STREAM_RESPONSE_BAD_STREAM:case Qj.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new fO(RR.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Qj.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new fO(RR.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new fO(RR.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Xj.WARNING,t,e.serverResponse.url)}case Qj.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new fO(RR.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Xj.WARNING,t,e.serverResponse.url)}case Qj.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Qj.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new fO(RR.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new fO(RR.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Xj.WARNING,t,e.serverResponse.url)}case Qj.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Qj.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Qj.LIVE_STREAM_RESPONSE_WORKER_LOST:case Qj.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Qj.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Qj.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new fO(RR.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(CI)},6e3)}}function nq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function iq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nq(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class sq extends HR{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FI;super(),uw(this,"onLiveStreamWarning",void 0),uw(this,"onLiveStreamError",void 0),uw(this,"spec",void 0),uw(this,"retryTimeout",1e4),uw(this,"connection",void 0),uw(this,"httpRetryConfig",void 0),uw(this,"wsRetryConfig",void 0),uw(this,"streamingTasks",new Map),uw(this,"isStartingStreamingTask",!1),uw(this,"taskMutex",new UI("live-streaming")),uw(this,"cancelToken",jC.CancelToken.source()),uw(this,"transcodingConfig",void 0),uw(this,"uapResponse",void 0),uw(this,"lastTaskId",1),uw(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=iq(iq({},Yj),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(aO.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(e=>iq(iq(iq({},Kj),e),{},{zOrder:e.zOrder?e.zOrder+1:1}))),function(e){jR(e.width)||DR(e.width,"config.width",0,1e4),jR(e.height)||DR(e.height,"config.height",0,1e4),jR(e.videoBitrate)||DR(e.videoBitrate,"config.videoBitrate",1,1e6),jR(e.videoFrameRate)||DR(e.videoFrameRate,"config.videoFrameRate"),jR(e.lowLatency)||AR(e.lowLatency,"config.lowLatency"),jR(e.audioSampleRate)||OR(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),jR(e.audioBitrate)||DR(e.audioBitrate,"config.audioBitrate",1,128),jR(e.audioChannels)||OR(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),jR(e.videoGop)||DR(e.videoGop,"config.videoGop"),jR(e.videoCodecProfile)||OR(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),jR(e.userCount)||DR(e.userCount,"config.userCount",0,17),jR(e.backgroundColor)||DR(e.backgroundColor,"config.backgroundColor",0,16777215),jR(e.userConfigExtraInfo)||PR(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!jR(e.transcodingUsers)&&(LR(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((e,t)=>{Wj(e.uid),jR(e.x)||DR(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),jR(e.y)||DR(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),jR(e.width)||DR(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),jR(e.height)||DR(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),jR(e.zOrder)||DR(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),jR(e.alpha)||DR(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),jR(e.watermark)||qj(e.watermark,"watermark"),jR(e.backgroundImage)||qj(e.backgroundImage,"backgroundImage"),e.images&&!jR(e.images)&&(LR(e.images,"config.images"),e.images.forEach((e,t)=>{qj(e,"images[".concat(t,"]"))}))}(t);const n=[];t.images&&n.push(...t.images.map(e=>iq(iq(iq({},zj),e),{},{zOrder:255}))),t.backgroundImage&&(n.push(iq(iq(iq({},zj),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(iq(iq(iq({},zj),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(e=>iq({},e)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const i=(t.userConfigs||[]).map(e=>"number"==typeof e.uid?np.resolve(e.uid):PV(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await np.all(i)).forEach((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)}),this.transcodingConfig=t,this.connection)try{var s;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(up(s=this.streamingTasks).call(s)).map(e=>e.taskId).join("#")});aO.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(t=>{aO.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then(()=>{aO.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))}).catch(e=>{aO.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)})})}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===Hj.TRANSCODE)throw new fO(RR.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};aO.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const s=await this.taskMutex.lock();if(!this.connection&&n)return void s();if(this.streamingTasks.get(e)&&!n)return s(),new fO(RR.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw s(),e}switch(t){case Hj.TRANSCODE:i.transcodingConfig=iq({},this.transcodingConfig);case Hj.RAW:}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const r=this.lastTaskId++;try{const a=new np((t,i)=>{TI(this.retryTimeout).then(()=>{if(n)return i(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),i(t)):void 0})}),o=await np.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===Hj.TRANSCODE?1:2,requestByUser:!n,tid:r.toString()}),a]);this.isStartingStreamingTask=!1,aO.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(o.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:r}),s()}catch(i){if(s(),this.isStartingStreamingTask=!1,!i.data||!i.data.retry||n)throw i;return i.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,i)):await this.startLiveStreamingTask(e,t,i)}}stopLiveStreamingTask(e){return new np((t,n)=>{const i=this.streamingTasks.get(e);if(!i||!this.connection)return new fO(RR.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:s===Hj.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(n=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(n)})}resetAllTask(){var e;const t=Array.from(up(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch(e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=jC.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new fO(RR.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await rI(this,Jj.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new tq(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Xj.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(Xj.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(Xj.REQUEST_NEW_ADDRESS,(t,n)=>{if(!this.connection)return n(new fO(RR.UNEXPECTED_ERROR,"can not get new live streaming address list"));rI(this,Jj.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(n)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),i=e.reason;switch(e.code){case Qj.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Qj.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const i=new fO(RR.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return aO.error(i.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,i);if(!this.isStartingStreamingTask)return;this.statusError.set(t,i)}case Qj.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new fO(RR.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case Qj.LIVE_STREAM_RESPONSE_WORKER_LOST:case Qj.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(up(s=this.streamingTasks).call(s));for(const n of t)n.abortTask?n.abortTask():(aO.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{aO.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)}).catch(e=>{aO.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const rq={name:"LiveStreaming",create:function(e){return new sq(e.joinInfo,e.websocketRetryConfig||FI,e.httpRetryConfig||FI)}};function aq(e){let t=_q();return function(e,t){let n=e.appId;void 0!==n&&(Oq(t,10),Tq(t,n));let i=e.cid;void 0!==i&&(Oq(t,16),Oq(t,i));let s=e.cname;void 0!==s&&(Oq(t,26),Tq(t,s));let r=e.deviceId;void 0!==r&&(Oq(t,34),Tq(t,r));let a=e.elapse;void 0!==a&&(Oq(t,40),Dq(t,a));let o=e.fileSize;void 0!==o&&(Oq(t,48),Dq(t,fq(o)));let c=e.height;void 0!==c&&(Oq(t,56),Dq(t,fq(c)));let l=e.jpg;void 0!==l&&(Oq(t,66),Oq(t,l.length),function(e,t){let n=bq(e,t.length);e.bytes.set(t,n)}(t,l));let d=e.networkType;void 0!==d&&(Oq(t,72),Dq(t,fq(d)));let u=e.osType;void 0!==u&&(Oq(t,80),Dq(t,fq(u)));let h=e.requestId;void 0!==h&&(Oq(t,90),Tq(t,h));let p=e.sdkVersion;void 0!==p&&(Oq(t,98),Tq(t,p));let m=e.sequence;void 0!==m&&(Oq(t,104),Dq(t,fq(m)));let f=e.sid;void 0!==f&&(Oq(t,114),Tq(t,f));let g=e.timestamp;void 0!==g&&(Oq(t,120),Dq(t,g));let _=e.uid;void 0!==_&&(Oq(t,128),Oq(t,_));let y=e.vid;void 0!==y&&(Oq(t,136),Oq(t,y));let v=e.width;void 0!==v&&(Oq(t,144),Dq(t,fq(v)));let E=e.service;void 0!==E&&(Oq(t,152),Oq(t,E));let b=e.callbackData;void 0!==b&&(Oq(t,162),Tq(t,b));let S=e.jpgEncryption;void 0!==S&&(Oq(t,168),Oq(t,S));let x=e.requestType;void 0!==x&&(Oq(t,176),Oq(t,x));let T=e.scorePorn;void 0!==T&&(Oq(t,185),Iq(t,T));let w=e.scoreSexy;void 0!==w&&(Oq(t,193),Iq(t,w));let N=e.scoreNeutral;void 0!==N&&(Oq(t,201),Iq(t,N));let C=e.scene;void 0!==C&&(Oq(t,208),Oq(t,C));let R=e.ossFilePrefix;void 0!==R&&(Oq(t,218),Tq(t,R));let I=e.serviceVendor;if(void 0!==I)for(let A of I){Oq(t,226);let e=_q();lq(A,e),Oq(t,e.limit),wq(t,e),yq(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function oq(e){return function(e){let t={};e:for(;!Eq(e);){let n=Aq(e);switch(n>>>3){case 0:break e;case 1:t.code=Aq(e);break;case 2:t.msg=xq(e,Aq(e));break;case 3:{let n=dq(e);t.data=cq(e),e.limit=n;break}default:uq(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function cq(e){let t={};e:for(;!Eq(e);){let n=Aq(e);switch(n>>>3){case 0:break e;case 1:t.requestId=xq(e,Aq(e));break;case 2:t.requestType=Aq(e)>>>0;break;case 3:t.scorePorn=Rq(e);break;case 4:t.scoreSexy=Rq(e);break;case 5:t.scoreNeutral=Rq(e);break;case 6:t.requestScene=Aq(e)>>>0;break;case 7:t.scene=Aq(e)>>>0;break;default:uq(e,7&n)}}return t}function lq(e,t){let n=e.service;void 0!==n&&(Oq(t,8),Oq(t,n));let i=e.vendor;void 0!==i&&(Oq(t,16),Oq(t,i));let s=e.token;void 0!==s&&(Oq(t,26),Tq(t,s));let r=e.callbackUrl;void 0!==r&&(Oq(t,34),Tq(t,r))}function dq(e){let t=Aq(e),n=e.limit;return e.limit=e.offset+t,n}function uq(e,t){switch(t){case 0:for(;128&Nq(e););break;case 2:vq(e,Aq(e));break;case 5:vq(e,4);break;case 1:vq(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let hq=new Float32Array(1);new Uint8Array(hq.buffer);let pq=new Float64Array(1),mq=new Uint8Array(pq.buffer);function fq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let gq=[];function _q(){const e=gq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function yq(e){gq.push(e)}function vq(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Eq(e){return e.offset>=e.limit}function bq(e,t){let n=e.bytes,i=e.offset,s=e.limit,r=i+t;if(r>n.length){let t=new Uint8Array(2*r);t.set(n),e.bytes=t}return e.offset=r,r>s&&(e.limit=r),i}function Sq(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function xq(e,t){let n=Sq(e,t),i=String.fromCharCode,s=e.bytes,r="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=s[o+n];0==(128&u)?a+=i(u):192==(224&u)?o+1>=t?a+=r:(e=s[o+n+1],128!=(192&e)?a+=r:(d=(31&u)<<6|63&e,d<128?a+=r:(a+=i(d),o++))):224==(240&u)?o+2>=t?a+=r:(e=s[o+n+1],c=s[o+n+2],32896!=(49344&(e|c<<8))?a+=r:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=r:(a+=i(d),o+=2))):240==(248&u)?o+3>=t?a+=r:(e=s[o+n+1],c=s[o+n+2],l=s[o+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=r:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=r:(d-=65536,a+=i(55296+(d>>10),56320+(1023&d)),o+=3))):a+=r}return a}function Tq(e,t){let n=t.length,i=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),i+=e<128?1:e<2048?2:e<65536?3:4}Oq(e,i);let s=bq(e,i),r=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?r[s++]=e:(e<2048?r[s++]=e>>6&31|192:(e<65536?r[s++]=e>>12&15|224:(r[s++]=e>>18&7|240,r[s++]=e>>12&63|128),r[s++]=e>>6&63|128),r[s++]=63&e|128)}}function wq(e,t){let n=bq(e,t.limit),i=e.bytes,s=t.bytes;for(let r=0,a=t.limit;r<a;r++)i[r+n]=s[r]}function Nq(e){return e.bytes[Sq(e,1)]}function Cq(e,t){let n=bq(e,1);e.bytes[n]=t}function Rq(e){let t=Sq(e,8),n=e.bytes;return mq[0]=n[t++],mq[1]=n[t++],mq[2]=n[t++],mq[3]=n[t++],mq[4]=n[t++],mq[5]=n[t++],mq[6]=n[t++],mq[7]=n[t++],pq[0]}function Iq(e,t){let n=bq(e,8),i=e.bytes;pq[0]=t,i[n++]=mq[0],i[n++]=mq[1],i[n++]=mq[2],i[n++]=mq[3],i[n++]=mq[4],i[n++]=mq[5],i[n++]=mq[6],i[n++]=mq[7]}function Aq(e){let t,n=0,i=0;do{t=Nq(e),n<32&&(i|=(127&t)<<n),n+=7}while(128&t);return i}function Oq(e,t){for(t>>>=0;t>=128;)Cq(e,127&t|128),t>>>=7;Cq(e,t)}function Dq(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,r=0===s?0===i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,a=bq(e,r),o=e.bytes;switch(r){case 10:o[a+9]=s>>>7&1;case 9:o[a+8]=9!==r?128|s:127&s;case 8:o[a+7]=8!==r?i>>>21|128:i>>>21&127;case 7:o[a+6]=7!==r?i>>>14|128:i>>>14&127;case 6:o[a+5]=6!==r?i>>>7|128:i>>>7&127;case 5:o[a+4]=5!==r?128|i:127&i;case 4:o[a+3]=4!==r?n>>>21|128:n>>>21&127;case 3:o[a+2]=3!==r?n>>>14|128:n>>>14&127;case 2:o[a+1]=2!==r?n>>>7|128:n>>>7&127;case 1:o[a]=1!==r?128|n:127&n}}function kq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}const Pq=new Map([["moderation",1],["supervise",2]]);class Lq extends HR{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(TM.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=ss(t=e.map(e=>Pq.get(e)||0)).call(t,(e,t)=>e+t),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),uw(this,"name","AgoraRTCVideoContentInspect"),uw(this,"_connectionState",SM.CONNECTING),uw(this,"_innerConnectionState",void 0),uw(this,"sequence",0),uw(this,"inspectStartTime",void 0),uw(this,"workerManagerConnection",void 0),uw(this,"workerConnection",void 0),uw(this,"workerMessageLengthLimit",void 0),uw(this,"inspectIntervalMinimum",void 0),uw(this,"qualityRatio",void 0),uw(this,"_connectInfo",void 0),uw(this,"_cancelTokenSource",jC.CancelToken.source()),uw(this,"_retryConfig",void 0),uw(this,"wmSequence",0),uw(this,"inspectInterval",void 0),uw(this,"inspectTimer",null),uw(this,"ossFilePrefix",void 0),uw(this,"extraInfo",void 0),uw(this,"_inspectType",void 0),uw(this,"_inspectMode",void 0),uw(this,"_quality",1),uw(this,"qualityTimer",null),uw(this,"_inspectId",void 0),uw(this,"_needWorkUrlOnly",!1),uw(this,"inspectImage",()=>{if(this.connectionState!==SM.CONNECTED)throw new fO(RR.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===SM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=wI(5,"inspect-"),this.workerMessageLengthLimit=RA("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=RA("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=RA("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new JM("worker-manager-"+this._inspectId,FI),this.on(TM.STATE_CHANGE,(e,t)=>{this._innerConnectionState=e,aO.debug("[".concat(this._inspectId,"] Inspect operation :").concat(xM[e]," ").concat(t||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new JM("worker-"+this._inspectId,FI),this.handleWorkerEvents()}async init(e,t){this.emit(TM.STATE_CHANGE,xM.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np((i,s)=>{this.on(TM.CONNECTION_STATE_CHANGE,(e,t)=>{t===SM.CONNECTED&&i()}),this.requestAP(e,n,t).then(e=>{this.connectWorkerManager(e)}).catch(e=>{s(e)})})}async requestAP(e,t,n){const i=RA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),s=await function(e,t,n,i){let{appId:s,areaCode:r,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="image_moderation_api",u={service_name:d,json_body:JSON.stringify({appId:s,areaCode:r,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,token:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GI(async()=>{h=Date.now();const e=await rV(m,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const i=RA("VIDEO_INSPECT_WORKER_MANAGER_HOST"),s=RA("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(i,":").concat(s||n)}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,responseTime:p}},(t,n)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==RR.OPERATION_ABORTED&&t.code!==RR.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)),i)}(i,e,t,n);this.emit(TM.STATE_CHANGE,xM.AP_CONNECTED);const{addressList:r}=s;return this.wmSequence++,r}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(TM.STATE_CHANGE,xM.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Bj.CONNECTED,async()=>{this.emit(TM.STATE_CHANGE,xM.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Bj.CLOSED,()=>{this._innerConnectionState<xM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Bj.FAILED,()=>{this._innerConnectionState<xM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Bj.RECONNECTING,()=>{this._innerConnectionState<xM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Bj.ON_MESSAGE,async e=>{this.emit(TM.STATE_CHANGE,xM.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw aO.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new fO(RR.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw aO.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new fO(RR.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=RA("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,i=t.replace(/:\d+\/?$/,":".concat(e));this.emit(TM.STATE_CHANGE,xM.CONNECT_WORKER,i),this._needWorkUrlOnly?this.emit(TM.REQUEST_NEW_WORKER_URL,i):await this.connectWorker(i)}}),this.workerManagerConnection.on(Bj.WILL_RECONNECT,(e,t,n)=>{n(e)}),this.workerManagerConnection.on(Bj.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(Bj.CONNECTED,async()=>{this.emit(TM.STATE_CHANGE,xM.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=SM.CONNECTED}),this.workerConnection.on(Bj.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=oq(new Uint8Array(e.data));if(RA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&aO.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(TM.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},i=ss(t=Object.keys(e)).call(t,(t,n)=>e[t]>e[n]?t:n,"porn"),s=Object.keys(e).find(e=>e===i);this.emit(TM.INSPECT_RESULT,s)}else this.emit(TM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(TM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else aO.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(TM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Bj.CLOSED,()=>{this.connectionState=SM.CLOSED}),this.workerConnection.on(Bj.FAILED,()=>{this.connectionState=SM.CLOSED}),this.workerConnection.on(Bj.RECONNECTING,()=>{this.connectionState=this.connectionState===SM.CONNECTED?SM.RECONNECTING:SM.CONNECTING}),this.workerConnection.on(Bj.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this.workerConnection.on(Bj.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(TM.REQUEST_NEW_WORKER_URL,t=>{e([t])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e=>{this.connectWorkerManager(e,!0)}).catch(e=>{t(e)})})}async requestToInspectImage(){this.sequence++;const e=oI(this,TM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(TM.INSPECT_RESULT,void 0,new fO(RR.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(TM.INSPECT_RESULT,void 0,new fO(RR.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:i,cid:s,vid:r,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await QD(l,n,i),u=this.sequence+"-"+s+"-"+o+"-"+c+"-"+wI(12,""),h={appId:n,cid:s,cname:i,deviceId:"",elapse:(p=Number(c-this.inspectStartTime),{low:p|=0,high:p>>31,unsigned:p>=0}),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this.sequence,sid:a,timestamp:uG(c),uid:o,vid:r,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var p;void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const m=aq(h);if(m.byteLength<this.workerMessageLengthLimit){if(RA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kq(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return m}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:i,cid:s,vid:r,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=jC.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=SM.CLOSED,this.emit(TM.STATE_CHANGE,xM.CLOSED)}}const jq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new fO(RR.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new fO(RR.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach(e=>{var t;if(!Pi(t=["supervise","moderation"]).call(t,e))throw new fO(RR.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(RR.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Lq(t)}};var Mq=i(ee.Object.getOwnPropertySymbols),Uq=On,Vq=Jn.indexOf,Fq=Hi,Bq=w([].indexOf),Gq=!!Bq&&1/Bq([1],1,-0)<0;Uq({target:"Array",proto:!0,forced:Gq||!Fq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Gq?Bq(this,e,t)||0:Vq(this,e,t)}});var Wq=ei("Array","indexOf"),Hq=u,Kq=Wq,zq=Array.prototype,qq=function(e){var t=e.indexOf;return e===zq||Hq(zq,e)&&t===zq.indexOf?Kq:t},Yq=i(qq);function Xq(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==Yq(t).call(t,i))continue;n[i]=e[i]}return n}(e,t);if(Mq){var r=Mq(e);for(i=0;i<r.length;i++)n=r[i],-1===Yq(t).call(t,n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}let Jq=class{get localCapabilities(){return pI(this._localCapabilities)}get rtpCapabilities(){return pI(this._rtpCapabilities)}get candidates(){return pI(this._candidates)}get iceParameters(){return pI(this._iceParameters)}get dtlsParameters(){return pI(this._dtlsParameters)}constructor(e){uw(this,"sessionDesc",void 0),uw(this,"_localCapabilities",void 0),uw(this,"_rtpCapabilities",void 0),uw(this,"_candidates",void 0),uw(this,"_iceParameters",void 0),uw(this,"_dtlsParameters",void 0),uw(this,"setup",void 0),uw(this,"currentMidIndex",void 0),uw(this,"cname","o/i14u9pJrxRKAsu"),uw(this,"firefoxSsrcMidMap",new Map),e=pI(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:s,localCapabilities:r,direction:a,setup:o,videoCodec:c,audioCodec:l}=e;let d;this.setup=o,d=a===Fj.RECEIVE_ONLY?VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=s,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=r;const u=a===Fj.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===Fj.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===Fj.RECEIVE_ONLY?s.send.videoCodecs:UU(fM.VIDEO,u,h,c),m=a===Fj.RECEIVE_ONLY?s.send.audioCodecs:UU(fM.AUDIO,u,h,l);for(const f of d.mediaDescriptions)f.attributes.iceUfrag=t.iceUfrag,f.attributes.icePwd=t.icePwd,f.attributes.fingerprints=n.fingerprints,f.attributes.candidates=i,f.attributes.setup=this.setup,"application"===f.media.mediaType&&(f.attributes.sctpPort="5000"),"video"===f.media.mediaType&&(f.media.fmts=p.map(e=>e.payloadType.toString(10)),f.attributes.payloads=p,f.attributes.extmaps=u.videoExtensions),"audio"===f.media.mediaType&&(f.media.fmts=m.map(e=>e.payloadType.toString(10)),f.attributes.payloads=m,f.attributes.extmaps=u.audioExtensions,MU(f));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return FA(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,s){n=n.replace(/ /g,"-");const{ssrcs:r,ssrcGroups:a}=NU(t,this.cname,RA("SYNC_GROUP")?n:void 0),o=this.findPreloadMediaDesc(r);if(o){if(nR()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,o.attributes.mid),s&&(s.twcc||s.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(o,s),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,r,i);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,r,a,"sendonly",i,s),this.updateBundleMids()):(n=pI(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=r,n.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,s)),nR()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{e.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(e=>{const s=e._mediaStreamTrack.kind,r=this.findAvailableRecvMediaIndex(s);let a,o=!1;-1===r?(o=!0,a=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(a=pI(this.sessionDesc.mediaDescriptions[r]),a.attributes.direction="recvonly"),i.push({mid:a.attributes.mid,needCreateTransceiver:o})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:s,type:r,relatedAddress:a,relatedPort:o,priority:c}=new RTCIceCandidate(e),l={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=i?i:"",port:s?s+"":"",type:r?r+"":"",relAddr:null!=a?a:"",relPort:o?o+"":"",extension:{}};this.candidates.some(e=>e.priority===l.priority&&e.connectionAddress===l.connectionAddress&&e.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,s){const r=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,o=UU(r,a,this.localCapabilities.send,r===fM.AUDIO?s:i),c=r===fM.VIDEO?a.videoExtensions:a.audioExtensions,l="".concat(++this.currentMidIndex);let d={media:{mediaType:r,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);const u=this.findFirstClosedMedia(r);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Pi(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Pi(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===e&&"0"!==i.media.port&&("sendonly"===i.attributes.direction||"sendrecv"===i.attributes.direction)&&0===i.attributes.ssrcs.length;if(nR()){if(s){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==i.attributes.mid&&"1"!==i.attributes.mid)||!(!e||e!==i.attributes.mid)}return!1}return s&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=pI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,s,r){const a=this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;nR()&&(s="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:s}};l=this.mungSendMediaDesc(l,r);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,n){const i=pI(e);return RU(i),CU(i,t),IU(i,t),AU(i),OU(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=pI(e);return OU(n,t,this.localCapabilities.recv),MU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>nR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}};const Qq=["sdp"];var Zq;function $q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function eY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$q(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let tY=(Zq=class e extends pM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),uw(this,"direction",void 0),uw(this,"name",void 0),uw(this,"store",void 0),uw(this,"spec",void 0),uw(this,"peerConnection",void 0),uw(this,"initialOffer",void 0),uw(this,"transport",void 0),uw(this,"statsFilter",void 0),uw(this,"localCandidateCount",0),uw(this,"_isInRestartIce",!1),uw(this,"mutex",void 0),uw(this,"onLocalCandidate",void 0),uw(this,"remoteSDP",void 0),uw(this,"pendingCandidates",[]),uw(this,"localCapabilities",void 0),uw(this,"isReady",!1),uw(this,"restartCnt",0),uw(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new UI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=i?i:Fj.SEND_ONLY,this.name=this.direction===Fj.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,nR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await kU();if(this.localCapabilities=jU(t),e){const{sdp:t}=e,n=Xq(e,Qq),i=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(LU(t,e,"videoExtensions",n,i,s),LU(t,e,"videoCodecs",n,i,s),LU(t,e,"audioExtensions",n,i,s),LU(t,e,"audioCodecs",n,i,s),RA("RAISE_H264_BASELINE_PRIORITY")){const e=s.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=s.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const n=s.videoCodecs[e];s.videoCodecs.splice(e,1),s.videoCodecs.splice(t,0,n)}-1!==t&&RA("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:i,sendrecv:s}}({},{},t);this.remoteSDP=new Jq({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const r=SU(s.sdp);await this.peerConnection.setLocalDescription(s);const a=await PU({},{},s.sdp);this.localCapabilities=jU(a);const o=this.peerConnection.getTransceivers()[0];return null!=o&&o.receiver&&o.receiver.transport&&this.tryBindTransportEvents(o.receiver.transport),eY(eY({},r),{},{sdp:s.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=SU(e.sdp);return this.initialOffer=e,eY(eY({},t),{},{sdp:e.sdp})}}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:i}=e,s=await PU({},{},t);this.remoteSDP=new Jq({remoteIceParameters:n,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const r=this.peerConnection.getTransceivers()[0];null!=r&&r.sender&&r.sender.transport&&this.tryBindTransportEvents(r.sender.transport)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(e=>{this.peerConnection.addIceCandidate(e)}),this.pendingCandidates=[])}catch(e){throw new IR(RR.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var i=this;return YN(function*(){const s=yield JN(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[],r=i.remoteSDP.receive(e,t,n);e.forEach((e,t)=>{if(r[t].needCreateTransceiver){const t=i.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});s.push(t),e._updateRtpTransceiver(t)}else{const n=i.peerConnection.getTransceivers().find(e=>e.mid===r[t].mid);if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(r[t].mid));s.push(n),e._updateRtpTransceiver(n)}}),nR()&&!0===RA("SIMULCAST")&&(yield JN(i.applySimulcastForFirefox(s,e)));const a=r.map(e=>e.mid),o=yield JN(i.peerConnection.createOffer()),c=i.mungSendOfferSDP(o.sdp,e,a),l=VA(c),d=a.map(e=>{const t=l.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return xU(t,RA("USE_PUB_RTX"))}),u=s.map((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}});yield JN(i.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield u}catch(e){const n=i.remoteSDP.toString();throw yield JN(i.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JN(i.peerConnection.setRemoteDescription({type:"answer",sdp:n})),yield JN(i.stopSending(a,!0)),e}yield JN(i.applySimulcastEncodings(s,e)),yield JN(i.applySendEncodings(s,e));const h=i.remoteSDP.toString(),p=i.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield JN(i.setRemoteDescription({type:"answer",sdp:h})),s.map((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}})}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{s()}})()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map(e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const s=this.remoteSDP.toString();null==i||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:r}=this.remoteSDP.send(e,t,n,i);if(r){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer(),r=this.mungReceiveAnswerSDP(i.sdp,s,e);null==n||n(r||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:r}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(e=>e.mid===s);if(!a||null===a.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:r}=this.remoteSDP.send(e,t,n,i);if(r){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer(),r=this.mungReceiveAnswerSDP(i.sdp,s,e);null==n||n(r||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:r}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===EA.Auto&&(this.store.p2pTransport=EA.SdRtn,_O().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,_O().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=SU(e.sdp);return this.store.descriptionStart(),this.direction===Fj.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Fj.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=SU(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==r||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?nR()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:i}=t.getSelectedCandidatePair();return{local:eY(eY({},$I),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:eY(eY({},$I),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Pi(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s={iceServers:[]};var r;return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZR(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,i)),RA("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),Pi(r=[EA.Relay,EA.SdRtn]).call(r,n)&&(s.iceTransportPolicy="relay"),RA("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(s.iceTransportPolicy="relay")}))),RA("ENABLE_ENCODED_TRANSFORM")&&_O().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),aO.debug("P2PConnection p2pTransport is ".concat(n)),s}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=[],s=e.filter(e=>e.tcpport);aO.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(n));const r=s.length>n?s[n]:s[0];switch(t){case EA.SdRtn:const t=e.filter(e=>{var t;return Pi(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL}),s=t.length>n?t[n]:t[0];s&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(nU(s.turnServerURL),":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(nU(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;case EA.Relay:r&&(i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=udp")}),i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(nU(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}));break;default:r&&(i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=udp")}),i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(nU(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}),i.push({username:r.username,credential:r.password,credentialType:"password",urls:"stun:".concat(r.turnServerURL,":").concat(r.tcpport)}))}return i}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair()||{};if(e&&n){const t=e.address+":"+e.port,i=n.address+":"+n.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(t)),", remote ").concat(JSON.stringify(hU(i))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!_O().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(e._encoderConfig){var r;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:i}=e._encoderConfig;t&&(s.maxBitrate=1e3*t),Pi(r=e._hints).call(r,UO.LOW_STREAM)&&(n&&(s.maxFramerate=rU(n)),i&&i>=1&&(s.scaleResolutionDownBy=i))}if(RA("DSCP_TYPE")&&SR()){var a;const e=RA("DSCP_TYPE");Pi(a=["very-low","low","medium","high"]).call(a,e)&&(s.networkPriority=e)}const o=t.getParameters(),c=null===(n=o.encodings)||void 0===n?void 0:n[0];nR()&&!c&&(i.encodings=[s]),c&&Object.assign(c,s),Object.assign(o,i),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await t.setParameters(o)}async applySendEncodings(e,t){try{if(!_O().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const i=e[n],s=t[n];s instanceof PP&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const i=VA(e);return t.forEach((e,t)=>{const s=n[t],r=i.mediaDescriptions.find(e=>e.attributes.mid===s);r&&(CU(r,e),DU(r,e,this.store.codec))}),FA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var n,i,s,r,a;const c=e[o],l=t[o];if(l instanceof PP&&!Pi(n=l._hints).call(n,UO.LOW_STREAM)&&null!==(i=l._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(s=l._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(r=l._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nR()&&e.length===t.length)for(let n=0;n<e.length;n++){const i=t[n];if(i instanceof PP&&this.isVP8Simulcast(i)){const t=e[n],s={},r={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:r.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:r.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,s))}}}isVP8Simulcast(e){var t,n,i,s,r;return!!(e instanceof PP&&RA("SIMULCAST")&&"vp8"===this.store.codec&&!Pi(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(i=e._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(s=e._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(r=e._scalabilityMode)||void 0===r?void 0:r.numSpatialLayers)>1)}logSDPExchange(e,t,n,i){if(RA("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(i,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",i)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();null==i||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async e=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();null==i||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n;if(t=null!=t?t:null===(n=this.currentRemoteDescription)||void 0===n?void 0:n.sdp){var i;const n=null===(i=VA(t).mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===i?void 0:i.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Pi(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const i=VA(e),s=i.mediaDescriptions.find(e=>e.attributes.mid===t);return s&&n===fM.AUDIO&&"audio"===s.media.mediaType&&MU(s),FA(i)}},Ij(Zq.prototype,"establish",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"establish"),Zq.prototype),Ij(Zq.prototype,"connect",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"connect"),Zq.prototype),Ij(Zq.prototype,"receive",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"receive"),Zq.prototype),Ij(Zq.prototype,"mockReceive",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"mockReceive"),Zq.prototype),Ij(Zq.prototype,"stopReceiving",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"stopReceiving"),Zq.prototype),Ij(Zq.prototype,"restartICE",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"restartICE"),Zq.prototype),Ij(Zq.prototype,"close",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"close"),Zq.prototype),Ij(Zq.prototype,"updateEncoderConfig",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateEncoderConfig"),Zq.prototype),Ij(Zq.prototype,"updateSendParameters",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateSendParameters"),Zq.prototype),Ij(Zq.prototype,"replaceTrack",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"replaceTrack"),Zq.prototype),Ij(Zq.prototype,"muteLocal",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"muteLocal"),Zq.prototype),Ij(Zq.prototype,"unmuteLocal",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"unmuteLocal"),Zq.prototype),Zq);function nY(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return await i.apply(this,r)}finally{n()}},n}let iY=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var sY,rY,aY,oY,cY,lY,dY,uY,hY,pY,mY,fY;function gY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gY(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let yY=(sY=vY(iY.SEND_ONLY),rY=vY(iY.SEND_ONLY),aY=vY(),oY=vY(iY.RECEIVE_ONLY),cY=vY(iY.RECEIVE_ONLY),lY=vY(iY.RECEIVE_ONLY),dY=vY(iY.RECEIVE_ONLY),uY=vY(iY.RECEIVE_ONLY),hY=vY(iY.RECEIVE_ONLY),pY=vY(),mY=vY(iY.RECEIVE_ONLY),fY=class extends HR{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(bM.StateChange,t,this._state)}constructor(e,t){super(),uw(this,"isPlanB",!1),uw(this,"store",void 0),uw(this,"statsUploader",void 0),uw(this,"sendConnection",void 0),uw(this,"recvConnection",void 0),uw(this,"localTrackMap",new Map),uw(this,"remoteUserMap",new Map),uw(this,"localDataChannels",[]),uw(this,"pendingLocalTracks",[]),uw(this,"pendingRemoteTracks",[]),uw(this,"statsCollector",void 0),uw(this,"dtlsFailedCount",0),uw(this,"sendMutex",void 0),uw(this,"recvMutex",void 0),uw(this,"_state",EM.Disconnected),uw(this,"_restartStates",["disconnected","failed"]),uw(this,"reconnectInterval",void 0),uw(this,"uploadUnplinkStarted",!1),uw(this,"uploadDownlinkStarted",!1),uw(this,"uplinkStateUploadInterval",void 0),uw(this,"downlinkStatsUploadInterval",void 0),uw(this,"handleMuteLocalTrack",async(e,t,n)=>{const i=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const i=this.filterTobeMutedTracks(e);if(0===i.length)return void t();const a=i.find(e=>"videoLowTrack"===e[0]);a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(i.map(e=>{let[,{id:t}]=e;return t}));let o=!1;var s,r;o="video"===e.trackMediaType?!(null===(s=this.localTrackMap.get(vM.LocalAudioTrack))||void 0===s||!s.track._muted):void 0===(null===(r=this.localTrackMap.get(vM.LocalVideoTrack))||void 0===r?void 0:r.id);const c=this.createMuteMessage(i);await aI(this,bM.RequestMuteLocal,c);const l="video"===e.trackMediaType?DM.MUTE_LOCAL_VIDEO:DM.MUTE_LOCAL_AUDIO;await aI(this,bM.RequestP2PMuteLocal,{action:l,message:c,isMuteAll:o}),t()}catch(e){n(e)}finally{i()}}),uw(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const i=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const i=this.filterTobeUnmutedTracks(e);if(0===i.length)return void t();await this.sendConnection.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t}));const s=this.createUnmuteMessage(i),r="video"===e.trackMediaType?DM.UNMUTE_LOCAL_VIDEO:DM.UNMUTE_LOCAL_AUDIO;await aI(this,bM.RequestP2PMuteLocal,{action:r,message:s}),t()}catch(e){n(e)}finally{i()}}),uw(this,"handleUpdateVideoEncoder",async(e,t,n,i)=>{let s;"boolean"==typeof i&&i||(s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(vM.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:i,track:s}=n;i&&(await this.sendConnection.updateSendParameters(i,s),await this.sendConnection.updateEncoderConfig(i,s),this.emit(bM.UpdateVideoEncoder,s)),t()}catch(e){n(e)}finally{var r;null===(r=s)||void 0===r||r()}}),uw(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const i=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(vM.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:i,track:s}=n;i&&await this.sendConnection.updateSendParameters(i,s),t()}catch(e){n(e)}finally{i()}}),uw(this,"handleReplaceTrack",async(e,t,n,i)=>{let s;aO.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof i&&i||(s=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var r;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.sendConnection||!n||void 0===n[1].id||this.state!==EM.Connected)return void t();if(await(null===(r=this.sendConnection)||void 0===r?void 0:r.replaceTrack(e,n[1].id)),n[0]===vM.LocalVideoTrack&&_O().supportDualStreamEncoding){const t=this.localTrackMap.get(vM.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=s)||void 0===a||a()}}),uw(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uw(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uw(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uw(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(e),this.bindStatsUploaderEvents(),this.sendMutex=new UI("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new UI("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))})},RA("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new tY(e,this.store,Fj.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=EM.New,this.sendConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new tY(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EM.Connected}async addRemoteCandidate(e,t){if(t===Fj.RECEIVE_ONLY){if(!this.sendConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return YN(function*(){const s=yield JN(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==EM.Connected){i.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===i.pendingLocalTracks.indexOf(e));return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(t))}i.store.pubId=i.store.pubId+1,zV.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(e,t,n);if(0===s.length)return void(yield JN(i.tryToUnmuteAudio(e)));s.forEach(e=>{let{track:t,type:n}=e;const s=Date.now();i.store.publish(t.getTrackId(),n===vM.LocalAudioTrack?"audio":"video",s)}),i.bindLocalTrackEvents(s);const r=yield JN(i.sendConnection.send(s.map(e=>{let{track:t}=e;return t}),i.store.codec,i.store.audioCodec)),a=(yield JN(r.next())).value,o=i.createGatewayPublishMessage(s,a);try{yield o}catch(e){throw r.throw(e),(null==e?void 0:e.code)===RR.WS_ABORT&&s.forEach(e=>{let{track:t}=e;-1===i.pendingLocalTracks.indexOf(t)&&i.pendingLocalTracks.push(t)}),i.unbindLocalTrackEvents(s),e}yield JN(r.next()),s.forEach(e=>{let{type:t}=e;i.statsCollector.addLocalStats(t)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(s,a),s.forEach(e=>{let{track:t,type:n}=e;const s=Date.now();i.store.publish(t.getTrackId(),n===vM.LocalAudioTrack?"audio":"video",void 0,s)}),i.startUploadUplinkState()}finally{s()}})()}async unpublish(e){if(!this.sendConnection||this.state!==EM.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(t=>!Pi(e).call(e,t)));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===EM.Connected)return n&&n[1].track.close(),i;e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s,ssrcs:r}]=n;const a={stream_type:gF(s,i),ssrcs:r};s._muted||!s._enabled?e.push(a):t.push(a)}),e.length>0&&e.forEach(e=>{aI(this,bM.RequestMuteLocal,[e])}),t.length>0&&t.forEach(e=>{aI(this,bM.RequestUnmuteLocal,[e])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return YN(function*(){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rI(this,bM.RequestRePublish,this.pendingLocalTracks),this.emit(bM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var s;if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(s=this.remoteUserMap.get(e))&&void 0!==s&&s.has(t))return;const{track:r,mid:a,transceiver:o}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(r):(e._audioTrack=new QP(r,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),o&&e._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(r):(e._videoTrack=new JP(r,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),o&&e._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex(n=>{let{user:i,kind:s}=n;return i.uid===e.uid&&t===s});-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(bM.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(n=>{let{user:i,kind:s}=n;return void 0!==t?i.uid===e.uid&&t===s:i.uid===e.uid});if(i.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.recvConnection||n||i.forEach(t=>{let{kind:n}=t;var i;if(n===fM.AUDIO)null===(i=e._audioTrack)||void 0===i||i._destroy(),e._audioTrack=void 0;else if(n===fM.VIDEO){var s;null===(s=e._videoTrack)||void 0===s||s._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const s=this.filterTobeUnSubscribedTracks(e,t);0!==s.length&&(await this.recvConnection.stopReceiving(s.map(e=>{let[,{id:t}]=e;return t})),this.withdrawRemoteTracks(s),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach(e=>{let[t,{kind:i}]=e;var s,r;if(i===fM.VIDEO&&t._videoSSRC&&(null===(s=this.recvConnection)||void 0===s||s.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),i===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0);else if(i===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),s.forEach(e=>{let[,{kind:t}]=e;aI(this,bM.RequestP2PMuteRemote,t)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[fM.VIDEO,fM.AUDIO].forEach(e=>{t.has(e)?aI(this,bM.RequestP2PUnmuteRemote,e):aI(this,bM.RequestP2PMuteRemote,e)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==i&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(vM.LocalAudioTrack);if((null==t?void 0:t.track)instanceof Wk){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==vM.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===vM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===vM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}reportPublishEvent(e,t,n,i,s){if(e){const n=this.localTrackMap.get(vM.LocalAudioTrack),r=i?this.localTrackMap.get(vM.LocalVideoLowTrack):this.localTrackMap.get(vM.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==r?void 0:r.track.getTrackLabel(),screenshare:-1!==(null==r?void 0:r.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!n,video:!!r,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var r;n||(n=[]);const a=n.find(e=>e instanceof Fk),o=i?null===(r=this.localTrackMap.get(vM.LocalVideoTrack))||void 0===r?void 0:r.track:n.find(e=>e instanceof PP);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,i){const s=i===fM.VIDEO?n._videoSSRC:n._audioSSRC;s&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===fM.VIDEO,audio:i===fM.AUDIO,peerid:n.uid,subscribeRequestid:i===fM.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,s)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new UI("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new UI("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(vM.LocalAudioTrack);if((null==e?void 0:e.track)instanceof Wk){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=EM.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(vM.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(vM.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof PP||t&&t.track instanceof Fk?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(vM.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=EM.Reconnecting,RA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case vM.LocalVideoTrack:Pi(t=i._hints).call(t,UO.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case vM.LocalAudioTrack:i instanceof Wk?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case vM.LocalVideoLowTrack:}}),this.emit(bM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(bM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:s}=n;if((e instanceof ZV?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===Fj.SEND_ONLY){if(!this.sendConnection)throw new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const e=await i.restartICE(t);return i.isInRestartIce=!1,e}{const e=await i.restartICE();if(e){const t=await rI(this,bM.RequestP2PRestartICE,{direction:Fj.RECEIVE_ONLY,iceParameter:e});await i.restartICE(t),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(vM.LocalVideoTrack),n=this.localTrackMap.get(vM.LocalAudioTrack),i=e.videoSend.find(e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)}),s=e.audioSend.find(e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)});if(!i||!s)return 1;const r=oI(this,bM.NeedSignalRTT),a=i?i.rttMs:void 0,o=s?s.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&r?(c+r)/2:c||r)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return GL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const s=i._audioSSRC,r=i._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===s),o=e.videoRecv.find(e=>e.ssrc===r);if(!a&&!o)return void(t+=1);const c=oI(this,bM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],s=_O(),r=this.getAllTracks();e=uI(e=e.filter(e=>-1===r.indexOf(e)));let a=!1,o=!1;for(const c of e){if(c instanceof PP&&(this.localTrackMap.has(vM.LocalVideoTrack)||a?new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:vM.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);i.push({track:e,type:vM.LocalVideoLowTrack})}if(c instanceof Fk){const e=this.localTrackMap.get(vM.LocalAudioTrack);if(e){if(!(e.track instanceof Wk))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(o){const e=i.find(e=>{let{type:t}=e;return t===vM.LocalAudioTrack});if(!(e.track instanceof Wk))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!s.webAudioMediaStreamDest||c instanceof Wk||c._bypassWebAudio)i.push({track:c,type:vM.LocalAudioTrack});else{const e=new Wk;e.addAudioTrack(c),i.push({track:e,type:vM.LocalAudioTrack})}o=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=uI(e=e.filter(e=>-1!==n.indexOf(e)));for(const i of e){if(i instanceof Fk){const e=this.localTrackMap.get(vM.LocalAudioTrack);if(!e)continue;e.track instanceof Wk?(e.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),0===e.track.trackList.length&&(t.push([vM.LocalAudioTrack,e]),e.track.close())):t.push([vM.LocalAudioTrack,e])}if(i instanceof PP){const e=this.localTrackMap.get(vM.LocalVideoTrack);if(!e)continue;t.push([vM.LocalVideoTrack,e]);const n=this.localTrackMap.get(vM.LocalVideoLowTrack);n&&t.push([vM.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case vM.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case vM.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case vM.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Wk?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case vM.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case vM.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case vM.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Wk?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var i;let s,{track:r,type:a}=e;switch(a){case vM.LocalAudioTrack:s=iM.Audio;break;case vM.LocalVideoTrack:s=Pi(i=r._hints).call(i,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalVideoLowTrack:s=iM.Low}return{kind:a===vM.LocalAudioTrack?fM.AUDIO:fM.VIDEO,stream_type:s,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:r.muted||!r.enabled}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[i,{track:s,ssrcs:r,id:a}]=e;switch(i){case vM.LocalVideoTrack:n=Pi(t=s._hints).call(t,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalAudioTrack:n=iM.Audio;break;case vM.LocalVideoLowTrack:n=iM.Low}return{stream_type:n,ssrcs:r,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:i,type:s}=e;this.localTrackMap.set(s,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(bM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Pi(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await TI(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YR.TRACER}).onSuccess(),this.emit(bM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(i=n.audioTrack)||void 0===i||i.emit(HO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,i="relay"===t.candidateType;"unknown"!==t.candidateType&&n===i||this.emit(bM.ConnectionTypeChange,n),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(bM.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Fj.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,aO.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Fj.SEND_ONLY?this.restartICE(e):rI(this,bM.RequestP2PRestartICE,{direction:Fj.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(vM.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Wk)return n.track.isActive||t.push([vM.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(i&&(t.push(i),i[0]===vM.LocalVideoTrack)){const e=this.localTrackMap.get(vM.LocalVideoLowTrack);e&&t.push([vM.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(vM.LocalAudioTrack);if(e instanceof Fk&&(null==n?void 0:n.track)instanceof Wk)return n.track.isActive&&t.push([vM.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(i)if(i[0]===vM.LocalVideoTrack){t.push(i);const e=this.localTrackMap.get(vM.LocalVideoLowTrack);e&&t.push([vM.LocalVideoLowTrack,e])}else t.push(i);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[i,{track:s,ssrcs:r,id:a}]=e;switch(i){case vM.LocalAudioTrack:n=iM.Audio;break;case vM.LocalVideoTrack:n=Pi(t=s._hints).call(t,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalVideoLowTrack:n=iM.Low}return{stream_type:n,ssrcs:r,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[i,{track:s,ssrcs:r,id:a}]=e;switch(i){case vM.LocalAudioTrack:n=iM.Audio;break;case vM.LocalVideoTrack:n=Pi(t=s._hints).call(t,UO.SCREEN_TRACK)?iM.Screen:iM.High;break;case vM.LocalVideoLowTrack:n=iM.Low}return{stream_type:n,ssrcs:r,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const s=i.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach(t=>{let[i,s]=t;n.push([e,{kind:i,id:s}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:i,id:s}]=e;switch(i){case fM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:n._videoSSRC}));case fM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const i=this.remoteUserMap.get(t);i&&(i.delete(n),0===Array.from(i.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(vM.LocalVideoTrack),n=this.localTrackMap.get(vM.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Fk){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const i=this.createUnmuteMessage(n);return void await aI(this,bM.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(bM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(bM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await TI(BI(this.dtlsFailedCount,FI)),this.emit(bM.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(vM.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof PP)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof PP).length>1)throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Fk).length>1&&(e.some(e=>e instanceof Fk&&e._bypassWebAudio)||!_O().webAudioMediaStreamDest))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof PP&&this.pendingLocalTracks.some(e=>e instanceof PP))throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fk&&this.pendingLocalTracks.some(e=>e instanceof Fk)&&(!_O().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Fk&&e._bypassWebAudio)))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&_O().supportDualStreamEncoding,i=_Y(_Y({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=n?e._mediaStreamTrack.clone():RF(e,i);const r=wI(8,"track-low-"),a=new PP(s,_Y(_Y({},n&&{scaleResolutionDownBy:dU(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,r);return a.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),a._hints.push(UO.LOW_STREAM),e.addListener(MO.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var s;const r=Array.from(XA(s=this.remoteUserMap).call(s)).find(t=>t._videoSSRC===e);if(r){i||this.store.subscribe(r.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,a=s.subscribe.find(e=>e.userId===r.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:r._uintid,videowidth:t,videoheight:n,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const s=i.get(t);if(!s)return!1;const r=await this.recvConnection.getRemoteSSRC(s);return void 0!==r&&r!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new IR(RR.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new IR(RR.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}async preConnect(e){throw new IR(RR.NOT_SUPPORTED)}getEstablishParams(){throw new IR(RR.NOT_SUPPORTED)}async reSubscribe(e){throw new IR(RR.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new IR(RR.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===vM.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VO.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ij(fY.prototype,"p2pConnect",[sY],Object.getOwnPropertyDescriptor(fY.prototype,"p2pConnect"),fY.prototype),Ij(fY.prototype,"unpublish",[rY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublish"),fY.prototype),Ij(fY.prototype,"unpublishLowStream",[aY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublishLowStream"),fY.prototype),Ij(fY.prototype,"subscribe",[oY],Object.getOwnPropertyDescriptor(fY.prototype,"subscribe"),fY.prototype),Ij(fY.prototype,"mockSubscribe",[cY],Object.getOwnPropertyDescriptor(fY.prototype,"mockSubscribe"),fY.prototype),Ij(fY.prototype,"unsubscribe",[lY],Object.getOwnPropertyDescriptor(fY.prototype,"unsubscribe"),fY.prototype),Ij(fY.prototype,"muteRemote",[dY],Object.getOwnPropertyDescriptor(fY.prototype,"muteRemote"),fY.prototype),Ij(fY.prototype,"unmuteRemote",[uY],Object.getOwnPropertyDescriptor(fY.prototype,"unmuteRemote"),fY.prototype),Ij(fY.prototype,"hasRemoteMediaWithLock",[hY],Object.getOwnPropertyDescriptor(fY.prototype,"hasRemoteMediaWithLock"),fY.prototype),Ij(fY.prototype,"disconnectForReconnect",[pY],Object.getOwnPropertyDescriptor(fY.prototype,"disconnectForReconnect"),fY.prototype),Ij(fY.prototype,"remoteMediaSsrcChanged",[mY],Object.getOwnPropertyDescriptor(fY.prototype,"remoteMediaSsrcChanged"),fY.prototype),fY);function vY(e){return function(t,n,i){const s=t[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];switch(e){case iY.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,i)}finally{e()}}case iY.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,i)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,i)}finally{e(),t()}}}},i}}class EY extends HR{constructor(e,t){super(),uw(this,"signal",void 0),uw(this,"token",void 0),uw(this,"tokenTimeout",void 0),uw(this,"tokenInterval",void 0),uw(this,"_sequence",0),uw(this,"userMap",new Map),uw(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===Lj.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*RA("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,i,s){var r;if(0===this.userMap.size)return;const a=Array.from(up(r=this.userMap).call(r))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),i=null!=i?i:wI(6,""),s=null!=s?s:this._sequence++;const o={_id:i,_type:e,_seq:s,_message:t,token:"".concat(this.token,"_").concat(a)};RA("SHOW_P2P_LOG")&&aO.debug("send message",o,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(o)).forEach(e=>{this.signal.request(Mj.DATA_STREAM,{payload:yI(this.encoder.encode(e))})});const c=new np((t,s)=>{const r=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),a),this.off("res-@".concat(i),l),this.off(OM.ABORT,c),aO.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(i)),0===this.userMap.size?s(new IR(RR.INVALID_REMOTE_USER)):s(new IR(RR.TIMEOUT))},RA("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{r&&window.clearTimeout(r),this.off(OM.ABORT,c),n&&t()},c=()=>{r&&window.clearTimeout(r),this.off("res-@".concat(i,"_ack"),a),this.off("res-@".concat(i),l),s(new IR(RR.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(i)))};this.once(OM.ABORT,c),this.once("res-@".concat(i,"_ack"),a);const l=(n,o)=>{d=!0,r&&window.clearTimeout(r),this.off("res-@".concat(i,"_ack"),a),this.off(OM.ABORT,c),"success"===n?t(o):s(new IR(RR.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(i)))};let d=!1;n||(this.once("res-@".concat(i),l),TI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d||aO.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(i,", ").concat(o))}))});try{return await c}catch(r){if(r.code===RR.TIMEOUT)return await this.send(e,t,n,i,s);throw r}}onMessage(e){var t;const{_uid:n}=e;let i,s=this.userMap.get(n);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==AM.CHECK)return;const{token:t}=e;i=new Map,s={uid:n,isStart:!0,token:t,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,s),this.signal.emit(Vj.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var r;const{id:t,total:s}=e,a=null!==(r=i.get(t))&&void 0!==r?r:[];if(a.push(e),i.has(t)||i.set(t,a),a.length!==s)return;{const s=Xp(a).call(a,(e,t)=>e.index-t.index).map(e=>e.payload).join("");i.delete(t),(e=JSON.parse(s))._uid=n}}const{_type:a,token:o}=e;if(Pi(t=[AM.ACK,AM.CHECK]).call(t,a))return a===AM.CHECK&&this.handleCheckToken(s,o),void this.receiveMessage(e);o==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):aO.debug('Receive unexpected message", '.concat(o,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:wI(6,""),token:this.token,_type:AM.CHECK};RA("SHOW_P2P_LOG")&&aO.debug("send message",e),this.signal.request(Mj.DATA_STREAM,{payload:yI(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:AM.ACK,token:this.token};RA("SHOW_P2P_LOG")&&aO.debug("send message",t),this.signal.request(Mj.DATA_STREAM,{payload:yI(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(AM.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach(e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const i=t.get(n);t.delete(n),this.receiveMessage(i),e.nextExpectedSequenceNumber++}})};if(!e)return void t();const{_uid:n,_seq:i}=e,s=this.userMap.get(n),{receivedMessagesMap:r,isStart:a,nextExpectedSequenceNumber:o}=s;if(i<o)return this.ack(e._id),void aO.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));r.set(i,e),a&&i===o&&(this.receiveMessage(e),r.delete(o),s.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:i,_uid:s}=e;if(RA("SHOW_P2P_LOG")&&aO.debug("receive message",e),t){let r;switch(e._type!==AM.ACK&&(i&&(r=JSON.parse(i)),this.ack(e._id)),e._type){case AM.CANDIDATE:case AM.CONTROL:this.signal.emit(n,r,s);break;case AM.PUBLISH:case AM.UNPUBLISH:case AM.RESTART_ICE:case AM.CALL:r.uid=s,rI(this.signal,n,r).then(t=>{this.response(e._id,t)}).catch(()=>{this.response(e._id,void 0,!0)});break;case AM.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case AM.RESPONSE:{const{success:e,message:n}=r;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<EY.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),i=wI(6,"");let s=0,r=800;const a=Math.ceil(e.length/r);for(;e.length>0;){s++;const o={id:i,index:s,total:a,payload:e.slice(0,r),token:"".concat(this.token,"_").concat(n)};JSON.stringify(o).length>EY.MAX_MESSAGE_SIZE?r-=50:(t.push(o),e=e.slice(r))}return t.map(e=>JSON.stringify(e))}handleCheckToken(e,t){return e.token!==t?(aO.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{aO.debug("token timeout, ".concat(t)),this.reset(e.uid)},RA("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await rI(this.signal,AM.CALL,void 0),t=await this.send(AM.CALL,e);this.signal.emit(jj.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(OM.ABORT),this.signal.emit(Vj.ON_USER_OFFLINE,{uid:n.uid,reason:kM.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(aO.debug("change local token from ".concat(t," to ").concat(t)),this.token=wI(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(OM.ABORT)}}uw(EY,"MAX_SIZE",1),uw(EY,"MAX_MESSAGE_SIZE",1024);class bY extends HR{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Lj.CONNECTED?this.emit(jj.WS_CONNECTED):e===Lj.RECONNECTING?this.emit(jj.WS_RECONNECTING,this._websocketReconnectReason):e===Lj.CLOSED&&this.emit(jj.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uw(this,"_disconnectedReason",void 0),uw(this,"_websocketReconnectReason",void 0),uw(this,"_connectionState",Lj.CLOSED),uw(this,"reconnectToken",void 0),uw(this,"p2pToken",void 0),uw(this,"websocket",void 0),uw(this,"openConnectionTime",void 0),uw(this,"clientId",void 0),uw(this,"lastMsgTime",Date.now()),uw(this,"uploadCache",[]),uw(this,"uploadCacheInterval",void 0),uw(this,"rttRolling",new HI(5)),uw(this,"pingpongTimer",void 0),uw(this,"pingpongTimeoutCount",0),uw(this,"joinResponse",void 0),uw(this,"multiIpOption",void 0),uw(this,"initError",void 0),uw(this,"spec",void 0),uw(this,"store",void 0),uw(this,"_external_signal",void 0),uw(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(jj.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case Vj.ON_DATA_STREAM:return void this.handleDataStream(t._message);case Vj.MUTE_AUDIO:case Vj.MUTE_VIDEO:case Vj.ON_P2P_LOST:case Vj.ON_USER_ONLINE:return;case Vj.ON_USER_OFFLINE:const{uid:e}=t._message;return aO.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===Vj.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===Vj.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QR.UID_BANNED);break;case 15:this.close(QR.IP_BANNED);break;case 16:this.close(QR.CHANNEL_BANNED)}if(t._type===Vj.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Pj.ERR_LICENSE_MISSING:this.close(QR.LICENSE_MISSING);break;case Pj.ERR_LICENSE_EXPIRED:this.close(QR.LICENSE_EXPIRED);break;case Pj.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QR.LICENSE_MINUTES_EXCEEDED);break;case Pj.ERR_LICENSE_PERIOD_INVALID:this.close(QR.LICENSE_PERIOD_INVALID);break;case Pj.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QR.LICENSE_MULTIPLE_SDK_SERVICE);break;case Pj.ERR_LICENSE_ILLEGAL:this.close(QR.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,RA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),RA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lj.CONNECTED&&this.reconnect("retry",nI.OFFLINE)}),this.p2pToken=wI(6,""),this._external_signal=new EY(this,this.p2pToken)}async request(e,t,n,i){const s=wI(6,""),r={_id:s,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new np((e,t)=>{if(this.connectionState===Lj.CONNECTED)return e();const n=()=>{this.off(jj.WS_CLOSED,i),e()},i=()=>{this.off(jj.WS_CONNECTED,n),t(new IR(RR.WS_ABORT))};this.once(jj.WS_CONNECTED,n),this.once(jj.WS_CLOSED,i)});if(this.connectionState!==Lj.CONNECTING&&this.connectionState!==Lj.RECONNECTING||e===Mj.JOIN||e===Mj.REJOIN||await o(),this.websocket.sendMessage(r,!0),i)return;const c=new np((n,i)=>{let r=!1;const o=(i,s)=>{r=!0,n({isSuccess:"success"===i,message:s||{}}),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.emit(jj.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(s),o);const c=()=>{i(new IR(RR.WS_ABORT,"type: ".concat(e))),this.off(jj.WS_CLOSED,c),this.off(jj.WS_RECONNECTING,c),this.off("res-@".concat(s),o)};this.once(jj.WS_CLOSED,c),this.once(jj.WS_RECONNECTING,c),TI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||r||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(jj.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(i){if(this.connectionState===Lj.CLOSED||e===Mj.LEAVE)throw new IR(RR.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?i.throw():e===Mj.JOIN||e===Mj.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new IR(RR.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===Pj.ERR_TOO_MANY_BROADCASTERS?e===Mj.JOIN||e===Mj.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===Pj.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nI.MULTI_IP)):this.reconnect(u.action,nI.SERVER_ERROR),e===Mj.JOIN||e===Mj.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np(n=>{const i=s=>{(!t||t(s))&&(this.off(e,i),n(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Uj.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=RA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lj.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},RA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np((t,n)=>{this.once(jj.WS_CONNECTED,()=>t(this.joinResponse)),this.once(jj.WS_CLOSED,()=>n(this.initError||new IR(RR.WS_ABORT))),this.connectionState=Lj.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||QR.LEAVE,this.connectionState=Lj.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=wI(6,""),this._external_signal.clear(),this._external_signal=new EY(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(jj.ABORT_P2P_EXECUTION);const e=await rI(this,jj.REQUEST_JOIN_INFO),t=await this.request(Mj.JOIN,e);if(!t)return this.emit(jj.REPORT_JOIN_GATEWAY,RR.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(jj.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lj.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){return!1}handleDataStream(e){try{var t;const n=_I(e.payload),i=(new TextDecoder).decode(n),s=JSON.parse(i);"total"in s&&"id"in s||Pi(t=Object.values(AM)).call(t,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(Vj.ON_DATA_STREAM,e)}catch(t){this.emit(Vj.ON_DATA_STREAM,e)}}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QR.UID_BANNED),void this.close()):void this.reconnect(t.action,nI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=RA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>RA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nI.TIMEOUT):this.request(Mj.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),RA("REPORT_STATS")&&this.send(Mj.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWebsocketEvents(){this.websocket.on(Bj.RECONNECT_CREATE_CONNECTION,e=>{this.emit(jj.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Bj.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bj.CLOSED,()=>{this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.FAILED,()=>{this._disconnectedReason=QR.NETWORK_ERROR,this.connectionState=Lj.CLOSED}),this.websocket.on(Bj.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Lj.CONNECTED?this.connectionState=Lj.RECONNECTING:this.connectionState=Lj.CONNECTING}),this.websocket.on(Bj.WILL_RECONNECT,(e,t,n)=>{"retry"!==e?(aO.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):aO.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)}),this.websocket.on(Bj.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(jj.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof IR&&e.code===RR.UNEXPECTED_RESPONSE&&e.data.code===Pj.ERR_NO_AUTHORIZED)return aO.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",nI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nI.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Bj.REQUEST_NEW_URLS,(e,t)=>{rI(this,jj.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Bj.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Vj.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const SY={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new yY(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new bY(n,t)}};function xY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function TY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xY(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class wY{constructor(e){uw(this,"sessionDesc",void 0),uw(this,"localCapabilities",void 0),uw(this,"rtpCapabilities",void 0),uw(this,"candidates",void 0),uw(this,"_originCandidates",void 0),uw(this,"iceParameters",void 0),uw(this,"dtlsParameters",void 0),uw(this,"setup",void 0),uw(this,"currentMidIndex",void 0),uw(this,"cname",void 0),e=pI(e);const{iceParameters:t,dtlsParameters:n,candidates:i,rtpCapabilities:s,setup:r,localCapabilities:a,sdkCodec:o,cname:c}=e,l=VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=s,this.candidates=i,this._originCandidates=pI(i),this.iceParameters=t,this.dtlsParameters=n,this.setup=r,this.localCapabilities=a,this.cname=c;for(let d=0;d<l.mediaDescriptions.length;d++){const e=l.mediaDescriptions[d];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=i,e.attributes.setup=r,"video"===e.media.mediaType){e.media.fmts=s.videoCodecs.map(e=>e.payloadType.toString(10));const t=s.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Pi(n=t.encodingName.toLowerCase()).call(n,o)}),n=s.videoCodecs.filter(e=>!Pi(t).call(t,e));e.attributes.payloads=[...t,...n],e.attributes.extmaps=s.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=s.audioCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=s.audioCodecs,e.attributes.extmaps=s.audioExtensions),l.mediaDescriptions[d]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return FA(this.sessionDesc)}send(e,t,n){const{ssrcs:i,ssrcGroups:s}=NU(t,this.cname),r=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType),a=i[0].attributes.label,o=i[0].attributes.mslabel;return r.attributes.ssrcs=r.attributes.ssrcs.concat(i),r.attributes.ssrcGroups=r.attributes.ssrcGroups.concat(s),{id:a,mslabel:o}}batchSend(e){return e.map(e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{const n=[],i=[],s=[];t.attributes.ssrcs.forEach(t=>{Pi(e).call(e,t.attributes.label||"")?s.push(t):n.push(t)}),t.attributes.ssrcGroups.forEach(e=>{var t;Pi(t=s.map(e=>e.ssrcId)).call(t,e.ssrcIds[0])||i.push(e)}),t.attributes.ssrcs=n,t.attributes.ssrcGroups=i})}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach((e,t)=>{const n=e._mediaStreamTrack,i=this.sessionDesc.mediaDescriptions.findIndex(e=>e.attributes.mid===n.kind),s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],e);this.sessionDesc.mediaDescriptions[i]=s})}stopReceiving(e){}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),n=[];if(t.forEach(e=>{n.push(TY(TY({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this.candidates=n;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this.candidates=[...t,...n];break;default:this.candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pI(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=pI(e);return CU(n,t),IU(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const i=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid);if(i){const e=i.attributes.ssrcs.find(e=>e.attributes.label===t);var s;e&&(e.attributes.label=n,null===(s=e.attributes.msid)||void 0===s||s.replace(t,n))}}mungMediaDesc(e){const t=pI(e);return RU(t),function(e){const t=e.attributes.extmaps.find(e=>yU(e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var NY;function CY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function RY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CY(Object(n),!0).forEach(function(t){uw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let IY=(NY=class e extends mM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Pi(t=Object.keys(DA)).call(t,e)}))]}constructor(t,n){super(t,n),uw(this,"store",void 0),uw(this,"peerConnection",void 0),uw(this,"remoteSDP",void 0),uw(this,"initialOffer",void 0),uw(this,"statsFilter",void 0),uw(this,"useRTX",!1),uw(this,"localCapabilities",void 0),uw(this,"localCandidateCount",0),uw(this,"allCandidatesReceived",!1),uw(this,"establishPromise",void 0),uw(this,"mutex",void 0),this.store=n,this.mutex=new UI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,nR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=SU(e.sdp),n=bU(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:RA("FILTER_VIDEO_FEC"),filterAudioFec:RA("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,RY(RY({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new wY(RY(RY({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return YN(function*(){const i=yield JN(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=e.map(e=>n.peerConnection.addTrack(e._mediaStreamTrack)),s=yield JN(n.peerConnection.createOffer()),r=VA(s.sdp),a=e.map(e=>{const t=e._mediaStreamTrack,i=r.mediaDescriptions.find(e=>e.attributes.mid===t.kind);if(!i)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const i=e.attributes.ssrcs.filter(e=>e.attributes.label===t),s=e.attributes.ssrcGroups;if(0===i.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(s&&i.length>1){const e=s.find(e=>-1!==e.ssrcIds.indexOf(i[0].ssrcId));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:i[0].ssrcId}]}return[{ssrcId:i[0].ssrcId}]}(i,t.id,n.useRTX)});let o;try{o=yield a}catch(e){throw i.forEach(e=>{$C()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)}),e}const c=n.mungSendOfferSDP(s.sdp,e);n.remoteSDP.receive(e,t,o);const l=n.remoteSDP.toString();return yield JN(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JN(n.applySendEncodings(i,e)),yield JN(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:a[t],id:n}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{$C()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:s}=this.remoteSDP.send(e,t,i),r=new np((t,i)=>{const r=setTimeout(()=>{i(new Error("Cannot receive track, id: ".concat(n)))},1e4),a=i=>{const o=qC();if(("Safari"===o.name&&11===Number(o.version)||iR())&&i.track.id!==n&&i.streams[0].id===s){var c;const s=i.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,i.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(r),void t(s)}if(i.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(r),void t(i.track)};this.peerConnection.addEventListener("track",a)}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),{track:await r,id:n}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(e=>{if($C()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!1),e.setParameters(t)}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async e=>{if($C()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!0),await e.setParameters(t)}});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YN(function*(){const n=yield JN(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=_O().supportPCSetConfiguration;if(e===gM.RELAY&&!n)return;if(n){const n=t.peerConnection.getConfiguration(),i=e===gM.RELAY?"relay":"all";n.iceTransportPolicy!==i&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(i,"]")),n.iceTransportPolicy=i,t.peerConnection.setConfiguration(n))}e!==gM.RELAY&&t.remoteSDP.updateCandidates(e);const i=yield JN(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=SU(i.sdp),{remoteIceParameters:r}=yield s.iceParameters;t.remoteSDP.restartICE(r);const a=t.remoteSDP.toString();yield JN(t.peerConnection.setLocalDescription(i)),yield JN(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e});1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find(e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t});n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},RA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZR(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),RA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id})),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!_O().supportSetRtpSenderParameters)return aO.warn("Browser not support set rtp-sender parameters");const i={},s={};if(e instanceof PP)switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(RA("DSCP_TYPE")&&SR()){var r;const e=RA("DSCP_TYPE");Pi(r=["very-low","low","medium","high"]).call(r,e)&&(s.networkPriority=e)}const a=t.getParameters(),o=null===(n=a.encodings)||void 0===n?void 0:n[0];o&&Object.assign(o,s),Object.assign(a,i),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!_O().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const i=e[n],s=t[n];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=VA(e);return t.forEach((e,t)=>{const i=e._mediaStreamTrack,s=n.mediaDescriptions.find(e=>e.attributes.mid===i.kind);s&&CU(s,e)}),FA(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map((t,n)=>{let{id:i,mslabel:s}=t;const{kind:r}=e[n];return new np((e,t)=>{const n=setTimeout(()=>{t(new Error("Cannot receive track, id: ".concat(i)))},1e4),a=t=>{const o=qC();if("Safari"===o.name&&11===Number(o.version)&&t.track.id!==i&&t.streams[0].id===s){var c;const s=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(r,i,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:s,id:i})}if(t.track.id===i)return this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:t.track,id:i})};this.peerConnection.addEventListener("track",a)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await np.all(t)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(_O().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ij(NY.prototype,"connect",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"connect"),NY.prototype),Ij(NY.prototype,"stopSending",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"stopSending"),NY.prototype),Ij(NY.prototype,"receive",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"receive"),NY.prototype),Ij(NY.prototype,"stopReceiving",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"stopReceiving"),NY.prototype),Ij(NY.prototype,"muteRemote",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"muteRemote"),NY.prototype),Ij(NY.prototype,"unmuteRemote",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"unmuteRemote"),NY.prototype),Ij(NY.prototype,"muteLocal",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"muteLocal"),NY.prototype),Ij(NY.prototype,"unmuteLocal",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"unmuteLocal"),NY.prototype),Ij(NY.prototype,"close",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"close"),NY.prototype),Ij(NY.prototype,"updateEncoderConfig",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"updateEncoderConfig"),NY.prototype),Ij(NY.prototype,"updateSendParameters",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"updateSendParameters"),NY.prototype),Ij(NY.prototype,"replaceTrack",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"replaceTrack"),NY.prototype),Ij(NY.prototype,"getRemoteSSRC",[AY],Object.getOwnPropertyDescriptor(NY.prototype,"getRemoteSSRC"),NY.prototype),NY);function AY(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return await i.apply(this,r)}finally{n()}},n}const OY={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new IY(n,t)}},DY={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!_O().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(dL.has(e))return;if(!e.track)return;const n={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const r=new TransformStream({transform(s,r){n.controller||(n.controller=r),e.track&&e.track.id!==n.track.id&&(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const a=t.metadata&&t.metadata();a?function(e,t){const{chunk:n,controller:i}=t,s=cL.METADATA;n.data=function(e,t,n){const i=n.byteLength,s=i+aL+oL,r=sL+rL+s,a=new ArrayBuffer(e.byteLength+r),o=new DataView(a);o.setUint8(0,iL),o.setUint16(1,s),o.setUint8(3,t),o.setUint16(4,i);for(let l=0;l<i;l++)o.setUint8(6+l,n[l]);const c=new Uint8Array(o.buffer);return c.set(new Uint8Array(e),r),c.buffer}(n.data,s,e),i.enqueue(n)}(a,{sender:e,chunk:s,controller:r}):r.enqueue(s)}});s.readable.pipeThrough(r).pipeTo(s.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const s=nL(),r=new MessageChannel;await new np(e=>s.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(s,{name:"audio-metadata-tx",port:r.port2},[r.port2]);e.transform=a,await new np(e=>s.onmessage=t=>{"started"===t.data&&e(void 0)}),r.port1.onmessage=s=>{var a;if(s.data.transformed&&e.track&&(null===(a=e.track)||void 0===a?void 0:a.id)!==n.track.id)aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(s.data.getMetadata){const e=t.metadata&&t.metadata();e&&r.port1.postMessage({metadata:e})}},n.worker=s}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const t=dL.get(e);if(t){dL.delete(e);try{var n,s;null===(n=t.controller)||void 0===n||n.terminate(),null===(s=t.worker)||void 0===s||s.terminate()}catch(e){aO.warning(e&&e.message)}}}dL.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!_O().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(DL.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ZC()&&!iR()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");aR(WC.CHROME,87,116)||(t.enableTopn=!1);let s=null;try{s=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const r=new TransformStream({transform(s,r){n.controller||(n.controller=r),e.track&&e.track.id!==n.track.id&&(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(e,t,n){var i;const s=lL(new DataView(t.data));if(!s)return n.enqueue(t);const r=e.track.id;kL.set(r,e.track);const a=null===(i=s.tlv.find(e=>e.tag===cL.AUDIO_LEVEL))||void 0===i?void 0:i.value;let o=0;"number"==typeof a&&(o=127-a);const c=Math.round(Math.pow(10,o/60)-1),{selected:l,speaker:d}=function(e,t){let n=SL.get(e);if(n||(n=function(e){const t=new yL;return SL.set(e,t),xL||(xL=new bL(RA("TOPN_SILENCE_THRESHOLD")||500),xL.on("ActiveSpeakerChanged",e=>{null!=e&&(TL=e)})),xL.addSpeakers([t]),t}(e)),SL.size<=wL)return{selected:!0,speaker:n};if(!xL)throw new Error("no active speaker detector");return xL.levelChanged(n.id,t),NL=xL.loudest.map(e=>e.id),TL&&!Pi(NL).call(NL,TL)&&NL.length>=wL&&NL.pop(),{selected:Pi(NL).call(NL,n.id)||n.id===TL,speaker:n}}(e,c),u=function(e,t,n){const i=CL.get(e)||new IL(e,t);return i.score=n,CL.set(e,i),function(e){if(RL.set(e,!0),!AL)return void(AL=Date.now());const t=Date.now();t-AL>1e3&&(RL.get(e)?RL.set(e,!1):(OL(e),RL.delete(e)),AL=t)}(e),i}(r,e.track,d.energyScore);u.addSample(l),u.active&&(t.data=s.frame.buffer,n.enqueue(t))}(e,s,r):t.enableMetadata||t.enablePts?function(e,t,n,i){const s=new DataView(e.data),r=s.getUint8(0);let a;if(0!=(128&r)&&71!==r){const t=function(e){if(e.byteLength<=0)return[];const t=[];let n=0;for(;n<e.byteLength;){const i=(128&e.getUint8(n))>>7,s=127&e.getUint8(n);if(!(i&&n+4<=e.byteLength)){n++;break}{const i=e.getUint32(n,!1),r=(16776192&i)>>10,a=1023&i;t.push({pt:s,ts_offset:r,length:a,data:new Uint8Array}),n+=4}}let i=e.byteLength-n;for(const s of t){if(s.length>i)return console.warn("Broken red payload"),[];s.length>0&&(s.data=new Uint8Array(e.buffer,e.byteOffset+n,s.length),n+=s.length,i-=s.length)}if(i>0){const s={pt:t.length>0?t[t.length-1].pt:0,ts_offset:0,length:i,data:new Uint8Array(e.buffer,e.byteOffset+n,i)};t.push(s)}return t}(s);if(t.length>0){const n=function(e){let t=0;for(let s=0;s<e.length;s++)t+=s<e.length-1?4:1,t+=e[s].length;const n=new Uint8Array(t);let i=0;for(let s=0;s<e.length;s++)if(s<e.length-1){const t=(2147483648|(127&e[s].pt)<<24|(262143&e[s].ts_offset)<<10|1023&e[s].length)>>>0;n[i++]=t>>24&255,n[i++]=t>>16&255,n[i++]=t>>8&255,n[i++]=255&t}else n[i++]=127&e[s].pt;for(const s of e)n.set(s.data,i),i+=s.length;return n}(t.map(e=>{const t=new Uint8Array(e.length);t.set(e.data);const n=lL(new DataView(t.buffer));return null!=n&&n.frame&&(e.data=null==n?void 0:n.frame),a=n,e}));e.data=n.buffer}}else a=lL(s),a&&(e.data=a.frame.buffer);if(t.enqueue(e),!a)return;const o=a.tlv.find(e=>e.tag===cL.METADATA);o&&n&&o.value instanceof Uint8Array&&n(o.value);const c=a.tlv.find(e=>e.tag===cL.AUDIO_64_BIT_PTS);c&&i&&c.value instanceof Uint8Array&&8==c.value.length&&i(new DataView(c.value.buffer).getBigUint64(0,!0))}(s,r,t.onMetadata,t.onPts):r.enqueue(s)}});s.readable.pipeThrough(r).pipeTo(s.writable)}else{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=nL(),s=new MessageChannel;await new np(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const r=new RTCRtpScriptTransform(t,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=r,await new np(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),s.port1.onmessage=t=>{var s;t.data.transformed&&e.track&&(null===(s=e.track)||void 0===s?void 0:s.id)!==n.track.id?(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):t.data.metadata&&n.onMetadata?n.onMetadata(t.data.metadata):t.data.pts&&n.onPts&&n.onPts(t.data.pts)},n.worker=t}function i(){e.track.removeEventListener("ended",i),function(e){const t=DL.get(e);if(t){!function(e){const t=SL.get(e);t&&(SL.delete(e),xL&&(xL.removeSpeakers([t]),0===SL.size&&(xL.destroy(),xL=null)))}(e),OL(e.track.id),DL.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}DL.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!_O().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(VL.has(e))return;if(!e.track)return;const n={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const r=[];t.on("sei-to-send",e=>{r.push(e)});const a=new TransformStream({transform(t,s){n.controller||(n.controller=s),e.track&&e.track.id!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const a=UL(new Uint8Array(t.data)),o=r.shift();if(o){const e=function(e,t,n){switch(n){case PL:return function(e,t){const n=ML(t),i=n.length,s=Math.floor(i/255),r=i%255,a=new Uint8Array(6+s+1+i+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=6,a[5]=101;let o=0;for(;o<s;)a[6+o]=255,o++;return a[6+o]=r,o++,a.set(n,6+o),a.set(new Uint8Array(e),6+o+i),a.buffer}(e,t);case LL:return function(e,t){const n=ML(t),i=n.length,s=Math.floor(i/255),r=i%255,a=new Uint8Array(7+s+1+i+1+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=78,a[5]=1,a[6]=101;let o=0;for(;o<s;)a[7+o]=255,o++;return a[7+o]=r,o++,a.set(n,7+o),o+=i,a[7+o]=128,o++,a.set(new Uint8Array(e),7+o),a.buffer}(e,t);default:return null}}(t.data,o,a);e&&(t.data=e)}s.enqueue(t)}});s.readable.pipeThrough(a).pipeTo(s.writable)}else{if(!$C())return;{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const s=nL(),r=new MessageChannel;await new np(e=>s.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(s,{name:"sei-tx",port:r.port2},[r.port2]);e.transform=a,await new np(e=>s.onmessage=t=>{"started"===t.data&&e(void 0)}),t.on("sei-to-send",e=>{r.port1.postMessage({sei:e})}),r.port1.onmessage=t=>{var s;t.data.transformed&&e.track&&(null===(s=e.track)||void 0===s?void 0:s.id)!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=s}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const t=VL.get(e);if(t){VL.delete(e);try{var n,s;null===(n=t.controller)||void 0===n||n.terminate(),null===(s=t.worker)||void 0===s||s.terminate()}catch(e){aO.warning(e&&e.message)}}}VL.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!_O().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(!e.track)return;if(FL.has(e)){const n=FL.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const s=new TransformStream({transform(t,s){n.controller||(n.controller=s),e.track&&e.track.id!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const r=function(e,t){switch(t){case PL:return function(e){const t=new DataView(e.data);let n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let i=n+6,s=0,r=0;for(;255===(r=t.getUint8(i++));)s+=255;s+=r;const a=jL(e.data,i,s);return new Uint8Array(a)}n++}return null}(e);case LL:return function(e){const t=new DataView(e.data);let n=0;for(;n+5<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&78===t.getUint8(n+4)&&1===t.getUint8(n+5)&&101===t.getUint8(n+6)){let i=n+7,s=0,r=0;for(;255===(r=t.getUint8(i++));)s+=255;s+=r;const a=jL(e.data,i,s);return new Uint8Array(a)}n++}return null}(e);default:return null}}(t,UL(new Uint8Array(t.data)));r&&n.onSei&&n.onSei(r),s.enqueue(t)}});t.readable.pipeThrough(s).pipeTo(t.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=nL(),s=new MessageChannel;await new np(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const r=new RTCRtpScriptTransform(t,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=r,await new np(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),s.port1.onmessage=t=>{var s;t.data.transformed&&e.track&&(null===(s=e.track)||void 0===s?void 0:s.id)!==n.track.id?(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}!function(e){const t=FL.get(e);if(t){FL.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}FL.set(e,n),e.track.addEventListener("ended",i)}},kY={name:"InterceptFrame",create:()=>DY};_A(),CA("PROCESS_ID","process-".concat(wI(8,""),"-").concat(wI(4,""),"-").concat(wI(4,""),"-").concat(wI(4,""),"-").concat(wI(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();aO.debug("Loading global parameters from cache",t),Object.keys(t).forEach(e=>{if(Object.prototype.hasOwnProperty.call(NA,e)){const{value:i,expires:s}=t[e];if(s&&s<=n)return;AA[e]=i,NA[e]=i}})}catch(t){aO.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(AA.AREAS)&&AA.AREAS.length>0&&mV(AA.AREAS,!0);const PY=(e,t,n)=>{aO.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),CA(e,t,n)};XU(Zz,!1),XU(rq,!1),XU(fG,!1),XU(jq,!1),XU(Xz,!1),XU(SY,!1),XU(OY,!1),XU(kY,!1);const LY=function(e){const t=new HR,n=e,i={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===NM.SECURITY_POLICY_VIOLATION&&fW(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return pW(pW({},n),i)}({__TRACK_LIST__:LO,VERSION:yA,BUILD:TA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:PY,getParameter:RA,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return _O().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new fO(RR.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=mO.reportApiInvoke(null,{name:qR.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:YR.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket;t=!!(e&&n&&i),t&&bR()&&rR(75)&&(new e).close()}catch(e){return aO.error("check system requirement failed: ",e),!1}let n=!1;const i=qC();i.name===WC.CHROME&&Number(i.version)>=58&&("WebKit"!==KC.engine.name||function(){const e=qC();if(QC()){if(e.os===GC.MAC_OS)return!0;if(e.os===GC.IOS){const e=KC.os.version&&KC.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(i.name===WC.FIREFOX&&Number(i.version)>=56||i.name===WC.OPERA&&Number(i.version)>=45||i.name===WC.SAFARI&&Number(i.version)>=11||"WebKit"===i.name&&(iR()||yR())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||vR()||qC().name===WC.QQ)&&(n=!0),aO.debug("checkSystemRequirements, api:",t,"browser",n);const s=t&&n;return e.onSuccess(s),s},getDevices:function(e){return DD.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return DD.getRecordingDevices(e)},getCameras:function(e){return DD.getCamerasDevices(e)},getElectronScreenSources:TD,getPlaybackDevices:function(e){return DD.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=wI(5,"client-"),i=mO.reportApiInvoke(null,{id:n,name:qR.CREATE_CLIENT,options:[t],tag:YR.TRACER});try{!function(e){OR(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),OR(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&OR(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&PR(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&$R(e.turnServer),void 0!==e.httpRetryConfig&&XR(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&XR(e.websocketRetryConfig)}(t)}catch(e){throw i.onError(e),e}return(uR(16,0,!0)||hR(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",aO.debug("browser not support vp9, force use vp8")),CA("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),i.onSuccess(),new aW(rW(rW({forceWaitGatewayResponse:!0},t),{},{role:Pi(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=RA("CAMERA_CAPTURE_CONFIG"),n=wI(8,"track-cam-"),i=mO.reportApiInvoke(null,{id:n,tag:YR.TRACER,name:qR.CREATE_CAM_VIDEO_TRACK,options:[lD({},e),t]});t&&(e.encoderConfig=t);const s=qD(e);let r=null;aO.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{r=(await RD({video:s},n)).getVideoTracks()[0]||null}catch(e){throw i.onError(e),e}if(!r){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(e),e.throw(aO)}if(e.optimizationMode&&jP(n,r,e,AO(e.encoderConfig)),RA("USE_STANDARD_BITRATE_DEFAULT")){const t=AO(e.encoderConfig);e.encoderConfig=t,delete t.bitrateMax,delete t.bitrateMin}const a=new LP(r,e,s,e.scalabiltyMode?DO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(a.getTrackId()),aO.info("create camera video success, trackId:",n),a},createCustomVideoTrack:function(e){const t=wI(8,"track-cus-"),n=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new PP(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?DO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[UO.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),aO.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n="object"==typeof t?function(e){return YD(e)}(t):void 0;n&&(t="auto");const i=wI(8,"track-scr-v-"),s=mO.reportApiInvoke(null,{id:i,tag:YR.TRACER,name:qR.CREATE_SCREEN_VIDEO_TRACK,options:[lD({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const r=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&ZC()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:i,surfaceSwitching:s,systemAudio:r,preferCurrentTab:a}=e;(sR(107)||oR(107)||pR(93))&&(n&&(OR(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),i?(OR(i,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=i):t.selfBrowserSurface="include",s&&(OR(s,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=s)),(sR(105)||oR(105)||pR(91))&&r&&(OR(r,"systemAudio",["exclude","include"]),t.systemAudio=r),(sR(94)||oR(94)||pR(80))&&a&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const o=e.encoderConfig?OO(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&(o.frameRate&&("number"==typeof o.frameRate?(t.mandatory.maxFrameRate=o.frameRate,t.mandatory.minFrameRate=o.frameRate):(t.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,t.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),t.frameRate=o.frameRate),o.width&&(t.width=o.width),o.height&&(t.height=o.height)),t}(e);let a=null,o=null;const c=_O();if(!c.supportShareAudio&&"enable"===t){const e=new IR(RR.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(e),e.throw(aO)}aO.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const l=c.supportShareAudio&&"disable"!==t;try{const e=await RD({screen:r,screenAudio:l?n||!0:void 0},i);a=e.getVideoTracks()[0]||null,o=e.getAudioTracks()[0]||null}catch(e){throw s.onError(e),e}if(!a){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(e),e.throw(aO)}if(!o&&"enable"===t){a&&a.stop();const e=new IR(RR.SHARE_AUDIO_NOT_ALLOWED);return s.onError(e),e.throw(aO)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(jP(i,a,e,e.encoderConfig&&OO(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const d=new PP(a,e.encoderConfig?OO(e.encoderConfig):{},e.scalabiltyMode?DO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[UO.SCREEN_TRACK]);if(!o)return s.onSuccess(d.getTrackId()),aO.info("create screen video track success","video:",d.getTrackId()),d;const u=new Fk(o,void 0,wI(8,"track-scr-a-"),!1);return s.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create screen video track success","video:",d.getTrackId(),"audio:",u.getTrackId()),[d,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=RA("CAMERA_CAPTURE_CONFIG"),i=wI(8,"track-mic-"),s=wI(8,"track-cam-"),r=mO.reportApiInvoke(null,{id:"".concat(i,"-").concat(s),tag:YR.TRACER,name:qR.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const a=qD(t),o=XD(e);let c=null,l=null;aO.info("start create camera video track(".concat(s,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await RD({audio:o,video:a},"".concat(i,"-").concat(s));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw r.onError(e),e}if(!c||!l){const e=new IR(RR.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(e),e.throw(aO)}if(t.optimizationMode&&jP(s,l,t,AO(t.encoderConfig)),RA("USE_STANDARD_BITRATE_DEFAULT")){const e=AO(t.encoderConfig);t.encoderConfig=e,delete e.bitrateMax,delete e.bitrateMin}const d=new Bk(c,e,o,i),u=new LP(l,t,a,t.scalabiltyMode?DO(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return r.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create camera video track(".concat(s,") and microphone audio track(").concat(i,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=wI(8,"track-mic-"),n=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=XD(e);let s=null;aO.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{s=(await RD({audio:i},t)).getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!s){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(aO)}const r=new Bk(s,e,i,t);return n.onSuccess(r.getTrackId()),aO.info("create microphone audio track success, trackId:",t),r},createCustomAudioTrack:function(e){const t=wI(8,"track-cus-"),n=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Fk(e.mediaStreamTrack,e.encoderConfig?PO(e.encoderConfig):{},t,!1);return aO.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:s}=e;const r={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":s,cacheOnlineFile:n,encoderConfig:i},a=wI(8,"track-buf-"),o=mO.reportApiInvoke(null,{id:a,tag:YR.TRACER,name:qR.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(RA("DISABLE_WEBAUDIO"))throw new IR(RR.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");aO.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",a);const c=s;if(!(s instanceof AudioBuffer))try{s=await async function(e,t){let n=null;if("string"==typeof e){const t=Kk.get(e);if(t)return aO.debug("use cached audio resource: ",e),t;try{n=(await GI(()=>jC.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new IR(RR.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new np((t,n)=>{const i=new FileReader;i.onload=e=>{e.target?t(e.target.result):n(new IR(RR.READ_LOCAL_AUDIO_FILE_ERROR))},i.onerror=()=>{n(new IR(RR.READ_LOCAL_AUDIO_FILE_ERROR))},i.readAsArrayBuffer(e)});n=await t}const i=await function(e){const t=fD();return new np((n,i)=>{t.decodeAudioData(e,e=>{n(e)},e=>{i(new IR(RR.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(n);return"string"==typeof e&&t&&Kk.set(e,i),i}(s,n)}catch(e){return o.onError(e),e.throw(aO)}const l=new Hk(s),d=new Gk(c,l,i?PO(i):{},a);return aO.info("create buffer source audio track success, trackId:",a),o.onSuccess(d.getTrackId()),d},setAppType:function(e){if(aO.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw aO.debug("Invalid appType"),new fO(RR.INVALID_PARAMS,"invalid app type",e);CA("APP_TYPE",Math.floor(e))},setLogLevel:function(e){aO.setLogLevel(e)},enableLogUpload:function(){RA("USE_NEW_LOG")?CA("UPLOAD_LOG",!0):aO.enableLogUpload()},disableLogUpload:function(){RA("USE_NEW_LOG")?CA("UPLOAD_LOG",!1):aO.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new JV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Fk||e instanceof QP)){const e=new fO(RR.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof Fk?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let r=s,a=s;const o=Date.now();return new np(s=>{const c=setInterval(()=>{const l=e.getVolumeLevel();r=l>r?l:r,a=l<a?l:a;const d=r-a>1e-4,u=Date.now()-o;if(d||u>t){clearInterval(c);const t=d,a={duration:u,deviceLabel:i,maxVolumeLevel:r,result:t};aO.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),n.onSuccess(a),s(t)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof PP||e instanceof JP)){const e=new fO(RR.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof PP?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0),r=document.createElement("video");r.style.width="1px",r.style.height="1px",r.setAttribute("muted",""),r.muted=!0,r.setAttribute("playsinline",""),r.controls=!1,($C()||QC())&&(r.style.opacity="0.01",r.style.position="fixed",r.style.left="0",r.style.top="0",document.body.appendChild(r)),r.srcObject=new MediaStream([s]),r.play();const a=document.createElement("canvas");a.width=160,a.height=120;let o=0,c=0;try{const e=Date.now();o=await function(e,t,n,i){let s,r=0,a=null;return new np((o,c)=>{function l(){r>i&&s&&(s(),o(r));const t=n.getContext("2d");if(!t){const e=new fO(RR.UNEXPECTED_ERROR,"can not get canvas 2d context.");return aO.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,n.width,n.height),d=Math.floor(l.data.length/3);if(a){for(let e=0;e<d;e+=3)if(l.data[e]!==a[e])return r+=1,void(a=l.data);a=l.data}else a=l.data}setTimeout(()=>{s&&(s(),o(r))},t),s=yD(()=>{l()},30)})}(r,t,a,4),c=Date.now()-e}catch(e){throw n.onError(e),e}hB===WC.SAFARI&&(r.pause(),r.remove()),r.srcObject=null;const l=o>4,d={duration:c,changedPicNum:o,deviceLabel:i,result:l};return aO.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),n.onSuccess(d),l},setArea:mV,audioElementPlayCenter:UD,resumeAudioContext:function(){UD.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){uW.processExternalMediaAEC(e)},registerExtensions:function(e){const t=RA("PLUGIN_INFO")||[];e.forEach(e=>{"name"in e&&!Pi(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=aO.extLog,n.reporter.hookApiInvoke=mO.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(e=>{n.parameters[e]=RA(e)})}),PY("PLUGIN_INFO",t)},ChannelMediaRelayError:nM,ChannelMediaRelayEvent:eM,ChannelMediaRelayState:tM,RemoteStreamFallbackType:BO,RemoteStreamType:FO,ConnectionDisconnectedReason:QR,AudienceLatencyLevelType:JR,AREAS:oM,preload:async function(e,t,n,i){return NB(e,t,n,i)}});return Object.defineProperties(LY,{onAudioAutoplayFailed:{get:()=>PD.onAudioAutoplayFailed,set:e=>{PD.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>PD.onAutoplayFailed,set:e=>{PD.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>LY._onSecurityPolicyViolation,set(e){LY._onSecurityPolicyViolation=e,fW(e)}},__CLIENT_LIST__:{get:()=>RA("SHOW_GLOBAL_CLIENT_LIST")?WL:[]}}),DD.on(tD.CAMERA_DEVICE_CHANGED,e=>{aO.info("camera device changed",JSON.stringify(e)),LY.onCameraChanged&&LY.onCameraChanged(e),LY.safeEmit(NM.CAMERA_CHANGED,e)}),DD.on(tD.RECORDING_DEVICE_CHANGED,e=>{aO.info("microphone device changed",JSON.stringify(e)),LY.onMicrophoneChanged&&LY.onMicrophoneChanged(e),LY.safeEmit(NM.MICROPHONE_CHANGED,e)}),DD.on(tD.PLAYOUT_DEVICE_CHANGED,e=>{aO.debug("playout device changed",JSON.stringify(e)),LY.onPlaybackDeviceChanged&&LY.onPlaybackDeviceChanged(e),LY.safeEmit(NM.PLAYBACK_DEVICE_CHANGED,e)}),UD.onAutoplayFailed=()=>{aO.info("detect audio element autoplay failed"),PD.onAudioAutoplayFailed&&PD.onAudioAutoplayFailed()},mD.on("autoplay-failed",()=>{aO.info("detect webaudio autoplay failed"),PD.onAudioAutoplayFailed&&PD.onAudioAutoplayFailed(),LY.safeEmit(NM.AUTOPLAY_FAILED)}),mD.on(SO.STATE_CHANGE,(e,t)=>{aO.info("audio context state changed: ".concat(t," => ").concat(e)),LY.onAudioContextStateChanged&&LY.onAudioContextStateChanged(e,t),LY.safeEmit(NM.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),lI.on(sI.NETWORK_STATE_CHANGE,(e,t)=>{aO.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=LY),LY}()},730:(e,t,n)=>{"use strict";var i=n(43),s=n(853);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,i,s,r,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var _=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,n,i){var s=g.hasOwnProperty(t)?g[t]:null;(null!==s?0!==s.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,i)&&(n=null),i||null===s?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,i=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(_,y);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(_,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(_,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var E=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),S=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),C=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var k=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var j,M=Object.assign;function U(e){if(void 0===j)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);j=t&&t[1]||""}return"\n"+j+e}var V=!1;function F(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var s=l.stack.split("\n"),r=i.stack.split("\n"),a=s.length-1,o=r.length-1;1<=a&&0<=o&&s[a]!==r[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==r[o]){if(1!==a||1!==o)do{if(a--,0>--o||s[a]!==r[o]){var c="\n"+s[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=o);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case x:return"Fragment";case S:return"Portal";case w:return"Profiler";case T:return"StrictMode";case I:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function z(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){i=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=K(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=H(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&i&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(i&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(r(92));if(te(n)){if(1<n.length)throw Error(r(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function re(e,t){var n=H(t.value),i=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),s=fe(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,s):e[n]=s}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var _e=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,xe=null,Te=null;function we(e){if(e=vs(e)){if("function"!==typeof Se)throw Error(r(280));var t=e.stateNode;t&&(t=bs(t),Se(e.stateNode,e.type,t))}}function Ne(e){xe?Te?Te.push(e):Te=[e]:xe=e}function Ce(){if(xe){var e=xe,t=Te;if(Te=xe=null,we(e),t)for(e=0;e<t.length;e++)we(t[e])}}function Re(e,t){return e(t)}function Ie(){}var Ae=!1;function Oe(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Re(e,t,n)}finally{Ae=!1,(null!==xe||null!==Te)&&(Ie(),Ce())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var i=bs(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(r(231,t,typeof n));return n}var ke=!1;if(d)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){ke=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(de){ke=!1}function Le(e,t,n,i,s,r,a,o,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(d){this.onError(d)}}var je=!1,Me=null,Ue=!1,Ve=null,Fe={onError:function(e){je=!0,Me=e}};function Be(e,t,n,i,s,r,a,o,c){je=!1,Me=null,Le.apply(Fe,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ge(e)!==e)throw Error(r(188))}function Ke(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var s=n.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(i=s.return)){n=i;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return He(s),e;if(a===i)return He(s),t;a=a.sibling}throw Error(r(188))}if(n.return!==i.return)n=s,i=a;else{for(var o=!1,c=s.child;c;){if(c===n){o=!0,n=s,i=a;break}if(c===i){o=!0,i=s,n=a;break}c=c.sibling}if(!o){for(c=a.child;c;){if(c===n){o=!0,n=a,i=s;break}if(c===i){o=!0,i=a,n=s;break}c=c.sibling}if(!o)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(e))?ze(e):null}function ze(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=ze(e);if(null!==t)return t;e=e.sibling}return null}var qe=s.unstable_scheduleCallback,Ye=s.unstable_cancelCallback,Xe=s.unstable_shouldYield,Je=s.unstable_requestPaint,Qe=s.unstable_now,Ze=s.unstable_getCurrentPriorityLevel,$e=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,nt=s.unstable_LowPriority,it=s.unstable_IdlePriority,st=null,rt=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/ct|0)|0},ot=Math.log,ct=Math.LN2;var lt=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,s=e.suspendedLanes,r=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~s;0!==o?i=ut(o):0!==(r&=a)&&(i=ut(r))}else 0!==(a=n&~s)?i=ut(a):0!==r&&(i=ut(r));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&s)&&((s=i&-i)>=(r=t&-t)||16===s&&0!==(4194240&r)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)s=1<<(n=31-at(t)),i|=e[n],t&=~s;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),s=1<<i;s&t|e[i]&t&&(e[i]|=t),n&=~s}}var vt=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,St,xt,Tt,wt,Nt=!1,Ct=[],Rt=null,It=null,At=null,Ot=new Map,Dt=new Map,kt=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function jt(e,t,n,i,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=vs(t))&&St(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Mt(e){var t=ys(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void wt(e.priority,function(){xt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vs(n))&&St(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);Ee=i,n.target.dispatchEvent(i),Ee=null,t.shift()}return!0}function Vt(e,t,n){Ut(e)&&n.delete(t)}function Ft(){Nt=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==It&&Ut(It)&&(It=null),null!==At&&Ut(At)&&(At=null),Ot.forEach(Vt),Dt.forEach(Vt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Nt||(Nt=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Ft)))}function Gt(e){function t(t){return Bt(t,e)}if(0<Ct.length){Bt(Ct[0],e);for(var n=1;n<Ct.length;n++){var i=Ct[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Rt&&Bt(Rt,e),null!==It&&Bt(It,e),null!==At&&Bt(At,e),Ot.forEach(t),Dt.forEach(t),n=0;n<kt.length;n++)(i=kt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<kt.length&&null===(n=kt[0]).blockedOn;)Mt(n),null===n.blockedOn&&kt.shift()}var Wt=E.ReactCurrentBatchConfig,Ht=!0;function Kt(e,t,n,i){var s=vt,r=Wt.transition;Wt.transition=null;try{vt=1,qt(e,t,n,i)}finally{vt=s,Wt.transition=r}}function zt(e,t,n,i){var s=vt,r=Wt.transition;Wt.transition=null;try{vt=4,qt(e,t,n,i)}finally{vt=s,Wt.transition=r}}function qt(e,t,n,i){if(Ht){var s=Xt(e,t,n,i);if(null===s)Hi(e,t,i,Yt,n),Lt(e,i);else if(function(e,t,n,i,s){switch(t){case"focusin":return Rt=jt(Rt,e,t,n,i,s),!0;case"dragenter":return It=jt(It,e,t,n,i,s),!0;case"mouseover":return At=jt(At,e,t,n,i,s),!0;case"pointerover":var r=s.pointerId;return Ot.set(r,jt(Ot.get(r)||null,e,t,n,i,s)),!0;case"gotpointercapture":return r=s.pointerId,Dt.set(r,jt(Dt.get(r)||null,e,t,n,i,s)),!0}return!1}(s,e,t,n,i))i.stopPropagation();else if(Lt(e,i),4&t&&-1<Pt.indexOf(e)){for(;null!==s;){var r=vs(s);if(null!==r&&bt(r),null===(r=Xt(e,t,n,i))&&Hi(e,t,i,Yt,n),r===s)break;s=r}null!==s&&i.stopPropagation()}else Hi(e,t,i,null,n)}}var Yt=null;function Xt(e,t,n,i){if(Yt=null,null!==(e=ys(e=be(i))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,i=n.length,s="value"in Qt?Qt.value:Qt.textContent,r=s.length;for(e=0;e<i&&n[e]===s[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===s[r-t];t++);return $t=s.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function sn(){return!1}function rn(e){function t(t,n,i,s,r){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?nn:sn,this.isPropagationStopped=sn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=rn(ln),un=M({},ln,{view:0,detail:0}),hn=rn(un),pn=M({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,on=e.screenY-cn.screenY):on=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),mn=rn(pn),fn=rn(M({},pn,{dataTransfer:0})),gn=rn(M({},un,{relatedTarget:0})),_n=rn(M({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=M({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=rn(yn),En=rn(M({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xn[e])&&!!t[e]}function wn(){return Tn}var Nn=M({},un,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=rn(Nn),Rn=rn(M({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=rn(M({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wn})),An=rn(M({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),On=M({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=rn(On),kn=[9,13,27,32],Pn=d&&"CompositionEvent"in window,Ln=null;d&&"documentMode"in document&&(Ln=document.documentMode);var jn=d&&"TextEvent"in window&&!Ln,Mn=d&&(!Pn||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),Vn=!1;function Fn(e,t){switch(e){case"keyup":return-1!==kn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Kn(e,t,n,i){Ne(i),0<(t=zi(t,"onChange")).length&&(n=new dn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var zn=null,qn=null;function Yn(e){Ui(e,0)}function Xn(e){if(q(Es(e)))return e}function Jn(e,t){if("change"===e)return t}var Qn=!1;if(d){var Zn;if(d){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}Zn=$n}else Zn=!1;Qn=Zn&&(!document.documentMode||9<document.documentMode)}function ti(){zn&&(zn.detachEvent("onpropertychange",ni),qn=zn=null)}function ni(e){if("value"===e.propertyName&&Xn(qn)){var t=[];Kn(t,qn,e,be(e)),Oe(Yn,t)}}function ii(e,t,n){"focusin"===e?(ti(),qn=n,(zn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function si(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function ri(e,t){if("click"===e)return Xn(t)}function ai(e,t){if("input"===e||"change"===e)return Xn(t)}var oi="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ci(e,t){if(oi(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!u.call(t,s)||!oi(e[s],t[s]))return!1}return!0}function li(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=li(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=li(i)}}function ui(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ui(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ui(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,r=Math.min(i.start,s);i=void 0===i.end?r:Math.min(i.end,s),!e.extend&&r>i&&(s=i,i=r,r=s),s=di(n,r);var a=di(n,i);s&&a&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),r>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fi=d&&"documentMode"in document&&11>=document.documentMode,gi=null,_i=null,yi=null,vi=!1;function Ei(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vi||null==gi||gi!==Y(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&ci(yi,i)||(yi=i,0<(i=zi(_i,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Si={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},xi={},Ti={};function wi(e){if(xi[e])return xi[e];if(!Si[e])return e;var t,n=Si[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ti)return xi[e]=n[t];return e}d&&(Ti=document.createElement("div").style,"AnimationEvent"in window||(delete Si.animationend.animation,delete Si.animationiteration.animation,delete Si.animationstart.animation),"TransitionEvent"in window||delete Si.transitionend.transition);var Ni=wi("animationend"),Ci=wi("animationiteration"),Ri=wi("animationstart"),Ii=wi("transitionend"),Ai=new Map,Oi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(e,t){Ai.set(e,t),c(t,[e])}for(var ki=0;ki<Oi.length;ki++){var Pi=Oi[ki];Di(Pi.toLowerCase(),"on"+(Pi[0].toUpperCase()+Pi.slice(1)))}Di(Ni,"onAnimationEnd"),Di(Ci,"onAnimationIteration"),Di(Ri,"onAnimationStart"),Di("dblclick","onDoubleClick"),Di("focusin","onFocus"),Di("focusout","onBlur"),Di(Ii,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ji=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function Mi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,s,a,o,c,l){if(Be.apply(this,arguments),je){if(!je)throw Error(r(198));var d=Me;je=!1,Me=null,Ue||(Ue=!0,Ve=d)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],s=i.event;i=i.listeners;e:{var r=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],c=o.instance,l=o.currentTarget;if(o=o.listener,c!==r&&s.isPropagationStopped())break e;Mi(s,o,l),r=c}else for(a=0;a<i.length;a++){if(c=(o=i[a]).instance,l=o.currentTarget,o=o.listener,c!==r&&s.isPropagationStopped())break e;Mi(s,o,l),r=c}}}if(Ue)throw e=Ve,Ue=!1,Ve=null,e}function Vi(e,t){var n=t[fs];void 0===n&&(n=t[fs]=new Set);var i=e+"__bubble";n.has(i)||(Wi(t,e,2,!1),n.add(i))}function Fi(e,t,n){var i=0;t&&(i|=4),Wi(n,e,i,t)}var Bi="_reactListening"+Math.random().toString(36).slice(2);function Gi(e){if(!e[Bi]){e[Bi]=!0,a.forEach(function(t){"selectionchange"!==t&&(ji.has(t)||Fi(t,!1,e),Fi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bi]||(t[Bi]=!0,Fi("selectionchange",!1,t))}}function Wi(e,t,n,i){switch(Jt(t)){case 1:var s=Kt;break;case 4:s=zt;break;default:s=qt}n=s.bind(null,t,n,e),s=void 0,!ke||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),i?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Hi(e,t,n,i,s){var r=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===a)for(a=i.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===s||8===c.nodeType&&c.parentNode===s))return;a=a.return}for(;null!==o;){if(null===(a=ys(o)))return;if(5===(c=a.tag)||6===c){i=r=a;continue e}o=o.parentNode}}i=i.return}Oe(function(){var i=r,s=be(n),a=[];e:{var o=Ai.get(e);if(void 0!==o){var c=dn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Cn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=In;break;case Ni:case Ci:case Ri:c=_n;break;case Ii:c=An;break;case"scroll":c=hn;break;case"wheel":c=Dn;break;case"copy":case"cut":case"paste":c=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Rn}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var p,m=i;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=De(m,h))&&d.push(Ki(m,f,p)))),u)break;m=m.return}0<d.length&&(o=new c(o,l,null,n,s),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Ee||!(l=n.relatedTarget||n.fromElement)||!ys(l)&&!l[ms])&&(c||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=i,null!==(l=(l=n.relatedTarget||n.toElement)?ys(l):null)&&(l!==(u=Ge(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=i),c!==l)){if(d=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Rn,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==c?o:Es(c),p=null==l?o:Es(l),(o=new d(f,m+"leave",c,n,s)).target=u,o.relatedTarget=p,f=null,ys(s)===i&&((d=new d(h,m+"enter",l,n,s)).target=p,d.relatedTarget=u,f=d),u=f,c&&l)e:{for(h=l,m=0,p=d=c;p;p=qi(p))m++;for(p=0,f=h;f;f=qi(f))p++;for(;0<m-p;)d=qi(d),m--;for(;0<p-m;)h=qi(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=qi(d),h=qi(h)}d=null}else d=null;null!==c&&Yi(a,o,c,d,!1),null!==l&&null!==u&&Yi(a,u,l,d,!0)}if("select"===(c=(o=i?Es(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var g=Jn;else if(Hn(o))if(Qn)g=ai;else{g=si;var _=ii}else(c=o.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=ri);switch(g&&(g=g(e,i))?Kn(a,g,n,s):(_&&_(e,o,i),"focusout"===e&&(_=o._wrapperState)&&_.controlled&&"number"===o.type&&ee(o,"number",o.value)),_=i?Es(i):window,e){case"focusin":(Hn(_)||"true"===_.contentEditable)&&(gi=_,_i=i,yi=null);break;case"focusout":yi=_i=gi=null;break;case"mousedown":vi=!0;break;case"contextmenu":case"mouseup":case"dragend":vi=!1,Ei(a,n,s);break;case"selectionchange":if(fi)break;case"keydown":case"keyup":Ei(a,n,s)}var y;if(Pn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Gn?Fn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Mn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Gn&&(y=en()):(Zt="value"in(Qt=s)?Qt.value:Qt.textContent,Gn=!0)),0<(_=zi(i,v)).length&&(v=new En(v,e,null,n,s),a.push({event:v,listeners:_}),y?v.data=y:null!==(y=Bn(n))&&(v.data=y))),(y=jn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Vn=!0,Un);case"textInput":return(e=t.data)===Un&&Vn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Pn&&Fn(e,t)?(e=en(),$t=Zt=Qt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=zi(i,"onBeforeInput")).length&&(s=new En("onBeforeInput","beforeinput",null,n,s),a.push({event:s,listeners:i}),s.data=y))}Ui(a,t)})}function Ki(e,t,n){return{instance:e,listener:t,currentTarget:n}}function zi(e,t){for(var n=t+"Capture",i=[];null!==e;){var s=e,r=s.stateNode;5===s.tag&&null!==r&&(s=r,null!=(r=De(e,n))&&i.unshift(Ki(e,r,s)),null!=(r=De(e,t))&&i.push(Ki(e,r,s))),e=e.return}return i}function qi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yi(e,t,n,i,s){for(var r=t._reactName,a=[];null!==n&&n!==i;){var o=n,c=o.alternate,l=o.stateNode;if(null!==c&&c===i)break;5===o.tag&&null!==l&&(o=l,s?null!=(c=De(n,r))&&a.unshift(Ki(n,c,o)):s||null!=(c=De(n,r))&&a.push(Ki(n,c,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Xi=/\r\n?/g,Ji=/\u0000|\uFFFD/g;function Qi(e){return("string"===typeof e?e:""+e).replace(Xi,"\n").replace(Ji,"")}function Zi(e,t,n){if(t=Qi(t),Qi(e)!==t&&n)throw Error(r(425))}function $i(){}var es=null,ts=null;function ns(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var is="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,rs="function"===typeof Promise?Promise:void 0,as="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof rs?function(e){return rs.resolve(null).then(e).catch(os)}:is;function os(e){setTimeout(function(){throw e})}function cs(e,t){var n=t,i=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===i)return e.removeChild(s),void Gt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=s}while(n);Gt(t)}function ls(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ds(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var us=Math.random().toString(36).slice(2),hs="__reactFiber$"+us,ps="__reactProps$"+us,ms="__reactContainer$"+us,fs="__reactEvents$"+us,gs="__reactListeners$"+us,_s="__reactHandles$"+us;function ys(e){var t=e[hs];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ms]||n[hs]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ds(e);null!==e;){if(n=e[hs])return n;e=ds(e)}return t}n=(e=n).parentNode}return null}function vs(e){return!(e=e[hs]||e[ms])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Es(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function bs(e){return e[ps]||null}var Ss=[],xs=-1;function Ts(e){return{current:e}}function ws(e){0>xs||(e.current=Ss[xs],Ss[xs]=null,xs--)}function Ns(e,t){xs++,Ss[xs]=e.current,e.current=t}var Cs={},Rs=Ts(Cs),Is=Ts(!1),As=Cs;function Os(e,t){var n=e.type.contextTypes;if(!n)return Cs;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var s,r={};for(s in n)r[s]=t[s];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Ds(e){return null!==(e=e.childContextTypes)&&void 0!==e}function ks(){ws(Is),ws(Rs)}function Ps(e,t,n){if(Rs.current!==Cs)throw Error(r(168));Ns(Rs,t),Ns(Is,n)}function Ls(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var s in i=i.getChildContext())if(!(s in t))throw Error(r(108,W(e)||"Unknown",s));return M({},n,i)}function js(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cs,As=Rs.current,Ns(Rs,e),Ns(Is,Is.current),!0}function Ms(e,t,n){var i=e.stateNode;if(!i)throw Error(r(169));n?(e=Ls(e,t,As),i.__reactInternalMemoizedMergedChildContext=e,ws(Is),ws(Rs),Ns(Rs,e)):ws(Is),Ns(Is,n)}var Us=null,Vs=!1,Fs=!1;function Bs(e){null===Us?Us=[e]:Us.push(e)}function Gs(){if(!Fs&&null!==Us){Fs=!0;var e=0,t=vt;try{var n=Us;for(vt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Us=null,Vs=!1}catch(s){throw null!==Us&&(Us=Us.slice(e+1)),qe($e,Gs),s}finally{vt=t,Fs=!1}}return null}var Ws=[],Hs=0,Ks=null,zs=0,qs=[],Ys=0,Xs=null,Js=1,Qs="";function Zs(e,t){Ws[Hs++]=zs,Ws[Hs++]=Ks,Ks=e,zs=t}function $s(e,t,n){qs[Ys++]=Js,qs[Ys++]=Qs,qs[Ys++]=Xs,Xs=e;var i=Js;e=Qs;var s=32-at(i)-1;i&=~(1<<s),n+=1;var r=32-at(t)+s;if(30<r){var a=s-s%5;r=(i&(1<<a)-1).toString(32),i>>=a,s-=a,Js=1<<32-at(t)+s|n<<s|i,Qs=r+e}else Js=1<<r|n<<s|i,Qs=e}function er(e){null!==e.return&&(Zs(e,1),$s(e,1,0))}function tr(e){for(;e===Ks;)Ks=Ws[--Hs],Ws[Hs]=null,zs=Ws[--Hs],Ws[Hs]=null;for(;e===Xs;)Xs=qs[--Ys],qs[Ys]=null,Qs=qs[--Ys],qs[Ys]=null,Js=qs[--Ys],qs[Ys]=null}var nr=null,ir=null,sr=!1,rr=null;function ar(e,t){var n=Dl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function or(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,nr=e,ir=ls(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,nr=e,ir=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xs?{id:Js,overflow:Qs}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Dl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,nr=e,ir=null,!0);default:return!1}}function cr(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function lr(e){if(sr){var t=ir;if(t){var n=t;if(!or(e,t)){if(cr(e))throw Error(r(418));t=ls(n.nextSibling);var i=nr;t&&or(e,t)?ar(i,n):(e.flags=-4097&e.flags|2,sr=!1,nr=e)}}else{if(cr(e))throw Error(r(418));e.flags=-4097&e.flags|2,sr=!1,nr=e}}}function dr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;nr=e}function ur(e){if(e!==nr)return!1;if(!sr)return dr(e),sr=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ns(e.type,e.memoizedProps)),t&&(t=ir)){if(cr(e))throw hr(),Error(r(418));for(;t;)ar(e,t),t=ls(t.nextSibling)}if(dr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ir=ls(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ir=null}}else ir=nr?ls(e.stateNode.nextSibling):null;return!0}function hr(){for(var e=ir;e;)e=ls(e.nextSibling)}function pr(){ir=nr=null,sr=!1}function mr(e){null===rr?rr=[e]:rr.push(e)}var fr=E.ReactCurrentBatchConfig;function gr(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var _r=Ts(null),yr=null,vr=null,Er=null;function br(){Er=vr=yr=null}function Sr(e){var t=_r.current;ws(_r),e._currentValue=t}function xr(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Tr(e,t){yr=e,Er=vr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Eo=!0),e.firstContext=null)}function wr(e){var t=e._currentValue;if(Er!==e)if(e={context:e,memoizedValue:t,next:null},null===vr){if(null===yr)throw Error(r(308));vr=e,yr.dependencies={lanes:0,firstContext:e}}else vr=vr.next=e;return t}var Nr=null;function Cr(e){null===Nr?Nr=[e]:Nr.push(e)}function Rr(e,t,n,i){var s=t.interleaved;return null===s?(n.next=n,Cr(t)):(n.next=s.next,s.next=n),t.interleaved=n,Ir(e,i)}function Ir(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ar=!1;function Or(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function kr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Pr(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Ic)){var s=i.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),i.pending=t,Ir(e,n)}return null===(s=i.interleaved)?(t.next=t,Cr(i)):(t.next=s.next,s.next=t),i.interleaved=t,Ir(e,n)}function Lr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function jr(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var s=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?s=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?s=r=t:r=r.next=t}else s=r=t;return n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Mr(e,t,n,i){var s=e.updateQueue;Ar=!1;var r=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var c=o,l=c.next;c.next=null,null===a?r=l:a.next=l,a=c;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=l:o.next=l,d.lastBaseUpdate=c))}if(null!==r){var u=s.baseState;for(a=0,d=l=c=null,o=r;;){var h=o.lane,p=o.eventTime;if((i&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,f=o;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=M({},u,h);break e;case 2:Ar=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,a|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===d&&(c=u),s.baseState=c,s.firstBaseUpdate=l,s.lastBaseUpdate=d,null!==(t=s.shared.interleaved)){s=t;do{a|=s.lane,s=s.next}while(s!==t)}else null===r&&(s.shared.lanes=0);Mc|=a,e.lanes=a,e.memoizedState=u}}function Ur(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],s=i.callback;if(null!==s){if(i.callback=null,i=n,"function"!==typeof s)throw Error(r(191,s));s.call(i)}}}var Vr=(new i.Component).refs;function Fr(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Br={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tl(),s=nl(e),r=kr(i,s);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Pr(e,r,s))&&(il(t,e,s,i),Lr(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tl(),s=nl(e),r=kr(i,s);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Pr(e,r,s))&&(il(t,e,s,i),Lr(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),i=nl(e),s=kr(n,i);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Pr(e,s,i))&&(il(t,e,i,n),Lr(t,e,i))}};function Gr(e,t,n,i,s,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(s,r))}function Wr(e,t,n){var i=!1,s=Cs,r=t.contextType;return"object"===typeof r&&null!==r?r=wr(r):(s=Ds(t)?As:Rs.current,r=(i=null!==(i=t.contextTypes)&&void 0!==i)?Os(e,s):Cs),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Br,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=r),t}function Hr(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Br.enqueueReplaceState(t,t.state,null)}function Kr(e,t,n,i){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs=Vr,Or(e);var r=t.contextType;"object"===typeof r&&null!==r?s.context=wr(r):(r=Ds(t)?As:Rs.current,s.context=Os(e,r)),s.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(Fr(e,t,r,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&Br.enqueueReplaceState(s,s.state,null),Mr(e,n,s,i),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function zr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(r(309));var i=n.stateNode}if(!i)throw Error(r(147,e));var s=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=s.refs;t===Vr&&(t=s.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(r(284));if(!n._owner)throw Error(r(290,e))}return e}function qr(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yr(e){return(0,e._init)(e._payload)}function Xr(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Pl(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=Ul(n,e.mode,i)).return=e,t):((t=s(t,n)).return=e,t)}function l(e,t,n,i){var r=n.type;return r===x?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===D&&Yr(r)===t.type)?((i=s(t,n.props)).ref=zr(e,t,n),i.return=e,i):((i=Ll(n.type,n.key,n.props,null,e.mode,i)).ref=zr(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vl(n,e.mode,i)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function u(e,t,n,i,r){return null===t||7!==t.tag?((t=jl(n,e.mode,i,r)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ul(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Ll(t.type,t.key,t.props,null,e.mode,n)).ref=zr(e,null,t),n.return=e,n;case S:return(t=Vl(t,e.mode,n)).return=e,t;case D:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=jl(t,e.mode,n,null)).return=e,t;qr(e,t)}return null}function p(e,t,n,i){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===s?l(e,t,n,i):null;case S:return n.key===s?d(e,t,n,i):null;case D:return p(e,t,(s=n._init)(n._payload),i)}if(te(n)||L(n))return null!==s?null:u(e,t,n,i,null);qr(e,n)}return null}function m(e,t,n,i,s){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,s);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return l(t,e=e.get(null===i.key?n:i.key)||null,i,s);case S:return d(t,e=e.get(null===i.key?n:i.key)||null,i,s);case D:return m(e,t,n,(0,i._init)(i._payload),s)}if(te(i)||L(i))return u(t,e=e.get(n)||null,i,s,null);qr(t,i)}return null}function f(s,r,o,c){for(var l=null,d=null,u=r,f=r=0,g=null;null!==u&&f<o.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var _=p(s,u,o[f],c);if(null===_){null===u&&(u=g);break}e&&u&&null===_.alternate&&t(s,u),r=a(_,r,f),null===d?l=_:d.sibling=_,d=_,u=g}if(f===o.length)return n(s,u),sr&&Zs(s,f),l;if(null===u){for(;f<o.length;f++)null!==(u=h(s,o[f],c))&&(r=a(u,r,f),null===d?l=u:d.sibling=u,d=u);return sr&&Zs(s,f),l}for(u=i(s,u);f<o.length;f++)null!==(g=m(u,s,f,o[f],c))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),r=a(g,r,f),null===d?l=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(s,e)}),sr&&Zs(s,f),l}function g(s,o,c,l){var d=L(c);if("function"!==typeof d)throw Error(r(150));if(null==(c=d.call(c)))throw Error(r(151));for(var u=d=null,f=o,g=o=0,_=null,y=c.next();null!==f&&!y.done;g++,y=c.next()){f.index>g?(_=f,f=null):_=f.sibling;var v=p(s,f,y.value,l);if(null===v){null===f&&(f=_);break}e&&f&&null===v.alternate&&t(s,f),o=a(v,o,g),null===u?d=v:u.sibling=v,u=v,f=_}if(y.done)return n(s,f),sr&&Zs(s,g),d;if(null===f){for(;!y.done;g++,y=c.next())null!==(y=h(s,y.value,l))&&(o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return sr&&Zs(s,g),d}for(f=i(s,f);!y.done;g++,y=c.next())null!==(y=m(f,s,g,y.value,l))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return e&&f.forEach(function(e){return t(s,e)}),sr&&Zs(s,g),d}return function e(i,r,a,c){if("object"===typeof a&&null!==a&&a.type===x&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case b:e:{for(var l=a.key,d=r;null!==d;){if(d.key===l){if((l=a.type)===x){if(7===d.tag){n(i,d.sibling),(r=s(d,a.props.children)).return=i,i=r;break e}}else if(d.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===D&&Yr(l)===d.type){n(i,d.sibling),(r=s(d,a.props)).ref=zr(i,d,a),r.return=i,i=r;break e}n(i,d);break}t(i,d),d=d.sibling}a.type===x?((r=jl(a.props.children,i.mode,c,a.key)).return=i,i=r):((c=Ll(a.type,a.key,a.props,null,i.mode,c)).ref=zr(i,r,a),c.return=i,i=c)}return o(i);case S:e:{for(d=a.key;null!==r;){if(r.key===d){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(i,r.sibling),(r=s(r,a.children||[])).return=i,i=r;break e}n(i,r);break}t(i,r),r=r.sibling}(r=Vl(a,i.mode,c)).return=i,i=r}return o(i);case D:return e(i,r,(d=a._init)(a._payload),c)}if(te(a))return f(i,r,a,c);if(L(a))return g(i,r,a,c);qr(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==r&&6===r.tag?(n(i,r.sibling),(r=s(r,a)).return=i,i=r):(n(i,r),(r=Ul(a,i.mode,c)).return=i,i=r),o(i)):n(i,r)}}var Jr=Xr(!0),Qr=Xr(!1),Zr={},$r=Ts(Zr),ea=Ts(Zr),ta=Ts(Zr);function na(e){if(e===Zr)throw Error(r(174));return e}function ia(e,t){switch(Ns(ta,t),Ns(ea,e),Ns($r,Zr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ws($r),Ns($r,t)}function sa(){ws($r),ws(ea),ws(ta)}function ra(e){na(ta.current);var t=na($r.current),n=ce(t,e.type);t!==n&&(Ns(ea,e),Ns($r,n))}function aa(e){ea.current===e&&(ws($r),ws(ea))}var oa=Ts(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var la=[];function da(){for(var e=0;e<la.length;e++)la[e]._workInProgressVersionPrimary=null;la.length=0}var ua=E.ReactCurrentDispatcher,ha=E.ReactCurrentBatchConfig,pa=0,ma=null,fa=null,ga=null,_a=!1,ya=!1,va=0,Ea=0;function ba(){throw Error(r(321))}function Sa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!oi(e[n],t[n]))return!1;return!0}function xa(e,t,n,i,s,a){if(pa=a,ma=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ua.current=null===e||null===e.memoizedState?ao:oo,e=n(i,s),ya){a=0;do{if(ya=!1,va=0,25<=a)throw Error(r(301));a+=1,ga=fa=null,t.updateQueue=null,ua.current=co,e=n(i,s)}while(ya)}if(ua.current=ro,t=null!==fa&&null!==fa.next,pa=0,ga=fa=ma=null,_a=!1,t)throw Error(r(300));return e}function Ta(){var e=0!==va;return va=0,e}function wa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ga?ma.memoizedState=ga=e:ga=ga.next=e,ga}function Na(){if(null===fa){var e=ma.alternate;e=null!==e?e.memoizedState:null}else e=fa.next;var t=null===ga?ma.memoizedState:ga.next;if(null!==t)ga=t,fa=e;else{if(null===e)throw Error(r(310));e={memoizedState:(fa=e).memoizedState,baseState:fa.baseState,baseQueue:fa.baseQueue,queue:fa.queue,next:null},null===ga?ma.memoizedState=ga=e:ga=ga.next=e}return ga}function Ca(e,t){return"function"===typeof t?t(e):t}function Ra(e){var t=Na(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=fa,s=i.baseQueue,a=n.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}i.baseQueue=s=a,n.pending=null}if(null!==s){a=s.next,i=i.baseState;var c=o=null,l=null,d=a;do{var u=d.lane;if((pa&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:e(i,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===l?(c=l=h,o=i):l=l.next=h,ma.lanes|=u,Mc|=u}d=d.next}while(null!==d&&d!==a);null===l?o=i:l.next=c,oi(i,t.memoizedState)||(Eo=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){s=e;do{a=s.lane,ma.lanes|=a,Mc|=a,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ia(e){var t=Na(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,s=n.pending,a=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);oi(a,t.memoizedState)||(Eo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Aa(){}function Oa(e,t){var n=ma,i=Na(),s=t(),a=!oi(i.memoizedState,s);if(a&&(i.memoizedState=s,Eo=!0),i=i.queue,Wa(Pa.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==ga&&1&ga.memoizedState.tag){if(n.flags|=2048,Ua(9,ka.bind(null,n,i,s,t),void 0,null),null===Ac)throw Error(r(349));0!==(30&pa)||Da(n,t,s)}return s}function Da(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ka(e,t,n,i){t.value=n,t.getSnapshot=i,La(t)&&ja(e)}function Pa(e,t,n){return n(function(){La(t)&&ja(e)})}function La(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!oi(e,n)}catch(i){return!0}}function ja(e){var t=Ir(e,1);null!==t&&il(t,e,1,-1)}function Ma(e){var t=wa();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:e},t.queue=e,e=e.dispatch=to.bind(null,ma,e),[t.memoizedState,e]}function Ua(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Va(){return Na().memoizedState}function Fa(e,t,n,i){var s=wa();ma.flags|=e,s.memoizedState=Ua(1|t,n,void 0,void 0===i?null:i)}function Ba(e,t,n,i){var s=Na();i=void 0===i?null:i;var r=void 0;if(null!==fa){var a=fa.memoizedState;if(r=a.destroy,null!==i&&Sa(i,a.deps))return void(s.memoizedState=Ua(t,n,r,i))}ma.flags|=e,s.memoizedState=Ua(1|t,n,r,i)}function Ga(e,t){return Fa(8390656,8,e,t)}function Wa(e,t){return Ba(2048,8,e,t)}function Ha(e,t){return Ba(4,2,e,t)}function Ka(e,t){return Ba(4,4,e,t)}function za(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ba(4,4,za.bind(null,t,e),n)}function Ya(){}function Xa(e,t){var n=Na();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Sa(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ja(e,t){var n=Na();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Sa(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Qa(e,t,n){return 0===(21&pa)?(e.baseState&&(e.baseState=!1,Eo=!0),e.memoizedState=n):(oi(n,t)||(n=ft(),ma.lanes|=n,Mc|=n,e.baseState=!0),t)}function Za(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var i=ha.transition;ha.transition={};try{e(!1),t()}finally{vt=n,ha.transition=i}}function $a(){return Na().memoizedState}function eo(e,t,n){var i=nl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},no(e))io(t,n);else if(null!==(n=Rr(e,t,n,i))){il(n,e,i,tl()),so(n,t,i)}}function to(e,t,n){var i=nl(e),s={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(no(e))io(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=r(a,n);if(s.hasEagerState=!0,s.eagerState=o,oi(o,a)){var c=t.interleaved;return null===c?(s.next=s,Cr(t)):(s.next=c.next,c.next=s),void(t.interleaved=s)}}catch(l){}null!==(n=Rr(e,t,s,i))&&(il(n,e,i,s=tl()),so(n,t,i))}}function no(e){var t=e.alternate;return e===ma||null!==t&&t===ma}function io(e,t){ya=_a=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function so(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var ro={readContext:wr,useCallback:ba,useContext:ba,useEffect:ba,useImperativeHandle:ba,useInsertionEffect:ba,useLayoutEffect:ba,useMemo:ba,useReducer:ba,useRef:ba,useState:ba,useDebugValue:ba,useDeferredValue:ba,useTransition:ba,useMutableSource:ba,useSyncExternalStore:ba,useId:ba,unstable_isNewReconciler:!1},ao={readContext:wr,useCallback:function(e,t){return wa().memoizedState=[e,void 0===t?null:t],e},useContext:wr,useEffect:Ga,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Fa(4194308,4,za.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Fa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Fa(4,2,e,t)},useMemo:function(e,t){var n=wa();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=wa();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=eo.bind(null,ma,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},wa().memoizedState=e},useState:Ma,useDebugValue:Ya,useDeferredValue:function(e){return wa().memoizedState=e},useTransition:function(){var e=Ma(!1),t=e[0];return e=Za.bind(null,e[1]),wa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ma,s=wa();if(sr){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===Ac)throw Error(r(349));0!==(30&pa)||Da(i,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Ga(Pa.bind(null,i,a,e),[e]),i.flags|=2048,Ua(9,ka.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=wa(),t=Ac.identifierPrefix;if(sr){var n=Qs;t=":"+t+"R"+(n=(Js&~(1<<32-at(Js)-1)).toString(32)+n),0<(n=va++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ea++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},oo={readContext:wr,useCallback:Xa,useContext:wr,useEffect:Wa,useImperativeHandle:qa,useInsertionEffect:Ha,useLayoutEffect:Ka,useMemo:Ja,useReducer:Ra,useRef:Va,useState:function(){return Ra(Ca)},useDebugValue:Ya,useDeferredValue:function(e){return Qa(Na(),fa.memoizedState,e)},useTransition:function(){return[Ra(Ca)[0],Na().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1},co={readContext:wr,useCallback:Xa,useContext:wr,useEffect:Wa,useImperativeHandle:qa,useInsertionEffect:Ha,useLayoutEffect:Ka,useMemo:Ja,useReducer:Ia,useRef:Va,useState:function(){return Ia(Ca)},useDebugValue:Ya,useDeferredValue:function(e){var t=Na();return null===fa?t.memoizedState=e:Qa(t,fa.memoizedState,e)},useTransition:function(){return[Ia(Ca)[0],Na().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1};function lo(e,t){try{var n="",i=t;do{n+=B(i),i=i.return}while(i);var s=n}catch(r){s="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:s,digest:null}}function uo(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ho(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var po="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,n){(n=kr(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Kc||(Kc=!0,zc=i),ho(0,t)},n}function fo(e,t,n){(n=kr(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var s=t.value;n.payload=function(){return i(s)},n.callback=function(){ho(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){ho(0,t),"function"!==typeof i&&(null===qc?qc=new Set([this]):qc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function go(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new po;var s=new Set;i.set(t,s)}else void 0===(s=i.get(t))&&(s=new Set,i.set(t,s));s.has(n)||(s.add(n),e=Nl.bind(null,e,t,n),t.then(e,e))}function _o(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function yo(e,t,n,i,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=kr(-1,1)).tag=2,Pr(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var vo=E.ReactCurrentOwner,Eo=!1;function bo(e,t,n,i){t.child=null===e?Qr(t,null,n,i):Jr(t,e.child,n,i)}function So(e,t,n,i,s){n=n.render;var r=t.ref;return Tr(t,s),i=xa(e,t,n,i,r,s),n=Ta(),null===e||Eo?(sr&&n&&er(t),t.flags|=1,bo(e,t,i,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Ko(e,t,s))}function xo(e,t,n,i,s){if(null===e){var r=n.type;return"function"!==typeof r||kl(r)||void 0!==r.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ll(n.type,null,i,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,To(e,t,r,i,s))}if(r=e.child,0===(e.lanes&s)){var a=r.memoizedProps;if((n=null!==(n=n.compare)?n:ci)(a,i)&&e.ref===t.ref)return Ko(e,t,s)}return t.flags|=1,(e=Pl(r,i)).ref=t.ref,e.return=t,t.child=e}function To(e,t,n,i,s){if(null!==e){var r=e.memoizedProps;if(ci(r,i)&&e.ref===t.ref){if(Eo=!1,t.pendingProps=i=r,0===(e.lanes&s))return t.lanes=e.lanes,Ko(e,t,s);0!==(131072&e.flags)&&(Eo=!0)}}return Co(e,t,n,i,s)}function wo(e,t,n){var i=t.pendingProps,s=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ns(Pc,kc),kc|=n;else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ns(Pc,kc),kc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==r?r.baseLanes:n,Ns(Pc,kc),kc|=i}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,Ns(Pc,kc),kc|=i;return bo(e,t,s,n),t.child}function No(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,n,i,s){var r=Ds(n)?As:Rs.current;return r=Os(t,r),Tr(t,s),n=xa(e,t,n,i,r,s),i=Ta(),null===e||Eo?(sr&&i&&er(t),t.flags|=1,bo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Ko(e,t,s))}function Ro(e,t,n,i,s){if(Ds(n)){var r=!0;js(t)}else r=!1;if(Tr(t,s),null===t.stateNode)Ho(e,t),Wr(t,n,i),Kr(t,n,i,s),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var c=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=wr(l):l=Os(t,l=Ds(n)?As:Rs.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||c!==l)&&Hr(t,a,i,l),Ar=!1;var h=t.memoizedState;a.state=h,Mr(t,i,a,s),c=t.memoizedState,o!==i||h!==c||Is.current||Ar?("function"===typeof d&&(Fr(t,n,d,i),c=t.memoizedState),(o=Ar||Gr(t,n,o,i,h,c,l))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),a.props=i,a.state=c,a.context=l,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Dr(e,t),o=t.memoizedProps,l=t.type===t.elementType?o:gr(t.type,o),a.props=l,u=t.pendingProps,h=a.context,"object"===typeof(c=n.contextType)&&null!==c?c=wr(c):c=Os(t,c=Ds(n)?As:Rs.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==c)&&Hr(t,a,i,c),Ar=!1,h=t.memoizedState,a.state=h,Mr(t,i,a,s);var m=t.memoizedState;o!==u||h!==m||Is.current||Ar?("function"===typeof p&&(Fr(t,n,p,i),m=t.memoizedState),(l=Ar||Gr(t,n,l,i,h,m,c)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,m,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,m,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),a.props=i,a.state=m,a.context=c,i=l):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Io(e,t,n,i,r,s)}function Io(e,t,n,i,s,r){No(e,t);var a=0!==(128&t.flags);if(!i&&!a)return s&&Ms(t,n,!1),Ko(e,t,r);i=t.stateNode,vo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=Jr(t,e.child,null,r),t.child=Jr(t,null,o,r)):bo(e,t,o,r),t.memoizedState=i.state,s&&Ms(t,n,!0),t.child}function Ao(e){var t=e.stateNode;t.pendingContext?Ps(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ps(0,t.context,!1),ia(e,t.containerInfo)}function Oo(e,t,n,i,s){return pr(),mr(s),t.flags|=256,bo(e,t,n,i),t.child}var Do,ko,Po,Lo,jo={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,n){var i,s=t.pendingProps,a=oa.current,o=!1,c=0!==(128&t.flags);if((i=c)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ns(oa,1&a),null===e)return lr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=s.children,e=s.fallback,o?(s=t.mode,o=t.child,c={mode:"hidden",children:c},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=c):o=Ml(c,s,0,null),e=jl(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(n),t.memoizedState=jo,e):Vo(t,c));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,s,a,o){if(n)return 256&t.flags?(t.flags&=-257,Fo(e,t,o,i=uo(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,s=t.mode,i=Ml({mode:"visible",children:i.children},s,0,null),(a=jl(a,s,o,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&Jr(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=jo,a);if(0===(1&t.mode))return Fo(e,t,o,null);if("$!"===s.data){if(i=s.nextSibling&&s.nextSibling.dataset)var c=i.dgst;return i=c,Fo(e,t,o,i=uo(a=Error(r(419)),i,void 0))}if(c=0!==(o&e.childLanes),Eo||c){if(null!==(i=Ac)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(i.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Ir(e,s),il(i,e,s,-1))}return gl(),Fo(e,t,o,i=uo(Error(r(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Rl.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,ir=ls(s.nextSibling),nr=t,sr=!0,rr=null,null!==e&&(qs[Ys++]=Js,qs[Ys++]=Qs,qs[Ys++]=Xs,Js=e.id,Qs=e.overflow,Xs=t),t=Vo(t,i.children),t.flags|=4096,t)}(e,t,c,s,i,a,n);if(o){o=s.fallback,c=t.mode,i=(a=e.child).sibling;var l={mode:"hidden",children:s.children};return 0===(1&c)&&t.child!==a?((s=t.child).childLanes=0,s.pendingProps=l,t.deletions=null):(s=Pl(a,l)).subtreeFlags=14680064&a.subtreeFlags,null!==i?o=Pl(i,o):(o=jl(o,c,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,c=null===(c=e.child.memoizedState)?Mo(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},o.memoizedState=c,o.childLanes=e.childLanes&~n,t.memoizedState=jo,s}return e=(o=e.child).sibling,s=Pl(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Vo(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fo(e,t,n,i){return null!==i&&mr(i),Jr(t,e.child,null,n),(e=Vo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bo(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),xr(e.return,t,n)}function Go(e,t,n,i,s){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=s)}function Wo(e,t,n){var i=t.pendingProps,s=i.revealOrder,r=i.tail;if(bo(e,t,i.children,n),0!==(2&(i=oa.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bo(e,n,t);else if(19===e.tag)Bo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Ns(oa,i),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Go(t,!1,s,n,r);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ca(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Go(t,!0,n,null,r);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ko(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Pl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function zo(e,t){if(!sr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=14680064&s.subtreeFlags,i|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Yo(e,t,n){var i=t.pendingProps;switch(tr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:case 17:return Ds(t.type)&&ks(),qo(t),null;case 3:return i=t.stateNode,sa(),ws(Is),ws(Rs),da(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ur(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==rr&&(ol(rr),rr=null))),ko(e,t),qo(t),null;case 5:aa(t);var s=na(ta.current);if(n=t.type,null!==e&&null!=t.stateNode)Po(e,t,n,i,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(r(166));return qo(t),null}if(e=na($r.current),ur(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[hs]=t,i[ps]=a,e=0!==(1&t.mode),n){case"dialog":Vi("cancel",i),Vi("close",i);break;case"iframe":case"object":case"embed":Vi("load",i);break;case"video":case"audio":for(s=0;s<Li.length;s++)Vi(Li[s],i);break;case"source":Vi("error",i);break;case"img":case"image":case"link":Vi("error",i),Vi("load",i);break;case"details":Vi("toggle",i);break;case"input":J(i,a),Vi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Vi("invalid",i);break;case"textarea":se(i,a),Vi("invalid",i)}for(var c in ye(n,a),s=null,a)if(a.hasOwnProperty(c)){var l=a[c];"children"===c?"string"===typeof l?i.textContent!==l&&(!0!==a.suppressHydrationWarning&&Zi(i.textContent,l,e),s=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==a.suppressHydrationWarning&&Zi(i.textContent,l,e),s=["children",""+l]):o.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Vi("scroll",i)}switch(n){case"input":z(i),$(i,a,!0);break;case"textarea":z(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=$i)}i=s,t.updateQueue=i,null!==i&&(t.flags|=4)}else{c=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[hs]=t,e[ps]=i,Do(e,t,!1,!1),t.stateNode=e;e:{switch(c=ve(n,i),n){case"dialog":Vi("cancel",e),Vi("close",e),s=i;break;case"iframe":case"object":case"embed":Vi("load",e),s=i;break;case"video":case"audio":for(s=0;s<Li.length;s++)Vi(Li[s],e);s=i;break;case"source":Vi("error",e),s=i;break;case"img":case"image":case"link":Vi("error",e),Vi("load",e),s=i;break;case"details":Vi("toggle",e),s=i;break;case"input":J(e,i),s=X(e,i),Vi("invalid",e);break;case"option":default:s=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},s=M({},i,{value:void 0}),Vi("invalid",e);break;case"textarea":se(e,i),s=ie(e,i),Vi("invalid",e)}for(a in ye(n,s),l=s)if(l.hasOwnProperty(a)){var d=l[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Vi("scroll",e):null!=d&&v(e,a,d,c))}switch(n){case"input":z(e),$(e,i,!1);break;case"textarea":z(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+H(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&null!=t.stateNode)Lo(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(r(166));if(n=na(ta.current),na($r.current),ur(t)){if(i=t.stateNode,n=t.memoizedProps,i[hs]=t,(a=i.nodeValue!==n)&&null!==(e=nr))switch(e.tag){case 3:Zi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zi(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hs]=t,t.stateNode=i}return qo(t),null;case 13:if(ws(oa),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(sr&&null!==ir&&0!==(1&t.mode)&&0===(128&t.flags))hr(),pr(),t.flags|=98560,a=!1;else if(a=ur(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));a[hs]=t}else pr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qo(t),a=!1}else null!==rr&&(ol(rr),rr=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&oa.current)?0===Lc&&(Lc=3):gl())),null!==t.updateQueue&&(t.flags|=4),qo(t),null);case 4:return sa(),ko(e,t),null===e&&Gi(t.stateNode.containerInfo),qo(t),null;case 10:return Sr(t.type._context),qo(t),null;case 19:if(ws(oa),null===(a=t.memoizedState))return qo(t),null;if(i=0!==(128&t.flags),null===(c=a.rendering))if(i)zo(a,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ca(e))){for(t.flags|=128,zo(a,!1),null!==(i=c.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ns(oa,1&oa.current|2),t.child}e=e.sibling}null!==a.tail&&Qe()>Wc&&(t.flags|=128,i=!0,zo(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ca(c))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),zo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!c.alternate&&!sr)return qo(t),null}else 2*Qe()-a.renderingStartTime>Wc&&1073741824!==n&&(t.flags|=128,i=!0,zo(a,!1),t.lanes=4194304);a.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=a.last)?n.sibling=c:t.child=c,a.last=c)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Qe(),t.sibling=null,n=oa.current,Ns(oa,i?1&n|2:1&n),t):(qo(t),null);case 22:case 23:return hl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&kc)&&(qo(t),6&t.subtreeFlags&&(t.flags|=8192)):qo(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function Xo(e,t){switch(tr(t),t.tag){case 1:return Ds(t.type)&&ks(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return sa(),ws(Is),ws(Rs),da(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return aa(t),null;case 13:if(ws(oa),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));pr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ws(oa),null;case 4:return sa(),null;case 10:return Sr(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Do=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ko=function(){},Po=function(e,t,n,i){var s=e.memoizedProps;if(s!==i){e=t.stateNode,na($r.current);var r,a=null;switch(n){case"input":s=X(e,s),i=X(e,i),a=[];break;case"select":s=M({},s,{value:void 0}),i=M({},i,{value:void 0}),a=[];break;case"textarea":s=ie(e,s),i=ie(e,i),a=[];break;default:"function"!==typeof s.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(d in ye(n,i),n=null,s)if(!i.hasOwnProperty(d)&&s.hasOwnProperty(d)&&null!=s[d])if("style"===d){var c=s[d];for(r in c)c.hasOwnProperty(r)&&(n||(n={}),n[r]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in i){var l=i[d];if(c=null!=s?s[d]:void 0,i.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(r in c)!c.hasOwnProperty(r)||l&&l.hasOwnProperty(r)||(n||(n={}),n[r]="");for(r in l)l.hasOwnProperty(r)&&c[r]!==l[r]&&(n||(n={}),n[r]=l[r])}else n||(a||(a=[]),a.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Vi("scroll",e),a||c===l||(a=[])):(a=a||[]).push(d,l))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Lo=function(e,t,n,i){n!==i&&(t.flags|=4)};var Jo=!1,Qo=!1,Zo="function"===typeof WeakSet?WeakSet:Set,$o=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){wl(e,t,i)}else n.current=null}function tc(e,t,n){try{n()}catch(i){wl(e,t,i)}}var nc=!1;function ic(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var s=i=i.next;do{if((s.tag&e)===e){var r=s.destroy;s.destroy=void 0,void 0!==r&&tc(t,n,r)}s=s.next}while(s!==i)}}function sc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ac(e){var t=e.alternate;null!==t&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hs],delete t[ps],delete t[fs],delete t[gs],delete t[_s])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}function dc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(dc(e,t,n),e=e.sibling;null!==e;)dc(e,t,n),e=e.sibling}var uc=null,hc=!1;function pc(e,t,n){for(n=n.child;null!==n;)mc(e,t,n),n=n.sibling}function mc(e,t,n){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(st,n)}catch(o){}switch(n.tag){case 5:Qo||ec(n,t);case 6:var i=uc,s=hc;uc=null,pc(e,t,n),hc=s,null!==(uc=i)&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?cs(e.parentNode,n):1===e.nodeType&&cs(e,n),Gt(e)):cs(uc,n.stateNode));break;case 4:i=uc,s=hc,uc=n.stateNode.containerInfo,hc=!0,pc(e,t,n),uc=i,hc=s;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){s=i=i.next;do{var r=s,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&tc(n,t,a),s=s.next}while(s!==i)}pc(e,t,n);break;case 1:if(!Qo&&(ec(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(o){wl(n,t,o)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Qo=(i=Qo)||null!==n.memoizedState,pc(e,t,n),Qo=i):pc(e,t,n);break;default:pc(e,t,n)}}function fc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zo),t.forEach(function(t){var i=Il.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function gc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var s=n[i];try{var a=e,o=t,c=o;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,hc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===uc)throw Error(r(160));mc(a,o,s),uc=null,hc=!1;var l=s.alternate;null!==l&&(l.return=null),s.return=null}catch(d){wl(s,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)_c(t,e),t=t.sibling}function _c(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),yc(e),4&i){try{ic(3,e,e.return),sc(3,e)}catch(g){wl(e,e.return,g)}try{ic(5,e,e.return)}catch(g){wl(e,e.return,g)}}break;case 1:gc(t,e),yc(e),512&i&&null!==n&&ec(n,n.return);break;case 5:if(gc(t,e),yc(e),512&i&&null!==n&&ec(n,n.return),32&e.flags){var s=e.stateNode;try{he(s,"")}catch(g){wl(e,e.return,g)}}if(4&i&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&Q(s,a),ve(c,o);var d=ve(c,a);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];"style"===u?ge(s,h):"dangerouslySetInnerHTML"===u?ue(s,h):"children"===u?he(s,h):v(s,u,h,d)}switch(c){case"input":Z(s,a);break;case"textarea":re(s,a);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ne(s,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(s,!!a.multiple,a.defaultValue,!0):ne(s,!!a.multiple,a.multiple?[]:"",!1))}s[ps]=a}catch(g){wl(e,e.return,g)}}break;case 6:if(gc(t,e),yc(e),4&i){if(null===e.stateNode)throw Error(r(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(g){wl(e,e.return,g)}}break;case 3:if(gc(t,e),yc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){wl(e,e.return,g)}break;case 4:default:gc(t,e),yc(e);break;case 13:gc(t,e),yc(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(Gc=Qe())),4&i&&fc(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Qo=(d=Qo)||u,gc(t,e),Qo=d):gc(t,e),yc(e),8192&i){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for($o=e,u=e.child;null!==u;){for(h=$o=u;null!==$o;){switch(m=(p=$o).child,p.tag){case 0:case 11:case 14:case 15:ic(4,p,p.return);break;case 1:ec(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){i=p,n=p.return;try{t=i,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){wl(i,n,g)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){Sc(h);continue}}null!==m?(m.return=p,$o=m):Sc(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{s=h.stateNode,d?"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,o=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",o))}catch(g){wl(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){wl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gc(t,e),yc(e),4&i&&fc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(oc(n)){var i=n;break e}n=n.return}throw Error(r(160))}switch(i.tag){case 5:var s=i.stateNode;32&i.flags&&(he(s,""),i.flags&=-33),dc(e,cc(e),s);break;case 3:case 4:var a=i.stateNode.containerInfo;lc(e,cc(e),a);break;default:throw Error(r(161))}}catch(o){wl(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vc(e,t,n){$o=e,Ec(e,t,n)}function Ec(e,t,n){for(var i=0!==(1&e.mode);null!==$o;){var s=$o,r=s.child;if(22===s.tag&&i){var a=null!==s.memoizedState||Jo;if(!a){var o=s.alternate,c=null!==o&&null!==o.memoizedState||Qo;o=Jo;var l=Qo;if(Jo=a,(Qo=c)&&!l)for($o=s;null!==$o;)c=(a=$o).child,22===a.tag&&null!==a.memoizedState?xc(s):null!==c?(c.return=a,$o=c):xc(s);for(;null!==r;)$o=r,Ec(r,t,n),r=r.sibling;$o=s,Jo=o,Qo=l}bc(e)}else 0!==(8772&s.subtreeFlags)&&null!==r?(r.return=s,$o=r):bc(e)}}function bc(e){for(;null!==$o;){var t=$o;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||sc(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Qo)if(null===n)i.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:gr(t.type,n.memoizedProps);i.componentDidUpdate(s,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ur(t,a,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ur(t,o,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(r(163))}Qo||512&t.flags&&rc(t)}catch(p){wl(t,t.return,p)}}if(t===e){$o=null;break}if(null!==(n=t.sibling)){n.return=t.return,$o=n;break}$o=t.return}}function Sc(e){for(;null!==$o;){var t=$o;if(t===e){$o=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$o=n;break}$o=t.return}}function xc(e){for(;null!==$o;){var t=$o;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{sc(4,t)}catch(c){wl(t,n,c)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var s=t.return;try{i.componentDidMount()}catch(c){wl(t,s,c)}}var r=t.return;try{rc(t)}catch(c){wl(t,r,c)}break;case 5:var a=t.return;try{rc(t)}catch(c){wl(t,a,c)}}}catch(c){wl(t,t.return,c)}if(t===e){$o=null;break}var o=t.sibling;if(null!==o){o.return=t.return,$o=o;break}$o=t.return}}var Tc,wc=Math.ceil,Nc=E.ReactCurrentDispatcher,Cc=E.ReactCurrentOwner,Rc=E.ReactCurrentBatchConfig,Ic=0,Ac=null,Oc=null,Dc=0,kc=0,Pc=Ts(0),Lc=0,jc=null,Mc=0,Uc=0,Vc=0,Fc=null,Bc=null,Gc=0,Wc=1/0,Hc=null,Kc=!1,zc=null,qc=null,Yc=!1,Xc=null,Jc=0,Qc=0,Zc=null,$c=-1,el=0;function tl(){return 0!==(6&Ic)?Qe():-1!==$c?$c:$c=Qe()}function nl(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==Dc?Dc&-Dc:null!==fr.transition?(0===el&&(el=ft()),el):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function il(e,t,n,i){if(50<Qc)throw Qc=0,Zc=null,Error(r(185));_t(e,n,i),0!==(2&Ic)&&e===Ac||(e===Ac&&(0===(2&Ic)&&(Uc|=n),4===Lc&&cl(e,Dc)),sl(e,i),1===n&&0===Ic&&0===(1&t.mode)&&(Wc=Qe()+500,Vs&&Gs()))}function sl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,r=e.pendingLanes;0<r;){var a=31-at(r),o=1<<a,c=s[a];-1===c?0!==(o&n)&&0===(o&i)||(s[a]=pt(o,t)):c<=t&&(e.expiredLanes|=o),r&=~o}}(e,t);var i=ht(e,e===Ac?Dc:0);if(0===i)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Vs=!0,Bs(e)}(ll.bind(null,e)):Bs(ll.bind(null,e)),as(function(){0===(6&Ic)&&Gs()}),n=null;else{switch(Et(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Al(n,rl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rl(e,t){if($c=-1,el=0,0!==(6&Ic))throw Error(r(327));var n=e.callbackNode;if(xl()&&e.callbackNode!==n)return null;var i=ht(e,e===Ac?Dc:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=_l(e,i);else{t=i;var s=Ic;Ic|=2;var a=fl();for(Ac===e&&Dc===t||(Hc=null,Wc=Qe()+500,pl(e,t));;)try{vl();break}catch(c){ml(e,c)}br(),Nc.current=a,Ic=s,null!==Oc?t=0:(Ac=null,Dc=0,t=Lc)}if(0!==t){if(2===t&&(0!==(s=mt(e))&&(i=s,t=al(e,s))),1===t)throw n=jc,pl(e,0),cl(e,i),sl(e,Qe()),n;if(6===t)cl(e,i);else{if(s=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var s=n[i],r=s.getSnapshot;s=s.value;try{if(!oi(r(),s))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=_l(e,i))&&(0!==(a=mt(e))&&(i=a,t=al(e,a))),1===t))throw n=jc,pl(e,0),cl(e,i),sl(e,Qe()),n;switch(e.finishedWork=s,e.finishedLanes=i,t){case 0:case 1:throw Error(r(345));case 2:case 5:Sl(e,Bc,Hc);break;case 3:if(cl(e,i),(130023424&i)===i&&10<(t=Gc+500-Qe())){if(0!==ht(e,0))break;if(((s=e.suspendedLanes)&i)!==i){tl(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=is(Sl.bind(null,e,Bc,Hc),t);break}Sl(e,Bc,Hc);break;case 4:if(cl(e,i),(4194240&i)===i)break;for(t=e.eventTimes,s=-1;0<i;){var o=31-at(i);a=1<<o,(o=t[o])>s&&(s=o),i&=~a}if(i=s,10<(i=(120>(i=Qe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*wc(i/1960))-i)){e.timeoutHandle=is(Sl.bind(null,e,Bc,Hc),i);break}Sl(e,Bc,Hc);break;default:throw Error(r(329))}}}return sl(e,Qe()),e.callbackNode===n?rl.bind(null,e):null}function al(e,t){var n=Fc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=_l(e,t))&&(t=Bc,Bc=n,null!==t&&ol(t)),e}function ol(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function cl(e,t){for(t&=~Vc,t&=~Uc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function ll(e){if(0!==(6&Ic))throw Error(r(327));xl();var t=ht(e,0);if(0===(1&t))return sl(e,Qe()),null;var n=_l(e,t);if(0!==e.tag&&2===n){var i=mt(e);0!==i&&(t=i,n=al(e,i))}if(1===n)throw n=jc,pl(e,0),cl(e,t),sl(e,Qe()),n;if(6===n)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sl(e,Bc,Hc),sl(e,Qe()),null}function dl(e,t){var n=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=n)&&(Wc=Qe()+500,Vs&&Gs())}}function ul(e){null!==Xc&&0===Xc.tag&&0===(6&Ic)&&xl();var t=Ic;Ic|=1;var n=Rc.transition,i=vt;try{if(Rc.transition=null,vt=1,e)return e()}finally{vt=i,Rc.transition=n,0===(6&(Ic=t))&&Gs()}}function hl(){kc=Pc.current,ws(Pc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ss(n)),null!==Oc)for(n=Oc.return;null!==n;){var i=n;switch(tr(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&ks();break;case 3:sa(),ws(Is),ws(Rs),da();break;case 5:aa(i);break;case 4:sa();break;case 13:case 19:ws(oa);break;case 10:Sr(i.type._context);break;case 22:case 23:hl()}n=n.return}if(Ac=e,Oc=e=Pl(e.current,null),Dc=kc=t,Lc=0,jc=null,Vc=Uc=Mc=0,Bc=Fc=null,null!==Nr){for(t=0;t<Nr.length;t++)if(null!==(i=(n=Nr[t]).interleaved)){n.interleaved=null;var s=i.next,r=n.pending;if(null!==r){var a=r.next;r.next=s,i.next=a}n.pending=i}Nr=null}return e}function ml(e,t){for(;;){var n=Oc;try{if(br(),ua.current=ro,_a){for(var i=ma.memoizedState;null!==i;){var s=i.queue;null!==s&&(s.pending=null),i=i.next}_a=!1}if(pa=0,ga=fa=ma=null,ya=!1,va=0,Cc.current=null,null===n||null===n.return){Lc=1,jc=t,Oc=null;break}e:{var a=e,o=n.return,c=n,l=t;if(t=Dc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l,u=c,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=_o(o);if(null!==m){m.flags&=-257,yo(m,o,c,0,t),1&m.mode&&go(a,d,t),l=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}if(0===(1&t)){go(a,d,t),gl();break e}l=Error(r(426))}else if(sr&&1&c.mode){var _=_o(o);if(null!==_){0===(65536&_.flags)&&(_.flags|=256),yo(_,o,c,0,t),mr(lo(l,c));break e}}a=l=lo(l,c),4!==Lc&&(Lc=2),null===Fc?Fc=[a]:Fc.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,jr(a,mo(0,l,t));break e;case 1:c=l;var y=a.type,v=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===qc||!qc.has(v)))){a.flags|=65536,t&=-t,a.lanes|=t,jr(a,fo(a,c,t));break e}}a=a.return}while(null!==a)}bl(n)}catch(E){t=E,Oc===n&&null!==n&&(Oc=n=n.return);continue}break}}function fl(){var e=Nc.current;return Nc.current=ro,null===e?ro:e}function gl(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Ac||0===(268435455&Mc)&&0===(268435455&Uc)||cl(Ac,Dc)}function _l(e,t){var n=Ic;Ic|=2;var i=fl();for(Ac===e&&Dc===t||(Hc=null,pl(e,t));;)try{yl();break}catch(s){ml(e,s)}if(br(),Ic=n,Nc.current=i,null!==Oc)throw Error(r(261));return Ac=null,Dc=0,Lc}function yl(){for(;null!==Oc;)El(Oc)}function vl(){for(;null!==Oc&&!Xe();)El(Oc)}function El(e){var t=Tc(e.alternate,e,kc);e.memoizedProps=e.pendingProps,null===t?bl(e):Oc=t,Cc.current=null}function bl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yo(n,t,kc)))return void(Oc=n)}else{if(null!==(n=Xo(n,t)))return n.flags&=32767,void(Oc=n);if(null===e)return Lc=6,void(Oc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Oc=t);Oc=t=e}while(null!==t);0===Lc&&(Lc=5)}function Sl(e,t,n){var i=vt,s=Rc.transition;try{Rc.transition=null,vt=1,function(e,t,n,i){do{xl()}while(null!==Xc);if(0!==(6&Ic))throw Error(r(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-at(n),r=1<<s;t[s]=0,i[s]=-1,e[s]=-1,n&=~r}}(e,a),e===Ac&&(Oc=Ac=null,Dc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yc||(Yc=!0,Al(tt,function(){return xl(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Rc.transition,Rc.transition=null;var o=vt;vt=1;var c=Ic;Ic|=4,Cc.current=null,function(e,t){if(es=Ht,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var s=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(b){n=null;break e}var o=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==s&&3!==h.nodeType||(c=o+s),h!==a||0!==i&&3!==h.nodeType||(l=o+i),3===h.nodeType&&(o+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===s&&(c=o),p===a&&++u===i&&(l=o),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ts={focusedElem:e,selectionRange:n},Ht=!1,$o=t;null!==$o;)if(e=(t=$o).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$o=e;else for(;null!==$o;){t=$o;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,_=f.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:gr(t.type,g),_);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(r(163))}}catch(b){wl(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$o=e;break}$o=t.return}f=nc,nc=!1}(e,n),_c(n,e),mi(ts),Ht=!!es,ts=es=null,e.current=n,vc(n,e,s),Je(),Ic=c,vt=o,Rc.transition=a}else e.current=n;if(Yc&&(Yc=!1,Xc=e,Jc=s),a=e.pendingLanes,0===a&&(qc=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),sl(e,Qe()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],i(s.value,{componentStack:s.stack,digest:s.digest});if(Kc)throw Kc=!1,e=zc,zc=null,e;0!==(1&Jc)&&0!==e.tag&&xl(),a=e.pendingLanes,0!==(1&a)?e===Zc?Qc++:(Qc=0,Zc=e):Qc=0,Gs()}(e,t,n,i)}finally{Rc.transition=s,vt=i}return null}function xl(){if(null!==Xc){var e=Et(Jc),t=Rc.transition,n=vt;try{if(Rc.transition=null,vt=16>e?16:e,null===Xc)var i=!1;else{if(e=Xc,Xc=null,Jc=0,0!==(6&Ic))throw Error(r(331));var s=Ic;for(Ic|=4,$o=e.current;null!==$o;){var a=$o,o=a.child;if(0!==(16&$o.flags)){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var d=c[l];for($o=d;null!==$o;){var u=$o;switch(u.tag){case 0:case 11:case 15:ic(8,u,a)}var h=u.child;if(null!==h)h.return=u,$o=h;else for(;null!==$o;){var p=(u=$o).sibling,m=u.return;if(ac(u),u===d){$o=null;break}if(null!==p){p.return=m,$o=p;break}$o=m}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}$o=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,$o=o;else e:for(;null!==$o;){if(0!==(2048&(a=$o).flags))switch(a.tag){case 0:case 11:case 15:ic(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,$o=y;break e}$o=a.return}}var v=e.current;for($o=v;null!==$o;){var E=(o=$o).child;if(0!==(2064&o.subtreeFlags)&&null!==E)E.return=o,$o=E;else e:for(o=v;null!==$o;){if(0!==(2048&(c=$o).flags))try{switch(c.tag){case 0:case 11:case 15:sc(9,c)}}catch(S){wl(c,c.return,S)}if(c===o){$o=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,$o=b;break e}$o=c.return}}if(Ic=s,Gs(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(st,e)}catch(S){}i=!0}return i}finally{vt=n,Rc.transition=t}}return!1}function Tl(e,t,n){e=Pr(e,t=mo(0,t=lo(n,t),1),1),t=tl(),null!==e&&(_t(e,1,t),sl(e,t))}function wl(e,t,n){if(3===e.tag)Tl(e,e,n);else for(;null!==t;){if(3===t.tag){Tl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===qc||!qc.has(i))){t=Pr(t,e=fo(t,e=lo(n,e),1),1),e=tl(),null!==t&&(_t(t,1,e),sl(t,e));break}}t=t.return}}function Nl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,Ac===e&&(Dc&n)===n&&(4===Lc||3===Lc&&(130023424&Dc)===Dc&&500>Qe()-Gc?pl(e,0):Vc|=n),sl(e,t)}function Cl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=tl();null!==(e=Ir(e,t))&&(_t(e,t,n),sl(e,n))}function Rl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cl(e,n)}function Il(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(r(314))}null!==i&&i.delete(t),Cl(e,n)}function Al(e,t){return qe(e,t)}function Ol(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dl(e,t,n,i){return new Ol(e,t,n,i)}function kl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pl(e,t){var n=e.alternate;return null===n?((n=Dl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ll(e,t,n,i,s,a){var o=2;if(i=e,"function"===typeof e)kl(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case x:return jl(n.children,s,a,t);case T:o=8,s|=8;break;case w:return(e=Dl(12,n,t,2|s)).elementType=w,e.lanes=a,e;case I:return(e=Dl(13,n,t,s)).elementType=I,e.lanes=a,e;case A:return(e=Dl(19,n,t,s)).elementType=A,e.lanes=a,e;case k:return Ml(n,s,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case N:o=10;break e;case C:o=9;break e;case R:o=11;break e;case O:o=14;break e;case D:o=16,i=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Dl(o,n,t,s)).elementType=e,t.type=i,t.lanes=a,t}function jl(e,t,n,i){return(e=Dl(7,e,i,t)).lanes=n,e}function Ml(e,t,n,i){return(e=Dl(22,e,i,t)).elementType=k,e.lanes=n,e.stateNode={isHidden:!1},e}function Ul(e,t,n){return(e=Dl(6,e,null,t)).lanes=n,e}function Vl(e,t,n){return(t=Dl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fl(e,t,n,i,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Bl(e,t,n,i,s,r,a,o,c){return e=new Fl(e,t,n,o,c),1===t?(t=1,!0===r&&(t|=8)):t=0,r=Dl(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Or(r),e}function Gl(e){if(!e)return Cs;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ds(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var n=e.type;if(Ds(n))return Ls(e,n,t)}return t}function Wl(e,t,n,i,s,r,a,o,c){return(e=Bl(n,i,!0,e,0,r,0,o,c)).context=Gl(null),n=e.current,(r=kr(i=tl(),s=nl(n))).callback=void 0!==t&&null!==t?t:null,Pr(n,r,s),e.current.lanes=s,_t(e,s,i),sl(e,i),e}function Hl(e,t,n,i){var s=t.current,r=tl(),a=nl(s);return n=Gl(n),null===t.context?t.context=n:t.pendingContext=n,(t=kr(r,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Pr(s,t,a))&&(il(e,s,a,r),Lr(e,s,a)),a}function Kl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function zl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){zl(e,t),(e=e.alternate)&&zl(e,t)}Tc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Is.current)Eo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Eo=!1,function(e,t,n){switch(t.tag){case 3:Ao(t),pr();break;case 5:ra(t);break;case 1:Ds(t.type)&&js(t);break;case 4:ia(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,s=t.memoizedProps.value;Ns(_r,i._currentValue),i._currentValue=s;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Ns(oa,1&oa.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Uo(e,t,n):(Ns(oa,1&oa.current),null!==(e=Ko(e,t,n))?e.sibling:null);Ns(oa,1&oa.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Wo(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ns(oa,oa.current),i)break;return null;case 22:case 23:return t.lanes=0,wo(e,t,n)}return Ko(e,t,n)}(e,t,n);Eo=0!==(131072&e.flags)}else Eo=!1,sr&&0!==(1048576&t.flags)&&$s(t,zs,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ho(e,t),e=t.pendingProps;var s=Os(t,Rs.current);Tr(t,n),s=xa(null,t,i,e,s,n);var a=Ta();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ds(i)?(a=!0,js(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Or(t),s.updater=Br,t.stateNode=s,s._reactInternals=t,Kr(t,i,e,n),t=Io(null,t,i,!0,a,n)):(t.tag=0,sr&&a&&er(t),bo(null,t,s,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,i=(s=i._init)(i._payload),t.type=i,s=t.tag=function(e){if("function"===typeof e)return kl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===O)return 14}return 2}(i),e=gr(i,e),s){case 0:t=Co(null,t,i,e,n);break e;case 1:t=Ro(null,t,i,e,n);break e;case 11:t=So(null,t,i,e,n);break e;case 14:t=xo(null,t,i,gr(i.type,e),n);break e}throw Error(r(306,i,""))}return t;case 0:return i=t.type,s=t.pendingProps,Co(e,t,i,s=t.elementType===i?s:gr(i,s),n);case 1:return i=t.type,s=t.pendingProps,Ro(e,t,i,s=t.elementType===i?s:gr(i,s),n);case 3:e:{if(Ao(t),null===e)throw Error(r(387));i=t.pendingProps,s=(a=t.memoizedState).element,Dr(e,t),Mr(t,i,null,n);var o=t.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Oo(e,t,i,n,s=lo(Error(r(423)),t));break e}if(i!==s){t=Oo(e,t,i,n,s=lo(Error(r(424)),t));break e}for(ir=ls(t.stateNode.containerInfo.firstChild),nr=t,sr=!0,rr=null,n=Qr(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pr(),i===s){t=Ko(e,t,n);break e}bo(e,t,i,n)}t=t.child}return t;case 5:return ra(t),null===e&&lr(t),i=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,ns(i,s)?o=null:null!==a&&ns(i,a)&&(t.flags|=32),No(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&lr(t),null;case 13:return Uo(e,t,n);case 4:return ia(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Jr(t,null,i,n):bo(e,t,i,n),t.child;case 11:return i=t.type,s=t.pendingProps,So(e,t,i,s=t.elementType===i?s:gr(i,s),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,Ns(_r,i._currentValue),i._currentValue=o,null!==a)if(oi(a.value,o)){if(a.children===s.children&&!Is.current){t=Ko(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){o=a.child;for(var l=c.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=kr(-1,n&-n)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),d.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),xr(a.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(r(341));o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),xr(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}bo(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,i=t.pendingProps.children,Tr(t,n),i=i(s=wr(s)),t.flags|=1,bo(e,t,i,n),t.child;case 14:return s=gr(i=t.type,t.pendingProps),xo(e,t,i,s=gr(i.type,s),n);case 15:return To(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:gr(i,s),Ho(e,t),t.tag=1,Ds(i)?(e=!0,js(t)):e=!1,Tr(t,n),Wr(t,i,s),Kr(t,i,s,n),Io(null,t,i,!0,e,n);case 19:return Wo(e,t,n);case 22:return wo(e,t,n)}throw Error(r(156,t.tag))};var Yl="function"===typeof reportError?reportError:function(e){console.error(e)};function Xl(e){this._internalRoot=e}function Jl(e){this._internalRoot=e}function Ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function ed(e,t,n,i,s){var r=n._reactRootContainer;if(r){var a=r;if("function"===typeof s){var o=s;s=function(){var e=Kl(a);o.call(e)}}Hl(t,a,e,s)}else a=function(e,t,n,i,s){if(s){if("function"===typeof i){var r=i;i=function(){var e=Kl(a);r.call(e)}}var a=Wl(t,i,e,0,null,!1,0,"",$l);return e._reactRootContainer=a,e[ms]=a.current,Gi(8===e.nodeType?e.parentNode:e),ul(),a}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof i){var o=i;i=function(){var e=Kl(c);o.call(e)}}var c=Bl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=c,e[ms]=c.current,Gi(8===e.nodeType?e.parentNode:e),ul(function(){Hl(t,c,n,i)}),c}(n,t,e,s,i);return Kl(a)}Jl.prototype.render=Xl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Hl(e,t,null,null)},Jl.prototype.unmount=Xl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){Hl(null,e,null,null)}),t[ms]=null}},Jl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<kt.length&&0!==t&&t<kt[n].priority;n++);kt.splice(n,0,e),0===n&&Mt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(yt(t,1|n),sl(t,Qe()),0===(6&Ic)&&(Wc=Qe()+500,Gs()))}break;case 13:ul(function(){var t=Ir(e,1);if(null!==t){var n=tl();il(t,e,1,n)}}),ql(e,1)}},St=function(e){if(13===e.tag){var t=Ir(e,134217728);if(null!==t)il(t,e,134217728,tl());ql(e,134217728)}},xt=function(e){if(13===e.tag){var t=nl(e),n=Ir(e,t);if(null!==n)il(n,e,t,tl());ql(e,t)}},Tt=function(){return vt},wt=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},Se=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var s=bs(i);if(!s)throw Error(r(90));q(i),Z(i,s)}}}break;case"textarea":re(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=dl,Ie=ul;var td={usingClientEntryPoint:!1,Events:[vs,Es,bs,Ne,Ce,dl]},nd={findFiberByHostInstance:ys,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},id={bundleType:nd.bundleType,version:nd.version,rendererPackageName:nd.rendererPackageName,rendererConfig:nd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ke(e))?null:e.stateNode},findFiberByHostInstance:nd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var sd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sd.isDisabled&&sd.supportsFiber)try{st=sd.inject(id),rt=sd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=td,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ql(t))throw Error(r(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Ql(e))throw Error(r(299));var n=!1,i="",s=Yl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Bl(e,1,!1,null,0,n,0,i,s),e[ms]=t.current,Gi(8===e.nodeType?e.parentNode:e),new Xl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=Ke(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Zl(t))throw Error(r(200));return ed(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Ql(e))throw Error(r(405));var i=null!=n&&n.hydratedSources||null,s=!1,a="",o=Yl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Wl(t,null,e,1,null!=n?n:null,s,0,a,o),e[ms]=t.current,Gi(e),i)for(e=0;e<i.length;e++)s=(s=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Jl(t)},t.render=function(e,t,n){if(!Zl(t))throw Error(r(200));return ed(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zl(e))throw Error(r(40));return!!e._reactRootContainer&&(ul(function(){ed(null,null,e,!1,function(){e._reactRootContainer=null,e[ms]=null})}),!0)},t.unstable_batchedUpdates=dl,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Zl(n))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return ed(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},819:(e,t,n)=>{"use strict";n.d(t,{QueryClient:()=>i.E});var i=n(198),s=n(298);n.o(s,"QueryClientProvider")&&n.d(t,{QueryClientProvider:function(){return s.QueryClientProvider}})},853:(e,t,n)=>{"use strict";e.exports=n(234)},870:(e,t,n)=>{"use strict";n.d(t,{BH:()=>y,Cp:()=>g,F$:()=>m,G6:()=>x,HN:()=>c,MK:()=>h,Od:()=>f,S$:()=>s,Zw:()=>a,b_:()=>u,gn:()=>o,j3:()=>l,jY:()=>T,lQ:()=>r,nJ:()=>p,vh:()=>d,yy:()=>S});var i=n(168),s="undefined"===typeof window;function r(){}function a(e,t){return"function"===typeof e?e(t):e}function o(e){return"number"===typeof e&&e>=0&&e!==1/0}function c(e){return Array.isArray(e)?e:[e]}function l(e,t){return Math.max(e+(t||0)-Date.now(),0)}function d(e,t,n){return b(e)?"function"===typeof t?(0,i.A)({},n,{queryKey:e,queryFn:t}):(0,i.A)({},t,{queryKey:e}):e}function u(e,t,n){return b(e)?[(0,i.A)({},t,{queryKey:e}),n]:[e||{},t]}function h(e,t){var n=e.active,i=e.exact,s=e.fetching,r=e.inactive,a=e.predicate,o=e.queryKey,c=e.stale;if(b(o))if(i){if(t.queryHash!==m(o,t.options))return!1}else if(!g(t.queryKey,o))return!1;var l=function(e,t){return!0===e&&!0===t||null==e&&null==t?"all":!1===e&&!1===t?"none":(null!=e?e:!t)?"active":"inactive"}(n,r);if("none"===l)return!1;if("all"!==l){var d=t.isActive();if("active"===l&&!d)return!1;if("inactive"===l&&d)return!1}return("boolean"!==typeof c||t.isStale()===c)&&(("boolean"!==typeof s||t.isFetching()===s)&&!(a&&!a(t)))}function p(e,t){var n=e.exact,i=e.fetching,s=e.predicate,r=e.mutationKey;if(b(r)){if(!t.options.mutationKey)return!1;if(n){if(f(t.options.mutationKey)!==f(r))return!1}else if(!g(t.options.mutationKey,r))return!1}return("boolean"!==typeof i||"loading"===t.state.status===i)&&!(s&&!s(t))}function m(e,t){return((null==t?void 0:t.queryKeyHashFn)||f)(e)}function f(e){var t,n=c(e);return t=n,JSON.stringify(t,function(e,t){return v(t)?Object.keys(t).sort().reduce(function(e,n){return e[n]=t[n],e},{}):t})}function g(e,t){return _(c(e),c(t))}function _(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&!Object.keys(t).some(function(n){return!_(e[n],t[n])}))}function y(e,t){if(e===t)return e;var n=Array.isArray(e)&&Array.isArray(t);if(n||v(e)&&v(t)){for(var i=n?e.length:Object.keys(e).length,s=n?t:Object.keys(t),r=s.length,a=n?[]:{},o=0,c=0;c<r;c++){var l=n?c:s[c];a[l]=y(e[l],t[l]),a[l]===e[l]&&o++}return i===r&&o===i?e:a}return t}function v(e){if(!E(e))return!1;var t=e.constructor;if("undefined"===typeof t)return!0;var n=t.prototype;return!!E(n)&&!!n.hasOwnProperty("isPrototypeOf")}function E(e){return"[object Object]"===Object.prototype.toString.call(e)}function b(e){return"string"===typeof e||Array.isArray(e)}function S(e){return new Promise(function(t){setTimeout(t,e)})}function x(e){Promise.resolve().then(e).catch(function(e){return setTimeout(function(){throw e})})}function T(){if("function"===typeof AbortController)return new AbortController}},907:(e,t,n)=>{"use strict";n.d(t,{QueryClient:()=>i.QueryClient,QueryClientProvider:()=>s.QueryClientProvider});var i=n(819);n.o(i,"QueryClientProvider")&&n.d(t,{QueryClientProvider:function(){return i.QueryClientProvider}});var s=n(524)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},991:(e,t,n)=>{"use strict";n.d(t,{j:()=>s});var i=n(870),s=new(function(){function e(){this.queue=[],this.transactions=0,this.notifyFn=function(e){e()},this.batchNotifyFn=function(e){e()}}var t=e.prototype;return t.batch=function(e){var t;this.transactions++;try{t=e()}finally{this.transactions--,this.transactions||this.flush()}return t},t.schedule=function(e){var t=this;this.transactions?this.queue.push(e):(0,i.G6)(function(){t.notifyFn(e)})},t.batchCalls=function(e){var t=this;return function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];t.schedule(function(){e.apply(void 0,i)})}},t.flush=function(){var e=this,t=this.queue;this.queue=[],t.length&&(0,i.G6)(function(){e.batchNotifyFn(function(){t.forEach(function(t){e.notifyFn(t)})})})},t.setNotifyFunction=function(e){this.notifyFn=e},t.setBatchNotifyFunction=function(e){this.batchNotifyFn=e},e}())}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"===typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"===typeof i.then)return i}var r=Object.create(null);n.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&s&&i;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>i[e]);return a.default=()=>i,n.d(r,a),r}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t=n(43),i=n.t(t,2),s=n(391),r=n(950),a=n.t(r,2);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const c="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function d(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function u(e,t){return{usr:e.state,key:e.key,idx:t}}function h(e,t,n,i){return void 0===n&&(n=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?m(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function m(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function f(t,n,i,s){void 0===s&&(s={});let{window:r=document.defaultView,v5Compat:a=!1}=s,d=r.history,m=e.Pop,f=null,g=_();function _(){return(d.state||{idx:null}).idx}function y(){m=e.Pop;let t=_(),n=null==t?null:t-g;g=t,f&&f({action:m,location:E.location,delta:n})}function v(e){let t="null"!==r.location.origin?r.location.origin:r.location.href,n="string"===typeof e?e:p(e);return n=n.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,d.replaceState(o({},d.state,{idx:g}),""));let E={get action(){return m},get location(){return t(r,d)},listen(e){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(c,y),f=e,()=>{r.removeEventListener(c,y),f=null}},createHref:e=>n(r,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){m=e.Push;let s=h(E.location,t,n);i&&i(s,t),g=_()+1;let o=u(s,g),c=E.createHref(s);try{d.pushState(o,"",c)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;r.location.assign(c)}a&&f&&f({action:m,location:E.location,delta:1})},replace:function(t,n){m=e.Replace;let s=h(E.location,t,n);i&&i(s,t),g=_();let r=u(s,g),o=E.createHref(s);d.replaceState(r,"",o),a&&f&&f({action:m,location:E.location,delta:0})},go:e=>d.go(e)};return E}var g;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function _(e,t,n){return void 0===n&&(n="/"),y(e,t,n,!1)}function y(e,t,n,i){let s=D(("string"===typeof t?m(t):t).pathname||"/",n);if(null==s)return null;let r=v(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(r);let a=null;for(let o=0;null==a&&o<r.length;++o){let e=O(s);a=I(r[o],e,i)}return a}function v(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let s=(e,s,r)=>{let a={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:s,route:e};a.relativePath.startsWith("/")&&(l(a.relativePath.startsWith(i),'Absolute route path "'+a.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(i.length));let o=M([i,a.relativePath]),c=n.concat(a);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),v(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:R(o,e.index),routesMeta:c})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of E(e.path))s(e,t,i);else s(e,t)}),t}function E(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,s=n.endsWith("?"),r=n.replace(/\?$/,"");if(0===i.length)return s?[r,""]:[r];let a=E(i.join("/")),o=[];return o.push(...a.map(e=>""===e?r:[r,e].join("/"))),s&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const b=/^:[\w-]+$/,S=3,x=2,T=1,w=10,N=-2,C=e=>"*"===e;function R(e,t){let n=e.split("/"),i=n.length;return n.some(C)&&(i+=N),t&&(i+=x),n.filter(e=>!C(e)).reduce((e,t)=>e+(b.test(t)?S:""===t?T:w),i)}function I(e,t,n){void 0===n&&(n=!1);let{routesMeta:i}=e,s={},r="/",a=[];for(let o=0;o<i.length;++o){let e=i[o],c=o===i.length-1,l="/"===r?t:t.slice(r.length)||"/",d=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),u=e.route;if(!d&&c&&n&&!i[i.length-1].route.index&&(d=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!d)return null;Object.assign(s,d.params),a.push({params:s,pathname:M([r,d.pathname]),pathnameBase:U(M([r,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(r=M([r,d.pathnameBase]))}return a}function A(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);d("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(i.push({paramName:"*"}),s+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":""!==e&&"/"!==e&&(s+="(?:(?=\\/|$))");let r=new RegExp(s,t?void 0:"i");return[r,i]}(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let r=s[0],a=r.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:i.reduce((e,t,n)=>{let{paramName:i,isOptional:s}=t;if("*"===i){let e=o[n]||"";a=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const c=o[n];return e[i]=s&&!c?void 0:(c||"").replace(/%2F/g,"/"),e},{}),pathname:r,pathnameBase:a,pattern:e}}function O(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return d(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function D(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}function k(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function P(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function L(e,t){let n=P(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function j(e,t,n,i){let s;void 0===i&&(i=!1),"string"===typeof e?s=m(e):(s=o({},e),l(!s.pathname||!s.pathname.includes("?"),k("?","pathname","search",s)),l(!s.pathname||!s.pathname.includes("#"),k("#","pathname","hash",s)),l(!s.search||!s.search.includes("#"),k("#","search","hash",s)));let r,a=""===e||""===s.pathname,c=a?"/":s.pathname;if(null==c)r=n;else{let e=t.length-1;if(!i&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}r=e>=0?t[e]:"/"}let d=function(e,t){void 0===t&&(t="/");let{pathname:n,search:i="",hash:s=""}="string"===typeof e?m(e):e,r=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:r,search:V(i),hash:F(s)}}(s,r),u=c&&"/"!==c&&c.endsWith("/"),h=(a||"."===c)&&n.endsWith("/");return d.pathname.endsWith("/")||!u&&!h||(d.pathname+="/"),d}const M=e=>e.join("/").replace(/\/\/+/g,"/"),U=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function B(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const G=["post","put","patch","delete"],W=(new Set(G),["get",...G]);new Set(W),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},H.apply(this,arguments)}const K=t.createContext(null);const z=t.createContext(null);const q=t.createContext(null);const Y=t.createContext(null);const X=t.createContext({outlet:null,matches:[],isDataRoute:!1});const J=t.createContext(null);function Q(){return null!=t.useContext(Y)}function Z(){return Q()||l(!1),t.useContext(Y).location}function $(e){t.useContext(q).static||t.useLayoutEffect(e)}function ee(){let{isDataRoute:e}=t.useContext(X);return e?function(){let{router:e}=ue(le.UseNavigateStable),n=pe(de.UseNavigateStable),i=t.useRef(!1);return $(()=>{i.current=!0}),t.useCallback(function(t,s){void 0===s&&(s={}),i.current&&("number"===typeof t?e.navigate(t):e.navigate(t,H({fromRouteId:n},s)))},[e,n])}():function(){Q()||l(!1);let e=t.useContext(K),{basename:n,future:i,navigator:s}=t.useContext(q),{matches:r}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(L(r,i.v7_relativeSplatPath)),c=t.useRef(!1);return $(()=>{c.current=!0}),t.useCallback(function(t,i){if(void 0===i&&(i={}),!c.current)return;if("number"===typeof t)return void s.go(t);let r=j(t,JSON.parse(o),a,"path"===i.relative);null==e&&"/"!==n&&(r.pathname="/"===r.pathname?n:M([n,r.pathname])),(i.replace?s.replace:s.push)(r,i.state,i)},[n,s,o,a,e])}()}const te=t.createContext(null);function ne(e,n){let{relative:i}=void 0===n?{}:n,{future:s}=t.useContext(q),{matches:r}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(L(r,s.v7_relativeSplatPath));return t.useMemo(()=>j(e,JSON.parse(o),a,"path"===i),[e,o,a,i])}function ie(n,i,s,r){Q()||l(!1);let{navigator:a}=t.useContext(q),{matches:o}=t.useContext(X),c=o[o.length-1],d=c?c.params:{},u=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let h,p=Z();if(i){var f;let e="string"===typeof i?m(i):i;"/"===u||(null==(f=e.pathname)?void 0:f.startsWith(u))||l(!1),h=e}else h=p;let g=h.pathname||"/",y=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=_(n,{pathname:y});let E=ce(v&&v.map(e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:M([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:M([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,s,r);return i&&E?t.createElement(Y.Provider,{value:{location:H({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:e.Pop}},E):E}function se(){let e=function(){var e;let n=t.useContext(J),i=he(de.UseRouteError),s=pe(de.UseRouteError);if(void 0!==n)return n;return null==(e=i.errors)?void 0:e[s]}(),n=B(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),i?t.createElement("pre",{style:r},i):null,null)}const re=t.createElement(se,null);class ae extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(X.Provider,{value:this.props.routeContext},t.createElement(J.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oe(e){let{routeContext:n,match:i,children:s}=e,r=t.useContext(K);return r&&r.static&&r.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=i.route.id),t.createElement(X.Provider,{value:n},s)}function ce(e,n,i,s){var r;if(void 0===n&&(n=[]),void 0===i&&(i=null),void 0===s&&(s=null),null==e){var a;if(!i)return null;if(i.errors)e=i.matches;else{if(!(null!=(a=s)&&a.v7_partialHydration&&0===n.length&&!i.initialized&&i.matches.length>0))return null;e=i.matches}}let o=e,c=null==(r=i)?void 0:r.errors;if(null!=c){let e=o.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||l(!1),o=o.slice(0,Math.min(o.length,e+1))}let d=!1,u=-1;if(i&&s&&s.v7_partialHydration)for(let t=0;t<o.length;t++){let e=o[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:n}=i,s=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||s){d=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,s,r)=>{let a,l=!1,h=null,p=null;var m;i&&(a=c&&s.route.id?c[s.route.id]:void 0,h=s.route.errorElement||re,d&&(u<0&&0===r?(m="route-fallback",!1||me[m]||(me[m]=!0),l=!0,p=null):u===r&&(l=!0,p=s.route.hydrateFallbackElement||null)));let f=n.concat(o.slice(0,r+1)),g=()=>{let n;return n=a?h:l?p:s.route.Component?t.createElement(s.route.Component,null):s.route.element?s.route.element:e,t.createElement(oe,{match:s,routeContext:{outlet:e,matches:f,isDataRoute:null!=i},children:n})};return i&&(s.route.ErrorBoundary||s.route.errorElement||0===r)?t.createElement(ae,{location:i.location,revalidation:i.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):g()},null)}var le=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(le||{}),de=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(de||{});function ue(e){let n=t.useContext(K);return n||l(!1),n}function he(e){let n=t.useContext(z);return n||l(!1),n}function pe(e){let n=function(){let e=t.useContext(X);return e||l(!1),e}(),i=n.matches[n.matches.length-1];return i.route.id||l(!1),i.route.id}const me={};i.startTransition;function fe(e){let{to:n,replace:i,state:s,relative:r}=e;Q()||l(!1);let{future:a,static:o}=t.useContext(q),{matches:c}=t.useContext(X),{pathname:d}=Z(),u=ee(),h=j(n,L(c,a.v7_relativeSplatPath),d,"path"===r),p=JSON.stringify(h);return t.useEffect(()=>u(JSON.parse(p),{replace:i,state:s,relative:r}),[u,p,r,i,s]),null}function ge(e){return function(e){let n=t.useContext(X).outlet;return n?t.createElement(te.Provider,{value:e},n):n}(e.context)}function _e(e){l(!1)}function ye(n){let{basename:i="/",children:s=null,location:r,navigationType:a=e.Pop,navigator:o,static:c=!1,future:d}=n;Q()&&l(!1);let u=i.replace(/^\/*/,"/"),h=t.useMemo(()=>({basename:u,navigator:o,static:c,future:H({v7_relativeSplatPath:!1},d)}),[u,d,o,c]);"string"===typeof r&&(r=m(r));let{pathname:p="/",search:f="",hash:g="",state:_=null,key:y="default"}=r,v=t.useMemo(()=>{let e=D(p,u);return null==e?null:{location:{pathname:e,search:f,hash:g,state:_,key:y},navigationType:a}},[u,p,f,g,_,y,a]);return null==v?null:t.createElement(q.Provider,{value:h},t.createElement(Y.Provider,{children:s,value:v}))}function ve(e){let{children:t,location:n}=e;return ie(Ee(t),n)}new Promise(()=>{});t.Component;function Ee(e,n){void 0===n&&(n=[]);let i=[];return t.Children.forEach(e,(e,s)=>{if(!t.isValidElement(e))return;let r=[...n,s];if(e.type===t.Fragment)return void i.push.apply(i,Ee(e.props.children,r));e.type!==_e&&l(!1),e.props.index&&e.props.children&&l(!1);let a={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Ee(e.props.children,r)),i.push(a)}),i}function be(){return be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},be.apply(this,arguments)}function Se(e,t){if(null==e)return{};var n,i,s={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const xe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(ty){}new Map;const Te=i.startTransition;a.flushSync,i.useId;function we(e){let{basename:n,children:i,future:s,window:r}=e,a=t.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:r,v5Compat:!0})&&(o={}),f(function(e,t){let{pathname:n,search:i,hash:s}=e.location;return h("",{pathname:n,search:i,hash:s},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:p(t)},null,o)));let c=a.current,[l,d]=t.useState({action:c.action,location:c.location}),{v7_startTransition:u}=s||{},m=t.useCallback(e=>{u&&Te?Te(()=>d(e)):d(e)},[d,u]);return t.useLayoutEffect(()=>c.listen(m),[c,m]),t.createElement(ye,{basename:n,children:i,location:l.location,navigationType:l.action,navigator:c,future:s})}const Ne="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Re=t.forwardRef(function(e,n){let i,{onClick:s,relative:r,reloadDocument:a,replace:o,state:c,target:d,to:u,preventScrollReset:h,unstable_viewTransition:m}=e,f=Se(e,xe),{basename:g}=t.useContext(q),_=!1;if("string"===typeof u&&Ce.test(u)&&(i=u,Ne))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=D(t.pathname,g);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:_=!0}catch(ty){}let y=function(e,n){let{relative:i}=void 0===n?{}:n;Q()||l(!1);let{basename:s,navigator:r}=t.useContext(q),{hash:a,pathname:o,search:c}=ne(e,{relative:i}),d=o;return"/"!==s&&(d="/"===o?s:M([s,o])),r.createHref({pathname:d,search:c,hash:a})}(u,{relative:r}),v=function(e,n){let{target:i,replace:s,state:r,preventScrollReset:a,relative:o,unstable_viewTransition:c}=void 0===n?{}:n,l=ee(),d=Z(),u=ne(e,{relative:o});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,i)){t.preventDefault();let n=void 0!==s?s:p(d)===p(u);l(e,{replace:n,state:r,preventScrollReset:a,relative:o,unstable_viewTransition:c})}},[d,l,u,s,r,i,e,a,o,c])}(u,{replace:o,state:c,target:d,preventScrollReset:h,relative:r,unstable_viewTransition:m});return t.createElement("a",be({},f,{href:i||y,onClick:_||a?s:function(e){s&&s(e),e.defaultPrevented||v(e)},ref:n,target:d}))});var Ie,Ae;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ie||(Ie={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ae||(Ae={}));var Oe=n(907);function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function ke(e){var t=function(e,t){if("object"!=De(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=De(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==De(t)?t:t+""}function Pe(e,t,n){return(t=ke(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach(function(t){Pe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Me(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function Ue(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=Ue(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}const Ve=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=Ue(e))&&(i&&(i+=" "),i+=t);return i},Fe=["theme","type"],Be=["delay","staleId"],Ge=e=>"number"==typeof e&&!isNaN(e),We=e=>"string"==typeof e,He=e=>"function"==typeof e,Ke=e=>We(e)||He(e)?e:null,ze=e=>(0,t.isValidElement)(e)||We(e)||He(e)||Ge(e);function qe(e){let{enter:n,exit:i,appendPosition:s=!1,collapse:r=!0,collapseDuration:a=300}=e;return function(e){let{children:o,position:c,preventExitTransition:l,done:d,nodeRef:u,isIn:h}=e;const p=s?"".concat(n,"--").concat(c):n,m=s?"".concat(i,"--").concat(c):i,f=(0,t.useRef)(0);return(0,t.useLayoutEffect)(()=>{const e=u.current,t=p.split(" "),n=i=>{i.target===u.current&&(e.dispatchEvent(new Event("d")),e.removeEventListener("animationend",n),e.removeEventListener("animationcancel",n),0===f.current&&"animationcancel"!==i.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",n),e.addEventListener("animationcancel",n)},[]),(0,t.useEffect)(()=>{const e=u.current,t=()=>{e.removeEventListener("animationend",t),r?function(e,t,n){void 0===n&&(n=300);const{scrollHeight:i,style:s}=e;requestAnimationFrame(()=>{s.minHeight="initial",s.height=i+"px",s.transition="all ".concat(n,"ms"),requestAnimationFrame(()=>{s.height="0",s.padding="0",s.margin="0",setTimeout(t,n)})})}(e,d,a):d()};h||(l?t():(f.current=1,e.className+=" ".concat(m),e.addEventListener("animationend",t)))},[h]),t.createElement(t.Fragment,null,o)}}function Ye(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const Xe={list:new Map,emitQueue:new Map,on(e,t){return this.list.has(e)||this.list.set(e,[]),this.list.get(e).push(t),this},off(e,t){if(t){const n=this.list.get(e).filter(e=>e!==t);return this.list.set(e,n),this}return this.list.delete(e),this},cancelEmit(e){const t=this.emitQueue.get(e);return t&&(t.forEach(clearTimeout),this.emitQueue.delete(e)),this},emit(e){this.list.has(e)&&this.list.get(e).forEach(t=>{const n=setTimeout(()=>{t(...[].slice.call(arguments,1))},0);this.emitQueue.has(e)||this.emitQueue.set(e,[]),this.emitQueue.get(e).push(n)})}},Je=e=>{let{theme:n,type:i}=e,s=Me(e,Fe);return t.createElement("svg",je({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===n?"currentColor":"var(--toastify-icon-color-".concat(i,")")},s))},Qe={info:function(e){return t.createElement(Je,je({},e),t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return t.createElement(Je,je({},e),t.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return t.createElement(Je,je({},e),t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return t.createElement(Je,je({},e),t.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return t.createElement("div",{className:"Toastify__spinner"})}};function Ze(e){const[,n]=(0,t.useReducer)(e=>e+1,0),[i,s]=(0,t.useState)([]),r=(0,t.useRef)(null),a=(0,t.useRef)(new Map).current,o=e=>-1!==i.indexOf(e),c=(0,t.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:e,containerId:null,isToastActive:o,getToast:e=>a.get(e)}).current;function l(e){let{containerId:t}=e;const{limit:n}=c.props;!n||t&&c.containerId!==t||(c.count-=c.queue.length,c.queue=[])}function d(e){s(t=>null==e?[]:t.filter(t=>t!==e))}function u(){const{toastContent:e,toastProps:t,staleId:n}=c.queue.shift();p(e,t,n)}function h(e,i){let{delay:s,staleId:o}=i,l=Me(i,Be);if(!ze(e)||function(e){return!r.current||c.props.enableMultiContainer&&e.containerId!==c.props.containerId||a.has(e.toastId)&&null==e.updateId}(l))return;const{toastId:h,updateId:m,data:f}=l,{props:g}=c,_=()=>d(h),y=null==m;y&&c.count++;const v=je(je(je({},g),{},{style:g.toastStyle,key:c.toastKey++},Object.fromEntries(Object.entries(l).filter(e=>{let[t,n]=e;return null!=n}))),{},{toastId:h,updateId:m,data:f,closeToast:_,isIn:!1,className:Ke(l.className||g.toastClassName),bodyClassName:Ke(l.bodyClassName||g.bodyClassName),progressClassName:Ke(l.progressClassName||g.progressClassName),autoClose:!l.isLoading&&(E=l.autoClose,b=g.autoClose,!1===E||Ge(E)&&E>0?E:b),deleteToast(){const e=Ye(a.get(h),"removed");a.delete(h),Xe.emit(4,e);const t=c.queue.length;if(c.count=null==h?c.count-c.displayedToast:c.count-1,c.count<0&&(c.count=0),t>0){const e=null==h?c.props.limit:1;if(1===t||1===e)c.displayedToast++,u();else{const n=e>t?t:e;c.displayedToast=n;for(let e=0;e<n;e++)u()}}else n()}});var E,b;v.iconOut=function(e){let{theme:n,type:i,isLoading:s,icon:r}=e,a=null;const o={theme:n,type:i};return!1===r||(He(r)?a=r(o):(0,t.isValidElement)(r)?a=(0,t.cloneElement)(r,o):We(r)||Ge(r)?a=r:s?a=Qe.spinner():(e=>e in Qe)(i)&&(a=Qe[i](o))),a}(v),He(l.onOpen)&&(v.onOpen=l.onOpen),He(l.onClose)&&(v.onClose=l.onClose),v.closeButton=g.closeButton,!1===l.closeButton||ze(l.closeButton)?v.closeButton=l.closeButton:!0===l.closeButton&&(v.closeButton=!ze(g.closeButton)||g.closeButton);let S=e;(0,t.isValidElement)(e)&&!We(e.type)?S=(0,t.cloneElement)(e,{closeToast:_,toastProps:v,data:f}):He(e)&&(S=e({closeToast:_,toastProps:v,data:f})),g.limit&&g.limit>0&&c.count>g.limit&&y?c.queue.push({toastContent:S,toastProps:v,staleId:o}):Ge(s)?setTimeout(()=>{p(S,v,o)},s):p(S,v,o)}function p(e,t,n){const{toastId:i}=t;n&&a.delete(n);const r={content:e,props:t};a.set(i,r),s(e=>[...e,i].filter(e=>e!==n)),Xe.emit(4,Ye(r,null==r.props.updateId?"added":"updated"))}return(0,t.useEffect)(()=>(c.containerId=e.containerId,Xe.cancelEmit(3).on(0,h).on(1,e=>r.current&&d(e)).on(5,l).emit(2,c),()=>{a.clear(),Xe.emit(3,c)}),[]),(0,t.useEffect)(()=>{c.props=e,c.isToastActive=o,c.displayedToast=i.length}),{getToastToRender:function(t){const n=new Map,i=Array.from(a.values());return e.newestOnTop&&i.reverse(),i.forEach(e=>{const{position:t}=e.props;n.has(t)||n.set(t,[]),n.get(t).push(e)}),Array.from(n,e=>t(e[0],e[1]))},containerRef:r,isToastActive:o}}function $e(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientX:e.clientX}function et(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientY:e.clientY}function tt(e){const[n,i]=(0,t.useState)(!1),[s,r]=(0,t.useState)(!1),a=(0,t.useRef)(null),o=(0,t.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,c=(0,t.useRef)(e),{autoClose:l,pauseOnHover:d,closeToast:u,onClick:h,closeOnClick:p}=e;function m(t){if(e.draggable){"touchstart"===t.nativeEvent.type&&t.nativeEvent.preventDefault(),o.didMove=!1,document.addEventListener("mousemove",y),document.addEventListener("mouseup",v),document.addEventListener("touchmove",y),document.addEventListener("touchend",v);const n=a.current;o.canCloseOnClick=!0,o.canDrag=!0,o.boundingRect=n.getBoundingClientRect(),n.style.transition="",o.x=$e(t.nativeEvent),o.y=et(t.nativeEvent),"x"===e.draggableDirection?(o.start=o.x,o.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(o.start=o.y,o.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent/100))}}function f(t){if(o.boundingRect){const{top:n,bottom:i,left:s,right:r}=o.boundingRect;"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&o.x>=s&&o.x<=r&&o.y>=n&&o.y<=i?_():g()}}function g(){i(!0)}function _(){i(!1)}function y(t){const i=a.current;o.canDrag&&i&&(o.didMove=!0,n&&_(),o.x=$e(t),o.y=et(t),o.delta="x"===e.draggableDirection?o.x-o.start:o.y-o.start,o.start!==o.x&&(o.canCloseOnClick=!1),i.style.transform="translate".concat(e.draggableDirection,"(").concat(o.delta,"px)"),i.style.opacity=""+(1-Math.abs(o.delta/o.removalDistance)))}function v(){document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",v),document.removeEventListener("touchmove",y),document.removeEventListener("touchend",v);const t=a.current;if(o.canDrag&&o.didMove&&t){if(o.canDrag=!1,Math.abs(o.delta)>o.removalDistance)return r(!0),void e.closeToast();t.style.transition="transform 0.2s, opacity 0.2s",t.style.transform="translate".concat(e.draggableDirection,"(0)"),t.style.opacity="1"}}(0,t.useEffect)(()=>{c.current=e}),(0,t.useEffect)(()=>(a.current&&a.current.addEventListener("d",g,{once:!0}),He(e.onOpen)&&e.onOpen((0,t.isValidElement)(e.children)&&e.children.props),()=>{const e=c.current;He(e.onClose)&&e.onClose((0,t.isValidElement)(e.children)&&e.children.props)}),[]),(0,t.useEffect)(()=>(e.pauseOnFocusLoss&&(document.hasFocus()||_(),window.addEventListener("focus",g),window.addEventListener("blur",_)),()=>{e.pauseOnFocusLoss&&(window.removeEventListener("focus",g),window.removeEventListener("blur",_))}),[e.pauseOnFocusLoss]);const E={onMouseDown:m,onTouchStart:m,onMouseUp:f,onTouchEnd:f};return l&&d&&(E.onMouseEnter=_,E.onMouseLeave=g),p&&(E.onClick=e=>{h&&h(e),o.canCloseOnClick&&u()}),{playToast:g,pauseToast:_,isRunning:n,preventExitTransition:s,toastRef:a,eventHandlers:E}}function nt(e){let{closeToast:n,theme:i,ariaLabel:s="close"}=e;return t.createElement("button",{className:"Toastify__close-button Toastify__close-button--".concat(i),type:"button",onClick:e=>{e.stopPropagation(),n(e)},"aria-label":s},t.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},t.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function it(e){let{delay:n,isRunning:i,closeToast:s,type:r="default",hide:a,className:o,style:c,controlledProgress:l,progress:d,rtl:u,isIn:h,theme:p}=e;const m=a||l&&0===d,f=je(je({},c),{},{animationDuration:"".concat(n,"ms"),animationPlayState:i?"running":"paused",opacity:m?0:1});l&&(f.transform="scaleX(".concat(d,")"));const g=Ve("Toastify__progress-bar",l?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated","Toastify__progress-bar-theme--".concat(p),"Toastify__progress-bar--".concat(r),{"Toastify__progress-bar--rtl":u}),_=He(o)?o({rtl:u,type:r,defaultClassName:g}):Ve(g,o);return t.createElement("div",{role:"progressbar","aria-hidden":m?"true":"false","aria-label":"notification timer",className:_,style:f,[l&&d>=1?"onTransitionEnd":"onAnimationEnd"]:l&&d<1?null:()=>{h&&s()}})}const st=e=>{const{isRunning:n,preventExitTransition:i,toastRef:s,eventHandlers:r}=tt(e),{closeButton:a,children:o,autoClose:c,onClick:l,type:d,hideProgressBar:u,closeToast:h,transition:p,position:m,className:f,style:g,bodyClassName:_,bodyStyle:y,progressClassName:v,progressStyle:E,updateId:b,role:S,progress:x,rtl:T,toastId:w,deleteToast:N,isIn:C,isLoading:R,iconOut:I,closeOnClick:A,theme:O}=e,D=Ve("Toastify__toast","Toastify__toast-theme--".concat(O),"Toastify__toast--".concat(d),{"Toastify__toast--rtl":T},{"Toastify__toast--close-on-click":A}),k=He(f)?f({rtl:T,position:m,type:d,defaultClassName:D}):Ve(D,f),P=!!x||!c,L={closeToast:h,type:d,theme:O};let j=null;return!1===a||(j=He(a)?a(L):(0,t.isValidElement)(a)?(0,t.cloneElement)(a,L):nt(L)),t.createElement(p,{isIn:C,done:N,position:m,preventExitTransition:i,nodeRef:s},t.createElement("div",je(je({id:w,onClick:l,className:k},r),{},{style:g,ref:s}),t.createElement("div",je(je({},C&&{role:S}),{},{className:He(_)?_({type:d}):Ve("Toastify__toast-body",_),style:y}),null!=I&&t.createElement("div",{className:Ve("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!R})},I),t.createElement("div",null,o)),j,t.createElement(it,je(je({},b&&!P?{key:"pb-".concat(b)}:{}),{},{rtl:T,theme:O,delay:c,isRunning:n,isIn:C,closeToast:h,hide:u,type:d,style:E,className:v,controlledProgress:P,progress:x||0}))))},rt=function(e,t){return void 0===t&&(t=!1),{enter:"Toastify--animate Toastify__".concat(e,"-enter"),exit:"Toastify--animate Toastify__".concat(e,"-exit"),appendPosition:t}},at=qe(rt("bounce",!0)),ot=(qe(rt("slide",!0)),qe(rt("zoom")),qe(rt("flip")),(0,t.forwardRef)((e,n)=>{const{getToastToRender:i,containerRef:s,isToastActive:r}=Ze(e),{className:a,style:o,rtl:c,containerId:l}=e;function d(e){const t=Ve("Toastify__toast-container","Toastify__toast-container--".concat(e),{"Toastify__toast-container--rtl":c});return He(a)?a({position:e,rtl:c,defaultClassName:t}):Ve(t,Ke(a))}return(0,t.useEffect)(()=>{n&&(n.current=s.current)},[]),t.createElement("div",{ref:s,className:"Toastify",id:l},i((e,n)=>{const i=n.length?je({},o):je(je({},o),{},{pointerEvents:"none"});return t.createElement("div",{className:d(e),style:i,key:"container-".concat(e)},n.map((e,i)=>{let{content:s,props:a}=e;return t.createElement(st,je(je({},a),{},{isIn:r(a.toastId),style:je(je({},a.style),{},{"--nth":i+1,"--len":n.length}),key:"toast-".concat(a.key)}),s)}))}))}));ot.displayName="ToastContainer",ot.defaultProps={position:"top-right",transition:at,autoClose:5e3,closeButton:nt,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let ct,lt=new Map,dt=[],ut=1;function ht(){return""+ut++}function pt(e){return e&&(We(e.toastId)||Ge(e.toastId))?e.toastId:ht()}function mt(e,t){return lt.size>0?Xe.emit(0,e,t):dt.push({content:e,options:t}),t.toastId}function ft(e,t){return je(je({},t),{},{type:t&&t.type||e,toastId:pt(t)})}function gt(e){return(t,n)=>mt(t,ft(e,n))}function _t(e,t){return mt(e,ft("default",t))}_t.loading=(e,t)=>mt(e,ft("default",je({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},t))),_t.promise=function(e,t,n){let i,{pending:s,error:r,success:a}=t;s&&(i=We(s)?_t.loading(s,n):_t.loading(s.render,je(je({},n),s)));const o={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(e,t,s)=>{if(null==t)return void _t.dismiss(i);const r=je(je(je({type:e},o),n),{},{data:s}),a=We(t)?{render:t}:t;return i?_t.update(i,je(je({},r),a)):_t(a.render,je(je({},r),a)),s},l=He(e)?e():e;return l.then(e=>c("success",a,e)).catch(e=>c("error",r,e)),l},_t.success=gt("success"),_t.info=gt("info"),_t.error=gt("error"),_t.warning=gt("warning"),_t.warn=_t.warning,_t.dark=(e,t)=>mt(e,ft("default",je({theme:"dark"},t))),_t.dismiss=e=>{lt.size>0?Xe.emit(1,e):dt=dt.filter(t=>null!=e&&t.options.toastId!==e)},_t.clearWaitingQueue=function(e){return void 0===e&&(e={}),Xe.emit(5,e)},_t.isActive=e=>{let t=!1;return lt.forEach(n=>{n.isToastActive&&n.isToastActive(e)&&(t=!0)}),t},_t.update=function(e,t){void 0===t&&(t={}),setTimeout(()=>{const n=function(e,t){let{containerId:n}=t;const i=lt.get(n||ct);return i&&i.getToast(e)}(e,t);if(n){const{props:i,content:s}=n,r=je(je(je({delay:100},i),t),{},{toastId:t.toastId||e,updateId:ht()});r.toastId!==e&&(r.staleId=e);const a=r.render||s;delete r.render,mt(a,r)}},0)},_t.done=e=>{_t.update(e,{progress:1})},_t.onChange=e=>(Xe.on(4,e),()=>{Xe.off(4,e)}),_t.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},_t.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},Xe.on(2,e=>{ct=e.containerId||e,lt.set(ct,e),dt.forEach(e=>{Xe.emit(0,e.content,e.options)}),dt=[]}).on(3,e=>{lt.delete(e.containerId||e),0===lt.size&&Xe.off(0).off(1).off(5)});const yt=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296===(64512&s)&&i+1<e.length&&56320===(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},vt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const t=e[s],r=s+1<e.length,a=r?e[s+1]:0,o=s+2<e.length,c=o?e[s+2]:0,l=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|c>>6,h=63&c;o||(h=64,r||(u=64)),i.push(n[l],n[d],n[u],n[h])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(yt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],a=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],r=s<e.length?n[e.charAt(s)]:0;++s;const a=s<e.length?n[e.charAt(s)]:64;++s;const o=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==r||null==a||null==o)throw new Et;const c=t<<2|r>>4;if(i.push(c),64!==a){const e=r<<4&240|a>>2;if(i.push(e),64!==o){const e=a<<6&192|o;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Et extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bt=function(e){return function(e){const t=yt(e);return vt.encodeByteArray(t,!0)}(e).replace(/\./g,"")},St=function(e){try{return vt.decodeString(e,!0)}catch(ty){console.error("base64Decode failed: ",ty)}return null};const xt=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Tt=()=>{try{return xt()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(ty){return}const t=e&&St(e[1]);return t&&JSON.parse(t)})()}catch(ty){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(ty))}},wt=e=>{var t,n;return null===(n=null===(t=Tt())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Nt=e=>{const t=wt(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},Ct=()=>{var e;return null===(e=Tt())||void 0===e?void 0:e.config},Rt=e=>{var t;return null===(t=Tt())||void 0===t?void 0:t["_".concat(e)]};class It{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function At(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Ot(){return!function(){var e;const t=null===(e=Tt())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(ty){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Dt(){try{return"object"===typeof indexedDB}catch(ty){return!1}}class kt extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,kt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pt.prototype.create)}}class Pt{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),i=this.errors[e],s=i?function(e,t){return e.replace(Lt,(e,n)=>{const i=t[n];return null!=i?String(i):"<".concat(n,"?>")})}(i,t):"Error",r="".concat(this.serviceName,": ").concat(s," (").concat(n,").");return new kt(n,r,t)}}const Lt=/\{\$([^}]+)}/g;function jt(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(Mt(n)&&Mt(r)){if(!jt(n,r))return!1}else if(n!==r)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function Mt(e){return null!==e&&"object"===typeof e}function Ut(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function Vt(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function Ft(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Bt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=Gt),void 0===i.error&&(i.error=Gt),void 0===i.complete&&(i.complete=Gt);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(ty){}}),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(ty){"undefined"!==typeof console&&console.error&&console.error(ty)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Gt(){}function Wt(e){return e&&e._delegate?e._delegate:e}class Ht{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Kt="[DEFAULT]";class zt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new It;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(ty){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),i=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(ty){if(i)return null;throw ty}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Kt})}catch(ty){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(ty){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&r.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(i){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===Kt?void 0:s),options:n}),this.instances.set(t,i),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(r){}var s;return i||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.component?this.component.multipleInstances?e:Kt:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class qt{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new zt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Yt=[];var Xt;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Xt||(Xt={}));const Jt={debug:Xt.DEBUG,verbose:Xt.VERBOSE,info:Xt.INFO,warn:Xt.WARN,error:Xt.ERROR,silent:Xt.SILENT},Qt=Xt.INFO,Zt={[Xt.DEBUG]:"log",[Xt.VERBOSE]:"log",[Xt.INFO]:"info",[Xt.WARN]:"warn",[Xt.ERROR]:"error"},$t=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),i=Zt[t];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];console[i]("[".concat(n,"]  ").concat(e.name,":"),...r)};class en{constructor(e){this.name=e,this._logLevel=Qt,this._logHandler=$t,this._userLogHandler=null,Yt.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Xt))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?Jt[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.DEBUG,...t),this._logHandler(this,Xt.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.VERBOSE,...t),this._logHandler(this,Xt.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.INFO,...t),this._logHandler(this,Xt.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.WARN,...t),this._logHandler(this,Xt.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.ERROR,...t),this._logHandler(this,Xt.ERROR,...t)}}let tn,nn;const sn=new WeakMap,rn=new WeakMap,an=new WeakMap,on=new WeakMap,cn=new WeakMap;let ln={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return rn.get(e);if("objectStoreNames"===t)return e.objectStoreNames||an.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hn(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function dn(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(nn||(nn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(pn(this),n),hn(sn.get(this))}:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return hn(e.apply(pn(this),n))}:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];const r=e.call(pn(this),t,...i);return an.set(r,t.sort?t.sort():[t]),hn(r)}}function un(e){return"function"===typeof e?dn(e):(e instanceof IDBTransaction&&function(e){if(rn.has(e))return;const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)});rn.set(e,t)}(e),t=e,(tn||(tn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,ln):e);var t}function hn(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(hn(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)});return t.then(t=>{t instanceof IDBCursor&&sn.set(t,e)}).catch(()=>{}),cn.set(t,e),t}(e);if(on.has(e))return on.get(e);const t=un(e);return t!==e&&(on.set(e,t),cn.set(t,e)),t}const pn=e=>cn.get(e);const mn=["get","getKey","getAll","getAllKeys","count"],fn=["put","add","delete","clear"],gn=new Map;function _n(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(gn.get(t))return gn.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=fn.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!mn.includes(n))return;const r=async function(e){const t=this.transaction(e,s?"readwrite":"readonly");let r=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=arguments[c];return i&&(r=r.index(o.shift())),(await Promise.all([r[n](...o),s&&t.done]))[0]};return gn.set(t,r),r}ln=(e=>je(je({},e),{},{get:(t,n,i)=>_n(t,n)||e.get(t,n,i),has:(t,n)=>!!_n(t,n)||e.has(t,n)}))(ln);class yn{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const vn="@firebase/app",En="0.10.5",bn=new en("@firebase/app"),Sn="@firebase/app-compat",xn="@firebase/analytics-compat",Tn="@firebase/analytics",wn="@firebase/app-check-compat",Nn="@firebase/app-check",Cn="@firebase/auth",Rn="@firebase/auth-compat",In="@firebase/database",An="@firebase/database-compat",On="@firebase/functions",Dn="@firebase/functions-compat",kn="@firebase/installations",Pn="@firebase/installations-compat",Ln="@firebase/messaging",jn="@firebase/messaging-compat",Mn="@firebase/performance",Un="@firebase/performance-compat",Vn="@firebase/remote-config",Fn="@firebase/remote-config-compat",Bn="@firebase/storage",Gn="@firebase/storage-compat",Wn="@firebase/firestore",Hn="@firebase/vertexai-preview",Kn="@firebase/firestore-compat",zn="firebase",qn="[DEFAULT]",Yn={[vn]:"fire-core",[Sn]:"fire-core-compat",[Tn]:"fire-analytics",[xn]:"fire-analytics-compat",[Nn]:"fire-app-check",[wn]:"fire-app-check-compat",[Cn]:"fire-auth",[Rn]:"fire-auth-compat",[In]:"fire-rtdb",[An]:"fire-rtdb-compat",[On]:"fire-fn",[Dn]:"fire-fn-compat",[kn]:"fire-iid",[Pn]:"fire-iid-compat",[Ln]:"fire-fcm",[jn]:"fire-fcm-compat",[Mn]:"fire-perf",[Un]:"fire-perf-compat",[Vn]:"fire-rc",[Fn]:"fire-rc-compat",[Bn]:"fire-gcs",[Gn]:"fire-gcs-compat",[Wn]:"fire-fst",[Kn]:"fire-fst-compat",[Hn]:"fire-vertex","fire-js":"fire-js",[zn]:"fire-js-all"},Xn=new Map,Jn=new Map,Qn=new Map;function Zn(e,t){try{e.container.addComponent(t)}catch(ty){bn.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),ty)}}function $n(e){const t=e.name;if(Qn.has(t))return bn.debug("There were multiple attempts to register component ".concat(t,".")),!1;Qn.set(t,e);for(const n of Xn.values())Zn(n,e);for(const n of Jn.values())Zn(n,e);return!0}function ei(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ti(e){return void 0!==e.settings}const ni=new Pt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ii{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ht("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ni.create("app-deleted",{appName:this._name})}}const si="10.12.2";function ri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=Object.assign({name:qn,automaticDataCollectionEnabled:!1},t),s=i.name;if("string"!==typeof s||!s)throw ni.create("bad-app-name",{appName:String(s)});if(n||(n=Ct()),!n)throw ni.create("no-options");const r=Xn.get(s);if(r){if(jt(n,r.options)&&jt(i,r.config))return r;throw ni.create("duplicate-app",{appName:s})}const a=new qt(s);for(const c of Qn.values())a.addComponent(c);const o=new ii(n,i,a);return Xn.set(s,o),o}function ai(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qn;const t=Xn.get(e);if(!t&&e===qn&&Ct())return ri();if(!t)throw ni.create("no-app",{appName:e});return t}function oi(e,t,n){var i;let s=null!==(i=Yn[e])&&void 0!==i?i:e;n&&(s+="-".concat(n));const r=s.match(/\s|\//),a=t.match(/\s|\//);if(r||a){const e=['Unable to register library "'.concat(s,'" with version "').concat(t,'":')];return r&&e.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),r&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void bn.warn(e.join(" "))}$n(new Ht("".concat(s,"-version"),()=>({library:s,version:t}),"VERSION"))}const ci="firebase-heartbeat-store";let li=null;function di(){return li||(li=function(e,t){let{blocked:n,upgrade:i,blocking:s,terminated:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=hn(a);return i&&a.addEventListener("upgradeneeded",e=>{i(hn(a.result),e.oldVersion,e.newVersion,hn(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{r&&e.addEventListener("close",()=>r()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ci)}catch(ty){console.warn(ty)}}}).catch(e=>{throw ni.create("idb-open",{originalErrorMessage:e.message})})),li}async function ui(e,t){try{const n=(await di()).transaction(ci,"readwrite"),i=n.objectStore(ci);await i.put(t,hi(e)),await n.done}catch(ty){if(ty instanceof kt)bn.warn(ty.message);else{const t=ni.create("idb-set",{originalErrorMessage:null===ty||void 0===ty?void 0:ty.message});bn.warn(t.message)}}}function hi(e){return"".concat(e.name,"!").concat(e.options.appId)}class pi{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new fi(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=mi();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==i&&!this._heartbeatsCache.heartbeats.some(e=>e.date===i))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=mi(),{heartbeatsToSend:n,unsentEntries:i}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let i=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),gi(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),gi(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),s=bt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function mi(){return(new Date).toISOString().substring(0,10)}class fi{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Dt()&&new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await di()).transaction(ci),n=await t.objectStore(ci).get(hi(e));return await t.done,n}catch(ty){if(ty instanceof kt)bn.warn(ty.message);else{const t=ni.create("idb-get",{originalErrorMessage:null===ty||void 0===ty?void 0:ty.message});bn.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ui(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ui(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function gi(e){return bt(JSON.stringify({version:2,heartbeats:e})).length}var _i;_i="",$n(new Ht("platform-logger",e=>new yn(e),"PRIVATE")),$n(new Ht("heartbeat",e=>new pi(e),"PRIVATE")),oi(vn,En,_i),oi(vn,En,"esm2017"),oi("fire-js","");function yi(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function vi(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ei=vi,bi=new Pt("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Si=new en("@firebase/auth");function xi(e){if(Si.logLevel<=Xt.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Si.error("Auth (".concat(si,"): ").concat(e),...n)}}function Ti(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw Ri(e,...n)}function wi(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ri(e,...n)}function Ni(e,t,n){const i=Object.assign(Object.assign({},Ei()),{[t]:n});return new Pt("auth","Firebase",i).create(t,{appName:e.name})}function Ci(e){return Ni(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ri(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if("string"!==typeof e){const t=n[0],i=[...n.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(t,...i)}return bi.create(e,...n)}function Ii(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];throw Ri(t,...i)}}function Ai(e){const t="INTERNAL ASSERTION FAILED: "+e;throw xi(t),new Error(t)}function Oi(e,t){e||Ai(t)}function Di(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function ki(){return"http:"===Pi()||"https:"===Pi()}function Pi(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Li(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(ki()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class ji{constructor(e,t){this.shortDelay=e,this.longDelay=t,Oi(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(At())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return Li()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Mi(e,t){Oi(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class Ui{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void Ai("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void Ai("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void Ai("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Vi={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Fi=new ji(3e4,6e4);function Bi(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Gi(e,t,n,i){return Wi(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let s={},r={};i&&("GET"===t?r=i:s={body:JSON.stringify(i)});const a=Ut(Object.assign({key:e.config.apiKey},r)).slice(1),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode),Ui.fetch()(Ki(e,e.config.apiHost,n,a),Object.assign({method:t,headers:o,referrerPolicy:"no-referrer"},s))})}async function Wi(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Vi),t);try{const t=new qi(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Yi(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Yi(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Yi(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw Yi(e,"user-disabled",r);const o=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw Ni(e,o,a);Ti(e,o)}}catch(ty){if(ty instanceof kt)throw ty;Ti(e,"network-request-failed",{message:String(ty)})}}async function Hi(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=await Gi(e,t,n,i,s);return"mfaPendingCredential"in r&&Ti(e,"multi-factor-auth-required",{_serverResponse:r}),r}function Ki(e,t,n,i){const s="".concat(t).concat(n,"?").concat(i);return e.config.emulator?Mi(e.config,s):"".concat(e.config.apiScheme,"://").concat(s)}function zi(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qi{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(wi(this.auth,"network-request-failed")),Fi.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Yi(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=wi(e,t,i);return s.customData._tokenResponse=n,s}function Xi(e){return void 0!==e&&void 0!==e.enterprise}class Ji{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return zi(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Qi(e,t){return Gi(e,"GET","/v2/recaptchaConfig",Bi(e,t))}async function Zi(e,t){return Gi(e,"POST","/v1/accounts:lookup",t)}function $i(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(ty){}}function es(e){return 1e3*Number(e)}function ts(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return xi("JWT malformed, contained fewer than 3 sections"),null;try{const e=St(n);return e?JSON.parse(e):(xi("Failed to decode base64 JWT payload"),null)}catch(ty){return xi("Caught error parsing JWT payload as JSON",null===ty||void 0===ty?void 0:ty.toString()),null}}function ns(e){const t=ts(e);return Ii(t,"internal-error"),Ii("undefined"!==typeof t.exp,"internal-error"),Ii("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function is(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(ty){throw ty instanceof kt&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(ty)&&e.auth.currentUser===e&&await e.auth.signOut(),ty}}class ss{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(ty){return void((null===ty||void 0===ty?void 0:ty.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class rs{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$i(this.lastLoginAt),this.creationTime=$i(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function as(e){var t;const n=e.auth,i=await e.getIdToken(),s=await is(e,Zi(n,{idToken:i}));Ii(null===s||void 0===s?void 0:s.users.length,n,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const a=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?os(r.providerUserInfo):[],o=(c=e.providerData,l=a,[...c.filter(e=>!l.some(t=>t.providerId===e.providerId)),...l]);var c,l;const d=e.isAnonymous,u=!(e.email&&r.passwordHash)&&!(null===o||void 0===o?void 0:o.length),h=!!d&&u,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new rs(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(e,p)}function os(e){return e.map(e=>{var{providerId:t}=e,n=yi(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class cs{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ii(e.idToken,"internal-error"),Ii("undefined"!==typeof e.idToken,"internal-error"),Ii("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):ns(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ii(0!==e.length,"internal-error");const t=ns(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(Ii(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await Wi(e,{},async()=>{const n=Ut({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,r=Ki(e,i,"/v1/token","key=".concat(s)),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Ui.fetch()(r,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new cs;return n&&(Ii("string"===typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(Ii("string"===typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(Ii("number"===typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new cs,this.toJSON())}_performRefresh(){return Ai("not implemented")}}function ls(e,t){Ii("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class ds{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=yi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ss(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new rs(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await is(this,this.stsTokenManager.getToken(this.auth,e));return Ii(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Wt(e),i=await n.getIdToken(t),s=ts(i);Ii(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"===typeof s.firebase?s.firebase:void 0,a=null===r||void 0===r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:$i(es(s.auth_time)),issuedAtTime:$i(es(s.iat)),expirationTime:$i(es(s.exp)),signInProvider:a||null,signInSecondFactor:(null===r||void 0===r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Wt(e);await as(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Ii(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ds(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ii(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await as(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ti(this.auth.app))return Promise.reject(Ci(this.auth));const e=await this.getIdToken();return await is(this,async function(e,t){return Gi(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,a,o,c,l;const d=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,h=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,p=null!==(r=t.photoURL)&&void 0!==r?r:void 0,m=null!==(a=t.tenantId)&&void 0!==a?a:void 0,f=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,_=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:y,emailVerified:v,isAnonymous:E,providerData:b,stsTokenManager:S}=t;Ii(y&&S,e,"internal-error");const x=cs.fromJSON(this.name,S);Ii("string"===typeof y,e,"internal-error"),ls(d,e.name),ls(u,e.name),Ii("boolean"===typeof v,e,"internal-error"),Ii("boolean"===typeof E,e,"internal-error"),ls(h,e.name),ls(p,e.name),ls(m,e.name),ls(f,e.name),ls(g,e.name),ls(_,e.name);const T=new ds({uid:y,auth:e,email:u,emailVerified:v,displayName:d,isAnonymous:E,photoURL:p,phoneNumber:h,tenantId:m,stsTokenManager:x,createdAt:g,lastLoginAt:_});return b&&Array.isArray(b)&&(T.providerData=b.map(e=>Object.assign({},e))),f&&(T._redirectEventId=f),T}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=new cs;i.updateFromServerResponse(t);const s=new ds({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await as(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];Ii(void 0!==i.localId,"internal-error");const s=void 0!==i.providerUserInfo?os(i.providerUserInfo):[],r=!(i.email&&i.passwordHash)&&!(null===s||void 0===s?void 0:s.length),a=new cs;a.updateFromIdToken(n);const o=new ds({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:r}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new rs(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(null===s||void 0===s?void 0:s.length)};return Object.assign(o,c),o}}const us=new Map;function hs(e){Oi(e instanceof Function,"Expected a class definition");let t=us.get(e);return t?(Oi(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,us.set(e,t),t)}class ps{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ps.type="NONE";const ms=ps;function fs(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class gs{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=fs(this.userKey,i.apiKey,s),this.fullPersistenceKey=fs("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ds._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new gs(hs(ms),e,n);const i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=i[0]||hs(ms);const r=fs(n,e.config.apiKey,e.name);let a=null;for(const l of t)try{const t=await l._get(r);if(t){const n=ds._fromJSON(e,t);l!==s&&(a=n),s=l;break}}catch(c){}const o=i.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&o.length?(s=o[0],a&&await s._set(r,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(r)}catch(c){}})),new gs(s,e,n)):new gs(s,e,n)}}function _s(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(bs(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ys(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(xs(t))return"Blackberry";if(Ts(t))return"Webos";if(vs(t))return"Safari";if((t.includes("chrome/")||Es(t))&&!t.includes("edge/"))return"Chrome";if(Ss(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function ys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/firefox\//i.test(e)}function vs(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:At()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Es(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/crios\//i.test(e)}function bs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/iemobile/i.test(e)}function Ss(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/android/i.test(e)}function xs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/blackberry/i.test(e)}function Ts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/webos/i.test(e)}function ws(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ns(){return function(){const e=At();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Cs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return ws(e)||Ss(e)||Ts(e)||xs(e)||/windows phone/i.test(e)||bs(e)}function Rs(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=_s(At());break;case"Worker":t="".concat(_s(At()),"-").concat(e);break;default:t=e}const i=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(si,"/").concat(i)}class Is{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,i)=>{try{n(e(t))}catch(ty){i(ty)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(ty){t.reverse();for(const n of t)try{n()}catch(tt){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===ty||void 0===ty?void 0:ty.message})}}}class As{constructor(e){var t,n,i,s;const r=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=r.minPasswordLength)&&void 0!==t?t:6,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),void 0!==r.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),void 0!==r.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),void 0!==r.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),void 0!==r.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,s,r,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(i=o.containsLowercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsUppercaseLetter)||void 0===s||s),o.isValid&&(o.isValid=null===(r=o.containsNumericCharacter)||void 0===r||r),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class Os{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ks(this),this.idTokenSubscription=new ks(this),this.beforeStateQueue=new Is(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bi,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=hs(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await gs.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(ty){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Zi(this,{idToken:e}),n=await ds._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ti(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null===i||void 0===i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);n&&n!==r||!(null===a||void 0===a?void 0:a.user)||(i=a.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(ty){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(ty))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ii(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(ty){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await as(e)}catch(ty){if((null===ty||void 0===ty?void 0:ty.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ti(this.app))return Promise.reject(Ci(this));const t=e?Wt(e):null;return t&&Ii(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&Ii(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ti(this.app)?Promise.reject(Ci(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ti(this.app)?Promise.reject(Ci(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hs(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return Gi(e,"GET","/v2/passwordPolicy",Bi(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new As(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Pt("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Gi(e,"POST","/v2/accounts:revokeToken",Bi(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&hs(e)||this._popupRedirectResolver;Ii(t,this,"argument-error"),this.redirectPersistenceManager=await gs.create(this,[hs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"===typeof t?t:t.next.bind(t);let r=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ii(a,this,"internal-error"),a.then(()=>{r||s(this.currentUser)}),"function"===typeof t){const s=e.addObserver(t,n,i);return()=>{r=!0,s()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ii(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Rs(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(Si.logLevel<=Xt.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Si.warn("Auth (".concat(si,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function Ds(e){return Wt(e)}class ks{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Bt(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return Ii(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ps={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ls(e){return Ps.loadJS(e)}function js(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Ms{constructor(e){this.type="recaptcha-enterprise",this.auth=Ds(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,i){const s=window.grecaptcha;Xi(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Qi(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new Ji(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&Xi(window.grecaptcha))n(s,e,i);else{if("undefined"===typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=Ps.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Ls(t).then(()=>{n(s,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function Us(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=new Ms(e);let r;try{r=await s.verify(n)}catch(o){r=await s.verify(n,!0)}const a=Object.assign({},t);return i?Object.assign(a,{captchaResp:r}):Object.assign(a,{captchaResponse:r}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Vs(e,t,n,i){var s;if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Us(e,t,n,"getOobCode"===n);return i(e,s)}return i(e,t).catch(async s=>{if(s.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const s=await Us(e,t,n,"getOobCode"===n);return i(e,s)}return Promise.reject(s)})}function Fs(e,t,n){const i=Ds(e);Ii(i._canInitEmulator,i,"emulator-config-failed"),Ii(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const s=!!(null===n||void 0===n?void 0:n.disableWarnings),r=Bs(t),{host:a,port:o}=function(e){const t=Bs(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:Gs(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Gs(t)}}}(t),c=null===o?"":":".concat(o);i.config.emulator={url:"".concat(r,"//").concat(a).concat(c,"/")},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:a,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Bs(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Gs(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ws{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ai("not implemented")}_getIdTokenResponse(e){return Ai("not implemented")}_linkToIdToken(e,t){return Ai("not implemented")}_getReauthenticationResolver(e){return Ai("not implemented")}}async function Hs(e,t){return Gi(e,"POST","/v1/accounts:signUp",t)}async function Ks(e,t){return Hi(e,"POST","/v1/accounts:signInWithPassword",Bi(e,t))}class zs extends Ws{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new zs(e,t,"password")}static _fromEmailAndCode(e,t){return new zs(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Vs(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Ks);case"emailLink":return async function(e,t){return Hi(e,"POST","/v1/accounts:signInWithEmailLink",Bi(e,t))}(e,{email:this._email,oobCode:this._password});default:Ti(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Vs(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hs);case"emailLink":return async function(e,t){return Hi(e,"POST","/v1/accounts:signInWithEmailLink",Bi(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Ti(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function qs(e,t){return Hi(e,"POST","/v1/accounts:signInWithIdp",Bi(e,t))}class Ys extends Ws{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ys(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ti("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=yi(t,["providerId","signInMethod"]);if(!n||!i)return null;const r=new Ys(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return qs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,qs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,qs(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ut(t)}return e}}const Xs={USER_NOT_FOUND:"user-not-found"};class Js extends Ws{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Js({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Js({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Hi(e,"POST","/v1/accounts:signInWithPhoneNumber",Bi(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Hi(e,"POST","/v1/accounts:signInWithPhoneNumber",Bi(e,t));if(n.temporaryProof)throw Yi(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Hi(e,"POST","/v1/accounts:signInWithPhoneNumber",Bi(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Xs)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new Js({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class Qs{constructor(e){var t,n,i,s,r,a;const o=Vt(Ft(e)),c=null!==(t=o.apiKey)&&void 0!==t?t:null,l=null!==(n=o.oobCode)&&void 0!==n?n:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=o.mode)&&void 0!==i?i:null);Ii(c&&l&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=l,this.continueUrl=null!==(s=o.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=o.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=Vt(Ft(e)).link,n=t?Vt(Ft(t)).deep_link_id:null,i=Vt(Ft(e)).deep_link_id;return(i?Vt(Ft(i)).link:null)||i||n||t||e}(e);try{return new Qs(t)}catch(n){return null}}}class Zs{constructor(){this.providerId=Zs.PROVIDER_ID}static credential(e,t){return zs._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Qs.parseLink(t);return Ii(n,"argument-error"),zs._fromEmailAndCode(e,n.code,n.tenantId)}}Zs.PROVIDER_ID="password",Zs.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Zs.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class $s{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class er extends $s{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tr extends er{constructor(){super("facebook.com")}static credential(e){return Ys._fromParams({providerId:tr.PROVIDER_ID,signInMethod:tr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tr.credentialFromTaggedObject(e)}static credentialFromError(e){return tr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return tr.credential(t.oauthAccessToken)}catch(n){return null}}}tr.FACEBOOK_SIGN_IN_METHOD="facebook.com",tr.PROVIDER_ID="facebook.com";class nr extends er{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ys._fromParams({providerId:nr.PROVIDER_ID,signInMethod:nr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nr.credentialFromTaggedObject(e)}static credentialFromError(e){return nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return nr.credential(n,i)}catch(s){return null}}}nr.GOOGLE_SIGN_IN_METHOD="google.com",nr.PROVIDER_ID="google.com";class ir extends er{constructor(){super("github.com")}static credential(e){return Ys._fromParams({providerId:ir.PROVIDER_ID,signInMethod:ir.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ir.credentialFromTaggedObject(e)}static credentialFromError(e){return ir.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ir.credential(t.oauthAccessToken)}catch(n){return null}}}ir.GITHUB_SIGN_IN_METHOD="github.com",ir.PROVIDER_ID="github.com";class sr extends er{constructor(){super("twitter.com")}static credential(e,t){return Ys._fromParams({providerId:sr.PROVIDER_ID,signInMethod:sr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return sr.credentialFromTaggedObject(e)}static credentialFromError(e){return sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=t;if(!n||!i)return null;try{return sr.credential(n,i)}catch(s){return null}}}async function rr(e,t){return Hi(e,"POST","/v1/accounts:signUp",Bi(e,t))}sr.TWITTER_SIGN_IN_METHOD="twitter.com",sr.PROVIDER_ID="twitter.com";class ar{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=await ds._fromIdTokenResponse(e,n,i),r=or(n);return new ar({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=or(n);return new ar({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function or(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class cr extends kt{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,cr.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new cr(e,t,n,i)}}function lr(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw cr._fromErrorAndOperation(e,n,t,i);throw n})}async function dr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=await is(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ar._forOperation(e,"link",i)}async function ur(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:i}=e;if(ti(i.app))return Promise.reject(Ci(i));const s="reauthenticate";try{const r=await is(e,lr(i,s,t,e),n);Ii(r.idToken,i,"internal-error");const a=ts(r.idToken);Ii(a,i,"internal-error");const{sub:o}=a;return Ii(e.uid===o,i,"user-mismatch"),ar._forOperation(e,s,r)}catch(ty){throw(null===ty||void 0===ty?void 0:ty.code)==="auth/".concat("user-not-found")&&Ti(i,"user-mismatch"),ty}}async function hr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ti(e.app))return Promise.reject(Ci(e));const i="signIn",s=await lr(e,i,t),r=await ar._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}async function pr(e,t){return hr(Ds(e),t)}async function mr(e){const t=Ds(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function fr(e,t){let{displayName:n,photoURL:i}=t;if(void 0===n&&void 0===i)return;const s=Wt(e),r={idToken:await s.getIdToken(),displayName:n,photoUrl:i,returnSecureToken:!0},a=await is(s,async function(e,t){return Gi(e,"POST","/v1/accounts:update",t)}(s.auth,r));s.displayName=a.displayName||null,s.photoURL=a.photoUrl||null;const o=s.providerData.find(e=>{let{providerId:t}=e;return"password"===t});o&&(o.displayName=s.displayName,o.photoURL=s.photoURL),await s._updateTokensIfNecessary(a)}function gr(e){return Wt(e).signOut()}new WeakMap;const _r="__sak";class yr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_r,"1"),this.storage.removeItem(_r),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class vr extends yr{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=At();return vs(e)||ws(e)}()&&function(){try{return!(!window||window===window.top)}catch(ty){return!1}}(),this.fallbackToPolling=Cs(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);Ns()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}vr.type="LOCAL";const Er=vr;class br extends yr{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}br.type="SESSION";const Sr=br;class xr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new xr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null===r||void 0===r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const a=Array.from(r).map(async e=>e(t.origin,s)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Tr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}xr.receivers=[];class wr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const i="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise((a,o)=>{const c=Tr("",20);i.port1.start();const l=setTimeout(()=>{o(new Error("unsupported_event"))},n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(l),clearTimeout(s),o(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function Nr(){return window}function Cr(){return"undefined"!==typeof Nr().WorkerGlobalScope&&"function"===typeof Nr().importScripts}const Rr="firebaseLocalStorageDb",Ir="firebaseLocalStorage",Ar="fbase_key";class Or{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Dr(e,t){return e.transaction([Ir],t?"readwrite":"readonly").objectStore(Ir)}function kr(){const e=indexedDB.open(Rr,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Ir,{keyPath:Ar})}catch(ty){n(ty)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(Ir)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Rr);return new Or(e).toPromise()}(),t(await kr()))})})}async function Pr(e,t,n){const i=Dr(e,!0).put({[Ar]:t,value:n});return new Or(i).toPromise()}function Lr(e,t){const n=Dr(e,!0).delete(t);return new Or(n).toPromise()}class jr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await kr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(ty){if(t++>3)throw ty;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Cr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=xr._getInstance(Cr()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new wr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kr();return await Pr(e,_r,"1"),await Lr(e,_r),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Pr(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Dr(e,!1).get(t),i=await new Or(n).toPromise();return void 0===i?null:i.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Lr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Dr(e,!1).getAll();return new Or(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}jr.type="LOCAL";const Mr=jr;js("rcb"),new ji(3e4,6e4);const Ur="recaptcha";async function Vr(e,t,n){var i;const s=await n.verify();try{let r;if(Ii("string"===typeof s,e,"argument-error"),Ii(n.type===Ur,e,"argument-error"),r="string"===typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){Ii("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Gi(e,"POST","/v2/accounts/mfaEnrollment:start",Bi(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{Ii("signin"===t.type,e,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;Ii(n,e,"missing-multi-factor-info");const a=await function(e,t){return Gi(e,"POST","/v2/accounts/mfaSignIn:start",Bi(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Gi(e,"POST","/v1/accounts:sendVerificationCode",Bi(e,t))}(e,{phoneNumber:r.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}class Fr{constructor(e){this.providerId=Fr.PROVIDER_ID,this.auth=Ds(e)}verifyPhoneNumber(e,t){return Vr(this.auth,e,Wt(t))}static credential(e,t){return Js._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Fr.credentialFromTaggedObject(t)}static credentialFromError(e){return Fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:i}=t;return n&&i?Js._fromTokenResponse(n,i):null}}function Br(e,t){return t?hs(t):(Ii(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Fr.PROVIDER_ID="phone",Fr.PHONE_SIGN_IN_METHOD="phone";class Gr extends Ws{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return qs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return qs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return qs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Wr(e){return hr(e.auth,new Gr(e),e.bypassAuthState)}function Hr(e){const{auth:t,user:n}=e;return Ii(n,t,"internal-error"),ur(n,new Gr(e),e.bypassAuthState)}async function Kr(e){const{auth:t,user:n}=e;return Ii(n,t,"internal-error"),dr(n,new Gr(e),e.bypassAuthState)}class zr{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(ty){this.reject(ty)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:a}=e;if(r)return void this.reject(r);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(ty){this.reject(ty)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wr;case"linkViaPopup":case"linkViaRedirect":return Kr;case"reauthViaPopup":case"reauthViaRedirect":return Hr;default:Ti(this.auth,"internal-error")}}resolve(e){Oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const qr=new ji(2e3,1e4);class Yr extends zr{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,Yr.currentPopupAction&&Yr.currentPopupAction.cancel(),Yr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ii(e,this.auth,"internal-error"),e}async onExecution(){Oi(1===this.filter.length,"Popup operations only handle one event");const e=Tr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(wi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(wi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(wi(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,qr.get())};e()}}Yr.currentPopupAction=null;const Xr=new Map;class Jr extends zr{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Xr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=$r(t),i=Zr(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(ty){e=()=>Promise.reject(ty)}Xr.set(this.auth._key(),e)}return this.bypassAuthState||Xr.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Qr(e,t){Xr.set(e._key(),t)}function Zr(e){return hs(e._redirectPersistence)}function $r(e){return fs("pendingRedirect",e.config.apiKey,e.name)}async function ea(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ti(e.app))return Promise.reject(Ci(e));const i=Ds(e),s=Br(i,t),r=new Jr(i,s,n),a=await r.execute();return a&&!n&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class ta{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ia(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ia(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(wi(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(na(e))}saveEventToCache(e){this.cachedEventUids.add(na(e)),this.lastProcessedEventTime=Date.now()}}function na(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ia(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const sa=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ra=/^https?/;async function aa(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Gi(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const i of t)try{if(oa(i))return}catch(n){}Ti(e,"unauthorized-domain")}function oa(e){const t=Di(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!ra.test(n))return!1;if(sa.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const ca=new ji(3e4,6e4);function la(){const e=Nr().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function da(e){return new Promise((t,n)=>{var i,s,r;function a(){la(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{la(),n(wi(e,"network-request-failed"))},timeout:ca.get()})}if(null===(s=null===(i=Nr().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=Nr().gapi)||void 0===r?void 0:r.load)){const t=js("iframefcb");return Nr()[t]=()=>{gapi.load?a():n(wi(e,"network-request-failed"))},Ls("".concat(Ps.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}a()}}).catch(e=>{throw ua=null,e})}let ua=null;const ha=new ji(5e3,15e3),pa={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ma=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function fa(e){const t=e.config;Ii(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Mi(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),i={apiKey:t.apiKey,appName:e.name,v:si},s=ma.get(e.config.apiHost);s&&(i.eid=s);const r=e._getFrameworks();return r.length&&(i.fw=r.join(",")),"".concat(n,"?").concat(Ut(i).slice(1))}async function ga(e){const t=await function(e){return ua=ua||da(e),ua}(e),n=Nr().gapi;return Ii(n,e,"internal-error"),t.open({where:document.body,url:fa(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:pa,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=wi(e,"network-request-failed"),r=Nr().setTimeout(()=>{i(s)},ha.get());function a(){Nr().clearTimeout(r),n(t)}t.ping(a).then(a,()=>{i(s)})}))}const _a={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ya{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(ty){}}}function va(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const r=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let o="";const c=Object.assign(Object.assign({},_a),{width:i.toString(),height:s.toString(),top:r,left:a}),l=At().toLowerCase();n&&(o=Es(l)?"_blank":n),ys(l)&&(t=t||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce((e,t)=>{let[n,i]=t;return"".concat(e).concat(n,"=").concat(i,",")},"");if(function(){var e;return ws(arguments.length>0&&void 0!==arguments[0]?arguments[0]:At())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(l)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",o),new ya(null);const u=window.open(t||"",o,d);Ii(u,e,"popup-blocked");try{u.focus()}catch(ty){}return new ya(u)}const Ea="__/auth/handler",ba="emulator/auth/handler",Sa=encodeURIComponent("fac");async function xa(e,t,n,i,s,r){Ii(e.config.authDomain,e,"auth-domain-config-required"),Ii(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:si,eventId:s};if(t instanceof $s){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(r||{}))a[e]=t}if(t instanceof er){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const d of Object.keys(o))void 0===o[d]&&delete o[d];const c=await e._getAppCheckToken(),l=c?"#".concat(Sa,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Ea);return Mi(t,ba)}(e),"?").concat(Ut(o).slice(1)).concat(l)}const Ta="webStorageSupport";const wa=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Sr,this._completeRedirectFn=ea,this._overrideRedirectResult=Qr}async _openPopup(e,t,n,i){var s;Oi(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return va(e,await xa(e,t,n,Di(),i),Tr())}async _openRedirect(e,t,n,i){await this._originValidation(e);return function(e){Nr().location.href=e}(await xa(e,t,n,Di(),i)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Oi(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ga(e),n=new ta(e);return t.register("authEvent",t=>{Ii(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ta,{type:Ta},n=>{var i;const s=null===(i=null===n||void 0===n?void 0:n[0])||void 0===i?void 0:i[Ta];void 0!==s&&t(!!s),Ti(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=aa(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Cs()||vs()||ws()}};var Na="@firebase/auth",Ca="1.7.4";class Ra{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ii(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ia=Rt("authIdTokenMaxAge")||300;let Aa=null;var Oa;function Da(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{c(i.next(e))}catch(ty){r(ty)}}function o(e){try{c(i.throw(e))}catch(ty){r(ty)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}c((i=i.apply(e,t||[])).next())})}function ka(e,t){var n,i,s,r,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(s=(s=a.trys).length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){a.label=r[1];break}if(6===r[0]&&a.label<s[1]){a.label=s[1],s=r;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(r);break}s[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(ty){r=[6,ty],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}!function(e){Ps=e}({loadJS:e=>new Promise((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=wi("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),Oa="Browser",$n(new Ht("auth",(e,t)=>{let{options:n}=t;const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;Ii(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const c={apiKey:a,authDomain:o,clientPlatform:Oa,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Rs(Oa)},l=new Os(i,s,r,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(hs);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),$n(new Ht("auth-internal",e=>(e=>new Ra(e))(Ds(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),oi(Na,Ca,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Oa)),oi(Na,Ca,"esm2017");var Pa=function(){return Pa=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Pa.apply(this,arguments)},La=function(e){return{loading:void 0===e||null===e,value:e}},ja=function(e){var n=e?e():void 0,i=(0,t.useReducer)(function(e,t){switch(t.type){case"error":return Pa(Pa({},e),{error:t.error,loading:!1,value:void 0});case"reset":return La(t.defaultValue);case"value":return Pa(Pa({},e),{error:void 0,loading:!1,value:t.value});default:return e}},La(n)),s=i[0],r=i[1],a=(0,t.useCallback)(function(){var t=e?e():void 0;r({type:"reset",defaultValue:t})},[e]),o=(0,t.useCallback)(function(e){r({type:"error",error:e})},[]),c=(0,t.useCallback)(function(e){r({type:"value",value:e})},[]);return(0,t.useMemo)(function(){return{error:s.error,loading:s.loading,reset:a,setError:o,setValue:c,value:s.value}},[s.error,s.loading,a,o,c,s.value])},Ma=function(e,n){var i=ja(function(){return e.currentUser}),s=i.error,r=i.loading,a=i.setError,o=i.setValue,c=i.value;return(0,t.useEffect)(function(){var t=function(e,t,n,i){return Wt(e).onAuthStateChanged(t,n,i)}(e,function(e){return Da(void 0,void 0,void 0,function(){var t;return ka(this,function(i){switch(i.label){case 0:if(!(null===n||void 0===n?void 0:n.onUserChanged))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.onUserChanged(e)];case 2:return i.sent(),[3,4];case 3:return t=i.sent(),a(t),[3,4];case 4:return o(e),[2]}})})},a);return function(){t()}},[e]),[c,r,s]};oi("firebase","10.12.2","app");var Ua,Va,Fa="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Ba={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var i=Array(16);if("string"===typeof t)for(var s=0;16>s;++s)i[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)i[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var r=e.g[3],a=t+(r^n&(s^r))+i[0]+3614090360&4294967295;a=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=n+(a<<7&4294967295|a>>>25))+((a=r+(s^t&(n^s))+i[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=s+(n^r&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^s&(r^t))+i[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^n&(s^r))+i[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=r+(s^t&(n^s))+i[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=s+(n^r&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^s&(r^t))+i[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^n&(s^r))+i[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=r+(s^t&(n^s))+i[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=s+(n^r&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^s&(r^t))+i[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^n&(s^r))+i[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=r+(s^t&(n^s))+i[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=s+(n^r&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^s&(r^t))+i[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(n^s))+i[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^s&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=s+(t^n&(r^t))+i[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(s^r))+i[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(s^r&(n^s))+i[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^s&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=s+(t^n&(r^t))+i[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(s^r))+i[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(s^r&(n^s))+i[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^s&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=s+(t^n&(r^t))+i[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(s^r))+i[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(s^r&(n^s))+i[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^s&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=s+(t^n&(r^t))+i[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(s^r))+i[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^s^r)+i[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^s)+i[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=s+(r^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(s^r^t)+i[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^s^r)+i[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^s)+i[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=s+(r^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(s^r^t)+i[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^s^r)+i[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^s)+i[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=s+(r^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(s^r^t)+i[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^s^r)+i[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^s)+i[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=s+(r^t^n)+i[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(s^r^t)+i[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(s^(n|~r))+i[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~s))+i[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=s+(t^(r|~n))+i[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(r^(s|~t))+i[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(s^(n|~r))+i[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~s))+i[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=s+(t^(r|~n))+i[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(r^(s|~t))+i[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(s^(n|~r))+i[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~s))+i[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=s+(t^(r|~n))+i[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(r^(s|~t))+i[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((r=(t=n+((a=t+(s^(n|~r))+i[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~s))+i[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((s=r+((a=s+(t^(r|~n))+i[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+r&4294967295}function i(e,t){this.h=t;for(var n=[],i=!0,s=e.length-1;0<=s;s--){var r=0|e[s];i&&r==t||(n[s]=r,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var i=t-this.blockSize,s=this.B,r=this.h,a=0;a<t;){if(0==r)for(;a<=i;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(s[r++]=e.charCodeAt(a++),r==this.blockSize){n(this,s),r=0;break}}else for(;a<t;)if(s[r++]=e[a++],r==this.blockSize){n(this,s),r=0;break}}this.h=r,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var s={};function r(e){return-128<=e&&128>e?function(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new i([0|e],0>e?-1:0)}):new i([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(0>e)return h(a(-e));for(var t=[],n=1,s=0;e>=n;s++)t[s]=e/n|0,n*=4294967296;return new i(t,0)}var o=r(0),c=r(1),l=r(16777216);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],s=0;s<t;s++)n[s]=~e.g[s];return new i(n,~e.h).add(c)}function p(e,t){return e.add(h(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function f(e,t){this.g=e,this.h=t}function g(e,t){if(d(t))throw Error("division by zero");if(d(e))return new f(o,o);if(u(e))return t=g(h(e),t),new f(h(t.g),h(t.h));if(u(t))return t=g(e,h(t)),new f(h(t.g),t.h);if(30<e.g.length){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,i=t;0>=i.l(e);)n=_(n),i=_(i);var s=y(n,1),r=y(i,1);for(i=y(i,2),n=y(n,2);!d(i);){var l=r.add(i);0>=l.l(e)&&(s=s.add(n),r=l),i=y(i,1),n=y(n,1)}return t=p(e,s.j(t)),new f(s,t)}for(s=o;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),l=(r=a(n)).j(t);u(l)||0<l.l(e);)l=(r=a(n-=i)).j(t);d(r)&&(r=c),s=s.add(r),e=p(e,l)}return new f(s,e)}function _(e){for(var t=e.g.length+1,n=[],s=0;s<t;s++)n[s]=e.i(s)<<1|e.i(s-1)>>>31;return new i(n,e.h)}function y(e,t){var n=t>>5;t%=32;for(var s=e.g.length-n,r=[],a=0;a<s;a++)r[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new i(r,e.h)}(e=i.prototype).m=function(){if(u(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(u(this))return"-"+h(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,i="";;){var s=g(n,t).g,r=((0<(n=p(n,s.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(d(n=s))return r+i;for(;6>r.length;)r="0"+r;i=r+i}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=p(this,e))?-1:d(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0,r=0;r<=t;r++){var a=s+(65535&this.i(r))+(65535&e.i(r)),o=(a>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);s=o>>>16,a&=65535,o&=65535,n[r]=o<<16|a}return new i(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return o;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(0>this.l(l)&&0>e.l(l))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<e.g.length;r++){var c=this.i(s)>>>16,p=65535&this.i(s),f=e.i(r)>>>16,g=65535&e.i(r);n[2*s+2*r]+=p*g,m(n,2*s+2*r),n[2*s+2*r+1]+=c*g,m(n,2*s+2*r+1),n[2*s+2*r+1]+=p*f,m(n,2*s+2*r+1),n[2*s+2*r+2]+=c*f,m(n,2*s+2*r+2)}for(s=0;s<t;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=t;s<2*t;s++)n[s]=0;return new i(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)&e.i(s);return new i(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)|e.i(s);return new i(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)^e.i(s);return new i(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Va=Ba.Md5=t,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=a,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=a(Math.pow(n,8)),s=o,r=0;r<t.length;r+=8){var c=Math.min(8,t.length-r),l=parseInt(t.substring(r,r+c),n);8>c?(c=a(Math.pow(n,c)),s=s.j(c).add(a(l))):s=(s=s.j(i)).add(a(l))}return s},Ua=Ba.Integer=i}).apply("undefined"!==typeof Fa?Fa:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Ga,Wa,Ha,Ka,za,qa,Ya,Xa,Ja,Qa="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Za={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Qa&&Qa];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,i){if(i)e:{var s=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in s))break e;s=s[a]}(i=i(r=s[e=e[e.length-1]]))!=r&&null!=i&&t(s,e,{configurable:!0,writable:!0,value:i})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,s={next:function(){if(!i&&n<e.length){var s=n++;return{value:t(s,e[s]),done:!1}}return i=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,function(e,t){return t})}});var i=i||{},s=this||self;function r(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:c).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function p(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(r(t)){const n=e.length||0,i=t.length||0;e.length=n+i;for(let s=0;s<i;s++)e[n+s]=t[s]}else e.push(t)}}function m(e){return/^[\s\xa0]*$/.test(e)}function f(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var _=-1!=f().indexOf("Gecko")&&!(-1!=f().toLowerCase().indexOf("webkit")&&-1==f().indexOf("Edge"))&&!(-1!=f().indexOf("Trident")||-1!=f().indexOf("MSIE"))&&-1==f().indexOf("Edge");function y(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function v(e){const t={};for(const n in e)t[n]=e[n];return t}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let n,i;for(let s=1;s<arguments.length;s++){for(n in i=arguments[s],i)e[n]=i[n];for(let t=0;t<E.length;t++)n=E[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function S(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function x(e){s.setTimeout(()=>{throw e},0)}function T(){var e=I;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var w=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new N,e=>e.reset());class N{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,R=!1,I=new class{constructor(){this.h=this.g=null}add(e,t){const n=w.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},A=()=>{const e=s.Promise.resolve(void 0);C=()=>{e.then(O)}};var O=()=>{for(var e;e=T();){try{e.h.call(e.g)}catch(n){x(n)}var t=w;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}R=!1};function D(){this.s=this.s,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}D.prototype.s=!1,D.prototype.ma=function(){this.s||(this.s=!0,this.N())},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(n){}return e}();function L(e,t){if(k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(_){e:{try{g(t.nodeName);var s=!0;break e}catch(ze){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}u(L,k);var j={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=s,this.key=++U,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function G(e,t){var n=t.type;if(n in e.g){var i,s=e.g[n],r=Array.prototype.indexOf.call(s,t,void 0);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(F(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function W(e,t,n,i){for(var s=0;s<e.length;++s){var r=e[s];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==i)return s}return-1}B.prototype.add=function(e,t,n,i,s){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var a=W(e,t,i,s);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new V(t,this.src,r,!!i,s)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),K={};function z(e,t,n,i,s){if(i&&i.once)return Y(e,t,n,i,s);if(Array.isArray(t)){for(var r=0;r<t.length;r++)z(e,t[r],n,i,s);return null}return n=te(n),e&&e[M]?e.K(t,n,a(i)?!!i.capture:!!i,s):q(e,t,n,!1,i,s)}function q(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");var o=a(s)?!!s.capture:!!s,c=$(e);if(c||(e[H]=c=new B(e)),(n=c.add(t,n,i,o,r)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}const t=Z;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)P||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(Q(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function Y(e,t,n,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++)Y(e,t[r],n,i,s);return null}return n=te(n),e&&e[M]?e.L(t,n,a(i)?!!i.capture:!!i,s):q(e,t,n,!0,i,s)}function X(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)X(e,t[r],n,i,s);else i=a(i)?!!i.capture:!!i,n=te(n),e&&e[M]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=W(r=e.g[t],n,i,s))&&(F(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--)))):e&&(e=$(e))&&(t=e.g[t.toString()],e=-1,t&&(e=W(t,n,i,s)),(n=-1<e?t[e]:null)&&J(n))}function J(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])G(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Q(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=$(t))?(G(n,e),0==n.h&&(n.src=null,t[H]=null)):F(e)}}}function Q(e){return e in K?K[e]:K[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new L(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&J(e),e=n.call(i,t)}return e}function $(e){return(e=e[H])instanceof B?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){D.call(this),this.i=new B(this),this.M=this,this.F=null}function ie(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"===typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var s=t;b(t=new k(i,e),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var a=t.g=n[r];s=se(a,i,!0,t)&&s}if(s=se(a=t.g=e,i,!0,t)&&s,s=se(a,i,!1,t)&&s,n)for(r=0;r<n.length;r++)s=se(a=t.g=n[r],i,!1,t)&&s}function se(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,r=0;r<t.length;++r){var a=t[r];if(a&&!a.da&&a.capture==n){var o=a.listener,c=a.ha||a.src;a.fa&&G(e.i,a),s=!1!==o.call(c,i)&&s}}return s&&!i.defaultPrevented}function re(e,t,n){if("function"===typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function ae(e){e.g=re(()=>{e.g=null,e.i&&(e.i=!1,ae(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(ne,D),ne.prototype[M]=!0,ne.prototype.removeEventListener=function(e,t,n,i){X(this,e,t,n,i)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)F(n[i]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ne.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class oe extends D{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ae(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){D.call(this),this.h=e,this.g={}}u(ce,D);var le=[];function de(e){y(e.g,function(e,t){this.g.hasOwnProperty(t)&&J(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),de(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ue=s.JSON.stringify,he=s.JSON.parse,pe=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function me(){}function fe(e){return e.h||(e.h=e.i())}function ge(){}me.prototype.h=null;var _e={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ye(){k.call(this,"d")}function ve(){k.call(this,"c")}u(ye,k),u(ve,k);var Ee={},be=null;function Se(){return be=be||new ne}function xe(e){k.call(this,Ee.La,e)}function Te(e){const t=Se();ie(t,new xe(t))}function we(e,t){k.call(this,Ee.STAT_EVENT,e),this.stat=t}function Ne(e){const t=Se();ie(t,new we(t,e))}function Ce(e,t){k.call(this,Ee.Ma,e),this.size=t}function Re(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){e()},t)}function Ie(){this.g=!0}function Ae(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var a=1;a<s.length;a++)s[a]=""}}}return ue(n)}catch(Ke){return t}}(e,n)+(i?" "+i:"")})}Ee.La="serverreachability",u(xe,k),Ee.STAT_EVENT="statevent",u(we,k),Ee.Ma="timingevent",u(Ce,k),Ie.prototype.xa=function(){this.g=!1},Ie.prototype.info=function(){};var Oe,De={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ke={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Pe(){}function Le(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new je}function je(){this.i=null,this.g="",this.h=!1}u(Pe,me),Pe.prototype.g=function(){return new XMLHttpRequest},Pe.prototype.i=function(){return{}},Oe=new Pe;var Me={},Ue={};function Ve(e,t,n){e.L=1,e.v=ft(dt(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),He(e),e.A=dt(e.v);var n=e.A,i=e.R;Array.isArray(i)||(i=[String(i)]),It(n.i,"t",i),e.C=0,n=e.j.J,e.h=new je,e.g=_n(e.j,n?t:null,!e.m),0<e.O&&(e.M=new oe(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,i=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(le[0]=s.toString()),s=le);for(var r=0;r<s.length;r++){var a=z(n,s[r],i||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?v(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Te(),function(e,t,n,i,s,r){e.info(function(){if(e.g)if(r)for(var a="",o=r.split("&"),c=0;c<o.length;c++){var l=o[c].split("=");if(1<l.length){var d=l[0];l=l[1];var u=d.split("_");a=2<=u.length&&"type"==u[1]?a+(d+"=")+l+"&":a+(d+"=redacted&")}}else a=null;else a=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Be(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ge(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Ue:(n=Number(t.substring(n,i)),isNaN(n)?Me:(i+=1)+n>t.length?Ue:(t=t.slice(i,i+n),e.C=i+n,t))}function He(e){e.S=Date.now()+e.I,qe(e,e.I)}function qe(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Re(l(e.ba,e),t)}function Ye(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function Xe(e){0==e.j.G||e.J||hn(e.j,e)}function Je(e){Ye(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,de(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Qe(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||it(n.h,e)))if(!e.K&&it(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(d){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;un(n),en(n)}cn(n),Ne(18)}}else n.za=s[1],0<n.za-n.T&&37500>s[2]&&n.F&&0==n.v&&!n.C&&(n.C=Re(l(n.Za,n),6e3));if(1>=nt(n.h)&&n.ca){try{n.ca()}catch(d){}n.ca=void 0}}else mn(n,11)}else if((e.K||n.g==e)&&un(n),!m(t))for(s=n.Da.g.parse(t),t=0;t<s.length;t++){let l=s[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const s=l[4];null!=s&&(n.Aa=s,n.j.info("SVER="+n.Aa));const d=l[5];null!=d&&"number"===typeof d&&0<d&&(i=1.5*d,n.L=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(st(r,r.h),r.h=null))}if(i.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,mt(i.I,i.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((i=n).qa=gn(i,i.J?i.ia:null,i.W),a.K){rt(i.h,a);var o=a,c=i.L;c&&(o.I=c),o.B&&(Ye(o),He(o)),i.g=a}else on(i);0<n.i.length&&nn(n)}else"stop"!=l[0]&&"close"!=l[0]||mn(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?mn(n,7):$t(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}Te()}catch(d){}}Le.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Xt(e)?t.j():this.Y(e)},Le.prototype.Y=function(e){try{if(e==this.g)e:{const h=Xt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Jt(this.g)))){this.J||4!=h||7==t||Te(),Ye(this);var n=this.g.Z();this.X=n;t:if(Be(this)){var i=Jt(this.g);e="";var r=i.length,a=4==Xt(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Je(this),Xe(this);var o="";break t}this.h.i=new s.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(a&&t==r-1)});i.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,i,s,r,a){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+a})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(c)){var d=c;break t}}d=null}if(!(n=d)){this.o=!1,this.s=3,Ne(12),Je(this),Xe(this);break e}Ae(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qe(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;){if(e=Ge(this,o),e==Ue){4==h&&(this.s=4,Ne(14),n=!1),Ae(this.i,this.l,null,"[Incomplete Response]");break}if(e==Me){this.s=4,Ne(15),Ae(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}Ae(this.i,this.l,e,null),Qe(this,e)}if(Be(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=o.length||this.h.h||(this.s=1,Ne(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),ln(u),u.M=!0,Ne(11))}}else Ae(this.i,this.l,o,"[Invalid Chunked Response]"),Je(this),Xe(this)}else Ae(this.i,this.l,o,null),Qe(this,o);4==h&&Je(this),this.o&&!this.J&&(4==h?hn(this.j,this):(this.o=!1,He(this)))}else(function(e){const t={};e=(e.g&&2<=Xt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(m(e[i]))continue;var n=S(e[i]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const r=t[s]||[];t[s]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Ne(12)):(this.s=0,Ne(13)),Je(this),Xe(this)}}}catch(h){}},Le.prototype.cancel=function(){this.J=!0,Je(this)},Le.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Te(),Ne(17)),Je(this),this.s=2,Xe(this)):qe(this,this.S-e)};var Ze=class{constructor(e,t){this.g=e,this.map=t}};function et(e){this.l=e||10,s.PerformanceNavigationTiming?e=0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function tt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function nt(e){return e.h?1:e.g?e.g.size:0}function it(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function st(e,t){e.g?e.g.add(t):e.h=t}function rt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function at(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function ot(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(r(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(r(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(r(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),s=i.length,a=0;a<s;a++)t.call(void 0,i[a],n&&n[a],e)}et.prototype.cancel=function(){if(this.i=at(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ct=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof lt){this.h=e.h,ut(this,e.j),this.o=e.o,this.g=e.g,ht(this,e.s),this.l=e.l;var t=e.i,n=new wt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),pt(this,n),this.m=e.m}else e&&(t=String(e).match(ct))?(this.h=!1,ut(this,t[1]||"",!0),this.o=gt(t[2]||""),this.g=gt(t[3]||"",!0),ht(this,t[4]),this.l=gt(t[5]||"",!0),pt(this,t[6]||"",!0),this.m=gt(t[7]||"")):(this.h=!1,this.i=new wt(null,this.h))}function dt(e){return new lt(e)}function ut(e,t,n){e.j=n?gt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ht(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function pt(e,t,n){t instanceof wt?(e.i=t,function(e,t){t&&!e.j&&(Nt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Ct(this,t),It(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=_t(t,xt)),e.i=new wt(t,e.h))}function mt(e,t,n){e.i.set(t,n)}function ft(e){return mt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function gt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function _t(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,yt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function yt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}lt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(_t(t,Et,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(_t(t,Et,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(_t(n,"/"==n.charAt(0)?St:bt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",_t(n,Tt)),e.join("")};var vt,Et=/[#\/\?@]/g,bt=/[#\?:]/g,St=/[#\?]/g,xt=/[#\?@]/g,Tt=/#/g;function wt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Nt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),s=null;if(0<=i){var r=e[n].substring(0,i);s=e[n].substring(i+1)}else r=e[n];t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Ct(e,t){Nt(e),t=At(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Rt(e,t){return Nt(e),t=At(e,t),e.g.has(t)}function It(e,t,n){Ct(e,t),0<n.length&&(e.i=null,e.g.set(At(e,t),h(n)),e.h+=n.length)}function At(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ot(e,t,n,i,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),i(n)}catch(ze){}}function Dt(){this.g=new pe}function kt(e,t,n){const i=n||"";try{ot(e,function(e,n){let s=e;a(e)&&(s=ue(e)),t.push(i+n+"="+encodeURIComponent(s))})}catch(ty){throw t.push(i+"type="+encodeURIComponent("_badmap")),ty}}function Pt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Lt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function jt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Mt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ut(e)}function Ut(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Vt(e){let t="";return y(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Ft(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Vt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):mt(e,t,n))}function Bt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=wt.prototype).add=function(e,t){Nt(this),this.i=null,e=At(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Nt(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},e.na=function(){Nt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const s=e[i];for(let e=0;e<s.length;e++)n.push(t[i])}return n},e.V=function(e){Nt(this);let t=[];if("string"===typeof e)Rt(this,e)&&(t=t.concat(this.g.get(At(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Nt(this),this.i=null,Rt(this,e=At(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const r=encodeURIComponent(String(i)),a=this.V(i);for(i=0;i<a.length;i++){var s=r;""!==a[i]&&(s+="="+encodeURIComponent(String(a[i]))),e.push(s)}}return this.i=e.join("&")},u(Pt,me),Pt.prototype.g=function(){return new Lt(this.l,this.j)},Pt.prototype.i=(vt={},function(){return vt}),u(Lt,ne),(e=Lt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ut(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ut(this)),this.g&&(this.readyState=3,Ut(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;jt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mt(this):Ut(this),3==this.readyState&&jt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Mt(this))},e.Qa=function(e){this.g&&(this.response=e,Mt(this))},e.ga=function(){this.g&&Mt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Lt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Bt,ne);var Gt=/^https?$/i,Wt=["POST","PUT"];function Ht(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Kt(e),qt(e)}function Kt(e){e.A||(e.A=!0,ie(e,"complete"),ie(e,"error"))}function zt(e){if(e.h&&"undefined"!=typeof i&&(!e.v[1]||4!=Xt(e)||2!=e.Z()))if(e.u&&4==Xt(e))re(e.Ea,0,e);else if(ie(e,"readystatechange"),4==Xt(e)){e.h=!1;try{const i=e.Z();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===i){var a=String(e.D).match(ct)[1]||null;!a&&s.self&&s.self.location&&(a=s.self.location.protocol.slice(0,-1)),r=!Gt.test(a?a.toLowerCase():"")}n=r}if(n)ie(e,"complete"),ie(e,"success");else{e.m=6;try{var o=2<Xt(e)?e.g.statusText:""}catch(Ke){o=""}e.l=o+" ["+e.Z()+"]",Kt(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){Yt(e);const n=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ie(e,"ready");try{n.onreadystatechange=i}catch(ty){}}}function Yt(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function Xt(e){return e.g?e.g.readyState:0}function Jt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch($e){return null}}function Qt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Zt(e){this.Aa=0,this.i=[],this.j=new Ie,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qt("baseRetryDelayMs",5e3,e),this.cb=Qt("retryDelaySeedMs",1e4,e),this.Wa=Qt("forwardChannelMaxRetries",2,e),this.wa=Qt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new et(e&&e.concurrentRequestLimit),this.Da=new Dt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function $t(e){if(tn(e),3==e.G){var t=e.U++,n=dt(e.I);if(mt(n,"SID",e.K),mt(n,"RID",t),mt(n,"TYPE","terminate"),rn(e,n),(t=new Le(e,e.j,t)).L=2,t.v=ft(dt(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(t.v.toString(),"")}catch(We){}!n&&s.Image&&((new Image).src=t.v,n=!0),n||(t.g=_n(t.j,null),t.g.ea(t.v)),t.F=Date.now(),He(t)}fn(e)}function en(e){e.g&&(ln(e),e.g.cancel(),e.g=null)}function tn(e){en(e),e.u&&(s.clearTimeout(e.u),e.u=null),un(e),e.h.cancel(),e.s&&("number"===typeof e.s&&s.clearTimeout(e.s),e.s=null)}function nn(e){if(!tt(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||A(),R||(C(),R=!0),I.add(t,e),e.B=0}}function sn(e,t){var n;n=t?t.l:e.U++;const i=dt(e.I);mt(i,"SID",e.K),mt(i,"RID",n),mt(i,"AID",e.T),rn(e,i),e.m&&e.o&&Ft(i,e.m,e.o),n=new Le(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=an(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),st(e.h,n),Ve(n,i,t)}function rn(e,t){e.H&&y(e.H,function(e,n){mt(t,n,e)}),e.l&&ot({},function(e,n){mt(t,n,e)})}function an(e,t,n){n=Math.min(e.i.length,n);var i=e.l?l(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let a=!0;for(let o=0;o<n;o++){let n=s[o].g;const c=s[o].map;if(n-=t,0>n)t=Math.max(0,s[o].g-100),a=!1;else try{kt(c,e,"req"+n+"_")}catch(r){i&&i(c)}}if(a){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function on(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||A(),R||(C(),R=!0),I.add(t,e),e.v=0}}function cn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Re(l(e.Fa,e),pn(e,e.v)),e.v++,!0)}function ln(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function dn(e){e.g=new Le(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=dt(e.qa);mt(t,"RID","rpc"),mt(t,"SID",e.K),mt(t,"AID",e.T),mt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&mt(t,"TO",e.ja),mt(t,"TYPE","xmlhttp"),rn(e,t),e.m&&e.o&&Ft(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ft(dt(t)),n.m=null,n.P=!0,Fe(n,e)}function un(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function hn(e,t){var n=null;if(e.g==t){un(e),ln(e),e.g=null;var i=2}else{if(!it(e.h,t))return;n=t.D,rt(e.h,t),i=1}if(0!=e.G)if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;ie(i=Se(),new Ce(i,n)),nn(e)}else on(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&function(e,t){return!(nt(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Re(l(e.Ga,e,t),pn(e,e.B)),e.B++,!0))}(e,t)||2==i&&cn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),s){case 1:mn(e,5);break;case 4:mn(e,10);break;case 3:mn(e,6);break;default:mn(e,2)}}function pn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function mn(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),i=e.Xa;const t=!i;i=new lt(i||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||ut(i,"https"),ft(i),t?function(e,t){const n=new Ie;if(s.Image){const i=new Image;i.onload=d(Ot,n,"TestLoadImage: loaded",!0,t,i),i.onerror=d(Ot,n,"TestLoadImage: error",!1,t,i),i.onabort=d(Ot,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=d(Ot,n,"TestLoadImage: timeout",!1,t,i),s.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new Ie;const n=new AbortController,i=setTimeout(()=>{n.abort(),Ot(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?Ot(0,0,!0,t):Ot(0,0,!1,t)}).catch(()=>{clearTimeout(i),Ot(0,0,!1,t)})}(i.toString(),n)}else Ne(2);e.G=0,e.l&&e.l.sa(t),fn(e),tn(e)}function fn(e){if(e.G=0,e.ka=[],e.l){const t=at(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function gn(e,t,n){var i=n instanceof lt?dt(n):new lt(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ht(i,i.s);else{var r=s.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var a=new lt(null);i&&ut(a,i),t&&(a.g=t),r&&ht(a,r),n&&(a.l=n),i=a}return n=e.D,t=e.ya,n&&t&&mt(i,n,t),mt(i,"VER",e.la),rn(e,i),i}function _n(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Bt(new Pt({eb:n})):new Bt(e.pa)).Ha(e.J),t}function yn(){}function vn(){}function En(e,t){ne.call(this),this.g=new Zt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new xn(this)}function bn(e){ye.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Sn(){ve.call(this),this.status=1}function xn(e){this.g=e}(e=Bt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Oe.g(),this.v=this.o?fe(this.o):fe(Oe),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(ze){return void Ht(this,ze)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!==typeof i.keys||"function"!==typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=s.FormData&&e instanceof s.FormData,!(0<=Array.prototype.indexOf.call(Wt,t,void 0))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of n)this.g.setRequestHeader(s,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Yt(this),this.u=!0,this.g.send(e),this.u=!1}catch(ze){Ht(this,ze)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ie(this,"complete"),ie(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),Bt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?zt(this):this.bb())},e.bb=function(){zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Xt(this)?this.g.status:-1}catch(vt){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(vt){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Zt.prototype).la=8,e.G=1,e.connect=function(e,t,n,i){Ne(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=gn(this,null,this.W),nn(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new Le(this,this.j,e);let r=this.o;if(this.S&&(r?(r=v(r),b(r,this.S)):r=this.S),null!==this.m||this.O||(s.H=r,r=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"===typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=an(this,s,t),mt(n=dt(this.I),"RID",e),mt(n,"CVER",22),this.D&&mt(n,"X-HTTP-Session-Id",this.D),rn(this,n),r&&(this.O?t="headers="+encodeURIComponent(String(Vt(r)))+"&"+t:this.m&&Ft(n,this.m,r)),st(this.h,s),this.Ua&&mt(n,"TYPE","init"),this.P?(mt(n,"$req",t),mt(n,"SID","null"),s.T=!0,Ve(s,n,null)):Ve(s,n,t),this.G=2}}else 3==this.G&&(e?sn(this,e):0==this.i.length||tt(this.h)||sn(this))},e.Fa=function(){if(this.u=null,dn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Re(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ne(10),en(this),dn(this))},e.Za=function(){null!=this.C&&(this.C=null,en(this),cn(this),Ne(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=yn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},vn.prototype.g=function(e,t){return new En(e,t)},u(En,ne),En.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},En.prototype.close=function(){$t(this.g)},En.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ue(e),e=n);t.i.push(new Ze(t.Ya++,e)),3==t.G&&nn(t)},En.prototype.N=function(){this.g.l=null,delete this.j,$t(this.g),delete this.g,En.aa.N.call(this)},u(bn,ye),u(Sn,ve),u(xn,yn),xn.prototype.ua=function(){ie(this.g,"a")},xn.prototype.ta=function(e){ie(this.g,new bn(e))},xn.prototype.sa=function(e){ie(this.g,new Sn)},xn.prototype.ra=function(){ie(this.g,"b")},vn.prototype.createWebChannel=vn.prototype.g,En.prototype.send=En.prototype.o,En.prototype.open=En.prototype.m,En.prototype.close=En.prototype.close,Ja=Za.createWebChannelTransport=function(){return new vn},Xa=Za.getStatEventTarget=function(){return Se()},Ya=Za.Event=Ee,qa=Za.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},De.NO_ERROR=0,De.TIMEOUT=8,De.HTTP_ERROR=6,za=Za.ErrorCode=De,ke.COMPLETE="complete",Ka=Za.EventType=ke,ge.EventType=_e,_e.OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",ne.prototype.listen=ne.prototype.K,Ha=Za.WebChannel=ge,Wa=Za.FetchXmlHttpFactory=Pt,Bt.prototype.listenOnce=Bt.prototype.L,Bt.prototype.getLastError=Bt.prototype.Ka,Bt.prototype.getLastErrorCode=Bt.prototype.Ba,Bt.prototype.getStatus=Bt.prototype.Z,Bt.prototype.getResponseJson=Bt.prototype.Oa,Bt.prototype.getResponseText=Bt.prototype.oa,Bt.prototype.send=Bt.prototype.ea,Bt.prototype.setWithCredentials=Bt.prototype.Ha,Ga=Za.XhrIo=Bt}).apply("undefined"!==typeof Qa?Qa:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const $a="@firebase/firestore";class eo{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}eo.UNAUTHENTICATED=new eo(null),eo.GOOGLE_CREDENTIALS=new eo("google-credentials-uid"),eo.FIRST_PARTY=new eo("first-party-uid"),eo.MOCK_USER=new eo("mock-user");let to="10.12.1";const no=new en("@firebase/firestore");function io(){return no.logLevel}function so(e){if(no.logLevel<=Xt.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(oo);no.debug("Firestore (".concat(to,"): ").concat(e),...s)}}function ro(e){if(no.logLevel<=Xt.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(oo);no.error("Firestore (".concat(to,"): ").concat(e),...s)}}function ao(e){if(no.logLevel<=Xt.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(oo);no.warn("Firestore (".concat(to,"): ").concat(e),...s)}}function oo(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function co(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(to,") INTERNAL ASSERTION FAILED: ")+e;throw ro(t),new Error(t)}function lo(e,t){e||co()}function uo(e,t){return e}const ho={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class po extends kt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class mo{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class fo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class go{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(eo.UNAUTHENTICATED))}shutdown(){}}class _o{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class yo{constructor(e){this.t=e,this.currentUser=eo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new mo;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new mo,e.enqueueRetryable(()=>i(this.currentUser))};const r=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},a=e=>{so("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(so("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new mo)}},0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(so("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(lo("string"==typeof t.accessToken),new fo(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return lo(null===e||"string"==typeof e),new eo(e)}}class vo{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=eo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Eo{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new vo(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(eo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class bo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class So{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&so("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,so("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const i=e=>{so("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?i(e):so("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(lo("string"==typeof e.token),this.R=e.token,new bo(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function xo(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}class To{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=xo(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}}function wo(e,t){return e<t?-1:e>t?1:0}function No(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class Co{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new po(ho.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new po(ho.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new po(ho.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new po(ho.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Co.fromMillis(Date.now())}static fromDate(e){return Co.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Co(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?wo(this.nanoseconds,e.nanoseconds):wo(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ro{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ro(e)}static min(){return new Ro(new Co(0,0))}static max(){return new Ro(new Co(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Io{constructor(e,t,n){void 0===t?t=0:t>e.length&&co(),void 0===n?n=e.length-t:n>e.length-t&&co(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Io.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Io?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),s=t.get(i);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ao extends Io{construct(e,t,n){return new Ao(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n){if(s.indexOf("//")>=0)throw new po(ho.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push(...s.split("/").filter(e=>e.length>0))}return new Ao(e)}static emptyPath(){return new Ao([])}}const Oo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Do extends Io{construct(e,t,n){return new Do(e,t,n)}static isValidIdentifier(e){return Oo.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Do.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Do(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new po(ho.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new po(ho.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new po(ho.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new po(ho.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Do(t)}static emptyPath(){return new Do([])}}class ko{constructor(e){this.path=e}static fromPath(e){return new ko(Ao.fromString(e))}static fromName(e){return new ko(Ao.fromString(e).popFirst(5))}static empty(){return new ko(Ao.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ao.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ao.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ko(new Ao(e.slice()))}}class Po{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}Po.UNKNOWN_ID=-1;function Lo(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,s=Ro.fromTimestamp(1e9===i?new Co(n+1,0):new Co(n,i));return new Mo(s,ko.empty(),t)}function jo(e){return new Mo(e.readTime,e.key,-1)}class Mo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Mo(Ro.min(),ko.empty(),-1)}static max(){return new Mo(Ro.max(),ko.empty(),-1)}}function Uo(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ko.comparator(e.documentKey,t.documentKey),0!==n?n:wo(e.largestBatchId,t.largestBatchId))}const Vo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Bo(e){if(e.code!==ho.FAILED_PRECONDITION||e.message!==Vo)throw e;so("LocalStore","Unexpectedly lost primary lease")}class Go{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&co(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Go((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Go?t:Go.resolve(t)}catch(e){return Go.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Go.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Go.reject(t)}static resolve(e){return new Go((t,n)=>{t(e)})}static reject(e){return new Go((t,n)=>{n(e)})}static waitFor(e){return new Go((t,n)=>{let i=0,s=0,r=!1;e.forEach(e=>{++i,e.next(()=>{++s,r&&s===i&&t()},e=>n(e))}),r=!0,s===i&&t()})}static or(e){let t=Go.resolve(!1);for(const n of e)t=t.next(e=>e?Go.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new Go((n,i)=>{const s=e.length,r=new Array(s);let a=0;for(let o=0;o<s;o++){const c=o;t(e[c]).next(e=>{r[c]=e,++a,a===s&&n(r)},e=>i(e))}})}static doWhile(e,t){return new Go((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}function Wo(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Ho(e){return"IndexedDbTransactionError"===e.name}class Ko{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function zo(e){return null==e}function qo(e){return 0===e&&1/e==-1/0}function Yo(e){return"number"==typeof e&&Number.isInteger(e)&&!qo(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}Ko.oe=-1;const Xo=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Jo=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Qo=Jo;function Zo(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function $o(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ec(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tc{constructor(e,t){this.comparator=e,this.root=t||ic.EMPTY}insert(e,t){return new tc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ic.BLACK,null,null))}remove(e){return new tc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ic.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nc(this.root,e,this.comparator,!1)}getReverseIterator(){return new nc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nc(this.root,e,this.comparator,!0)}}class nc{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ic{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:ic.RED,this.left=null!=i?i:ic.EMPTY,this.right=null!=s?s:ic.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new ic(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ic.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return ic.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ic.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ic.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw co();if(this.right.isRed())throw co();const e=this.left.check();if(e!==this.right.check())throw co();return e+(this.isRed()?0:1)}}ic.EMPTY=null,ic.RED=!0,ic.BLACK=!1,ic.EMPTY=new class{constructor(){this.size=0}get key(){throw co()}get value(){throw co()}get color(){throw co()}get left(){throw co()}get right(){throw co()}copy(e,t,n,i,s){return this}insert(e,t,n){return new ic(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class sc{constructor(e){this.comparator=e,this.data=new tc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rc(this.data.getIterator())}getIteratorFrom(e){return new rc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sc))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new sc(this.comparator);return t.data=e,t}}class rc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ac{constructor(e){this.fields=e,e.sort(Do.comparator)}static empty(){return new ac([])}unionWith(e){let t=new sc(Do.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ac(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return No(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class oc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class cc{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new oc("Invalid base64 string: "+e):e}}(e);return new cc(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new cc(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return wo(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}cc.EMPTY_BYTE_STRING=new cc("");const lc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dc(e){if(lo(!!e),"string"==typeof e){let t=0;const n=lc.exec(e);if(lo(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:uc(e.seconds),nanos:uc(e.nanos)}}function uc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function hc(e){return"string"==typeof e?cc.fromBase64String(e):cc.fromUint8Array(e)}function pc(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function mc(e){const t=e.mapValue.fields.__previous_value__;return pc(t)?mc(t):t}function fc(e){const t=dc(e.mapValue.fields.__local_write_time__.timestampValue);return new Co(t.seconds,t.nanos)}class gc{constructor(e,t,n,i,s,r,a,o,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=c}}class _c{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new _c("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof _c&&e.projectId===this.projectId&&e.database===this.database}}const yc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function vc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?pc(e)?4:kc(e)?9007199254740991:10:co()}function Ec(e,t){if(e===t)return!0;const n=vc(e);if(n!==vc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return fc(e).isEqual(fc(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=dc(e.timestampValue),i=dc(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return hc(e.bytesValue).isEqual(hc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return uc(e.geoPointValue.latitude)===uc(t.geoPointValue.latitude)&&uc(e.geoPointValue.longitude)===uc(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return uc(e.integerValue)===uc(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=uc(e.doubleValue),i=uc(t.doubleValue);return n===i?qo(n)===qo(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return No(e.arrayValue.values||[],t.arrayValue.values||[],Ec);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Zo(n)!==Zo(i))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===i[s]||!Ec(n[s],i[s])))return!1;return!0}(e,t);default:return co()}}function bc(e,t){return void 0!==(e.values||[]).find(e=>Ec(e,t))}function Sc(e,t){if(e===t)return 0;const n=vc(e),i=vc(t);if(n!==i)return wo(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return wo(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=uc(e.integerValue||e.doubleValue),i=uc(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return xc(e.timestampValue,t.timestampValue);case 4:return xc(fc(e),fc(t));case 5:return wo(e.stringValue,t.stringValue);case 6:return function(e,t){const n=hc(e),i=hc(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let s=0;s<n.length&&s<i.length;s++){const e=wo(n[s],i[s]);if(0!==e)return e}return wo(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=wo(uc(e.latitude),uc(t.latitude));return 0!==n?n:wo(uc(e.longitude),uc(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let s=0;s<n.length&&s<i.length;++s){const e=Sc(n[s],i[s]);if(e)return e}return wo(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===yc.mapValue&&t===yc.mapValue)return 0;if(e===yc.mapValue)return 1;if(t===yc.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let a=0;a<i.length&&a<r.length;++a){const e=wo(i[a],r[a]);if(0!==e)return e;const t=Sc(n[i[a]],s[r[a]]);if(0!==t)return t}return wo(i.length,r.length)}(e.mapValue,t.mapValue);default:throw co()}}function xc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return wo(e,t);const n=dc(e),i=dc(t),s=wo(n.seconds,i.seconds);return 0!==s?s:wo(n.nanos,i.nanos)}function Tc(e){return wc(e)}function wc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=dc(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return hc(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ko.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=wc(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+="".concat(s,":").concat(wc(e.fields[s]));return n+"}"}(e.mapValue):co()}function Nc(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Cc(e){return!!e&&"integerValue"in e}function Rc(e){return!!e&&"arrayValue"in e}function Ic(e){return!!e&&"nullValue"in e}function Ac(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Oc(e){return!!e&&"mapValue"in e}function Dc(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return $o(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Dc(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Dc(e.arrayValue.values[n]);return t}return Object.assign({},e)}function kc(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Pc{constructor(e){this.value=e}static empty(){return new Pc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Oc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Dc(t)}setAll(e){let t=Do.emptyPath(),n={},i=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=Dc(e):i.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Oc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ec(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Oc(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){$o(t,(t,n)=>e[t]=n);for(const i of n)delete e[i]}clone(){return new Pc(Dc(this.value))}}function Lc(e){const t=[];return $o(e.fields,(e,n)=>{const i=new Do([e]);if(Oc(n)){const e=Lc(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)}),new ac(t)}class jc{constructor(e,t,n,i,s,r,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=a}static newInvalidDocument(e){return new jc(e,0,Ro.min(),Ro.min(),Ro.min(),Pc.empty(),0)}static newFoundDocument(e,t,n,i){return new jc(e,1,t,Ro.min(),n,i,0)}static newNoDocument(e,t){return new jc(e,2,t,Ro.min(),Ro.min(),Pc.empty(),0)}static newUnknownDocument(e,t){return new jc(e,3,t,Ro.min(),Ro.min(),Pc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ro.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ro.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof jc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new jc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class Mc{constructor(e,t){this.position=e,this.inclusive=t}}function Uc(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],a=e.position[s];if(i=r.field.isKeyField()?ko.comparator(ko.fromName(a.referenceValue),n.key):Sc(a,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function Vc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ec(e.position[n],t.position[n]))return!1;return!0}class Fc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Bc(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Gc{}class Wc extends Gc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Qc(e,t,n):"array-contains"===t?new tl(e,n):"in"===t?new nl(e,n):"not-in"===t?new il(e,n):"array-contains-any"===t?new sl(e,n):new Wc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Zc(e,n):new $c(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Sc(t,this.value)):null!==t&&vc(this.value)===vc(t)&&this.matchesComparison(Sc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return co()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Hc extends Gc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Hc(e,t)}matches(e){return Kc(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Kc(e){return"and"===e.op}function zc(e){return qc(e)&&Kc(e)}function qc(e){for(const t of e.filters)if(t instanceof Hc)return!1;return!0}function Yc(e){if(e instanceof Wc)return e.field.canonicalString()+e.op.toString()+Tc(e.value);if(zc(e))return e.filters.map(e=>Yc(e)).join(",");{const t=e.filters.map(e=>Yc(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Xc(e,t){return e instanceof Wc?function(e,t){return t instanceof Wc&&e.op===t.op&&e.field.isEqual(t.field)&&Ec(e.value,t.value)}(e,t):e instanceof Hc?function(e,t){return t instanceof Hc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,i)=>e&&Xc(n,t.filters[i]),!0)}(e,t):void co()}function Jc(e){return e instanceof Wc?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Tc(e.value))}(e):e instanceof Hc?function(e){return e.op.toString()+" {"+e.getFilters().map(Jc).join(" ,")+"}"}(e):"Filter"}class Qc extends Wc{constructor(e,t,n){super(e,t,n),this.key=ko.fromName(n.referenceValue)}matches(e){const t=ko.comparator(e.key,this.key);return this.matchesComparison(t)}}class Zc extends Wc{constructor(e,t){super(e,"in",t),this.keys=el("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class $c extends Wc{constructor(e,t){super(e,"not-in",t),this.keys=el("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function el(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>ko.fromName(e.referenceValue))}class tl extends Wc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Rc(t)&&bc(t.arrayValue,this.value)}}class nl extends Wc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&bc(this.value.arrayValue,t)}}class il extends Wc{constructor(e,t){super(e,"not-in",t)}matches(e){if(bc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!bc(this.value.arrayValue,t)}}class sl extends Wc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Rc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>bc(this.value.arrayValue,e))}}class rl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=a,this.ue=null}}function al(e){return new rl(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function ol(e){const t=uo(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Yc(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),zo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Tc(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Tc(e)).join(",")),t.ue=e}return t.ue}function cl(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Bc(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Xc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Vc(e.startAt,t.startAt)&&Vc(e.endAt,t.endAt)}function ll(e){return ko.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class dl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function ul(e,t,n,i,s,r,a,o){return new dl(e,t,n,i,s,r,a,o)}function hl(e){return new dl(e)}function pl(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ml(e){return null!==e.collectionGroup}function fl(e){const t=uo(e);if(null===t.ce){t.ce=[];const e=new Set;for(const s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",i=function(e){let t=new sc(Do.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);i.forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.ce.push(new Fc(i,n))}),e.has(Do.keyField().canonicalString())||t.ce.push(new Fc(Do.keyField(),n))}return t.ce}function gl(e){const t=uo(e);return t.le||(t.le=_l(t,fl(e))),t.le}function _l(e,t){if("F"===e.limitType)return al(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Fc(e.field,t)});const n=e.endAt?new Mc(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Mc(e.startAt.position,e.startAt.inclusive):null;return al(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}function yl(e,t){const n=e.filters.concat([t]);return new dl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function vl(e,t,n){return new dl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function El(e,t){return cl(gl(e),gl(t))&&e.limitType===t.limitType}function bl(e){return"".concat(ol(gl(e)),"|lt:").concat(e.limitType)}function Sl(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>Jc(e)).join(", "),"]")),zo(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Tc(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Tc(e)).join(",")),"Target(".concat(t,")")}(gl(e)),"; limitType=").concat(e.limitType,")")}function xl(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ko.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of fl(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Uc(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,fl(e),t))&&!(e.endAt&&!function(e,t,n){const i=Uc(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,fl(e),t))}(e,t)}function Tl(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function wl(e){return(t,n)=>{let i=!1;for(const s of fl(e)){const e=Nl(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}function Nl(e,t,n){const i=e.field.isKeyField()?ko.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?Sc(i,s):co()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return co()}}class Cl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){$o(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return ec(this.inner)}size(){return this.innerSize}}const Rl=new tc(ko.comparator);function Il(){return Rl}const Al=new tc(ko.comparator);function Ol(){let e=Al;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.insert(s.key,s);return e}function Dl(e){let t=Al;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function kl(){return Ll()}function Pl(){return Ll()}function Ll(){return new Cl(e=>e.toString(),(e,t)=>e.isEqual(t))}const jl=new tc(ko.comparator),Ml=new sc(ko.comparator);function Ul(){let e=Ml;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.add(s);return e}const Vl=new sc(wo);function Fl(){return Vl}function Bl(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qo(t)?"-0":t}}function Gl(e){return{integerValue:""+e}}function Wl(e,t){return Yo(t)?Gl(t):Bl(e,t)}class Hl{constructor(){this._=void 0}}function Kl(e,t,n){return e instanceof Yl?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&pc(t)&&(t=mc(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Xl?Jl(e,t):e instanceof Ql?Zl(e,t):function(e,t){const n=ql(e,t),i=ed(n)+ed(e.Pe);return Cc(n)&&Cc(e.Pe)?Gl(i):Bl(e.serializer,i)}(e,t)}function zl(e,t,n){return e instanceof Xl?Jl(e,t):e instanceof Ql?Zl(e,t):n}function ql(e,t){return e instanceof $l?function(e){return Cc(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Yl extends Hl{}class Xl extends Hl{constructor(e){super(),this.elements=e}}function Jl(e,t){const n=td(t);for(const i of e.elements)n.some(e=>Ec(e,i))||n.push(i);return{arrayValue:{values:n}}}class Ql extends Hl{constructor(e){super(),this.elements=e}}function Zl(e,t){let n=td(t);for(const i of e.elements)n=n.filter(e=>!Ec(e,i));return{arrayValue:{values:n}}}class $l extends Hl{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function ed(e){return uc(e.integerValue||e.doubleValue)}function td(e){return Rc(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nd{constructor(e,t){this.field=e,this.transform=t}}class id{constructor(e,t){this.version=e,this.transformResults=t}}class sd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sd}static exists(e){return new sd(void 0,e)}static updateTime(e){return new sd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rd(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ad{}function od(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new _d(e.key,sd.none()):new hd(e.key,e.data,sd.none());{const n=e.data,i=Pc.empty();let s=new sc(Do.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),s=s.add(e)}return new pd(e.key,i,new ac(s.toArray()),sd.none())}}function cd(e,t,n){e instanceof hd?function(e,t,n){const i=e.value.clone(),s=fd(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof pd?function(e,t,n){if(!rd(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=fd(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(md(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ld(e,t,n,i){return e instanceof hd?function(e,t,n,i){if(!rd(e.precondition,t))return n;const s=e.value.clone(),r=gd(e.fieldTransforms,i,t);return s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,i):e instanceof pd?function(e,t,n,i){if(!rd(e.precondition,t))return n;const s=gd(e.fieldTransforms,i,t),r=t.data;return r.setAll(md(e)),r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):function(e,t,n){return rd(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function dd(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),s=ql(i.transform,e||null);null!=s&&(null===n&&(n=Pc.empty()),n.set(i.field,s))}return n||null}function ud(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&No(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Xl&&t instanceof Xl||e instanceof Ql&&t instanceof Ql?No(e.elements,t.elements,Ec):e instanceof $l&&t instanceof $l?Ec(e.Pe,t.Pe):e instanceof Yl&&t instanceof Yl}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class hd extends ad{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class pd extends ad{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function md(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}}),t}function fd(e,t,n){const i=new Map;lo(e.length===n.length);for(let s=0;s<n.length;s++){const r=e[s],a=r.transform,o=t.data.field(r.field);i.set(r.field,zl(a,o,n[s]))}return i}function gd(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,Kl(e,r,t))}return i}class _d extends ad{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class yd extends ad{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class vd{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&cd(t,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ld(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ld(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Pl();return this.mutations.forEach(i=>{const s=e.get(i.key),r=s.overlayedDocument;let a=this.applyToLocalView(r,s.mutatedFields);a=t.has(i.key)?null:a;const o=od(r,a);null!==o&&n.set(i.key,o),r.isValidDocument()||r.convertToNoDocument(Ro.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ul())}isEqual(e){return this.batchId===e.batchId&&No(this.mutations,e.mutations,(e,t)=>ud(e,t))&&No(this.baseMutations,e.baseMutations,(e,t)=>ud(e,t))}}class Ed{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){lo(e.mutations.length===n.length);let i=jl;const s=e.mutations;for(let r=0;r<s.length;r++)i=i.insert(s[r].key,n[r].version);return new Ed(e,t,n,i)}}class bd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Sd{constructor(e,t){this.count=e,this.unchangedNames=t}}var xd,Td;function wd(e){switch(e){default:return co();case ho.CANCELLED:case ho.UNKNOWN:case ho.DEADLINE_EXCEEDED:case ho.RESOURCE_EXHAUSTED:case ho.INTERNAL:case ho.UNAVAILABLE:case ho.UNAUTHENTICATED:return!1;case ho.INVALID_ARGUMENT:case ho.NOT_FOUND:case ho.ALREADY_EXISTS:case ho.PERMISSION_DENIED:case ho.FAILED_PRECONDITION:case ho.ABORTED:case ho.OUT_OF_RANGE:case ho.UNIMPLEMENTED:case ho.DATA_LOSS:return!0}}function Nd(e){if(void 0===e)return ro("GRPC error has no .code"),ho.UNKNOWN;switch(e){case xd.OK:return ho.OK;case xd.CANCELLED:return ho.CANCELLED;case xd.UNKNOWN:return ho.UNKNOWN;case xd.DEADLINE_EXCEEDED:return ho.DEADLINE_EXCEEDED;case xd.RESOURCE_EXHAUSTED:return ho.RESOURCE_EXHAUSTED;case xd.INTERNAL:return ho.INTERNAL;case xd.UNAVAILABLE:return ho.UNAVAILABLE;case xd.UNAUTHENTICATED:return ho.UNAUTHENTICATED;case xd.INVALID_ARGUMENT:return ho.INVALID_ARGUMENT;case xd.NOT_FOUND:return ho.NOT_FOUND;case xd.ALREADY_EXISTS:return ho.ALREADY_EXISTS;case xd.PERMISSION_DENIED:return ho.PERMISSION_DENIED;case xd.FAILED_PRECONDITION:return ho.FAILED_PRECONDITION;case xd.ABORTED:return ho.ABORTED;case xd.OUT_OF_RANGE:return ho.OUT_OF_RANGE;case xd.UNIMPLEMENTED:return ho.UNIMPLEMENTED;case xd.DATA_LOSS:return ho.DATA_LOSS;default:return co()}}(Td=xd||(xd={}))[Td.OK=0]="OK",Td[Td.CANCELLED=1]="CANCELLED",Td[Td.UNKNOWN=2]="UNKNOWN",Td[Td.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Td[Td.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Td[Td.NOT_FOUND=5]="NOT_FOUND",Td[Td.ALREADY_EXISTS=6]="ALREADY_EXISTS",Td[Td.PERMISSION_DENIED=7]="PERMISSION_DENIED",Td[Td.UNAUTHENTICATED=16]="UNAUTHENTICATED",Td[Td.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Td[Td.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Td[Td.ABORTED=10]="ABORTED",Td[Td.OUT_OF_RANGE=11]="OUT_OF_RANGE",Td[Td.UNIMPLEMENTED=12]="UNIMPLEMENTED",Td[Td.INTERNAL=13]="INTERNAL",Td[Td.UNAVAILABLE=14]="UNAVAILABLE",Td[Td.DATA_LOSS=15]="DATA_LOSS";let Cd=null;function Rd(){return new TextEncoder}const Id=new Ua([4294967295,4294967295],0);function Ad(e){const t=Rd().encode(e),n=new Va;return n.update(t),new Uint8Array(n.digest())}function Od(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new Ua([n,i],0),new Ua([s,r],0)]}class Dd{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new kd("Invalid padding: ".concat(t));if(n<0)throw new kd("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new kd("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new kd("Invalid padding when bitmap length is 0: ".concat(t));this.Ie=8*e.length-t,this.Te=Ua.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Ua.fromNumber(n)));return 1===i.compare(Id)&&(i=new Ua([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Ad(e),[n,i]=Od(t);for(let s=0;s<this.hashCount;s++){const e=this.Ee(n,i,s);if(!this.de(e))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),r=new Dd(s,i,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.Ie)return;const t=Ad(e),[n,i]=Od(t);for(let s=0;s<this.hashCount;s++){const e=this.Ee(n,i,s);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class kd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Pd{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Ld.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Pd(Ro.min(),i,new tc(wo),Il(),Ul())}}class Ld{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ld(n,t,Ul(),Ul(),Ul())}}class jd{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class Md{constructor(e,t){this.targetId=e,this.me=t}}class Ud{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cc.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Vd{constructor(){this.fe=0,this.ge=Gd(),this.pe=cc.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=Ul(),t=Ul(),n=Ul();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:co()}}),new Ld(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=Gd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,lo(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Fd{constructor(e){this.Le=e,this.Be=new Map,this.ke=Il(),this.qe=Bd(),this.Qe=new tc(wo)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:co()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(ll(s))if(0===n){const e=new ko(s.path);this.Ue(t,e,jc.newNoDocument(e,Ro.min()))}else lo(1===n);else{const i=this.Ye(t);if(i!==n){const n=this.Ze(e),s=n?this.Xe(n,e,i):1;if(0!==s){this.je(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==Cd||Cd.et(function(e,t,n,i,s){var r,a,o,c,l,d;const u={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(u.bloomFilter={applied:0===s,hashCount:null!==(r=null==h?void 0:h.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(c=null===(o=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==c?c:0,padding:null!==(d=null===(l=null==h?void 0:h.bits)||void 0===l?void 0:l.padding)&&void 0!==d?d:0,mightContain:e=>{var t;return null!==(t=null==i?void 0:i.mightContain(e))&&void 0!==t&&t}}),u}(i,e.me,this.Le.tt(),n,s))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let r,a;try{r=hc(n).toUint8Array()}catch(e){if(e instanceof oc)return ao("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new Dd(r,i,s)}catch(e){return ao(e instanceof kd?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(n=>{const s=this.Le.tt(),r="projects/".concat(s.projectId,"/databases/").concat(s.database,"/documents/").concat(n.path.canonicalString());e.mightContain(r)||(this.Ue(t,n,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((n,i)=>{const s=this.Je(i);if(s){if(n.current&&ll(s.target)){const t=new ko(s.target.path);null!==this.ke.get(t)||this.it(i,t)||this.Ue(i,t,jc.newNoDocument(t,e))}n.be&&(t.set(i,n.Ce()),n.ve())}});let n=Ul();this.qe.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));const i=new Pd(e,t,this.Qe,this.ke,n);return this.ke=Il(),this.qe=Bd(),this.Qe=new tc(wo),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Vd,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new sc(wo),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||so("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Vd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Bd(){return new tc(ko.comparator)}function Gd(){return new tc(ko.comparator)}const Wd={asc:"ASCENDING",desc:"DESCENDING"},Hd={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kd={and:"AND",or:"OR"};class zd{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function qd(e,t){return e.useProto3Json||zo(t)?t:{value:t}}function Yd(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Xd(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Jd(e,t){return Yd(e,t.toTimestamp())}function Qd(e){return lo(!!e),Ro.fromTimestamp(function(e){const t=dc(e);return new Co(t.seconds,t.nanos)}(e))}function Zd(e,t){return $d(e,t).canonicalString()}function $d(e,t){const n=function(e){return new Ao(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function eu(e){const t=Ao.fromString(e);return lo(Eu(t)),t}function tu(e,t){return Zd(e.databaseId,t.path)}function nu(e,t){const n=eu(t);if(n.get(1)!==e.databaseId.projectId)throw new po(ho.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new po(ho.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ko(au(n))}function iu(e,t){return Zd(e.databaseId,t)}function su(e){const t=eu(e);return 4===t.length?Ao.emptyPath():au(t)}function ru(e){return new Ao(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function au(e){return lo(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ou(e,t,n){return{name:tu(e,t),fields:n.value.mapValue.fields}}function cu(e,t){let n;if(t instanceof hd)n={update:ou(e,t.key,t.value)};else if(t instanceof _d)n={delete:tu(e,t.key)};else if(t instanceof pd)n={update:ou(e,t.key,t.data),updateMask:vu(t.fieldMask)};else{if(!(t instanceof yd))return co();n={verify:tu(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Yl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Xl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ql)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof $l)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw co()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Jd(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:co()}(e,t.precondition)),n}function lu(e,t){return{documents:[iu(e,t.path)]}}function du(e,t){const n={structuredQuery:{}},i=t.path;let s;null!==t.collectionGroup?(s=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=iu(e,s);const r=function(e){if(0!==e.length)return yu(Hc.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:gu(e.field),direction:pu(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=qd(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:s}}function uu(e){let t=su(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){lo(1===i);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=hu(e);return t instanceof Hc&&zc(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new Fc(_u(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,zo(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Mc(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new Mc(n,t)}(n.endAt)),ul(t,s,a,r,o,"F",c,l)}function hu(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=_u(e.unaryFilter.field);return Wc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=_u(e.unaryFilter.field);return Wc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=_u(e.unaryFilter.field);return Wc.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=_u(e.unaryFilter.field);return Wc.create(s,"!=",{nullValue:"NULL_VALUE"});default:return co()}}(e):void 0!==e.fieldFilter?function(e){return Wc.create(_u(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return co()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Hc.create(e.compositeFilter.filters.map(e=>hu(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return co()}}(e.compositeFilter.op))}(e):co()}function pu(e){return Wd[e]}function mu(e){return Hd[e]}function fu(e){return Kd[e]}function gu(e){return{fieldPath:e.canonicalString()}}function _u(e){return Do.fromServerFormat(e.fieldPath)}function yu(e){return e instanceof Wc?function(e){if("=="===e.op){if(Ac(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NAN"}};if(Ic(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ac(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NOT_NAN"}};if(Ic(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gu(e.field),op:mu(e.op),value:e.value}}}(e):e instanceof Hc?function(e){const t=e.getFilters().map(e=>yu(e));return 1===t.length?t[0]:{compositeFilter:{op:fu(e.op),filters:t}}}(e):co()}function vu(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Eu(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class bu{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ro.min(),r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ro.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:cc.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new bu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new bu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Su{constructor(e){this.ct=e}}function xu(e){const t=uu({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?vl(t,t.limit,"L"):t}class Tu{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(uc(e.integerValue));else if("doubleValue"in e){const n=uc(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),qo(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=dc(n)),t.At("".concat(n.seconds||"")),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(hc(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?kc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):co()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const i of n)this.It(i,t)}gt(e,t){this.Et(t,37),ko.fromName(e).path.forEach(e=>{this.Et(t,60),this.St(e,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}Tu.bt=new Tu;class wu{constructor(){this._n=new Nu}addToCollectionParentIndex(e,t){return this._n.add(t),Go.resolve()}getCollectionParents(e,t){return Go.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Go.resolve()}deleteFieldIndex(e,t){return Go.resolve()}deleteAllFieldIndexes(e){return Go.resolve()}createTargetIndexes(e,t){return Go.resolve()}getDocumentsMatchingTarget(e,t){return Go.resolve(null)}getIndexType(e,t){return Go.resolve(0)}getFieldIndexes(e,t){return Go.resolve([])}getNextCollectionGroupToUpdate(e){return Go.resolve(null)}getMinOffset(e,t){return Go.resolve(Mo.min())}getMinOffsetFromCollectionGroup(e,t){return Go.resolve(Mo.min())}updateCollectionGroup(e,t,n){return Go.resolve()}updateIndexEntries(e,t){return Go.resolve()}}class Nu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new sc(Ao.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new sc(Ao.comparator)).toArray()}}new Uint8Array(0);class Cu{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Cu(e,Cu.DEFAULT_COLLECTION_PERCENTILE,Cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Cu.DEFAULT_COLLECTION_PERCENTILE=10,Cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Cu.DEFAULT=new Cu(41943040,Cu.DEFAULT_COLLECTION_PERCENTILE,Cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Cu.DISABLED=new Cu(-1,0,0);class Ru{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Ru(0)}static Ln(){return new Ru(-1)}}class Iu{constructor(){this.changes=new Cl(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,jc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Go.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Au{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ou{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ld(n.mutation,e,ac.empty(),Co.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Ul()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ul();const i=kl();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=Ol();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=kl();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ul()))}populateOverlays(e,t,n){const i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let s=Il();const r=Ll(),a=Ll();return t.forEach((e,t)=>{const a=n.get(t.key);i.has(t.key)&&(void 0===a||a.mutation instanceof pd)?s=s.insert(t.key,t):void 0!==a?(r.set(t.key,a.mutation.getFieldMask()),ld(a.mutation,t,a.mutation.getFieldMask(),Co.now())):r.set(t.key,ac.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>r.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new Au(t,null!==(n=r.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=Ll();let i=new tc((e,t)=>e-t),s=Ul();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const r=t.get(e);if(null===r)return;let a=n.get(e)||ac.empty();a=s.applyToLocalView(r,a),n.set(e,a);const o=(i.get(s.batchId)||Ul()).add(e);i=i.insert(s.batchId,o)})}).next(()=>{const r=[],a=i.getReverseIterator();for(;a.hasNext();){const i=a.getNext(),o=i.key,c=i.value,l=Pl();c.forEach(e=>{if(!s.has(e)){const i=od(t.get(e),n.get(e));null!==i&&l.set(e,i),s=s.add(e)}}),r.push(this.documentOverlayCache.saveOverlays(e,o,l))}return Go.waitFor(r)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return function(e){return ko.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ml(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):Go.resolve(kl());let a=-1,o=s;return r.next(t=>Go.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),s.get(t)?Go.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,o,t,Ul())).next(e=>({batchId:a,changes:Dl(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ko(t)).next(e=>{let t=Ol();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let r=Ol();return this.indexManager.getCollectionParents(e,s).next(a=>Go.forEach(a,a=>{const o=function(e,t){return new dl(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(s));return this.getDocumentsMatchingCollectionQuery(e,o,n,i).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(e=>{s.forEach((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,jc.newInvalidDocument(i)))});let n=Ol();return e.forEach((e,i)=>{const r=s.get(e);void 0!==r&&ld(r.mutation,i,ac.empty(),Co.now()),xl(t,i)&&(n=n.insert(e,i))}),n})}}class Du{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Go.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Qd(e.createTime)}}(t)),Go.resolve()}getNamedQuery(e,t){return Go.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:xu(e.bundledQuery),readTime:Qd(e.readTime)}}(t)),Go.resolve()}}class ku{constructor(){this.overlays=new tc(ko.comparator),this.hr=new Map}getOverlay(e,t){return Go.resolve(this.overlays.get(t))}getOverlays(e,t){const n=kl();return Go.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.ht(e,t,i)}),Go.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.hr.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.hr.delete(n)),Go.resolve()}getOverlaysForCollection(e,t,n){const i=kl(),s=t.length+1,r=new ko(t.child("")),a=this.overlays.getIteratorFrom(r);for(;a.hasNext();){const e=a.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return Go.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new tc((e,t)=>e-t);const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=kl(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=kl(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=i)););return Go.resolve(a)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new bd(t,n));let s=this.hr.get(t);void 0===s&&(s=Ul(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}}class Pu{constructor(){this.Pr=new sc(Lu.Ir),this.Tr=new sc(Lu.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Lu(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Ar(new Lu(e,t))}Rr(e,t){e.forEach(e=>this.removeReference(e,t))}Vr(e){const t=new ko(new Ao([])),n=new Lu(t,e),i=new Lu(t,e+1),s=[];return this.Tr.forEachInRange([n,i],e=>{this.Ar(e),s.push(e.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new ko(new Ao([])),n=new Lu(t,e),i=new Lu(t,e+1);let s=Ul();return this.Tr.forEachInRange([n,i],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new Lu(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Lu{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return ko.comparator(e.key,t.key)||wo(e.pr,t.pr)}static Er(e,t){return wo(e.pr,t.pr)||ko.comparator(e.key,t.key)}}class ju{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new sc(Lu.Ir)}checkEmpty(e){return Go.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new vd(s,t,n,i);this.mutationQueue.push(r);for(const a of i)this.wr=this.wr.add(new Lu(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Go.resolve(r)}lookupMutationBatch(e,t){return Go.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.br(n),s=i<0?0:i;return Go.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Go.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Go.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Lu(t,0),i=new Lu(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],e=>{const t=this.Sr(e.pr);s.push(t)}),Go.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sc(wo);return t.forEach(e=>{const t=new Lu(e,0),i=new Lu(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,i],e=>{n=n.add(e.pr)})}),Go.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;ko.isDocumentKey(s)||(s=s.child(""));const r=new Lu(new ko(s),0);let a=new sc(wo);return this.wr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(a=a.add(e.pr)),!0)},r),Go.resolve(this.Dr(a))}Dr(e){const t=[];return e.forEach(e=>{const n=this.Sr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){lo(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Go.forEach(t.mutations,i=>{const s=new Lu(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){const n=new Lu(t,0),i=this.wr.firstAfterOrEqual(n);return Go.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Go.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Mu{constructor(e){this.vr=e,this.docs=new tc(ko.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Go.resolve(n?n.document.mutableCopy():jc.newInvalidDocument(t))}getEntries(e,t){let n=Il();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():jc.newInvalidDocument(e))}),Go.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Il();const r=t.path,a=new ko(r.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||Uo(jo(a),n)<=0||(i.has(a.key)||xl(t,a))&&(s=s.insert(a.key,a.mutableCopy()))}return Go.resolve(s)}getAllFromCollectionGroup(e,t,n,i){co()}Fr(e,t){return Go.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Uu(this)}getSize(e){return Go.resolve(this.size)}}class Uu extends Iu{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(n)}),Go.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Vu{constructor(e){this.persistence=e,this.Mr=new Cl(e=>ol(e),cl),this.lastRemoteSnapshotVersion=Ro.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Pu,this.targetCount=0,this.Lr=Ru.Nn()}forEachTarget(e,t){return this.Mr.forEach((e,n)=>t(n)),Go.resolve()}getLastRemoteSnapshotVersion(e){return Go.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Go.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),Go.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Go.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new Ru(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Go.resolve()}updateTargetData(e,t){return this.qn(t),Go.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Go.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Mr.forEach((r,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Mr.delete(r),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),Go.waitFor(s).next(()=>i)}getTargetCount(e){return Go.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Go.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Go.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(t=>{s.push(i.markPotentiallyOrphaned(e,t))}),Go.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Go.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Go.resolve(n)}containsKey(e,t){return Go.resolve(this.Nr.containsKey(t))}}class Fu{constructor(e,t){this.Br={},this.overlays={},this.kr=new Ko(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Vu(this),this.indexManager=new wu,this.remoteDocumentCache=function(e){return new Mu(e)}(e=>this.referenceDelegate.Kr(e)),this.serializer=new Su(t),this.$r=new Du(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ku,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new ju(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){so("MemoryPersistence","Starting transaction:",e);const i=new Bu(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(e=>this.referenceDelegate.Wr(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Gr(e,t){return Go.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}}class Bu extends Fo{constructor(e){super(),this.currentSequenceNumber=e}}class Gu{constructor(e){this.persistence=e,this.zr=new Pu,this.jr=null}static Hr(e){return new Gu(e)}get Jr(){if(this.jr)return this.jr;throw co()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Go.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Go.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Go.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(e=>this.Jr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Jr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Go.forEach(this.Jr,n=>{const i=ko.fromPath(n);return this.Yr(e,i).next(e=>{e||t.removeEntry(i,Ro.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return Go.or([()=>Go.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Wu{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=i}static Ki(e,t){let n=Ul(),i=Ul();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Wu(e,t.fromCache,n,i)}}class Hu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ku{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=Ot()?8:Wo(At())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ji(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.Hi(e,t,i,n).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const n=new Hu;return this.Ji(e,t,n).next(i=>{if(s.result=i,this.Ui)return this.Yi(e,t,n,i.size)})}).next(()=>s.result)}Yi(e,t,n,i){return n.documentReadCount<this.Wi?(io()<=Xt.DEBUG&&so("QueryEngine","SDK will not create cache indexes for query:",Sl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Go.resolve()):(io()<=Xt.DEBUG&&so("QueryEngine","Query:",Sl(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(io()<=Xt.DEBUG&&so("QueryEngine","The SDK decides to create cache indexes for query:",Sl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,gl(t))):Go.resolve())}ji(e,t){if(pl(t))return Go.resolve(null);let n=gl(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=vl(t,null,"F"),n=gl(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const s=Ul(...i);return this.zi.getDocuments(e,s).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{const r=this.Zi(t,i);return this.Xi(t,r,s,n.readTime)?this.ji(e,vl(t,null,"F")):this.es(e,r,t,n)}))})))}Hi(e,t,n,i){return pl(t)||i.isEqual(Ro.min())?Go.resolve(null):this.zi.getDocuments(e,n).next(s=>{const r=this.Zi(t,s);return this.Xi(t,r,n,i)?Go.resolve(null):(io()<=Xt.DEBUG&&so("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sl(t)),this.es(e,r,t,Lo(i,-1)).next(e=>e))})}Zi(e,t){let n=new sc(wl(e));return t.forEach((t,i)=>{xl(e,i)&&(n=n.add(i))}),n}Xi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,n){return io()<=Xt.DEBUG&&so("QueryEngine","Using full collection scan to execute query:",Sl(t)),this.zi.getDocumentsMatchingQuery(e,t,Mo.min(),n)}es(e,t,n,i){return this.zi.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class zu{constructor(e,t,n,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new tc(wo),this.rs=new Cl(e=>ol(e),cl),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ou(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function qu(e,t,n,i){return new zu(e,t,n,i)}async function Yu(e,t){const n=uo(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next(s=>(i=s,n._s(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],r=[];let a=Ul();for(const e of i){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({us:e,removedBatchIds:s,addedBatchIds:r}))})})}function Xu(e){const t=uo(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function Ju(e,t,n){let i=Ul(),s=Ul();return n.forEach(e=>i=i.add(e)),t.getEntries(e,i).next(e=>{let i=Il();return n.forEach((n,r)=>{const a=e.get(n);r.isFoundDocument()!==a.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(Ro.min())?(t.removeEntry(n,r.readTime),i=i.insert(n,r)):!a.isValidDocument()||r.version.compareTo(a.version)>0||0===r.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(r),i=i.insert(n,r)):so("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",r.version)}),{cs:i,ls:s}})}function Qu(e,t){const n=uo(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Zu(e,t){const n=uo(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let i;return n.Qr.getTargetData(e,t).next(s=>s?(i=s,Go.resolve(i)):n.Qr.allocateTargetId(e).next(s=>(i=new bu(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,i).next(()=>i))))}).then(e=>{const i=n.ns.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e})}async function $u(e,t,n){const i=uo(e),s=i.ns.get(t),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,e=>i.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!Ho(e))throw e;so("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}i.ns=i.ns.remove(t),i.rs.delete(s.target)}function eh(e,t,n){const i=uo(e);let s=Ro.min(),r=Ul();return i.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const i=uo(e),s=i.rs.get(n);return void 0!==s?Go.resolve(i.ns.get(s)):i.Qr.getTargetData(t,n)}(i,e,gl(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,i.Qr.getMatchingKeysForTargetId(e,t.targetId).next(e=>{r=e})}).next(()=>i.ts.getDocumentsMatchingQuery(e,t,n?s:Ro.min(),n?r:Ul())).next(e=>(th(i,Tl(t),e),{documents:e,hs:r})))}function th(e,t,n){let i=e.ss.get(t)||Ro.min();n.forEach((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)}),e.ss.set(t,i)}class nh{constructor(){this.activeTargetIds=Fl()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ih{constructor(){this.no=new nh,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new nh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sh{io(e){}shutdown(){}}class rh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){so("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){so("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ah=null;function oh(){return null===ah?ah=268435456+Math.round(2147483648*Math.random()):ah++,"0x"+ah.toString(16)}const ch={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lh{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const dh="WebChannelConnection";class uh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.wo=t+"://"+e.host,this.So="projects/".concat(n,"/databases/").concat(i),this.bo="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(i)}get Do(){return!1}Co(e,t,n,i,s){const r=oh(),a=this.vo(e,t.toUriEncodedString());so("RestConnection","Sending RPC '".concat(e,"' ").concat(r,":"),a,n);const o={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(o,i,s),this.Mo(e,a,o,n).then(t=>(so("RestConnection","Received RPC '".concat(e,"' ").concat(r,": "),t),t),t=>{throw ao("RestConnection","RPC '".concat(e,"' ").concat(r," failed with error: "),t,"url: ",a,"request:",n),t})}xo(e,t,n,i,s,r){return this.Co(e,t,n,i,s)}Fo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+to,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}vo(e,t){const n=ch[e];return"".concat(this.wo,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,i){const s=oh();return new Promise((r,a)=>{const o=new Ga;o.setWithCredentials(!0),o.listenOnce(Ka.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case za.NO_ERROR:const t=o.getResponseJson();so(dh,"XHR for RPC '".concat(e,"' ").concat(s," received:"),JSON.stringify(t)),r(t);break;case za.TIMEOUT:so(dh,"RPC '".concat(e,"' ").concat(s," timed out")),a(new po(ho.DEADLINE_EXCEEDED,"Request time out"));break;case za.HTTP_ERROR:const n=o.getStatus();if(so(dh,"RPC '".concat(e,"' ").concat(s," failed with status:"),n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(ho).indexOf(t)>=0?t:ho.UNKNOWN}(t.status);a(new po(e,t.message))}else a(new po(ho.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new po(ho.UNAVAILABLE,"Connection failed."));break;default:co()}}finally{so(dh,"RPC '".concat(e,"' ").concat(s," completed."))}});const c=JSON.stringify(i);so(dh,"RPC '".concat(e,"' ").concat(s," sending request:"),i),o.send(t,"POST",c,n,15)})}Oo(e,t,n){const i=oh(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=Ja(),a=Xa(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(o.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(o.xmlHttpFactory=new Wa({})),this.Fo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const l=s.join("");so(dh,"Creating RPC '".concat(e,"' stream ").concat(i,": ").concat(l),o);const d=r.createWebChannel(l,o);let u=!1,h=!1;const p=new lh({lo:t=>{h?so(dh,"Not sending because RPC '".concat(e,"' stream ").concat(i," is closed:"),t):(u||(so(dh,"Opening RPC '".concat(e,"' stream ").concat(i," transport.")),d.open(),u=!0),so(dh,"RPC '".concat(e,"' stream ").concat(i," sending:"),t),d.send(t))},ho:()=>d.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(d,Ha.EventType.OPEN,()=>{h||(so(dh,"RPC '".concat(e,"' stream ").concat(i," transport opened.")),p.mo())}),m(d,Ha.EventType.CLOSE,()=>{h||(h=!0,so(dh,"RPC '".concat(e,"' stream ").concat(i," transport closed")),p.po())}),m(d,Ha.EventType.ERROR,t=>{h||(h=!0,ao(dh,"RPC '".concat(e,"' stream ").concat(i," transport errored:"),t),p.po(new po(ho.UNAVAILABLE,"The operation could not be completed")))}),m(d,Ha.EventType.MESSAGE,t=>{var n;if(!h){const s=t.data[0];lo(!!s);const r=s,a=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(a){so(dh,"RPC '".concat(e,"' stream ").concat(i," received error:"),a);const t=a.status;let n=function(e){const t=xd[e];if(void 0!==t)return Nd(t)}(t),s=a.message;void 0===n&&(n=ho.INTERNAL,s="Unknown error status: "+t+" with message "+a.message),h=!0,p.po(new po(n,s)),d.close()}else so(dh,"RPC '".concat(e,"' stream ").concat(i," received:"),s),p.yo(s)}}),m(a,Ya.STAT_EVENT,t=>{t.stat===qa.PROXY?so(dh,"RPC '".concat(e,"' stream ").concat(i," detected buffering proxy")):t.stat===qa.NOPROXY&&so(dh,"RPC '".concat(e,"' stream ").concat(i," detected no buffering proxy"))}),setTimeout(()=>{p.fo()},0),p}}function hh(){return"undefined"!=typeof document?document:null}function ph(e){return new zd(e,!0)}class mh{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.oi=e,this.timerId=t,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-n);i>0&&so("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class fh{constructor(e,t,n,i,s,r,a,o){this.oi=e,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new mh(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(e,t){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==e?this.Yo.reset():t&&t.code===ho.RESOURCE_EXHAUSTED?(ro(t.toString()),ro("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===ho.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ao(t)}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,i]=e;this.jo===t&&this.u_(n,i)},t=>{e(()=>{const e=new po(ho.UNKNOWN,"Fetching auth token failed: "+t.message);return this.c_(e)})})}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(e=>{n(()=>this.c_(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}e_(){this.state=5,this.Yo.$o(async()=>{this.state=0,this.start()})}c_(e){return so("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(so("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gh extends fh{constructor(e,t,n,i,s,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:co()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(lo(void 0===t||"string"==typeof t),cc.fromBase64String(t||"")):(lo(void 0===t||t instanceof Buffer||t instanceof Uint8Array),cc.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?ho.UNKNOWN:Nd(e.code);return new po(t,e.message||"")}(a);n=new Ud(i,s,r,o||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=nu(e,i.document.name),r=Qd(i.document.updateTime),a=i.document.createTime?Qd(i.document.createTime):Ro.min(),o=new Pc({mapValue:{fields:i.document.fields}}),c=jc.newFoundDocument(s,r,a,o),l=i.targetIds||[],d=i.removedTargetIds||[];n=new jd(l,d,c.key,c)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=nu(e,i.document),r=i.readTime?Qd(i.readTime):Ro.min(),a=jc.newNoDocument(s,r),o=i.removedTargetIds||[];n=new jd([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=nu(e,i.document),r=i.removedTargetIds||[];n=new jd([],r,s,null)}else{if(!("filter"in t))return co();{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:s}=e,r=new Sd(i,s),a=e.targetId;n=new Md(a,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Ro.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ro.min():t.readTime?Qd(t.readTime):Ro.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=ru(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=ll(i)?{documents:lu(e,i)}:{query:du(e,i)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Xd(e,t.resumeToken);const i=qd(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(Ro.min())>0){n.readTime=Yd(e,t.snapshotVersion.toTimestamp());const i=qd(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return co()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=ru(this.serializer),t.removeTarget=e,this.i_(t)}}class _h extends fh{constructor(e,t,n,i,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(lo(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function(e,t){return e&&e.length>0?(lo(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?Qd(e.updateTime):Qd(t);return n.isEqual(Ro.min())&&(n=Qd(t)),new id(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Qd(e.commitTime);return this.listener.A_(n,t)}return lo(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=ru(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>cu(this.serializer,e))};this.i_(t)}}class yh extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new po(ho.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[r,a]=s;return this.connection.Co(e,$d(t,n),i,r,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===ho.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new po(ho.UNKNOWN,e.toString())})}xo(e,t,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(r=>{let[a,o]=r;return this.connection.xo(e,$d(t,n),i,a,o,s)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===ho.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new po(ho.UNKNOWN,e.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class vh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.y_?(ro(t),this.y_=!1):so("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Eh{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(e=>{n.enqueueAndForget(async()=>{Ih(this)&&(so("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=uo(e);t.M_.add(4),await Sh(t),t.N_.set("Unknown"),t.M_.delete(4),await bh(t)}(this))})}),this.N_=new vh(n,i)}}async function bh(e){if(Ih(e))for(const t of e.x_)await t(!0)}async function Sh(e){for(const t of e.x_)await t(!1)}function xh(e,t){const n=uo(e);n.F_.has(t.targetId)||(n.F_.set(t.targetId,t),Rh(n)?Ch(n):Yh(n).Xo()&&wh(n,t))}function Th(e,t){const n=uo(e),i=Yh(n);n.F_.delete(t),i.Xo()&&Nh(n,t),0===n.F_.size&&(i.Xo()?i.n_():Ih(n)&&n.N_.set("Unknown"))}function wh(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Ro.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Yh(e).P_(t)}function Nh(e,t){e.L_.xe(t),Yh(e).I_(t)}function Ch(e){e.L_=new Fd({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.F_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),Yh(e).start(),e.N_.w_()}function Rh(e){return Ih(e)&&!Yh(e).Zo()&&e.F_.size>0}function Ih(e){return 0===uo(e).M_.size}function Ah(e){e.L_=void 0}async function Oh(e){e.N_.set("Online")}async function Dh(e){e.F_.forEach((t,n)=>{wh(e,t)})}async function kh(e,t){Ah(e),Rh(e)?(e.N_.D_(t),Ch(e)):e.N_.set("Unknown")}async function Ph(e,t,n){if(e.N_.set("Online"),t instanceof Ud&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.F_.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.F_.delete(i),e.L_.removeTarget(i))}(e,t)}catch(n){so("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Lh(e,n)}else if(t instanceof jd?e.L_.Ke(t):t instanceof Md?e.L_.He(t):e.L_.We(t),!n.isEqual(Ro.min()))try{const t=await Xu(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.L_.rt(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.F_.get(i);s&&e.F_.set(i,s.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const i=e.F_.get(t);if(!i)return;e.F_.set(t,i.withResumeToken(cc.EMPTY_BYTE_STRING,i.snapshotVersion)),Nh(e,t);const s=new bu(i.target,t,n,i.sequenceNumber);wh(e,s)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){so("RemoteStore","Failed to raise snapshot:",t),await Lh(e,t)}}async function Lh(e,t,n){if(!Ho(t))throw t;e.M_.add(1),await Sh(e),e.N_.set("Offline"),n||(n=()=>Xu(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{so("RemoteStore","Retrying IndexedDB access"),await n(),e.M_.delete(1),await bh(e)})}function jh(e,t){return t().catch(n=>Lh(e,n,t))}async function Mh(e){const t=uo(e),n=Xh(t);let i=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;Uh(t);)try{const e=await Qu(t.localStore,i);if(null===e){0===t.v_.length&&n.n_();break}i=e.batchId,Vh(t,e)}catch(e){await Lh(t,e)}Fh(t)&&Bh(t)}function Uh(e){return Ih(e)&&e.v_.length<10}function Vh(e,t){e.v_.push(t);const n=Xh(e);n.Xo()&&n.E_&&n.d_(t.mutations)}function Fh(e){return Ih(e)&&!Xh(e).Zo()&&e.v_.length>0}function Bh(e){Xh(e).start()}async function Gh(e){Xh(e).V_()}async function Wh(e){const t=Xh(e);for(const n of e.v_)t.d_(n.mutations)}async function Hh(e,t,n){const i=e.v_.shift(),s=Ed.from(i,t,n);await jh(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await Mh(e)}async function Kh(e,t){t&&Xh(e).E_&&await async function(e,t){if(function(e){return wd(e)&&e!==ho.ABORTED}(t.code)){const n=e.v_.shift();Xh(e).t_(),await jh(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Mh(e)}}(e,t),Fh(e)&&Bh(e)}async function zh(e,t){const n=uo(e);n.asyncQueue.verifyOperationInProgress(),so("RemoteStore","RemoteStore received new credentials");const i=Ih(n);n.M_.add(3),await Sh(n),i&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.M_.delete(3),await bh(n)}async function qh(e,t){const n=uo(e);t?(n.M_.delete(2),await bh(n)):t||(n.M_.add(2),await Sh(n),n.N_.set("Unknown"))}function Yh(e){return e.B_||(e.B_=function(e,t,n){const i=uo(e);return i.f_(),new gh(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Po:Oh.bind(null,e),To:Dh.bind(null,e),Ao:kh.bind(null,e),h_:Ph.bind(null,e)}),e.x_.push(async t=>{t?(e.B_.t_(),Rh(e)?Ch(e):e.N_.set("Unknown")):(await e.B_.stop(),Ah(e))})),e.B_}function Xh(e){return e.k_||(e.k_=function(e,t,n){const i=uo(e);return i.f_(),new _h(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Po:()=>Promise.resolve(),To:Gh.bind(null,e),Ao:Kh.bind(null,e),R_:Wh.bind(null,e),A_:Hh.bind(null,e)}),e.x_.push(async t=>{t?(e.k_.t_(),await Mh(e)):(await e.k_.stop(),e.v_.length>0&&(so("RemoteStore","Stopping write stream with ".concat(e.v_.length," pending writes")),e.v_=[]))})),e.k_}class Jh{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new mo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,a=new Jh(e,t,r,i,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new po(ho.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qh(e,t){if(ro("AsyncQueue","".concat(t,": ").concat(e)),Ho(e))return new po(ho.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Zh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ko.comparator(t.key,n.key):(e,t)=>ko.comparator(e.key,t.key),this.keyedMap=Ol(),this.sortedSet=new tc(this.comparator)}static emptySet(e){return new Zh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Zh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Zh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class $h{constructor(){this.q_=new tc(ko.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):co():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ep{constructor(e,t,n,i,s,r,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,i,s){const r=[];return t.forEach(e=>{r.push({type:0,doc:e})}),new ep(e,t,Zh.emptySet(t),r,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&El(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class tp{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class np{constructor(){this.queries=new Cl(e=>bl(e),El),this.onlineState="Unknown",this.z_=new Set}}async function ip(e,t){const n=uo(e);let i=3;const s=t.query;let r=n.queries.get(s);r?!r.W_()&&t.G_()&&(i=2):(r=new tp,i=t.G_()?0:1);try{switch(i){case 0:r.K_=await n.onListen(s,!0);break;case 1:r.K_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=Qh(e,"Initialization of query '".concat(Sl(t.query),"' failed"));return void t.onError(n)}n.queries.set(s,r),r.U_.push(t),t.j_(n.onlineState),r.K_&&t.H_(r.K_)&&op(n)}async function sp(e,t){const n=uo(e),i=t.query;let s=3;const r=n.queries.get(i);if(r){const e=r.U_.indexOf(t);e>=0&&(r.U_.splice(e,1),0===r.U_.length?s=t.G_()?0:1:!r.W_()&&t.G_()&&(s=2))}switch(s){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function rp(e,t){const n=uo(e);let i=!1;for(const s of t){const e=s.query,t=n.queries.get(e);if(t){for(const e of t.U_)e.H_(s)&&(i=!0);t.K_=s}}i&&op(n)}function ap(e,t,n){const i=uo(e),s=i.queries.get(t);if(s)for(const r of s.U_)r.onError(n);i.queries.delete(t)}function op(e){e.z_.forEach(e=>{e.next()})}var cp,lp;(lp=cp||(cp={})).J_="default",lp.Cache="cache";class dp{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ep(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==t;return(!this.options.ra||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){if(e.docChanges.length>0)return!0;const t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}na(e){e=ep.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==cp.Cache}}class up{constructor(e){this.key=e}}class hp{constructor(e){this.key=e}}class pp{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=Ul(),this.mutatedKeys=Ul(),this.Ia=wl(e),this.Ta=new Zh(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new $h,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,r=i,a=!1;const o="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{const l=i.get(e),d=xl(this.query,t)?t:null,u=!!l&&this.mutatedKeys.has(l.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let p=!1;l&&d?l.data.isEqual(d.data)?u!==h&&(n.track({type:3,doc:d}),p=!0):this.Ra(l,d)||(n.track({type:2,doc:d}),p=!0,(o&&this.Ia(d,o)>0||c&&this.Ia(d,c)<0)&&(a=!0)):!l&&d?(n.track({type:0,doc:d}),p=!0):l&&!d&&(n.track({type:1,doc:l}),p=!0,(o||c)&&(a=!0)),p&&(d?(r=r.add(d),s=h?s.add(e):s.delete(e)):(r=r.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{Ta:r,Aa:n,Xi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const r=e.Aa.Q_();r.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return co()}};return n(e)-n(t)}(e.type,t.type)||this.Ia(e.doc,t.doc)),this.Va(n),i=null!=i&&i;const a=t&&!i?this.ma():[],o=0===this.Pa.size&&this.current&&!i?1:0,c=o!==this.ha;return this.ha=o,0!==r.length||c?{snapshot:new ep(this.query,e.Ta,s,r,e.mutatedKeys,0===o,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new $h,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(e=>this.la=this.la.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=Ul(),this.Ta.forEach(e=>{this.ga(e.key)&&(this.Pa=this.Pa.add(e.key))});const t=[];return e.forEach(e=>{this.Pa.has(e)||t.push(new hp(e))}),this.Pa.forEach(n=>{e.has(n)||t.push(new up(n))}),t}pa(e){this.la=e.hs,this.Pa=Ul();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return ep.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class mp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fp{constructor(e){this.key=e,this.wa=!1}}class gp{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Sa={},this.ba=new Cl(e=>bl(e),El),this.Da=new Map,this.Ca=new Set,this.va=new tc(ko.comparator),this.Fa=new Map,this.Ma=new Pu,this.xa={},this.Oa=new Map,this.Na=Ru.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function _p(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=Up(e);let s;const r=i.ba.get(t);return r?(i.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.ya()):s=await vp(i,t,n,!0),s}async function yp(e,t){const n=Up(e);await vp(n,t,!0,!1)}async function vp(e,t,n,i){const s=await Zu(e.localStore,gl(t)),r=s.targetId,a=n?e.sharedClientState.addLocalQueryTarget(r):"not-current";let o;return i&&(o=await Ep(e,t,r,"current"===a,s.resumeToken)),e.isPrimaryClient&&n&&xh(e.remoteStore,s),o}async function Ep(e,t,n,i,s){e.Ba=(t,n,i)=>async function(e,t,n,i){let s=t.view.da(n);s.Xi&&(s=await eh(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.da(n,s)}));const r=i&&i.targetChanges.get(t.targetId),a=i&&null!=i.targetMismatches.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,r,a);return Dp(e,t.targetId,o.fa),o.snapshot}(e,t,n,i);const r=await eh(e.localStore,t,!0),a=new pp(t,r.hs),o=a.da(r.documents),c=Ld.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,s),l=a.applyChanges(o,e.isPrimaryClient,c);Dp(e,n,l.fa);const d=new mp(t,n,a);return e.ba.set(t,d),e.Da.has(n)?e.Da.get(n).push(t):e.Da.set(n,[t]),l.snapshot}async function bp(e,t,n){const i=uo(e),s=i.ba.get(t),r=i.Da.get(s.targetId);if(r.length>1)return i.Da.set(s.targetId,r.filter(e=>!El(e,t))),void i.ba.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await $u(i.localStore,s.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(s.targetId),n&&Th(i.remoteStore,s.targetId),Ap(i,s.targetId)}).catch(Bo)):(Ap(i,s.targetId),await $u(i.localStore,s.targetId,!0))}async function Sp(e,t){const n=uo(e),i=n.ba.get(t),s=n.Da.get(i.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),Th(n.remoteStore,i.targetId))}async function xp(e,t){const n=uo(e);try{const e=await function(e,t){const n=uo(e),i=t.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const r=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const a=[];t.targetChanges.forEach((r,o)=>{const c=s.get(o);if(!c)return;a.push(n.Qr.removeMatchingKeys(e,r.removedDocuments,o).next(()=>n.Qr.addMatchingKeys(e,r.addedDocuments,o)));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?l=l.withResumeToken(cc.EMPTY_BYTE_STRING,Ro.min()).withLastLimboFreeSnapshotVersion(Ro.min()):r.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(r.resumeToken,i)),s=s.insert(o,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,r)&&a.push(n.Qr.updateTargetData(e,l))});let o=Il(),c=Ul();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),a.push(Ju(e,r,t.documentUpdates).next(e=>{o=e.cs,c=e.ls})),!i.isEqual(Ro.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next(t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,i));a.push(t)}return Go.waitFor(a).next(()=>r.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,c)).next(()=>o)}).then(e=>(n.ns=s,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const i=n.Fa.get(t);i&&(lo(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.wa=!0:e.modifiedDocuments.size>0?lo(i.wa):e.removedDocuments.size>0&&(lo(i.wa),i.wa=!1))}),await Lp(n,e,t)}catch(e){await Bo(e)}}function Tp(e,t,n){const i=uo(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.ba.forEach((n,i)=>{const s=i.view.j_(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=uo(e);n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(const s of n.U_)s.j_(t)&&(i=!0)}),i&&op(n)}(i.eventManager,t),e.length&&i.Sa.h_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function wp(e,t,n){const i=uo(e);i.sharedClientState.updateQueryState(t,"rejected",n);const s=i.Fa.get(t),r=s&&s.key;if(r){let e=new tc(ko.comparator);e=e.insert(r,jc.newNoDocument(r,Ro.min()));const n=Ul().add(r),s=new Pd(Ro.min(),new Map,new tc(wo),e,n);await xp(i,s),i.va=i.va.remove(r),i.Fa.delete(t),Pp(i)}else await $u(i.localStore,t,!1).then(()=>Ap(i,t,n)).catch(Bo)}async function Np(e,t){const n=uo(e),i=t.batch.batchId;try{const e=await function(e,t){const n=uo(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const i=t.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const s=n.batch,r=s.keys();let a=Go.resolve();return r.forEach(e=>{a=a.next(()=>i.getEntry(t,e)).next(t=>{const r=n.docVersions.get(e);lo(null!==r),t.version.compareTo(r)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(n,e,t,s).next(()=>s.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Ul();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))})}(n.localStore,t);Ip(n,i,null),Rp(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Lp(n,e)}catch(e){await Bo(e)}}async function Cp(e,t,n){const i=uo(e);try{const e=await function(e,t){const n=uo(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(lo(null!==t),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i)).next(()=>n.localDocuments.getDocuments(e,i))})}(i.localStore,t);Ip(i,t,n),Rp(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await Lp(i,e)}catch(n){await Bo(n)}}function Rp(e,t){(e.Oa.get(t)||[]).forEach(e=>{e.resolve()}),e.Oa.delete(t)}function Ip(e,t,n){const i=uo(e);let s=i.xa[i.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),i.xa[i.currentUser.toKey()]=s}}function Ap(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.Da.get(t))e.ba.delete(i),n&&e.Sa.ka(i,n);e.Da.delete(t),e.isPrimaryClient&&e.Ma.Vr(t).forEach(t=>{e.Ma.containsKey(t)||Op(e,t)})}function Op(e,t){e.Ca.delete(t.path.canonicalString());const n=e.va.get(t);null!==n&&(Th(e.remoteStore,n),e.va=e.va.remove(t),e.Fa.delete(n),Pp(e))}function Dp(e,t,n){for(const i of n)i instanceof up?(e.Ma.addReference(i.key,t),kp(e,i)):i instanceof hp?(so("SyncEngine","Document no longer in limbo: "+i.key),e.Ma.removeReference(i.key,t),e.Ma.containsKey(i.key)||Op(e,i.key)):co()}function kp(e,t){const n=t.key,i=n.path.canonicalString();e.va.get(n)||e.Ca.has(i)||(so("SyncEngine","New document in limbo: "+n),e.Ca.add(i),Pp(e))}function Pp(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){const t=e.Ca.values().next().value;e.Ca.delete(t);const n=new ko(Ao.fromString(t)),i=e.Na.next();e.Fa.set(i,new fp(n)),e.va=e.va.insert(n,i),xh(e.remoteStore,new bu(gl(hl(n.path)),i,"TargetPurposeLimboResolution",Ko.oe))}}async function Lp(e,t,n){const i=uo(e),s=[],r=[],a=[];i.ba.isEmpty()||(i.ba.forEach((e,o)=>{a.push(i.Ba(o,t,n).then(e=>{if((e||n)&&i.isPrimaryClient){const t=e&&!e.fromCache;i.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){s.push(e);const t=Wu.Ki(o.targetId,e);r.push(t)}}))}),await Promise.all(a),i.Sa.h_(s),await async function(e,t){const n=uo(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Go.forEach(t,t=>Go.forEach(t.qi,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>Go.forEach(t.Qi,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(e){if(!Ho(e))throw e;so("LocalStore","Failed to update sequence numbers: "+e)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.ns.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.ns=n.ns.insert(e,s)}}}(i.localStore,r))}async function jp(e,t){const n=uo(e);if(!n.currentUser.isEqual(t)){so("SyncEngine","User change. New user:",t.toKey());const e=await Yu(n.localStore,t);n.currentUser=t,function(e,t){e.Oa.forEach(e=>{e.forEach(e=>{e.reject(new po(ho.CANCELLED,t))})}),e.Oa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Lp(n,e.us)}}function Mp(e,t){const n=uo(e),i=n.Fa.get(t);if(i&&i.wa)return Ul().add(i.key);{let e=Ul();const i=n.Da.get(t);if(!i)return e;for(const t of i){const i=n.ba.get(t);e=e.unionWith(i.view.Ea)}return e}}function Up(e){const t=uo(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=xp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=wp.bind(null,t),t.Sa.h_=rp.bind(null,t.eventManager),t.Sa.ka=ap.bind(null,t.eventManager),t}function Vp(e){const t=uo(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Np.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Cp.bind(null,t),t}class Fp{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=ph(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return qu(this.persistence,new Ku,e.initialUser,this.serializer)}createPersistence(e){return new Fu(Gu.Hr,this.serializer)}createSharedClientState(e){return new ih}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Bp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Tp(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jp.bind(null,this.syncEngine),await qh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new np}createDatastore(e){const t=ph(e.databaseInfo.databaseId),n=function(e){return new uh(e)}(e.databaseInfo);return function(e,t,n,i){return new yh(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,i,s){return new Eh(e,t,n,i,s)}(this.localStore,this.datastore,e.asyncQueue,e=>Tp(this.syncEngine,e,0),rh.D()?new rh:new sh)}createSyncEngine(e,t){return function(e,t,n,i,s,r,a){const o=new gp(e,t,n,i,s,r);return a&&(o.La=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=uo(e);so("RemoteStore","RemoteStore shutting down."),t.M_.add(5),await Sh(t),t.O_.shutdown(),t.N_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class Gp{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):ro("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Wp{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=eo.UNAUTHENTICATED,this.clientId=To.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{so("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(so("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new po(ho.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new mo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Qh(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Hp(e,t){e.asyncQueue.verifyOperationInProgress(),so("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await Yu(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Kp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await qp(e);so("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>zh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>zh(t.remoteStore,n)),e._onlineComponents=t}function zp(e){return"FirebaseError"===e.name?e.code===ho.FAILED_PRECONDITION||e.code===ho.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function qp(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){so("FirestoreClient","Using user provided OfflineComponentProvider");try{await Hp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!zp(n))throw n;ao("Error using user provided cache. Falling back to memory cache: "+n),await Hp(e,new Fp)}}else so("FirestoreClient","Using default OfflineComponentProvider"),await Hp(e,new Fp);return e._offlineComponents}async function Yp(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(so("FirestoreClient","Using user provided OnlineComponentProvider"),await Kp(e,e._uninitializedComponentsProvider._online)):(so("FirestoreClient","Using default OnlineComponentProvider"),await Kp(e,new Bp))),e._onlineComponents}function Xp(e){return Yp(e).then(e=>e.syncEngine)}async function Jp(e){const t=await Yp(e),n=t.eventManager;return n.onListen=_p.bind(null,t.syncEngine),n.onUnlisten=bp.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=yp.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Sp.bind(null,t.syncEngine),n}function Qp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new mo;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,i,s){const r=new Gp({next:r=>{t.enqueueAndForget(()=>sp(e,a));const o=r.docs.has(n);!o&&r.fromCache?s.reject(new po(ho.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&r.fromCache&&i&&"server"===i.source?s.reject(new po(ho.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(r)},error:e=>s.reject(e)}),a=new dp(hl(n.path),r,{includeMetadataChanges:!0,ra:!0});return ip(e,a)}(await Jp(e),e.asyncQueue,t,n,i)),i.promise}function Zp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new mo;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,i,s){const r=new Gp({next:n=>{t.enqueueAndForget(()=>sp(e,a)),n.fromCache&&"server"===i.source?s.reject(new po(ho.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),a=new dp(n,r,{includeMetadataChanges:!0,ra:!0});return ip(e,a)}(await Jp(e),e.asyncQueue,t,n,i)),i.promise}function $p(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const em=new Map;function tm(e,t,n){if(!n)throw new po(ho.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function nm(e){if(!ko.isDocumentKey(e))throw new po(ho.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function im(e){if(ko.isDocumentKey(e))throw new po(ho.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function sm(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":co()}function rm(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new po(ho.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=sm(e);throw new po(ho.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function am(e,t){if(t<=0)throw new po(ho.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}class om{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new po(ho.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new po(ho.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new po(ho.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$p(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new po(ho.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new po(ho.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new po(ho.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cm{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new om({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new po(ho.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new po(ho.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new om(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new go;switch(e.type){case"firstParty":return new Eo(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new po(ho.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=em.get(e);t&&(so("ComponentProvider","Removing Datastore"),em.delete(e),t.terminate())}(this),Promise.resolve()}}function lm(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var s;const r=(e=rm(e,cm))._getSettings(),a="".concat(t,":").concat(n);if("firestore.googleapis.com"!==r.host&&r.host!==a&&ao("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},r),{host:a,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=eo.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[bt(JSON.stringify({alg:"none",type:"JWT"})),bt(JSON.stringify(r)),""].join(".")}(i.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const r=i.mockUserToken.sub||i.mockUserToken.user_id;if(!r)throw new po(ho.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new eo(r)}e._authCredentials=new _o(new fo(t,n))}}class dm{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new dm(this.firestore,e,this._query)}}class um{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new um(this.firestore,e,this._key)}}class hm extends dm{constructor(e,t,n){super(e,t,hl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new um(this.firestore,null,new ko(e))}withConverter(e){return new hm(this.firestore,e,this._path)}}function pm(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=Wt(e),tm("collection","path",t),e instanceof cm){const n=Ao.fromString(t,...i);return im(n),new hm(e,null,n)}{if(!(e instanceof um||e instanceof hm))throw new po(ho.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ao.fromString(t,...i));return im(n),new hm(e.firestore,null,n)}}function mm(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=Wt(e),1===arguments.length&&(t=To.newId()),tm("doc","path",t),e instanceof cm){const n=Ao.fromString(t,...i);return nm(n),new um(e,null,new ko(n))}{if(!(e instanceof um||e instanceof hm))throw new po(ho.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ao.fromString(t,...i));return nm(n),new um(e.firestore,e instanceof hm?e.converter:null,new ko(n))}}class fm{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new mh(this,"async_queue_retry"),this.hu=()=>{const e=hh();e&&so("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};const e=hh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=hh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new mo;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(ty){if(!Ho(ty))throw ty;so("AsyncQueue","Operation failed with retryable error: "+ty)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(e=>{this.au=e,this.uu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw ro("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.uu=!1,e))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=Jh.createAndSchedule(this,e,t,n,e=>this.Eu(e));return this._u.push(i),i}Pu(){this.au&&co()}verifyOperationInProgress(){}async du(){let e;do{e=this.iu,await e}while(e!==this.iu)}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function gm(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const i of t)if(i in n&&"function"==typeof n[i])return!0;return!1}(e,["next","error","complete"])}class _m extends cm{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new fm,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||vm(this),this._firestoreClient.terminate()}}function ym(e){return e._firestoreClient||vm(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function vm(e){var t,n,i;const s=e._freezeSettings(),r=function(e,t,n,i){return new gc(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,$p(i.experimentalLongPollingOptions),i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._firestoreClient=new Wp(e._authCredentials,e._appCheckCredentials,e._queue,r),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class Em{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Em(cc.fromBase64String(e))}catch(e){throw new po(ho.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Em(cc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class bm{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<t.length;++i)if(0===t[i].length)throw new po(ho.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Do(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Sm{constructor(e){this._methodName=e}}class xm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new po(ho.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new po(ho.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return wo(this._lat,e._lat)||wo(this._long,e._long)}}const Tm=/^__.*__$/;class wm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new pd(e,this.data,this.fieldMask,t,this.fieldTransforms):new hd(e,this.data,t,this.fieldTransforms)}}class Nm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new pd(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Cm(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw co()}}class Rm{constructor(e,t,n,i,s,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new Rm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.wu(e),i}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Hm(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(Cm(this.fu)&&Tm.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class Im{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ph(e)}Fu(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Rm({fu:e,methodName:t,vu:n,path:Do.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Am(e){const t=e._freezeSettings(),n=ph(e._databaseId);return new Im(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Om(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Fu(r.merge||r.mergeFields?2:0,t,n,s);Fm("Data must be an object, but it was:",a,i);const o=Um(i,a);let c,l;if(r.merge)c=new ac(a.fieldMask),l=a.fieldTransforms;else if(r.mergeFields){const e=[];for(const i of r.mergeFields){const s=Bm(t,i,n);if(!a.contains(s))throw new po(ho.INVALID_ARGUMENT,"Field '".concat(s,"' is specified in your field mask but missing from your input data."));Km(e,s)||e.push(s)}c=new ac(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new wm(new Pc(o),c,l)}class Dm extends Sm{_toFieldTransform(e){if(2!==e.fu)throw 1===e.fu?e.Du("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Du("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Dm}}class km extends Sm{_toFieldTransform(e){return new nd(e.path,new Yl)}isEqual(e){return e instanceof km}}function Pm(e,t,n,i){const s=e.Fu(1,t,n);Fm("Data must be an object, but it was:",s,i);const r=[],a=Pc.empty();$o(i,(e,i)=>{const o=Wm(t,e,n);i=Wt(i);const c=s.Su(o);if(i instanceof Dm)r.push(o);else{const e=Mm(i,c);null!=e&&(r.push(o),a.set(o,e))}});const o=new ac(r);return new Nm(a,o,s.fieldTransforms)}function Lm(e,t,n,i,s,r){const a=e.Fu(1,t,n),o=[Bm(t,i,n)],c=[s];if(r.length%2!=0)throw new po(ho.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let h=0;h<r.length;h+=2)o.push(Bm(t,r[h])),c.push(r[h+1]);const l=[],d=Pc.empty();for(let h=o.length-1;h>=0;--h)if(!Km(l,o[h])){const e=o[h];let t=c[h];t=Wt(t);const n=a.Su(e);if(t instanceof Dm)l.push(e);else{const i=Mm(t,n);null!=i&&(l.push(e),d.set(e,i))}}const u=new ac(l);return new Nm(d,u,a.fieldTransforms)}function jm(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Mm(n,e.Fu(i?4:3,t))}function Mm(e,t){if(Vm(e=Wt(e)))return Fm("Unsupported field value:",t,e),Um(e,t);if(e instanceof Sm)return function(e,t){if(!Cm(t.fu))throw t.Du("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Du("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const s of e){let e=Mm(s,t.bu(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Wt(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Wl(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Co.fromDate(e);return{timestampValue:Yd(t.serializer,n)}}if(e instanceof Co){const n=new Co(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Yd(t.serializer,n)}}if(e instanceof xm)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Em)return{bytesValue:Xd(t.serializer,e._byteString)};if(e instanceof um){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Du("Document reference is for database ".concat(i.projectId,"/").concat(i.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:Zd(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Du("Unsupported field value: ".concat(sm(e)))}(e,t)}function Um(e,t){const n={};return ec(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):$o(e,(e,i)=>{const s=Mm(i,t.pu(e));null!=s&&(n[e]=s)}),{mapValue:{fields:n}}}function Vm(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Co||e instanceof xm||e instanceof Em||e instanceof um||e instanceof Sm)}function Fm(e,t,n){if(!Vm(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=sm(n);throw"an object"===i?t.Du(e+" a custom object"):t.Du(e+" "+i)}}function Bm(e,t,n){if((t=Wt(t))instanceof bm)return t._internalPath;if("string"==typeof t)return Wm(e,t);throw Hm("Field path arguments must be of type string or ",e,!1,void 0,n)}const Gm=new RegExp("[~\\*/\\[\\]]");function Wm(e,t,n){if(t.search(Gm)>=0)throw Hm("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new bm(...t.split("."))._internalPath}catch(Ue){throw Hm("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Hm(e,t,n,i,s){const r=i&&!i.isEmpty(),a=void 0!==s;let o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(r||a)&&(c+=" (found",r&&(c+=" in field ".concat(i)),a&&(c+=" in document ".concat(s)),c+=")"),new po(ho.INVALID_ARGUMENT,o+e+c)}function Km(e,t){return e.some(e=>e.isEqual(t))}class zm{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new um(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new qm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ym("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class qm extends zm{data(){return super.data()}}function Ym(e,t){return"string"==typeof t?Wm(e,t):t instanceof bm?t._internalPath:t._delegate._internalPath}function Xm(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new po(ho.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jm{}class Qm extends Jm{}function Zm(e,t){let n=[];for(var i=arguments.length,s=new Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];t instanceof Jm&&n.push(t),n=n.concat(s),function(e){const t=e.filter(e=>e instanceof tf).length,n=e.filter(e=>e instanceof $m).length;if(t>1||t>0&&n>0)throw new po(ho.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class $m extends Qm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new $m(e,t,n)}_apply(e){const t=this._parse(e);return cf(e._query,t),new dm(e.firestore,e.converter,yl(e._query,t))}_parse(e){const t=Am(e.firestore),n=function(e,t,n,i,s,r,a){let o;if(s.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new po(ho.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(r,"' queries on documentId()."));if("in"===r||"not-in"===r){of(a,r);const t=[];for(const n of a)t.push(af(i,e,n));o={arrayValue:{values:t}}}else o=af(i,e,a)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||of(a,r),o=jm(n,t,a,"in"===r||"not-in"===r);return Wc.create(s,r,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function ef(e,t,n){const i=t,s=Ym("where",e);return $m._create(s,i,n)}class tf extends Jm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new tf(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Hc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const s of i)cf(n,s),n=yl(n,s)}(e._query,t),new dm(e.firestore,e.converter,yl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class nf extends Qm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new nf(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new po(ho.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new po(ho.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Fc(t,n)}(e._query,this._field,this._direction);return new dm(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new dl(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function sf(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Ym("orderBy",e);return nf._create(n,t)}class rf extends Qm{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new rf(e,t,n)}_apply(e){return new dm(e.firestore,e.converter,vl(e._query,this._limit,this._limitType))}}function af(e,t,n){if("string"==typeof(n=Wt(n))){if(""===n)throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ml(t)&&-1!==n.indexOf("/"))throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const i=t.path.child(Ao.fromString(n));if(!ko.isDocumentKey(i))throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(i,"' is not because it has an odd number of segments (").concat(i.length,")."));return Nc(e,new ko(i))}if(n instanceof um)return Nc(e,n._key);throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(sm(n),"."))}function of(e,t){if(!Array.isArray(e)||0===e.length)throw new po(ho.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function cf(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new po(ho.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new po(ho.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class lf{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(vc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return uc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(hc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw co()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return $o(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertGeoPoint(e){return new xm(uc(e.latitude),uc(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=mc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(fc(e));default:return null}}convertTimestamp(e){const t=dc(e);return new Co(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ao.fromString(e);lo(Eu(n));const i=new _c(n.get(1),n.get(3)),s=new ko(n.popFirst(5));return i.isEqual(t)||ro("Document ".concat(s," contains a document reference within a different database (").concat(i.projectId,"/").concat(i.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),s}}function df(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class uf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hf extends zm{constructor(e,t,n,i,s,r){super(e,t,n,i,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new pf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Ym("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class pf extends hf{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class mf{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new uf(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new pf(this._firestore,this._userDataWriter,n.key,n,new uf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new po(ho.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const i=new pf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new uf(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const i=new pf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,r=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:ff(t.type),doc:i,oldIndex:s,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function ff(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return co()}}function gf(e){e=rm(e,um);const t=rm(e.firestore,_m);return Qp(ym(t),e._key).then(n=>Tf(t,e,n))}class _f extends lf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Em(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new um(this.firestore,null,t)}}function yf(e){e=rm(e,dm);const t=rm(e.firestore,_m),n=ym(t),i=new _f(t);return Xm(e._query),Zp(n,e._query).then(n=>new mf(t,i,e,n))}function vf(e,t,n){e=rm(e,um);const i=rm(e.firestore,_m),s=df(e.converter,t,n);return xf(i,[Om(Am(i),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,sd.none())])}function Ef(e,t,n){e=rm(e,um);const i=rm(e.firestore,_m),s=Am(i);let r;for(var a=arguments.length,o=new Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];return r="string"==typeof(t=Wt(t))||t instanceof bm?Lm(s,"updateDoc",e._key,t,n,o):Pm(s,"updateDoc",e._key,t),xf(i,[r.toMutation(e._key,sd.exists(!0))])}function bf(e,t){const n=rm(e.firestore,_m),i=mm(e),s=df(e.converter,t);return xf(n,[Om(Am(e.firestore),"addDoc",i._key,s,null!==e.converter,{}).toMutation(i._key,sd.exists(!1))]).then(()=>i)}function Sf(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s,r,a;e=Wt(e);let o={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof n[c]||gm(n[c])||(o=n[c],c++);const l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(gm(n[c])){const e=n[c];n[c]=null===(s=e.next)||void 0===s?void 0:s.bind(e),n[c+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),n[c+2]=null===(a=e.complete)||void 0===a?void 0:a.bind(e)}let d,u,h;if(e instanceof um)u=rm(e.firestore,_m),h=hl(e._key.path),d={next:t=>{n[c]&&n[c](Tf(u,e,t))},error:n[c+1],complete:n[c+2]};else{const t=rm(e,dm);u=rm(t.firestore,_m),h=t._query;const i=new _f(u);d={next:e=>{n[c]&&n[c](new mf(u,i,t,e))},error:n[c+1],complete:n[c+2]},Xm(e._query)}return function(e,t,n,i){const s=new Gp(i),r=new dp(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>ip(await Jp(e),r)),()=>{s.$a(),e.asyncQueue.enqueueAndForget(async()=>sp(await Jp(e),r))}}(ym(u),h,l,d)}function xf(e,t){return function(e,t){const n=new mo;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const i=Vp(e);try{const e=await function(e,t){const n=uo(e),i=Co.now(),s=t.reduce((e,t)=>e.add(t.key),Ul());let r,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=Il(),c=Ul();return n.os.getEntries(e,s).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(s=>{r=s;const a=[];for(const e of t){const t=dd(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new pd(e.key,t,Lc(t.value.mapValue),sd.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,a,t)}).next(t=>{a=t;const i=t.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)})}).then(()=>({batchId:a.batchId,changes:Dl(r)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.xa[e.currentUser.toKey()];i||(i=new tc(wo)),i=i.insert(t,n),e.xa[e.currentUser.toKey()]=i}(i,e.batchId,n),await Lp(i,e.changes),await Mh(i.remoteStore)}catch(e){const t=Qh(e,"Failed to persist write");n.reject(t)}}(await Xp(e),t,n)),n.promise}(ym(e),t)}function Tf(e,t,n){const i=n.docs.get(t._key),s=new _f(e);return new hf(e,s,t._key,i,new uf(n.hasPendingWrites,n.fromCache),t.converter)}function wf(){return new km("serverTimestamp")}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){to=e}(si),$n(new Ht("firestore",(e,n)=>{let{instanceIdentifier:i,options:s}=n;const r=e.getProvider("app").getImmediate(),a=new _m(new yo(e.getProvider("auth-internal")),new So(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new po(ho.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _c(e.options.projectId,t)}(r,i),r);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),oi($a,"4.6.3",e),oi($a,"4.6.3","esm2017")}();const Nf="functions";class Cf{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(ty){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(ty){return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const Rf="us-central1";class If{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Rf,r=arguments.length>5?arguments[5]:void 0;this.app=e,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new Cf(t,n,i),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(s);this.customDomain=e.origin,this.region=Rf}catch(ty){this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){const n=this.emulatorOrigin;return"".concat(n,"/").concat(t,"/").concat(this.region,"/").concat(e)}return null!==this.customDomain?"".concat(this.customDomain,"/").concat(e):"https://".concat(this.region,"-").concat(t,".cloudfunctions.net/").concat(e)}}const Af="@firebase/functions",Of="0.11.5";!function(e,t){$n(new Ht(Nf,(t,n)=>{let{instanceIdentifier:i}=n;const s=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),a=t.getProvider("messaging-internal"),o=t.getProvider("app-check-internal");return new If(s,r,a,o,i,e)},"PUBLIC").setMultipleInstances(!0)),oi(Af,Of,t),oi(Af,Of,"esm2017")}(fetch.bind(self));const Df=ri({apiKey:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",authDomain:"elderx-f5c2b.firebaseapp.com",projectId:"elderx-f5c2b",storageBucket:"elderx-f5c2b.firebasestorage.app",messagingSenderId:"987610993096",appId:"1:987610993096:web:97c82732772d1223d3f0fd"}),kf=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ai();const t=ei(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ei(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(jt(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Ti(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:wa,persistence:[Mr,Er,Sr]}),i=Rt("authTokenSyncURL");if(i&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ia)return;const i=null===t||void 0===t?void 0:t.token;Aa!==i&&(Aa=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:"Bearer ".concat(i)}:{}}))});!function(e,t,n){Wt(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,i){Wt(e).onIdTokenChanged(t,n,i)}(n,e=>t(e))}}var s;const r=wt("auth");return r&&Fs(n,"http://".concat(r)),n}(Df),Pf=function(e,t){const n="string"==typeof e?e:t||"(default)",i=ei("object"==typeof e?e:ai(),"firestore").getImmediate({identifier:n});if(!i._initialized){const e=Nt("firestore");e&&lm(i,...e)}return i}(Df);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ai(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rf;const n=ei(Wt(e),Nf).getImmediate({identifier:t}),i=Nt("functions");i&&function(e,t,n){!function(e,t,n){e.emulatorOrigin="http://".concat(t,":").concat(n)}(Wt(e),t,n)}(n,...i)}(Df);var Lf={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const jf=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],Mf=(e,n)=>{const i=(0,t.forwardRef)((i,s)=>{let{color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:l="",children:d}=i,u=Me(i,jf);return(0,t.createElement)("svg",je(je({ref:s},Lf),{},{width:a,height:a,stroke:r,strokeWidth:c?24*Number(o)/Number(a):o,className:["lucide","lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),l].join(" ")},u),[...n.map(e=>{let[n,i]=e;return(0,t.createElement)(n,i)}),...Array.isArray(d)?d:[d]]);var h});return i.displayName="".concat(e),i},Uf=Mf("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Vf=Mf("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Ff=Mf("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Bf=Mf("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),Gf=Mf("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),Wf=Mf("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Hf=Mf("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Kf=Mf("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),zf=Mf("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),qf=Mf("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Yf=Mf("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var Xf=n(579);const Jf=()=>{const[e,n]=(0,t.useState)(!1),i=ee(),s=Z(),r=async()=>{try{await gr(kf),_t.success("Signed out successfully"),i("/login")}catch(e){_t.error("Error signing out"),console.error("Sign out error:",e)}},a=[{name:"Overview",href:"/dashboard",icon:Uf},{name:"Request Care",href:"/appointments",icon:Vf},{name:"Health Vitals",href:"/vital-signs",icon:Ff},{name:"Telemedicine",href:"/telemedicine",icon:Bf},{name:"Messages",href:"/messages",icon:Gf},{name:"Subscription",href:"/subscription",icon:Wf}],o=e=>s.pathname===e;return(0,Xf.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Xf.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Xf.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>n(!1)}),(0,Xf.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white shadow-xl",children:[(0,Xf.jsxs)("div",{className:"flex h-16 items-center justify-between px-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]}),(0,Xf.jsx)("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Hf,{className:"h-6 w-6"})})]}),(0,Xf.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Xf.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),i(e.href),n(!1)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Xf.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Xf.jsxs)("button",{onClick:r,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Xf.jsx)(Kf,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})]}),(0,Xf.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,Xf.jsxs)("div",{className:"flex flex-col flex-grow bg-white border-r border-gray-200 shadow-sm",children:[(0,Xf.jsx)("div",{className:"flex h-16 items-center px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]})}),(0,Xf.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Xf.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),i(e.href)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Xf.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Xf.jsxs)("button",{onClick:r,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Xf.jsx)(Kf,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})}),(0,Xf.jsxs)("div",{className:"lg:pl-64",children:[(0,Xf.jsxs)("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[(0,Xf.jsx)("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>n(!0),children:(0,Xf.jsx)(zf,{className:"h-6 w-6"})}),(0,Xf.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[(0,Xf.jsx)("div",{className:"flex flex-1"}),(0,Xf.jsxs)("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:[(0,Xf.jsxs)("button",{className:"p-2 text-gray-400 hover:text-gray-500",children:[(0,Xf.jsx)(qf,{className:"h-5 w-5"}),(0,Xf.jsx)("span",{className:"sr-only",children:"Notifications"})]}),(0,Xf.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-400"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Mrs. Adunni Okafor"})]})]})]})]}),(0,Xf.jsx)("main",{className:"py-6",children:(0,Xf.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,Xf.jsx)(ge,{})})})]})]})},Qf=Mf("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Zf=Mf("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),$f=Mf("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),eg=Mf("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),tg=Mf("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),ng=Mf("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),ig=Mf("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),sg=Mf("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),rg=Mf("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),ag=Mf("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),og=Mf("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),cg=Mf("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),lg=()=>{const[e,n]=(0,t.useState)(!1),i=ee(),s=Z(),r=[{name:"Dashboard",href:"/admin",icon:Qf},{name:"Users",href:"/admin/users",icon:Zf},{name:"Appointments",href:"/admin/appointments",icon:$f},{name:"Emergency",href:"/admin/emergency",icon:eg},{name:"Medications",href:"/admin/medications",icon:tg},{name:"Caregivers",href:"/admin/caregivers",icon:ng},{name:"Analytics",href:"/admin/analytics",icon:ig},{name:"Communication",href:"/admin/communication",icon:sg},{name:"Audit Logs",href:"/admin/audit-logs",icon:rg},{name:"Reports",href:"/admin/reports",icon:ag},{name:"Settings",href:"/admin/settings",icon:og}],a=e=>s.pathname===e;return(0,Xf.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Xf.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>n(!1)}),(0,Xf.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Xf.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Xf.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>n(!1),children:(0,Xf.jsx)(Hf,{className:"h-6 w-6 text-white"})})}),(0,Xf.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Xf.jsx)(cg,{className:"h-8 w-8 text-blue-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Admin"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)("a",{href:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(a(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(a(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Xf.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Xf.jsx)("div",{className:"flex flex-col w-64",children:(0,Xf.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Xf.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Xf.jsx)(cg,{className:"h-8 w-8 text-blue-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Admin"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)("a",{href:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(a(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(a(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Xf.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-3",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Admin User"}),(0,Xf.jsxs)("button",{onClick:async()=>{try{await gr(kf),_t.success("Signed out successfully"),i("/login")}catch(e){_t.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Xf.jsx)(Kf,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Xf.jsxs)("div",{className:"lg:pl-64 flex flex-col flex-1",children:[(0,Xf.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Xf.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 lg:hidden",onClick:()=>n(!0),children:(0,Xf.jsx)(zf,{className:"h-6 w-6"})}),(0,Xf.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Xf.jsx)("div",{className:"flex-1 flex",children:(0,Xf.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Xf.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Xf.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:"Admin Panel"})})})})}),(0,Xf.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Xf.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:(0,Xf.jsx)(qf,{className:"h-6 w-6"})}),(0,Xf.jsx)("div",{className:"ml-3 relative",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Admin User"})})]})})]})]})]}),(0,Xf.jsx)("main",{className:"flex-1",children:(0,Xf.jsx)("div",{className:"py-6",children:(0,Xf.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:(0,Xf.jsx)(ge,{})})})})]})]})},dg=Mf("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ug=Mf("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),hg=Mf("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),pg=Mf("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),mg=Mf("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),fg=Mf("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),gg=Mf("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),_g=Mf("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),yg=Mf("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),vg=()=>{const e=[{icon:Ff,title:"Health Monitoring",description:"Continuous monitoring of vital signs and health metrics"},{icon:cg,title:"Secure & Private",description:"Your health data is protected with enterprise-grade security"},{icon:Zf,title:"Caregiver Support",description:"Professional caregivers available 24/7 for your needs"},{icon:dg,title:"24/7 Access",description:"Round-the-clock support and emergency response"}],t=[{icon:ug,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",color:"text-blue-600",bgColor:"bg-blue-100"},{icon:$f,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",color:"text-green-600",bgColor:"bg-green-100"},{icon:qf,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",color:"text-red-600",bgColor:"bg-red-100"},{icon:Bf,title:"Telemedicine",description:"Video consultations with doctors and specialists.",color:"text-purple-600",bgColor:"bg-purple-100"},{icon:Zf,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",color:"text-orange-600",bgColor:"bg-orange-100"},{icon:cg,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",color:"text-blue-600",bgColor:"bg-blue-100"}];return(0,Xf.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,Xf.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:(0,Xf.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsxs)("div",{className:"flex-shrink-0 flex items-center",children:[(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Xf.jsx)("p",{className:"ml-4 text-sm text-gray-600 hidden sm:block",children:"Professional Home Healthcare"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)(Re,{to:"/login",className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Sign In"}),(0,Xf.jsx)(Re,{to:"/signup",className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700",children:"Get Started"})]})]})})}),(0,Xf.jsx)("section",{className:"relative py-16 sm:py-24 lg:py-32",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[(0,Xf.jsxs)("div",{className:"text-center lg:text-left",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:"NG Proudly Nigerian \u2022 NDPR Compliant"}),(0,Xf.jsxs)("h1",{className:"mt-4 text-4xl font-extrabold text-gray-900 sm:text-5xl md:text-6xl",children:["Quality ",(0,Xf.jsx)("span",{className:"text-teal-600",children:"Healthcare"})," At Your ",(0,Xf.jsx)("span",{className:"text-green-600",children:"Doorstep"})]}),(0,Xf.jsx)("p",{className:"mt-6 text-lg text-gray-600 max-w-xl mx-auto lg:mx-0",children:"ElderCare Nigeria provides compassionate and professional home healthcare services, ensuring comfort and well-being for your loved ones."}),(0,Xf.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center lg:justify-start",children:[(0,Xf.jsxs)(Re,{to:"/signup",className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:["Start Your Care Journey",(0,Xf.jsx)(hg,{className:"ml-2 h-5 w-5"})]}),(0,Xf.jsxs)("a",{href:"tel:0800-ELDERCARE",className:"inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[(0,Xf.jsx)(pg,{className:"mr-2 h-5 w-5 text-blue-600"}),"Call: 0800-ELDERCARE"]})]}),(0,Xf.jsxs)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-3 gap-6 text-gray-600",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Xf.jsx)(mg,{className:"h-5 w-5 text-green-500 mr-2"}),"Licensed Professionals"]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 text-blue-500 mr-2"}),"Secure & Private"]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Xf.jsx)(dg,{className:"h-5 w-5 text-purple-500 mr-2"}),"24/7 Emergency Support"]})]})]}),(0,Xf.jsx)("div",{className:"relative mt-12 lg:mt-0 flex justify-center",children:(0,Xf.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-sm",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)("img",{className:"h-12 w-12 rounded-full object-cover",src:"https://images.unsplash.com/photo-1559839734-2b716b1772a1?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",alt:"Nurse Fatima Abdullahi"}),(0,Xf.jsxs)("div",{className:"ml-3",children:[(0,Xf.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"Nurse Fatima Abdullahi"}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500 flex items-center",children:[(0,Xf.jsx)(Ff,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-yellow-500",children:"\u2605"})," 4.9 (156 visits)"]})]})]}),(0,Xf.jsx)("div",{className:"bg-green-50 p-3 rounded-lg mb-4",children:(0,Xf.jsx)("p",{className:"text-sm text-green-800",children:'"Hello! I\'ll be arriving at your location in 15 minutes. Please ensure the gate is open."'})}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center border-t border-gray-200 pt-4",children:[(0,Xf.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800",children:[(0,Xf.jsx)(Gf,{className:"h-5 w-5 mr-1"}),"Reply"]}),(0,Xf.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800",children:[(0,Xf.jsx)(Bf,{className:"h-5 w-5 mr-1"}),"Video Call"]})]})]})})]})}),(0,Xf.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-12",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Why Choose ElderCare Nigeria?"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"We provide comprehensive healthcare solutions designed specifically for Nigerian families"})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:e.map((e,t)=>{const n=e.icon;return(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Xf.jsx)(n,{className:"h-8 w-8 text-blue-600"})}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),(0,Xf.jsx)("p",{className:"text-gray-600",children:e.description})]},t)})})]})}),(0,Xf.jsx)("section",{className:"py-16",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-12",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map((e,t)=>{const n=e.icon;return(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Xf.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Xf.jsx)(n,{className:"h-8 w-8 ".concat(e.color)})}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Xf.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]})}),(0,Xf.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-12",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"What Our Clients Say"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600",children:"Real stories from families who trust ElderCare Nigeria"})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{name:"Mrs. Adunni Okafor",location:"Lagos, Nigeria",rating:5,text:"ElderCare Nigeria has been a blessing for my family. The caregivers are professional and caring, and the 24/7 support gives us peace of mind."},{name:"Dr. Kemi Adebayo",location:"Abuja, Nigeria",rating:5,text:"As a healthcare professional, I can confidently recommend ElderCare Nigeria. Their services are top-notch and their technology is cutting-edge."},{name:"Mr. Chinedu Okoro",location:"Port Harcourt, Nigeria",rating:5,text:"The medication management system has been incredibly helpful. I never miss a dose anymore, and my family is always informed about my health status."}].map((e,t)=>(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,Xf.jsx)("div",{className:"flex items-center mb-4",children:[...Array(e.rating)].map((e,t)=>(0,Xf.jsx)(fg,{className:"h-5 w-5 text-yellow-400 fill-current"},t))}),(0,Xf.jsxs)("p",{className:"text-gray-600 mb-4 italic",children:['"',e.text,'"']}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-blue-600"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500 flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-1"}),e.location]})]})]})]},t))})]})}),(0,Xf.jsx)("section",{className:"py-16 bg-gradient-to-r from-blue-600 to-green-600",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Ready to Get Started?"}),(0,Xf.jsx)("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Join thousands of Nigerian families who trust ElderCare Nigeria for their healthcare needs"}),(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,Xf.jsxs)(Re,{to:"/signup",className:"inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-gray-50",children:[(0,Xf.jsx)(_g,{className:"mr-2 h-5 w-5"}),"Start Your Care Journey"]}),(0,Xf.jsxs)(Re,{to:"/pricing",className:"inline-flex items-center justify-center px-8 py-3 border border-white text-base font-medium rounded-md text-white hover:bg-white hover:text-blue-600",children:[(0,Xf.jsx)(yg,{className:"mr-2 h-5 w-5"}),"View Our Plans"]})]})]})}),(0,Xf.jsx)("footer",{className:"bg-white py-8 border-t border-gray-200",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,Xf.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Xf.jsx)("p",{className:"text-gray-600 mb-4",children:"Professional home healthcare services for Nigerian families. Compassionate care, advanced technology, and 24/7 support."}),(0,Xf.jsxs)("div",{className:"flex space-x-4",children:[(0,Xf.jsx)("a",{href:"tel:0800-ELDERCARE",className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-5 w-5"})}),(0,Xf.jsx)("a",{href:"mailto:info@eldercare.ng",className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(Gf,{className:"h-5 w-5"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Services"}),(0,Xf.jsxs)("ul",{className:"space-y-2",children:[(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Home Visits"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Vitals Monitoring"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Emergency Support"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Telemedicine"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Company"}),(0,Xf.jsxs)("ul",{className:"space-y-2",children:[(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/pricing",className:"text-gray-600 hover:text-blue-600",children:"Pricing"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/about",className:"text-gray-600 hover:text-blue-600",children:"About Us"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/contact",className:"text-gray-600 hover:text-blue-600",children:"Contact"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/privacy",className:"text-gray-600 hover:text-blue-600",children:"Privacy Policy"})})]})]})]}),(0,Xf.jsxs)("div",{className:"border-t border-gray-200 mt-8 pt-8 text-center",children:[(0,Xf.jsx)("p",{className:"text-gray-500 text-sm",children:"\xa9 2024 ElderCare Nigeria. All rights reserved."}),(0,Xf.jsxs)("p",{className:"text-gray-500 text-sm mt-2",children:["Made by ",(0,Xf.jsx)("a",{href:"https://mgx.dev",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"MGX"})]})]})]})})]})},Eg=Mf("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),bg=Mf("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Sg=()=>{const[e,n]=(0,t.useState)(""),[i,s]=(0,t.useState)(""),[r,a]=(0,t.useState)(!1),o=ee();return(0,Xf.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,Xf.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"flex justify-center mb-6",children:(0,Xf.jsx)("div",{className:"p-4 bg-blue-100 rounded-2xl",children:(0,Xf.jsx)(Ff,{className:"h-12 w-12 text-blue-600"})})}),(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to ElderX"}),(0,Xf.jsx)("p",{className:"text-gray-600 text-lg",children:"Your trusted health companion"})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{t.preventDefault(),a(!0);try{await function(e,t,n){return ti(e.app)?Promise.reject(Ci(e)):pr(Wt(e),Zs.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&mr(e),t})}(kf,e,i),_t.success("Welcome back!"),o("/dashboard")}catch(n){console.error("Login error:",n);let e="An error occurred during login";switch(n.code){case"auth/user-not-found":e="No account found with this email";break;case"auth/wrong-password":e="Incorrect password";break;case"auth/invalid-credential":e="Invalid email or password. Please check your credentials.";break;case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/operation-not-allowed":e="Email/password login is not enabled. Please contact support.";break;case"auth/too-many-requests":e="Too many failed attempts. Please try again later.";break;default:e=n.message||"An unexpected error occurred"}_t.error(e)}finally{a(!1)}},children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"email",className:"form-label",children:[(0,Xf.jsx)(Eg,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,Xf.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Enter your email",value:e,onChange:e=>n(e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"password",className:"form-label",children:[(0,Xf.jsx)(bg,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,Xf.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"form-input",placeholder:"Enter your password",value:i,onChange:e=>s(e.target.value)})]})]}),(0,Xf.jsx)("div",{children:(0,Xf.jsx)("button",{type:"submit",disabled:r,className:"btn btn-primary w-full",children:r?"Signing in...":"Sign In"})}),(0,Xf.jsxs)("div",{className:"text-center space-y-2",children:[(0,Xf.jsxs)("p",{className:"text-gray-600",children:["Don't have an account?"," ",(0,Xf.jsx)(Re,{to:"/signup",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign up here"})]}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,Xf.jsx)("p",{children:"Demo Account:"}),(0,Xf.jsx)("p",{children:"Email: demo@elderx.com | Password: demo123"})]})]})]})})]})})},xg=()=>{const[e,n]=(0,t.useState)({displayName:"",email:"",password:"",confirmPassword:"",userType:"elderly"}),[i,s]=(0,t.useState)(!1),r=ee(),a=t=>{n(je(je({},e),{},{[t.target.name]:t.target.value}))};return(0,Xf.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,Xf.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"flex justify-center mb-6",children:(0,Xf.jsx)("div",{className:"p-4 bg-blue-100 rounded-2xl",children:(0,Xf.jsx)(Ff,{className:"h-12 w-12 text-blue-600"})})}),(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Join ElderX"}),(0,Xf.jsx)("p",{className:"text-gray-600 text-lg",children:"Create your account to get started"})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{if(t.preventDefault(),e.password===e.confirmPassword)if(e.password.length<6)_t.error("Password must be at least 6 characters");else{s(!0);try{const{user:t}=await async function(e,t,n){if(ti(e.app))return Promise.reject(Ci(e));const i=Ds(e),s=Vs(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rr),r=await s.catch(t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&mr(e),t}),a=await ar._fromIdTokenResponse(i,"signIn",r);return await i._updateCurrentUser(a.user),a}(kf,e.email,e.password);await fr(t,{displayName:e.displayName}),_t.success("Account created successfully!"),r("/dashboard")}catch(n){console.error("Signup error:",n);let e="An error occurred during signup";switch(n.code){case"auth/email-already-in-use":e="This email is already registered";break;case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/operation-not-allowed":e="Email/password signup is not enabled. Please contact support.";break;case"auth/weak-password":e="Password should be at least 6 characters";break;default:e=n.message||"An unexpected error occurred"}_t.error(e)}finally{s(!1)}}else _t.error("Passwords do not match")},children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"displayName",className:"form-label",children:[(0,Xf.jsx)(Yf,{className:"inline h-4 w-4 mr-2"}),"Full Name"]}),(0,Xf.jsx)("input",{id:"displayName",name:"displayName",type:"text",autoComplete:"name",required:!0,className:"form-input",placeholder:"Enter your full name",value:e.displayName,onChange:a})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"userType",className:"form-label",children:[(0,Xf.jsx)(ng,{className:"inline h-4 w-4 mr-2"}),"Account Type"]}),(0,Xf.jsxs)("select",{id:"userType",name:"userType",className:"form-input",value:e.userType,onChange:a,children:[(0,Xf.jsx)("option",{value:"elderly",children:"Elderly Person"}),(0,Xf.jsx)("option",{value:"caregiver",children:"Caregiver"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"email",className:"form-label",children:[(0,Xf.jsx)(Eg,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,Xf.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Enter your email",value:e.email,onChange:a})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"password",className:"form-label",children:[(0,Xf.jsx)(bg,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,Xf.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Create a password",value:e.password,onChange:a})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"confirmPassword",className:"form-label",children:[(0,Xf.jsx)(bg,{className:"inline h-4 w-4 mr-2"}),"Confirm Password"]}),(0,Xf.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Confirm your password",value:e.confirmPassword,onChange:a})]})]}),(0,Xf.jsx)("div",{children:(0,Xf.jsx)("button",{type:"submit",disabled:i,className:"btn btn-primary w-full",children:i?"Creating Account...":"Create Account"})}),(0,Xf.jsx)("div",{className:"text-center",children:(0,Xf.jsxs)("p",{className:"text-gray-600",children:["Already have an account?"," ",(0,Xf.jsx)(Re,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in here"})]})})]})})]})})},Tg=()=>(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Welcome back, Adunni"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Age"}),(0,Xf.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:"72 years"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Emergency Contact"}),(0,Xf.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:"Dr. Kemi Okafor"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"+234 801 987 6543"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Subscription"}),(0,Xf.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:"Premium"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Medical Conditions"}),(0,Xf.jsxs)("div",{className:"flex flex-wrap gap-2 mt-1",children:[(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:"Hypertension"}),(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:"Diabetes Type 2"})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("button",{className:"w-full bg-red-600 text-white py-4 px-6 rounded-lg font-bold text-lg hover:bg-red-700 transition-colors",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 inline mr-2"}),"EMERGENCY - NEED HELP NOW"]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Xf.jsxs)("button",{className:"bg-orange-100 text-orange-700 py-3 px-4 rounded-lg hover:bg-orange-200 transition-colors",children:[(0,Xf.jsx)(pg,{className:"h-5 w-5 inline mr-2"}),"Family"]}),(0,Xf.jsxs)("button",{className:"bg-blue-100 text-blue-700 py-3 px-4 rounded-lg hover:bg-blue-200 transition-colors",children:[(0,Xf.jsx)(Ff,{className:"h-5 w-5 inline mr-2"}),"Doctor"]})]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(Vf,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"1"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"Upcoming Visits"})]}),(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-red-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"140/90"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"Last BP Reading"})]}),(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(Gf,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"3"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"New Messages"})]}),(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(pg,{className:"h-8 w-8 text-purple-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"24/7"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"Support Available"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upcoming Care Visits"}),(0,Xf.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900",children:"Medication Administration"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Caregiver TBD"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Time TBD"})]}),(0,Xf.jsx)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:"Pending"})]})})]})]}),wg=Mf("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ng=Mf("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Cg=Mf("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),Rg=Mf("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ig=()=>{const[e,n]=(0,t.useState)(!1),[i,s]=(0,t.useState)(null),[r,a]=(0,t.useState)([{id:1,name:"Aspirin",dosage:"100mg",frequency:"Daily",instructions:"Take with food",nextDose:"8:00 AM",taken:!0,startDate:"2024-01-15",endDate:null},{id:2,name:"Vitamin D",dosage:"2000IU",frequency:"Weekly",instructions:"Take in the morning",nextDose:"9:00 AM",taken:!1,startDate:"2024-01-10",endDate:null},{id:3,name:"Blood Pressure Medication",dosage:"10mg",frequency:"Twice Daily",instructions:"Take with water",nextDose:"2:00 PM",taken:!1,startDate:"2024-01-20",endDate:null}]),[o,c]=(0,t.useState)({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:"",endDate:""});return(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medications"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your medications and track doses"})]}),(0,Xf.jsxs)("button",{onClick:()=>n(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4"}),"Add Medication"]})]}),e&&(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Medication"}),(0,Xf.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=je(je({id:Date.now()},o),{},{nextDose:"8:00 AM",taken:!1});a([...r,t]),c({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:"",endDate:""}),n(!1),_t.success("Medication added successfully")},className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Medication Name"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:o.name,onChange:e=>c(je(je({},o),{},{name:e.target.value})),required:!0})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Dosage"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:o.dosage,onChange:e=>c(je(je({},o),{},{dosage:e.target.value})),required:!0})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Frequency"}),(0,Xf.jsxs)("select",{className:"form-input",value:o.frequency,onChange:e=>c(je(je({},o),{},{frequency:e.target.value})),children:[(0,Xf.jsx)("option",{value:"Daily",children:"Daily"}),(0,Xf.jsx)("option",{value:"Twice Daily",children:"Twice Daily"}),(0,Xf.jsx)("option",{value:"Weekly",children:"Weekly"}),(0,Xf.jsx)("option",{value:"As Needed",children:"As Needed"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Start Date"}),(0,Xf.jsx)("input",{type:"date",className:"form-input",value:o.startDate,onChange:e=>c(je(je({},o),{},{startDate:e.target.value})),required:!0})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Instructions"}),(0,Xf.jsx)("textarea",{className:"form-input form-textarea",value:o.instructions,onChange:e=>c(je(je({},o),{},{instructions:e.target.value})),placeholder:"e.g., Take with food, Take on empty stomach"})]}),(0,Xf.jsxs)("div",{className:"flex space-x-4",children:[(0,Xf.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Add Medication"}),(0,Xf.jsx)("button",{type:"button",onClick:()=>n(!1),className:"btn btn-outline",children:"Cancel"})]})]})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 gap-4",children:r.map(e=>(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(tg,{className:"h-8 w-8 text-blue-600 mr-4"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-gray-600",children:[e.dosage," \u2022 ",e.frequency]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:e.instructions}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-400",children:[(0,Xf.jsx)(Vf,{className:"h-3 w-3 mr-1"}),"Started: ",e.startDate]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsxs)("div",{className:"text-right",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Next Dose"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:e.nextDose}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[e.taken?(0,Xf.jsx)(mg,{className:"h-4 w-4 text-green-500 mr-1"}):(0,Xf.jsx)(Ng,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-xs text-gray-500",children:e.taken?"Taken":"Pending"})]})]}),(0,Xf.jsxs)("div",{className:"flex space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,a(r.map(e=>e.id===t?je(je({},e),{},{taken:!e.taken}):e)),void _t.success("Medication status updated");var t},className:"btn ".concat(e.taken?"btn-outline":"btn-success"),children:e.taken?"Mark as Missed":"Mark as Taken"}),(0,Xf.jsx)("button",{onClick:()=>s(e),className:"btn btn-outline",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,a(r.filter(e=>e.id!==t)),void _t.success("Medication deleted successfully");var t},className:"btn btn-danger",children:(0,Xf.jsx)(Rg,{className:"h-4 w-4"})})]})]})]})},e.id))}),0===r.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(tg,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No medications added yet"}),(0,Xf.jsx)("p",{className:"text-gray-500 mb-4",children:"Start by adding your first medication"}),(0,Xf.jsxs)("button",{onClick:()=>n(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Add Your First Medication"]})]})]})},Ag=Mf("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),Og=Mf("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Dg=()=>{const[e,n]=(0,t.useState)({vitalType:"Blood Pressure",reading:"",notes:""}),i=[{id:1,type:"Blood Pressure",value:"140/90",unit:"mmHg",timestamp:"9/3/2025, 9:00:00 AM",status:"Warning",statusColor:"bg-yellow-100 text-yellow-800",icon:Ff},{id:2,type:"Blood Sugar",value:"120",unit:"mg/dL",timestamp:"9/3/2025, 9:15:00 AM",status:"Normal",statusColor:"bg-green-100 text-green-800",icon:Ag}],s=[{id:1,type:"Blood Pressure",trend:"Improving",trendColor:"text-green-600",average:"Average",icon:Ff}],r=e=>{switch(e){case"Normal":return"bg-green-100 text-green-800";case"Warning":return"bg-yellow-100 text-yellow-800";case"Critical":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,Xf.jsxs)("div",{className:"space-y-8",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Current Vitals"})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:i.map(e=>{const t=e.icon;return(0,Xf.jsxs)("div",{className:"p-6 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.type})]}),(0,Xf.jsx)("span",{className:"px-3 py-1 rounded text-sm font-medium ".concat(r(e.status)),children:e.status})]}),(0,Xf.jsxs)("div",{className:"mb-2",children:[(0,Xf.jsx)("span",{className:"text-3xl font-bold text-gray-900",children:e.value}),(0,Xf.jsx)("span",{className:"text-lg text-gray-600 ml-2",children:e.unit})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:e.timestamp})]},e.id)})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(wg,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Record New Reading"})]}),(0,Xf.jsxs)("form",{onSubmit:t=>{t.preventDefault(),console.log("Vital reading submitted:",e),_t.success("Vital reading saved successfully"),n({vitalType:"Blood Pressure",reading:"",notes:""})},className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vital Type"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("select",{value:e.vitalType,onChange:t=>n(je(je({},e),{},{vitalType:t.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure","Blood Sugar","Heart Rate","Temperature","Weight","Oxygen Saturation","Respiratory Rate","Pain Level"].map(e=>(0,Xf.jsx)("option",{value:e,children:e},e))}),(0,Xf.jsx)(Og,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reading"}),(0,Xf.jsx)("input",{type:"text",value:e.reading,onChange:t=>n(je(je({},e),{},{reading:t.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., 120/80 or 98.6",required:!0})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,Xf.jsx)("textarea",{value:e.notes,onChange:t=>n(je(je({},e),{},{notes:t.target.value})),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Any additional observations..."})]}),(0,Xf.jsx)("div",{className:"flex justify-end",children:(0,Xf.jsxs)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center hover:bg-blue-700 transition-colors",children:[(0,Xf.jsx)(wg,{className:"h-5 w-5 mr-2"}),"Save Reading"]})})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(ig,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Health Trends (Last 7 Days)"})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:s.map(e=>{const t=e.icon;return(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900",children:e.type}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium ".concat(e.trendColor),children:e.trend}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:e.average})]})]})]}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"View Details"})]},e.id)})})]})]})},kg=Mf("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Pg=()=>{const[e,n]=(0,t.useState)("immediate"),[i,s]=(0,t.useState)({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""}),r=e=>{switch(e){case"Available":return"bg-green-100 text-green-800";case"Busy":default:return"bg-gray-100 text-gray-800";case"In Progress":return"bg-blue-100 text-blue-800";case"Pending":return"bg-yellow-100 text-yellow-800"}},a=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-orange-100 text-orange-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return(0,Xf.jsxs)("div",{className:"space-y-8",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(ug,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Request Care Service"})]}),(0,Xf.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,Xf.jsxs)("button",{onClick:()=>n("immediate"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("immediate"===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Xf.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-current flex items-center justify-center mr-3",children:(0,Xf.jsx)("span",{className:"text-xs font-bold",children:"!"})}),"Need Care Now"]}),(0,Xf.jsxs)("button",{onClick:()=>n("scheduled"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("scheduled"===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Xf.jsx)(Vf,{className:"h-5 w-5 mr-3"}),"Schedule Visit"]})]}),(0,Xf.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Care request submitted:",i),s({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""})},className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type of Care Needed"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("select",{value:i.careType,onChange:e=>s(je(je({},i),{},{careType:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure Check","Medication Administration","Wound Care","Physical Therapy","Vital Signs Monitoring","Meal Preparation","Companionship","Transportation","Housekeeping","Emergency Response"].map(e=>(0,Xf.jsx)("option",{value:e,children:e},e))}),(0,Xf.jsx)(Og,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),"scheduled"===e&&(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Date"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("input",{type:"date",value:i.preferredDate,onChange:e=>s(je(je({},i),{},{preferredDate:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"mm/dd/yyyy"}),(0,Xf.jsx)(Vf,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Time"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("input",{type:"time",value:i.preferredTime,onChange:e=>s(je(je({},i),{},{preferredTime:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"--:--"}),(0,Xf.jsx)(dg,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("textarea",{value:i.additionalNotes,onChange:e=>s(je(je({},i),{},{additionalNotes:e.target.value})),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Please describe your symptoms or specific care needs..."}),(0,Xf.jsx)(kg,{className:"absolute bottom-3 right-3 h-4 w-4 text-gray-400"})]})]}),(0,Xf.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors",children:"immediate"===e?"Request Immediate Care":"Schedule Care Visit"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Caregivers Nearby"})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:[{id:1,name:"Nurse Fatima Abdullahi",specialty:"Geriatric Care",rating:4.8,location:"Victoria Island, Lagos",status:"Available",visits:156,avatar:null},{id:2,name:"Dr. Chinedu Okoro",specialty:"General Medicine",rating:4.9,location:"Ikeja, Lagos",status:"Busy",visits:89,avatar:null}].map(e=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.specialty}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e.rating})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e.location})]})]})]})]}),(0,Xf.jsxs)("div",{className:"text-right",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(r(e.status)),children:e.status}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e.visits," visits"]})]})]},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Recent Care Requests"}),(0,Xf.jsx)("div",{className:"space-y-4",children:[{id:1,title:"Blood Pressure Check",assignedCaregiver:"Nurse Fatima Abdullahi",createdDate:"9/1/2025",scheduledDate:"9/3/2025, 2:00:00 PM",description:"Regular weekly checkup",status:"In Progress",priority:"Medium"},{id:2,title:"Medication Administration",assignedCaregiver:"Caregiver not assigned yet",createdDate:"9/3/2025",scheduledDate:null,description:"Daily medication reminder and administration",status:"Pending",priority:"High"}].map(e=>(0,Xf.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:e.title}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.assignedCaregiver}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{children:e.createdDate})]}),e.scheduledDate&&(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{children:e.scheduledDate})]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,Xf.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(r(e.status)),children:e.status}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(a(e.priority)),children:e.priority})]})]})},e.id))})]})]})},Lg=()=>{const e="John Doe",t="john.doe@example.com",n="elderly",i="1950-05-15",s={name:"Alice Johnson",phone:"555-1234"},r="Dr. Smith",a="Penicillin, Shellfish",o="Hypertension, Diabetes Type 2";return(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your personal and medical information"})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Personal Information"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Full Name"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:e})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:t})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Date of Birth"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:i})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Account Type"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900 capitalize",children:n})]})]})]}),(0,Xf.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Personal Info"})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medical Information"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Primary Care Doctor"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:r})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Allergies"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:a})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Medical Conditions"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:o})]})]}),(0,Xf.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Medical Info"})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Emergency Contact"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Name"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:s.name})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:s.phone})]})]})]}),(0,Xf.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Emergency Contact"})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Health Summary"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Active Medications"}),(0,Xf.jsx)("span",{className:"font-semibold text-gray-900",children:"5"})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Upcoming Appointments"}),(0,Xf.jsx)("span",{className:"font-semibold text-gray-900",children:"2"})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Vital Signs This Week"}),(0,Xf.jsx)("span",{className:"font-semibold text-gray-900",children:"12"})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Medication Adherence"}),(0,Xf.jsx)("span",{className:"font-semibold text-green-600",children:"95%"})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary mt-4",children:[(0,Xf.jsx)(Ff,{className:"h-4 w-4 mr-2"}),"View Health Reports"]})]})]})]})},jg=Mf("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Mg=Mf("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Ug=Mf("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Vg=()=>{const[e,n]=(0,t.useState)(null),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)([]),[o,c]=(0,t.useState)({}),[l,d]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e={id:1,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",profileImage:null,rating:4.8,totalPatients:8,currentPatients:3,experience:"5 years",joinDate:"2023-06-15",hourlyRate:2500,totalEarnings:21e5,thisMonthEarnings:18e4,performance:{punctuality:95,patientSatisfaction:4.8,taskCompletion:98,communication:4.7,safety:100}};n(e),s([{id:1,patientName:"Adunni Okafor",patientId:"ELD001",time:"09:00",duration:"8 hours",address:"123 Victoria Island, Lagos",tasks:["Morning medication administration","Breakfast preparation","Physical therapy exercises","Lunch preparation","Afternoon medication","Evening care routine"],status:"upcoming",notes:"Patient has diabetes - monitor blood sugar levels",emergencyContact:"+234 801 987 6543"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",time:"14:00",duration:"4 hours",address:"456 Ikoyi, Lagos",tasks:["Medication administration","Light housekeeping","Companionship","Evening meal preparation"],status:"upcoming",notes:"Patient prefers quiet environment",emergencyContact:"+234 803 456 7890"}]),a([{id:1,patientName:"Adunni Okafor",task:"Medication Administration",completedAt:"2024-01-20T08:30:00Z",status:"completed",notes:"Patient took medication without issues"},{id:2,patientName:"Grace Johnson",task:"Physical Therapy",completedAt:"2024-01-20T10:15:00Z",status:"completed",notes:"Completed 30 minutes of exercises"},{id:3,patientName:"Adunni Okafor",task:"Blood Sugar Check",completedAt:"2024-01-20T12:00:00Z",status:"completed",notes:"Blood sugar: 120 mg/dL - within normal range"}]),c(e.performance),d(!1)},1e3)}catch(e){console.error("Error loading caregiver data:",e),d(!1)}})()},[]);const u=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"upcoming":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return l?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"h-full bg-gray-50",children:[(0,Xf.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-white font-medium",children:null===e||void 0===e?void 0:e.name.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsxs)("div",{className:"ml-3",children:[(0,Xf.jsxs)("h1",{className:"text-xl font-semibold text-gray-900",children:["Welcome, ",null===e||void 0===e?void 0:e.name]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Caregiver Dashboard"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(qf,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(og,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Kf,{className:"h-6 w-6"})})]})]})}),(0,Xf.jsx)("div",{className:"flex-1 p-6",children:(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Today's Visits"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]})]})}),(0,Xf.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed Tasks"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.filter(e=>"completed"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(fg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Rating"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:null===e||void 0===e?void 0:e.rating})]})]})}),(0,Xf.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(ig,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"This Month"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20a6",null===e||void 0===e?void 0:e.thisMonthEarnings.toLocaleString()]})]})]})})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Xf.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Today's Schedule"})}),(0,Xf.jsx)("div",{className:"p-6",children:(0,Xf.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(u(e.status)),children:e.status})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mb-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-1"}),e.time," (",e.duration,")"]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-1"}),e.address]})]}),(0,Xf.jsxs)("div",{className:"mb-3",children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tasks:"}),(0,Xf.jsx)("ul",{className:"list-disc list-inside text-sm text-gray-600 space-y-1",children:e.tasks.map((e,t)=>(0,Xf.jsx)("li",{children:e},t))})]}),e.notes&&(0,Xf.jsxs)("div",{className:"mb-3",children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Notes:"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.notes})]})]}),(0,Xf.jsxs)("div",{className:"flex flex-col space-y-2 ml-4",children:[(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock in for schedule:",t);var t},className:"btn btn-primary text-sm",children:"Clock In"}),(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock out for schedule:",t);var t},className:"btn btn-secondary text-sm",children:"Clock Out"}),(0,Xf.jsxs)("button",{onClick:()=>{return t=e.patientId,void console.log("Emergency for patient:",t);var t},className:"btn btn-red text-sm",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 mr-1"}),"Emergency"]})]})]})},e.id))})})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Xf.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Tasks"})}),(0,Xf.jsx)("div",{className:"p-6",children:(0,Xf.jsx)("div",{className:"space-y-3",children:r.map(e=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)(mg,{className:"h-5 w-5 text-green-600"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.task}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.patientName}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.completedAt).toLocaleString()})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(u(e.status)),children:e.status}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})})]})]},e.id))})})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Xf.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Performance Overview"})}),(0,Xf.jsx)("div",{className:"p-6",children:(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Punctuality"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2 mr-3",children:(0,Xf.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat(o.punctuality,"%")}})}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[o.punctuality,"%"]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Task Completion"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2 mr-3",children:(0,Xf.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(o.taskCompletion,"%")}})}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[o.taskCompletion,"%"]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Patient Satisfaction"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:o.patientSatisfaction})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Communication"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:o.communication})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Safety Record"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2 mr-3",children:(0,Xf.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat(o.safety,"%")}})}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[o.safety,"%"]})]})]})]})})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Xf.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Quick Actions"})}),(0,Xf.jsx)("div",{className:"p-6",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,Xf.jsxs)("button",{className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(sg,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Messages"})]}),(0,Xf.jsxs)("button",{className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(Mg,{className:"h-5 w-5 text-green-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Photo Update"})]}),(0,Xf.jsxs)("button",{className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ag,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Add Note"})]}),(0,Xf.jsxs)("button",{className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(Ug,{className:"h-5 w-5 text-orange-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Navigation"})]})]})})]})]})]})})]})},Fg=Mf("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Bg=Mf("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Gg=Mf("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Wg=()=>{const[e,n]=(0,t.useState)(new Date),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(new Date);(0,t.useEffect)(()=>{l()},[o]);const l=async()=>{try{a(!0),setTimeout(()=>{s([{id:1,patientName:"Adunni Okafor",patientAge:72,patientAddress:"123 Victoria Island, Lagos",patientPhone:"+234 801 234 5678",appointmentTime:"09:00",duration:60,type:"Home Visit",status:"scheduled",tasks:["Medication administration","Vital signs check","Meal preparation","Light housekeeping"],notes:"Patient has diabetes, check blood sugar levels",priority:"high",estimatedTravelTime:25},{id:2,patientName:"Tunde Adebayo",patientAge:68,patientAddress:"456 Ikoyi, Lagos",patientPhone:"+234 802 345 6789",appointmentTime:"11:30",duration:90,type:"Home Visit",status:"scheduled",tasks:["Physical therapy exercises","Medication reminder","Grocery shopping","Companionship"],notes:"Patient recovering from hip surgery",priority:"medium",estimatedTravelTime:15},{id:3,patientName:"Grace Johnson",patientAge:75,patientAddress:"789 Lekki, Lagos",patientPhone:"+234 803 456 7890",appointmentTime:"14:00",duration:45,type:"Home Visit",status:"completed",tasks:["Medication administration","Vital signs check","Meal preparation"],notes:"Regular checkup visit",priority:"low",estimatedTravelTime:30}]),a(!1)},1e3)}catch(e){console.error("Error loading schedule data:",e),a(!1)}},d=e=>{switch(e){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},u=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},h=e=>e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),p=e=>{const t=new Date(o);t.setDate(t.getDate()+e),c(t)};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Today's Schedule"}),(0,Xf.jsxs)("p",{className:"text-gray-600",children:["Your appointments and tasks for ",h(o)]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("button",{onClick:()=>p(-1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Xf.jsx)(Bg,{className:"h-5 w-5"})}),(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:h(o)}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500",children:[i.filter(e=>"scheduled"===e.status).length," appointments scheduled"]})]}),(0,Xf.jsx)("button",{onClick:()=>p(1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Xf.jsx)(Gg,{className:"h-5 w-5"})})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Schedule Timeline"}),(0,Xf.jsx)("div",{className:"space-y-4",children:i.filter(e=>"scheduled"===e.status).sort((e,t)=>e.appointmentTime.localeCompare(t.appointmentTime)).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-green-600 font-medium",children:e.patientName.split(" ").map(e=>e[0]).join("")})})}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge]}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.priority)),children:[e.priority," priority"]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(u(e.status)),children:e.status})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:[e.appointmentTime," (",e.duration," minutes)"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsx)("span",{children:e.patientAddress})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsx)("span",{children:e.patientPhone})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Ug,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:[e.estimatedTravelTime," min travel time"]})]})]}),(0,Xf.jsx)("div",{className:"mb-3",children:(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.notes})}),(0,Xf.jsxs)("div",{className:"mb-3",children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tasks:"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tasks.map((e,t)=>(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,Xf.jsx)(mg,{className:"h-3 w-3 mr-1"}),e]},t))})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Ug,{className:"h-4 w-4 mr-2"}),"Navigate"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-2"}),"Start Visit"]})]})]})},e.id))})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:i.filter(e=>"scheduled"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:i.filter(e=>"completed"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Hours"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:i.reduce((e,t)=>e+t.duration,0)/60})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"High Priority"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:i.filter(e=>"high"===e.priority).length})]})]})})]})]})},Hg=Mf("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Kg=Mf("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),zg=Mf("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),qg=Mf("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Yg=Mf("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Xg=Mf("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]),Jg=Mf("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Qg=Mf("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),Zg=Mf("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),$g=Mf("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),e_=Mf("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var t_=n(635),n_=n.n(t_);const i_=new class{constructor(){this.client=null,this.localVideoTrack=null,this.localAudioTrack=null,this.remoteUsers=new Map,this.isJoined=!1,this.isPublished=!1,this.isInitialized=!1,this.eventListeners=new Map,this.config={appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_APP_ID||"43c43dc3e6a44a99b2b75a4997e3b1a4",channel:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_CHANNEL||"elderx_dev",token:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_TOKEN||"007eJxTYAj736zimGlilN56YtmltxEzVy/6tjyKYx73BPWFcnNFEswVGEyMk02MU5KNU80STUwSLS2TjJLMTRNNLC3NU42TDBNNeP4ezmgIZGRIe8LJwAiFID4XQ2pOSmpRRXxKahkDAwDgxiEn",uid:null,mode:"rtc",codec:"vp8"}}async initialize(){try{if(this.isInitialized)return!0;if(!this.config.appId)throw new Error("Agora App ID is required");return this.client=n_().createClient({mode:this.config.mode,codec:this.config.codec}),this.setupEventListeners(),this.isInitialized=!0,this.triggerEvent("initialized",{}),!0}catch(e){throw console.error("Failed to initialize Agora client:",e),this.triggerEvent("error",{type:"initialization",error:e.message}),e}}setupEventListeners(){this.client&&(this.client.on("user-published",async(e,t)=>{console.log("User published:",e,t);try{if(await this.client.subscribe(e,t),"video"===t&&this.remoteUsers.set(e.uid,je(je({},e),{},{videoTrack:e.videoTrack})),"audio"===t&&this.remoteUsers.set(e.uid,je(je({},e),{},{audioTrack:e.audioTrack})),"video"===t){const t=document.getElementById("remote-video-".concat(e.uid));t&&e.videoTrack.play(t)}"audio"===t&&e.audioTrack.play(),this.triggerEvent("user-published",{user:e,mediaType:t})}catch(n){console.error("Failed to subscribe user:",n)}}),this.client.on("user-unpublished",(e,t)=>{console.log("User unpublished:",e,t),"video"===t&&this.remoteUsers.delete(e.uid),this.triggerEvent("user-unpublished",{user:e,mediaType:t})}),this.client.on("user-left",e=>{console.log("User left:",e),this.remoteUsers.delete(e.uid),this.triggerEvent("user-left",{user:e})}),this.client.on("connection-state-change",(e,t)=>{console.log("Connection state changed:",e,t),this.triggerEvent("connection-state-change",{curState:e,revState:t})}))}async joinChannel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(this.isInitialized||await this.initialize(),this.isJoined)return console.warn("Already joined a channel"),this.config.uid;const n=t||this.config.channel,i=e||Math.floor(1e5*Math.random());if(this.config.uid=i,!n||""===n.trim())throw new Error("Channel name is required");return await this.client.join(this.config.appId,n,this.config.token,i),this.isJoined=!0,console.log("Successfully joined channel:",n),await this.createLocalTracks(),await this.publishLocalTracks(),this.triggerEvent("joined",{uid:i,channel:n}),i}catch(n){throw console.error("Failed to join channel:",n),this.triggerEvent("error",{type:"join",error:n.message}),n}}async createLocalTracks(){try{const e=await this.checkCameraPermission(),t=await this.checkMicrophonePermission();if(!e&&!t)throw new Error("Camera and microphone access are required for video calls");if(e&&(this.localVideoTrack=await n_().createCameraVideoTrack({encoderConfig:"720p_1"})),t&&(this.localAudioTrack=await n_().createMicrophoneAudioTrack()),this.localVideoTrack){const e=document.getElementById("local-video");e&&this.localVideoTrack.play(e)}console.log("Local tracks created successfully"),this.triggerEvent("tracks-created",{hasVideo:!!this.localVideoTrack,hasAudio:!!this.localAudioTrack})}catch(e){throw console.error("Failed to create local tracks:",e),this.triggerEvent("error",{type:"track-creation",error:e.message}),e}}async checkCameraPermission(){try{return(await n_().getCameras()).length>0}catch(e){return console.warn("Camera permission check failed:",e),!1}}async checkMicrophonePermission(){try{return(await n_().getMicrophones()).length>0}catch(e){return console.warn("Microphone permission check failed:",e),!1}}async publishLocalTracks(){try{if(!this.client)throw new Error("Client not initialized");const e=[];if(this.localVideoTrack&&e.push(this.localVideoTrack),this.localAudioTrack&&e.push(this.localAudioTrack),0===e.length)throw new Error("No tracks available to publish");await this.client.publish(e),this.isPublished=!0,console.log("Local tracks published successfully"),this.triggerEvent("published",{videoPublished:!!this.localVideoTrack,audioPublished:!!this.localAudioTrack})}catch(e){throw console.error("Failed to publish local tracks:",e),this.triggerEvent("error",{type:"publish",error:e.message}),e}}async leaveChannel(){try{this.client&&this.isJoined&&(this.isPublished&&await this.client.unpublish([this.localVideoTrack,this.localAudioTrack]),await this.client.leave(),this.isJoined=!1,this.isPublished=!1),this.localVideoTrack&&(this.localVideoTrack.stop(),this.localVideoTrack.close(),this.localVideoTrack=null),this.localAudioTrack&&(this.localAudioTrack.stop(),this.localAudioTrack.close(),this.localAudioTrack=null),this.remoteUsers.clear(),console.log("Successfully left channel"),this.triggerEvent("left",{})}catch(e){throw console.error("Failed to leave channel:",e),e}}async toggleVideo(){try{if(this.localVideoTrack)return await this.localVideoTrack.setEnabled(!this.localVideoTrack.enabled),this.triggerEvent("video-toggled",{enabled:this.localVideoTrack.enabled}),this.localVideoTrack.enabled}catch(e){throw console.error("Failed to toggle video:",e),e}}async toggleAudio(){try{if(this.localAudioTrack)return await this.localAudioTrack.setEnabled(!this.localAudioTrack.enabled),this.triggerEvent("audio-toggled",{enabled:this.localAudioTrack.enabled}),this.localAudioTrack.enabled}catch(e){throw console.error("Failed to toggle audio:",e),e}}getConnectionState(){return this.client?this.client.connectionState:"DISCONNECTED"}getRemoteUsers(){return Array.from(this.remoteUsers.values())}isVideoEnabled(){return!!this.localVideoTrack&&this.localVideoTrack.enabled}isAudioEnabled(){return!!this.localAudioTrack&&this.localAudioTrack.enabled}async getAvailableDevices(){try{const[e,t]=await Promise.all([n_().getCameras(),n_().getMicrophones()]);return{cameras:e.map(e=>({deviceId:e.deviceId,label:e.label||"Camera"})),microphones:t.map(e=>({deviceId:e.deviceId,label:e.label||"Microphone"}))}}catch(e){return console.error("Failed to get devices:",e),{cameras:[],microphones:[]}}}async switchCamera(e){try{if(!this.localVideoTrack)throw new Error("No video track available");await this.localVideoTrack.setDevice(e),this.triggerEvent("camera-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch camera:",t),this.triggerEvent("error",{type:"camera-switch",error:t.message}),t}}async switchMicrophone(e){try{if(!this.localAudioTrack)throw new Error("No audio track available");await this.localAudioTrack.setDevice(e),this.triggerEvent("microphone-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch microphone:",t),this.triggerEvent("error",{type:"microphone-switch",error:t.message}),t}}async startRecording(){try{if(!this.client||!this.isJoined)throw new Error("Must be in a call to start recording");return this.triggerEvent("recording-started",{}),!0}catch(e){throw console.error("Failed to start recording:",e),this.triggerEvent("error",{type:"recording-start",error:e.message}),e}}async stopRecording(){try{return this.triggerEvent("recording-stopped",{}),!0}catch(e){throw console.error("Failed to stop recording:",e),this.triggerEvent("error",{type:"recording-stop",error:e.message}),e}}getRecordingStatus(){return{isRecording:!1,recordingId:null,startTime:null}}triggerEvent(e,t){const n=new CustomEvent("agora-".concat(e),{detail:t});window.dispatchEvent(n)}destroy(){this.leaveChannel(),this.client=null}},s_=i_,r_="telemedicine_appointments",a_="telemedicine_calls",o_="telemedicine_recordings",c_="doctors";const l_=new class{async createAppointment(e){try{const t=je(je({},e),{},{createdAt:wf(),updatedAt:wf(),status:"scheduled"});return je({id:(await bf(pm(Pf,r_),t)).id},t)}catch(t){throw console.error("Error creating appointment:",t),t}}async getAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const n="patient"===t?"patientId":"doctorId",i=Zm(pm(Pf,r_),ef(n,"==",e),sf("appointmentDate","asc")),s=await yf(i),r=[];return s.forEach(e=>{r.push(je({id:e.id},e.data()))}),r}catch(n){throw console.error("Error getting appointments:",n),n}}async getUpcomingAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const n=new Date,i="patient"===t?"patientId":"doctorId",s=Zm(pm(Pf,r_),ef(i,"==",e),ef("appointmentDate",">=",Co.fromDate(n)),ef("status","==","scheduled"),sf("appointmentDate","asc")),r=await yf(s),a=[];return r.forEach(e=>{a.push(je({id:e.id},e.data()))}),a}catch(n){throw console.error("Error getting upcoming appointments:",n),n}}async updateAppointmentStatus(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const i=mm(Pf,r_,e);return await Ef(i,je({status:t,updatedAt:wf()},n)),!0}catch(i){throw console.error("Error updating appointment status:",i),i}}async startCall(e,t){try{const n=je(je({appointmentId:e},t),{},{startTime:wf(),status:"active",createdAt:wf()}),i=await bf(pm(Pf,a_),n);return await this.updateAppointmentStatus(e,"in-progress",{callId:i.id}),je({id:i.id},n)}catch(n){throw console.error("Error starting call:",n),n}}async endCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=mm(Pf,a_,e);await Ef(n,je({endTime:wf(),status:"completed",updatedAt:wf()},t));const i=await gf(n);if(i.exists()){const e=i.data();await this.updateAppointmentStatus(e.appointmentId,"completed")}return!0}catch(n){throw console.error("Error ending call:",n),n}}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const i="patient"===t?"patientId":"doctorId",s=Zm(pm(Pf,a_),ef(i,"==",e),sf("startTime","desc"),(am("limit",n=50),rf._create("limit",n,"F"))),r=await yf(s),a=[];return r.forEach(e=>{a.push(je({id:e.id},e.data()))}),a}catch(i){throw console.error("Error getting call history:",i),i}var n}async saveRecording(e,t){try{const n=je(je({callId:e},t),{},{createdAt:wf()}),i=await bf(pm(Pf,o_),n),s=mm(Pf,a_,e);return await Ef(s,{recordingId:i.id,hasRecording:!0,updatedAt:wf()}),je({id:i.id},n)}catch(n){throw console.error("Error saving recording:",n),n}}async getCallRecordings(e){try{const t=Zm(pm(Pf,o_),ef("callId","==",e)),n=await yf(t),i=[];return n.forEach(e=>{i.push(je({id:e.id},e.data()))}),i}catch(t){throw console.error("Error getting call recordings:",t),t}}async getAvailableDoctors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=Zm(pm(Pf,c_),ef("isActive","==",!0));e&&(t=Zm(t,ef("specialty","==",e)));const n=await yf(t),i=[];return n.forEach(e=>{i.push(je({id:e.id},e.data()))}),i}catch(t){throw console.error("Error getting available doctors:",t),t}}async getDoctor(e){try{const t=mm(Pf,c_,e),n=await gf(t);if(n.exists())return je({id:n.id},n.data());throw new Error("Doctor not found")}catch(t){throw console.error("Error getting doctor:",t),t}}subscribeToAppointments(e,t,n){const i="patient"===t?"patientId":"doctorId";return Sf(Zm(pm(Pf,r_),ef(i,"==",e),sf("appointmentDate","asc")),e=>{const t=[];e.forEach(e=>{t.push(je({id:e.id},e.data()))}),n(t)})}subscribeToCalls(e,t,n){const i="patient"===t?"patientId":"doctorId";return Sf(Zm(pm(Pf,a_),ef(i,"==",e),sf("startTime","desc")),e=>{const t=[];e.forEach(e=>{t.push(je({id:e.id},e.data()))}),n(t)})}convertTimestamp(e){return e&&e.toDate?e.toDate():e}formatAppointmentForDisplay(e){return je(je({},e),{},{appointmentDate:this.convertTimestamp(e.appointmentDate),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}formatCallForDisplay(e){return je(je({},e),{},{startTime:this.convertTimestamp(e.startTime),endTime:this.convertTimestamp(e.endTime),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}},d_=l_,u_=()=>{const[e,n]=Ma(kf),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)(!0),[f,g]=(0,t.useState)(!1),[_,y]=(0,t.useState)(0),[v,E]=(0,t.useState)([]),[b,S]=(0,t.useState)("disconnected"),[x,T]=(0,t.useState)(null),[w,N]=(0,t.useState)({cameras:[],microphones:[]}),[C,R]=(0,t.useState)(!1),[I,A]=(0,t.useState)("patient");(0,t.useEffect)(()=>(e&&!n&&(k(),D(),O()),()=>{f&&s_.leaveChannel()}),[e,n]),(0,t.useEffect)(()=>{if(e){var t;const n=null!==(t=e.displayName)&&void 0!==t&&t.includes("Dr.")?"doctor":"patient";A(n)}},[e]);const O=async()=>{try{const e=await s_.getAvailableDevices();N(e)}catch(x){console.error("Failed to load devices:",x)}},D=()=>{window.addEventListener("agora-user-published",e=>{const{user:t}=e.detail;E(e=>[...e,t]),_t.success("".concat(t.uid," joined the call"))}),window.addEventListener("agora-user-left",e=>{const{user:t}=e.detail;E(e=>e.filter(e=>e.uid!==t.uid)),_t.info("".concat(t.uid," left the call"))}),window.addEventListener("agora-connection-state-change",e=>{const{curState:t}=e.detail;S(t),console.log("Connection state:",t),"CONNECTED"===t?_t.success("Connected to call"):"DISCONNECTED"===t&&_t.warning("Connection lost")}),window.addEventListener("agora-error",e=>{const{type:t,error:n}=e.detail;switch(T(n),console.error("Agora error:",t,n),t){case"initialization":_t.error("Failed to initialize video calling");break;case"join":_t.error("Failed to join call");break;case"track-creation":_t.error("Failed to access camera/microphone");break;case"publish":_t.error("Failed to start video/audio");break;default:_t.error("Video call error occurred")}}),window.addEventListener("agora-tracks-created",e=>{const{hasVideo:t,hasAudio:n}=e.detail;c(t),d(n),t||n?t?n||_t.warning("Microphone access not available - video only"):_t.warning("Camera access not available - audio only"):_t.warning("No camera or microphone access available")}),window.addEventListener("agora-recording-started",e=>{h(!0),_t.success("Recording started")}),window.addEventListener("agora-recording-stopped",e=>{h(!1),_t.success("Recording stopped")})},k=async()=>{try{if(m(!0),T(null),!e)return void m(!1);const t=(await d_.getAppointments(e.uid,I)).map(e=>d_.formatAppointmentForDisplay(e));s(t),m(!1)}catch(x){console.error("Error loading telemedicine data:",x),T("Failed to load appointments. Please try again."),m(!1),P()}},P=()=>{const e=[{id:"mock-1",doctorName:"Dr. Kemi Adebayo",doctorSpecialty:"Cardiologist",doctorImage:null,patientName:"Adunni Okafor",patientAge:72,appointmentDate:new Date("2024-01-20T15:00:00Z"),duration:30,status:"scheduled",type:"video",notes:"Follow-up consultation for heart condition",symptoms:["Chest pain","Shortness of breath"],vitalSigns:{bloodPressure:"140/90",heartRate:85,temperature:98.6},prescription:null,recording:null},{id:"mock-2",doctorName:"Dr. Tunde Williams",doctorSpecialty:"General Practitioner",doctorImage:null,patientName:"Grace Johnson",patientAge:68,appointmentDate:new Date("2024-01-20T16:30:00Z"),duration:45,status:"completed",type:"video",notes:"Regular checkup and medication review",symptoms:["Fatigue","Joint pain"],vitalSigns:{bloodPressure:"130/80",heartRate:72,temperature:98.4},prescription:{medications:[{name:"Metformin",dosage:"500mg",frequency:"twice daily"},{name:"Ibuprofen",dosage:"200mg",frequency:"as needed"}]},recording:{url:"https://example.com/recording1.mp4",duration:"42 minutes",size:"1.2GB"}}];s(e),_t.warning("Using offline data. Some features may be limited.")},L=async()=>{try{const e=await s_.toggleVideo();c(e),_t.info(e?"Video enabled":"Video disabled")}catch(x){console.error("Failed to toggle video:",x),_t.error("Failed to toggle video")}},j=async()=>{try{const e=await s_.toggleAudio();d(e),_t.info(e?"Audio enabled":"Audio disabled")}catch(x){console.error("Failed to toggle audio:",x),_t.error("Failed to toggle audio")}},M=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},U=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return n?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e?p?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Telemedicine"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Virtual consultations and remote healthcare"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{onClick:async()=>{try{_t.info("Seeding sample data..."),await(async()=>{try{console.log("\ud83c\udf31 Seeding telemedicine data...");const e=[{id:"doctor-1",name:"Dr. Kemi Adebayo",specialty:"Cardiologist",email:"kemi.adebayo@elderx.ng",phone:"+234 801 234 5678",isActive:!0,rating:4.9,experience:"15 years",qualifications:["MBBS","MD Cardiology"],languages:["English","Yoruba"],consultationFee:15e3,availableSlots:["09:00","10:00","11:00","14:00","15:00"],createdAt:wf()},{id:"doctor-2",name:"Dr. Tunde Williams",specialty:"General Practitioner",email:"tunde.williams@elderx.ng",phone:"+234 802 345 6789",isActive:!0,rating:4.8,experience:"12 years",qualifications:["MBBS","MD General Medicine"],languages:["English","Hausa"],consultationFee:1e4,availableSlots:["08:00","09:00","10:00","13:00","14:00"],createdAt:wf()},{id:"doctor-3",name:"Dr. Sarah Okafor",specialty:"Dermatologist",email:"sarah.okafor@elderx.ng",phone:"+234 803 456 7890",isActive:!0,rating:4.7,experience:"10 years",qualifications:["MBBS","MD Dermatology"],languages:["English","Igbo"],consultationFee:12e3,availableSlots:["10:00","11:00","12:00","15:00","16:00"],createdAt:wf()}],t=[{id:"patient-1",name:"Adunni Okafor",email:"adunni.okafor@email.com",phone:"+234 804 567 8901",age:72,gender:"Female",medicalConditions:["Hypertension","Diabetes Type 2"],allergies:["Penicillin"],emergencyContact:{name:"Kemi Okafor",phone:"+234 801 987 6543",relationship:"Daughter"},createdAt:wf()},{id:"patient-2",name:"Grace Johnson",email:"grace.johnson@email.com",phone:"+234 805 678 9012",age:68,gender:"Female",medicalConditions:["Arthritis"],allergies:["None"],emergencyContact:{name:"John Johnson",phone:"+234 802 876 5432",relationship:"Son"},createdAt:wf()},{id:"patient-3",name:"Tunde Adebayo",email:"tunde.adebayo@email.com",phone:"+234 806 789 0123",age:75,gender:"Male",medicalConditions:["High Blood Pressure"],allergies:["Shellfish"],emergencyContact:{name:"Funmi Adebayo",phone:"+234 803 765 4321",relationship:"Wife"},createdAt:wf()}],n=[{patientId:"patient-1",doctorId:"doctor-1",appointmentDate:new Date("2024-01-20T15:00:00Z"),duration:30,type:"video",status:"scheduled",notes:"Follow-up consultation for heart condition",symptoms:["Chest pain","Shortness of breath"],vitalSigns:{bloodPressure:"140/90",heartRate:85,temperature:98.6},createdAt:wf()},{patientId:"patient-2",doctorId:"doctor-2",appointmentDate:new Date("2024-01-20T16:30:00Z"),duration:45,type:"video",status:"completed",notes:"Regular checkup and medication review",symptoms:["Fatigue","Joint pain"],vitalSigns:{bloodPressure:"130/80",heartRate:72,temperature:98.4},prescription:{medications:[{name:"Metformin",dosage:"500mg",frequency:"twice daily"},{name:"Ibuprofen",dosage:"200mg",frequency:"as needed"}]},createdAt:wf()},{patientId:"patient-3",doctorId:"doctor-3",appointmentDate:new Date("2024-01-21T10:00:00Z"),duration:20,type:"audio",status:"scheduled",notes:"Skin condition consultation",symptoms:["Rash on arms","Itching"],createdAt:wf()}];console.log("Adding doctors...");for(const i of e)await vf(mm(Pf,"doctors",i.id),i),console.log("\u2705 Added doctor: ".concat(i.name));console.log("Adding patients...");for(const i of t)await vf(mm(Pf,"patients",i.id),i),console.log("\u2705 Added patient: ".concat(i.name));console.log("Adding appointments...");for(const i of n){const e=await bf(pm(Pf,"telemedicine_appointments"),i);console.log("\u2705 Added appointment: ".concat(e.id))}return console.log("\ud83c\udf89 Telemedicine data seeded successfully!"),!0}catch(x){throw console.error("\u274c Error seeding telemedicine data:",x),x}})(),_t.success("Sample data seeded successfully!"),k()}catch(x){console.error("Failed to seed data:",x),_t.error("Failed to seed sample data")}},className:"btn btn-secondary",title:"Add sample data to Firebase",children:[(0,Xf.jsx)(Hg,{className:"h-4 w-4 mr-2"}),"Seed Data"]}),(0,Xf.jsxs)("button",{onClick:async()=>{try{_t.info("Running telemedicine tests...");const e=await(async()=>{const e={initialization:!1,deviceDetection:!1,permissions:!1,errors:[]};try{console.log("\ud83e\uddea Testing Telemedicine Service...");try{await s_.initialize(),e.initialization=!0,console.log("\u2705 Service initialization: PASSED")}catch(x){e.errors.push("Initialization failed: ".concat(x.message)),console.error("\u274c Service initialization: FAILED",x)}try{const t=await s_.getAvailableDevices();e.deviceDetection=t.cameras.length>0||t.microphones.length>0,console.log("\u2705 Device detection: PASSED",t)}catch(x){e.errors.push("Device detection failed: ".concat(x.message)),console.error("\u274c Device detection: FAILED",x)}try{const t=await s_.checkCameraPermission(),n=await s_.checkMicrophonePermission();e.permissions=t||n,console.log("\u2705 Permission checks: PASSED",{hasCamera:t,hasMicrophone:n})}catch(x){e.errors.push("Permission checks failed: ".concat(x.message)),console.error("\u274c Permission checks: FAILED",x)}return e.initialization&&e.deviceDetection&&e.permissions?console.log("\ud83c\udf89 All telemedicine tests PASSED!"):console.log("\u26a0\ufe0f Some telemedicine tests FAILED:",e.errors),e}catch(x){return console.error("\ud83d\udca5 Telemedicine test suite failed:",x),e.errors.push("Test suite failed: ".concat(x.message)),e}})();0===e.errors.length?_t.success("All telemedicine tests passed!"):(_t.warning("Some tests failed: ".concat(e.errors.length," errors")),console.log("Test results:",e))}catch(x){console.error("Test failed:",x),_t.error("Telemedicine test failed")}},className:"btn btn-secondary",title:"Test telemedicine functionality",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-2"}),"Test System"]}),(0,Xf.jsxs)("button",{onClick:O,className:"btn btn-secondary",title:"Refresh device list",children:[(0,Xf.jsx)(og,{className:"h-4 w-4 mr-2"}),"Refresh Devices"]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-2"}),"Schedule Appointment"]}),(0,Xf.jsxs)("button",{onClick:async()=>{try{const t={patientId:"patient"===I?e.uid:"sample-patient-id",doctorId:"doctor"===I?e.uid:"sample-doctor-id",appointmentDate:new Date(Date.now()+864e5),duration:30,type:"video",notes:"New consultation appointment",status:"scheduled"};await d_.createAppointment(t);_t.success("New appointment created successfully!"),k()}catch(x){console.error("Failed to create appointment:",x),_t.error("Failed to create appointment")}},className:"btn btn-primary",title:"Create new consultation appointment",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"New Consultation"]})]})]}),w.cameras.length>0||w.microphones.length>0?(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Available Devices"}),(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:[w.cameras.length," camera(s), ",w.microphones.length," microphone(s)"]})]})}):(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-5 w-5 text-yellow-600 mr-2"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"No Devices Detected"}),(0,Xf.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"Please ensure your camera and microphone are connected and permissions are granted."})]})]})})}),(x||"disconnected"!==b)&&(0,Xf.jsxs)("div",{className:"card",children:[x&&(0,Xf.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Connection Error"}),(0,Xf.jsx)("p",{className:"text-sm text-red-700 mt-1",children:x})]})]})}),"disconnected"!==b&&(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat("CONNECTED"===b?"bg-green-500":"CONNECTING"===b?"bg-yellow-500":"bg-red-500")}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-600",children:["Status: ",b.toLowerCase()]})]}),C&&(0,Xf.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Initializing..."]})]})]}),r&&(0,Xf.jsxs)("div",{className:"card bg-gray-900 text-white",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-white font-medium",children:r.doctorName?r.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold",children:r.doctorName||"Doctor"}),(0,Xf.jsx)("p",{className:"text-gray-300",children:r.doctorSpecialty})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsxs)("span",{className:"text-sm text-gray-300",children:["Call Duration: ",(e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))})(_)]}),u&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-1 bg-red-600 px-2 py-1 rounded-full",children:[(0,Xf.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,Xf.jsx)("span",{className:"text-xs text-white",children:"REC"})]}),(0,Xf.jsx)("button",{onClick:async()=>{try{if(null!==r&&void 0!==r&&r.timer&&clearInterval(r.timer),await s_.leaveChannel(),null!==r&&void 0!==r&&r.callId)try{const e={duration:_,endReason:"user_ended",hasRecording:u};await d_.endCall(r.callId,e)}catch(e){console.warn("Failed to save call end to Firebase:",e)}a(null),g(!1),y(0),E([]),c(!0),d(!0),h(!1),_t.success("Call ended successfully!")}catch(x){console.error("Failed to end call:",x),_t.error("Failed to end call properly.")}},className:"p-2 bg-red-600 rounded-full hover:bg-red-700",title:"End call",children:(0,Xf.jsx)(Kg,{className:"h-5 w-5"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,Xf.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Xf.jsx)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:v.length>0?v.map((e,t)=>(0,Xf.jsx)("div",{id:"remote-video-".concat(e.uid),className:"w-full h-full"},e.uid)):(0,Xf.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Mg,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Xf.jsx)("p",{className:"text-gray-400",children:"Waiting for doctor to join..."})]})})}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-300",children:v.length>0?"".concat(v.length," participant(s)"):"No participants"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:L,className:"p-2 rounded-full ".concat(o?"bg-gray-700":"bg-red-600"),children:o?(0,Xf.jsx)(Bf,{className:"h-4 w-4"}):(0,Xf.jsx)(zg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:j,className:"p-2 rounded-full ".concat(l?"bg-gray-700":"bg-red-600"),children:l?(0,Xf.jsx)(qg,{className:"h-4 w-4"}):(0,Xf.jsx)(Yg,{className:"h-4 w-4"})})]})]})]}),(0,Xf.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Xf.jsxs)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:[(0,Xf.jsx)("div",{id:"local-video",className:"w-full h-full"}),!o&&(0,Xf.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-600",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(zg,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Xf.jsx)("p",{className:"text-gray-400",children:"Your video is off"})]})})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-300",children:"You"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:L,className:"p-2 rounded-full ".concat(o?"bg-gray-700":"bg-red-600"),children:o?(0,Xf.jsx)(Bf,{className:"h-4 w-4"}):(0,Xf.jsx)(zg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:j,className:"p-2 rounded-full ".concat(l?"bg-gray-700":"bg-red-600"),children:l?(0,Xf.jsx)(qg,{className:"h-4 w-4"}):(0,Xf.jsx)(Yg,{className:"h-4 w-4"})})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,Xf.jsx)("button",{onClick:L,className:"p-3 rounded-full transition-colors ".concat(o?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:o?"Turn off video":"Turn on video",children:o?(0,Xf.jsx)(Bf,{className:"h-6 w-6"}):(0,Xf.jsx)(zg,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{onClick:j,className:"p-3 rounded-full transition-colors ".concat(l?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:l?"Mute microphone":"Unmute microphone",children:l?(0,Xf.jsx)(qg,{className:"h-6 w-6"}):(0,Xf.jsx)(Yg,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{onClick:async()=>{try{if(u){if(await s_.stopRecording(),h(!1),null!==r&&void 0!==r&&r.callId)try{const e={duration:_,status:"completed",recordingUrl:null,fileSize:null};await d_.saveRecording(r.callId,e)}catch(e){console.warn("Failed to save recording data to Firebase:",e)}_t.success("Recording stopped")}else{if(await s_.startRecording(),h(!0),null!==r&&void 0!==r&&r.callId)try{const e={status:"recording",startTime:new Date};await d_.saveRecording(r.callId,e)}catch(e){console.warn("Failed to save recording start to Firebase:",e)}_t.success("Recording started")}}catch(x){console.error("Failed to toggle recording:",x),_t.error("Failed to toggle recording")}},className:"p-3 rounded-full transition-colors ".concat(u?"bg-red-600 hover:bg-red-700":"bg-gray-700 hover:bg-gray-600"),title:u?"Stop recording":"Start recording",children:u?(0,Xf.jsx)(Xg,{className:"h-6 w-6"}):(0,Xf.jsx)(Jg,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Share screen",children:(0,Xf.jsx)(Qg,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Settings",children:(0,Xf.jsx)(og,{className:"h-6 w-6"})})]}),(w.cameras.length>1||w.microphones.length>1)&&(0,Xf.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[w.cameras.length>1&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(Mg,{className:"h-4 w-4"}),(0,Xf.jsx)("select",{onChange:e=>(async e=>{try{await s_.switchCamera(e),_t.success("Camera switched successfully")}catch(x){console.error("Failed to switch camera:",x),_t.error("Failed to switch camera")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:w.cameras.map(e=>(0,Xf.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]}),w.microphones.length>1&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(qg,{className:"h-4 w-4"}),(0,Xf.jsx)("select",{onChange:e=>(async e=>{try{await s_.switchMicrophone(e),_t.success("Microphone switched successfully")}catch(x){console.error("Failed to switch microphone:",x),_t.error("Failed to switch microphone")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:w.microphones.map(e=>(0,Xf.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Appointments"}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Zg,{className:"h-4 w-4 mr-2"}),"Search"]})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:i.filter(e=>"scheduled"===e.status).map(t=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-blue-600 font-medium",children:t.doctorName?t.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.doctorName||"Doctor"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:t.doctorSpecialty||"General Practice"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(M(t.status)),children:t.status})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:["Patient: ",t.patientName||"Patient"," (",t.patientAge||"N/A","y)"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-2"}),(0,Xf.jsx)("span",{children:t.appointmentDate?U(t.appointmentDate).date:"TBD"})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:[t.appointmentDate?U(t.appointmentDate).time:"TBD"," (",t.duration||30,"min)"]})]})]}),(0,Xf.jsxs)("div",{className:"mt-2",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:t.notes}),t.symptoms&&(0,Xf.jsxs)("div",{className:"mt-2",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Symptoms: "}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t.symptoms.join(", ")})]})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>(async t=>{try{R(!0),T(null),a(t),g(!0),y(0);const i="appointment_".concat(t.id,"_").concat(Date.now()),s=await s_.joinChannel(null,i);console.log("Joined call with UID:",s);let r=null;try{const n={appointmentId:t.id,patientId:"patient"===I?e.uid:t.patientId,doctorId:"doctor"===I?e.uid:t.doctorId,channelName:i,uid:s,callType:t.type||"video",status:"active"},o=await d_.startCall(t.id,n);r=o.id,a(e=>je(je({},e),{},{callId:r}))}catch(n){console.warn("Failed to save call to Firebase:",n)}_t.success("Call started successfully!");const o=setInterval(()=>{y(e=>e+1)},1e3);a(e=>je(je({},e),{},{timer:o,channelName:i,uid:s,callId:r}))}catch(x){console.error("Failed to start call:",x),T(x.message),_t.error("Failed to start call: ".concat(x.message)),a(null),g(!1)}finally{R(!1)}})(t),disabled:C,className:"btn btn-primary ".concat(C?"opacity-50 cursor-not-allowed":""),children:C?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Starting..."]}):(0,Xf.jsxs)(Xf.Fragment,{children:["video"===t.type?(0,Xf.jsx)(Bf,{className:"h-4 w-4 mr-2"}):(0,Xf.jsx)(pg,{className:"h-4 w-4 mr-2"}),"Start Call"]})}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 mr-2"}),"Chat"]})]})]})},t.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Consultations"}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]})]}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.filter(e=>"completed"===e.status).map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-blue-600 font-medium",children:e.doctorName?e.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.doctorName||"Doctor"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.doctorSpecialty||"General Practice"})]})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.patientName||"Patient"}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge||"N/A"]})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.appointmentDate?U(e.appointmentDate).date:"TBD"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.appointmentDate?U(e.appointmentDate).time:"TBD"})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:["video"===e.type?(0,Xf.jsx)(Bf,{className:"h-4 w-4 text-blue-600 mr-1"}):(0,Xf.jsx)(pg,{className:"h-4 w-4 text-green-600 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900 capitalize",children:e.type})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(M(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(ag,{className:"h-4 w-4"})}),e.recording&&(0,Xf.jsx)("button",{className:"text-green-600 hover:text-green-900",children:(0,Xf.jsx)($g,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{className:"text-purple-600 hover:text-purple-900",children:(0,Xf.jsx)(e_,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]}):(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Required"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Please log in to access telemedicine features."})]})})},h_=()=>{const[e,n]=(0,t.useState)(!1),i=ee(),s=Z(),r=[{name:"Dashboard",href:"/caregiver",icon:$f},{name:"Today's Schedule",href:"/caregiver/schedule",icon:Vf},{name:"My Patients",href:"/caregiver/patients",icon:Ff},{name:"Tasks",href:"/caregiver/tasks",icon:mg},{name:"Messages",href:"/caregiver/messages",icon:sg},{name:"Navigation",href:"/caregiver/navigation",icon:Ug},{name:"Photo Updates",href:"/caregiver/photos",icon:Mg},{name:"Performance",href:"/caregiver/performance",icon:ig},{name:"Emergency",href:"/caregiver/emergency",icon:eg},{name:"Settings",href:"/caregiver/settings",icon:og}],a=e=>s.pathname===e;return(0,Xf.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Xf.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>n(!1)}),(0,Xf.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Xf.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Xf.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>n(!1),children:(0,Xf.jsx)(Hf,{className:"h-6 w-6 text-white"})})}),(0,Xf.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-green-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Xf.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Xf.jsx)("div",{className:"flex flex-col w-64",children:(0,Xf.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Xf.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-green-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Xf.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-3",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"}),(0,Xf.jsxs)("button",{onClick:async()=>{try{await gr(kf),_t.success("Signed out successfully"),i("/login")}catch(e){_t.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Xf.jsx)(Kf,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Xf.jsxs)("div",{className:"lg:pl-64 flex flex-col flex-1",children:[(0,Xf.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Xf.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500 lg:hidden",onClick:()=>n(!0),children:(0,Xf.jsx)(zf,{className:"h-6 w-6"})}),(0,Xf.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Xf.jsx)("div",{className:"flex-1 flex",children:(0,Xf.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Xf.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Xf.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:"Caregiver Portal"})})})})}),(0,Xf.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Xf.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:(0,Xf.jsx)(qf,{className:"h-6 w-6"})}),(0,Xf.jsx)("div",{className:"ml-3 relative",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"})})]})})]})]})]}),(0,Xf.jsx)("main",{className:"flex-1 overflow-auto",children:(0,Xf.jsx)("div",{className:"h-full",children:(0,Xf.jsx)(ge,{})})})]})]})},p_=Mf("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),m_=Mf("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),f_=Mf("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),g_=Mf("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),__=Mf("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),y_=()=>{const[e,n]=(0,t.useState)(null),[i,s]=(0,t.useState)(""),[r,a]=(0,t.useState)(""),[o,c]=(0,t.useState)([{id:1,name:"Dr. Kemi Adebayo",role:"Cardiologist",avatar:null,lastMessage:"Your blood pressure readings look good. Keep monitoring daily.",timestamp:"2 hours ago",unreadCount:2,status:"online",messages:[{id:1,text:"Hello Mrs. Okafor, how are you feeling today?",sender:"doctor",timestamp:"10:30 AM",read:!0},{id:2,text:"I'm feeling much better, thank you doctor.",sender:"patient",timestamp:"10:32 AM",read:!0},{id:3,text:"Your blood pressure readings look good. Keep monitoring daily.",sender:"doctor",timestamp:"2 hours ago",read:!1}]},{id:2,name:"Nurse Fatima Abdullahi",role:"Caregiver",avatar:null,lastMessage:"I'll be there for your appointment at 2 PM.",timestamp:"1 day ago",unreadCount:0,status:"offline",messages:[{id:1,text:"Good morning! I'm on my way for your home visit.",sender:"caregiver",timestamp:"Yesterday 8:00 AM",read:!0},{id:2,text:"I'll be there for your appointment at 2 PM.",sender:"caregiver",timestamp:"1 day ago",read:!0}]},{id:3,name:"ElderX Support",role:"Support Team",avatar:null,lastMessage:"Your subscription will renew on January 15th.",timestamp:"3 days ago",unreadCount:1,status:"online",messages:[{id:1,text:"Welcome to ElderX! We're here to help with any questions.",sender:"support",timestamp:"3 days ago",read:!0},{id:2,text:"Your subscription will renew on January 15th.",sender:"support",timestamp:"3 days ago",read:!1}]}]),[l,d]=(0,t.useState)(o);(0,t.useEffect)(()=>{if(r){const e=o.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||e.role.toLowerCase().includes(r.toLowerCase()));d(e)}else d(o)},[r,o]);const u=e=>"online"===e?"bg-green-500":"bg-gray-400",h=e=>"patient"===e.sender?e.read?(0,Xf.jsx)(p_,{className:"h-4 w-4 text-blue-500"}):(0,Xf.jsx)(m_,{className:"h-4 w-4 text-gray-400"}):null;return(0,Xf.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Xf.jsxs)("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[(0,Xf.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(Gf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Messages"})]}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search conversations...",value:r,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto",children:l.map(t=>(0,Xf.jsx)("div",{onClick:()=>n(t),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ".concat((null===e||void 0===e?void 0:e.id)===t.id?"bg-blue-50 border-blue-200":""),children:(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ".concat(u(t.status))})]}),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:t.name}),(0,Xf.jsx)("span",{className:"text-xs text-gray-500",children:t.timestamp})]}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:t.role}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-600 truncate",children:t.lastMessage}),t.unreadCount>0&&(0,Xf.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:t.unreadCount})]})]})]})},t.id))})]}),(0,Xf.jsx)("div",{className:"flex-1 flex flex-col",children:e?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-blue-600"})}),(0,Xf.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ".concat(u(e.status))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:e.role})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(pg,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(Bf,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(e_,{className:"h-5 w-5"})})]})]})}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:e.messages.map(e=>(0,Xf.jsx)("div",{className:"flex ".concat("patient"===e.sender?"justify-end":"justify-start"),children:(0,Xf.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("patient"===e.sender?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,Xf.jsx)("p",{className:"text-sm",children:e.text}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between mt-1 ".concat("patient"===e.sender?"text-blue-100":"text-gray-500"),children:[(0,Xf.jsx)("span",{className:"text-xs",children:e.timestamp}),h(e)]})]})},e.id))}),(0,Xf.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:(0,Xf.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),!i.trim()||!e)return;const n={id:Date.now(),text:i,sender:"patient",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),read:!1};c(t=>t.map(t=>t.id===e.id?je(je({},t),{},{messages:[...t.messages,n],lastMessage:i,timestamp:"Just now"}):t)),s("")},className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(f_,{className:"h-5 w-5"})}),(0,Xf.jsxs)("div",{className:"flex-1 relative",children:[(0,Xf.jsx)("input",{type:"text",value:i,onChange:e=>s(e.target.value),placeholder:"Type a message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,Xf.jsx)("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(g_,{className:"h-5 w-5"})})]}),(0,Xf.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Xf.jsx)(__,{className:"h-5 w-5"})})]})})]}):(0,Xf.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Gf,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,Xf.jsx)("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})},v_=Mf("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),E_=()=>{const[e,n]=(0,t.useState)("premium"),[i,s]=(0,t.useState)("monthly"),r={currentPlan:"Premium",status:"Active",nextBilling:"January 15, 2025",amount:"$49.99",cycle:"Monthly",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications"]},a=[{id:"basic",name:"Basic",price:{monthly:19.99,yearly:199.99},description:"Essential care services",features:["2 home visits per month","Basic health monitoring","Email support","Medication reminders","Emergency contact"],popular:!1,icon:Ff},{id:"premium",name:"Premium",price:{monthly:49.99,yearly:499.99},description:"Comprehensive care package",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications","Priority support"],popular:!0,icon:v_},{id:"elite",name:"Elite",price:{monthly:99.99,yearly:999.99},description:"Premium concierge service",features:["Everything in Premium","Dedicated care manager","Specialist consultations","Advanced health analytics","Custom care plans","White-glove service","Family dashboard","24/7 concierge support"],popular:!1,icon:fg}],o=e=>{switch(e){case"Active":case"Paid":return"bg-green-100 text-green-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,Xf.jsxs)("div",{className:"space-y-8",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Subscription"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your ElderX subscription and billing"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Download Invoice"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(og,{className:"h-4 w-4 mr-2"}),"Manage Billing"]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(Wf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Current Subscription"})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,Xf.jsxs)("div",{className:"p-6 bg-blue-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(v_,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[r.currentPlan," Plan"]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(r.status)),children:r.status})]})]}),(0,Xf.jsxs)("div",{className:"space-y-2",children:[(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Amount:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:r.amount})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Cycle:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:r.cycle})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Next billing:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:r.nextBilling})]})]})]}),(0,Xf.jsxs)("div",{className:"p-6 bg-green-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)($f,{className:"h-8 w-8 text-green-600 mr-3"}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Usage This Month"})]}),(0,Xf.jsxs)("div",{className:"space-y-2",children:[(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Home visits:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:"8 / Unlimited"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Telemedicine:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:"3 / Unlimited"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Emergency calls:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:"1 / Unlimited"})]})]})]}),(0,Xf.jsxs)("div",{className:"p-6 bg-purple-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(cg,{className:"h-8 w-8 text-purple-600 mr-3"}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Benefits"})]}),(0,Xf.jsx)("div",{className:"space-y-1",children:r.features.slice(0,4).map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(m_,{className:"h-4 w-4 text-green-500 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Plans"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>s("monthly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("monthly"===i?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Monthly"}),(0,Xf.jsx)("button",{onClick:()=>s("yearly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("yearly"===i?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Yearly (Save 17%)"})]})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.map(t=>{const s=t.icon,r=e===t.id,a="monthly"===i?t.price.monthly:t.price.yearly,o="yearly"===i?Math.round((12*t.price.monthly-t.price.yearly)/(12*t.price.monthly)*100):0;return(0,Xf.jsxs)("div",{className:"relative p-6 border-2 rounded-lg transition-all ".concat(t.popular?"border-blue-500 bg-blue-50":r?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),children:[t.popular&&(0,Xf.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Xf.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),r&&(0,Xf.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Xf.jsx)("span",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Current Plan"})}),(0,Xf.jsxs)("div",{className:"text-center mb-6",children:[(0,Xf.jsx)(s,{className:"h-12 w-12 mx-auto mb-4 ".concat(t.popular?"text-blue-600":r?"text-green-600":"text-gray-600")}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:t.name}),(0,Xf.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,Xf.jsxs)("div",{className:"mb-2",children:[(0,Xf.jsxs)("span",{className:"text-3xl font-bold text-gray-900",children:["$",a]}),(0,Xf.jsxs)("span",{className:"text-gray-600",children:["/","monthly"===i?"month":"year"]})]}),o>0&&(0,Xf.jsxs)("p",{className:"text-sm text-green-600 font-medium",children:["Save ",o,"% with yearly billing"]})]}),(0,Xf.jsx)("div",{className:"space-y-3 mb-6",children:t.features.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(m_,{className:"h-4 w-4 text-green-500 mr-3 flex-shrink-0"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))}),(0,Xf.jsx)("button",{onClick:()=>{return e=t.id,void n(e);var e},className:"w-full py-3 px-4 rounded-lg font-semibold transition-colors ".concat(r?"bg-green-600 text-white hover:bg-green-700":t.popular?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),disabled:r,children:r?"Current Plan":"Choose Plan"})]},t.id)})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Wf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Payment Methods"})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Wf,{className:"h-4 w-4 mr-2"}),"Add Payment Method"]})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:[{id:1,type:"Visa",last4:"4242",expiry:"12/26",isDefault:!0},{id:2,type:"Mastercard",last4:"5555",expiry:"08/25",isDefault:!1}].map(e=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"w-12 h-8 bg-blue-600 rounded flex items-center justify-center",children:(0,Xf.jsx)(Wf,{className:"h-5 w-5 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.type," \u2022\u2022\u2022\u2022 ",e.last4]}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500",children:["Expires ",e.expiry]})]}),e.isDefault&&(0,Xf.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"Default"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),(0,Xf.jsx)("button",{className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]})]},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Billing History"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Download All"]})]}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:[{id:1,date:"December 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:2,date:"November 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:3,date:"October 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"}].map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.description}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:e.amount}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)($g,{className:"h-4 w-4"})})})]},e.id))})]})})]})]})},b_=()=>{const e=[{icon:Uf,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",bgColor:"bg-blue-100",iconColor:"text-blue-600"},{icon:Ff,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",bgColor:"bg-green-100",iconColor:"text-green-600"},{icon:eg,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",bgColor:"bg-red-100",iconColor:"text-red-600"},{icon:Bf,title:"Telemedicine",description:"Video consultations with doctors and specialists.",bgColor:"bg-purple-100",iconColor:"text-purple-600"},{icon:Zf,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",bgColor:"bg-orange-100",iconColor:"text-orange-600"},{icon:cg,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",bgColor:"bg-blue-100",iconColor:"text-blue-600"}];return(0,Xf.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-16",children:[(0,Xf.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((e,t)=>{const n=e.icon;return(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Xf.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Xf.jsx)(n,{className:"h-8 w-8 ".concat(e.iconColor)})}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Xf.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]}),(0,Xf.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Xf.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Xf.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Xf.jsx)("span",{className:"font-bold",children:"MGX"})]})})]})},S_=()=>(0,Xf.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-16",children:[(0,Xf.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Affordable Care Plans"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600",children:"Flexible subscription options designed for Nigerian families."})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12",children:[{name:"Basic",price:"\u20a615,000",period:"per month",features:["2 home visits per month","Basic health monitoring","Emergency support"],buttonText:"Choose Basic",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"},{name:"Premium",price:"\u20a625,000",period:"per month",features:["4 home visits per month","Video consultations","Family notifications"],buttonText:"Choose Premium",buttonStyle:"bg-blue-600 text-white hover:bg-blue-700",popular:!0},{name:"Family",price:"\u20a640,000",period:"per month",features:["Unlimited home visits","24/7 emergency support","Specialist consultations"],buttonText:"Choose Family",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}].map((e,t)=>(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 relative ".concat(e.popular?"border-2 border-blue-600":"border border-gray-200"),children:[e.popular&&(0,Xf.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,Xf.jsx)("div",{className:"bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),(0,Xf.jsxs)("div",{className:"text-center mb-6",children:[(0,Xf.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.name}),(0,Xf.jsxs)("div",{className:"mb-2",children:[(0,Xf.jsx)("span",{className:"text-4xl font-bold text-blue-600",children:e.price}),(0,Xf.jsx)("span",{className:"text-gray-500 ml-2",children:e.period})]})]}),(0,Xf.jsx)("ul",{className:"space-y-3 mb-8",children:e.features.map((e,t)=>(0,Xf.jsxs)("li",{className:"flex items-center",children:[(0,Xf.jsx)(m_,{className:"h-5 w-5 text-green-500 mr-3 flex-shrink-0"}),(0,Xf.jsx)("span",{className:"text-gray-700",children:e})]},t))}),(0,Xf.jsx)("button",{className:"w-full py-3 px-6 rounded-lg font-medium transition-colors ".concat(e.buttonStyle),children:e.buttonText})]},t))}),(0,Xf.jsx)("div",{className:"text-center",children:(0,Xf.jsx)("button",{className:"bg-gradient-to-r from-blue-600 to-green-600 text-white px-8 py-4 rounded-lg font-medium hover:from-blue-700 hover:to-green-700 transition-all",children:"View All Plans & Get Started"})})]}),(0,Xf.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Xf.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Xf.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Xf.jsx)("span",{className:"font-bold",children:"MGX"})]})})]}),x_=()=>{const[e,n]=(0,t.useState)({totalUsers:0,elderlyUsers:0,caregivers:0,activeAppointments:0,emergencyAlerts:0,medicationReminders:0,systemHealth:"Good"}),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n({totalUsers:1247,elderlyUsers:892,caregivers:355,activeAppointments:23,emergencyAlerts:2,medicationReminders:156,systemHealth:"Good"}),s([{id:1,type:"emergency",message:"Emergency alert from Adunni Okafor",time:"2 minutes ago",status:"active"},{id:2,type:"appointment",message:"New appointment scheduled with Dr. Kemi",time:"15 minutes ago",status:"completed"},{id:3,type:"medication",message:"Medication reminder sent to 12 users",time:"1 hour ago",status:"completed"},{id:4,type:"user",message:"New caregiver registered: Tunde Adebayo",time:"2 hours ago",status:"completed"}]),a(!1)},1e3)}catch(e){console.error("Error loading dashboard data:",e),a(!1)}})()},[]);const o=e=>{switch(e){case"emergency":return(0,Xf.jsx)(eg,{className:"h-4 w-4 text-red-500"});case"appointment":return(0,Xf.jsx)(Vf,{className:"h-4 w-4 text-blue-500"});case"medication":return(0,Xf.jsx)(Ff,{className:"h-4 w-4 text-green-500"});case"user":return(0,Xf.jsx)(ng,{className:"h-4 w-4 text-purple-500"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4 text-gray-500"})}},c=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Monitor and manage the ElderX platform"})]}),(0,Xf.jsx)("div",{className:"flex items-center space-x-2",children:(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"System Healthy"})]})})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.totalUsers.toLocaleString()})]}),(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-blue-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(ig,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+12% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Elderly Users"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.elderlyUsers.toLocaleString()})]}),(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-green-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(ig,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+8% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Caregivers"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.caregivers.toLocaleString()})]}),(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(ng,{className:"h-6 w-6 text-purple-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(ig,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+15% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Appointments"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.activeAppointments})]}),(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-orange-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-blue-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-blue-600",children:"Today's schedule"})]})]})]}),e.emergencyAlerts>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Emergency Alerts"}),(0,Xf.jsxs)("p",{className:"text-red-600",children:[e.emergencyAlerts," active emergency alert",e.emergencyAlerts>1?"s":""," requiring immediate attention"]})]})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/emergency",className:"btn btn-red",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 mr-2"}),"View Emergencies"]})]})}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"System Health"}),(0,Xf.jsx)(cg,{className:"h-5 w-5 text-green-600"})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Database"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Authentication"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Notifications"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"API Response Time"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"45ms"})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),(0,Xf.jsx)($f,{className:"h-5 w-5 text-gray-600"})]}),(0,Xf.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[o(e.type),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:e.message}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:e.time}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(c(e.status)),children:e.status})]})]})]},e.id))})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-8 gap-4",children:[(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/users",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(Zf,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Manage Users"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/caregivers",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ng,{className:"h-5 w-5 text-indigo-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Caregivers"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/analytics",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(Qf,{className:"h-5 w-5 text-orange-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Analytics"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/communication",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(sg,{className:"h-5 w-5 text-teal-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Messages"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/audit-logs",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ag,{className:"h-5 w-5 text-gray-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Audit Logs"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/emergency",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(eg,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Emergency Center"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/reports",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ag,{className:"h-5 w-5 text-green-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"View Reports"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/settings",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"System Settings"})]})]})]})]})},T_=Mf("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),w_=Mf("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),N_=Mf("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),C_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Adunni Okafor",email:"adunni@example.com",phone:"+234 801 987 6543",type:"elderly",status:"active",joinDate:"2024-01-15",lastActive:"2024-01-20",emergencyContact:"Dr. Kemi Okafor",medicalConditions:["Hypertension","Diabetes Type 2"]},{id:2,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",type:"caregiver",status:"active",joinDate:"2024-01-10",lastActive:"2024-01-20",certifications:["CPR Certified","First Aid"],experience:"5 years"},{id:3,name:"Grace Johnson",email:"grace@example.com",phone:"+234 803 456 7890",type:"elderly",status:"inactive",joinDate:"2023-12-20",lastActive:"2024-01-15",emergencyContact:"Dr. Michael Johnson",medicalConditions:["Arthritis"]},{id:4,name:"Dr. Kemi Okafor",email:"kemi@example.com",phone:"+234 804 789 0123",type:"doctor",status:"active",joinDate:"2023-11-01",lastActive:"2024-01-20",specialization:"Geriatrics",licenseNumber:"MD12345"}];n(e),s(e),a(!1)},1e3)}catch(e){console.error("Error loading users:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.phone.includes(o))),"all"!==l&&(t=t.filter(e=>e.type===l)),s(t)},[o,l,e]);const f=e=>{switch(e){case"elderly":return"bg-blue-100 text-blue-800";case"caregiver":return"bg-green-100 text-green-800";case"doctor":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";case"suspended":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},_=(e,t)=>{if(h(t),"view"===e)m(!0)};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage elderly users, caregivers, and doctors"})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(T_,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search users by name, email, or phone...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Users"}),(0,Xf.jsx)("option",{value:"elderly",children:"Elderly"}),(0,Xf.jsx)("option",{value:"caregiver",children:"Caregivers"}),(0,Xf.jsx)("option",{value:"doctor",children:"Doctors"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Join Date"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(e.type)),children:e.type.charAt(0).toUpperCase()+e.type.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(g(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.joinDate).toLocaleDateString()}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.lastActive).toLocaleDateString()}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>_("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>_("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit User",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("div",{className:"relative",children:(0,Xf.jsx)("button",{className:"text-gray-600 hover:text-gray-900",title:"More Actions",children:(0,Xf.jsx)(e_,{className:"h-4 w-4"})})})]})})]},e.id))})]})}),0===i.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(w_,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"Get started by adding a new user."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"User Details"}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-lg font-medium text-gray-700",children:u.name.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-xl font-semibold text-gray-900",children:u.name}),(0,Xf.jsxs)("div",{className:"flex space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(u.type)),children:u.type.charAt(0).toUpperCase()+u.type.slice(1)}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(g(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.email})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.phone})]})]})]}),"elderly"===u.type&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Contact"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.emergencyContact})]}),"elderly"===u.type&&u.medicalConditions&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medical Conditions"}),(0,Xf.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:u.medicalConditions.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:e},t))})]}),"caregiver"===u.type&&u.certifications&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Certifications"}),(0,Xf.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:u.certifications.map((e,t)=>(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Xf.jsx)(N_,{className:"h-3 w-3 mr-1"}),e]},t))})]}),"doctor"===u.type&&(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Specialization"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.specialization})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"License Number"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.licenseNumber})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Join Date"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:new Date(u.joinDate).toLocaleDateString()})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Active"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:new Date(u.lastActive).toLocaleDateString()})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit User"]})]})]})})})]})},R_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)(!0),[r,a]=(0,t.useState)({startDate:"",endDate:""}),[o,c]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n([{id:1,title:"User Activity Report",description:"Comprehensive overview of user engagement and activity patterns",type:"user_activity",generatedAt:"2024-01-20T10:30:00Z",period:"Last 30 days",records:1247,status:"ready"},{id:2,title:"Emergency Response Report",description:"Analysis of emergency alerts and response times",type:"emergency",generatedAt:"2024-01-19T15:45:00Z",period:"Last 7 days",records:23,status:"ready"},{id:3,title:"Medication Compliance Report",description:"Medication adherence and reminder effectiveness",type:"medication",generatedAt:"2024-01-18T09:15:00Z",period:"Last 14 days",records:892,status:"ready"},{id:4,title:"Caregiver Performance Report",description:"Caregiver activity and patient satisfaction metrics",type:"caregiver",generatedAt:"2024-01-17T14:20:00Z",period:"Last 30 days",records:355,status:"generating"},{id:5,title:"System Health Report",description:"Platform performance and system metrics",type:"system",generatedAt:"2024-01-16T11:00:00Z",period:"Last 24 hours",records:156,status:"ready"}]),s(!1)},1e3)}catch(e){console.error("Error loading reports:",e),s(!1)}})()},[]);const l=e=>{switch(e){case"user_activity":return(0,Xf.jsx)(Zf,{className:"h-5 w-5 text-blue-600"});case"emergency":return(0,Xf.jsx)($f,{className:"h-5 w-5 text-red-600"});case"medication":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-green-600"});case"caregiver":return(0,Xf.jsx)(Zf,{className:"h-5 w-5 text-purple-600"});case"system":return(0,Xf.jsx)(Qf,{className:"h-5 w-5 text-orange-600"});default:return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-gray-600"})}},d=e=>{switch(e){case"ready":return"bg-green-100 text-green-800";case"generating":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return i?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Reports & Analytics"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Generate and view platform reports"})]}),(0,Xf.jsxs)("button",{onClick:()=>{console.log("Generating report with:",{dateRange:r,reportType:o})},className:"btn btn-primary",children:[(0,Xf.jsx)(Qf,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generate New Report"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),(0,Xf.jsxs)("select",{className:"form-input",value:o,onChange:e=>c(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Reports"}),(0,Xf.jsx)("option",{value:"user_activity",children:"User Activity"}),(0,Xf.jsx)("option",{value:"emergency",children:"Emergency Response"}),(0,Xf.jsx)("option",{value:"medication",children:"Medication Compliance"}),(0,Xf.jsx)("option",{value:"caregiver",children:"Caregiver Performance"}),(0,Xf.jsx)("option",{value:"system",children:"System Health"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,Xf.jsx)("input",{type:"date",className:"form-input",value:r.startDate,onChange:e=>a(je(je({},r),{},{startDate:e.target.value}))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,Xf.jsx)("input",{type:"date",className:"form-input",value:r.endDate,onChange:e=>a(je(je({},r),{},{endDate:e.target.value}))})]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(ag,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Reports"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(ig,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Ready Reports"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"ready"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Generating"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"generating"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Qf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Records"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.reduce((e,t)=>e+t.records,0).toLocaleString()})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Reports"}),(0,Xf.jsx)("div",{className:"flex items-center space-x-2",children:(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:l(e.type)}),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.title}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Generated: ",new Date(e.generatedAt).toLocaleDateString()]}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Period: ",e.period]}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Records: ",e.records.toLocaleString()]})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-1",children:["ready"===e.status&&(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Viewing report:",t);var t},className:"p-2 text-gray-400 hover:text-gray-600",title:"View Report",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Downloading report:",t);var t},className:"p-2 text-gray-400 hover:text-gray-600",title:"Download Report",children:(0,Xf.jsx)($g,{className:"h-4 w-4"})})]}),"generating"===e.status&&(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,Xf.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"Generating..."})]})]})]})]})},e.id))}),0===e.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(ag,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No reports found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Generate your first report to get started."})]})]})]})},I_=Mf("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),A_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientEmail:"adunni@example.com",patientPhone:"+234 801 987 6543",doctorName:"Dr. Kemi Okafor",type:"Regular Checkup",dateTime:"2024-01-22T10:00:00Z",location:"Lagos General Hospital",status:"scheduled",notes:"Follow-up for hypertension medication",duration:30},{id:2,patientName:"Grace Johnson",patientEmail:"grace@example.com",patientPhone:"+234 803 456 7890",doctorName:"Dr. Michael Johnson",type:"Emergency Consultation",dateTime:"2024-01-21T14:30:00Z",location:"Emergency Room",status:"completed",notes:"Emergency visit for chest pain",duration:45},{id:3,patientName:"Tunde Adebayo",patientEmail:"tunde@example.com",patientPhone:"+234 802 123 4567",doctorName:"Dr. Sarah Williams",type:"Medication Review",dateTime:"2024-01-23T09:15:00Z",location:"Cardiology Clinic",status:"scheduled",notes:"Review diabetes medication effectiveness",duration:20},{id:4,patientName:"Mary Okonkwo",patientEmail:"mary@example.com",patientPhone:"+234 805 234 5678",doctorName:"Dr. Kemi Okafor",type:"Physical Therapy",dateTime:"2024-01-20T11:00:00Z",location:"Physical Therapy Center",status:"cancelled",notes:"Patient cancelled due to illness",duration:60}];n(e),s(e),a(!1)},1e3)}catch(e){console.error("Error loading appointments:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.doctorName.toLowerCase().includes(o.toLowerCase())||e.type.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),s(t)},[o,l,e]);const f=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"rescheduled":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"scheduled":return(0,Xf.jsx)(dg,{className:"h-4 w-4"});case"completed":return(0,Xf.jsx)(mg,{className:"h-4 w-4"});case"cancelled":return(0,Xf.jsx)(Ng,{className:"h-4 w-4"});case"rescheduled":return(0,Xf.jsx)(I_,{className:"h-4 w-4"});default:return(0,Xf.jsx)(Vf,{className:"h-4 w-4"})}},_=(e,t)=>{if(h(t),"view"===e)m(!0)},y=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Appointment Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage patient appointments and schedules"})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-2"}),"Schedule Appointment"]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"completed"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Scheduled"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"scheduled"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(Ng,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Cancelled"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"cancelled"===e.status).length})]})]})})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search appointments by patient, doctor, or type...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,Xf.jsx)("option",{value:"completed",children:"Completed"}),(0,Xf.jsx)("option",{value:"cancelled",children:"Cancelled"}),(0,Xf.jsx)("option",{value:"rescheduled",children:"Rescheduled"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>{const{date:t,time:n}=y(e.dateTime);return(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.patientEmail})]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.doctorName})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.type})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:t}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:n})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(e.status)),children:[g(e.status),(0,Xf.jsx)("span",{className:"ml-1",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>_("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>_("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Appointment",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),0===i.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(Vf,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No appointments found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No appointments have been scheduled yet."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Appointment Details"}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Name"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.patientName})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Doctor"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.doctorName})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Date & Time"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:y(u.dateTime).date})]}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:y(u.dateTime).time})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Duration"}),(0,Xf.jsxs)("p",{className:"mt-1 text-sm text-gray-900",children:[u.duration," minutes"]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Contact"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientPhone})]}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientEmail})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(u.status)),children:[g(u.status),(0,Xf.jsx)("span",{className:"ml-1",children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.notes})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Appointment"]})]})]})})})]})},O_=Mf("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),D_=Mf("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),k_=()=>{const[e,n]=(0,t.useState)("general"),[i,s]=(0,t.useState)({general:{platformName:"ElderX",platformDescription:"Your trusted health companion for elderly care",supportEmail:"support@elderx.com",supportPhone:"+234 800 ELDERX",timezone:"Africa/Lagos",language:"en"},notifications:{emailNotifications:!0,smsNotifications:!0,pushNotifications:!0,emergencyAlerts:!0,appointmentReminders:!0,medicationReminders:!0,systemAlerts:!0},security:{twoFactorAuth:!0,sessionTimeout:30,passwordPolicy:"strong",loginAttempts:5,ipWhitelist:!1,auditLogging:!0},system:{maintenanceMode:!1,autoBackup:!0,backupFrequency:"daily",dataRetention:365,apiRateLimit:1e3,maxFileSize:10}}),[r,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(null),l=[{id:"general",name:"General",icon:og},{id:"notifications",name:"Notifications",icon:qf},{id:"security",name:"Security",icon:cg},{id:"system",name:"System",icon:O_}],d=(e,t,n)=>{s(i=>je(je({},i),{},{[e]:je(je({},i[e]),{},{[t]:n})}))},u=()=>(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Platform Information"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Platform Name"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:i.general.platformName,onChange:e=>d("general","platformName",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Support Email"}),(0,Xf.jsx)("input",{type:"email",className:"form-input",value:i.general.supportEmail,onChange:e=>d("general","supportEmail",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Support Phone"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:i.general.supportPhone,onChange:e=>d("general","supportPhone",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),(0,Xf.jsxs)("select",{className:"form-input",value:i.general.timezone,onChange:e=>d("general","timezone",e.target.value),children:[(0,Xf.jsx)("option",{value:"Africa/Lagos",children:"Africa/Lagos"}),(0,Xf.jsx)("option",{value:"Africa/Cairo",children:"Africa/Cairo"}),(0,Xf.jsx)("option",{value:"Africa/Johannesburg",children:"Africa/Johannesburg"}),(0,Xf.jsx)("option",{value:"UTC",children:"UTC"})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6",children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Platform Description"}),(0,Xf.jsx)("textarea",{className:"form-input",rows:3,value:i.general.platformDescription,onChange:e=>d("general","platformDescription",e.target.value)})]})]})}),h=e=>({emailNotifications:"Send notifications via email",smsNotifications:"Send notifications via SMS",pushNotifications:"Send push notifications to mobile apps",emergencyAlerts:"Immediate alerts for emergency situations",appointmentReminders:"Remind users about upcoming appointments",medicationReminders:"Remind users to take medications",systemAlerts:"Notify about system issues and updates"}[e]||"");return(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"System Settings"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Configure platform settings and preferences"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:["success"===o&&(0,Xf.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm",children:"Saved successfully"})]}),"error"===o&&(0,Xf.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm",children:"Save failed"})]}),(0,Xf.jsxs)("button",{onClick:async()=>{a(!0),c(null);try{await new Promise(e=>setTimeout(e,1e3)),c("success"),setTimeout(()=>c(null),3e3)}catch(e){c("error"),setTimeout(()=>c(null),3e3)}finally{a(!1)}},disabled:r,className:"btn btn-primary",children:[(0,Xf.jsx)(D_,{className:"h-4 w-4 mr-2"}),r?"Saving...":"Save Changes"]})]})]}),(0,Xf.jsx)("div",{className:"border-b border-gray-200",children:(0,Xf.jsx)("nav",{className:"-mb-px flex space-x-8",children:l.map(t=>{const i=t.icon;return(0,Xf.jsxs)("button",{onClick:()=>n(t.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center ".concat(e===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(i,{className:"h-4 w-4 mr-2"}),t.name]},t.id)})})}),(0,Xf.jsx)("div",{className:"card",children:(()=>{switch(e){case"general":default:return u();case"notifications":return(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Notification Preferences"}),(0,Xf.jsx)("div",{className:"space-y-4",children:Object.entries(i.notifications).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:h(t)})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:e=>d("notifications",t,e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})})]})});case"security":return(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Security Configuration"}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Two-Factor Authentication"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Require 2FA for admin accounts"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:i.security.twoFactorAuth,onChange:e=>d("security","twoFactorAuth",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Timeout (minutes)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:i.security.sessionTimeout,onChange:e=>d("security","sessionTimeout",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password Policy"}),(0,Xf.jsxs)("select",{className:"form-input w-48",value:i.security.passwordPolicy,onChange:e=>d("security","passwordPolicy",e.target.value),children:[(0,Xf.jsx)("option",{value:"basic",children:"Basic (6+ characters)"}),(0,Xf.jsx)("option",{value:"medium",children:"Medium (8+ chars, mixed case)"}),(0,Xf.jsx)("option",{value:"strong",children:"Strong (8+ chars, mixed case, numbers, symbols)"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Login Attempts"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:i.security.loginAttempts,onChange:e=>d("security","loginAttempts",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Audit Logging"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Log all admin actions for security"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:i.security.auditLogging,onChange:e=>d("security","auditLogging",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]})});case"system":return(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"System Configuration"}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Maintenance Mode"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Temporarily disable platform access"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:i.system.maintenanceMode,onChange:e=>d("system","maintenanceMode",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Auto Backup"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Automatically backup system data"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:i.system.autoBackup,onChange:e=>d("system","autoBackup",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Frequency"}),(0,Xf.jsxs)("select",{className:"form-input w-48",value:i.system.backupFrequency,onChange:e=>d("system","backupFrequency",e.target.value),children:[(0,Xf.jsx)("option",{value:"hourly",children:"Hourly"}),(0,Xf.jsx)("option",{value:"daily",children:"Daily"}),(0,Xf.jsx)("option",{value:"weekly",children:"Weekly"}),(0,Xf.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Retention (days)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:i.system.dataRetention,onChange:e=>d("system","dataRetention",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Rate Limit (requests/hour)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:i.system.apiRateLimit,onChange:e=>d("system","apiRateLimit",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max File Size (MB)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:i.system.maxFileSize,onChange:e=>d("system","maxFileSize",parseInt(e.target.value))})]})]})]})})}})()})]})},P_=Mf("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),L_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({active:0,resolved:0,averageResponseTime:0,totalToday:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",patientPhone:"+234 801 987 6543",patientEmail:"adunni@example.com",emergencyType:"Medical Emergency",severity:"Critical",description:"Chest pain and difficulty breathing",location:"Lagos, Nigeria",coordinates:{lat:6.5244,lng:3.3792},triggeredAt:"2024-01-20T14:30:00Z",status:"active",responseTime:0,assignedTo:"Dr. Kemi Okafor",assignedToPhone:"+234 802 123 4567",familyContact:"Tunde Adebayo",familyPhone:"+234 803 456 7890",medicalHistory:["Hypertension","Diabetes Type 2"],currentMedications:["Metformin","Lisinopril"],notes:"Patient reported severe chest pain. Emergency services contacted.",actions:[{id:1,action:"Emergency services contacted",timestamp:"2024-01-20T14:32:00Z",performedBy:"System",status:"completed"},{id:2,action:"Family notified",timestamp:"2024-01-20T14:35:00Z",performedBy:"Admin",status:"completed"}]},{id:2,patientName:"Grace Johnson",patientId:"ELD002",patientPhone:"+234 803 456 7890",patientEmail:"grace@example.com",emergencyType:"Fall Detection",severity:"High",description:"Patient fell and may be injured",location:"Abuja, Nigeria",coordinates:{lat:9.0765,lng:7.3986},triggeredAt:"2024-01-20T10:15:00Z",status:"resolved",responseTime:12,assignedTo:"Dr. Michael Johnson",assignedToPhone:"+234 804 567 8901",familyContact:"John Johnson",familyPhone:"+234 805 678 9012",medicalHistory:["Arthritis","Osteoporosis"],currentMedications:["Calcium","Vitamin D"],notes:"Patient fell in bathroom. Minor injuries reported. Family assisted.",actions:[{id:1,action:"Fall detected by sensor",timestamp:"2024-01-20T10:15:00Z",performedBy:"IoT Device",status:"completed"},{id:2,action:"Family contacted",timestamp:"2024-01-20T10:18:00Z",performedBy:"System",status:"completed"},{id:3,action:"Emergency resolved",timestamp:"2024-01-20T10:27:00Z",performedBy:"Dr. Michael Johnson",status:"completed"}]},{id:3,patientName:"Tunde Adebayo",patientId:"ELD003",patientPhone:"+234 802 123 4567",patientEmail:"tunde@example.com",emergencyType:"Medication Overdose",severity:"Critical",description:"Patient may have taken double dose of medication",location:"Ibadan, Nigeria",coordinates:{lat:7.3775,lng:3.947},triggeredAt:"2024-01-20T08:45:00Z",status:"active",responseTime:0,assignedTo:"Dr. Sarah Williams",assignedToPhone:"+234 806 789 0123",familyContact:"Adebayo Family",familyPhone:"+234 807 890 1234",medicalHistory:["Diabetes Type 2","Heart Disease"],currentMedications:["Insulin","Metformin","Aspirin"],notes:"Patient accidentally took double dose of insulin. Monitoring blood sugar levels.",actions:[{id:1,action:"Overdose alert triggered",timestamp:"2024-01-20T08:45:00Z",performedBy:"Medication Tracker",status:"completed"},{id:2,action:"Emergency services contacted",timestamp:"2024-01-20T08:47:00Z",performedBy:"System",status:"completed"}]}],t=e.filter(e=>"active"===e.status).length,i=e.filter(e=>"resolved"===e.status).length,r=e.length,o=e.filter(e=>e.responseTime>0).reduce((e,t)=>e+t.responseTime,0)/i||0;g({active:t,resolved:i,averageResponseTime:Math.round(o),totalToday:r}),n(e),s(e),a(!1)},1e3)}catch(e){console.error("Error loading emergency data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.emergencyType.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),s(t)},[o,l,e]);const _=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800 border-red-200";case"High":return"bg-orange-100 text-orange-800 border-orange-200";case"Medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},y=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"resolved":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},v=e=>{switch(e){case"active":return(0,Xf.jsx)(eg,{className:"h-4 w-4"});case"resolved":return(0,Xf.jsx)(mg,{className:"h-4 w-4"});case"in_progress":return(0,Xf.jsx)($f,{className:"h-4 w-4"});default:return(0,Xf.jsx)(dg,{className:"h-4 w-4"})}},E=(e,t)=>{if(h(t),"view"===e)m(!0)},b=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},S=e=>{const t=new Date,n=new Date(e),i=Math.floor((t-n)/6e4);return i<1?"Just now":i<60?"".concat(i,"m ago"):i<1440?"".concat(Math.floor(i/60),"h ago"):"".concat(Math.floor(i/1440),"d ago")};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Monitor and manage emergency alerts in real-time"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(P_,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(qf,{className:"h-4 w-4 mr-2"}),"Test Alert"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Emergencies"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-red-600",children:f.active})]})]})}),(0,Xf.jsx)("div",{className:"card border-l-4 border-green-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Resolved Today"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-green-600",children:f.resolved})]})]})}),(0,Xf.jsx)("div",{className:"card border-l-4 border-blue-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Response Time"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[f.averageResponseTime,"m"]})]})]})}),(0,Xf.jsx)("div",{className:"card border-l-4 border-purple-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(ig,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Today"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:f.totalToday})]})]})})]}),f.active>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Active Emergency Alert"}),(0,Xf.jsxs)("p",{className:"text-red-600",children:[f.active," emergency",f.active>1?"ies":""," requiring immediate attention"]})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-red",children:[(0,Xf.jsx)(jg,{className:"h-4 w-4 mr-2"}),"View Active"]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search emergencies by patient, type, or description...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,Xf.jsx)("option",{value:"resolved",children:"Resolved"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Emergency Alerts"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:"Auto-refresh: ON"}),(0,Xf.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:i.map(e=>{const{date:t,time:n}=b(e.triggeredAt);return(0,Xf.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 ".concat("active"===e.status?"border-red-200 bg-red-50":"border-gray-200"),children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:"active"===e.status?(0,Xf.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}):(0,Xf.jsx)("div",{className:"w-3 h-3 bg-gray-300 rounded-full"})}),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(_(e.severity)),children:e.severity}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(y(e.status)),children:[v(e.status),(0,Xf.jsx)("span",{className:"ml-1",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-1"}),e.location]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-1"}),S(e.triggeredAt)]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-4 w-4 mr-1"}),e.assignedTo]})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>E("view",e),className:"p-2 text-gray-400 hover:text-gray-600",title:"View Details",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),"active"===e.status&&(0,Xf.jsx)("button",{onClick:()=>E("resolve",e),className:"p-2 text-green-600 hover:text-green-800",title:"Mark as Resolved",children:(0,Xf.jsx)(mg,{className:"h-4 w-4"})})]})]})},e.id)})}),0===i.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(cg,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No emergencies found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No emergency alerts at this time."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Emergency Details"}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(y(u.status)),children:[v(u.status),(0,Xf.jsx)("span",{className:"ml-1",children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Patient Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Name"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.patientName})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientPhone})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientEmail})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Medical Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medical History"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.medicalHistory.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:e},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Current Medications"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.currentMedications.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Emergency Details"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Type"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.emergencyType})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Severity"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(_(u.severity)),children:u.severity})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.description})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Triggered At"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[b(u.triggeredAt).date," at ",b(u.triggeredAt).time]})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Assigned Personnel"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Assigned Doctor"}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.assignedTo}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Family Contact"}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.familyContact}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Response Actions"}),(0,Xf.jsx)("div",{className:"space-y-2",children:u.actions.map(e=>(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 text-green-500"}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:e.action}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:[b(e.timestamp).date," at ",b(e.timestamp).time," by ",e.performedBy]})]})]},e.id))})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),"active"===u.status&&(0,Xf.jsxs)("button",{className:"btn btn-green",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-2"}),"Mark as Resolved"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 mr-2"}),"Add Note"]})]})]})})})]})},j_=Mf("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),M_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[_,y]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Cardiac Emergency Response",category:"Medical Emergency",severity:"Critical",description:"Standard protocol for handling cardiac emergencies including heart attacks and cardiac arrest",triggerConditions:["Chest pain reported","Heart rate irregular","Cardiac arrest detected","ECG abnormalities"],steps:[{id:1,step:"Immediate Assessment",description:"Assess patient consciousness and vital signs",duration:"2 minutes",responsible:"Emergency Response Team",priority:"Critical"},{id:2,step:"Call Emergency Services",description:"Contact local emergency services (911/999)",duration:"1 minute",responsible:"System/Admin",priority:"Critical"},{id:3,step:"Notify Family",description:"Contact emergency family contacts",duration:"2 minutes",responsible:"Admin",priority:"High"},{id:4,step:"CPR if Needed",description:"Begin CPR if patient is unresponsive",duration:"Ongoing",responsible:"Trained Personnel",priority:"Critical"},{id:5,step:"Medical History Review",description:"Review patient medical history and medications",duration:"3 minutes",responsible:"Medical Team",priority:"Medium"}],escalationRules:[{condition:"No response in 5 minutes",action:"Escalate to senior medical staff",contact:"Dr. Sarah Williams (+234 802 123 4567)"},{condition:"Patient condition worsens",action:"Contact emergency services again",contact:"Emergency Services (911)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Medical Director",name:"Dr. Sarah Williams",phone:"+234 802 123 4567",priority:"High"},{type:"Family Contact",name:"Emergency Family Contact",phone:"Patient-specific",priority:"High"}],isActive:!0,createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-01-20T14:30:00Z",createdBy:"Dr. Sarah Williams"},{id:2,name:"Fall Detection Response",category:"Fall Detection",severity:"High",description:"Protocol for responding to fall detection alerts from IoT devices",triggerConditions:["Fall detected by sensor","Patient reports fall","Caregiver reports fall","Motion sensor alerts"],steps:[{id:1,step:"Immediate Check",description:"Contact patient immediately via phone or app",duration:"1 minute",responsible:"System/Admin",priority:"High"},{id:2,step:"Assess Injury",description:"Determine if patient is injured and needs medical attention",duration:"3 minutes",responsible:"Medical Team",priority:"High"},{id:3,step:"Notify Family",description:"Contact family members about the fall",duration:"2 minutes",responsible:"Admin",priority:"Medium"},{id:4,step:"Arrange Care",description:"Arrange for caregiver or medical assistance if needed",duration:"5 minutes",responsible:"Care Team",priority:"Medium"}],escalationRules:[{condition:"Patient unresponsive",action:"Treat as medical emergency",contact:"Emergency Services (199)"},{condition:"Injury suspected",action:"Arrange immediate medical assessment",contact:"Dr. Michael Johnson (+234 803 456 7890)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Orthopedic Specialist",name:"Dr. Michael Johnson",phone:"+234 803 456 7890",priority:"High"}],isActive:!0,createdAt:"2024-01-10T09:00:00Z",updatedAt:"2024-01-18T16:45:00Z",createdBy:"Dr. Michael Johnson"},{id:3,name:"Medication Overdose Response",category:"Medication Emergency",severity:"Critical",description:"Protocol for handling medication overdoses and adverse reactions",triggerConditions:["Double dose detected","Wrong medication taken","Adverse reaction reported","Medication interaction alert"],steps:[{id:1,step:"Immediate Assessment",description:"Assess patient condition and vital signs",duration:"2 minutes",responsible:"Medical Team",priority:"Critical"},{id:2,step:"Identify Medication",description:"Determine which medication and dosage was taken",duration:"3 minutes",responsible:"Medical Team",priority:"Critical"},{id:3,step:"Contact Poison Control",description:"Contact poison control center for guidance",duration:"2 minutes",responsible:"Medical Team",priority:"Critical"},{id:4,step:"Emergency Services",description:"Call emergency services if needed",duration:"1 minute",responsible:"System/Admin",priority:"Critical"},{id:5,step:"Monitor Patient",description:"Continuous monitoring of patient condition",duration:"Ongoing",responsible:"Medical Team",priority:"High"}],escalationRules:[{condition:"Severe symptoms",action:"Immediate emergency services",contact:"Emergency Services (199)"},{condition:"Unknown medication",action:"Contact poison control immediately",contact:"Poison Control (+234 800 123 4567)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Poison Control",name:"National Poison Control",phone:"+234 800 123 4567",priority:"Critical"},{type:"Pharmacist",name:"Dr. Kemi Okafor",phone:"+234 804 567 8901",priority:"High"}],isActive:!0,createdAt:"2024-01-12T11:30:00Z",updatedAt:"2024-01-19T13:20:00Z",createdBy:"Dr. Kemi Okafor"}];n(e),s(e),a(!1)},1e3)}catch(e){console.error("Error loading protocols:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase())||e.category.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.category===l)),s(t)},[o,l,e]);const v=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800 border-red-200";case"High":return"bg-orange-100 text-orange-800 border-orange-200";case"Medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},E=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800";case"High":return"bg-orange-100 text-orange-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},b=e=>{switch(e){case"Medical Emergency":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-red-600"});case"Fall Detection":return(0,Xf.jsx)($f,{className:"h-5 w-5 text-orange-600"});case"Medication Emergency":return(0,Xf.jsx)(cg,{className:"h-5 w-5 text-purple-600"});default:return(0,Xf.jsx)(eg,{className:"h-5 w-5 text-gray-600"})}},S=(e,t)=>{switch(h(t),e){case"view":m(!0);break;case"edit":y(t),g(!0)}},x=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Protocols"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage emergency response protocols and procedures"})]}),(0,Xf.jsxs)("button",{onClick:()=>g(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Create Protocol"]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(cg,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Protocols"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Protocols"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>e.isActive).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Critical Protocols"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"Critical"===e.severity).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Categories"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:new Set(e.map(e=>e.category)).size})]})]})})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search protocols by name, description, or category...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Categories"}),(0,Xf.jsx)("option",{value:"Medical Emergency",children:"Medical Emergency"}),(0,Xf.jsx)("option",{value:"Fall Detection",children:"Fall Detection"}),(0,Xf.jsx)("option",{value:"Medication Emergency",children:"Medication Emergency"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Protocol"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:b(e.category)}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.description})]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e.category})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(v(e.severity)),children:e.severity})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)(mg,{className:"h-3 w-3 mr-1"}),"Active"]}):(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)(Ng,{className:"h-3 w-3 mr-1"}),"Inactive"]})})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(e.updatedAt).date}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>S("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>S("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Protocol",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>S("copy",e),className:"text-purple-600 hover:text-purple-900",title:"Copy Protocol",children:(0,Xf.jsx)(j_,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===i.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(cg,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No protocols found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"Create your first emergency protocol to get started."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[b(u.category),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.name}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(v(u.severity)),children:u.severity})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Description"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-700",children:u.description})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Trigger Conditions"}),(0,Xf.jsx)("ul",{className:"list-disc list-inside space-y-1",children:u.triggerConditions.map((e,t)=>(0,Xf.jsx)("li",{className:"text-sm text-gray-700",children:e},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Response Steps"}),(0,Xf.jsx)("div",{className:"space-y-3",children:u.steps.map(e=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Xf.jsx)("h5",{className:"font-medium text-gray-900",children:e.step}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(E(e.priority)),children:e.priority})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-3 w-3 mr-1"}),e.duration]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Zf,{className:"h-3 w-3 mr-1"}),e.responsible]})]})]},e.id))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Escalation Rules"}),(0,Xf.jsx)("div",{className:"space-y-2",children:u.escalationRules.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 text-yellow-600"}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.condition}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.action}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:["Contact: ",e.contact]})]})]},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Emergency Contacts"}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.contacts.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:e.type})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(E(e.priority)),children:e.priority}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{onClick:()=>S("edit",u),className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Protocol"]})]})]})})})]})},U_=Mf("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),V_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({totalMedications:0,activeMedications:0,complianceRate:0,overdueDoses:0,drugInteractions:0,sideEffects:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",medicationName:"Metformin",genericName:"Metformin HCl",dosage:"500mg",frequency:"Twice daily",route:"Oral",startDate:"2024-01-01",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:92,totalDoses:60,takenDoses:55,missedDoses:5,lastTaken:"2024-01-20T08:00:00Z",nextDose:"2024-01-20T20:00:00Z",sideEffects:["Mild nausea","Occasional diarrhea"],drugInteractions:["Warfarin - Monitor INR"],instructions:"Take with food to reduce stomach upset",notes:"Patient reports good tolerance. Blood sugar well controlled.",reminders:{enabled:!0,times:["08:00","20:00"],methods:["push","sms"]}},{id:2,patientName:"Adunni Okafor",patientId:"ELD001",medicationName:"Lisinopril",genericName:"Lisinopril",dosage:"10mg",frequency:"Once daily",route:"Oral",startDate:"2023-12-15",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:98,totalDoses:35,takenDoses:34,missedDoses:1,lastTaken:"2024-01-20T09:00:00Z",nextDose:"2024-01-21T09:00:00Z",sideEffects:["Dry cough"],drugInteractions:["Potassium supplements - Monitor levels"],instructions:"Take at the same time each day",notes:"Blood pressure well controlled. Patient tolerates well.",reminders:{enabled:!0,times:["09:00"],methods:["push","email"]}},{id:3,patientName:"Grace Johnson",patientId:"ELD002",medicationName:"Calcium Carbonate",genericName:"Calcium Carbonate",dosage:"1000mg",frequency:"Twice daily",route:"Oral",startDate:"2024-01-10",endDate:"2024-12-31",prescribedBy:"Dr. Michael Johnson",status:"active",complianceRate:85,totalDoses:20,takenDoses:17,missedDoses:3,lastTaken:"2024-01-19T12:00:00Z",nextDose:"2024-01-20T12:00:00Z",sideEffects:["Constipation"],drugInteractions:["Iron supplements - Take 2 hours apart"],instructions:"Take with food and plenty of water",notes:"Patient needs reminder to take with meals.",reminders:{enabled:!0,times:["08:00","18:00"],methods:["push","sms","call"]}},{id:4,patientName:"Tunde Adebayo",patientId:"ELD003",medicationName:"Insulin Glargine",genericName:"Insulin Glargine",dosage:"30 units",frequency:"Once daily",route:"Subcutaneous",startDate:"2023-11-01",endDate:"2024-12-31",prescribedBy:"Dr. Sarah Williams",status:"active",complianceRate:95,totalDoses:80,takenDoses:76,missedDoses:4,lastTaken:"2024-01-20T07:00:00Z",nextDose:"2024-01-21T07:00:00Z",sideEffects:["Injection site irritation"],drugInteractions:["Alcohol - Monitor blood sugar"],instructions:"Inject at the same time each day, rotate injection sites",notes:"Blood sugar levels well controlled. Patient self-injects successfully.",reminders:{enabled:!0,times:["07:00"],methods:["push","sms"]}},{id:5,patientName:"Mary Okonkwo",patientId:"ELD004",medicationName:"Warfarin",genericName:"Warfarin Sodium",dosage:"5mg",frequency:"Once daily",route:"Oral",startDate:"2024-01-05",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:88,totalDoses:15,takenDoses:13,missedDoses:2,lastTaken:"2024-01-19T18:00:00Z",nextDose:"2024-01-20T18:00:00Z",sideEffects:["Bruising"],drugInteractions:["Metformin - Monitor INR closely","Aspirin - Increased bleeding risk"],instructions:"Take at the same time each day. Regular INR monitoring required.",notes:"INR levels stable. Patient educated about bleeding precautions.",reminders:{enabled:!0,times:["18:00"],methods:["push","call"]}}],t=e.length,i=e.filter(e=>"active"===e.status).length,r=e.reduce((e,t)=>e+t.complianceRate,0)/t,o=e.filter(e=>new Date(e.nextDose)<new Date&&"active"===e.status).length,c=e.reduce((e,t)=>e+t.drugInteractions.length,0),l=e.reduce((e,t)=>e+t.sideEffects.length,0);g({totalMedications:t,activeMedications:i,complianceRate:Math.round(r),overdueDoses:o,drugInteractions:c,sideEffects:l}),n(e),s(e),a(!1)},1e3)}catch(e){console.error("Error loading medication data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.medicationName.toLowerCase().includes(o.toLowerCase())||e.genericName.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),s(t)},[o,l,e]);const _=e=>e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600",y=e=>e>=90?(0,Xf.jsx)(ig,{className:"h-4 w-4 text-green-600"}):e>=80?(0,Xf.jsx)($f,{className:"h-4 w-4 text-yellow-600"}):(0,Xf.jsx)(U_,{className:"h-4 w-4 text-red-600"}),v=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"paused":return"bg-yellow-100 text-yellow-800";case"discontinued":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=(e,t)=>{if(h(t),"view"===e)m(!0)},b=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},S=e=>new Date(e)<new Date;return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medication Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Monitor medication compliance and manage prescriptions"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Add Medication"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(tg,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Medications"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalMedications})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.activeMedications})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Qf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Compliance Rate"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[f.complianceRate,"%"]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Overdue Doses"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.overdueDoses})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(cg,{className:"h-6 w-6 text-orange-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Drug Interactions"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.drugInteractions})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Side Effects"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.sideEffects})]})]})})]}),f.overdueDoses>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Overdue Medication Doses"}),(0,Xf.jsxs)("p",{className:"text-red-600",children:[f.overdueDoses," medication dose",f.overdueDoses>1?"s":""," are overdue and need immediate attention"]})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-red",children:[(0,Xf.jsx)(qf,{className:"h-4 w-4 mr-2"}),"Send Reminders"]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search medications by patient, medication name, or generic name...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"paused",children:"Paused"}),(0,Xf.jsx)("option",{value:"discontinued",children:"Discontinued"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient & Medication"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dosage & Frequency"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compliance"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Dose"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>{const{date:t,time:n}=b(e.nextDose),i=S(e.nextDose);return(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(i?"bg-red-50":""),children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(tg,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.medicationName}),(0,Xf.jsx)("div",{className:"text-xs text-gray-400",children:e.genericName})]})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.dosage}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.frequency}),(0,Xf.jsx)("div",{className:"text-xs text-gray-400",children:e.route})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[y(e.complianceRate),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(_(e.complianceRate)),children:[e.complianceRate,"%"]})]}),(0,Xf.jsxs)("div",{className:"text-xs text-gray-500",children:[e.takenDoses,"/",e.totalDoses," doses"]})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm ".concat(i?"text-red-600 font-medium":"text-gray-900"),children:t}),(0,Xf.jsx)("div",{className:"text-sm ".concat(i?"text-red-500":"text-gray-500"),children:n}),i&&(0,Xf.jsx)("div",{className:"text-xs text-red-600 font-medium",children:"OVERDUE"})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(v(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>E("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>E("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Medication",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),0===i.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(tg,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No medications found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No medications have been added yet."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)(tg,{className:"h-6 w-6 text-blue-600"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Medication Details"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(v(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Medication Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.patientName})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medication Name"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.medicationName}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:["(",u.genericName,")"]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Dosage"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.dosage})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Route"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.route})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Frequency"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.frequency})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Prescribed By"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.prescribedBy})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Compliance Tracking"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Compliance Rate"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[y(u.complianceRate),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(_(u.complianceRate)),children:[u.complianceRate,"%"]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Doses Taken"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.takenDoses,"/",u.totalDoses]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Missed Doses"}),(0,Xf.jsx)("span",{className:"text-sm text-red-600",children:u.missedDoses})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Taken"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[b(u.lastTaken).date," at ",b(u.lastTaken).time]})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Schedule & Reminders"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Next Dose"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm ".concat(S(u.nextDose)?"text-red-600 font-medium":"text-gray-900"),children:[b(u.nextDose).date," at ",b(u.nextDose).time]})]}),S(u.nextDose)&&(0,Xf.jsx)("span",{className:"text-xs text-red-600 font-medium",children:"OVERDUE"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Reminders"}),(0,Xf.jsxs)("div",{className:"space-y-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(qf,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.reminders.enabled?"Enabled":"Disabled"})]}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:["Times: ",u.reminders.times.join(", ")]}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:["Methods: ",u.reminders.methods.join(", ")]})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Safety Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[u.sideEffects.length>0&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Side Effects"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.sideEffects.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:e},t))})]}),u.drugInteractions.length>0&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Drug Interactions"}),(0,Xf.jsx)("div",{className:"space-y-1 mt-1",children:u.drugInteractions.map((e,t)=>(0,Xf.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:e},t))})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Instructions & Notes"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Instructions"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.instructions})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.notes})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Medication"]})]})]})})})]})},F_=()=>{const[e,n]=(0,t.useState)({complianceTrends:[],medicationStats:[],patientCompliance:[],sideEffectReports:[],drugInteractions:[],reminderEffectiveness:[]}),[i,s]=(0,t.useState)(!0),[r,a]=(0,t.useState)("30days"),[o,c]=(0,t.useState)("compliance");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n({complianceTrends:[{date:"2024-01-01",compliance:85,patients:120},{date:"2024-01-02",compliance:87,patients:122},{date:"2024-01-03",compliance:89,patients:125},{date:"2024-01-04",compliance:88,patients:128},{date:"2024-01-05",compliance:91,patients:130},{date:"2024-01-06",compliance:90,patients:132},{date:"2024-01-07",compliance:92,patients:135},{date:"2024-01-08",compliance:89,patients:138},{date:"2024-01-09",compliance:87,patients:140},{date:"2024-01-10",compliance:90,patients:142},{date:"2024-01-11",compliance:93,patients:145},{date:"2024-01-12",compliance:91,patients:148},{date:"2024-01-13",compliance:88,patients:150},{date:"2024-01-14",compliance:90,patients:152},{date:"2024-01-15",compliance:92,patients:155},{date:"2024-01-16",compliance:89,patients:158},{date:"2024-01-17",compliance:87,patients:160},{date:"2024-01-18",compliance:91,patients:162},{date:"2024-01-19",compliance:93,patients:165},{date:"2024-01-20",compliance:90,patients:167}],medicationStats:[{medication:"Metformin",totalPatients:45,avgCompliance:92,sideEffects:3,interactions:2},{medication:"Lisinopril",totalPatients:38,avgCompliance:88,sideEffects:5,interactions:1},{medication:"Insulin",totalPatients:25,avgCompliance:95,sideEffects:2,interactions:3},{medication:"Warfarin",totalPatients:18,avgCompliance:85,sideEffects:4,interactions:4},{medication:"Calcium",totalPatients:32,avgCompliance:78,sideEffects:6,interactions:1},{medication:"Aspirin",totalPatients:28,avgCompliance:90,sideEffects:2,interactions:2}],patientCompliance:[{patient:"Adunni Okafor",totalMedications:3,compliance:92,missedDoses:5,lastCheck:"2024-01-20"},{patient:"Grace Johnson",totalMedications:2,compliance:85,missedDoses:8,lastCheck:"2024-01-19"},{patient:"Tunde Adebayo",totalMedications:4,compliance:95,missedDoses:2,lastCheck:"2024-01-20"},{patient:"Mary Okonkwo",totalMedications:2,compliance:88,missedDoses:6,lastCheck:"2024-01-18"},{patient:"John Smith",totalMedications:3,compliance:78,missedDoses:12,lastCheck:"2024-01-17"},{patient:"Sarah Williams",totalMedications:1,compliance:96,missedDoses:1,lastCheck:"2024-01-20"}],sideEffectReports:[{medication:"Metformin",sideEffect:"Nausea",frequency:12,severity:"Mild",trend:"decreasing"},{medication:"Lisinopril",sideEffect:"Dry Cough",frequency:8,severity:"Moderate",trend:"stable"},{medication:"Warfarin",sideEffect:"Bruising",frequency:6,severity:"Mild",trend:"stable"},{medication:"Calcium",sideEffect:"Constipation",frequency:15,severity:"Mild",trend:"increasing"},{medication:"Insulin",sideEffect:"Injection Site Irritation",frequency:4,severity:"Mild",trend:"decreasing"}],drugInteractions:[{medication1:"Warfarin",medication2:"Aspirin",severity:"High",frequency:3,action:"Monitor INR closely"},{medication1:"Metformin",medication2:"Warfarin",severity:"Medium",frequency:2,action:"Monitor blood sugar"},{medication1:"Calcium",medication2:"Iron",severity:"Low",frequency:5,action:"Take 2 hours apart"},{medication1:"Lisinopril",medication2:"Potassium",severity:"Medium",frequency:1,action:"Monitor potassium levels"}],reminderEffectiveness:[{method:"Push Notifications",sent:1250,responded:1100,effectiveness:88},{method:"SMS",sent:890,responded:756,effectiveness:85},{method:"Email",sent:650,responded:520,effectiveness:80},{method:"Phone Calls",sent:120,responded:108,effectiveness:90}]}),s(!1)},1e3)}catch(e){console.error("Error loading analytics data:",e),s(!1)}})()},[r]);const l=e=>e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600",d=e=>e>=90?(0,Xf.jsx)(ig,{className:"h-4 w-4 text-green-600"}):e>=80?(0,Xf.jsx)($f,{className:"h-4 w-4 text-yellow-600"}):(0,Xf.jsx)(U_,{className:"h-4 w-4 text-red-600"}),u=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},h=e=>{switch(e){case"increasing":return(0,Xf.jsx)(ig,{className:"h-4 w-4 text-red-600"});case"decreasing":return(0,Xf.jsx)(U_,{className:"h-4 w-4 text-green-600"});case"stable":return(0,Xf.jsx)($f,{className:"h-4 w-4 text-blue-600"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4 text-gray-600"})}};return i?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medication Analytics"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Comprehensive medication compliance and safety analytics"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("select",{className:"form-input",value:r,onChange:e=>a(e.target.value),children:[(0,Xf.jsx)("option",{value:"7days",children:"Last 7 days"}),(0,Xf.jsx)("option",{value:"30days",children:"Last 30 days"}),(0,Xf.jsx)("option",{value:"90days",children:"Last 90 days"}),(0,Xf.jsx)("option",{value:"1year",children:"Last year"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Qf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Compliance"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"90%"}),(0,Xf.jsx)("p",{className:"text-xs text-green-600",children:"+2% from last month"})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Doses Taken"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"2,847"}),(0,Xf.jsx)("p",{className:"text-xs text-green-600",children:"+5% from last month"})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(Ng,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Missed Doses"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"156"}),(0,Xf.jsx)("p",{className:"text-xs text-red-600",children:"-8% from last month"})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Patients"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"167"}),(0,Xf.jsx)("p",{className:"text-xs text-blue-600",children:"+12 from last month"})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Compliance Trends"}),(0,Xf.jsx)("div",{className:"flex items-center space-x-2",children:(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),(0,Xf.jsx)("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Qf,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Xf.jsx)("p",{className:"text-gray-500",children:"Compliance trend chart would be displayed here"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-400",children:"Integration with charting library needed"})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medication Performance"}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Medication"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patients"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Compliance"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Side Effects"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Interactions"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.medicationStats.map((e,t)=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(tg,{className:"h-5 w-5 text-blue-600 mr-3"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.medication})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.totalPatients})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[d(e.avgCompliance),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(l(e.avgCompliance)),children:[e.avgCompliance,"%"]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.sideEffects})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.interactions})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})})})]},t))})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Patient Compliance Overview"}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Medications"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compliance"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Missed Doses"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Check"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.patientCompliance.map((e,t)=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center mr-3",children:(0,Xf.jsx)("span",{className:"text-xs font-medium text-gray-700",children:e.patient.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.patient})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.totalMedications})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[d(e.compliance),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(l(e.compliance)),children:[e.compliance,"%"]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.missedDoses})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.lastCheck})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})})})]},t))})]})})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Side Effect Reports"}),(0,Xf.jsx)("div",{className:"space-y-3",children:e.sideEffectReports.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(tg,{className:"h-4 w-4 text-blue-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.medication})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[h(e.trend),(0,Xf.jsx)("span",{className:"ml-1 text-xs text-gray-500",children:e.trend})]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.sideEffect}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:["Frequency: ",e.frequency]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("Mild"===e.severity?"bg-green-100 text-green-800":"Moderate"===e.severity?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.severity})]})]},t))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Drug Interactions"}),(0,Xf.jsx)("div",{className:"space-y-3",children:e.drugInteractions.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 text-orange-600 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.medication1," + ",e.medication2]})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(u(e.severity)),children:e.severity})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.action}),(0,Xf.jsx)("div",{className:"flex items-center justify-between",children:(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:["Frequency: ",e.frequency]})})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Reminder Effectiveness"}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:e.reminderEffectiveness.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.method}),(0,Xf.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[e.effectiveness,"%"]})]}),(0,Xf.jsxs)("div",{className:"space-y-1",children:[(0,Xf.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:["Sent: ",e.sent]}),(0,Xf.jsxs)("span",{children:["Responded: ",e.responded]})]}),(0,Xf.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Xf.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(e.effectiveness,"%")}})})]})]},t))})]})]})},B_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({totalCaregivers:0,activeCaregivers:0,averageRating:0,totalPatients:0,pendingAssignments:0,trainingCompleted:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",status:"active",rating:4.8,totalPatients:8,currentPatients:3,experience:"5 years",specializations:["Elderly Care","Dementia Care","Physical Therapy"],certifications:["CPR Certified","First Aid","Dementia Care Specialist"],location:"Lagos, Nigeria",availability:"Full-time",hourlyRate:2500,joinDate:"2023-06-15",lastActive:"2024-01-20T14:30:00Z",profileImage:null,bio:"Experienced caregiver with 5 years of dedicated service to elderly patients. Specializes in dementia care and physical therapy assistance.",languages:["English","Yoruba"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[{patientId:"ELD001",patientName:"Adunni Okafor",startDate:"2024-01-15",schedule:"Mon-Fri, 9AM-5PM",status:"active"},{patientId:"ELD002",patientName:"Grace Johnson",startDate:"2024-01-10",schedule:"Tue-Thu, 2PM-6PM",status:"active"}],performance:{punctuality:95,patientSatisfaction:4.8,taskCompletion:98,communication:4.7,safety:100},earnings:{thisMonth:18e4,lastMonth:175e3,total:21e5}},{id:2,name:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890",status:"active",rating:4.9,totalPatients:12,currentPatients:4,experience:"7 years",specializations:["Post-Surgery Care","Medication Management","Mobility Assistance"],certifications:["CPR Certified","First Aid","Medication Administration","Physical Therapy Aide"],location:"Abuja, Nigeria",availability:"Part-time",hourlyRate:3e3,joinDate:"2022-03-20",lastActive:"2024-01-20T16:45:00Z",profileImage:null,bio:"Highly skilled caregiver with extensive experience in post-surgery care and medication management. Known for excellent patient communication.",languages:["English","Hausa"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[{patientId:"ELD003",patientName:"Tunde Adebayo",startDate:"2024-01-12",schedule:"Mon-Wed-Fri, 10AM-4PM",status:"active"},{patientId:"ELD004",patientName:"Mary Okonkwo",startDate:"2024-01-08",schedule:"Tue-Thu, 1PM-7PM",status:"active"}],performance:{punctuality:98,patientSatisfaction:4.9,taskCompletion:100,communication:4.8,safety:100},earnings:{thisMonth:22e4,lastMonth:21e4,total:28e5}},{id:3,name:"Michael Johnson",email:"michael@example.com",phone:"+234 804 567 8901",status:"pending",rating:0,totalPatients:0,currentPatients:0,experience:"2 years",specializations:["Basic Care","Companionship"],certifications:["CPR Certified","First Aid"],location:"Ibadan, Nigeria",availability:"Full-time",hourlyRate:2e3,joinDate:"2024-01-18",lastActive:"2024-01-19T10:15:00Z",profileImage:null,bio:"New caregiver eager to provide quality care to elderly patients. Recently completed training and ready to start.",languages:["English","Yoruba"],vehicle:!1,backgroundCheck:"Pending",insurance:"Pending",currentAssignments:[],performance:{punctuality:0,patientSatisfaction:0,taskCompletion:0,communication:0,safety:0},earnings:{thisMonth:0,lastMonth:0,total:0}},{id:4,name:"Grace Okafor",email:"grace@example.com",phone:"+234 805 678 9012",status:"inactive",rating:4.6,totalPatients:15,currentPatients:0,experience:"6 years",specializations:["Palliative Care","End-of-Life Care","Family Support"],certifications:["CPR Certified","First Aid","Palliative Care Specialist","Grief Counseling"],location:"Port Harcourt, Nigeria",availability:"On-call",hourlyRate:3500,joinDate:"2021-09-10",lastActive:"2024-01-15T12:00:00Z",profileImage:null,bio:"Specialized in palliative and end-of-life care. Currently on temporary leave for personal reasons.",languages:["English","Igbo"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[],performance:{punctuality:92,patientSatisfaction:4.6,taskCompletion:95,communication:4.5,safety:98},earnings:{thisMonth:0,lastMonth:45e3,total:32e5}}],t=e.length,i=e.filter(e=>"active"===e.status).length,r=e.filter(e=>e.rating>0).reduce((e,t)=>e+t.rating,0)/e.filter(e=>e.rating>0).length,o=e.reduce((e,t)=>e+t.currentPatients,0),c=e.filter(e=>"pending"===e.status).length,l=e.filter(e=>e.certifications.length>=2).length;g({totalCaregivers:t,activeCaregivers:i,averageRating:Math.round(10*r)/10,totalPatients:o,pendingAssignments:c,trainingCompleted:l}),n(e),s(e),a(!1)},1e3)}catch(e){console.error("Error loading caregiver data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.specializations.some(e=>e.toLowerCase().includes(o.toLowerCase())))),"all"!==l&&(t=t.filter(e=>e.status===l)),s(t)},[o,l,e]);const _=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=e=>e>=4.5?"text-green-600":e>=4?"text-yellow-600":e>=3?"text-orange-600":"text-red-600",v=(e,t)=>{if(h(t),"view"===e)m(!0)};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Caregiver Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage caregivers, assignments, and performance"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(T_,{className:"h-4 w-4 mr-2"}),"Add Caregiver"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Caregivers"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalCaregivers})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.activeCaregivers})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.pendingAssignments})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(fg,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Rating"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.averageRating})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-orange-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Patients"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalPatients})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-indigo-100 rounded-full",children:(0,Xf.jsx)(yg,{className:"h-6 w-6 text-indigo-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Trained"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.trainingCompleted})]})]})})]}),f.pendingAssignments>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-yellow-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-yellow-800",children:"Pending Caregiver Approvals"}),(0,Xf.jsxs)("p",{className:"text-yellow-600",children:[f.pendingAssignments," caregiver",f.pendingAssignments>1?"s":""," waiting for approval and assignment"]})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-yellow",children:[(0,Xf.jsx)(jg,{className:"h-4 w-4 mr-2"}),"Review Pending"]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search caregivers by name, email, or specialization...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"pending",children:"Pending"}),(0,Xf.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Caregiver"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating & Experience"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Patients"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Specializations"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),(0,Xf.jsx)("div",{className:"text-xs text-gray-400",children:e.location})]})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium ".concat(y(e.rating)),children:e.rating>0?e.rating:"N/A"})]}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.experience}),(0,Xf.jsxs)("div",{className:"text-xs text-gray-400",children:["\u20a6",e.hourlyRate.toLocaleString(),"/hr"]})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.currentPatients}),(0,Xf.jsxs)("div",{className:"text-xs text-gray-500",children:["of ",e.totalPatients," total"]})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.specializations.slice(0,2).map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t)),e.specializations.length>2&&(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.specializations.length-2," more"]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(_(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>v("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>v("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Caregiver",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>v("assign",e),className:"text-purple-600 hover:text-purple-900",title:"Assign Patient",children:(0,Xf.jsx)(wg,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===i.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(Zf,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No caregivers found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No caregivers have been added yet."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-lg font-medium text-gray-700",children:u.name.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.name}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(_(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Contact Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.email})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.phone})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Professional Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Experience"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.experience})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Hourly Rate"}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-900",children:["\u20a6",u.hourlyRate.toLocaleString()]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Availability"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.availability})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Languages"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.languages.join(", ")})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Specializations"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2",children:u.specializations.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Certifications"}),(0,Xf.jsx)("div",{className:"space-y-2",children:u.certifications.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(yg,{className:"h-4 w-4 text-green-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Performance Metrics"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Overall Rating"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium ".concat(y(u.rating)),children:u.rating>0?u.rating:"N/A"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Punctuality"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.punctuality,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Patient Satisfaction"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.performance.patientSatisfaction})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Task Completion"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.taskCompletion,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Communication"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.performance.communication})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Safety Record"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.safety,"%"]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Current Assignments"}),(0,Xf.jsx)("div",{className:"space-y-3",children:u.currentAssignments.length>0?u.currentAssignments.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("h5",{className:"font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.schedule}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:["Started: ",e.startDate]})]},t)):(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"No current assignments"})})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Earnings Summary"}),(0,Xf.jsxs)("div",{className:"space-y-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"This Month"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["\u20a6",u.earnings.thisMonth.toLocaleString()]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Last Month"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:["\u20a6",u.earnings.lastMonth.toLocaleString()]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Total Earnings"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["\u20a6",u.earnings.total.toLocaleString()]})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Caregiver"]}),(0,Xf.jsxs)("button",{className:"btn btn-green",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Assign Patient"]})]})]})})})]})},G_=Mf("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),W_=Mf("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),H_=Mf("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),K_=()=>{const[e,n]=(0,t.useState)({overview:{},userMetrics:{},caregiverMetrics:{},emergencyMetrics:{},medicationMetrics:{},financialMetrics:{},geographicData:{},trends:{}}),[i,s]=(0,t.useState)(!0),[r,a]=(0,t.useState)("30d"),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)({overview:!0,users:!0,caregivers:!1,emergencies:!1,medications:!1,financial:!1,geographic:!1,trends:!1});(0,t.useEffect)(()=>{u()},[r]);const u=async()=>{try{s(!0),setTimeout(()=>{n({overview:{totalUsers:1247,activeCaregivers:89,totalAppointments:2341,emergencyAlerts:12,medicationCompliance:94.2,systemUptime:99.8,userGrowth:15.3,caregiverSatisfaction:4.7},userMetrics:{totalUsers:1247,newUsersThisMonth:156,activeUsers:892,inactiveUsers:355,userRetention:87.3,averageAge:72.5,genderDistribution:{male:45.2,female:54.8},locationDistribution:{Lagos:35.2,Abuja:22.1,Kano:15.8,"Port Harcourt":12.4,Ibadan:8.9,Others:5.6},registrationTrend:[{month:"Jan",count:89},{month:"Feb",count:112},{month:"Mar",count:98},{month:"Apr",count:134},{month:"May",count:156},{month:"Jun",count:178}]},caregiverMetrics:{totalCaregivers:89,activeCaregivers:67,pendingCaregivers:12,inactiveCaregivers:10,averageRating:4.6,averageExperience:4.2,topPerformers:[{name:"Tunde Adebayo",rating:4.9,patients:8,earnings:18e4},{name:"Sarah Williams",rating:4.8,patients:6,earnings:165e3},{name:"Grace Okafor",rating:4.7,patients:7,earnings:155e3}],performanceDistribution:{"Excellent (4.5+)":45,"Good (4.0-4.4)":32,"Average (3.5-3.9)":8,"Below Average (<3.5)":4},specializations:{"Elderly Care":67,"Dementia Care":45,"Physical Therapy":38,"Medication Management":52,"Post-Surgery Care":29}},emergencyMetrics:{totalEmergencies:12,resolvedEmergencies:10,activeEmergencies:2,averageResponseTime:8.5,emergencyTypes:{"Medical Emergency":5,Fall:3,"Medication Issue":2,"Equipment Malfunction":1,Other:1},responseTimeTrend:[{day:"Mon",time:7.2},{day:"Tue",time:8.1},{day:"Wed",time:9.3},{day:"Thu",time:6.8},{day:"Fri",time:8.9},{day:"Sat",time:10.2},{day:"Sun",time:9.1}],severityDistribution:{Critical:2,High:4,Medium:5,Low:1}},medicationMetrics:{totalMedications:2341,complianceRate:94.2,missedDoses:89,medicationErrors:3,averageAdherence:96.1,medicationTypes:{"Blood Pressure":456,Diabetes:389,"Heart Medication":234,"Pain Management":567,Vitamins:445,Other:250},complianceTrend:[{week:"Week 1",rate:92.1},{week:"Week 2",rate:94.3},{week:"Week 3",rate:95.8},{week:"Week 4",rate:94.2}]},financialMetrics:{totalRevenue:125e5,monthlyRevenue:21e5,revenueGrowth:12.5,averageTransactionValue:45e3,revenueByService:{"Caregiver Services":85e5,"Medication Management":21e5,"Emergency Services":12e5,Consultation:7e5},paymentMethods:{"Bank Transfer":45.2,"Card Payment":32.1,"Mobile Money":18.7,Cash:4},monthlyRevenueTrend:[{month:"Jan",revenue:18e5},{month:"Feb",revenue:195e4},{month:"Mar",revenue:21e5},{month:"Apr",revenue:205e4},{month:"May",revenue:22e5},{month:"Jun",revenue:21e5}]},geographicData:{userDistribution:{Lagos:439,Abuja:276,Kano:197,"Port Harcourt":155,Ibadan:111,Others:69},caregiverDistribution:{Lagos:31,Abuja:19,Kano:14,"Port Harcourt":11,Ibadan:8,Others:6},serviceAreas:[{city:"Lagos",coverage:95,users:439,caregivers:31},{city:"Abuja",coverage:88,users:276,caregivers:19},{city:"Kano",coverage:75,users:197,caregivers:14},{city:"Port Harcourt",coverage:70,users:155,caregivers:11},{city:"Ibadan",coverage:65,users:111,caregivers:8}]},trends:{userGrowth:[{month:"Jan",growth:8.2},{month:"Feb",growth:12.1},{month:"Mar",growth:9.8},{month:"Apr",growth:15.3},{month:"May",growth:18.7},{month:"Jun",growth:15.3}],caregiverGrowth:[{month:"Jan",growth:5.1},{month:"Feb",growth:8.3},{month:"Mar",growth:6.7},{month:"Apr",growth:11.2},{month:"May",growth:13.8},{month:"Jun",growth:10.5}],serviceDemand:{"Caregiver Services":78.5,"Medication Management":65.2,"Emergency Response":45.8,"Health Monitoring":52.3,"Family Communication":38.7}}}),s(!1)},1500)}catch(e){console.error("Error loading analytics data:",e),s(!1)}},h=e=>{d(t=>je(je({},t),{},{[e]:!t[e]}))},p=e=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(e),m=function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e>0?(0,Xf.jsx)(ig,{className:"h-4 w-4 text-green-500"}):(0,Xf.jsx)(U_,{className:"h-4 w-4 text-red-500"}):e>0?(0,Xf.jsx)(U_,{className:"h-4 w-4 text-red-500"}):(0,Xf.jsx)(ig,{className:"h-4 w-4 text-green-500"})},f=function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e>0?"text-green-600":"text-red-600":e>0?"text-red-600":"text-green-600"};return i?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Comprehensive insights and performance metrics"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("select",{className:"form-input",value:r,onChange:e=>a(e.target.value),children:[(0,Xf.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,Xf.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,Xf.jsx)("option",{value:"90d",children:"Last 90 days"}),(0,Xf.jsx)("option",{value:"1y",children:"Last year"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Xf.jsxs)("button",{onClick:u,className:"btn btn-primary",children:[(0,Xf.jsx)(P_,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(g=e.overview.totalUsers,g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toString())}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[m(e.overview.userGrowth),(0,Xf.jsxs)("span",{className:"text-sm ".concat(f(e.overview.userGrowth)),children:["+",e.overview.userGrowth,"%"]})]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(ng,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Caregivers"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.overview.activeCaregivers}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[(0,Xf.jsx)(Star,{className:"h-4 w-4 text-yellow-400"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-600 ml-1",children:[e.overview.caregiverSatisfaction," avg rating"]})]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Medication Compliance"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.overview.medicationCompliance,"%"]}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[(0,Xf.jsx)(G_,{className:"h-4 w-4 text-green-500"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600 ml-1",children:"Above target"})]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(W_,{className:"h-6 w-6 text-orange-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.monthlyRevenue)}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[m(e.financialMetrics.revenueGrowth),(0,Xf.jsxs)("span",{className:"text-sm ".concat(f(e.financialMetrics.revenueGrowth)),children:["+",e.financialMetrics.revenueGrowth,"%"]})]})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("users"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"User Analytics"}),l.users?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.users&&(0,Xf.jsx)("div",{className:"mt-6 space-y-6",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"User Distribution"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Active Users"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.userMetrics.activeUsers})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"New This Month"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.userMetrics.newUsersThisMonth})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Retention Rate"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.userRetention,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Average Age"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.averageAge," years"]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Gender Distribution"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Male"})]}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.genderDistribution.male,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 bg-pink-500 rounded-full mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Female"})]}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.genderDistribution.female,"%"]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Top Locations"}),(0,Xf.jsx)("div",{className:"space-y-2",children:Object.entries(e.userMetrics.locationDistribution).slice(0,5).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[n,"%"]})]},t)})})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("caregivers"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Caregiver Analytics"}),l.caregivers?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.caregivers&&(0,Xf.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Performance Distribution"}),(0,Xf.jsx)("div",{className:"space-y-3",children:Object.entries(e.caregiverMetrics.performanceDistribution).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[n," caregivers"]})]},t)})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Top Performers"}),(0,Xf.jsx)("div",{className:"space-y-3",children:e.caregiverMetrics.topPerformers.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:[e.patients," patients"]})]}),(0,Xf.jsxs)("div",{className:"text-right",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Star,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.rating})]}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:p(e.earnings)})]})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Specializations"}),(0,Xf.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries(e.caregiverMetrics.specializations).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("p",{className:"text-lg font-bold text-gray-900",children:n}),(0,Xf.jsx)("p",{className:"text-xs text-gray-600",children:t})]},t)})})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("emergencies"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Emergency Analytics"}),l.emergencies?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.emergencies&&(0,Xf.jsx)("div",{className:"mt-6 space-y-6",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Emergency Summary"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Total Emergencies"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.emergencyMetrics.totalEmergencies})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Resolved"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-green-600",children:e.emergencyMetrics.resolvedEmergencies})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Active"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-red-600",children:e.emergencyMetrics.activeEmergencies})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Avg Response Time"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.emergencyMetrics.averageResponseTime," min"]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Emergency Types"}),(0,Xf.jsx)("div",{className:"space-y-2",children:Object.entries(e.emergencyMetrics.emergencyTypes).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:n})]},t)})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Severity Distribution"}),(0,Xf.jsx)("div",{className:"space-y-2",children:Object.entries(e.emergencyMetrics.severityDistribution).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:n})]},t)})})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("financial"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Financial Analytics"}),l.financial?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.financial&&(0,Xf.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Revenue by Service"}),(0,Xf.jsx)("div",{className:"space-y-3",children:Object.entries(e.financialMetrics.revenueByService).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:p(n)})]},t)})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Payment Methods"}),(0,Xf.jsx)("div",{className:"space-y-3",children:Object.entries(e.financialMetrics.paymentMethods).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[n,"%"]})]},t)})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Key Financial Metrics"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.totalRevenue)}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Total Revenue"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.averageTransactionValue)}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Avg Transaction"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["+",e.financialMetrics.revenueGrowth,"%"]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Growth Rate"})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("geographic"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Geographic Analytics"}),l.geographic?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.geographic&&(0,Xf.jsx)("div",{className:"mt-6 space-y-6",children:(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Service Coverage"}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"City"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Coverage"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Users"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Caregivers"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.geographicData.serviceAreas.map((e,t)=>(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.city}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.coverage,"%"]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.users}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.caregivers})]},t))})]})})]})})]})]});var g},z_=Mf("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),q_=Mf("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Y_=Mf("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),X_=()=>{const[e,n]=(0,t.useState)("messages"),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)([]),[u,h]=(0,t.useState)(!0),[p,m]=(0,t.useState)(null),[f,g]=(0,t.useState)(!1),[_,y]=(0,t.useState)(!1),[v,E]=(0,t.useState)(""),[b,S]=(0,t.useState)("all"),[x,T]=(0,t.useState)({inbox:!0,sent:!1,drafts:!1,archived:!1});(0,t.useEffect)(()=>{w()},[]);const w=async()=>{try{h(!0),setTimeout(()=>{s([{id:1,type:"inbox",from:"Adunni Okafor",fromEmail:"adunni@example.com",to:"Admin",subject:"Medication Reminder Issue",content:"Hello, I'm having trouble receiving my medication reminders. Can you please check my settings?",timestamp:"2024-01-20T14:30:00Z",status:"unread",priority:"medium",category:"support",attachments:[],tags:["medication","reminder","technical"],replyCount:0,isStarred:!1,isArchived:!1},{id:2,type:"sent",from:"Admin",fromEmail:"admin@elderx.com",to:"Tunde Adebayo",toEmail:"tunde@example.com",subject:"Caregiver Performance Review",content:"Hi Tunde, your performance this month has been excellent. Keep up the great work!",timestamp:"2024-01-20T10:15:00Z",status:"sent",priority:"low",category:"feedback",attachments:[],tags:["performance","caregiver","review"],replyCount:0,isStarred:!0,isArchived:!1},{id:3,type:"inbox",from:"Grace Johnson",fromEmail:"grace@example.com",to:"Admin",subject:"Emergency Contact Update",content:"I need to update my emergency contact information. My daughter's phone number has changed.",timestamp:"2024-01-19T16:45:00Z",status:"read",priority:"high",category:"emergency",attachments:[],tags:["emergency","contact","update"],replyCount:1,isStarred:!1,isArchived:!1},{id:4,type:"draft",from:"Admin",fromEmail:"admin@elderx.com",to:"All Caregivers",toEmail:"caregivers@elderx.com",subject:"Monthly Training Session",content:"We will be conducting a monthly training session on...",timestamp:"2024-01-19T09:00:00Z",status:"draft",priority:"medium",category:"announcement",attachments:[],tags:["training","caregivers","announcement"],replyCount:0,isStarred:!1,isArchived:!1}]),a([{id:1,type:"system",title:"System Maintenance Scheduled",message:"Scheduled maintenance will occur on January 25th from 2:00 AM to 4:00 AM",timestamp:"2024-01-20T12:00:00Z",status:"unread",priority:"medium",category:"system",actionRequired:!1,isRead:!1},{id:2,type:"emergency",title:"Emergency Alert - Adunni Okafor",message:"Emergency alert triggered by Adunni Okafor. Response time: 3 minutes",timestamp:"2024-01-20T11:30:00Z",status:"active",priority:"high",category:"emergency",actionRequired:!0,isRead:!1},{id:3,type:"medication",title:"Medication Compliance Alert",message:"12 patients have missed their medication doses today",timestamp:"2024-01-20T10:00:00Z",status:"read",priority:"medium",category:"medication",actionRequired:!0,isRead:!0},{id:4,type:"caregiver",title:"New Caregiver Registration",message:"Sarah Williams has completed her registration and is ready for approval",timestamp:"2024-01-19T15:20:00Z",status:"read",priority:"low",category:"caregiver",actionRequired:!0,isRead:!0}]),c([{id:1,name:"Welcome Message",subject:"Welcome to ElderX - Your Health Companion",content:"Dear {{name}}, welcome to ElderX! We're excited to be part of your health journey...",category:"welcome",variables:["name","email"],usageCount:45,lastUsed:"2024-01-15T10:00:00Z",isActive:!0},{id:2,name:"Medication Reminder",subject:"Medication Reminder - {{medicationName}}",content:"Hello {{name}}, this is a reminder to take your {{medicationName}} at {{time}}...",category:"medication",variables:["name","medicationName","time"],usageCount:234,lastUsed:"2024-01-20T08:00:00Z",isActive:!0},{id:3,name:"Emergency Contact",subject:"Emergency Alert - {{patientName}}",content:"EMERGENCY ALERT: {{patientName}} has triggered an emergency alert at {{time}}...",category:"emergency",variables:["patientName","time","location"],usageCount:12,lastUsed:"2024-01-20T11:30:00Z",isActive:!0},{id:4,name:"Caregiver Feedback",subject:"Monthly Performance Review - {{caregiverName}}",content:"Hi {{caregiverName}}, here is your monthly performance review...",category:"caregiver",variables:["caregiverName","rating","feedback"],usageCount:67,lastUsed:"2024-01-18T14:00:00Z",isActive:!0}]),d([{id:1,name:"Monthly Health Check Reminder",subject:"Monthly Health Check Reminder",content:"Dear {{name}}, it's time for your monthly health check...",status:"scheduled",scheduledDate:"2024-01-25T09:00:00Z",recipientCount:1247,sentCount:0,openedCount:0,clickedCount:0,category:"health",targetAudience:"all_users",createdAt:"2024-01-20T10:00:00Z"},{id:2,name:"Caregiver Training Announcement",subject:"Upcoming Caregiver Training Session",content:"Dear caregivers, we have an upcoming training session...",status:"sent",scheduledDate:"2024-01-18T14:00:00Z",recipientCount:89,sentCount:89,openedCount:67,clickedCount:23,category:"training",targetAudience:"caregivers",createdAt:"2024-01-17T16:00:00Z"},{id:3,name:"System Update Notification",subject:"ElderX Platform Update",content:"We've released new features to improve your experience...",status:"draft",scheduledDate:null,recipientCount:0,sentCount:0,openedCount:0,clickedCount:0,category:"announcement",targetAudience:"all_users",createdAt:"2024-01-19T11:00:00Z"}]),h(!1)},1e3)}catch(e){console.error("Error loading communication data:",e),h(!1)}},N=e=>{T(t=>je(je({},t),{},{[e]:!t[e]}))},C=e=>{switch(e){case"unread":return"bg-blue-100 text-blue-800";case"read":default:return"bg-gray-100 text-gray-800";case"sent":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"archived":return"bg-purple-100 text-purple-800";case"active":return"bg-red-100 text-red-800"}},R=e=>{switch(e){case"high":return"text-red-600";case"medium":return"text-yellow-600";case"low":return"text-green-600";default:return"text-gray-600"}},I=e=>{switch(e){case"support":default:return(0,Xf.jsx)(sg,{className:"h-4 w-4"});case"emergency":return(0,Xf.jsx)(eg,{className:"h-4 w-4"});case"medication":return(0,Xf.jsx)(Ff,{className:"h-4 w-4"});case"caregiver":return(0,Xf.jsx)(ng,{className:"h-4 w-4"});case"system":return(0,Xf.jsx)(cg,{className:"h-4 w-4"});case"announcement":return(0,Xf.jsx)(qf,{className:"h-4 w-4"})}},A=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},O=(e,t)=>{if(m(t),"view"===e)g(!0)},D=i.filter(e=>{const t=e.subject.toLowerCase().includes(v.toLowerCase())||e.from.toLowerCase().includes(v.toLowerCase())||e.content.toLowerCase().includes(v.toLowerCase()),n="all"===b||e.status===b;return t&&n});return u?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Communication Center"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage messages, notifications, and communication campaigns"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{onClick:()=>y(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Compose"]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(og,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(sg,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Messages"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(qf,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Unread Notifications"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.filter(e=>!e.isRead).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(__,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Campaigns"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:l.filter(e=>"sent"===e.status||"scheduled"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(ag,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Templates"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:o.length})]})]})})]}),(0,Xf.jsx)("div",{className:"border-b border-gray-200",children:(0,Xf.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{id:"messages",name:"Messages",icon:sg},{id:"notifications",name:"Notifications",icon:qf},{id:"templates",name:"Templates",icon:ag},{id:"campaigns",name:"Campaigns",icon:__}].map(t=>{const i=t.icon;return(0,Xf.jsxs)("button",{onClick:()=>n(t.id),className:"flex items-center py-2 px-1 border-b-2 font-medium text-sm ".concat(e===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(i,{className:"h-4 w-4 mr-2"}),t.name]},t.id)})})}),"messages"===e&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search messages...",className:"form-input pl-10",value:v,onChange:e=>E(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:b,onChange:e=>S(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"unread",children:"Unread"}),(0,Xf.jsx)("option",{value:"read",children:"Read"}),(0,Xf.jsx)("option",{value:"sent",children:"Sent"}),(0,Xf.jsx)("option",{value:"draft",children:"Draft"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>N("inbox"),children:[(0,Xf.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Inbox (",i.filter(e=>"inbox"===e.type).length,")"]}),x.inbox?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),x.inbox&&(0,Xf.jsx)("div",{className:"mt-4 space-y-3",children:D.filter(e=>"inbox"===e.type).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[I(e.category),(0,Xf.jsx)("span",{className:"font-medium text-gray-900",children:e.from}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:e.fromEmail})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status}),(0,Xf.jsxs)("span",{className:"text-xs ".concat(R(e.priority)),children:[e.priority," priority"]})]}),(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.tags.map((e,t)=>(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},t))]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[e.isStarred&&(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400"}),(0,Xf.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"View Message",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("reply",e),className:"text-green-600 hover:text-green-800",title:"Reply",children:(0,Xf.jsx)(z_,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("archive",e),className:"text-purple-600 hover:text-purple-800",title:"Archive",children:(0,Xf.jsx)(q_,{className:"h-4 w-4"})})]})]})},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>N("sent"),children:[(0,Xf.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Sent (",i.filter(e=>"sent"===e.type).length,")"]}),x.sent?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),x.sent&&(0,Xf.jsx)("div",{className:"mt-4 space-y-3",children:D.filter(e=>"sent"===e.type).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(__,{className:"h-4 w-4"}),(0,Xf.jsxs)("span",{className:"font-medium text-gray-900",children:["To: ",e.to]}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:e.toEmail})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})]}),(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.tags.map((e,t)=>(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},t))]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[e.isStarred&&(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400"}),(0,Xf.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"View Message",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("forward",e),className:"text-blue-600 hover:text-blue-800",title:"Forward",children:(0,Xf.jsx)(Y_,{className:"h-4 w-4"})})]})]})},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>N("drafts"),children:[(0,Xf.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Drafts (",i.filter(e=>"draft"===e.type).length,")"]}),x.drafts?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),x.drafts&&(0,Xf.jsx)("div",{className:"mt-4 space-y-3",children:D.filter(e=>"draft"===e.type).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4"}),(0,Xf.jsx)("span",{className:"font-medium text-gray-900",children:"Draft"})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})]}),(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:(0,Xf.jsxs)("span",{children:["Last saved: ",A(e.timestamp).date," at ",A(e.timestamp).time]})})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,Xf.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"Edit Draft",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("delete",e),className:"text-red-600 hover:text-red-800",title:"Delete Draft",children:(0,Xf.jsx)(Rg,{className:"h-4 w-4"})})]})]})},e.id))})]})]})]}),"notifications"===e&&(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Notifications"}),(0,Xf.jsx)("div",{className:"space-y-3",children:r.map(e=>(0,Xf.jsx)("div",{className:"border rounded-lg p-4 ".concat(e.isRead?"bg-gray-50":"bg-white border-blue-200"),children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsx)("div",{className:"p-2 rounded-full ".concat("emergency"===e.category?"bg-red-100":"system"===e.category?"bg-blue-100":"bg-gray-100"),children:I(e.category)}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900",children:e.title}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status}),(0,Xf.jsxs)("span",{className:"text-xs ".concat(R(e.priority)),children:[e.priority," priority"]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.actionRequired&&(0,Xf.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Action Required"})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),e.actionRequired&&(0,Xf.jsx)("button",{className:"btn btn-primary text-sm",children:"Take Action"})]})]})},e.id))})]})}),"templates"===e&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Message Templates"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Create Template"]})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(e=>(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500 mb-3 line-clamp-3",children:e.content}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[(0,Xf.jsxs)("span",{children:["Used ",e.usageCount," times"]}),(0,Xf.jsxs)("span",{children:["Last used: ",A(e.lastUsed).date]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsxs)("button",{className:"btn btn-primary text-sm flex-1",children:[(0,Xf.jsx)(Cg,{className:"h-3 w-3 mr-1"}),"Edit"]}),(0,Xf.jsx)("button",{className:"btn btn-secondary text-sm",children:(0,Xf.jsx)(jg,{className:"h-3 w-3"})})]})]},e.id))})]}),"campaigns"===e&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Communication Campaigns"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(wg,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campaign"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recipients"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Engagement"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Scheduled"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.subject})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.recipientCount}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,Xf.jsxs)("div",{className:"text-xs",children:[(0,Xf.jsxs)("div",{children:["Opened: ",e.openedCount]}),(0,Xf.jsxs)("div",{children:["Clicked: ",e.clickedCount]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.scheduledDate?A(e.scheduledDate).date:"Not scheduled"}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{className:"text-green-600 hover:text-green-900",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{className:"text-red-600 hover:text-red-900",children:(0,Xf.jsx)(Rg,{className:"h-4 w-4"})})]})})]},e.id))})]})})})]}),f&&p&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:p.subject}),(0,Xf.jsxs)("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Xf.jsxs)("span",{children:[(0,Xf.jsx)("strong",{children:"From:"})," ",p.from," (",p.fromEmail,")"]}),(0,Xf.jsxs)("span",{children:[(0,Xf.jsx)("strong",{children:"To:"})," ",p.to]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Xf.jsxs)("span",{children:[(0,Xf.jsx)("strong",{children:"Date:"})," ",A(p.timestamp).date," at ",A(p.timestamp).time]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(p.status)),children:p.status})]}),(0,Xf.jsx)("div",{className:"border-t pt-4",children:(0,Xf.jsx)("p",{className:"text-gray-900 whitespace-pre-wrap",children:p.content})}),p.tags.length>0&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Tags:"}),p.tags.map((e,t)=>(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs",children:e},t))]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>g(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(z_,{className:"h-4 w-4 mr-2"}),"Reply"]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Y_,{className:"h-4 w-4 mr-2"}),"Forward"]})]})]})})})]})},J_=Mf("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Q_=()=>{const[e,n]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(null),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)({action:"all",user:"all",resource:"all",status:"all",dateRange:"all",severity:"all"}),[f,g]=(0,t.useState)({overview:!0,recent:!0,security:!1,system:!1,user:!1,data:!1}),[_,y]=(0,t.useState)({totalLogs:0,todayLogs:0,securityEvents:0,systemEvents:0,userEvents:0,dataEvents:0,criticalEvents:0,warningEvents:0});(0,t.useEffect)(()=>{v()},[]),(0,t.useEffect)(()=>{E()},[e,o,p]);const v=async()=>{try{a(!0),setTimeout(()=>{const e=[{id:1,timestamp:"2024-01-20T14:30:00Z",action:"LOGIN",user:"admin@elderx.com",userId:"admin_001",resource:"Authentication",resourceId:"auth_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{loginMethod:"email_password",sessionId:"sess_abc123",location:"Lagos, Nigeria"},changes:null,category:"security"},{id:2,timestamp:"2024-01-20T14:25:00Z",action:"CREATE",user:"admin@elderx.com",userId:"admin_001",resource:"Caregiver",resourceId:"caregiver_002",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{caregiverName:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890"},changes:{before:null,after:{name:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890",status:"pending"}},category:"user"},{id:3,timestamp:"2024-01-20T14:20:00Z",action:"UPDATE",user:"admin@elderx.com",userId:"admin_001",resource:"Medication",resourceId:"med_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{medicationName:"Metformin",patientId:"patient_001",dosage:"500mg"},changes:{before:{dosage:"250mg",frequency:"twice daily"},after:{dosage:"500mg",frequency:"once daily"}},category:"data"},{id:4,timestamp:"2024-01-20T14:15:00Z",action:"DELETE",user:"admin@elderx.com",userId:"admin_001",resource:"Appointment",resourceId:"appt_003",status:"SUCCESS",severity:"WARNING",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{appointmentDate:"2024-01-25",patientName:"Adunni Okafor",doctorName:"Dr. Kemi Adebayo",reason:"Patient requested cancellation"},changes:{before:{status:"scheduled",date:"2024-01-25T10:00:00Z"},after:null},category:"system"},{id:5,timestamp:"2024-01-20T14:10:00Z",action:"LOGIN_FAILED",user:"unknown@example.com",userId:null,resource:"Authentication",resourceId:"auth_002",status:"FAILED",severity:"WARNING",ipAddress:"192.168.1.200",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{loginMethod:"email_password",failureReason:"Invalid password",attemptCount:3},changes:null,category:"security"},{id:6,timestamp:"2024-01-20T14:05:00Z",action:"PERMISSION_CHANGE",user:"admin@elderx.com",userId:"admin_001",resource:"User",resourceId:"user_005",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{targetUser:"caregiver@example.com",permissionType:"admin_access"},changes:{before:{role:"caregiver",permissions:["read_patients","update_medications"]},after:{role:"admin",permissions:["read_patients","update_medications","manage_users","view_analytics"]}},category:"security"},{id:7,timestamp:"2024-01-20T14:00:00Z",action:"DATA_EXPORT",user:"admin@elderx.com",userId:"admin_001",resource:"Patient Data",resourceId:"export_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{exportType:"patient_medications",recordCount:1247,format:"CSV",purpose:"Monthly report"},changes:null,category:"data"},{id:8,timestamp:"2024-01-20T13:55:00Z",action:"SYSTEM_CONFIG",user:"admin@elderx.com",userId:"admin_001",resource:"System Settings",resourceId:"config_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{settingName:"notification_frequency",settingValue:"immediate"},changes:{before:{notification_frequency:"hourly"},after:{notification_frequency:"immediate"}},category:"system"},{id:9,timestamp:"2024-01-20T13:50:00Z",action:"EMERGENCY_ALERT",user:"system",userId:"system",resource:"Emergency System",resourceId:"emergency_001",status:"SUCCESS",severity:"CRITICAL",ipAddress:"system",userAgent:"ElderX Emergency System",details:{patientId:"patient_003",patientName:"Grace Johnson",alertType:"fall_detected",location:"Lagos, Nigeria",responseTime:"2 minutes"},changes:null,category:"system"},{id:10,timestamp:"2024-01-20T13:45:00Z",action:"BACKUP",user:"system",userId:"system",resource:"Database",resourceId:"backup_001",status:"SUCCESS",severity:"INFO",ipAddress:"system",userAgent:"ElderX Backup System",details:{backupType:"full_database",size:"2.5GB",duration:"15 minutes",location:"cloud_storage"},changes:null,category:"system"}],t=e.length,i=e.filter(e=>{const t=new Date(e.timestamp),n=new Date;return t.toDateString()===n.toDateString()}).length,s=e.filter(e=>"security"===e.category).length,r=e.filter(e=>"system"===e.category).length,o=e.filter(e=>"user"===e.category).length,c=e.filter(e=>"data"===e.category).length,l=e.filter(e=>"CRITICAL"===e.severity).length,d=e.filter(e=>"WARNING"===e.severity).length;y({totalLogs:t,todayLogs:i,securityEvents:s,systemEvents:r,userEvents:o,dataEvents:c,criticalEvents:l,warningEvents:d}),n(e),a(!1)},1e3)}catch(e){console.error("Error loading audit logs:",e),a(!1)}},E=()=>{let t=e;o&&(t=t.filter(e=>e.action.toLowerCase().includes(o.toLowerCase())||e.user.toLowerCase().includes(o.toLowerCase())||e.resource.toLowerCase().includes(o.toLowerCase())||e.details&&JSON.stringify(e.details).toLowerCase().includes(o.toLowerCase()))),"all"!==p.action&&(t=t.filter(e=>e.action===p.action)),"all"!==p.user&&(t=t.filter(e=>e.user===p.user)),"all"!==p.resource&&(t=t.filter(e=>e.resource===p.resource)),"all"!==p.status&&(t=t.filter(e=>e.status===p.status)),"all"!==p.severity&&(t=t.filter(e=>e.severity===p.severity)),s(t)},b=e=>{switch(e){case"CRITICAL":return"bg-red-100 text-red-800 border-red-200";case"WARNING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"INFO":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},S=e=>{switch(e){case"SUCCESS":return"bg-green-100 text-green-800";case"FAILED":return"bg-red-100 text-red-800";case"PENDING":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},x=e=>{switch(e){case"security":return(0,Xf.jsx)(cg,{className:"h-4 w-4"});case"system":return(0,Xf.jsx)(og,{className:"h-4 w-4"});case"user":return(0,Xf.jsx)(Yf,{className:"h-4 w-4"});case"data":return(0,Xf.jsx)(O_,{className:"h-4 w-4"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4"})}},T=e=>{switch(e){case"LOGIN":return(0,Xf.jsx)(J_,{className:"h-4 w-4"});case"LOGOUT":return(0,Xf.jsx)(bg,{className:"h-4 w-4"});case"CREATE":return(0,Xf.jsx)(wg,{className:"h-4 w-4"});case"UPDATE":return(0,Xf.jsx)(Cg,{className:"h-4 w-4"});case"DELETE":return(0,Xf.jsx)(Rg,{className:"h-4 w-4"});case"LOGIN_FAILED":return(0,Xf.jsx)(Ng,{className:"h-4 w-4"});case"PERMISSION_CHANGE":return(0,Xf.jsx)(cg,{className:"h-4 w-4"});case"DATA_EXPORT":return(0,Xf.jsx)($g,{className:"h-4 w-4"});case"SYSTEM_CONFIG":return(0,Xf.jsx)(og,{className:"h-4 w-4"});case"EMERGENCY_ALERT":return(0,Xf.jsx)(eg,{className:"h-4 w-4"});case"BACKUP":return(0,Xf.jsx)(O_,{className:"h-4 w-4"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4"})}},w=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),full:t.toLocaleString()}};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Audit Logs"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Comprehensive system activity and security monitoring"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{onClick:v,className:"btn btn-secondary",children:[(0,Xf.jsx)(P_,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,Xf.jsxs)("button",{onClick:()=>{console.log("Exporting logs...")},className:"btn btn-primary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(ag,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Logs"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:_.totalLogs})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Today's Events"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:_.todayLogs})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Critical Events"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:_.criticalEvents})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(cg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Security Events"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:_.securityEvents})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>{return e="overview",void g(t=>je(je({},t),{},{[e]:!t[e]}));var e},children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Activity Overview"}),f.overview?(0,Xf.jsx)(H_,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),f.overview&&(0,Xf.jsx)("div",{className:"mt-6",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(cg,{className:"h-6 w-6 text-blue-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:_.securityEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Security Events"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(og,{className:"h-6 w-6 text-green-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:_.systemEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"System Events"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-purple-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:_.userEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"User Events"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(O_,{className:"h-6 w-6 text-orange-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:_.dataEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Data Events"})]})]})})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Zg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search audit logs...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:p.action,onChange:e=>m(je(je({},p),{},{action:e.target.value})),children:[(0,Xf.jsx)("option",{value:"all",children:"All Actions"}),(0,Xf.jsx)("option",{value:"LOGIN",children:"Login"}),(0,Xf.jsx)("option",{value:"LOGOUT",children:"Logout"}),(0,Xf.jsx)("option",{value:"CREATE",children:"Create"}),(0,Xf.jsx)("option",{value:"UPDATE",children:"Update"}),(0,Xf.jsx)("option",{value:"DELETE",children:"Delete"}),(0,Xf.jsx)("option",{value:"LOGIN_FAILED",children:"Login Failed"}),(0,Xf.jsx)("option",{value:"PERMISSION_CHANGE",children:"Permission Change"}),(0,Xf.jsx)("option",{value:"DATA_EXPORT",children:"Data Export"}),(0,Xf.jsx)("option",{value:"SYSTEM_CONFIG",children:"System Config"}),(0,Xf.jsx)("option",{value:"EMERGENCY_ALERT",children:"Emergency Alert"}),(0,Xf.jsx)("option",{value:"BACKUP",children:"Backup"})]}),(0,Xf.jsxs)("select",{className:"form-input",value:p.status,onChange:e=>m(je(je({},p),{},{status:e.target.value})),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"SUCCESS",children:"Success"}),(0,Xf.jsx)("option",{value:"FAILED",children:"Failed"}),(0,Xf.jsx)("option",{value:"PENDING",children:"Pending"})]}),(0,Xf.jsxs)("select",{className:"form-input",value:p.severity,onChange:e=>m(je(je({},p),{},{severity:e.target.value})),children:[(0,Xf.jsx)("option",{value:"all",children:"All Severity"}),(0,Xf.jsx)("option",{value:"CRITICAL",children:"Critical"}),(0,Xf.jsx)("option",{value:"WARNING",children:"Warning"}),(0,Xf.jsx)("option",{value:"INFO",children:"Info"}),(0,Xf.jsx)("option",{value:"DEBUG",children:"Debug"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Resource"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:w(e.timestamp).date}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:w(e.timestamp).time})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[T(e.action),(0,Xf.jsx)("span",{className:"ml-2 text-sm font-medium text-gray-900",children:e.action})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.user}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.ipAddress})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[x(e.category),(0,Xf.jsx)("span",{className:"ml-2 text-sm text-gray-900",children:e.resource})]}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.resourceId})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(S(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(b(e.severity)),children:e.severity})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsx)("button",{onClick:()=>((e,t)=>{d(t),"view"===e&&h(!0)})("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(jg,{className:"h-4 w-4"})})})]},e.id))})]})}),0===i.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(ag,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No audit logs found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||Object.values(p).some(e=>"all"!==e)?"Try adjusting your search or filter criteria.":"No audit logs have been recorded yet."})]})]}),u&&l&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[T(l.action),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:l.action}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(b(l.severity)),children:l.severity})]}),(0,Xf.jsxs)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Event Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Timestamp:"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:w(l.timestamp).full})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"User:"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:l.user})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"IP Address:"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:l.ipAddress})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Status:"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(S(l.status)),children:l.status})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Resource:"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[l.resource," (",l.resourceId,")"]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Technical Details"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"User Agent"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900 break-all",children:l.userAgent})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[x(l.category),(0,Xf.jsx)("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:l.category})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Event Details"}),(0,Xf.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,Xf.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.details,null,2)})})]}),l.changes&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Changes"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[l.changes.before&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Before:"}),(0,Xf.jsx)("div",{className:"bg-red-50 rounded-lg p-3",children:(0,Xf.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.changes.before,null,2)})})]}),l.changes.after&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"After:"}),(0,Xf.jsx)("div",{className:"bg-green-50 rounded-lg p-3",children:(0,Xf.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.changes.after,null,2)})})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>h(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)($g,{className:"h-4 w-4 mr-2"}),"Export Log"]})]})]})})})]})},Z_=()=>(0,Xf.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Loading ElderX..."})]})});const $_=function(){const[e,t]=Ma(kf);return t?(0,Xf.jsx)(Z_,{}):(0,Xf.jsxs)(ve,{children:[(0,Xf.jsx)(_e,{path:"/",element:(0,Xf.jsx)(vg,{})}),(0,Xf.jsx)(_e,{path:"/login",element:e?(0,Xf.jsx)(fe,{to:"/dashboard",replace:!0}):(0,Xf.jsx)(Sg,{})}),(0,Xf.jsx)(_e,{path:"/signup",element:e?(0,Xf.jsx)(fe,{to:"/dashboard",replace:!0}):(0,Xf.jsx)(xg,{})}),(0,Xf.jsx)(_e,{path:"/dashboard",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(Tg,{})})}),(0,Xf.jsx)(_e,{path:"/medications",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(Ig,{})})}),(0,Xf.jsx)(_e,{path:"/vital-signs",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(Dg,{})})}),(0,Xf.jsx)(_e,{path:"/appointments",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(Pg,{})})}),(0,Xf.jsx)(_e,{path:"/telemedicine",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(u_,{})})}),(0,Xf.jsx)(_e,{path:"/profile",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(Lg,{})})}),(0,Xf.jsx)(_e,{path:"/messages",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(y_,{})})}),(0,Xf.jsx)(_e,{path:"/subscription",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(E_,{})})}),(0,Xf.jsxs)(_e,{path:"/caregiver",element:e?(0,Xf.jsx)(h_,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(Vg,{})}),(0,Xf.jsx)(_e,{path:"schedule",element:(0,Xf.jsx)(Wg,{})})]}),(0,Xf.jsx)(_e,{path:"/services",element:(0,Xf.jsx)(b_,{})}),(0,Xf.jsx)(_e,{path:"/pricing",element:(0,Xf.jsx)(S_,{})}),(0,Xf.jsxs)(_e,{path:"/admin",element:e?(0,Xf.jsx)(lg,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Xf.jsx)(_e,{index:!0,element:(0,Xf.jsx)(x_,{})}),(0,Xf.jsx)(_e,{path:"users",element:(0,Xf.jsx)(C_,{})}),(0,Xf.jsx)(_e,{path:"appointments",element:(0,Xf.jsx)(A_,{})}),(0,Xf.jsx)(_e,{path:"emergency",element:(0,Xf.jsx)(L_,{})}),(0,Xf.jsx)(_e,{path:"emergency/protocols",element:(0,Xf.jsx)(M_,{})}),(0,Xf.jsx)(_e,{path:"medications",element:(0,Xf.jsx)(V_,{})}),(0,Xf.jsx)(_e,{path:"medications/analytics",element:(0,Xf.jsx)(F_,{})}),(0,Xf.jsx)(_e,{path:"caregivers",element:(0,Xf.jsx)(B_,{})}),(0,Xf.jsx)(_e,{path:"analytics",element:(0,Xf.jsx)(K_,{})}),(0,Xf.jsx)(_e,{path:"communication",element:(0,Xf.jsx)(X_,{})}),(0,Xf.jsx)(_e,{path:"audit-logs",element:(0,Xf.jsx)(Q_,{})}),(0,Xf.jsx)(_e,{path:"reports",element:(0,Xf.jsx)(R_,{})}),(0,Xf.jsx)(_e,{path:"settings",element:(0,Xf.jsx)(k_,{})})]}),(0,Xf.jsx)(_e,{path:"*",element:(0,Xf.jsx)(fe,{to:"/",replace:!0})})]})},ey=new Oe.QueryClient;(0,s.H)(document.getElementById("root")).render((0,Xf.jsx)(t.StrictMode,{children:(0,Xf.jsx)(Oe.QueryClientProvider,{client:ey,children:(0,Xf.jsxs)(we,{children:[(0,Xf.jsx)($_,{}),(0,Xf.jsx)(ot,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})})}))})()})();
//# sourceMappingURL=main.447d557d.js.map