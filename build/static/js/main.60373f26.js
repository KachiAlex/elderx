/*! For license information please see main.60373f26.js.LICENSE.txt */
(()=>{var e={43:(e,t,n)=>{"use strict";e.exports=n(202)},75:(e,t,n)=>{"use strict";n.d(t,{B:()=>r,t:()=>i});var s=console;function i(){return s}function r(e){s=e}},153:(e,t,n)=>{"use strict";var s=n(43),i=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var s,r={},l=null,d=null;for(s in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,s)&&!c.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===r[s]&&(r[s]=t[s]);return{$$typeof:i,type:e,key:l,ref:d,props:r,_owner:o.current}}t.Fragment=r,t.jsx=l,t.jsxs=l},168:(e,t,n)=>{"use strict";function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},s.apply(null,arguments)}n.d(t,{A:()=>s})},198:(e,t,n)=>{"use strict";n.d(t,{E:()=>w});var s=n(168),i=n(870);function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}var o=n(991),c=n(75),l=function(){function e(){this.listeners=[]}var t=e.prototype;return t.subscribe=function(e){var t=this,n=e||function(){};return this.listeners.push(n),this.onSubscribe(),function(){t.listeners=t.listeners.filter(function(e){return e!==n}),t.onUnsubscribe()}},t.hasListeners=function(){return this.listeners.length>0},t.onSubscribe=function(){},t.onUnsubscribe=function(){},e}(),d=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!i.S$&&(null==(t=window)?void 0:t.addEventListener)){var n=function(){return e()};return window.addEventListener("visibilitychange",n,!1),window.addEventListener("focus",n,!1),function(){window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}}},t}a(t,e);var n=t.prototype;return n.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},n.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},n.setEventListener=function(e){var t,n=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?n.setFocused(e):n.onFocus()})},n.setFocused=function(e){this.focused=e,e&&this.onFocus()},n.onFocus=function(){this.listeners.forEach(function(e){e()})},n.isFocused=function(){return"boolean"===typeof this.focused?this.focused:"undefined"===typeof document||[void 0,"visible","prerender"].includes(document.visibilityState)},t}(l)),u=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!i.S$&&(null==(t=window)?void 0:t.addEventListener)){var n=function(){return e()};return window.addEventListener("online",n,!1),window.addEventListener("offline",n,!1),function(){window.removeEventListener("online",n),window.removeEventListener("offline",n)}}},t}a(t,e);var n=t.prototype;return n.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},n.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},n.setEventListener=function(e){var t,n=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?n.setOnline(e):n.onOnline()})},n.setOnline=function(e){this.online=e,e&&this.onOnline()},n.onOnline=function(){this.listeners.forEach(function(e){e()})},n.isOnline=function(){return"boolean"===typeof this.online?this.online:"undefined"===typeof navigator||"undefined"===typeof navigator.onLine||navigator.onLine},t}(l));function h(e){return Math.min(1e3*Math.pow(2,e),3e4)}function p(e){return"function"===typeof(null==e?void 0:e.cancel)}var m=function(e){this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent};function f(e){return e instanceof m}var g=function(e){var t,n,s,r,a=this,o=!1;this.abort=e.abort,this.cancel=function(e){return null==t?void 0:t(e)},this.cancelRetry=function(){o=!0},this.continueRetry=function(){o=!1},this.continue=function(){return null==n?void 0:n()},this.failureCount=0,this.isPaused=!1,this.isResolved=!1,this.isTransportCancelable=!1,this.promise=new Promise(function(e,t){s=e,r=t});var c=function(t){a.isResolved||(a.isResolved=!0,null==e.onSuccess||e.onSuccess(t),null==n||n(),s(t))},l=function(t){a.isResolved||(a.isResolved=!0,null==e.onError||e.onError(t),null==n||n(),r(t))};!function s(){if(!a.isResolved){var r;try{r=e.fn()}catch(f){r=Promise.reject(f)}t=function(e){if(!a.isResolved&&(l(new m(e)),null==a.abort||a.abort(),p(r)))try{r.cancel()}catch(t){}},a.isTransportCancelable=p(r),Promise.resolve(r).then(c).catch(function(t){var r,c;if(!a.isResolved){var p=null!=(r=e.retry)?r:3,m=null!=(c=e.retryDelay)?c:h,f="function"===typeof m?m(a.failureCount,t):m,g=!0===p||"number"===typeof p&&a.failureCount<p||"function"===typeof p&&p(a.failureCount,t);!o&&g?(a.failureCount++,null==e.onFail||e.onFail(a.failureCount,t),(0,i.yy)(f).then(function(){if(!d.isFocused()||!u.isOnline())return new Promise(function(t){n=t,a.isPaused=!0,null==e.onPause||e.onPause()}).then(function(){n=void 0,a.isPaused=!1,null==e.onContinue||e.onContinue()})}).then(function(){o?l(t):s()})):l(t)}})}}()},y=function(){function e(e){this.abortSignalConsumed=!1,this.hadObservers=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||this.getDefaultState(this.options),this.state=this.initialState,this.meta=e.meta,this.scheduleGc()}var t=e.prototype;return t.setOptions=function(e){var t;this.options=(0,s.A)({},this.defaultOptions,e),this.meta=null==e?void 0:e.meta,this.cacheTime=Math.max(this.cacheTime||0,null!=(t=this.options.cacheTime)?t:3e5)},t.setDefaultOptions=function(e){this.defaultOptions=e},t.scheduleGc=function(){var e=this;this.clearGcTimeout(),(0,i.gn)(this.cacheTime)&&(this.gcTimeout=setTimeout(function(){e.optionalRemove()},this.cacheTime))},t.clearGcTimeout=function(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)},t.optionalRemove=function(){this.observers.length||(this.state.isFetching?this.hadObservers&&this.scheduleGc():this.cache.remove(this))},t.setData=function(e,t){var n,s,r=this.state.data,a=(0,i.Zw)(e,r);return(null==(n=(s=this.options).isDataEqual)?void 0:n.call(s,r,a))?a=r:!1!==this.options.structuralSharing&&(a=(0,i.BH)(r,a)),this.dispatch({data:a,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt}),a},t.setState=function(e,t){this.dispatch({type:"setState",state:e,setStateOptions:t})},t.cancel=function(e){var t,n=this.promise;return null==(t=this.retryer)||t.cancel(e),n?n.then(i.lQ).catch(i.lQ):Promise.resolve()},t.destroy=function(){this.clearGcTimeout(),this.cancel({silent:!0})},t.reset=function(){this.destroy(),this.setState(this.initialState)},t.isActive=function(){return this.observers.some(function(e){return!1!==e.options.enabled})},t.isFetching=function(){return this.state.isFetching},t.isStale=function(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(function(e){return e.getCurrentResult().isStale})},t.isStaleByTime=function(e){return void 0===e&&(e=0),this.state.isInvalidated||!this.state.dataUpdatedAt||!(0,i.j3)(this.state.dataUpdatedAt,e)},t.onFocus=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnWindowFocus()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.onOnline=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnReconnect()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.addObserver=function(e){-1===this.observers.indexOf(e)&&(this.observers.push(e),this.hadObservers=!0,this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))},t.removeObserver=function(e){-1!==this.observers.indexOf(e)&&(this.observers=this.observers.filter(function(t){return t!==e}),this.observers.length||(this.retryer&&(this.retryer.isTransportCancelable||this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.cacheTime?this.scheduleGc():this.cache.remove(this)),this.cache.notify({type:"observerRemoved",query:this,observer:e}))},t.getObserversCount=function(){return this.observers.length},t.invalidate=function(){this.state.isInvalidated||this.dispatch({type:"invalidate"})},t.fetch=function(e,t){var n,s,r,a=this;if(this.state.isFetching)if(this.state.dataUpdatedAt&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(this.promise){var o;return null==(o=this.retryer)||o.continueRetry(),this.promise}if(e&&this.setOptions(e),!this.options.queryFn){var l=this.observers.find(function(e){return e.options.queryFn});l&&this.setOptions(l.options)}var d=(0,i.HN)(this.queryKey),u=(0,i.jY)(),h={queryKey:d,pageParam:void 0,meta:this.meta};Object.defineProperty(h,"signal",{enumerable:!0,get:function(){if(u)return a.abortSignalConsumed=!0,u.signal}});var p,m,y={fetchOptions:t,options:this.options,queryKey:d,state:this.state,fetchFn:function(){return a.options.queryFn?(a.abortSignalConsumed=!1,a.options.queryFn(h)):Promise.reject("Missing queryFn")},meta:this.meta};(null==(n=this.options.behavior)?void 0:n.onFetch)&&(null==(p=this.options.behavior)||p.onFetch(y));(this.revertState=this.state,this.state.isFetching&&this.state.fetchMeta===(null==(s=y.fetchOptions)?void 0:s.meta))||this.dispatch({type:"fetch",meta:null==(m=y.fetchOptions)?void 0:m.meta});return this.retryer=new g({fn:y.fetchFn,abort:null==u||null==(r=u.abort)?void 0:r.bind(u),onSuccess:function(e){a.setData(e),null==a.cache.config.onSuccess||a.cache.config.onSuccess(e,a),0===a.cacheTime&&a.optionalRemove()},onError:function(e){f(e)&&e.silent||a.dispatch({type:"error",error:e}),f(e)||(null==a.cache.config.onError||a.cache.config.onError(e,a),(0,c.t)().error(e)),0===a.cacheTime&&a.optionalRemove()},onFail:function(){a.dispatch({type:"failed"})},onPause:function(){a.dispatch({type:"pause"})},onContinue:function(){a.dispatch({type:"continue"})},retry:y.options.retry,retryDelay:y.options.retryDelay}),this.promise=this.retryer.promise,this.promise},t.dispatch=function(e){var t=this;this.state=this.reducer(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onQueryUpdate(e)}),t.cache.notify({query:t,type:"queryUpdated",action:e})})},t.getDefaultState=function(e){var t="function"===typeof e.initialData?e.initialData():e.initialData,n="undefined"!==typeof e.initialData?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0,s="undefined"!==typeof t;return{data:t,dataUpdateCount:0,dataUpdatedAt:s?null!=n?n:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchMeta:null,isFetching:!1,isInvalidated:!1,isPaused:!1,status:s?"success":"idle"}},t.reducer=function(e,t){var n,i;switch(t.type){case"failed":return(0,s.A)({},e,{fetchFailureCount:e.fetchFailureCount+1});case"pause":return(0,s.A)({},e,{isPaused:!0});case"continue":return(0,s.A)({},e,{isPaused:!1});case"fetch":return(0,s.A)({},e,{fetchFailureCount:0,fetchMeta:null!=(n=t.meta)?n:null,isFetching:!0,isPaused:!1},!e.dataUpdatedAt&&{error:null,status:"loading"});case"success":return(0,s.A)({},e,{data:t.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:null!=(i=t.dataUpdatedAt)?i:Date.now(),error:null,fetchFailureCount:0,isFetching:!1,isInvalidated:!1,isPaused:!1,status:"success"});case"error":var r=t.error;return f(r)&&r.revert&&this.revertState?(0,s.A)({},this.revertState):(0,s.A)({},e,{error:r,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,isFetching:!1,isPaused:!1,status:"error"});case"invalidate":return(0,s.A)({},e,{isInvalidated:!0});case"setState":return(0,s.A)({},e,t.state);default:return e}},e}(),v=function(e){function t(t){var n;return(n=e.call(this)||this).config=t||{},n.queries=[],n.queriesMap={},n}a(t,e);var n=t.prototype;return n.build=function(e,t,n){var s,r=t.queryKey,a=null!=(s=t.queryHash)?s:(0,i.F$)(r,t),o=this.get(a);return o||(o=new y({cache:this,queryKey:r,queryHash:a,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r),meta:t.meta}),this.add(o)),o},n.add=function(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"queryAdded",query:e}))},n.remove=function(e){var t=this.queriesMap[e.queryHash];t&&(e.destroy(),this.queries=this.queries.filter(function(t){return t!==e}),t===e&&delete this.queriesMap[e.queryHash],this.notify({type:"queryRemoved",query:e}))},n.clear=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(t){e.remove(t)})})},n.get=function(e){return this.queriesMap[e]},n.getAll=function(){return this.queries},n.find=function(e,t){var n=(0,i.b_)(e,t)[0];return"undefined"===typeof n.exact&&(n.exact=!0),this.queries.find(function(e){return(0,i.MK)(n,e)})},n.findAll=function(e,t){var n=(0,i.b_)(e,t)[0];return Object.keys(n).length>0?this.queries.filter(function(e){return(0,i.MK)(n,e)}):this.queries},n.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},n.onFocus=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onFocus()})})},n.onOnline=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onOnline()})})},t}(l),_=function(){function e(e){this.options=(0,s.A)({},e.defaultOptions,e.options),this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.observers=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,isPaused:!1,status:"idle",variables:void 0},this.meta=e.meta}var t=e.prototype;return t.setState=function(e){this.dispatch({type:"setState",state:e})},t.addObserver=function(e){-1===this.observers.indexOf(e)&&this.observers.push(e)},t.removeObserver=function(e){this.observers=this.observers.filter(function(t){return t!==e})},t.cancel=function(){return this.retryer?(this.retryer.cancel(),this.retryer.promise.then(i.lQ).catch(i.lQ)):Promise.resolve()},t.continue=function(){return this.retryer?(this.retryer.continue(),this.retryer.promise):this.execute()},t.execute=function(){var e,t=this,n="loading"===this.state.status,s=Promise.resolve();return n||(this.dispatch({type:"loading",variables:this.options.variables}),s=s.then(function(){null==t.mutationCache.config.onMutate||t.mutationCache.config.onMutate(t.state.variables,t)}).then(function(){return null==t.options.onMutate?void 0:t.options.onMutate(t.state.variables)}).then(function(e){e!==t.state.context&&t.dispatch({type:"loading",context:e,variables:t.state.variables})})),s.then(function(){return t.executeMutation()}).then(function(n){e=n,null==t.mutationCache.config.onSuccess||t.mutationCache.config.onSuccess(e,t.state.variables,t.state.context,t)}).then(function(){return null==t.options.onSuccess?void 0:t.options.onSuccess(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(e,null,t.state.variables,t.state.context)}).then(function(){return t.dispatch({type:"success",data:e}),e}).catch(function(e){return null==t.mutationCache.config.onError||t.mutationCache.config.onError(e,t.state.variables,t.state.context,t),(0,c.t)().error(e),Promise.resolve().then(function(){return null==t.options.onError?void 0:t.options.onError(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(void 0,e,t.state.variables,t.state.context)}).then(function(){throw t.dispatch({type:"error",error:e}),e})})},t.executeMutation=function(){var e,t=this;return this.retryer=new g({fn:function(){return t.options.mutationFn?t.options.mutationFn(t.state.variables):Promise.reject("No mutationFn found")},onFail:function(){t.dispatch({type:"failed"})},onPause:function(){t.dispatch({type:"pause"})},onContinue:function(){t.dispatch({type:"continue"})},retry:null!=(e=this.options.retry)?e:0,retryDelay:this.options.retryDelay}),this.retryer.promise},t.dispatch=function(e){var t=this;this.state=function(e,t){switch(t.type){case"failed":return(0,s.A)({},e,{failureCount:e.failureCount+1});case"pause":return(0,s.A)({},e,{isPaused:!0});case"continue":return(0,s.A)({},e,{isPaused:!1});case"loading":return(0,s.A)({},e,{context:t.context,data:void 0,error:null,isPaused:!1,status:"loading",variables:t.variables});case"success":return(0,s.A)({},e,{data:t.data,error:null,status:"success",isPaused:!1});case"error":return(0,s.A)({},e,{data:void 0,error:t.error,failureCount:e.failureCount+1,isPaused:!1,status:"error"});case"setState":return(0,s.A)({},e,t.state);default:return e}}(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onMutationUpdate(e)}),t.mutationCache.notify(t)})},e}();var E=function(e){function t(t){var n;return(n=e.call(this)||this).config=t||{},n.mutations=[],n.mutationId=0,n}a(t,e);var n=t.prototype;return n.build=function(e,t,n){var s=new _({mutationCache:this,mutationId:++this.mutationId,options:e.defaultMutationOptions(t),state:n,defaultOptions:t.mutationKey?e.getMutationDefaults(t.mutationKey):void 0,meta:t.meta});return this.add(s),s},n.add=function(e){this.mutations.push(e),this.notify(e)},n.remove=function(e){this.mutations=this.mutations.filter(function(t){return t!==e}),e.cancel(),this.notify(e)},n.clear=function(){var e=this;o.j.batch(function(){e.mutations.forEach(function(t){e.remove(t)})})},n.getAll=function(){return this.mutations},n.find=function(e){return"undefined"===typeof e.exact&&(e.exact=!0),this.mutations.find(function(t){return(0,i.nJ)(e,t)})},n.findAll=function(e){return this.mutations.filter(function(t){return(0,i.nJ)(e,t)})},n.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},n.onFocus=function(){this.resumePausedMutations()},n.onOnline=function(){this.resumePausedMutations()},n.resumePausedMutations=function(){var e=this.mutations.filter(function(e){return e.state.isPaused});return o.j.batch(function(){return e.reduce(function(e,t){return e.then(function(){return t.continue().catch(i.lQ)})},Promise.resolve())})},t}(l);function b(e,t){return null==e.getNextPageParam?void 0:e.getNextPageParam(t[t.length-1],t)}function x(e,t){return null==e.getPreviousPageParam?void 0:e.getPreviousPageParam(t[0],t)}var w=function(){function e(e){void 0===e&&(e={}),this.queryCache=e.queryCache||new v,this.mutationCache=e.mutationCache||new E,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[]}var t=e.prototype;return t.mount=function(){var e=this;this.unsubscribeFocus=d.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onFocus(),e.queryCache.onFocus())}),this.unsubscribeOnline=u.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onOnline(),e.queryCache.onOnline())})},t.unmount=function(){var e,t;null==(e=this.unsubscribeFocus)||e.call(this),null==(t=this.unsubscribeOnline)||t.call(this)},t.isFetching=function(e,t){var n=(0,i.b_)(e,t)[0];return n.fetching=!0,this.queryCache.findAll(n).length},t.isMutating=function(e){return this.mutationCache.findAll((0,s.A)({},e,{fetching:!0})).length},t.getQueryData=function(e,t){var n;return null==(n=this.queryCache.find(e,t))?void 0:n.state.data},t.getQueriesData=function(e){return this.getQueryCache().findAll(e).map(function(e){return[e.queryKey,e.state.data]})},t.setQueryData=function(e,t,n){var s=(0,i.vh)(e),r=this.defaultQueryOptions(s);return this.queryCache.build(this,r).setData(t,n)},t.setQueriesData=function(e,t,n){var s=this;return o.j.batch(function(){return s.getQueryCache().findAll(e).map(function(e){var i=e.queryKey;return[i,s.setQueryData(i,t,n)]})})},t.getQueryState=function(e,t){var n;return null==(n=this.queryCache.find(e,t))?void 0:n.state},t.removeQueries=function(e,t){var n=(0,i.b_)(e,t)[0],s=this.queryCache;o.j.batch(function(){s.findAll(n).forEach(function(e){s.remove(e)})})},t.resetQueries=function(e,t,n){var r=this,a=(0,i.b_)(e,t,n),c=a[0],l=a[1],d=this.queryCache,u=(0,s.A)({},c,{active:!0});return o.j.batch(function(){return d.findAll(c).forEach(function(e){e.reset()}),r.refetchQueries(u,l)})},t.cancelQueries=function(e,t,n){var s=this,r=(0,i.b_)(e,t,n),a=r[0],c=r[1],l=void 0===c?{}:c;"undefined"===typeof l.revert&&(l.revert=!0);var d=o.j.batch(function(){return s.queryCache.findAll(a).map(function(e){return e.cancel(l)})});return Promise.all(d).then(i.lQ).catch(i.lQ)},t.invalidateQueries=function(e,t,n){var r,a,c,l=this,d=(0,i.b_)(e,t,n),u=d[0],h=d[1],p=(0,s.A)({},u,{active:null==(r=null!=(a=u.refetchActive)?a:u.active)||r,inactive:null!=(c=u.refetchInactive)&&c});return o.j.batch(function(){return l.queryCache.findAll(u).forEach(function(e){e.invalidate()}),l.refetchQueries(p,h)})},t.refetchQueries=function(e,t,n){var r=this,a=(0,i.b_)(e,t,n),c=a[0],l=a[1],d=o.j.batch(function(){return r.queryCache.findAll(c).map(function(e){return e.fetch(void 0,(0,s.A)({},l,{meta:{refetchPage:null==c?void 0:c.refetchPage}}))})}),u=Promise.all(d).then(i.lQ);return(null==l?void 0:l.throwOnError)||(u=u.catch(i.lQ)),u},t.fetchQuery=function(e,t,n){var s=(0,i.vh)(e,t,n),r=this.defaultQueryOptions(s);"undefined"===typeof r.retry&&(r.retry=!1);var a=this.queryCache.build(this,r);return a.isStaleByTime(r.staleTime)?a.fetch(r):Promise.resolve(a.state.data)},t.prefetchQuery=function(e,t,n){return this.fetchQuery(e,t,n).then(i.lQ).catch(i.lQ)},t.fetchInfiniteQuery=function(e,t,n){var s=(0,i.vh)(e,t,n);return s.behavior={onFetch:function(e){e.fetchFn=function(){var t,n,s,r,a,o,c,l=null==(t=e.fetchOptions)||null==(n=t.meta)?void 0:n.refetchPage,d=null==(s=e.fetchOptions)||null==(r=s.meta)?void 0:r.fetchMore,u=null==d?void 0:d.pageParam,h="forward"===(null==d?void 0:d.direction),m="backward"===(null==d?void 0:d.direction),f=(null==(a=e.state.data)?void 0:a.pages)||[],g=(null==(o=e.state.data)?void 0:o.pageParams)||[],y=(0,i.jY)(),v=null==y?void 0:y.signal,_=g,E=!1,w=e.options.queryFn||function(){return Promise.reject("Missing queryFn")},S=function(e,t,n,s){return _=s?[t].concat(_):[].concat(_,[t]),s?[n].concat(e):[].concat(e,[n])},N=function(t,n,s,i){if(E)return Promise.reject("Cancelled");if("undefined"===typeof s&&!n&&t.length)return Promise.resolve(t);var r={queryKey:e.queryKey,signal:v,pageParam:s,meta:e.meta},a=w(r),o=Promise.resolve(a).then(function(e){return S(t,s,e,i)});return p(a)&&(o.cancel=a.cancel),o};if(f.length)if(h){var T="undefined"!==typeof u,C=T?u:b(e.options,f);c=N(f,T,C)}else if(m){var R="undefined"!==typeof u,I=R?u:x(e.options,f);c=N(f,R,I,!0)}else!function(){_=[];var t="undefined"===typeof e.options.getNextPageParam,n=!l||!f[0]||l(f[0],0,f);c=n?N([],t,g[0]):Promise.resolve(S([],g[0],f[0]));for(var s=function(n){c=c.then(function(s){if(!l||!f[n]||l(f[n],n,f)){var i=t?g[n]:b(e.options,s);return N(s,t,i)}return Promise.resolve(S(s,g[n],f[n]))})},i=1;i<f.length;i++)s(i)}();else c=N([]);var A=c.then(function(e){return{pages:e,pageParams:_}});return A.cancel=function(){E=!0,null==y||y.abort(),p(c)&&c.cancel()},A}}},this.fetchQuery(s)},t.prefetchInfiniteQuery=function(e,t,n){return this.fetchInfiniteQuery(e,t,n).then(i.lQ).catch(i.lQ)},t.cancelMutations=function(){var e=this,t=o.j.batch(function(){return e.mutationCache.getAll().map(function(e){return e.cancel()})});return Promise.all(t).then(i.lQ).catch(i.lQ)},t.resumePausedMutations=function(){return this.getMutationCache().resumePausedMutations()},t.executeMutation=function(e){return this.mutationCache.build(this,e).execute()},t.getQueryCache=function(){return this.queryCache},t.getMutationCache=function(){return this.mutationCache},t.getDefaultOptions=function(){return this.defaultOptions},t.setDefaultOptions=function(e){this.defaultOptions=e},t.setQueryDefaults=function(e,t){var n=this.queryDefaults.find(function(t){return(0,i.Od)(e)===(0,i.Od)(t.queryKey)});n?n.defaultOptions=t:this.queryDefaults.push({queryKey:e,defaultOptions:t})},t.getQueryDefaults=function(e){var t;return e?null==(t=this.queryDefaults.find(function(t){return(0,i.Cp)(e,t.queryKey)}))?void 0:t.defaultOptions:void 0},t.setMutationDefaults=function(e,t){var n=this.mutationDefaults.find(function(t){return(0,i.Od)(e)===(0,i.Od)(t.mutationKey)});n?n.defaultOptions=t:this.mutationDefaults.push({mutationKey:e,defaultOptions:t})},t.getMutationDefaults=function(e){var t;return e?null==(t=this.mutationDefaults.find(function(t){return(0,i.Cp)(e,t.mutationKey)}))?void 0:t.defaultOptions:void 0},t.defaultQueryOptions=function(e){if(null==e?void 0:e._defaulted)return e;var t=(0,s.A)({},this.defaultOptions.queries,this.getQueryDefaults(null==e?void 0:e.queryKey),e,{_defaulted:!0});return!t.queryHash&&t.queryKey&&(t.queryHash=(0,i.F$)(t.queryKey,t)),t},t.defaultQueryObserverOptions=function(e){return this.defaultQueryOptions(e)},t.defaultMutationOptions=function(e){return(null==e?void 0:e._defaulted)?e:(0,s.A)({},this.defaultOptions.mutations,this.getMutationDefaults(null==e?void 0:e.mutationKey),e,{_defaulted:!0})},t.clear=function(){this.queryCache.clear(),this.mutationCache.clear()},e}()},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),s=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function v(){}function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var E=_.prototype=new v;E.constructor=_,f(E,y.prototype),E.isPureReactComponent=!0;var b=Array.isArray,x=Object.prototype.hasOwnProperty,w={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,s){var i,r={},a=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)x.call(t,i)&&!S.hasOwnProperty(i)&&(r[i]=t[i]);var c=arguments.length-2;if(1===c)r.children=s;else if(1<c){for(var l=Array(c),d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===r[i]&&(r[i]=c[i]);return{$$typeof:n,type:e,key:a,ref:o,props:r,_owner:w.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,i,r,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c=!1;if(null===e)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case s:c=!0}}if(c)return a=a(c=e),e=""===r?"."+R(c,0):r,b(a)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),I(a,t,i,"",function(e){return e})):null!=a&&(T(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+e)),t.push(a)),1;if(c=0,r=""===r?".":r+":",b(e))for(var l=0;l<e.length;l++){var d=r+R(o=e[l],l);c+=I(o,t,i,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),l=0;!(o=e.next()).done;)c+=I(o=o.value,t,i,d=r+R(o,l++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function A(e,t,n){if(null==e)return e;var s=[],i=0;return I(e,s,"","",function(e){return t.call(n,e,i++)}),s}function O(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var k={current:null},D={transition:null},P={ReactCurrentDispatcher:k,ReactCurrentBatchConfig:D,ReactCurrentOwner:w};t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=a,t.PureComponent=_,t.StrictMode=r,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,s){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=f({},e.props),r=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=w.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)x.call(t,l)&&!S.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=s;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}return{$$typeof:n,type:e.type,key:r,ref:a,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=N,t.createFactory=function(e){var t=N.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return k.current.useCallback(e,t)},t.useContext=function(e){return k.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return k.current.useDeferredValue(e)},t.useEffect=function(e,t){return k.current.useEffect(e,t)},t.useId=function(){return k.current.useId()},t.useImperativeHandle=function(e,t,n){return k.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return k.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return k.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return k.current.useMemo(e,t)},t.useReducer=function(e,t,n){return k.current.useReducer(e,t,n)},t.useRef=function(e){return k.current.useRef(e)},t.useState=function(e){return k.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return k.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return k.current.useTransition()},t.version="18.2.0"},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var s=n-1>>>1,i=e[s];if(!(0<r(i,t)))break e;e[s]=t,e[n]=i,n=s}}function s(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var s=0,i=e.length,a=i>>>1;s<a;){var o=2*(s+1)-1,c=e[o],l=o+1,d=e[l];if(0>r(c,n))l<i&&0>r(d,c)?(e[s]=d,e[l]=n,s=l):(e[s]=c,e[o]=n,s=o);else{if(!(l<i&&0>r(d,n)))break e;e[s]=d,e[l]=n,s=l}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,c=o.now();t.unstable_now=function(){return o.now()-c}}var l=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=s(d);null!==t;){if(null===t.callback)i(d);else{if(!(t.startTime<=e))break;i(d),t.sortIndex=t.expirationTime,n(l,t)}t=s(d)}}function b(e){if(g=!1,E(e),!f)if(null!==s(l))f=!0,D(x);else{var t=s(d);null!==t&&P(b,t.startTime-e)}}function x(e,n){f=!1,g&&(g=!1,v(T),T=-1),m=!0;var r=p;try{for(E(n),h=s(l);null!==h&&(!(h.expirationTime>n)||e&&!I());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===s(l)&&i(l),E(n)}else i(l);h=s(l)}if(null!==h)var c=!0;else{var u=s(d);null!==u&&P(b,u.startTime-n),c=!1}return c}finally{h=null,p=r,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,S=!1,N=null,T=-1,C=5,R=-1;function I(){return!(t.unstable_now()-R<C)}function A(){if(null!==N){var e=t.unstable_now();R=e;var n=!0;try{n=N(!0,e)}finally{n?w():(S=!1,N=null)}}else S=!1}if("function"===typeof _)w=function(){_(A)};else if("undefined"!==typeof MessageChannel){var O=new MessageChannel,k=O.port2;O.port1.onmessage=A,w=function(){k.postMessage(null)}}else w=function(){y(A,0)};function D(e){N=e,S||(S=!0,w())}function P(e,n){T=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,D(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return s(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,r){var a=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?a+r:a:r=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:i,priorityLevel:e,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>a?(e.sortIndex=r,n(d,e),null===s(l)&&e===s(d)&&(g?(v(T),T=-1):g=!0,P(b,r-a))):(e.sortIndex=o,n(l,e),f||m||(f=!0,D(x))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},298:()=>{},391:(e,t,n)=>{"use strict";var s=n(950);t.H=s.createRoot,s.hydrateRoot},524:(e,t,n)=>{"use strict";n.d(t,{QueryClientProvider:()=>u});var s=n(991),i=n(950).unstable_batchedUpdates;s.j.setBatchNotifyFunction(i);var r=n(75),a=console;(0,r.B)(a);var o=n(43),c=o.createContext(void 0),l=o.createContext(!1);function d(e){return e&&"undefined"!==typeof window?(window.ReactQueryClientContext||(window.ReactQueryClientContext=c),window.ReactQueryClientContext):c}var u=function(e){var t=e.client,n=e.contextSharing,s=void 0!==n&&n,i=e.children;o.useEffect(function(){return t.mount(),function(){t.unmount()}},[t]);var r=d(s);return o.createElement(l.Provider,{value:s},o.createElement(r.Provider,{value:t},i))}},579:(e,t,n)=>{"use strict";e.exports=n(153)},635:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var s=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i=function(e){try{return!!e()}catch(e){return!0}},r=!i(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),a=r,o=Function.prototype,c=o.call,l=a&&o.bind.bind(c,c),d=a?l:function(e){return function(){return c.apply(e,arguments)}},u=d({}.isPrototypeOf),h=function(e){return e&&e.Math===Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof t&&t)||h("object"==typeof t&&t)||function(){return this}()||Function("return this")(),m=r,f=Function.prototype,g=f.apply,y=f.call,v="object"==typeof Reflect&&Reflect.apply||(m?y.bind(g):function(){return y.apply(g,arguments)}),_=d,E=_({}.toString),b=_("".slice),x=function(e){return b(E(e),8,-1)},w=x,S=d,N=function(e){if("Function"===w(e))return S(e)},T="object"==typeof document&&document.all,C=void 0===T&&void 0!==T?function(e){return"function"==typeof e||e===T}:function(e){return"function"==typeof e},R={},I=!i(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),A=r,O=Function.prototype.call,k=A?O.bind(O):function(){return O.apply(O,arguments)},D={},P={}.propertyIsEnumerable,j=Object.getOwnPropertyDescriptor,L=j&&!P.call({1:2},1);D.f=L?function(e){var t=j(this,e);return!!t&&t.enumerable}:P;var M,U,V=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},F=i,B=x,G=Object,W=d("".split),H=F(function(){return!G("z").propertyIsEnumerable(0)})?function(e){return"String"===B(e)?W(e,""):G(e)}:G,K=function(e){return null==e},z=K,q=TypeError,Y=function(e){if(z(e))throw new q("Can't call method on "+e);return e},X=H,J=Y,Q=function(e){return X(J(e))},Z=C,$=function(e){return"object"==typeof e?null!==e:Z(e)},ee={},te=ee,ne=p,se=C,ie=function(e){return se(e)?e:void 0},re=function(e,t){return arguments.length<2?ie(te[e])||ie(ne[e]):te[e]&&te[e][t]||ne[e]&&ne[e][t]},ae=p.navigator,oe=ae&&ae.userAgent,ce=oe?String(oe):"",le=p,de=ce,ue=le.process,he=le.Deno,pe=ue&&ue.versions||he&&he.version,me=pe&&pe.v8;me&&(U=(M=me.split("."))[0]>0&&M[0]<4?1:+(M[0]+M[1])),!U&&de&&(!(M=de.match(/Edge\/(\d+)/))||M[1]>=74)&&(M=de.match(/Chrome\/(\d+)/))&&(U=+M[1]);var fe=U,ge=fe,ye=i,ve=p.String,_e=!!Object.getOwnPropertySymbols&&!ye(function(){var e=Symbol("symbol detection");return!ve(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ge&&ge<41}),Ee=_e&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,be=re,xe=C,we=u,Se=Object,Ne=Ee?function(e){return"symbol"==typeof e}:function(e){var t=be("Symbol");return xe(t)&&we(t.prototype,Se(e))},Te=String,Ce=function(e){try{return Te(e)}catch(e){return"Object"}},Re=C,Ie=Ce,Ae=TypeError,Oe=function(e){if(Re(e))return e;throw new Ae(Ie(e)+" is not a function")},ke=Oe,De=K,Pe=function(e,t){var n=e[t];return De(n)?void 0:ke(n)},je=k,Le=C,Me=$,Ue=TypeError,Ve={exports:{}},Fe=p,Be=Object.defineProperty,Ge=p,We=function(e,t){try{Be(Fe,e,{value:t,configurable:!0,writable:!0})}catch(s){Fe[e]=t}return t},He="__core-js_shared__",Ke=Ve.exports=Ge[He]||We(He,{});(Ke.versions||(Ke.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ze=Ve.exports,qe=ze,Ye=function(e,t){return qe[e]||(qe[e]=t||{})},Xe=Y,Je=Object,Qe=function(e){return Je(Xe(e))},Ze=Qe,$e=d({}.hasOwnProperty),et=Object.hasOwn||function(e,t){return $e(Ze(e),t)},tt=d,nt=0,st=Math.random(),it=tt(1..toString),rt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+it(++nt+st,36)},at=Ye,ot=et,ct=rt,lt=_e,dt=Ee,ut=p.Symbol,ht=at("wks"),pt=dt?ut.for||ut:ut&&ut.withoutSetter||ct,mt=function(e){return ot(ht,e)||(ht[e]=lt&&ot(ut,e)?ut[e]:pt("Symbol."+e)),ht[e]},ft=k,gt=$,yt=Ne,vt=Pe,_t=function(e,t){var n,s;if("string"===t&&Le(n=e.toString)&&!Me(s=je(n,e)))return s;if(Le(n=e.valueOf)&&!Me(s=je(n,e)))return s;if("string"!==t&&Le(n=e.toString)&&!Me(s=je(n,e)))return s;throw new Ue("Can't convert object to primitive value")},Et=TypeError,bt=mt("toPrimitive"),xt=function(e,t){if(!gt(e)||yt(e))return e;var n,s=vt(e,bt);if(s){if(void 0===t&&(t="default"),n=ft(s,e,t),!gt(n)||yt(n))return n;throw new Et("Can't convert object to primitive value")}return void 0===t&&(t="number"),_t(e,t)},wt=Ne,St=function(e){var t=xt(e,"string");return wt(t)?t:t+""},Nt=$,Tt=p.document,Ct=Nt(Tt)&&Nt(Tt.createElement),Rt=function(e){return Ct?Tt.createElement(e):{}},It=Rt,At=!I&&!i(function(){return 7!==Object.defineProperty(It("div"),"a",{get:function(){return 7}}).a}),Ot=I,kt=k,Dt=D,Pt=V,jt=Q,Lt=St,Mt=et,Ut=At,Vt=Object.getOwnPropertyDescriptor;R.f=Ot?Vt:function(e,t){if(e=jt(e),t=Lt(t),Ut)try{return Vt(e,t)}catch(e){}if(Mt(e,t))return Pt(!kt(Dt.f,e,t),e[t])};var Ft=i,Bt=C,Gt=/#|\.prototype\./,Wt=function(e,t){var n=Kt[Ht(e)];return n===qt||n!==zt&&(Bt(t)?Ft(t):!!t)},Ht=Wt.normalize=function(e){return String(e).replace(Gt,".").toLowerCase()},Kt=Wt.data={},zt=Wt.NATIVE="N",qt=Wt.POLYFILL="P",Yt=Wt,Xt=Oe,Jt=r,Qt=N(N.bind),Zt=function(e,t){return Xt(e),void 0===t?e:Jt?Qt(e,t):function(){return e.apply(t,arguments)}},$t={},en=I&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),tn=$,nn=String,sn=TypeError,rn=function(e){if(tn(e))return e;throw new sn(nn(e)+" is not an object")},an=I,on=At,cn=en,ln=rn,dn=St,un=TypeError,hn=Object.defineProperty,pn=Object.getOwnPropertyDescriptor,mn="enumerable",fn="configurable",gn="writable";$t.f=an?cn?function(e,t,n){if(ln(e),t=dn(t),ln(n),"function"==typeof e&&"prototype"===t&&"value"in n&&gn in n&&!n[gn]){var s=pn(e,t);s&&s[gn]&&(e[t]=n.value,n={configurable:fn in n?n[fn]:s[fn],enumerable:mn in n?n[mn]:s[mn],writable:!1})}return hn(e,t,n)}:hn:function(e,t,n){if(ln(e),t=dn(t),ln(n),on)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new un("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var yn=$t,vn=V,_n=I?function(e,t,n){return yn.f(e,t,vn(1,n))}:function(e,t,n){return e[t]=n,e},En=p,bn=v,xn=N,wn=C,Sn=R.f,Nn=Yt,Tn=ee,Cn=Zt,Rn=_n,In=et,An=function(e){var t=function(n,s,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,s)}return new e(n,s,i)}return bn(e,this,arguments)};return t.prototype=e.prototype,t},On=function(e,t){var n,s,i,r,a,o,c,l,d,u=e.target,h=e.global,p=e.stat,m=e.proto,f=h?En:p?En[u]:En[u]&&En[u].prototype,g=h?Tn:Tn[u]||Rn(Tn,u,{})[u],y=g.prototype;for(r in t)s=!(n=Nn(h?r:u+(p?".":"#")+r,e.forced))&&f&&In(f,r),o=g[r],s&&(c=e.dontCallGetSet?(d=Sn(f,r))&&d.value:f[r]),a=s&&c?c:t[r],(n||m||typeof o!=typeof a)&&(l=e.bind&&s?Cn(a,En):e.wrap&&s?An(a):m&&wn(a)?xn(a):a,(e.sham||a&&a.sham||o&&o.sham)&&Rn(l,"sham",!0),Rn(g,r,l),m&&(In(Tn,i=u+"Prototype")||Rn(Tn,i,{}),Rn(Tn[i],r,a),e.real&&y&&(n||!y[r])&&Rn(y,r,a)))},kn=Math.ceil,Dn=Math.floor,Pn=Math.trunc||function(e){var t=+e;return(t>0?Dn:kn)(t)},jn=Pn,Ln=function(e){var t=+e;return t!=t||0===t?0:jn(t)},Mn=Ln,Un=Math.max,Vn=Math.min,Fn=function(e,t){var n=Mn(e);return n<0?Un(n+t,0):Vn(n,t)},Bn=Ln,Gn=Math.min,Wn=function(e){var t=Bn(e);return t>0?Gn(t,9007199254740991):0},Hn=Wn,Kn=function(e){return Hn(e.length)},zn=Q,qn=Fn,Yn=Kn,Xn=function(e){return function(t,n,s){var i=zn(t),r=Yn(i);if(0===r)return!e&&-1;var a,o=qn(s,r);if(e&&n!=n){for(;r>o;)if((a=i[o++])!=a)return!0}else for(;r>o;o++)if((e||o in i)&&i[o]===n)return e||o||0;return!e&&-1}},Jn={includes:Xn(!0),indexOf:Xn(!1)},Qn=Jn.includes;On({target:"Array",proto:!0,forced:i(function(){return!Array(1).includes()})},{includes:function(e){return Qn(this,e,arguments.length>1?arguments[1]:void 0)}});var Zn=p,$n=ee,es=function(e,t){var n=$n[e+"Prototype"],s=n&&n[t];if(s)return s;var i=Zn[e],r=i&&i.prototype;return r&&r[t]},ts=es("Array","includes"),ns=$,ss=x,is=mt("match"),rs=function(e){var t;return ns(e)&&(void 0!==(t=e[is])?!!t:"RegExp"===ss(e))},as=rs,os=TypeError,cs={};cs[mt("toStringTag")]="z";var ls="[object z]"===String(cs),ds=ls,us=C,hs=x,ps=mt("toStringTag"),ms=Object,fs="Arguments"===hs(function(){return arguments}()),gs=ds?hs:function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=ms(e),ps))?n:fs?hs(t):"Object"===(s=hs(t))&&us(t.callee)?"Arguments":s},ys=gs,vs=String,_s=function(e){if("Symbol"===ys(e))throw new TypeError("Cannot convert a Symbol value to a string");return vs(e)},Es=mt("match"),bs=On,xs=function(e){if(as(e))throw new os("The method doesn't accept regular expressions");return e},ws=Y,Ss=_s,Ns=function(e){var t=/./;try{"/./"[e](t)}catch(s){try{return t[Es]=!1,"/./"[e](t)}catch(e){}}return!1},Ts=d("".indexOf);bs({target:"String",proto:!0,forced:!Ns("includes")},{includes:function(e){return!!~Ts(Ss(ws(this)),Ss(xs(e)),arguments.length>1?arguments[1]:void 0)}});var Cs=es("String","includes"),Rs=u,Is=ts,As=Cs,Os=Array.prototype,ks=String.prototype,Ds=function(e){var t=e.includes;return e===Os||Rs(Os,e)&&t===Os.includes?Is:"string"==typeof e||e===ks||Rs(ks,e)&&t===ks.includes?As:t},Ps=s(Ds),js=Oe,Ls=Qe,Ms=H,Us=Kn,Vs=TypeError,Fs="Reduce of empty array with no initial value",Bs=function(e){return function(t,n,s,i){var r=Ls(t),a=Ms(r),o=Us(r);if(js(n),0===o&&s<2)throw new Vs(Fs);var c=e?o-1:0,l=e?-1:1;if(s<2)for(;;){if(c in a){i=a[c],c+=l;break}if(c+=l,e?c<0:o<=c)throw new Vs(Fs)}for(;e?c>=0:o>c;c+=l)c in a&&(i=n(i,a[c],c,r));return i}},Gs={left:Bs(!1),right:Bs(!0)},Ws=i,Hs=function(e,t){var n=[][e];return!!n&&Ws(function(){n.call(null,t||function(){return 1},1)})},Ks=p,zs=ce,qs=x,Ys=function(e){return zs.slice(0,e.length)===e},Xs=Ys("Bun/")?"BUN":Ys("Cloudflare-Workers")?"CLOUDFLARE":Ys("Deno/")?"DENO":Ys("Node.js/")?"NODE":Ks.Bun&&"string"==typeof Bun.version?"BUN":Ks.Deno&&"object"==typeof Deno.version?"DENO":"process"===qs(Ks.process)?"NODE":Ks.window&&Ks.document?"BROWSER":"REST",Js="NODE"===Xs,Qs=Gs.left;On({target:"Array",proto:!0,forced:!Js&&fe>79&&fe<83||!Hs("reduce")},{reduce:function(e){var t=arguments.length;return Qs(this,e,t,t>1?arguments[1]:void 0)}});var Zs=es("Array","reduce"),$s=u,ei=Zs,ti=Array.prototype,ni=function(e){var t=e.reduce;return e===ti||$s(ti,e)&&t===ti.reduce?ei:t},si=ni,ii=s(si),ri=x,ai=Array.isArray||function(e){return"Array"===ri(e)},oi=On,ci=ai,li=d([].reverse),di=[1,2];oi({target:"Array",proto:!0,forced:String(di)===String(di.reverse())},{reverse:function(){return ci(this)&&(this.length=this.length),li(this)}});var ui=es("Array","reverse"),hi=u,pi=ui,mi=Array.prototype,fi=function(e){var t=e.reverse;return e===mi||hi(mi,e)&&t===mi.reverse?pi:t},gi=fi,yi=s(gi),vi=rt,_i=Ye("keys"),Ei=function(e){return _i[e]||(_i[e]=vi(e))},bi=!i(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),xi=et,wi=C,Si=Qe,Ni=bi,Ti=Ei("IE_PROTO"),Ci=Object,Ri=Ci.prototype,Ii=Ni?Ci.getPrototypeOf:function(e){var t=Si(e);if(xi(t,Ti))return t[Ti];var n=t.constructor;return wi(n)&&t instanceof n?n.prototype:t instanceof Ci?Ri:null},Ai=d,Oi=Oe,ki=$,Di=function(e){return ki(e)||null===e},Pi=String,ji=TypeError,Li=function(e,t,n){try{return Ai(Oi(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Mi=$,Ui=Y,Vi=function(e){if(Di(e))return e;throw new ji("Can't set "+Pi(e)+" as a prototype")},Fi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Li(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,s){return Ui(n),Vi(s),Mi(n)?(t?e(n,s):n.__proto__=s,n):n}}():void 0),Bi={},Gi={},Wi=et,Hi=Q,Ki=Jn.indexOf,zi=Gi,qi=d([].push),Yi=function(e,t){var n,s=Hi(e),i=0,r=[];for(n in s)!Wi(zi,n)&&Wi(s,n)&&qi(r,n);for(;t.length>i;)Wi(s,n=t[i++])&&(~Ki(r,n)||qi(r,n));return r},Xi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ji=Yi,Qi=Xi.concat("length","prototype");Bi.f=Object.getOwnPropertyNames||function(e){return Ji(e,Qi)};var Zi={};Zi.f=Object.getOwnPropertySymbols;var $i=re,er=Bi,tr=Zi,nr=rn,sr=d([].concat),ir=$i("Reflect","ownKeys")||function(e){var t=er.f(nr(e)),n=tr.f;return n?sr(t,n(e)):t},rr=et,ar=ir,or=R,cr=$t,lr={},dr=Yi,ur=Xi,hr=Object.keys||function(e){return dr(e,ur)},pr=I,mr=en,fr=$t,gr=rn,yr=Q,vr=hr;lr.f=pr&&!mr?Object.defineProperties:function(e,t){gr(e);for(var n,s=yr(t),i=vr(t),r=i.length,a=0;r>a;)fr.f(e,n=i[a++],s[n]);return e};var _r,Er=re("document","documentElement"),br=rn,xr=lr,wr=Xi,Sr=Gi,Nr=Er,Tr=Rt,Cr="prototype",Rr="script",Ir=Ei("IE_PROTO"),Ar=function(){},Or=function(e){return"<"+Rr+">"+e+"</"+Rr+">"},kr=function(e){e.write(Or("")),e.close();var t=e.parentWindow.Object;return e=null,t},Dr=function(){try{_r=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;Dr="undefined"!=typeof document?document.domain&&_r?kr(_r):(t=Tr("iframe"),n="java"+Rr+":",t.style.display="none",Nr.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Or("document.F=Object")),e.close(),e.F):kr(_r);for(var s=wr.length;s--;)delete Dr[Cr][wr[s]];return Dr()};Sr[Ir]=!0;var Pr=Object.create||function(e,t){var n;return null!==e?(Ar[Cr]=br(e),n=new Ar,Ar[Cr]=null,n[Ir]=e):n=Dr(),void 0===t?n:xr.f(n,t)},jr=$,Lr=_n,Mr=Error,Ur=d("".replace),Vr=String(new Mr("zxcasd").stack),Fr=/\n\s*at [^:]*:[^\n]*/,Br=Fr.test(Vr),Gr=V,Wr=!i(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Gr(1,7)),7!==e.stack)}),Hr=_n,Kr=function(e,t){if(Br&&"string"==typeof e&&!Mr.prepareStackTrace)for(;t--;)e=Ur(e,Fr,"");return e},zr=Wr,qr=Error.captureStackTrace,Yr={},Xr=Yr,Jr=mt("iterator"),Qr=Array.prototype,Zr=function(e){return void 0!==e&&(Xr.Array===e||Qr[Jr]===e)},$r=gs,ea=Pe,ta=K,na=Yr,sa=mt("iterator"),ia=function(e){if(!ta(e))return ea(e,sa)||ea(e,"@@iterator")||na[$r(e)]},ra=k,aa=Oe,oa=rn,ca=Ce,la=ia,da=TypeError,ua=function(e,t){var n=arguments.length<2?la(e):t;if(aa(n))return oa(ra(n,e));throw new da(ca(e)+" is not iterable")},ha=k,pa=rn,ma=Pe,fa=function(e,t,n){var s,i;pa(e);try{if(!(s=ma(e,"return"))){if("throw"===t)throw n;return n}s=ha(s,e)}catch(e){i=!0,s=e}if("throw"===t)throw n;if(i)throw s;return pa(s),n},ga=Zt,ya=k,va=rn,_a=Ce,Ea=Zr,ba=Kn,xa=u,wa=ua,Sa=ia,Na=fa,Ta=TypeError,Ca=function(e,t){this.stopped=e,this.result=t},Ra=Ca.prototype,Ia=function(e,t,n){var s,i,r,a,o,c,l,d=n&&n.that,u=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),m=!(!n||!n.INTERRUPTED),f=ga(t,d),g=function(e){return s&&Na(s,"normal",e),new Ca(!0,e)},y=function(e){return u?(va(e),m?f(e[0],e[1],g):f(e[0],e[1])):m?f(e,g):f(e)};if(h)s=e.iterator;else if(p)s=e;else{if(!(i=Sa(e)))throw new Ta(_a(e)+" is not iterable");if(Ea(i)){for(r=0,a=ba(e);a>r;r++)if((o=y(e[r]))&&xa(Ra,o))return o;return new Ca(!1)}s=wa(e,i)}for(c=h?e.next:s.next;!(l=ya(c,s)).done;){try{o=y(l.value)}catch(e){Na(s,"throw",e)}if("object"==typeof o&&o&&xa(Ra,o))return o}return new Ca(!1)},Aa=_s,Oa=On,ka=u,Da=Ii,Pa=Fi,ja=function(e,t,n){for(var s=ar(t),i=cr.f,r=or.f,a=0;a<s.length;a++){var o=s[a];rr(e,o)||n&&rr(n,o)||i(e,o,r(t,o))}},La=Pr,Ma=_n,Ua=V,Va=function(e,t){jr(t)&&"cause"in t&&Lr(e,"cause",t.cause)},Fa=function(e,t,n,s){zr&&(qr?qr(e,t):Hr(e,"stack",Kr(n,s)))},Ba=Ia,Ga=function(e,t){return void 0===e?arguments.length<2?"":t:Aa(e)},Wa=mt("toStringTag"),Ha=Error,Ka=[].push,za=function(e,t){var n,s=ka(qa,this);Pa?n=Pa(new Ha,s?Da(this):qa):(n=s?this:La(qa),Ma(n,Wa,"Error")),void 0!==t&&Ma(n,"message",Ga(t)),Fa(n,za,n.stack,1),arguments.length>2&&Va(n,arguments[2]);var i=[];return Ba(e,Ka,{that:i}),Ma(n,"errors",i),n};Pa?Pa(za,Ha):ja(za,Ha,{name:!0});var qa=za.prototype=La(Ha.prototype,{constructor:Ua(1,za),message:Ua(1,""),name:Ua(1,"AggregateError")});Oa({global:!0,constructor:!0,arity:2},{AggregateError:za});var Ya,Xa,Ja,Qa=C,Za=p.WeakMap,$a=Qa(Za)&&/native code/.test(String(Za)),eo=p,to=$,no=_n,so=et,io=ze,ro=Ei,ao=Gi,oo="Object already initialized",co=eo.TypeError,lo=eo.WeakMap;if($a||io.state){var uo=io.state||(io.state=new lo);uo.get=uo.get,uo.has=uo.has,uo.set=uo.set,Ya=function(e,t){if(uo.has(e))throw new co(oo);return t.facade=e,uo.set(e,t),t},Xa=function(e){return uo.get(e)||{}},Ja=function(e){return uo.has(e)}}else{var ho=ro("state");ao[ho]=!0,Ya=function(e,t){if(so(e,ho))throw new co(oo);return t.facade=e,no(e,ho,t),t},Xa=function(e){return so(e,ho)?e[ho]:{}},Ja=function(e){return so(e,ho)}}var po,mo,fo,go={set:Ya,get:Xa,has:Ja,enforce:function(e){return Ja(e)?Xa(e):Ya(e,{})},getterFor:function(e){return function(t){var n;if(!to(t)||(n=Xa(t)).type!==e)throw new co("Incompatible receiver, "+e+" required");return n}}},yo=I,vo=et,_o=Function.prototype,Eo=yo&&Object.getOwnPropertyDescriptor,bo=vo(_o,"name"),xo={EXISTS:bo,PROPER:bo&&"something"===function(){}.name,CONFIGURABLE:bo&&(!yo||yo&&Eo(_o,"name").configurable)},wo=_n,So=function(e,t,n,s){return s&&s.enumerable?e[t]=n:wo(e,t,n),e},No=i,To=C,Co=$,Ro=Pr,Io=Ii,Ao=So,Oo=mt("iterator"),ko=!1;[].keys&&("next"in(fo=[].keys())?(mo=Io(Io(fo)))!==Object.prototype&&(po=mo):ko=!0);var Do=!Co(po)||No(function(){var e={};return po[Oo].call(e)!==e});To((po=Do?{}:Ro(po))[Oo])||Ao(po,Oo,function(){return this});var Po={IteratorPrototype:po,BUGGY_SAFARI_ITERATORS:ko},jo=gs,Lo=ls?{}.toString:function(){return"[object "+jo(this)+"]"},Mo=ls,Uo=$t.f,Vo=_n,Fo=et,Bo=Lo,Go=mt("toStringTag"),Wo=function(e,t,n,s){var i=n?e:e&&e.prototype;i&&(Fo(i,Go)||Uo(i,Go,{configurable:!0,value:t}),s&&!Mo&&Vo(i,"toString",Bo))},Ho=Po.IteratorPrototype,Ko=Pr,zo=V,qo=Wo,Yo=Yr,Xo=function(){return this},Jo=function(e,t,n,s){var i=t+" Iterator";return e.prototype=Ko(Ho,{next:zo(+!s,n)}),qo(e,i,!1,!0),Yo[i]=Xo,e},Qo=On,Zo=k,$o=Jo,ec=Ii,tc=Wo,nc=So,sc=Yr,ic=Po,rc=xo.PROPER,ac=ic.BUGGY_SAFARI_ITERATORS,oc=mt("iterator"),cc="keys",lc="values",dc="entries",uc=function(){return this},hc=function(e,t,n,s,i,r,a){$o(n,t,s);var o,c,l,d=function(e){if(e===i&&f)return f;if(!ac&&e&&e in p)return p[e];switch(e){case cc:case lc:case dc:return function(){return new n(this,e)}}return function(){return new n(this)}},u=t+" Iterator",h=!1,p=e.prototype,m=p[oc]||p["@@iterator"]||i&&p[i],f=!ac&&m||d(i),g="Array"===t&&p.entries||m;if(g&&(o=ec(g.call(new e)))!==Object.prototype&&o.next&&(tc(o,u,!0,!0),sc[u]=uc),rc&&i===lc&&m&&m.name!==lc&&(h=!0,f=function(){return Zo(m,this)}),i)if(c={values:d(lc),keys:r?f:d(cc),entries:d(dc)},a)for(l in c)(ac||h||!(l in p))&&nc(p,l,c[l]);else Qo({target:t,proto:!0,forced:ac||h},c);return a&&p[oc]!==f&&nc(p,oc,f,{name:i}),sc[t]=f,c},pc=function(e,t){return{value:e,done:t}},mc=Q,fc=Yr,gc=go;$t.f;var yc=hc,vc=pc,_c="Array Iterator",Ec=gc.set,bc=gc.getterFor(_c);yc(Array,"Array",function(e,t){Ec(this,{type:_c,target:mc(e),index:0,kind:t})},function(){var e=bc(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,vc(void 0,!0);switch(e.kind){case"keys":return vc(n,!1);case"values":return vc(t[n],!1)}return vc([n,t[n]],!1)},"values"),fc.Arguments=fc.Array;var xc=$t,wc=function(e,t,n){return xc.f(e,t,n)},Sc=re,Nc=wc,Tc=I,Cc=mt("species"),Rc=u,Ic=TypeError,Ac=function(e,t){if(Rc(t,e))return e;throw new Ic("Incorrect invocation")},Oc=C,kc=ze,Dc=d(Function.toString);Oc(kc.inspectSource)||(kc.inspectSource=function(e){return Dc(e)});var Pc=kc.inspectSource,jc=d,Lc=i,Mc=C,Uc=gs,Vc=Pc,Fc=function(){},Bc=re("Reflect","construct"),Gc=/^\s*(?:class|function)\b/,Wc=jc(Gc.exec),Hc=!Gc.test(Fc),Kc=function(e){if(!Mc(e))return!1;try{return Bc(Fc,[],e),!0}catch(e){return!1}},zc=function(e){if(!Mc(e))return!1;switch(Uc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Hc||!!Wc(Gc,Vc(e))}catch(e){return!0}};zc.sham=!0;var qc,Yc,Xc,Jc,Qc=!Bc||Lc(function(){var e;return Kc(Kc.call)||!Kc(Object)||!Kc(function(){e=!0})||e})?zc:Kc,Zc=Qc,$c=Ce,el=TypeError,tl=rn,nl=function(e){if(Zc(e))return e;throw new el($c(e)+" is not a constructor")},sl=K,il=mt("species"),rl=function(e,t){var n,s=tl(e).constructor;return void 0===s||sl(n=tl(s)[il])?t:nl(n)},al=d([].slice),ol=TypeError,cl=function(e,t){if(e<t)throw new ol("Not enough arguments");return e},ll=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),dl=p,ul=v,hl=Zt,pl=C,ml=et,fl=i,gl=Er,yl=al,vl=Rt,_l=cl,El=ll,bl=Js,xl=dl.setImmediate,wl=dl.clearImmediate,Sl=dl.process,Nl=dl.Dispatch,Tl=dl.Function,Cl=dl.MessageChannel,Rl=dl.String,Il=0,Al={},Ol="onreadystatechange";fl(function(){qc=dl.location});var kl=function(e){if(ml(Al,e)){var t=Al[e];delete Al[e],t()}},Dl=function(e){return function(){kl(e)}},Pl=function(e){kl(e.data)},jl=function(e){dl.postMessage(Rl(e),qc.protocol+"//"+qc.host)};xl&&wl||(xl=function(e){_l(arguments.length,1);var t=pl(e)?e:Tl(e),n=yl(arguments,1);return Al[++Il]=function(){ul(t,void 0,n)},Yc(Il),Il},wl=function(e){delete Al[e]},bl?Yc=function(e){Sl.nextTick(Dl(e))}:Nl&&Nl.now?Yc=function(e){Nl.now(Dl(e))}:Cl&&!El?(Jc=(Xc=new Cl).port2,Xc.port1.onmessage=Pl,Yc=hl(Jc.postMessage,Jc)):dl.addEventListener&&pl(dl.postMessage)&&!dl.importScripts&&qc&&"file:"!==qc.protocol&&!fl(jl)?(Yc=jl,dl.addEventListener("message",Pl,!1)):Yc=Ol in vl("script")?function(e){gl.appendChild(vl("script"))[Ol]=function(){gl.removeChild(this),kl(e)}}:function(e){setTimeout(Dl(e),0)});var Ll={set:xl,clear:wl},Ml=p,Ul=I,Vl=Object.getOwnPropertyDescriptor,Fl=function(e){if(!Ul)return Ml[e];var t=Vl(Ml,e);return t&&t.value},Bl=function(){this.head=null,this.tail=null};Bl.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Gl,Wl,Hl,Kl,zl,ql=Bl,Yl=/ipad|iphone|ipod/i.test(ce)&&"undefined"!=typeof Pebble,Xl=/web0s(?!.*chrome)/i.test(ce),Jl=p,Ql=Fl,Zl=Zt,$l=Ll.set,ed=ql,td=ll,nd=Yl,sd=Xl,id=Js,rd=Jl.MutationObserver||Jl.WebKitMutationObserver,ad=Jl.document,od=Jl.process,cd=Jl.Promise,ld=Ql("queueMicrotask");if(!ld){var dd=new ed,ud=function(){var e,t;for(id&&(e=od.domain)&&e.exit();t=dd.get();)try{t()}catch(e){throw dd.head&&Gl(),e}e&&e.enter()};td||id||sd||!rd||!ad?!nd&&cd&&cd.resolve?((Kl=cd.resolve(void 0)).constructor=cd,zl=Zl(Kl.then,Kl),Gl=function(){zl(ud)}):id?Gl=function(){od.nextTick(ud)}:($l=Zl($l,Jl),Gl=function(){$l(ud)}):(Wl=!0,Hl=ad.createTextNode(""),new rd(ud).observe(Hl,{characterData:!0}),Gl=function(){Hl.data=Wl=!Wl}),ld=function(e){dd.head||Gl(),dd.add(e)}}var hd=ld,pd=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},md=p.Promise,fd=p,gd=md,yd=C,vd=Yt,_d=Pc,Ed=mt,bd=Xs,xd=fe,wd=gd&&gd.prototype,Sd=Ed("species"),Nd=!1,Td=yd(fd.PromiseRejectionEvent),Cd=vd("Promise",function(){var e=_d(gd),t=e!==String(gd);if(!t&&66===xd)return!0;if(!wd.catch||!wd.finally)return!0;if(!xd||xd<51||!/native code/.test(e)){var n=new gd(function(e){e(1)}),s=function(e){e(function(){},function(){})};if((n.constructor={})[Sd]=s,!(Nd=n.then(function(){})instanceof s))return!0}return!(t||"BROWSER"!==bd&&"DENO"!==bd||Td)}),Rd={CONSTRUCTOR:Cd,REJECTION_EVENT:Td,SUBCLASSING:Nd},Id={},Ad=Oe,Od=TypeError,kd=function(e){var t,n;this.promise=new e(function(e,s){if(void 0!==t||void 0!==n)throw new Od("Bad Promise constructor");t=e,n=s}),this.resolve=Ad(t),this.reject=Ad(n)};Id.f=function(e){return new kd(e)};var Dd,Pd,jd=On,Ld=Js,Md=p,Ud=k,Vd=So,Fd=Wo,Bd=function(e){var t=Sc(e);Tc&&t&&!t[Cc]&&Nc(t,Cc,{configurable:!0,get:function(){return this}})},Gd=Oe,Wd=C,Hd=$,Kd=Ac,zd=rl,qd=Ll.set,Yd=hd,Xd=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}},Jd=pd,Qd=ql,Zd=go,$d=md,eu=Rd,tu=Id,nu="Promise",su=eu.CONSTRUCTOR,iu=eu.REJECTION_EVENT,ru=Zd.getterFor(nu),au=Zd.set,ou=$d&&$d.prototype,cu=$d,lu=ou,du=Md.TypeError,uu=Md.document,hu=Md.process,pu=tu.f,mu=pu,fu=!!(uu&&uu.createEvent&&Md.dispatchEvent),gu="unhandledrejection",yu=function(e){var t;return!(!Hd(e)||!Wd(t=e.then))&&t},vu=function(e,t){var n,s,i,r=t.value,a=1===t.state,o=a?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{o?(a||(2===t.rejection&&wu(t),t.rejection=1),!0===o?n=r:(d&&d.enter(),n=o(r),d&&(d.exit(),i=!0)),n===e.promise?l(new du("Promise-chain cycle")):(s=yu(n))?Ud(s,n,c,l):c(n)):l(r)}catch(e){d&&!i&&d.exit(),l(e)}},_u=function(e,t){e.notified||(e.notified=!0,Yd(function(){for(var n,s=e.reactions;n=s.get();)vu(n,e);e.notified=!1,t&&!e.rejection&&bu(e)}))},Eu=function(e,t,n){var s,i;fu?((s=uu.createEvent("Event")).promise=t,s.reason=n,s.initEvent(e,!1,!0),Md.dispatchEvent(s)):s={promise:t,reason:n},!iu&&(i=Md["on"+e])?i(s):e===gu&&Xd("Unhandled promise rejection",n)},bu=function(e){Ud(qd,Md,function(){var t,n=e.facade,s=e.value;if(xu(e)&&(t=Jd(function(){Ld?hu.emit("unhandledRejection",s,n):Eu(gu,n,s)}),e.rejection=Ld||xu(e)?2:1,t.error))throw t.value})},xu=function(e){return 1!==e.rejection&&!e.parent},wu=function(e){Ud(qd,Md,function(){var t=e.facade;Ld?hu.emit("rejectionHandled",t):Eu("rejectionhandled",t,e.value)})},Su=function(e,t,n){return function(s){e(t,s,n)}},Nu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,_u(e,!0))},Tu=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new du("Promise can't be resolved itself");var s=yu(t);s?Yd(function(){var n={done:!1};try{Ud(s,t,Su(Tu,n,e),Su(Nu,n,e))}catch(t){Nu(n,t,e)}}):(e.value=t,e.state=1,_u(e,!1))}catch(t){Nu({done:!1},t,e)}}};su&&(lu=(cu=function(e){Kd(this,lu),Gd(e),Ud(Dd,this);var t=ru(this);try{e(Su(Tu,t),Su(Nu,t))}catch(e){Nu(t,e)}}).prototype,(Dd=function(e){au(this,{type:nu,done:!1,notified:!1,parent:!1,reactions:new Qd,rejection:!1,state:0,value:null})}).prototype=Vd(lu,"then",function(e,t){var n=ru(this),s=pu(zd(this,cu));return n.parent=!0,s.ok=!Wd(e)||e,s.fail=Wd(t)&&t,s.domain=Ld?hu.domain:void 0,0===n.state?n.reactions.add(s):Yd(function(){vu(s,n)}),s.promise}),Pd=function(){var e=new Dd,t=ru(e);this.promise=e,this.resolve=Su(Tu,t),this.reject=Su(Nu,t)},tu.f=pu=function(e){return e===cu||void 0===e?new Pd(e):mu(e)}),jd({global:!0,constructor:!0,wrap:!0,forced:su},{Promise:cu}),Fd(cu,nu,!1,!0),Bd(nu);var Cu=mt("iterator"),Ru=!1;try{var Iu=0,Au={next:function(){return{done:!!Iu++}},return:function(){Ru=!0}};Au[Cu]=function(){return this},Array.from(Au,function(){throw 2})}catch(e){}var Ou=md,ku=function(e,t){try{if(!t&&!Ru)return!1}catch(e){return!1}var n=!1;try{var s={};s[Cu]=function(){return{next:function(){return{done:n=!0}}}},e(s)}catch(e){}return n},Du=Rd.CONSTRUCTOR||!ku(function(e){Ou.all(e).then(void 0,function(){})}),Pu=k,ju=Oe,Lu=Id,Mu=pd,Uu=Ia;On({target:"Promise",stat:!0,forced:Du},{all:function(e){var t=this,n=Lu.f(t),s=n.resolve,i=n.reject,r=Mu(function(){var n=ju(t.resolve),r=[],a=0,o=1;Uu(e,function(e){var c=a++,l=!1;o++,Pu(n,t,e).then(function(e){l||(l=!0,r[c]=e,--o||s(r))},i)}),--o||s(r)});return r.error&&i(r.value),n.promise}});var Vu=On,Fu=Rd.CONSTRUCTOR;md&&md.prototype,Vu({target:"Promise",proto:!0,forced:Fu,real:!0},{catch:function(e){return this.then(void 0,e)}});var Bu=k,Gu=Oe,Wu=Id,Hu=pd,Ku=Ia;On({target:"Promise",stat:!0,forced:Du},{race:function(e){var t=this,n=Wu.f(t),s=n.reject,i=Hu(function(){var i=Gu(t.resolve);Ku(e,function(e){Bu(i,t,e).then(n.resolve,s)})});return i.error&&s(i.value),n.promise}});var zu=Id;On({target:"Promise",stat:!0,forced:Rd.CONSTRUCTOR},{reject:function(e){var t=zu.f(this);return(0,t.reject)(e),t.promise}});var qu=rn,Yu=$,Xu=Id,Ju=function(e,t){if(qu(e),Yu(t)&&t.constructor===e)return t;var n=Xu.f(e);return(0,n.resolve)(t),n.promise},Qu=On,Zu=md,$u=Rd.CONSTRUCTOR,eh=Ju,th=re("Promise"),nh=!$u;Qu({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return eh(nh&&this===th?Zu:this,e)}});var sh=k,ih=Oe,rh=Id,ah=pd,oh=Ia;On({target:"Promise",stat:!0,forced:Du},{allSettled:function(e){var t=this,n=rh.f(t),s=n.resolve,i=n.reject,r=ah(function(){var n=ih(t.resolve),i=[],r=0,a=1;oh(e,function(e){var o=r++,c=!1;a++,sh(n,t,e).then(function(e){c||(c=!0,i[o]={status:"fulfilled",value:e},--a||s(i))},function(e){c||(c=!0,i[o]={status:"rejected",reason:e},--a||s(i))})}),--a||s(i)});return r.error&&i(r.value),n.promise}});var ch=k,lh=Oe,dh=re,uh=Id,hh=pd,ph=Ia,mh="No one promise resolved";On({target:"Promise",stat:!0,forced:Du},{any:function(e){var t=this,n=dh("AggregateError"),s=uh.f(t),i=s.resolve,r=s.reject,a=hh(function(){var s=lh(t.resolve),a=[],o=0,c=1,l=!1;ph(e,function(e){var d=o++,u=!1;c++,ch(s,t,e).then(function(e){u||l||(l=!0,i(e))},function(e){u||l||(u=!0,a[d]=e,--c||r(new n(a,mh)))})}),--c||r(new n(a,mh))});return a.error&&r(a.value),s.promise}});var fh=On,gh=v,yh=al,vh=Id,_h=Oe,Eh=pd,bh=p.Promise,xh=!1;fh({target:"Promise",stat:!0,forced:!bh||!bh.try||Eh(function(){bh.try(function(e){xh=8===e},8)}).error||!xh},{try:function(e){var t=arguments.length>1?yh(arguments,1):[],n=vh.f(this),s=Eh(function(){return gh(_h(e),void 0,t)});return(s.error?n.reject:n.resolve)(s.value),n.promise}});var wh=Id;On({target:"Promise",stat:!0},{withResolvers:function(){var e=wh.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Sh=On,Nh=md,Th=i,Ch=re,Rh=C,Ih=rl,Ah=Ju,Oh=Nh&&Nh.prototype;Sh({target:"Promise",proto:!0,real:!0,forced:!!Nh&&Th(function(){Oh.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=Ih(this,Ch("Promise")),n=Rh(e);return this.then(n?function(n){return Ah(t,e()).then(function(){return n})}:e,n?function(n){return Ah(t,e()).then(function(){throw n})}:e)}});var kh=d,Dh=Ln,Ph=_s,jh=Y,Lh=kh("".charAt),Mh=kh("".charCodeAt),Uh=kh("".slice),Vh=function(e){return function(t,n){var s,i,r=Ph(jh(t)),a=Dh(n),o=r.length;return a<0||a>=o?e?"":void 0:(s=Mh(r,a))<55296||s>56319||a+1===o||(i=Mh(r,a+1))<56320||i>57343?e?Lh(r,a):s:e?Uh(r,a,a+2):i-56320+(s-55296<<10)+65536}},Fh={codeAt:Vh(!1),charAt:Vh(!0)},Bh=Fh.charAt,Gh=_s,Wh=go,Hh=hc,Kh=pc,zh="String Iterator",qh=Wh.set,Yh=Wh.getterFor(zh);Hh(String,"String",function(e){qh(this,{type:zh,string:Gh(e),index:0})},function(){var e,t=Yh(this),n=t.string,s=t.index;return s>=n.length?Kh(void 0,!0):(e=Bh(n,s),t.index+=e.length,Kh(e,!1))});var Xh=ee.Promise,Jh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Qh=p,Zh=Wo,$h=Yr;for(var ep in Jh)Zh(Qh[ep],ep),$h[ep]=$h.Array;var tp=Xh,np=s(tp),sp=es("Array","values"),ip=gs,rp=et,ap=u,op=sp,cp=Array.prototype,lp={DOMTokenList:!0,NodeList:!0},dp=function(e){var t=e.values;return e===cp||ap(cp,e)&&t===cp.values||rp(lp,ip(e))?op:t},up=s(dp),hp=Ce,pp=TypeError,mp=al,fp=Math.floor,gp=function(e,t){var n=e.length;if(n<8)for(var s,i,r=1;r<n;){for(i=r,s=e[r];i&&t(e[i-1],s)>0;)e[i]=e[--i];i!==r++&&(e[i]=s)}else for(var a=fp(n/2),o=gp(mp(e,0,a),t),c=gp(mp(e,a),t),l=o.length,d=c.length,u=0,h=0;u<l||h<d;)e[u+h]=u<l&&h<d?t(o[u],c[h])<=0?o[u++]:c[h++]:u<l?o[u++]:c[h++];return e},yp=gp,vp=ce.match(/firefox\/(\d+)/i),_p=!!vp&&+vp[1],Ep=/MSIE|Trident/.test(ce),bp=ce.match(/AppleWebKit\/(\d+)\./),xp=!!bp&&+bp[1],wp=On,Sp=d,Np=Oe,Tp=Qe,Cp=Kn,Rp=function(e,t){if(!delete e[t])throw new pp("Cannot delete property "+hp(t)+" of "+hp(e))},Ip=_s,Ap=i,Op=yp,kp=Hs,Dp=_p,Pp=Ep,jp=fe,Lp=xp,Mp=[],Up=Sp(Mp.sort),Vp=Sp(Mp.push),Fp=Ap(function(){Mp.sort(void 0)}),Bp=Ap(function(){Mp.sort(null)}),Gp=kp("sort"),Wp=!Ap(function(){if(jp)return jp<70;if(!(Dp&&Dp>3)){if(Pp)return!0;if(Lp)return Lp<603;var e,t,n,s,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(s=0;s<47;s++)Mp.push({k:t+s,v:n})}for(Mp.sort(function(e,t){return t.v-e.v}),s=0;s<Mp.length;s++)t=Mp[s].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}});wp({target:"Array",proto:!0,forced:Fp||!Bp||!Gp||!Wp},{sort:function(e){void 0!==e&&Np(e);var t=Tp(this);if(Wp)return void 0===e?Up(t):Up(t,e);var n,s,i=[],r=Cp(t);for(s=0;s<r;s++)s in t&&Vp(i,t[s]);for(Op(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Ip(t)>Ip(n)?1:-1}}(e)),n=Cp(i),s=0;s<n;)t[s]=i[s++];for(;s<r;)Rp(t,s++);return t}});var Hp=es("Array","sort"),Kp=u,zp=Hp,qp=Array.prototype,Yp=function(e){var t=e.sort;return e===qp||Kp(qp,e)&&t===qp.sort?zp:t},Xp=s(Yp),Jp=On,Qp=d,Zp=Fn,$p=RangeError,em=String.fromCharCode,tm=String.fromCodePoint,nm=Qp([].join);Jp({target:"String",stat:!0,arity:1,forced:!!tm&&1!==tm.length},{fromCodePoint:function(e){for(var t,n=[],s=arguments.length,i=0;s>i;){if(t=+arguments[i++],Zp(t,1114111)!==t)throw new $p(t+" is not a valid code point");n[i]=t<65536?em(t):em(55296+((t-=65536)>>10),t%1024+56320)}return nm(n,"")}});var sm=i,im=mt("iterator"),rm=!sm(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),s="";return e.pathname="c%20d",t.forEach(function(e,n){t.delete("b"),s+=n+e}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[im]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("https://a#\u0431").hash||"a1c3"!==s||"x"!==new URL("https://x",void 0).host}),am=So,om=On,cm=p,lm=Fl,dm=re,um=k,hm=d,pm=I,mm=rm,fm=So,gm=wc,ym=function(e,t,n){for(var s in t)n&&n.unsafe&&e[s]?e[s]=t[s]:am(e,s,t[s],n);return e},vm=Wo,_m=Jo,Em=go,bm=Ac,xm=C,wm=et,Sm=Zt,Nm=gs,Tm=rn,Cm=$,Rm=_s,Im=Pr,Am=V,Om=ua,km=ia,Dm=pc,Pm=cl,jm=yp,Lm=mt("iterator"),Mm="URLSearchParams",Um=Mm+"Iterator",Vm=Em.set,Fm=Em.getterFor(Mm),Bm=Em.getterFor(Um),Gm=lm("fetch"),Wm=lm("Request"),Hm=lm("Headers"),Km=Wm&&Wm.prototype,zm=Hm&&Hm.prototype,qm=cm.TypeError,Ym=cm.encodeURIComponent,Xm=String.fromCharCode,Jm=dm("String","fromCodePoint"),Qm=parseInt,Zm=hm("".charAt),$m=hm([].join),ef=hm([].push),tf=hm("".replace),nf=hm([].shift),sf=hm([].splice),rf=hm("".split),af=hm("".slice),of=hm(/./.exec),cf=/\+/g,lf=/^[0-9a-f]+$/i,df=function(e,t){var n=af(e,t,t+2);return of(lf,n)?Qm(n,16):NaN},uf=function(e){for(var t=0,n=128;n>0&&0!=(e&n);n>>=1)t++;return t},hf=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},pf=function(e){for(var t=(e=tf(e,cf," ")).length,n="",s=0;s<t;){var i=Zm(e,s);if("%"===i){if("%"===Zm(e,s+1)||s+3>t){n+="%",s++;continue}var r=df(e,s+1);if(r!=r){n+=i,s++;continue}s+=2;var a=uf(r);if(0===a)i=Xm(r);else{if(1===a||a>4){n+="\ufffd",s++;continue}for(var o=[r],c=1;c<a&&!(3+ ++s>t||"%"!==Zm(e,s));){var l=df(e,s+1);if(l!=l){s+=3;break}if(l>191||l<128)break;ef(o,l),s+=2,c++}if(o.length!==a){n+="\ufffd";continue}var d=hf(o);null===d?n+="\ufffd":i=Jm(d)}}n+=i,s++}return n},mf=/[!'()~]|%20/g,ff={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},gf=function(e){return ff[e]},yf=function(e){return tf(Ym(e),mf,gf)},vf=_m(function(e,t){Vm(this,{type:Um,target:Fm(e).entries,index:0,kind:t})},Mm,function(){var e=Bm(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Dm(void 0,!0);var s=t[n];switch(e.kind){case"keys":return Dm(s.key,!1);case"values":return Dm(s.value,!1)}return Dm([s.key,s.value],!1)},!0),_f=function(e){this.entries=[],this.url=null,void 0!==e&&(Cm(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Zm(e,0)?af(e,1):e:Rm(e)))};_f.prototype={type:Mm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,s,i,r,a,o,c=this.entries,l=km(e);if(l)for(n=(t=Om(e,l)).next;!(s=um(n,t)).done;){if(r=(i=Om(Tm(s.value))).next,(a=um(r,i)).done||(o=um(r,i)).done||!um(r,i).done)throw new qm("Expected sequence with length 2");ef(c,{key:Rm(a.value),value:Rm(o.value)})}else for(var d in e)wm(e,d)&&ef(c,{key:d,value:Rm(e[d])})},parseQuery:function(e){if(e)for(var t,n,s=this.entries,i=rf(e,"&"),r=0;r<i.length;)(t=i[r++]).length&&(n=rf(t,"="),ef(s,{key:pf(nf(n)),value:pf($m(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],s=0;s<t.length;)e=t[s++],ef(n,yf(e.key)+"="+yf(e.value));return $m(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ef=function(){bm(this,bf);var e=Vm(this,new _f(arguments.length>0?arguments[0]:void 0));pm||(this.size=e.entries.length)},bf=Ef.prototype;if(ym(bf,{append:function(e,t){var n=Fm(this);Pm(arguments.length,2),ef(n.entries,{key:Rm(e),value:Rm(t)}),pm||this.length++,n.updateURL()},delete:function(e){for(var t=Fm(this),n=Pm(arguments.length,1),s=t.entries,i=Rm(e),r=n<2?void 0:arguments[1],a=void 0===r?r:Rm(r),o=0;o<s.length;){var c=s[o];if(c.key!==i||void 0!==a&&c.value!==a)o++;else if(sf(s,o,1),void 0!==a)break}pm||(this.size=s.length),t.updateURL()},get:function(e){var t=Fm(this).entries;Pm(arguments.length,1);for(var n=Rm(e),s=0;s<t.length;s++)if(t[s].key===n)return t[s].value;return null},getAll:function(e){var t=Fm(this).entries;Pm(arguments.length,1);for(var n=Rm(e),s=[],i=0;i<t.length;i++)t[i].key===n&&ef(s,t[i].value);return s},has:function(e){for(var t=Fm(this).entries,n=Pm(arguments.length,1),s=Rm(e),i=n<2?void 0:arguments[1],r=void 0===i?i:Rm(i),a=0;a<t.length;){var o=t[a++];if(o.key===s&&(void 0===r||o.value===r))return!0}return!1},set:function(e,t){var n=Fm(this);Pm(arguments.length,1);for(var s,i=n.entries,r=!1,a=Rm(e),o=Rm(t),c=0;c<i.length;c++)(s=i[c]).key===a&&(r?sf(i,c--,1):(r=!0,s.value=o));r||ef(i,{key:a,value:o}),pm||(this.size=i.length),n.updateURL()},sort:function(){var e=Fm(this);jm(e.entries,function(e,t){return e.key>t.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Fm(this).entries,s=Sm(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)s((t=n[i++]).value,t.key,this)},keys:function(){return new vf(this,"keys")},values:function(){return new vf(this,"values")},entries:function(){return new vf(this,"entries")}},{enumerable:!0}),fm(bf,Lm,bf.entries,{name:"entries"}),fm(bf,"toString",function(){return Fm(this).serialize()},{enumerable:!0}),pm&&gm(bf,"size",{get:function(){return Fm(this).entries.length},configurable:!0,enumerable:!0}),vm(Ef,Mm),om({global:!0,constructor:!0,forced:!mm},{URLSearchParams:Ef}),!mm&&xm(Hm)){var xf=hm(zm.has),wf=hm(zm.set),Sf=function(e){if(Cm(e)){var t,n=e.body;if(Nm(n)===Mm)return t=e.headers?new Hm(e.headers):new Hm,xf(t,"content-type")||wf(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Im(e,{body:Am(0,Rm(n)),headers:Am(0,t)})}return e};if(xm(Gm)&&om({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Gm(e,arguments.length>1?Sf(arguments[1]):{})}}),xm(Wm)){var Nf=function(e){return bm(this,Km),new Wm(e,arguments.length>1?Sf(arguments[1]):{})};Km.constructor=Nf,Nf.prototype=Km,om({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Nf})}}var Tf,Cf={URLSearchParams:Ef,getState:Fm},Rf=ee.URLSearchParams,If=I,Af=d,Of=k,kf=i,Df=hr,Pf=Zi,jf=D,Lf=Qe,Mf=H,Uf=Object.assign,Vf=Object.defineProperty,Ff=Af([].concat),Bf=!Uf||kf(function(){if(If&&1!==Uf({b:1},Uf(Vf({},"a",{enumerable:!0,get:function(){Vf(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),s="abcdefghijklmnopqrst";return e[n]=7,s.split("").forEach(function(e){t[e]=e}),7!==Uf({},e)[n]||Df(Uf({},t)).join("")!==s})?function(e,t){for(var n=Lf(e),s=arguments.length,i=1,r=Pf.f,a=jf.f;s>i;)for(var o,c=Mf(arguments[i++]),l=r?Ff(Df(c),r(c)):Df(c),d=l.length,u=0;d>u;)o=l[u++],If&&!Of(a,c,o)||(n[o]=c[o]);return n}:Uf,Gf=rn,Wf=fa,Hf=I,Kf=$t,zf=V,qf=function(e,t,n){Hf?Kf.f(e,t,zf(0,n)):e[t]=n},Yf=Zt,Xf=k,Jf=Qe,Qf=function(e,t,n,s){try{return s?t(Gf(n)[0],n[1]):t(n)}catch(t){Wf(e,"throw",t)}},Zf=Zr,$f=Qc,eg=Kn,tg=qf,ng=ua,sg=ia,ig=Array,rg=d,ag=2147483647,og=/[^\0-\u007E]/,cg=/[.\u3002\uFF0E\uFF61]/g,lg="Overflow: input needs wider integers to process",dg=RangeError,ug=rg(cg.exec),hg=Math.floor,pg=String.fromCharCode,mg=rg("".charCodeAt),fg=rg([].join),gg=rg([].push),yg=rg("".replace),vg=rg("".split),_g=rg("".toLowerCase),Eg=function(e){return e+22+75*(e<26)},bg=function(e,t,n){var s=0;for(e=n?hg(e/700):e>>1,e+=hg(e/t);e>455;)e=hg(e/35),s+=36;return hg(s+36*e/(e+38))},xg=function(e){var t=[];e=function(e){for(var t=[],n=0,s=e.length;n<s;){var i=mg(e,n++);if(i>=55296&&i<=56319&&n<s){var r=mg(e,n++);56320==(64512&r)?gg(t,((1023&i)<<10)+(1023&r)+65536):(gg(t,i),n--)}else gg(t,i)}return t}(e);var n,s,i=e.length,r=128,a=0,o=72;for(n=0;n<e.length;n++)(s=e[n])<128&&gg(t,pg(s));var c=t.length,l=c;for(c&&gg(t,"-");l<i;){var d=ag;for(n=0;n<e.length;n++)(s=e[n])>=r&&s<d&&(d=s);var u=l+1;if(d-r>hg((ag-a)/u))throw new dg(lg);for(a+=(d-r)*u,r=d,n=0;n<e.length;n++){if((s=e[n])<r&&++a>ag)throw new dg(lg);if(s===r){for(var h=a,p=36;;){var m=p<=o?1:p>=o+26?26:p-o;if(h<m)break;var f=h-m,g=36-m;gg(t,pg(Eg(m+f%g))),h=hg(f/g),p+=36}gg(t,pg(Eg(h))),o=bg(a,u,l===c),a=0,l++}}a++,r++}return fg(t,"")},wg=On,Sg=I,Ng=rm,Tg=p,Cg=Zt,Rg=d,Ig=So,Ag=wc,Og=Ac,kg=et,Dg=Bf,Pg=function(e){var t=Jf(e),n=$f(this),s=arguments.length,i=s>1?arguments[1]:void 0,r=void 0!==i;r&&(i=Yf(i,s>2?arguments[2]:void 0));var a,o,c,l,d,u,h=sg(t),p=0;if(!h||this===ig&&Zf(h))for(a=eg(t),o=n?new this(a):ig(a);a>p;p++)u=r?i(t[p],p):t[p],tg(o,p,u);else for(o=n?new this:[],d=(l=ng(t,h)).next;!(c=Xf(d,l)).done;p++)u=r?Qf(l,i,[c.value,p],!0):c.value,tg(o,p,u);return o.length=p,o},jg=al,Lg=Fh.codeAt,Mg=function(e){var t,n,s=[],i=vg(yg(_g(e),cg,"."),".");for(t=0;t<i.length;t++)n=i[t],gg(s,ug(og,n)?"xn--"+xg(n):n);return fg(s,".")},Ug=_s,Vg=Wo,Fg=cl,Bg=Cf,Gg=go,Wg=Gg.set,Hg=Gg.getterFor("URL"),Kg=Bg.URLSearchParams,zg=Bg.getState,qg=Tg.URL,Yg=Tg.TypeError,Xg=Tg.parseInt,Jg=Math.floor,Qg=Math.pow,Zg=Rg("".charAt),$g=Rg(/./.exec),ey=Rg([].join),ty=Rg(1..toString),ny=Rg([].pop),sy=Rg([].push),iy=Rg("".replace),ry=Rg([].shift),ay=Rg("".split),oy=Rg("".slice),cy=Rg("".toLowerCase),ly=Rg([].unshift),dy="Invalid scheme",uy="Invalid host",hy="Invalid port",py=/[a-z]/i,my=/[\d+-.a-z]/i,fy=/\d/,gy=/^0x/i,yy=/^[0-7]+$/,vy=/^\d+$/,_y=/^[\da-f]+$/i,Ey=/[\0\t\n\r #%/:<>?@[\\\]^|]/,by=/[\0\t\n\r #/:<>?@[\\\]^|]/,xy=/^[\u0000-\u0020]+/,wy=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Sy=/[\t\n\r]/g,Ny=function(e){var t,n,s,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)ly(t,e%256),e=Jg(e/256);return ey(t,".")}if("object"==typeof e){for(t="",s=function(e){for(var t=null,n=1,s=null,i=0,r=0;r<8;r++)0!==e[r]?(i>n&&(t=s,n=i),s=null,i=0):(null===s&&(s=r),++i);return i>n?s:t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),s===n?(t+=n?":":"::",i=!0):(t+=ty(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Ty={},Cy=Dg({},Ty,{" ":1,'"':1,"<":1,">":1,"`":1}),Ry=Dg({},Cy,{"#":1,"?":1,"{":1,"}":1}),Iy=Dg({},Ry,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ay=function(e,t){var n=Lg(e,0);return n>32&&n<127&&!kg(t,e)?e:encodeURIComponent(e)},Oy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ky=function(e,t){var n;return 2===e.length&&$g(py,Zg(e,0))&&(":"===(n=Zg(e,1))||!t&&"|"===n)},Dy=function(e){var t;return e.length>1&&ky(oy(e,0,2))&&(2===e.length||"/"===(t=Zg(e,2))||"\\"===t||"?"===t||"#"===t)},Py=function(e){return"."===e||"%2e"===cy(e)},jy={},Ly={},My={},Uy={},Vy={},Fy={},By={},Gy={},Wy={},Hy={},Ky={},zy={},qy={},Yy={},Xy={},Jy={},Qy={},Zy={},$y={},ev={},tv={},nv=function(e,t,n){var s,i,r,a=Ug(e);if(t){if(i=this.parse(a))throw new Yg(i);this.searchParams=null}else{if(void 0!==n&&(s=new nv(n,!0)),i=this.parse(a,null,s))throw new Yg(i);(r=zg(new Kg)).bindURL(this),this.searchParams=r}};nv.prototype={type:"URL",parse:function(e,t,n){var s,i,r,a,o,c=this,l=t||jy,d=0,u="",h=!1,p=!1,m=!1;for(e=Ug(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=iy(e,xy,""),e=iy(e,wy,"$1")),e=iy(e,Sy,""),s=Pg(e);d<=s.length;){switch(i=s[d],l){case jy:if(!i||!$g(py,i)){if(t)return dy;l=My;continue}u+=cy(i),l=Ly;break;case Ly:if(i&&($g(my,i)||"+"===i||"-"===i||"."===i))u+=cy(i);else{if(":"!==i){if(t)return dy;u="",l=My,d=0;continue}if(t&&(c.isSpecial()!==kg(Oy,u)||"file"===u&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&Oy[c.scheme]===c.port&&(c.port=null));u="","file"===c.scheme?l=Yy:c.isSpecial()&&n&&n.scheme===c.scheme?l=Uy:c.isSpecial()?l=Gy:"/"===s[d+1]?(l=Vy,d++):(c.cannotBeABaseURL=!0,sy(c.path,""),l=$y)}break;case My:if(!n||n.cannotBeABaseURL&&"#"!==i)return dy;if(n.cannotBeABaseURL&&"#"===i){c.scheme=n.scheme,c.path=jg(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=tv;break}l="file"===n.scheme?Yy:Fy;continue;case Uy:if("/"!==i||"/"!==s[d+1]){l=Fy;continue}l=Wy,d++;break;case Vy:if("/"===i){l=Hy;break}l=Zy;continue;case Fy:if(c.scheme=n.scheme,i===Tf)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=jg(n.path),c.query=n.query;else if("/"===i||"\\"===i&&c.isSpecial())l=By;else if("?"===i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=jg(n.path),c.query="",l=ev;else{if("#"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=jg(n.path),c.path.length--,l=Zy;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=jg(n.path),c.query=n.query,c.fragment="",l=tv}break;case By:if(!c.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=Zy;continue}l=Hy}else l=Wy;break;case Gy:if(l=Wy,"/"!==i||"/"!==Zg(u,d+1))continue;d++;break;case Wy:if("/"!==i&&"\\"!==i){l=Hy;continue}break;case Hy:if("@"===i){h&&(u="%40"+u),h=!0,r=Pg(u);for(var f=0;f<r.length;f++){var g=r[f];if(":"!==g||m){var y=Ay(g,Iy);m?c.password+=y:c.username+=y}else m=!0}u=""}else if(i===Tf||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(h&&""===u)return"Invalid authority";d-=Pg(u).length+1,u="",l=Ky}else u+=i;break;case Ky:case zy:if(t&&"file"===c.scheme){l=Jy;continue}if(":"!==i||p){if(i===Tf||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(c.isSpecial()&&""===u)return uy;if(t&&""===u&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(u))return a;if(u="",l=Qy,t)return;continue}"["===i?p=!0:"]"===i&&(p=!1),u+=i}else{if(""===u)return uy;if(a=c.parseHost(u))return a;if(u="",l=qy,t===zy)return}break;case qy:if(!$g(fy,i)){if(i===Tf||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()||t){if(""!==u){var v=Xg(u,10);if(v>65535)return hy;c.port=c.isSpecial()&&v===Oy[c.scheme]?null:v,u=""}if(t)return;l=Qy;continue}return hy}u+=i;break;case Yy:if(c.scheme="file","/"===i||"\\"===i)l=Xy;else{if(!n||"file"!==n.scheme){l=Zy;continue}switch(i){case Tf:c.host=n.host,c.path=jg(n.path),c.query=n.query;break;case"?":c.host=n.host,c.path=jg(n.path),c.query="",l=ev;break;case"#":c.host=n.host,c.path=jg(n.path),c.query=n.query,c.fragment="",l=tv;break;default:Dy(ey(jg(s,d),""))||(c.host=n.host,c.path=jg(n.path),c.shortenPath()),l=Zy;continue}}break;case Xy:if("/"===i||"\\"===i){l=Jy;break}n&&"file"===n.scheme&&!Dy(ey(jg(s,d),""))&&(ky(n.path[0],!0)?sy(c.path,n.path[0]):c.host=n.host),l=Zy;continue;case Jy:if(i===Tf||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&ky(u))l=Zy;else if(""===u){if(c.host="",t)return;l=Qy}else{if(a=c.parseHost(u))return a;if("localhost"===c.host&&(c.host=""),t)return;u="",l=Qy}continue}u+=i;break;case Qy:if(c.isSpecial()){if(l=Zy,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==Tf&&(l=Zy,"/"!==i))continue}else c.fragment="",l=tv;else c.query="",l=ev;break;case Zy:if(i===Tf||"/"===i||"\\"===i&&c.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(o=cy(o=u))||"%2e."===o||".%2e"===o||"%2e%2e"===o?(c.shortenPath(),"/"===i||"\\"===i&&c.isSpecial()||sy(c.path,"")):Py(u)?"/"===i||"\\"===i&&c.isSpecial()||sy(c.path,""):("file"===c.scheme&&!c.path.length&&ky(u)&&(c.host&&(c.host=""),u=Zg(u,0)+":"),sy(c.path,u)),u="","file"===c.scheme&&(i===Tf||"?"===i||"#"===i))for(;c.path.length>1&&""===c.path[0];)ry(c.path);"?"===i?(c.query="",l=ev):"#"===i&&(c.fragment="",l=tv)}else u+=Ay(i,Ry);break;case $y:"?"===i?(c.query="",l=ev):"#"===i?(c.fragment="",l=tv):i!==Tf&&(c.path[0]+=Ay(i,Ty));break;case ev:t||"#"!==i?i!==Tf&&("'"===i&&c.isSpecial()?c.query+="%27":c.query+="#"===i?"%23":Ay(i,Ty)):(c.fragment="",l=tv);break;case tv:i!==Tf&&(c.fragment+=Ay(i,Cy))}d++}},parseHost:function(e){var t,n,s;if("["===Zg(e,0)){if("]"!==Zg(e,e.length-1))return uy;if(t=function(e){var t,n,s,i,r,a,o,c=[0,0,0,0,0,0,0,0],l=0,d=null,u=0,h=function(){return Zg(e,u)};if(":"===h()){if(":"!==Zg(e,1))return;u+=2,d=++l}for(;h();){if(8===l)return;if(":"!==h()){for(t=n=0;n<4&&$g(_y,h());)t=16*t+Xg(h(),16),u++,n++;if("."===h()){if(0===n)return;if(u-=n,l>6)return;for(s=0;h();){if(i=null,s>0){if(!("."===h()&&s<4))return;u++}if(!$g(fy,h()))return;for(;$g(fy,h());){if(r=Xg(h(),10),null===i)i=r;else{if(0===i)return;i=10*i+r}if(i>255)return;u++}c[l]=256*c[l]+i,2!=++s&&4!==s||l++}if(4!==s)return;break}if(":"===h()){if(u++,!h())return}else if(h())return;c[l++]=t}else{if(null!==d)return;u++,d=++l}}if(null!==d)for(a=l-d,l=7;0!==l&&a>0;)o=c[l],c[l--]=c[d+a-1],c[d+--a]=o;else if(8!==l)return;return c}(oy(e,1,-1)),!t)return uy;this.host=t}else if(this.isSpecial()){if(e=Mg(e),$g(Ey,e))return uy;if(t=function(e){var t,n,s,i,r,a,o,c=ay(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],s=0;s<t;s++){if(""===(i=c[s]))return e;if(r=10,i.length>1&&"0"===Zg(i,0)&&(r=$g(gy,i)?16:8,i=oy(i,8===r?1:2)),""===i)a=0;else{if(!$g(10===r?vy:8===r?yy:_y,i))return e;a=Xg(i,r)}sy(n,a)}for(s=0;s<t;s++)if(a=n[s],s===t-1){if(a>=Qg(256,5-t))return null}else if(a>255)return null;for(o=ny(n),s=0;s<n.length;s++)o+=n[s]*Qg(256,3-s);return o}(e),null===t)return uy;this.host=t}else{if($g(by,e))return uy;for(t="",n=Pg(e),s=0;s<n.length;s++)t+=Ay(n[s],Ty);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return kg(Oy,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&ky(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,s=e.password,i=e.host,r=e.port,a=e.path,o=e.query,c=e.fragment,l=t+":";return null!==i?(l+="//",e.includesCredentials()&&(l+=n+(s?":"+s:"")+"@"),l+=Ny(i),null!==r&&(l+=":"+r)):"file"===t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+ey(a,"/"):"",null!==o&&(l+="?"+o),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw new Yg(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new sv(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+Ny(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ug(e)+":",jy)},getUsername:function(){return this.username},setUsername:function(e){var t=Pg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Ay(t[n],Iy)}},getPassword:function(){return this.password},setPassword:function(e){var t=Pg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Ay(t[n],Iy)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Ny(e):Ny(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Ky)},getHostname:function(){var e=this.host;return null===e?"":Ny(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,zy)},getPort:function(){var e=this.port;return null===e?"":Ug(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=Ug(e))?this.port=null:this.parse(e,qy))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ey(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Qy))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=Ug(e))?this.query=null:("?"===Zg(e,0)&&(e=oy(e,1)),this.query="",this.parse(e,ev)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=Ug(e))?("#"===Zg(e,0)&&(e=oy(e,1)),this.fragment="",this.parse(e,tv)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var sv=function(e){var t=Og(this,iv),n=Fg(arguments.length,1)>1?arguments[1]:void 0,s=Wg(t,new nv(e,!1,n));Sg||(t.href=s.serialize(),t.origin=s.getOrigin(),t.protocol=s.getProtocol(),t.username=s.getUsername(),t.password=s.getPassword(),t.host=s.getHost(),t.hostname=s.getHostname(),t.port=s.getPort(),t.pathname=s.getPathname(),t.search=s.getSearch(),t.searchParams=s.getSearchParams(),t.hash=s.getHash())},iv=sv.prototype,rv=function(e,t){return{get:function(){return Hg(this)[e]()},set:t&&function(e){return Hg(this)[t](e)},configurable:!0,enumerable:!0}};if(Sg&&(Ag(iv,"href",rv("serialize","setHref")),Ag(iv,"origin",rv("getOrigin")),Ag(iv,"protocol",rv("getProtocol","setProtocol")),Ag(iv,"username",rv("getUsername","setUsername")),Ag(iv,"password",rv("getPassword","setPassword")),Ag(iv,"host",rv("getHost","setHost")),Ag(iv,"hostname",rv("getHostname","setHostname")),Ag(iv,"port",rv("getPort","setPort")),Ag(iv,"pathname",rv("getPathname","setPathname")),Ag(iv,"search",rv("getSearch","setSearch")),Ag(iv,"searchParams",rv("getSearchParams")),Ag(iv,"hash",rv("getHash","setHash"))),Ig(iv,"toJSON",function(){return Hg(this).serialize()},{enumerable:!0}),Ig(iv,"toString",function(){return Hg(this).serialize()},{enumerable:!0}),qg){var av=qg.createObjectURL,ov=qg.revokeObjectURL;av&&Ig(sv,"createObjectURL",Cg(av,qg)),ov&&Ig(sv,"revokeObjectURL",Cg(ov,qg))}Vg(sv,"URL"),wg({global:!0,constructor:!0,forced:!Ng,sham:!Sg},{URL:sv});var cv=On,lv=i,dv=cl,uv=_s,hv=rm,pv=re("URL"),mv=hv&&lv(function(){pv.canParse()}),fv=lv(function(){return 1!==pv.canParse.length});cv({target:"URL",stat:!0,forced:!mv||fv},{canParse:function(e){var t=dv(arguments.length,1),n=uv(e),s=t<2||void 0===arguments[1]?void 0:uv(arguments[1]);try{return!!new pv(n,s)}catch(e){return!1}}});var gv=On,yv=cl,vv=_s,_v=rm,Ev=re("URL");gv({target:"URL",stat:!0,forced:!_v},{parse:function(e){var t=yv(arguments.length,1),n=vv(e),s=t<2||void 0===arguments[1]?void 0:vv(arguments[1]);try{return new Ev(n,s)}catch(e){return null}}});var bv=s(ee.URL);let xv=!0,wv=!0;function Sv(e,t,n){const s=e.match(t);return s&&s.length>=n&&parseInt(s[n],10)}function Nv(e,t,n){if(!e.RTCPeerConnection)return;const s=e.RTCPeerConnection.prototype,i=s.addEventListener;s.addEventListener=function(e,s){if(e!==t)return i.apply(this,arguments);const r=e=>{const t=n(e);t&&(s.handleEvent?s.handleEvent(t):s(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(s,r),i.apply(this,[e,r])};const r=s.removeEventListener;s.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(n))return r.apply(this,arguments);const s=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,r.apply(this,[e,s])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Tv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(xv=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Cv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(wv=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Rv(){if("object"==typeof window){if(xv)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Iv(e,t){wv&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Av(e){return"[object Object]"===Object.prototype.toString.call(e)}function Ov(e){var t;return Av(e)?ii(t=Object.keys(e)).call(t,function(t,n){const s=Av(e[n]),i=s?Ov(e[n]):e[n],r=s&&!Object.keys(i).length;return void 0===i||r?t:Object.assign(t,{[n]:i})},{}):e}function kv(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(s=>{s.endsWith("Id")?kv(e,e.get(t[s]),n):s.endsWith("Ids")&&t[s].forEach(t=>{kv(e,e.get(t),n)})}))}function Dv(e,t,n){const s=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const r=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&r.push(e)}),r.forEach(t=>{e.forEach(n=>{n.type===s&&n.trackId===t.id&&kv(e,n,i)})}),i}const Pv=Rv;function jv(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const s=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const s="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==s.exact&&"number"==typeof s.exact&&(s.min=s.max=s.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==s.ideal){t.optional=t.optional||[];let e={};"number"==typeof s.ideal?(e[i("min",n)]=s.ideal,t.optional.push(e),e={},e[i("max",n)]=s.ideal,t.optional.push(e)):(e[i("",n)]=s.ideal,t.optional.push(e))}void 0!==s.exact&&"number"!=typeof s.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=s.exact):["min","max"].forEach(e=>{void 0!==s[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=s[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"==typeof e.video){let r=e.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});const a=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===r.exact||"environment"===r.ideal?t=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{n=n.filter(e=>"videoinput"===e.kind);let a=n.find(e=>t.some(t=>{var n;return Ps(n=e.label.toLowerCase()).call(n,t)}));return!a&&n.length&&Ps(t).call(t,"back")&&(a=n[n.length-1]),a&&(e.video.deviceId=r.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=s(e.video),Pv("chrome: "+JSON.stringify(e)),i(e)})}e.video=s(e.video)}return Pv("chrome: "+JSON.stringify(e)),i(e)},r=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,s){i(e,e=>{n.webkitGetUserMedia(e,t,e=>{s&&s(r(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>np.reject(r(e))))}}}function Lv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Mv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=s,i.transceiver={receiver:s},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=s,i.transceiver={receiver:s},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Nv(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Uv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,s){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){s.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,s]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},r=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const s=function(e){n(r(i(e)))};return t.apply(this,[s,e])}return new np((e,n)=>{t.apply(this,[function(t){e(r(i(t)))},n])}).then(n,s)}}function Fv(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Dv(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Nv(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Dv(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,s;return this.getSenders().forEach(n=>{n.track===e&&(t?s=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?s=!0:n=t),t.track===e)),s||t&&n?np.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():np.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Bv(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const s=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(s)&&this._shimmedLocalStreams[n.id].push(s):this._shimmedLocalStreams[n.id]=[n,s],s};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const s=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(s)};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],s.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function Gv(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Bv(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}s.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function r(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const s=e._reverseStreams[t],i=e._streams[s.id];n=n.replace(new RegExp(i.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const s=[].slice.call(arguments,1);if(1!==s.length||!s[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),np.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const s=new e.MediaStream([t]);this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],s={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=r(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>r(this,e))}};e.RTCPeerConnection.prototype[t]=s[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const s=e._reverseStreams[t],i=e._streams[s.id];n=n.replace(new RegExp(s.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:r(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wv(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=s[t]})}function Hv(e,t){Nv(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var Kv=Object.freeze({__proto__:null,fixNegotiationNeeded:Hv,shimAddTrackRemoveTrack:Gv,shimAddTrackRemoveTrackWithNative:Bv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const s=n.video&&n.video.width,i=n.video&&n.video.height,r=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:r||3}},s&&(n.video.mandatory.maxWidth=s),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Uv,shimGetStats:Vv,shimGetUserMedia:jv,shimMediaStream:Lv,shimOnTrack:Mv,shimPeerConnection:Wv,shimSenderReceiverGetStats:Fv});function zv(e,t){const n=e&&e.navigator,s=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,s){Iv("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,s)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},s&&s.prototype.getSettings){const t=s.prototype.getSettings;s.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(s&&s.prototype.applyConstraints){const t=s.prototype.applyConstraints;s.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function qv(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Yv(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=s[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,r]=arguments;return s.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,s)=>{e.set(s,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,r)}}function Xv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):np.resolve(new Map)}}function Jv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Nv(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Qv(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Iv("removeStream","removeTrack"),this.getSenders().forEach(t=>{var n;t.track&&Ps(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function Zv(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $v(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(n){const{sender:t}=s,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return s})}function e_(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function t_(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function n_(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var s_=Object.freeze({__proto__:null,shimAddTransceiver:$v,shimCreateAnswer:n_,shimCreateOffer:t_,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,np.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:e_,shimGetUserMedia:zv,shimOnTrack:qv,shimPeerConnection:Yv,shimRTCDataChannel:Zv,shimReceiverGetStats:Jv,shimRemoveStream:Qv,shimSenderGetStats:Xv});function i_(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Ps(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return s&&s.forEach(e=>{var t;this._localStreams?Ps(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{Ps(n).call(n,e.track)&&this.removeTrack(e)})})}}function r_(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Ps(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function a_(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,s=t.createAnswer,i=t.setLocalDescription,r=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const s=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[s]);return t?(i.then(e,t),np.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=s.apply(this,[n]);return t?(i.then(e,t),np.resolve()):i};let o=function(e,t,n){const s=i.apply(this,[e]);return n?(s.then(t,n),np.resolve()):s};t.setLocalDescription=o,o=function(e,t,n){const s=r.apply(this,[e]);return n?(s.then(t,n),np.resolve()):s},t.setRemoteDescription=o,o=function(e,t,n){const s=a.apply(this,[e]);return n?(s.then(t,n),np.resolve()):s},t.addIceCandidate=o}function o_(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(c_(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,s){t.mediaDevices.getUserMedia(e).then(n,s)}.bind(t))}function c_(e){return e&&void 0!==e.video?Object.assign({},e,{video:Ov(e.video)}):e}function l_(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let s=e.iceServers[n];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(Iv("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,t.push(s)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function d_(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function u_(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function h_(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var p_=Object.freeze({__proto__:null,shimAudioContext:h_,shimCallbacksAPI:a_,shimConstraints:c_,shimCreateOfferLegacy:u_,shimGetUserMedia:o_,shimLocalStreamsAPI:i_,shimRTCIceServerUrls:l_,shimRemoteStreamsAPI:r_,shimTrackEventTransceiver:d_}),m_="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",f_=Y,g_=_s,y_=m_,v_=d("".replace),__=RegExp("^["+y_+"]+"),E_=RegExp("(^|[^"+y_+"])["+y_+"]+$"),b_=function(e){return function(t){var n=g_(f_(t));return 1&e&&(n=v_(n,__,"")),2&e&&(n=v_(n,E_,"$1")),n}},x_={start:b_(1),end:b_(2),trim:b_(3)},w_=xo.PROPER,S_=i,N_=m_,T_=x_.trim;On({target:"String",proto:!0,forced:function(e){return S_(function(){return!!N_[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||w_&&N_[e].name!==e})}("trim")},{trim:function(){return T_(this)}});var C_=es("String","trim"),R_=u,I_=C_,A_=String.prototype,O_=function(e){var t=e.trim;return"string"==typeof e||e===A_||R_(A_,e)&&t===A_.trim?I_:t},k_=s(O_),D_={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let s=8;s<t.length;s+=2)switch(t[s]){case"raddr":n.relatedAddress=t[s+1];break;case"rport":n.relatedPort=parseInt(t[s+1],10);break;case"tcptype":n.tcpType=t[s+1];break;case"ufrag":n.ufrag=t[s+1],n.usernameFragment=t[s+1];break;default:void 0===n[t[s]]&&(n[t[s]]=t[s+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const s=e.type;return t.push("typ"),t.push(s),"host"!==s&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const s=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<s.length;i++)n=s[i].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const s=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?s.push(t+"="+e.parameters[t]):s.push(t)}),t+="a=fmtp:"+n+" "+s.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},s=e.indexOf(":",t);return s>-1?(n.attribute=e.substring(t+1,s),n.value=e.substring(s+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const s=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(e)[0].split(" ");n.profile=s[2];for(let r=3;r<s.length;r++){const i=s[r],a=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){const s=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=r.length?t.parseFmtp(r[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{i.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let s="";s+="m="+e+" ",s+=n.codecs.length>0?"9":"0",s+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",s+="c=IN IP4 0.0.0.0\r\n",s+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{s+=t.writeRtpMap(e),s+=t.writeFmtp(e),s+=t.writeRtcpFb(e)});let i=0;return n.codecs.forEach(e=>{e.maxptime>i&&(i=e.maxptime)}),i>0&&(s+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{s+=t.writeExtmap(e)}),s},t.parseRtpEncodingParameters=function(e){const n=[],s=t.parseRtpParameters(e),i=-1!==s.fecMechanisms.indexOf("RED"),r=-1!==s.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),o=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===o&&(c=l[0][1]),s.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:r?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&o&&n.push({ssrc:o});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=d})),n},t.parseRtcpParameters=function(e){const n={},s=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];s&&(n.cname=s.value,n.ssrc=s.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const r=t.matchPrefix(e,"a=rtcp-mux");return n.mux=r.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const s=t.matchPrefix(e,"a=msid:");if(1===s.length)return n=s[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),s=t.matchPrefix(e,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const r=t.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,s){let i;const r=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(s||"thisisadapterortc")+" "+i+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const s=t.splitLines(e);for(let t=0;t<s.length;t++)switch(s[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(D_);var P_=D_.exports,j_=s(P_),L_=e({__proto__:null,default:j_},[P_]);function M_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),s=j_.parseCandidate(e.candidate),i=Object.assign(n,s);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Nv(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function U_(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Nv(e,"icecandidate",e=>{if(e.candidate){const t=j_.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function V_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=j_.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=j_.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},s=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},r=function(e,n){let s=65536;"firefox"===t.browser&&57===t.version&&(s=65535);const i=j_.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?s=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(s=2147483637),s},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=s(arguments[0]),t=i(e),n=r(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>a}),this._sctp=o}return a.apply(this,arguments)}}function F_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const s=arguments[0],i=s.length||s.size||s.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Nv(e,"datachannel",e=>(t(e.channel,e.target),e))}function B_(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function G_(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==k_(e).call(e)).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function W_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?np.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),np.resolve())})}function H_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var K_=Object.freeze({__proto__:null,removeExtmapAllowMixed:G_,shimAddIceCandidateNullOrEmpty:W_,shimConnectionState:B_,shimMaxMessageSize:V_,shimParameterlessSetLocalDescription:H_,shimRTCIceCandidate:M_,shimRTCIceCandidateRelayProtocol:U_,shimSendThrowTypeError:F_});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Rv,s=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Sv(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Sv(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Sv(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:s,commonShim:K_,extractVersion:Sv,disableLog:Tv,disableWarnings:Cv,sdp:L_};switch(s.browser){case"chrome":if(!Kv||!Wv||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===s.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Kv,W_(e,s),H_(e),jv(e,s),Lv(e),Wv(e,s),Mv(e),Gv(e,s),Uv(e),Vv(e),Fv(e),Hv(e,s),M_(e),U_(e),B_(e),V_(e,s),F_(e),G_(e,s);break;case"firefox":if(!s_||!Yv||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=s_,W_(e,s),H_(e),zv(e,s),Yv(e,s),qv(e),Qv(e),Xv(e),Jv(e),Zv(e),$v(e),e_(e),t_(e),n_(e),M_(e),B_(e),V_(e,s),F_(e);break;case"safari":if(!p_||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=p_,W_(e,s),H_(e),l_(e),u_(e),a_(e),i_(e),r_(e),d_(e),o_(e),h_(e),M_(e),U_(e),V_(e,s),F_(e),G_(e,s);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var z_=p;On({global:!0,forced:z_.globalThis!==z_},{globalThis:z_});var q_=s(p),Y_={exports:{}};!function(e,n){!function(t,s){var i="function",r="undefined",a="object",o="string",c="major",l="model",d="name",u="type",h="vendor",p="version",m="architecture",f="console",g="mobile",y="tablet",v="smarttv",_="wearable",E="embedded",b="Amazon",x="Apple",w="ASUS",S="BlackBerry",N="Browser",T="Chrome",C="Firefox",R="Google",I="Huawei",A="LG",O="Microsoft",k="Motorola",D="Opera",P="Samsung",j="Sharp",L="Sony",M="Xiaomi",U="Zebra",V="Facebook",F="Chromium OS",B="Mac OS",G=" Browser",W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},H=function(e,t){return typeof e===o&&-1!==K(t).indexOf(K(e))},K=function(e){return e.toLowerCase()},z=function(e,t){if(typeof e===o)return e=e.replace(/^\s\s*/,""),typeof t===r?e:e.substring(0,500)},q=function(e,t){for(var n,r,o,c,l,d,u=0;u<t.length&&!l;){var h=t[u],p=t[u+1];for(n=r=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(e))for(o=0;o<p.length;o++)d=l[++r],typeof(c=p[o])===a&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):s:this[c[0]]=d?c[1].call(this,d,c[2]):s:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):s):this[c]=d||s;u+=2}},Y=function(e,t){for(var n in t)if(typeof t[n]===a&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(H(t[n][i],e))return"?"===n?s:n}else if(H(t[n],e))return"?"===n?s:n;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,p],[/opios[\/ ]+([\w\.]+)/i],[p,[d,D+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[d,D+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[d,D]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[p,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[d,"UC"+N]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[d,"Smart Lenovo "+N]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+N],p],[/\bfocus\/([\w\.]+)/i],[p,[d,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[d,D+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[d,D+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI"+G]],[/fxios\/([\w\.-]+)/i],[p,[d,C]],[/\bqihoobrowser\/?([\w\.]*)/i],[p,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+G],p],[/samsungbrowser\/([\w\.]+)/i],[p,[d,P+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[p,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,p],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[p,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,V],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[d,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,T+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[d,"Android "+N]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[p,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],p],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[d,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,K]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",K]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,K]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,P],[u,y]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,P],[u,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[h,x],[u,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,x],[u,y]],[/(macintosh);/i],[l,[h,x]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,j],[u,g]],[/(?:honor)([-\w ]+)[;\)]/i],[l,[h,"Honor"],[u,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,I],[u,y]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,I],[u,g]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,g]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[u,g]],[/\b(opd2\d{3}a?) bui/i],[l,[h,"OPPO"],[u,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[u,g]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[u,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,k],[u,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,k],[u,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,A],[u,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,A],[u,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[u,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[u,g]],[/(pixel c)\b/i],[l,[h,R],[u,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,R],[u,g]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,L],[u,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,L],[u,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[u,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,b],[u,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,b],[u,g]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[u,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,S],[u,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,w],[u,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,w],[u,g]],[/(nexus 9)/i],[l,[h,"HTC"],[u,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[u,g]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[l,[h,"TCL"],[u,y]],[/(itel) ((\w+))/i],[[h,K],l,[u,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[u,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[u,g]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[h,"Ulefone"],[u,g]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[h,"Energizer"],[u,g]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[h,"Cat"],[u,g]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[h,"Smartfren"],[u,g]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[h,"Nothing"],[u,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[u,g]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[u,y]],[/(surface duo)/i],[l,[h,O],[u,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[u,g]],[/(u304aa)/i],[l,[h,"AT&T"],[u,g]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[u,g]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[u,y]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[u,y]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[u,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[u,y]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[u,y]],[/\b(k88) b/i],[l,[h,"ZTE"],[u,y]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[u,g]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[u,g]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[u,y]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[u,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[u,y]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[u,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[u,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[u,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[u,g]],[/\b(ph-1) /i],[l,[h,"Essential"],[u,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[u,y]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[u,y]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[u,y]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[u,y]],[/(sprint) (\w+)/i],[h,l,[u,g]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,O],[u,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,U],[u,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,U],[u,g]],[/smart-tv.+(samsung)/i],[h,[u,v]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,P],[u,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,A],[u,v]],[/(apple) ?tv/i],[h,[l,x+" TV"],[u,v]],[/crkey/i],[[l,T+"cast"],[h,R],[u,v]],[/droid.+aft(\w+)( bui|\))/i],[l,[h,b],[u,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,j],[u,v]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,L],[u,v]],[/(mitv-\w{5}) bui/i],[l,[h,M],[u,v]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[u,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,z],[l,z],[u,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[u,f]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[u,f]],[/(playstation [345portablevi]+)/i],[l,[h,L],[u,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,O],[u,f]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[l,[h,P],[u,_]],[/((pebble))app/i],[h,l,[u,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,x],[u,_]],[/droid.+; (glass) \d/i],[l,[h,R],[u,_]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,U],[u,_]],[/droid.+; (glass) \d/i],[l,[h,R],[u,_]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,l,[u,_]],[/; (quest( \d| pro)?)/i],[l,[h,V],[u,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[u,E]],[/(aeobc)\b/i],[l,[h,b],[u,E]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[l,[u,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[u,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,g]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,p],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[p,Y,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,Y,X],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,p],[/\(bb(10);/i],[p,[d,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[d,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[d,T+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,F],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,p],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,p]]},Q=function(e,n){if(typeof e===a&&(n=e,e=s),!(this instanceof Q))return new Q(e,n).getResult();var f=typeof t!==r&&t.navigator?t.navigator:s,v=e||(f&&f.userAgent?f.userAgent:""),_=f&&f.userAgentData?f.userAgentData:s,E=n?function(e,t){var n={};for(var s in e)t[s]&&t[s].length%2==0?n[s]=t[s].concat(e[s]):n[s]=e[s];return n}(J,n):J,b=f&&f.userAgent==v;return this.getBrowser=function(){var e={};return e[d]=s,e[p]=s,q.call(e,v,E.browser),e[c]=function(e){return typeof e===o?e.replace(/[^\d\.]/g,"").split(".")[0]:s}(e[p]),b&&f&&f.brave&&typeof f.brave.isBrave==i&&(e[d]="Brave"),e},this.getCPU=function(){var e={};return e[m]=s,q.call(e,v,E.cpu),e},this.getDevice=function(){var e={};return e[h]=s,e[l]=s,e[u]=s,q.call(e,v,E.device),b&&!e[u]&&_&&_.mobile&&(e[u]=g),b&&"Macintosh"==e[l]&&f&&typeof f.standalone!==r&&f.maxTouchPoints&&f.maxTouchPoints>2&&(e[l]="iPad",e[u]=y),e},this.getEngine=function(){var e={};return e[d]=s,e[p]=s,q.call(e,v,E.engine),e},this.getOS=function(){var e={};return e[d]=s,e[p]=s,q.call(e,v,E.os),b&&!e[d]&&_&&_.platform&&"Unknown"!=_.platform&&(e[d]=_.platform.replace(/chrome os/i,F).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(e){return v=typeof e===o&&e.length>500?z(e,500):e,this},this.setUA(v),this};Q.VERSION="0.7.40",Q.BROWSER=W([d,p,c]),Q.CPU=W([m]),Q.DEVICE=W([l,h,u,f,g,v,y,_,E]),Q.ENGINE=Q.OS=W([d,p]),e.exports&&(n=e.exports=Q),n.UAParser=Q;var Z=typeof t!==r&&(t.jQuery||t.Zepto);if(Z&&!Z.ua){var $=new Q;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==typeof window?window:t)}(Y_,Y_.exports);var X_=s(Y_.exports),J_=Ll.clear;On({global:!0,bind:!0,enumerable:!0,forced:p.clearImmediate!==J_},{clearImmediate:J_});var Q_=p,Z_=v,$_=C,eE=Xs,tE=ce,nE=al,sE=cl,iE=Q_.Function,rE=/MSIE .\./.test(tE)||"BUN"===eE&&function(){var e=Q_.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}(),aE=On,oE=p,cE=Ll.set,lE=function(e,t){var n=t?2:1;return rE?function(s,i){var r=sE(arguments.length,1)>n,a=$_(s)?s:iE(s),o=r?nE(arguments,n):[],c=r?function(){Z_(a,this,o)}:a;return t?e(c,i):e(c)}:e},dE=oE.setImmediate?lE(cE,!1):cE;aE({global:!0,bind:!0,enumerable:!0,forced:oE.setImmediate!==dE},{setImmediate:dE});var uE=s(ee.setImmediate),hE=p,pE=hd,mE=Oe,fE=cl,gE=I;On({global:!0,enumerable:!0,dontCallGetSet:!0,forced:i(function(){return gE&&1!==Object.getOwnPropertyDescriptor(hE,"queueMicrotask").value.length})},{queueMicrotask:function(e){fE(arguments.length,1),pE(mE(e))}});var yE=s(ee.queueMicrotask);function vE(e,t){return function(){return e.apply(t,arguments)}}const{toString:_E}=Object.prototype,{getPrototypeOf:EE}=Object,{iterator:bE,toStringTag:xE}=Symbol,wE=(SE=Object.create(null),e=>{const t=_E.call(e);return SE[t]||(SE[t]=t.slice(8,-1).toLowerCase())});var SE;const NE=e=>(e=e.toLowerCase(),t=>wE(t)===e),TE=e=>t=>typeof t===e,{isArray:CE}=Array,RE=TE("undefined"),IE=NE("ArrayBuffer"),AE=TE("string"),OE=TE("function"),kE=TE("number"),DE=e=>null!==e&&"object"==typeof e,PE=e=>{if("object"!==wE(e))return!1;const t=EE(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||xE in e||bE in e)},jE=NE("Date"),LE=NE("File"),ME=NE("Blob"),UE=NE("FileList"),VE=NE("URLSearchParams"),[FE,BE,GE,WE]=["ReadableStream","Request","Response","Headers"].map(NE);function HE(e,t){let n,s,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),CE(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),r=s.length;let a;for(n=0;n<r;n++)a=s[n],t.call(null,e[a],a,e)}}function KE(e,t){t=t.toLowerCase();const n=Object.keys(e);let s,i=n.length;for(;i-- >0;)if(s=n[i],t===s.toLowerCase())return s;return null}const zE=void 0!==q_?q_:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,qE=e=>!RE(e)&&e!==zE,YE=(XE="undefined"!=typeof Uint8Array&&EE(Uint8Array),e=>XE&&e instanceof XE);var XE;const JE=NE("HTMLFormElement"),QE=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),ZE=NE("RegExp"),$E=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),s={};HE(n,(n,i)=>{let r;!1!==(r=t(n,i,e))&&(s[i]=r||n)}),Object.defineProperties(e,s)},eb=NE("AsyncFunction"),tb=(nb="function"==typeof uE,sb=OE(zE.postMessage),nb?uE:sb?(ib="axios@".concat(Math.random()),rb=[],zE.addEventListener("message",e=>{let{source:t,data:n}=e;t===zE&&n===ib&&rb.length&&rb.shift()()},!1),e=>{rb.push(e),zE.postMessage(ib,"*")}):e=>setTimeout(e));var nb,sb,ib,rb;const ab=void 0!==yE?yE.bind(zE):"undefined"!=typeof process&&process.nextTick||tb;var ob={isArray:CE,isArrayBuffer:IE,isBuffer:function(e){return null!==e&&!RE(e)&&null!==e.constructor&&!RE(e.constructor)&&OE(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||OE(e.append)&&("formdata"===(t=wE(e))||"object"===t&&OE(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&IE(e.buffer),t},isString:AE,isNumber:kE,isBoolean:e=>!0===e||!1===e,isObject:DE,isPlainObject:PE,isReadableStream:FE,isRequest:BE,isResponse:GE,isHeaders:WE,isUndefined:RE,isDate:jE,isFile:LE,isBlob:ME,isRegExp:ZE,isFunction:OE,isStream:e=>DE(e)&&OE(e.pipe),isURLSearchParams:VE,isTypedArray:YE,isFileList:UE,forEach:HE,merge:function e(){const{caseless:t}=qE(this)&&this||{},n={},s=(s,i)=>{const r=t&&KE(n,i)||i;PE(n[r])&&PE(s)?n[r]=e(n[r],s):PE(s)?n[r]=e({},s):CE(s)?n[r]=s.slice():n[r]=s};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&HE(arguments[i],s);return n},extend:function(e,t,n){let{allOwnKeys:s}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return HE(t,(t,s)=>{n&&OE(t)?e[s]=vE(t,n):e[s]=t},{allOwnKeys:s}),e},trim:e=>k_(e)?k_(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,s)=>{let i,r,a;const o={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),r=i.length;r-- >0;)a=i[r],s&&!s(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==n&&EE(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:wE,kindOfTest:NE,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const s=e.indexOf(t,n);return-1!==s&&s===n},toArray:e=>{if(!e)return null;if(CE(e))return e;let t=e.length;if(!kE(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[bE]).call(e);let s;for(;(s=n.next())&&!s.done;){const n=s.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const s=[];for(;null!==(n=e.exec(t));)s.push(n);return s},isHTMLForm:JE,hasOwnProperty:QE,hasOwnProp:QE,reduceDescriptors:$E,freezeMethods:e=>{$E(e,(t,n)=>{if(OE(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const s=e[n];OE(s)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},s=e=>{e.forEach(e=>{n[e]=!0})};return CE(e)?s(e):s(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:KE,global:zE,isContextDefined:qE,isSpecCompliantForm:function(e){return!!(e&&OE(e.append)&&"FormData"===e[xE]&&e[bE])},toJSONObject:e=>{const t=new Array(10),n=(e,s)=>{if(DE(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[s]=e;const i=CE(e)?[]:{};return HE(e,(e,t)=>{const r=n(e,s+1);!RE(r)&&(i[t]=r)}),t[s]=void 0,i}}return e};return n(e,0)},isAsyncFn:eb,isThenable:e=>e&&(DE(e)||OE(e))&&OE(e.then)&&OE(e.catch),setImmediate:tb,asap:ab,isIterable:e=>null!=e&&OE(e[bE])};function cb(e,t,n,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}ob.inherits(cb,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ob.toJSONObject(this.config),code:this.code,status:this.status}}});const lb=cb.prototype,db={};function ub(e){return ob.isPlainObject(e)||ob.isArray(e)}function hb(e){return ob.endsWith(e,"[]")?e.slice(0,-2):e}function pb(e,t,n){return e?e.concat(t).map(function(e,t){return e=hb(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{db[e]={value:e}}),Object.defineProperties(cb,db),Object.defineProperty(lb,"isAxiosError",{value:!0}),cb.from=(e,t,n,s,i,r)=>{const a=Object.create(lb);return ob.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),cb.call(a,e.message,t,n,s,i),a.cause=e,a.name=e.name,r&&Object.assign(a,r),a};const mb=ob.toFlatObject(ob,{},null,function(e){return/^is[A-Z]/.test(e)});function fb(e,t,n){if(!ob.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const s=(n=ob.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!ob.isUndefined(t[e])})).metaTokens,i=n.visitor||l,r=n.dots,a=n.indexes,o=(n.Blob||"undefined"!=typeof Blob&&Blob)&&ob.isSpecCompliantForm(t);if(!ob.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(ob.isDate(e))return e.toISOString();if(!o&&ob.isBlob(e))throw new cb("Blob is not supported. Use a Buffer instead.");return ob.isArrayBuffer(e)||ob.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let o=e;if(e&&!i&&"object"==typeof e)if(ob.endsWith(n,"{}"))n=s?n:n.slice(0,-2),e=JSON.stringify(e);else if(ob.isArray(e)&&function(e){return ob.isArray(e)&&!e.some(ub)}(e)||(ob.isFileList(e)||ob.endsWith(n,"[]"))&&(o=ob.toArray(e)))return n=hb(n),o.forEach(function(e,s){!ob.isUndefined(e)&&null!==e&&t.append(!0===a?pb([n],s,r):null===a?n:n+"[]",c(e))}),!1;return!!ub(e)||(t.append(pb(i,n,r),c(e)),!1)}const d=[],u=Object.assign(mb,{defaultVisitor:l,convertValue:c,isVisitable:ub});if(!ob.isObject(e))throw new TypeError("data must be an object");return function e(n,s){if(!ob.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+s.join("."));d.push(n),ob.forEach(n,function(n,r){!0===(!(ob.isUndefined(n)||null===n)&&i.call(t,n,ob.isString(r)?k_(r).call(r):r,s,u))&&e(n,s?s.concat(r):[r])}),d.pop()}}(e),t}function gb(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function yb(e,t){this._pairs=[],e&&fb(e,this,t)}const vb=yb.prototype;function _b(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Eb(e,t,n){if(!t)return e;const s=n&&n.encode||_b;ob.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let r;if(r=i?i(t,n):ob.isURLSearchParams(t)?t.toString():new yb(t,n).toString(s),r){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}vb.append=function(e,t){this._pairs.push([e,t])},vb.toString=function(e){const t=e?function(t){return e.call(this,t,gb)}:gb;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var bb=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ob.forEach(this.handlers,function(t){null!==t&&e(t)})}},xb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wb={exports:{}},Sb=On,Nb=I,Tb=$t.f;Sb({target:"Object",stat:!0,forced:Object.defineProperty!==Tb,sham:!Nb},{defineProperty:Tb});var Cb=ee.Object,Rb=wb.exports=function(e,t,n){return Cb.defineProperty(e,t,n)};Cb.defineProperty.sham&&(Rb.sham=!0);var Ib=s(wb.exports),Ab=TypeError,Ob=ai,kb=Qc,Db=$,Pb=mt("species"),jb=Array,Lb=function(e){var t;return Ob(e)&&(t=e.constructor,(kb(t)&&(t===jb||Ob(t.prototype))||Db(t)&&null===(t=t[Pb]))&&(t=void 0)),void 0===t?jb:t},Mb=function(e,t){return new(Lb(e))(0===t?0:t)},Ub=i,Vb=fe,Fb=mt("species"),Bb=function(e){return Vb>=51||!Ub(function(){var t=[];return(t.constructor={})[Fb]=function(){return{foo:1}},1!==t[e](Boolean).foo})},Gb=On,Wb=i,Hb=ai,Kb=$,zb=Qe,qb=Kn,Yb=function(e){if(e>9007199254740991)throw Ab("Maximum allowed index exceeded");return e},Xb=qf,Jb=Mb,Qb=Bb,Zb=fe,$b=mt("isConcatSpreadable"),ex=Zb>=51||!Wb(function(){var e=[];return e[$b]=!1,e.concat()[0]!==e}),tx=function(e){if(!Kb(e))return!1;var t=e[$b];return void 0!==t?!!t:Hb(e)};Gb({target:"Array",proto:!0,arity:1,forced:!ex||!Qb("concat")},{concat:function(e){var t,n,s,i,r,a=zb(this),o=Jb(a,0),c=0;for(t=-1,s=arguments.length;t<s;t++)if(tx(r=-1===t?a:arguments[t]))for(i=qb(r),Yb(c+i),n=0;n<i;n++,c++)n in r&&Xb(o,c,r[n]);else Yb(c+1),Xb(o,c++,r);return o.length=c,o}});var nx={},sx=x,ix=Q,rx=Bi.f,ax=al,ox="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];nx.f=function(e){return ox&&"Window"===sx(e)?function(e){try{return rx(e)}catch(e){return ax(ox)}}(e):rx(ix(e))};var cx={},lx=mt;cx.f=lx;var dx=ee,ux=et,hx=cx,px=$t.f,mx=function(e){var t=dx.Symbol||(dx.Symbol={});ux(t,e)||px(t,e,{value:hx.f(e)})},fx=k,gx=re,yx=mt,vx=So,_x=function(){var e=gx("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,s=yx("toPrimitive");t&&!t[s]&&vx(t,s,function(e){return fx(n,this)},{arity:1})},Ex=Zt,bx=H,xx=Qe,wx=Kn,Sx=Mb,Nx=d([].push),Tx=function(e){var t=1===e,n=2===e,s=3===e,i=4===e,r=6===e,a=7===e,o=5===e||r;return function(c,l,d,u){for(var h,p,m=xx(c),f=bx(m),g=wx(f),y=Ex(l,d),v=0,_=u||Sx,E=t?_(c,g):n||a?_(c,0):void 0;g>v;v++)if((o||v in f)&&(p=y(h=f[v],v,m),e))if(t)E[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:Nx(E,h)}else switch(e){case 4:return!1;case 7:Nx(E,h)}return r?-1:s||i?i:E}},Cx={forEach:Tx(0),map:Tx(1),filter:Tx(2),some:Tx(3),every:Tx(4),find:Tx(5),findIndex:Tx(6),filterReject:Tx(7)},Rx=On,Ix=p,Ax=k,Ox=d,kx=I,Dx=_e,Px=i,jx=et,Lx=u,Mx=rn,Ux=Q,Vx=St,Fx=_s,Bx=V,Gx=Pr,Wx=hr,Hx=Bi,Kx=nx,zx=Zi,qx=R,Yx=$t,Xx=lr,Jx=D,Qx=So,Zx=wc,$x=Ye,ew=Gi,tw=rt,nw=mt,sw=cx,iw=mx,rw=_x,aw=Wo,ow=go,cw=Cx.forEach,lw=Ei("hidden"),dw="Symbol",uw="prototype",hw=ow.set,pw=ow.getterFor(dw),mw=Object[uw],fw=Ix.Symbol,gw=fw&&fw[uw],yw=Ix.RangeError,vw=Ix.TypeError,_w=Ix.QObject,Ew=qx.f,bw=Yx.f,xw=Kx.f,ww=Jx.f,Sw=Ox([].push),Nw=$x("symbols"),Tw=$x("op-symbols"),Cw=$x("wks"),Rw=!_w||!_w[uw]||!_w[uw].findChild,Iw=function(e,t,n){var s=Ew(mw,t);s&&delete mw[t],bw(e,t,n),s&&e!==mw&&bw(mw,t,s)},Aw=kx&&Px(function(){return 7!==Gx(bw({},"a",{get:function(){return bw(this,"a",{value:7}).a}})).a})?Iw:bw,Ow=function(e,t){var n=Nw[e]=Gx(gw);return hw(n,{type:dw,tag:e,description:t}),kx||(n.description=t),n},kw=function(e,t,n){e===mw&&kw(Tw,t,n),Mx(e);var s=Vx(t);return Mx(n),jx(Nw,s)?(n.enumerable?(jx(e,lw)&&e[lw][s]&&(e[lw][s]=!1),n=Gx(n,{enumerable:Bx(0,!1)})):(jx(e,lw)||bw(e,lw,Bx(1,Gx(null))),e[lw][s]=!0),Aw(e,s,n)):bw(e,s,n)},Dw=function(e,t){Mx(e);var n=Ux(t),s=Wx(n).concat(Mw(n));return cw(s,function(t){kx&&!Ax(Pw,n,t)||kw(e,t,n[t])}),e},Pw=function(e){var t=Vx(e),n=Ax(ww,this,t);return!(this===mw&&jx(Nw,t)&&!jx(Tw,t))&&(!(n||!jx(this,t)||!jx(Nw,t)||jx(this,lw)&&this[lw][t])||n)},jw=function(e,t){var n=Ux(e),s=Vx(t);if(n!==mw||!jx(Nw,s)||jx(Tw,s)){var i=Ew(n,s);return!i||!jx(Nw,s)||jx(n,lw)&&n[lw][s]||(i.enumerable=!0),i}},Lw=function(e){var t=xw(Ux(e)),n=[];return cw(t,function(e){jx(Nw,e)||jx(ew,e)||Sw(n,e)}),n},Mw=function(e){var t=e===mw,n=xw(t?Tw:Ux(e)),s=[];return cw(n,function(e){!jx(Nw,e)||t&&!jx(mw,e)||Sw(s,Nw[e])}),s};Dx||(fw=function(){if(Lx(gw,this))throw new vw("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Fx(arguments[0]):void 0,t=tw(e),n=function(e){var s=void 0===this?Ix:this;s===mw&&Ax(n,Tw,e),jx(s,lw)&&jx(s[lw],t)&&(s[lw][t]=!1);var i=Bx(1,e);try{Aw(s,t,i)}catch(e){if(!(e instanceof yw))throw e;Iw(s,t,i)}};return kx&&Rw&&Aw(mw,t,{configurable:!0,set:n}),Ow(t,e)},Qx(gw=fw[uw],"toString",function(){return pw(this).tag}),Qx(fw,"withoutSetter",function(e){return Ow(tw(e),e)}),Jx.f=Pw,Yx.f=kw,Xx.f=Dw,qx.f=jw,Hx.f=Kx.f=Lw,zx.f=Mw,sw.f=function(e){return Ow(nw(e),e)},kx&&Zx(gw,"description",{configurable:!0,get:function(){return pw(this).description}})),Rx({global:!0,constructor:!0,wrap:!0,forced:!Dx,sham:!Dx},{Symbol:fw}),cw(Wx(Cw),function(e){iw(e)}),Rx({target:dw,stat:!0,forced:!Dx},{useSetter:function(){Rw=!0},useSimple:function(){Rw=!1}}),Rx({target:"Object",stat:!0,forced:!Dx,sham:!kx},{create:function(e,t){return void 0===t?Gx(e):Dw(Gx(e),t)},defineProperty:kw,defineProperties:Dw,getOwnPropertyDescriptor:jw}),Rx({target:"Object",stat:!0,forced:!Dx},{getOwnPropertyNames:Lw}),rw(),aw(fw,dw),ew[lw]=!0;var Uw=_e&&!!Symbol.for&&!!Symbol.keyFor,Vw=On,Fw=re,Bw=et,Gw=_s,Ww=Ye,Hw=Uw,Kw=Ww("string-to-symbol-registry"),zw=Ww("symbol-to-string-registry");Vw({target:"Symbol",stat:!0,forced:!Hw},{for:function(e){var t=Gw(e);if(Bw(Kw,t))return Kw[t];var n=Fw("Symbol")(t);return Kw[t]=n,zw[n]=t,n}});var qw=On,Yw=et,Xw=Ne,Jw=Ce,Qw=Uw,Zw=Ye("symbol-to-string-registry");qw({target:"Symbol",stat:!0,forced:!Qw},{keyFor:function(e){if(!Xw(e))throw new TypeError(Jw(e)+" is not a symbol");if(Yw(Zw,e))return Zw[e]}});var $w=ai,eS=C,tS=x,nS=_s,sS=d([].push),iS=On,rS=re,aS=v,oS=k,cS=d,lS=i,dS=C,uS=Ne,hS=al,pS=function(e){if(eS(e))return e;if($w(e)){for(var t=e.length,n=[],s=0;s<t;s++){var i=e[s];"string"==typeof i?sS(n,i):"number"!=typeof i&&"Number"!==tS(i)&&"String"!==tS(i)||sS(n,nS(i))}var r=n.length,a=!0;return function(e,t){if(a)return a=!1,t;if($w(this))return t;for(var s=0;s<r;s++)if(n[s]===e)return t}}},mS=_e,fS=String,gS=rS("JSON","stringify"),yS=cS(/./.exec),vS=cS("".charAt),_S=cS("".charCodeAt),ES=cS("".replace),bS=cS(1..toString),xS=/[\uD800-\uDFFF]/g,wS=/^[\uD800-\uDBFF]$/,SS=/^[\uDC00-\uDFFF]$/,NS=!mS||lS(function(){var e=rS("Symbol")("stringify detection");return"[null]"!==gS([e])||"{}"!==gS({a:e})||"{}"!==gS(Object(e))}),TS=lS(function(){return'"\\udf06\\ud834"'!==gS("\udf06\ud834")||'"\\udead"'!==gS("\udead")}),CS=function(e,t){var n=hS(arguments),s=pS(t);if(dS(s)||void 0!==e&&!uS(e))return n[1]=function(e,t){if(dS(s)&&(t=oS(s,this,fS(e),t)),!uS(t))return t},aS(gS,null,n)},RS=function(e,t,n){var s=vS(n,t-1),i=vS(n,t+1);return yS(wS,e)&&!yS(SS,i)||yS(SS,e)&&!yS(wS,s)?"\\u"+bS(_S(e,0),16):e};gS&&iS({target:"JSON",stat:!0,arity:3,forced:NS||TS},{stringify:function(e,t,n){var s=hS(arguments),i=aS(NS?CS:gS,null,s);return TS&&"string"==typeof i?ES(i,xS,RS):i}});var IS=Zi,AS=Qe;On({target:"Object",stat:!0,forced:!_e||i(function(){IS.f(1)})},{getOwnPropertySymbols:function(e){var t=IS.f;return t?t(AS(e)):[]}}),mx("asyncIterator"),mx("hasInstance"),mx("isConcatSpreadable"),mx("iterator"),mx("match"),mx("matchAll"),mx("replace"),mx("search"),mx("species"),mx("split");var OS=_x;mx("toPrimitive"),OS();var kS=re,DS=Wo;mx("toStringTag"),DS(kS("Symbol"),"Symbol"),mx("unscopables"),Wo(p.JSON,"JSON",!0);var PS=ee.Symbol,jS=mt,LS=$t.f,MS=jS("metadata"),US=Function.prototype;void 0===US[MS]&&LS(US,MS,{value:null}),mx("asyncDispose"),mx("dispose"),mx("metadata");var VS=PS,FS=d,BS=re("Symbol"),GS=BS.keyFor,WS=FS(BS.prototype.valueOf),HS=BS.isRegisteredSymbol||function(e){try{return void 0!==GS(WS(e))}catch(e){return!1}};On({target:"Symbol",stat:!0},{isRegisteredSymbol:HS});for(var KS=Ye,zS=re,qS=d,YS=Ne,XS=mt,JS=zS("Symbol"),QS=JS.isWellKnownSymbol,ZS=zS("Object","getOwnPropertyNames"),$S=qS(JS.prototype.valueOf),eN=KS("wks"),tN=0,nN=ZS(JS),sN=nN.length;tN<sN;tN++)try{var iN=nN[tN];YS(JS[iN])&&XS(iN)}catch(e){}var rN=function(e){if(QS&&QS(e))return!0;try{for(var t=$S(e),n=0,s=ZS(eN),i=s.length;n<i;n++)if(eN[s[n]]==t)return!0}catch(e){}return!1};On({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:rN}),mx("customMatcher"),mx("observable"),On({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:HS}),On({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:rN}),mx("matcher"),mx("metadataKey"),mx("patternMatch"),mx("replaceAll");var aN=s(VS),oN=s(cx.f("iterator"));function cN(e){return cN="function"==typeof aN&&"symbol"==typeof oN?function(e){return typeof e}:function(e){return e&&"function"==typeof aN&&e.constructor===aN&&e!==aN.prototype?"symbol":typeof e},cN(e)}var lN=s(cx.f("toPrimitive"));function dN(e){var t=function(e,t){if("object"!=cN(e)||!e)return e;var n=e[lN];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=cN(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==cN(t)?t:t+""}function uN(e,t,n){return(t=dN(t))in e?Ib(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hN=s(Rf),pN={isBrowser:!0,classes:{URLSearchParams:void 0!==hN?hN:yb,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const mN="undefined"!=typeof window&&"undefined"!=typeof document,fN="object"==typeof navigator&&navigator||void 0,gN=mN&&(!fN||["ReactNative","NativeScript","NS"].indexOf(fN.product)<0),yN="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,vN=mN&&window.location.href||"http://localhost";function _N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function EN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_N(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var bN=EN(EN({},Object.freeze({__proto__:null,hasBrowserEnv:mN,hasStandardBrowserEnv:gN,hasStandardBrowserWebWorkerEnv:yN,navigator:fN,origin:vN})),pN),xN=rn,wN=k,SN=et,NN=u,TN=function(){var e=xN(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},CN=RegExp.prototype,RN=function(e){var t=e.flags;return void 0!==t||"flags"in CN||SN(e,"flags")||!NN(CN,e)?t:wN(TN,e)},IN=Fh.charAt,AN=k,ON=rn,kN=C,DN=x,PN=/./.exec,jN=TypeError,LN=On,MN=k,UN=N,VN=Jo,FN=pc,BN=Y,GN=Wn,WN=_s,HN=rn,KN=$,zN=x,qN=rs,YN=RN,XN=Pe,JN=i,QN=rl,ZN=function(e,t,n){return t+(n?IN(e,t).length:1)},$N=function(e,t){var n=e.exec;if(kN(n)){var s=AN(n,e,t);return null!==s&&ON(s),s}if("RegExp"===DN(e))return AN(PN,e,t);throw new jN("RegExp#exec called on incompatible receiver")},eT=go,tT=mt("matchAll"),nT="RegExp String",sT=nT+" Iterator",iT=eT.set,rT=eT.getterFor(sT),aT=TypeError,oT=UN("".indexOf),cT=UN("".matchAll),lT=!!cT&&!JN(function(){cT("a",/./)}),dT=VN(function(e,t,n,s){iT(this,{type:sT,regexp:e,string:t,global:n,unicode:s,done:!1})},nT,function(){var e=rT(this);if(e.done)return FN(void 0,!0);var t=e.regexp,n=e.string,s=$N(t,n);return null===s?(e.done=!0,FN(void 0,!0)):e.global?(""===WN(s[0])&&(t.lastIndex=ZN(n,GN(t.lastIndex),e.unicode)),FN(s,!1)):(e.done=!0,FN(s,!1))}),uT=function(e){var t,n,s,i=HN(this),r=WN(e),a=QN(i,RegExp),o=WN(YN(i));return t=new a(a===RegExp?i.source:i,o),n=!!~oT(o,"g"),s=!!~oT(o,"u"),t.lastIndex=GN(i.lastIndex),new dT(t,r,n,s)};LN({target:"String",proto:!0,forced:lT},{matchAll:function(e){var t,n,s,i,r=BN(this);if(KN(e)){if(qN(e)&&(t=WN(BN(YN(e))),!~oT(t,"g")))throw new aT("`.matchAll` does not allow non-global regexes");if(lT)return cT(r,e);if(void 0===(s=XN(e,tT))&&"RegExp"===zN(e)&&(s=uT),s)return MN(s,e,r)}else if(lT)return cT(r,e);return n=WN(r),i=new RegExp(e,"g"),MN(uT,i,n)}});var hT=es("String","matchAll"),pT=u,mT=hT,fT=String.prototype,gT=function(e){var t=e.matchAll;return"string"==typeof e||e===fT||pT(fT,e)&&t===fT.matchAll?mT:t},yT=s(gT);function vT(e){function t(e,n,s,i){let r=e[i++];if("__proto__"===r)return!0;const a=Number.isFinite(+r),o=i>=e.length;return r=!r&&ob.isArray(s)?s.length:r,o?(ob.hasOwnProp(s,r)?s[r]=[s[r],n]:s[r]=n,!a):(s[r]&&ob.isObject(s[r])||(s[r]=[]),t(e,n,s[r],i)&&ob.isArray(s[r])&&(s[r]=function(e){const t={},n=Object.keys(e);let s;const i=n.length;let r;for(s=0;s<i;s++)r=n[s],t[r]=e[r];return t}(s[r])),!a)}if(ob.isFormData(e)&&ob.isFunction(e.entries)){const n={};return ob.forEachEntry(e,(e,s)=>{t(function(e){return yT(ob).call(ob,/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),s,n,0)}),n}return null}const _T={transitional:xb,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",s=n.indexOf("application/json")>-1,i=ob.isObject(e);if(i&&ob.isHTMLForm(e)&&(e=new FormData(e)),ob.isFormData(e))return s?JSON.stringify(vT(e)):e;if(ob.isArrayBuffer(e)||ob.isBuffer(e)||ob.isStream(e)||ob.isFile(e)||ob.isBlob(e)||ob.isReadableStream(e))return e;if(ob.isArrayBufferView(e))return e.buffer;if(ob.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let r;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return fb(e,new bN.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,s){return bN.isNode&&ob.isBuffer(e)?(this.append(t,e.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((r=ob.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return fb(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),function(e,t,n){if(ob.isString(e))try{return(t||JSON.parse)(e),k_(ob).call(ob,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||_T.transitional,n=t&&t.forcedJSONParsing,s="json"===this.responseType;if(ob.isResponse(e)||ob.isReadableStream(e))return e;if(e&&ob.isString(e)&&(n&&!this.responseType||s)){const n=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw cb.from(e,cb.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bN.classes.FormData,Blob:bN.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ob.forEach(["delete","get","head","post","put","patch"],e=>{_T.headers[e]={}});var ET=_T;const bT=ob.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),xT=Symbol("internals");function wT(e){var t;return e&&k_(t=String(e)).call(t).toLowerCase()}function ST(e){return!1===e||null==e?e:ob.isArray(e)?e.map(ST):String(e)}function NT(e,t,n,s,i){return ob.isFunction(s)?s.call(this,t,n):(i&&(t=n),ob.isString(t)?ob.isString(s)?-1!==t.indexOf(s):ob.isRegExp(s)?s.test(t):void 0:void 0)}class TT{constructor(e){e&&this.set(e)}set(e,t,n){const s=this;function i(e,t,n){const i=wT(t);if(!i)throw new Error("header name must be a non-empty string");const r=ob.findKey(s,i);(!r||void 0===s[r]||!0===n||void 0===n&&!1!==s[r])&&(s[r||t]=ST(e))}const r=(e,t)=>ob.forEach(e,(e,n)=>i(e,n,t));if(ob.isPlainObject(e)||e instanceof this.constructor)r(e,t);else if(ob.isString(e)&&(e=k_(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(k_(a=e).call(a)))r((e=>{const t={};let n,s,i;return e&&e.split("\n").forEach(function(e){var r,a;i=e.indexOf(":"),n=k_(r=e.substring(0,i)).call(r).toLowerCase(),s=k_(a=e.substring(i+1)).call(a),!n||t[n]&&bT[n]||("set-cookie"===n?t[n]?t[n].push(s):t[n]=[s]:t[n]=t[n]?t[n]+", "+s:s)}),t})(e),t);else if(ob.isObject(e)&&ob.isIterable(e)){let n,s,i={};for(const t of e){if(!ob.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[s=t[0]]=(n=i[s])?ob.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}r(i,t)}else null!=e&&i(t,e,n);var a;return this}get(e,t){if(e=wT(e)){const n=ob.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(e);)t[s[1]]=s[2];return t}(e);if(ob.isFunction(t))return t.call(this,e,n);if(ob.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=wT(e)){const n=ob.findKey(this,e);return!(!n||void 0===this[n]||t&&!NT(0,this[n],n,t))}return!1}delete(e,t){const n=this;let s=!1;function i(e){if(e=wT(e)){const i=ob.findKey(n,e);!i||t&&!NT(0,n[i],i,t)||(delete n[i],s=!0)}}return ob.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let n=t.length,s=!1;for(;n--;){const i=t[n];e&&!NT(0,this[i],i,e,!0)||(delete this[i],s=!0)}return s}normalize(e){const t=this,n={};return ob.forEach(this,(s,i)=>{var r;const a=ob.findKey(n,i);if(a)return t[a]=ST(s),void delete t[i];const o=e?function(e){return k_(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(i):k_(r=String(i)).call(r);o!==i&&delete t[i],t[o]=ST(s),n[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return ob.forEach(this,(n,s)=>{null!=n&&!1!==n&&(t[s]=e&&ob.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return s.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[xT]=this[xT]={accessors:{}}).accessors,n=this.prototype;function s(e){const s=wT(e);t[s]||(function(e,t){const n=ob.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+n,{value:function(e,n,i){return this[s].call(this,t,e,n,i)},configurable:!0})})}(n,e),t[s]=!0)}return ob.isArray(e)?e.forEach(s):s(e),this}}TT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ob.reduceDescriptors(TT.prototype,(e,t)=>{let{value:n}=e,s=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[s]=e}}}),ob.freezeMethods(TT);var CT=TT;function RT(e,t){const n=this||ET,s=t||n,i=CT.from(s.headers);let r=s.data;return ob.forEach(e,function(e){r=e.call(n,r,i.normalize(),t?t.status:void 0)}),i.normalize(),r}function IT(e){return!(!e||!e.__CANCEL__)}function AT(e,t,n){cb.call(this,null==e?"canceled":e,cb.ERR_CANCELED,t,n),this.name="CanceledError"}function OT(e,t,n){const s=n.config.validateStatus;n.status&&s&&!s(n.status)?t(new cb("Request failed with status code "+n.status,[cb.ERR_BAD_REQUEST,cb.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}ob.inherits(AT,cb,{__CANCEL__:!0});const kT=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,s=0;const i=function(e,t){e=e||10;const n=new Array(e),s=new Array(e);let i,r=0,a=0;return t=void 0!==t?t:1e3,function(o){const c=Date.now(),l=s[a];i||(i=c),n[r]=o,s[r]=c;let d=a,u=0;for(;d!==r;)u+=n[d++],d%=e;if(r=(r+1)%e,r===a&&(a=(a+1)%e),c-i<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let n,s,i=0,r=1e3/t;const a=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=r,n=null,s&&(clearTimeout(s),s=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];t>=r?a(c,e):(n=c,s||(s=setTimeout(()=>{s=null,a(n)},r-t)))},()=>n&&a(n)]}(n=>{const r=n.loaded,a=n.lengthComputable?n.total:void 0,o=r-s,c=i(o);s=r,e({loaded:r,total:a,progress:a?r/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&r<=a?(a-r)/c:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},DT=(e,t)=>{const n=null!=e;return[s=>t[0]({lengthComputable:n,total:e,loaded:s}),t[1]]},PT=e=>function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return ob.asap(()=>e(...n))};var jT=bN.hasStandardBrowserEnv?((e,t)=>n=>(n=new bv(n,bN.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new bv(bN.origin),bN.navigator&&/(msie|trident)/i.test(bN.navigator.userAgent)):()=>!0,LT=bN.hasStandardBrowserEnv?{write(e,t,n,s,i,r){const a=[e+"="+encodeURIComponent(t)];ob.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),ob.isString(s)&&a.push("path="+s),ob.isString(i)&&a.push("domain="+i),!0===r&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function MT(e,t,n){let s=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(s||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function UT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}const VT=e=>e instanceof CT?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UT(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UT(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e):e;function FT(e,t){t=t||{};const n={};function s(e,t,n,s){return ob.isPlainObject(e)&&ob.isPlainObject(t)?ob.merge.call({caseless:s},e,t):ob.isPlainObject(t)?ob.merge({},t):ob.isArray(t)?t.slice():t}function i(e,t,n,i){return ob.isUndefined(t)?ob.isUndefined(e)?void 0:s(void 0,e,0,i):s(e,t,0,i)}function r(e,t){if(!ob.isUndefined(t))return s(void 0,t)}function a(e,t){return ob.isUndefined(t)?ob.isUndefined(e)?void 0:s(void 0,e):s(void 0,t)}function o(n,i,r){return r in t?s(n,i):r in e?s(void 0,n):void 0}const c={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,n)=>i(VT(e),VT(t),0,!0)};return ob.forEach(Object.keys(Object.assign({},e,t)),function(s){const r=c[s]||i,a=r(e[s],t[s],s);ob.isUndefined(a)&&r!==o||(n[s]=a)}),n}var BT=e=>{const t=FT({},e);let n,{data:s,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:a,headers:o,auth:c}=t;if(t.headers=o=CT.from(o),t.url=Eb(MT(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),ob.isFormData(s))if(bN.hasStandardBrowserEnv||bN.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(n=o.getContentType())){const[e,...t]=n?n.split(";").map(e=>k_(e).call(e)).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(bN.hasStandardBrowserEnv&&(i&&ob.isFunction(i)&&(i=i(t)),i||!1!==i&&jT(t.url))){const e=r&&a&&LT.read(a);e&&o.set(r,e)}return t},GT="undefined"!=typeof XMLHttpRequest&&function(e){return new np(function(t,n){const s=BT(e);let i=s.data;const r=CT.from(s.headers).normalize();let a,o,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=s;function m(){l&&l(),d&&d(),s.cancelToken&&s.cancelToken.unsubscribe(a),s.signal&&s.signal.removeEventListener("abort",a)}let f=new XMLHttpRequest;function g(){if(!f)return;const s=CT.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());OT(function(e){t(e),m()},function(e){n(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:s,config:e,request:f}),f=null}f.open(s.method.toUpperCase(),s.url,!0),f.timeout=s.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(n(new cb("Request aborted",cb.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new cb("Network Error",cb.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const i=s.transitional||xb;s.timeoutErrorMessage&&(t=s.timeoutErrorMessage),n(new cb(t,i.clarifyTimeoutError?cb.ETIMEDOUT:cb.ECONNABORTED,e,f)),f=null},void 0===i&&r.setContentType(null),"setRequestHeader"in f&&ob.forEach(r.toJSON(),function(e,t){f.setRequestHeader(t,e)}),ob.isUndefined(s.withCredentials)||(f.withCredentials=!!s.withCredentials),u&&"json"!==u&&(f.responseType=s.responseType),p&&([c,d]=kT(p,!0),f.addEventListener("progress",c)),h&&f.upload&&([o,l]=kT(h),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",l)),(s.cancelToken||s.signal)&&(a=t=>{f&&(n(!t||t.type?new AT(null,e,f):t),f.abort(),f=null)},s.cancelToken&&s.cancelToken.subscribe(a),s.signal&&(s.signal.aborted?a():s.signal.addEventListener("abort",a)));const y=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(s.url);y&&-1===bN.protocols.indexOf(y)?n(new cb("Unsupported protocol "+y+":",cb.ERR_BAD_REQUEST,e)):f.send(i||null)})},WT=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,s=new AbortController;const i=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;s.abort(t instanceof cb?t:new AT(t instanceof Error?t.message:t))}};let r=t&&setTimeout(()=>{r=null,i(new cb("timeout ".concat(t," of ms exceeded"),cb.ETIMEDOUT))},t);const a=()=>{e&&(r&&clearTimeout(r),r=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:o}=s;return o.unsubscribe=()=>ob.asap(a),o}},HT=s(tp),KT=cx.f("asyncIterator"),zT=s(KT);function qT(e,t){this.v=e,this.k=t}function YT(e){return function(){return new XT(e.apply(this,arguments))}}function XT(e){var t,n;function s(t,n){try{var r=e[t](n),a=r.value,o=a instanceof qT;HT.resolve(o?a.v:a).then(function(n){if(o){var c="return"===t?"return":"next";if(!a.k||n.done)return s(c,n);n=e[c](n).value}i(r.done?"return":"normal",n)},function(e){s("throw",e)})}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?s(t.key,t.arg):n=null}this._invoke=function(e,i){return new HT(function(r,a){var o={key:e,arg:i,resolve:r,reject:a,next:null};n?n=n.next=o:(t=n=o,s(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}function JT(e){return new qT(e,0)}function QT(e){var t={},n=!1;function s(t,s){return n=!0,s=new HT(function(n){n(e[t](s))}),{done:!1,value:new qT(s,1)}}return t[void 0!==aN&&oN||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):s("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return s("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):s("return",e)}),t}XT.prototype["function"==typeof aN&&zT||"@@asyncIterator"]=function(){return this},XT.prototype.next=function(e){return this._invoke("next",e)},XT.prototype.throw=function(e){return this._invoke("throw",e)},XT.prototype.return=function(e){return this._invoke("return",e)};var ZT=s(KT);function $T(e){var t,n,s,i=2;for("undefined"!=typeof Symbol&&(n=ZT,s=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(s&&null!=(t=e[s]))return new eC(t.call(e));n="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function eC(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then(function(e){return{value:e,done:t}})}return eC=function(e){this.s=e,this.n=e.next},eC.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new eC(e)}const tC=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let s,i=0;for(;i<n;)s=i+t,yield e.slice(i,s),i=s},nC=function(){var e=YT(function*(e,t){var n,s=!1,i=!1;try{for(var r,a=$T(sC(e));s=!(r=yield JT(a.next())).done;s=!1){const e=r.value;yield*QT($T(tC(e,t)))}}catch(e){i=!0,n=e}finally{try{s&&null!=a.return&&(yield JT(a.return()))}finally{if(i)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),sC=function(){var e=YT(function*(e){if(e[ZT])return void(yield*QT($T(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield JT(t.read());if(e)break;yield n}}finally{yield JT(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),iC=(e,t,n,s)=>{const i=nC(e,t);let r,a=0,o=e=>{r||(r=!0,s&&s(e))};return new ReadableStream({async pull(e){try{const{done:t,value:s}=await i.next();if(t)return o(),void e.close();let r=s.byteLength;if(n){let e=a+=r;n(e)}e.enqueue(new Uint8Array(s))}catch(e){throw o(e),e}},cancel:e=>(o(e),i.return())},{highWaterMark:2})};function rC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function aC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rC(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const oC="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,cC=oC&&"function"==typeof ReadableStream,lC=oC&&("function"==typeof TextEncoder?(dC=new TextEncoder,e=>dC.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var dC;const uC=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return!!e(...n)}catch(e){return!1}},hC=cC&&uC(()=>{let e=!1;const t=new Request(bN.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),pC=cC&&uC(()=>ob.isReadableStream(new Response("").body)),mC={stream:pC&&(e=>e.body)};var fC;oC&&(fC=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!mC[e]&&(mC[e]=ob.isFunction(fC[e])?t=>t[e]():(t,n)=>{throw new cb("Response type '".concat(e,"' is not supported"),cb.ERR_NOT_SUPPORT,n)})}));const gC=async(e,t)=>{const n=ob.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(ob.isBlob(e))return e.size;if(ob.isSpecCompliantForm(e)){const t=new Request(bN.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return ob.isArrayBufferView(e)||ob.isArrayBuffer(e)?e.byteLength:(ob.isURLSearchParams(e)&&(e+=""),ob.isString(e)?(await lC(e)).byteLength:void 0)})(t):n};var yC=oC&&(async e=>{let{url:t,method:n,data:s,signal:i,cancelToken:r,timeout:a,onDownloadProgress:o,onUploadProgress:c,responseType:l,headers:d,withCredentials:u="same-origin",fetchOptions:h}=BT(e);l=l?(l+"").toLowerCase():"text";let p,m=WT([i,r&&r.toAbortSignal()],a);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(c&&hC&&"get"!==n&&"head"!==n&&0!==(g=await gC(d,s))){let e,n=new Request(t,{method:"POST",body:s,duplex:"half"});if(ob.isFormData(s)&&(e=n.headers.get("content-type"))&&d.setContentType(e),n.body){const[e,t]=DT(g,kT(PT(c)));s=iC(n.body,65536,e,t)}}ob.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,aC(aC({},h),{},{signal:m,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:i?u:void 0}));let r=await fetch(p);const a=pC&&("stream"===l||"response"===l);if(pC&&(o||a&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=r[t]});const t=ob.toFiniteNumber(r.headers.get("content-length")),[n,s]=o&&DT(t,kT(PT(o),!0))||[];r=new Response(iC(r.body,65536,n,()=>{s&&s(),f&&f()}),e)}l=l||"text";let y=await mC[ob.findKey(mC,l)||"text"](r,e);return!a&&f&&f(),await new np((t,n)=>{OT(t,n,{data:y,headers:CT.from(r.headers),status:r.status,statusText:r.statusText,config:e,request:p})})}catch(t){if(f&&f(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new cb("Network Error",cb.ERR_NETWORK,e,p),{cause:t.cause||t});throw cb.from(t,t&&t.code,e,p)}});const vC={http:null,xhr:GT,fetch:yC};ob.forEach(vC,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const _C=e=>"- ".concat(e),EC=e=>ob.isFunction(e)||null===e||!1===e;var bC={getAdapter:e=>{e=ob.isArray(e)?e:[e];const{length:t}=e;let n,s;const i={};for(let r=0;r<t;r++){let t;if(n=e[r],s=n,!EC(n)&&(s=vC[(t=String(n)).toLowerCase()],void 0===s))throw new cb("Unknown adapter '".concat(t,"'"));if(s)break;i[t||"#"+r]=s}if(!s){const e=Object.entries(i).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});throw new cb("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(_C).join("\n"):" "+_C(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return s},adapters:vC};function xC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new AT(null,e)}function wC(e){return xC(e),e.headers=CT.from(e.headers),e.data=RT.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),bC.getAdapter(e.adapter||ET.adapter)(e).then(function(t){return xC(e),t.data=RT.call(e,e.transformResponse,t),t.headers=CT.from(t.headers),t},function(t){return IT(t)||(xC(e),t&&t.response&&(t.response.data=RT.call(e,e.transformResponse,t.response),t.response.headers=CT.from(t.response.headers))),np.reject(t)})}const SC="1.9.0",NC={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{NC[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const TC={};NC.transitional=function(e,t,n){function s(e,t){return"[Axios v"+SC+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,r)=>{if(!1===e)throw new cb(s(i," has been removed"+(t?" in "+t:"")),cb.ERR_DEPRECATED);return t&&!TC[i]&&(TC[i]=!0,console.warn(s(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,r)}},NC.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var CC={assertOptions:function(e,t,n){if("object"!=typeof e)throw new cb("options must be an object",cb.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let i=s.length;for(;i-- >0;){const r=s[i],a=t[r];if(a){const t=e[r],n=void 0===t||a(t,r,e);if(!0!==n)throw new cb("option "+r+" must be "+n,cb.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new cb("Unknown option "+r,cb.ERR_BAD_OPTION)}},validators:NC};const RC=CC.validators;let IC=class{constructor(e){this.defaults=e||{},this.interceptors={request:new bb,response:new bb}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=FT(this.defaults,t);const{transitional:n,paramsSerializer:s,headers:i}=t;void 0!==n&&CC.assertOptions(n,{silentJSONParsing:RC.transitional(RC.boolean),forcedJSONParsing:RC.transitional(RC.boolean),clarifyTimeoutError:RC.transitional(RC.boolean)},!1),null!=s&&(ob.isFunction(s)?t.paramsSerializer={serialize:s}:CC.assertOptions(s,{encode:RC.function,serialize:RC.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),CC.assertOptions(t,{baseUrl:RC.spelling("baseURL"),withXsrfToken:RC.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let r=i&&ob.merge(i.common,i[t.method]);i&&ob.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=CT.concat(r,i);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const c=[];let l;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let d,u=0;if(!o){const e=[wC.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),d=e.length,l=np.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=a.length;let h=t;for(u=0;u<d;){const t=a[u++],n=a[u++];try{h=t(h)}catch(e){n.call(this,e);break}}try{l=wC.call(this,h)}catch(e){return np.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return Eb(MT((e=FT(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ob.forEach(["delete","get","head","options"],function(e){IC.prototype[e]=function(t,n){return this.request(FT(n||{},{method:e,url:t,data:(n||{}).data}))}}),ob.forEach(["post","put","patch"],function(e){function t(t){return function(n,s,i){return this.request(FT(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:s}))}}IC.prototype[e]=t(),IC.prototype[e+"Form"]=t(!0)});var AC=IC;class OC{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new np(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const s=new np(e=>{n.subscribe(e),t=e}).then(e);return s.cancel=function(){n.unsubscribe(t)},s},e(function(e,s,i){n.reason||(n.reason=new AT(e,s,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new OC(function(t){e=t}),cancel:e}}}var kC=OC;const DC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(DC).forEach(e=>{let[t,n]=e;DC[n]=t});var PC=DC;const jC=function e(t){const n=new AC(t),s=vE(AC.prototype.request,n);return ob.extend(s,AC.prototype,n,{allOwnKeys:!0}),ob.extend(s,n,null,{allOwnKeys:!0}),s.create=function(n){return e(FT(t,n))},s}(ET);jC.Axios=AC,jC.CanceledError=AT,jC.CancelToken=kC,jC.isCancel=IT,jC.VERSION=SC,jC.toFormData=fb,jC.AxiosError=cb,jC.Cancel=jC.CanceledError,jC.all=function(e){return np.all(e)},jC.spread=function(e){return function(t){return e.apply(null,t)}},jC.isAxiosError=function(e){return ob.isObject(e)&&!0===e.isAxiosError},jC.mergeConfig=FT,jC.AxiosHeaders=CT,jC.formToJSON=e=>vT(ob.isHTMLForm(e)?new FormData(e):e),jC.getAdapter=bC.getAdapter,jC.HttpStatusCode=PC,jC.default=jC;var LC=jC;const MC=()=>{};function UC(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:MC};return e.promise=new np((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}}),e}const VC=new Map,FC=new Map,BC=new Map;let GC=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),WC=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const HC=new X_;let KC=HC.getResult(),zC=null;function qC(e){if(!zC){e&&HC.setUA(e),KC=HC.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return WC.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return WC.CHROME;case"Safari":case"Mobile Safari":return WC.SAFARI;case"Edge":return WC.EDGE;case"Firefox":return WC.FIREFOX;case"QQ":case"QQBrowser":return WC.QQ;case"Opera":return WC.OPERA;case"WeChat":return WC.WECHAT;default:return e.browser.name||""}}(KC),n=YC(KC),s=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(KC),i=KC.os.version,r=YC(KC,!1),a=KC.device.type;if(!(t&&n&&s&&i))return{name:t,version:n,os:s,osVersion:i,browserVersion:r,deviceType:a};zC={name:t,version:n,os:s,osVersion:i,browserVersion:r,deviceType:a}}return zC}function YC(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function XC(){return qC().os}function JC(){const e=qC();return"".concat(e.os," ").concat(e.osVersion)}function QC(){const e=qC();return!!("WebKit"===KC.engine.name&&e.os===GC.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==WC.SAFARI||sR()&&e.name!==WC.SAFARI)}function ZC(){return qC().name===WC.CHROME}function $C(){return qC().name===WC.SAFARI}function eR(){const e=qC();if(e.name!==WC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}function tR(){return qC().name===WC.EDGE}function nR(){return qC().name===WC.FIREFOX}function sR(){return qC().os===GC.IOS}function iR(e){const t=qC();return!(t.name!==WC.CHROME||!t.osVersion)&&Number(t.version)>=e}function rR(e){const t=qC();return!(t.name!==WC.CHROME||!t.osVersion)&&Number(t.version)<e}function aR(e,t,n){const s=qC();return!(s.name!==e||!s.osVersion)&&(n?Number(s.version)>=t&&Number(s.version)<=n:Number(s.version)===t)}function oR(e){const t=qC();return!(t.name!==WC.EDGE||!t.osVersion)&&Number(t.version)>=e}function cR(e){const t=qC();return!(t.name!==WC.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function lR(e){const t=qC();return!(t.name!==WC.SAFARI||!t.osVersion)&&Number(t.version)>=e}function dR(e,t,n){const s=qC();if(s.os!==GC.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function uR(e,t,n){const s=qC();if(s.os!==GC.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function hR(e,t,n){const s=qC();if(s.name!==WC.SAFARI||!s.osVersion||!s.browserVersion)return!1;const i=s.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function pR(e){const t=qC();return!(t.name!==WC.OPERA||!t.osVersion)&&Number(t.version)>=e}function mR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function fR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function gR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function yR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function vR(){return $C()&&navigator.maxTouchPoints>0}function _R(){return qC().name===WC.WECHAT}function ER(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function bR(){const e=XC();return function(){const{deviceType:e}=qC();return"mobile"===e||"tablet"===e}()||e===GC.ANDROID||e===GC.IOS||e===GC.HARMONY_OS}function xR(){const e=qC();return e.name!==WC.EDGE&&e.name!==WC.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function wR(){return XC()===GC.ANDROID}function SR(){const e=qC();return wR()&&(e.name===WC.CHROME||e.name===WC.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function NR(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function CR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TR(Object(n),!0).forEach(function(t){NR(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TR(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let RR=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),IR=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),NR(this,"code",void 0),NR(this,"message",void 0),NR(this,"data",void 0),NR(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function AR(e,t){if("boolean"!=typeof e)throw new IR(RR.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function OR(e,t,n){if(!Ps(n).call(n,e))throw new IR(RR.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function kR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>s||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new IR(RR.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(s,"]. integer only"))}function DR(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new IR(RR.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&kR(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&kR(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&kR(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&kR(e.ideal,"".concat(t,".ideal"),1,1/0)}else kR(e,t,1,1/0)}function PR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new IR(RR.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!MR(e,n,s,i))throw new IR(RR.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(s,"].").concat(i?" ASCII characters only.":""))}function jR(e,t){if(!Array.isArray(e))throw new IR(RR.INVALID_PARAMS,"".concat(t," should be an array"))}function LR(e){return null==e}function MR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!s||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var UR=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(UR||{}),VR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(VR||{});const FR=new class{constructor(){NR(this,"_clientSize",null),NR(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),NR(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),NR(this,"getStyle",e=>window.getComputedStyle(e,null)),NR(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const s=this.getStyle(e),{display:i,visibility:r,opacity:a,filter:o}=s;return("none"===i||Ps(t=["hidden","collapse"]).call(t,r)||Number(a)<.1)&&(n=!1),!!n&&(o&&o.split(" ").filter(e=>{var t;const n=e.split("(")[0];return Ps(t=["brightness","blur","opacity"]).call(t,n)}).map(e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]}).forEach(e=>{const[t,s]=e;switch(t){case"brightness":(s<.1||s>3)&&(n=!1);break;case"blur":s>3&&(n=!1);break;case"opacity":s<.1&&(n=!1)}}),n)}),NR(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,s=!0;const i=e=>t(e);let r=e;for(;r&&s;)i(r)||(n=!1,s=!1),r=r.parentElement,r||(s=!1);return n}),NR(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),NR(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:s,right:i,top:r,bottom:a}=e.getBoundingClientRect(),o=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:s,right:i,top:r,bottom:a,clientWidth:o,clientHeight:c,clientMin:Math.min(o,c)}}),NR(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),NR(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),NR(this,"checkCoverForAPoint",(e,t,n)=>{const s=this.elementFromPoint(e,t);return null!==s&&s!==n}),NR(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:s}=this._clientSize,i=e/6,r=t/6,a=[],o=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*o+(0===c?.1:4===c?(i*c*o-1e5)/o:i*c)*o)/o,l=(s*o+(0===e?.1:4===e?(r*e*o-1e5)/o:r*e)*o)/o;a.push({x:t,y:l})}return[...a]}),NR(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(e=>!!e).length>6),NR(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),NR(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:s,clientHeight:i,clientWidth:r,clientMin:a}=this._clientSize;let o,c,l,d;if(e<0)o=0;else{if(!(e<r))return!1;o=e}if(t<0)return!1;if(c=t<r?t:r,n<0)l=0;else{if(!(n<i))return!1;l=n}if(s<0)return!1;d=s<i?s:i;const u=c-o,h=d-l;return this.checkSizeIsVisible(u,h,a)}),NR(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),NR(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(UR.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(UR.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(UR.SIZE)}}return this.returnHiddenResult(UR.STYLE)}return this.returnHiddenResult(VR.UNMOUNTED)}return this.returnHiddenResult(VR.INVALID_HTML_ELEMENT)}),NR(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))}};function BR(e){return(new TextEncoder).encode(e)}const GR=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},WR=async e=>function(e,t){let n="";return new Uint8Array(e).forEach(e=>{n+=e.toString(t).padStart(2,"0")}),n}(await crypto.subtle.digest("SHA-256",BR(e)),16);class HR{constructor(){NR(this,"_events",{}),NR(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],s=this._indexOfListener(n,t);-1!==s&&n.splice(s,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(e=>e);for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];for(let r=0;r<t.length;r+=1){const n=t[r];n.once&&this.off(e,n.listener),n.listener.apply(this,s||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];[...this._events[e]||[]].forEach(t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}let KR=null;function zR(){if(KR)return KR;if(window.electron)return KR=window.electron;if(!window.require)return null;try{return KR=window.require("electron"),KR}catch(e){return null}}let qR=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),YR=function(e){return e.TRACER="tracer",e}({});function XR(e){return kR(e.timeout,"config.timeout",0,1e5),kR(e.timeoutFactor,"config.timeoutFactor",0,100,!1),kR(e.maxRetryCount,"config.maxRetryConfig",0,1/0),kR(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let JR=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),QR=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ZR(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(e=>{if(!e.urls)throw Error()})}catch(e){return!1}return!0}function $R(e){return PR(e.turnServerURL,"turnServerURL"),PR(e.username,"username"),PR(e.password,"password"),e.udpport&&kR(e.udpport,"udpport",1,99999,!0),e.forceturn&&AR(e.forceturn,"forceturn"),e.security&&AR(e.security,"security"),e.tcpport&&kR(e.tcpport,"tcpport",1,99999,!0),!0}function eI(e){return void 0!==e.level&&OR(e.level,"level",[1,2,3]),void 0!==e.delay&&kR(e.delay,"delay",0,3e3,!0),!0}let tI=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),nI=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),sI=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),iI=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function rI(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];return 0===e.getListeners(t).length?np.reject(new IR(RR.UNEXPECTED_ERROR,"can not emit promise")):new np((n,i)=>{e.emit(t,...s,n,i)})}function aI(e,t){if(0===e.getListeners(t).length)return np.resolve();for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];return rI(e,t,...s)}function oI(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];return cI(e,t,...s)}function cI(e,t){let n=null,s=null;for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];if(e.emit(t,...r,e=>{n=e},e=>{s=e}),null!==s)throw s;if(null===n)throw new IR(RR.UNEXPECTED_ERROR,"handler is not sync");return n}const lI=new class extends HR{set networkState(e){this.emit(iI.NETWORK_STATE_CHANGE,e,this._networkState),e===sI.ONLINE?this.emit(iI.ONLINE):e===sI.OFFLINE&&(this.onlineWaiter=new np(e=>{this.once(iI.ONLINE,()=>{this.onlineWaiter=void 0,e(sI.ONLINE)})}),this.emit(iI.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===sI.ONLINE}constructor(){super(),NR(this,"_moduleName","network-indicator"),NR(this,"_networkState",sI.ONLINE),NR(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=sI.ONLINE}),window.addEventListener("offline",()=>{this.networkState=sI.OFFLINE})}};function dI(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function uI(e){const t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function hI(e){void 0!==np?np.resolve().then(e):setTimeout(e,0)}function pI(e){return JSON.parse(JSON.stringify(e))}function mI(e){try{return pI(e)}catch(t){return e}}const fI={};function gI(e,t){fI[t]||(fI[t]=!0,e())}function yI(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let s=0;s<t.length;s+=1)n[s]=t.charCodeAt(s);return n}function vI(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function _I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function EI(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=ii(t).call(t,(e,t)=>e+t.length,0),i=new Uint8Array(new ArrayBuffer(s));let r=0;return t.forEach(e=>{i.set(e,r),r+=e.length}),i}function bI(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function xI(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(e=>{t+="string"==typeof e?bI(e):e.size}),t+138}function wI(e){const t=new IR(RR.TIMEOUT,"timeout");return new np((n,s)=>{window.setTimeout(()=>s(t),e)})}function SI(e){return new np(t=>{window.setTimeout(t,e)})}function NI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+NI(e-n.length,"")}function TI(){return NI(32,"").toUpperCase()}const CI=()=>{},RI=new class{constructor(){NR(this,"fnMap",new Map)}throttleByKey(e,t,n,s){for(var i=arguments.length,r=new Array(i>4?i-4:0),a=4;a<i;a++)r[a-4]=arguments[a];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const a=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:r,skipFn:s})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,CR(CR({},i),{},{fn:e,args:r,skipFn:s}))}else{const i=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:r,skipFn:s})}}},II=RI.throttleByKey.bind(RI);function AI(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function OI(e,t){if(!AI(e)||!AI(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let s=0;s<t.length;s++)n[s]=OI(e[s],t[s]);return n}{const n=CR({},e);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(Object.prototype.hasOwnProperty.call(e,s)?n[s]=OI(e[s],t[s]):n[s]=t[s]);return n}}function kI(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let s=0;for(;e>0&&(n[s]=255&e,e>>=8,s++,!t||s!==t););return n}function DI(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function PI(e){return ii(e).call(e,(e,t)=>e+t,0)}function jI(e){const t="0123456789abcdef";function n(e){let n,s="";for(n=0;n<=3;n++)s+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return s}function s(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,r,a){return s(function(e,t){return e<<t|e>>>32-t}(s(s(t,e),s(i,a)),r),n)}function r(e,t,n,s,r,a,o){return i(t&n|~t&s,e,t,r,a,o)}function a(e,t,n,s,r,a,o){return i(t&s|n&~s,e,t,r,a,o)}function o(e,t,n,s,r,a,o){return i(t^n^s,e,t,r,a,o)}function c(e,t,n,s,r,a,o){return i(n^(t|~s),e,t,r,a,o)}const l=function(e){let t;const n=1+(e.length+8>>6),s=new Array(16*n);for(t=0;t<16*n;t++)s[t]=0;for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<t%4*8;return s[t>>2]|=128<<t%4*8,s[16*n-2]=8*e.length,s}(e);let d,u,h,p,m,f=1732584193,g=-271733879,y=-1732584194,v=271733878;for(d=0;d<l.length;d+=16)u=f,h=g,p=y,m=v,f=r(f,g,y,v,l[d+0],7,-680876936),v=r(v,f,g,y,l[d+1],12,-389564586),y=r(y,v,f,g,l[d+2],17,606105819),g=r(g,y,v,f,l[d+3],22,-1044525330),f=r(f,g,y,v,l[d+4],7,-176418897),v=r(v,f,g,y,l[d+5],12,1200080426),y=r(y,v,f,g,l[d+6],17,-1473231341),g=r(g,y,v,f,l[d+7],22,-45705983),f=r(f,g,y,v,l[d+8],7,1770035416),v=r(v,f,g,y,l[d+9],12,-1958414417),y=r(y,v,f,g,l[d+10],17,-42063),g=r(g,y,v,f,l[d+11],22,-1990404162),f=r(f,g,y,v,l[d+12],7,1804603682),v=r(v,f,g,y,l[d+13],12,-40341101),y=r(y,v,f,g,l[d+14],17,-1502002290),g=r(g,y,v,f,l[d+15],22,1236535329),f=a(f,g,y,v,l[d+1],5,-165796510),v=a(v,f,g,y,l[d+6],9,-1069501632),y=a(y,v,f,g,l[d+11],14,643717713),g=a(g,y,v,f,l[d+0],20,-373897302),f=a(f,g,y,v,l[d+5],5,-701558691),v=a(v,f,g,y,l[d+10],9,38016083),y=a(y,v,f,g,l[d+15],14,-660478335),g=a(g,y,v,f,l[d+4],20,-405537848),f=a(f,g,y,v,l[d+9],5,568446438),v=a(v,f,g,y,l[d+14],9,-1019803690),y=a(y,v,f,g,l[d+3],14,-187363961),g=a(g,y,v,f,l[d+8],20,1163531501),f=a(f,g,y,v,l[d+13],5,-1444681467),v=a(v,f,g,y,l[d+2],9,-51403784),y=a(y,v,f,g,l[d+7],14,1735328473),g=a(g,y,v,f,l[d+12],20,-1926607734),f=o(f,g,y,v,l[d+5],4,-378558),v=o(v,f,g,y,l[d+8],11,-2022574463),y=o(y,v,f,g,l[d+11],16,1839030562),g=o(g,y,v,f,l[d+14],23,-35309556),f=o(f,g,y,v,l[d+1],4,-1530992060),v=o(v,f,g,y,l[d+4],11,1272893353),y=o(y,v,f,g,l[d+7],16,-155497632),g=o(g,y,v,f,l[d+10],23,-1094730640),f=o(f,g,y,v,l[d+13],4,681279174),v=o(v,f,g,y,l[d+0],11,-358537222),y=o(y,v,f,g,l[d+3],16,-722521979),g=o(g,y,v,f,l[d+6],23,76029189),f=o(f,g,y,v,l[d+9],4,-640364487),v=o(v,f,g,y,l[d+12],11,-421815835),y=o(y,v,f,g,l[d+15],16,530742520),g=o(g,y,v,f,l[d+2],23,-995338651),f=c(f,g,y,v,l[d+0],6,-198630844),v=c(v,f,g,y,l[d+7],10,1126891415),y=c(y,v,f,g,l[d+14],15,-1416354905),g=c(g,y,v,f,l[d+5],21,-57434055),f=c(f,g,y,v,l[d+12],6,1700485571),v=c(v,f,g,y,l[d+3],10,-1894986606),y=c(y,v,f,g,l[d+10],15,-1051523),g=c(g,y,v,f,l[d+1],21,-2054922799),f=c(f,g,y,v,l[d+8],6,1873313359),v=c(v,f,g,y,l[d+15],10,-30611744),y=c(y,v,f,g,l[d+6],15,-1560198380),g=c(g,y,v,f,l[d+13],21,1309151649),f=c(f,g,y,v,l[d+4],6,-145523070),v=c(v,f,g,y,l[d+11],10,-1120210379),y=c(y,v,f,g,l[d+2],15,718787259),g=c(g,y,v,f,l[d+9],21,-343485551),f=s(f,u),g=s(g,h),y=s(y,p),v=s(v,m);return n(f)+n(g)+n(y)+n(v)}let LI=1,MI=console,UI=class{static setLogger(e){MI=e}constructor(e,t){NR(this,"id",void 0),NR(this,"lockingPromise",np.resolve()),NR(this,"locks",0),NR(this,"name",""),NR(this,"lockId",void 0),this.lockId=LI++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");MI.debug("".concat(n," ").concat(s))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new np(n=>{t=()=>{this.locks-=1,this.logger("unlocked",e),n()}}),s=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),s}};function VI(e,t){return function(n,s,i){const r=i.value;if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(s));try{for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return await r.apply(this,o)}finally{i()}},i}}const FI={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function BI(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function GI(e,t,n,s){const i=Object.assign({},FI,s);let r=i.timeout;const a=async()=>{await function(e){return new np(t=>{window.setTimeout(t,e)})}(r),r*=i.timeoutFactor,r=Math.min(i.maxRetryTimeout,r)};let o=!1;const c=new np(async(s,r)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(o)return r(new IR(RR.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return s(n);if(c+1===i.maxRetryCount)return s(n);await a()}catch(e){if(!n(e,c))return r(e);if(c+1===i.maxRetryCount)return r(e);await a()}}});return c.cancel=()=>o=!0,c}let WI,HI=class{constructor(e){NR(this,"input",[]),NR(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:ii(e=this.input).call(e,(e,t)=>e+t)/this.input.length}},KI=0,zI=0;function qI(e,t,n,s){return new np((i,r)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),KI+=bI(t.data)):n&&(t.data.size?KI+=t.data.size:t.data instanceof FormData?KI+=xI(t.data):KI+=bI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,LC.request(t).then(e=>{"string"==typeof e.data?zI+=bI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?zI+=e.data.byteLength:zI+=bI(JSON.stringify(e.data)),s&&i({data:e.data,headers:e.headers}),i(e.data)}).catch(e=>{LC.isCancel(e)?r(new IR(RR.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?r(new IR(RR.NETWORK_TIMEOUT,e.message)):e.response?r(new IR(RR.NETWORK_RESPONSE_ERROR,e.response.status)):r(new IR(RR.NETWORK_ERROR,e.message))})})}async function YI(e,t){const n=new Blob([t.data],{type:"buffer"});return await qI(e,CR(CR({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XI=()=>void 0!==window.isSecureContext;function JI(e){if(Array.isArray(e))return e.map(e=>e);if(!QI(e))return e;const t={};for(const n in e){const s=e[n];QI(s)||Array.isArray(s)?t[n]=JI(s):t[n]=s}return t}function QI(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let ZI=class{constructor(e){NR(this,"input",[]),NR(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const $I={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},eA={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:$I,remoteCandidate:$I},updateInterval:0},tA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},nA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},sA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},iA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let rA=class{constructor(e,t){NR(this,"onFirstVideoReceived",void 0),NR(this,"onFirstVideoDecoded",void 0),NR(this,"onFirstAudioReceived",void 0),NR(this,"onFirstVideoDecodedTimeout",void 0),NR(this,"onFirstAudioDecoded",void 0),NR(this,"onSelectedLocalCandidateChanged",void 0),NR(this,"onSelectedRemoteCandidateChanged",void 0),NR(this,"videoIsReady",!1),NR(this,"videoIsReady2",{}),NR(this,"pc",void 0),NR(this,"options",void 0),NR(this,"intervalTimer",void 0),NR(this,"stats",JI(eA)),NR(this,"isFirstVideoReceived",{}),NR(this,"isFirstVideoDecoded",{}),NR(this,"isFirstAudioReceived",{}),NR(this,"isFirstAudioDecoded",{}),NR(this,"isFirstVideoDecodedTimeout",{}),NR(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new np(e=>{e({local:CR({},$I),remote:CR({},$I)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,i=0,r=0,a=0;for(const o of n)e[o].forEach((e,n)=>{if(!this.lossRateWindowStats[t-1][o][n]||!this.lossRateWindowStats[0][o][n])return;const c=this.lossRateWindowStats[t-1][o][n].packets-this.lossRateWindowStats[0][o][n].packets,l=this.lossRateWindowStats[t-1][o][n].packetsLost-this.lossRateWindowStats[0][o][n].packetsLost;"videoSend"===o||"audioSend"===o?(s+=c,r+=l):(i+=c,a+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)});e.sendPacketLossRate=s<=0||r<=0?0:r/(s+r),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}},aA=class extends rA{constructor(){super(...arguments),NR(this,"_stats",eA),NR(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=JI(eA);const n=t.filter(e=>"ssrc"===e.type);this.processSSRCStats(n);const s=t.find(e=>"VideoBwe"===e.type);s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(e=>{var t;const n=Ps(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=JI(nA);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=JI(tA),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const s=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=s.framesDecodeFreezeTime,t.framesDecodeInterval=s.framesDecodeInterval,t.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CR({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=JI(iA);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=JI(sA);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}})}_getStats(){return new np((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t.push(n)}),t}},oA=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),cA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),lA=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),dA=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var uA=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(uA||{});function hA(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:uA.kNone;if(!t)return;const r=Number(t[n]);if("number"!=typeof r)return;const a=Number(t[s]);if("number"!=typeof a)return;if(!e)return a?r/a*i:void 0;const o=Number(e[n]);if("number"!=typeof o)return;const c=Number(e[s]);if("number"!=typeof c)return;const l=a-c;return l?(r-o)/l*i:void 0}let pA=class extends rA{constructor(){super(...arguments),NR(this,"_stats",eA),NR(this,"report",void 0),NR(this,"lastDecodeVideoReceiverStats",new Map),NR(this,"lastVideoFramesRecv",new Map),NR(this,"lastVideoFramesSent",new Map),NR(this,"lastVideoFramesDecode",new Map),NR(this,"lastVideoFramesOutput",new Map),NR(this,"lastVideoJBDelay",new Map),NR(this,"lastAudioJBDelay",new Map),NR(this,"mediaBytesSent",new Map),NR(this,"mediaBytesRetransmit",new Map),NR(this,"mediaBytesTargetEncode",new Map),NR(this,"lastDecodeAudioReceiverStats",new Map),NR(this,"lastAudioConcealment",new Map),NR(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=JI(eA),this.report.forEach(e=>{switch(e.type){case dA.OUTBOUND:case dA.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,s=!t&&!("frameWidth"in e);e.type===dA.OUTBOUND?"audio"===t||s?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===dA.INBOUND&&("audio"===t||s?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case dA.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case dA.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:CR({},$I),remote:CR({},$I)};return e.forEach(n=>{let s;if(n.type===dA.TRANSPORT&&(s=e.get(n.selectedCandidatePairId)),n.type===dA.CANDIDATE_PAIR&&n.selected&&(s=n),s){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(s.localCandidateId){const i=e.get(s.localCandidateId);i&&n(t.local,i)}if(s.remoteCandidateId){const i=e.get(s.remoteCandidateId);i&&n(t.remote,i)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===dA.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===dA.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===dA.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(CR({},t),CR({},this.stats.selectedCandidatePair.localCandidate)),e.type===dA.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(CR({},t),CR({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(t=>t.ssrc===e.ssrc);t||(t=JI(iA),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=hA(n,t,"totalProcessingDelay","jitterBufferEmittedCount",uA.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,CR({},t))}calculateAudioFreeze(e,t,n){const s=this.lastAudioConcealment.get(e.ssrc);if(null!=t&&null!=s){const i=s.lts,r=n.timestamp,a=r-i;if(a<=0)return;const o=e.concealedSamples-t.concealedSamples-0,c=s.nonSilent+o,l=e.totalSamplesReceived-t.totalSamplesReceived;if(l<=0)return;const d=80*l/a,u=200*l/a,h=a/l;let p=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,c>d&&(s.plc80>0?(e.freezeSamples80+=o,e.freezeMs80+=Math.round(o*h)):(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*h)),p=s.plc80+1);let m=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,c>u&&(s.plc200>0?(e.freezeSamples200+=o,e.freezeMs200+=Math.round(o*h)):(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*h)),m=s.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:o,lts:r,plc80:p,plc200:m})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(t=>t.ssrc===e.ssrc);t||(t=JI(tA),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),s=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),r=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const s=n.stats,i=r-n.lts;t.framesDecodeFreezeTime=s.framesDecodeFreezeTime,t.framesDecodeInterval=s.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<s.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=hA(null==n?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=hA(null==n?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",uA.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=hA(null==n?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",uA.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=hA(null==n?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",uA.kMillisecondsFromSeconds),s&&r-s.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-s.count)/((r-s.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:r,rate:t.decodeFrameRate})):s?t.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:r,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&r-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((r-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:r,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:r,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CR({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(t=>t.ssrc===e.ssrc);t||(t=JI(nA),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new ZI(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new ZI(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new ZI(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/s}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dA.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(t=>t.ssrc===e.ssrc);if(t||(t=JI(sA),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dA.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const s=Array.from(up(n=this.report).call(n)).find(n=>n.type===t&&n.ssrc===e);return s?s.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var s,i,r,a;const o=t?this.report.get(t):void 0,c=null!==(s=null==o?void 0:o.framesSent)&&void 0!==s?s:e.framesSent;if("number"!=typeof c)return;let l=null!==(i=null==o?void 0:o.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(r=null==o?void 0:o.frameHeight)&&void 0!==r?r:e.frameHeight,u=null!==(a=null==o?void 0:o.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof l&&"number"==typeof d||(l=0,d=0),null==u){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(u=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:u})):t?u=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:l,height:d,frameRate:Math.max(0,u)}}processVideoTrackReceiverStats(e,t,n){var s,i,r,a,o;const c=t?this.report.get(t):void 0,l=null!==(s=null==c?void 0:c.framesReceived)&&void 0!==s?s:e.framesReceived,d=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(r=null==c?void 0:c.frameHeight)&&void 0!==r?r:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(o=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let s=0;e&&t-e.lts>=800?(s=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:s})):e?s=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:d||0,height:u||0,frameRate:s||0},n.decodedFrame={width:d||0,height:u||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:d||0,height:u||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const s=p-e.jitterBufferEmittedCount;s>0&&(t=1e3*(h-e.jitterBufferDelay)/s),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var s,i,r,a;const o=t?this.report.get(t):void 0,c=null!==(s=null!==(i=null==o?void 0:o.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==s?s:0,l=null!==(r=null!==(a=null==o?void 0:o.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==r?r:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var s,i,r,a,o,c,l,d,u;const h=t?this.report.get(t):void 0,p=null!==(s=null==h?void 0:h.removedSamplesForAcceleration)&&void 0!==s?s:e.removedSamplesForAcceleration,m=null!==(i=null==h?void 0:h.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,f=null!==(r=null==h?void 0:h.jitterBufferDelay)&&void 0!==r?r:e.jitterBufferDelay,g=null!==(a=null==h?void 0:h.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,y=null!==(o=null==h?void 0:h.audioLevel)&&void 0!==o?o:null==e?void 0:e.audioLevel,v=null!==(c=null==h?void 0:h.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,_=null!==(l=null==h?void 0:h.concealedSamples)&&void 0!==l?l:e.concealedSamples,E=null!==(d=null==h?void 0:h.silentConcealedSamples)&&void 0!==d?d:e.silentConcealedSamples,b=null!==(u=null==h?void 0:h.concealmentEvents)&&void 0!==u?u:e.concealmentEvents;if("number"==typeof m&&(n.totalSamplesReceived=m),"number"==typeof E&&(n.silentConcealedSamples=E),"number"==typeof b&&(n.concealmentEvents=b),"number"==typeof _&&(n.concealedSamples=_),p&&m&&(n.accelerateRate=p/m),f&&g){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const s=g-e.jitterBufferEmittedCount;s>0&&(t=1e3*(f-e.jitterBufferDelay)/s),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:f,jitterBufferEmittedCount:g,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=y;let x=1920;v&&m&&(x=m/v/50,n.receivedFrames=Math.round(m/x)),_&&(n.droppedFrames=Math.round(_/x))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(t=>{e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(e=>{t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(e=>{n=null===n?e.diffMean():n+e.diffMean()});const s=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},mA=class extends rA{updateStats(){return np.resolve()}};function fA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const r=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return r?r<76?new aA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:i}):new pA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof np||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new pA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:i}):new mA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:i})}const gA="websdk_ng_install_id";function yA(){try{if(RA("INSTALL_ID"))return RA("INSTALL_ID");let e=window.localStorage.getItem(gA);return e||(e=TI(),window.localStorage.setItem(gA,e)),CA("INSTALL_ID",e),e}catch(e){return}}const vA=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}return"4.0.0.999"}("4.24.0"),_A=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let EA=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const bA=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const s=n.join(""),i=[];for(let o=0;o<6;o++)i.push("1");const r=i.join(""),a={};return a[e]=s,a[t]=r,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=bA;const xA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},wA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},SA="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",NA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},TA=CR(CR(CR(CR({},NA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:wA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},xA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function CA(e,t,n){var s,i,r;Ps(s=Object.keys(TA)).call(s,e)&&(!n&&Ps(i=Object.keys(AA)).call(i,e)||(TA[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS"!==e||!0!==t||(TA.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(r=!!t,TA.USE_NEW_NETWORK_CONFIG=r,r&&(TA.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],TA.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],TA.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],TA.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],TA.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",TA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",TA.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(TA.ENABLE_INSTANT_VIDEO=!0,TA.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(TA.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(TA.NEW_TURN_MODE||(TA.NEW_TURN_MODE=4))))}function RA(e){return TA[e]}_A||(TA.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],TA.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],TA.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],TA.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],TA.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],TA.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],TA.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",TA.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",TA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",TA.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",TA.AREAS=["NORTH_AMERICA","OVERSEA"]);let IA=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const AA={};var OA=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(OA||{});let kA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const DA=128,PA=96,jA=1e3,LA=10;let MA=0;var UA=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>x,Printer:()=>C,parse:()=>O,print:()=>k});const s="\n",i="".concat("\r").concat(s),r=" ";let a;function o(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function m(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function f(e){return h(e)||o(e)||"+"===e||"/"===e}function g(e){return o(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function y(e){return h(e)||o(e)||"+"===e||"/"===e}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){E(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));class b{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===s)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,r)}consumeOneOrMore(e,t,n){let s=t;for(;n(e[s]);)s++;if(s-t==0)throw new Error("Invalid rule at ".concat(t,"."));return s}consumeSpace(e,t){if(e[t]===r)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let s=0;s<4;s++)if(n=this.consumeDecimalUChar(e,n),3!==s){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&o(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const s=parseInt(e.slice(t,n));if(s>=0&&s<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((s=e[t+n])>="0"&&s<="9"||s>="a"&&s<="f"||s>="A"&&s<="F")){if(0===n)throw new Error("Invalid hex 4");break}var s;return t+n}consumeFQDN(e,t){let n=t;for(;o(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const s=e.slice(t,n),i=parseInt(s);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let r=0;r<3;r++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!u(e[t]))throw new Error("Invalid integer.");for(t+=1;o(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&o(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(u(e[n])&&(n+=1);o(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,r)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,o),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!u(e[t]))throw new Error("Invalid repeat interval");for(t+=1;o(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,o)}consume(e,t,n){for(let s=0;s<n.length;s++){if(t+s>=e.length)throw new Error("consume exceeding value length");if(e[t+s]!==n[s])throw new Error("consume ".concat(n," failed at ").concat(s))}return t+n.length}consumeTill(e,t,n){let s=t;for(;s<e.length&&("string"!=typeof n||e[s]!==n)&&("function"!=typeof n||!n(e[s]));)s++;return s}}class x extends b{constructor(){super(),E(this,"records",[]),E(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter(e=>!!k_(e).call(e)).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),s=this.parseOrigin(),i=this.parseSessionName(),r=this.parseInformation(),a=this.parseUri(),o=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),d=this.parseBandWidth(),u=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),m=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:s,sessionName:i,information:r,uri:a,emails:o,phones:c,connection:l,bandwidths:d,timeFields:u,key:h,attributes:p,mediaDescriptions:m}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===s)return"\r"===e[t-1]?i:s;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new S;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,e=>d(e)&&":"!==e),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,m)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new N(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,e=>d(e)&&":"!==e),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,m)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let s=!1;"-"===e.value[e.cur]&&(s=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:s})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),s=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:s}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;{const n=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const s=this.extractOneOrMore(t,o);e.push({bwtype:n,bandwidth:s}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,o));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const s=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:s,nettype:i,addrtype:r,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==a.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===a.CONNECTION){const t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const s=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:s}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const s=[];for(s.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,s.push(this.extract(e,this.consumeToken));if(0===s.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:s,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===a.TIME;){const t=this.parseTime(),n=this.parseRepeat(),s=this.parseZone();e.push({time:t,repeats:n,zones:s})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),s=this.parseConnections(),i=this.parseBandWidth(),r=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:s,bandwidths:i,key:r,attributes:a})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];const r=t.call(this,e.value,e.cur,...s),a=e.value.slice(e.cur,r);return e.cur=r,a}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),s=e.value.slice(e.cur,n);return e.cur=n,s}consumeSpaceForRecord(e){if(e.value[e.cur]!==r)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class w extends b{constructor(){super(...arguments),E(this,"attributes",void 0),E(this,"digested",!1)}extractOneOrMore(e,t,n){const s=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,s),[r,a]=n||[];if("number"==typeof r&&i.length<r)throw new Error("error in length, should be more or equal than ".concat(r," characters."));if("number"==typeof a&&i.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=s,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==r)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];const r=t.call(this,e.attValue,e._cur,...s),a=e.attValue.slice(e._cur,r);return e._cur=r,a}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,o);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeTill,r),i=_(_({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:s});this.peekChar(e)===r&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class S extends w{constructor(){super(...arguments),E(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===r;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,y),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===r;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const s=this.extractOneOrMore(e,e=>e!==r&&m(e));n.push({name:t,value:s})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===r&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,r);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class N extends w{constructor(e){super(),E(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,o,[1,10]);this.consumeAttributeSpace(e);const a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const d={foundation:t,componentId:n,transport:s,priority:i,connectionAddress:a,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));this.peekChar(e)===r;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:s,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const s={encodingName:n,clockRate:this.extractOneOrMore(e,o)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),s.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));i?i.rtpMap=s:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:s,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let s;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),s=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find(e=>e.ssrcId===parseInt(t,10));i?i.attributes[n]=s:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:s}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,r);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),s={};n.split(";").forEach(e=>{let[t,n]=e.split("=");t=k_(t).call(t);const i="string"==typeof n?k_(n).call(n):null;"string"==typeof t&&t.length>0&&(s[t]=i)});const i=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));i?i.fmtp={parameters:s}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:s}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const s=this.extract(e,this.consumeTill,";");for(t[n]=s;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const s=this.extract(e,this.consumeTill,";");t[n]=s}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,r),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,r);let s;if("trr-int"===n)s={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===r&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===r&&(t.additional=this.extract(e,this.consumeTill))),s=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(s);else{const e=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));e?e.rtcpFeedbacks.push(s):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[s]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===r&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,d,[1,64])};this.peekChar(e)===r&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,e=>h(e)||o(e)||"_"===e||"-"===e);this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===r){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===r&&this.extract(e,this.consume,r)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const s={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(s);break}default:{const s={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),s.val=this.extract(e,this.consumeTill,";")),n.params.push(s)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,o,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,o,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C{constructor(){T(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map(e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new I(this.eol).print(e)}printMediaAttributes(e){return new A(this.eol).print(e)}}class R{constructor(e){T(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(r)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(e=>"a=fingerprint:".concat(e.hashFunction).concat(r).concat(e.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(r).concat(e.extensionName).concat(e.extensionAttributes?"".concat(r).concat(e.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol)).join("")}}class I extends R{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map(e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map(e=>"".concat(r).concat(e)).join("")).concat(this.eol)).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map(e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map(e=>"".concat(r).concat(e.name).concat(e.value?"=".concat(e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(r,"*"):e.identifierList.length>0&&(t+=e.identifierList.map(e=>"".concat(r).concat(e))),t+this.eol}}class A extends R{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map(e=>"a=candidate:".concat(e.foundation).concat(r).concat(e.componentId).concat(r).concat(e.transport).concat(r).concat(e.priority).concat(r).concat(e.connectionAddress).concat(r).concat(e.port).concat(r,"typ").concat(r).concat(e.type).concat(e.relAddr?"".concat(r,"raddr").concat(r).concat(e.relAddr):"").concat(e.relPort?"".concat(r,"rport").concat(r).concat(e.relPort):"").concat(Object.keys(e.extension).map(t=>"".concat(r).concat(t).concat(r).concat(e.extension[t])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(e=>"a=remote-candidates:".concat(e.join(r)).concat(this.eol)).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map(e=>this.printRTCPFeedback("*",e)).join("");for(const s of t)n+=this.printRtpMap(s.payloadType,s.rtpMap),n+=this.printFmtp(s.payloadType,s.fmtp),n+=s.rtcpFeedbacks.map(e=>this.printRTCPFeedback(s.payloadType,e)).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(r).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(r).concat(Object.keys(t.parameters).map(e=>"".concat(e,"=").concat(t.parameters[e])).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(r).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(r),s=t;return"trr-int"===s.type?n+="ttr-int".concat(r).concat(s.interval):(n+="".concat(s.type),s.parameter&&(n+="".concat(r).concat(s.parameter),s.additional&&(n+="".concat(r).concat(s.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(e=>Object.keys(e.attributes).map(t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(r).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(r).concat(e.netType)),e.addressType&&(t+="".concat(r).concat(e.addressType)),e.address&&(t+="".concat(r).concat(e.address)),t+this.eol}printMSId(e){return e.map(e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(r).concat(e.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(e=>"a=imageattr:".concat(e).concat(this.eol)).join("")}printRid(e){return e.map(e=>{let t="a=rid:".concat(e.id).concat(r).concat(e.direction);return e.payloads&&(t+="".concat(r,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(r).concat(e.params.map(e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)).join(";"))),t+this.eol}).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map(e=>"".concat(r).concat(e.toString(10))).join("")).concat(this.eol)).join("")}}function O(e){return(new x).parse(e)}function k(e,t){return(new C).print(e,t)}}},t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();function VA(e){return UA.parse(e)}function FA(e,t){return UA.print(e,t)}var BA=es("Array","keys"),GA=gs,WA=et,HA=u,KA=BA,zA=Array.prototype,qA={DOMTokenList:!0,NodeList:!0},YA=function(e){var t=e.keys;return e===zA||HA(zA,e)&&t===zA.keys||WA(qA,GA(e))?KA:t},XA=s(YA);function JA(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function ZA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QA(Object(n),!0).forEach(function(t){JA(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const $A=new class extends HR{constructor(){super(...arguments),JA(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class eO{constructor(e){JA(this,"logger",void 0),JA(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function nO(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const sO={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},iO=Date.now(),rO=e=>{for(const t in sO)if(Object.prototype.hasOwnProperty.call(sO,t)&&sO[t]===e)return t;return"DEFAULT"},aO=new class{constructor(){JA(this,"proxyServerURL",void 0),JA(this,"logLevel",sO.DEBUG),JA(this,"uploadState","collecting"),JA(this,"uploadLogWaitingList",[]),JA(this,"uploadLogUploadingList",[]),JA(this,"uploadErrorCount",0),JA(this,"currentLogID",0),JA(this,"url",void 0),JA(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[sO.DEBUG].concat(t);this.log.apply(this,s)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[sO.INFO].concat(t);this.log.apply(this,s)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[sO.WARNING].concat(t);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[sO.ERROR].concat(t);this.log.apply(this,s)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[sO.DEBUG].concat(t);this.uploadLog.apply(this,s)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){CA("UPLOAD_LOG",!0)}disableLogUpload(){CA("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new eO(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-iO<100)return void setTimeout(()=>{this.log(...t)},Date.now()-iO);const s=Math.max(0,Math.min(4,t[0]));if(t[0]=tO()+" Agora-SDK [".concat(rO(s),"]:"),this.appendLogToWaitingList(s,...t),s<this.logLevel)return;const i=tO()+" %cAgora-SDK [".concat(rO(s),"]:");let r=[];if(!RA("USE_NEW_LOG"))switch(s){case sO.DEBUG:r=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,r);break;case sO.INFO:r=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,r);break;case sO.WARNING:r=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,r);break;case sO.ERROR:r=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,r)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-iO<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-iO);const s=Math.max(0,Math.min(4,t[0]));t[0]=tO()+" Agora-SDK [".concat(rO(s),"]:"),this.appendLogToWaitingList(s,...t)}appendLogToWaitingList(e){if(!RA("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];Array.isArray(n[0])?n[0][0]=nO()+" Agora-SDK [".concat(rO(e),"]:"):n[0]=nO()+" Agora-SDK [".concat(rO(e),"]:");let i="";n.forEach(e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:vA,process_id:RA("PROCESS_ID"),payload:JSON.stringify(e)};return GI(async()=>{const e=await LC.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(RA("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(RA("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}},()=>(this.uploadLogUploadingList=[],!1),t=>{const n={status:-1,message:t.message,errorRange:e.map(e=>e.log_item_id)};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),$A.reportLogUploadError(n),!0},{timeout:RA("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:RA("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,RA("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var oO;function cO(e){return PR(e.reportId,"params.reportId",0,100,!1),PR(e.category,"params.category",0,100,!1),PR(e.event,"params.event",0,100,!1),PR(e.label,"params.label",0,100,!1),kR(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(oO={}).FREE="free",oO.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const lO={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let dO=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),uO=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let hO=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function pO(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,s){const i=s.value;if("function"==typeof i){const r=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);s.value=function(){for(var t,s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];let c=a;if(e.argsMap)try{c=e.argsMap(this,...a)}catch(e){aO.warning(e),c=[]}try{JSON.stringify(c)}catch(e){aO.warning("arguments for method ".concat(r,".").concat(String(n)," not serializable for apiInvoke.")),c=[]}const l=(e.report||mO).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(r,".").concat(String(n)),options:c,tag:YR.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,a);return t instanceof np?t.then(t=>(l.onSuccess(e.reportResult&&t),t)).catch(e=>{throw l.onError(e),e}):(l.onSuccess(e.reportResult&&t),t)}catch(e){throw l.onError(e),e}}}return s}}const mO=new class{constructor(){JA(this,"baseInfoMap",new Map),JA(this,"proxyServer",void 0),JA(this,"eventUploadTimer",void 0),JA(this,"setSessionIdTimer",void 0),JA(this,"url",void 0),JA(this,"sids",new Set),JA(this,"backupUrl",void 0),JA(this,"_appId",void 0),JA(this,"_aid",0),JA(this,"keyEventUploadPendingItems",[]),JA(this,"normalEventUploadPendingItems",[]),JA(this,"apiInvokeUploadPendingItems",[]),JA(this,"apiInvokeCount",0),JA(this,"apiInvokeLoggedCount",0),JA(this,"ltsList",[]),JA(this,"lastSendNormalEventTime",Date.now()),JA(this,"customReportCounterTimer",void 0),JA(this,"customReportCount",0),JA(this,"extApiInvoke",async e=>{for(const t of e){const e=ZA(ZA({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:YR.TRACER});this.sendApiInvoke(e)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),RA("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),RA("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,n]=e;return t+n}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const s=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,r=!!RA("SHOW_REPORT_INVOKER_LOG"),a=!!RA("SHOW_REPORT_USER_INVOKER_LOG"),o=r||a&&t.id;o&&(this.apiInvokeLoggedCount+=1);const c=this.apiInvokeLoggedCount;function l(e,n){if(o){let s="[apiInvoke-".concat(c,"]");if(t.id&&(s+="[".concat(t.id,"]")),t.name&&(s+="[".concat(t.name,"]"),t.name===qR.JOIN))return aO.info("".concat(s," ").concat(e));aO.info("".concat(s," ").concat(e),"start"===e?t.options:n||"")}}const d=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:s,options:t.options,states:t.states||null});l("start");let u=!1;SI(t.timeout).then(()=>{u||(this.sendApiInvoke(ZA(ZA({},d()),{},{error:RR.API_INVOKE_TIMEOUT,success:!1})),l("timeout"))});const h=new IR(RR.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const s=()=>{if(u)throw h;return u=!0,this.sendApiInvoke(ZA(ZA({},d()),{},{success:!0},t.reportResult&&{result:e})),l("onSuccess"),e};return n?II(s,t.name+"Success",n,()=>u=!0):s()},onError:e=>{const s=()=>{if(u)throw e;u=!0,this.sendApiInvoke(ZA(ZA({},d()),{},{success:!1,error:e})),l("onFailure",e.toString())};return n?II(s,t.name+"Error",n,()=>u=!0):s()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),s=this.createBaseInfo(e,n);s.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:RA("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:_A?"global":"oversea",areas:RA("AREAS")&&RA("AREAS").join(",")},t.extend),{stringUid:r,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientRole:d}=t,u=Date.now(),h=ZA(ZA({},s),{},{eventType:dO.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:SA,lts:u,elapse:u-n,extend:JSON.stringify(i),mode:t.mode,process:RA("PROCESS_ID"),appType:RA("APP_TYPE"),success:!0,version:vA,stringUid:r,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientType:Ps(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:d,serviceId:RA("PROCESS_ID"),extensionID:RA("PLUGIN_INFO").join(",")||""});var p;this.send({type:uO.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA({},s),{},{role:t.role,eventType:dO.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:uO.JOIN_CHOOSE_SERVER,data:r},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA({},s),{},{eventType:dO.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:uO.REQ_USER_ACCOUNT,data:r},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info;t.vid&&(s.vid=t.vid),s.uid=t.uid,s.cid=t.cid;const i=Date.now(),{firstSuccess:r,addr:a,isProxy:o}=t,c=i-n.startTime,l=ZA(ZA({},s),{},{eventType:dO.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:i-t.lts,firstSuccess:r,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:yA(),isABTestSuccess:t.isABTestSuccess?1:0}),d=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),r)this.send({type:uO.JOIN_GATEWAY,data:l},!0);else{let e;if(a)if(o){const t=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=a.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:o?1:0}}else{const t=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=a.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:o?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:o?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const t=Object.assign({},l,e,{eventType:dO.REJOIN_GATEWAY});this.send({type:uO.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=Date.now(),i=ZA(ZA({},n.info),{},{lts:s,timeout:t,elapse:s-n.startTime});this.send({type:uO.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA({},s),{},{eventType:dO.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:uO.PUBLISH,data:r},!0)}subscribe(e,t,n){const s=this.baseInfoMap.get(e);if(!s)return;const i=s.info,r=Date.now(),a=ZA(ZA({},i),{},{eventType:dO.SUBSCRIBE,lts:r,eventElapse:t.eventElapse,elapse:r-s.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:uO.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...XA(t=this.baseInfoMap).call(t)],s=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(s);if(!i)return;const r=i.info,a=Date.now(),o=ZA(ZA({},r),{},{eventType:dO.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:uO.WS_COMPRESSOR_INIT,data:o},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),a=ZA(ZA({},s),{},{elapse:i-n.startTime,eventType:dO.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:r,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>r?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:uO.XLA_PEER_FIRST_VIDEO_FRAME,data:a},!0)}firstRemoteVideoDecode(e,t,n,s){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),o=ZA(ZA(ZA({},r),s),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((s.firstFrame||a)-i.startTime,0),apEnd:Math.max(s.apEnd-i.startTime,0),apStart:Math.max(s.apStart-i.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-i.startTime,0),joinGwStart:Math.max(s.joinGwStart-i.startTime,0),pcEnd:Math.max(s.pcEnd-i.startTime,0),pcStart:Math.max(s.pcStart-i.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-i.startTime,0),subscriberStart:Math.max(s.subscriberStart-i.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-i.startTime,0)});this.send({type:n,data:o},!0)}firstRemoteFrame(e,t,n,s){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),o=ZA(ZA(ZA({},r),s),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:o},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA(ZA({},s),t),{},{vid:void 0===s.vid?0:Number(s.vid),elapse:i-n.startTime,eventType:dO.AB_TEST,lts:i});this.send({type:uO.AB_TEST,data:r},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA(ZA({},s),t),{},{vid:void 0===s.vid?0:Number(s.vid),elapse:i-n.startTime,eventType:dO.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:uO.PC_STATS,data:r},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA(ZA({},s),t),{},{vid:void 0===s.vid?0:Number(s.vid),eventType:dO.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:uO.UPDATE_REMOTE_RTPCAPABILITIES,data:r},!0)}}onGatewayStream(e,t,n,s){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,a=Date.now(),o=ZA(ZA(ZA({},r),s),{},{eventType:t,lts:a});this.send({type:n,data:o},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA({},s),{},{eventType:dO.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:uO.STREAM_SWITCH,data:r},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA({},s),{},{eventType:dO.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_APPCENTER,data:r},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA({},s),{},{eventType:dO.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_WORKER_MANAGER,data:r},!0)}setProxyServer(e){this.proxyServer=e,e?aO.debug("reportProxyServerurl: ".concat(e)):aO.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA({},s),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:uO.PEER_PUBLISH_STATUS,data:r},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now();(function(e,t,n){const s=e[t];if(!s||"string"!=typeof s)return[e];e[t]="";const i=bI(JSON.stringify(e));let r=0;const a=[];let o=0;for(let c=0;c<s.length;c++)o+=s.charCodeAt(c)<=127?1:3,o<=n-i||(a[a.length]=CR(CR({},e),{},{[t]:s.substring(r,c)}),r=c,o=s.charCodeAt(c)<=127?1:3);return r!==s.length-1&&(a[a.length]=CR(CR({},e),{},{[t]:s.substring(r)})),a})(ZA(ZA(ZA({},s),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(e=>this.send({type:uO.WORKER_EVENT,data:e},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA(ZA({},s),t),{},{elapse:i-n.startTime,lts:i});this.send({type:uO.AP_WORKER_EVENT,data:r},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA(ZA({},s),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:uO.JOIN_WEB_PROXY_AP,data:r},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,i=Date.now(),r=ZA(ZA(ZA({},s),t),{},{elapse:i-n.startTime,lts:i});this.send({type:uO.WEBSOCKET_QUIT,data:r},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>RA("CUSTOM_REPORT_LIMIT"))throw new IR(RR.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),s=t.map(t=>({type:uO.USER_ANALYTICS,data:ZA(ZA({sid:e},t),{},{lts:n})}));try{RA("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(e){throw aO.error("send custom report message failed",e.toString()),new IR(RR.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=RA("NOT_REPORT_EVENT");if(e.tag&&Ps(t)&&Ps(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:s,uid:i,cid:r}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof IR){const{code:t,message:n}=e.error;a=t||n||e.error.toString()}else a=e.error.toString();const o={invokeId:e.invokeId,sid:e.sid,cname:s,cid:r,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:uO.API_INVOKE,data:o},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find(e=>null!==e);t&&e.forEach(e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>RA("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],s=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):s.push(t)}e.push(...s);for(const r of[...n]){var i;-1!==this.ltsList.indexOf(r.data.lts)?(r.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(r.data.lts)):(this.ltsList.push(r.data.lts),Xp(i=this.ltsList).call(i,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=Date.now()),RA("ENABLE_EVENT_REPORT")?(n.length&&(RA("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{RA("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>RA("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-RA("NORMAL_EVENT_QUEUE_CAPACITY")),aO.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){lI.networkState===sI.OFFLINE&&await np.race([lI.onlineWaiter,SI(2*FI.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach(e=>{const n=BR(JSON.stringify(e.data)),s=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(uO).forEach(n=>{let[s,i]=n;i===e.type&&(t=hO[s])}),t})(e),r=new DataView(s);r.setUint16(0,n.byteLength,!0),r.setUint8(2,255&i),r.setUint8(3,i>>>8&255),r.setUint8(4,i>>>16&255),t=GR(t,new Uint8Array(s)),t=GR(t,n)}),t},n="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(RA("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(RA("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await qI(s,{timeout:1e4,data:t(e),headers:ZA(ZA({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),s=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(e=>JSON.stringify(e)),vid:n,aid:s};lI.networkState===sI.OFFLINE&&await np.race([lI.onlineWaiter,SI(2*FI.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("EVENT_REPORT_DOMAIN"),"&p=").concat(RA("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(RA("EVENT_REPORT_DOMAIN"),":").concat(RA("STATS_COLLECTOR_PORT")).concat(r));for(let o=0;o<2;o+=1){1===o&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(RA("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(RA("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(RA("STATS_COLLECTOR_PORT")).concat(r)));try{t?await YI(a,{timeout:1e4,data:i}):await qI(a,{timeout:1e4,data:i})}catch(t){if(1===o)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},lO);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),s=n[n.length-1];s&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:s,tag:YR.TRACER}).onSuccess()}};$A.on("REPORT_LOG_UPLOAD",e=>{e.networkState=lI.networkState,mO.reportApiInvoke(null,{name:"logUploadError",options:e,tag:YR.TRACER}).onSuccess("logUploadError")});class fO extends IR{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),JA(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,aO)}throw(){super.throw(aO)}}const gO={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function yO(){return gO}function vO(){return"setSinkId"in HTMLAudioElement.prototype&&(!RA("RESTRICTION_SET_PLAYBACK_DEVICE")||(ZC()||tR())&&!bR())}function _O(){return!gO.supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&xR()}function EO(e){return!(nR()||rR(87)||_O()||!RA("ENABLE_PRE_SUB")&&(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB")))}function bO(e){return!!RA("ENABLE_INSTANT_VIDEO")||!(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB"))}let xO=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function wO(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function SO(e,t,n,s,i){return{width:e,height:t,frameRate:n,bitrateMin:s,bitrateMax:i}}function NO(e,t,n,s,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:s,bitrateMax:i}}function TO(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const CO={"90p":SO(160,90),"90p_1":SO(160,90),"120p":SO(160,120,15,30,65),"120p_1":SO(160,120,15,30,65),"120p_3":SO(120,120,15,30,50),"120p_4":SO(212,120),"180p":SO(320,180,15,30,140),"180p_1":SO(320,180,15,30,140),"180p_3":SO(180,180,15,30,100),"180p_4":SO(240,180,15,30,120),"240p":SO(320,240,15,40,200),"240p_1":SO(320,240,15,40,200),"240p_3":SO(240,240,15,40,140),"240p_4":SO(424,240,15,40,220),"360p":SO(640,360,15,80,400),"360p_1":SO(640,360,15,80,400),"360p_3":SO(360,360,15,80,260),"360p_4":SO(640,360,30,80,600),"360p_6":SO(360,360,30,80,400),"360p_7":SO(480,360,15,80,320),"360p_8":SO(480,360,30,80,490),"360p_9":SO(640,360,15,80,800),"360p_10":SO(640,360,24,80,800),"360p_11":SO(640,360,24,80,1e3),"480p":SO(640,480,15,100,500),"480p_1":SO(640,480,15,100,500),"480p_2":SO(640,480,30,100,1e3),"480p_3":SO(480,480,15,100,400),"480p_4":SO(640,480,30,100,750),"480p_6":SO(480,480,30,100,600),"480p_8":SO(848,480,15,100,610),"480p_9":SO(848,480,30,100,930),"480p_10":SO(640,480,10,100,400),"720p":SO(1280,720,15,120,1130),"720p_auto":SO(1280,720,30,900,3e3),"720p_1":SO(1280,720,15,120,1130),"720p_2":SO(1280,720,30,120,2e3),"720p_3":SO(1280,720,30,120,1710),"720p_5":SO(960,720,15,120,910),"720p_6":SO(960,720,30,120,1380),"1080p":SO(1920,1080,15,120,2080),"1080p_1":SO(1920,1080,15,120,2080),"1080p_2":SO(1920,1080,30,120,3e3),"1080p_3":SO(1920,1080,30,120,3150),"1080p_5":SO(1920,1080,60,120,4780),"1440p":SO(2560,1440,30,120,4850),"1440p_1":SO(2560,1440,30,120,4850),"1440p_2":SO(2560,1440,60,120,7350),"4k":SO(3840,2160,30,120,8910),"4k_1":SO(3840,2160,30,120,8910),"4k_3":SO(3840,2160,60,120,13500)},RO={"480p":NO(640,480,5),"480p_1":NO(640,480,5),"480p_2":NO(640,480,30),"480p_3":NO(640,480,15),"720p":NO(1280,720,5),"720p_auto":SO(1280,720,30,900,3e3),"720p_1":NO(1280,720,5),"720p_2":NO(1280,720,30),"720p_3":NO(1280,720,15),"1080p":NO(1920,1080,5),"1080p_1":NO(1920,1080,5),"1080p_2":NO(1920,1080,30),"1080p_3":NO(1920,1080,15)},IO={"1SL1TL":TO(1,1),"3SL3TL":TO(3,3),"2SL3TL":TO(2,3)};function AO(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},CO[e]):e}function OO(e){return"string"==typeof e?Object.assign({},RO[e]):e}function kO(e){return"string"==typeof e?Object.assign({},IO[e]):e}const DO={speech_low_quality:wO(16e3,!1),speech_standard:wO(32e3,!1,18),music_standard:wO(48e3,!1),standard_stereo:wO(48e3,!0,56),high_quality:wO(48e3,!1,128),high_quality_stereo:wO(48e3,!0,192)};function PO(e){return"string"==typeof e?Object.assign({},DO[e]):e}const jO=[];function LO(e){return OR(e,"mediaSource",["screen","window","application"]),!0}let MO=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),UO=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),VO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),FO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),BO=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),GO=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),WO=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),HO=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),KO=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),zO=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const qO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},XO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},JO={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ZO=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),$O=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),ek=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),tk=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),nk=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),sk=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const ik={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let rk=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function ak(e,t,n,s,i){var r,a,o={};return Object.keys(s).forEach(function(e){o[e]=s[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=ii(r=yi(a=n.slice()).call(a)).call(r,function(n,s){return s(e,t,n)||n},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function ok(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ck(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function lk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ck(Object(n),!0).forEach(function(t){ok(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ck(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class dk extends HR{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(GO.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),ok(this,"trackMediaType",void 0),ok(this,"_ID",void 0),ok(this,"_rtpTransceiver",void 0),ok(this,"_lowRtpTransceiver",void 0),ok(this,"_hints",[]),ok(this,"_isClosed",!1),ok(this,"_originMediaStreamTrack",void 0),ok(this,"mediaStreamTrack",void 0),ok(this,"_external",{}),this._ID=t||NI(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Ps(jO).call(jO,e)||jO.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||gI(()=>{var e;mO.reportApiInvoke(null,{name:qR.GET_MEDIA_STREAM_TRACK,options:[],tag:YR.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===VO.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=jO.indexOf(e);-1!==t&&jO.splice(t,1)}(this),this.emit(WO.CLOSED),this.removeAllListeners(GO.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===VO.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(GO.TRANSCEIVER_UPDATED,e,t)}}class uk extends dk{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),ok(this,"_enabled",!0),ok(this,"_muted",!1),ok(this,"_isExternalTrack",!1),ok(this,"_isClosed",!1),ok(this,"_enabledMutex",void 0),ok(this,"processor",void 0),ok(this,"_processorContext",void 0),ok(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new UI("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,aO.debug("[".concat(this.getTrackId(),"] close")),this.emit(MO.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}stateCheck(e,t){if(aO.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),AR(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new IR(RR.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",aO);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new IR(RR.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",aO)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():np.resolve([])}}const hk=window.AudioContext||window.webkitAudioContext;let pk=null;const mk=new class extends HR{constructor(){super(...arguments),ok(this,"prevState",void 0),ok(this,"curState",void 0),ok(this,"currentTime",void 0),ok(this,"currentTimeStuckAt",void 0),ok(this,"interruptDetectorTrack",void 0),ok(this,"onLocalAudioTrackMute",()=>{aO.info("ios15-interruption-start"),this.emit(xO.IOS_15_16_INTERRUPTION_START)}),ok(this,"onLocalAudioTrackUnmute",async()=>{aO.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?aO.info("ios15-interruption-end-canceled"):(pk&&await pk.suspend(),this.emit(xO.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){aO.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){aO.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function fk(){if(!pk){if(function(){if(!hk)return void aO.error("your browser is not support web audio");aO.info("create audio context");const e=lk({},RA("WEBAUDIO_INIT_OPTIONS"));aO.debug("audio context init option:",JSON.stringify(e)),pk=new hk(e),mk.curState=pk.state,pk.onstatechange=()=>{mk.prevState=mk.curState,mk.curState=pk?pk.state:void 0;const{prevState:e,curState:t}=mk,n="running"===t,s="interrupted"===t,i="running"===e,r="suspended"===e,a="interrupted"===e,o=qC().osVersion;(sR()||vR())&&i&&s&&(aO.info("ios".concat(o,"-interruption-start")),mk.emit(xO.IOS_INTERRUPTION_START)),(sR()||vR())&&(r||a)&&n&&(aO.info("ios".concat(o,"-interruption-end")),mk.emit(xO.IOS_INTERRUPTION_END)),e!==t&&mk.emit(xO.STATE_CHANGE,t,e)},setInterval(()=>{var e;const t=null===(e=pk)||void 0===e?void 0:e.currentTime;mk.currentTime!==t?(mk.currentTimeStuckAt&&(aO.debug("AudioContext current time resume at ".concat(t)),mk.currentTimeStuckAt=void 0),mk.currentTime=t):(t!==mk.currentTimeStuckAt&&(mO.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:YR.TRACER}).onSuccess(),aO.warning("AudioContext current time stuck at ".concat(t))),mk.currentTimeStuckAt=t)},5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,s=!1,i=!1,r=!1;function a(t){"running"===e.state?o(!1):sR()||vR()?"suspended"===e.state&&(o(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(o(!0),t&&e.resume().then(c,c))}function o(e){if(s!==e){s=e;for(let n=0,s=t;n<s.length;n+=1){const t=s[n];e?window.addEventListener(t,l,{capture:!0,passive:!0}):window.removeEventListener(t,l,{capture:!0,passive:!0})}}}function c(){a(!1)}function l(){a(!0)}function d(e){if(!r)if(n.paused)if(e){let t;u(!1),r=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else u(!0);else u(!1)}function u(e){if(i!==e){i=e;for(let n=0,s=t;n<s.length;n++){const t=s[n];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),r=!1,d(!1)}function p(){d(!0)}if(sR()){const t=e.createMediaStreamDestination(),s=document.createElement("div");s.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=s.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,d(!0)}mk.on(xO.STATE_CHANGE,function(){a(!0)}),a(!1)}(pk)}(),!pk)throw new IR(RR.NOT_SUPPORTED,"can not create audio context");return pk}return pk}function gk(e){if(function(){if(null!==yk)return yk;const e=fk(),t=e.createBufferSource(),n=e.createGain(),s=e.createGain();t.connect(n),t.connect(s),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),yk=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,s,i)=>{var r;return e._inputNodes||(e._inputNodes=[]),Ps(r=e._inputNodes).call(r,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,s,i)):t.call(e,n,s)),e},e.disconnect=(s,i,r)=>{n.call(e),s?dI(e._inputNodes,s):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let yk=null;function vk(e,t){let n=!1;const s=1/t;if(RA("DISABLE_WEBAUDIO")){const t=window.setInterval(()=>{n?window.clearInterval(t):e(performance.now()/1e3)},1e3*s)}else{const t=fk();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const r=()=>{if(n)return void(i=null);const a=t.createOscillator();a.onended=r,a.connect(i),a.start(0),a.stop(t.currentTime+s),e(t.currentTime)};r()}return()=>{n=!0}}class _k{constructor(){ok(this,"context",void 0),ok(this,"analyserNode",void 0),ok(this,"sourceNode",void 0),this.context=fk(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||sR()||vR()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=ii(e).call(e,(e,t)=>e+t*t,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){aO.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Ek extends HR{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ok(this,"outputNode",void 0),ok(this,"outputTrack",void 0),ok(this,"isPlayed",!1),ok(this,"sourceNode",void 0),ok(this,"context",void 0),ok(this,"audioBufferNode",void 0),ok(this,"destNode",void 0),ok(this,"audioOutputLevel",0),ok(this,"volumeLevelAnalyser",void 0),ok(this,"_processedNode",void 0),ok(this,"playNode",void 0),ok(this,"isDestroyed",!1),ok(this,"onNoAudioInput",void 0),ok(this,"isNoAudioInput",!1),ok(this,"_noAudioInputCount",0),this.context=fk(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),gk(this.outputNode),this.volumeLevelAnalyser=new _k}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(zO.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!yO().webAudioMediaStreamDest)throw new IR(RR.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&hI(()=>{mk.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;sR()||vR()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let s=!1;for(let i=0;i<n.length;i++)0!==n[i]&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await SI(200),await this.checkHasAudioInput(e?e+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bk extends Ek{get isFreeze(){return!1}constructor(e,t,n){var s;if(super(),ok(this,"sourceNode",void 0),ok(this,"track",void 0),ok(this,"clonedTrack",void 0),ok(this,"audioElement",void 0),ok(this,"isCurrentTrackCloned",!1),ok(this,"isRemoteTrack",!1),ok(this,"originVolumeLevelAnalyser",void 0),ok(this,"rebuildWebAudio",async()=>{if(aO.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void aO.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>aO.info("resume success")),aO.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),gk(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),gk(this.outputNode),this.emit(zO.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),"audio"!==e.kind)throw new IR(RR.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),gk(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,aO.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));gk(t),this.originVolumeLevelAnalyser=new _k,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const r=qC();t&&r.os===GC.IOS&&Number(null===(s=r.osVersion)||void 0===s?void 0:s.split(".")[0])<15&&(mk.on(xO.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),gk(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(zO.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),mk.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),aO.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));gk(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function xk(e,t,n){const s=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:s(t.height,1080),maxWidth:s(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function wk(e,t){const n=await Sk(e.mediaSource),{sourceId:s,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new np((n,s)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const r=document.createElement("div");r.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",s(e)};let d=t;const u=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=d,e.onchange=()=>{d=e.checked},u.appendChild(e),u.appendChild(t)}c.appendChild(u),c.appendChild(l),r.appendChild(a),r.appendChild(o),r.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(r),document.body.appendChild(h),e.map(e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let s=e.thumbnail;try{const{width:e}=s.getSize();e>1920&&(s=s.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+s.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:d})},o.appendChild(t)}})})}(n,t);return await xk(s,e,i)}async function Sk(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=zR();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new IR(RR.ELECTRON_IS_NULL);let s=null;try{var i;s=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){s=null}s&&s.then||(s=new np((e,s)=>{n.desktopCapturer.getSources({types:t},(t,n)=>{t?s(t):e(n)})}));try{return await s}catch(e){throw new IR(RR.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const Nk=new UI("safari");let Tk=!1,Ck=!1;async function Rk(e,t){let n=0,s=null;for(;n<2;)try{s=await Ik(e,t,n>0);break}catch(e){if(e instanceof IR)throw aO.error("[".concat(t,"] ").concat(e.toString())),e;const s=Ak(e.name||e.code||e,e.message);if(s.code===RR.MEDIA_OPTION_INVALID){aO.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await SI(500);continue}throw aO.error("[".concat(t,"] ").concat(s.toString())),s}if(!s)throw new IR(RR.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function Ik(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new IR(RR.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const s=yO(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return aO.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(zR())e.screen.sourceId?Ok(i,await xk(e.screen.sourceId,e.screen,!!e.screenAudio)):Ok(i,await wk(e.screen,!!e.screenAudio));else if(ZC()&&e.screen.extensionId&&e.screen.mandatory){if(!s.getStreamFromExtension)throw new IR(RR.NOT_SUPPORTED,"This browser does not support screen sharing");aO.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(a=e.screen.extensionId,o=t,new np((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},n=>{if(!n||!n.streamId)return aO.error("[".concat(o,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new IR(RR.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)})}catch(e){aO.error("[".concat(o,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),e.toString()),t(new IR(RR.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=n,Ok(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(s.getDisplayMedia){var r;e.screen.mediaSource&&LO(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(r=e.screen.displaySurface)&&void 0!==r?r:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:s,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c}=e.screen,l={selfBrowserSurface:s,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c};!s&&delete l.selfBrowserSurface,!a&&delete l.surfaceSwitching,!o&&delete l.systemAudio,!c&&delete l.preferCurrentTab,aO.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:e.screenAudio,controls:l})),Ok(i,await navigator.mediaDevices.getDisplayMedia(lk({video:n,audio:e.screenAudio},l)))}else{if(!nR())throw aO.error("[".concat(t,"] This browser does not support screenSharing")),new IR(RR.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&LO(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};aO.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),Ok(i,await navigator.mediaDevices.getUserMedia(n))}}var a,o;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=RA("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=OI(c,l)}catch(e){}aO.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),qC();let d,u=null;($C()||sR()||QC())&&(u=await Nk.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw u&&u(),e}return c.audio&&(Tk=!0),c.video&&(Ck=!0),Ok(i,d),u&&u(),i}function Ak(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new IR(RR.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new IR(RR.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new IR(RR.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new IR(RR.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new IR(RR.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new IR(RR.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return aO.error("getUserMedia unexpected error",e),new IR(RR.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Ok(e,t){const n=e.getVideoTracks()[0],s=e.getAudioTracks()[0],i=t.getVideoTracks()[0],r=t.getAudioTracks()[0];r&&(s&&e.removeTrack(s),e.addTrack(r)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const kk=new class extends HR{get state(){return this._state}set state(e){e!==this._state&&(this.emit(tk.STATE_CHANGE,e),this._state=e)}constructor(){super(),ok(this,"_state",ek.IDLE),ok(this,"isAccessMicrophonePermission",!1),ok(this,"isAccessCameraPermission",!1),ok(this,"lastAccessMicrophonePermission",!1),ok(this,"lastAccessCameraPermission",!1),ok(this,"checkdeviceMatched",!1),ok(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(RA("ENUMERATE_DEVICES_INTERVAL")||(wR()||XC()===GC.HARMONY_OS)&&xR())&&this.updateDevicesInfo()},RA("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>aO.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new IR(RR.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const s=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(s);let r=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(r=!1),i.video&&(a=!1);let o=null,c=null,l=null;if(!n&&(r||a)){if(Nk.isLocked&&(aO.debug("[device manager] wait GUM lock"),(await Nk.lock())(),aO.debug("[device manager] GUM unlock")),Tk&&(r=!1,this.isAccessMicrophonePermission=!0),Ck&&(a=!1,this.isAccessCameraPermission=!0),aO.debug("[device manager] check media device permissions",e,t,r,a),r&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=Ak(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(r){try{o=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=Ak(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=Ak(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}aO.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,e}catch(e){return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,new IR(RR.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audioinput"===e.kind)}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(e=>"videoinput"===e.kind)}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audiooutput"===e.kind)}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===e);if(!t)throw new IR(RR.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=ek.INITING;try{await this.updateDevicesInfo(),this.state=ek.INITEND}catch(e){throw aO.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ek.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new IR(RR.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find(e=>"audioinput"===e.kind&&"default"===e.deviceId),n=e.find(e=>"audiooutput"===e.kind&&"default"===e.deviceId);t&&n?n.groupId===t.groupId?aO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):aO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):aO.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(e=>{if(!e.deviceId)return;const s=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(s?s.state:"INACTIVE")){const s={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),s),n.push(s)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((e,s)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))}),this.state!==ek.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tk.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(tk.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tk.PLAYOUT_DEVICE_CHANGED,e)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(e=>"audioinput"===e.kind),n=e.filter(e=>"videoinput"===e.kind),s={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){s.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){s.video=!0;break}return s}};let Dk=!1;const Pk=new class extends HR{constructor(){super(...arguments),ok(this,"onAutoplayFailed",void 0),ok(this,"onAudioAutoplayFailed",void 0)}};function jk(){if(qC(),!Dk){const e=t=>{t.preventDefault(),Dk=!1,SR()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Dk=!0,SR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),aO.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Pk.onAutoplayFailed?Pk.onAutoplayFailed():Pk.onAudioAutoplayFailed?aO.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):aO.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Pk.emit("autoplay-failed")}}function Lk(e,t,n,s){if(!e)return;const i=mO.getBaseInfoBySessionId(e);if(!i)return;const r=i.info,a=Date.now(),o=lk(lk({},r),{},{vid:void 0===r.vid?0:Number(r.vid),lts:a,elapse:a-i.startTime,cbRegistered:Pk.onAutoplayFailed||Pk.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:s,extend:void 0});mO.send({type:uO.AUTOPLAY_FAILED,data:o},!0)}const Mk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Uk=new class{constructor(){ok(this,"onAutoplayFailed",void 0),ok(this,"elementMap",new Map),ok(this,"elementStateMap",new Map),ok(this,"elementsNeedToResume",[]),ok(this,"sinkIdMap",new Map),ok(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,s]=t;const i=this.elementStateMap.get(n),r=s.srcObject.getAudioTracks()[0],a=r&&r.readyState;if(aO.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return s.pause(),void s.play();if("running"===mk.curState)return fR()?(s.pause(),void s.play()):void(i&&"paused"===i&&s.play())}})}),ok(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const s=n.srcObject.getAudioTracks()[0];s&&"live"===s.readyState&&(aO.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),mk.on(xO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mk.on(xO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),mk.on(xO.STATE_CHANGE,()=>{sR()&&"suspended"===mk.prevState&&"running"===mk.curState&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new IR(RR.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,s){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,nk.INIT),this.setVolume(t,n);const r=this.sinkIdMap.get(t);if(r)try{i.setSinkId(r).catch(e=>{aO.warning("[".concat(t,"] set sink id failed"),e.toString())})}catch(e){aO.warning("[".concat(t,"] set sink id failed"),e.toString())}const a=i.play();a&&a.then&&a.catch(e=>{s&&Lk(s,"audio",e.message,t),aO.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(aO.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),hI(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),jk()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Mk.forEach(n=>{t.addEventListener(n,n=>{const s=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(aO.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&aO.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(e=>{aO.debug("Auto resume audio element success")}).catch(e=>{aO.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new np(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{SR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Vk(){return function(e,t,n){const s=n.value;return"function"==typeof s&&(n.value=function(){this._isClosed&&new IR(RR.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",aO);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=s.apply(this,t);return i instanceof np?new np((e,t)=>{i.then(e).catch(t)}):i}),n}}class Fk extends HR{constructor(e){super(),ok(this,"name","VideoProcessorDestination"),ok(this,"ID","0"),ok(this,"_source",void 0),ok(this,"videoContext",void 0),ok(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new IR(RR.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new IR(RR.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ZO.ON_TRACK,void 0)}}class Bk extends HR{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),ok(this,"constraintsMap",new Map),ok(this,"statsRegistry",[]),ok(this,"usageRegistry",[]),ok(this,"trackId",void 0),ok(this,"direction",void 0),ok(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await rI(this,$O.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return aO.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:s,cb:i}of this.statsRegistry)try{const r=i();e.push({processorID:t,processorName:n,type:s,stats:r})}catch(e){aO.error(new IR(RR.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(lk(lk({},n),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Gk extends HR{constructor(e){super(),ok(this,"name","AudioProcessorDestination"),ok(this,"ID","0"),ok(this,"inputTrack",void 0),ok(this,"inputNode",void 0),ok(this,"audioProcessorContext",void 0),ok(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new IR(RR.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new IR(RR.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ZO.ON_TRACK,void 0),this.emit(ZO.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(ZO.ON_NODE,this.inputNode))}}class Wk extends HR{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),ok(this,"constraintsMap",new Map),ok(this,"statsRegistry",[]),ok(this,"audioContext",void 0),ok(this,"trackId",void 0),ok(this,"direction",void 0),ok(this,"usageRegistry",[]),ok(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return rI(this,$O.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:s,cb:i}of this.statsRegistry)try{const r=i();e.push({processorID:t,processorName:n,type:s,stats:r})}catch(e){aO.error(new IR(RR.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(lk(lk({},n),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Hk extends HR{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ok(this,"context",void 0),ok(this,"processSourceNode",void 0),ok(this,"outputTrack",void 0),ok(this,"processedNode",void 0),ok(this,"clonedTrack",void 0),ok(this,"outputNode",void 0),this.outputNode=new Kk}setVolume(){}createOutputTrack(){throw new IR(RR.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Kk{disconnect(){}connect(){}}function zk(e){return new np((t,n)=>{let s=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const r=sR()?"canplay":"playing";i.addEventListener(r,()=>{const e=i.videoWidth,n=i.videoHeight;!e&&nR()||(s=!0,i.srcObject=null,i.remove(),t([e,n]))}),i.srcObject=new MediaStream([e]),i.play().catch(CI),setTimeout(()=>{s||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function qk(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=AO(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!ER()&&n.frameRate&&(t.frameRate=n.frameRate),tR()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),nR()&&(t.frameRate={ideal:30,max:30}),t}function Yk(e){const t={};return ER()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,ZC()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function Xk(e){const t=Yk(e);if(e.encoderConfig){const n=PO(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),wR()&&(t.sampleRate=void 0),t}const Jk=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:s,height:i}=e.getMediaStreamTrackSettings();let{frameRate:r=n,width:a=s,height:o=i}=t;if(!r||!a||!o)return;a=DI(a),o=DI(o),r=DI(r);const{max:c,min:l}=function(e,t,n){const s=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(s),max:Math.floor(4*s)}}(a,o,r),{bitrateMax:d,bitrateMin:u}=t||{};d||aO.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(o,", fps: ").concat(r,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));const{maxFramerate:h}=RA("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(r=Math.min(r,h)),{frameRate:r,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}},Qk=async(e,t,n)=>await(async(e,t,n)=>{const s=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(jI(""+t+n)).slice(0,16),i=s.slice(0,12),r=await window.crypto.subtle.importKey("raw",s,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},r,e))})(e.buffer,t,n),Zk=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new np((n,s)=>{t.toBlob(async e=>{if(t.remove(),e){const s=await $k(e);n({buffer:s,width:t.width,height:t.height})}else s(new IR(RR.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},$k=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var eD,tD,nD,sD,iD,rD,aD,oD,cD,lD,dD,uD,hD,pD,mD,fD,gD,yD,vD,_D,ED,bD,xD,wD,SD,ND,TD,CD,RD,ID,AD,OD,kD,DD,PD,jD,LD,MD,UD,VD;let FD=(eD=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),nD=Vk(),sD=VI("LocalAudioTrack","_enabledMutex"),iD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),rD=Vk(),aD=VI("LocalAudioTrack","_enabledMutex"),oD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),cD=Vk(),lD=Vk(),dD=Vk(),uD=pO({argsMap:e=>[e.getTrackId()]}),hD=Vk(),pD=pO({argsMap:e=>[e.getTrackId()]}),mD=Vk(),fD=pO({argsMap:e=>[e.getTrackId()]}),gD=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),yD=pO({argsMap:e=>[e.getTrackId()]}),ak((vD=class extends uk{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Uk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,s){super(e,n),ok(this,"trackMediaType",KO.AUDIO),ok(this,"_encoderConfig",void 0),ok(this,"_trackSource",void 0),ok(this,"metadata",[]),ok(this,"_enabled",!0),ok(this,"_volume",100),ok(this,"_useAudioElement",!0),ok(this,"_bypassWebAudio",!1),ok(this,"processor",void 0),ok(this,"_processorContext",void 0),ok(this,"_processorDestination",void 0),ok(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!s,this._trackSource=new Hk,RA("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),RA("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$C()&&!pk?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){kR(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Uk.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void aO.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,aI(this,MO.NEED_REPLACE_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!vO())throw new IR(RR.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Uk.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await aI(this,MO.NEED_ENABLE_TRACK,this),aO.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aI(this,MO.NEED_MUTE_TRACK,this):await aI(this,MO.NEED_UNMUTE_TRACK,this))}getStats(){return gI(()=>{aO.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lk({},qO)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),this._source.on(zO.ON_AUDIO_BUFFER,t=>e(t))}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Uk.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Uk.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Uk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return np.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new IR(RR.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this))}),e.on(ZO.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ZO.ON_TRACK),e.removeAllListeners(ZO.ON_NODE)}bindProcessorContextEvents(e){e.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners($O.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Hk&&(this._trackSource=new bk(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new Wk(this._source.context,this.getTrackId(),"local"),t=new Gk(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(zO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Uk.stop(this.getTrackId()),this._source.play()),aI(this,MO.NEED_REPLACE_MIXING_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[eD],Object.getOwnPropertyDescriptor(vD.prototype,"setVolume"),vD.prototype),ak(vD.prototype,"setPlaybackDevice",[tD,nD],Object.getOwnPropertyDescriptor(vD.prototype,"setPlaybackDevice"),vD.prototype),ak(vD.prototype,"setEnabled",[sD,iD,rD],Object.getOwnPropertyDescriptor(vD.prototype,"setEnabled"),vD.prototype),ak(vD.prototype,"setMuted",[aD,oD,cD],Object.getOwnPropertyDescriptor(vD.prototype,"setMuted"),vD.prototype),ak(vD.prototype,"getStats",[lD],Object.getOwnPropertyDescriptor(vD.prototype,"getStats"),vD.prototype),ak(vD.prototype,"setAudioFrameCallback",[dD],Object.getOwnPropertyDescriptor(vD.prototype,"setAudioFrameCallback"),vD.prototype),ak(vD.prototype,"play",[uD,hD],Object.getOwnPropertyDescriptor(vD.prototype,"play"),vD.prototype),ak(vD.prototype,"stop",[pD,mD],Object.getOwnPropertyDescriptor(vD.prototype,"stop"),vD.prototype),ak(vD.prototype,"close",[fD],Object.getOwnPropertyDescriptor(vD.prototype,"close"),vD.prototype),ak(vD.prototype,"pipe",[gD],Object.getOwnPropertyDescriptor(vD.prototype,"pipe"),vD.prototype),ak(vD.prototype,"unpipe",[yD],Object.getOwnPropertyDescriptor(vD.prototype,"unpipe"),vD.prototype),vD),BD=(_D=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),ED=Vk(),bD=VI("MicrophoneAudioTrack","_enabledMutex"),xD=pO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),wD=Vk(),SD=pO({argsMap:e=>[e.getTrackId()]}),ak((ND=class extends FD{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,s){super(e,t.encoderConfig?PO(t.encoderConfig):{},s,RA("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ok(this,"_config",void 0),ok(this,"_deviceName","default"),ok(this,"_constraints",void 0),ok(this,"_originalConstraints",void 0),ok(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(fR()||gR())&&mk.bindInterruptDetectorTrack(this)}async setDevice(e){if(aO.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await kk.getDeviceById(e),n={};n.audio=lk({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let s=null;try{s=await Rk(n,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),s=await Rk({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await kk.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return aO.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),RA("AUTO_RESET_AUDIO_ROUTE")&&(sR()||vR())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(s=this._source.clonedTrack)||void 0===s||s.stop(),n||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=lk({},this._constraints),r=kk.searchDeviceIdByName(this._deviceName);r&&!i.deviceId&&(i.deviceId=r);try{n||(this._enabled=!0);const e=await Rk({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(fR()||gR())&&mk.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((sR()||vR())&&this._enabled&&!this._isClosed&&mk.duringInterruption){const e=async()=>{mk.off(xO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mk.on(xO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=kk.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await Rk({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[_D,ED],Object.getOwnPropertyDescriptor(ND.prototype,"setDevice"),ND.prototype),ak(ND.prototype,"setEnabled",[bD,xD,wD],Object.getOwnPropertyDescriptor(ND.prototype,"setEnabled"),ND.prototype),ak(ND.prototype,"close",[SD],Object.getOwnPropertyDescriptor(ND.prototype,"close"),ND.prototype),ND),GD=(TD=pO({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),CD=Vk(),RD=pO({argsMap:e=>[e.getTrackId()]}),ID=Vk(),AD=pO({argsMap:e=>[e.getTrackId()]}),OD=Vk(),kD=pO({argsMap:e=>[e.getTrackId()]}),DD=Vk(),PD=pO({argsMap:e=>[e.getTrackId()]}),jD=Vk(),LD=pO({argsMap:e=>[e.getTrackId()]}),MD=pO({argsMap:e=>[e.getTrackId()]}),UD=Vk(),ak((VD=class extends FD{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,s){super(t.createOutputTrack(),n,s),ok(this,"source",void 0),ok(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(zO.AUDIO_SOURCE_STATE_CHANGE,e=>{this.safeEmit(WO.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){kR(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[TD,CD],Object.getOwnPropertyDescriptor(VD.prototype,"startProcessAudioBuffer"),VD.prototype),ak(VD.prototype,"pauseProcessAudioBuffer",[RD,ID],Object.getOwnPropertyDescriptor(VD.prototype,"pauseProcessAudioBuffer"),VD.prototype),ak(VD.prototype,"seekAudioBuffer",[AD,OD],Object.getOwnPropertyDescriptor(VD.prototype,"seekAudioBuffer"),VD.prototype),ak(VD.prototype,"resumeProcessAudioBuffer",[kD,DD],Object.getOwnPropertyDescriptor(VD.prototype,"resumeProcessAudioBuffer"),VD.prototype),ak(VD.prototype,"stopProcessAudioBuffer",[PD,jD],Object.getOwnPropertyDescriptor(VD.prototype,"stopProcessAudioBuffer"),VD.prototype),ak(VD.prototype,"close",[LD],Object.getOwnPropertyDescriptor(VD.prototype,"close"),VD.prototype),ak(VD.prototype,"setAudioBufferPlaybackSpeed",[MD,UD],Object.getOwnPropertyDescriptor(VD.prototype,"setAudioBufferPlaybackSpeed"),VD.prototype),VD);class WD extends FD{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=fk().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,NI(8,"track-mix-")),ok(this,"trackList",void 0),ok(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(aO.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):aO.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){aO.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}dI(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof WD?t.emit(GO.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class HD extends Ek{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(zO.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),ok(this,"audioBuffer",void 0),ok(this,"sourceNode",void 0),ok(this,"startPlayTime",0),ok(this,"startPlayOffset",0),ok(this,"pausePlayTime",0),ok(this,"options",void 0),ok(this,"currentLoopCount",0),ok(this,"currentPlaybackSpeed",100),ok(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):aO.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const KD=new Map;function zD(e,t){if(0===e.length||0===t.length)return 1/0;const n=PI(e),s=PI(t);return Math.floor(s/n)}class qD{get rendFrameRate(){const e=Math.max(1,zD(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:nk.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(aO.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){ok(this,"trackId",void 0),ok(this,"config",void 0),ok(this,"onFirstVideoFrameDecoded",void 0),ok(this,"onFirstVideoFrameRender",void 0),ok(this,"onVideoStateChanged",void 0),ok(this,"freezeTimeCounterList",[]),ok(this,"renderFreezeAccTime",0),ok(this,"renderFreezeAccTime2",0),ok(this,"isKeepLastFrame",!1),ok(this,"isDestroyed",!1),ok(this,"timeUpdatedCount",0),ok(this,"freezeTime",0),ok(this,"playbackTime",0),ok(this,"lastTimeUpdatedTime",0),ok(this,"autoplayFailed",!1),ok(this,"videoTrack",void 0),ok(this,"videoElement",void 0),ok(this,"cacheVideoElement",void 0),ok(this,"internal",!1),ok(this,"_render_interframe_delays",[]),ok(this,"_render_interframe_delays_sizes",[]),ok(this,"_videoState",sk.VideoStateStopped),ok(this,"videoElementCheckInterval",void 0),ok(this,"videoElementFreezeTimeout",void 0),ok(this,"_videoElementStatus",nk.NONE),ok(this,"_isInPage",!0),ok(this,"isGettingVideoDimensions",!1),ok(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return aO.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),ok(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===mk.curState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),yR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ok(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":"play"===e.type&&aO.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=nk.PLAYING;break;case"loadeddata":if(this.videoState=sk.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=nk.CANPLAY;break;case"stalled":this.videoElementStatus=nk.STALLED;break;case"suspend":this.videoElementStatus=nk.SUSPEND;break;case"pause":this.videoElementStatus=nk.PAUSED,sR()||vR()||$C()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=nk.WAITING;break;case"abort":this.videoElementStatus=nk.ABORT;break;case"ended":this.videoElementStatus=nk.ENDED;break;case"emptied":this.videoElementStatus=nk.EMPTIED;break;case"error":{const e=this.videoElement.error;e&&(this.videoElementStatus=nk.ERROR,aO.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,ZP.lastVisibleTime<ZP.lastHiddenTime||n<ZP.lastHiddenTime||n<ZP.lastVisibleTime)return;if(this.isSkipCalcRenderFreezeTime())return;for(t>RA("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ok(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),yR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),mk.on(xO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mk.on(xO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch(t=>{e&&Lk(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(aO.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):aO.warning("[".concat(this.trackId,"] play warning: "),t)});const n=qC();if(("Safari"===n.name&&15===Number(n.version)||fR())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return aO.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const s=n.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,n.width,n.height),new np((s,i)=>{n.toBlob(async e=>{if(n.remove(),e){const t=await $k(e);s({buffer:t,width:n.width,height:n.height})}else i(new IR(RR.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await Zk(e)}destroy(){this.isDestroyed=!0,mk.off(xO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mk.off(xO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=sk.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=nk.INIT,!this.videoElementCheckInterval&&(YD.forEach(e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(e){return e!==document.body&&document.body.contains(e)}(this.videoElement)},1e3),RA("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const s=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",s),this.videoElementFreezeTimeout=window.setTimeout(i,RA("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===sk.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=sk.VideoStateFrozen:document.addEventListener("visibilitychange",s))},r=(e,t)=>{if(this.videoElementStatus===nk.PLAYING){if(n){const e=t.presentationTime-n.presentationTime,s=t.presentedFrames-n.presentedFrames;this._render_interframe_delays_sizes.push(s),this._render_interframe_delays.push(e);const r=PI(this._render_interframe_delays_sizes),a=r-this._render_interframe_delays_sizes[0];if(r>30&&a>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===sk.VideoStateStarting&&(this.videoState=sk.VideoStateDecoding),this.videoState===sk.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,RA("VIDEO_FREEZE_DURATION"))),e<RA("VIDEO_FREEZE_DURATION")&&this.videoState===sk.VideoStateFrozen&&(this.videoState=sk.VideoStateDecoding),e>RA("VIDEO_FREEZE_DURATION")&&ZP.lastVisibleTime>=ZP.lastHiddenTime&&n.timestamp>ZP.lastVisibleTime&&n.timestamp>ZP.lastHiddenTime){const t=Math.min(66,zD(this._render_interframe_delays_sizes,this._render_interframe_delays)),n=Math.max(0,e-(s-1)*t);this.renderFreezeAccTime2+=n>t?n:0,this.renderFreezeAccTime+=e}}n=lk(lk({},t),{},{timestamp:e})}else this.isSkipCalcRenderFreezeTime()&&(n=lk(lk({},t),{},{timestamp:e}));var s,a;RA("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(s=(a=this.videoElement).requestVideoFrameCallback)||void 0===s||s.call(a,r))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,r)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),wR()&&!RA("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=qC();"Safari"===n.name&&15===Number(n.version)||fR()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nR()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nR()&&this.videoElement.load());const s=this.videoElement.play();void 0!==s&&s.catch(e=>{aO.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}resetVideoElement(){YD.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=nk.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===nk.DESTROYED||this.internal}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{aO.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(e=>{aO.error(e)}),this.autoplayFailed=!1,SR()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};SR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),jk()}}const YD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class XD extends qD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),ok(this,"container",void 0),ok(this,"slot",void 0),this.slot=e.element,this.internal=t,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;var n;!this.internal||this.slot?(t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()):(this.slot=t,t&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",null===(n=this.slot)||void 0===n||n.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await Zk(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),null===(e=this.slot)||void 0===e||e.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",RA("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),null===(e=this.slot)||void 0===e||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var JD,QD,ZD,$D,eP,tP,nP,sP,iP,rP,aP,oP,cP,lP,dP,uP,hP,pP,mP,fP,gP,yP,vP,_P,EP,bP,xP,wP,SP,NP,TP,CP,RP,IP,AP,OP,kP,DP;let PP=(JD=pO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),QD=Vk(),ZD=pO({argsMap:e=>[e.getTrackId()]}),$D=VI("LocalVideoTrack","_enabledMutex"),eP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),tP=Vk(),nP=VI("LocalVideoTrack","_enabledMutex"),sP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),iP=Vk(),rP=pO({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),aP=Vk(),oP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),cP=Vk(),lP=Vk(),dP=pO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),uP=Vk(),hP=Vk(),pP=Vk(),mP=pO({argsMap:e=>[e.getTrackId()]}),fP=Vk(),gP=Vk(),yP=Vk(),vP=Vk(),_P=Vk(),EP=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),bP=pO({argsMap:e=>[e.getTrackId()]}),xP=pO({argsMap:e=>[e.getTrackId()]}),wP=pO({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),SP=class e extends uk{get videoHeight(){if($C()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if($C()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nk.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,s,i,r){if(super(e,i),ok(this,"trackMediaType",KO.VIDEO),ok(this,"_player",void 0),ok(this,"isUseScaleResolutionDownBy",!1),ok(this,"_videoVisibleTimer",null),ok(this,"_previousVideoVisibleStatus",void 0),ok(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ok(this,"_encoderConfig",void 0),ok(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ok(this,"_optimizationMode",void 0),ok(this,"_saveEncodeBitrateRatio",1),ok(this,"_videoHeight",void 0),ok(this,"_videoWidth",void 0),ok(this,"_forceBitrateLimit",void 0),ok(this,"_enabled",!0),ok(this,"_processorDestination",void 0),ok(this,"_processorContext",void 0),$C()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=s,this._hints=r||[],t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)?this._encoderConfig=pI(t):this._encoderConfig=t,-1===this._hints.indexOf(UO.SCREEN_TRACK))this.updateBitrateFromProfile();else if(aR(WC.CHROME,115)&&-1!==XC().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&yO().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),s=new MediaStreamTrackGenerator({kind:"video"});let i,r,a=Date.now();const o=()=>{c&&(clearInterval(c),c=void 0),i&&(i.close(),i=void 0),e.stop(),r=void 0,s.removeEventListener("ended",o)};let c=window.setInterval(()=>{if(r&&i&&Date.now()-a>(null!=t?t:1e3))try{"live"===s.readyState?r.enqueue(i.clone()):o()}catch(e){o()}},null!=t?t:1e3);const l=new TransformStream({transform:(e,t)=>{"live"===s.readyState?(r=t,a=Date.now(),void 0===i?(i=e,t.enqueue(e.clone())):(t.enqueue(i),i=e)):e.close()}});return s.addEventListener("ended",o),n.readable.pipeThrough(l).pipeTo(s.writable),s}}(e);t&&(aO.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new Bk(this.getTrackId(),"local"),this._processorDestination=new Fk(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=lk(lk(lk({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new qD(n):this._player=new XD(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(WO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},RA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aI(this,MO.NEED_MUTE_TRACK,this):await aI(this,MO.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._saveEncodeBitrateRatio;if(1!==this._saveEncodeBitrateRatio&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),aO.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=AO(e),RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=qk({encoderConfig:e});($C()||sR()||vR())&&(t.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new IR(RR.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}getStats(){return gI(()=>{aO.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lk({},YO)}async setBeautyEffect(e){aO.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await Zk(e)}async findClosestProfile(){const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings(),{width:s,height:i,frameRate:r}=this._encoderConfig||{},a=DI(this._videoWidth||e||s||0),o=DI(this._videoHeight||t||i||0),c=function(e,t,n){if(!Array.isArray(RA("VIDEO_ENCODER_CONFIG_LIST")))return!1;if(0===RA("VIDEO_ENCODER_CONFIG_LIST").length)return!1;const s=Math.min(e,t);return!(s>=480)&&lk(lk({},RA("VIDEO_ENCODER_CONFIG_LIST").find(e=>e.height>s)),{},{frameRate:n})}(a,o,DI(n||r||15));if(c)return aO.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(a,"x").concat(o," => ").concat(JSON.stringify(c))),this.setEncoderConfiguration(c)}async setBitrateLimit(e){aO.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void aO.error(RR.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await aI(this,MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,aO.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return aO.error(RR.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,aO.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){zk(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(CI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");aO.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=AO(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:s,bitrateMin:i}=this._encoderConfig;if(null==i||null==s){const{max:r,min:a}=function(e,t,n,s,i){const r=RA("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===r)return{min:s,max:i};if(void 0===i){const a=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===r?4*a:2*a,s=null!=s?s:a}else s=null!=s?s:Math.floor(i/10);return{min:s,max:i}}(e,t,n,i,s);if(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=r,RA("VIDEO_STANDARD_BITRATE_VERSION")&&null==i&&null==s){const[s,i]=function(e,t,n){const s=4*Math.floor(2e5*Math.pow(n/15,.6)*Math.pow(e*t/230400,.75)),i=e*t,r=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),a=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let o=up(r).call(r).next().value,c=1;if(r.has(i))o=r.get(i);else{var l;const e=Xp(l=Array.from(r.entries())).call(l,(e,t)=>{let[n]=e,[s]=t;return n-s}),t=e.find(e=>{let[t]=e;return t>i});if(t){const n=e.indexOf(t);if(n>0){const s=e[n-1],r=(i-s[0])/(t[0]-s[0]);o=s[1]+r*(t[1]-s[1])}else o=t[1]}else o=e[e.length-1][1]}if(a.has(i))c=a.get(i);else{var d;const e=Xp(d=Array.from(a.entries())).call(d,(e,t)=>{let[n]=e,[s]=t;return n-s}),t=e.find(e=>{let[t]=e;return t>i});if(t){const n=e.indexOf(t);if(n>0){const s=e[n-1],r=(i-s[0])/(t[0]-s[0]);c=s[1]+r*(t[1]-s[1])}else c=t[1]}else c=e[e.length-1][1]}const u=RA("VIDEO_NEW_BITRATE_RATIO");u&&u>0&&(o=u/100);const h=Math.floor(s*o),p=Math.floor(65e4*Math.pow(e*t/230400,.5)*Math.pow(n/15,.69));let m=h;const f=RA("VIDEO_STANDARD_BITRATE_VERSION");return f&&f>0&&(1===f?m=s:2===f?m=h:3===f&&(m=p)),[Math.floor(m/1e3),c]}(e,t,n);this._encoderConfig.bitrateMax=s,this._encoderConfig.bitrateMin=a?Math.min(a,s):s,this._saveEncodeBitrateRatio=i,aO.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else aO.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(r,", brMin: ").concat(a,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),s={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:r}=s;if(this.isPlaying&&i instanceof HTMLVideoElement&&r instanceof HTMLElement){const e=FR.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new IR(RR.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;t&&(s=lk(lk({},s),AO(t))),s=mI(s);const i=NI(8,"track-video-cloned-"),r=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,mI(this._scalabilityMode),this._optimizationMode,i,mI(this._hints));return t&&s&&r.setEncoderConfiguration(s),aO.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),r}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new IR(RR.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new IR(RR.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(gI(()=>{mO.reportApiInvoke(null,{name:qR.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:YR.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!RA("ENABLE_VIDEO_SEI")||!RA("ENABLE_ENCODED_TRANSFORM"))return void aO.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new IR(RR.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void aO.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const s=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===s||"video/h265"===s?this.safeEmit("sei-to-send",e):aO.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($O.REQUEST_CONSTRAINTS)}},ak(SP.prototype,"play",[JD,QD],Object.getOwnPropertyDescriptor(SP.prototype,"play"),SP.prototype),ak(SP.prototype,"stop",[ZD],Object.getOwnPropertyDescriptor(SP.prototype,"stop"),SP.prototype),ak(SP.prototype,"setEnabled",[$D,eP,tP],Object.getOwnPropertyDescriptor(SP.prototype,"setEnabled"),SP.prototype),ak(SP.prototype,"setMuted",[nP,sP,iP],Object.getOwnPropertyDescriptor(SP.prototype,"setMuted"),SP.prototype),ak(SP.prototype,"setSaveEncodeBitrateRatio",[rP,aP],Object.getOwnPropertyDescriptor(SP.prototype,"setSaveEncodeBitrateRatio"),SP.prototype),ak(SP.prototype,"setEncoderConfiguration",[oP,cP],Object.getOwnPropertyDescriptor(SP.prototype,"setEncoderConfiguration"),SP.prototype),ak(SP.prototype,"getStats",[lP],Object.getOwnPropertyDescriptor(SP.prototype,"getStats"),SP.prototype),ak(SP.prototype,"setBeautyEffect",[dP,uP],Object.getOwnPropertyDescriptor(SP.prototype,"setBeautyEffect"),SP.prototype),ak(SP.prototype,"getCurrentFrameData",[hP],Object.getOwnPropertyDescriptor(SP.prototype,"getCurrentFrameData"),SP.prototype),ak(SP.prototype,"getCurrentFrameImage",[pP],Object.getOwnPropertyDescriptor(SP.prototype,"getCurrentFrameImage"),SP.prototype),ak(SP.prototype,"findClosestProfile",[mP,fP],Object.getOwnPropertyDescriptor(SP.prototype,"findClosestProfile"),SP.prototype),ak(SP.prototype,"setBitrateLimit",[gP],Object.getOwnPropertyDescriptor(SP.prototype,"setBitrateLimit"),SP.prototype),ak(SP.prototype,"setOptimizationMode",[yP],Object.getOwnPropertyDescriptor(SP.prototype,"setOptimizationMode"),SP.prototype),ak(SP.prototype,"setScalabiltyMode",[vP],Object.getOwnPropertyDescriptor(SP.prototype,"setScalabiltyMode"),SP.prototype),ak(SP.prototype,"updateMediaStreamTrackResolution",[_P],Object.getOwnPropertyDescriptor(SP.prototype,"updateMediaStreamTrackResolution"),SP.prototype),ak(SP.prototype,"pipe",[EP],Object.getOwnPropertyDescriptor(SP.prototype,"pipe"),SP.prototype),ak(SP.prototype,"unpipe",[bP],Object.getOwnPropertyDescriptor(SP.prototype,"unpipe"),SP.prototype),ak(SP.prototype,"close",[xP],Object.getOwnPropertyDescriptor(SP.prototype,"close"),SP.prototype),ak(SP.prototype,"replaceTrack",[wP],Object.getOwnPropertyDescriptor(SP.prototype,"replaceTrack"),SP.prototype),SP),jP=(NP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),TP=Vk(),CP=VI("CameraVideoTrack","_enabledMutex"),RP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),IP=Vk(),AP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),OP=Vk(),kP=pO({argsMap:e=>[e.getTrackId()]}),DP=class e extends PP{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,s,i,r){super(e,AO(t.encoderConfig),s,i,r),ok(this,"_config",void 0),ok(this,"_originalConstraints",void 0),ok(this,"_constraints",void 0),ok(this,"_enabled",!0),ok(this,"_deviceName","default"),ok(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(fR()||gR())&&!function(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&_R()&&this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=AO(this._config.encoderConfig),mk.on(xO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mk.on(xO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await kk.getDeviceById(e),n={};n.video=lk({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await Rk(n,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),s=await Rk({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await kk.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){aO.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:lk(lk({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await Rk(t,this.getTrackId())}catch(t){throw aO.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await Rk({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=lk({},t.video),aO.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await Rk({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=AO(e),RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=pI(this._config);n.encoderConfig=e;const s=qk(n);($C()||sR()||vR())&&(s.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(e){const t=new IR(RR.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=s,this._originalConstraints=s,this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((sR()||vR())&&this._enabled&&!this._isClosed&&mk.duringInterruption){const e=async()=>{mk.off(xO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mk.on(xO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=kk.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await Rk({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),mk.off(xO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mk.off(xO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;t&&(s=lk(lk({},s),AO(t))),s=mI(s);const i=NI(8,"track-cam-cloned-"),r=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,mI(lk(lk({},this._config),{},{encoderConfig:s})),mI(this._constraints),mI(this._scalabilityMode),this._optimizationMode,i);return t&&s&&r.setEncoderConfiguration(s),aO.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),r}bindProcessorContextEvents(){this.processorContext.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}),this.processorContext.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},ak(DP.prototype,"setDevice",[NP,TP],Object.getOwnPropertyDescriptor(DP.prototype,"setDevice"),DP.prototype),ak(DP.prototype,"setEnabled",[CP,RP,IP],Object.getOwnPropertyDescriptor(DP.prototype,"setEnabled"),DP.prototype),ak(DP.prototype,"setEncoderConfiguration",[AP,OP],Object.getOwnPropertyDescriptor(DP.prototype,"setEncoderConfiguration"),DP.prototype),ak(DP.prototype,"close",[kP],Object.getOwnPropertyDescriptor(DP.prototype,"close"),DP.prototype),DP);function LP(e,t,n,s){n.optimizationMode&&(s&&s.width&&s.height?(n.encoderConfig=lk(lk({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?aO.debug("[".concat(e,"] set content hint to"),n.optimizationMode):aO.debug("[".concat(e,"] set content hint failed")))):aO.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MP,UP,VP,FP,BP,GP,WP,HP,KP,zP,qP,YP;class XP extends dk{getUserId(){return this._userId}constructor(e,t,n,s){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(s.clientId,"_").concat(NI(5,""))),ok(this,"_userId",void 0),ok(this,"_uintId",void 0),ok(this,"_isDestroyed",!1),ok(this,"store",void 0),ok(this,"processor",void 0),ok(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=s}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,aO.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let JP=(MP=pO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),UP=pO({argsMap:e=>[e.getTrackId()]}),VP=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FP=pO({argsMap:e=>[e.getTrackId()]}),ak((BP=class extends XP{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nk.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,s,i){super(e,t,n,s),ok(this,"_videoVisibleTimer",null),ok(this,"_previousVideoVisibleStatus",void 0),ok(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ok(this,"trackMediaType",KO.VIDEO),ok(this,"_videoWidth",void 0),ok(this,"_videoHeight",void 0),ok(this,"_player",void 0),ok(this,"_prePlayer",void 0),ok(this,"processorDestination",void 0),ok(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new Bk(this.getTrackId(),"remote"),this.processorDestination=new Fk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return gI(()=>{aO.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lk({},QO)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.safeEmit(HO.PLAY_START),"string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=lk(lk({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let t=!1,s=!1;e instanceof HTMLVideoElement?(this._player=new qD(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,s=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,t=this._player.videoState>0,this._player.updateConfig(n)):this._player=new XD(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(HO.FIRST_FRAME_DECODED),s&&this.safeEmit(HO.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=e=>{this.safeEmit(HO.VIDEO_STATE_CHANGED,e)},t&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(HO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},RA("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(HO.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){zk(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(CI)}_updatePlayerSource(){aO.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),s={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:r}=s;if(this.isPlaying&&i instanceof HTMLVideoElement&&r instanceof HTMLElement){const e=FR.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new IR(RR.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(GO.SEI_RECEIVED,e)}}).prototype,"play",[MP],Object.getOwnPropertyDescriptor(BP.prototype,"play"),BP.prototype),ak(BP.prototype,"stop",[UP],Object.getOwnPropertyDescriptor(BP.prototype,"stop"),BP.prototype),ak(BP.prototype,"pipe",[VP],Object.getOwnPropertyDescriptor(BP.prototype,"pipe"),BP.prototype),ak(BP.prototype,"unpipe",[FP],Object.getOwnPropertyDescriptor(BP.prototype,"unpipe"),BP.prototype),BP),QP=(GP=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),WP=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),HP=pO({argsMap:e=>[e.getTrackId()]}),KP=pO({argsMap:e=>[e.getTrackId()]}),zP=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),qP=pO({argsMap:e=>[e.getTrackId()]}),ak((YP=class extends XP{get isPlaying(){return this._useAudioElement?Uk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,s){super(e,t,n,s),ok(this,"trackMediaType",KO.AUDIO),ok(this,"_source",void 0),ok(this,"_useAudioElement",!0),ok(this,"_volume",100),ok(this,"processorContext",void 0),ok(this,"processorDestination",void 0),ok(this,"_played",!1),ok(this,"_bypassWebAudio",!1),RA("DISABLE_WEBAUDIO")?(this._source=new Hk,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bk(e,!0),RA("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(zO.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(HO.FIRST_FRAME_DECODED)}),this.processorContext=new Wk(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Gk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(zO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),this._source.on(zO.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){this._volume=e,this._useAudioElement?Uk.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!vO())throw new IR(RR.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Uk.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return gI(()=>{aO.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lk({},XO)}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] use audio element to play")),Uk.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Uk.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Uk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ZO.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK),this.processorDestination.removeAllListeners(ZO.ON_NODE)}}).prototype,"setVolume",[GP],Object.getOwnPropertyDescriptor(YP.prototype,"setVolume"),YP.prototype),ak(YP.prototype,"setPlaybackDevice",[WP],Object.getOwnPropertyDescriptor(YP.prototype,"setPlaybackDevice"),YP.prototype),ak(YP.prototype,"play",[HP],Object.getOwnPropertyDescriptor(YP.prototype,"play"),YP.prototype),ak(YP.prototype,"stop",[KP],Object.getOwnPropertyDescriptor(YP.prototype,"stop"),YP.prototype),ak(YP.prototype,"pipe",[zP],Object.getOwnPropertyDescriptor(YP.prototype,"pipe"),YP.prototype),ak(YP.prototype,"unpipe",[qP],Object.getOwnPropertyDescriptor(YP.prototype,"unpipe"),YP.prototype),YP);const ZP=new class extends HR{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ok(this,"_lastHiddenTime",0),ok(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),aO.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class $P extends HR{constructor(e,t){super(),ok(this,"trackMediaType",KO.DATA),ok(this,"_version",1),ok(this,"_type",3),ok(this,"_config",void 0),ok(this,"_originDataChannel",void 0),ok(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ok(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),ok(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return RA("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new np((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout(()=>{var e;t(new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[rk.OPEN,rk.CLOSE,rk.ERROR].forEach(t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[n,s]=t;e.removeEventListener(n,s)}),this._datachannelEventMap.clear()}}class ej extends $P{constructor(e){super(e),ok(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(RA("SHOW_DATASTREAM2_LOG")&&aO.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let s=e.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(rk.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class tj extends $P{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function nj(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>bv.revokeObjectURL(e),0),new Worker(bv.createObjectURL(e))}const sj=71,ij=1,rj=2,aj=1,oj=2;var cj=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(cj||{});function lj(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.getUint8(0);if(n!==sj)return;const s=e.getUint16(1),i=ij+rj+s,r=new Uint8Array(e.byteLength-i);r.set(new Uint8Array(e.buffer,i,e.byteLength-i));const a={m:n,tlvLen:s,tlv:[],frame:r};let o=ij+rj;for(;o<i;){const n=e.getUint8(o),s=e.getUint16(o+aj),i=aj+oj;if(n===cj.AUDIO_LEVEL){let r=e.getUint8(o+i);for(let t=1;t<s;t++)r=r<<8|e.getUint8(o+i+t);a.tlv.push({tag:n,length:s,value:t?127^r>>1:127&r})}else if(n===cj.METADATA||n===cj.AUDIO_64_BIT_PTS){const t=new Uint8Array(s);for(let n=0;n<s;n++)t[n]=e.getUint8(o+i+n);a.tlv.push({tag:n,length:s,value:t})}o+=i+s}return a}const dj=new Map,uj=127,hj=1e-10,pj=139/13,mj=new Map;function fj(e,t,n){const s="".concat(e,"-").concat(t,"-").concat(n);let i=0;if(mj.has(s))i=mj.get(s);else{const r=.5;i=Math.log(function(e,t){const n=e-t;t<n&&(t=n);let s=1;for(let i=e,r=1;i>t;i--,r++)s=s*i/r;return s}(t,e))+e*Math.log(r)+(t-e)*Math.log(1-r)-Math.log(n)+n*e,mj.set(s,i)}return i<hj&&(i=hj),i}function gj(e,t,n){const s=t.length,i=e.length/s;let r=!1;for(let a=0,o=0;a<s;a++){let s=0;for(let t=o+i;o<t;o++)e[o]>n&&s++;t[a]!==s&&(t[a]=s,r=!0)}return r}window.cache=mj;let yj=0;class vj{constructor(e){ok(this,"id",void 0),ok(this,"immediates",[]),ok(this,"lastNonSilence",-1),ok(this,"immediateSpeechActivityScore",hj),ok(this,"lastLevelChangedTime",Date.now()),ok(this,"levels",[]),ok(this,"longs",[]),ok(this,"longSpeechActivityScore",hj),ok(this,"mediums",[]),ok(this,"mediumSpeechActivityScore",hj),ok(this,"minLevel",0),ok(this,"nextMinLevel",0),ok(this,"nextMinLevelWindowLength",0),ok(this,"energyScore",0),this.id=e||"".concat(yj++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,t=this.levels,n=this.minLevel+pj;let s=!1;for(let i=0;i<e.length;++i){let r=t[i];r<n&&(r=0);const a=Math.floor(r/pj);e[i]!==a&&(e[i]=a,s=!0)}return s}computeLongs(){return gj(this.mediums,this.longs,4)}computeMediums(){return gj(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=fj(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=fj(this.longs[0],10,47),this.longSpeechActivityScore>hj&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=fj(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(yi(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let n=e;return e<0&&(n=0),e>uj&&(n=uj),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+pj?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>uj&&(e=uj),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class _j{constructor(e){ok(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Ej{constructor(e,t,n){ok(this,"isDominant",void 0),ok(this,"energyRanking",void 0),ok(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n}}class bj extends HR{constructor(e){super(),ok(this,"dominantId",null),ok(this,"lastDecisionTime",0),ok(this,"lastLevelChangedTime",0),ok(this,"lastLevelIdleTime",0),ok(this,"relativeSpeechActivities",[]),ok(this,"speakers",new Map),ok(this,"enableSilence",!1),ok(this,"timeoutToSilenceInterval",0),ok(this,"decisionMaker",null),ok(this,"loudest",[]),ok(this,"numLoudestToTrack",3),ok(this,"energyExpireTimeMs",250),ok(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=n&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(t=>t.id===e)}levelChanged(e,t){const n=Date.now(),s=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());const i=s.levelChanged(t,n);return this.updateLoudestList(s,i,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)})}removeSpeakers(e){e.forEach(e=>{this.speakers.delete(e.id)})}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new vj(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,n){const s=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new Ej(s,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new Ej(s,0,e.energyScore);const i=n-this.energyExpireTimeMs;let r=0;for(;r<this.loudest.length;){const t=this.loudest[r];if(t.getLastLevelChangedTime()<i&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(r,1);else if(t.id!==e.id)++r;else if(this.loudest.splice(r,1),this.loudest.length<this.numLoudestToTrack)break}let a=0;for(;a<this.loudest.length&&!(this.loudest[a].energyScore<e.energyScore);)++a;return a<this.numLoudestToTrack&&(this.loudest.splice(a,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Ej(s,a,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new _j(this),this.decisionMaker.execute())}makeDecision(e){let t=null,n=null;const s=this.speakers.size;let i=null;if(0===s)i=null;else if(1===s){var r;const t=up(r=this.speakers).call(r).next().value;this.enableSilence&&t&&(i=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){const e=this.speakers.entries().next();e.value&&(i=e.value[0],t=e.value[1])}else i=t.id;null!=t&&t.evaluateSpeechActivityScores(e);const n=this.relativeSpeechActivities;let s=2;for(const r of this.speakers.entries()){const[a,o]=r;if(o===t)continue;o.evaluateSpeechActivityScores(e);for(let e=0;e<n.length;++e){const s=null==t?hj:t.getSpeechActivityScore(e);n[e]=Math.log(o.getSpeechActivityScore(e)/s)}const c=n[0],l=n[1],d=n[2];c>3&&l>2&&d>0&&l>s&&(s=l,i=a)}this.enableSilence&&null!=t&&i===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null)}null==i&&!this.enableSilence||i===this.dominantId||(t=this.dominantId,this.dominantId=i,n=this.dominantId),null==n&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){const e=Date.now(),t=300-(e-this.lastLevelIdleTime);let n=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;let s=300-(e-this.lastDecisionTime);return s<=0&&(this.lastDecisionTime=e,this.makeDecision(e),s=300-(Date.now()-e)),s>0&&n>s&&(n=s),n}timeoutIdleLevels(e){const t=[];for(const s of up(n=this.speakers).call(n)){var n;const i=e-s.getLastLevelChangedTime();36e5<i&&(null==this.dominantId||s.id!==this.dominantId)?t.push(s.id):300<i&&s.levelTimedOut()}t.forEach(e=>this.speakers.delete(e))}}const xj=new Map;let wj=null,Sj=null;const Nj=3;let Tj=[];const Cj=new Map,Rj=new Map;class Ij{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){ok(this,"id",void 0),ok(this,"track",void 0),ok(this,"score",0),ok(this,"active",!0),ok(this,"muted",!1),ok(this,"timer",0),ok(this,"actives",0),ok(this,"inactives",0),this.id=e,this.track=t,this.setActive(Cj.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:t,inactives:n}=function(){const e=[],t=[];return Array.from(up(Cj).call(Cj)).forEach(n=>{n.active?e.push(n):t.push(n)}),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach(t=>{(!e||e.score>t.score)&&(e=t)}),e&&e.setActive(!1)}if(t.length<3&&n.length>0){let t;n.forEach(e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)}),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(e){let t;return Array.from(up(Cj).call(Cj)).forEach(n=>{!n.active||n.id===e||n.samples<40||(!t||n.score<t.score)&&(t=n)}),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(e){let t;return Array.from(up(Cj).call(Cj)).forEach(n=>{n.active||n.id===e||n.samples<40||(!t||n.score>t.score)&&(t=n)}),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Aj;function Oj(e){const t=Cj.get(e);t&&(Cj.delete(e),t.clearTimer())}const kj=new Map,Dj=new Map,Pj="video/h264",jj="video/h265";function Lj(e,t,n){let s=new Uint8Array(e,t,n),i=[],r=0;for(;i.length<n;)r+3<n&&0===s[r]&&0===s[r+1]&&3===s[r+2]&&(0===s[r+3]||1===s[r+3]||2===s[r+3]||3===s[r+3])?(i.push(s[r],s[r+1],s[r+3]),r+=4):(i.push(s[r]),r++);return new Uint8Array(i)}function Mj(e){const t=e.length;let n=[],s=0;for(;s<t;)s+2<t&&0===e[s]&&0===e[s+1]&&(0===e[s+2]||1===e[s+2]||2===e[s+2]||3===e[s+2])?(n.push(e[s],e[s+1],3,e[s+2]),s+=3):(n.push(e[s]),s++);return new Uint8Array(n)}function Uj(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(0===e[i]&&0===e[i+1]&&1===e[i+2]){t=i;break}if(i<e.length-4&&0===e[i]&&0===e[i+1]&&0===e[i+2]&&1===e[i+3]){t=i;break}}if(-1===t)return"";const n=t+(0===e[t+2]?4:3);if(n>=e.length)return"";const s=e[n];return 128&s?"":(s>>1&63)>=32||n+1<e.length&&0==(248&e[n+1])?jj:(31&s)<=31?Pj:""}const Vj=new Map,Fj=new Map;!function(){const e=qC();gO.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gO.getStreamFromExtension=e.name===WC.CHROME&&Number(e.version)>34,gO.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),gO.supportMinBitrate=e.name===WC.CHROME||e.name===WC.EDGE,gO.supportSetRtpSenderParameters=function(){const e=qC();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!xR()||!(!$C()&&!QC())||e.name===WC.FIREFOX&&Number(e.version)>=64)}(),e.name===WC.SAFARI&&(Number(e.version)>=14?gO.supportDualStream=!0:gO.supportDualStream=!1),gO.webAudioMediaStreamDest=function(){const e=qC();return!(e.name===WC.SAFARI&&Number(e.version)<12)}(),gO.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,gO.supportWebGL="undefined"!=typeof WebGLRenderingContext,gO.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,xR()||(gO.webAudioWithAEC=!0),gO.supportShareAudio=function(){const e=qC();return(e.os===GC.WIN_10||e.os===GC.WIN_81||e.os===GC.WIN_7||e.os===GC.LINUX||e.os===GC.MAC_OS||e.os===GC.CHROMIUM_OS)&&e.name===WC.CHROME&&Number(e.version)>=74}(),gO.supportDataChannel=!!(iR(76)||cR(68)||lR(14)),gO.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!nR()&&!!e&&e.prototype.setConfiguration instanceof Function}(),gO.supportWebRTCEncodedTransform=iR(87)||eR()||cR(117),gO.supportWebRTCInsertableStream=function(){const e=qC();return(e.name===WC.CHROME||e.name===WC.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gO.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gO.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,hI(()=>{gO.supportDualStreamEncoding=function(){const e=qC();return!!RA("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&RA("CHROME_DUAL_STREAM_USE_ENCODING"))}(),aO.debug("browser ua: ",navigator.userAgent),aO.info("browser info: ",e),aO.info("browser compatibility: ",gO)})}();const Bj=["CHINA","GLOBAL"],Gj=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Wj=[],Hj=[];function Kj(e,t){return!!t&&Wj.some(n=>n.uid===e&&n.channelName===t)}function zj(){return Hj.length>0}var qj=Cx.forEach,Yj=Hs("forEach")?[].forEach:function(e){return qj(this,e,arguments.length>1?arguments[1]:void 0)};On({target:"Array",proto:!0,forced:[].forEach!==Yj},{forEach:Yj});var Xj=es("Array","forEach"),Jj=gs,Qj=et,Zj=u,$j=Xj,eL=Array.prototype,tL={DOMTokenList:!0,NodeList:!0},nL=function(e){var t=e.forEach;return e===eL||Zj(eL,e)&&t===eL.forEach||Qj(tL,Jj(e))?$j:t},sL=s(nL),iL=Qe,rL=hr;On({target:"Object",stat:!0,forced:i(function(){rL(1)})},{keys:function(e){return rL(iL(e))}});var aL=s(ee.Object.keys),oL=s(si),cL=s(gi),lL=On,dL=ai,uL=Qc,hL=$,pL=Fn,mL=Kn,fL=Q,gL=qf,yL=mt,vL=al,_L=Bb("slice"),EL=yL("species"),bL=Array,xL=Math.max;lL({target:"Array",proto:!0,forced:!_L},{slice:function(e,t){var n,s,i,r=fL(this),a=mL(r),o=pL(e,a),c=pL(void 0===t?a:t,a);if(dL(r)&&(n=r.constructor,(uL(n)&&(n===bL||dL(n.prototype))||hL(n)&&null===(n=n[EL]))&&(n=void 0),n===bL||void 0===n))return vL(r,o,c);for(s=new(void 0===n?bL:n)(xL(c-o,0)),i=0;o<c;o++,i++)o in r&&gL(s,i,r[o]);return s.length=i,s}});var wL=es("Array","slice"),SL=u,NL=wL,TL=Array.prototype,CL=function(e){var t=e.slice;return e===TL||SL(TL,e)&&t===TL.slice?NL:t},RL=s(CL);function IL(e,t,n,s,i){var r,a,o,c={};return sL(r=aL(s)).call(r,function(e){c[e]=s[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=oL(a=cL(o=RL(n).call(n)).call(o)).call(a,function(n,s){return s(e,t,n)||n},c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer?(Ib(e,t,c),null):c}let AL=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),OL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),kL=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),DL=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),PL=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),jL=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),LL=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),ML=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),UL=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),VL=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),FL=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),BL=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function GL(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw aO.error("Invalid Channel Name ".concat(e)),new fO(RR.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function WL(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||MR(e,1,255)))throw new fO(RR.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&aO.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let HL=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const KL={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},zL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qL(e,t){PR(e.url,"".concat(t,".url"),1,1e3,!1),LR(e.x)||kR(e.x,"".concat(t,".x"),0,1e4),LR(e.y)||kR(e.y,"".concat(t,".y"),0,1e4),LR(e.width)||kR(e.width,"".concat(t,".width"),0,1e4),LR(e.height)||kR(e.height,"".concat(t,".height"),0,1e4),LR(e.zOrder)||kR(e.zOrder,"".concat(t,".zOrder"),0,255),LR(e.alpha)||kR(e.alpha,"".concat(t,".alpha"),0,1,!1)}const YL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let XL=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),JL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),QL=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function ZL(e){if(!e.channelName)throw new fO(RR.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new fO(RR.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&PR(e.token,"info.token",1,2047),WL(e.uid),GL(e.channelName),!0}let $L=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),eM=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),tM=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),nM=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),sM=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),iM=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),rM=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),aM=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),oM=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const cM=[oM.AFRICA,oM.ASIA,oM.CHINA,oM.EUROPE,oM.GLOBAL,oM.INDIA,oM.JAPAN,oM.NORTH_AMERICA,oM.OCEANIA,oM.OVERSEA,oM.SOUTH_AMERICA];let lM=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const dM={CHINA:{},ASIA:{CODE:lM.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:lM.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:lM.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:lM.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:lM.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:lM.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:lM.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:lM.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:lM.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:lM.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:lM.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:lM.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:lM.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};_A&&(dM.CHINA={CODE:lM.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let uM=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function hM(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class pM extends HR{constructor(e,t){super(),uN(this,"onICEConnectionStateChange",void 0),uN(this,"onConnectionStateChange",void 0),uN(this,"onDTLSTransportStateChange",void 0),uN(this,"onDTLSTransportError",void 0),uN(this,"onICETransportStateChange",void 0),uN(this,"onFirstAudioReceived",void 0),uN(this,"onFirstVideoReceived",void 0),uN(this,"onFirstAudioDecoded",void 0),uN(this,"onFirstVideoDecoded",void 0),uN(this,"onFirstVideoRender",void 0),uN(this,"onFirstVideoDecodedTimeout",void 0),uN(this,"onSelectedLocalCandidateChanged",void 0),uN(this,"onSelectedRemoteCandidateChanged",void 0),uN(this,"onICECandidateError",void 0),uN(this,"getLocalVideoStats",void 0)}}class mM extends pM{constructor(e,t){super(e,t),uN(this,"establishPromise",void 0)}}let fM=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),gM=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),yM=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const vM=["disconnected","failed"];let _M=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),EM=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),bM=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),xM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),wM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),SM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),NM=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),TM=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),CM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),RM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),IM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),AM=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),OM=function(e){return e.ABORT="abort",e}({}),kM=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),DM=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const PM={[AL.ACCESS_POINT]:{[DL.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[DL.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[DL.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[DL.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[DL.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[DL.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[DL.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[AL.UNILBS]:{[kL.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[kL.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[kL.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[kL.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[kL.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[kL.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[kL.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[kL.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[kL.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[kL.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[kL.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[kL.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[AL.STRING_UID_ALLOCATOR]:{[OL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[OL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[OL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function jM(e){const t=PM[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===AL.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const LM={[PL.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[PL.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[PL.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[PL.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[PL.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[PL.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[PL.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[PL.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[PL.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[PL.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[PL.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[PL.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[PL.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[PL.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[PL.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[PL.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[PL.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[PL.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[PL.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[PL.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[PL.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[PL.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[PL.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[PL.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[PL.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[PL.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[PL.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[PL.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[PL.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[PL.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[PL.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[PL.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[PL.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[PL.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[PL.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[PL.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[PL.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[PL.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[PL.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[PL.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[PL.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[PL.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[PL.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[PL.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[PL.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[PL.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[PL.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[PL.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[PL.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[PL.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[PL.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[PL.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[PL.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[PL.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[PL.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[PL.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[PL.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[PL.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[PL.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[PL.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[PL.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[PL.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[PL.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[PL.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function MM(e){return LM[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function UM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function VM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UM(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function FM(e,t){if("string"==typeof e)return e;const{proxy:n,host:s,port:i}=e;if(t){const e=RA("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(s,"/ws/?p=").concat(Number(i)+150):"wss://".concat(s,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(s,"&p=").concat(i):"wss://".concat(s,":").concat(i)}const BM=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,GM=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,WM=/wss:\/\/(.+):([0-9]+)\/?/,HM=/wss:\/\/(.[^\/]+)\/?/;let KM=0;class zM{constructor(e,t){uN(this,"id",0),uN(this,"store",void 0),uN(this,"recordIndex",void 0),uN(this,"websockets",[]),uN(this,"try443PortDuration",2e3),uN(this,"forceCloseWSDuration",5e3),uN(this,"try443PortTimeout",null),uN(this,"forceCloseTimeout",null),uN(this,"isTry443PortFailed",!1),uN(this,"isNormalPortFailed",!1),uN(this,"useDoubleDomain",!1),uN(this,"useProxy",!1),uN(this,"startTime",Date.now()),this.id=++KM,this.try443PortDuration=RA("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];aO.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...s)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const s=RA("GATEWAY_DOMAINS"),i=Date.now(),r=[],a=s.find(t=>{var n;return Ps(n=e.host).call(n,t)});a||(this.useDoubleDomain=!1);const o=[];if(this.useDoubleDomain)s.forEach(n=>{o.push(FM(VM(VM({},e),{},{host:e.host.replace(a,n)}),t))});else{const n=VM({},e);if(t&&a){const e=s.find(e=>e!==a);e&&(n.host=n.host.replace(a,e))}o.push(FM(n,t))}try{o.forEach(e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",r.push(t),this.logger("ws is connecting:",t.url)})}catch(s){if(this.logger("ws create failed"),r.forEach(e=>e.close()),r.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new fO(RR.WS_ERR,"init websocket failed! Error: ".concat(s.toString()))}const c=UC();this.store&&this.store.recordJoinChannelService({urls:r.map(e=>e.url),service:"gateway"},this.recordIndex),r.forEach(e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach(t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))}),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState));const s=r.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(s)),s&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:rM.A_ROUND_WS_FAILED})):!t&&s&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),d()),t?this.isTry443PortFailed=s:this.isNormalPortFailed=s},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))}),this.websockets.push(...r);const l=()=>{this.websockets.forEach(e=>e.readyState!==WebSocket.OPEN&&e.close())},d=()=>{if(c.isResolved)return l();qC().os===GC.MAC_OS&&nR()&&l(),this.createWebSocket(e,!0,!0).then(e=>{c.resolve(e)}).catch(e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,l()},this.forceCloseWSDuration)};return n||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,l()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,d()},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,s){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,s;return[,t,n,s]=e.match(BM)||[],t||([,n,s]=e.match(GM)||[]),n&&s||([,n,s]=e.match(WM)||[]),n&&s||([,n]=e.match(HM)||[]),n||aO.warning("un-destructible url: ",e),{proxy:t,host:n,port:s||"443"}}(e)),this.recordIndex=s,this.useProxy=!!e.proxy,n&&this.useProxy&&(aO.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally(()=>this.clearTimeout())}}function qM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}class YM extends HR{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Ps(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(BL.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(BL.CONNECTED):"closed"===this._state?this.emit(BL.CLOSED):"failed"===this._state&&this.emit(BL.FAILED))}resetReconnectCount(e){aO.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5?arguments[5]:void 0;super(),uN(this,"_websocketUrl",null),uN(this,"connectionID",0),uN(this,"currentURLIndex",0),uN(this,"urls",[]),uN(this,"_reconnectMode","tryNext"),uN(this,"reconnectReason",void 0),uN(this,"_initMutex",void 0),uN(this,"name",void 0),uN(this,"_state","closed"),uN(this,"reconnectInterrupter",void 0),uN(this,"websocket",void 0),uN(this,"retryConfig",void 0),uN(this,"reconnectCount",0),uN(this,"forceCloseTimeout",5e3),uN(this,"onlineReconnectListener",void 0),uN(this,"useCompress",void 0),uN(this,"tryDoubleDomain",!1),uN(this,"use443PortOnly",!1),uN(this,"wsInflateLength",0),uN(this,"wsDeflateLength",0),uN(this,"closeEstablishingWs",()=>{}),uN(this,"store",void 0),uN(this,"joinGatewayRecordIndex",void 0),this.store=r,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qM(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t),this.useCompress=n,this.tryDoubleDomain=s,this.use443PortOnly=i,this._initMutex=new UI("websocket",r?r.clientId:void 0);const{timeout:a,timeoutFactor:o}=t,c=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*o)/10);sI.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),lI.on(iI.NETWORK_STATE_CHANGE,(e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===sI.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=o))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{var s;const e=UC(),t=this.urls[this.currentURLIndex];null===(s=this.store)||void 0===s||s.beforeConnect(),function(e){return!(_O()||RA("USE_NEW_TOKEN")||!RA("ENABLE_PREALLOC_PC")&&(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(NM.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(BL.CLOSED,()=>{e.reject(new IR(RR.WS_DISCONNECT))}),this.once(BL.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout(()=>e.close(),500):e.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void aO.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),aO.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new IR(RR.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new IR(RR.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=UC();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),aO.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(aO.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new IR(RR.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=oI(this,BL.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,s=await this.reconnectWithAction(t);if("closed"===this.state)return void aO.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!s)return n.reject(new IR(RR.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},r=e=>{this.emit(BL.ON_MESSAGE,e)},a=e=>{aO.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),RA("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=RA("GATEWAY_WSS_ADDRESS")),aO.debug("[".concat(this.name,"] start connect, url:"),e);const o=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;this._websocketUrl=FM(e);const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,s&&s(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=r,this.websocket.onerror=a,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},o),this.joinGatewayRecordIndex=o}catch(e){const t="closed"===this.state,s=e instanceof IR,r=s&&e.code===RR.WS_ABORT,a=s&&e.code===RR.WS_ERR,c=s?e.message:e&&(e.reason||e.toString());aO.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:r?"aborted":"error",errors:[e]},o),t||a?(n.reject(t?new IR(RR.WS_DISCONNECT,"websocket is closed: ".concat(c)):new IR(RR.WS_ERR,"init websocket failed: ".concat(c))),a&&aO.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;aO.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||lI.isOnline||!lI.onlineWaiter||(this.onlineReconnectListener=lI.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=BI(this.reconnectCount,this.retryConfig);aO.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await np.race([SI(t),this.onlineReconnectListener||new np(()=>{})])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const s=async(e,t)=>{this.emit(BL.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await s(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);aO.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await s(this.urls[this.currentURLIndex],e)}else"recover"===e&&(aO.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await rI(this,BL.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],e))}catch(n){var i;aO.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const s=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(s)&&Ps(s).call(s,"dynamic key expired")?(this.emit(BL.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class XM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=UC(),s=function(e,t){return new zM(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),n.reject(new IR(RR.WS_ABORT,"choose best websocket aborted"))};const i=RA("GATEWAY_DOMAINS");return aO.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class JM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new np((n,s)=>{let i=!1;const r=[];this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),r.forEach(e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()}),s(new IR(RR.WS_ABORT,"choose best websocket aborted"))};const a=RA("GATEWAY_DOMAINS");let o;const c=e.indexOf("?h="),l=a.find(t=>-1!==c?Ps(e).call(e,t,c):Ps(e).call(e,t));aO.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let d=!this.tryDoubleDomain||!l;if(!d&&l){var u;const h=Date.now();try{a.forEach(t=>{const n=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),s=new WebSocket(n);s.binaryType="arraybuffer",r.push(s),aO.debug("[choose-best-ws] ws is connecting:",s.url)})}catch(e){for(aO.debug("[choose-best-ws] ws create failed, fallback to single url"),r.forEach(e=>e.close());r.length;)r.pop();d=!0}null===(u=this.store)||void 0===u||u.recordJoinChannelService({urls:r.map(e=>e.url),service:"gateway"},t),r.forEach(e=>{e.onopen=()=>{if(i)return;const t=Date.now()-h;aO.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),r.filter(t=>t!==e).forEach(e=>{aO.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()}),i=!0,n(e)},e.onclose=e=>{o=e,i||r.find(e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))||(aO.debug("[choose-best-ws] all websocket is closed"),i=!0,s(o))},e.onmessage=t=>{aO.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}}),SI(this.forceCloseTimeout).then(()=>{r.forEach(e=>{e.readyState!==WebSocket.OPEN&&e.close()})})}if(d){var h;let i;aO.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),r.push(i),i.binaryType="arraybuffer"}catch(e){const n=new IR(RR.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return aO.error("[".concat(this.name,"]").concat(n)),void s(n)}i.onopen=()=>{n(i)},i.onclose=e=>{s(e)},i.onmessage=e=>{aO.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},SI(this.forceCloseTimeout).then(()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()})}}).then(e=>(this.closeEstablishingWs=void 0,e)).catch(e=>{throw this.closeEstablishingWs=void 0,e})}}class QM extends HR{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===jL.CONNECTED?this.emit(LL.WS_CONNECTED):e===jL.RECONNECTING?this.emit(LL.WS_RECONNECTING,this._websocketReconnectReason):e===jL.CLOSED&&this.emit(LL.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uN(this,"_disconnectedReason",void 0),uN(this,"_websocketReconnectReason",void 0),uN(this,"_connectionState",jL.CLOSED),uN(this,"reconnectToken",void 0),uN(this,"websocket",void 0),uN(this,"openConnectionTime",void 0),uN(this,"clientId",void 0),uN(this,"lastMsgTime",Date.now()),uN(this,"uploadCache",[]),uN(this,"uploadCacheInterval",void 0),uN(this,"rttRolling",new HI(5)),uN(this,"pingpongTimer",void 0),uN(this,"wsInflateDataTimer",void 0),uN(this,"pingpongTimeoutCount",0),uN(this,"ortc",void 0),uN(this,"joinResponse",void 0),uN(this,"multiIpOption",void 0),uN(this,"initError",void 0),uN(this,"spec",void 0),uN(this,"store",void 0),uN(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(LL.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===VL.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===VL.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QR.UID_BANNED);break;case 15:this.close(QR.IP_BANNED);break;case 16:this.close(QR.CHANNEL_BANNED)}if(t._type===VL.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case PL.ERR_LICENSE_MISSING:this.close(QR.LICENSE_MISSING);break;case PL.ERR_LICENSE_EXPIRED:this.close(QR.LICENSE_EXPIRED);break;case PL.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QR.LICENSE_MINUTES_EXCEEDED);break;case PL.ERR_LICENSE_PERIOD_INVALID:this.close(QR.LICENSE_PERIOD_INVALID);break;case PL.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QR.LICENSE_MULTIPLE_SDK_SERVICE);break;case PL.ERR_LICENSE_ILLEGAL:this.close(QR.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,RA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),RA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===jL.CONNECTED&&this.reconnect("retry",nI.OFFLINE)})}async request(e,t,n,s){const i=NI(6,""),r={_id:i,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new np((t,n)=>{if(this.connectionState===jL.CONNECTED)return t();const s=()=>{this.off(LL.WS_CLOSED,i),t()},i=()=>{this.off(LL.WS_CONNECTED,s),n(new fO(RR.WS_ABORT))};this.once(LL.WS_CONNECTED,s),this.once(LL.WS_CLOSED,i),e!==ML.PUBLISH&&e!==ML.PUBLISH_DATASTREAM&&e!==ML.SUBSCRIBE&&e!==ML.SUBSCRIBE_DATASTREAM&&e!==ML.UNSUBSCRIBE&&e!==ML.UNSUBSCRIBE_DATASTREAM&&e!==ML.UNPUBLISH&&e!==ML.UNPUBLISH_DATASTREAM&&e!==ML.CONTROL&&e!==ML.RESTART_ICE||this.once(LL.DISCONNECT_P2P,()=>{n(new fO(RR.DISCONNECT_P2P))}),e!==ML.PUBLISH&&e!==ML.RESTART_ICE||this.once(LL.ABORT_P2P_EXECUTION,()=>{n(new fO(RR.DISCONNECT_P2P))})});if(this.connectionState!==jL.CONNECTING&&this.connectionState!==jL.RECONNECTING||e===ML.JOIN||e===ML.REJOIN||await o(),this.websocket.sendMessage(r,!0),s)return;const c=new np((n,s)=>{let r=!1;const o=(s,i)=>{r=!0,n({isSuccess:"success"===s,message:i||{}}),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.emit(LL.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),o);const c=()=>{s(new fO(RR.WS_ABORT,"type: ".concat(e))),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.off("res-@".concat(i),o)};this.once(LL.WS_CLOSED,c),this.once(LL.WS_RECONNECTING,c),SI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||r||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(LL.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(s){if(this.connectionState===jL.CLOSED||e===ML.LEAVE)throw new fO(RR.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?s.throw():e===ML.JOIN||e===ML.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new fO(RR.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===PL.ERR_TOO_MANY_BROADCASTERS?e===ML.JOIN||e===ML.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===PL.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nI.MULTI_IP)):this.reconnect(u.action,nI.SERVER_ERROR),e===ML.JOIN||e===ML.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np(n=>{const s=i=>{(!t||t(i))&&(this.off(e,s),n(i))};this.on(e,s)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(UL.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=RA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==jL.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},RA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np((t,n)=>{this.once(LL.WS_CONNECTED,()=>t(this.joinResponse)),this.once(LL.WS_CLOSED,e=>n(this.initError||new fO(RR.WS_ABORT,e))),this.connectionState=jL.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||QR.LEAVE,this.connectionState=jL.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(LL.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await rI(this,LL.REQUEST_JOIN_INFO);this.store.joinReq();const t=await this.request(ML.JOIN,e);if(this.ortc=null==e?void 0:e.ortc,this.store.joinRep(),!t)return this.emit(LL.REPORT_JOIN_GATEWAY,rM.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(LL.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=jL.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new fO(RR.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=cI(this,LL.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(ML.REJOIN,e);return!!t&&(this.connectionState=jL.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(e=>{this.emit(VL.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(VL.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(VL.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(VL.MUTE_AUDIO,{uid:e.uid}):this.emit(VL.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(VL.MUTE_VIDEO,{uid:e.uid}):this.emit(VL.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(VL.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(VL.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(VL.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(VL.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(VL.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){if(!this.ortc)return!1;const t={downgrade_codec:e,ortc:this.ortc};return!!await this.request(ML.DOWNGRADE_CODEC,t)}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if(28===e.code&&"detail"in e&&(aO.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(LL.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QR.UID_BANNED),void this.close()):void this.reconnect(t.action,nI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=RA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>RA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nI.TIMEOUT):this.request(ML.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),RA("REPORT_STATS")&&this.send(ML.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(UL.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(BL.RECONNECT_CREATE_CONNECTION,e=>{this.emit(LL.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(BL.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(BL.CLOSED,()=>{this.connectionState=jL.CLOSED}),this.websocket.on(BL.FAILED,()=>{this._disconnectedReason=QR.NETWORK_ERROR,this.connectionState=jL.CLOSED}),this.websocket.on(BL.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===jL.CONNECTED?this.connectionState=jL.RECONNECTING:this.connectionState=jL.CONNECTING}),this.websocket.on(BL.WILL_RECONNECT,(e,t,n)=>{const s=cI(this,LL.IS_P2P_DISCONNECTED),i=s||"retry"!==e;s&&"retry"===e&&(aO.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=rM.P2P_DISCONNECTED),i&&(aO.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(LL.REPORT_JOIN_GATEWAY,t||rM.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(LL.DISCONNECT_P2P)),n(e)}),this.websocket.on(BL.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{aO.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",nI.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(LL.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof fO){if(e.code===RR.UNEXPECTED_RESPONSE&&e.data.code===PL.ERR_NO_AUTHORIZED)return this.initError=new fO(RR.TOKEN_EXPIRE,"dynamic key expired"),void this.close(QR.TOKEN_EXPIRE);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nI.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(BL.REQUEST_NEW_URLS,(e,t)=>{rI(this,LL.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(BL.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(VL.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(NM.PRE_CONNECT_PC,()=>{this.emit(LL.PRE_CONNECT_PC)})}}let ZM=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),$M=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function eU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function tU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eU(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nU(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(RA("TURN_DOMAIN")):(aO.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function sU(e){try{const t=RA("GATEWAY_DOMAINS").concat(RA("TURN_DOMAIN")).find(t=>Ps(e).call(e,t));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch(t){return aO.debug("serverUrlToIp error, fallback to url",e),e}}function iU(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(RA("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map(e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}});const n=RA("GATEWAY_DOMAINS");let s=n[1]&&Ps(t).call(t,n[1])?1:0;return e.map(e=>{let{domain_prefix:t,port:i,ip:r}=e;if(t)return{address:"".concat(t,".").concat(n[s++%n.length],":").concat(i)};const a=/^[\.\:\d]+$/.test(r),o=a?"".concat(r.replace(/[^\d]/g,"-"),".").concat(n[s++%n.length],":").concat(i):"".concat(r,":").concat(i);return a||aO.debug("Cannot recognized as ip address: ".concat(r,", use as host3")),{ip:r,port:i,address:o}})}(e.addresses,t),s=Array.isArray(e.detail)&&e.detail[18];if(s&&"string"==typeof s){const e=s.split(";");for(let t=0;t<e.length;t++){var i;const s=k_(i=e[t]).call(i);n[t]&&s&&(n[t].ip6=s)}}const r=e.detail&&e.detail.candidate;let a;if(r){const[e,t]=r.split(":");e&&t&&(a={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function rU(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function aU(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(rU(t.width),"x").concat(rU(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function oU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function cU(e,t){let n,s,i;switch(t){case $M.CHOOSE_SERVER:s=4096,i="choose server";break;case $M.CLOUD_PROXY:s=1048576,i="proxy";break;case $M.CLOUD_PROXY_5:s=4194304,i="proxy5";break;case $M.CLOUD_PROXY_FALLBACK:s=4194310,i="proxy fallback";break;default:throw new fO(RR.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(t=>{t.buffer&&t.buffer.flag===s&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map(e=>tU(tU({},e),{},{ticket:t.buffer.cert})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:tU(tU({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})}),!n)throw new fO(RR.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function lU(e,t){return await np.all(e.addresses.map(async e=>({address:nU(e.ip),tcpport:e.port,udpport:e.port,username:t&&RA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():bA.username,password:t&&RA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await WR(t.toString()):bA.password})))}function dU(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),s=t.videoHeight||n.height,i=t.videoWidth||n.width;return s&&i?Math.max(Math.min(s,i)/Math.min(rU(e.height),rU(e.width)),1):(aO.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function uU(e){let{candidateType:t,relayProtocol:n,type:s,address:i,port:r,protocol:a}=e;const o={candidateType:t,relayProtocol:n,protocol:a};if("local-candidate"!==s){const e=i.split(".");e.length>=4&&(e[1]="*",e[2]="*"),o.address=e.join("."),o.port=r}return o}function hU(e){const t=e.split(":"),n=e.split(/[-.]/),s=Ps(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+s+"**:"+t[t.length-1]):i=t.length>2?t[0]+s+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+s+"**"),i}function pU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RA("SVC_MODE");if(RA("ENABLE_SVC"))return function(e){return e in cA}(e)?e:cA.L1T3}const mU={[fM.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[fM.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function fU(e,t,n){t.forEach(t=>{var s;const i=mU[e].find(e=>{var n;let{key:s}=e;return Ps(n=t.extensionName).call(n,s)});if(!i)return;const r=n.find(e=>{let{extensionName:t}=e;return Ps(t).call(t,i.key)});r&&Ps(s=r.extensionName).call(s,"gdpr_forbidden")&&(t.extensionName=r.extensionName)})}function gU(e,t){t.forEach(t=>{var n;const s=mU[e].find(e=>{var n;let{key:s}=e;return Ps(n=t.extensionName).call(n,s)});Ps(n=t.extensionName).call(n,"gdpr_forbidden")&&s&&(t.extensionName=s.extensionName)})}function yU(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Ps(e).call(e,"abs-send-time")}function vU(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Ps(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function _U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function EU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_U(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_U(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function bU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:r,filterAudioFec:a,filterAudioCodec:o,filterVideoCodec:c,unsupportedVideoUplinkCodec:l,unsupportedVideoDownlinkCodec:d}=t,{useXR:u}=n;let h=[],p=[],m=[],f=[],g=!1,y=!1;if(VA(e).mediaDescriptions.forEach(e=>{s&&s!==e.attributes.direction||("video"!==e.media.mediaType||g||(p=e.attributes.payloads,f=e.attributes.extmaps,g=!0),"audio"!==e.media.mediaType||y||(h=e.attributes.payloads,m=e.attributes.extmaps,y=!0))}),!f||0===p.length)throw new Error("Cannot get video capabilities from SDP.");if(!m||0===h.length)throw new Error("Cannot get audio capabilities from SDP.");if(p.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),h.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),i&&(h=h.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}),p=p.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),r){const e=p.filter(e=>{var t;return/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}),t=VU(e,p).map(e=>e.payloadType),n=[...e.map(e=>e.payloadType),...t];p=p.filter(e=>!Ps(n).call(n,e.payloadType))}if(a&&(h=h.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),o&&(null==o?void 0:o.length)>0&&(h=h.filter(e=>{var t;return Ps(o).call(o,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})),c&&(null==c?void 0:c.length)>0){const e=p.filter(e=>{var t;return Ps(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")});p=e.concat(i?[]:VU(e,p))}const v=RA("UNSUPPORTED_VIDEO_CODEC");if(v&&v.length>0){const e=p.filter(e=>e.rtpMap&&Ps(v).call(v,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Ps(n).call(n,e.payloadType)),aO.debug("unsupportedVideoCodec: ".concat(v,", toBeRemoved: ").concat(n))}if(l&&l.length>0&&"sendonly"===s){const e=p.filter(e=>e.rtpMap&&Ps(l).call(l,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Ps(n).call(n,e.payloadType)),aO.debug("unsupportedVideoUplinkCodec: ".concat(l,", toBeRemoved: ").concat(n))}if(d&&d.length>0&&"recvonly"===s){const e=p.filter(e=>e.rtpMap&&Ps(d).call(d,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),n=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Ps(n).call(n,e.payloadType)),aO.debug("unsupportedVideoDownlinkCodec: ".concat(d,", toBeRemoved: ").concat(n))}return{audioCodecs:h,videoCodecs:p,audioExtensions:m,videoExtensions:f}}function xU(e){const t=VA(e);let n,s;for(const i of t.mediaDescriptions){if(!n){const e=i.attributes.iceUfrag,t=i.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!s){const e=i.attributes.fingerprints;e.length>0&&(s={fingerprints:e})}}if(!s&&t.attributes.fingerprints.length>0&&(s={fingerprints:t.attributes.fingerprints}),!s||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:s}}function wU(e,t){const n=[],s=e.attributes.ssrcGroups.filter(e=>"FID"===e.semantic),i=e.attributes.ssrcGroups.find(e=>"SIM"===e.semantic),r=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(e=>{var i;const r=null===(i=s.find(t=>t.ssrcIds[0]===e))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?r:void 0})});else if(s.length>0){const e=s[0].ssrcIds[0],i=s[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===r.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:r[0].ssrcId})}return n}function SU(e,t,n){const{cname:s}=e;let i=[];t&&(i=NU(t)),0===i.length&&(i=e.iceParameters.candidates.map(e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})),aO.debug("Using candidates from gateway."));const r={fingerprints:e.dtlsParameters.fingerprints.map(e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let o;switch(e.dtlsParameters.role){case"server":o="passive";break;case"client":o="active";break;case"auto":o="actpass"}const c=LU(e.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach(e=>{l.push({kind:fM.VIDEO,ssrcMsg:[{ssrcId:e.v,rtx:e.v_rtx}],mslabel:"".concat(e.v,"_").concat(e.a)},{kind:fM.AUDIO,ssrcMsg:[{ssrcId:e.a}],mslabel:"".concat(e.v,"_").concat(e.a)})}),{dtlsParameters:r,iceParameters:a,candidates:i,rtpCapabilities:c,setup:o,cname:s,preSSRCs:l}}function NU(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],aO.debug("Using remote candidate from AP ".concat(hU(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),aO.debug("Using IPV6 remote candidate from AP ".concat(hU(e.ip6),":").concat(e.port)))),t}function TU(e,t,n){const s=[],i=[];return e.forEach(e=>{let{ssrcId:r,rtx:a}=e;const o=NI(8,"track-"),c={ssrcId:r,attributes:EU({label:o,mslabel:n=n||NI(10,""),msid:"".concat(n," ").concat(o)},t&&{cname:t})};if(s.push(c),void 0!==a){const e={ssrcId:a,attributes:EU({label:o,mslabel:n,msid:"".concat(n," ").concat(o)},t&&{cname:t})};s.push(e),i.push({semantic:"FID",ssrcIds:[r,a]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(e=>{let{ssrcId:t}=e;return t})}),{ssrcs:s,ssrcGroups:i}}function CU(e,t){t instanceof FD&&e.attributes.payloads.forEach(e=>{var n;const s=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!s||-1===["opus","pcmu","pcma","g722"].indexOf(s))return;e.fmtp||(e.fmtp={parameters:{}}),"opus"===s&&"number"==typeof RA("OPUS_PTIME")?e.fmtp.parameters.ptime=RA("OPUS_PTIME"):e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&("pcmu"!==s&&"pcma"!==s&&"g722"!==s&&(i.bitrate&&!nR()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1")),t instanceof BD&&"opus"===s&&t._config.DTX&&(e.fmtp.parameters.usedtx="1"))})}function RU(e){const t=e.attributes.unrecognized.findIndex(e=>"x-google-flag"===e.attField&&"conference"===e.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}function IU(e,t){var n;if(!(t instanceof PP&&t._encoderConfig&&-1===t._hints.indexOf(UO.SCREEN_TRACK)))return;const s=t._encoderConfig;yO().supportMinBitrate&&s.bitrateMin&&e.attributes.payloads.forEach(e=>{var t,n;Ps(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),yO().supportMinBitrate&&!Ps(n=t._hints).call(n,UO.LOW_STREAM)&&s.bitrateMax&&e.attributes.payloads.forEach(e=>{var t,n;Ps(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(RA("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function AU(e){if("video"!==e.media.mediaType)return;const t=qC();if(t.name!==WC.SAFARI&&t.os!==GC.IOS)return;const n=e.attributes.extmaps.findIndex(e=>/video-orientation/g.test(e.extensionName));-1!==n&&e.attributes.extmaps.splice(n,1)}function OU(e,t,n){if(!t)return;let s,i;if("video"===e.media.mediaType?(s=n.videoExtensions,i=n.videoCodecs):(s=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=s.find(e=>vU(e.extensionName));if(t){const n=t.extensionName;e.attributes.extmaps.find(e=>vU(e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const s=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)))}(i,e.attributes.payloads);s.forEach(e=>{e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)||e.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex(e=>vU(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}if(!0===t.remb){const t=s.find(e=>yU(e.extensionName));if(t){const n=t.extensionName;e.attributes.extmaps.find(e=>e.extensionName===n)||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const s=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)))}(i,e.attributes.payloads);s.forEach(e=>{e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)||e.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex(e=>yU(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"goog-remb"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}}function kU(e,t,n){if(nR())return;if("video"!==e.media.mediaType)return;if(!(t instanceof PP))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!RA("SIMULCAST"))return;if("vp9"===n&&RA("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const s="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],r=e.attributes.ssrcGroups.find(e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let o=1;o<s;o++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+o,attributes:pI(i.attributes)}),a.ssrcIds.push(i.ssrcId+o),r&&(e.attributes.ssrcs.push({ssrcId:r.ssrcIds[1]+o,attributes:pI(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+o,r.ssrcIds[1]+o]}));e.attributes.ssrcGroups.unshift(a)}async function DU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const s=(await n.createOffer()).sdp,{send:i,recv:r,sendrecv:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=bU(n,e,t,"sendonly"),i=bU(n,e,t,"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(jU(s,i,"videoExtensions",r,a,o),jU(s,i,"videoCodecs",r,a,o),jU(s,i,"audioExtensions",r,a,o),jU(s,i,"audioCodecs",r,a,o),RA("RAISE_H264_BASELINE_PRIORITY")){const e=[],t=[];if(o.videoCodecs.forEach((n,s)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){var r,a;const i=o.videoCodecs[s+1],c=i&&HU(n,i),l=null===(r=n.fmtp)||void 0===r?void 0:r.parameters["profile-level-id"],d=null===(a=n.fmtp)||void 0===a?void 0:a.parameters["packetization-mode"];!l||l!==RA("FIRST_H264_PROFILE_LEVEL_ID")||RA("FIRST_PACKETIZATION_MODE")&&d!==RA("FIRST_PACKETIZATION_MODE")?c?t.push([n,i]):t.push([n]):c?e.push([n,i]):e.push([n])}}),e.length>0&&t.length>0){aO.debug("raising H264 baseline profile priority"),o.videoCodecs.forEach((n,s)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){const i=HU(n,o.videoCodecs[s+1]),r=e.shift()||t.shift()||[];r.length>0&&(i?o.videoCodecs.splice(s,2,...r):o.videoCodecs.splice(s,1,...r))}});const n=a.videoCodecs.filter(e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==RA("FIRST_H264_PROFILE_LEVEL_ID")});if(n.length>0){const e=VU(n,a.videoCodecs).map(e=>e.payloadType),t=[...n.map(e=>e.payloadType),...e];a.videoCodecs=a.videoCodecs.filter(e=>!Ps(t).call(t,e.payloadType))}RA("FILTER_SEND_H264_BASELINE")&&(r.videoCodecs=r.videoCodecs.filter(e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==RA("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:r,recv:a,sendrecv:o}}return{send:r,recv:a,sendrecv:o}}(e,t,s);try{n.close()}catch(e){}return{send:i,recv:r,sendrecv:a}}function PU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(jU(e,t,"videoExtensions",n,s,i),jU(e,t,"videoCodecs",n,s,i),jU(e,t,"audioExtensions",n,s,i),jU(e,t,"audioCodecs",n,s,i),RA("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(s.videoCodecs=s.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:s,sendrecv:i}}function jU(e,t,n,s,i,r){if("videoExtensions"===n||"audioExtensions"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0})?r[n].push(e):s[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)})}if("videoCodecs"===n||"audioCodecs"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(n),!0})?r[n].push(e):s[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)})}}function LU(e){const{send:t,recv:n,sendrecv:s}=e;if(!s){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,r;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...s.audioCodecs],i.videoCodecs=[...t.videoCodecs,...s.videoCodecs],i.audioExtensions=[...t.audioExtensions,...s.audioExtensions],i.videoExtensions=[...t.videoExtensions,...s.videoExtensions]):i=s,n?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...n.audioCodecs,...s.audioCodecs],r.videoCodecs=[...n.videoCodecs,...s.videoCodecs],r.audioExtensions=[...n.audioExtensions,...s.audioExtensions],r.videoExtensions=[...n.videoExtensions,...s.videoExtensions]):r=s,{send:i,recv:r}}function MU(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function UU(e,t,n,s){let i=[];if(e===fM.VIDEO){if(RA("H264_PROFILE_LEVEL_ID")&&"h264"===s&&(i=t.videoCodecs.filter(e=>{var t;return Ps(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,s)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===RA("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||0===i.length){let e=[];const r=[],a=[],o=[];if(n.videoCodecs.forEach(t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Ps(n).call(n,s)?e.push(t):Ps(n).call(n,"vp9")?r.push(t):Ps(n).call(n,"vp8")?a.push(t):Ps(n).call(n,"h264")&&o.push(t)}),0===e.length){let t="";0!==r.length?(e=r,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==o.length&&(e=o,t="h264"),aO.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter(t=>e.some(e=>e.payloadType===t.payloadType)))}if(0===i.length&&(aO.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),RA("USE_PUB_RTX")||RA("USE_SUB_RTX")){const e=VU(i,t.videoCodecs);i=[...i,...e]}}else{i=t.audioCodecs.filter(e=>{var t;return Ps(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,s)});const e=t.audioCodecs.filter(e=>{var t;return Ps(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"red")});0===i.length&&(aO.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(e=>{var t;return Ps(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})),RA("ENABLE_AUDIO_RED")&&0!==e.length&&(i=[...e,...i])}return i}function VU(e,t){const n=e.map(e=>e.payloadType.toString());return t.filter(e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Ps(n).call(n,e.fmtp&&e.fmtp.parameters.apt))}async function FU(e,t,n){const s=t.toString(),i=GU(s,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:s});const r=await e.createAnswer();if(!r.sdp)throw new Error("cannot get answer sdp");let a=r.sdp;a=BU(a,n||{}),null==i||i(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function BU(e,t,n){const s=VA(e),{useXR:i}=t;return s.mediaDescriptions.forEach(e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!Ps(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&MU(e),i&&Ps(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach(e=>{-1===e.rtcpFeedbacks.findIndex(e=>"rrtr"===e.type)&&e.rtcpFeedbacks.push({type:"rrtr"})})))}),FA(s)}function GU(e,t,n,s){if(RA("SDP_LOGGING"))return aO.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(s,"\n"),e),"offer"===t?e=>{GU(e,"answer","local"===n?"remote":"local",s)}:void 0}function WU(e){const t=RA("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(t=>Ps(e).call(e,t))}function HU(e,t){try{var n;return(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function KU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function zU(e,t){return typeof RA(e)===t?RA(e):void 0}function qU(){try{const e=RA("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KU(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e)}catch(e){return aO.debug("handle gateway attributes failed: ",e),{}}}const YU={};function XU(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&aO.debug("install service ".concat(e.name)),YU[e.name]=e}function JU(e){const t=YU[e];if(!t)throw new IR(RR.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function QU(e,t){return JU("DataStream").create(e,t)}function ZU(){return JU("InterceptFrame").create()}function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function eV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$U(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const tV=new Map;class nV extends HR{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(iM.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(iM.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){aO.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var n,s,i;super(),uN(this,"store",void 0),uN(this,"joinInfo",void 0),uN(this,"key",void 0),uN(this,"ntpOffset",0),uN(this,"signal",void 0),uN(this,"role",void 0),uN(this,"isPreallocation",void 0),uN(this,"isPreSub",void 0),uN(this,"inChannelInfo",{joinAt:null,duration:0}),uN(this,"spec",void 0),uN(this,"_state","DISCONNECTED"),uN(this,"_statsCollector",void 0),uN(this,"_disconnectedReason",void 0),uN(this,"isSignalRecover",!1),uN(this,"hasChangeBGPAddress",!1),uN(this,"trafficStatsInterval",void 0),uN(this,"networkQualityInterval",void 0),uN(this,"_joinGatewayStartTime",0),uN(this,"_signalTimeout",!1),uN(this,"_clientRoleOptions",void 0),uN(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(n={spec:eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(s=(i=JU("P2PChannel")).createSubmodule)||void 0===s?void 0:s.call(i,n)):new QM(eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const s=Date.now();let i=tV.get(e.cname);if(i||(i=new Map,tV.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new fO(RR.UID_CONFLICT);throw mO.joinGateway(e.sid,{lts:s,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let r=0;this.joinGatewayStartTime=s;const a=e.proxyServer;try{aO.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(r));const t=e.gatewayAddrs.map(t=>{let{address:n}=t;const[s,i]=n.split(":"),r={host:s,port:i};return e.proxyServer&&(r.proxy=e.proxyServer),r});r=(await this.signal.init(t)).uid,aO.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(r," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var o;throw aO.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),mO.joinGateway(e.sid,{lts:s,succ:!1,ec:(null===(o=t.data)||void 0===o?void 0:o.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!a,signalChannel:"0",preload:e.preload}),i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),aO.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{aO.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(iM.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(iM.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(iM.NETWORK_QUALITY,{uplinkNetworkQuality:oU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:oU(this._statsCollector.trafficStats.B_dnq)}):this.emit(iM.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),r}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==QR.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==jL.CONNECTED||await function(e,t){return t===1/0?e:np.race([e,wI(t)])}(this.signal.request(ML.LEAVE,void 0,!0),3e3)}catch(e){aO.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==QR.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:RA("PUB_EXTEND"),twcc:!!RA("PUBLISH_TWCC"),rtx:!!RA("USE_PUB_RTX")};try{return(await this.signal.request(ML.PUBLISH,s,!0))._message}catch(s){if(n&&s.data&&s.data.code===PL.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw s}}async publishDataChannel(e,t,n){var s;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(s=t.maxRetransmits)&&void 0!==s?s:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(ML.PUBLISH_DATASTREAM,i,!0)}catch(s){if(n&&s.data&&s.data.code===PL.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),s.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw s}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ML.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map(e=>this.signal.request(ML.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){aO.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const s={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!RA("SUBSCRIBE_TWCC"),rtx:!!RA("USE_SUB_RTX")||void 0,extend:RA("SUB_EXTEND"),svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return await this.signal.request(ML.PRE_SUBSCRIBE,s,!0)}catch(s){if(n&&s.data&&s.data.code===PL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,t,!1);throw s}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!RA("SUBSCRIBE_TWCC"),rtx:!!RA("USE_SUB_RTX"),extend:RA("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return(await this.signal.request(ML.SUBSCRIBE,s,!0))._message}catch(s){if(n&&s.data&&s.data.code===PL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw s}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(ML.SUBSCRIBE_DATASTREAM,s,!0)}catch(s){if(n&&s.data&&s.data.code===PL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw s}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!RA("USE_SUB_RTX"),twcc:!!RA("SUBSCRIBE_TWCC"),svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return await this.signal.request(ML.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===PL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,s=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof s&&(s=s.exact||s.ideal||s.max||s.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:s,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(ML.SET_VIDEO_PROFILE,t);aO.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(ML.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map(e=>this.signal.request(ML.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0)))}catch(e){aO.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(ML.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:s}=e;return{gatewayEstablishParams:await this.signal.request(ML.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ML.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ML.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),RA("CLIENT_ROLE_OPTIONS")&&(aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(RA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},RA("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),RA("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},RA("CLIENT_ROLE_OPTIONS")),aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(RA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let n,s=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0;const i=Object.assign({},t);delete i.delay,delete i.level,await this.signal.request(ML.SET_CLIENT_ROLE,eV(eV({role:e,level:s,delay:n},i),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(ML.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ML.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(ML.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(ML.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ML.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),eV({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ML.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=tV.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:bA.username,password:bA.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(eV(eV({},bA),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(ML.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(t=>t.peer_uid===e.peer_uid);t&&t.B_st!==e.B_st&&hI(()=>{this.emit(iM.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t,n;if(!this.joinInfo||!this.key)throw new fO(RR.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let i=RA("REPORT_APP_SCENARIO");if("string"!=typeof i)try{i=JSON.stringify(i)}catch(e){i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(iM.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,Ps(Hj).call(Hj,r)||Hj.push(r);const a=EO(this.store),o=!(null===(t=this.isPreallocation)||void 0===t||!t.call(this)),c=bO(this.store),l=qU(),d=iR(87)||eR()||cR(117),u=(function(){const e=qC();if(e.name!==WC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>18||18===Number(t[0])&&Number(t[1])>=4}()||dR(18,4,!1))&&hR(18,6,!0)&&"h264"===this.spec.codec&&RA("ENABLE_ABSSENDTIME_AS_SENTTS"),h=eV({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:vA,browser:navigator.userAgent,process_id:RA("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:RA("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:eV(eV({enableEncodedTransform:(!!RA("ENABLE_AUDIO_METADATA")||!!RA("ENABLE_AUDIO_PTS"))&&d||!!RA("ENABLE_AUDIO_TOPN")&&aR(WC.CHROME,87,116)||void 0,enableAudioMetadata:!!RA("ENABLE_AUDIO_METADATA")&&d,enableAudioPts:!!RA("ENABLE_AUDIO_PTS")&&d,topnSmoothLevel:RA("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:RA("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:RA("TOPN_SWITCH_HOLD_MS"),topnAudioGain:RA("TOPN_AUDIO_GAIN"),enablePublishedUserList:RA("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:RA("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:zU("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:zU("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:zU("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===RA("USE_PUB_RTX")||!0===RA("USE_SUB_RTX")||void 0,disableFEC:RA("DISABLE_FEC"),enableNTPReport:!!RA("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:c,enableFulllinkAvSync:!!RA("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:zU("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!RA("FORCE_ENABLE_AUT_CC")||!_O()&&(!!RA("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!RA("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:zU("USE_XR","boolean"),enableLossbasedBwe:zU("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!RA("FORCE_ENABLE_AUT_CC")||!_O()&&(!!RA("ENABLE_AUT_CC")||void 0),enableCCFallback:zU("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:a?zU("PRE_SUB_NUM","number"):void 0,enablePubTWCC:zU("PUBLISH_TWCC","boolean"),enableSubTWCC:zU("SUBSCRIBE_TWCC","boolean"),enablePubRTX:zU("USE_PUB_RTX","boolean"),enableSubRTX:zU("USE_SUB_RTX","boolean"),enableSubSVC:RA("ENABLE_SVC")?RA("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0,enableSvcExtended:RA("ENABLE_SVC")&&Array.isArray(RA("SVC_EXTENDED"))&&0!==RA("SVC_EXTENDED").length?RA("SVC_EXTENDED"):void 0},l),{},{audioDuplicate:zU("ENABLE_AUDIO_RED","boolean")?null!==(n=zU("AUDIO_DUPLICATE_NUM","number"))&&void 0!==n?n:2:void 0,senttsUsesAbsSendTime:!!u||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,RA("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),void 0!==this.joinInfo.defaultVideoStream&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new fO(RR.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(LL.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(LL.WS_RECONNECTING,e=>{this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||nI.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",mO.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(LL.WS_CLOSED,e=>{let t;switch(e){case QR.LEAVE:t=nI.LEAVE;break;case QR.UID_BANNED:case QR.IP_BANNED:case QR.CHANNEL_BANNED:case QR.SERVER_ERROR:t=nI.SERVER_ERROR;break;case QR.FALLBACK:t=nI.FALLBACK;break;case QR.LICENSE_MISSING:case QR.LICENSE_EXPIRED:case QR.LICENSE_MINUTES_EXCEEDED:case QR.LICENSE_PERIOD_INVALID:case QR.LICENSE_MULTIPLE_SDK_SERVICE:case QR.LICENSE_ILLEGAL:case QR.TOKEN_EXPIRE:t=e;break;default:t=nI.NETWORK_ERROR}aO.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+nI.NETWORK_ERROR)),this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===QR.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==QR.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(LL.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){const e=RA("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(aO.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void aO.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));CA("EVENT_REPORT_DOMAIN",e[1]),CA("EVENT_REPORT_BACKUP_DOMAIN",e[1]),CA("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(VL.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(LL.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new fO(RR.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,rI(this,iM.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(LL.REQUEST_JOIN_INFO,async(e,t,n)=>{var s,i,r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const a=pI(null===(s=this.joinInfo)||void 0===s?void 0:s.turnServer);if(RA("NEW_TURN_MODE")&&a&&"disabled"===(null===(i=this.joinInfo)||void 0===i?void 0:i.cloudProxyServer)){var o;let e=a.servers.map(e=>"turnServerURL"in e&&RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:sU(e.turnServerURL)}):e),t=null===(o=a.serversFromGateway)||void 0===o?void 0:o.map(e=>RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:sU(e.turnServerURL)}):e);const n=this.signal.currentURLIndex;e.length>0&&(e=[e[n%e.length]],a.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],a.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(n))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await rI(this,iM.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:a,cloudProxyServer:null===(r=this.joinInfo)||void 0===r?void 0:r.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(e){t(e)}}),this.signal.on(LL.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(LL.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let n,s="";var i;e instanceof fO?(n=(null===(i=e.data)||void 0===i?void 0:i.desc)||e.code,s=e.message):n=e,mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:s,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(LL.IS_P2P_DISCONNECTED,e=>{e(cI(this,iM.IS_P2P_DISCONNECTED))}),this.signal.on(LL.DISCONNECT_P2P,()=>{this.emit(iM.DISCONNECT_P2P)}),this.signal.on(LL.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(LL.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(LL.JOIN_RESPONSE,e=>{const t=this.getCurrentGatewayAddress();this.emit(iM.JOIN_RESPONSE,e,t)}),this.signal.on(LL.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,t;this.updateTurnConfigFromSignal();const s=this.getCurrentGatewayAddress(),i=pI(null===(e=this.joinInfo)||void 0===e?void 0:e.turnServer);if(RA("NEW_TURN_MODE")&&i&&"disabled"===(null===(t=this.joinInfo)||void 0===t?void 0:t.cloudProxyServer)){var n;let e=i.servers.map(e=>"turnServerURL"in e&&RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:sU(e.turnServerURL)}):e),t=null===(n=i.serversFromGateway)||void 0===n?void 0:n.map(e=>RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:sU(e.turnServerURL)}):e);const s=this.signal.currentURLIndex;e.length>0&&(e=[e[s%e.length]],i.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],i.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(s,",in pre pc"))}const r=RA("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(s&&r){const e=NU(s);this.emit(iM.PRE_CONNECT_PC,{candidates:e,fingerprint:r,turnServer:i})}}}),this.signal.on(LL.RECOVER_NOTIFICATION,e=>{this.joinInfo&&"string"==typeof RA("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(RA("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(ML.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(ML.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw aO.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(ML.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(ML.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw aO.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map(e=>({stream_id:e.stream_id,stream_type:e.stream_type}))};try{await this.signal.request(ML.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find(e=>e.stream_type===sM.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ML.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find(e=>e.stream_type===sM.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ML.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===fM.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ML.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===fM.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ML.CONTROL,n,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ML.RESTART_ICE,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||nI.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!RA("GATEWAY_WSS_ADDRESS"))return RA("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(aO.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ML.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let sV=0,iV=0;function rV(e,t,n,s){return new np((i,r)=>{t.timeout=t.timeout||RA("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),sV+=bI(t.data)):n&&(t.data.size?sV+=t.data.size:t.data instanceof FormData?sV+=xI(t.data):sV+=bI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,LC.request(t).then(e=>{"string"==typeof e.data?iV+=bI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?iV+=e.data.byteLength:iV+=bI(JSON.stringify(e.data)),s&&i({data:e.data,headers:e.headers}),i(e.data)}).catch(e=>{LC.isCancel(e)?r(new fO(RR.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?r(new fO(RR.NETWORK_TIMEOUT,e.message)):e.response?r(new fO(RR.NETWORK_RESPONSE_ERROR,e.response.status)):r(new fO(RR.NETWORK_ERROR,e.message))})})}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var s,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var s=e[n];if(s&&s.Math==Math)return s}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in n))break e;n=n[a]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(a("Symbol",function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",s=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+s++,i)}}),a("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),s=0;s<t.length;s++){var a=r[t[s]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&i(a.prototype,e,{configurable:!0,writable:!0,value:function(){return o(n(this))}})}return e}),"function"==typeof Object.setPrototypeOf)s=Object.setPrototypeOf;else{var l;e:{var d={};try{d.__proto__={a:!0},l=d.a;break e}catch(e){}l=!1}s=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var u=s;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function m(e,t){return e.h=3,{value:t}}function f(e){this.g=new h,this.G=e}function g(e,t,n,s){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var r=i.value}catch(t){return e.g.j=null,e.g.s(t),y(e)}return e.g.j=null,s.call(e.g,r),y(e)}function y(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function v(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),y(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function _(e,t){return t=new v(new f(t)),u&&e.prototype&&u(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return p(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),y(this))},f.prototype.s=function(e){return p(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),y(this))},a("Array.prototype.entries",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,s=!1,i={next:function(){if(!s&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return s=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return[e,t]})}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var E=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},b=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},x=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},w=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},S="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,N=S.FormData,T=S.XMLHttpRequest&&S.XMLHttpRequest.prototype.send,C=S.Request&&S.fetch,R=S.navigator&&S.navigator.sendBeacon,I=S.Element&&S.Element.prototype,A=S.Symbol&&Symbol.toStringTag;A&&(Blob.prototype[A]||(Blob.prototype[A]="Blob"),"File"in S&&!File.prototype[A]&&(File.prototype[A]="File"));try{new File([],"")}catch(e){S.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),A&&Object.defineProperty(e,A,{value:"File"}),e}}var O=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},k=function(e){this.i=[];var t=this;e&&E(e.elements,function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];E(n,function(n){t.append(e.name,n)})}else"select-multiple"===e.type||"select-one"===e.type?E(e.options,function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)}):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?b(e.value):e.value,t.append(e.name,n))})};if((e=k.prototype).append=function(e,t,n){w(arguments,2),this.i.push(x(e,t,n))},e.delete=function(e){w(arguments,1);var t=[];e=String(e),E(this.i,function(n){n[0]!==e&&t.push(n)}),this.i=t},e.entries=function e(){var t,n=this;return _(e,function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=m(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2})},e.forEach=function(e,t){w(arguments,1);for(var n=c(this),s=n.next();!s.done;s=n.next()){var i=c(s.value);s=i.next().value,i=i.next().value,e.call(t,i,s,this)}},e.get=function(e){w(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){w(arguments,1);var t=[];return e=String(e),E(this.i,function(n){n[0]===e&&t.push(n[1])}),t},e.has=function(e){w(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,s,i=this;return _(e,function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(s=n.value,m(e,c(s).next().value));n=t.next(),e.h=2})},e.set=function(e,t,n){w(arguments,2),e=String(e);var s=[],i=x(e,t,n),r=!0;E(this.i,function(t){t[0]===e?r&&(r=!s.push(i)):s.push(t)}),r&&s.push(i),this.i=s},e.values=function e(){var t,n,s,i,r=this;return _(e,function(e){if(1==e.h&&(t=c(r),n=t.next()),3!=e.h)return n.done?void(e.h=0):(s=n.value,(i=c(s)).next(),m(e,i.next().value));n=t.next(),e.h=2})},k.prototype._asNative=function(){for(var e=new N,t=c(this),n=t.next();!n.done;n=t.next()){var s=c(n.value);n=s.next().value,s=s.next().value,e.append(n,s)}return e},k.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(e,s){return"string"==typeof e?t.push(n+O(b(s))+'"\r\n\r\n'+b(e)+"\r\n"):t.push(n+O(b(s))+'"; filename="'+O(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")}),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},k.prototype[Symbol.iterator]=function(){return this.entries()},k.prototype.toString=function(){return"[object FormData]"},I&&!I.matches&&(I.matches=I.matchesSelector||I.mozMatchesSelector||I.msMatchesSelector||I.oMatchesSelector||I.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),A&&(k.prototype[A]="FormData"),T){var D=S.XMLHttpRequest.prototype.setRequestHeader;S.XMLHttpRequest.prototype.setRequestHeader=function(e,t){D.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},S.XMLHttpRequest.prototype.send=function(e){e instanceof k?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),T.call(this,e)):T.call(this,e)}}C&&(S.fetch=function(e,t){return t&&t.body&&t.body instanceof k&&(t.body=t.body._blob()),C.call(this,e,t)}),R&&(S.navigator.sendBeacon=function(e,t){return t instanceof k&&(t=t._asNative()),R.call(this,e,t)}),S.FormData=k}}();const aV=()=>{const e=RA("AREAS");return 0===e.length&&e.push(oM.GLOBAL),ii(e).call(e,(e,t,n)=>{const s=oV(t);return s?0===n?s:"".concat(e,",").concat(s):e},"")},oV=e=>e===oM.OVERSEA?"".concat(lM.ASIA,",").concat(lM.EUROPE,",").concat(lM.AFRICA,",").concat(lM.NORTH_AMERICA,",").concat(lM.SOUTH_AMERICA,",").concat(lM.OCEANIA):lM[e],cV=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(e=>{const n=dM[e],s=Object.keys(n);s&&s.map(e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))})}),t},lV={GLOBAL:{ASIA:[oM.CHINA,oM.JAPAN,oM.INDIA,oM.KOREA,oM.HKMC],EUROPE:[],NORTH_AMERICA:[oM.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dV=Object.keys(lV[oM.GLOBAL]),uV=[oM.CHINA,oM.NORTH_AMERICA,oM.EUROPE,oM.ASIA,oM.JAPAN,oM.INDIA,oM.OCEANIA,oM.SOUTH_AMERICA,oM.AFRICA,oM.KOREA,oM.HKMC,oM.US],hV=function(e,t){let n=[];if(Ps(e).call(e,oM.GLOBAL)){const r=[oM.GLOBAL,oM.OVERSEA],a=Object.keys(dM);if(t===oM.GLOBAL)throw new fO(RR.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===oM.CHINA)n=[oM.OVERSEA];else if(i=t,Ps(dV).call(dV,i)){const e=(s=t,lV[oM.GLOBAL][s]||[]),i=[...r,t,...e];n=a.filter(e=>!Ps(i).call(i,e))}else if(function(e){let t=!1;return dV.forEach(n=>{var s;Ps(s=lV[oM.GLOBAL][n]).call(s,e)&&(t=!0)}),t}(t)){const e=function(e){let t;return dV.forEach(n=>{var s;Ps(s=lV[oM.GLOBAL][n]).call(s,e)&&(t=n)}),t}(t),s=[...r,e,t];n=a.filter(e=>!Ps(s).call(s,e))}else n=e;n=function(e){const t=[];return uV.forEach(n=>{Ps(e).call(e,n)&&t.push(n)}),t.concat(e.filter(e=>!Ps(uV).call(uV,e)))}(n)}else n=e;var s,i;return n};function pV(e){var t,n;if(!e&&Ps(t=RA("AREAS")).call(t,oM.EXTENSIONS))return aO.debug("update area from ap : reset"),void mV(Bj,!0);if(!Ps(n=RA("AREAS")).call(n,oM.GLOBAL)||!e)return;let s=dM.EXTENSIONS;s&&(s={CODE:oV(oM.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},aO.debug("update area from ap success: ".concat(e,",config is "),s),CA("AREAS",[oM.EXTENSIONS],!0),Object.keys(s).map(e=>{CA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?s[e][0]:s[e])}))}function mV(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=mO.reportApiInvoke(null,{name:qR.SET_AREA,options:e,tag:YR.TRACER});try{let s=[];if("string"==typeof e&&(s=[e]),Array.isArray(e)&&(e.forEach(e=>{if(!Ps(cM).call(cM,e))throw new fO(RR.INVALID_PARAMS,"invalid area code")}),s=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new fO(RR.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),s=n?hV(i,n):i}if(!t){if(AA.AREAS){const e=new fO(RR.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void aO.warning("setArea is prohibited because of config-distribute")}if(Ps(s).call(s,oM.GLOBAL)&&RA("AREAS")===oM.EXTENSIONS){const e=new fO(RR.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void aO.warning("setArea is prohibited because of ap extensions")}}CA("AREAS",s,t);const i=cV(s);Object.keys(i).map(e=>{CA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])}),aO.debug("set area success:",s.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function fV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function gV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fV(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let yV=1;function vV(e,t,n,s,i){yV+=1;const r={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:yV,requestId:yV,version:vA,cname:n.cname},a={service_name:t,json_body:JSON.stringify(r)};let o,c,l=e[0];return GI(async()=>{o=Date.now();const e=await rV(l,{data:a,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-o,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw aO.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw aO.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw aO.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(RA("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))),workerToken:e.workerToken,vid:e.vid}}(n,t);return RA("LIVE_STREAMING_ADDRESS")&&(i.addressList=RA("LIVE_STREAMING_ADDRESS")instanceof Array?RA("LIVE_STREAMING_ADDRESS"):[RA("LIVE_STREAMING_ADDRESS")]),gV(gV({},i),{},{responseTime:c})},(s,i)=>(mO.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(s.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1),(s,i)=>(mO.apworkerEvent(n.sid,{success:!1,sc:s.data&&s.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(s.code!==RR.OPERATION_ABORTED&&s.code!==RR.UNEXPECTED_RESPONSE||s.data&&s.data.retry)&&(l=e[(i+1)%e.length],!0)),i)}let _V=1;function EV(e,t,n,s){let{url:i,areaCode:r}=e;const{clientId:a,sid:o}=t,c=Date.now();let l;const d=t.role,[u,h]=NV(t,r,[$M.CHOOSE_SERVER]);let p=lI.networkState;return GI(async()=>{p&&lI.networkState===sI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,SI(s&&s.maxRetryTimeout||FI.maxRetryTimeout)]),p=lI.networkState;const{data:e,headers:r}=await rV(i,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===r.http3?1:-1,mO.reportResourceTiming(i,o),xV(e,i,t,c,[$M.CHOOSE_SERVER],l);const a=cU(e,$M.CHOOSE_SERVER);return wV(a),iU(a,i)},e=>(e&&mO.joinChooseServer(o,{role:d,lts:c,succ:!0,csAddr:i,opid:h,serverList:e.gatewayAddrs.map(e=>e.address),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1),e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinChooseServer(o,{role:d,lts:c,succ:!1,csAddr:i,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),aO.warning("[".concat(a||"sid-".concat(o.slice(0,6)),"] Choose server network error, retry"),e),!0)),s)}function bV(e,t,n,s){let i,{url:r,areaCode:a,serviceIds:o}=e;const c=Date.now(),l=t.role,[d,u]=NV(t,a,o);let h;return GI(async()=>{h&&lI.networkState===sI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,SI(s&&s.maxRetryTimeout||FI.maxRetryTimeout)]),h=lI.networkState;const{data:e,headers:a}=await rV(r,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===a.http3?1:-1,mO.reportResourceTiming(r,t.sid),xV(e,r,t,c,o,i);const l=cU(e,$M.CHOOSE_SERVER),u=cU(e,"proxy5"===t.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK),p=performance.getEntriesByName(r),m=p[p.length-1];let f;return m&&(f={name:m.name,protocol:"nextHopProtocol"in m?m.nextHopProtocol:"",dnscost:"domainLookupEnd"in m&&"domainLookupStart"in m&&"number"==typeof m.domainLookupEnd&&"number"==typeof m.domainLookupStart?m.domainLookupEnd-m.domainLookupStart:-1,tcpTlsCost:"connectEnd"in m&&"connectStart"in m&&"number"==typeof m.connectEnd&&"number"==typeof m.connectStart?m.connectEnd-m.connectStart:-1,reqCost:"requestStart"in m&&"number"==typeof m.requestStart&&"responseEnd"in m&&"number"==typeof m.responseEnd?m.responseEnd-m.requestStart:-1,handleCost:"leave_ts"in e&&"enter_ts"in e&&"number"==typeof e.leave_ts&&"number"==typeof e.enter_ts?e.leave_ts-e.enter_ts:-1}),wV(l),{gatewayInfo:iU(l,r),proxyInfo:u,url:r,resourceTimingInfo:f}},e=>(e.gatewayInfo&&mO.joinChooseServer(t.sid,{role:l,lts:c,succ:!0,csAddr:r,serverList:e.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,opid:u,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:o.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38],resourceTimingInfo:e.resourceTimingInfo?JSON.stringify(e.resourceTimingInfo):void 0}),e.proxyInfo&&mO.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:r,turnServerAddrList:e.proxyInfo.addresses.map(e=>e.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:o.toString()}),!1),e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:o.toString(),extend:JSON.stringify({networkState:h})}),aO.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0)),s)}const xV=(e,t,n,s,i,r)=>{const{sid:a,clientId:o,cloudProxyServer:c}=n,l=[],d=o=>{4096===o.flag?mO.joinChooseServer(a,{role:n.role,lts:s,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:o.error.message,csIp:o.error.data&&o.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:r,corssRegionTagReq:n.apRequestDetail}):1048576!==o.flag&&4194304!==o.flag&&4194310!==o.flag||mO.joinWebProxyAP(a,{lts:s,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:o.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach(t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};l.push(n),d(n)}if(0!==n){const s=jM(n),i={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,s.desc,{desc:s.desc,retry:s.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?aO.warning(i.error.toString()):l.push(i),d(i)}}),l.length)throw aO.warning("[".concat(o||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)).join(" | "))),new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!l.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(l.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})},wV=e=>{var t,n,s,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(RA("AP_AREA")&&(null!==(s=e.detail)&&void 0!==s&&s[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?pV(e.detail[23].toLowerCase()):pV()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let s=0;s<n.length;s++){var r;const t=k_(r=n[s]).call(r);e.addresses[s]&&n&&(e.addresses[s].fingerprint=t)}}if(RA("GATEWAY_ADDRESS")&&RA("GATEWAY_ADDRESS").length>0){aO.debug("assign gateway address to",RA("GATEWAY_ADDRESS"));const t=RA("GATEWAY_ADDRESS").map(t=>{var n,s;const i=null!==(n=null===(s=e.addresses.find(e=>e.ip===t.ip&&e.port===t.port))||void 0===s?void 0:s.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}});e.addresses=t}},SV=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=jM(t.buffer.code);throw new fO(RR.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw aO.debug("update ticket request received ap response without response body:",t),new fO(RR.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},NV=(e,t,n)=>{const s=Math.floor(Math.random()*10**12),i="host"===e.role?"1":"audience"===e.role?"2":void 0,r={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:gV(gV(gV({6:e.stringUid,11:t,12:RA("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};r.request_bodies.forEach(t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(r)),[a,s]},TV=(e,t)=>{const n=Math.floor(Math.random()*10**12),s={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(e=>({ip:e.ip,port:e.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(s)),[i,n]};let CV=0;function RV(e){return np.all(e.map(e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}const IV=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:s,allFailedhandler:i,promisesCollector:r}=e,a=0;const o=t;let c,l=0;const d=async()=>{const e=(()=>{const e=a*o,t=e+o;return n.slice(e,t).map(s)})();r&&r.push(...e);try{c=await RV(e)}catch(e){if(l+=o,a++,!(l>=n.length))return void await d();i(e)}e.forEach(e=>e.cancel())};return await d(),c},AV=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:s}=e;const i=t.length;let r=0;const a=async()=>{const e=n(t.shift());try{return await e}catch(e){if(r++,r>=i||null!=s&&s(e))throw e;return a()}};return a()};async function OV(){if("undefined"==typeof VideoDecoder)return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],r=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],a=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128],o=await new np((o,c)=>{let l;!async function(){e&&"closed"!==e.state||await async function(){e=new VideoDecoder({output:e=>{e.close(),clearTimeout(l),o(!0)},error:e=>{clearTimeout(l),o(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const c=[t,n,s,i,r,a];for(let t=0;t<c.length;t++){const n=new EncodedVideoChunk({type:0==t?"key":"delta",timestamp:33333*t,duration:33333,data:new Uint8Array(c[t])});try{await e.decode(n)}catch(e){return void o(!1)}}}(),l=setTimeout(()=>{o(!1)},5e3)});return o}async function kV(e,t,n,s){const i=async function(e,t,n,s){let i=null;const r=[],a=async()=>{const i=RA("WEBCS_DOMAIN").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),a=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),o=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:s=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),s.url),EV(s,e,t,n)),allFailedhandler:e=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:r});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},a),o},o=async()=>{if(await SI(1e3),null!==i)return i;const a=RA("WEBCS_DOMAIN_BACKUP_LIST").map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),o=s.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map(e=>e.url)}),c=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:s=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),s.url),EV(s,e,t,n)),allFailedhandler:e=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:r});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},o),c};try{return i=await RV([a(),o()]),r.length&&r.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),i}catch(e){throw e[0]}}(e,t,n,s);return{gatewayInfo:await i}}async function DV(e,t,n,s,i){const r=e.cloudProxyServer;if("disabled"===r){if(!s)return;if(e.useLocalAccessPoint)return await kV(e,t,n,i);if(RA("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:s,proxyInfo:r}=await UV(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:s};const o=r.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bA.tcpport,udpport:e.udpport||bA.udpport,username:e.username||bA.username,password:e.password||bA.password,forceturn:!1,security:!0}));if(i.useP2P){var a;const t=null!==(a=e.uid)&&void 0!==a?a:s.uid,n="glb:".concat(t.toString()),i=await WR(n),c=r.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bA.tcpport,udpport:e.udpport||bA.udpport,username:n,password:i,forceturn:!1,security:!0}));o.push(...c)}return e.turnServer={mode:"manual",servers:o},{gatewayInfo:s}}return await kV(e,t,n,i)}const{proxyInfo:o,gatewayInfo:c}=await UV(e,t,n,i),l={gatewayInfo:c},d=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===r?void 0:e.tcpport?e.tcpport:bA.tcpport,udpport:"proxy4"===r?void 0:e.udpport?e.udpport:bA.udpport,username:e.username||bA.username,password:e.password||bA.password,forceturn:"proxy4"!==r,security:"proxy5"===r}));if(i.useP2P){var u;const t=null!==(u=e.uid)&&void 0!==u?u:c.uid,n="glb:".concat(t.toString()),s=await WR(n),i=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===r?void 0:e.tcpport||bA.tcpport,udpport:"proxy4"===r?void 0:e.udpport||bA.udpport,username:n,password:s,forceturn:"proxy4"!==r,security:"proxy5"===r}));d.push(...i)}return e.turnServer={mode:"manual",servers:d},aO.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(r)),l}async function PV(e,t,n,s,i){const r=RA("ACCOUNT_REGISTER").slice(0,RA("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?r.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):r.map(e=>"https://".concat(e,"/api/v1"));const o=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const r=await async function(e,t,n,s,i){const r=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let o=e[0];const c=await GI(()=>rV(o+"".concat(-1===o.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:s,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(n,s)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw aO.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),mO.reqUserAccount(a.sid,{lts:r,success:!1,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:RR.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new fO(RR.INVALID_UINT_UID_FROM_STRING_UID);return mO.reqUserAccount(a.sid,{lts:r,success:!0,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:null,extend:a}),!1}const i=jM(n.code);return i.retry&&(o=e[(s+1)%e.length]),mO.reqUserAccount(a.sid,{lts:r,success:!1,serverAddr:o,stringUid:a.string_uid,uid:n.uid,errorCode:i.desc,extend:a}),i.retry},(t,n)=>t.code!==RR.OPERATION_ABORTED&&(mO.reqUserAccount(a.sid,{lts:r,success:!1,serverAddr:o,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),o=e[(n+1)%e.length],!0),i);if(0!==c.code){const e=jM(c.code);throw new fO(RR.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,n,s);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},o),r.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},o),e}}async function jV(e,t,n){const s=RA("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?s.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):s.map(e=>"https://".concat(e,"/api/v1"));try{const s=await AV({referenceList:i,asyncMapHandler:s=>async function(e,t,n,s){const i=Date.now(),r={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await rV(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:r,cancelToken:s,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=jM(t.code);throw new fO(RR.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new fO(RR.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:r,uid:t.uid,elapse:Date.now()-i}}catch(e){throw e}}(s,e,t,n),closeFn:e=>e.code===RR.OPERATION_ABORTED||e.code===RR.UNEXPECTED_RESPONSE&&!e.data.retry});return s}catch(e){throw e}}async function LV(e,t,n){const s=RA("CDS_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")),i=s.map(s=>function(e,t,n,s){const i=qC(),r={flag:64,cipher_method:0,features:gV(gV(gV(gV(gV({install_id:yA(),device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:vA,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:ZM.WEB_RTC,browser_name:i.name,browser_version:i.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),i.os&&{os_name:i.os}),i.osVersion&&{os_version:i.osVersion}),{},{detail:""})};return GI(()=>rV(e,{data:r,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==RR.OPERATION_ABORTED,s)}(s,e,t,n));let r=null,a=null,o={};try{r=await RV(i)}catch(e){if(e.code===RR.OPERATION_ABORTED)throw e;a=e}if(i.forEach(e=>e.cancel()),mO.reportApiInvoke(e.sid,{name:qR.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:r}}).onSuccess(),r&&r.test_tags)try{o=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),s={};return n.forEach(e=>{var n;const i=k_(n=e.slice(4)).call(n),r=JSON.parse(t[e]),a=r[1];s[i]={tag:r[0]||"",value:a}}),s}(r)}catch(e){}return o}async function MV(e,t){const n=RA("WEBCS_DOMAIN").concat(RA("WEBCS_DOMAIN_BACKUP_LIST")).map(e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK]}));try{const s=await AV({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let s,{url:i,areaCode:r,serviceIds:a}=e;const o=Date.now(),[c,l]=NV(t,r,a);let d=lI.networkState;try{d&&lI.networkState===sI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,SI(FI.maxRetryTimeout)]),d=lI.networkState;const{data:e,headers:t}=await rV(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s="1"===t.http3?1:-1;const r=e=>{const t=[];if(e.response_body.forEach(n=>{const s=n.buffer.code;if(23===n.uri&&0===s&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const s={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(s)}if(0!==s){const i=jM(s),r={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?aO.warning(r.error.toString()):t.push(r)}}),t.length)throw new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,t.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!t.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(t.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})};r(e);const a=cU(e,$M.CHOOSE_SERVER),u=cU(e,$M.CLOUD_PROXY_FALLBACK);return wV(a),{gatewayInfo:iU(a,i),proxyInfo:u,opid:l,requestTime:o,url:i,isHttp3:s,elapse:Date.now()-o}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===RR.OPERATION_ABORTED||e.code===RR.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return s}catch(e){throw e}}async function UV(e,t,n,s){const i=RA("PROXY_SERVER_TYPE3"),r=(e,t,n)=>{let s=n||i;return Array.isArray(s)&&(s=t%2==0&&i[1]||i[0]),"https://".concat(s,"/ap/?url=").concat(e)};let a=null;const o=[],c=async()=>{const i=RA("WEBCS_DOMAIN").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map((t,n)=>{let s;return s="disabled"===e.cloudProxyServer&&e.proxyServer?r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:s,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),a=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),c=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:s=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),s.url),bV(s,e,t,n)),allFailedhandler:e=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c},l=async()=>{if(await SI(1e3),null!==a)return a;const i=RA("WEBCS_DOMAIN_BACKUP_LIST").map((t,n)=>{let s;return s="disabled"===e.cloudProxyServer&&e.proxyServer?r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):r("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:s,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),c=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),l=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:s=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),s.url),bV(s,e,t,n)),allFailedhandler:e=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:o});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let d,u,h;try{({gatewayInfo:d,proxyInfo:u,url:h}=await RV([c(),l()]))}catch(e){throw e[0]}if(o.length&&o.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),!d||!u)throw new fO(RR.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Ps(i).call(i,t)&&(e.proxyServer=t,aO.setProxyServer(t),mO.setProxyServer(t))}return a={gatewayInfo:d,proxyInfo:await lU(u,d.uid)},a}async function VV(e,t,n){const s=RA("UAP_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")),i=s.map(s=>function(e,t,n,s){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:vA,cname:t.cname,uid:t.uid.toString(),requestId:_V,seq:_V};_V+=1;const r={service_name:"tele_channel",json_body:JSON.stringify(i)};return GI(async()=>{const t=await rV(e,{data:r,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw aO.error(e.toString()),e}const s=JSON.parse(t.json_body);if(200!==s.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(s.code,", reason: ").concat(s.reason));throw aO.error(e.toString()),e}if(!s.servers||0===s.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw aO.error(e.toString()),e}return{vid:s.vid,workerToken:s.workerToken,addressList:(RA("CHANNEL_MEDIA_RELAY_SERVERS")||s.servers).map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(RA("WORKER_DOMAIN"),":").concat(e.wss))}},void 0,e=>!!(e.code!==RR.OPERATION_ABORTED&&e.code!==RR.UNEXPECTED_RESPONSE||e.data&&e.data.retry),s)}(s,e,t,n));try{const e=await RV(i);return i.forEach(e=>e.cancel()),e}catch(e){throw e[0]}}async function FV(e,t,n){let s=null;const i=[],r=async r=>{const a=RA(r?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"));return r&&(await SI(1e3),null!==s)?s:await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:s=>(aO.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(r?"backup":""," choose_server:"),s),function(e,t,n,s){const[i]=TV(t,[$M.CHOOSE_SERVER]);let r=lI.networkState;return GI(async()=>{r&&lI.networkState===sI.OFFLINE&&lI.onlineWaiter&&await np.race([lI.onlineWaiter,SI(s&&s.maxRetryTimeout||FI.maxRetryTimeout)]),r=lI.networkState;const t=await rV(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return SV(t,e)},()=>!1,e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.UPDATE_TICKET_FAILED?e.data.retry:(aO.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0)),s)}(s,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return s=await RV([r(!1),r(!0)]),i.length&&i.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),s}catch(e){throw e[0]}}function BV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function GV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BV(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class WV extends HR{get isSuccess(){return!!this.configs}constructor(e,t){super(),uN(this,"configs",void 0),uN(this,"store",void 0),uN(this,"joinInfo",void 0),uN(this,"cancelToken",void 0),uN(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),uN(this,"interval",void 0),uN(this,"mutex",void 0),uN(this,"mutableParamsRead",!1),uN(this,"configCache",{}),uN(this,"limit_bitrate",void 0),this.mutex=new UI("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),RA("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},RA("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,mO.reportApiInvoke(null,{options:void 0,name:qR.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:YR.TRACER}).onSuccess(JSON.stringify(AA))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void aO.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await LV(this.joinInfo,this.cancelToken,this.retryConfig),aO.debug("[config-distribute] get config distribute",JSON.stringify(e));const t=function(e){var t;const n=Xp(t=Object.keys(e).filter(e=>/^webrtc_ng_global_parameter/.test(e))).call(t);for(let r=0;r<n.length;r++)for(let t=n.length-1;t>r;t--){const s=n[t],i=e[s].value;if("number"==typeof i.__priority){const r=i.__priority,a=n[t-1],o=e[a].value;if("number"==typeof o.__priority){if(!(r>o.__priority))continue;{const e=s;n[t]=n[t-1],n[t-1]=e}}else{const e=s;n[t]=n[t-1],n[t-1]=e}}}const s=Date.now();let i={};return n.forEach(t=>{const n=e[t].value.__expires;n&&n<=s||(i[t]=e[t])}),i}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(e){const t=new fO(RR.NETWORK_RESPONSE_ERROR,e);aO.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){hM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(uM.UPDATE_BITRATE_LIMIT,e):this.emit(uM.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&GV({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const t={},n=Object.keys(e),s=[];n.forEach(n=>{const i=e[n].value;t[n]=i;const r=i.__id;if(r&&this.configCache[n]&&this.configCache[n].__id===r)return;const a=i.__type,o=e[n].value,c=e[n].tag;let l=0;a?a===IA.REALTIME&&(l=1):Object.keys(o).some(e=>Object.prototype.hasOwnProperty.call(NA,e)||!zj()&&Object.prototype.hasOwnProperty.call(xA,e)?(l=1,!0):void 0),s.push({tag:c,isApplied:l,feature:n,params:JSON.stringify(i)})}),s.forEach(e=>{let{tag:t,feature:n,params:s,isApplied:i}=e;this.store.sessionId&&mO.abTest(this.store.sessionId,{intSucc:1,isApplied:i,tag:t,feature:n,params:s,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(e){aO.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){const t=function(e){const t={};return Object.keys(e).forEach(n=>{const s=e[n].value,i=s.__expires,r=s.__type;Object.keys(s).forEach(e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=GV(GV({value:s[e]},i&&{expires:i}),r&&{type:r}))})}),t}(e);try{var n;const s=null===(n=t.LIMIT_BITRATE)||void 0===n?void 0:n.value;delete t.LIMIT_BITRATE,s&&hM(s)&&this.handleBitrateLimit(s),this.limit_bitrate=s,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{const t=Date.now();Object.keys(e).forEach(n=>{const{value:s,type:i,expires:r}=e[n];r&&r<=t||((i===IA.REALTIME||Object.prototype.hasOwnProperty.call(NA,n))&&(AA[n]=s,TA[n]=s,aO.debug("Update realtime parameters from config distribute",n,s)),i||zj()||!Object.prototype.hasOwnProperty.call(xA,n)||(AA[n]=s,TA[n]=s,aO.debug("Update gateway parameters from config distribute",n,s)))})}catch(t){aO.error("Error update config immediately: ".concat(e),t.message)}}(t);const i=JSON.stringify(t),r=window.btoa(i);window.localStorage.setItem("websdk_ng_global_parameter",r),aO.debug("Caching global parameters ".concat(i))}catch(e){aO.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{const t=Date.now();Object.keys(e).forEach(n=>{if("CLIENT_ROLE_OPTIONS"===n&&Object.prototype.hasOwnProperty.call(TA,n)){const{value:s,expires:i}=e[n];if(i&&i<=t)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(TA[n],s)||(AA[n]=s,TA[n]=s,this.emit(uM.UPDATE_CLIENT_ROLE_OPTIONS,s),aO.debug("Updating client role options: ".concat(JSON.stringify(s))))}})}catch(e){aO.error("Error handling global parameter config:",e.message)}}}class HV extends HR{constructor(){super(...arguments),uN(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n)),!t.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(RA("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(e);if(!s)return;s.result.push(n);const i="VIDEO_ENCODE_FAILED"===e?RA("ENCODE_EXCEPTION_TIMES"):5;if(s.result.length>=i){var r;const n=Ps(r=s.result).call(r,!0);s.isPrevNormal&&!n&&this.emit("exception",KV[e],e,t),!s.isPrevNormal&&n&&this.emit("exception",KV[e]+2e3,e+"_RECOVER",t),s.isPrevNormal=n,s.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof WD&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=rU(t._encoderConfig.frameRate));const s=e.captureFrameRate;return!n||!s||!(n>10&&s<5||n<10&&n>=5&&s<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var t;return!(!e.codecType||Ps(t=RA("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(t,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||0!==e.sendFrameRate||0!==e.sendResolutionWidth||0!==e.sendResolutionHeight}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof WD&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const KV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},zV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function qV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function YV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qV(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class XV{constructor(e){uN(this,"store",void 0),uN(this,"onStatsException",void 0),uN(this,"onUploadPublishDuration",void 0),uN(this,"onStatsChanged",void 0),uN(this,"onVideoCodecChanged",void 0),uN(this,"localStats",new Map),uN(this,"remoteStats",new Map),uN(this,"updateStatsInterval",void 0),uN(this,"trafficStats",void 0),uN(this,"trafficStatsPeerList",[]),uN(this,"uplinkStats",void 0),uN(this,"exceptionMonitor",void 0),uN(this,"p2pChannel",void 0),uN(this,"scalabilityMode",cA.L1T1),uN(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new HV,this.exceptionMonitor.on("exception",(e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(_M.LocalAudioTrack)||YV({},qO)}getLocalVideoTrackStats(){return this.localStats.get(_M.LocalVideoTrack)||YV({},YO)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var s;const i=null===(s=this.remoteStats.get(e))||void 0===s?void 0:s.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[s,{audioStats:i}]=e;i&&(n[s]=t(s,i))});return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const s=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;s&&(t[e]=s)}else Array.from(this.remoteStats.entries()).forEach(e=>{let[n,{networkStats:s}]=e;s&&(t[n]=s)});return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var s;const i=null===(s=this.remoteStats.get(e))||void 0===s?void 0:s.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[s,{videoStats:i}]=e;i&&(n[s]=t(s,i))});return n}getRTCStats(){let e=0,t=0,n=0,s=0;const i=this.localStats.get(_M.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const r=this.localStats.get(_M.LocalVideoTrack);r&&(e+=r.sendBytes,t+=r.sendBitrate);const a=this.localStats.get(_M.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach(e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,s+=t.receiveBitrate),i&&(n+=i.receiveBytes,s+=i.receiveBitrate)});let o=1;return this.trafficStats&&(o+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:o,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(e=>void 0!==e.B_ppad||void 0!==e.B_ppvd),e.peer_delay.filter(e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid)).forEach(e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),s=null!=n&&n.videoSSRC?zV.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?zV.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,s>i?s:i),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&aO.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const s=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return s||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[n,s]=t;switch(n){case _M.LocalVideoTrack:case _M.LocalVideoLowTrack:{const t=s,a=YV({},YO),o=e.getStats(),c=e.getLocalMedia(n);if(o){const n=o.videoSend.find(e=>e.ssrc===(null==c?void 0:c.ssrcs[0].ssrcId));if(n){const s=e.getLocalVideoSize(),r=e.getEncoderConfig(_M.LocalVideoTrack);var i;"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(a.codecType=n.codec,(null==t?void 0:t.codecType)!==n.codec&&(null===(i=this.onVideoCodecChanged)||void 0===i||i.call(this,n.codec.toLocaleLowerCase()))),a.sendBytes=n.bytes,a.sendBitrate=t?8*Math.max(0,a.sendBytes-t.sendBytes):0,n.inputFrame?(a.captureFrameRate=n.inputFrame.frameRate,a.captureResolutionHeight=n.inputFrame.height,a.captureResolutionWidth=n.inputFrame.width):s&&(a.captureResolutionWidth=s.width,a.captureResolutionHeight=s.height),n.sentFrame?(a.sendFrameRate=n.sentFrame.frameRate,a.sendResolutionHeight=n.sentFrame.height,a.sendResolutionWidth=n.sentFrame.width):s&&(a.sendResolutionWidth=s.width,a.sendResolutionHeight=s.height),n.avgEncodeMs&&(a.encodeDelay=n.avgEncodeMs),r&&r.bitrateMax?a.targetSendBitrate=1e3*r.bitrateMax:n.targetBitrate&&(a.targetSendBitrate=n.targetBitrate),a.sendPackets=n.packets,a.sendPacketsLost=n.packetsLost,a.sendJitterMs=n.jitterMs,a.sendRttMs=n.rttMs,a.totalDuration=t?t.totalDuration+1:1,a.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(a.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(aO.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var r;this.localStats.set(n,a),((null==t?void 0:t.sendResolutionWidth)!==a.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==a.sendResolutionHeight)&&(null===(r=this.onStatsChanged)||void 0===r||r.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&c&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,c.track,a);break}case _M.LocalAudioTrack:{const t=s,i=YV({},qO),r=e.getStats(),a=e.getLocalMedia(n);if(r){const n=r.audioSend.find(e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(_M.LocalAudioTrack,i),i&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,i);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var n,s;let[i,{videoStats:r,audioStats:a,videoPcStats:o}]=t;const c=a,l=r,d=o,u=YV({},XO),h=YV({},QO),p=YV({},JO),{audioTrack:m,videoTrack:f,audioSSRC:g,videoSSRC:y}=e.getRemoteMedia(i);let v;v=this.store.useP2P?e.getStats(!0):e.getStats();const _=null===(n=v)||void 0===n?void 0:n.audioRecv.find(e=>e.ssrc===g),E=null===(s=v)||void 0===s?void 0:s.videoRecv.find(e=>e.ssrc===y),b=this.trafficStats&&this.trafficStats.peer_delay.find(e=>e.peer_uid===i);if(_&&("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(u.codecType=_.codec),_.outputLevel?u.receiveLevel=Math.round(32767*_.outputLevel):m&&(u.receiveLevel=Math.round(32767*m.getVolumeLevel())),u.receiveBytes=_.bytes,u.receivePackets=_.packets,u.receivePacketsLost=_.packetsLost,u.receivePacketsDiscarded=_.packetsDiscarded,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.receiveBitrate=c?8*Math.max(0,u.receiveBytes-c.receiveBytes):0,u.totalDuration=c?c.totalDuration+1:1,u.totalFreezeTime=c?c.totalFreezeTime:0,u.freezeRate=u.totalFreezeTime/u.totalDuration,u.receiveDelay=_.jitterBufferMs,u.totalDuration>10&&XV.isRemoteAudioFreeze(m)&&(u.totalFreezeTime+=1)),E){var x;"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(h.codecType=E.codec),h.receiveBytes=E.bytes,h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.decodeFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,h.renderFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,E.outputFrame&&(h.renderFrameRate=E.outputFrame.frameRate),E.receivedFrame?(h.receiveFrameRate=E.receivedFrame.frameRate,h.receiveResolutionHeight=E.receivedFrame.height,h.receiveResolutionWidth=E.receivedFrame.width):f&&(h.receiveResolutionHeight=f._videoHeight||0,h.receiveResolutionWidth=f._videoWidth||0),void 0!==E.framesRateFirefox&&(h.receiveFrameRate=Math.round(E.framesRateFirefox)),h.receivePackets=E.packets,h.receivePacketsLost=E.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost);const t=l?l.totalFreezeTime:0,n=l?l.totalDuration:0;h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=null!==(x=E.totalFreezesDuration)&&void 0!==x?x:t||0,h.receiveDelay=E.jitterBufferMs||0;const s=!!y&&e.getRemoteVideoIsReady(y);void 0===E.totalFreezesDuration&&f&&s&&XV.isRemoteVideoFreeze(f,E,d)&&(h.totalFreezeTime+=1),h.freezeRate=Math.max(0,Math.min((h.totalFreezeTime-t)/(h.totalDuration-n),1))}b&&(u.end2EndDelay=b.B_ad,h.end2EndDelay=b.B_vd,u.transportDelay=b.B_ed,h.transportDelay=b.B_ed,u.currentPacketLossRate=b.B_ealr4/100,h.currentPacketLossRate=b.B_evlr4/100,p.uplinkNetworkQuality=b.B_punq?b.B_punq:0,p.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(i,{audioStats:u,videoStats:h,videoPcStats:E,networkStats:p}),m&&this.exceptionMonitor.setRemoteAudioStats(m,u),f&&this.exceptionMonitor.setRemoteVideoStats(f,h)})}}class JV{constructor(){uN(this,"destChannelMediaInfos",new Map),uN(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){ZL(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){ZL(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){GL(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QV(e){if(!(e instanceof JV))return new fO(RR.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new fO(RR.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new fO(RR.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class ZV{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){uN(this,"uid",void 0),uN(this,"_uintid",void 0),uN(this,"_trust_in_room_",!0),uN(this,"_trust_audio_enabled_state_",!0),uN(this,"_trust_video_enabled_state_",!0),uN(this,"_trust_audio_mute_state_",!0),uN(this,"_trust_video_mute_state_",!0),uN(this,"_audio_muted_",!1),uN(this,"_video_muted_",!1),uN(this,"_audio_enabled_",!0),uN(this,"_video_enabled_",!0),uN(this,"_audio_added_",!1),uN(this,"_video_added_",!1),uN(this,"_is_pre_created",!1),uN(this,"_video_pre_subscribed",!1),uN(this,"_audio_pre_subscribed",!1),uN(this,"_trust_video_stream_added_state_",!0),uN(this,"_trust_audio_stream_added_state_",!0),uN(this,"_audioTrack",void 0),uN(this,"_videoTrack",void 0),uN(this,"_dataChannels",[]),uN(this,"_audioSSRC",void 0),uN(this,"_videoSSRC",void 0),uN(this,"_audioOrtc",void 0),uN(this,"_videoOrtc",void 0),uN(this,"_cname",void 0),uN(this,"_rtxSsrcId",void 0),uN(this,"_videoMid",void 0),uN(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function $V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function eF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$V(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$V(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const tF="9",nF=2e4,sF=4e4;function iF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function rF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iF(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var aF=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(aF||{});const oF=new Map;function cF(e,t,n,s){let{scale:i}=e;if(0===i&&s===aF.UP||i>=t.length-1&&s===aF.DOWN)return e;let r=rF(rF({},e),{},{scale:s===aF.DOWN?++i:--i});switch(n){case"maintain-framerate":r=rF(rF({},r),t[i].motion);break;case"maintain-resolution":r=rF(rF({},r),t[i].detail);break;case"balanced":r=rF(rF({},r),t[i].balanced)}return r}function lF(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:dF(t)};oF.set(e,n)}else oF.delete(e)}function dF(e){const t=rF({},e),{bitrateMax:n,frameRate:s,scaleResolutionDownBy:i,bitrateMin:r}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:o,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:m,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:y,MOTION_RESOLUTION_FACTOR:v,MOTION_BITRATE_FACTOR:_,DETAIL_FRAMERATE_FACTOR:E,DETAIL_BITRATE_FACTOR:b}=wA,x=Math.min(t.frameRate,o),w=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*x),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:r},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:r},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:r}}];for(let S=1;S<=c;S++){const e={bwe_up:Math.round(Math.pow(u,S)*n),bwe_down:Math.round(Math.pow(h,S+1)*n),fps_up:Math.round(Math.pow(m,S)*x),fps_down:Math.round(Math.pow(p,S+1)*x)},t={scaleResolutionDownBy:i/Math.pow(y,S),frameRate:Math.max(Math.round(Math.pow(g,S)*s),a),bitrateMax:Math.max(Math.round(Math.pow(f,S)*n),d),bitrateMin:Math.max(Math.round(Math.pow(f,S)*r),l)},o={scaleResolutionDownBy:i/Math.pow(v,S),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(_,S)*n),d),bitrateMin:Math.max(Math.round(Math.pow(_,S)*r),l)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(E,S)*s),a),bitrateMax:Math.max(Math.round(Math.pow(b,S)*n),d),bitrateMin:Math.max(Math.round(Math.pow(b,S)*r),l)};w.push({scale:S,threshold:e,balanced:t,motion:o,detail:c})}return w}function uF(e,t,n,s,i,r){const a=oF.get(e)||{overUse:0,underUse:0,adaptationList:dF(i)},{adaptationList:o}=a;oF.set(e,a);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=wA,{scale:d}=s;let u,h;return"number"==typeof t&&t>0&&function(e,t,n,s){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return RA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===s&&(i=n[0].threshold.fps_down),e<i}(t,d,o,r)&&(a.overUse++,h=oA.CPU,a.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:s}}=n[t];return e<s}(n,d,o)&&(a.overUse++,h=oA.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,u=cF(s,o,r,aF.DOWN),[u,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,s){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return RA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===s&&(i=n[1].threshold.fps_up),e>i}(t,d,o,r)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:s}}=n[t];return e>s}(n,d,o)&&(a.underUse++,a.underUse>l&&(a.overUse=0,a.underUse=0,u=cF(s,o,r,aF.UP),0===u.scale&&(h=oA.NONE))),[u,h])}function hF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function pF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hF(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const mF=new Map;function fF(e,t){const n=mF.get(e);if(n){const{timer:t}=n;window.clearTimeout(t),mF.delete(e)}t.qualityLimitationReason=oA.NONE,lF(e)}function gF(e,t){var n;let s;switch(t){case _M.LocalAudioTrack:s=sM.Audio;break;case _M.LocalVideoTrack:s=Ps(n=e._hints).call(n,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalVideoLowTrack:s=sM.Low}return s}function yF(e){const t=yO();if(e.some(e=>e._bypassWebAudio))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function vF(e,t){yF(e);const n=t||new WD;return e.forEach(e=>n.addAudioTrack(e)),n}const _F=!yO().supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&xR();function EF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return _F?(n={spec:t,store:e},JU("PlanBConnection").create(n)):new TF(t,e)}function bF(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function xF(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(ZR(e.turnServer.servers))return!1;if(RA("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch(e){return!1}}var wF;function SF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function NF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SF(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let TF=(wF=class e extends mM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Ps(t=Object.keys(kA)).call(t,e)}))]}constructor(t,n){super(t,n),uN(this,"id",NI(5,"connection-")),uN(this,"store",void 0),uN(this,"peerConnection",void 0),uN(this,"forceTurn",!1),uN(this,"remoteSDP",void 0),uN(this,"initialOffer",void 0),uN(this,"transportEventReceiver",void 0),uN(this,"statsFilter",void 0),uN(this,"extension",{useXR:RA("USE_XR")}),uN(this,"localCapabilities",void 0),uN(this,"remoteCodecs",void 0),uN(this,"localCandidateCount",0),uN(this,"allCandidatesReceived",!1),uN(this,"isPreallocation",!1),uN(this,"preMediaMap",new Map),uN(this,"dataStreamChannelMap",new Map),uN(this,"establishPromise",void 0),uN(this,"recoveredDataChannelIds",[]),uN(this,"currentDataChannelId",1),uN(this,"supportAV1RtpSpec",!1),uN(this,"mutex",void 0),uN(this,"qualityLimitationReason",oA.NONE),uN(this,"isFirstConnected",!1),this.store=n,this.forceTurn=xF(t),this.mutex=new UI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,nR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else aO.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else aO.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=xU(n.sdp),i=await DU({filterRTX:!RA("USE_PUB_RTX")&&!RA("USE_SUB_RTX"),filterVideoFec:RA("FILTER_VIDEO_FEC"),filterAudioFec:RA("FILTER_AUDIO_FEC"),filterVideoCodec:RA("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:RA("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:RA("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=LU(i),this.initialOffer=n,RA("ENABLE_SVC")&&"av1"==this.store.codec){const t=await async function(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:cA.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=VA(t.sdp).mediaDescriptions[0];if(!n)return;const s=n.attributes.extmaps.find(e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName);return e.close(),s}catch(e){return}}();var e;t&&(this.supportAV1RtpSpec=!0,null===(e=i.send)||void 0===e||e.videoExtensions.push(t))}let r;return n.sdp&&WU(n.sdp)&&(r=pI(i),(t=r).send&&(gU(fM.VIDEO,t.send.videoExtensions),gU(fM.AUDIO,t.send.audioExtensions)),t.recv&&(gU(fM.VIDEO,t.recv.videoExtensions),gU(fM.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(gU(fM.VIDEO,t.sendrecv.videoExtensions),gU(fM.AUDIO,t.sendrecv.audioExtensions))),NF(NF({},s),{},{rtpCapabilities:r||i,offerSDP:n.sdp})}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&WU(this.initialOffer.sdp)&&(t=e.rtpCapabilities,n=this.localCapabilities,t.send&&(fU(fM.VIDEO,t.send.videoExtensions,n.send.videoExtensions),fU(fM.AUDIO,t.send.audioExtensions,n.send.audioExtensions)),t.recv&&(fU(fM.VIDEO,t.recv.videoExtensions,n.recv.videoExtensions),fU(fM.AUDIO,t.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return pI(this._localCapabilities)}get rtpCapabilities(){return pI(this._rtpCapabilities)}get candidates(){return pI(this._candidates)}get iceParameters(){return pI(this._iceParameters)}get dtlsParameters(){return pI(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];uN(this,"sessionDesc",void 0),uN(this,"_localCapabilities",void 0),uN(this,"_rtpCapabilities",void 0),uN(this,"_candidates",void 0),uN(this,"_originCandidates",void 0),uN(this,"_iceParameters",void 0),uN(this,"_isUseExtmapAllowMixed",void 0),uN(this,"_isUseLocalCodecs",void 0),uN(this,"_dtlsParameters",void 0),uN(this,"setup",void 0),uN(this,"currentMidIndex",void 0),uN(this,"cname",void 0),uN(this,"useLocalCodecsMids",[]),uN(this,"preloadSsrcs",[]),uN(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,e=pI(e);const{iceParameters:s,dtlsParameters:i,candidates:r,rtpCapabilities:a,setup:o,localCapabilities:c,cname:l}=e;this._rtpCapabilities=a,this._candidates=r,this._originCandidates=pI(r),this._iceParameters=s,this._dtlsParameters=i,this._localCapabilities=c,this.setup=o,this.cname=l,[this.sessionDesc]=this.updateRemoteRTPCapabilities(a),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(e=>{var t;return Ps(t=this.preloadSsrcs).call(t,e)})}preloadRemoteMedia(e){let t=0;const n=[],s=[];for(;e>0;){const i=[eF({ssrcId:sF+t},RA("USE_SUB_RTX")?{rtx:sF+t+1}:{})],r="".concat(sF+t,"_").concat(nF+t),{ssrcs:a,ssrcGroups:o}=TU(i,this.cname,RA("SYNC_GROUP")?r:void 0),c=this.preCreateOrRecycleSendMedia("video",a,o,void 0),l=[{ssrcId:nF+t}],d="".concat(sF+t,"_").concat(nF+t),{ssrcs:u,ssrcGroups:h}=TU(l,this.cname,RA("SYNC_GROUP")?d:void 0),p=this.preCreateOrRecycleSendMedia("audio",u,h,void 0);e--,t+=2,n.push(c,p),s.push(a[0].ssrcId,u[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=s,{mids:n,preSSRCs:s,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,s){const i=this.rtpCapabilities.send.videoCodecs,r=this._isUseLocalCodecs||0===i.length?this.localCapabilities.recv:this.rtpCapabilities.send;aO.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const a=e===fM.VIDEO?r.videoCodecs:r.audioCodecs,o=e===fM.VIDEO?r.videoExtensions:r.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:o,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};return l=this.mungSendMediaDesc(l,s),this.sessionDesc.mediaDescriptions.push(l),this.updateBundleMids(),c}toString(){return FA(this.sessionDesc)}send(e,t,n,s){const{ssrcs:i,ssrcGroups:r}=TU(t,this.cname,RA("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(nR()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),s&&(s.twcc||s.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,s),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&($C()||function(){const e=qC();return!(e.name!==WC.CHROME||!e.osVersion)&&Number(e.version)<=90}()||RA("ENABLE_ENCODED_TRANSFORM")&&ZC())||0===t&&!function(e){const t=qC();return!(t.name!==WC.FIREFOX||!t.osVersion)&&Number(t.version)===e}(138)&&RA("USE_SUB_RTX")||mR()?(n=this.createOrRecycleSendMedia(e,i,r,"sendonly",s),this.updateBundleMids()):(n=pI(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=r,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,s)),nR()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(e=>{let{kind:t,ssrcMsg:n,mslabel:s}=e;return this.send(t,n,s)}),n=[];let s=!1;return t.forEach(e=>{let{mid:t,needExchangeSDP:i}=e;i&&(s=!0),n.push(t)}),{mids:n,needExchangeSDP:s}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{"0"===e.attributes.mid||nR()||mR()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Ps(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Ps(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}receive(e,t,n,s){e.forEach((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,s[i])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||VA((n=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(n?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));var n;this._rtpCapabilities=e;let s=!1;const i=this.rtpCapabilities.send,r=this.localCapabilities.send,a=this.localCapabilities.recv,o=a.videoCodecs,c=a.audioCodecs,l=a.videoExtensions,d=a.audioExtensions;for(const m of t.mediaDescriptions){var u;if("sendonly"!==m.attributes.direction||"string"!=typeof m.attributes.mid||!Ps(u=this.useLocalCodecsMids).call(u,m.attributes.mid)){if(s=!0,m.attributes.iceUfrag=this._iceParameters.iceUfrag,m.attributes.icePwd=this._iceParameters.icePwd,m.attributes.fingerprints=this._dtlsParameters.fingerprints,m.attributes.candidates=this._candidates,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var h;m.media.fmts=o.map(e=>e.payloadType.toString(10)),m.attributes.payloads=o,m.attributes.extmaps=l;const e=m.attributes.mid;"string"!=typeof e||Ps(h=this.useLocalCodecsMids).call(h,e)||this.useLocalCodecsMids.push(e)}else if(0===i.videoCodecs.length){const e=r.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Ps(n=t.encodingName.toLowerCase()).call(n,"vp8")})||[r.videoCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=i.videoCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=i.videoCodecs,m.attributes.extmaps=i.videoExtensions;if("audio"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var p;m.media.fmts=c.map(e=>e.payloadType.toString(10)),m.attributes.payloads=c,m.attributes.extmaps=d;const e=m.attributes.mid;"string"!=typeof e||Ps(p=this.useLocalCodecsMids).call(p,e)||this.useLocalCodecsMids.push(e)}else if(0===i.audioCodecs.length){const e=r.audioCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Ps(n=t.encodingName.toLowerCase()).call(n,"opus")})||[r.audioCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=i.audioCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=i.audioCodecs,m.attributes.extmaps=i.audioExtensions,MU(m)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,s]}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),n=[];if(t.forEach(e=>{n.push(eF(eF({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this._candidates=n;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const s=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(nR()){if(s){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return s})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:tF,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,s,i,r){const a=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=UU(a,o,this.localCapabilities.send,a===fM.VIDEO?s:i),l=a===fM.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let u={media:{mediaType:a,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e,r);const h=this.findFirstClosedMedia(a);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(e=>e.fingerprint)),n=new Set(e.map(e=>e.fingerprint));let s=!1;t.size!==n.size&&(s=!0);for(const i of t)n.has(i)||(s=!0);return s}updateRemoteCodec(e,t,n){const s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Ps(t=Object.keys(kA)).call(t,e)}))],i=new Set(t);if(s.every(e=>i.has(e)))return aO.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const r=this._rtpCapabilities.recv.videoCodecs.filter(e=>t.some(t=>{var n;return Ps(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}));if(0===r.length)return aO.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(t)),!1;const a=[...new Set(r.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""))];let o;if(aO.debug("updateRemoteCodec, from ".concat(s," to ").concat(a)),0===e.length)o=this.sessionDesc.mediaDescriptions.filter(e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction);else if(o=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&"video"===t.media.mediaType&&Ps(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction),o.length!==e.length)return aO.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(RA("USE_PUB_RTX")||RA("USE_SUB_RTX")){const e=VU(r,this.rtpCapabilities.recv.videoCodecs);r.push(...e)}this._rtpCapabilities.recv.videoCodecs=r;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,d=UU(fM.VIDEO,l,c,n);return o.forEach(e=>{const t=d.map(e=>e.payloadType.toString(10));aO.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",d),e.attributes.payloads=d,e.media.fmts=t}),!0}createOrRecycleSendMedia(e,t,n,s,i){const r=this.rtpCapabilities.send.videoCodecs,a=this._isUseLocalCodecs||0===r.length?this.localCapabilities.recv:this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungSendMediaDesc(d,i);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const s=pI(e);return RU(s),CU(s,t),IU(s,t),AU(s),OU(s,n,this.localCapabilities.send),s}mungSendMediaDesc(e,t){const n=pI(e);return OU(n,t,this.localCapabilities.recv),MU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>nR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===t?void 0:t.attributes.ssrcs}}(NF(NF({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!RA("ENABLE_PRE_SUB_WITH_PRE_PC")||!RA("PRE_USE_LOCAL_CODECS"))&&EO(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),i=BU(this.initialOffer.sdp,this.extension),r=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==r||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const a=this.peerConnection.getTransceivers()[0];if(null!=a&&a.receiver&&this.tryBindTransportEvents(a.receiver),EO(this.store))if(e.preallocation&&RA("ENABLE_PRE_SUB_WITH_PRE_PC")){const e=RA("PRE_SUB_NUM"),{mids:t,preSSRCs:n}=this.remoteSDP.preloadRemoteMedia(e);await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(n)),this.presetMedia(t,n)}else{const{preSSRCs:t=[]}=e,n=t.map(e=>e.ssrcMsg[0].ssrcId);if(0===t.length)return;const{mids:s}=this.remoteSDP.batchSend(t.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(n)),this.presetMedia(s,n)}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}var t,n}presetMedia(e,t){e.forEach((e,n)=>{this.peerConnection.getTransceivers().forEach(s=>{if(null!=s.mid&&e===s.mid&&s.receiver.track){const i=s.receiver.track;let r;"video"===i.kind&&RA("ENABLE_PRE_RENDER")&&(r=new XD({trackId:"track-".concat(i.kind,"-unknown-").concat(this.store.clientId,"_").concat(NI(5,""))},!0),r.updateVideoTrack(i),r.onFirstVideoFrameRender=()=>{var e;const s=this.preMediaMap.get(t[n]);s&&(s.firstVideoRender=Date.now()),null===(e=this.onFirstVideoRender)||void 0===e||e.call(this,t[n])},r.play(this.store.sessionId||void 0)),this.preMediaMap.set(t[n],{mid:e,track:i,player:r,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let t=!1;const{rtpCapabilities:n}=e;if([,t]=this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const e=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);t=t||e}const{preSSRCs:s=[]}=e,i=s.map(e=>e.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(i)){const e=[],t=[];if(Array.from(this.preMediaMap.entries()).every(n=>{let[s,{mid:i,player:r,track:a}]=n;return e.push(i),t.push(s),this.preMediaMap.delete(s),r&&r.destroy(),!0}),e.length>0&&(this.remoteSDP.stopSending(e),await FU(this.peerConnection,this.remoteSDP,this.extension),aO.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(t)),mO.reportApiInvoke(this.store.sessionId,{name:qR.PRELOAD_MEDIA_FAILED,options:[s,t],tag:YR.TRACER}).onSuccess()),s.length>0){const{mids:e}=this.remoteSDP.batchSend(s.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(i)),this.presetMedia(e,i)}}t?(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):aO.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,n){var s=this;return YT(function*(){const i=yield JT(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=[],a=pU();e.forEach(e=>{const t=s.peerConnection.addTransceiver(e._mediaStreamTrack,NF({direction:"sendonly"},"video"===e.trackMediaType&&s.supportAV1RtpSpec&&a?{sendEncodings:[{scalabilityMode:a}]}:{}));r.push(t),e._updateRtpTransceiver(t)}),nR()&&!0===RA("SIMULCAST")&&(yield JT(s.applySimulcastForFirefox(r,e)));const o=yield JT(s.peerConnection.createOffer()),c=s.remoteSDP.predictReceivingMids(e.length),l=s.mungSendOfferSDP(o.sdp,e,c),d=VA(l),u=c.map(e=>{const t=d.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(t,RA("USE_PUB_RTX"))});let h;try{h=yield u}catch(i){h=[],s.remoteSDP.receive(e,t,n,h);const r=s.remoteSDP.toString();throw yield JT(s.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JT(s.peerConnection.setRemoteDescription({type:"answer",sdp:r})),yield JT(s.stopSending(c,!0)),i}s.remoteSDP.receive(e,t,n,h);const p=s.remoteSDP.toString(),m=s.logSDPExchange(l,"offer","local","send");return yield JT(s.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JT(s.applySimulcastEncodings(r,e)),yield JT(s.applySendEncodings(r,e)),null==m||m(p),yield JT(s.peerConnection.setRemoteDescription({type:"answer",sdp:p})),r.map((e,t)=>{const n=c[t];return{localSSRC:u[t],id:n,transceiver:e}})}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)aO.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:RA("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach(e=>{e._updateOriginDataChannel(n)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),aO.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else aO.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof IR?e:new IR(RR.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{var t;fF(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),s=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==s||s(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:r}=this.remoteSDP.send(e,t,n,s);r&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(e=>e.mid===i);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(e=>{const t=this.peerConnection.getTransceivers().find(t=>t.mid===e);if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(e=>{Array.from(this.preMediaMap.entries()).some(t=>{let[n,{mid:s,player:i}]=t;if(s===e)return this.preMediaMap.delete(n),i&&i.destroy(),!0})}),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();null==n||n(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();null==n||n(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();null==n||n(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),s=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==s||s(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(e,t)=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),s=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString();null==s||s(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YT(function*(){const n=yield JT(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=yO().supportPCSetConfiguration,s=RA("FORCE_TURN_TCP")||t.forceTurn;if(e===gM.RELAY&&!n)return;if(n&&!s){const n=e===gM.RELAY?"relay":"all",s=t.peerConnection.getConfiguration();s.iceTransportPolicy!==n&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(s.iceTransportPolicy,"] to [").concat(n,"]")),s.iceTransportPolicy=n,t.peerConnection.setConfiguration(s))}t.remoteSDP.updateCandidates(e);const i=yield JT(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=xU(i.sdp),{remoteIceParameters:a}=yield r.iceParameters;t.remoteSDP.restartICE(a);const o=t.remoteSDP.toString(),c=t.logSDPExchange(i.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield JT(t.peerConnection.setLocalDescription(i)),null==c||c(o),yield JT(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(gM.TCP_RELAY),await FU(this.peerConnection,this.remoteSDP,this.extension)}catch(e){aO.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(e=>{fF(this.id+e.mid,this)}),this.preMediaMap.forEach(e=>{let{player:t}=e;t&&t.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return NF(NF({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?nR()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:s}=t.getSelectedCandidatePair();return{local:NF(NF({},$I),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:NF(NF({},$I),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;const n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),s=e.port?"local: ".concat(e.port):"",i=hU(e.url||"");aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(i||"",", host_candidate:").concat(s)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},RA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},s=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(ZR(t.turnServer.servers)?n.iceServers=t.turnServer.servers:RA("NEW_TURN_MODE")&&n.iceServers&&"disabled"===s?(RA("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),RA("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),RA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),RA("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),RA("ENABLE_ENCODED_TRANSFORM")&&yO().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!RA("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{const n=RA("NEW_TURN_MODE");1===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":443?transport=tcp")}):4===n&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nU(e.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair()||{};if(e&&t){const n=e.address+":"+e.port,s=t.address+":"+t.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(n)),", remote ").concat(JSON.stringify(hU(s))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,s;if(!t){const n=this.peerConnection.getSenders();t=n.find(t=>t.track===e._mediaStreamTrack)}if(!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!yO().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},r={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}const a=function(e,t){return e.getTransceivers().find(e=>e.sender.track===t||e.receiver.track===t)}(this.peerConnection,e._mediaStreamTrack),o=Jk(e);if(function(e){var t;return!(!RA("ENABLE_AG_ADAPTATION")||!(e instanceof jP||Ps(t=e._hints).call(t,UO.CUSTOM_TRACK))||!RA("FORCE_SUPPORT_AG_ADAPTATION")&&!(dR(14,0,!1)&&uR(17,4,!0)||lR(14)&&hR(17,4,!0)))}(e)&&a&&t&&o&&this.getLocalVideoStats&&Ps(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=i.degradationPreference||(Ps(c=e._hints).call(c,UO.CUSTOM_TRACK)?RA("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,s,i,r){if(fF(e,n),i(t),"balanced"!==s&&"maintain-framerate"!==s&&"maintain-resolution"!==s)return;let a=-1;lF(e,t);const o=window.setInterval(()=>{const o=mF.get(e);if(!RA("ENABLE_AG_ADAPTATION")||!o)return fF(e,n),void i(t);const c=r();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;const r=c.sendFrameRate,l=c.OutgoingAvailableBandwidth,[d,u]=uF(e,r,l,o.adaptationConfig,t,s);u&&(n.qualityLimitationReason=u),d&&o.adaptationConfig.scale!==d.scale&&(aO.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(r,", bwe ").concat(l,", switch from ").concat(o.adaptationConfig.scale," to ").concat(d.scale," ")),o.adaptationConfig=pF(pF({},o.adaptationConfig),d),i(d))}},RA("CHECK_LOCAL_STATS_INTERVAL")),c=pF({},t);mF.set(e,{timer:o,adaptationConfig:c,originConfig:t,adaptationFunc:i}),aO.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(s))}(this.id+a.mid,o,this,n,e=>{t&&this.updateAdaptation(t,e)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:s}=e._encoderConfig;t&&(r.maxBitrate=1e3*t),(Ps(l=e._hints).call(l,UO.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(r.maxFramerate=rU(n)),s&&s>=1&&(r.scaleResolutionDownBy=s))}const{maxFramerate:d}=RA("ENCODER_CONFIG_LIMIT");if(d&&"number"==typeof d&&(r.maxFramerate=r.maxFramerate?Math.min(r.maxFramerate,d):d),RA("DSCP_TYPE")&&xR()){var u;const e=RA("DSCP_TYPE");Ps(u=["very-low","low","medium","high"]).call(u,e)&&(r.networkPriority=e)}const h=t.getParameters(),p=null===(s=h.encodings)||void 0===s?void 0:s[0];nR()&&!p&&(i.encodings=[r]),p&&Object.assign(p,r),Object.assign(h,i),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,n){try{var s;if(!yO().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e||"av1"===e}(e)||!RA("ENABLE_SVC"))return;const i={},r={},a=t.getParameters(),o=null===(s=a.encodings)||void 0===s?void 0:s[0];r.scalabilityMode=pU(n),o&&Object.assign(o,r),Object.assign(a,i),await t.setParameters(a),aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,RA("SVC_MODE"))}async updateAdaptation(e,t){var n,s;if(!e)return aO.debug("[updateAdaptation] no rtpSender found");if(!yO().supportSetRtpSenderParameters)return aO.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const i={},{bitrateMax:r,frameRate:a,scaleResolutionDownBy:o}=t;r&&(i.maxBitrate=1e3*r),a&&(i.maxFramerate=rU(a)),o&&o>=1&&Ps(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=o);const c=e.getParameters(),l=null===(s=c.encodings)||void 0===s?void 0:s[0];l&&Object.assign(l,i),Object.assign(c,{});try{await e.setParameters(c),aO.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?aO.debug("[updateAdaptation] peerConnection not connected}"):aO.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):aO.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!yO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const s=e[n],i=t[n];i instanceof PP&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,s.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const s=VA(e);return t.forEach((e,t)=>{const i=n[t],r=s.mediaDescriptions.find(e=>e.attributes.mid===i);r&&(CU(r,e),kU(r,e,this.store.codec))}),FA(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var s;null===(s=this.onFirstVideoDecoded)||void 0===s||s.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var n,s,i,r,a;const c=e[o],l=t[o];if(l instanceof PP&&!Ps(n=l._hints).call(n,UO.LOW_STREAM)&&null!==(s=l._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(r=l._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nR()&&e.length===t.length)for(let n=0;n<e.length;n++){const s=t[n];if(s instanceof PP&&this.isVP8Simulcast(s)){const t=e[n],i={},r={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:r.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:r.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,s,i,r;return!!(e instanceof PP&&RA("SIMULCAST")&&"vp8"===this.store.codec&&!Ps(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(s=e._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(r=e._scalabilityMode)||void 0===r?void 0:r.numSpatialLayers)>1)}logSDPExchange(e,t,n,s){if(RA("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(s,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",s)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(yO().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},IL(wF.prototype,"updateRemoteRTPCapabilities",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateRemoteRTPCapabilities"),wF.prototype),IL(wF.prototype,"connect",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"connect"),wF.prototype),IL(wF.prototype,"updateRemoteConnect",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateRemoteConnect"),wF.prototype),IL(wF.prototype,"createDataChannels",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"createDataChannels"),wF.prototype),IL(wF.prototype,"receive",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"receive"),wF.prototype),IL(wF.prototype,"batchReceive",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"batchReceive"),wF.prototype),IL(wF.prototype,"stopReceiving",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"stopReceiving"),wF.prototype),IL(wF.prototype,"muteRemote",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"muteRemote"),wF.prototype),IL(wF.prototype,"unmuteRemote",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"unmuteRemote"),wF.prototype),IL(wF.prototype,"muteLocal",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"muteLocal"),wF.prototype),IL(wF.prototype,"unmuteLocal",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"unmuteLocal"),wF.prototype),IL(wF.prototype,"close",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"close"),wF.prototype),IL(wF.prototype,"updateEncoderConfig",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateEncoderConfig"),wF.prototype),IL(wF.prototype,"updateSendParameters",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateSendParameters"),wF.prototype),IL(wF.prototype,"replaceTrack",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"replaceTrack"),wF.prototype),IL(wF.prototype,"updateAdaptation",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateAdaptation"),wF.prototype),IL(wF.prototype,"getRemoteSSRC",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"getRemoteSSRC"),wF.prototype),wF);function CF(e,t,n){const s=e[t];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return await s.apply(this,r)}finally{n()}},n}function RF(e,t){let n=document.createElement("video"),s=document.createElement("canvas");n.setAttribute("style","display:none"),s.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),s.width=rU(t.width),s.height=rU(t.height);const i=rU(t.framerate||15);document.body.append(n),document.body.append(s);let r=e._mediaStreamTrack;n.srcObject=new MediaStream([r]),n.play();const a=s.getContext("2d");if(!a)throw new fO(RR.UNEXPECTED_ERROR,"can not get canvas context");const o=yO(),c=s.captureStream(o.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=s),s.startCapture=()=>{if(!n)return s.stopCapture&&s.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=s.width*t;Math.abs(i-s.height)>=2&&(aO.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(i)),s.height=i)}a.drawImage(n,0,0,s.width,s.height),c.requestFrame&&c.requestFrame(),r!==e._mediaStreamTrack&&(r=e._mediaStreamTrack,n.srcObject=new MediaStream([r]))},s.stopCapture=vk(()=>s.startCapture&&s.startCapture(),i);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),aO.debug("clean low stream renderer")},c}var IF=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(IF||{}),AF=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(AF||{}),OF=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(OF||{}),kF=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(kF||{}),DF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(DF||{}),PF=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(PF||{});const jF=1e3,LF=6,MF=3,UF=Math.max(LF,MF,60);function VF(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function FF(e){const t={[DF.CONN_TYPE]:0,[DF.RTT]:e.rtt,[DF.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[DF.CONN_TYPE]=1),"tcp"===n&&(t[DF.CONN_TYPE]=3),"tls"===n&&(t[DF.CONN_TYPE]=4);break}case"srflx":t[DF.CONN_TYPE]=2;break;case"unknown":t[DF.CONN_TYPE]=5;break;default:t[DF.CONN_TYPE]=0}return t}function BF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class GF extends HR{constructor(e){super(),uN(this,"store",void 0),uN(this,"uploadWRTCStatsTimer",void 0),uN(this,"uploadOutboundDenoiserStatsTimer",void 0),uN(this,"uploadExtStatsTimer",void 0),uN(this,"uploadExtUsageStatsTimer",void 0),uN(this,"uploadInboundExtStatsTimer",void 0),uN(this,"requestStats",void 0),uN(this,"requestTransportStats",void 0),uN(this,"requestLocalMedia",void 0),uN(this,"requestRemoteMedia",void 0),uN(this,"requestAllTracks",void 0),uN(this,"requestVideoIsReady",void 0),uN(this,"requestUploadStats",void 0),uN(this,"requestUpload",void 0),uN(this,"uploadOutboundStarted",!1),uN(this,"uploadInboundStarted",!1),uN(this,"uploadTransportStarted",!1),uN(this,"uploadBaseStatsStarted",!1),uN(this,"uploadExtensionUsageStarted",!1),uN(this,"lastRecvStats",void 0),uN(this,"lastSendStats",void 0),uN(this,"lastRefRecvStats",void 0),uN(this,"lastRefSendStats",void 0),uN(this,"lastNormalRecvStats",void 0),uN(this,"lastNormalSendStats",void 0),uN(this,"lastExtendStats",{}),uN(this,"needUploadStats",{}),uN(this,"needUploadRenderFreezeTime",!0),uN(this,"lastUploadCompensateTime",-1),uN(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const t=e%MF==0,n=e%LF==0,s=e%60==0;let i,r;if(this.uploadTransportStarted&&(i=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!i&&this.uploadOutboundStarted&&(i=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),i||r){var a;const o={};if(this.uploadTransportStarted&&i){const e=this.getTransportStats(i,r,t);e&&(o.misc=[e])}if(this.uploadOutboundStarted&&i){const e=this.getOutboundStats(i,n?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats,s);e&&(o.outbound=[e])}if(this.uploadInboundStarted&&r){this.uploadCompensateStats(e);const s=this.getInboundStats(r,n?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);s&&(o.inbound=s)}const c=null===(a=this.requestTransportStats)||void 0===a?void 0:a.call(this).connectState;c&&(Array.isArray(o.misc)?o.misc[0]&&o.misc[0].addition&&(o.misc[0].addition[PF.RTC_PEER_CONNECTION_STATE]=lA[c]):o.misc=[{addition:{[PF.RTC_PEER_CONNECTION_STATE]:lA[c]}}]),this.needUploadStats.sendType&&(Array.isArray(o.outbound)&&o.outbound[0]&&o.outbound[0].high&&(o.outbound[0].high[IF.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(o)}this.lastRecvStats=r,this.lastSendStats=i,n&&(this.lastNormalRecvStats=r,this.lastNormalSendStats=i),t&&(this.lastRefRecvStats=r,this.lastRefSendStats=i)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,n;const e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(n=this.requestUploadStats)||void 0===n||n.call(this,{misc:[{addition:{[PF.RTC_PEER_CONNECTION_STATE]:lA[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===UF+1&&(e=1)},jF)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const t=e%MF==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(-1===this.lastUploadCompensateTime)return void(this.lastUploadCompensateTime=Date.now());const n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const s=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*s;const i=this.requestStats(!0);new Array(s).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const e={};if(this.uploadInboundStarted&&i){const t=this.requestRemoteMedia()||[],n=[];t.forEach(e=>{let[t,s]=e;const r={peer:t.uid};if(t._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(t._videoSSRC)&&s.has(fM.VIDEO)&&t.videoTrack){const e=function(e,t,n){if(!t.videoRecv.find(t=>t.ssrc===e))return;const s={};if(n&&n._player){const e=n._player,{renderFreezeAccTime2:t,videoElementStatus:i}=e;if("visible"===ZP.visibility&&i===nk.PLAYING&&yO().supportRequestVideoFrameCallback){const n=Math.min(6e3,t);e.renderFreezeAccTime2=Math.max(0,t-n),VF(s,AF.Video_Render_Freeze_Time_Render2,n),RA("USE_NEW_RENDER_FREEZE_TIME")&&VF(s,AF.Video_Render_Freeze_Time_Render,n)}}return s}(t._videoSSRC,i,t.videoTrack);e&&(r.video=e)}r.video&&n.push(r)}),n.length>0&&(e.inbound=n,this.requestUploadStats(e))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,n){if(!this.requestStats)return;if(!n)return null==e.rtt?void 0:{addition:{[DF.RTT]:e.rtt,[DF.CONN_TYPE]:void 0,[DF.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const s=FF(e);if(this.store.useP2P){if(t){const e=FF(t);s[DF.CONN_TYPE]+=e[DF.CONN_TYPE]<<3}s[DF.CONN_TYPE]+=110}else s[DF.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(e,t,n,s,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;const r=this.requestLocalMedia();if(!r||0===r.length)return;let a,o,c;return r.forEach(s=>{let[r,{track:l,ssrcs:d}]=s;switch(r){case _M.LocalVideoLowTrack:case _M.LocalVideoTrack:if(r===_M.LocalVideoTrack){var u;const s=function(e,t,n,s,i){const r=t.videoSend.find(t=>t.ssrc===e);if(!r)return;const a={},{sentFrame:o,inputFrame:c}=r;if(s&&(VF(a,AF.Video_Send_Qp_Sum,r.qpSumPerFrame),c&&o)){const e=c.frameRate,t=o.frameRate;a[AF.Video_Send_Freeze]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(i){switch(o&&(VF(a,OF.Video_Send_Height,o.height),VF(a,OF.Video_Send_Width,o.width),VF(a,OF.Video_Send_Frame_Rate,o.frameRate)),a[OF.Video_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0,r.adaptionChangeReason){case"none":a[OF.Video_Send_Adaptation]=0;break;case"cpu":a[OF.Video_Send_Adaptation]=1;break;case"bandwidth":a[OF.Video_Send_Adaptation]=2;break;case"other":a[OF.Video_Send_Adaptation]=3}let s=0;r.adaptionChangeReason&&(s+=BF(r.adaptionChangeReason)),t.qualityLimitationReason&&(s+=BF(t.qualityLimitationReason)<<3),a[OF.Video_Send_Adaptation]=s,a[OF.Video_Send_Player_Status]=ik[n._player?n._player.videoElementStatus:"uninit"],VF(a,OF.Video_Send_Nacks,r.nacksCount),VF(a,OF.Video_Send_Plis,r.plisCount),VF(a,OF.Video_Send_Firs,r.firsCount),VF(a,OF.Video_Send_Avg_Encode,r.avgEncodeMs),VF(a,OF.Video_Send_Huge_Frame_Sent,r.hugeFramesSent),VF(a,OF.Video_Send_Bytes_Retransmit,r.retransmittedBytesSent),VF(a,OF.Video_Send_Packages_Retransmit,r.retransmittedPacketsSent),VF(a,OF.Video_Send_Key_Frames_Encoded,r.keyFramesEncoded);const c=i.videoSend.find(t=>t.ssrc===e);if(c){let e=jF*MF;c.timestamp&&r.timestamp&&(e=r.timestamp-c.timestamp),null!=c.packets&&null!=r.packets&&VF(a,OF.Video_Send_Package_Rate,1e3*(r.packets-c.packets)/e),null!=r.packetsLost&&null!=c.packetsLost&&VF(a,OF.Video_Send_Package_Lost,r.packetsLost-c.packetsLost),null!=c.bytes&&null!=r.bytes&&VF(a,OF.Video_Send_Bitrate,8*(r.bytes-c.bytes)/e)}}return a}(d[0].ssrcId,e,l,t,n),r="CameraVideoTrack"===l.__className__?3:Ps(u=l._hints).call(u,UO.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==r||i)&&(this.needUploadStats={sendType:r},this.lastExtendStats.sendType=r);const a=l&&function(e,t,n,s){const i=t.videoSend.find(t=>t.ssrc===e);if(!i)return null;const r={};if(s){const e=i.inputFrame,t=e&&e.height||n.videoHeight||0,s=e&&e.width||n.videoWidth||0,a=e&&e.frameRate||0;VF(r,OF.Video_Capture_Height,t),VF(r,OF.Video_Capture_Width,s),VF(r,OF.Video_Capture_Frame_Rate,a)}return r}(d[0].ssrcId,e,l,!!n),c=function(e,t){const n={};return t&&(VF(n,OF.Video_Send_Retransmit,e.bitrate.retransmit),VF(n,OF.Video_Send_Target_Encoded,e.bitrate.targetEncoded),VF(n,OF.Video_Send_Actual_Encoded,e.bitrate.actualEncoded),VF(n,OF.Video_Send_Transmit,e.bitrate.transmit),VF(n,OF.Video_Send_Bandwidth,e.sendBandwidth)),n}(e,!!n);o=Object.assign({},s,a,c)}else c=function(e,t,n,s){const i=t.videoSend.find(t=>t.ssrc===e);if(!i)return;const r={};if(s){const t=i.sentFrame;t&&(VF(r,OF.Video_Send_Low_Height,t.height),VF(r,OF.Video_Send_Low_Width,t.width),VF(r,OF.Video_Send_Low_Frame_Rate,t.frameRate));const n=s.videoSend.find(t=>t.ssrc===e);if(n){let e=jF*LF;n.timestamp&&i.timestamp&&(e=i.timestamp-n.timestamp),null!=n.packets&&null!=i.packets&&VF(r,OF.Video_Send_Low_Package_Rate,1e3*(i.packets-n.packets)/e),null!=i.packetsLost&&null!=n.packetsLost&&VF(r,OF.Video_Send_Low_Package_Lost,i.packetsLost-n.packetsLost),null!=n.bytes&&null!=i.bytes&&VF(r,OF.Video_Send_Low_Bitrate,8*(i.bytes-n.bytes)/e)}}return r}(d[0].ssrcId,e,0,n);break;case _M.LocalAudioTrack:a=l&&function(e,t,n,s,i){const r=t.audioSend.find(t=>t.ssrc===e);if(!r)return;const a={};if(i){a[OF.Audio_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0;const t=100*n._source.getAccurateVolumeLevel(),s=r.inputLevel;if(null!=s){const e=Math.ceil(50*Math.log10(100*s+1));VF(a,OF.Audio_Send_Level,e)}VF(a,OF.Audio_Capture_PCM_Level,t),VF(a,OF.Audio_Send_AEC_Return_Loss,r.aecReturnLoss),VF(a,OF.Audio_Send_AEC_Return_Loss_Enhancement,r.aecReturnLossEnhancement),VF(a,OF.Audio_Send_Bytes_Retransmit,r.retransmittedBytesSent),VF(a,OF.Audio_Send_Packages_Retransmit,r.retransmittedPacketsSent),a[OF.Audio_Send_Freeze]=0;const o=i.audioSend.find(t=>t.ssrc===e);if(o){let e=jF*LF;o.timestamp&&r.timestamp&&(e=r.timestamp-o.timestamp),null!=o.bytes&&null!=r.bytes&&VF(a,OF.Audio_Send_Bitrate,8*(r.bytes-o.bytes)/e),null!=o.packets&&null!=r.packets&&VF(a,OF.Audio_Send_Package_Rate,1e3*(r.packets-o.packets)/e)}}return a}(d[0].ssrcId,e,l,0,n)}}),{high:o,low:c,audio:a}}getInboundStats(e,t,n,s){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],r=[];return i.forEach(i=>{let[a,o]=i;const c={peer:a.uid};if(o.has(fM.VIDEO)&&a.videoTrack){const i=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,r=a.videoTrack?function(e,t,n,s,i,r,a,o){const c=t.videoRecv.find(t=>t.ssrc===e);if(!c)return;const l={},{receivedFrame:d,outputFrame:u,decodeFrameRate:h}=c;VF(l,kF.Video_Render_Frame_Rate_Decode,h),c.framesRateFirefox&&VF(l,kF.Video_Recv_Frame_Rate,c.framesRateFirefox),d&&VF(l,kF.Video_Recv_Frame_Rate,d.frameRate),VF(l,kF.Video_Recv_Frame_Dropped,c.framesDroppedCount),VF(l,kF.Video_Recv_Bytes_Retransmit,c.retransmittedBytesReceived),VF(l,kF.Video_Recv_Packages_Retransmit,c.retransmittedPacketsReceived),VF(l,kF.Video_Recv_Packages_Discarded,c.packetsDiscarded),VF(l,kF.Video_Recv_Avg_Decode,c.avgDecodeMs),VF(l,kF.Video_Recv_Avg_Processing_Delay,c.avgProcessingDelayMs),VF(l,kF.Video_Recv_Avg_Assembly_Time,c.avgFramesAssembledFromMultiplePacketsMs),VF(l,kF.Video_Recv_Avg_Inter_Frame_Delay,c.avgInterFrameDelayMs),VF(l,kF.Video_Recv_Key_Frames_Decoded,c.keyFramesDecoded);const p=o&&o.videoRecv.find(t=>t.ssrc===e);if(p){const e=t.timestamp-o.timestamp||jF;null!=c.packetsLost&&null!=p.packetsLost&&VF(l,kF.Video_Recv_Package_Lost,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&VF(l,kF.Video_Recv_Bitrate,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&VF(l,kF.Video_Recv_Package_Rate,1e3*(c.packets-p.packets)/e)}const m=r&&r.videoRecv.find(t=>t.ssrc===e);if(m&&(VF(l,AF.Video_Recv_Qp_Sum,c.qpSumPerFrame),l[AF.Video_Recv_Freeze]=s&&XV.isRemoteVideoFreeze(n,c,m)?1:0),a){var f;const t=a.videoRecv.find(t=>t.ssrc===e);d?(VF(l,OF.Video_Recv_Height,d.height),VF(l,OF.Video_Recv_Width,d.width)):n&&(VF(l,OF.Video_Recv_Height,n._videoHeight||0),VF(l,OF.Video_Recv_Width,n._videoWidth||0)),u&&VF(l,OF.Video_Recv_Frame_Rate_Output,u.frameRate);const s=null===(f=n._player)||void 0===f?void 0:f.rendFrameRate.toFixed(0);if(s&&VF(l,OF.Video_Render_Frame_Rate_Render,+s),VF(l,OF.Video_Recv_Jitter_Buffer,c.jitterBufferMs),VF(l,OF.Video_Recv_Current_Delay,c.currentDelayMs),VF(l,OF.Video_Recv_Firs,c.firsCount),VF(l,OF.Video_Recv_Nacks,c.nacksCount),VF(l,OF.Video_Recv_Plis,c.plisCount),n){l[OF.Video_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1;const e=n._player;if(e){const{freezeTimeCounterList:n,renderFreezeAccTime:s,renderFreezeAccTime2:r,videoElementStatus:a}=e;if(n&&n.length>0&&VF(l,AF.Video_Render_Freeze_Time,n.splice(0,1)[0]),i&&"visible"===ZP.visibility&&a===nk.PLAYING&&yO().supportRequestVideoFrameCallback){const t=Math.min(6e3,r);e.renderFreezeAccTime2=Math.max(0,r-t),VF(l,AF.Video_Render_Freeze_Time_Render2,t);const n=Math.min(6e3,s);e.renderFreezeAccTime=Math.max(0,s-n),VF(l,AF.Video_Render_Freeze_Time_Render,RA("USE_NEW_RENDER_FREEZE_TIME")?t:n)}if("number"==typeof c.totalFreezesDuration){const e=t&&t.totalFreezesDuration?c.totalFreezesDuration-t.totalFreezesDuration:c.totalFreezesDuration;VF(l,OF.Video_Render_Freeze_Duration,1e3*e)}}}if(l[OF.Video_Recv_Player_Status]=ik[n._player?n._player.videoElementStatus:"uninit"],t&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-t.totalInterFrameDelay,n=c.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,s=c.framesDecodeCount-t.framesDecodeCount,i=e/s*1e3,r=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/s)/s));!isNaN(r)&&i+r>Math.max(3*i,i+150)&&(l[OF.Video_Recv_I_Frame_Delay]=r)}}return l}(a._videoSSRC,e,a.videoTrack,!0===i,this.needUploadRenderFreezeTime,t,n,s):void 0;r&&(c.video=r)}if(o.has(fM.AUDIO)&&a.audioTrack){const i=a.audioTrack?function(e,t,n,s,i,r){const a=t.audioRecv.find(t=>t.ssrc===e);if(!a)return;const o={};VF(o,kF.Audio_Recv_Jitter,a.jitterMs),VF(o,kF.Audio_Recv_Bytes_Retransmit,a.retransmittedBytesReceived),VF(o,kF.Audio_Recv_Packages_Retransmit,a.retransmittedPacketsReceived),VF(o,kF.Audio_Recv_Packages_Discarded,a.packetsDiscarded),VF(o,kF.Audio_Recv_Avg_Processing_Delay,a.avgProcessingDelayMs);const c=r&&r.audioRecv.find(t=>t.ssrc===e);if(c){const e=jF;null!=a.packets&&null!=c.packets&&VF(o,kF.Audio_Recv_Package_Rate,1e3*(a.packets-c.packets)/e),null!=a.packetsLost&&null!=c.packetsLost&&VF(o,kF.Audio_Recv_Package_Lost,a.packetsLost-c.packetsLost)}if(s){const{receivedFrames:e,droppedFrames:t}=a;null!=e&&null!=t&&(o[AF.Audio_Recv_Freeze]=0===(l=e)||100*t/l>20?1:0)}var l;if(i){const t=100*n._source.getAccurateVolumeLevel(),s=a.outputLevel;if(null!=s){const e=Math.ceil(50*Math.log10(100*s+1));VF(o,OF.Audio_Render_Level,e)}VF(o,OF.Audio_Recv_PCM_Level,t),n&&(o[OF.Audio_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1),VF(o,OF.Audio_Recv_Jitter_Buffer,a.jitterBufferMs),VF(o,OF.Audio_Recv_Current_Delay,a.jitterBufferMs),o[OF.Audio_Recv_Player_Status]=ik[Uk.getPlayerState(n.getTrackId())];const r=i.audioRecv.find(t=>t.ssrc===e);if(r){null!=r.bytes&&null!=a.bytes&&VF(o,OF.Audio_Recv_Bitrate,8*(a.bytes-r.bytes)/(jF*MF));const e=a.concealedSamples-r.concealedSamples;e>0&&VF(o,OF.Audio_Recv_Concealed_Samples,e);const t=a.totalSamplesReceived-r.totalSamplesReceived;t>0&&VF(o,OF.Audio_Recv_Total_Samples_Received,t);const n=a.freezeSamples80-r.freezeSamples80;n>0&&VF(o,OF.Audio_Render_Freeze_Samples_80ms,n);const s=a.freezeSamples200-r.freezeSamples200;s>0&&VF(o,OF.Audio_Render_Freeze_Samples_200ms,s);const i=a.freezeMs80-r.freezeMs80;VF(o,OF.Audio_Render_Freeze_Time_80ms,i<0?0:i);const c=a.freezeMs200-r.freezeMs200;VF(o,OF.Audio_Render_Freeze_Time_200ms,c<0?0:c)}}return o}(a._audioSSRC,e,a.audioTrack,t,n,s):void 0;i&&(c.audio=i)}(c.video||c.audio)&&r.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,r}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(e=>e instanceof BD);if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(UL.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach(e=>{let[t,n]=e;n.has(fM.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}),n.has(fM.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const t=Date.now(),n={connectionInterval:RA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let s=[];const i=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of i)!e.muted&&e.enabled&&(s=s.concat(await e.getProcessorUsage()));const r=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of r)c.has(fM.VIDEO)&&e.videoTrack&&(s=s.concat(await e.videoTrack.getProcessorUsage())),c.has(fM.AUDIO)&&e.audioTrack&&(s=s.concat(await e.audioTrack.getProcessorUsage()));if(0===s.length)return;n.details=function(e,t){const n={};for(const{id:a,value:o,level:c,direction:l}of e){var s;const e=null!==(s=t.get(a))&&void 0!==s?s:0,d=2===o?e+RA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,r;t.set(a,d),n[a]?(2===o&&(n[a].value=o),c>n[a].level&&(n[a].level=c),"remote"===l&&(n[a].remoteUidCount+=1),n[a].totalTs=null!==(i=t.get(a))&&void 0!==i?i:0):n[a]={value:o,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(r=t.get(a))&&void 0!==r?r:0}}return Object.keys(n).map(e=>{const{level:t,value:s,totalTs:i}=n[e];return{id:e,level:t,value:s,totalTs:i}})}(s,e);const a=Date.now(),o=a>t?a:t+1;this.requestUpload&&this.requestUpload(UL.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:o})},RA("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const WF=RA("ICE_RESTART_INTERVAL");let HF=new Map,KF=new Map,zF=[gM.UDP_TCP_RELAY,gM.TCP_RELAY,gM.RELAY],qF=RA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&yO().supportPCSetConfiguration;function YF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=HF.get(e.id);n&&(window.clearTimeout(n),HF.delete(e.id));const s=KF.get(e.id);t&&s&&s.index===zF.length-1&&(aO.debug("[".concat(e.id,"] reset ICE restart policy")),KF.delete(e.id))}function XF(e,t,n){if(0===HF.size&&0===KF.size&&(Array.isArray(RA("RESTART_SEQUENCE"))&&RA("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const s=e[n];if(e.filter(e=>e===s).length!==t.filter(e=>e===s).length)return!1}return!0}(zF,RA("RESTART_SEQUENCE"))&&(zF=RA("RESTART_SEQUENCE").filter(e=>{var t;if(Ps(t=Object.values(gM)).call(t,e))return!0}),aO.debug("use reconnection policy from config distribution, queues: ".concat(zF.join(" => ")))),qF=RA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&yO().supportPCSetConfiguration),0===zF.length)return void n();let s,{index:i=0,type:r}=KF.get(e.id)||{};if(qF&&r===gM.RELAY)return void n();let a=r&&i>=zF.length-1;if(qF)r=gM.RELAY;else{if(a)return void n();r?(i++,r=zF[i]):(r=zF[0],i=0)}aO.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(r,", index: ").concat(i)),t(r),KF.set(e.id,{index:i,type:r}),s=window.setTimeout(()=>XF(e,t,n),WF),HF.set(e.id,s)}var JF;function QF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function ZF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QF(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $F(e){var t,n,s,i=2;for("undefined"!=typeof Symbol&&(n=ZT,s=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(s&&null!=(t=e[s]))return new eB(t.call(e));n="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function eB(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then(function(e){return{value:e,done:t}})}return eB=function(e){this.s=e,this.n=e.next},eB.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new eB(e)}let tB=(JF=class extends HR{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(bM.StateChange,t,this._state)}constructor(e,t){super(),uN(this,"isPlanB",void 0),uN(this,"store",void 0),uN(this,"statsUploader",void 0),uN(this,"connection",void 0),uN(this,"localTrackMap",new Map),uN(this,"remoteUserMap",new Map),uN(this,"localDataChannels",[]),uN(this,"remoteDataChannelMap",new Map),uN(this,"pendingLocalTracks",[]),uN(this,"pendingRemoteTracks",[]),uN(this,"pendingLocalDataChannels",[]),uN(this,"pendingRemoteDataChannels",[]),uN(this,"statsCollector",void 0),uN(this,"shouldForwardP2PCreation",void 0),uN(this,"iceFailedCount",0),uN(this,"dtlsFailedCount",0),uN(this,"mutex",void 0),uN(this,"_state",EM.Disconnected),uN(this,"_pcStatsUploadType",RA("NEW_ICE_RESTART")?yM.FIRST_CONNECTION:yM.OLD_FIRST_CONNECTION),uN(this,"_isStartRestartIce",!1),uN(this,"_restartTimer",void 0),uN(this,"_isTryConnecting",!1),uN(this,"_iceError",null),uN(this,"_forceTurn",!1),uN(this,"_isWaitPcToRePub",!1),uN(this,"handleMuteLocalTrack",async(e,t,n)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const s=this.filterTobeMutedTracks(e);if(0===s.length)return void t();const i=s.find(e=>"videoLowTrack"===e[0]);if(i){const e=i[1];this.store.enableInstantMuteRestore?(e.track._originMediaStreamTrack.enabled=!1,aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):e.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(s.map(e=>{let[,{id:t}]=e;return t}));const r=this.createMuteMessage(s);await aI(this,bM.RequestMuteLocal,r),t()}catch(e){n(e)}finally{s()}}),uN(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const s=this.filterTobeUnmutedTracks(e);if(0===s.length)return void t();const i=s.find(e=>"videoLowTrack"===e[0]);if(i){const t=i[1];if(this.store.enableInstantMuteRestore)t.track._originMediaStreamTrack.enabled=!0,aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(t.track._originMediaStreamTrack.stop(),!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=RF(e,cI(this,bM.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(s.map(e=>{let[,{id:t}]=e;return t}));const r=this.createUnmuteMessage(s);await aI(this,bM.RequestUnmuteLocal,r),t()}catch(e){n(e)}finally{s()}}),uN(this,"handleUpdateVideoEncoder",async(e,t,n,s)=>{let i;s||(i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:s,track:i}=n;await this.connection.updateSendParameters(s,i),await this.connection.updateEncoderConfig(s,i),this.emit(bM.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{var r;null===(r=i)||void 0===r||r()}}),uN(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:s,track:i}=n;await this.connection.updateSendParameters(s,i),t()}catch(e){n(e)}finally{s()}}),uN(this,"handleReplaceMixingTrack",async(e,t,n,s)=>{if(!this.connection||this.state!==EM.Connected)return void t();const i=vF([e]);let r;aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(i.getTrackId(),"]")),"boolean"==typeof s&&s||(r=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,i),t()}catch(e){n(e)}finally{var a;null===(a=r)||void 0===a||a()}}),uN(this,"handleReplaceTrack",async(e,t,n,s)=>{let i;aO.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof s&&s||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var r;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.connection||!n||this.state!==EM.Connected)return void t();if(await(null===(r=this.connection)||void 0===r?void 0:r.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===_M.LocalVideoTrack&&!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding){const t=this.localTrackMap.get(_M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}}),uN(this,"handleGetRTCStats",e=>{e(this.statsCollector.getRTCStats())}),uN(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uN(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uN(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uN(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(this.store),this.bindStatsUploaderEvents(),this.mutex=new UI("P2PChannel-mutex",this.store.clientId),this.isPlanB=!yO().supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&xR(),this.shouldForwardP2PCreation=RA("FORWARD_P2P_CREATION")&&yO().supportPCSetConfiguration&&bR(),this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=EM.New,this._forceTurn=xF(e),aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if((!this.shouldForwardP2PCreation||s||t)&&((s||t)&&this.connection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=EF(this.store,e),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=RA("NEW_ICE_RESTART")?yM.FIRST_CONNECTION:yM.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===EM.Connected){if(this.connection instanceof TF&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),mO.reportApiInvoke(this.store.sessionId,{name:qR.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:YR.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(bM.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EM.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(e=>{var t;let[n]=e;return Ps(t=[_M.LocalVideoLowTrack,_M.LocalVideoTrack]).call(t,n)}),n=t.map(e=>{let[,{id:t}]=e;return t}),s=t.map(e=>{let[t]=e;return t});if(this.connection instanceof TF){if(mO.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ps(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find(t=>Ps(e).call(e,t));t&&(this.store.codec=t,aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof TF&&"closed"!==this.connection.peerConnectionState&&Ps(e=[EM.New,EM.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==EM.Connected){if(this.state===EM.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(e=>{var t;Ps(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach(e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)}),e.map(e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId})))}publish(e,t,n){var s=this;return YT(function*(){const i=yield JT(s.mutex.lock("From P2PChannel.publish"));try{var r;const i=s.connection&&Ps(r=["disconnected","failed"]).call(r,s.connection.peerConnectionState);if(!s.connection||s.state!==EM.Connected||i){if(s.state===EM.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===s.pendingLocalTracks.indexOf(e));return s.pendingLocalTracks=s.pendingLocalTracks.concat(t),void(i&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,zV.markPublishStart(s.store.clientId,s.store.pubId);const a=s.filterTobePublishedTracks(e,t,n);if(0===a.length)return void(yield JT(s.tryToUnmuteAudio(e)));yield*QT($F(s.doPublish(s.connection,a)))}finally{i()}})()}doPublish(e,t){var n=this;return YT(function*(){t.forEach(e=>{let{track:t,type:s}=e;const i=Date.now();n.store.publish(t.getTrackId(),s===_M.LocalAudioTrack?"audio":"video",i)}),n.bindLocalTrackEvents(t);const s=t.map(e=>{let{track:t}=e;return t}),i=yield JT(e.send(s,n.store.codec,n.store.audioCodec)),r=(yield JT(i.next())).value,a=n.createGatewayPublishMessage(t,r);let o;try{o=yield a}catch(e){throw i.throw(e),(null==e?void 0:e.code)===RR.WS_ABORT&&t.forEach(e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)}),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(a,o,s),l=(yield JT(i.next(c))).value;if(n.state===EM.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");RA("ENABLE_VIDEO_SEI");const d=RA("ENABLE_ENCODED_TRANSFORM"),u=RA("ENABLE_AUDIO_METADATA");s.forEach(async e=>{const t=e.getRTCRtpTransceiver();if(!t||!d)return;const{interceptLocalVideoFrame:n,interceptLocalAudioFrame:s}=ZU();e.trackMediaType===fM.VIDEO?await n(t.sender,e):e.trackMediaType===fM.AUDIO&&await s(t.sender,{metadata:u?()=>{const t=e.metadata.shift();return t&&t.value}:void 0})}),t.forEach(e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)}),n.assignLocalTracks(t,l),n.statsUploader.startUploadOutboundStats(),t.forEach(e=>{let{track:t,type:s}=e;const i=Date.now();n.store.publish(t.getTrackId(),s===_M.LocalAudioTrack?"audio":"video",void 0,i)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof PP))return aO.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=dU(e,t)),n.maxFramerate=e.framerate?rU(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,s);if(s._encoderConfig||(s._encoderConfig={}),t!==_M.LocalVideoLowTrack||!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(s._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=s._originMediaStreamTrack;if(!t.canvas)return aO.warn("[".concat(s.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=rU(t.width)),t.height&&(n.height=rU(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=vk(()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()},rU(t.framerate)))}(t,e)}null!=i.maxBitrate&&(s._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(s._encoderConfig.frameRate&&"object"==typeof s._encoderConfig.frameRate?s._encoderConfig.frameRate.max=i.maxFramerate:s._encoderConfig.frameRate={max:i.maxFramerate}),aO.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(e){var t=this;return YT(function*(){if(!t.connection||t.state!==EM.Connected)return;const n=yield JT(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(_M.LocalVideoTrack);if(!n)throw new IR(RR.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(_M.LocalVideoLowTrack))throw new IR(RR.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:_M.LocalVideoLowTrack}];if(yield*QT($F(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var s;const e=null===(s=t.localTrackMap.get(_M.LocalVideoLowTrack))||void 0===s?void 0:s.id;void 0!==e&&(yield JT(t.connection.muteLocal([e])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rI(this,bM.RequestRePublish,this.pendingLocalTracks),this.emit(bM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(aO.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await rI(this,bM.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==fM.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==fM.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await rI(this,bM.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===fM.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(bM.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==EM.Connected)return void e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)});const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==EM.Connected)return void e.forEach(e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)});const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach(e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)}),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map(e=>e.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==EM.Connected)return;const e=this.localTrackMap.get(_M.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[_M.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==EM.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))});if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach(t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const s=this.pendingRemoteDataChannels.findIndex(n=>{let{user:s,id:i}=n;return s.uid===e.uid&&i===t.id});-1!==s&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(e=>e.id)}async subscribe(e,t,n,s,i){var r;if(!this.connection||this.state!==EM.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(r=this.remoteUserMap.get(e))&&void 0!==r&&r.has(t))return;let a,o,c,l;const d=this.connection.getPreMedia(n);if(d)aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=d.transceiver,a=d.track,o=d.mid,l=d.player,d.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:d.firstVideoRender});else if(i){const n=i.find(e=>{let{stream_type:n}=e;return n===t});if(!n)throw new IR(RR.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const s=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof TF&&(c=s.transceiver),a=s.track,o=s.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:s}],String(e._uintid),void 0);this.connection instanceof TF&&(c=i.transceiver),a=i.track,o=i.id}if(t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new QP(a,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new JP(a,e.uid,e._uintid,this.store,l),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(HO.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(HO.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),l?e._videoTrack.once(HO.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(HO.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&RA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:n,interceptRemoteAudioFrame:s}=ZU();t==fM.VIDEO?await n(c.receiver,{onSei:RA("ENABLE_VIDEO_SEI")&&(t=>{var n;return null===(n=e._videoTrack)||void 0===n?void 0:n._onSei(t)})}):t==fM.AUDIO&&await s(c.receiver,{enableTopn:!!RA("ENABLE_AUDIO_TOPN"),enableMetadata:!!RA("ENABLE_AUDIO_METADATA"),enablePts:!!RA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(bM.AudioMetadata,e)},onPts:e=>{this.safeEmit(bM.AudioPts,e)}})}const u=this.remoteUserMap.get(e);u?u.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const h=this.pendingRemoteTracks.findIndex(n=>{let{user:s,kind:i}=n;return s.uid===e.uid&&t===i});-1!==h&&(this.pendingRemoteTracks.splice(h,1),this.emit(bM.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==EM.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(e=>{var t;let{user:n,mediaType:s}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(s))});const t=[],n=new Map;e.forEach(e=>{if(!this.connection)return;const s=this.connection.getPreMedia(e.ssrcId);if(s){const{track:t,mid:i,transceiver:r,player:a}=s;n.set(e.ssrcId,{track:t,id:i,transceiver:r,player:a})}else t.push(e)});const s=await this.connection.batchReceive(t.map(e=>{let{user:t,mediaType:n,ssrcId:s,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:s,rtx:i}],mslabel:String(t._uintid)}}));t.forEach((e,t)=>{n.set(e.ssrcId,s[t])});for(const{user:i,mediaType:r,ssrcId:a}of e){const e=n.get(a);if(!e)return void aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(r,", ").concat(a));const{track:t,id:s,transceiver:o,player:c}=e;if(o&&RA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();r==fM.VIDEO?await e(o.receiver,{onSei:RA("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=i._videoTrack)||void 0===t?void 0:t._onSei(e)})}):r==fM.AUDIO&&await t(o.receiver,{enableTopn:!!RA("ENABLE_AUDIO_TOPN"),enableMetadata:!!RA("ENABLE_AUDIO_METADATA"),enablePts:!!RA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(bM.AudioMetadata,e)},onPts:e=>{this.safeEmit(bM.AudioPts,e)}})}if(r===fM.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(t):(i._audioTrack=new QP(t,i.uid,i._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),o&&i._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(t):(i._videoTrack=new JP(t,i.uid,i._uintid,this.store,c),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),o&&i._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(i,i._videoTrack)),RA("ENABLE_VIDEO_SEI")&&o){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();r==fM.VIDEO?await e(o.receiver,{onSei:e=>{var t;null===(t=i._videoTrack)||void 0===t||t._onSei(e)}}):r==fM.AUDIO&&await t(o.receiver)}const l=this.remoteUserMap.get(i);l?l.set(r,s):this.remoteUserMap.set(i,new Map([[r,s]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const d=this.pendingRemoteTracks.findIndex(e=>{let{user:t,kind:n}=e;return t.uid===i.uid&&r===n});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(bM.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const s=this.pendingRemoteTracks.filter(n=>{let{user:s,kind:i}=n;return void 0!==t?s.uid===e.uid&&t===i:s.uid===e.uid});if(s.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.connection&&this.state===EM.Connected||n||s.forEach(t=>{let{kind:n}=t;var s;if(n===fM.AUDIO)null===(s=e._audioTrack)||void 0===s||s._destroy(),e._audioTrack=void 0;else if(n===fM.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==EM.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map(e=>{let[,{id:t}]=e;return t}));const r=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach(e=>{let[t,{kind:s}]=e;var i,r;if(s===fM.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),s===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0);else if(s===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),r}async unsubscribeDataChannel(e,t){if(t.forEach(e=>{const t=this.pendingRemoteDataChannels.findIndex(t=>t.id===e.id);-1!==t&&this.pendingRemoteDataChannels.splice(t,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach(e=>{e._close()});const s=this.remoteDataChannelMap.get(e);return n.forEach(e=>{s&&s.delete(e.id)}),s&&0===s.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(e=>e.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:r}of e){const e=this.pendingRemoteTracks.filter(e=>{let{user:t,kind:n}=e;return void 0!==r?t.uid===i.uid&&r===n:t.uid===i.uid});e.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),t=t.concat(e)}if(!this.connection||this.state!==EM.Connected)return void t.forEach(e=>{let{user:t,kind:n}=e;var s;if(n===fM.AUDIO)null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0;else if(n===fM.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}});const n=ii(e).call(e,(e,t)=>{let{user:n,mediaType:s}=t;const i=this.filterTobeUnSubscribedTracks(n,s);return e.concat(i)},[]);if(0===n.length)return;await this.connection.stopReceiving(n.map(e=>{let[,{id:t}]=e;return t}));const s=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach(e=>{let[t,{kind:n}]=e;var s,i;if(n===fM.VIDEO&&t._videoSSRC&&(null===(s=this.connection)||void 0===s||s.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===fM.AUDIO){var r;this.unbindRemoteTrackEvents(t._audioTrack),null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0}}),s}isPreSubScribe(e){return!(!this.connection||this.state!==EM.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==s&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(_M.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(_M.LocalAudioTrack);if((null==t?void 0:t.track)instanceof WD){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==_M.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,s,i){if(e){const n=this.localTrackMap.get(_M.LocalAudioTrack),r=s?this.localTrackMap.get(_M.LocalVideoLowTrack):this.localTrackMap.get(_M.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==r?void 0:r.track.getTrackLabel(),screenshare:-1!==(null==r?void 0:r.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!n,video:!!r,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var r;n||(n=[]);const a=n.find(e=>e instanceof FD),o=s?null===(r=this.localTrackMap.get(_M.LocalVideoTrack))||void 0===r?void 0:r.track:n.find(e=>e instanceof PP);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,s){const i=s===fM.VIDEO?n._videoSSRC:n._audioSSRC;i&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===fM.VIDEO,audio:s===fM.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new UI("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(_M.LocalAudioTrack);if((null==e?void 0:e.track)instanceof WD){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=EM.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof PP||t&&t.track instanceof FD?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(_M.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.connection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=EM.Reconnecting,RA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=EF(this.store),this.emit(bM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:s}]=e;switch(n){case _M.LocalVideoTrack:Ps(t=s._hints).call(t,UO.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case _M.LocalAudioTrack:s instanceof WD?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case _M.LocalVideoLowTrack:}}),this.emit(bM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(bM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach(e=>{this.setPendingRemoteDataChannel(t,e)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:s,id:i}=n;if((e instanceof ZV?e.uid:e)===s.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:s,kind:i}=n;if((e instanceof ZV?e.uid:e)===s.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return YT(function*(){if(!t.connection||t.state!==EM.Connected)return;const n=yield JT(t.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield JT(t.connection.restartICE(e));const n=yield JT(s.next());if(n.done)return;const i=n.value,r=yield i;switch(bF(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case gM.UDP_TCP_RELAY:t._pcStatsUploadType=yM.UDP_TCP_RESTART;break;case gM.TCP_RELAY:t._pcStatsUploadType=yM.TCP_RESTART;break;case gM.RELAY:t._pcStatsUploadType=yM.RELAY_RESTART;break;default:t._pcStatsUploadType=yM.OLD_RESTART}t._isTryConnecting=!0,s.next(r)}catch(e){var i;null===(i=s)||void 0===i||i.throw(e)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalAudioTrack),s=e.videoSend.find(e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId));if(!s||!i)return 1;const r=oI(this,bM.NeedSignalRTT),a=s?s.rttMs:void 0,o=i?i.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&r?(c+r)/2:c||r)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return Gj[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[s]=n;const i=s._audioSSRC,r=s._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===i),o=e.videoRecv.find(e=>e.ssrc===r);if(!a&&!o)return void(t+=1);const c=oI(this,bM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(aO.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==EM.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!s)return;const i=s[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),s[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,s[1].id)),this.isPlanB){const e=s[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===_M.LocalVideoTrack&&!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding){const t=this.localTrackMap.get(_M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}}filterTobePublishedTracks(e,t,n){const s=[],i=this.getAllTracks();e=uI(e=e.filter(e=>-1===i.indexOf(e)));let r,a=!1;const o=this.localTrackMap.get(_M.LocalAudioTrack);for(const c of e){if(c instanceof PP&&(this.localTrackMap.has(_M.LocalVideoTrack)||a?new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:c,type:_M.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);s.push({track:e,type:_M.LocalVideoLowTrack})}if(c instanceof FD)if(o){const e=o.track;if(e instanceof WD)yF([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=vF([e,c]);aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else r instanceof WD?(yF([c]),r.addAudioTrack(c)):r=r||!c._useAudioElement&&yO().webAudioMediaStreamDest&&!c._bypassWebAudio?vF(r?[c,r]:[c]):c}return r&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(r.getTrackId(),"]")),s.push({track:r,type:_M.LocalAudioTrack})),s}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=uI(e=e.filter(e=>-1!==n.indexOf(e)));for(const s of e){if(s instanceof FD){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(!e)continue;e.track instanceof WD?(e.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),0===e.track.trackList.length&&(t.push([_M.LocalAudioTrack,e]),e.track.close())):t.push([_M.LocalAudioTrack,e])}if(s instanceof PP){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(!e)continue;t.push([_M.LocalVideoTrack,e]);const n=this.localTrackMap.get(_M.LocalVideoLowTrack);n&&t.push([_M.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=uI(e)).filter(e=>-1===this.localDataChannels.findIndex(t=>t.id===e.id))}filterTobeUnpublishedDataChannels(e){return(e=(e=uI(e)).filter(e=>-1!==this.localDataChannels.indexOf(e))).filter(e=>e._originDataChannel)}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof WD?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.GET_RTC_STATS,this.handleGetRTCStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof WD?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var s;let i,r,{track:a,type:o}=e;switch(o){case _M.LocalAudioTrack:i=sM.Audio,r={dtx:a instanceof BD&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case _M.LocalVideoTrack:i=Ps(s=a._hints).call(s,UO.SCREEN_TRACK)?sM.Screen:sM.High,r=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()});break;case _M.LocalVideoLowTrack:i=sM.Low,r=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()})}return{stream_type:i,attributes:r,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[s,{track:i,ssrcs:r,id:a}]=e;switch(s){case _M.LocalVideoTrack:n=Ps(t=i._hints).call(t,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalAudioTrack:n=sM.Audio;break;case _M.LocalVideoLowTrack:n=sM.Low}return{stream_type:n,ssrcs:r,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:s,type:i}=e;this.localTrackMap.set(i,{track:s,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(bM.PeerConnectionStateChange,t),"connecting"===t&&e instanceof TF&&!nR()&&RA("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{"connecting"===t&&e.extendCandidate()},RA("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof TF&&YF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=yM.DISCONNECTED_OR_FAILED,"CONNECTED"===oI(this,bM.QueryClientConnectionState)&&this._isWaitPcToRePub)){const e=this.pendingLocalTracks.map(e=>e.getTrackId()),t=this.pendingLocalDataChannels.map(e=>"dc_".concat(e.id));mO.reportApiInvoke(this.store.sessionId,{name:qR.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:YR.TRACER}).onSuccess(),this.republish()}if(RA("NEW_ICE_RESTART")&&e instanceof TF&&!nR()&&!this._forceTurn){if(Ps(vM).call(vM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{bF(e)&&(aO.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===oI(this,bM.QueryClientConnectionState)&&this.emit(bM.RequestRestartICE,t))},n=()=>{bF(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),aO.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{XF(e,t,n)},800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&RA("ICE_RESTART")&&"CONNECTED"===oI(this,bM.QueryClientConnectionState)&&this.emit(bM.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);"failed"===t&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(bM.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YR.TRACER}).onSuccess(),this.emit(bM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var s;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(s=n.audioTrack)||void 0===s||s.emit(HO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{var s;const i=Array.from(XA(s=this.remoteUserMap).call(s)).find(t=>t._videoSSRC===e);i&&this.store.firstVideoFrameDecoded(i.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoRender=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(n))},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstReceived:Date.now()}),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,s="relay"===t.candidateType;"unknown"!==t.candidateType&&n===s||this.emit(bM.ConnectionTypeChange,n),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return ZF(ZF({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){e instanceof TF&&function(e){KF.delete(e.id),YF(e)}(e),e.close(),this.emit(bM.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof FD&&(null==n?void 0:n.track)instanceof WD)return n.track.isActive||t.push([_M.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(s&&(t.push(s),s[0]===_M.LocalVideoTrack)){const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof FD&&(null==n?void 0:n.track)instanceof WD)return n.track.isActive&&t.push([_M.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(s)if(s[0]===_M.LocalVideoTrack){t.push(s);const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}else t.push(s);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[s,{track:i,ssrcs:r,id:a}]=e;switch(s){case _M.LocalAudioTrack:n=sM.Audio;break;case _M.LocalVideoTrack:n=Ps(t=i._hints).call(t,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalVideoLowTrack:n=sM.Low}return{stream_type:n,ssrcs:r,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[s,{track:i,ssrcs:r,id:a}]=e;switch(s){case _M.LocalAudioTrack:n=sM.Audio;break;case _M.LocalVideoTrack:n=Ps(t=i._hints).call(t,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalVideoLowTrack:n=sM.Low}return{stream_type:n,ssrcs:r,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],s=this.remoteUserMap.get(e);if(!s)return n;if(t){const i=s.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(s.entries()).forEach(t=>{let[s,i]=t;n.push([e,{kind:s,id:i}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(t=>{var s;null!==(s=this.remoteDataChannelMap.get(e))&&void 0!==s&&s.has(t.id)&&n.push(t)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:s,id:i}]=e;switch(s){case fM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:n._videoSSRC}));case fM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(e=>{let[n,{kind:s}]=e;if(t.has(n)){let e=t.get(n);s===fM.VIDEO?e|=aM.Video:e|=aM.Audio,t.set(n,e)}else s===fM.VIDEO?t.set(n,aM.Video):t.set(n,aM.Audio)}),{users:Array.from(t.entries()).map(e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}})}}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const s=this.remoteUserMap.get(t);s&&(s.delete(n),0===Array.from(s.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)}))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}isPreallocation(){return this.connection instanceof TF&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof TF&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((e,s)=>{var i;let{stream_type:r}=e;const a=null===(i=t.find(e=>{let{stream_type:t}=e;return r===t}))||void 0===i?void 0:i.attributes;if(a&&RA("DISABLE_SCREEN_SHARE_REMB")){const e=n[s]._hints;(Ps(e).call(e,UO.SCREEN_TRACK)||Ps(e).call(e,UO.SCREEN_LOW_TRACK))&&(a.remb=!1,aO.debug("disable remb for screen share, hints:",e))}return a})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof FD){var t;const s=this.filterTobeUnmutedTracks(e[n]);if(0===s.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(s.map(e=>{let[,{id:t}]=e;return t})));const i=this.createUnmuteMessage(s);return void await aI(this,bM.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(bM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(bM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await SI(BI(this.dtlsFailedCount,FI)),this.emit(bM.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await rI(this,bM.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(bM.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(_M.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof PP)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof PP).length>1)throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof FD).length>1&&(e.some(e=>e instanceof FD&&e._bypassWebAudio)||!yO().webAudioMediaStreamDest))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof PP&&this.pendingLocalTracks.some(e=>e instanceof PP))throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof FD&&this.pendingLocalTracks.some(e=>e instanceof FD)&&(!yO().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof FD&&e._bypassWebAudio)))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const s=!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding,i=ZF(ZF({},{width:160,height:120,framerate:15,bitrate:50}),t);let r;r=s?e._mediaStreamTrack.clone():RF(e,i);const a=NI(8,"track-low-"),o=new PP(r,ZF(ZF({},s&&{scaleResolutionDownBy:dU(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return o.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),o._hints.push(UO.LOW_STREAM),Ps(n=e._hints).call(n,UO.SCREEN_TRACK)&&o._hints.push(UO.SCREEN_LOW_TRACK),e.on("sei-to-send",e=>{o.emit("sei-to-send",e)}),e.addListener(MO.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof TF){var i,r,a,o;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();mO.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(r=h.candidateType)&&void 0!==r?r:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(o=p.candidateType)&&void 0!==o?o:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(t=>t.userId===e.uid);if(!n)return;const{isInternalUpload:s,isExternalUpload:i}=n;if(s&&i)return;const{subscribeEnd:r,firstPreRender:a,peerPublishDuration:o,peerPubStatusMs:c}=n;let{firstRender:l=0}=n;if(r&&(l||a)&&o&&c){n.isInternalUpload=!0;const{playEnd:s}=n;s&&(n.isExternalUpload=!0);const{firstPreRender:i=0}=n;l=i||l;const a=e.videoTrack,d={peer:e._uintid,width:(null==a?void 0:a._videoWidth)||0,height:(null==a?void 0:a._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:o,peerPubStatusMs:c,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:i||0,firstRender:s?Math.max(l,s):Math.max(l,r),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:bO(this.store)};mO.firstXLAPeerFirstVideoFrame(this.store.sessionId,d)}}reportVideoFirstFrameDecoded(e,t,n,s){var i;const r=Array.from(XA(i=this.remoteUserMap).call(i)).find(t=>t._videoSSRC===e);if(r){s||this.store.subscribe(r.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find(e=>e.userId===r.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:r._uintid,videowidth:t,videoheight:n,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:s?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const i=s.get(t);if(!i)return!1;const r=await this.connection.getRemoteSSRC(i);return void 0!==r&&r!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===_M.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VO.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},IL(JF.prototype,"startP2PConnection",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"startP2PConnection"),JF.prototype),IL(JF.prototype,"connect",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"connect"),JF.prototype),IL(JF.prototype,"updateRemoteRTPCapabilities",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"updateRemoteRTPCapabilities"),JF.prototype),IL(JF.prototype,"publishDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"publishDataChannel"),JF.prototype),IL(JF.prototype,"unpublish",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublish"),JF.prototype),IL(JF.prototype,"unpublishDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishDataChannel"),JF.prototype),IL(JF.prototype,"unpublishLowStream",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishLowStream"),JF.prototype),IL(JF.prototype,"subscribeDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribeDataChannel"),JF.prototype),IL(JF.prototype,"subscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribe"),JF.prototype),IL(JF.prototype,"massSubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"massSubscribe"),JF.prototype),IL(JF.prototype,"unsubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribe"),JF.prototype),IL(JF.prototype,"unsubscribeDataChannel",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribeDataChannel"),JF.prototype),IL(JF.prototype,"massUnsubscribe",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"massUnsubscribe"),JF.prototype),IL(JF.prototype,"muteRemote",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"muteRemote"),JF.prototype),IL(JF.prototype,"unmuteRemote",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"unmuteRemote"),JF.prototype),IL(JF.prototype,"hasRemoteMediaWithLock",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"hasRemoteMediaWithLock"),JF.prototype),IL(JF.prototype,"disconnectForReconnect",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"disconnectForReconnect"),JF.prototype),IL(JF.prototype,"updateBitrateLimit",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"updateBitrateLimit"),JF.prototype),IL(JF.prototype,"remoteMediaSsrcChanged",[nB],Object.getOwnPropertyDescriptor(JF.prototype,"remoteMediaSsrcChanged"),JF.prototype),JF);function nB(e,t,n){const s=e[t];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return await s.apply(this,r)}finally{n()}},n}function sB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function iB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sB(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const rB=Date.now(),aB=20,oB=new Map,cB=new Map;async function lB(e){const t=oB.get(e),n=Array.isArray(t)&&t[t.length-1],s=cB.get(e);if(!n)return void(s.isSyncing=!1);const i={uid:n.uid,payload:n.payload};0===s.firstRecvTs&&(s.firstRecvTs=n.recvTs,s.firstSendTs=n.sendTs);const r=n.sendTs-s.firstSendTs,a=r-(Date.now()-s.firstRecvTs);a>0&&(s.firstRecvTs=Date.now()-r);let o=n.mediaDelay+a;o<=0?(t.pop(),dB(n.context,i),o=0):o=Math.min(o,aB),setTimeout(()=>t.length&&lB(e),o)}function dB(e,t){e.safeEmit(tI.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function uB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return dB(n,{uid:e.uid,payload:e.payload});const s="".concat(n.id,"-").concat(e.uid),i=oB.get(s)||[],r=i.findIndex(t=>e.sendTs>=t.sendTs),a=iB(iB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===r?i.push(a):i.splice(r,0,a),oB.set(s,i);let o=!1;var c;cB.has(s)?o=!(null===(c=cB.get(s))||void 0===c||!c.isSyncing):cB.set(s,{isSyncing:o,firstRecvTs:0,firstSendTs:0}),o||lB(s)}const hB=qC().name;function pB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function mB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pB(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const fB="websdk_ng_cache_parameter",gB=RA("MAX_PRELOAD_ASYNC_LENGTH"),yB=1e4,vB=new Map,_B=[];let EB=null,bB=0,xB=0;const wB=new Map,SB=function(e,t){const n=[];let s=0;const i=async()=>{const e=n.shift();e&&await e(),n.length>0&&s<t?i():s--};return async function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return new np(async(r,o)=>{n.push(async()=>{try{const t=await e(...a);r(t)}catch(e){o(e)}}),s<t&&(s++,i())})}}(TB,gB),NB=LC.CancelToken.source();async function TB(e,t,n,s,i,r){try{if(!RA("ENABLE_PRELOAD"))return;if(!yO().supportWebCrypto)return void gI(()=>{aO.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&null!==n)throw new IR(RR.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&PR(n,"token",1,2047),PR(e,"appid",1,2047),GL(t),s&&WL(s);const a=TI();aO.debug("preload channel ".concat(t,", uid is ").concat(s));const o={appId:e,cname:t,token:n||e,uid:"string"!=typeof s?s:null,sid:a,proxyServer:i};let c,l;"string"==typeof s?(o.stringUid=s,[l,c]=await np.all([jV(s,{sid:a,appId:e},NB.token),MV(mB(mB({},o),{},{token:n||e,uid:0}),NB.token)]),o.uid=l.uid,c.gatewayInfo.uid=o.uid,c.gatewayInfo.res.uid=o.uid):(r&&(o.stringUid=r),c=await MV(o,NB.token));const d={sid:a,appId:e,cname:t,token:n||e,uid:o.stringUid||s,intUid:o.uid||c.gatewayInfo.uid,stringUid:o.stringUid,ts:Date.now(),sua:l,ap:c};await async function(e){let t;try{e.uid&&RB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=PB(e),s=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",_I(t),"AES-GCM",!1,["encrypt"]),s=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,yI(window.btoa(JSON.stringify(e))));return vI(new Uint8Array(s))}catch(e){return}}(e,e.token||e.appId);if(!s)return;t=kB(fB);const i=t?JSON.parse(t):[];i.push({[n]:s}),i.length>RA("AP_CACHE_NUM")&&i.shift(),DB(fB,JSON.stringify(i))}catch(e){aO.warn("Error caching server parameters:",e.message),DB(fB,"")}}(d),bB++}catch(e){throw xB++,function(e){EB||(EB=window.setTimeout(()=>{let t="";wB.forEach((e,n)=>{t+="".concat(n,": ").concat(e," ;")}),mO.reportApiInvoke(null,{name:qR.PRELOAD,options:{success:bB,failed:xB,err:t}}).onError(e),bB=0,xB=0,wB.clear(),EB=null},yB));const t=wB.get(e.code)||0;wB.set(e.code,t+1)}(e),e}}async function CB(e){try{if(RA("AP_REQUEST_DETAIL")||RA("ENABLE_ROLE_SELECT_EDGE"))return;const t=RB(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",_I(t),"AES-GCM",!1,["decrypt"]),s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,yI(e));return JSON.parse(window.atob(vI(new Uint8Array(s))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<RA("AP_CACHE_LIFETIME"))return n}catch(e){aO.warn("Error get preloadInfo",e.message)}}function RB(e){let t;try{if(t=kB(fB),!t)return;const n=JSON.parse(t),s=PB(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,e=>s in e);if(-1===i)return;const r=n.splice(i,1)[0];return DB(fB,JSON.stringify(n)),r[s]}catch(e){aO.warn("Error delete preload info: ".concat(t),e.message),DB(fB,"")}}function IB(e){if(e){let t=vB.get(e);t&&(window.clearTimeout(t),t=null,vB.delete(e)),Ps(_B).call(_B,e)||"disabled"!==e.cloudProxyServer||_B.push(e)}if(vB.size<RA("AP_CACHE_NUM")&&_B.length>0){const e=_B.shift();vB.set(e,window.setTimeout(async()=>{const{appId:t,cname:n,token:s,stringUid:i,uid:r,proxyServer:a}=e;try{await SB(t,n,s,r,a,i),vB.has(e)&&IB(e)}catch(t){aO.warn("update preload failed",t.message),AB(e)}},RA("AP_UPDATE_INTERVAL")))}}function AB(e){const t=_B.indexOf(e);-1!==t&&_B.splice(t,1);let n=vB.get(e);n&&(window.clearTimeout(n),n=null,vB.delete(e),IB())}function OB(e,t){const n=e.sua,s=e.ap;t&&n&&mO.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),mO.reportResourceTiming(e.ap.url,e.sid),mO.joinWebProxyAP(e.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(e=>e.ip).join(","),eventType:"disabled",unilbsServerIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK].toString()}),mO.joinChooseServer(e.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function kB(e){return window.atob(window.localStorage.getItem(e)||"")}function DB(e,t){window.localStorage.setItem(e,window.btoa(t))}function PB(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),jI(t)}function jB(e){let t=function(){const e=VB.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(JB(t,10),zB(t,n));let s=e.cid;void 0!==s&&(JB(t,16),JB(t,s));let i=e.cname;void 0!==i&&(JB(t,26),zB(t,i));let r=e.deviceId;void 0!==r&&(JB(t,34),zB(t,r));let a=e.elapse;void 0!==a&&(JB(t,40),ZB(t,a));let o=e.fileSize;void 0!==o&&(JB(t,48),ZB(t,UB(o)));let c=e.height;void 0!==c&&(JB(t,56),ZB(t,UB(c)));let l=e.jpg;void 0!==l&&(JB(t,66),JB(t,l.length),HB(t,l));let d=e.networkType;void 0!==d&&(JB(t,72),ZB(t,UB(d)));let u=e.osType;void 0!==u&&(JB(t,80),ZB(t,UB(u)));let h=e.requestId;void 0!==h&&(JB(t,90),zB(t,h));let p=e.sdkVersion;void 0!==p&&(JB(t,98),zB(t,p));let m=e.sequence;void 0!==m&&(JB(t,104),ZB(t,UB(m)));let f=e.sid;void 0!==f&&(JB(t,114),zB(t,f));let g=e.timestamp;void 0!==g&&(JB(t,120),ZB(t,g));let y=e.uid;void 0!==y&&(JB(t,128),JB(t,y));let v=e.vid;void 0!==v&&(JB(t,136),JB(t,v));let _=e.width;void 0!==_&&(JB(t,144),ZB(t,UB(_)));let E=e.service;void 0!==E&&(JB(t,152),JB(t,E));let b=e.callbackData;void 0!==b&&(JB(t,162),JB(t,b.length),HB(t,b));let x=e.ticket;void 0!==x&&(JB(t,170),zB(t,x));let w=e.vendorConfigs;void 0!==w&&(JB(t,178),zB(t,w))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function LB(e){return function(e){let t={};e:for(;!BB(e);){let n=XB(e);switch(n>>>3){case 0:break e;case 1:t.code=XB(e);break;case 2:t.msg=KB(e,XB(e));break;case 3:t.requestId=KB(e,XB(e));break;case 4:t.timestamp=QB(e,!1);break;default:MB(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function MB(e,t){switch(t){case 0:for(;128&qB(e););break;case 2:FB(e,XB(e));break;case 5:FB(e,4);break;case 1:FB(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function UB(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let VB=[];function FB(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function BB(e){return e.offset>=e.limit}function GB(e,t){let n=e.bytes,s=e.offset,i=e.limit,r=s+t;if(r>n.length){let t=new Uint8Array(2*r);t.set(n),e.bytes=t}return e.offset=r,r>i&&(e.limit=r),s}function WB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function HB(e,t){let n=GB(e,t.length);e.bytes.set(t,n)}function KB(e,t){let n=WB(e,t),s=String.fromCharCode,i=e.bytes,r="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=i[o+n];0==(128&u)?a+=s(u):192==(224&u)?o+1>=t?a+=r:(e=i[o+n+1],128!=(192&e)?a+=r:(d=(31&u)<<6|63&e,d<128?a+=r:(a+=s(d),o++))):224==(240&u)?o+2>=t?a+=r:(e=i[o+n+1],c=i[o+n+2],32896!=(49344&(e|c<<8))?a+=r:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=r:(a+=s(d),o+=2))):240==(248&u)?o+3>=t?a+=r:(e=i[o+n+1],c=i[o+n+2],l=i[o+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=r:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=r:(d-=65536,a+=s(55296+(d>>10),56320+(1023&d)),o+=3))):a+=r}return a}function zB(e,t){let n=t.length,s=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),s+=e<128?1:e<2048?2:e<65536?3:4}JB(e,s);let i=GB(e,s),r=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?r[i++]=e:(e<2048?r[i++]=e>>6&31|192:(e<65536?r[i++]=e>>12&15|224:(r[i++]=e>>18&7|240,r[i++]=e>>12&63|128),r[i++]=e>>6&63|128),r[i++]=63&e|128)}}function qB(e){return e.bytes[WB(e,1)]}function YB(e,t){let n=GB(e,1);e.bytes[n]=t}function XB(e){let t,n=0,s=0;do{t=qB(e),n<32&&(s|=(127&t)<<n),n+=7}while(128&t);return s}function JB(e,t){for(t>>>=0;t>=128;)YB(e,127&t|128),t>>>=7;YB(e,t)}function QB(e,t){let n,s=0,i=0,r=0;return n=qB(e),s=127&n,128&n&&(n=qB(e),s|=(127&n)<<7,128&n&&(n=qB(e),s|=(127&n)<<14,128&n&&(n=qB(e),s|=(127&n)<<21,128&n&&(n=qB(e),i=127&n,128&n&&(n=qB(e),i|=(127&n)<<7,128&n&&(n=qB(e),i|=(127&n)<<14,128&n&&(n=qB(e),i|=(127&n)<<21,128&n&&(n=qB(e),r=127&n,128&n&&(n=qB(e),r|=(127&n)<<7))))))))),{low:s|i<<28,high:i>>>4|r<<24,unsigned:t}}function ZB(e,t){let n=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,r=0===i?0===s?n<16384?n<128?1:2:n<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:i<128?9:10,a=GB(e,r),o=e.bytes;switch(r){case 10:o[a+9]=i>>>7&1;case 9:o[a+8]=9!==r?128|i:127&i;case 8:o[a+7]=8!==r?s>>>21|128:s>>>21&127;case 7:o[a+6]=7!==r?s>>>14|128:s>>>14&127;case 6:o[a+5]=6!==r?s>>>7|128:s>>>7&127;case 5:o[a+4]=5!==r?128|s:127&s;case 4:o[a+3]=4!==r?n>>>21|128:n>>>21&127;case 3:o[a+2]=3!==r?n>>>14|128:n>>>14&127;case 2:o[a+1]=2!==r?n>>>7|128:n>>>7&127;case 1:o[a]=1!==r?128|n:127&n}}const $B={},eG={},tG=4294967296,nG=tG*tG,sG=nG/2,iG=lG(0,!0),rG=lG(0),aG=dG(0,-2147483648,!1),oG=dG(-1,2147483647,!1),cG=dG(-1,-1,!0);function lG(e,t){let n,s,i;return t?(i=0<=(e>>>=0)&&e<256)&&(s=eG[e],s)?s:(n=dG(e,0,!0),i&&(eG[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(s=$B[e],s)?s:(n=dG(e,e<0?-1:0,!1),i&&($B[e]=n),n)}function dG(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function uG(e,t){if(isNaN(e))return t?iG:rG;if(t){if(e<0)return iG;if(e>=nG)return cG}else{if(e<=-sG)return aG;if(e+1>=sG)return oG}return e<0?t?iG:rG:dG(e%tG|0,e/tG|0,t)}function hG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}class pG extends HR{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(RM.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),uN(this,"name","AgoraRTCImageModeration"),uN(this,"_connectionState",CM.CONNECTING),uN(this,"_sequence",0),uN(this,"_moderationStartTime",void 0),uN(this,"_workerConnection",void 0),uN(this,"_workerMessageLengthLimit",void 0),uN(this,"_qualityRatio",void 0),uN(this,"_connectInfo",void 0),uN(this,"_cancelTokenSource",LC.CancelToken.source()),uN(this,"_retryConfig",void 0),uN(this,"_moderationInterval",void 0),uN(this,"_moderationTimer",null),uN(this,"_moderationMode",1),uN(this,"_quality",1),uN(this,"_qualityTimer",null),uN(this,"_ticket",void 0),uN(this,"_moderationIntervalMinimum",void 0),uN(this,"_uploadFailedNum",0),uN(this,"_uploadNum",0),uN(this,"_uploadTimer",null),uN(this,"_extraInfo",void 0),uN(this,"_vendor",""),uN(this,"_encoder",new TextEncoder),uN(this,"_moderationId",void 0),uN(this,"inspectImage",()=>{if(this.connectionState!==CM.CONNECTED)throw new fO(RR.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===CM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=NI(5,"image-moderation-"),this._workerMessageLengthLimit=RA("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=RA("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=RA("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new JM("worker-"+this._moderationId,FI),this.on(RM.STATE_CHANGE,(e,t)=>{aO.debug("[".concat(this._moderationId,"] Moderation operation :").concat(IM[e]," ").concat(t||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(RM.STATE_CHANGE,IM.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np((s,i)=>{this.on(RM.CONNECTION_STATE_CHANGE,(e,t)=>{e===CM.CONNECTED&&s()}),this.requestAP(e,n,t).then(e=>{this.connectWorker(e)}).catch(e=>{i(e)})})}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),aO.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===CM.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const s=RA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),i=await function(e,t,n,s){let{appId:i,areaCode:r,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="moderation_plugin",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:r,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,appToken:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GI(async()=>{h=Date.now();const e=await rV(m,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers.some(e=>!!e.wss)){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const s=RA("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(s,":").concat(n,"/moderation")}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}},(t,n)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==RR.OPERATION_ABORTED&&t.code!==RR.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)),s)}(s,e,t,n);this.emit(RM.STATE_CHANGE,IM.AP_CONNECTED);const{addressList:r,ticket:a}=i;return this._ticket=a,r}async connectWorker(e){this.emit(RM.STATE_CHANGE,IM.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(BL.CONNECTED,async()=>{this.emit(RM.STATE_CHANGE,IM.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=CM.CONNECTED}),this._workerConnection.on(BL.CLOSED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(BL.FAILED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(BL.RECONNECTING,()=>{this.connectionState=this.connectionState===CM.CONNECTED?CM.RECONNECTING:CM.CONNECTING}),this._workerConnection.on(BL.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const t=LB(new Uint8Array(e.data));RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,aO.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{mO.reportApiInvoke(this._connectInfo.sid||null,{name:qR.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:YR.TRACER}).onError(new fO(RR.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},RA("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else aO.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(BL.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this._workerConnection.on(BL.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=oI(this,RM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:s,cid:i,vid:r,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await Qk(l,n,s),u=this._sequence+"-"+i+"-"+o+"-"+c+"-"+NI(12,""),h={appId:n,cid:i,cname:s,deviceId:"",elapse:pG.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this._sequence,sid:a,timestamp:uG(c),uid:o,vid:r,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=jB(h);if(p.byteLength<this._workerMessageLengthLimit){if(RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hG(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:s,cid:i,vid:r,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=LC.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=CM.CLOSED,this.emit(RM.STATE_CHANGE,IM.CLOSED)}}function mG(e){if(kR(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(RR.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new fO(RR.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fG={name:"ImageModeration",create:function(e){let{config:t}=e;return mG(t),new pG(t)}};var gG,yG,vG,_G,EG,bG,xG,wG,SG,NG,TG,CG,RG,IG,AG,OG,kG,DG,PG,jG,LG,MG,UG,VG,FG,BG,GG,WG,HG,KG,zG,qG,YG,XG,JG,QG,ZG,$G,eW,tW,nW,sW;function iW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function rW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iW(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}UI.setLogger(aO);let aW=(gG=pO(),yG=pO({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof uk))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),vG=pO({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==KO.DATA?(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())):[t.getChannelId()])}),_G=pO({argsMap:(e,t,n,s)=>["object"==typeof t?t.uid:t,n,s]}),EG=pO({argsMap:(e,t,n)=>[t,n]}),bG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]})}),xG=pO({argsMap:(e,t,n,s)=>["object"==typeof t?t.uid:t,n,s]}),wG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}})}),SG=pO(),NG=pO(),TG=pO(),CG=pO(),RG=pO(),IG=pO(),AG=pO(),OG=pO(),kG=pO(),DG=pO(),PG=pO(),jG=pO(),LG=pO(),MG=pO(),UG=pO(),VG=pO({argsMap:(e,t)=>[t]}),FG=pO(),BG=pO(),GG=pO(),WG=pO(),HG=pO(),KG=pO(),zG=pO(),qG=pO(),YG=pO({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),XG=pO(),JG=pO(),QG=pO(),ZG=pO(),$G=pO(),eW=pO(),tW=pO({reportResult:!0}),nW=pO(),sW=class extends HR{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),uN(this,"store",void 0),uN(this,"_uid",void 0),uN(this,"_channelName",void 0),uN(this,"_uintUid",void 0),uN(this,"_users",[]),uN(this,"_config",void 0),uN(this,"_clientId",void 0),uN(this,"_appId",void 0),uN(this,"_sessionId",null),uN(this,"_key",void 0),uN(this,"_rtmConfig",{}),uN(this,"_joinInfo",void 0),uN(this,"_gateway",void 0),uN(this,"_statsCollector",void 0),uN(this,"_configDistribute",void 0),uN(this,"_leaveMutex",void 0),uN(this,"_publishMutex",void 0),uN(this,"_renewTokenMutex",void 0),uN(this,"_subscribeMutex",void 0),uN(this,"_encryptionMode","none"),uN(this,"_encryptionSecret",null),uN(this,"_encryptionSalt",null),uN(this,"_encryptDataStream",!1),uN(this,"_encryptDataStreamKey",null),uN(this,"_encryptDataStreamIv",null),uN(this,"_proxyServer",void 0),uN(this,"_turnServer",{servers:[],mode:"auto"}),uN(this,"_cloudProxyServerMode","disabled"),uN(this,"_isDualStreamEnabled",!1),uN(this,"_defaultStreamFallbackType",void 0),uN(this,"_lowStreamParameter",void 0),uN(this,"_streamFallbackTypeCacheMap",new Map),uN(this,"_remoteStreamTypeCacheMap",new Map),uN(this,"_axiosCancelSource",LC.CancelToken.source()),uN(this,"_audioVolumeIndicationInterval",void 0),uN(this,"_networkQualityInterval",void 0),uN(this,"_userOfflineTimeout",void 0),uN(this,"_streamRemovedTimeout",void 0),uN(this,"_liveTranscodeStreamingClient",void 0),uN(this,"_liveRawStreamingClient",void 0),uN(this,"_channelMediaRelayClient",void 0),uN(this,"_networkQualitySensitivity","normal"),uN(this,"_p2pChannel",void 0),uN(this,"_useLocalAccessPoint",!1),uN(this,"_setLocalAPVersion",void 0),uN(this,"_joinAndNotLeaveYet",!1),uN(this,"_numberOfJoinCount",0),uN(this,"_joinResponse",null),uN(this,"_remoteDefaultVideoStreamType",void 0),uN(this,"_inspect",void 0),uN(this,"_moderation",void 0),uN(this,"_license",void 0),uN(this,"_pendingPublishedUsers",[]),uN(this,"ntpAlignErrorCount",0),uN(this,"remoteInboundOffset",0),uN(this,"_peerConnectionState",void 0),uN(this,"_handleLocalTrackEnable",(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),uN(this,"_handleLocalTrackDisable",(e,t,n)=>{this.unpublish(e).then(t).catch(n)}),uN(this,"_handleUserOnline",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&Kj(e.uid,this.channelName))return void aO.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&aO.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find(t=>t.uid===e.uid);if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(tI.USER_JOINED,t));else{const t=new ZV(e.uid,e.uint_id||e.uid);this._users.push(t),aO.debug("[".concat(this._clientId,"] user online"),e.uid),this.store.firstVideoFrameDecoded(t.uid,{userJoinNotify:Date.now()}),this.safeEmit(tI.USER_JOINED,t)}}),uN(this,"_handleUserOffline",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&Kj(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:dI(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),aO.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(tI.USER_LEAVED,t,e.reason))}),uN(this,"_handleAddAudioOrVideoStream",(e,t,n,s,i,r,a,o)=>{if(RA("BLOCK_LOCAL_CLIENT")&&Kj(t,this.channelName))return;const c=this._users.find(e=>e.uid===t);if(!c)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now()),"video"===e&&this.store.firstVideoFrameDecoded(c.uid,{videoAddNotify:Date.now()});const l="audio"===e?c.hasAudio:c.hasVideo;if(c._uintid||(c._uintid=r||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==n&&(c._audioSSRC=n),void 0!==s&&(c._cname=s),a&&(c._audioOrtc=a)):(c._video_added_=!0,void 0!==n&&(c._videoSSRC=n),void 0!==s&&(c._cname=s),void 0!==o&&(c._rtxSsrcId=o),a&&(c._videoOrtc=a)),("audio"===e?c.hasAudio:c.hasVideo)&&!l&&(aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(e)),this.safeEmit(tI.USER_PUBLISHED,c,e)),"video"===e?mO.onGatewayStream(this._sessionId,dO.ON_ADD_VIDEO_STREAM,uO.ON_ADD_VIDEO_STREAM,{peer:r||t,ssrc:c._videoSSRC}):mO.onGatewayStream(this._sessionId,dO.ON_ADD_AUDIO_STREAM,uO.ON_ADD_AUDIO_STREAM,{peer:r||t,ssrc:c._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(c,e,n).then(t=>{if(t&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tB))return this._p2pChannel.unsubscribe(c,e,!0).then(()=>this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(c,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})),"video"===e&&!$C()&&!sR()){const e=this._getEncodingName(i);(null==e?void 0:e.toLocaleLowerCase())==kA.av1&&OV().then(t=>{t||this._gateway.downgradeCodec(e)})}}),uN(this,"_handleRemoveStream",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&Kj(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);if(!t)return void aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));aO.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"audio"),aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof tB&&this._p2pChannel.unsubscribe(t).then(e=>{if(e)return this._gateway.unsubscribe(e,t.uid)}),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),mO.onGatewayStream(this._sessionId,dO.ON_REMOVE_STREAM,uO.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()}),uN(this,"_handleSetStreamLocalEnable",(e,t,n)=>{if(RA("BLOCK_LOCAL_CLIENT")&&Kj(t,this.channelName))return;const s=this._users.find(e=>e.uid===t);if(!s)return void aO.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));aO.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?s.hasAudio:s.hasVideo;if("audio"===e){s._trust_audio_enabled_state_=!0;const e=s._audio_enabled_;if(s._audio_enabled_=n,s._audio_enabled_===e)return;{const e=s._audio_enabled_?"enable-local-audio":"disable-local-audio";aO.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tI.USER_INFO_UPDATED,t,e)}}else{s._trust_video_enabled_state_=!0;const e=s._video_enabled_;if(s._video_enabled_=n,s._video_enabled_===e)return;{const e=s._video_enabled_?"enable-local-video":"disable-local-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tI.USER_INFO_UPDATED,t,e)}}const r="audio"===e?s.hasAudio:s.hasVideo;return i!==r?!i&&r?(aO.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(tI.USER_PUBLISHED,s,e)):("video"===e&&s._videoTrack&&s._videoTrack._destroy(),"audio"===e&&s._audioTrack,this._p2pChannel.muteRemote(s,e),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(tI.USER_UNPUBLISHED,s,e)):void 0}),uN(this,"_handleMuteStream",(e,t,n)=>{if(RA("BLOCK_LOCAL_CLIENT")&&Kj(e,this.channelName))return;aO.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const s=this._users.find(t=>t.uid===e);if(!s)return void aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?s.hasAudio:s.hasVideo;if("audio"===t){s._trust_audio_mute_state_=!0;const t=s._audio_muted_;if(s._audio_muted_=n,s._audio_muted_===t)return;{const t=s._audio_muted_?"mute-audio":"unmute-audio";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tI.USER_INFO_UPDATED,e,t)}}else{s._trust_video_mute_state_=!0;const t=s._video_muted_;if(s._video_muted_=n,s._video_muted_===t)return;{const t=s._video_muted_?"mute-video":"unmute-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tI.USER_INFO_UPDATED,e,t)}}const r="audio"===t?s.hasAudio:s.hasVideo;if(i!==r){if(!i&&r)return("audio"===t?s._audioSSRC:s._videoSSRC)?(aO.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(tI.USER_PUBLISHED,s,t)):void aO.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&s._videoTrack&&!s._video_pre_subscribed&&s._videoTrack._destroy(),"audio"===t&&s._audioTrack,this._p2pChannel.muteRemote(s,t),aO.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(tI.USER_UNPUBLISHED,s,t)}}),uN(this,"_handleP2PLost",async e=>{aO.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():aO.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)}),uN(this,"_handleTokenWillExpire",()=>{aO.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(tI.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),uN(this,"_handleBeforeUnload",e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),aO.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),uN(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(tI.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(tI.NETWORK_QUALITY,e)}),uN(this,"_handleP2PAddAudioOrVideoStream",(e,t,n,s)=>{const i=this._users.find(e=>e.uid===t);if(!i)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());const r="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==s&&(i._audioMid=s)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==s&&(i._videoMid=s)),("audio"===e?i.hasAudio:i.hasVideo)&&!r&&(aO.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(tI.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._config=e,this._clientId=t||NI(5,"client-"),this.store=new class{constructor(e,t,n,s){NR(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:EA.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case OA.SET_SESSION_ID:return CR(CR({},e),{},{sessionId:t.sessionId});case OA.SET_P2P_ID:return CR(CR({},e),{},{p2pId:t.p2pId});case OA.SET_UID:return CR(CR({},e),{},{uid:t.uid});case OA.SET_INT_UID:return CR(CR({},e),{},{intUid:t.intUid});case OA.SET_PUB_ID:return CR(CR({},e),{},{pubId:t.pubId});case OA.KEY_METRIC_CLIENT_CREATED:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{clientCreated:t.metric})});case OA.KEY_METRIC_JOIN_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinStart:t.metric})});case OA.KEY_METRIC_PRELOAD_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{preloadStart:t.metric})});case OA.KEY_METRIC_PRELOAD_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{preloadEnd:t.metric})});case OA.KEY_METRIC_JOIN_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinEnd:t.metric})});case OA.KEY_METRIC_REQUEST_AP_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestAPStart:t.metric})});case OA.KEY_METRIC_REQUEST_AP_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestAPEnd:t.metric})});case OA.KEY_METRIC_REQUEST_SUA_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestSUAEnd:t.metric})});case OA.KEY_METRIC_BEFORE_CONNECT:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{beforeConnect:t.metric})});case OA.KEY_METRIC_PEER_RECEIVER:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerReceiver:t.metric})});case OA.KEY_METRIC_SIGNAL_CONNECTED:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{signalConnected:t.metric})});case OA.KEY_METRIC_JOIN_REQ:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinReq:t.metric})});case OA.KEY_METRIC_JOIN_REP:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinRep:t.metric})});case OA.KEY_METRIC_JOIN_GATEWAY_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case OA.KEY_METRIC_JOIN_GATEWAY_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case OA.KEY_METRIC_PEER_CONNECTION_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case OA.KEY_METRIC_PEER_CONNECTION_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case OA.KEY_METRIC_DESCRIPTION_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{descriptionStart:t.metric})});case OA.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case OA.KEY_METRIC_ICE_CONNECTION_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case OA.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,s=n.findIndex(e=>e.trackId===t.metric.trackId);return-1!==s?(n[s]=CR(CR({},n[s]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{publish:[...n]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case OA.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,s=n.findIndex(e=>e.userId===t.metric.userId&&e.type===t.metric.type);return-1!==s?(n[s]=CR(CR({},n[s]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{subscribe:[...n]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case OA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const n=e.keyMetrics.firstVideoFrameDecoded,s=n.findIndex(e=>e.userId===t.metric.userId);return-1!==s?(n[s]=CR(CR({},n[s]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{firstVideoFrameDecoded:[...n]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{firstVideoFrameDecoded:[...e.keyMetrics.firstVideoFrameDecoded,t.metric]})})}case OA.RESET_FIRST_VIDEO_FRAME_DECODED:return e.keyMetrics.firstVideoFrameDecoded=[],e;case OA.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case OA.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=CR(CR({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case OA.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case OA.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},e;case OA.SET_USE_P2P:return CR(CR({},e),{},{useP2P:t.val});case OA.SET_TRANSPORT_TYPE:return CR(CR({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set autoSubscribe(e){this.state.autoSubscribe=e}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(e){this.state.enableInstantMuteRestore=e}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(e){this.dispatch({type:OA.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:OA.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:OA.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:OA.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:OA.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:OA.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:OA.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:OA.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:OA.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:OA.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:OA.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:OA.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:OA.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:OA.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:OA.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:OA.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:OA.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:OA.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:OA.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:OA.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:OA.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:OA.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:OA.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:OA.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:OA.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:OA.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(e,t){this.dispatch({type:OA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:CR({userId:e},t)})}descriptionStart(){this.dispatch({type:OA.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:OA.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:OA.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,s){this.dispatch({type:OA.KEY_METRIC_PUBLISH,metric:CR(CR({trackId:e,type:t},n&&{publishStart:n}),s&&{publishEnd:s})})}subscribe(e,t,n,s,i,r,a){this.dispatch({type:OA.KEY_METRIC_SUBSCRIBE,metric:CR(CR(CR(CR(CR({userId:e,type:t},n&&{subscribeStart:n}),s&&{subscribeEnd:s}),i&&{firstFrame:i}),r&&{streamAdded:r}),a&&{firstDecoded:a})})}massSubscribe(e,t,n,s){e.forEach(e=>{this.dispatch({type:OA.KEY_METRIC_SUBSCRIBE,metric:CR(CR(CR({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map(e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof t?(this.dispatch({type:OA.RECORD_JOIN_CHANNEL_SERVICE,record:CR(CR({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:OA.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:OA.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:OA.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:OA.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new UI("client-leave",this._clientId),this._publishMutex=new UI("client-publish",this._clientId),this._renewTokenMutex=new UI("client-renewtoken",this._clientId),this._subscribeMutex=new UI("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),aO.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(vA," build: ").concat(SA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{eI(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(e){aO.warning("[".concat(this._clientId,"] ").concat(e.toString()))}var s;this._statsCollector=new XV(this.store),this._statsCollector.onStatsException=(e,t,n)=>{aO.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),e===KV.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(e=>{e instanceof jP&&RA("ENABLE_ENCODE_EXCEPTION")&&e.findClosestProfile()}),this.safeEmit(tI.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,s)=>{const i=this._users.find(t=>t.uid===e);i&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(i._uintid,{peerPublishDuration:n,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(i)),mO.peerPublishStatus(this._sessionId,{subscribeElapse:s,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid}))},this._statsCollector.onVideoCodecChanged=e=>{if(RA("VIDEO_STANDARD_BITRATE_VERSION")&&("av1"===e||"h265"===e||"h264"===e)){const t=this.localTracks.find(e=>e instanceof PP);t&&1!==t._saveEncodeBitrateRatio&&t.setSaveEncodeBitrateRatio("h264"===e?RA("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P="p2p"===e.mode,this._gateway=new nV(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||FI,httpRetryConfig:e.httpRetryConfig||FI,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new WV(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},JU("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new tB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,s,i){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];CA("JOIN_GATEWAY_USE_443PORT_ONLY",r),CA("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const o=this._gateway.signal.websocket;return o instanceof XM&&(o.use443PortOnly=r,o.tryDoubleDomain=a),async function(e,t,n){VC.get(e)||VC.set(e,[]),FC.get(e)||FC.set(e,t),BC.get(e)||BC.set(e,0);const s=VC.get(e),i=FC.get(e);if(!s||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(BC.get(e)===i){const e=UC();s.push(e),await e.promise}BC.set(e,BC.get(e)+1);for(var r=arguments.length,a=new Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];const c=await n(...a);return BC.set(e,BC.get(e)-1),BC.get(e)===i-1&&s.length>0&&(s[0].resolve(),s.shift()),0===BC.get(e)&&(VC.set(e,[]),FC.set(e,0),BC.set(e,0)),c}("client.join",RA("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,s,i)}async join(e,t,n,s,i){const r=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const a="HTTPS"===(WI||WI||(WI=(window.location.protocol.split(":")[0]||"").toUpperCase(),WI)),o=XI()?window.isSecureContext:"Browser Not Support";if(!XI()&&!a||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";aO.warning(e)}let c;mO.setAppId(e);try{if(!n&&null!==n)throw new fO(RR.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&PR(n,"token",1,2047),PR(e,"appid",1,2047),GL(t),s&&WL(s),i)if("string"==typeof i)PR(i,"optionalInfo",1,256),c=i;else{if("object"!=typeof i)throw new fO(RR.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:e,enableInstantMuteRestore:t}=i;e&&(AR(e,"autoSubscribe"),aO.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(e)),this.store.autoSubscribe=e),t&&(AR(t,"enableInstantMuteRestore"),aO.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(t)),this.store.enableInstantMuteRestore=t)}}}catch(i){throw mO.reportApiInvoke(TI(),{name:qR.JOIN,options:[e,t,n,s],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}).onError(i),i}if(this._leaveMutex.isLocked&&(aO.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),aO.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const i=new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw mO.reportApiInvoke(TI(),{name:qR.JOIN,options:[e,t,n,s],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}).onError(i),i}this._gateway.state="CONNECTING",this.store.preloadStart();const l=await CB({appId:e,cname:t,uid:s,stringUid:"string"==typeof s?s:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const d=(null==l?void 0:l.sid)||TI();aO.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(r)),this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId);const u=mO.reportApiInvoke(d,{id:this._clientId,name:qR.JOIN,options:[e,t,n,s],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}),h=rW(rW(rW({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof s?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!l},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:RA("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(h.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof s&&(h.stringUid=s,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(h.aesmode=this._encryptionMode,h.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),s=BR(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,s);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(h.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=RA("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(h.appId+this._encryptionSecret+this._encryptionSecret):e.encode(h.appId+h.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const s=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,r=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:jA,hash:"SHA-256",salt:n},s,i+PA);return new Uint8Array(r).subarray(i/8)}(this._encryptionMode,t,yI(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const s=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:jA,hash:"SHA-256",salt:n},s,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,yI(this._encryptionSalt))}else o?aO.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):aO.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,aO.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:h.stringUid});const p=this._sessionId;setTimeout(()=>{"CONNECTING"===this.connectionState&&p===this._sessionId&&mO.joinChannelTimeout(this._sessionId,5)},5e3);try{var m;let s;const i=h.cloudProxyServer;if(Ps(m=["proxy3","proxy4","proxy5"]).call(m,i)){const e=RA("PROXY_SERVER_TYPE3");Array.isArray(e)?h.proxyServer=e[0]:h.proxyServer=e}if(mO.setProxyServer(h.proxyServer),aO.setProxyServer(h.proxyServer),this.store.requestAPStart(),l){if(aO.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(h.stringUid?", ".concat(h.stringUid," => ").concat(l.intUid):""," ")),h.stringUid&&!h.uid&&(h.uid=l.intUid),s={gatewayInfo:l.ap.gatewayInfo},RA("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===h.turnServer.mode)if(0===l.ap.proxyInfo.addresses.length)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await lU(l.ap.proxyInfo,l.ap.gatewayInfo.uid)).map(e=>({turnServerURL:e.address,tcpport:e.tcpport||bA.tcpport,udpport:e.udpport||bA.udpport,username:e.username||bA.username,password:e.password||bA.password,forceturn:!1,security:!0}));h.turnServer={mode:"manual",servers:e}}OB(l,h.stringUid)}else{if(h.stringUid&&!h.uid){let e;[e,s]=await np.all([PV(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,this.store).finally(()=>{this.store.requestSUAEnd()}),DV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),aO.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(h.stringUid," => ").concat(e)),h.uid=e,s.gatewayInfo.uid=e,s.gatewayInfo.res.uid=e}else s=await DV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,!0,this.store);if(!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(uM.UPDATE_BITRATE_LIMIT,e=>{this._p2pChannel.updateBitrateLimit(e)}),this._configDistribute.on(uM.UPDATE_CLIENT_ROLE_OPTIONS,e=>{this._setClientRoleOptions(e)})},0),this._key=n||e;const r=s.gatewayInfo,a=h.uid?h.uid:r.uid;this._joinInfo=rW(rW({},h),{},{cid:r.cid,uid:a,vid:r.vid,apResponse:r.res,apGatewayAddress:r.apGatewayAddress,uni_lbs_ip:r.uni_lbs_ip,gatewayAddrs:r.gatewayAddrs}),this.store.intUid=a,this.store.cid=r.cid;const o=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(o),this._appId=e,this._channelName=h.cname,this._uid=o,this.store.uid=o,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const c=h.stringUid?"string uid: ".concat(h.stringUid,",uid: ").concat(h.uid):"uid: ".concat(this._uid);return aO.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(c)),setTimeout(()=>{aO.startUpload()},5e3),this.store.joinEnd(),f=this,Ps(Wj).call(Wj,f)||Wj.push(f),"disabled"===this._cloudProxyServerMode&&yO().supportWebCrypto&&RA("ENABLE_PRELOAD")&&IB(this._joinInfo),o}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===RR.OPERATION_ABORTED?aO.warning("[".concat(this._clientId,"] join number: ").concat(r,", Joining channel failed, rollback"),t):aO.error("[".concat(this._clientId,"] join number: ").concat(r,", Joining channel failed, rollback"),t),t.code!==RR.OPERATION_ABORTED&&this._numberOfJoinCount===r&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(t),t}var f}_joinGateway(){if(!this._joinInfo||!this._key)throw new fO(RR.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!RA("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){aO.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=Wj.indexOf(e);-1!==t&&Wj.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return aO.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,QR.LEAVE),aO.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof uk))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new fO(RR.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new fO(RR.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof uk))throw new fO(RR.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new fO(RR.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}aO.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(e=>{const t=this._configDistribute.getBitrateLimit();e instanceof PP&&t&&e.setBitrateLimit(t.uplink)});try{await this._publishHighStream(n),aO.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))))}catch(e){throw aO.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{s()}}async _publishDataChannel(e){if(null==e)throw new fO(RR.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));kR(e.id,"id",0,65535,!0),AR(e.ordered,"ordered"),PR(e.metadata,"metadata",0,512),aO.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex(t=>t.id===e.id))throw new fO(RR.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&RA("FORCE_TURN")&&!RA("TURN_ENABLE_TCP")&&!RA("TURN_ENABLE_UDP"))throw new fO(RR.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return QU(e,!1)}(e),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if("number"!=typeof t._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new fO(RR.CREATE_DATACHANNEL_ERROR);try{await np.all(n.map(e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0))),await t._waitTillOpen()}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw e}}return aO.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw aO.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof uk))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);aO.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(e=>"".concat(e.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(AM.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),aO.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(e=>"".concat(e.getTrackId()))))}}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),aO.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(e=>"".concat(e.id," "))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),aO.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(e=>"".concat(e.id))))}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(OR(t,"mediaType",["audio","video"]),this.store.useP2P)throw new fO(RR.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===fM.AUDIO,s=t===fM.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:i,ortc:r,rtxSsrcId:a,cname:o,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new fO(RR.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(t=>t.uid===e);l||(l=new ZV(e,c||e),l._is_pre_created=!0,this._users.push(l)),o&&(l._cname=o),l._uintid||(l._uintid=c||e),n&&(l._audioSSRC=i,l._audio_pre_subscribed=!0,r&&(l._audioOrtc=r)),s&&(l._videoSSRC=i,l._video_pre_subscribed=!0,r&&(l._videoOrtc=r),null!=a&&(l._rtxSsrcId=a)),aO.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(l,t,i,a,r);const d=n?l._audioTrack:l._videoTrack;if(!d)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),s&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),d}catch(t){throw aO.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{i()}}async _subscribeDataChannel(e,t){var n;if(kR(t,"channelId",0,65535,!0),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const s=this._users.find(t=>t===e);if(!s)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new fO(RR.INVALID_REMOTE_USER,"user is not published");const i=null===(n=e._dataChannels)||void 0===n?void 0:n.find(e=>e.id===t);if(!i)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);const r=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[i]);if(n&&Ps(n).call(n,i.id))try{var a;if("number"!=typeof i._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new fO(RR.CREATE_DATACHANNEL_ERROR);const t={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(a=i.metadata)&&void 0!==a?a:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await i._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==RR.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),t;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{r()}}async _p2pSubscribe(e,t,n){if(OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const s=this._users.find(t=>t===e);if(!s){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(RR.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const i=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,s="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,n,s)}catch(e){throw e}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const s=this._users.find(t=>t===e);if(!s){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(RR.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:i};"video"===t&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const c=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const s="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==s&&s!==i&&(i=s,r="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:i}),zV.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,r);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,o,!0)}catch(n){if((null==n?void 0:n.code)!==RR.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const s="audio"===t?e._audioTrack:e._videoTrack;if(!s)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user object");return"video"===t&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),s}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(jR(e,"subscribeList"),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,s=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; ")));const i=(e=[...e]).map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}}),r=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){const s=e[t],{user:r,mediaType:a}=s;if(OR(a,"mediaType",["audio","video"]),!r){const e=new fO(RR.INVALID_PARAMS,"user property does not exist in subscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const o=this._users.find(e=>e===r);if(!o){const n=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");aO.error("[".concat(this._clientId,"] can not massSubscribe ").concat(r.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===a&&(!r.hasAudio||void 0===r._audioSSRC)||"video"===a&&(!r.hasVideo||void 0===r._videoSSRC)){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);aO.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(a,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const c=aM.Video|aM.LwoVideo,l=n.get(r);if(l){if("video"===a?l&c:l&aM.Audio){e.splice(t,1),aO.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(r.uid,", mediaType:").concat(a," twice"));continue}n.set(r,l|("video"===a?c:aM.Audio))}else n.set(r,"video"===a?c:aM.Audio)}for(let t=e.length-1;t>=0;t--){const s=e[t],{user:i,mediaType:r}=s,a=aM.Video|aM.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,r)){await this._p2pChannel.unmuteRemoteNoLock(i,r);const s=n.get(i);n.set(i,"video"===r?s^a:s^aM.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map(e=>({userId:e.user.uid,type:e.mediaType})),t);let s=ii(a=Array.from(n.entries())).call(a,(e,t)=>{let[n,s]=t;if(0===s)return e;const i={stream_id:n.uid,stream_type:s};return s&aM.Audio&&(i.audio_ssrc=n._audioSSRC),s&aM.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===fM.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===fM.VIDEO?t._rtxSsrcId:void 0}}));const n=new Map;if(s=s.filter(e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc),s.length>0){const e=await this._gateway.subscribeAll(s,!0);((null==e?void 0:e.users)||[]).forEach(e=>{let{stream_id:t,video_error_code:s,audio_error_code:i,error_code:r}=e;(s||i||r)&&n.set(t,{video_error_code:s,audio_error_code:i,error_code:r})})}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach(t=>{let[n,s]=t;const i=this.remoteUsers.find(e=>e.uid===n);if(i){let t;s.error_code||s.video_error_code&&s.audio_error_code?t=void 0:s.video_error_code?t=fM.VIDEO:s.audio_error_code&&(t=fM.AUDIO),e.push({user:i,mediaType:t})}}),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=MM(n);aO.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new fO(RR.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter(e=>!e.error).map(e=>({userId:e.user.uid,type:e.mediaType})),void 0,Date.now()),i.forEach(e=>{var n;mO.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===fM.VIDEO,audio:e.mediaType===fM.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===fM.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)}),aO.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{r(),s()}}async unsubscribe(e,t,n){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const s=this._users.find(t=>t===e);if(!s){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&dI(this._users,e),aO.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===RR.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&kR(t,"id",0,65535,!0),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find(t=>t===e);if(!n){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let s;if("number"==typeof t){const n=e._dataChannels.find(e=>e.id===t);n&&(s=[n])}else s=e._dataChannels;if(void 0===s){const n=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s.map(e=>e.id)));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,s);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),aO.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===RR.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(jR(e,"unsubscribeList"),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");aO.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:s,mediaType:i}=e[n];if(!s){const e=new fO(RR.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}OR(i,"mediaType",["video","audio",void 0]);const r=this._users.find(e=>e===s);if(!r){aO.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),e.splice(n,1);continue}const a=aM.Video|aM.LwoVideo;if(t.has(s)){const r=t.get(s);let o;switch(i){case"video":o=r&a;break;case"audio":o=r&aM.Audio;break;default:o=r&(aM.Audio|a)}if(o){aO.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(s,r|aM.Audio):"video"===i&&t.set(s,r|a):t.set(s,r|aM.Audio|a)}else i?"audio"===i?t.set(s,aM.Audio):"video"===i&&t.set(s,a):t.set(s,aM.Audio|a)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),aO.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join()))}catch(e){if(e.code===RR.DISCONNECT_P2P)return void aO.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw aO.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new IR(RR.INVALID_PARAMS);LR(e.width)||DR(e.width,"streamParameter.width"),LR(e.height)||DR(e.height,"streamParameter.height"),LR(e.framerate)||DR(e.framerate,"streamParameter.framerate"),LR(e.bitrate)||kR(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&aO.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),aO.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,_M.LocalVideoLowTrack)}async enableDualStream(){if(!yO().supportDualStream)throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new fO(RR.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new fO(RR.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),aO.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(_M.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),aO.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){OR(e,"role",["audience","host"])}(e),t&&eI(t),"rtc"===this.mode||"p2p"===this.mode)throw aO.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new fO(RR.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new fO(RR.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new fO(RR.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&RA("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",nI.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),aO.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode)return;if("audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&eI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{aO.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(PR(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,mO.setProxyServer(this._proxyServer),aO.setProxyServer(this._proxyServer),aO.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy")}if(ZR(e))return this._turnServer={servers:e,mode:"original-manual"},void aO.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(e=>e.urls).join(","),"."));e.forEach(e=>$R(e)),this._turnServer={servers:e,mode:"manual"},aO.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"you should set license before join channel");if(PR(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new fO(RR.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,aO.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new fO(RR.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new fO(RR.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Stop proxy server after leave channel");mO.setProxyServer(),aO.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new fO(RR.INVALID_PARAMS,"accessPoints is required.");jR(e.accessPoints.serverList,"accessPoints.serverList"),PR(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{kR(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(RR.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");RA("CLOSE_AFB_FOR_LOCAL_AP")&&(CA("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),CA("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,r=e.accessPoints.serverList.map(e=>s.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e),a=r.map(e=>"".concat(e,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,CA("WEBCS_DOMAIN",a),CA("WEBCS_DOMAIN_BACKUP_LIST",a),CA("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(jR(e.report.hostname,"report.hostname"),CA("EVENT_REPORT_DOMAIN",e.report.hostname[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(CA("EVENT_REPORT_DOMAIN",r[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]));let o=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),o=e.report.port),CA("STATS_COLLECTOR_PORT",o),e.report?CA("ENABLE_EVENT_REPORT",!0):CA("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(jR(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=r[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),CA("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(jR(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=r;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),CA("CDS_AP",d.map(e=>"".concat(e,":").concat(u))),e.cds?CA("ENABLE_CONFIG_DISTRIBUTE",!0):CA("ENABLE_CONFIG_DISTRIBUTE",!1),aO.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(jR(e,"serverList"),PR(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(RR.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,CA("WEBCS_DOMAIN",e),CA("WEBCS_DOMAIN_BACKUP_LIST",e),CA("GATEWAY_DOMAINS",[t]),CA("EVENT_REPORT_DOMAIN",e[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),CA("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),aO.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(OR(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw aO.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else aO.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){OR(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const t=this._users.find(t=>t.uid===e);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(e){throw aO.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){OR(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,s){!function(e){OR(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),PR(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Ps(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new fO(RR.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new fO(RR.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(AR(s,"encryptDataStream"),!Ps(i).call(i,e))throw new fO(RR.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||aO.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=vI(n))}async renewToken(e){if(PR(e,"token",1,2047),!this._key||!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(RA("USE_NEW_TOKEN")){aO.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await FV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FI);aO.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else aO.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});aO.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,aO.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?aO.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(tI.VOLUME_INDICATOR,e)},RA("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new fO(RR.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new fO(RR.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new fO(RR.LIVE_STREAMING_TASK_CONFLICT);const n=t?HL.TRANSCODE:HL.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(HL.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(e));if(!t.length)throw new fO(RR.INVALID_PARAMS,"can not find live streaming url to stop");await np.all(t.map(t=>t&&t.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof tB&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ps(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(s=!0,e.payload=await async function(e,t,n){var s;const i=ii(s=Array.from(n)).call(s,(e,t)=>e+t,0),r={serverTs:0,seq:MA++,length:n.length,checkSum:i},a=new Uint8Array(kI(i,2)),o=new ArrayBuffer(LA),c=new DataView(o);c.setUint32(0,r.serverTs),c.setUint16(4,r.seq),c.setUint16(6,r.length),c.setUint16(8,r.checkSum);const l=16-n.length%16;n=EI(n,new Uint8Array(l));const d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:DA,additionalData:a},t,n);return EI(new Uint8Array(o),new Uint8Array(d))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new fO(RR.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ML.DATA_STREAM,{payload:vI(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-rB},!n)}sendMetadata(e){if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new fO(RR.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ML.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vI(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(cO),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send custom report, not joined");await mO.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(RA("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(e=>e.uid+"");Object.keys(e).forEach(n=>{Ps(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){OR(t.spatialLayer,"spatialLayer",[0,1,2,3]),OR(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(AR(t,"apRTM"),kR(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,aO.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(aO.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Hj.indexOf(e);-1!==t&&Hj.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=LC.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&AB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&mO.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(e=>e._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new UI("client-publish",this._clientId),this._subscribeMutex=new UI("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const s=e||TI();e?aO.debug("[".concat(this._clientId,"] new Session ").concat(s)):aO.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const i=e?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,mO.addSid(s);const r={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};mO.sessionInit(this._sessionId,rW({cname:t.channel,appid:t.appId},r)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&RA("FORCE_TURN")&&!RA("TURN_ENABLE_TCP")&&!RA("TURN_ENABLE_UDP"))throw new fO(RR.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");aO.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(AM.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await n.next()).value;if(s){var t;let i;try{i=await this._gateway.publish(this._uid,s,!0)}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof PP&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch(e=>{aO.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===RR.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));aO.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let s;try{s=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==RR.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=s)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===RR.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new fO(RR.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},JU("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qR.ON_LIVE_STREAM_ERROR,options:[e,t],tag:YR.TRACER}).onSuccess(),this.safeEmit(tI.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qR.ON_LIVE_STREAM_WARNING,options:[e,t],tag:YR.TRACER}).onSuccess(),this.safeEmit(tI.LIVE_STREAMING_WARNING,e,t)},e.on(JL.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new fO(RR.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,s){const i=RA("UAP_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"));return await vV(i,e,t,n,s)})(e,this._joinInfo,this._axiosCancelSource.token,FI).then(t).catch(n)}),e};return e===HL.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new fO(RR.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),s=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},JU("ChannelMediaRelay").create(e));s.on("state",e=>{e===tM.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(tI.CHANNEL_MEDIA_RELAY_STATE,e)}),s.on("event",e=>{this.safeEmit(tI.CHANNEL_MEDIA_RELAY_EVENT,e)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:s}=e,i=[];if(t){const e=[];this._users.forEach(t=>{t._dataChannels.forEach(s=>{n.every(e=>e.uid!==t._uintid||e.stream_id!==s.id)&&e.push({uid:t._uintid,stream_id:s.id,ordered:s.ordered,max_retrans_times:s.maxRetransmits,metadata:s.metadata})})}),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach(e=>{const{uid:n,stream_id:s,ordered:r,max_retrans_times:a,metadata:o}=e,c=this._users.find(e=>e._uintid===n);if(c){if(aO.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Ps(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex(t=>t.id===e.stream_id)){const e={id:s,ordered:!!r,maxRetransmits:a,metadata:o},n=function(e){return QU(e,!0)}(e);c._dataChannels.push(n),aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(tI.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(aO.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())}))}else aO.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),t&&(this.safeEmit(tI.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(e=>{const{uid:t,stream_id:n}=e,s=this._users.find(e=>e._uintid===t);if(!s)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const i=s._dataChannels.find(t=>t.id===e.stream_id);i&&(aO.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(s,[i]).then(e=>{if(s._dataChannels=s._dataChannels.filter(e=>e!==i),e)return this._gateway.unsubscribeDataChannel(e,s.uid)}),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(tI.USER_UNPUBLISHED,s,"datachannel",i._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=null===(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)||void 0===t?void 0:t.videoCodecs;if(n)for(const i of n){var s;if(i.payloadType===e)return null==i||null===(s=i.rtpMap)||void 0===s?void 0:s.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(t=>t.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){aO.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(e=>{this.safeEmit(tI.USER_UNPUBLISHED,t,"datachannel",e._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)}),n()}}else aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(iM.UPDATE_GATEWAY_CONFIG,()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(e=>{const{value:s,type:i,expires:r}=t[e];r&&r<=n||i||zj()||!Object.prototype.hasOwnProperty.call(xA,e)||(AA[e]=s,TA[e]=s,aO.debug("Update gateway parameters from config distribute",e,s))})}catch(e){aO.error("Error update config from local cache",e.message)}}()}),this._gateway.on(iM.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(iM.CONNECTION_STATE_CHANGE,(e,t,n)=>{var s;if(n===QR.FALLBACK)return;const i=()=>{this.safeEmit(tI.CONNECTION_STATE_CHANGE,e,t,n)};if(mO.reportApiInvoke(this._sessionId||(null===(s=this._gateway.joinInfo)||void 0===s?void 0:s.sid)||null,{name:qR.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:YR.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),aO.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach(e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var r;this._streamFallbackTypeCacheMap.forEach((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)})}),this._remoteStreamTypeCacheMap.forEach((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(r=this._joinInfo)||void 0===r?void 0:r.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{aO.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(e=>{aO.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(e=>!e._trust_in_room_).forEach(e=>{aO.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(e=>{e._trust_audio_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.AUDIO,!1)),e._trust_video_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.VIDEO,!1)),e._trust_audio_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(aO.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3))}i()}),this._gateway.on(iM.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new fO(RR.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const n=await CB(rW(rW({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,OB(n),this._joinInfo.preload=!0):(t=await kV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const s=[];t.gatewayInfo.gatewayAddrs.forEach(e=>{let{address:t}=e;const[n,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:n,port:i}):s.push({host:n,port:i})}),e(s)}catch(e){t(e)}}),this._gateway.on(iM.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(tI.NETWORK_QUALITY,e)}),this._gateway.on(iM.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(tI.STREAM_TYPE_CHANGED,e,t),mO.reportApiInvoke(this._sessionId,{name:qR.STREAM_TYPE_CHANGE,options:[e,t],tag:YR.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(iM.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(iM.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();n&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(e){n(e)}}),this._gateway.on(iM.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:aO.debug("no attributes in joinResponse");const s=SU(e.ortc,t,n);this._p2pChannel.connect(s)}),this._gateway.on(iM.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:s}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:r,cid:a}=this._joinInfo.apResponse,o="".concat(a,"_").concat(r);if(o.length<4||o.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:s,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(r),icePwd:"".concat(a,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(i=RA("FINGERPRINT"))&&void 0!==i?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(e){e.code&&e.code===RR.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:s,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(VL.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(VL.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(VL.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(VL.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(VL.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(VL.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(VL.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(VL.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(VL.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!0)),this._gateway.signal.on(VL.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!1)),this._gateway.signal.on(VL.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!0)),this._gateway.signal.on(VL.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!1)),this._gateway.signal.on(VL.RECEIVE_METADATA,e=>{const t=yI(e.metadata);this.safeEmit(tI.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(VL.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=yI(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ps(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<LA)throw new fO(RR.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(LA));const t=await async function(e,t,n){const s=n.subarray(0,LA),i=s.slice(8,LA),r=(i[0]<<8)+i[1],a=(s[6]<<8)+s[7],o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:DA,additionalData:new Uint8Array(kI(r,2))},t,n.subarray(LA));return new Uint8Array(o).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let s=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find(t=>t.uid===e.uid),i=null==t?void 0:t.audioRecv.find(e=>e.ssrc===(null==n?void 0:n._audioSSRC));s=null==i?void 0:i.jitterBufferMs}(null==s||Number.isNaN(s))&&(s=0),uB(rW(rW({},e),{},{payload:n}),s,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(VL.ON_CRYPT_ERROR,()=>{gI(()=>{aO.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(tI.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(VL.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(VL.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{aO.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,QR.TOKEN_EXPIRE),this.safeEmit(tI.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(VL.ON_STREAM_FALLBACK_UPDATE,e=>{aO.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(tI.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(VL.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),aO.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(VL.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(VL.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(LL.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ML.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,s;const i=e.some(e=>{let{stream_type:t}=e;return t===sM.Audio}),r=e.some(e=>{let{stream_type:t}=e;return t!==sM.Audio}),a=e.some(e=>{let{stream_type:t}=e;return t===sM.Screen||t===sM.ScreenLow});"offer"===t.state&&mO.publish(this._joinInfo.sid,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:RR.TIMEOUT,audio:i,video:r,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:i?null===(n=e.find(e=>{let{stream_type:t}=e;return t===sM.Audio}))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:r?null===(s=e.find(e=>{let{stream_type:t}=e;return t!==sM.Audio}))||void 0===s||null===(s=s.ssrcs[0])||void 0===s?void 0:s.ssrcId.toString():void 0})}break}case ML.SUBSCRIBE:t&&mO.subscribe(this._joinInfo.sid,{succ:!1,ec:RR.TIMEOUT,audio:t.stream_type===fM.AUDIO,video:t.stream_type===fM.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(VL.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(VL.ON_PUBLISHED_USER_LIST,e=>{if(null==e||!e.users)return;RA("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(e=>!Kj(e.string_id||e.stream_id,this.channelName)));const t=[],n=[];for(const s of e.users){let e=this._users.find(e=>e._uintid===s.stream_id);e?e._trust_in_room_=!0:(e=new ZV(s.string_id||s.stream_id,s.stream_id),this._users.push(e),this.store.firstVideoFrameDecoded(e.uid,{userJoinNotify:Date.now()}),0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(tI.USER_JOINED,e)));const i=aM.Audio&s.stream_type,r=(aM.Video|aM.LwoVideo)&s.stream_type,a=0!=(65280&s.stream_type),o=i&&e.hasAudio,c=r&&e.hasVideo;r&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=s.video_ssrc,e._rtxSsrcId=s.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=s.audio_ssrc),i&&!o&&0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(tI.USER_PUBLISHED,e,"audio")),r&&!c&&0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(tI.USER_PUBLISHED,e,"video")),(i&&!o||r&&!c||a)&&t.push(e),r&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(aO.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(e=>{aO.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())})),this.getListeners(tI.PUBLISHED_USER_LIST).length>0?RA("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(aO.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(e=>e.uid).join(", "))),this.safeEmit(tI.PUBLISHED_USER_LIST,t)):aO.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(e=>e.uid).join(", ")))}),this._gateway.signal.on(VL.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof tB&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(e=>e.toLowerCase()).filter(e=>{var t;return Ps(t=Object.keys(kA)).call(t,e)}))})}_handleP2PEvents(){this._gateway.signal.on(VL.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(AM.PUBLISH,(e,t,n)=>{const{uid:s}=e;e.forEach(e=>{const{kind:i,ssrcs:r,mid:a,isMuted:o}=e;this._handleP2PAddAudioOrVideoStream(i,s,r[0].ssrcId,a);const c=this._users.find(e=>e.uid===s);return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,i,r[0].ssrcId,a).then(()=>{t()}).catch(n):t(),this._handleMuteStream(s,i,!!o)})}),this._gateway.signal.on(AM.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var s;t(await this._p2pChannel.startP2P({turnServer:null===(s=this._joinInfo)||void 0===s?void 0:s.turnServer},e))}catch(e){n(e)}}),this._gateway.signal.on(LL.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(AM.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:s,uid:i}=e,r=this._users.find(e=>e.uid===i);if(!r)return aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{s.forEach(async e=>{let{stream_type:t}=e;const n=t===sM.Audio?fM.AUDIO:fM.VIDEO;await this._p2pChannel.unsubscribe(r,n),this._handleMuteStream(i,n,!0)}),t()}catch(e){n(e)}}}),this._gateway.signal.on(AM.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case kM.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,fM.VIDEO,!0);break;case kM.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,fM.AUDIO,!0);break;case kM.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,fM.VIDEO,!1);break;case kM.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,fM.AUDIO,!1)}}),this._gateway.signal.on(AM.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:n,iceParameter:s}=e;n!==FL.SEND_ONLY||s?t(await this._p2pChannel.restartICE(n,s)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}}),this._gateway.signal.on(AM.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(bM.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(AM.RESTART_ICE,e,n===FL.SEND_ONLY))}catch(e){n(e)}}),this._p2pChannel.on(bM.LocalCandidate,e=>{this._gateway.sendExtensionMessage(AM.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(bM.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(AM.CONTROL,e,!0),t()}catch(e){n(e)}}),this._p2pChannel.on(bM.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.StateChange,(e,t)=>{t===EM.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(bM.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(tI.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(bM.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(bM.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(bM.RequestRePublishDataChannel,(e,t,n)=>{np.all(e.map(async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach(e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)})}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw e}})).then(t).catch(n)}),this._p2pChannel.on(bM.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===fM.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}}),this._p2pChannel.on(bM.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(bM.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(bM.MediaReconnectStart,e=>{this.safeEmit(tI.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(bM.MediaReconnectEnd,e=>{this.safeEmit(tI.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(bM.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(bM.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const s=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:s})}catch(e){return void t.throw(e)}const{iceParameters:r}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:r})}),this._p2pChannel.on(bM.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(bM.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:r}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:s}),a=SU(i,r);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(bM.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(bM.P2PLost,()=>{this.safeEmit(tI.P2P_LOST,this.store.uid)}),this._p2pChannel.on(bM.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(bM.ConnectionTypeChange,e=>{this.safeEmit(tI.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(bM.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(bM.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(bM.AudioMetadata,e=>{this.safeEmit(tI.AUDIO_METADATA,e)}),this._p2pChannel.on(bM.AudioPts,e=>{this.safeEmit(tI.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},JU("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:s,cname:i,sid:r,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await n.init({appId:s,areaCode:"",cname:i,sid:r,token:a,uid:o,cid:c,vid:l?Number(l):0},FI)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(SM.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(tI.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===xM.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(tI.CONTENT_INSPECT_ERROR,new fO(RR.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(SM.INSPECT_RESULT,(e,t)=>{var n;if((null==t?void 0:t.code)===RR.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return aO.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(tI.CONTENT_INSPECT_RESULT,e,t)}),e.on(SM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}async disableContentInspect(){if(!this._inspect)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(AR(e,"enabled"),e){if(!t)throw new fO(RR.INVALID_PARAMS,"config is required");if(mG(t),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(n={config:t},JU("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);const{appId:s,cname:i,sid:r,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await e.init({appId:s,areaCode:"",cname:i,sid:r,token:a,uid:o,cid:c,vid:l?Number(l):0},FI)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var n;if(!this._moderation)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(RM.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(tI.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===CM.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new fO(RR.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(RM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}setP2PTransport(e){if(function(e){OR(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new fO(RR.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,aO.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return aO.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){AR(e,"enabled"),CA("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},IL(sW.prototype,"leave",[gG],Object.getOwnPropertyDescriptor(sW.prototype,"leave"),sW.prototype),IL(sW.prototype,"publish",[yG],Object.getOwnPropertyDescriptor(sW.prototype,"publish"),sW.prototype),IL(sW.prototype,"unpublish",[vG],Object.getOwnPropertyDescriptor(sW.prototype,"unpublish"),sW.prototype),IL(sW.prototype,"subscribe",[_G],Object.getOwnPropertyDescriptor(sW.prototype,"subscribe"),sW.prototype),IL(sW.prototype,"presubscribe",[EG],Object.getOwnPropertyDescriptor(sW.prototype,"presubscribe"),sW.prototype),IL(sW.prototype,"massSubscribe",[bG],Object.getOwnPropertyDescriptor(sW.prototype,"massSubscribe"),sW.prototype),IL(sW.prototype,"unsubscribe",[xG],Object.getOwnPropertyDescriptor(sW.prototype,"unsubscribe"),sW.prototype),IL(sW.prototype,"massUnsubscribe",[wG],Object.getOwnPropertyDescriptor(sW.prototype,"massUnsubscribe"),sW.prototype),IL(sW.prototype,"setLowStreamParameter",[SG],Object.getOwnPropertyDescriptor(sW.prototype,"setLowStreamParameter"),sW.prototype),IL(sW.prototype,"enableDualStream",[NG],Object.getOwnPropertyDescriptor(sW.prototype,"enableDualStream"),sW.prototype),IL(sW.prototype,"disableDualStream",[TG],Object.getOwnPropertyDescriptor(sW.prototype,"disableDualStream"),sW.prototype),IL(sW.prototype,"setClientRole",[CG],Object.getOwnPropertyDescriptor(sW.prototype,"setClientRole"),sW.prototype),IL(sW.prototype,"_setClientRoleOptions",[RG],Object.getOwnPropertyDescriptor(sW.prototype,"_setClientRoleOptions"),sW.prototype),IL(sW.prototype,"setProxyServer",[IG],Object.getOwnPropertyDescriptor(sW.prototype,"setProxyServer"),sW.prototype),IL(sW.prototype,"setTurnServer",[AG],Object.getOwnPropertyDescriptor(sW.prototype,"setTurnServer"),sW.prototype),IL(sW.prototype,"setLicense",[OG],Object.getOwnPropertyDescriptor(sW.prototype,"setLicense"),sW.prototype),IL(sW.prototype,"startProxyServer",[kG],Object.getOwnPropertyDescriptor(sW.prototype,"startProxyServer"),sW.prototype),IL(sW.prototype,"stopProxyServer",[DG],Object.getOwnPropertyDescriptor(sW.prototype,"stopProxyServer"),sW.prototype),IL(sW.prototype,"setLocalAccessPointsV2",[PG],Object.getOwnPropertyDescriptor(sW.prototype,"setLocalAccessPointsV2"),sW.prototype),IL(sW.prototype,"setLocalAccessPoints",[jG],Object.getOwnPropertyDescriptor(sW.prototype,"setLocalAccessPoints"),sW.prototype),IL(sW.prototype,"setRemoteDefaultVideoStreamType",[LG],Object.getOwnPropertyDescriptor(sW.prototype,"setRemoteDefaultVideoStreamType"),sW.prototype),IL(sW.prototype,"setRemoteVideoStreamType",[MG],Object.getOwnPropertyDescriptor(sW.prototype,"setRemoteVideoStreamType"),sW.prototype),IL(sW.prototype,"setStreamFallbackOption",[UG],Object.getOwnPropertyDescriptor(sW.prototype,"setStreamFallbackOption"),sW.prototype),IL(sW.prototype,"setEncryptionConfig",[VG],Object.getOwnPropertyDescriptor(sW.prototype,"setEncryptionConfig"),sW.prototype),IL(sW.prototype,"renewToken",[FG],Object.getOwnPropertyDescriptor(sW.prototype,"renewToken"),sW.prototype),IL(sW.prototype,"enableAudioVolumeIndicator",[BG],Object.getOwnPropertyDescriptor(sW.prototype,"enableAudioVolumeIndicator"),sW.prototype),IL(sW.prototype,"startLiveStreaming",[GG],Object.getOwnPropertyDescriptor(sW.prototype,"startLiveStreaming"),sW.prototype),IL(sW.prototype,"setLiveTranscoding",[WG],Object.getOwnPropertyDescriptor(sW.prototype,"setLiveTranscoding"),sW.prototype),IL(sW.prototype,"stopLiveStreaming",[HG],Object.getOwnPropertyDescriptor(sW.prototype,"stopLiveStreaming"),sW.prototype),IL(sW.prototype,"startChannelMediaRelay",[KG],Object.getOwnPropertyDescriptor(sW.prototype,"startChannelMediaRelay"),sW.prototype),IL(sW.prototype,"updateChannelMediaRelay",[zG],Object.getOwnPropertyDescriptor(sW.prototype,"updateChannelMediaRelay"),sW.prototype),IL(sW.prototype,"stopChannelMediaRelay",[qG],Object.getOwnPropertyDescriptor(sW.prototype,"stopChannelMediaRelay"),sW.prototype),IL(sW.prototype,"sendCustomReportMessage",[YG],Object.getOwnPropertyDescriptor(sW.prototype,"sendCustomReportMessage"),sW.prototype),IL(sW.prototype,"pickSVCLayer",[XG],Object.getOwnPropertyDescriptor(sW.prototype,"pickSVCLayer"),sW.prototype),IL(sW.prototype,"setRTMConfig",[JG],Object.getOwnPropertyDescriptor(sW.prototype,"setRTMConfig"),sW.prototype),IL(sW.prototype,"enableContentInspect",[QG],Object.getOwnPropertyDescriptor(sW.prototype,"enableContentInspect"),sW.prototype),IL(sW.prototype,"disableContentInspect",[ZG],Object.getOwnPropertyDescriptor(sW.prototype,"disableContentInspect"),sW.prototype),IL(sW.prototype,"setImageModeration",[$G],Object.getOwnPropertyDescriptor(sW.prototype,"setImageModeration"),sW.prototype),IL(sW.prototype,"setP2PTransport",[eW],Object.getOwnPropertyDescriptor(sW.prototype,"setP2PTransport"),sW.prototype),IL(sW.prototype,"getJoinChannelServiceRecords",[tW],Object.getOwnPropertyDescriptor(sW.prototype,"getJoinChannelServiceRecords"),sW.prototype),IL(sW.prototype,"setPublishAudioFilterEnabled",[nW],Object.getOwnPropertyDescriptor(sW.prototype,"setPublishAudioFilterEnabled"),sW.prototype),sW);class oW{constructor(e,t){uN(this,"id",0),uN(this,"element",void 0),uN(this,"peerPair",void 0),uN(this,"context",void 0),uN(this,"audioPlayerElement",void 0),uN(this,"audioTrack",void 0),oW.count+=1,this.id=oW.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new np(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const s=await e(this.peerPair[1],"answer");await t(this.peerPair[0],s)}catch(e){throw new fO(RR.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new fO(RR.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new fO(RR.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){aO.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var cW,lW;uN(oW,"count",0);const dW=window.AudioContext||window.webkitAudioContext,uW=new(cW=pO({report:mO}),IL((lW=class{constructor(){uN(this,"units",[]),uN(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return aO.debug("the system does not need to process local aec"),-1;this.context||(this.context=new dW);let t=this.units.find(t=>t&&t.getElement()===e);return t||(t=new oW(e,this.context),this.units.push(t)),t.startEchoCancellation(),aO.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qC().name!==WC.SAFARI}}).prototype,"processExternalMediaAEC",[cW],Object.getOwnPropertyDescriptor(lW.prototype,"processExternalMediaAEC"),lW.prototype),lW);function hW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function pW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hW(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const mW=window||document;function fW(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!mW)return;const n=jY._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const s=e=>{if(!(e&&e.blockedURI&&(jY.onSecurityPolicyViolation||jY.getListeners(TM.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;RA("CSP_DETECTED_HOSTNAME_LIST").some(e=>Ps(t).call(t,e))&&(jY.onSecurityPolicyViolation&&"function"==typeof jY.onSecurityPolicyViolation&&jY.onSecurityPolicyViolation(e),jY.getListeners(TM.SECURITY_POLICY_VIOLATION).length>0&&jY.safeEmit(TM.SECURITY_POLICY_VIOLATION,e))};n&&mW.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||jY.getListeners(TM.SECURITY_POLICY_VIOLATION).length>0)&&mW.addEventListener("securitypolicyviolation",s),jY._cspEventHandlerPointer=s}var gW=u,yW=RN,vW=RegExp.prototype,_W=function(e){return e===vW||gW(vW,e)?yW(e):e.flags},EW=s(_W);function bW(e){let t=e.length;for(;--t>=0;)e[t]=0}const xW=256,wW=286,SW=30,NW=15,TW=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),CW=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),RW=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),IW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AW=new Array(576);bW(AW);const OW=new Array(60);bW(OW);const kW=new Array(512);bW(kW);const DW=new Array(256);bW(DW);const PW=new Array(29);bW(PW);const jW=new Array(SW);function LW(e,t,n,s,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=i,this.has_stree=e&&e.length}let MW,UW,VW;function FW(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}bW(jW);const BW=e=>e<256?kW[e]:kW[256+(e>>>7)],GW=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},WW=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,GW(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},HW=(e,t,n)=>{WW(e,n[2*t],n[2*t+1])},KW=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},zW=(e,t,n)=>{const s=new Array(16);let i,r,a=0;for(i=1;i<=NW;i++)a=a+n[i-1]<<1,s[i]=a;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=KW(s[t]++,t))}},qW=e=>{let t;for(t=0;t<wW;t++)e.dyn_ltree[2*t]=0;for(t=0;t<SW;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},YW=e=>{e.bi_valid>8?GW(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},XW=(e,t,n,s)=>{const i=2*t,r=2*n;return e[i]<e[r]||e[i]===e[r]&&s[t]<=s[n]},JW=(e,t,n)=>{const s=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&XW(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!XW(t,s,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=s},QW=(e,t,n)=>{let s,i,r,a,o=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+o++],s+=(255&e.pending_buf[e.sym_buf+o++])<<8,i=e.pending_buf[e.sym_buf+o++],0===s?HW(e,i,t):(r=DW[i],HW(e,r+xW+1,t),a=TW[r],0!==a&&(i-=PW[r],WW(e,i,a)),s--,r=BW(s),HW(e,r,n),a=CW[r],0!==a&&(s-=jW[r],WW(e,s,a)))}while(o<e.sym_next);HW(e,256,t)},ZW=(e,t)=>{const n=t.dyn_tree,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,r=t.stat_desc.elems;let a,o,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<r;a++)0!==n[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=s[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)JW(e,n,a);c=r;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],JW(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,n[2*c]=n[2*a]+n[2*o],e.depth[c]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,n[2*a+1]=n[2*o+1]=c,e.heap[1]=c++,JW(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,s=t.max_code,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,d,u,h,p,m,f=0;for(h=0;h<=NW;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)d=e.heap[l],h=n[2*n[2*d+1]+1]+1,h>c&&(h=c,f++),n[2*d+1]=h,d>s||(e.bl_count[h]++,p=0,d>=o&&(p=a[d-o]),m=n[2*d],e.opt_len+=m*(h+p),r&&(e.static_len+=m*(i[2*d+1]+p)));if(0!==f){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,f-=2}while(f>0);for(h=c;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--l],u>s||(n[2*u+1]!==h&&(e.opt_len+=(h-n[2*u+1])*n[2*u],n[2*u+1]=h),d--)}})(e,t),zW(n,l,e.bl_count)},$W=(e,t,n)=>{let s,i,r=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,s=0;s<=n;s++)i=a,a=t[2*(s+1)+1],++o<c&&i===a||(o<l?e.bl_tree[2*i]+=o:0!==i?(i!==r&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=i,0===a?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4))},eH=(e,t,n)=>{let s,i,r=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),s=0;s<=n;s++)if(i=a,a=t[2*(s+1)+1],!(++o<c&&i===a)){if(o<l)do{HW(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==r&&(HW(e,i,e.bl_tree),o--),HW(e,16,e.bl_tree),WW(e,o-3,2)):o<=10?(HW(e,17,e.bl_tree),WW(e,o-3,3)):(HW(e,18,e.bl_tree),WW(e,o-11,7));o=0,r=i,0===a?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4)}};let tH=!1;const nH=(e,t,n,s)=>{WW(e,0+(s?1:0),3),YW(e),GW(e,n),GW(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var sH=e=>{tH||((()=>{let e,t,n,s,i;const r=new Array(16);for(n=0,s=0;s<28;s++)for(PW[s]=n,e=0;e<1<<TW[s];e++)DW[n++]=s;for(DW[n-1]=s,i=0,s=0;s<16;s++)for(jW[s]=i,e=0;e<1<<CW[s];e++)kW[i++]=s;for(i>>=7;s<SW;s++)for(jW[s]=i<<7,e=0;e<1<<CW[s]-7;e++)kW[256+i++]=s;for(t=0;t<=NW;t++)r[t]=0;for(e=0;e<=143;)AW[2*e+1]=8,e++,r[8]++;for(;e<=255;)AW[2*e+1]=9,e++,r[9]++;for(;e<=279;)AW[2*e+1]=7,e++,r[7]++;for(;e<=287;)AW[2*e+1]=8,e++,r[8]++;for(zW(AW,287,r),e=0;e<SW;e++)OW[2*e+1]=5,OW[2*e]=KW(e,5);MW=new LW(AW,TW,257,wW,NW),UW=new LW(OW,CW,0,SW,NW),VW=new LW(new Array(0),RW,0,19,7)})(),tH=!0),e.l_desc=new FW(e.dyn_ltree,MW),e.d_desc=new FW(e.dyn_dtree,UW),e.bl_desc=new FW(e.bl_tree,VW),e.bi_buf=0,e.bi_valid=0,qW(e)},iH=(e,t,n,s)=>{let i,r,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<xW;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ZW(e,e.l_desc),ZW(e,e.d_desc),a=(e=>{let t;for($W(e,e.dyn_ltree,e.l_desc.max_code),$W(e,e.dyn_dtree,e.d_desc.max_code),ZW(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*IW[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=i&&(i=r)):i=r=n+5,n+4<=i&&-1!==t?nH(e,t,n,s):4===e.strategy||r===i?(WW(e,2+(s?1:0),3),QW(e,AW,OW)):(WW(e,4+(s?1:0),3),((e,t,n,s)=>{let i;for(WW(e,t-257,5),WW(e,n-1,5),WW(e,s-4,4),i=0;i<s;i++)WW(e,e.bl_tree[2*IW[i]+1],3);eH(e,e.dyn_ltree,t-1),eH(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),QW(e,e.dyn_ltree,e.dyn_dtree)),qW(e),s&&YW(e)},rH=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(DW[n]+xW+1)]++,e.dyn_dtree[2*BW(t)]++),e.sym_next===e.sym_end),aH=e=>{WW(e,2,3),HW(e,256,AW),(e=>{16===e.bi_valid?(GW(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},oH={_tr_init:sH,_tr_stored_block:nH,_tr_flush_block:iH,_tr_tally:rH,_tr_align:aH},cH=(e,t,n,s)=>{let i=65535&e,r=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{i=i+t[s++]|0,r=r+i|0}while(--a);i%=65521,r%=65521}return i|r<<16};const lH=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var dH=(e,t,n,s)=>{const i=lH,r=s+n;e^=-1;for(let a=s;a<r;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},uH={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},hH={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:pH,_tr_stored_block:mH,_tr_flush_block:fH,_tr_tally:gH,_tr_align:yH}=oH,{Z_NO_FLUSH:vH,Z_PARTIAL_FLUSH:_H,Z_FULL_FLUSH:EH,Z_FINISH:bH,Z_BLOCK:xH,Z_OK:wH,Z_STREAM_END:SH,Z_STREAM_ERROR:NH,Z_DATA_ERROR:TH,Z_BUF_ERROR:CH,Z_DEFAULT_COMPRESSION:RH,Z_FILTERED:IH,Z_HUFFMAN_ONLY:AH,Z_RLE:OH,Z_FIXED:kH,Z_DEFAULT_STRATEGY:DH,Z_UNKNOWN:PH,Z_DEFLATED:jH}=hH,LH=286,MH=30,UH=19,VH=2*LH+1,FH=15,BH=258,GH=262,WH=42,HH=113,KH=666,zH=(e,t)=>(e.msg=uH[t],t),qH=e=>2*e-(e>4?9:0),YH=e=>{let t=e.length;for(;--t>=0;)e[t]=0},XH=e=>{let t,n,s,i=e.w_size;t=e.hash_size,s=t;do{n=e.head[--s],e.head[s]=n>=i?n-i:0}while(--t);t=i,s=t;do{n=e.prev[--s],e.prev[s]=n>=i?n-i:0}while(--t)};let JH=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const QH=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},ZH=(e,t)=>{fH(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,QH(e.strm)},$H=(e,t)=>{e.pending_buf[e.pending++]=t},eK=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},tK=(e,t,n,s)=>{let i=e.avail_in;return i>s&&(i=s),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=cH(e.adler,t,i,n):2===e.state.wrap&&(e.adler=dH(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},nK=(e,t)=>{let n,s,i=e.max_chain_length,r=e.strstart,a=e.prev_length,o=e.nice_match;const c=e.strstart>e.w_size-GH?e.strstart-(e.w_size-GH):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+BH;let p=l[r+a-1],m=l[r+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,l[n+a]===m&&l[n+a-1]===p&&l[n]===l[r]&&l[++n]===l[r+1]){r+=2,n++;do{}while(l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&r<h);if(s=BH-(h-r),r=h-BH,s>a){if(e.match_start=t,a=s,s>=o)break;p=l[r+a-1],m=l[r+a]}}}while((t=u[t&d])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead},sK=e=>{const t=e.w_size;let n,s,i;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-GH)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),XH(e),s+=t),0===e.strm.avail_in)break;if(n=tK(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=JH(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=JH(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<GH&&0!==e.strm.avail_in)},iK=(e,t)=>{let n,s,i,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>i&&(n=i),n<r&&(0===n&&t!==bH||t===vH||n!==s+e.strm.avail_in))break;a=t===bH&&n===s+e.strm.avail_in?1:0,mH(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,QH(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(tK(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==vH&&t!==bH&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(tK(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,r=i>e.w_size?e.w_size:i,s=e.strstart-e.block_start,(s>=r||(s||t===bH)&&t!==vH&&0===e.strm.avail_in&&s<=i)&&(n=s>i?i:s,a=t===bH&&0===e.strm.avail_in&&n===s?1:0,mH(e,e.block_start,n,a),e.block_start+=n,QH(e.strm)),a?3:1)},rK=(e,t)=>{let n,s;for(;;){if(e.lookahead<GH){if(sK(e),e.lookahead<GH&&t===vH)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-GH&&(e.match_length=nK(e,n)),e.match_length>=3)if(s=gH(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=JH(e,e.ins_h,e.window[e.strstart+1]);else s=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2},aK=(e,t)=>{let n,s,i;for(;;){if(e.lookahead<GH){if(sK(e),e.lookahead<GH&&t===vH)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-GH&&(e.match_length=nK(e,n),e.match_length<=5&&(e.strategy===IH||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,s=gH(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(ZH(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=gH(e,0,e.window[e.strstart-1]),s&&ZH(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=gH(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2};function oK(e,t,n,s,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=i}const cK=[new oK(0,0,0,0,iK),new oK(4,4,8,4,rK),new oK(4,5,16,8,rK),new oK(4,6,32,32,rK),new oK(4,4,16,16,aK),new oK(8,16,32,32,aK),new oK(8,16,128,128,aK),new oK(8,32,128,256,aK),new oK(32,128,258,1024,aK),new oK(32,258,258,4096,aK)];function lK(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jH,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*VH),this.dyn_dtree=new Uint16Array(2*(2*MH+1)),this.bl_tree=new Uint16Array(2*(2*UH+1)),YH(this.dyn_ltree),YH(this.dyn_dtree),YH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(FH+1),this.heap=new Uint16Array(2*LH+1),YH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*LH+1),YH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dK=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==WH&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==HH&&t.status!==KH?1:0},uK=e=>{if(dK(e))return zH(e,NH);e.total_in=e.total_out=0,e.data_type=PH;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?WH:HH,e.adler=2===t.wrap?0:1,t.last_flush=-2,pH(t),wH},hK=e=>{const t=uK(e);return t===wH&&(e=>{e.window_size=2*e.w_size,YH(e.head),e.max_lazy_match=cK[e.level].max_lazy,e.good_match=cK[e.level].good_length,e.nice_match=cK[e.level].nice_length,e.max_chain_length=cK[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},pK=(e,t,n,s,i,r)=>{if(!e)return NH;let a=1;if(t===RH&&(t=6),s<0?(a=0,s=-s):s>15&&(a=2,s-=16),i<1||i>9||n!==jH||s<8||s>15||t<0||t>9||r<0||r>kH||8===s&&1!==a)return zH(e,NH);8===s&&(s=9);const o=new lK;return e.state=o,o.strm=e,o.status=WH,o.wrap=a,o.gzhead=null,o.w_bits=s,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=r,o.method=n,hK(e)};var mK=(e,t)=>{if(dK(e)||t>xH||t<0)return e?zH(e,NH):NH;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===KH&&t!==bH)return zH(e,0===e.avail_out?CH:NH);const s=n.last_flush;if(n.last_flush=t,0!==n.pending){if(QH(e),0===e.avail_out)return n.last_flush=-1,wH}else if(0===e.avail_in&&qH(t)<=qH(s)&&t!==bH)return zH(e,CH);if(n.status===KH&&0!==e.avail_in)return zH(e,CH);if(n.status===WH&&0===n.wrap&&(n.status=HH),n.status===WH){let t=jH+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=AH||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=s<<6,0!==n.strstart&&(t|=32),t+=31-t%31,eK(n,t),0!==n.strstart&&(eK(n,e.adler>>>16),eK(n,65535&e.adler)),e.adler=1,n.status=HH,QH(e),0!==n.pending)return n.last_flush=-1,wH}if(57===n.status)if(e.adler=0,$H(n,31),$H(n,139),$H(n,8),n.gzhead)$H(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),$H(n,255&n.gzhead.time),$H(n,n.gzhead.time>>8&255),$H(n,n.gzhead.time>>16&255),$H(n,n.gzhead.time>>24&255),$H(n,9===n.level?2:n.strategy>=AH||n.level<2?4:0),$H(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&($H(n,255&n.gzhead.extra.length),$H(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=dH(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if($H(n,0),$H(n,0),$H(n,0),$H(n,0),$H(n,0),$H(n,9===n.level?2:n.strategy>=AH||n.level<2?4:0),$H(n,3),n.status=HH,QH(e),0!==n.pending)return n.last_flush=-1,wH;if(69===n.status){if(n.gzhead.extra){let t=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=dH(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,QH(e),0!==n.pending)return n.last_flush=-1,wH;t=0,s-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>t&&(e.adler=dH(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=dH(e.adler,n.pending_buf,n.pending-s,s)),QH(e),0!==n.pending)return n.last_flush=-1,wH;s=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,$H(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=dH(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=dH(e.adler,n.pending_buf,n.pending-s,s)),QH(e),0!==n.pending)return n.last_flush=-1,wH;s=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,$H(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=dH(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(QH(e),0!==n.pending))return n.last_flush=-1,wH;$H(n,255&e.adler),$H(n,e.adler>>8&255),e.adler=0}if(n.status=HH,QH(e),0!==n.pending)return n.last_flush=-1,wH}if(0!==e.avail_in||0!==n.lookahead||t!==vH&&n.status!==KH){let s=0===n.level?iK(n,t):n.strategy===AH?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(sK(e),0===e.lookahead)){if(t===vH)return 1;break}if(e.match_length=0,n=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===OH?((e,t)=>{let n,s,i,r;const a=e.window;for(;;){if(e.lookahead<=BH){if(sK(e),e.lookahead<=BH&&t===vH)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,s=a[i],s===a[++i]&&s===a[++i]&&s===a[++i])){r=e.strstart+BH;do{}while(s===a[++i]&&s===a[++i]&&s===a[++i]&&s===a[++i]&&s===a[++i]&&s===a[++i]&&s===a[++i]&&s===a[++i]&&i<r);e.match_length=BH-(r-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=gH(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===bH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2})(n,t):cK[n.level].func(n,t);if(3!==s&&4!==s||(n.status=KH),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),wH;if(2===s&&(t===_H?yH(n):t!==xH&&(mH(n,0,0,!1),t===EH&&(YH(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),QH(e),0===e.avail_out))return n.last_flush=-1,wH}return t!==bH?wH:n.wrap<=0?SH:(2===n.wrap?($H(n,255&e.adler),$H(n,e.adler>>8&255),$H(n,e.adler>>16&255),$H(n,e.adler>>24&255),$H(n,255&e.total_in),$H(n,e.total_in>>8&255),$H(n,e.total_in>>16&255),$H(n,e.total_in>>24&255)):(eK(n,e.adler>>>16),eK(n,65535&e.adler)),QH(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?wH:SH)},fK=(e,t)=>{let n=t.length;if(dK(e))return NH;const s=e.state,i=s.wrap;if(2===i||1===i&&s.status!==WH||s.lookahead)return NH;if(1===i&&(e.adler=cH(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){0===i&&(YH(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(n-s.w_size,n),0),t=e,n=s.w_size}const r=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,sK(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=JH(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,sK(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=a,e.input=o,e.avail_in=r,s.wrap=i,wH},gK={deflateInit:(e,t)=>pK(e,t,jH,15,8,DH),deflateInit2:pK,deflateReset:hK,deflateResetKeep:uK,deflateSetHeader:(e,t)=>dK(e)||2!==e.state.wrap?NH:(e.state.gzhead=t,wH),deflate:mK,deflateEnd:e=>{if(dK(e))return NH;const t=e.state.status;return e.state=null,t===HH?zH(e,TH):wH},deflateSetDictionary:fK,deflateInfo:"pako deflate (from Nodeca project)"};const yK=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var vK={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)yK(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let s=0,i=e.length;s<i;s++)t+=e[s].length;const n=new Uint8Array(t);for(let s=0,i=0,r=e.length;s<r;s++){let t=e[s];n.set(t,i),i+=t.length}return n}};let _K=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){_K=!1}const EK=new Uint8Array(256);for(let n=0;n<256;n++)EK[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;EK[254]=EK[254]=1;var bK={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,s,i,r,a=e.length,o=0;for(i=0;i<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),r=0,i=0;r<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),i++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,i;const r=new Array(2*n);for(i=0,s=0;s<n;){let t=e[s++];if(t<128){r[i++]=t;continue}let a=EK[t];if(a>4)r[i++]=65533,s+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&s<n;)t=t<<6|63&e[s++],a--;a>1?r[i++]=65533:t<65536?r[i++]=t:(t-=65536,r[i++]=55296|t>>10&1023,r[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&_K)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n})(r,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+EK[e[n]]>t?n:t}},xK=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const wK=Object.prototype.toString,{Z_NO_FLUSH:SK,Z_SYNC_FLUSH:NK,Z_FULL_FLUSH:TK,Z_FINISH:CK,Z_OK:RK,Z_STREAM_END:IK,Z_DEFAULT_COMPRESSION:AK,Z_DEFAULT_STRATEGY:OK,Z_DEFLATED:kK}=hH;function DK(e){this.options=vK.assign({level:AK,method:kK,chunkSize:16384,windowBits:15,memLevel:8,strategy:OK},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xK,this.strm.avail_out=0;let n=gK.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==RK)throw new Error(uH[n]);if(t.header&&gK.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?bK.string2buf(t.dictionary):"[object ArrayBuffer]"===wK.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=gK.deflateSetDictionary(this.strm,e),n!==RK)throw new Error(uH[n]);this._dict_set=!0}}function PK(e,t){const n=new DK(t);if(n.push(e,!0),n.err)throw n.msg||uH[n.err];return n.result}DK.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize;let i,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?CK:SK,"string"==typeof e?n.input=bK.string2buf(e):"[object ArrayBuffer]"===wK.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(r===NK||r===TK)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=gK.deflate(n,r),i===IK)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=gK.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===RK;if(0!==n.avail_out){if(r>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},DK.prototype.onData=function(e){this.chunks.push(e)},DK.prototype.onEnd=function(e){e===RK&&(this.result=vK.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jK={Deflate:DK,deflate:PK,deflateRaw:function(e,t){return(t=t||{}).raw=!0,PK(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,PK(e,t)},constants:hH};const LK=16209;var MK=function(e,t){let n,s,i,r,a,o,c,l,d,u,h,p,m,f,g,y,v,_,E,b,x,w,S,N;const T=e.state;n=e.next_in,S=e.input,s=n+(e.avail_in-5),i=e.next_out,N=e.output,r=i-(t-e.avail_out),a=i+(e.avail_out-257),o=T.dmax,c=T.wsize,l=T.whave,d=T.wnext,u=T.window,h=T.hold,p=T.bits,m=T.lencode,f=T.distcode,g=(1<<T.lenbits)-1,y=(1<<T.distbits)-1;e:do{p<15&&(h+=S[n++]<<p,p+=8,h+=S[n++]<<p,p+=8),v=m[h&g];t:for(;;){if(_=v>>>24,h>>>=_,p-=_,_=v>>>16&255,0===_)N[i++]=65535&v;else{if(!(16&_)){if(0==(64&_)){v=m[(65535&v)+(h&(1<<_)-1)];continue t}if(32&_){T.mode=16191;break e}e.msg="invalid literal/length code",T.mode=LK;break e}E=65535&v,_&=15,_&&(p<_&&(h+=S[n++]<<p,p+=8),E+=h&(1<<_)-1,h>>>=_,p-=_),p<15&&(h+=S[n++]<<p,p+=8,h+=S[n++]<<p,p+=8),v=f[h&y];n:for(;;){if(_=v>>>24,h>>>=_,p-=_,_=v>>>16&255,!(16&_)){if(0==(64&_)){v=f[(65535&v)+(h&(1<<_)-1)];continue n}e.msg="invalid distance code",T.mode=LK;break e}if(b=65535&v,_&=15,p<_&&(h+=S[n++]<<p,p+=8,p<_&&(h+=S[n++]<<p,p+=8)),b+=h&(1<<_)-1,b>o){e.msg="invalid distance too far back",T.mode=LK;break e}if(h>>>=_,p-=_,_=i-r,b>_){if(_=b-_,_>l&&T.sane){e.msg="invalid distance too far back",T.mode=LK;break e}if(x=0,w=u,0===d){if(x+=c-_,_<E){E-=_;do{N[i++]=u[x++]}while(--_);x=i-b,w=N}}else if(d<_){if(x+=c+d-_,_-=d,_<E){E-=_;do{N[i++]=u[x++]}while(--_);if(x=0,d<E){_=d,E-=_;do{N[i++]=u[x++]}while(--_);x=i-b,w=N}}}else if(x+=d-_,_<E){E-=_;do{N[i++]=u[x++]}while(--_);x=i-b,w=N}for(;E>2;)N[i++]=w[x++],N[i++]=w[x++],N[i++]=w[x++],E-=3;E&&(N[i++]=w[x++],E>1&&(N[i++]=w[x++]))}else{x=i-b;do{N[i++]=N[x++],N[i++]=N[x++],N[i++]=N[x++],E-=3}while(E>2);E&&(N[i++]=N[x++],E>1&&(N[i++]=N[x++]))}break}}break}}while(n<s&&i<a);E=p>>3,n-=E,p-=E<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=i<a?a-i+257:257-(i-a),T.hold=h,T.bits=p};const UK=15,VK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),FK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),BK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),GK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var WK=(e,t,n,s,i,r,a,o)=>{const c=o.bits;let l,d,u,h,p,m,f=0,g=0,y=0,v=0,_=0,E=0,b=0,x=0,w=0,S=0,N=null;const T=new Uint16Array(16),C=new Uint16Array(16);let R,I,A,O=null;for(f=0;f<=UK;f++)T[f]=0;for(g=0;g<s;g++)T[t[n+g]]++;for(_=c,v=UK;v>=1&&0===T[v];v--);if(_>v&&(_=v),0===v)return i[r++]=20971520,i[r++]=20971520,o.bits=1,0;for(y=1;y<v&&0===T[y];y++);for(_<y&&(_=y),x=1,f=1;f<=UK;f++)if(x<<=1,x-=T[f],x<0)return-1;if(x>0&&(0===e||1!==v))return-1;for(C[1]=0,f=1;f<UK;f++)C[f+1]=C[f]+T[f];for(g=0;g<s;g++)0!==t[n+g]&&(a[C[t[n+g]]++]=g);if(0===e?(N=O=a,m=20):1===e?(N=VK,O=FK,m=257):(N=BK,O=GK,m=0),S=0,g=0,f=y,p=r,E=_,b=0,u=-1,w=1<<_,h=w-1,1===e&&w>852||2===e&&w>592)return 1;for(;;){R=f-b,a[g]+1<m?(I=0,A=a[g]):a[g]>=m?(I=O[a[g]-m],A=N[a[g]-m]):(I=96,A=0),l=1<<f-b,d=1<<E,y=d;do{d-=l,i[p+(S>>b)+d]=R<<24|I<<16|A}while(0!==d);for(l=1<<f-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,g++,0==--T[f]){if(f===v)break;f=t[n+a[g]]}if(f>_&&(S&h)!==u){for(0===b&&(b=_),p+=y,E=f-b,x=1<<E;E+b<v&&(x-=T[E+b],!(x<=0));)E++,x<<=1;if(w+=1<<E,1===e&&w>852||2===e&&w>592)return 1;u=S&h,i[u]=_<<24|E<<16|p-r}}return 0!==S&&(i[p+S]=f-b<<24|64<<16),o.bits=_,0};const{Z_FINISH:HK,Z_BLOCK:KK,Z_TREES:zK,Z_OK:qK,Z_STREAM_END:YK,Z_NEED_DICT:XK,Z_STREAM_ERROR:JK,Z_DATA_ERROR:QK,Z_MEM_ERROR:ZK,Z_BUF_ERROR:$K,Z_DEFLATED:ez}=hH,tz=16180,nz=16190,sz=16191,iz=16192,rz=16194,az=16199,oz=16200,cz=16206,lz=16209,dz=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function uz(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const hz=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<tz||t.mode>16211?1:0},pz=e=>{if(hz(e))return JK;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=tz,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qK},mz=e=>{if(hz(e))return JK;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,pz(e)},fz=(e,t)=>{let n;if(hz(e))return JK;const s=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?JK:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,mz(e))},gz=(e,t)=>{if(!e)return JK;const n=new uz;e.state=n,n.strm=e,n.window=null,n.mode=tz;const s=fz(e,t);return s!==qK&&(e.state=null),s};let yz,vz,_z=!0;const Ez=e=>{if(_z){yz=new Int32Array(512),vz=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(WK(1,e.lens,0,288,yz,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;WK(2,e.lens,0,32,vz,0,e.work,{bits:5}),_z=!1}e.lencode=yz,e.lenbits=9,e.distcode=vz,e.distbits=5},bz=(e,t,n,s)=>{let i;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),s>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(i=r.wsize-r.wnext,i>s&&(i=s),r.window.set(t.subarray(n-s,n-s+i),r.wnext),(s-=i)?(r.window.set(t.subarray(n-s,n),0),r.wnext=s,r.whave=r.wsize):(r.wnext+=i,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=i))),0};var xz=(e,t)=>{let n,s,i,r,a,o,c,l,d,u,h,p,m,f,g,y,v,_,E,b,x,w,S=0;const N=new Uint8Array(4);let T,C;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(hz(e)||!e.output||!e.input&&0!==e.avail_in)return JK;n=e.state,n.mode===sz&&(n.mode=iz),a=e.next_out,i=e.output,c=e.avail_out,r=e.next_in,s=e.input,o=e.avail_in,l=n.hold,d=n.bits,u=o,h=c,w=qK;e:for(;;)switch(n.mode){case tz:if(0===n.wrap){n.mode=iz;break}for(;d<16;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,N[0]=255&l,N[1]=l>>>8&255,n.check=dH(n.check,N,2,0),l=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=lz;break}if((15&l)!==ez){e.msg="unknown compression method",n.mode=lz;break}if(l>>>=4,d-=4,x=8+(15&l),0===n.wbits&&(n.wbits=x),x>15||x>n.wbits){e.msg="invalid window size",n.mode=lz;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:sz,l=0,d=0;break;case 16181:for(;d<16;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(n.flags=l,(255&EW(n))!==ez){e.msg="unknown compression method",n.mode=lz;break}if(57344&EW(n)){e.msg="unknown header flags set",n.mode=lz;break}n.head&&(n.head.text=l>>8&1),512&EW(n)&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,n.check=dH(n.check,N,2,0)),l=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}n.head&&(n.head.time=l),512&EW(n)&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,N[2]=l>>>16&255,N[3]=l>>>24&255,n.check=dH(n.check,N,4,0)),l=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&EW(n)&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,n.check=dH(n.check,N,2,0)),l=0,d=0,n.mode=16184;case 16184:if(1024&EW(n)){for(;d<16;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}n.length=l,n.head&&(n.head.extra_len=l),512&EW(n)&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,n.check=dH(n.check,N,2,0)),l=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&EW(n)&&(p=n.length,p>o&&(p=o),p&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(r,r+p),x)),512&EW(n)&&4&n.wrap&&(n.check=dH(n.check,s,p,r)),o-=p,r+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&EW(n)){if(0===o)break e;p=0;do{x=s[r+p++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x))}while(x&&p<o);if(512&EW(n)&&4&n.wrap&&(n.check=dH(n.check,s,p,r)),o-=p,r+=p,x)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&EW(n)){if(0===o)break e;p=0;do{x=s[r+p++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x))}while(x&&p<o);if(512&EW(n)&&4&n.wrap&&(n.check=dH(n.check,s,p,r)),o-=p,r+=p,x)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&EW(n)){for(;d<16;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=lz;break}l=0,d=0}n.head&&(n.head.hcrc=EW(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=sz;break;case 16189:for(;d<32;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}e.adler=n.check=dz(l),l=0,d=0,n.mode=nz;case nz:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=o,n.hold=l,n.bits=d,XK;e.adler=n.check=1,n.mode=sz;case sz:if(t===KK||t===zK)break e;case iz:if(n.last){l>>>=7&d,d-=7&d,n.mode=cz;break}for(;d<3;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}switch(n.last=1&l,l>>>=1,d-=1,3&l){case 0:n.mode=16193;break;case 1:if(Ez(n),n.mode=az,t===zK){l>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=lz}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=lz;break}if(n.length=65535&l,l=0,d=0,n.mode=rz,t===zK)break e;case rz:n.mode=16195;case 16195:if(p=n.length,p){if(p>o&&(p=o),p>c&&(p=c),0===p)break e;i.set(s.subarray(r,r+p),a),o-=p,r+=p,c-=p,a+=p,n.length-=p;break}n.mode=sz;break;case 16196:for(;d<14;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(n.nlen=257+(31&l),l>>>=5,d-=5,n.ndist=1+(31&l),l>>>=5,d-=5,n.ncode=4+(15&l),l>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=lz;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}n.lens[R[n.have++]]=7&l,l>>>=3,d-=3}for(;n.have<19;)n.lens[R[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},w=WK(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,w){e.msg="invalid code lengths set",n.mode=lz;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[l&(1<<n.lenbits)-1],g=S>>>24,y=S>>>16&255,v=65535&S,!(g<=d);){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(v<16)l>>>=g,d-=g,n.lens[n.have++]=v;else{if(16===v){for(C=g+2;d<C;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(l>>>=g,d-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=lz;break}x=n.lens[n.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===v){for(C=g+3;d<C;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}l>>>=g,d-=g,x=0,p=3+(7&l),l>>>=3,d-=3}else{for(C=g+7;d<C;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}l>>>=g,d-=g,x=0,p=11+(127&l),l>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=lz;break}for(;p--;)n.lens[n.have++]=x}}if(n.mode===lz)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=lz;break}if(n.lenbits=9,T={bits:n.lenbits},w=WK(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,w){e.msg="invalid literal/lengths set",n.mode=lz;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},w=WK(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,w){e.msg="invalid distances set",n.mode=lz;break}if(n.mode=az,t===zK)break e;case az:n.mode=oz;case oz:if(o>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=o,n.hold=l,n.bits=d,MK(e,h),a=e.next_out,i=e.output,c=e.avail_out,r=e.next_in,s=e.input,o=e.avail_in,l=n.hold,d=n.bits,n.mode===sz&&(n.back=-1);break}for(n.back=0;S=n.lencode[l&(1<<n.lenbits)-1],g=S>>>24,y=S>>>16&255,v=65535&S,!(g<=d);){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(y&&0==(240&y)){for(_=g,E=y,b=v;S=n.lencode[b+((l&(1<<_+E)-1)>>_)],g=S>>>24,y=S>>>16&255,v=65535&S,!(_+g<=d);){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}l>>>=_,d-=_,n.back+=_}if(l>>>=g,d-=g,n.back+=g,n.length=v,0===y){n.mode=16205;break}if(32&y){n.back=-1,n.mode=sz;break}if(64&y){e.msg="invalid literal/length code",n.mode=lz;break}n.extra=15&y,n.mode=16201;case 16201:if(n.extra){for(C=n.extra;d<C;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;S=n.distcode[l&(1<<n.distbits)-1],g=S>>>24,y=S>>>16&255,v=65535&S,!(g<=d);){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(0==(240&y)){for(_=g,E=y,b=v;S=n.distcode[b+((l&(1<<_+E)-1)>>_)],g=S>>>24,y=S>>>16&255,v=65535&S,!(_+g<=d);){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}l>>>=_,d-=_,n.back+=_}if(l>>>=g,d-=g,n.back+=g,64&y){e.msg="invalid distance code",n.mode=lz;break}n.offset=v,n.extra=15&y,n.mode=16203;case 16203:if(n.extra){for(C=n.extra;d<C;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=lz;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=lz;break}p>n.wnext?(p-=n.wnext,m=n.wsize-p):m=n.wnext-p,p>n.length&&(p=n.length),f=n.window}else f=i,m=a-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[a++]=f[m++]}while(--p);0===n.length&&(n.mode=oz);break;case 16205:if(0===c)break e;i[a++]=n.length,c--,n.mode=oz;break;case cz:if(n.wrap){for(;d<32;){if(0===o)break e;o--,l|=s[r++]<<d,d+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=EW(n)?dH(n.check,i,h,a-h):cH(n.check,i,h,a-h)),h=c,4&n.wrap&&(EW(n)?l:dz(l))!==n.check){e.msg="incorrect data check",n.mode=lz;break}l=0,d=0}n.mode=16207;case 16207:if(n.wrap&&EW(n)){for(;d<32;){if(0===o)break e;o--,l+=s[r++]<<d,d+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=lz;break}l=0,d=0}n.mode=16208;case 16208:w=YK;break e;case lz:w=QK;break e;case 16210:return ZK;default:return JK}return e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=o,n.hold=l,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<lz&&(n.mode<cz||t!==HK))&&bz(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=EW(n)?dH(n.check,i,h,e.next_out-h):cH(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===sz?128:0)+(n.mode===az||n.mode===rz?256:0),(0===u&&0===h||t===HK)&&w===qK&&(w=$K),w},wz={inflateReset:mz,inflateReset2:fz,inflateResetKeep:pz,inflateInit:e=>gz(e,15),inflateInit2:gz,inflate:xz,inflateEnd:e=>{if(hz(e))return JK;let t=e.state;return t.window&&(t.window=null),e.state=null,qK},inflateGetHeader:(e,t)=>{if(hz(e))return JK;const n=e.state;return 0==(2&n.wrap)?JK:(n.head=t,t.done=!1,qK)},inflateSetDictionary:(e,t)=>{const n=t.length;let s,i,r;return hz(e)?JK:(s=e.state,0!==s.wrap&&s.mode!==nz?JK:s.mode===nz&&(i=1,i=cH(i,t,n,0),i!==s.check)?QK:(r=bz(e,t,n,n),r?(s.mode=16210,ZK):(s.havedict=1,qK)))},inflateInfo:"pako inflate (from Nodeca project)"},Sz=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Nz=Object.prototype.toString,{Z_NO_FLUSH:Tz,Z_FINISH:Cz,Z_OK:Rz,Z_STREAM_END:Iz,Z_NEED_DICT:Az,Z_STREAM_ERROR:Oz,Z_DATA_ERROR:kz,Z_MEM_ERROR:Dz}=hH;function Pz(e){this.options=vK.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xK,this.strm.avail_out=0;let n=wz.inflateInit2(this.strm,t.windowBits);if(n!==Rz)throw new Error(uH[n]);if(this.header=new Sz,wz.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=bK.string2buf(t.dictionary):"[object ArrayBuffer]"===Nz.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=wz.inflateSetDictionary(this.strm,t.dictionary),n!==Rz)))throw new Error(uH[n])}function jz(e,t){const n=new Pz(t);if(n.push(e),n.err)throw n.msg||uH[n.err];return n.result}Pz.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let r,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Cz:Tz,"[object ArrayBuffer]"===Nz.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),r=wz.inflate(n,a),r===Az&&i&&(r=wz.inflateSetDictionary(n,i),r===Rz?r=wz.inflate(n,a):r===kz&&(r=Az));n.avail_in>0&&r===Iz&&n.state.wrap>0&&0!==e[n.next_in];)wz.inflateReset(n),r=wz.inflate(n,a);switch(r){case Oz:case kz:case Az:case Dz:return this.onEnd(r),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||r===Iz))if("string"===this.options.to){let e=bK.utf8border(n.output,n.next_out),t=n.next_out-e,i=bK.buf2string(n.output,e);n.next_out=t,n.avail_out=s-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==Rz||0!==o){if(r===Iz)return r=wz.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Pz.prototype.onData=function(e){this.chunks.push(e)},Pz.prototype.onEnd=function(e){e===Rz&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=vK.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Lz={Inflate:Pz,inflate:jz,inflateRaw:function(e,t){return(t=t||{}).raw=!0,jz(e,t)},ungzip:jz,constants:hH};const{Deflate:Mz,deflate:Uz,deflateRaw:Vz,gzip:Fz}=jK,{Inflate:Bz,inflate:Gz,inflateRaw:Wz,ungzip:Hz}=Lz;var Kz=Uz,zz=Gz,qz=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(qz||{});class Yz{constructor(){uN(this,"_sequence",0),uN(this,"_startTime",Date.now()),uN(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const s={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[s]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;RA("SHOW_DATASTREAM2_LOG")&&aO.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),s=new Uint8Array(n),i=new DataView(n);let r=0;if(i.setUint16(r,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),r+=2,i.setUint32(r,t.commonPacketHeader.sequence,!0),r+=4,i.setUint16(r,t.commonStreamHeader,!0),r+=2,t.extension){const e=this.serializeExtension(t.extension);s.set(new Uint8Array(e),r),r+=e.byteLength}if(s.set(new Uint8Array(t.payload),r),r+=t.payload.byteLength,r!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const s=t.getUint16(n,!0);n+=2;const i={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let r,a;if(n+=4,RA("SHOW_DATASTREAM2_LOG")&&aO.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(n,!0),n+=2,i.extension){a=this.deserializeExtension(e.slice(n)),n+=2+a.length,r=e.slice(n);let t=!1;if(a.datas.length>0){const e=a.datas.find(e=>0===e.id);e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}r=t?this.decompress(r):r}else r=e.slice(8);return r}serializeExtension(e){const{profile:t,length:n,datas:s}=e,i=new ArrayBuffer(n+2),r=new Uint8Array(i),a=new DataView(i);let o=0;if(a.setUint8(o++,t),a.setUint8(o++,n),s.forEach(e=>{t?(a.setUint8(o++,e.id),a.setUint8(o++,e.length),r.set(new Uint8Array(e.data),o),o+=e.data.byteLength):(a.setUint8(o++,e.id|e.length<<4),r.set(new Uint8Array(e.data),o),o+=e.data.byteLength)}),o!==n+2)throw Error("serialize extension error, is ".concat(o,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const s=t.getUint8(n);n++;const i=t.getUint8(n);n++;const r=s===qz.TWO_BYTE,a=[],o=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);r?(e=o.getUint8(c),c++,t=o.getUint8(c),c++):(e=15&o.getUint8(c),t=o.getUint8(c)>>4,c++),t>0&&(n=o.buffer.slice(c+2,c+2+t),c+=n.byteLength),a.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:s,length:i,datas:a}}decompress(e){return zz(new Uint8Array(e))}compress(e){return Kz(new Uint8Array(e))}}const Xz={name:"DataStream",create:(e,t)=>{const n=t?new ej(e):new tj(e);return n.useDataStream(new Yz),n}};class Jz extends HR{constructor(e,t,n){super(),uN(this,"ws",void 0),uN(this,"requestId",1),uN(this,"heartBeatTimer",void 0),uN(this,"joinInfo",void 0),uN(this,"clientId",void 0),uN(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),uN(this,"onClose",e=>{this.emit("close"),this.dispose()}),uN(this,"onMessage",e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)}),this.joinInfo=e,this.clientId=t,this.ws=new JM("cross-channel-".concat(this.clientId),n),this.ws.on(BL.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(BL.CONNECTED,this.onOpen),this.ws.on(BL.ON_MESSAGE,this.onMessage),this.ws.on(BL.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new np((t,n)=>{const s=window.setTimeout(()=>{n(new fO(RR.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,i=>{window.clearTimeout(s),i.state&&0!==i.state?n(new fO(RR.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),n(new fO(RR.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new fO(RR.WS_DISCONNECT);const t=()=>new np((e,t)=>{this.ws.once(BL.CLOSED,()=>t(new fO(RR.WS_ABORT))),this.ws.once(BL.CONNECTED,e)});"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),s=new np((e,t)=>{const s=()=>{t(new fO(RR.WS_ABORT))};this.ws.once(BL.RECONNECTING,s),this.ws.once(BL.CLOSED,s),this.once("req_".concat(n),e),SI(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(BL.RECONNECTING,s),this.ws.off(BL.CLOSED,s),t(new fO(RR.TIMEOUT,"cross channel ws request timeout"))})}),i=await s;if(!i||200!==i.code)throw new fO(RR.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(BL.REQUEST_NEW_URLS),this.ws.on(BL.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Qz extends HR{set state(e){e!==this._state&&(e!==tM.RELAY_STATE_FAILURE&&(this.errorCode=nM.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,s,i){super(),uN(this,"joinInfo",void 0),uN(this,"sid",void 0),uN(this,"clientId",void 0),uN(this,"cancelToken",LC.CancelToken.source()),uN(this,"workerToken",void 0),uN(this,"requestId",0),uN(this,"signal",void 0),uN(this,"prevChannelMediaConfig",void 0),uN(this,"httpRetryConfig",void 0),uN(this,"_resolution",void 0),uN(this,"_state",tM.RELAY_STATE_IDLE),uN(this,"errorCode",nM.RELAY_OK),uN(this,"onStatus",e=>{aO.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nM.SRC_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nM.DEST_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE))}),uN(this,"onReconnect",async()=>{aO.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",eM.NETWORK_DISCONNECTED),this.state=tM.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{this.state!==tM.RELAY_STATE_IDLE&&(aO.error("auto restart channel media relay failed",e.toString()),this.errorCode=nM.SERVER_CONNECTION_LOST,this.state=tM.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=TI(),this.signal=new Jz(this.joinInfo,this.clientId,n),this.httpRetryConfig=s,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_IDLE)throw new fO(RR.INVALID_OPERATION);this.state=tM.RELAY_STATE_CONNECTING,await this.connect(),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_RUNNING)throw new fO(RR.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==tM.RELAY_STATE_RUNNING)throw new fO(RR.INVALID_OPERATION);const t=this.genMessage($L.SetVideoProfile);await this.signal.request(t),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),aO.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tM.RELAY_STATE_IDLE,this.dispose()}dispose(){aO.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=LC.CancelToken.source(),this.state=tM.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await VV(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",eM.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage($L.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage($L.SetSdkProfile,e);await this.signal.request(n),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage($L.SetSourceChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",eM.PACKET_JOINED_SRC_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage($L.SetSourceUserId,e);await this.signal.request(i),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const r=this.genMessage($L.SetDestChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",eM.PACKET_JOINED_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage($L.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",eM.PACKET_SENT_TO_DEST_CHANNEL),this.state=tM.RELAY_STATE_RUNNING,aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage($L.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",eM.PACKET_UPDATE_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage($L.StopPacketTransfer);await this.signal.request(e),aO.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],s=[],i=[];this.requestId+=1;const r={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:vA,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.24.0"===r.sdkVersion&&(r.sdkVersion="0.0.1");let a=null,o=null;switch(e){case $L.SetSdkProfile:return r.clientRequest={command:"SetSdkProfile",type:"multi_channel"},r;case $L.SetSourceChannel:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(RR.UNEXPECTED_ERROR,"can not find source config");return r.clientRequest={command:"SetSourceChannel",uid:"0",channelName:o.channelName,token:o.token||this.joinInfo.appId},r;case $L.SetSourceUserId:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(RR.UNEXPECTED_ERROR,"can not find source config");return r.clientRequest={command:"SetSourceUserId",uid:o.uid+""},r;case $L.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(RR.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),s.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),r.clientRequest={command:"SetDestChannel",channelName:n,uid:s,token:i},r;case $L.StartPacketTransfer:return r.clientRequest={command:"StartPacketTransfer"},r;case $L.Reconnect:return r.clientRequest={command:"Reconnect"},r;case $L.StopPacketTransfer:return r.clientRequest={command:"StopPacketTransfer"},r;case $L.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(RR.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),s.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),r.clientRequest={command:"UpdateDestChannel",channelName:n,uid:s,token:i},r;case $L.SetVideoProfile:r.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return r}}const Zz={name:"ChannelMediaRelay",create:function(e){return new Qz(e.joinInfo,e.clientId,e.websocketRetryConfig||FI,e.httpRetryConfig||FI,e.resolution)}};function $z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function eq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$z(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class tq extends HR{constructor(e,t,n,s){super(),uN(this,"spec",void 0),uN(this,"token",void 0),uN(this,"websocket",void 0),uN(this,"pingpongTimer",void 0),uN(this,"reconnectMode","retry"),uN(this,"serviceMode",void 0),uN(this,"reqId",0),uN(this,"commandReqId",0),uN(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),uN(this,"handleWebSocketMessage",e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(mO.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===HL.TRANSCODE?1:2}),this.emit(XL.PUBLISH_STREAM_STATUS,t))}),this.spec=t,this.token=e,this.serviceMode=s,this.websocket=new JM("live-streaming",n),this.websocket.on(BL.CONNECTED,this.handleWebSocketOpen),this.websocket.on(BL.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(BL.REQUEST_NEW_URLS,(e,t)=>{rI(this,XL.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(BL.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,n,s){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,r=this.reqId;if(!r||!this.websocket)throw new fO(RR.UNEXPECTED_ERROR);const a=eq({command:e,sdkVersion:"4.24.0"===vA?"0.0.1":vA,seq:r,requestId:r,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new fO(RR.WS_DISCONNECT);const o=()=>new np((e,t)=>{this.websocket.once(BL.CLOSED,()=>t(new fO(RR.WS_ABORT))),this.websocket.once(BL.CONNECTED,e)});"connected"!==this.websocket.state&&await o(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const c=new np((e,t)=>{const n=()=>{t(new fO(RR.WS_ABORT))};this.websocket.once(BL.RECONNECTING,n),this.websocket.once(BL.CLOSED,n),this.once("@".concat(r,"-").concat(this.spec.sid),t=>{e(t)})});s&&mO.workerEvent(this.spec.sid,eq(eq({},s),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let d=null;try{d=await c}catch(s){if("closed"===this.websocket.state)throw s;return await o(),await this.request(e,t,n)}return s&&mO.workerEvent(this.spec.sid,eq(eq({},s),{},{requestId:i,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-l})),200!==d.code&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.24.0"===vA?"0.0.1":vA;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case QL.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void aO.warning("live stream response already exists stream");case QL.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case QL.LIVE_STREAM_RESPONSE_BAD_STREAM:case QL.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new fO(RR.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case QL.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new fO(RR.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new fO(RR.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(XL.WARNING,t,e.serverResponse.url)}case QL.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new fO(RR.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(XL.WARNING,t,e.serverResponse.url)}case QL.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case QL.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new fO(RR.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new fO(RR.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(XL.WARNING,t,e.serverResponse.url)}case QL.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case QL.LIVE_STREAM_RESPONSE_WORKER_LOST:case QL.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case QL.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case QL.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new fO(RR.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(CI)},6e3)}}function nq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function sq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nq(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class iq extends HR{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FI;super(),uN(this,"onLiveStreamWarning",void 0),uN(this,"onLiveStreamError",void 0),uN(this,"spec",void 0),uN(this,"retryTimeout",1e4),uN(this,"connection",void 0),uN(this,"httpRetryConfig",void 0),uN(this,"wsRetryConfig",void 0),uN(this,"streamingTasks",new Map),uN(this,"isStartingStreamingTask",!1),uN(this,"taskMutex",new UI("live-streaming")),uN(this,"cancelToken",LC.CancelToken.source()),uN(this,"transcodingConfig",void 0),uN(this,"uapResponse",void 0),uN(this,"lastTaskId",1),uN(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=sq(sq({},YL),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(aO.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(e=>sq(sq(sq({},KL),e),{},{zOrder:e.zOrder?e.zOrder+1:1}))),function(e){LR(e.width)||kR(e.width,"config.width",0,1e4),LR(e.height)||kR(e.height,"config.height",0,1e4),LR(e.videoBitrate)||kR(e.videoBitrate,"config.videoBitrate",1,1e6),LR(e.videoFrameRate)||kR(e.videoFrameRate,"config.videoFrameRate"),LR(e.lowLatency)||AR(e.lowLatency,"config.lowLatency"),LR(e.audioSampleRate)||OR(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),LR(e.audioBitrate)||kR(e.audioBitrate,"config.audioBitrate",1,128),LR(e.audioChannels)||OR(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),LR(e.videoGop)||kR(e.videoGop,"config.videoGop"),LR(e.videoCodecProfile)||OR(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),LR(e.userCount)||kR(e.userCount,"config.userCount",0,17),LR(e.backgroundColor)||kR(e.backgroundColor,"config.backgroundColor",0,16777215),LR(e.userConfigExtraInfo)||PR(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!LR(e.transcodingUsers)&&(jR(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((e,t)=>{WL(e.uid),LR(e.x)||kR(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),LR(e.y)||kR(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),LR(e.width)||kR(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),LR(e.height)||kR(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),LR(e.zOrder)||kR(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),LR(e.alpha)||kR(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),LR(e.watermark)||qL(e.watermark,"watermark"),LR(e.backgroundImage)||qL(e.backgroundImage,"backgroundImage"),e.images&&!LR(e.images)&&(jR(e.images,"config.images"),e.images.forEach((e,t)=>{qL(e,"images[".concat(t,"]"))}))}(t);const n=[];t.images&&n.push(...t.images.map(e=>sq(sq(sq({},zL),e),{},{zOrder:255}))),t.backgroundImage&&(n.push(sq(sq(sq({},zL),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(sq(sq(sq({},zL),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(e=>sq({},e)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const s=(t.userConfigs||[]).map(e=>"number"==typeof e.uid?np.resolve(e.uid):PV(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await np.all(s)).forEach((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)}),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(up(i=this.streamingTasks).call(i)).map(e=>e.taskId).join("#")});aO.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(t=>{aO.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then(()=>{aO.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))}).catch(e=>{aO.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)})})}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===HL.TRANSCODE)throw new fO(RR.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const s={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};aO.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const i=await this.taskMutex.lock();if(!this.connection&&n)return void i();if(this.streamingTasks.get(e)&&!n)return i(),new fO(RR.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw i(),e}switch(t){case HL.TRANSCODE:s.transcodingConfig=sq({},this.transcodingConfig);case HL.RAW:}this.uapResponse&&this.uapResponse.vid&&(s.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const r=this.lastTaskId++;try{const a=new np((t,s)=>{SI(this.retryTimeout).then(()=>{if(n)return s(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),s(t)):void 0})}),o=await np.race([this.connection.request("request",{clientRequest:s},!0,{url:e,command:"PublishStream",workerType:t===HL.TRANSCODE?1:2,requestByUser:!n,tid:r.toString()}),a]);this.isStartingStreamingTask=!1,aO.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(o.code)),this.streamingTasks.set(e,{clientRequest:s,mode:t,url:e,taskId:r}),i()}catch(s){if(i(),this.isStartingStreamingTask=!1,!s.data||!s.data.retry||n)throw s;return s.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,s)):await this.startLiveStreamingTask(e,t,s)}}stopLiveStreamingTask(e){return new np((t,n)=>{const s=this.streamingTasks.get(e);if(!s||!this.connection)return new fO(RR.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=s.mode;s.abortTask=()=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:s.url}},!1,{url:e,command:"UnPublishStream",workerType:i===HL.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(n=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(n)})}resetAllTask(){var e;const t=Array.from(up(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch(e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=LC.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new fO(RR.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await rI(this,JL.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new tq(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(XL.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(XL.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(XL.REQUEST_NEW_ADDRESS,(t,n)=>{if(!this.connection)return n(new fO(RR.UNEXPECTED_ERROR,"can not get new live streaming address list"));rI(this,JL.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(n)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),s=e.reason;switch(e.code){case QL.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const s=new fO(RR.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return aO.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,s);if(!this.isStartingStreamingTask)return;this.statusError.set(t,s)}case QL.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new fO(RR.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case QL.LIVE_STREAM_RESPONSE_WORKER_LOST:case QL.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(up(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(aO.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{aO.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)}).catch(e=>{aO.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const rq={name:"LiveStreaming",create:function(e){return new iq(e.joinInfo,e.websocketRetryConfig||FI,e.httpRetryConfig||FI)}};function aq(e){let t=yq();return function(e,t){let n=e.appId;void 0!==n&&(Oq(t,10),Sq(t,n));let s=e.cid;void 0!==s&&(Oq(t,16),Oq(t,s));let i=e.cname;void 0!==i&&(Oq(t,26),Sq(t,i));let r=e.deviceId;void 0!==r&&(Oq(t,34),Sq(t,r));let a=e.elapse;void 0!==a&&(Oq(t,40),kq(t,a));let o=e.fileSize;void 0!==o&&(Oq(t,48),kq(t,fq(o)));let c=e.height;void 0!==c&&(Oq(t,56),kq(t,fq(c)));let l=e.jpg;void 0!==l&&(Oq(t,66),Oq(t,l.length),function(e,t){let n=bq(e,t.length);e.bytes.set(t,n)}(t,l));let d=e.networkType;void 0!==d&&(Oq(t,72),kq(t,fq(d)));let u=e.osType;void 0!==u&&(Oq(t,80),kq(t,fq(u)));let h=e.requestId;void 0!==h&&(Oq(t,90),Sq(t,h));let p=e.sdkVersion;void 0!==p&&(Oq(t,98),Sq(t,p));let m=e.sequence;void 0!==m&&(Oq(t,104),kq(t,fq(m)));let f=e.sid;void 0!==f&&(Oq(t,114),Sq(t,f));let g=e.timestamp;void 0!==g&&(Oq(t,120),kq(t,g));let y=e.uid;void 0!==y&&(Oq(t,128),Oq(t,y));let v=e.vid;void 0!==v&&(Oq(t,136),Oq(t,v));let _=e.width;void 0!==_&&(Oq(t,144),kq(t,fq(_)));let E=e.service;void 0!==E&&(Oq(t,152),Oq(t,E));let b=e.callbackData;void 0!==b&&(Oq(t,162),Sq(t,b));let x=e.jpgEncryption;void 0!==x&&(Oq(t,168),Oq(t,x));let w=e.requestType;void 0!==w&&(Oq(t,176),Oq(t,w));let S=e.scorePorn;void 0!==S&&(Oq(t,185),Iq(t,S));let N=e.scoreSexy;void 0!==N&&(Oq(t,193),Iq(t,N));let T=e.scoreNeutral;void 0!==T&&(Oq(t,201),Iq(t,T));let C=e.scene;void 0!==C&&(Oq(t,208),Oq(t,C));let R=e.ossFilePrefix;void 0!==R&&(Oq(t,218),Sq(t,R));let I=e.serviceVendor;if(void 0!==I)for(let A of I){Oq(t,226);let e=yq();lq(A,e),Oq(t,e.limit),Nq(t,e),vq(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function oq(e){return function(e){let t={};e:for(;!Eq(e);){let n=Aq(e);switch(n>>>3){case 0:break e;case 1:t.code=Aq(e);break;case 2:t.msg=wq(e,Aq(e));break;case 3:{let n=dq(e);t.data=cq(e),e.limit=n;break}default:uq(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function cq(e){let t={};e:for(;!Eq(e);){let n=Aq(e);switch(n>>>3){case 0:break e;case 1:t.requestId=wq(e,Aq(e));break;case 2:t.requestType=Aq(e)>>>0;break;case 3:t.scorePorn=Rq(e);break;case 4:t.scoreSexy=Rq(e);break;case 5:t.scoreNeutral=Rq(e);break;case 6:t.requestScene=Aq(e)>>>0;break;case 7:t.scene=Aq(e)>>>0;break;default:uq(e,7&n)}}return t}function lq(e,t){let n=e.service;void 0!==n&&(Oq(t,8),Oq(t,n));let s=e.vendor;void 0!==s&&(Oq(t,16),Oq(t,s));let i=e.token;void 0!==i&&(Oq(t,26),Sq(t,i));let r=e.callbackUrl;void 0!==r&&(Oq(t,34),Sq(t,r))}function dq(e){let t=Aq(e),n=e.limit;return e.limit=e.offset+t,n}function uq(e,t){switch(t){case 0:for(;128&Tq(e););break;case 2:_q(e,Aq(e));break;case 5:_q(e,4);break;case 1:_q(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let hq=new Float32Array(1);new Uint8Array(hq.buffer);let pq=new Float64Array(1),mq=new Uint8Array(pq.buffer);function fq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let gq=[];function yq(){const e=gq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function vq(e){gq.push(e)}function _q(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Eq(e){return e.offset>=e.limit}function bq(e,t){let n=e.bytes,s=e.offset,i=e.limit,r=s+t;if(r>n.length){let t=new Uint8Array(2*r);t.set(n),e.bytes=t}return e.offset=r,r>i&&(e.limit=r),s}function xq(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function wq(e,t){let n=xq(e,t),s=String.fromCharCode,i=e.bytes,r="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=i[o+n];0==(128&u)?a+=s(u):192==(224&u)?o+1>=t?a+=r:(e=i[o+n+1],128!=(192&e)?a+=r:(d=(31&u)<<6|63&e,d<128?a+=r:(a+=s(d),o++))):224==(240&u)?o+2>=t?a+=r:(e=i[o+n+1],c=i[o+n+2],32896!=(49344&(e|c<<8))?a+=r:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=r:(a+=s(d),o+=2))):240==(248&u)?o+3>=t?a+=r:(e=i[o+n+1],c=i[o+n+2],l=i[o+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=r:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=r:(d-=65536,a+=s(55296+(d>>10),56320+(1023&d)),o+=3))):a+=r}return a}function Sq(e,t){let n=t.length,s=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),s+=e<128?1:e<2048?2:e<65536?3:4}Oq(e,s);let i=bq(e,s),r=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?r[i++]=e:(e<2048?r[i++]=e>>6&31|192:(e<65536?r[i++]=e>>12&15|224:(r[i++]=e>>18&7|240,r[i++]=e>>12&63|128),r[i++]=e>>6&63|128),r[i++]=63&e|128)}}function Nq(e,t){let n=bq(e,t.limit),s=e.bytes,i=t.bytes;for(let r=0,a=t.limit;r<a;r++)s[r+n]=i[r]}function Tq(e){return e.bytes[xq(e,1)]}function Cq(e,t){let n=bq(e,1);e.bytes[n]=t}function Rq(e){let t=xq(e,8),n=e.bytes;return mq[0]=n[t++],mq[1]=n[t++],mq[2]=n[t++],mq[3]=n[t++],mq[4]=n[t++],mq[5]=n[t++],mq[6]=n[t++],mq[7]=n[t++],pq[0]}function Iq(e,t){let n=bq(e,8),s=e.bytes;pq[0]=t,s[n++]=mq[0],s[n++]=mq[1],s[n++]=mq[2],s[n++]=mq[3],s[n++]=mq[4],s[n++]=mq[5],s[n++]=mq[6],s[n++]=mq[7]}function Aq(e){let t,n=0,s=0;do{t=Tq(e),n<32&&(s|=(127&t)<<n),n+=7}while(128&t);return s}function Oq(e,t){for(t>>>=0;t>=128;)Cq(e,127&t|128),t>>>=7;Cq(e,t)}function kq(e,t){let n=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,r=0===i?0===s?n<16384?n<128?1:2:n<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:i<128?9:10,a=bq(e,r),o=e.bytes;switch(r){case 10:o[a+9]=i>>>7&1;case 9:o[a+8]=9!==r?128|i:127&i;case 8:o[a+7]=8!==r?s>>>21|128:s>>>21&127;case 7:o[a+6]=7!==r?s>>>14|128:s>>>14&127;case 6:o[a+5]=6!==r?s>>>7|128:s>>>7&127;case 5:o[a+4]=5!==r?128|s:127&s;case 4:o[a+3]=4!==r?n>>>21|128:n>>>21&127;case 3:o[a+2]=3!==r?n>>>14|128:n>>>14&127;case 2:o[a+1]=2!==r?n>>>7|128:n>>>7&127;case 1:o[a]=1!==r?128|n:127&n}}function Dq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}const Pq=new Map([["moderation",1],["supervise",2]]);class jq extends HR{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(SM.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=ii(t=e.map(e=>Pq.get(e)||0)).call(t,(e,t)=>e+t),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),uN(this,"name","AgoraRTCVideoContentInspect"),uN(this,"_connectionState",xM.CONNECTING),uN(this,"_innerConnectionState",void 0),uN(this,"sequence",0),uN(this,"inspectStartTime",void 0),uN(this,"workerManagerConnection",void 0),uN(this,"workerConnection",void 0),uN(this,"workerMessageLengthLimit",void 0),uN(this,"inspectIntervalMinimum",void 0),uN(this,"qualityRatio",void 0),uN(this,"_connectInfo",void 0),uN(this,"_cancelTokenSource",LC.CancelToken.source()),uN(this,"_retryConfig",void 0),uN(this,"wmSequence",0),uN(this,"inspectInterval",void 0),uN(this,"inspectTimer",null),uN(this,"ossFilePrefix",void 0),uN(this,"extraInfo",void 0),uN(this,"_inspectType",void 0),uN(this,"_inspectMode",void 0),uN(this,"_quality",1),uN(this,"qualityTimer",null),uN(this,"_inspectId",void 0),uN(this,"_needWorkUrlOnly",!1),uN(this,"inspectImage",()=>{if(this.connectionState!==xM.CONNECTED)throw new fO(RR.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===xM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=NI(5,"inspect-"),this.workerMessageLengthLimit=RA("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=RA("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=RA("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new JM("worker-manager-"+this._inspectId,FI),this.on(SM.STATE_CHANGE,(e,t)=>{this._innerConnectionState=e,aO.debug("[".concat(this._inspectId,"] Inspect operation :").concat(wM[e]," ").concat(t||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new JM("worker-"+this._inspectId,FI),this.handleWorkerEvents()}async init(e,t){this.emit(SM.STATE_CHANGE,wM.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np((s,i)=>{this.on(SM.CONNECTION_STATE_CHANGE,(e,t)=>{t===xM.CONNECTED&&s()}),this.requestAP(e,n,t).then(e=>{this.connectWorkerManager(e)}).catch(e=>{i(e)})})}async requestAP(e,t,n){const s=RA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),i=await function(e,t,n,s){let{appId:i,areaCode:r,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="image_moderation_api",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:r,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,token:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GI(async()=>{h=Date.now();const e=await rV(m,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const s=RA("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=RA("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(s,":").concat(i||n)}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,responseTime:p}},(t,n)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==RR.OPERATION_ABORTED&&t.code!==RR.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)),s)}(s,e,t,n);this.emit(SM.STATE_CHANGE,wM.AP_CONNECTED);const{addressList:r}=i;return this.wmSequence++,r}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(SM.STATE_CHANGE,wM.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(BL.CONNECTED,async()=>{this.emit(SM.STATE_CHANGE,wM.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(BL.CLOSED,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(BL.FAILED,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(BL.RECONNECTING,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(BL.ON_MESSAGE,async e=>{this.emit(SM.STATE_CHANGE,wM.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw aO.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new fO(RR.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw aO.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new fO(RR.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=RA("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,s=t.replace(/:\d+\/?$/,":".concat(e));this.emit(SM.STATE_CHANGE,wM.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(SM.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(BL.WILL_RECONNECT,(e,t,n)=>{n(e)}),this.workerManagerConnection.on(BL.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(BL.CONNECTED,async()=>{this.emit(SM.STATE_CHANGE,wM.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=xM.CONNECTED}),this.workerConnection.on(BL.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=oq(new Uint8Array(e.data));if(RA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&aO.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(SM.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},s=ii(t=Object.keys(e)).call(t,(t,n)=>e[t]>e[n]?t:n,"porn"),i=Object.keys(e).find(e=>e===s);this.emit(SM.INSPECT_RESULT,i)}else this.emit(SM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(SM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else aO.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(SM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(BL.CLOSED,()=>{this.connectionState=xM.CLOSED}),this.workerConnection.on(BL.FAILED,()=>{this.connectionState=xM.CLOSED}),this.workerConnection.on(BL.RECONNECTING,()=>{this.connectionState=this.connectionState===xM.CONNECTED?xM.RECONNECTING:xM.CONNECTING}),this.workerConnection.on(BL.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this.workerConnection.on(BL.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(SM.REQUEST_NEW_WORKER_URL,t=>{e([t])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e=>{this.connectWorkerManager(e,!0)}).catch(e=>{t(e)})})}async requestToInspectImage(){this.sequence++;const e=oI(this,SM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(SM.INSPECT_RESULT,void 0,new fO(RR.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(SM.INSPECT_RESULT,void 0,new fO(RR.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:s,cid:i,vid:r,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await Qk(l,n,s),u=this.sequence+"-"+i+"-"+o+"-"+c+"-"+NI(12,""),h={appId:n,cid:i,cname:s,deviceId:"",elapse:(p=Number(c-this.inspectStartTime),{low:p|=0,high:p>>31,unsigned:p>=0}),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this.sequence,sid:a,timestamp:uG(c),uid:o,vid:r,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var p;void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const m=aq(h);if(m.byteLength<this.workerMessageLengthLimit){if(RA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dq(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return m}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:s,cid:i,vid:r,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=LC.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=xM.CLOSED,this.emit(SM.STATE_CHANGE,wM.CLOSED)}}const Lq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new fO(RR.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new fO(RR.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach(e=>{var t;if(!Ps(t=["supervise","moderation"]).call(t,e))throw new fO(RR.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(RR.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new jq(t)}};var Mq=s(ee.Object.getOwnPropertySymbols),Uq=On,Vq=Jn.indexOf,Fq=Hs,Bq=N([].indexOf),Gq=!!Bq&&1/Bq([1],1,-0)<0;Uq({target:"Array",proto:!0,forced:Gq||!Fq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Gq?Bq(this,e,t)||0:Vq(this,e,t)}});var Wq=es("Array","indexOf"),Hq=u,Kq=Wq,zq=Array.prototype,qq=function(e){var t=e.indexOf;return e===zq||Hq(zq,e)&&t===zq.indexOf?Kq:t},Yq=s(qq);function Xq(e,t){if(null==e)return{};var n,s,i=function(e,t){if(null==e)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(-1!==Yq(t).call(t,s))continue;n[s]=e[s]}return n}(e,t);if(Mq){var r=Mq(e);for(s=0;s<r.length;s++)n=r[s],-1===Yq(t).call(t,n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let Jq=class{get localCapabilities(){return pI(this._localCapabilities)}get rtpCapabilities(){return pI(this._rtpCapabilities)}get candidates(){return pI(this._candidates)}get iceParameters(){return pI(this._iceParameters)}get dtlsParameters(){return pI(this._dtlsParameters)}constructor(e){uN(this,"sessionDesc",void 0),uN(this,"_localCapabilities",void 0),uN(this,"_rtpCapabilities",void 0),uN(this,"_candidates",void 0),uN(this,"_iceParameters",void 0),uN(this,"_dtlsParameters",void 0),uN(this,"setup",void 0),uN(this,"currentMidIndex",void 0),uN(this,"cname","o/i14u9pJrxRKAsu"),uN(this,"firefoxSsrcMidMap",new Map),e=pI(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:s,remoteRTPCapabilities:i,localCapabilities:r,direction:a,setup:o,videoCodec:c,audioCodec:l}=e;let d;this.setup=o,d=a===FL.RECEIVE_ONLY?VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=i,this._candidates=s,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=r;const u=a===FL.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===FL.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===FL.RECEIVE_ONLY?i.send.videoCodecs:UU(fM.VIDEO,u,h,c),m=a===FL.RECEIVE_ONLY?i.send.audioCodecs:UU(fM.AUDIO,u,h,l);for(const f of d.mediaDescriptions)f.attributes.iceUfrag=t.iceUfrag,f.attributes.icePwd=t.icePwd,f.attributes.fingerprints=n.fingerprints,f.attributes.candidates=s,f.attributes.setup=this.setup,"application"===f.media.mediaType&&(f.attributes.sctpPort="5000"),"video"===f.media.mediaType&&(f.media.fmts=p.map(e=>e.payloadType.toString(10)),f.attributes.payloads=p,f.attributes.extmaps=u.videoExtensions),"audio"===f.media.mediaType&&(f.media.fmts=m.map(e=>e.payloadType.toString(10)),f.attributes.payloads=m,f.attributes.extmaps=u.audioExtensions,MU(f));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return FA(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,s,i){n=n.replace(/ /g,"-");const{ssrcs:r,ssrcGroups:a}=TU(t,this.cname,RA("SYNC_GROUP")?n:void 0),o=this.findPreloadMediaDesc(r);if(o){if(nR()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,o.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(o,i),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,r,s);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,r,a,"sendonly",s,i),this.updateBundleMids()):(n=pI(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=r,n.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),nR()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{e.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const s=[];return e.forEach(e=>{const i=e._mediaStreamTrack.kind,r=this.findAvailableRecvMediaIndex(i);let a,o=!1;-1===r?(o=!0,a=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(a=pI(this.sessionDesc.mediaDescriptions[r]),a.attributes.direction="recvonly"),s.push({mid:a.attributes.mid,needCreateTransceiver:o})}),s}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:s,port:i,type:r,relatedAddress:a,relatedPort:o,priority:c}=new RTCIceCandidate(e),l={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=s?s:"",port:i?i+"":"",type:r?r+"":"",relAddr:null!=a?a:"",relPort:o?o+"":"",extension:{}};this.candidates.some(e=>e.priority===l.priority&&e.connectionAddress===l.connectionAddress&&e.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,s,i){const r=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,o=UU(r,a,this.localCapabilities.send,r===fM.AUDIO?i:s),c=r===fM.VIDEO?a.videoExtensions:a.audioExtensions,l="".concat(++this.currentMidIndex);let d={media:{mediaType:r,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);const u=this.findFirstClosedMedia(r);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Ps(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Ps(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const i=s.media.mediaType===e&&"0"!==s.media.port&&("sendonly"===s.attributes.direction||"sendrecv"===s.attributes.direction)&&0===s.attributes.ssrcs.length;if(nR()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==s.attributes.mid&&"1"!==s.attributes.mid)||!(!e||e!==s.attributes.mid)}return!1}return i&&s.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=pI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,s,i,r){const a=this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;nR()&&(i="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:i}};l=this.mungSendMediaDesc(l,r);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,n){const s=pI(e);return RU(s),CU(s,t),IU(s,t),AU(s),OU(s,n,this.localCapabilities.send),s}mungSendMediaDesc(e,t){const n=pI(e);return OU(n,t,this.localCapabilities.recv),MU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>nR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}};const Qq=["sdp"];var Zq;function $q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function eY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$q(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let tY=(Zq=class e extends pM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,s){super(t,n),uN(this,"direction",void 0),uN(this,"name",void 0),uN(this,"store",void 0),uN(this,"spec",void 0),uN(this,"peerConnection",void 0),uN(this,"initialOffer",void 0),uN(this,"transport",void 0),uN(this,"statsFilter",void 0),uN(this,"localCandidateCount",0),uN(this,"_isInRestartIce",!1),uN(this,"mutex",void 0),uN(this,"onLocalCandidate",void 0),uN(this,"remoteSDP",void 0),uN(this,"pendingCandidates",[]),uN(this,"localCapabilities",void 0),uN(this,"isReady",!1),uN(this,"restartCnt",0),uN(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new UI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=s?s:FL.SEND_ONLY,this.name=this.direction===FL.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,nR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await DU();if(this.localCapabilities=LU(t),e){const{sdp:t}=e,n=Xq(e,Qq),s=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(jU(t,e,"videoExtensions",n,s,i),jU(t,e,"videoCodecs",n,s,i),jU(t,e,"audioExtensions",n,s,i),jU(t,e,"audioCodecs",n,s,i),RA("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&RA("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:s,sendrecv:i}}({},{},t);this.remoteSDP=new Jq({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const r=xU(i.sdp);await this.peerConnection.setLocalDescription(i);const a=await PU({},{},i.sdp);this.localCapabilities=LU(a);const o=this.peerConnection.getTransceivers()[0];return null!=o&&o.receiver&&o.receiver.transport&&this.tryBindTransportEvents(o.receiver.transport),eY(eY({},r),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=xU(e.sdp);return this.initialOffer=e,eY(eY({},t),{},{sdp:e.sdp})}}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:s}=e,i=await PU({},{},t);this.remoteSDP=new Jq({remoteIceParameters:n,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const r=this.peerConnection.getTransceivers()[0];null!=r&&r.sender&&r.sender.transport&&this.tryBindTransportEvents(r.sender.transport)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(e=>{this.peerConnection.addIceCandidate(e)}),this.pendingCandidates=[])}catch(e){throw new IR(RR.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var s=this;return YT(function*(){const i=yield JT(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],r=s.remoteSDP.receive(e,t,n);e.forEach((e,t)=>{if(r[t].needCreateTransceiver){const t=s.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{const n=s.peerConnection.getTransceivers().find(e=>e.mid===r[t].mid);if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(r[t].mid));i.push(n),e._updateRtpTransceiver(n)}}),nR()&&!0===RA("SIMULCAST")&&(yield JT(s.applySimulcastForFirefox(i,e)));const a=r.map(e=>e.mid),o=yield JT(s.peerConnection.createOffer()),c=s.mungSendOfferSDP(o.sdp,e,a),l=VA(c),d=a.map(e=>{const t=l.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(t,RA("USE_PUB_RTX"))}),u=i.map((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}});yield JT(s.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield u}catch(e){const n=s.remoteSDP.toString();throw yield JT(s.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JT(s.peerConnection.setRemoteDescription({type:"answer",sdp:n})),yield JT(s.stopSending(a,!0)),e}yield JT(s.applySimulcastEncodings(i,e)),yield JT(s.applySendEncodings(i,e));const h=s.remoteSDP.toString(),p=s.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield JT(s.setRemoteDescription({type:"answer",sdp:h})),i.map((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}})}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map(e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),s=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==s||s(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:r}=this.remoteSDP.send(e,t,n,s);if(r){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer(),r=this.mungReceiveAnswerSDP(s.sdp,i,e);null==n||n(r||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:r}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(e=>e.mid===i);if(!a||null===a.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:r}=this.remoteSDP.send(e,t,n,s);if(r){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer(),r=this.mungReceiveAnswerSDP(s.sdp,i,e);null==n||n(r||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:r}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();null==n||n(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===EA.Auto&&(this.store.p2pTransport=EA.SdRtn,yO().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,yO().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=xU(e.sdp);return this.store.descriptionStart(),this.direction===FL.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===FL.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=xU(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?nR()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:s}=t.getSelectedCandidatePair();return{local:eY(eY({},$I),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:eY(eY({},$I),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Ps(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={iceServers:[]};var r;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZR(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,s)),RA("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,s)),Ps(r=[EA.Relay,EA.SdRtn]).call(r,n)&&(i.iceTransportPolicy="relay"),RA("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(i.iceTransportPolicy="relay")}))),RA("ENABLE_ENCODED_TRANSFORM")&&yO().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),aO.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=[],i=e.filter(e=>e.tcpport);aO.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));const r=i.length>n?i[n]:i[0];switch(t){case EA.SdRtn:const t=e.filter(e=>{var t;return Ps(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL}),i=t.length>n?t[n]:t[0];i&&(s.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(nU(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),s.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(nU(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case EA.Relay:r&&(s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=udp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(nU(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}));break;default:r&&(s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=udp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(nU(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"stun:".concat(r.turnServerURL,":").concat(r.tcpport)}))}return s}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair()||{};if(e&&n){const t=e.address+":"+e.port,s=n.address+":"+n.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(t)),", remote ").concat(JSON.stringify(hU(s))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!yO().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},i={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(e._encoderConfig){var r;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:s}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Ps(r=e._hints).call(r,UO.LOW_STREAM)&&(n&&(i.maxFramerate=rU(n)),s&&s>=1&&(i.scaleResolutionDownBy=s))}if(RA("DSCP_TYPE")&&xR()){var a;const e=RA("DSCP_TYPE");Ps(a=["very-low","low","medium","high"]).call(a,e)&&(i.networkPriority=e)}const o=t.getParameters(),c=null===(n=o.encodings)||void 0===n?void 0:n[0];nR()&&!c&&(s.encodings=[i]),c&&Object.assign(c,i),Object.assign(o,s),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await t.setParameters(o)}async applySendEncodings(e,t){try{if(!yO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const s=e[n],i=t[n];i instanceof PP&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,s.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const s=VA(e);return t.forEach((e,t)=>{const i=n[t],r=s.mediaDescriptions.find(e=>e.attributes.mid===i);r&&(CU(r,e),kU(r,e,this.store.codec))}),FA(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var s;null===(s=this.onFirstVideoDecoded)||void 0===s||s.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var n,s,i,r,a;const c=e[o],l=t[o];if(l instanceof PP&&!Ps(n=l._hints).call(n,UO.LOW_STREAM)&&null!==(s=l._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(r=l._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nR()&&e.length===t.length)for(let n=0;n<e.length;n++){const s=t[n];if(s instanceof PP&&this.isVP8Simulcast(s)){const t=e[n],i={},r={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:r.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:r.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,s,i,r;return!!(e instanceof PP&&RA("SIMULCAST")&&"vp8"===this.store.codec&&!Ps(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(s=e._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(r=e._scalabilityMode)||void 0===r?void 0:r.numSpatialLayers)>1)}logSDPExchange(e,t,n,s){if(RA("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(s,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",s)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),s=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==s||s(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async e=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),s=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==s||s(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n;if(t=null!=t?t:null===(n=this.currentRemoteDescription)||void 0===n?void 0:n.sdp){var s;const n=null===(s=VA(t).mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===s?void 0:s.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Ps(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const s=VA(e),i=s.mediaDescriptions.find(e=>e.attributes.mid===t);return i&&n===fM.AUDIO&&"audio"===i.media.mediaType&&MU(i),FA(s)}},IL(Zq.prototype,"establish",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"establish"),Zq.prototype),IL(Zq.prototype,"connect",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"connect"),Zq.prototype),IL(Zq.prototype,"receive",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"receive"),Zq.prototype),IL(Zq.prototype,"mockReceive",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"mockReceive"),Zq.prototype),IL(Zq.prototype,"stopReceiving",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"stopReceiving"),Zq.prototype),IL(Zq.prototype,"restartICE",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"restartICE"),Zq.prototype),IL(Zq.prototype,"close",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"close"),Zq.prototype),IL(Zq.prototype,"updateEncoderConfig",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateEncoderConfig"),Zq.prototype),IL(Zq.prototype,"updateSendParameters",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateSendParameters"),Zq.prototype),IL(Zq.prototype,"replaceTrack",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"replaceTrack"),Zq.prototype),IL(Zq.prototype,"muteLocal",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"muteLocal"),Zq.prototype),IL(Zq.prototype,"unmuteLocal",[nY],Object.getOwnPropertyDescriptor(Zq.prototype,"unmuteLocal"),Zq.prototype),Zq);function nY(e,t,n){const s=e[t];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return await s.apply(this,r)}finally{n()}},n}let sY=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var iY,rY,aY,oY,cY,lY,dY,uY,hY,pY,mY,fY;function gY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function yY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gY(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let vY=(iY=_Y(sY.SEND_ONLY),rY=_Y(sY.SEND_ONLY),aY=_Y(),oY=_Y(sY.RECEIVE_ONLY),cY=_Y(sY.RECEIVE_ONLY),lY=_Y(sY.RECEIVE_ONLY),dY=_Y(sY.RECEIVE_ONLY),uY=_Y(sY.RECEIVE_ONLY),hY=_Y(sY.RECEIVE_ONLY),pY=_Y(),mY=_Y(sY.RECEIVE_ONLY),fY=class extends HR{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(bM.StateChange,t,this._state)}constructor(e,t){super(),uN(this,"isPlanB",!1),uN(this,"store",void 0),uN(this,"statsUploader",void 0),uN(this,"sendConnection",void 0),uN(this,"recvConnection",void 0),uN(this,"localTrackMap",new Map),uN(this,"remoteUserMap",new Map),uN(this,"localDataChannels",[]),uN(this,"pendingLocalTracks",[]),uN(this,"pendingRemoteTracks",[]),uN(this,"statsCollector",void 0),uN(this,"dtlsFailedCount",0),uN(this,"sendMutex",void 0),uN(this,"recvMutex",void 0),uN(this,"_state",EM.Disconnected),uN(this,"_restartStates",["disconnected","failed"]),uN(this,"reconnectInterval",void 0),uN(this,"uploadUnplinkStarted",!1),uN(this,"uploadDownlinkStarted",!1),uN(this,"uplinkStateUploadInterval",void 0),uN(this,"downlinkStatsUploadInterval",void 0),uN(this,"handleMuteLocalTrack",async(e,t,n)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const s=this.filterTobeMutedTracks(e);if(0===s.length)return void t();const a=s.find(e=>"videoLowTrack"===e[0]);a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(s.map(e=>{let[,{id:t}]=e;return t}));let o=!1;var i,r;o="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(_M.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(r=this.localTrackMap.get(_M.LocalVideoTrack))||void 0===r?void 0:r.id);const c=this.createMuteMessage(s);await aI(this,bM.RequestMuteLocal,c);const l="video"===e.trackMediaType?kM.MUTE_LOCAL_VIDEO:kM.MUTE_LOCAL_AUDIO;await aI(this,bM.RequestP2PMuteLocal,{action:l,message:c,isMuteAll:o}),t()}catch(e){n(e)}finally{s()}}),uN(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==EM.Connected)return void n(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const s=this.filterTobeUnmutedTracks(e);if(0===s.length)return void t();await this.sendConnection.unmuteLocal(s.map(e=>{let[,{id:t}]=e;return t}));const i=this.createUnmuteMessage(s),r="video"===e.trackMediaType?kM.UNMUTE_LOCAL_VIDEO:kM.UNMUTE_LOCAL_AUDIO;await aI(this,bM.RequestP2PMuteLocal,{action:r,message:i}),t()}catch(e){n(e)}finally{s()}}),uN(this,"handleUpdateVideoEncoder",async(e,t,n,s)=>{let i;"boolean"==typeof s&&s||(i=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:s,track:i}=n;s&&(await this.sendConnection.updateSendParameters(s,i),await this.sendConnection.updateEncoderConfig(s,i),this.emit(bM.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{var r;null===(r=i)||void 0===r||r()}}),uN(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(_M.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==EM.Connected)return void t();const{id:s,track:i}=n;s&&await this.sendConnection.updateSendParameters(s,i),t()}catch(e){n(e)}finally{s()}}),uN(this,"handleReplaceTrack",async(e,t,n,s)=>{let i;aO.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof s&&s||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var r;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.sendConnection||!n||void 0===n[1].id||this.state!==EM.Connected)return void t();if(await(null===(r=this.sendConnection)||void 0===r?void 0:r.replaceTrack(e,n[1].id)),n[0]===_M.LocalVideoTrack&&yO().supportDualStreamEncoding){const t=this.localTrackMap.get(_M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}}),uN(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uN(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uN(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uN(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(e),this.bindStatsUploaderEvents(),this.sendMutex=new UI("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new UI("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))})},RA("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new tY(e,this.store,FL.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(t);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=EM.New,this.sendConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new tY(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EM.Connected}async addRemoteCandidate(e,t){if(t===FL.RECEIVE_ONLY){if(!this.sendConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var s=this;return YT(function*(){const i=yield JT(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==EM.Connected){s.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===s.pendingLocalTracks.indexOf(e));return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(t))}s.store.pubId=s.store.pubId+1,zV.markPublishStart(s.store.clientId,s.store.pubId);const i=s.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield JT(s.tryToUnmuteAudio(e)));i.forEach(e=>{let{track:t,type:n}=e;const i=Date.now();s.store.publish(t.getTrackId(),n===_M.LocalAudioTrack?"audio":"video",i)}),s.bindLocalTrackEvents(i);const r=yield JT(s.sendConnection.send(i.map(e=>{let{track:t}=e;return t}),s.store.codec,s.store.audioCodec)),a=(yield JT(r.next())).value,o=s.createGatewayPublishMessage(i,a);try{yield o}catch(e){throw r.throw(e),(null==e?void 0:e.code)===RR.WS_ABORT&&i.forEach(e=>{let{track:t}=e;-1===s.pendingLocalTracks.indexOf(t)&&s.pendingLocalTracks.push(t)}),s.unbindLocalTrackEvents(i),e}yield JT(r.next()),i.forEach(e=>{let{type:t}=e;s.statsCollector.addLocalStats(t)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(i,a),i.forEach(e=>{let{track:t,type:n}=e;const i=Date.now();s.store.publish(t.getTrackId(),n===_M.LocalAudioTrack?"audio":"video",void 0,i)}),s.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==EM.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(t=>!Ps(e).call(e,t)));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);n&&n[1].track.close();const s=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===EM.Connected)return n&&n[1].track.close(),s;e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[s,{track:i,ssrcs:r}]=n;const a={stream_type:gF(i,s),ssrcs:r};i._muted||!i._enabled?e.push(a):t.push(a)}),e.length>0&&e.forEach(e=>{aI(this,bM.RequestMuteLocal,[e])}),t.length>0&&t.forEach(e=>{aI(this,bM.RequestUnmuteLocal,[e])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return YT(function*(){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await rI(this,bM.RequestRePublish,this.pendingLocalTracks),this.emit(bM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,s){var i;if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:r,mid:a,transceiver:o}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),s);t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(r):(e._audioTrack=new QP(r,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),o&&e._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(r):(e._videoTrack=new JP(r,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),o&&e._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex(n=>{let{user:s,kind:i}=n;return s.uid===e.uid&&t===i});-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(bM.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,s){if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),s)}async unsubscribe(e,t,n){const s=this.pendingRemoteTracks.filter(n=>{let{user:s,kind:i}=n;return void 0!==t?s.uid===e.uid&&t===i:s.uid===e.uid});if(s.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.recvConnection||n||s.forEach(t=>{let{kind:n}=t;var s;if(n===fM.AUDIO)null===(s=e._audioTrack)||void 0===s||s._destroy(),e._audioTrack=void 0;else if(n===fM.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map(e=>{let[,{id:t}]=e;return t})),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(e=>{let[t,{kind:s}]=e;var i,r;if(s===fM.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),s===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0);else if(s===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),i.forEach(e=>{let[,{kind:t}]=e;aI(this,bM.RequestP2PMuteRemote,t)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[fM.VIDEO,fM.AUDIO].forEach(e=>{t.has(e)?aI(this,bM.RequestP2PUnmuteRemote,e):aI(this,bM.RequestP2PMuteRemote,e)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==s&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(_M.LocalAudioTrack);if((null==t?void 0:t.track)instanceof WD){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==_M.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===_M.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}reportPublishEvent(e,t,n,s,i){if(e){const n=this.localTrackMap.get(_M.LocalAudioTrack),r=s?this.localTrackMap.get(_M.LocalVideoLowTrack):this.localTrackMap.get(_M.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==r?void 0:r.track.getTrackLabel(),screenshare:-1!==(null==r?void 0:r.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!n,video:!!r,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var r;n||(n=[]);const a=n.find(e=>e instanceof FD),o=s?null===(r=this.localTrackMap.get(_M.LocalVideoTrack))||void 0===r?void 0:r.track:n.find(e=>e instanceof PP);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,s){const i=s===fM.VIDEO?n._videoSSRC:n._audioSSRC;i&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===fM.VIDEO,audio:s===fM.AUDIO,peerid:n.uid,subscribeRequestid:s===fM.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,i)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new UI("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new UI("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(_M.LocalAudioTrack);if((null==e?void 0:e.track)instanceof WD){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=EM.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof PP||t&&t.track instanceof FD?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(_M.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=EM.Reconnecting,RA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:s}]=e;switch(n){case _M.LocalVideoTrack:Ps(t=s._hints).call(t,UO.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case _M.LocalAudioTrack:s instanceof WD?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case _M.LocalVideoLowTrack:}}),this.emit(bM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(bM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:s,kind:i}=n;if((e instanceof ZV?e.uid:e)===s.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,s;if(e===FL.SEND_ONLY){if(!this.sendConnection)throw new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(t){const e=await s.restartICE(t);return s.isInRestartIce=!1,e}{const e=await s.restartICE();if(e){const t=await rI(this,bM.RequestP2PRestartICE,{direction:FL.RECEIVE_ONLY,iceParameter:e});await s.restartICE(t),s.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalAudioTrack),s=e.videoSend.find(e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)}),i=e.audioSend.find(e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)});if(!s||!i)return 1;const r=oI(this,bM.NeedSignalRTT),a=s?s.rttMs:void 0,o=i?i.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&r?(c+r)/2:c||r)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return Gj[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[s]=n;const i=s._audioSSRC,r=s._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===i),o=e.videoRecv.find(e=>e.ssrc===r);if(!a&&!o)return void(t+=1);const c=oI(this,bM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const s=[],i=yO(),r=this.getAllTracks();e=uI(e=e.filter(e=>-1===r.indexOf(e)));let a=!1,o=!1;for(const c of e){if(c instanceof PP&&(this.localTrackMap.has(_M.LocalVideoTrack)||a?new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:c,type:_M.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);s.push({track:e,type:_M.LocalVideoLowTrack})}if(c instanceof FD){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(e){if(!(e.track instanceof WD))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(o){const e=s.find(e=>{let{type:t}=e;return t===_M.LocalAudioTrack});if(!(e.track instanceof WD))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof WD||c._bypassWebAudio)s.push({track:c,type:_M.LocalAudioTrack});else{const e=new WD;e.addAudioTrack(c),s.push({track:e,type:_M.LocalAudioTrack})}o=!0}}}return s}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=uI(e=e.filter(e=>-1!==n.indexOf(e)));for(const s of e){if(s instanceof FD){const e=this.localTrackMap.get(_M.LocalAudioTrack);if(!e)continue;e.track instanceof WD?(e.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),0===e.track.trackList.length&&(t.push([_M.LocalAudioTrack,e]),e.track.close())):t.push([_M.LocalAudioTrack,e])}if(s instanceof PP){const e=this.localTrackMap.get(_M.LocalVideoTrack);if(!e)continue;t.push([_M.LocalVideoTrack,e]);const n=this.localTrackMap.get(_M.LocalVideoLowTrack);n&&t.push([_M.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof WD?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case _M.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _M.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case _M.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof WD?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QP&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var s;let i,{track:r,type:a}=e;switch(a){case _M.LocalAudioTrack:i=sM.Audio;break;case _M.LocalVideoTrack:i=Ps(s=r._hints).call(s,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalVideoLowTrack:i=sM.Low}return{kind:a===_M.LocalAudioTrack?fM.AUDIO:fM.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:r.muted||!r.enabled}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[s,{track:i,ssrcs:r,id:a}]=e;switch(s){case _M.LocalVideoTrack:n=Ps(t=i._hints).call(t,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalAudioTrack:n=sM.Audio;break;case _M.LocalVideoLowTrack:n=sM.Low}return{stream_type:n,ssrcs:r,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:s,type:i}=e;this.localTrackMap.set(i,{track:s,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(bM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Ps(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await SI(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YR.TRACER}).onSuccess(),this.emit(bM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var s;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(s=n.audioTrack)||void 0===s||s.emit(HO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,s="relay"===t.candidateType;"unknown"!==t.candidateType&&n===s||this.emit(bM.ConnectionTypeChange,n),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(bM.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===FL.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,aO.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===FL.SEND_ONLY?this.restartICE(e):rI(this,bM.RequestP2PRestartICE,{direction:FL.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof FD&&(null==n?void 0:n.track)instanceof WD)return n.track.isActive||t.push([_M.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(s&&(t.push(s),s[0]===_M.LocalVideoTrack)){const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(_M.LocalAudioTrack);if(e instanceof FD&&(null==n?void 0:n.track)instanceof WD)return n.track.isActive&&t.push([_M.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(s)if(s[0]===_M.LocalVideoTrack){t.push(s);const e=this.localTrackMap.get(_M.LocalVideoLowTrack);e&&t.push([_M.LocalVideoLowTrack,e])}else t.push(s);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[s,{track:i,ssrcs:r,id:a}]=e;switch(s){case _M.LocalAudioTrack:n=sM.Audio;break;case _M.LocalVideoTrack:n=Ps(t=i._hints).call(t,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalVideoLowTrack:n=sM.Low}return{stream_type:n,ssrcs:r,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[s,{track:i,ssrcs:r,id:a}]=e;switch(s){case _M.LocalAudioTrack:n=sM.Audio;break;case _M.LocalVideoTrack:n=Ps(t=i._hints).call(t,UO.SCREEN_TRACK)?sM.Screen:sM.High;break;case _M.LocalVideoLowTrack:n=sM.Low}return{stream_type:n,ssrcs:r,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],s=this.remoteUserMap.get(e);if(!s)return n;if(t){const i=s.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(s.entries()).forEach(t=>{let[s,i]=t;n.push([e,{kind:s,id:i}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:s,id:i}]=e;switch(s){case fM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:n._videoSSRC}));case fM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const s=this.remoteUserMap.get(t);s&&(s.delete(n),0===Array.from(s.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(_M.LocalVideoTrack),n=this.localTrackMap.get(_M.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof FD){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const s=this.createUnmuteMessage(n);return void await aI(this,bM.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(bM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(bM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await SI(BI(this.dtlsFailedCount,FI)),this.emit(bM.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(_M.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof PP)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof PP).length>1)throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof FD).length>1&&(e.some(e=>e instanceof FD&&e._bypassWebAudio)||!yO().webAudioMediaStreamDest))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof PP&&this.pendingLocalTracks.some(e=>e instanceof PP))throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof FD&&this.pendingLocalTracks.some(e=>e instanceof FD)&&(!yO().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof FD&&e._bypassWebAudio)))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding,s=yY(yY({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():RF(e,s);const r=NI(8,"track-low-"),a=new PP(i,yY(yY({},n&&{scaleResolutionDownBy:dU(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,r);return a.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),a._hints.push(UO.LOW_STREAM),e.addListener(MO.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,s){var i;const r=Array.from(XA(i=this.remoteUserMap).call(i)).find(t=>t._videoSSRC===e);if(r){s||this.store.subscribe(r.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find(e=>e.userId===r.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:r._uintid,videowidth:t,videoheight:n,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const i=s.get(t);if(!i)return!1;const r=await this.recvConnection.getRemoteSSRC(i);return void 0!==r&&r!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new IR(RR.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new IR(RR.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}async preConnect(e){throw new IR(RR.NOT_SUPPORTED)}getEstablishParams(){throw new IR(RR.NOT_SUPPORTED)}async reSubscribe(e){throw new IR(RR.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new IR(RR.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===_M.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VO.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},IL(fY.prototype,"p2pConnect",[iY],Object.getOwnPropertyDescriptor(fY.prototype,"p2pConnect"),fY.prototype),IL(fY.prototype,"unpublish",[rY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublish"),fY.prototype),IL(fY.prototype,"unpublishLowStream",[aY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublishLowStream"),fY.prototype),IL(fY.prototype,"subscribe",[oY],Object.getOwnPropertyDescriptor(fY.prototype,"subscribe"),fY.prototype),IL(fY.prototype,"mockSubscribe",[cY],Object.getOwnPropertyDescriptor(fY.prototype,"mockSubscribe"),fY.prototype),IL(fY.prototype,"unsubscribe",[lY],Object.getOwnPropertyDescriptor(fY.prototype,"unsubscribe"),fY.prototype),IL(fY.prototype,"muteRemote",[dY],Object.getOwnPropertyDescriptor(fY.prototype,"muteRemote"),fY.prototype),IL(fY.prototype,"unmuteRemote",[uY],Object.getOwnPropertyDescriptor(fY.prototype,"unmuteRemote"),fY.prototype),IL(fY.prototype,"hasRemoteMediaWithLock",[hY],Object.getOwnPropertyDescriptor(fY.prototype,"hasRemoteMediaWithLock"),fY.prototype),IL(fY.prototype,"disconnectForReconnect",[pY],Object.getOwnPropertyDescriptor(fY.prototype,"disconnectForReconnect"),fY.prototype),IL(fY.prototype,"remoteMediaSsrcChanged",[mY],Object.getOwnPropertyDescriptor(fY.prototype,"remoteMediaSsrcChanged"),fY.prototype),fY);function _Y(e){return function(t,n,s){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];switch(e){case sY.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,s)}finally{e()}}case sY.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,s)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,s)}finally{e(),t()}}}},s}}class EY extends HR{constructor(e,t){super(),uN(this,"signal",void 0),uN(this,"token",void 0),uN(this,"tokenTimeout",void 0),uN(this,"tokenInterval",void 0),uN(this,"_sequence",0),uN(this,"userMap",new Map),uN(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===jL.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*RA("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,s,i){var r;if(0===this.userMap.size)return;const a=Array.from(up(r=this.userMap).call(r))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),s=null!=s?s:NI(6,""),i=null!=i?i:this._sequence++;const o={_id:s,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(a)};RA("SHOW_P2P_LOG")&&aO.debug("send message",o,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(o)).forEach(e=>{this.signal.request(ML.DATA_STREAM,{payload:vI(this.encoder.encode(e))})});const c=new np((t,i)=>{const r=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),a),this.off("res-@".concat(s),l),this.off(OM.ABORT,c),aO.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(s)),0===this.userMap.size?i(new IR(RR.INVALID_REMOTE_USER)):i(new IR(RR.TIMEOUT))},RA("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{r&&window.clearTimeout(r),this.off(OM.ABORT,c),n&&t()},c=()=>{r&&window.clearTimeout(r),this.off("res-@".concat(s,"_ack"),a),this.off("res-@".concat(s),l),i(new IR(RR.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(s)))};this.once(OM.ABORT,c),this.once("res-@".concat(s,"_ack"),a);const l=(n,o)=>{d=!0,r&&window.clearTimeout(r),this.off("res-@".concat(s,"_ack"),a),this.off(OM.ABORT,c),"success"===n?t(o):i(new IR(RR.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(s)))};let d=!1;n||(this.once("res-@".concat(s),l),SI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d||aO.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(s,", ").concat(o))}))});try{return await c}catch(r){if(r.code===RR.TIMEOUT)return await this.send(e,t,n,s,i);throw r}}onMessage(e){var t;const{_uid:n}=e;let s,i=this.userMap.get(n);if(i)s=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==AM.CHECK)return;const{token:t}=e;s=new Map,i={uid:n,isStart:!0,token:t,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,i),this.signal.emit(VL.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var r;const{id:t,total:i}=e,a=null!==(r=s.get(t))&&void 0!==r?r:[];if(a.push(e),s.has(t)||s.set(t,a),a.length!==i)return;{const i=Xp(a).call(a,(e,t)=>e.index-t.index).map(e=>e.payload).join("");s.delete(t),(e=JSON.parse(i))._uid=n}}const{_type:a,token:o}=e;if(Ps(t=[AM.ACK,AM.CHECK]).call(t,a))return a===AM.CHECK&&this.handleCheckToken(i,o),void this.receiveMessage(e);o==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):aO.debug('Receive unexpected message", '.concat(o,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){const e={_id:NI(6,""),token:this.token,_type:AM.CHECK};RA("SHOW_P2P_LOG")&&aO.debug("send message",e),this.signal.request(ML.DATA_STREAM,{payload:vI(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:AM.ACK,token:this.token};RA("SHOW_P2P_LOG")&&aO.debug("send message",t),this.signal.request(ML.DATA_STREAM,{payload:vI(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(AM.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach(e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const s=t.get(n);t.delete(n),this.receiveMessage(s),e.nextExpectedSequenceNumber++}})};if(!e)return void t();const{_uid:n,_seq:s}=e,i=this.userMap.get(n),{receivedMessagesMap:r,isStart:a,nextExpectedSequenceNumber:o}=i;if(s<o)return this.ack(e._id),void aO.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(e._message));r.set(s,e),a&&s===o&&(this.receiveMessage(e),r.delete(o),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:s,_uid:i}=e;if(RA("SHOW_P2P_LOG")&&aO.debug("receive message",e),t){let r;switch(e._type!==AM.ACK&&(s&&(r=JSON.parse(s)),this.ack(e._id)),e._type){case AM.CANDIDATE:case AM.CONTROL:this.signal.emit(n,r,i);break;case AM.PUBLISH:case AM.UNPUBLISH:case AM.RESTART_ICE:case AM.CALL:r.uid=i,rI(this.signal,n,r).then(t=>{this.response(e._id,t)}).catch(()=>{this.response(e._id,void 0,!0)});break;case AM.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case AM.RESPONSE:{const{success:e,message:n}=r;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<EY.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),s=NI(6,"");let i=0,r=800;const a=Math.ceil(e.length/r);for(;e.length>0;){i++;const o={id:s,index:i,total:a,payload:e.slice(0,r),token:"".concat(this.token,"_").concat(n)};JSON.stringify(o).length>EY.MAX_MESSAGE_SIZE?r-=50:(t.push(o),e=e.slice(r))}return t.map(e=>JSON.stringify(e))}handleCheckToken(e,t){return e.token!==t?(aO.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{aO.debug("token timeout, ".concat(t)),this.reset(e.uid)},RA("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await rI(this.signal,AM.CALL,void 0),t=await this.send(AM.CALL,e);this.signal.emit(LL.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(OM.ABORT),this.signal.emit(VL.ON_USER_OFFLINE,{uid:n.uid,reason:DM.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(aO.debug("change local token from ".concat(t," to ").concat(t)),this.token=NI(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(OM.ABORT)}}uN(EY,"MAX_SIZE",1),uN(EY,"MAX_MESSAGE_SIZE",1024);class bY extends HR{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===jL.CONNECTED?this.emit(LL.WS_CONNECTED):e===jL.RECONNECTING?this.emit(LL.WS_RECONNECTING,this._websocketReconnectReason):e===jL.CLOSED&&this.emit(LL.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uN(this,"_disconnectedReason",void 0),uN(this,"_websocketReconnectReason",void 0),uN(this,"_connectionState",jL.CLOSED),uN(this,"reconnectToken",void 0),uN(this,"p2pToken",void 0),uN(this,"websocket",void 0),uN(this,"openConnectionTime",void 0),uN(this,"clientId",void 0),uN(this,"lastMsgTime",Date.now()),uN(this,"uploadCache",[]),uN(this,"uploadCacheInterval",void 0),uN(this,"rttRolling",new HI(5)),uN(this,"pingpongTimer",void 0),uN(this,"pingpongTimeoutCount",0),uN(this,"joinResponse",void 0),uN(this,"multiIpOption",void 0),uN(this,"initError",void 0),uN(this,"spec",void 0),uN(this,"store",void 0),uN(this,"_external_signal",void 0),uN(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(LL.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case VL.ON_DATA_STREAM:return void this.handleDataStream(t._message);case VL.MUTE_AUDIO:case VL.MUTE_VIDEO:case VL.ON_P2P_LOST:case VL.ON_USER_ONLINE:return;case VL.ON_USER_OFFLINE:const{uid:e}=t._message;return aO.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===VL.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===VL.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QR.UID_BANNED);break;case 15:this.close(QR.IP_BANNED);break;case 16:this.close(QR.CHANNEL_BANNED)}if(t._type===VL.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case PL.ERR_LICENSE_MISSING:this.close(QR.LICENSE_MISSING);break;case PL.ERR_LICENSE_EXPIRED:this.close(QR.LICENSE_EXPIRED);break;case PL.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QR.LICENSE_MINUTES_EXCEEDED);break;case PL.ERR_LICENSE_PERIOD_INVALID:this.close(QR.LICENSE_PERIOD_INVALID);break;case PL.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QR.LICENSE_MULTIPLE_SDK_SERVICE);break;case PL.ERR_LICENSE_ILLEGAL:this.close(QR.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,RA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),RA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===jL.CONNECTED&&this.reconnect("retry",nI.OFFLINE)}),this.p2pToken=NI(6,""),this._external_signal=new EY(this,this.p2pToken)}async request(e,t,n,s){const i=NI(6,""),r={_id:i,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new np((e,t)=>{if(this.connectionState===jL.CONNECTED)return e();const n=()=>{this.off(LL.WS_CLOSED,s),e()},s=()=>{this.off(LL.WS_CONNECTED,n),t(new IR(RR.WS_ABORT))};this.once(LL.WS_CONNECTED,n),this.once(LL.WS_CLOSED,s)});if(this.connectionState!==jL.CONNECTING&&this.connectionState!==jL.RECONNECTING||e===ML.JOIN||e===ML.REJOIN||await o(),this.websocket.sendMessage(r,!0),s)return;const c=new np((n,s)=>{let r=!1;const o=(s,i)=>{r=!0,n({isSuccess:"success"===s,message:i||{}}),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.emit(LL.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),o);const c=()=>{s(new IR(RR.WS_ABORT,"type: ".concat(e))),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.off("res-@".concat(i),o)};this.once(LL.WS_CLOSED,c),this.once(LL.WS_RECONNECTING,c),SI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||r||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(LL.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(s){if(this.connectionState===jL.CLOSED||e===ML.LEAVE)throw new IR(RR.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?s.throw():e===ML.JOIN||e===ML.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new IR(RR.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===PL.ERR_TOO_MANY_BROADCASTERS?e===ML.JOIN||e===ML.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===PL.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nI.MULTI_IP)):this.reconnect(u.action,nI.SERVER_ERROR),e===ML.JOIN||e===ML.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np(n=>{const s=i=>{(!t||t(i))&&(this.off(e,s),n(i))};this.on(e,s)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(UL.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=RA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==jL.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},RA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np((t,n)=>{this.once(LL.WS_CONNECTED,()=>t(this.joinResponse)),this.once(LL.WS_CLOSED,()=>n(this.initError||new IR(RR.WS_ABORT))),this.connectionState=jL.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||QR.LEAVE,this.connectionState=jL.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=NI(6,""),this._external_signal.clear(),this._external_signal=new EY(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(LL.ABORT_P2P_EXECUTION);const e=await rI(this,LL.REQUEST_JOIN_INFO),t=await this.request(ML.JOIN,e);if(!t)return this.emit(LL.REPORT_JOIN_GATEWAY,RR.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(LL.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=jL.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){return!1}handleDataStream(e){try{var t;const n=yI(e.payload),s=(new TextDecoder).decode(n),i=JSON.parse(s);"total"in i&&"id"in i||Ps(t=Object.values(AM)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(VL.ON_DATA_STREAM,e)}catch(t){this.emit(VL.ON_DATA_STREAM,e)}}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QR.UID_BANNED),void this.close()):void this.reconnect(t.action,nI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=RA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>RA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nI.TIMEOUT):this.request(ML.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),RA("REPORT_STATS")&&this.send(ML.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWebsocketEvents(){this.websocket.on(BL.RECONNECT_CREATE_CONNECTION,e=>{this.emit(LL.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(BL.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(BL.CLOSED,()=>{this.connectionState=jL.CLOSED}),this.websocket.on(BL.FAILED,()=>{this._disconnectedReason=QR.NETWORK_ERROR,this.connectionState=jL.CLOSED}),this.websocket.on(BL.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===jL.CONNECTED?this.connectionState=jL.RECONNECTING:this.connectionState=jL.CONNECTING}),this.websocket.on(BL.WILL_RECONNECT,(e,t,n)=>{"retry"!==e?(aO.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):aO.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)}),this.websocket.on(BL.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(LL.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof IR&&e.code===RR.UNEXPECTED_RESPONSE&&e.data.code===PL.ERR_NO_AUTHORIZED)return aO.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",nI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nI.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(BL.REQUEST_NEW_URLS,(e,t)=>{rI(this,LL.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(BL.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(VL.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const xY={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new vY(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new bY(n,t)}};function wY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function SY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wY(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class NY{constructor(e){uN(this,"sessionDesc",void 0),uN(this,"localCapabilities",void 0),uN(this,"rtpCapabilities",void 0),uN(this,"candidates",void 0),uN(this,"_originCandidates",void 0),uN(this,"iceParameters",void 0),uN(this,"dtlsParameters",void 0),uN(this,"setup",void 0),uN(this,"currentMidIndex",void 0),uN(this,"cname",void 0),e=pI(e);const{iceParameters:t,dtlsParameters:n,candidates:s,rtpCapabilities:i,setup:r,localCapabilities:a,sdkCodec:o,cname:c}=e,l=VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=s,this._originCandidates=pI(s),this.iceParameters=t,this.dtlsParameters=n,this.setup=r,this.localCapabilities=a,this.cname=c;for(let d=0;d<l.mediaDescriptions.length;d++){const e=l.mediaDescriptions[d];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=s,e.attributes.setup=r,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map(e=>e.payloadType.toString(10));const t=i.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Ps(n=t.encodingName.toLowerCase()).call(n,o)}),n=i.videoCodecs.filter(e=>!Ps(t).call(t,e));e.attributes.payloads=[...t,...n],e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),l.mediaDescriptions[d]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return FA(this.sessionDesc)}send(e,t,n){const{ssrcs:s,ssrcGroups:i}=TU(t,this.cname),r=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType),a=s[0].attributes.label,o=s[0].attributes.mslabel;return r.attributes.ssrcs=r.attributes.ssrcs.concat(s),r.attributes.ssrcGroups=r.attributes.ssrcGroups.concat(i),{id:a,mslabel:o}}batchSend(e){return e.map(e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{const n=[],s=[],i=[];t.attributes.ssrcs.forEach(t=>{Ps(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)}),t.attributes.ssrcGroups.forEach(e=>{var t;Ps(t=i.map(e=>e.ssrcId)).call(t,e.ssrcIds[0])||s.push(e)}),t.attributes.ssrcs=n,t.attributes.ssrcGroups=s})}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach((e,t)=>{const n=e._mediaStreamTrack,s=this.sessionDesc.mediaDescriptions.findIndex(e=>e.attributes.mid===n.kind),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],e);this.sessionDesc.mediaDescriptions[s]=i})}stopReceiving(e){}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),n=[];if(t.forEach(e=>{n.push(SY(SY({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this.candidates=n;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this.candidates=[...t,...n];break;default:this.candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pI(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=pI(e);return CU(n,t),IU(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const s=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid);if(s){const e=s.attributes.ssrcs.find(e=>e.attributes.label===t);var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=pI(e);return RU(t),function(e){const t=e.attributes.extmaps.find(e=>vU(e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var TY;function CY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function RY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CY(Object(n),!0).forEach(function(t){uN(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let IY=(TY=class e extends mM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Ps(t=Object.keys(kA)).call(t,e)}))]}constructor(t,n){super(t,n),uN(this,"store",void 0),uN(this,"peerConnection",void 0),uN(this,"remoteSDP",void 0),uN(this,"initialOffer",void 0),uN(this,"statsFilter",void 0),uN(this,"useRTX",!1),uN(this,"localCapabilities",void 0),uN(this,"localCandidateCount",0),uN(this,"allCandidatesReceived",!1),uN(this,"establishPromise",void 0),uN(this,"mutex",void 0),this.store=n,this.mutex=new UI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,nR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=xU(e.sdp),n=bU(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:RA("FILTER_VIDEO_FEC"),filterAudioFec:RA("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,RY(RY({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new NY(RY(RY({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return YT(function*(){const s=yield JT(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(e=>n.peerConnection.addTrack(e._mediaStreamTrack)),i=yield JT(n.peerConnection.createOffer()),r=VA(i.sdp),a=e.map(e=>{const t=e._mediaStreamTrack,s=r.mediaDescriptions.find(e=>e.attributes.mid===t.kind);if(!s)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const s=e.attributes.ssrcs.filter(e=>e.attributes.label===t),i=e.attributes.ssrcGroups;if(0===s.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&s.length>1){const e=i.find(e=>-1!==e.ssrcIds.indexOf(s[0].ssrcId));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:s[0].ssrcId}]}return[{ssrcId:s[0].ssrcId}]}(s,t.id,n.useRTX)});let o;try{o=yield a}catch(e){throw s.forEach(e=>{$C()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)}),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,o);const l=n.remoteSDP.toString();return yield JT(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JT(n.applySendEncodings(s,e)),yield JT(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:a[t],id:n}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{s()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{$C()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,s),r=new np((t,s)=>{const r=setTimeout(()=>{s(new Error("Cannot receive track, id: ".concat(n)))},1e4),a=s=>{const o=qC();if(("Safari"===o.name&&11===Number(o.version)||sR())&&s.track.id!==n&&s.streams[0].id===i){var c;const i=s.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,s.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(r),void t(i)}if(s.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(r),void t(s.track)};this.peerConnection.addEventListener("track",a)}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),{track:await r,id:n}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(e=>{if($C()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!1),e.setParameters(t)}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async e=>{if($C()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!0),await e.setParameters(t)}});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YT(function*(){const n=yield JT(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=yO().supportPCSetConfiguration;if(e===gM.RELAY&&!n)return;if(n){const n=t.peerConnection.getConfiguration(),s=e===gM.RELAY?"relay":"all";n.iceTransportPolicy!==s&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(s,"]")),n.iceTransportPolicy=s,t.peerConnection.setConfiguration(n))}e!==gM.RELAY&&t.remoteSDP.updateCandidates(e);const s=yield JT(t.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=xU(s.sdp),{remoteIceParameters:r}=yield i.iceParameters;t.remoteSDP.restartICE(r);const a=t.remoteSDP.toString();yield JT(t.peerConnection.setLocalDescription(s)),yield JT(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e});1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find(e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t});n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},RA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZR(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),RA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id})),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!yO().supportSetRtpSenderParameters)return aO.warn("Browser not support set rtp-sender parameters");const s={},i={};if(e instanceof PP)switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(RA("DSCP_TYPE")&&xR()){var r;const e=RA("DSCP_TYPE");Ps(r=["very-low","low","medium","high"]).call(r,e)&&(i.networkPriority=e)}const a=t.getParameters(),o=null===(n=a.encodings)||void 0===n?void 0:n[0];o&&Object.assign(o,i),Object.assign(a,s),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!yO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const s=e[n],i=t[n];s&&i&&await this.updateRtpSenderEncodings(i,s)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=VA(e);return t.forEach((e,t)=>{const s=e._mediaStreamTrack,i=n.mediaDescriptions.find(e=>e.attributes.mid===s.kind);i&&CU(i,e)}),FA(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var s;null===(s=this.onFirstVideoDecoded)||void 0===s||s.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map((t,n)=>{let{id:s,mslabel:i}=t;const{kind:r}=e[n];return new np((e,t)=>{const n=setTimeout(()=>{t(new Error("Cannot receive track, id: ".concat(s)))},1e4),a=t=>{const o=qC();if("Safari"===o.name&&11===Number(o.version)&&t.track.id!==s&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(r,s,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:i,id:s})}if(t.track.id===s)return this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:t.track,id:s})};this.peerConnection.addEventListener("track",a)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await np.all(t)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(yO().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},IL(TY.prototype,"connect",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"connect"),TY.prototype),IL(TY.prototype,"stopSending",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"stopSending"),TY.prototype),IL(TY.prototype,"receive",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"receive"),TY.prototype),IL(TY.prototype,"stopReceiving",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"stopReceiving"),TY.prototype),IL(TY.prototype,"muteRemote",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"muteRemote"),TY.prototype),IL(TY.prototype,"unmuteRemote",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"unmuteRemote"),TY.prototype),IL(TY.prototype,"muteLocal",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"muteLocal"),TY.prototype),IL(TY.prototype,"unmuteLocal",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"unmuteLocal"),TY.prototype),IL(TY.prototype,"close",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"close"),TY.prototype),IL(TY.prototype,"updateEncoderConfig",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"updateEncoderConfig"),TY.prototype),IL(TY.prototype,"updateSendParameters",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"updateSendParameters"),TY.prototype),IL(TY.prototype,"replaceTrack",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"replaceTrack"),TY.prototype),IL(TY.prototype,"getRemoteSSRC",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"getRemoteSSRC"),TY.prototype),TY);function AY(e,t,n){const s=e[t];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return await s.apply(this,r)}finally{n()}},n}const OY={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new IY(n,t)}},kY={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(dj.has(e))return;if(!e.track)return;const n={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const r=new TransformStream({transform(i,r){n.controller||(n.controller=r),e.track&&e.track.id!==n.track.id&&(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));const a=t.metadata&&t.metadata();a?function(e,t){const{chunk:n,controller:s}=t,i=cj.METADATA;n.data=function(e,t,n){const s=n.byteLength,i=s+aj+oj,r=ij+rj+i,a=new ArrayBuffer(e.byteLength+r),o=new DataView(a);o.setUint8(0,sj),o.setUint16(1,i),o.setUint8(3,t),o.setUint16(4,s);for(let l=0;l<s;l++)o.setUint8(6+l,n[l]);const c=new Uint8Array(o.buffer);return c.set(new Uint8Array(e),r),c.buffer}(n.data,i,e),s.enqueue(n)}(a,{sender:e,chunk:i,controller:r}):r.enqueue(i)}});i.readable.pipeThrough(r).pipeTo(i.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const i=nj(),r=new MessageChannel;await new np(e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:r.port2},[r.port2]);e.transform=a,await new np(e=>i.onmessage=t=>{"started"===t.data&&e(void 0)}),r.port1.onmessage=i=>{var a;if(i.data.transformed&&e.track&&(null===(a=e.track)||void 0===a?void 0:a.id)!==n.track.id)aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s);else if(i.data.getMetadata){const e=t.metadata&&t.metadata();e&&r.port1.postMessage({metadata:e})}},n.worker=i}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const t=dj.get(e);if(t){dj.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){aO.warning(e&&e.message)}}}dj.set(e,n),e.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(kj.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ZC()&&!sR()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");aR(WC.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const r=new TransformStream({transform(i,r){n.controller||(n.controller=r),e.track&&e.track.id!==n.track.id&&(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)),t.enableTopn?function(e,t,n){var s;const i=lj(new DataView(t.data));if(!i)return n.enqueue(t);const r=e.track.id;Dj.set(r,e.track);const a=null===(s=i.tlv.find(e=>e.tag===cj.AUDIO_LEVEL))||void 0===s?void 0:s.value;let o=0;"number"==typeof a&&(o=127-a);const c=Math.round(Math.pow(10,o/60)-1),{selected:l,speaker:d}=function(e,t){let n=xj.get(e);if(n||(n=function(e){const t=new vj;return xj.set(e,t),wj||(wj=new bj(RA("TOPN_SILENCE_THRESHOLD")||500),wj.on("ActiveSpeakerChanged",e=>{null!=e&&(Sj=e)})),wj.addSpeakers([t]),t}(e)),xj.size<=Nj)return{selected:!0,speaker:n};if(!wj)throw new Error("no active speaker detector");return wj.levelChanged(n.id,t),Tj=wj.loudest.map(e=>e.id),Sj&&!Ps(Tj).call(Tj,Sj)&&Tj.length>=Nj&&Tj.pop(),{selected:Ps(Tj).call(Tj,n.id)||n.id===Sj,speaker:n}}(e,c),u=function(e,t,n){const s=Cj.get(e)||new Ij(e,t);return s.score=n,Cj.set(e,s),function(e){if(Rj.set(e,!0),!Aj)return void(Aj=Date.now());const t=Date.now();t-Aj>1e3&&(Rj.get(e)?Rj.set(e,!1):(Oj(e),Rj.delete(e)),Aj=t)}(e),s}(r,e.track,d.energyScore);u.addSample(l),u.active&&(t.data=i.frame.buffer,n.enqueue(t))}(e,i,r):t.enableMetadata||t.enablePts?function(e,t,n,s){const i=new DataView(e.data),r=i.getUint8(0);let a;if(0!=(128&r)&&71!==r){const t=function(e){if(e.byteLength<=0)return[];const t=[];let n=0;for(;n<e.byteLength;){const s=(128&e.getUint8(n))>>7,i=127&e.getUint8(n);if(!(s&&n+4<=e.byteLength)){n++;break}{const s=e.getUint32(n,!1),r=(16776192&s)>>10,a=1023&s;t.push({pt:i,ts_offset:r,length:a,data:new Uint8Array}),n+=4}}let s=e.byteLength-n;for(const i of t){if(i.length>s)return console.warn("Broken red payload"),[];i.length>0&&(i.data=new Uint8Array(e.buffer,e.byteOffset+n,i.length),n+=i.length,s-=i.length)}if(s>0){const i={pt:t.length>0?t[t.length-1].pt:0,ts_offset:0,length:s,data:new Uint8Array(e.buffer,e.byteOffset+n,s)};t.push(i)}return t}(i);if(t.length>0){const n=function(e){let t=0;for(let i=0;i<e.length;i++)t+=i<e.length-1?4:1,t+=e[i].length;const n=new Uint8Array(t);let s=0;for(let i=0;i<e.length;i++)if(i<e.length-1){const t=(2147483648|(127&e[i].pt)<<24|(262143&e[i].ts_offset)<<10|1023&e[i].length)>>>0;n[s++]=t>>24&255,n[s++]=t>>16&255,n[s++]=t>>8&255,n[s++]=255&t}else n[s++]=127&e[i].pt;for(const i of e)n.set(i.data,s),s+=i.length;return n}(t.map(e=>{const t=new Uint8Array(e.length);t.set(e.data);const n=lj(new DataView(t.buffer));return null!=n&&n.frame&&(e.data=null==n?void 0:n.frame),a=n,e}));e.data=n.buffer}}else a=lj(i),a&&(e.data=a.frame.buffer);if(t.enqueue(e),!a)return;const o=a.tlv.find(e=>e.tag===cj.METADATA);o&&n&&o.value instanceof Uint8Array&&n(o.value);const c=a.tlv.find(e=>e.tag===cj.AUDIO_64_BIT_PTS);c&&s&&c.value instanceof Uint8Array&&8==c.value.length&&s(new DataView(c.value.buffer).getBigUint64(0,!0))}(i,r,t.onMetadata,t.onPts):r.enqueue(i)}});i.readable.pipeThrough(r).pipeTo(i.writable)}else{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=nj(),i=new MessageChannel;await new np(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const r=new RTCRtpScriptTransform(t,{name:"audio-metadata-rx",port:i.port2},[i.port2]);e.transform=r,await new np(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(aO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)):t.data.metadata&&n.onMetadata?n.onMetadata(t.data.metadata):t.data.pts&&n.onPts&&n.onPts(t.data.pts)},n.worker=t}function s(){e.track.removeEventListener("ended",s),function(e){const t=kj.get(e);if(t){!function(e){const t=xj.get(e);t&&(xj.delete(e),wj&&(wj.removeSpeakers([t]),0===xj.size&&(wj.destroy(),wj=null)))}(e),Oj(e.track.id),kj.delete(e);try{var n,s;null===(n=t.controller)||void 0===n||n.terminate(),null===(s=t.worker)||void 0===s||s.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}kj.set(e,n),e.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(e,t){if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(Vj.has(e))return;if(!e.track)return;const n={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const r=[];t.on("sei-to-send",e=>{r.push(e)});const a=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));const a=Uj(new Uint8Array(t.data)),o=r.shift();if(o){const e=function(e,t,n){switch(n){case Pj:return function(e,t){const n=Mj(t),s=n.length,i=Math.floor(s/255),r=s%255,a=new Uint8Array(6+i+1+s+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=6,a[5]=101;let o=0;for(;o<i;)a[6+o]=255,o++;return a[6+o]=r,o++,a.set(n,6+o),a.set(new Uint8Array(e),6+o+s),a.buffer}(e,t);case jj:return function(e,t){const n=Mj(t),s=n.length,i=Math.floor(s/255),r=s%255,a=new Uint8Array(7+i+1+s+1+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=78,a[5]=1,a[6]=101;let o=0;for(;o<i;)a[7+o]=255,o++;return a[7+o]=r,o++,a.set(n,7+o),o+=s,a[7+o]=128,o++,a.set(new Uint8Array(e),7+o),a.buffer}(e,t);default:return null}}(t.data,o,a);e&&(t.data=e)}i.enqueue(t)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if(!$C())return;{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const i=nj(),r=new MessageChannel;await new np(e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(i,{name:"sei-tx",port:r.port2},[r.port2]);e.transform=a,await new np(e=>i.onmessage=t=>{"started"===t.data&&e(void 0)}),t.on("sei-to-send",e=>{r.port1.postMessage({sei:e})}),r.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s))},n.worker=i}}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const t=Vj.get(e);if(t){Vj.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){aO.warning(e&&e.message)}}}Vj.set(e,n),e.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(!e.track)return;if(Fj.has(e)){const n=Fj.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));const r=function(e,t){switch(t){case Pj:return function(e){const t=new DataView(e.data);let n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let s=n+6,i=0,r=0;for(;255===(r=t.getUint8(s++));)i+=255;i+=r;const a=Lj(e.data,s,i);return new Uint8Array(a)}n++}return null}(e);case jj:return function(e){const t=new DataView(e.data);let n=0;for(;n+5<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&78===t.getUint8(n+4)&&1===t.getUint8(n+5)&&101===t.getUint8(n+6)){let s=n+7,i=0,r=0;for(;255===(r=t.getUint8(s++));)i+=255;i+=r;const a=Lj(e.data,s,i);return new Uint8Array(a)}n++}return null}(e);default:return null}}(t,Uj(new Uint8Array(t.data)));r&&n.onSei&&n.onSei(r),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=nj(),i=new MessageChannel;await new np(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const r=new RTCRtpScriptTransform(t,{name:"sei-rx",port:i.port2},[i.port2]);e.transform=r,await new np(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(aO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}!function(e){const t=Fj.get(e);if(t){Fj.delete(e);try{var n,s;null===(n=t.controller)||void 0===n||n.terminate(),null===(s=t.worker)||void 0===s||s.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}Fj.set(e,n),e.track.addEventListener("ended",s)}},DY={name:"InterceptFrame",create:()=>kY};yA(),CA("PROCESS_ID","process-".concat(NI(8,""),"-").concat(NI(4,""),"-").concat(NI(4,""),"-").concat(NI(4,""),"-").concat(NI(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();aO.debug("Loading global parameters from cache",t),Object.keys(t).forEach(e=>{if(Object.prototype.hasOwnProperty.call(TA,e)){const{value:s,expires:i}=t[e];if(i&&i<=n)return;AA[e]=s,TA[e]=s}})}catch(t){aO.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(AA.AREAS)&&AA.AREAS.length>0&&mV(AA.AREAS,!0);const PY=(e,t,n)=>{aO.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),CA(e,t,n)};XU(Zz,!1),XU(rq,!1),XU(fG,!1),XU(Lq,!1),XU(Xz,!1),XU(xY,!1),XU(OY,!1),XU(DY,!1);const jY=function(e){const t=new HR,n=e,s={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===TM.SECURITY_POLICY_VIOLATION&&fW(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return pW(pW({},n),s)}({__TRACK_LIST__:jO,VERSION:vA,BUILD:SA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:PY,getParameter:RA,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return yO().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new fO(RR.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=mO.reportApiInvoke(null,{name:qR.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:YR.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,s=window.WebSocket;t=!!(e&&n&&s),t&&bR()&&rR(75)&&(new e).close()}catch(e){return aO.error("check system requirement failed: ",e),!1}let n=!1;const s=qC();s.name===WC.CHROME&&Number(s.version)>=58&&("WebKit"!==KC.engine.name||function(){const e=qC();if(QC()){if(e.os===GC.MAC_OS)return!0;if(e.os===GC.IOS){const e=KC.os.version&&KC.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(s.name===WC.FIREFOX&&Number(s.version)>=56||s.name===WC.OPERA&&Number(s.version)>=45||s.name===WC.SAFARI&&Number(s.version)>=11||"WebKit"===s.name&&(sR()||vR())&&s.osVersion&&Number(s.osVersion.split(".")[0])>=11||_R()||qC().name===WC.QQ)&&(n=!0),aO.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return kk.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return kk.getRecordingDevices(e)},getCameras:function(e){return kk.getCamerasDevices(e)},getElectronScreenSources:Sk,getPlaybackDevices:function(e){return kk.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=NI(5,"client-"),s=mO.reportApiInvoke(null,{id:n,name:qR.CREATE_CLIENT,options:[t],tag:YR.TRACER});try{!function(e){OR(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),OR(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&OR(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&PR(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&$R(e.turnServer),void 0!==e.httpRetryConfig&&XR(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&XR(e.websocketRetryConfig)}(t)}catch(e){throw s.onError(e),e}return(uR(16,0,!0)||hR(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",aO.debug("browser not support vp9, force use vp8")),CA("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),s.onSuccess(),new aW(rW(rW({forceWaitGatewayResponse:!0},t),{},{role:Ps(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=RA("CAMERA_CAPTURE_CONFIG"),n=NI(8,"track-cam-"),s=mO.reportApiInvoke(null,{id:n,tag:YR.TRACER,name:qR.CREATE_CAM_VIDEO_TRACK,options:[lk({},e),t]});t&&(e.encoderConfig=t);const i=qk(e);let r=null;aO.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{r=(await Rk({video:i},n)).getVideoTracks()[0]||null}catch(e){throw s.onError(e),e}if(!r){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(e),e.throw(aO)}if(e.optimizationMode&&LP(n,r,e,AO(e.encoderConfig)),RA("USE_STANDARD_BITRATE_DEFAULT")){const t=AO(e.encoderConfig);e.encoderConfig=t,delete t.bitrateMax,delete t.bitrateMin}const a=new jP(r,e,i,e.scalabiltyMode?kO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return s.onSuccess(a.getTrackId()),aO.info("create camera video success, trackId:",n),a},createCustomVideoTrack:function(e){const t=NI(8,"track-cus-"),n=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const s=new PP(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?kO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[UO.CUSTOM_TRACK]);return n.onSuccess(s.getTrackId()),aO.info("create custom video track success with config",e,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n="object"==typeof t?function(e){return Yk(e)}(t):void 0;n&&(t="auto");const s=NI(8,"track-scr-v-"),i=mO.reportApiInvoke(null,{id:s,tag:YR.TRACER,name:qR.CREATE_SCREEN_VIDEO_TRACK,options:[lk({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const r=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&ZC()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:s,surfaceSwitching:i,systemAudio:r,preferCurrentTab:a}=e;(iR(107)||oR(107)||pR(93))&&(n&&(OR(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),s?(OR(s,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=s):t.selfBrowserSurface="include",i&&(OR(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(iR(105)||oR(105)||pR(91))&&r&&(OR(r,"systemAudio",["exclude","include"]),t.systemAudio=r),(iR(94)||oR(94)||pR(80))&&a&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const o=e.encoderConfig?OO(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&(o.frameRate&&("number"==typeof o.frameRate?(t.mandatory.maxFrameRate=o.frameRate,t.mandatory.minFrameRate=o.frameRate):(t.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,t.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),t.frameRate=o.frameRate),o.width&&(t.width=o.width),o.height&&(t.height=o.height)),t}(e);let a=null,o=null;const c=yO();if(!c.supportShareAudio&&"enable"===t){const e=new IR(RR.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(e),e.throw(aO)}aO.info("start create screen video track with config",e,"withAudio",t,"trackId",s);const l=c.supportShareAudio&&"disable"!==t;try{const e=await Rk({screen:r,screenAudio:l?n||!0:void 0},s);a=e.getVideoTracks()[0]||null,o=e.getAudioTracks()[0]||null}catch(e){throw i.onError(e),e}if(!a){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(e),e.throw(aO)}if(!o&&"enable"===t){a&&a.stop();const e=new IR(RR.SHARE_AUDIO_NOT_ALLOWED);return i.onError(e),e.throw(aO)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(LP(s,a,e,e.encoderConfig&&OO(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const d=new PP(a,e.encoderConfig?OO(e.encoderConfig):{},e.scalabiltyMode?kO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[UO.SCREEN_TRACK]);if(!o)return i.onSuccess(d.getTrackId()),aO.info("create screen video track success","video:",d.getTrackId()),d;const u=new FD(o,void 0,NI(8,"track-scr-a-"),!1);return i.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create screen video track success","video:",d.getTrackId(),"audio:",u.getTrackId()),[d,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=RA("CAMERA_CAPTURE_CONFIG"),s=NI(8,"track-mic-"),i=NI(8,"track-cam-"),r=mO.reportApiInvoke(null,{id:"".concat(s,"-").concat(i),tag:YR.TRACER,name:qR.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const a=qk(t),o=Xk(e);let c=null,l=null;aO.info("start create camera video track(".concat(i,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await Rk({audio:o,video:a},"".concat(s,"-").concat(i));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw r.onError(e),e}if(!c||!l){const e=new IR(RR.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(e),e.throw(aO)}if(t.optimizationMode&&LP(i,l,t,AO(t.encoderConfig)),RA("USE_STANDARD_BITRATE_DEFAULT")){const e=AO(t.encoderConfig);t.encoderConfig=e,delete e.bitrateMax,delete e.bitrateMin}const d=new BD(c,e,o,s),u=new jP(l,t,a,t.scalabiltyMode?kO(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return r.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create camera video track(".concat(i,") and microphone audio track(").concat(s,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=NI(8,"track-mic-"),n=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_MIC_AUDIO_TRACK,options:[e]}),s=Xk(e);let i=null;aO.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Rk({audio:s},t)).getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!i){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(aO)}const r=new BD(i,e,s,t);return n.onSuccess(r.getTrackId()),aO.info("create microphone audio track success, trackId:",t),r},createCustomAudioTrack:function(e){const t=NI(8,"track-cus-"),n=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),s=new FD(e.mediaStreamTrack,e.encoderConfig?PO(e.encoderConfig):{},t,!1);return aO.info("create custom audio track success with config",e,"trackId",s.getTrackId()),n.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:s}=e;let{source:i}=e;const r={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:s},a=NI(8,"track-buf-"),o=mO.reportApiInvoke(null,{id:a,tag:YR.TRACER,name:qR.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(RA("DISABLE_WEBAUDIO"))throw new IR(RR.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");aO.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",a);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){const t=KD.get(e);if(t)return aO.debug("use cached audio resource: ",e),t;try{n=(await GI(()=>LC.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new IR(RR.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new np((t,n)=>{const s=new FileReader;s.onload=e=>{e.target?t(e.target.result):n(new IR(RR.READ_LOCAL_AUDIO_FILE_ERROR))},s.onerror=()=>{n(new IR(RR.READ_LOCAL_AUDIO_FILE_ERROR))},s.readAsArrayBuffer(e)});n=await t}const s=await function(e){const t=fk();return new np((n,s)=>{t.decodeAudioData(e,e=>{n(e)},e=>{s(new IR(RR.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(n);return"string"==typeof e&&t&&KD.set(e,s),s}(i,n)}catch(e){return o.onError(e),e.throw(aO)}const l=new HD(i),d=new GD(c,l,s?PO(s):{},a);return aO.info("create buffer source audio track success, trackId:",a),o.onSuccess(d.getTrackId()),d},setAppType:function(e){if(aO.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw aO.debug("Invalid appType"),new fO(RR.INVALID_PARAMS,"invalid app type",e);CA("APP_TYPE",Math.floor(e))},setLogLevel:function(e){aO.setLogLevel(e)},enableLogUpload:function(){RA("USE_NEW_LOG")?CA("UPLOAD_LOG",!0):aO.enableLogUpload()},disableLogUpload:function(){RA("USE_NEW_LOG")?CA("UPLOAD_LOG",!1):aO.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new JV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof FD||e instanceof QP)){const e=new fO(RR.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const s=e instanceof FD?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let r=i,a=i;const o=Date.now();return new np(i=>{const c=setInterval(()=>{const l=e.getVolumeLevel();r=l>r?l:r,a=l<a?l:a;const d=r-a>1e-4,u=Date.now()-o;if(d||u>t){clearInterval(c);const t=d,a={duration:u,deviceLabel:s,maxVolumeLevel:r,result:t};aO.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),n.onSuccess(a),i(t)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof PP||e instanceof JP)){const e=new fO(RR.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const s=e instanceof PP?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),r=document.createElement("video");r.style.width="1px",r.style.height="1px",r.setAttribute("muted",""),r.muted=!0,r.setAttribute("playsinline",""),r.controls=!1,($C()||QC())&&(r.style.opacity="0.01",r.style.position="fixed",r.style.left="0",r.style.top="0",document.body.appendChild(r)),r.srcObject=new MediaStream([i]),r.play();const a=document.createElement("canvas");a.width=160,a.height=120;let o=0,c=0;try{const e=Date.now();o=await function(e,t,n,s){let i,r=0,a=null;return new np((o,c)=>{function l(){r>s&&i&&(i(),o(r));const t=n.getContext("2d");if(!t){const e=new fO(RR.UNEXPECTED_ERROR,"can not get canvas 2d context.");return aO.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,n.width,n.height),d=Math.floor(l.data.length/3);if(a){for(let e=0;e<d;e+=3)if(l.data[e]!==a[e])return r+=1,void(a=l.data);a=l.data}else a=l.data}setTimeout(()=>{i&&(i(),o(r))},t),i=vk(()=>{l()},30)})}(r,t,a,4),c=Date.now()-e}catch(e){throw n.onError(e),e}hB===WC.SAFARI&&(r.pause(),r.remove()),r.srcObject=null;const l=o>4,d={duration:c,changedPicNum:o,deviceLabel:s,result:l};return aO.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),n.onSuccess(d),l},setArea:mV,audioElementPlayCenter:Uk,resumeAudioContext:function(){Uk.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){uW.processExternalMediaAEC(e)},registerExtensions:function(e){const t=RA("PLUGIN_INFO")||[];e.forEach(e=>{"name"in e&&!Ps(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=aO.extLog,n.reporter.hookApiInvoke=mO.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(e=>{n.parameters[e]=RA(e)})}),PY("PLUGIN_INFO",t)},ChannelMediaRelayError:nM,ChannelMediaRelayEvent:eM,ChannelMediaRelayState:tM,RemoteStreamFallbackType:BO,RemoteStreamType:FO,ConnectionDisconnectedReason:QR,AudienceLatencyLevelType:JR,AREAS:oM,preload:async function(e,t,n,s){return TB(e,t,n,s)}});return Object.defineProperties(jY,{onAudioAutoplayFailed:{get:()=>Pk.onAudioAutoplayFailed,set:e=>{Pk.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Pk.onAutoplayFailed,set:e=>{Pk.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>jY._onSecurityPolicyViolation,set(e){jY._onSecurityPolicyViolation=e,fW(e)}},__CLIENT_LIST__:{get:()=>RA("SHOW_GLOBAL_CLIENT_LIST")?Wj:[]}}),kk.on(tk.CAMERA_DEVICE_CHANGED,e=>{aO.info("camera device changed",JSON.stringify(e)),jY.onCameraChanged&&jY.onCameraChanged(e),jY.safeEmit(TM.CAMERA_CHANGED,e)}),kk.on(tk.RECORDING_DEVICE_CHANGED,e=>{aO.info("microphone device changed",JSON.stringify(e)),jY.onMicrophoneChanged&&jY.onMicrophoneChanged(e),jY.safeEmit(TM.MICROPHONE_CHANGED,e)}),kk.on(tk.PLAYOUT_DEVICE_CHANGED,e=>{aO.debug("playout device changed",JSON.stringify(e)),jY.onPlaybackDeviceChanged&&jY.onPlaybackDeviceChanged(e),jY.safeEmit(TM.PLAYBACK_DEVICE_CHANGED,e)}),Uk.onAutoplayFailed=()=>{aO.info("detect audio element autoplay failed"),Pk.onAudioAutoplayFailed&&Pk.onAudioAutoplayFailed()},mk.on("autoplay-failed",()=>{aO.info("detect webaudio autoplay failed"),Pk.onAudioAutoplayFailed&&Pk.onAudioAutoplayFailed(),jY.safeEmit(TM.AUTOPLAY_FAILED)}),mk.on(xO.STATE_CHANGE,(e,t)=>{aO.info("audio context state changed: ".concat(t," => ").concat(e)),jY.onAudioContextStateChanged&&jY.onAudioContextStateChanged(e,t),jY.safeEmit(TM.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),lI.on(iI.NETWORK_STATE_CHANGE,(e,t)=>{aO.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=jY),jY}()},730:(e,t,n)=>{"use strict";var s=n(43),i=n(853);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,s,i,r,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function _(e,t,n,s){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:s||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,s){if(null===t||"undefined"===typeof t||function(e,t,n,s){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!s&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,s))return!0;if(s)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,s)&&(n=null),s||null===i?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,s=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var E=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),x=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function j(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var L,M=Object.assign;function U(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var V=!1;function F(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var s=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){s=l}e.call(t.prototype)}else{try{throw Error()}catch(l){s=l}e()}}catch(l){if(l&&s&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),r=s.stack.split("\n"),a=i.length-1,o=r.length-1;1<=a&&0<=o&&i[a]!==r[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==r[o]){if(1!==a||1!==o)do{if(a--,0>--o||i[a]!==r[o]){var c="\n"+i[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=o);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case x:return"Portal";case N:return"Profiler";case S:return"StrictMode";case I:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case k:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function z(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){s=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(e){s=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=K(e)?e.checked?"true":"false":e.value),(e=s)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,s=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=H(t.value),s=t.type;if(null!=n)"number"===s?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===s||"reset"===s)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!("submit"!==s&&"reset"!==s||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,s){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&s&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(s&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(r(92));if(te(n)){if(1<n.length)throw Error(r(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function re(e,t){var n=H(t.value),s=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=s&&(e.defaultValue=""+s)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var s=0===n.indexOf("--"),i=fe(n,t[n],s);"float"===n&&(n="cssFloat"),s?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ye=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,we=null,Se=null;function Ne(e){if(e=_i(e)){if("function"!==typeof xe)throw Error(r(280));var t=e.stateNode;t&&(t=bi(t),xe(e.stateNode,e.type,t))}}function Te(e){we?Se?Se.push(e):Se=[e]:we=e}function Ce(){if(we){var e=we,t=Se;if(Se=we=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Re(e,t){return e(t)}function Ie(){}var Ae=!1;function Oe(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Re(e,t,n)}finally{Ae=!1,(null!==we||null!==Se)&&(Ie(),Ce())}}function ke(e,t){var n=e.stateNode;if(null===n)return null;var s=bi(n);if(null===s)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(r(231,t,typeof n));return n}var De=!1;if(d)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(de){De=!1}function je(e,t,n,s,i,r,a,o,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(d){this.onError(d)}}var Le=!1,Me=null,Ue=!1,Ve=null,Fe={onError:function(e){Le=!0,Me=e}};function Be(e,t,n,s,i,r,a,o,c){Le=!1,Me=null,je.apply(Fe,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ge(e)!==e)throw Error(r(188))}function Ke(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,s=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(s=i.return)){n=s;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return He(i),e;if(a===s)return He(i),t;a=a.sibling}throw Error(r(188))}if(n.return!==s.return)n=i,s=a;else{for(var o=!1,c=i.child;c;){if(c===n){o=!0,n=i,s=a;break}if(c===s){o=!0,s=i,n=a;break}c=c.sibling}if(!o){for(c=a.child;c;){if(c===n){o=!0,n=a,s=i;break}if(c===s){o=!0,s=a,n=i;break}c=c.sibling}if(!o)throw Error(r(189))}}if(n.alternate!==s)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(e))?ze(e):null}function ze(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=ze(e);if(null!==t)return t;e=e.sibling}return null}var qe=i.unstable_scheduleCallback,Ye=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,Je=i.unstable_requestPaint,Qe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,st=i.unstable_IdlePriority,it=null,rt=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/ct|0)|0},ot=Math.log,ct=Math.LN2;var lt=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var s=0,i=e.suspendedLanes,r=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~i;0!==o?s=ut(o):0!==(r&=a)&&(s=ut(r))}else 0!==(a=n&~i)?s=ut(a):0!==r&&(s=ut(r));if(0===s)return 0;if(0!==t&&t!==s&&0===(t&i)&&((i=s&-s)>=(r=t&-t)||16===i&&0!==(4194240&r)))return t;if(0!==(4&s)&&(s|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=s;0<t;)i=1<<(n=31-at(t)),s|=e[n],t&=~i;return s}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-at(n),i=1<<s;i&t|e[s]&t&&(e[s]|=t),n&=~i}}var _t=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,xt,wt,St,Nt,Tt=!1,Ct=[],Rt=null,It=null,At=null,Ot=new Map,kt=new Map,Dt=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":kt.delete(t.pointerId)}}function Lt(e,t,n,s,i,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},null!==t&&(null!==(t=_i(t))&&xt(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Mt(e){var t=vi(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void Nt(e.priority,function(){wt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_i(n))&&xt(t),e.blockedOn=n,!1;var s=new(n=e.nativeEvent).constructor(n.type,n);Ee=s,n.target.dispatchEvent(s),Ee=null,t.shift()}return!0}function Vt(e,t,n){Ut(e)&&n.delete(t)}function Ft(){Tt=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==It&&Ut(It)&&(It=null),null!==At&&Ut(At)&&(At=null),Ot.forEach(Vt),kt.forEach(Vt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ft)))}function Gt(e){function t(t){return Bt(t,e)}if(0<Ct.length){Bt(Ct[0],e);for(var n=1;n<Ct.length;n++){var s=Ct[n];s.blockedOn===e&&(s.blockedOn=null)}}for(null!==Rt&&Bt(Rt,e),null!==It&&Bt(It,e),null!==At&&Bt(At,e),Ot.forEach(t),kt.forEach(t),n=0;n<Dt.length;n++)(s=Dt[n]).blockedOn===e&&(s.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Dt.shift()}var Wt=E.ReactCurrentBatchConfig,Ht=!0;function Kt(e,t,n,s){var i=_t,r=Wt.transition;Wt.transition=null;try{_t=1,qt(e,t,n,s)}finally{_t=i,Wt.transition=r}}function zt(e,t,n,s){var i=_t,r=Wt.transition;Wt.transition=null;try{_t=4,qt(e,t,n,s)}finally{_t=i,Wt.transition=r}}function qt(e,t,n,s){if(Ht){var i=Xt(e,t,n,s);if(null===i)Hs(e,t,s,Yt,n),jt(e,s);else if(function(e,t,n,s,i){switch(t){case"focusin":return Rt=Lt(Rt,e,t,n,s,i),!0;case"dragenter":return It=Lt(It,e,t,n,s,i),!0;case"mouseover":return At=Lt(At,e,t,n,s,i),!0;case"pointerover":var r=i.pointerId;return Ot.set(r,Lt(Ot.get(r)||null,e,t,n,s,i)),!0;case"gotpointercapture":return r=i.pointerId,kt.set(r,Lt(kt.get(r)||null,e,t,n,s,i)),!0}return!1}(i,e,t,n,s))s.stopPropagation();else if(jt(e,s),4&t&&-1<Pt.indexOf(e)){for(;null!==i;){var r=_i(i);if(null!==r&&bt(r),null===(r=Xt(e,t,n,s))&&Hs(e,t,s,Yt,n),r===i)break;i=r}null!==i&&s.stopPropagation()}else Hs(e,t,s,null,n)}}var Yt=null;function Xt(e,t,n,s){if(Yt=null,null!==(e=vi(e=be(s))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case st:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,s=n.length,i="value"in Qt?Qt.value:Qt.textContent,r=i.length;for(e=0;e<s&&n[e]===i[e];e++);var a=s-e;for(t=1;t<=a&&n[s-t]===i[r-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function sn(){return!1}function rn(e){function t(t,n,s,i,r){for(var a in this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:sn,this.isPropagationStopped=sn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=rn(ln),un=M({},ln,{view:0,detail:0}),hn=rn(un),pn=M({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,on=e.screenY-cn.screenY):on=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),mn=rn(pn),fn=rn(M({},pn,{dataTransfer:0})),gn=rn(M({},un,{relatedTarget:0})),yn=rn(M({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=M({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=rn(vn),En=rn(M({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wn[e])&&!!t[e]}function Nn(){return Sn}var Tn=M({},un,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=rn(Tn),Rn=rn(M({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=rn(M({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nn})),An=rn(M({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),On=M({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),kn=rn(On),Dn=[9,13,27,32],Pn=d&&"CompositionEvent"in window,jn=null;d&&"documentMode"in document&&(jn=document.documentMode);var Ln=d&&"TextEvent"in window&&!jn,Mn=d&&(!Pn||jn&&8<jn&&11>=jn),Un=String.fromCharCode(32),Vn=!1;function Fn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Kn(e,t,n,s){Te(s),0<(t=zs(t,"onChange")).length&&(n=new dn("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var zn=null,qn=null;function Yn(e){Us(e,0)}function Xn(e){if(q(Ei(e)))return e}function Jn(e,t){if("change"===e)return t}var Qn=!1;if(d){var Zn;if(d){var $n="oninput"in document;if(!$n){var es=document.createElement("div");es.setAttribute("oninput","return;"),$n="function"===typeof es.oninput}Zn=$n}else Zn=!1;Qn=Zn&&(!document.documentMode||9<document.documentMode)}function ts(){zn&&(zn.detachEvent("onpropertychange",ns),qn=zn=null)}function ns(e){if("value"===e.propertyName&&Xn(qn)){var t=[];Kn(t,qn,e,be(e)),Oe(Yn,t)}}function ss(e,t,n){"focusin"===e?(ts(),qn=n,(zn=t).attachEvent("onpropertychange",ns)):"focusout"===e&&ts()}function is(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function rs(e,t){if("click"===e)return Xn(t)}function as(e,t){if("input"===e||"change"===e)return Xn(t)}var os="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cs(e,t){if(os(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var i=n[s];if(!u.call(t,i)||!os(e[i],t[i]))return!1}return!0}function ls(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ds(e,t){var n,s=ls(e);for(e=0;s;){if(3===s.nodeType){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=ls(s)}}function us(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?us(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hs(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(s){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function ps(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function ms(e){var t=hs(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&us(n.ownerDocument.documentElement,n)){if(null!==s&&ps(n))if(t=s.start,void 0===(e=s.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,r=Math.min(s.start,i);s=void 0===s.end?r:Math.min(s.end,i),!e.extend&&r>s&&(i=s,s=r,r=i),i=ds(n,r);var a=ds(n,s);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),r>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fs=d&&"documentMode"in document&&11>=document.documentMode,gs=null,ys=null,vs=null,_s=!1;function Es(e,t,n){var s=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_s||null==gs||gs!==Y(s)||("selectionStart"in(s=gs)&&ps(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},vs&&cs(vs,s)||(vs=s,0<(s=zs(ys,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=gs)))}function bs(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xs={animationend:bs("Animation","AnimationEnd"),animationiteration:bs("Animation","AnimationIteration"),animationstart:bs("Animation","AnimationStart"),transitionend:bs("Transition","TransitionEnd")},ws={},Ss={};function Ns(e){if(ws[e])return ws[e];if(!xs[e])return e;var t,n=xs[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ss)return ws[e]=n[t];return e}d&&(Ss=document.createElement("div").style,"AnimationEvent"in window||(delete xs.animationend.animation,delete xs.animationiteration.animation,delete xs.animationstart.animation),"TransitionEvent"in window||delete xs.transitionend.transition);var Ts=Ns("animationend"),Cs=Ns("animationiteration"),Rs=Ns("animationstart"),Is=Ns("transitionend"),As=new Map,Os="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ks(e,t){As.set(e,t),c(t,[e])}for(var Ds=0;Ds<Os.length;Ds++){var Ps=Os[Ds];ks(Ps.toLowerCase(),"on"+(Ps[0].toUpperCase()+Ps.slice(1)))}ks(Ts,"onAnimationEnd"),ks(Cs,"onAnimationIteration"),ks(Rs,"onAnimationStart"),ks("dblclick","onDoubleClick"),ks("focusin","onFocus"),ks("focusout","onBlur"),ks(Is,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var js="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ls=new Set("cancel close invalid load scroll toggle".split(" ").concat(js));function Ms(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,s,i,a,o,c,l){if(Be.apply(this,arguments),Le){if(!Le)throw Error(r(198));var d=Me;Le=!1,Me=null,Ue||(Ue=!0,Ve=d)}}(s,t,void 0,e),e.currentTarget=null}function Us(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var s=e[n],i=s.event;s=s.listeners;e:{var r=void 0;if(t)for(var a=s.length-1;0<=a;a--){var o=s[a],c=o.instance,l=o.currentTarget;if(o=o.listener,c!==r&&i.isPropagationStopped())break e;Ms(i,o,l),r=c}else for(a=0;a<s.length;a++){if(c=(o=s[a]).instance,l=o.currentTarget,o=o.listener,c!==r&&i.isPropagationStopped())break e;Ms(i,o,l),r=c}}}if(Ue)throw e=Ve,Ue=!1,Ve=null,e}function Vs(e,t){var n=t[fi];void 0===n&&(n=t[fi]=new Set);var s=e+"__bubble";n.has(s)||(Ws(t,e,2,!1),n.add(s))}function Fs(e,t,n){var s=0;t&&(s|=4),Ws(n,e,s,t)}var Bs="_reactListening"+Math.random().toString(36).slice(2);function Gs(e){if(!e[Bs]){e[Bs]=!0,a.forEach(function(t){"selectionchange"!==t&&(Ls.has(t)||Fs(t,!1,e),Fs(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bs]||(t[Bs]=!0,Fs("selectionchange",!1,t))}}function Ws(e,t,n,s){switch(Jt(t)){case 1:var i=Kt;break;case 4:i=zt;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),s?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hs(e,t,n,s,i){var r=s;if(0===(1&t)&&0===(2&t)&&null!==s)e:for(;;){if(null===s)return;var a=s.tag;if(3===a||4===a){var o=s.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===a)for(a=s.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;a=a.return}for(;null!==o;){if(null===(a=vi(o)))return;if(5===(c=a.tag)||6===c){s=r=a;continue e}o=o.parentNode}}s=s.return}Oe(function(){var s=r,i=be(n),a=[];e:{var o=As.get(e);if(void 0!==o){var c=dn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Cn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=In;break;case Ts:case Cs:case Rs:c=yn;break;case Is:c=An;break;case"scroll":c=hn;break;case"wheel":c=kn;break;case"copy":case"cut":case"paste":c=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Rn}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var p,m=s;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=ke(m,h))&&d.push(Ks(m,f,p)))),u)break;m=m.return}0<d.length&&(o=new c(o,l,null,n,i),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Ee||!(l=n.relatedTarget||n.fromElement)||!vi(l)&&!l[mi])&&(c||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=s,null!==(l=(l=n.relatedTarget||n.toElement)?vi(l):null)&&(l!==(u=Ge(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=s),c!==l)){if(d=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Rn,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==c?o:Ei(c),p=null==l?o:Ei(l),(o=new d(f,m+"leave",c,n,i)).target=u,o.relatedTarget=p,f=null,vi(i)===s&&((d=new d(h,m+"enter",l,n,i)).target=p,d.relatedTarget=u,f=d),u=f,c&&l)e:{for(h=l,m=0,p=d=c;p;p=qs(p))m++;for(p=0,f=h;f;f=qs(f))p++;for(;0<m-p;)d=qs(d),m--;for(;0<p-m;)h=qs(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=qs(d),h=qs(h)}d=null}else d=null;null!==c&&Ys(a,o,c,d,!1),null!==l&&null!==u&&Ys(a,u,l,d,!0)}if("select"===(c=(o=s?Ei(s):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var g=Jn;else if(Hn(o))if(Qn)g=as;else{g=is;var y=ss}else(c=o.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=rs);switch(g&&(g=g(e,s))?Kn(a,g,n,i):(y&&y(e,o,s),"focusout"===e&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&ee(o,"number",o.value)),y=s?Ei(s):window,e){case"focusin":(Hn(y)||"true"===y.contentEditable)&&(gs=y,ys=s,vs=null);break;case"focusout":vs=ys=gs=null;break;case"mousedown":_s=!0;break;case"contextmenu":case"mouseup":case"dragend":_s=!1,Es(a,n,i);break;case"selectionchange":if(fs)break;case"keydown":case"keyup":Es(a,n,i)}var v;if(Pn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Gn?Fn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Mn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Gn&&(v=en()):(Zt="value"in(Qt=i)?Qt.value:Qt.textContent,Gn=!0)),0<(y=zs(s,_)).length&&(_=new En(_,e,null,n,i),a.push({event:_,listeners:y}),v?_.data=v:null!==(v=Bn(n))&&(_.data=v))),(v=Ln?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Vn=!0,Un);case"textInput":return(e=t.data)===Un&&Vn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Pn&&Fn(e,t)?(e=en(),$t=Zt=Qt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(s=zs(s,"onBeforeInput")).length&&(i=new En("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:s}),i.data=v))}Us(a,t)})}function Ks(e,t,n){return{instance:e,listener:t,currentTarget:n}}function zs(e,t){for(var n=t+"Capture",s=[];null!==e;){var i=e,r=i.stateNode;5===i.tag&&null!==r&&(i=r,null!=(r=ke(e,n))&&s.unshift(Ks(e,r,i)),null!=(r=ke(e,t))&&s.push(Ks(e,r,i))),e=e.return}return s}function qs(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ys(e,t,n,s,i){for(var r=t._reactName,a=[];null!==n&&n!==s;){var o=n,c=o.alternate,l=o.stateNode;if(null!==c&&c===s)break;5===o.tag&&null!==l&&(o=l,i?null!=(c=ke(n,r))&&a.unshift(Ks(n,c,o)):i||null!=(c=ke(n,r))&&a.push(Ks(n,c,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Xs=/\r\n?/g,Js=/\u0000|\uFFFD/g;function Qs(e){return("string"===typeof e?e:""+e).replace(Xs,"\n").replace(Js,"")}function Zs(e,t,n){if(t=Qs(t),Qs(e)!==t&&n)throw Error(r(425))}function $s(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var si="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ri="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ri?function(e){return ri.resolve(null).then(e).catch(oi)}:si;function oi(e){setTimeout(function(){throw e})}function ci(e,t){var n=t,s=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===s)return e.removeChild(i),void Gt(t);s--}else"$"!==n&&"$?"!==n&&"$!"!==n||s++;n=i}while(n);Gt(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function di(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ui=Math.random().toString(36).slice(2),hi="__reactFiber$"+ui,pi="__reactProps$"+ui,mi="__reactContainer$"+ui,fi="__reactEvents$"+ui,gi="__reactListeners$"+ui,yi="__reactHandles$"+ui;function vi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=di(e);null!==e;){if(n=e[hi])return n;e=di(e)}return t}n=(e=n).parentNode}return null}function _i(e){return!(e=e[hi]||e[mi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ei(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function bi(e){return e[pi]||null}var xi=[],wi=-1;function Si(e){return{current:e}}function Ni(e){0>wi||(e.current=xi[wi],xi[wi]=null,wi--)}function Ti(e,t){wi++,xi[wi]=e.current,e.current=t}var Ci={},Ri=Si(Ci),Ii=Si(!1),Ai=Ci;function Oi(e,t){var n=e.type.contextTypes;if(!n)return Ci;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var i,r={};for(i in n)r[i]=t[i];return s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function ki(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Di(){Ni(Ii),Ni(Ri)}function Pi(e,t,n){if(Ri.current!==Ci)throw Error(r(168));Ti(Ri,t),Ti(Ii,n)}function ji(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,"function"!==typeof s.getChildContext)return n;for(var i in s=s.getChildContext())if(!(i in t))throw Error(r(108,W(e)||"Unknown",i));return M({},n,s)}function Li(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Ai=Ri.current,Ti(Ri,e),Ti(Ii,Ii.current),!0}function Mi(e,t,n){var s=e.stateNode;if(!s)throw Error(r(169));n?(e=ji(e,t,Ai),s.__reactInternalMemoizedMergedChildContext=e,Ni(Ii),Ni(Ri),Ti(Ri,e)):Ni(Ii),Ti(Ii,n)}var Ui=null,Vi=!1,Fi=!1;function Bi(e){null===Ui?Ui=[e]:Ui.push(e)}function Gi(){if(!Fi&&null!==Ui){Fi=!0;var e=0,t=_t;try{var n=Ui;for(_t=1;e<n.length;e++){var s=n[e];do{s=s(!0)}while(null!==s)}Ui=null,Vi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(e+1)),qe($e,Gi),i}finally{_t=t,Fi=!1}}return null}var Wi=[],Hi=0,Ki=null,zi=0,qi=[],Yi=0,Xi=null,Ji=1,Qi="";function Zi(e,t){Wi[Hi++]=zi,Wi[Hi++]=Ki,Ki=e,zi=t}function $i(e,t,n){qi[Yi++]=Ji,qi[Yi++]=Qi,qi[Yi++]=Xi,Xi=e;var s=Ji;e=Qi;var i=32-at(s)-1;s&=~(1<<i),n+=1;var r=32-at(t)+i;if(30<r){var a=i-i%5;r=(s&(1<<a)-1).toString(32),s>>=a,i-=a,Ji=1<<32-at(t)+i|n<<i|s,Qi=r+e}else Ji=1<<r|n<<i|s,Qi=e}function er(e){null!==e.return&&(Zi(e,1),$i(e,1,0))}function tr(e){for(;e===Ki;)Ki=Wi[--Hi],Wi[Hi]=null,zi=Wi[--Hi],Wi[Hi]=null;for(;e===Xi;)Xi=qi[--Yi],qi[Yi]=null,Qi=qi[--Yi],qi[Yi]=null,Ji=qi[--Yi],qi[Yi]=null}var nr=null,sr=null,ir=!1,rr=null;function ar(e,t){var n=kl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function or(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,nr=e,sr=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,nr=e,sr=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:Ji,overflow:Qi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=kl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,nr=e,sr=null,!0);default:return!1}}function cr(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function lr(e){if(ir){var t=sr;if(t){var n=t;if(!or(e,t)){if(cr(e))throw Error(r(418));t=li(n.nextSibling);var s=nr;t&&or(e,t)?ar(s,n):(e.flags=-4097&e.flags|2,ir=!1,nr=e)}}else{if(cr(e))throw Error(r(418));e.flags=-4097&e.flags|2,ir=!1,nr=e}}}function dr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;nr=e}function ur(e){if(e!==nr)return!1;if(!ir)return dr(e),ir=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=sr)){if(cr(e))throw hr(),Error(r(418));for(;t;)ar(e,t),t=li(t.nextSibling)}if(dr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){sr=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}sr=null}}else sr=nr?li(e.stateNode.nextSibling):null;return!0}function hr(){for(var e=sr;e;)e=li(e.nextSibling)}function pr(){sr=nr=null,ir=!1}function mr(e){null===rr?rr=[e]:rr.push(e)}var fr=E.ReactCurrentBatchConfig;function gr(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var yr=Si(null),vr=null,_r=null,Er=null;function br(){Er=_r=vr=null}function xr(e){var t=yr.current;Ni(yr),e._currentValue=t}function wr(e,t,n){for(;null!==e;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==s&&(s.childLanes|=t)):null!==s&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function Sr(e,t){vr=e,Er=_r=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Eo=!0),e.firstContext=null)}function Nr(e){var t=e._currentValue;if(Er!==e)if(e={context:e,memoizedValue:t,next:null},null===_r){if(null===vr)throw Error(r(308));_r=e,vr.dependencies={lanes:0,firstContext:e}}else _r=_r.next=e;return t}var Tr=null;function Cr(e){null===Tr?Tr=[e]:Tr.push(e)}function Rr(e,t,n,s){var i=t.interleaved;return null===i?(n.next=n,Cr(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ir(e,s)}function Ir(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ar=!1;function Or(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Dr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Pr(e,t,n){var s=e.updateQueue;if(null===s)return null;if(s=s.shared,0!==(2&Ic)){var i=s.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),s.pending=t,Ir(e,n)}return null===(i=s.interleaved)?(t.next=t,Cr(s)):(t.next=i.next,i.next=t),s.interleaved=t,Ir(e,n)}function jr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Lr(e,t){var n=e.updateQueue,s=e.alternate;if(null!==s&&n===(s=s.updateQueue)){var i=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?i=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?i=r=t:r=r.next=t}else i=r=t;return n={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Mr(e,t,n,s){var i=e.updateQueue;Ar=!1;var r=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var c=o,l=c.next;c.next=null,null===a?r=l:a.next=l,a=c;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=l:o.next=l,d.lastBaseUpdate=c))}if(null!==r){var u=i.baseState;for(a=0,d=l=c=null,o=r;;){var h=o.lane,p=o.eventTime;if((s&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,f=o;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=M({},u,h);break e;case 2:Ar=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,a|=h;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(h=o).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===d&&(c=u),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===r&&(i.shared.lanes=0);Mc|=a,e.lanes=a,e.memoizedState=u}}function Ur(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var s=e[t],i=s.callback;if(null!==i){if(s.callback=null,s=n,"function"!==typeof i)throw Error(r(191,i));i.call(s)}}}var Vr=(new s.Component).refs;function Fr(e,t,n,s){n=null===(n=n(s,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Br={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=tl(),i=nl(e),r=Dr(s,i);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Pr(e,r,i))&&(sl(t,e,i,s),jr(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=tl(),i=nl(e),r=Dr(s,i);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Pr(e,r,i))&&(sl(t,e,i,s),jr(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),s=nl(e),i=Dr(n,s);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Pr(e,i,s))&&(sl(t,e,s,n),jr(t,e,s))}};function Gr(e,t,n,s,i,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(s,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!cs(n,s)||!cs(i,r))}function Wr(e,t,n){var s=!1,i=Ci,r=t.contextType;return"object"===typeof r&&null!==r?r=Nr(r):(i=ki(t)?Ai:Ri.current,r=(s=null!==(s=t.contextTypes)&&void 0!==s)?Oi(e,i):Ci),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Br,e.stateNode=t,t._reactInternals=e,s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=r),t}function Hr(e,t,n,s){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,s),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Br.enqueueReplaceState(t,t.state,null)}function Kr(e,t,n,s){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Vr,Or(e);var r=t.contextType;"object"===typeof r&&null!==r?i.context=Nr(r):(r=ki(t)?Ai:Ri.current,i.context=Oi(e,r)),i.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(Fr(e,t,r,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Br.enqueueReplaceState(i,i.state,null),Mr(e,n,i,s),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function zr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(r(309));var s=n.stateNode}if(!s)throw Error(r(147,e));var i=s,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;t===Vr&&(t=i.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(r(284));if(!n._owner)throw Error(r(290,e))}return e}function qr(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yr(e){return(0,e._init)(e._payload)}function Xr(e){function t(t,n){if(e){var s=t.deletions;null===s?(t.deletions=[n],t.flags|=16):s.push(n)}}function n(n,s){if(!e)return null;for(;null!==s;)t(n,s),s=s.sibling;return null}function s(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pl(e,t)).index=0,e.sibling=null,e}function a(t,n,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<n?(t.flags|=2,n):s:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,s){return null===t||6!==t.tag?((t=Ul(n,e.mode,s)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,s){var r=n.type;return r===w?u(e,t,n.props.children,s,n.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===k&&Yr(r)===t.type)?((s=i(t,n.props)).ref=zr(e,t,n),s.return=e,s):((s=jl(n.type,n.key,n.props,null,e.mode,s)).ref=zr(e,t,n),s.return=e,s)}function d(e,t,n,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vl(n,e.mode,s)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,s,r){return null===t||7!==t.tag?((t=Ll(n,e.mode,s,r)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ul(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=jl(t.type,t.key,t.props,null,e.mode,n)).ref=zr(e,null,t),n.return=e,n;case x:return(t=Vl(t,e.mode,n)).return=e,t;case k:return h(e,(0,t._init)(t._payload),n)}if(te(t)||j(t))return(t=Ll(t,e.mode,n,null)).return=e,t;qr(e,t)}return null}function p(e,t,n,s){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,s);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?l(e,t,n,s):null;case x:return n.key===i?d(e,t,n,s):null;case k:return p(e,t,(i=n._init)(n._payload),s)}if(te(n)||j(n))return null!==i?null:u(e,t,n,s,null);qr(e,n)}return null}function m(e,t,n,s,i){if("string"===typeof s&&""!==s||"number"===typeof s)return c(t,e=e.get(n)||null,""+s,i);if("object"===typeof s&&null!==s){switch(s.$$typeof){case b:return l(t,e=e.get(null===s.key?n:s.key)||null,s,i);case x:return d(t,e=e.get(null===s.key?n:s.key)||null,s,i);case k:return m(e,t,n,(0,s._init)(s._payload),i)}if(te(s)||j(s))return u(t,e=e.get(n)||null,s,i,null);qr(t,s)}return null}function f(i,r,o,c){for(var l=null,d=null,u=r,f=r=0,g=null;null!==u&&f<o.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var y=p(i,u,o[f],c);if(null===y){null===u&&(u=g);break}e&&u&&null===y.alternate&&t(i,u),r=a(y,r,f),null===d?l=y:d.sibling=y,d=y,u=g}if(f===o.length)return n(i,u),ir&&Zi(i,f),l;if(null===u){for(;f<o.length;f++)null!==(u=h(i,o[f],c))&&(r=a(u,r,f),null===d?l=u:d.sibling=u,d=u);return ir&&Zi(i,f),l}for(u=s(i,u);f<o.length;f++)null!==(g=m(u,i,f,o[f],c))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),r=a(g,r,f),null===d?l=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(i,e)}),ir&&Zi(i,f),l}function g(i,o,c,l){var d=j(c);if("function"!==typeof d)throw Error(r(150));if(null==(c=d.call(c)))throw Error(r(151));for(var u=d=null,f=o,g=o=0,y=null,v=c.next();null!==f&&!v.done;g++,v=c.next()){f.index>g?(y=f,f=null):y=f.sibling;var _=p(i,f,v.value,l);if(null===_){null===f&&(f=y);break}e&&f&&null===_.alternate&&t(i,f),o=a(_,o,g),null===u?d=_:u.sibling=_,u=_,f=y}if(v.done)return n(i,f),ir&&Zi(i,g),d;if(null===f){for(;!v.done;g++,v=c.next())null!==(v=h(i,v.value,l))&&(o=a(v,o,g),null===u?d=v:u.sibling=v,u=v);return ir&&Zi(i,g),d}for(f=s(i,f);!v.done;g++,v=c.next())null!==(v=m(f,i,g,v.value,l))&&(e&&null!==v.alternate&&f.delete(null===v.key?g:v.key),o=a(v,o,g),null===u?d=v:u.sibling=v,u=v);return e&&f.forEach(function(e){return t(i,e)}),ir&&Zi(i,g),d}return function e(s,r,a,c){if("object"===typeof a&&null!==a&&a.type===w&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case b:e:{for(var l=a.key,d=r;null!==d;){if(d.key===l){if((l=a.type)===w){if(7===d.tag){n(s,d.sibling),(r=i(d,a.props.children)).return=s,s=r;break e}}else if(d.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===k&&Yr(l)===d.type){n(s,d.sibling),(r=i(d,a.props)).ref=zr(s,d,a),r.return=s,s=r;break e}n(s,d);break}t(s,d),d=d.sibling}a.type===w?((r=Ll(a.props.children,s.mode,c,a.key)).return=s,s=r):((c=jl(a.type,a.key,a.props,null,s.mode,c)).ref=zr(s,r,a),c.return=s,s=c)}return o(s);case x:e:{for(d=a.key;null!==r;){if(r.key===d){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(s,r.sibling),(r=i(r,a.children||[])).return=s,s=r;break e}n(s,r);break}t(s,r),r=r.sibling}(r=Vl(a,s.mode,c)).return=s,s=r}return o(s);case k:return e(s,r,(d=a._init)(a._payload),c)}if(te(a))return f(s,r,a,c);if(j(a))return g(s,r,a,c);qr(s,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==r&&6===r.tag?(n(s,r.sibling),(r=i(r,a)).return=s,s=r):(n(s,r),(r=Ul(a,s.mode,c)).return=s,s=r),o(s)):n(s,r)}}var Jr=Xr(!0),Qr=Xr(!1),Zr={},$r=Si(Zr),ea=Si(Zr),ta=Si(Zr);function na(e){if(e===Zr)throw Error(r(174));return e}function sa(e,t){switch(Ti(ta,t),Ti(ea,e),Ti($r,Zr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ni($r),Ti($r,t)}function ia(){Ni($r),Ni(ea),Ni(ta)}function ra(e){na(ta.current);var t=na($r.current),n=ce(t,e.type);t!==n&&(Ti(ea,e),Ti($r,n))}function aa(e){ea.current===e&&(Ni($r),Ni(ea))}var oa=Si(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var la=[];function da(){for(var e=0;e<la.length;e++)la[e]._workInProgressVersionPrimary=null;la.length=0}var ua=E.ReactCurrentDispatcher,ha=E.ReactCurrentBatchConfig,pa=0,ma=null,fa=null,ga=null,ya=!1,va=!1,_a=0,Ea=0;function ba(){throw Error(r(321))}function xa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!os(e[n],t[n]))return!1;return!0}function wa(e,t,n,s,i,a){if(pa=a,ma=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ua.current=null===e||null===e.memoizedState?ao:oo,e=n(s,i),va){a=0;do{if(va=!1,_a=0,25<=a)throw Error(r(301));a+=1,ga=fa=null,t.updateQueue=null,ua.current=co,e=n(s,i)}while(va)}if(ua.current=ro,t=null!==fa&&null!==fa.next,pa=0,ga=fa=ma=null,ya=!1,t)throw Error(r(300));return e}function Sa(){var e=0!==_a;return _a=0,e}function Na(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ga?ma.memoizedState=ga=e:ga=ga.next=e,ga}function Ta(){if(null===fa){var e=ma.alternate;e=null!==e?e.memoizedState:null}else e=fa.next;var t=null===ga?ma.memoizedState:ga.next;if(null!==t)ga=t,fa=e;else{if(null===e)throw Error(r(310));e={memoizedState:(fa=e).memoizedState,baseState:fa.baseState,baseQueue:fa.baseQueue,queue:fa.queue,next:null},null===ga?ma.memoizedState=ga=e:ga=ga.next=e}return ga}function Ca(e,t){return"function"===typeof t?t(e):t}function Ra(e){var t=Ta(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var s=fa,i=s.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}s.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,s=s.baseState;var c=o=null,l=null,d=a;do{var u=d.lane;if((pa&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),s=d.hasEagerState?d.eagerState:e(s,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===l?(c=l=h,o=s):l=l.next=h,ma.lanes|=u,Mc|=u}d=d.next}while(null!==d&&d!==a);null===l?o=s:l.next=c,os(s,t.memoizedState)||(Eo=!0),t.memoizedState=s,t.baseState=o,t.baseQueue=l,n.lastRenderedState=s}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,ma.lanes|=a,Mc|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ia(e){var t=Ta(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var s=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);os(a,t.memoizedState)||(Eo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,s]}function Aa(){}function Oa(e,t){var n=ma,s=Ta(),i=t(),a=!os(s.memoizedState,i);if(a&&(s.memoizedState=i,Eo=!0),s=s.queue,Wa(Pa.bind(null,n,s,e),[e]),s.getSnapshot!==t||a||null!==ga&&1&ga.memoizedState.tag){if(n.flags|=2048,Ua(9,Da.bind(null,n,s,i,t),void 0,null),null===Ac)throw Error(r(349));0!==(30&pa)||ka(n,t,i)}return i}function ka(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Da(e,t,n,s){t.value=n,t.getSnapshot=s,ja(t)&&La(e)}function Pa(e,t,n){return n(function(){ja(t)&&La(e)})}function ja(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!os(e,n)}catch(s){return!0}}function La(e){var t=Ir(e,1);null!==t&&sl(t,e,1,-1)}function Ma(e){var t=Na();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:e},t.queue=e,e=e.dispatch=to.bind(null,ma,e),[t.memoizedState,e]}function Ua(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e),e}function Va(){return Ta().memoizedState}function Fa(e,t,n,s){var i=Na();ma.flags|=e,i.memoizedState=Ua(1|t,n,void 0,void 0===s?null:s)}function Ba(e,t,n,s){var i=Ta();s=void 0===s?null:s;var r=void 0;if(null!==fa){var a=fa.memoizedState;if(r=a.destroy,null!==s&&xa(s,a.deps))return void(i.memoizedState=Ua(t,n,r,s))}ma.flags|=e,i.memoizedState=Ua(1|t,n,r,s)}function Ga(e,t){return Fa(8390656,8,e,t)}function Wa(e,t){return Ba(2048,8,e,t)}function Ha(e,t){return Ba(4,2,e,t)}function Ka(e,t){return Ba(4,4,e,t)}function za(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ba(4,4,za.bind(null,t,e),n)}function Ya(){}function Xa(e,t){var n=Ta();t=void 0===t?null:t;var s=n.memoizedState;return null!==s&&null!==t&&xa(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Ja(e,t){var n=Ta();t=void 0===t?null:t;var s=n.memoizedState;return null!==s&&null!==t&&xa(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Qa(e,t,n){return 0===(21&pa)?(e.baseState&&(e.baseState=!1,Eo=!0),e.memoizedState=n):(os(n,t)||(n=ft(),ma.lanes|=n,Mc|=n,e.baseState=!0),t)}function Za(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var s=ha.transition;ha.transition={};try{e(!1),t()}finally{_t=n,ha.transition=s}}function $a(){return Ta().memoizedState}function eo(e,t,n){var s=nl(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},no(e))so(t,n);else if(null!==(n=Rr(e,t,n,s))){sl(n,e,s,tl()),io(n,t,s)}}function to(e,t,n){var s=nl(e),i={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(no(e))so(t,i);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=r(a,n);if(i.hasEagerState=!0,i.eagerState=o,os(o,a)){var c=t.interleaved;return null===c?(i.next=i,Cr(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(l){}null!==(n=Rr(e,t,i,s))&&(sl(n,e,s,i=tl()),io(n,t,s))}}function no(e){var t=e.alternate;return e===ma||null!==t&&t===ma}function so(e,t){va=ya=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function io(e,t,n){if(0!==(4194240&n)){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,vt(e,n)}}var ro={readContext:Nr,useCallback:ba,useContext:ba,useEffect:ba,useImperativeHandle:ba,useInsertionEffect:ba,useLayoutEffect:ba,useMemo:ba,useReducer:ba,useRef:ba,useState:ba,useDebugValue:ba,useDeferredValue:ba,useTransition:ba,useMutableSource:ba,useSyncExternalStore:ba,useId:ba,unstable_isNewReconciler:!1},ao={readContext:Nr,useCallback:function(e,t){return Na().memoizedState=[e,void 0===t?null:t],e},useContext:Nr,useEffect:Ga,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Fa(4194308,4,za.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Fa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Fa(4,2,e,t)},useMemo:function(e,t){var n=Na();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=Na();return t=void 0!==n?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=eo.bind(null,ma,e),[s.memoizedState,e]},useRef:function(e){return e={current:e},Na().memoizedState=e},useState:Ma,useDebugValue:Ya,useDeferredValue:function(e){return Na().memoizedState=e},useTransition:function(){var e=Ma(!1),t=e[0];return e=Za.bind(null,e[1]),Na().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=ma,i=Na();if(ir){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===Ac)throw Error(r(349));0!==(30&pa)||ka(s,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Ga(Pa.bind(null,s,a,e),[e]),s.flags|=2048,Ua(9,Da.bind(null,s,a,n,t),void 0,null),n},useId:function(){var e=Na(),t=Ac.identifierPrefix;if(ir){var n=Qi;t=":"+t+"R"+(n=(Ji&~(1<<32-at(Ji)-1)).toString(32)+n),0<(n=_a++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ea++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},oo={readContext:Nr,useCallback:Xa,useContext:Nr,useEffect:Wa,useImperativeHandle:qa,useInsertionEffect:Ha,useLayoutEffect:Ka,useMemo:Ja,useReducer:Ra,useRef:Va,useState:function(){return Ra(Ca)},useDebugValue:Ya,useDeferredValue:function(e){return Qa(Ta(),fa.memoizedState,e)},useTransition:function(){return[Ra(Ca)[0],Ta().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1},co={readContext:Nr,useCallback:Xa,useContext:Nr,useEffect:Wa,useImperativeHandle:qa,useInsertionEffect:Ha,useLayoutEffect:Ka,useMemo:Ja,useReducer:Ia,useRef:Va,useState:function(){return Ia(Ca)},useDebugValue:Ya,useDeferredValue:function(e){var t=Ta();return null===fa?t.memoizedState=e:Qa(t,fa.memoizedState,e)},useTransition:function(){return[Ia(Ca)[0],Ta().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1};function lo(e,t){try{var n="",s=t;do{n+=B(s),s=s.return}while(s);var i=n}catch(r){i="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:i,digest:null}}function uo(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ho(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var po="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,n){(n=Dr(-1,n)).tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Kc||(Kc=!0,zc=s),ho(0,t)},n}function fo(e,t,n){(n=Dr(-1,n)).tag=3;var s=e.type.getDerivedStateFromError;if("function"===typeof s){var i=t.value;n.payload=function(){return s(i)},n.callback=function(){ho(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){ho(0,t),"function"!==typeof s&&(null===qc?qc=new Set([this]):qc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function go(e,t,n){var s=e.pingCache;if(null===s){s=e.pingCache=new po;var i=new Set;s.set(t,i)}else void 0===(i=s.get(t))&&(i=new Set,s.set(t,i));i.has(n)||(i.add(n),e=Tl.bind(null,e,t,n),t.then(e,e))}function yo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,s,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Dr(-1,1)).tag=2,Pr(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var _o=E.ReactCurrentOwner,Eo=!1;function bo(e,t,n,s){t.child=null===e?Qr(t,null,n,s):Jr(t,e.child,n,s)}function xo(e,t,n,s,i){n=n.render;var r=t.ref;return Sr(t,i),s=wa(e,t,n,s,r,i),n=Sa(),null===e||Eo?(ir&&n&&er(t),t.flags|=1,bo(e,t,s,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ko(e,t,i))}function wo(e,t,n,s,i){if(null===e){var r=n.type;return"function"!==typeof r||Dl(r)||void 0!==r.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=jl(n.type,null,s,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,So(e,t,r,s,i))}if(r=e.child,0===(e.lanes&i)){var a=r.memoizedProps;if((n=null!==(n=n.compare)?n:cs)(a,s)&&e.ref===t.ref)return Ko(e,t,i)}return t.flags|=1,(e=Pl(r,s)).ref=t.ref,e.return=t,t.child=e}function So(e,t,n,s,i){if(null!==e){var r=e.memoizedProps;if(cs(r,s)&&e.ref===t.ref){if(Eo=!1,t.pendingProps=s=r,0===(e.lanes&i))return t.lanes=e.lanes,Ko(e,t,i);0!==(131072&e.flags)&&(Eo=!0)}}return Co(e,t,n,s,i)}function No(e,t,n){var s=t.pendingProps,i=s.children,r=null!==e?e.memoizedState:null;if("hidden"===s.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(Pc,Dc),Dc|=n;else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ti(Pc,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=null!==r?r.baseLanes:n,Ti(Pc,Dc),Dc|=s}else null!==r?(s=r.baseLanes|n,t.memoizedState=null):s=n,Ti(Pc,Dc),Dc|=s;return bo(e,t,i,n),t.child}function To(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,n,s,i){var r=ki(n)?Ai:Ri.current;return r=Oi(t,r),Sr(t,i),n=wa(e,t,n,s,r,i),s=Sa(),null===e||Eo?(ir&&s&&er(t),t.flags|=1,bo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ko(e,t,i))}function Ro(e,t,n,s,i){if(ki(n)){var r=!0;Li(t)}else r=!1;if(Sr(t,i),null===t.stateNode)Ho(e,t),Wr(t,n,s),Kr(t,n,s,i),s=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var c=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=Nr(l):l=Oi(t,l=ki(n)?Ai:Ri.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==s||c!==l)&&Hr(t,a,s,l),Ar=!1;var h=t.memoizedState;a.state=h,Mr(t,s,a,i),c=t.memoizedState,o!==s||h!==c||Ii.current||Ar?("function"===typeof d&&(Fr(t,n,d,s),c=t.memoizedState),(o=Ar||Gr(t,n,o,s,h,c,l))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),a.props=s,a.state=c,a.context=l,s=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,kr(e,t),o=t.memoizedProps,l=t.type===t.elementType?o:gr(t.type,o),a.props=l,u=t.pendingProps,h=a.context,"object"===typeof(c=n.contextType)&&null!==c?c=Nr(c):c=Oi(t,c=ki(n)?Ai:Ri.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==c)&&Hr(t,a,s,c),Ar=!1,h=t.memoizedState,a.state=h,Mr(t,s,a,i);var m=t.memoizedState;o!==u||h!==m||Ii.current||Ar?("function"===typeof p&&(Fr(t,n,p,s),m=t.memoizedState),(l=Ar||Gr(t,n,l,s,h,m,c)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(s,m,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(s,m,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=m),a.props=s,a.state=m,a.context=c,s=l):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),s=!1)}return Io(e,t,n,s,r,i)}function Io(e,t,n,s,i,r){To(e,t);var a=0!==(128&t.flags);if(!s&&!a)return i&&Mi(t,n,!1),Ko(e,t,r);s=t.stateNode,_o.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:s.render();return t.flags|=1,null!==e&&a?(t.child=Jr(t,e.child,null,r),t.child=Jr(t,null,o,r)):bo(e,t,o,r),t.memoizedState=s.state,i&&Mi(t,n,!0),t.child}function Ao(e){var t=e.stateNode;t.pendingContext?Pi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pi(0,t.context,!1),sa(e,t.containerInfo)}function Oo(e,t,n,s,i){return pr(),mr(i),t.flags|=256,bo(e,t,n,s),t.child}var ko,Do,Po,jo,Lo={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,n){var s,i=t.pendingProps,a=oa.current,o=!1,c=0!==(128&t.flags);if((s=c)||(s=(null===e||null!==e.memoizedState)&&0!==(2&a)),s?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ti(oa,1&a),null===e)return lr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,o?(i=t.mode,o=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=c):o=Ml(c,i,0,null),e=Ll(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(n),t.memoizedState=Lo,e):Vo(t,c));if(null!==(a=e.memoizedState)&&null!==(s=a.dehydrated))return function(e,t,n,s,i,a,o){if(n)return 256&t.flags?(t.flags&=-257,Fo(e,t,o,s=uo(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=s.fallback,i=t.mode,s=Ml({mode:"visible",children:s.children},i,0,null),(a=Ll(a,i,o,null)).flags|=2,s.return=t,a.return=t,s.sibling=a,t.child=s,0!==(1&t.mode)&&Jr(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=Lo,a);if(0===(1&t.mode))return Fo(e,t,o,null);if("$!"===i.data){if(s=i.nextSibling&&i.nextSibling.dataset)var c=s.dgst;return s=c,Fo(e,t,o,s=uo(a=Error(r(419)),s,void 0))}if(c=0!==(o&e.childLanes),Eo||c){if(null!==(s=Ac)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(s.suspendedLanes|o))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Ir(e,i),sl(s,e,i,-1))}return gl(),Fo(e,t,o,s=uo(Error(r(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Rl.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,sr=li(i.nextSibling),nr=t,ir=!0,rr=null,null!==e&&(qi[Yi++]=Ji,qi[Yi++]=Qi,qi[Yi++]=Xi,Ji=e.id,Qi=e.overflow,Xi=t),t=Vo(t,s.children),t.flags|=4096,t)}(e,t,c,i,s,a,n);if(o){o=i.fallback,c=t.mode,s=(a=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Pl(a,l)).subtreeFlags=14680064&a.subtreeFlags,null!==s?o=Pl(s,o):(o=Ll(o,c,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,c=null===(c=e.child.memoizedState)?Mo(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},o.memoizedState=c,o.childLanes=e.childLanes&~n,t.memoizedState=Lo,i}return e=(o=e.child).sibling,i=Pl(o,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Vo(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fo(e,t,n,s){return null!==s&&mr(s),Jr(t,e.child,null,n),(e=Vo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bo(e,t,n){e.lanes|=t;var s=e.alternate;null!==s&&(s.lanes|=t),wr(e.return,t,n)}function Go(e,t,n,s,i){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:i}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=n,r.tailMode=i)}function Wo(e,t,n){var s=t.pendingProps,i=s.revealOrder,r=s.tail;if(bo(e,t,s.children,n),0!==(2&(s=oa.current)))s=1&s|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bo(e,n,t);else if(19===e.tag)Bo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(Ti(oa,s),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Go(t,!1,i,n,r);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ca(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Go(t,!0,n,null,r);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ko(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Pl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function zo(e,t){if(!ir)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;null!==n;)null!==n.alternate&&(s=n),n=n.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,s=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,s|=14680064&i.subtreeFlags,s|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function Yo(e,t,n){var s=t.pendingProps;switch(tr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:case 17:return ki(t.type)&&Di(),qo(t),null;case 3:return s=t.stateNode,ia(),Ni(Ii),Ni(Ri),da(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),null!==e&&null!==e.child||(ur(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==rr&&(ol(rr),rr=null))),Do(e,t),qo(t),null;case 5:aa(t);var i=na(ta.current);if(n=t.type,null!==e&&null!=t.stateNode)Po(e,t,n,s,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(null===t.stateNode)throw Error(r(166));return qo(t),null}if(e=na($r.current),ur(t)){s=t.stateNode,n=t.type;var a=t.memoizedProps;switch(s[hi]=t,s[pi]=a,e=0!==(1&t.mode),n){case"dialog":Vs("cancel",s),Vs("close",s);break;case"iframe":case"object":case"embed":Vs("load",s);break;case"video":case"audio":for(i=0;i<js.length;i++)Vs(js[i],s);break;case"source":Vs("error",s);break;case"img":case"image":case"link":Vs("error",s),Vs("load",s);break;case"details":Vs("toggle",s);break;case"input":J(s,a),Vs("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!a.multiple},Vs("invalid",s);break;case"textarea":ie(s,a),Vs("invalid",s)}for(var c in ve(n,a),i=null,a)if(a.hasOwnProperty(c)){var l=a[c];"children"===c?"string"===typeof l?s.textContent!==l&&(!0!==a.suppressHydrationWarning&&Zs(s.textContent,l,e),i=["children",l]):"number"===typeof l&&s.textContent!==""+l&&(!0!==a.suppressHydrationWarning&&Zs(s.textContent,l,e),i=["children",""+l]):o.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Vs("scroll",s)}switch(n){case"input":z(s),$(s,a,!0);break;case"textarea":z(s),ae(s);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(s.onclick=$s)}s=i,t.updateQueue=s,null!==s&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof s.is?e=c.createElement(n,{is:s.is}):(e=c.createElement(n),"select"===n&&(c=e,s.multiple?c.multiple=!0:s.size&&(c.size=s.size))):e=c.createElementNS(e,n),e[hi]=t,e[pi]=s,ko(e,t,!1,!1),t.stateNode=e;e:{switch(c=_e(n,s),n){case"dialog":Vs("cancel",e),Vs("close",e),i=s;break;case"iframe":case"object":case"embed":Vs("load",e),i=s;break;case"video":case"audio":for(i=0;i<js.length;i++)Vs(js[i],e);i=s;break;case"source":Vs("error",e),i=s;break;case"img":case"image":case"link":Vs("error",e),Vs("load",e),i=s;break;case"details":Vs("toggle",e),i=s;break;case"input":J(e,s),i=X(e,s),Vs("invalid",e);break;case"option":default:i=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},i=M({},s,{value:void 0}),Vs("invalid",e);break;case"textarea":ie(e,s),i=se(e,s),Vs("invalid",e)}for(a in ve(n,i),l=i)if(l.hasOwnProperty(a)){var d=l[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Vs("scroll",e):null!=d&&_(e,a,d,c))}switch(n){case"input":z(e),$(e,s,!1);break;case"textarea":z(e),ae(e);break;case"option":null!=s.value&&e.setAttribute("value",""+H(s.value));break;case"select":e.multiple=!!s.multiple,null!=(a=s.value)?ne(e,!!s.multiple,a,!1):null!=s.defaultValue&&ne(e,!!s.multiple,s.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$s)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&null!=t.stateNode)jo(e,t,e.memoizedProps,s);else{if("string"!==typeof s&&null===t.stateNode)throw Error(r(166));if(n=na(ta.current),na($r.current),ur(t)){if(s=t.stateNode,n=t.memoizedProps,s[hi]=t,(a=s.nodeValue!==n)&&null!==(e=nr))switch(e.tag){case 3:Zs(s.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zs(s.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(s=(9===n.nodeType?n:n.ownerDocument).createTextNode(s))[hi]=t,t.stateNode=s}return qo(t),null;case 13:if(Ni(oa),s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ir&&null!==sr&&0!==(1&t.mode)&&0===(128&t.flags))hr(),pr(),t.flags|=98560,a=!1;else if(a=ur(t),null!==s&&null!==s.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));a[hi]=t}else pr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qo(t),a=!1}else null!==rr&&(ol(rr),rr=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((s=null!==s)!==(null!==e&&null!==e.memoizedState)&&s&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&oa.current)?0===jc&&(jc=3):gl())),null!==t.updateQueue&&(t.flags|=4),qo(t),null);case 4:return ia(),Do(e,t),null===e&&Gs(t.stateNode.containerInfo),qo(t),null;case 10:return xr(t.type._context),qo(t),null;case 19:if(Ni(oa),null===(a=t.memoizedState))return qo(t),null;if(s=0!==(128&t.flags),null===(c=a.rendering))if(s)zo(a,!1);else{if(0!==jc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ca(e))){for(t.flags|=128,zo(a,!1),null!==(s=c.updateQueue)&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;null!==n;)e=s,(a=n).flags&=14680066,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ti(oa,1&oa.current|2),t.child}e=e.sibling}null!==a.tail&&Qe()>Wc&&(t.flags|=128,s=!0,zo(a,!1),t.lanes=4194304)}else{if(!s)if(null!==(e=ca(c))){if(t.flags|=128,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),zo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!c.alternate&&!ir)return qo(t),null}else 2*Qe()-a.renderingStartTime>Wc&&1073741824!==n&&(t.flags|=128,s=!0,zo(a,!1),t.lanes=4194304);a.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=a.last)?n.sibling=c:t.child=c,a.last=c)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Qe(),t.sibling=null,n=oa.current,Ti(oa,s?1&n|2:1&n),t):(qo(t),null);case 22:case 23:return hl(),s=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==s&&(t.flags|=8192),s&&0!==(1&t.mode)?0!==(1073741824&Dc)&&(qo(t),6&t.subtreeFlags&&(t.flags|=8192)):qo(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function Xo(e,t){switch(tr(t),t.tag){case 1:return ki(t.type)&&Di(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ia(),Ni(Ii),Ni(Ri),da(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return aa(t),null;case 13:if(Ni(oa),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));pr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ni(oa),null;case 4:return ia(),null;case 10:return xr(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}ko=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Do=function(){},Po=function(e,t,n,s){var i=e.memoizedProps;if(i!==s){e=t.stateNode,na($r.current);var r,a=null;switch(n){case"input":i=X(e,i),s=X(e,s),a=[];break;case"select":i=M({},i,{value:void 0}),s=M({},s,{value:void 0}),a=[];break;case"textarea":i=se(e,i),s=se(e,s),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof s.onClick&&(e.onclick=$s)}for(d in ve(n,s),n=null,i)if(!s.hasOwnProperty(d)&&i.hasOwnProperty(d)&&null!=i[d])if("style"===d){var c=i[d];for(r in c)c.hasOwnProperty(r)&&(n||(n={}),n[r]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in s){var l=s[d];if(c=null!=i?i[d]:void 0,s.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(r in c)!c.hasOwnProperty(r)||l&&l.hasOwnProperty(r)||(n||(n={}),n[r]="");for(r in l)l.hasOwnProperty(r)&&c[r]!==l[r]&&(n||(n={}),n[r]=l[r])}else n||(a||(a=[]),a.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Vs("scroll",e),a||c===l||(a=[])):(a=a||[]).push(d,l))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},jo=function(e,t,n,s){n!==s&&(t.flags|=4)};var Jo=!1,Qo=!1,Zo="function"===typeof WeakSet?WeakSet:Set,$o=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(s){Nl(e,t,s)}else n.current=null}function tc(e,t,n){try{n()}catch(s){Nl(e,t,s)}}var nc=!1;function sc(e,t,n){var s=t.updateQueue;if(null!==(s=null!==s?s.lastEffect:null)){var i=s=s.next;do{if((i.tag&e)===e){var r=i.destroy;i.destroy=void 0,void 0!==r&&tc(t,n,r)}i=i.next}while(i!==s)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function rc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ac(e){var t=e.alternate;null!==t&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[fi],delete t[gi],delete t[yi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$s));else if(4!==s&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}function dc(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==s&&null!==(e=e.child))for(dc(e,t,n),e=e.sibling;null!==e;)dc(e,t,n),e=e.sibling}var uc=null,hc=!1;function pc(e,t,n){for(n=n.child;null!==n;)mc(e,t,n),n=n.sibling}function mc(e,t,n){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(it,n)}catch(o){}switch(n.tag){case 5:Qo||ec(n,t);case 6:var s=uc,i=hc;uc=null,pc(e,t,n),hc=i,null!==(uc=s)&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Gt(e)):ci(uc,n.stateNode));break;case 4:s=uc,i=hc,uc=n.stateNode.containerInfo,hc=!0,pc(e,t,n),uc=s,hc=i;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(s=n.updateQueue)&&null!==(s=s.lastEffect))){i=s=s.next;do{var r=i,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&tc(n,t,a),i=i.next}while(i!==s)}pc(e,t,n);break;case 1:if(!Qo&&(ec(n,t),"function"===typeof(s=n.stateNode).componentWillUnmount))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(o){Nl(n,t,o)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Qo=(s=Qo)||null!==n.memoizedState,pc(e,t,n),Qo=s):pc(e,t,n);break;default:pc(e,t,n)}}function fc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zo),t.forEach(function(t){var s=Il.bind(null,e,t);n.has(t)||(n.add(t),t.then(s,s))})}}function gc(e,t){var n=t.deletions;if(null!==n)for(var s=0;s<n.length;s++){var i=n[s];try{var a=e,o=t,c=o;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,hc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===uc)throw Error(r(160));mc(a,o,i),uc=null,hc=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(d){Nl(i,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yc(t,e),t=t.sibling}function yc(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),vc(e),4&s){try{sc(3,e,e.return),ic(3,e)}catch(g){Nl(e,e.return,g)}try{sc(5,e,e.return)}catch(g){Nl(e,e.return,g)}}break;case 1:gc(t,e),vc(e),512&s&&null!==n&&ec(n,n.return);break;case 5:if(gc(t,e),vc(e),512&s&&null!==n&&ec(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){Nl(e,e.return,g)}}if(4&s&&null!=(i=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&Q(i,a),_e(c,o);var d=_e(c,a);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];"style"===u?ge(i,h):"dangerouslySetInnerHTML"===u?ue(i,h):"children"===u?he(i,h):_(i,u,h,d)}switch(c){case"input":Z(i,a);break;case"textarea":re(i,a);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ne(i,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(i,!!a.multiple,a.defaultValue,!0):ne(i,!!a.multiple,a.multiple?[]:"",!1))}i[pi]=a}catch(g){Nl(e,e.return,g)}}break;case 6:if(gc(t,e),vc(e),4&s){if(null===e.stateNode)throw Error(r(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(g){Nl(e,e.return,g)}}break;case 3:if(gc(t,e),vc(e),4&s&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){Nl(e,e.return,g)}break;case 4:default:gc(t,e),vc(e);break;case 13:gc(t,e),vc(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Gc=Qe())),4&s&&fc(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Qo=(d=Qo)||u,gc(t,e),Qo=d):gc(t,e),vc(e),8192&s){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for($o=e,u=e.child;null!==u;){for(h=$o=u;null!==$o;){switch(m=(p=$o).child,p.tag){case 0:case 11:case 14:case 15:sc(4,p,p.return);break;case 1:ec(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){s=p,n=p.return;try{t=s,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Nl(s,n,g)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){xc(h);continue}}null!==m?(m.return=p,$o=m):xc(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{i=h.stateNode,d?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,o=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",o))}catch(g){Nl(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Nl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gc(t,e),vc(e),4&s&&fc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(oc(n)){var s=n;break e}n=n.return}throw Error(r(160))}switch(s.tag){case 5:var i=s.stateNode;32&s.flags&&(he(i,""),s.flags&=-33),dc(e,cc(e),i);break;case 3:case 4:var a=s.stateNode.containerInfo;lc(e,cc(e),a);break;default:throw Error(r(161))}}catch(o){Nl(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _c(e,t,n){$o=e,Ec(e,t,n)}function Ec(e,t,n){for(var s=0!==(1&e.mode);null!==$o;){var i=$o,r=i.child;if(22===i.tag&&s){var a=null!==i.memoizedState||Jo;if(!a){var o=i.alternate,c=null!==o&&null!==o.memoizedState||Qo;o=Jo;var l=Qo;if(Jo=a,(Qo=c)&&!l)for($o=i;null!==$o;)c=(a=$o).child,22===a.tag&&null!==a.memoizedState?wc(i):null!==c?(c.return=a,$o=c):wc(i);for(;null!==r;)$o=r,Ec(r,t,n),r=r.sibling;$o=i,Jo=o,Qo=l}bc(e)}else 0!==(8772&i.subtreeFlags)&&null!==r?(r.return=i,$o=r):bc(e)}}function bc(e){for(;null!==$o;){var t=$o;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||ic(5,t);break;case 1:var s=t.stateNode;if(4&t.flags&&!Qo)if(null===n)s.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:gr(t.type,n.memoizedProps);s.componentDidUpdate(i,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ur(t,a,s);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ur(t,o,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(r(163))}Qo||512&t.flags&&rc(t)}catch(p){Nl(t,t.return,p)}}if(t===e){$o=null;break}if(null!==(n=t.sibling)){n.return=t.return,$o=n;break}$o=t.return}}function xc(e){for(;null!==$o;){var t=$o;if(t===e){$o=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$o=n;break}$o=t.return}}function wc(e){for(;null!==$o;){var t=$o;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(c){Nl(t,n,c)}break;case 1:var s=t.stateNode;if("function"===typeof s.componentDidMount){var i=t.return;try{s.componentDidMount()}catch(c){Nl(t,i,c)}}var r=t.return;try{rc(t)}catch(c){Nl(t,r,c)}break;case 5:var a=t.return;try{rc(t)}catch(c){Nl(t,a,c)}}}catch(c){Nl(t,t.return,c)}if(t===e){$o=null;break}var o=t.sibling;if(null!==o){o.return=t.return,$o=o;break}$o=t.return}}var Sc,Nc=Math.ceil,Tc=E.ReactCurrentDispatcher,Cc=E.ReactCurrentOwner,Rc=E.ReactCurrentBatchConfig,Ic=0,Ac=null,Oc=null,kc=0,Dc=0,Pc=Si(0),jc=0,Lc=null,Mc=0,Uc=0,Vc=0,Fc=null,Bc=null,Gc=0,Wc=1/0,Hc=null,Kc=!1,zc=null,qc=null,Yc=!1,Xc=null,Jc=0,Qc=0,Zc=null,$c=-1,el=0;function tl(){return 0!==(6&Ic)?Qe():-1!==$c?$c:$c=Qe()}function nl(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==kc?kc&-kc:null!==fr.transition?(0===el&&(el=ft()),el):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function sl(e,t,n,s){if(50<Qc)throw Qc=0,Zc=null,Error(r(185));yt(e,n,s),0!==(2&Ic)&&e===Ac||(e===Ac&&(0===(2&Ic)&&(Uc|=n),4===jc&&cl(e,kc)),il(e,s),1===n&&0===Ic&&0===(1&t.mode)&&(Wc=Qe()+500,Vi&&Gi()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,i=e.expirationTimes,r=e.pendingLanes;0<r;){var a=31-at(r),o=1<<a,c=i[a];-1===c?0!==(o&n)&&0===(o&s)||(i[a]=pt(o,t)):c<=t&&(e.expiredLanes|=o),r&=~o}}(e,t);var s=ht(e,e===Ac?kc:0);if(0===s)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Vi=!0,Bi(e)}(ll.bind(null,e)):Bi(ll.bind(null,e)),ai(function(){0===(6&Ic)&&Gi()}),n=null;else{switch(Et(s)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=st}n=Al(n,rl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rl(e,t){if($c=-1,el=0,0!==(6&Ic))throw Error(r(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var s=ht(e,e===Ac?kc:0);if(0===s)return null;if(0!==(30&s)||0!==(s&e.expiredLanes)||t)t=yl(e,s);else{t=s;var i=Ic;Ic|=2;var a=fl();for(Ac===e&&kc===t||(Hc=null,Wc=Qe()+500,pl(e,t));;)try{_l();break}catch(c){ml(e,c)}br(),Tc.current=a,Ic=i,null!==Oc?t=0:(Ac=null,kc=0,t=jc)}if(0!==t){if(2===t&&(0!==(i=mt(e))&&(s=i,t=al(e,i))),1===t)throw n=Lc,pl(e,0),cl(e,s),il(e,Qe()),n;if(6===t)cl(e,s);else{if(i=e.current.alternate,0===(30&s)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var s=0;s<n.length;s++){var i=n[s],r=i.getSnapshot;i=i.value;try{if(!os(r(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=yl(e,s))&&(0!==(a=mt(e))&&(s=a,t=al(e,a))),1===t))throw n=Lc,pl(e,0),cl(e,s),il(e,Qe()),n;switch(e.finishedWork=i,e.finishedLanes=s,t){case 0:case 1:throw Error(r(345));case 2:case 5:xl(e,Bc,Hc);break;case 3:if(cl(e,s),(130023424&s)===s&&10<(t=Gc+500-Qe())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&s)!==s){tl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=si(xl.bind(null,e,Bc,Hc),t);break}xl(e,Bc,Hc);break;case 4:if(cl(e,s),(4194240&s)===s)break;for(t=e.eventTimes,i=-1;0<s;){var o=31-at(s);a=1<<o,(o=t[o])>i&&(i=o),s&=~a}if(s=i,10<(s=(120>(s=Qe()-s)?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Nc(s/1960))-s)){e.timeoutHandle=si(xl.bind(null,e,Bc,Hc),s);break}xl(e,Bc,Hc);break;default:throw Error(r(329))}}}return il(e,Qe()),e.callbackNode===n?rl.bind(null,e):null}function al(e,t){var n=Fc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=yl(e,t))&&(t=Bc,Bc=n,null!==t&&ol(t)),e}function ol(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function cl(e,t){for(t&=~Vc,t&=~Uc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),s=1<<n;e[n]=-1,t&=~s}}function ll(e){if(0!==(6&Ic))throw Error(r(327));wl();var t=ht(e,0);if(0===(1&t))return il(e,Qe()),null;var n=yl(e,t);if(0!==e.tag&&2===n){var s=mt(e);0!==s&&(t=s,n=al(e,s))}if(1===n)throw n=Lc,pl(e,0),cl(e,t),il(e,Qe()),n;if(6===n)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xl(e,Bc,Hc),il(e,Qe()),null}function dl(e,t){var n=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=n)&&(Wc=Qe()+500,Vi&&Gi())}}function ul(e){null!==Xc&&0===Xc.tag&&0===(6&Ic)&&wl();var t=Ic;Ic|=1;var n=Rc.transition,s=_t;try{if(Rc.transition=null,_t=1,e)return e()}finally{_t=s,Rc.transition=n,0===(6&(Ic=t))&&Gi()}}function hl(){Dc=Pc.current,Ni(Pc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Oc)for(n=Oc.return;null!==n;){var s=n;switch(tr(s),s.tag){case 1:null!==(s=s.type.childContextTypes)&&void 0!==s&&Di();break;case 3:ia(),Ni(Ii),Ni(Ri),da();break;case 5:aa(s);break;case 4:ia();break;case 13:case 19:Ni(oa);break;case 10:xr(s.type._context);break;case 22:case 23:hl()}n=n.return}if(Ac=e,Oc=e=Pl(e.current,null),kc=Dc=t,jc=0,Lc=null,Vc=Uc=Mc=0,Bc=Fc=null,null!==Tr){for(t=0;t<Tr.length;t++)if(null!==(s=(n=Tr[t]).interleaved)){n.interleaved=null;var i=s.next,r=n.pending;if(null!==r){var a=r.next;r.next=i,s.next=a}n.pending=s}Tr=null}return e}function ml(e,t){for(;;){var n=Oc;try{if(br(),ua.current=ro,ya){for(var s=ma.memoizedState;null!==s;){var i=s.queue;null!==i&&(i.pending=null),s=s.next}ya=!1}if(pa=0,ga=fa=ma=null,va=!1,_a=0,Cc.current=null,null===n||null===n.return){jc=1,Lc=t,Oc=null;break}e:{var a=e,o=n.return,c=n,l=t;if(t=kc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l,u=c,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=yo(o);if(null!==m){m.flags&=-257,vo(m,o,c,0,t),1&m.mode&&go(a,d,t),l=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}if(0===(1&t)){go(a,d,t),gl();break e}l=Error(r(426))}else if(ir&&1&c.mode){var y=yo(o);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),vo(y,o,c,0,t),mr(lo(l,c));break e}}a=l=lo(l,c),4!==jc&&(jc=2),null===Fc?Fc=[a]:Fc.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Lr(a,mo(0,l,t));break e;case 1:c=l;var v=a.type,_=a.stateNode;if(0===(128&a.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===qc||!qc.has(_)))){a.flags|=65536,t&=-t,a.lanes|=t,Lr(a,fo(a,c,t));break e}}a=a.return}while(null!==a)}bl(n)}catch(E){t=E,Oc===n&&null!==n&&(Oc=n=n.return);continue}break}}function fl(){var e=Tc.current;return Tc.current=ro,null===e?ro:e}function gl(){0!==jc&&3!==jc&&2!==jc||(jc=4),null===Ac||0===(268435455&Mc)&&0===(268435455&Uc)||cl(Ac,kc)}function yl(e,t){var n=Ic;Ic|=2;var s=fl();for(Ac===e&&kc===t||(Hc=null,pl(e,t));;)try{vl();break}catch(i){ml(e,i)}if(br(),Ic=n,Tc.current=s,null!==Oc)throw Error(r(261));return Ac=null,kc=0,jc}function vl(){for(;null!==Oc;)El(Oc)}function _l(){for(;null!==Oc&&!Xe();)El(Oc)}function El(e){var t=Sc(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,null===t?bl(e):Oc=t,Cc.current=null}function bl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yo(n,t,Dc)))return void(Oc=n)}else{if(null!==(n=Xo(n,t)))return n.flags&=32767,void(Oc=n);if(null===e)return jc=6,void(Oc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Oc=t);Oc=t=e}while(null!==t);0===jc&&(jc=5)}function xl(e,t,n){var s=_t,i=Rc.transition;try{Rc.transition=null,_t=1,function(e,t,n,s){do{wl()}while(null!==Xc);if(0!==(6&Ic))throw Error(r(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),r=1<<i;t[i]=0,s[i]=-1,e[i]=-1,n&=~r}}(e,a),e===Ac&&(Oc=Ac=null,kc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yc||(Yc=!0,Al(tt,function(){return wl(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Rc.transition,Rc.transition=null;var o=_t;_t=1;var c=Ic;Ic|=4,Cc.current=null,function(e,t){if(ei=Ht,ps(e=hs())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(s&&0!==s.rangeCount){n=s.anchorNode;var i=s.anchorOffset,a=s.focusNode;s=s.focusOffset;try{n.nodeType,a.nodeType}catch(b){n=null;break e}var o=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==i&&3!==h.nodeType||(c=o+i),h!==a||0!==s&&3!==h.nodeType||(l=o+s),3===h.nodeType&&(o+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===i&&(c=o),p===a&&++u===s&&(l=o),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Ht=!1,$o=t;null!==$o;)if(e=(t=$o).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$o=e;else for(;null!==$o;){t=$o;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,y=f.memoizedState,v=t.stateNode,_=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:gr(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(r(163))}}catch(b){Nl(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$o=e;break}$o=t.return}f=nc,nc=!1}(e,n),yc(n,e),ms(ti),Ht=!!ei,ti=ei=null,e.current=n,_c(n,e,i),Je(),Ic=c,_t=o,Rc.transition=a}else e.current=n;if(Yc&&(Yc=!1,Xc=e,Jc=i),a=e.pendingLanes,0===a&&(qc=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,Qe()),null!==t)for(s=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],s(i.value,{componentStack:i.stack,digest:i.digest});if(Kc)throw Kc=!1,e=zc,zc=null,e;0!==(1&Jc)&&0!==e.tag&&wl(),a=e.pendingLanes,0!==(1&a)?e===Zc?Qc++:(Qc=0,Zc=e):Qc=0,Gi()}(e,t,n,s)}finally{Rc.transition=i,_t=s}return null}function wl(){if(null!==Xc){var e=Et(Jc),t=Rc.transition,n=_t;try{if(Rc.transition=null,_t=16>e?16:e,null===Xc)var s=!1;else{if(e=Xc,Xc=null,Jc=0,0!==(6&Ic))throw Error(r(331));var i=Ic;for(Ic|=4,$o=e.current;null!==$o;){var a=$o,o=a.child;if(0!==(16&$o.flags)){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var d=c[l];for($o=d;null!==$o;){var u=$o;switch(u.tag){case 0:case 11:case 15:sc(8,u,a)}var h=u.child;if(null!==h)h.return=u,$o=h;else for(;null!==$o;){var p=(u=$o).sibling,m=u.return;if(ac(u),u===d){$o=null;break}if(null!==p){p.return=m,$o=p;break}$o=m}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}$o=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,$o=o;else e:for(;null!==$o;){if(0!==(2048&(a=$o).flags))switch(a.tag){case 0:case 11:case 15:sc(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,$o=v;break e}$o=a.return}}var _=e.current;for($o=_;null!==$o;){var E=(o=$o).child;if(0!==(2064&o.subtreeFlags)&&null!==E)E.return=o,$o=E;else e:for(o=_;null!==$o;){if(0!==(2048&(c=$o).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(x){Nl(c,c.return,x)}if(c===o){$o=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,$o=b;break e}$o=c.return}}if(Ic=i,Gi(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(it,e)}catch(x){}s=!0}return s}finally{_t=n,Rc.transition=t}}return!1}function Sl(e,t,n){e=Pr(e,t=mo(0,t=lo(n,t),1),1),t=tl(),null!==e&&(yt(e,1,t),il(e,t))}function Nl(e,t,n){if(3===e.tag)Sl(e,e,n);else for(;null!==t;){if(3===t.tag){Sl(t,e,n);break}if(1===t.tag){var s=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof s.componentDidCatch&&(null===qc||!qc.has(s))){t=Pr(t,e=fo(t,e=lo(n,e),1),1),e=tl(),null!==t&&(yt(t,1,e),il(t,e));break}}t=t.return}}function Tl(e,t,n){var s=e.pingCache;null!==s&&s.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,Ac===e&&(kc&n)===n&&(4===jc||3===jc&&(130023424&kc)===kc&&500>Qe()-Gc?pl(e,0):Vc|=n),il(e,t)}function Cl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=tl();null!==(e=Ir(e,t))&&(yt(e,t,n),il(e,n))}function Rl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cl(e,n)}function Il(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(r(314))}null!==s&&s.delete(t),Cl(e,n)}function Al(e,t){return qe(e,t)}function Ol(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kl(e,t,n,s){return new Ol(e,t,n,s)}function Dl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pl(e,t){var n=e.alternate;return null===n?((n=kl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function jl(e,t,n,s,i,a){var o=2;if(s=e,"function"===typeof e)Dl(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case w:return Ll(n.children,i,a,t);case S:o=8,i|=8;break;case N:return(e=kl(12,n,t,2|i)).elementType=N,e.lanes=a,e;case I:return(e=kl(13,n,t,i)).elementType=I,e.lanes=a,e;case A:return(e=kl(19,n,t,i)).elementType=A,e.lanes=a,e;case D:return Ml(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:o=10;break e;case C:o=9;break e;case R:o=11;break e;case O:o=14;break e;case k:o=16,s=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=kl(o,n,t,i)).elementType=e,t.type=s,t.lanes=a,t}function Ll(e,t,n,s){return(e=kl(7,e,s,t)).lanes=n,e}function Ml(e,t,n,s){return(e=kl(22,e,s,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Ul(e,t,n){return(e=kl(6,e,null,t)).lanes=n,e}function Vl(e,t,n){return(t=kl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fl(e,t,n,s,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Bl(e,t,n,s,i,r,a,o,c){return e=new Fl(e,t,n,o,c),1===t?(t=1,!0===r&&(t|=8)):t=0,r=kl(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Or(r),e}function Gl(e){if(!e)return Ci;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ki(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var n=e.type;if(ki(n))return ji(e,n,t)}return t}function Wl(e,t,n,s,i,r,a,o,c){return(e=Bl(n,s,!0,e,0,r,0,o,c)).context=Gl(null),n=e.current,(r=Dr(s=tl(),i=nl(n))).callback=void 0!==t&&null!==t?t:null,Pr(n,r,i),e.current.lanes=i,yt(e,i,s),il(e,s),e}function Hl(e,t,n,s){var i=t.current,r=tl(),a=nl(i);return n=Gl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Dr(r,a)).payload={element:e},null!==(s=void 0===s?null:s)&&(t.callback=s),null!==(e=Pr(i,t,a))&&(sl(e,i,a,r),jr(e,i,a)),a}function Kl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function zl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){zl(e,t),(e=e.alternate)&&zl(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)Eo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Eo=!1,function(e,t,n){switch(t.tag){case 3:Ao(t),pr();break;case 5:ra(t);break;case 1:ki(t.type)&&Li(t);break;case 4:sa(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,i=t.memoizedProps.value;Ti(yr,s._currentValue),s._currentValue=i;break;case 13:if(null!==(s=t.memoizedState))return null!==s.dehydrated?(Ti(oa,1&oa.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Uo(e,t,n):(Ti(oa,1&oa.current),null!==(e=Ko(e,t,n))?e.sibling:null);Ti(oa,1&oa.current);break;case 19:if(s=0!==(n&t.childLanes),0!==(128&e.flags)){if(s)return Wo(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ti(oa,oa.current),s)break;return null;case 22:case 23:return t.lanes=0,No(e,t,n)}return Ko(e,t,n)}(e,t,n);Eo=0!==(131072&e.flags)}else Eo=!1,ir&&0!==(1048576&t.flags)&&$i(t,zi,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Ho(e,t),e=t.pendingProps;var i=Oi(t,Ri.current);Sr(t,n),i=wa(null,t,s,e,i,n);var a=Sa();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ki(s)?(a=!0,Li(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Or(t),i.updater=Br,t.stateNode=i,i._reactInternals=t,Kr(t,s,e,n),t=Io(null,t,s,!0,a,n)):(t.tag=0,ir&&a&&er(t),bo(null,t,i,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,s=(i=s._init)(s._payload),t.type=s,i=t.tag=function(e){if("function"===typeof e)return Dl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===O)return 14}return 2}(s),e=gr(s,e),i){case 0:t=Co(null,t,s,e,n);break e;case 1:t=Ro(null,t,s,e,n);break e;case 11:t=xo(null,t,s,e,n);break e;case 14:t=wo(null,t,s,gr(s.type,e),n);break e}throw Error(r(306,s,""))}return t;case 0:return s=t.type,i=t.pendingProps,Co(e,t,s,i=t.elementType===s?i:gr(s,i),n);case 1:return s=t.type,i=t.pendingProps,Ro(e,t,s,i=t.elementType===s?i:gr(s,i),n);case 3:e:{if(Ao(t),null===e)throw Error(r(387));s=t.pendingProps,i=(a=t.memoizedState).element,kr(e,t),Mr(t,s,null,n);var o=t.memoizedState;if(s=o.element,a.isDehydrated){if(a={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Oo(e,t,s,n,i=lo(Error(r(423)),t));break e}if(s!==i){t=Oo(e,t,s,n,i=lo(Error(r(424)),t));break e}for(sr=li(t.stateNode.containerInfo.firstChild),nr=t,ir=!0,rr=null,n=Qr(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pr(),s===i){t=Ko(e,t,n);break e}bo(e,t,s,n)}t=t.child}return t;case 5:return ra(t),null===e&&lr(t),s=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,ni(s,i)?o=null:null!==a&&ni(s,a)&&(t.flags|=32),To(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&lr(t),null;case 13:return Uo(e,t,n);case 4:return sa(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=Jr(t,null,s,n):bo(e,t,s,n),t.child;case 11:return s=t.type,i=t.pendingProps,xo(e,t,s,i=t.elementType===s?i:gr(s,i),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,Ti(yr,s._currentValue),s._currentValue=o,null!==a)if(os(a.value,o)){if(a.children===i.children&&!Ii.current){t=Ko(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){o=a.child;for(var l=c.firstContext;null!==l;){if(l.context===s){if(1===a.tag){(l=Dr(-1,n&-n)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),d.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),wr(a.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(r(341));o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),wr(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}bo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,s=t.pendingProps.children,Sr(t,n),s=s(i=Nr(i)),t.flags|=1,bo(e,t,s,n),t.child;case 14:return i=gr(s=t.type,t.pendingProps),wo(e,t,s,i=gr(s.type,i),n);case 15:return So(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,i=t.pendingProps,i=t.elementType===s?i:gr(s,i),Ho(e,t),t.tag=1,ki(s)?(e=!0,Li(t)):e=!1,Sr(t,n),Wr(t,s,i),Kr(t,s,i,n),Io(null,t,s,!0,e,n);case 19:return Wo(e,t,n);case 22:return No(e,t,n)}throw Error(r(156,t.tag))};var Yl="function"===typeof reportError?reportError:function(e){console.error(e)};function Xl(e){this._internalRoot=e}function Jl(e){this._internalRoot=e}function Ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function ed(e,t,n,s,i){var r=n._reactRootContainer;if(r){var a=r;if("function"===typeof i){var o=i;i=function(){var e=Kl(a);o.call(e)}}Hl(t,a,e,i)}else a=function(e,t,n,s,i){if(i){if("function"===typeof s){var r=s;s=function(){var e=Kl(a);r.call(e)}}var a=Wl(t,s,e,0,null,!1,0,"",$l);return e._reactRootContainer=a,e[mi]=a.current,Gs(8===e.nodeType?e.parentNode:e),ul(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof s){var o=s;s=function(){var e=Kl(c);o.call(e)}}var c=Bl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=c,e[mi]=c.current,Gs(8===e.nodeType?e.parentNode:e),ul(function(){Hl(t,c,n,s)}),c}(n,t,e,i,s);return Kl(a)}Jl.prototype.render=Xl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Hl(e,t,null,null)},Jl.prototype.unmount=Xl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){Hl(null,e,null,null)}),t[mi]=null}},Jl.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Mt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(vt(t,1|n),il(t,Qe()),0===(6&Ic)&&(Wc=Qe()+500,Gi()))}break;case 13:ul(function(){var t=Ir(e,1);if(null!==t){var n=tl();sl(t,e,1,n)}}),ql(e,1)}},xt=function(e){if(13===e.tag){var t=Ir(e,134217728);if(null!==t)sl(t,e,134217728,tl());ql(e,134217728)}},wt=function(e){if(13===e.tag){var t=nl(e),n=Ir(e,t);if(null!==n)sl(n,e,t,tl());ql(e,t)}},St=function(){return _t},Nt=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},xe=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var i=bi(s);if(!i)throw Error(r(90));q(s),Z(s,i)}}}break;case"textarea":re(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=dl,Ie=ul;var td={usingClientEntryPoint:!1,Events:[_i,Ei,bi,Te,Ce,dl]},nd={findFiberByHostInstance:vi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},sd={bundleType:nd.bundleType,version:nd.version,rendererPackageName:nd.rendererPackageName,rendererConfig:nd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ke(e))?null:e.stateNode},findFiberByHostInstance:nd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var id=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!id.isDisabled&&id.supportsFiber)try{it=id.inject(sd),rt=id}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=td,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ql(t))throw Error(r(200));return function(e,t,n){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==s?null:""+s,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Ql(e))throw Error(r(299));var n=!1,s="",i=Yl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Bl(e,1,!1,null,0,n,0,s,i),e[mi]=t.current,Gs(8===e.nodeType?e.parentNode:e),new Xl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=Ke(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Zl(t))throw Error(r(200));return ed(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Ql(e))throw Error(r(405));var s=null!=n&&n.hydratedSources||null,i=!1,a="",o=Yl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Wl(t,null,e,1,null!=n?n:null,i,0,a,o),e[mi]=t.current,Gs(e),s)for(e=0;e<s.length;e++)i=(i=(n=s[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Jl(t)},t.render=function(e,t,n){if(!Zl(t))throw Error(r(200));return ed(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zl(e))throw Error(r(40));return!!e._reactRootContainer&&(ul(function(){ed(null,null,e,!1,function(){e._reactRootContainer=null,e[mi]=null})}),!0)},t.unstable_batchedUpdates=dl,t.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Zl(n))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return ed(e,t,n,!1,s)},t.version="18.2.0-next-9e3b772b8-20220608"},819:(e,t,n)=>{"use strict";n.d(t,{QueryClient:()=>s.E});var s=n(198),i=n(298);n.o(i,"QueryClientProvider")&&n.d(t,{QueryClientProvider:function(){return i.QueryClientProvider}})},853:(e,t,n)=>{"use strict";e.exports=n(234)},870:(e,t,n)=>{"use strict";n.d(t,{BH:()=>v,Cp:()=>g,F$:()=>m,G6:()=>w,HN:()=>c,MK:()=>h,Od:()=>f,S$:()=>i,Zw:()=>a,b_:()=>u,gn:()=>o,j3:()=>l,jY:()=>S,lQ:()=>r,nJ:()=>p,vh:()=>d,yy:()=>x});var s=n(168),i="undefined"===typeof window;function r(){}function a(e,t){return"function"===typeof e?e(t):e}function o(e){return"number"===typeof e&&e>=0&&e!==1/0}function c(e){return Array.isArray(e)?e:[e]}function l(e,t){return Math.max(e+(t||0)-Date.now(),0)}function d(e,t,n){return b(e)?"function"===typeof t?(0,s.A)({},n,{queryKey:e,queryFn:t}):(0,s.A)({},t,{queryKey:e}):e}function u(e,t,n){return b(e)?[(0,s.A)({},t,{queryKey:e}),n]:[e||{},t]}function h(e,t){var n=e.active,s=e.exact,i=e.fetching,r=e.inactive,a=e.predicate,o=e.queryKey,c=e.stale;if(b(o))if(s){if(t.queryHash!==m(o,t.options))return!1}else if(!g(t.queryKey,o))return!1;var l=function(e,t){return!0===e&&!0===t||null==e&&null==t?"all":!1===e&&!1===t?"none":(null!=e?e:!t)?"active":"inactive"}(n,r);if("none"===l)return!1;if("all"!==l){var d=t.isActive();if("active"===l&&!d)return!1;if("inactive"===l&&d)return!1}return("boolean"!==typeof c||t.isStale()===c)&&(("boolean"!==typeof i||t.isFetching()===i)&&!(a&&!a(t)))}function p(e,t){var n=e.exact,s=e.fetching,i=e.predicate,r=e.mutationKey;if(b(r)){if(!t.options.mutationKey)return!1;if(n){if(f(t.options.mutationKey)!==f(r))return!1}else if(!g(t.options.mutationKey,r))return!1}return("boolean"!==typeof s||"loading"===t.state.status===s)&&!(i&&!i(t))}function m(e,t){return((null==t?void 0:t.queryKeyHashFn)||f)(e)}function f(e){var t,n=c(e);return t=n,JSON.stringify(t,function(e,t){return _(t)?Object.keys(t).sort().reduce(function(e,n){return e[n]=t[n],e},{}):t})}function g(e,t){return y(c(e),c(t))}function y(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&!Object.keys(t).some(function(n){return!y(e[n],t[n])}))}function v(e,t){if(e===t)return e;var n=Array.isArray(e)&&Array.isArray(t);if(n||_(e)&&_(t)){for(var s=n?e.length:Object.keys(e).length,i=n?t:Object.keys(t),r=i.length,a=n?[]:{},o=0,c=0;c<r;c++){var l=n?c:i[c];a[l]=v(e[l],t[l]),a[l]===e[l]&&o++}return s===r&&o===s?e:a}return t}function _(e){if(!E(e))return!1;var t=e.constructor;if("undefined"===typeof t)return!0;var n=t.prototype;return!!E(n)&&!!n.hasOwnProperty("isPrototypeOf")}function E(e){return"[object Object]"===Object.prototype.toString.call(e)}function b(e){return"string"===typeof e||Array.isArray(e)}function x(e){return new Promise(function(t){setTimeout(t,e)})}function w(e){Promise.resolve().then(e).catch(function(e){return setTimeout(function(){throw e})})}function S(){if("function"===typeof AbortController)return new AbortController}},907:(e,t,n)=>{"use strict";n.d(t,{QueryClient:()=>s.QueryClient,QueryClientProvider:()=>i.QueryClientProvider});var s=n(819);n.o(s,"QueryClientProvider")&&n.d(t,{QueryClientProvider:function(){return s.QueryClientProvider}});var i=n(524)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},991:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});var s=n(870),i=new(function(){function e(){this.queue=[],this.transactions=0,this.notifyFn=function(e){e()},this.batchNotifyFn=function(e){e()}}var t=e.prototype;return t.batch=function(e){var t;this.transactions++;try{t=e()}finally{this.transactions--,this.transactions||this.flush()}return t},t.schedule=function(e){var t=this;this.transactions?this.queue.push(e):(0,s.G6)(function(){t.notifyFn(e)})},t.batchCalls=function(e){var t=this;return function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];t.schedule(function(){e.apply(void 0,s)})}},t.flush=function(){var e=this,t=this.queue;this.queue=[],t.length&&(0,s.G6)(function(){e.batchNotifyFn(function(){t.forEach(function(t){e.notifyFn(t)})})})},t.setNotifyFunction=function(e){this.notifyFn=e},t.setBatchNotifyFunction=function(e){this.batchNotifyFn=e},e}())}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(s,i){if(1&i&&(s=this(s)),8&i)return s;if("object"===typeof s&&s){if(4&i&&s.__esModule)return s;if(16&i&&"function"===typeof s.then)return s}var r=Object.create(null);n.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&s;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>s[e]);return a.default=()=>s,n.d(r,a),r}})(),n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t=n(43),s=n.t(t,2),i=n(391),r=n(950),a=n.t(r,2);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const c="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function d(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function u(e,t){return{usr:e.state,key:e.key,idx:t}}function h(e,t,n,s){return void 0===n&&(n=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?m(t):t,{state:n,key:t&&t.key||s||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:t="/",search:n="",hash:s=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),s&&"#"!==s&&(t+="#"===s.charAt(0)?s:"#"+s),t}function m(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function f(t,n,s,i){void 0===i&&(i={});let{window:r=document.defaultView,v5Compat:a=!1}=i,d=r.history,m=e.Pop,f=null,g=y();function y(){return(d.state||{idx:null}).idx}function v(){m=e.Pop;let t=y(),n=null==t?null:t-g;g=t,f&&f({action:m,location:E.location,delta:n})}function _(e){let t="null"!==r.location.origin?r.location.origin:r.location.href,n="string"===typeof e?e:p(e);return n=n.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,d.replaceState(o({},d.state,{idx:g}),""));let E={get action(){return m},get location(){return t(r,d)},listen(e){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(c,v),f=e,()=>{r.removeEventListener(c,v),f=null}},createHref:e=>n(r,e),createURL:_,encodeLocation(e){let t=_(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){m=e.Push;let i=h(E.location,t,n);s&&s(i,t),g=y()+1;let o=u(i,g),c=E.createHref(i);try{d.pushState(o,"",c)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;r.location.assign(c)}a&&f&&f({action:m,location:E.location,delta:1})},replace:function(t,n){m=e.Replace;let i=h(E.location,t,n);s&&s(i,t),g=y();let r=u(i,g),o=E.createHref(i);d.replaceState(r,"",o),a&&f&&f({action:m,location:E.location,delta:0})},go:e=>d.go(e)};return E}var g;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(e,t,n){return void 0===n&&(n="/"),v(e,t,n,!1)}function v(e,t,n,s){let i=k(("string"===typeof t?m(t):t).pathname||"/",n);if(null==i)return null;let r=_(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(r);let a=null;for(let o=0;null==a&&o<r.length;++o){let e=O(i);a=I(r[o],e,s)}return a}function _(e,t,n,s){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===s&&(s="");let i=(e,i,r)=>{let a={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(l(a.relativePath.startsWith(s),'Absolute route path "'+a.relativePath+'" nested under path "'+s+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(s.length));let o=M([s,a.relativePath]),c=n.concat(a);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),_(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:R(o,e.index),routesMeta:c})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let s of E(e.path))i(e,t,s);else i(e,t)}),t}function E(e){let t=e.split("/");if(0===t.length)return[];let[n,...s]=t,i=n.endsWith("?"),r=n.replace(/\?$/,"");if(0===s.length)return i?[r,""]:[r];let a=E(s.join("/")),o=[];return o.push(...a.map(e=>""===e?r:[r,e].join("/"))),i&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const b=/^:[\w-]+$/,x=3,w=2,S=1,N=10,T=-2,C=e=>"*"===e;function R(e,t){let n=e.split("/"),s=n.length;return n.some(C)&&(s+=T),t&&(s+=w),n.filter(e=>!C(e)).reduce((e,t)=>e+(b.test(t)?x:""===t?S:N),s)}function I(e,t,n){void 0===n&&(n=!1);let{routesMeta:s}=e,i={},r="/",a=[];for(let o=0;o<s.length;++o){let e=s[o],c=o===s.length-1,l="/"===r?t:t.slice(r.length)||"/",d=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),u=e.route;if(!d&&c&&n&&!s[s.length-1].route.index&&(d=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:M([r,d.pathname]),pathnameBase:U(M([r,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(r=M([r,d.pathnameBase]))}return a}function A(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);d("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let s=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(s.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(s.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let r=new RegExp(i,t?void 0:"i");return[r,s]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let r=i[0],a=r.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:s.reduce((e,t,n)=>{let{paramName:s,isOptional:i}=t;if("*"===s){let e=o[n]||"";a=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const c=o[n];return e[s]=i&&!c?void 0:(c||"").replace(/%2F/g,"/"),e},{}),pathname:r,pathnameBase:a,pattern:e}}function O(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return d(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function k(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&"/"!==s?null:e.slice(n)||"/"}function D(e,t,n,s){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function P(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function j(e,t){let n=P(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function L(e,t,n,s){let i;void 0===s&&(s=!1),"string"===typeof e?i=m(e):(i=o({},e),l(!i.pathname||!i.pathname.includes("?"),D("?","pathname","search",i)),l(!i.pathname||!i.pathname.includes("#"),D("#","pathname","hash",i)),l(!i.search||!i.search.includes("#"),D("#","search","hash",i)));let r,a=""===e||""===i.pathname,c=a?"/":i.pathname;if(null==c)r=n;else{let e=t.length-1;if(!s&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}r=e>=0?t[e]:"/"}let d=function(e,t){void 0===t&&(t="/");let{pathname:n,search:s="",hash:i=""}="string"===typeof e?m(e):e,r=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:r,search:V(s),hash:F(i)}}(i,r),u=c&&"/"!==c&&c.endsWith("/"),h=(a||"."===c)&&n.endsWith("/");return d.pathname.endsWith("/")||!u&&!h||(d.pathname+="/"),d}const M=e=>e.join("/").replace(/\/\/+/g,"/"),U=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function B(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const G=["post","put","patch","delete"],W=(new Set(G),["get",...G]);new Set(W),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},H.apply(this,arguments)}const K=t.createContext(null);const z=t.createContext(null);const q=t.createContext(null);const Y=t.createContext(null);const X=t.createContext({outlet:null,matches:[],isDataRoute:!1});const J=t.createContext(null);function Q(){return null!=t.useContext(Y)}function Z(){return Q()||l(!1),t.useContext(Y).location}function $(e){t.useContext(q).static||t.useLayoutEffect(e)}function ee(){let{isDataRoute:e}=t.useContext(X);return e?function(){let{router:e}=ue(le.UseNavigateStable),n=pe(de.UseNavigateStable),s=t.useRef(!1);return $(()=>{s.current=!0}),t.useCallback(function(t,i){void 0===i&&(i={}),s.current&&("number"===typeof t?e.navigate(t):e.navigate(t,H({fromRouteId:n},i)))},[e,n])}():function(){Q()||l(!1);let e=t.useContext(K),{basename:n,future:s,navigator:i}=t.useContext(q),{matches:r}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(j(r,s.v7_relativeSplatPath)),c=t.useRef(!1);return $(()=>{c.current=!0}),t.useCallback(function(t,s){if(void 0===s&&(s={}),!c.current)return;if("number"===typeof t)return void i.go(t);let r=L(t,JSON.parse(o),a,"path"===s.relative);null==e&&"/"!==n&&(r.pathname="/"===r.pathname?n:M([n,r.pathname])),(s.replace?i.replace:i.push)(r,s.state,s)},[n,i,o,a,e])}()}const te=t.createContext(null);function ne(e,n){let{relative:s}=void 0===n?{}:n,{future:i}=t.useContext(q),{matches:r}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(j(r,i.v7_relativeSplatPath));return t.useMemo(()=>L(e,JSON.parse(o),a,"path"===s),[e,o,a,s])}function se(n,s,i,r){Q()||l(!1);let{navigator:a}=t.useContext(q),{matches:o}=t.useContext(X),c=o[o.length-1],d=c?c.params:{},u=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let h,p=Z();if(s){var f;let e="string"===typeof s?m(s):s;"/"===u||(null==(f=e.pathname)?void 0:f.startsWith(u))||l(!1),h=e}else h=p;let g=h.pathname||"/",v=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");v="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let _=y(n,{pathname:v});let E=ce(_&&_.map(e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:M([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:M([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,i,r);return s&&E?t.createElement(Y.Provider,{value:{location:H({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:e.Pop}},E):E}function ie(){let e=function(){var e;let n=t.useContext(J),s=he(de.UseRouteError),i=pe(de.UseRouteError);if(void 0!==n)return n;return null==(e=s.errors)?void 0:e[i]}(),n=B(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),s?t.createElement("pre",{style:r},s):null,null)}const re=t.createElement(ie,null);class ae extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(X.Provider,{value:this.props.routeContext},t.createElement(J.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oe(e){let{routeContext:n,match:s,children:i}=e,r=t.useContext(K);return r&&r.static&&r.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=s.route.id),t.createElement(X.Provider,{value:n},i)}function ce(e,n,s,i){var r;if(void 0===n&&(n=[]),void 0===s&&(s=null),void 0===i&&(i=null),null==e){var a;if(!s)return null;if(s.errors)e=s.matches;else{if(!(null!=(a=i)&&a.v7_partialHydration&&0===n.length&&!s.initialized&&s.matches.length>0))return null;e=s.matches}}let o=e,c=null==(r=s)?void 0:r.errors;if(null!=c){let e=o.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||l(!1),o=o.slice(0,Math.min(o.length,e+1))}let d=!1,u=-1;if(s&&i&&i.v7_partialHydration)for(let t=0;t<o.length;t++){let e=o[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:n}=s,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){d=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,i,r)=>{let a,l=!1,h=null,p=null;var m;s&&(a=c&&i.route.id?c[i.route.id]:void 0,h=i.route.errorElement||re,d&&(u<0&&0===r?(m="route-fallback",!1||me[m]||(me[m]=!0),l=!0,p=null):u===r&&(l=!0,p=i.route.hydrateFallbackElement||null)));let f=n.concat(o.slice(0,r+1)),g=()=>{let n;return n=a?h:l?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(oe,{match:i,routeContext:{outlet:e,matches:f,isDataRoute:null!=s},children:n})};return s&&(i.route.ErrorBoundary||i.route.errorElement||0===r)?t.createElement(ae,{location:s.location,revalidation:s.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):g()},null)}var le=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(le||{}),de=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(de||{});function ue(e){let n=t.useContext(K);return n||l(!1),n}function he(e){let n=t.useContext(z);return n||l(!1),n}function pe(e){let n=function(){let e=t.useContext(X);return e||l(!1),e}(),s=n.matches[n.matches.length-1];return s.route.id||l(!1),s.route.id}const me={};s.startTransition;function fe(e){let{to:n,replace:s,state:i,relative:r}=e;Q()||l(!1);let{future:a,static:o}=t.useContext(q),{matches:c}=t.useContext(X),{pathname:d}=Z(),u=ee(),h=L(n,j(c,a.v7_relativeSplatPath),d,"path"===r),p=JSON.stringify(h);return t.useEffect(()=>u(JSON.parse(p),{replace:s,state:i,relative:r}),[u,p,r,s,i]),null}function ge(e){return function(e){let n=t.useContext(X).outlet;return n?t.createElement(te.Provider,{value:e},n):n}(e.context)}function ye(e){l(!1)}function ve(n){let{basename:s="/",children:i=null,location:r,navigationType:a=e.Pop,navigator:o,static:c=!1,future:d}=n;Q()&&l(!1);let u=s.replace(/^\/*/,"/"),h=t.useMemo(()=>({basename:u,navigator:o,static:c,future:H({v7_relativeSplatPath:!1},d)}),[u,d,o,c]);"string"===typeof r&&(r=m(r));let{pathname:p="/",search:f="",hash:g="",state:y=null,key:v="default"}=r,_=t.useMemo(()=>{let e=k(p,u);return null==e?null:{location:{pathname:e,search:f,hash:g,state:y,key:v},navigationType:a}},[u,p,f,g,y,v,a]);return null==_?null:t.createElement(q.Provider,{value:h},t.createElement(Y.Provider,{children:i,value:_}))}function _e(e){let{children:t,location:n}=e;return se(Ee(t),n)}new Promise(()=>{});t.Component;function Ee(e,n){void 0===n&&(n=[]);let s=[];return t.Children.forEach(e,(e,i)=>{if(!t.isValidElement(e))return;let r=[...n,i];if(e.type===t.Fragment)return void s.push.apply(s,Ee(e.props.children,r));e.type!==ye&&l(!1),e.props.index&&e.props.children&&l(!1);let a={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Ee(e.props.children,r)),s.push(a)}),s}function be(){return be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},be.apply(this,arguments)}function xe(e,t){if(null==e)return{};var n,s,i={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const we=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(mv){}new Map;const Se=s.startTransition;a.flushSync,s.useId;function Ne(e){let{basename:n,children:s,future:i,window:r}=e,a=t.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:r,v5Compat:!0})&&(o={}),f(function(e,t){let{pathname:n,search:s,hash:i}=e.location;return h("",{pathname:n,search:s,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:p(t)},null,o)));let c=a.current,[l,d]=t.useState({action:c.action,location:c.location}),{v7_startTransition:u}=i||{},m=t.useCallback(e=>{u&&Se?Se(()=>d(e)):d(e)},[d,u]);return t.useLayoutEffect(()=>c.listen(m),[c,m]),t.createElement(ve,{basename:n,children:s,location:l.location,navigationType:l.action,navigator:c,future:i})}const Te="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Re=t.forwardRef(function(e,n){let s,{onClick:i,relative:r,reloadDocument:a,replace:o,state:c,target:d,to:u,preventScrollReset:h,unstable_viewTransition:m}=e,f=xe(e,we),{basename:g}=t.useContext(q),y=!1;if("string"===typeof u&&Ce.test(u)&&(s=u,Te))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=k(t.pathname,g);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:y=!0}catch(mv){}let v=function(e,n){let{relative:s}=void 0===n?{}:n;Q()||l(!1);let{basename:i,navigator:r}=t.useContext(q),{hash:a,pathname:o,search:c}=ne(e,{relative:s}),d=o;return"/"!==i&&(d="/"===o?i:M([i,o])),r.createHref({pathname:d,search:c,hash:a})}(u,{relative:r}),_=function(e,n){let{target:s,replace:i,state:r,preventScrollReset:a,relative:o,unstable_viewTransition:c}=void 0===n?{}:n,l=ee(),d=Z(),u=ne(e,{relative:o});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,s)){t.preventDefault();let n=void 0!==i?i:p(d)===p(u);l(e,{replace:n,state:r,preventScrollReset:a,relative:o,unstable_viewTransition:c})}},[d,l,u,i,r,s,e,a,o,c])}(u,{replace:o,state:c,target:d,preventScrollReset:h,relative:r,unstable_viewTransition:m});return t.createElement("a",be({},f,{href:s||v,onClick:y||a?i:function(e){i&&i(e),e.defaultPrevented||_(e)},ref:n,target:d}))});var Ie,Ae;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ie||(Ie={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ae||(Ae={}));var Oe=n(907);function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function De(e){var t=function(e,t){if("object"!=ke(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=ke(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ke(t)?t:t+""}function Pe(e,t,n){return(t=De(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach(function(t){Pe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Me(e,t){if(null==e)return{};var n,s,i=function(e,t){if(null==e)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(-1!==t.indexOf(s))continue;n[s]=e[s]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Ue(e){var t,n,s="";if("string"==typeof e||"number"==typeof e)s+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=Ue(e[t]))&&(s&&(s+=" "),s+=n);else for(t in e)e[t]&&(s&&(s+=" "),s+=t);return s}const Ve=function(){for(var e,t,n=0,s="";n<arguments.length;)(e=arguments[n++])&&(t=Ue(e))&&(s&&(s+=" "),s+=t);return s},Fe=["theme","type"],Be=["delay","staleId"],Ge=e=>"number"==typeof e&&!isNaN(e),We=e=>"string"==typeof e,He=e=>"function"==typeof e,Ke=e=>We(e)||He(e)?e:null,ze=e=>(0,t.isValidElement)(e)||We(e)||He(e)||Ge(e);function qe(e){let{enter:n,exit:s,appendPosition:i=!1,collapse:r=!0,collapseDuration:a=300}=e;return function(e){let{children:o,position:c,preventExitTransition:l,done:d,nodeRef:u,isIn:h}=e;const p=i?"".concat(n,"--").concat(c):n,m=i?"".concat(s,"--").concat(c):s,f=(0,t.useRef)(0);return(0,t.useLayoutEffect)(()=>{const e=u.current,t=p.split(" "),n=s=>{s.target===u.current&&(e.dispatchEvent(new Event("d")),e.removeEventListener("animationend",n),e.removeEventListener("animationcancel",n),0===f.current&&"animationcancel"!==s.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",n),e.addEventListener("animationcancel",n)},[]),(0,t.useEffect)(()=>{const e=u.current,t=()=>{e.removeEventListener("animationend",t),r?function(e,t,n){void 0===n&&(n=300);const{scrollHeight:s,style:i}=e;requestAnimationFrame(()=>{i.minHeight="initial",i.height=s+"px",i.transition="all ".concat(n,"ms"),requestAnimationFrame(()=>{i.height="0",i.padding="0",i.margin="0",setTimeout(t,n)})})}(e,d,a):d()};h||(l?t():(f.current=1,e.className+=" ".concat(m),e.addEventListener("animationend",t)))},[h]),t.createElement(t.Fragment,null,o)}}function Ye(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const Xe={list:new Map,emitQueue:new Map,on(e,t){return this.list.has(e)||this.list.set(e,[]),this.list.get(e).push(t),this},off(e,t){if(t){const n=this.list.get(e).filter(e=>e!==t);return this.list.set(e,n),this}return this.list.delete(e),this},cancelEmit(e){const t=this.emitQueue.get(e);return t&&(t.forEach(clearTimeout),this.emitQueue.delete(e)),this},emit(e){this.list.has(e)&&this.list.get(e).forEach(t=>{const n=setTimeout(()=>{t(...[].slice.call(arguments,1))},0);this.emitQueue.has(e)||this.emitQueue.set(e,[]),this.emitQueue.get(e).push(n)})}},Je=e=>{let{theme:n,type:s}=e,i=Me(e,Fe);return t.createElement("svg",Le({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===n?"currentColor":"var(--toastify-icon-color-".concat(s,")")},i))},Qe={info:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return t.createElement("div",{className:"Toastify__spinner"})}};function Ze(e){const[,n]=(0,t.useReducer)(e=>e+1,0),[s,i]=(0,t.useState)([]),r=(0,t.useRef)(null),a=(0,t.useRef)(new Map).current,o=e=>-1!==s.indexOf(e),c=(0,t.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:e,containerId:null,isToastActive:o,getToast:e=>a.get(e)}).current;function l(e){let{containerId:t}=e;const{limit:n}=c.props;!n||t&&c.containerId!==t||(c.count-=c.queue.length,c.queue=[])}function d(e){i(t=>null==e?[]:t.filter(t=>t!==e))}function u(){const{toastContent:e,toastProps:t,staleId:n}=c.queue.shift();p(e,t,n)}function h(e,s){let{delay:i,staleId:o}=s,l=Me(s,Be);if(!ze(e)||function(e){return!r.current||c.props.enableMultiContainer&&e.containerId!==c.props.containerId||a.has(e.toastId)&&null==e.updateId}(l))return;const{toastId:h,updateId:m,data:f}=l,{props:g}=c,y=()=>d(h),v=null==m;v&&c.count++;const _=Le(Le(Le({},g),{},{style:g.toastStyle,key:c.toastKey++},Object.fromEntries(Object.entries(l).filter(e=>{let[t,n]=e;return null!=n}))),{},{toastId:h,updateId:m,data:f,closeToast:y,isIn:!1,className:Ke(l.className||g.toastClassName),bodyClassName:Ke(l.bodyClassName||g.bodyClassName),progressClassName:Ke(l.progressClassName||g.progressClassName),autoClose:!l.isLoading&&(E=l.autoClose,b=g.autoClose,!1===E||Ge(E)&&E>0?E:b),deleteToast(){const e=Ye(a.get(h),"removed");a.delete(h),Xe.emit(4,e);const t=c.queue.length;if(c.count=null==h?c.count-c.displayedToast:c.count-1,c.count<0&&(c.count=0),t>0){const e=null==h?c.props.limit:1;if(1===t||1===e)c.displayedToast++,u();else{const n=e>t?t:e;c.displayedToast=n;for(let e=0;e<n;e++)u()}}else n()}});var E,b;_.iconOut=function(e){let{theme:n,type:s,isLoading:i,icon:r}=e,a=null;const o={theme:n,type:s};return!1===r||(He(r)?a=r(o):(0,t.isValidElement)(r)?a=(0,t.cloneElement)(r,o):We(r)||Ge(r)?a=r:i?a=Qe.spinner():(e=>e in Qe)(s)&&(a=Qe[s](o))),a}(_),He(l.onOpen)&&(_.onOpen=l.onOpen),He(l.onClose)&&(_.onClose=l.onClose),_.closeButton=g.closeButton,!1===l.closeButton||ze(l.closeButton)?_.closeButton=l.closeButton:!0===l.closeButton&&(_.closeButton=!ze(g.closeButton)||g.closeButton);let x=e;(0,t.isValidElement)(e)&&!We(e.type)?x=(0,t.cloneElement)(e,{closeToast:y,toastProps:_,data:f}):He(e)&&(x=e({closeToast:y,toastProps:_,data:f})),g.limit&&g.limit>0&&c.count>g.limit&&v?c.queue.push({toastContent:x,toastProps:_,staleId:o}):Ge(i)?setTimeout(()=>{p(x,_,o)},i):p(x,_,o)}function p(e,t,n){const{toastId:s}=t;n&&a.delete(n);const r={content:e,props:t};a.set(s,r),i(e=>[...e,s].filter(e=>e!==n)),Xe.emit(4,Ye(r,null==r.props.updateId?"added":"updated"))}return(0,t.useEffect)(()=>(c.containerId=e.containerId,Xe.cancelEmit(3).on(0,h).on(1,e=>r.current&&d(e)).on(5,l).emit(2,c),()=>{a.clear(),Xe.emit(3,c)}),[]),(0,t.useEffect)(()=>{c.props=e,c.isToastActive=o,c.displayedToast=s.length}),{getToastToRender:function(t){const n=new Map,s=Array.from(a.values());return e.newestOnTop&&s.reverse(),s.forEach(e=>{const{position:t}=e.props;n.has(t)||n.set(t,[]),n.get(t).push(e)}),Array.from(n,e=>t(e[0],e[1]))},containerRef:r,isToastActive:o}}function $e(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientX:e.clientX}function et(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientY:e.clientY}function tt(e){const[n,s]=(0,t.useState)(!1),[i,r]=(0,t.useState)(!1),a=(0,t.useRef)(null),o=(0,t.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,c=(0,t.useRef)(e),{autoClose:l,pauseOnHover:d,closeToast:u,onClick:h,closeOnClick:p}=e;function m(t){if(e.draggable){"touchstart"===t.nativeEvent.type&&t.nativeEvent.preventDefault(),o.didMove=!1,document.addEventListener("mousemove",v),document.addEventListener("mouseup",_),document.addEventListener("touchmove",v),document.addEventListener("touchend",_);const n=a.current;o.canCloseOnClick=!0,o.canDrag=!0,o.boundingRect=n.getBoundingClientRect(),n.style.transition="",o.x=$e(t.nativeEvent),o.y=et(t.nativeEvent),"x"===e.draggableDirection?(o.start=o.x,o.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(o.start=o.y,o.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent/100))}}function f(t){if(o.boundingRect){const{top:n,bottom:s,left:i,right:r}=o.boundingRect;"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&o.x>=i&&o.x<=r&&o.y>=n&&o.y<=s?y():g()}}function g(){s(!0)}function y(){s(!1)}function v(t){const s=a.current;o.canDrag&&s&&(o.didMove=!0,n&&y(),o.x=$e(t),o.y=et(t),o.delta="x"===e.draggableDirection?o.x-o.start:o.y-o.start,o.start!==o.x&&(o.canCloseOnClick=!1),s.style.transform="translate".concat(e.draggableDirection,"(").concat(o.delta,"px)"),s.style.opacity=""+(1-Math.abs(o.delta/o.removalDistance)))}function _(){document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",_),document.removeEventListener("touchmove",v),document.removeEventListener("touchend",_);const t=a.current;if(o.canDrag&&o.didMove&&t){if(o.canDrag=!1,Math.abs(o.delta)>o.removalDistance)return r(!0),void e.closeToast();t.style.transition="transform 0.2s, opacity 0.2s",t.style.transform="translate".concat(e.draggableDirection,"(0)"),t.style.opacity="1"}}(0,t.useEffect)(()=>{c.current=e}),(0,t.useEffect)(()=>(a.current&&a.current.addEventListener("d",g,{once:!0}),He(e.onOpen)&&e.onOpen((0,t.isValidElement)(e.children)&&e.children.props),()=>{const e=c.current;He(e.onClose)&&e.onClose((0,t.isValidElement)(e.children)&&e.children.props)}),[]),(0,t.useEffect)(()=>(e.pauseOnFocusLoss&&(document.hasFocus()||y(),window.addEventListener("focus",g),window.addEventListener("blur",y)),()=>{e.pauseOnFocusLoss&&(window.removeEventListener("focus",g),window.removeEventListener("blur",y))}),[e.pauseOnFocusLoss]);const E={onMouseDown:m,onTouchStart:m,onMouseUp:f,onTouchEnd:f};return l&&d&&(E.onMouseEnter=y,E.onMouseLeave=g),p&&(E.onClick=e=>{h&&h(e),o.canCloseOnClick&&u()}),{playToast:g,pauseToast:y,isRunning:n,preventExitTransition:i,toastRef:a,eventHandlers:E}}function nt(e){let{closeToast:n,theme:s,ariaLabel:i="close"}=e;return t.createElement("button",{className:"Toastify__close-button Toastify__close-button--".concat(s),type:"button",onClick:e=>{e.stopPropagation(),n(e)},"aria-label":i},t.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},t.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function st(e){let{delay:n,isRunning:s,closeToast:i,type:r="default",hide:a,className:o,style:c,controlledProgress:l,progress:d,rtl:u,isIn:h,theme:p}=e;const m=a||l&&0===d,f=Le(Le({},c),{},{animationDuration:"".concat(n,"ms"),animationPlayState:s?"running":"paused",opacity:m?0:1});l&&(f.transform="scaleX(".concat(d,")"));const g=Ve("Toastify__progress-bar",l?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated","Toastify__progress-bar-theme--".concat(p),"Toastify__progress-bar--".concat(r),{"Toastify__progress-bar--rtl":u}),y=He(o)?o({rtl:u,type:r,defaultClassName:g}):Ve(g,o);return t.createElement("div",{role:"progressbar","aria-hidden":m?"true":"false","aria-label":"notification timer",className:y,style:f,[l&&d>=1?"onTransitionEnd":"onAnimationEnd"]:l&&d<1?null:()=>{h&&i()}})}const it=e=>{const{isRunning:n,preventExitTransition:s,toastRef:i,eventHandlers:r}=tt(e),{closeButton:a,children:o,autoClose:c,onClick:l,type:d,hideProgressBar:u,closeToast:h,transition:p,position:m,className:f,style:g,bodyClassName:y,bodyStyle:v,progressClassName:_,progressStyle:E,updateId:b,role:x,progress:w,rtl:S,toastId:N,deleteToast:T,isIn:C,isLoading:R,iconOut:I,closeOnClick:A,theme:O}=e,k=Ve("Toastify__toast","Toastify__toast-theme--".concat(O),"Toastify__toast--".concat(d),{"Toastify__toast--rtl":S},{"Toastify__toast--close-on-click":A}),D=He(f)?f({rtl:S,position:m,type:d,defaultClassName:k}):Ve(k,f),P=!!w||!c,j={closeToast:h,type:d,theme:O};let L=null;return!1===a||(L=He(a)?a(j):(0,t.isValidElement)(a)?(0,t.cloneElement)(a,j):nt(j)),t.createElement(p,{isIn:C,done:T,position:m,preventExitTransition:s,nodeRef:i},t.createElement("div",Le(Le({id:N,onClick:l,className:D},r),{},{style:g,ref:i}),t.createElement("div",Le(Le({},C&&{role:x}),{},{className:He(y)?y({type:d}):Ve("Toastify__toast-body",y),style:v}),null!=I&&t.createElement("div",{className:Ve("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!R})},I),t.createElement("div",null,o)),L,t.createElement(st,Le(Le({},b&&!P?{key:"pb-".concat(b)}:{}),{},{rtl:S,theme:O,delay:c,isRunning:n,isIn:C,closeToast:h,hide:u,type:d,style:E,className:_,controlledProgress:P,progress:w||0}))))},rt=function(e,t){return void 0===t&&(t=!1),{enter:"Toastify--animate Toastify__".concat(e,"-enter"),exit:"Toastify--animate Toastify__".concat(e,"-exit"),appendPosition:t}},at=qe(rt("bounce",!0)),ot=(qe(rt("slide",!0)),qe(rt("zoom")),qe(rt("flip")),(0,t.forwardRef)((e,n)=>{const{getToastToRender:s,containerRef:i,isToastActive:r}=Ze(e),{className:a,style:o,rtl:c,containerId:l}=e;function d(e){const t=Ve("Toastify__toast-container","Toastify__toast-container--".concat(e),{"Toastify__toast-container--rtl":c});return He(a)?a({position:e,rtl:c,defaultClassName:t}):Ve(t,Ke(a))}return(0,t.useEffect)(()=>{n&&(n.current=i.current)},[]),t.createElement("div",{ref:i,className:"Toastify",id:l},s((e,n)=>{const s=n.length?Le({},o):Le(Le({},o),{},{pointerEvents:"none"});return t.createElement("div",{className:d(e),style:s,key:"container-".concat(e)},n.map((e,s)=>{let{content:i,props:a}=e;return t.createElement(it,Le(Le({},a),{},{isIn:r(a.toastId),style:Le(Le({},a.style),{},{"--nth":s+1,"--len":n.length}),key:"toast-".concat(a.key)}),i)}))}))}));ot.displayName="ToastContainer",ot.defaultProps={position:"top-right",transition:at,autoClose:5e3,closeButton:nt,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let ct,lt=new Map,dt=[],ut=1;function ht(){return""+ut++}function pt(e){return e&&(We(e.toastId)||Ge(e.toastId))?e.toastId:ht()}function mt(e,t){return lt.size>0?Xe.emit(0,e,t):dt.push({content:e,options:t}),t.toastId}function ft(e,t){return Le(Le({},t),{},{type:t&&t.type||e,toastId:pt(t)})}function gt(e){return(t,n)=>mt(t,ft(e,n))}function yt(e,t){return mt(e,ft("default",t))}yt.loading=(e,t)=>mt(e,ft("default",Le({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},t))),yt.promise=function(e,t,n){let s,{pending:i,error:r,success:a}=t;i&&(s=We(i)?yt.loading(i,n):yt.loading(i.render,Le(Le({},n),i)));const o={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(e,t,i)=>{if(null==t)return void yt.dismiss(s);const r=Le(Le(Le({type:e},o),n),{},{data:i}),a=We(t)?{render:t}:t;return s?yt.update(s,Le(Le({},r),a)):yt(a.render,Le(Le({},r),a)),i},l=He(e)?e():e;return l.then(e=>c("success",a,e)).catch(e=>c("error",r,e)),l},yt.success=gt("success"),yt.info=gt("info"),yt.error=gt("error"),yt.warning=gt("warning"),yt.warn=yt.warning,yt.dark=(e,t)=>mt(e,ft("default",Le({theme:"dark"},t))),yt.dismiss=e=>{lt.size>0?Xe.emit(1,e):dt=dt.filter(t=>null!=e&&t.options.toastId!==e)},yt.clearWaitingQueue=function(e){return void 0===e&&(e={}),Xe.emit(5,e)},yt.isActive=e=>{let t=!1;return lt.forEach(n=>{n.isToastActive&&n.isToastActive(e)&&(t=!0)}),t},yt.update=function(e,t){void 0===t&&(t={}),setTimeout(()=>{const n=function(e,t){let{containerId:n}=t;const s=lt.get(n||ct);return s&&s.getToast(e)}(e,t);if(n){const{props:s,content:i}=n,r=Le(Le(Le({delay:100},s),t),{},{toastId:t.toastId||e,updateId:ht()});r.toastId!==e&&(r.staleId=e);const a=r.render||i;delete r.render,mt(a,r)}},0)},yt.done=e=>{yt.update(e,{progress:1})},yt.onChange=e=>(Xe.on(4,e),()=>{Xe.off(4,e)}),yt.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},yt.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},Xe.on(2,e=>{ct=e.containerId||e,lt.set(ct,e),dt.forEach(e=>{Xe.emit(0,e.content,e.options)}),dt=[]}).on(3,e=>{lt.delete(e.containerId||e),0===lt.size&&Xe.off(0).off(1).off(5)});const vt=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let i=e.charCodeAt(s);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&s+1<e.length&&56320===(64512&e.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++s)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},_t={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<e.length;i+=3){const t=e[i],r=i+1<e.length,a=r?e[i+1]:0,o=i+2<e.length,c=o?e[i+2]:0,l=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|c>>6,h=63&c;o||(h=64,r||(u=64)),s.push(n[l],n[d],n[u],n[h])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(vt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const i=e[n++];if(i<128)t[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=e[n++];t[s++]=String.fromCharCode((31&i)<<6|63&r)}else if(i>239&&i<365){const r=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(r>>10)),t[s++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],a=e[n++];t[s++]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],r=i<e.length?n[e.charAt(i)]:0;++i;const a=i<e.length?n[e.charAt(i)]:64;++i;const o=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==r||null==a||null==o)throw new Et;const c=t<<2|r>>4;if(s.push(c),64!==a){const e=r<<4&240|a>>2;if(s.push(e),64!==o){const e=a<<6&192|o;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Et extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bt=function(e){return function(e){const t=vt(e);return _t.encodeByteArray(t,!0)}(e).replace(/\./g,"")},xt=function(e){try{return _t.decodeString(e,!0)}catch(mv){console.error("base64Decode failed: ",mv)}return null};const wt=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,St=()=>{try{return wt()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(mv){return}const t=e&&xt(e[1]);return t&&JSON.parse(t)})()}catch(mv){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(mv))}},Nt=e=>{var t,n;return null===(n=null===(t=St())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Tt=e=>{const t=Nt(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const s=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),s]:[t.substring(0,n),s]},Ct=()=>{var e;return null===(e=St())||void 0===e?void 0:e.config},Rt=e=>{var t;return null===(t=St())||void 0===t?void 0:t["_".concat(e)]};class It{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function At(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Ot(){return!function(){var e;const t=null===(e=St())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(mv){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function kt(){try{return"object"===typeof indexedDB}catch(mv){return!1}}class Dt extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Dt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pt.prototype.create)}}class Pt{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),s=this.errors[e],i=s?function(e,t){return e.replace(jt,(e,n)=>{const s=t[n];return null!=s?String(s):"<".concat(n,"?>")})}(s,t):"Error",r="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new Dt(n,r,t)}}const jt=/\{\$([^}]+)}/g;function Lt(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const i of n){if(!s.includes(i))return!1;const n=e[i],r=t[i];if(Mt(n)&&Mt(r)){if(!Lt(n,r))return!1}else if(n!==r)return!1}for(const i of s)if(!n.includes(i))return!1;return!0}function Mt(e){return null!==e&&"object"===typeof e}function Ut(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function Vt(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,s]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(s)}}),t}function Ft(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Bt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");s=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===s.next&&(s.next=Gt),void 0===s.error&&(s.error=Gt),void 0===s.complete&&(s.complete=Gt);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(mv){}}),this.observers.push(s),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(mv){"undefined"!==typeof console&&console.error&&console.error(mv)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Gt(){}function Wt(e){return e&&e._delegate?e._delegate:e}class Ht{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Kt="[DEFAULT]";class zt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new It;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(mv){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),s=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(mv){if(s)return null;throw mv}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Kt})}catch(mv){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(mv){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&r.resolve(s)}return s}onInit(e,t){var n;const s=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(s){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===Kt?void 0:i),options:n}),this.instances.set(t,s),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch(r){}var i;return s||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.component?this.component.multipleInstances?e:Kt:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class qt{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new zt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Yt=[];var Xt;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Xt||(Xt={}));const Jt={debug:Xt.DEBUG,verbose:Xt.VERBOSE,info:Xt.INFO,warn:Xt.WARN,error:Xt.ERROR,silent:Xt.SILENT},Qt=Xt.INFO,Zt={[Xt.DEBUG]:"log",[Xt.VERBOSE]:"log",[Xt.INFO]:"info",[Xt.WARN]:"warn",[Xt.ERROR]:"error"},$t=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),s=Zt[t];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];console[s]("[".concat(n,"]  ").concat(e.name,":"),...r)};class en{constructor(e){this.name=e,this._logLevel=Qt,this._logHandler=$t,this._userLogHandler=null,Yt.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Xt))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?Jt[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.DEBUG,...t),this._logHandler(this,Xt.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.VERBOSE,...t),this._logHandler(this,Xt.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.INFO,...t),this._logHandler(this,Xt.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.WARN,...t),this._logHandler(this,Xt.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Xt.ERROR,...t),this._logHandler(this,Xt.ERROR,...t)}}let tn,nn;const sn=new WeakMap,rn=new WeakMap,an=new WeakMap,on=new WeakMap,cn=new WeakMap;let ln={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return rn.get(e);if("objectStoreNames"===t)return e.objectStoreNames||an.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hn(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function dn(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(nn||(nn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return e.apply(pn(this),n),hn(sn.get(this))}:function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return hn(e.apply(pn(this),n))}:function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];const r=e.call(pn(this),t,...s);return an.set(r,t.sort?t.sort():[t]),hn(r)}}function un(e){return"function"===typeof e?dn(e):(e instanceof IDBTransaction&&function(e){if(rn.has(e))return;const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{t(),s()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)});rn.set(e,t)}(e),t=e,(tn||(tn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,ln):e);var t}function hn(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{t(hn(e.result)),s()},r=()=>{n(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",r)});return t.then(t=>{t instanceof IDBCursor&&sn.set(t,e)}).catch(()=>{}),cn.set(t,e),t}(e);if(on.has(e))return on.get(e);const t=un(e);return t!==e&&(on.set(e,t),cn.set(t,e)),t}const pn=e=>cn.get(e);const mn=["get","getKey","getAll","getAllKeys","count"],fn=["put","add","delete","clear"],gn=new Map;function yn(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(gn.get(t))return gn.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,i=fn.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!i&&!mn.includes(n))return;const r=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let r=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=arguments[c];return s&&(r=r.index(o.shift())),(await Promise.all([r[n](...o),i&&t.done]))[0]};return gn.set(t,r),r}ln=(e=>Le(Le({},e),{},{get:(t,n,s)=>yn(t,n)||e.get(t,n,s),has:(t,n)=>!!yn(t,n)||e.has(t,n)}))(ln);class vn{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const _n="@firebase/app",En="0.10.5",bn=new en("@firebase/app"),xn="@firebase/app-compat",wn="@firebase/analytics-compat",Sn="@firebase/analytics",Nn="@firebase/app-check-compat",Tn="@firebase/app-check",Cn="@firebase/auth",Rn="@firebase/auth-compat",In="@firebase/database",An="@firebase/database-compat",On="@firebase/functions",kn="@firebase/functions-compat",Dn="@firebase/installations",Pn="@firebase/installations-compat",jn="@firebase/messaging",Ln="@firebase/messaging-compat",Mn="@firebase/performance",Un="@firebase/performance-compat",Vn="@firebase/remote-config",Fn="@firebase/remote-config-compat",Bn="@firebase/storage",Gn="@firebase/storage-compat",Wn="@firebase/firestore",Hn="@firebase/vertexai-preview",Kn="@firebase/firestore-compat",zn="firebase",qn="[DEFAULT]",Yn={[_n]:"fire-core",[xn]:"fire-core-compat",[Sn]:"fire-analytics",[wn]:"fire-analytics-compat",[Tn]:"fire-app-check",[Nn]:"fire-app-check-compat",[Cn]:"fire-auth",[Rn]:"fire-auth-compat",[In]:"fire-rtdb",[An]:"fire-rtdb-compat",[On]:"fire-fn",[kn]:"fire-fn-compat",[Dn]:"fire-iid",[Pn]:"fire-iid-compat",[jn]:"fire-fcm",[Ln]:"fire-fcm-compat",[Mn]:"fire-perf",[Un]:"fire-perf-compat",[Vn]:"fire-rc",[Fn]:"fire-rc-compat",[Bn]:"fire-gcs",[Gn]:"fire-gcs-compat",[Wn]:"fire-fst",[Kn]:"fire-fst-compat",[Hn]:"fire-vertex","fire-js":"fire-js",[zn]:"fire-js-all"},Xn=new Map,Jn=new Map,Qn=new Map;function Zn(e,t){try{e.container.addComponent(t)}catch(mv){bn.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),mv)}}function $n(e){const t=e.name;if(Qn.has(t))return bn.debug("There were multiple attempts to register component ".concat(t,".")),!1;Qn.set(t,e);for(const n of Xn.values())Zn(n,e);for(const n of Jn.values())Zn(n,e);return!0}function es(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ts(e){return void 0!==e.settings}const ns=new Pt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ss{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ht("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ns.create("app-deleted",{appName:this._name})}}const is="10.12.2";function rs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const s=Object.assign({name:qn,automaticDataCollectionEnabled:!1},t),i=s.name;if("string"!==typeof i||!i)throw ns.create("bad-app-name",{appName:String(i)});if(n||(n=Ct()),!n)throw ns.create("no-options");const r=Xn.get(i);if(r){if(Lt(n,r.options)&&Lt(s,r.config))return r;throw ns.create("duplicate-app",{appName:i})}const a=new qt(i);for(const c of Qn.values())a.addComponent(c);const o=new ss(n,s,a);return Xn.set(i,o),o}function as(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qn;const t=Xn.get(e);if(!t&&e===qn&&Ct())return rs();if(!t)throw ns.create("no-app",{appName:e});return t}function os(e,t,n){var s;let i=null!==(s=Yn[e])&&void 0!==s?s:e;n&&(i+="-".concat(n));const r=i.match(/\s|\//),a=t.match(/\s|\//);if(r||a){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return r&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),r&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void bn.warn(e.join(" "))}$n(new Ht("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}const cs="firebase-heartbeat-store";let ls=null;function ds(){return ls||(ls=function(e,t){let{blocked:n,upgrade:s,blocking:i,terminated:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=hn(a);return s&&a.addEventListener("upgradeneeded",e=>{s(hn(a.result),e.oldVersion,e.newVersion,hn(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{r&&e.addEventListener("close",()=>r()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(cs)}catch(mv){console.warn(mv)}}}).catch(e=>{throw ns.create("idb-open",{originalErrorMessage:e.message})})),ls}async function us(e,t){try{const n=(await ds()).transaction(cs,"readwrite"),s=n.objectStore(cs);await s.put(t,hs(e)),await n.done}catch(mv){if(mv instanceof Dt)bn.warn(mv.message);else{const t=ns.create("idb-set",{originalErrorMessage:null===mv||void 0===mv?void 0:mv.message});bn.warn(t.message)}}}function hs(e){return"".concat(e.name,"!").concat(e.options.appId)}class ps{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new fs(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=ms();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==s&&!this._heartbeatsCache.heartbeats.some(e=>e.date===s))return this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ms(),{heartbeatsToSend:n,unsentEntries:s}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let s=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),gs(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),gs(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),i=bt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function ms(){return(new Date).toISOString().substring(0,10)}class fs{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!kt()&&new Promise((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ds()).transaction(cs),n=await t.objectStore(cs).get(hs(e));return await t.done,n}catch(mv){if(mv instanceof Dt)bn.warn(mv.message);else{const t=ns.create("idb-get",{originalErrorMessage:null===mv||void 0===mv?void 0:mv.message});bn.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return us(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return us(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function gs(e){return bt(JSON.stringify({version:2,heartbeats:e})).length}var ys;ys="",$n(new Ht("platform-logger",e=>new vn(e),"PRIVATE")),$n(new Ht("heartbeat",e=>new ps(e),"PRIVATE")),os(_n,En,ys),os(_n,En,"esm2017"),os("fire-js","");function vs(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function _s(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Es=_s,bs=new Pt("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),xs=new en("@firebase/auth");function ws(e){if(xs.logLevel<=Xt.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];xs.error("Auth (".concat(is,"): ").concat(e),...n)}}function Ss(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];throw Rs(e,...n)}function Ns(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return Rs(e,...n)}function Ts(e,t,n){const s=Object.assign(Object.assign({},Es()),{[t]:n});return new Pt("auth","Firebase",s).create(t,{appName:e.name})}function Cs(e){return Ts(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Rs(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if("string"!==typeof e){const t=n[0],s=[...n.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(t,...s)}return bs.create(e,...n)}function Is(e,t){if(!e){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];throw Rs(t,...s)}}function As(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ws(t),new Error(t)}function Os(e,t){e||As(t)}function ks(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Ds(){return"http:"===Ps()||"https:"===Ps()}function Ps(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function js(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Ds()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Ls{constructor(e,t){this.shortDelay=e,this.longDelay=t,Os(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(At())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return js()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ms(e,t){Os(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class Us{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void As("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void As("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void As("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Vs={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Fs=new Ls(3e4,6e4);function Bs(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Gs(e,t,n,s){return Ws(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let i={},r={};s&&("GET"===t?r=s:i={body:JSON.stringify(s)});const a=Ut(Object.assign({key:e.config.apiKey},r)).slice(1),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode),Us.fetch()(Ks(e,e.config.apiHost,n,a),Object.assign({method:t,headers:o,referrerPolicy:"no-referrer"},i))})}async function Ws(e,t,n){e._canInitEmulator=!1;const s=Object.assign(Object.assign({},Vs),t);try{const t=new qs(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await i.json();if("needConfirmation"in r)throw Ys(e,"account-exists-with-different-credential",r);if(i.ok&&!("errorMessage"in r))return r;{const t=i.ok?r.errorMessage:r.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ys(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Ys(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw Ys(e,"user-disabled",r);const o=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw Ts(e,o,a);Ss(e,o)}}catch(mv){if(mv instanceof Dt)throw mv;Ss(e,"network-request-failed",{message:String(mv)})}}async function Hs(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=await Gs(e,t,n,s,i);return"mfaPendingCredential"in r&&Ss(e,"multi-factor-auth-required",{_serverResponse:r}),r}function Ks(e,t,n,s){const i="".concat(t).concat(n,"?").concat(s);return e.config.emulator?Ms(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}function zs(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qs{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Ns(this.auth,"network-request-failed")),Fs.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ys(e,t,n){const s={appName:e.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const i=Ns(e,t,s);return i.customData._tokenResponse=n,i}function Xs(e){return void 0!==e&&void 0!==e.enterprise}class Js{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return zs(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Qs(e,t){return Gs(e,"GET","/v2/recaptchaConfig",Bs(e,t))}async function Zs(e,t){return Gs(e,"POST","/v1/accounts:lookup",t)}function $s(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(mv){}}function ei(e){return 1e3*Number(e)}function ti(e){const[t,n,s]=e.split(".");if(void 0===t||void 0===n||void 0===s)return ws("JWT malformed, contained fewer than 3 sections"),null;try{const e=xt(n);return e?JSON.parse(e):(ws("Failed to decode base64 JWT payload"),null)}catch(mv){return ws("Caught error parsing JWT payload as JSON",null===mv||void 0===mv?void 0:mv.toString()),null}}function ni(e){const t=ti(e);return Is(t,"internal-error"),Is("undefined"!==typeof t.exp,"internal-error"),Is("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function si(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(mv){throw mv instanceof Dt&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(mv)&&e.auth.currentUser===e&&await e.auth.signOut(),mv}}class ii{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(mv){return void((null===mv||void 0===mv?void 0:mv.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class ri{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$s(this.lastLoginAt),this.creationTime=$s(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ai(e){var t;const n=e.auth,s=await e.getIdToken(),i=await si(e,Zs(n,{idToken:s}));Is(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const r=i.users[0];e._notifyReloadListener(r);const a=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?oi(r.providerUserInfo):[],o=(c=e.providerData,l=a,[...c.filter(e=>!l.some(t=>t.providerId===e.providerId)),...l]);var c,l;const d=e.isAnonymous,u=!(e.email&&r.passwordHash)&&!(null===o||void 0===o?void 0:o.length),h=!!d&&u,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new ri(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(e,p)}function oi(e){return e.map(e=>{var{providerId:t}=e,n=vs(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class ci{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Is(e.idToken,"internal-error"),Is("undefined"!==typeof e.idToken,"internal-error"),Is("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):ni(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Is(0!==e.length,"internal-error");const t=ni(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(Is(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:i}=await async function(e,t){const n=await Ws(e,{},async()=>{const n=Ut({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:i}=e.config,r=Ks(e,s,"/v1/token","key=".concat(i)),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Us.fetch()(r,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,s,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:i}=t,r=new ci;return n&&(Is("string"===typeof n,"internal-error",{appName:e}),r.refreshToken=n),s&&(Is("string"===typeof s,"internal-error",{appName:e}),r.accessToken=s),i&&(Is("number"===typeof i,"internal-error",{appName:e}),r.expirationTime=i),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ci,this.toJSON())}_performRefresh(){return As("not implemented")}}function li(e,t){Is("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class di{constructor(e){var{uid:t,auth:n,stsTokenManager:s}=e,i=vs(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ii(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ri(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await si(this,this.stsTokenManager.getToken(this.auth,e));return Is(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Wt(e),s=await n.getIdToken(t),i=ti(s);Is(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const r="object"===typeof i.firebase?i.firebase:void 0,a=null===r||void 0===r?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:$s(ei(i.auth_time)),issuedAtTime:$s(ei(i.iat)),expirationTime:$s(ei(i.exp)),signInProvider:a||null,signInSecondFactor:(null===r||void 0===r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Wt(e);await ai(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Is(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new di(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Is(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ai(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ts(this.auth.app))return Promise.reject(Cs(this.auth));const e=await this.getIdToken();return await si(this,async function(e,t){return Gs(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,s,i,r,a,o,c,l;const d=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(s=t.email)&&void 0!==s?s:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(r=t.photoURL)&&void 0!==r?r:void 0,m=null!==(a=t.tenantId)&&void 0!==a?a:void 0,f=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:_,isAnonymous:E,providerData:b,stsTokenManager:x}=t;Is(v&&x,e,"internal-error");const w=ci.fromJSON(this.name,x);Is("string"===typeof v,e,"internal-error"),li(d,e.name),li(u,e.name),Is("boolean"===typeof _,e,"internal-error"),Is("boolean"===typeof E,e,"internal-error"),li(h,e.name),li(p,e.name),li(m,e.name),li(f,e.name),li(g,e.name),li(y,e.name);const S=new di({uid:v,auth:e,email:u,emailVerified:_,displayName:d,isAnonymous:E,photoURL:p,phoneNumber:h,tenantId:m,stsTokenManager:w,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(S.providerData=b.map(e=>Object.assign({},e))),f&&(S._redirectEventId=f),S}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=new ci;s.updateFromServerResponse(t);const i=new di({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await ai(i),i}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];Is(void 0!==s.localId,"internal-error");const i=void 0!==s.providerUserInfo?oi(s.providerUserInfo):[],r=!(s.email&&s.passwordHash)&&!(null===i||void 0===i?void 0:i.length),a=new ci;a.updateFromIdToken(n);const o=new di({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:r}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new ri(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(o,c),o}}const ui=new Map;function hi(e){Os(e instanceof Function,"Expected a class definition");let t=ui.get(e);return t?(Os(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ui.set(e,t),t)}class pi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}pi.type="NONE";const mi=pi;function fi(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class gi{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:i}=this.auth;this.fullUserKey=fi(this.userKey,s.apiKey,i),this.fullPersistenceKey=fi("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?di._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new gi(hi(mi),e,n);const s=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=s[0]||hi(mi);const r=fi(n,e.config.apiKey,e.name);let a=null;for(const l of t)try{const t=await l._get(r);if(t){const n=di._fromJSON(e,t);l!==i&&(a=n),i=l;break}}catch(c){}const o=s.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length?(i=o[0],a&&await i._set(r,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(r)}catch(c){}})),new gi(i,e,n)):new gi(i,e,n)}}function yi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(bi(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(vi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(wi(t))return"Blackberry";if(Si(t))return"Webos";if(_i(t))return"Safari";if((t.includes("chrome/")||Ei(t))&&!t.includes("edge/"))return"Chrome";if(xi(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function vi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/firefox\//i.test(e)}function _i(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:At()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ei(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/crios\//i.test(e)}function bi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/iemobile/i.test(e)}function xi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/android/i.test(e)}function wi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/blackberry/i.test(e)}function Si(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/webos/i.test(e)}function Ni(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ti(){return function(){const e=At();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Ci(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return Ni(e)||xi(e)||Si(e)||wi(e)||/windows phone/i.test(e)||bi(e)}function Ri(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=yi(At());break;case"Worker":t="".concat(yi(At()),"-").concat(e);break;default:t=e}const s=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(is,"/").concat(s)}class Ii{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,s)=>{try{n(e(t))}catch(mv){s(mv)}});n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(mv){t.reverse();for(const n of t)try{n()}catch(tt){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===mv||void 0===mv?void 0:mv.message})}}}class Ai{constructor(e){var t,n,s,i;const r=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=r.minPasswordLength)&&void 0!==t?t:6,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),void 0!==r.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),void 0!==r.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),void 0!==r.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),void 0!==r.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(s=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==s?s:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,s,i,r,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(s=o.containsLowercaseLetter)||void 0===s||s),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(r=o.containsNumericCharacter)||void 0===r||r),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Oi{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Di(this),this.idTokenSubscription=new Di(this),this.beforeStateQueue=new Ii(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bs,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=hi(t)),this._initializationPromise=this.queue(async()=>{var n,s;if(!this._deleted&&(this.persistenceManager=await gi.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(mv){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Zs(this,{idToken:e}),n=await di._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ts(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let s=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null===s||void 0===s?void 0:s._redirectEventId,a=await this.tryRedirectSignIn(e);n&&n!==r||!(null===a||void 0===a?void 0:a.user)||(s=a.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(mv){s=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(mv))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Is(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(mv){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ai(e)}catch(mv){if((null===mv||void 0===mv?void 0:mv.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ts(this.app))return Promise.reject(Cs(this));const t=e?Wt(e):null;return t&&Is(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&Is(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ts(this.app)?Promise.reject(Cs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ts(this.app)?Promise.reject(Cs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hi(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return Gs(e,"GET","/v2/passwordPolicy",Bs(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new Ai(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Pt("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Gs(e,"POST","/v2/accounts:revokeToken",Bs(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&hi(e)||this._popupRedirectResolver;Is(t,this,"argument-error"),this.redirectPersistenceManager=await gi.create(this,[hi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let r=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Is(a,this,"internal-error"),a.then(()=>{r||i(this.currentUser)}),"function"===typeof t){const i=e.addObserver(t,n,s);return()=>{r=!0,i()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Is(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ri(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(xs.logLevel<=Xt.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];xs.warn("Auth (".concat(is,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function ki(e){return Wt(e)}class Di{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Bt(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return Is(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Pi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ji(e){return Pi.loadJS(e)}function Li(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Mi{constructor(e){this.type="recaptcha-enterprise",this.auth=ki(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,s){const i=window.grecaptcha;Xs(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):s(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,s)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Qs(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(s=>{if(void 0!==s.recaptchaKey){const n=new Js(s);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&Xs(window.grecaptcha))n(i,e,s);else{if("undefined"===typeof window)return void s(new Error("RecaptchaVerifier is only supported in browser"));let t=Pi.recaptchaEnterpriseScript;0!==t.length&&(t+=i),ji(t).then(()=>{n(i,e,s)}).catch(e=>{s(e)})}}).catch(e=>{s(e)})})}}async function Ui(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=new Mi(e);let r;try{r=await i.verify(n)}catch(o){r=await i.verify(n,!0)}const a=Object.assign({},t);return s?Object.assign(a,{captchaResp:r}):Object.assign(a,{captchaResponse:r}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Vi(e,t,n,s){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Ui(e,t,n,"getOobCode"===n);return s(e,i)}return s(e,t).catch(async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await Ui(e,t,n,"getOobCode"===n);return s(e,i)}return Promise.reject(i)})}function Fi(e,t,n){const s=ki(e);Is(s._canInitEmulator,s,"emulator-config-failed"),Is(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),r=Bi(t),{host:a,port:o}=function(e){const t=Bi(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const e=i[1];return{host:e,port:Gi(s.substr(e.length+1))}}{const[e,t]=s.split(":");return{host:e,port:Gi(t)}}}(t),c=null===o?"":":".concat(o);s.config.emulator={url:"".concat(r,"//").concat(a).concat(c,"/")},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:a,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Bi(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Gi(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Wi{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return As("not implemented")}_getIdTokenResponse(e){return As("not implemented")}_linkToIdToken(e,t){return As("not implemented")}_getReauthenticationResolver(e){return As("not implemented")}}async function Hi(e,t){return Gs(e,"POST","/v1/accounts:signUp",t)}async function Ki(e,t){return Hs(e,"POST","/v1/accounts:signInWithPassword",Bs(e,t))}class zi extends Wi{constructor(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new zi(e,t,"password")}static _fromEmailAndCode(e,t){return new zi(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Vi(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Ki);case"emailLink":return async function(e,t){return Hs(e,"POST","/v1/accounts:signInWithEmailLink",Bs(e,t))}(e,{email:this._email,oobCode:this._password});default:Ss(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Vi(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hi);case"emailLink":return async function(e,t){return Hs(e,"POST","/v1/accounts:signInWithEmailLink",Bs(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Ss(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function qi(e,t){return Hs(e,"POST","/v1/accounts:signInWithIdp",Bs(e,t))}class Yi extends Wi{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Yi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ss("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s}=t,i=vs(t,["providerId","signInMethod"]);if(!n||!s)return null;const r=new Yi(n,s);return r.idToken=i.idToken||void 0,r.accessToken=i.accessToken||void 0,r.secret=i.secret,r.nonce=i.nonce,r.pendingToken=i.pendingToken||null,r}_getIdTokenResponse(e){return qi(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,qi(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,qi(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ut(t)}return e}}const Xi={USER_NOT_FOUND:"user-not-found"};class Ji extends Wi{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ji({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ji({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Hs(e,"POST","/v1/accounts:signInWithPhoneNumber",Bs(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Hs(e,"POST","/v1/accounts:signInWithPhoneNumber",Bs(e,t));if(n.temporaryProof)throw Ys(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Hs(e,"POST","/v1/accounts:signInWithPhoneNumber",Bs(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Xi)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:s,temporaryProof:i}=e;return n||t||s||i?new Ji({verificationId:t,verificationCode:n,phoneNumber:s,temporaryProof:i}):null}}class Qi{constructor(e){var t,n,s,i,r,a;const o=Vt(Ft(e)),c=null!==(t=o.apiKey)&&void 0!==t?t:null,l=null!==(n=o.oobCode)&&void 0!==n?n:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(s=o.mode)&&void 0!==s?s:null);Is(c&&l&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=l,this.continueUrl=null!==(i=o.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(r=o.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=Vt(Ft(e)).link,n=t?Vt(Ft(t)).deep_link_id:null,s=Vt(Ft(e)).deep_link_id;return(s?Vt(Ft(s)).link:null)||s||n||t||e}(e);try{return new Qi(t)}catch(n){return null}}}class Zi{constructor(){this.providerId=Zi.PROVIDER_ID}static credential(e,t){return zi._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Qi.parseLink(t);return Is(n,"argument-error"),zi._fromEmailAndCode(e,n.code,n.tenantId)}}Zi.PROVIDER_ID="password",Zi.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Zi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class $i{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class er extends $i{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tr extends er{constructor(){super("facebook.com")}static credential(e){return Yi._fromParams({providerId:tr.PROVIDER_ID,signInMethod:tr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tr.credentialFromTaggedObject(e)}static credentialFromError(e){return tr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return tr.credential(t.oauthAccessToken)}catch(n){return null}}}tr.FACEBOOK_SIGN_IN_METHOD="facebook.com",tr.PROVIDER_ID="facebook.com";class nr extends er{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Yi._fromParams({providerId:nr.PROVIDER_ID,signInMethod:nr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nr.credentialFromTaggedObject(e)}static credentialFromError(e){return nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:s}=t;if(!n&&!s)return null;try{return nr.credential(n,s)}catch(i){return null}}}nr.GOOGLE_SIGN_IN_METHOD="google.com",nr.PROVIDER_ID="google.com";class sr extends er{constructor(){super("github.com")}static credential(e){return Yi._fromParams({providerId:sr.PROVIDER_ID,signInMethod:sr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sr.credentialFromTaggedObject(e)}static credentialFromError(e){return sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return sr.credential(t.oauthAccessToken)}catch(n){return null}}}sr.GITHUB_SIGN_IN_METHOD="github.com",sr.PROVIDER_ID="github.com";class ir extends er{constructor(){super("twitter.com")}static credential(e,t){return Yi._fromParams({providerId:ir.PROVIDER_ID,signInMethod:ir.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ir.credentialFromTaggedObject(e)}static credentialFromError(e){return ir.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=t;if(!n||!s)return null;try{return ir.credential(n,s)}catch(i){return null}}}async function rr(e,t){return Hs(e,"POST","/v1/accounts:signUp",Bs(e,t))}ir.TWITTER_SIGN_IN_METHOD="twitter.com",ir.PROVIDER_ID="twitter.com";class ar{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await di._fromIdTokenResponse(e,n,s),r=or(n);return new ar({user:i,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=or(n);return new ar({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function or(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class cr extends Dt{constructor(e,t,n,s){var i;super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,cr.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new cr(e,t,n,s)}}function lr(e,t,n,s){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw cr._fromErrorAndOperation(e,n,t,s);throw n})}async function dr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=await si(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ar._forOperation(e,"link",s)}async function ur(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:s}=e;if(ts(s.app))return Promise.reject(Cs(s));const i="reauthenticate";try{const r=await si(e,lr(s,i,t,e),n);Is(r.idToken,s,"internal-error");const a=ti(r.idToken);Is(a,s,"internal-error");const{sub:o}=a;return Is(e.uid===o,s,"user-mismatch"),ar._forOperation(e,i,r)}catch(mv){throw(null===mv||void 0===mv?void 0:mv.code)==="auth/".concat("user-not-found")&&Ss(s,"user-mismatch"),mv}}async function hr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ts(e.app))return Promise.reject(Cs(e));const s="signIn",i=await lr(e,s,t),r=await ar._fromIdTokenResponse(e,s,i);return n||await e._updateCurrentUser(r.user),r}async function pr(e,t){return hr(ki(e),t)}async function mr(e){const t=ki(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function fr(e,t){let{displayName:n,photoURL:s}=t;if(void 0===n&&void 0===s)return;const i=Wt(e),r={idToken:await i.getIdToken(),displayName:n,photoUrl:s,returnSecureToken:!0},a=await si(i,async function(e,t){return Gs(e,"POST","/v1/accounts:update",t)}(i.auth,r));i.displayName=a.displayName||null,i.photoURL=a.photoUrl||null;const o=i.providerData.find(e=>{let{providerId:t}=e;return"password"===t});o&&(o.displayName=i.displayName,o.photoURL=i.photoURL),await i._updateTokensIfNecessary(a)}function gr(e){return Wt(e).signOut()}new WeakMap;const yr="__sak";class vr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yr,"1"),this.storage.removeItem(yr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class _r extends vr{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=At();return _i(e)||Ni(e)}()&&function(){try{return!(!window||window===window.top)}catch(mv){return!1}}(),this.fallbackToPolling=Ci(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const s=this.storage.getItem(n);if(e.newValue!==s)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const s=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);Ti()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,10):s()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}_r.type="LOCAL";const Er=_r;class br extends vr{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}br.type="SESSION";const xr=br;class wr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new wr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:i}=t.data,r=this.handlersMap[s];if(!(null===r||void 0===r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const a=Array.from(r).map(async e=>e(t.origin,i)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Sr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let s=0;s<t;s++)n+=Math.floor(10*Math.random());return e+n}wr.receivers=[];class Nr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const s="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,r;return new Promise((a,o)=>{const c=Sr("",20);s.port1.start();const l=setTimeout(()=>{o(new Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),i=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(t.data.response);break;default:clearTimeout(l),clearTimeout(i),o(new Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function Tr(){return window}function Cr(){return"undefined"!==typeof Tr().WorkerGlobalScope&&"function"===typeof Tr().importScripts}const Rr="firebaseLocalStorageDb",Ir="firebaseLocalStorage",Ar="fbase_key";class Or{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function kr(e,t){return e.transaction([Ir],t?"readwrite":"readonly").objectStore(Ir)}function Dr(){const e=indexedDB.open(Rr,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Ir,{keyPath:Ar})}catch(mv){n(mv)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(Ir)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Rr);return new Or(e).toPromise()}(),t(await Dr()))})})}async function Pr(e,t,n){const s=kr(e,!0).put({[Ar]:t,value:n});return new Or(s).toPromise()}function jr(e,t){const n=kr(e,!0).delete(t);return new Or(n).toPromise()}class Lr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Dr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(mv){if(t++>3)throw mv;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Cr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=wr._getInstance(Cr()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Nr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Dr();return await Pr(e,yr,"1"),await jr(e,yr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Pr(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=kr(e,!1).get(t),s=await new Or(n).toPromise();return void 0===s?null:s.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>jr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=kr(e,!1).getAll();return new Or(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:s,value:i}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Lr.type="LOCAL";const Mr=Lr;Li("rcb"),new Ls(3e4,6e4);const Ur="recaptcha";async function Vr(e,t,n){var s;const i=await n.verify();try{let r;if(Is("string"===typeof i,e,"argument-error"),Is(n.type===Ur,e,"argument-error"),r="string"===typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){Is("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Gs(e,"POST","/v2/accounts/mfaEnrollment:start",Bs(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Is("signin"===t.type,e,"internal-error");const n=(null===(s=r.multiFactorHint)||void 0===s?void 0:s.uid)||r.multiFactorUid;Is(n,e,"missing-multi-factor-info");const a=await function(e,t){return Gs(e,"POST","/v2/accounts/mfaSignIn:start",Bs(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Gs(e,"POST","/v1/accounts:sendVerificationCode",Bs(e,t))}(e,{phoneNumber:r.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Fr{constructor(e){this.providerId=Fr.PROVIDER_ID,this.auth=ki(e)}verifyPhoneNumber(e,t){return Vr(this.auth,e,Wt(t))}static credential(e,t){return Ji._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Fr.credentialFromTaggedObject(t)}static credentialFromError(e){return Fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:s}=t;return n&&s?Ji._fromTokenResponse(n,s):null}}function Br(e,t){return t?hi(t):(Is(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Fr.PROVIDER_ID="phone",Fr.PHONE_SIGN_IN_METHOD="phone";class Gr extends Wi{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return qi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return qi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return qi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Wr(e){return hr(e.auth,new Gr(e),e.bypassAuthState)}function Hr(e){const{auth:t,user:n}=e;return Is(n,t,"internal-error"),ur(n,new Gr(e),e.bypassAuthState)}async function Kr(e){const{auth:t,user:n}=e;return Is(n,t,"internal-error"),dr(n,new Gr(e),e.bypassAuthState)}class zr{constructor(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(mv){this.reject(mv)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:i,error:r,type:a}=e;if(r)return void this.reject(r);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(mv){this.reject(mv)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wr;case"linkViaPopup":case"linkViaRedirect":return Kr;case"reauthViaPopup":case"reauthViaRedirect":return Hr;default:Ss(this.auth,"internal-error")}}resolve(e){Os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const qr=new Ls(2e3,1e4);class Yr extends zr{constructor(e,t,n,s,i){super(e,t,s,i),this.provider=n,this.authWindow=null,this.pollId=null,Yr.currentPopupAction&&Yr.currentPopupAction.cancel(),Yr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Is(e,this.auth,"internal-error"),e}async onExecution(){Os(1===this.filter.length,"Popup operations only handle one event");const e=Sr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Ns(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ns(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ns(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,qr.get())};e()}}Yr.currentPopupAction=null;const Xr=new Map;class Jr extends zr{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Xr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=$r(t),s=Zr(e);if(!await s._isAvailable())return!1;const i="true"===await s._get(n);return await s._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(mv){e=()=>Promise.reject(mv)}Xr.set(this.auth._key(),e)}return this.bypassAuthState||Xr.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Qr(e,t){Xr.set(e._key(),t)}function Zr(e){return hi(e._redirectPersistence)}function $r(e){return fi("pendingRedirect",e.config.apiKey,e.name)}async function ea(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ts(e.app))return Promise.reject(Cs(e));const s=ki(e),i=Br(s,t),r=new Jr(s,i,n),a=await r.execute();return a&&!n&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,t)),a}class ta{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sa(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!sa(e)){const s=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ns(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(na(e))}saveEventToCache(e){this.cachedEventUids.add(na(e)),this.lastProcessedEventTime=Date.now()}}function na(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function sa(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const ia=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ra=/^https?/;async function aa(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Gs(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const s of t)try{if(oa(s))return}catch(n){}Ss(e,"unauthorized-domain")}function oa(e){const t=ks(),{protocol:n,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===s?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===s}if(!ra.test(n))return!1;if(ia.test(e))return s===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}const ca=new Ls(3e4,6e4);function la(){const e=Tr().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function da(e){return new Promise((t,n)=>{var s,i,r;function a(){la(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{la(),n(Ns(e,"network-request-failed"))},timeout:ca.get()})}if(null===(i=null===(s=Tr().gapi)||void 0===s?void 0:s.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=Tr().gapi)||void 0===r?void 0:r.load)){const t=Li("iframefcb");return Tr()[t]=()=>{gapi.load?a():n(Ns(e,"network-request-failed"))},ji("".concat(Pi.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}a()}}).catch(e=>{throw ua=null,e})}let ua=null;const ha=new Ls(5e3,15e3),pa={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ma=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function fa(e){const t=e.config;Is(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Ms(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),s={apiKey:t.apiKey,appName:e.name,v:is},i=ma.get(e.config.apiHost);i&&(s.eid=i);const r=e._getFrameworks();return r.length&&(s.fw=r.join(",")),"".concat(n,"?").concat(Ut(s).slice(1))}async function ga(e){const t=await function(e){return ua=ua||da(e),ua}(e),n=Tr().gapi;return Is(n,e,"internal-error"),t.open({where:document.body,url:fa(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:pa,dontclear:!0},t=>new Promise(async(n,s)=>{await t.restyle({setHideOnLeave:!1});const i=Ns(e,"network-request-failed"),r=Tr().setTimeout(()=>{s(i)},ha.get());function a(){Tr().clearTimeout(r),n(t)}t.ping(a).then(a,()=>{s(i)})}))}const ya={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class va{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(mv){}}}function _a(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const r=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString();let o="";const c=Object.assign(Object.assign({},ya),{width:s.toString(),height:i.toString(),top:r,left:a}),l=At().toLowerCase();n&&(o=Ei(l)?"_blank":n),vi(l)&&(t=t||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce((e,t)=>{let[n,s]=t;return"".concat(e).concat(n,"=").concat(s,",")},"");if(function(){var e;return Ni(arguments.length>0&&void 0!==arguments[0]?arguments[0]:At())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(l)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}(t||"",o),new va(null);const u=window.open(t||"",o,d);Is(u,e,"popup-blocked");try{u.focus()}catch(mv){}return new va(u)}const Ea="__/auth/handler",ba="emulator/auth/handler",xa=encodeURIComponent("fac");async function wa(e,t,n,s,i,r){Is(e.config.authDomain,e,"auth-domain-config-required"),Is(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:is,eventId:i};if(t instanceof $i){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(r||{}))a[e]=t}if(t instanceof er){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const d of Object.keys(o))void 0===o[d]&&delete o[d];const c=await e._getAppCheckToken(),l=c?"#".concat(xa,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Ea);return Ms(t,ba)}(e),"?").concat(Ut(o).slice(1)).concat(l)}const Sa="webStorageSupport";const Na=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xr,this._completeRedirectFn=ea,this._overrideRedirectResult=Qr}async _openPopup(e,t,n,s){var i;Os(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return _a(e,await wa(e,t,n,ks(),s),Sr())}async _openRedirect(e,t,n,s){await this._originValidation(e);return function(e){Tr().location.href=e}(await wa(e,t,n,ks(),s)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Os(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ga(e),n=new ta(e);return t.register("authEvent",t=>{Is(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Sa,{type:Sa},n=>{var s;const i=null===(s=null===n||void 0===n?void 0:n[0])||void 0===s?void 0:s[Sa];void 0!==i&&t(!!i),Ss(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=aa(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ci()||_i()||Ni()}};var Ta="@firebase/auth",Ca="1.7.4";class Ra{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Is(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ia=Rt("authIdTokenMaxAge")||300;let Aa=null;var Oa;function ka(e,t,n,s){return new(n||(n=Promise))(function(i,r){function a(e){try{c(s.next(e))}catch(mv){r(mv)}}function o(e){try{c(s.throw(e))}catch(mv){r(mv)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}c((s=s.apply(e,t||[])).next())})}function Da(e,t){var n,s,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(i=2&r[0]?s.return:r[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,s=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(mv){r=[6,mv],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}!function(e){Pi=e}({loadJS:e=>new Promise((t,n)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{const t=Ns("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),Oa="Browser",$n(new Ht("auth",(e,t)=>{let{options:n}=t;const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=s.options;Is(a&&!a.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:a,authDomain:o,clientPlatform:Oa,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ri(Oa)},l=new Oi(s,i,r,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],s=(Array.isArray(n)?n:[n]).map(hi);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),$n(new Ht("auth-internal",e=>(e=>new Ra(e))(ki(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),os(Ta,Ca,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Oa)),os(Ta,Ca,"esm2017");var Pa=function(){return Pa=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Pa.apply(this,arguments)},ja=function(e){return{loading:void 0===e||null===e,value:e}},La=function(e){var n=e?e():void 0,s=(0,t.useReducer)(function(e,t){switch(t.type){case"error":return Pa(Pa({},e),{error:t.error,loading:!1,value:void 0});case"reset":return ja(t.defaultValue);case"value":return Pa(Pa({},e),{error:void 0,loading:!1,value:t.value});default:return e}},ja(n)),i=s[0],r=s[1],a=(0,t.useCallback)(function(){var t=e?e():void 0;r({type:"reset",defaultValue:t})},[e]),o=(0,t.useCallback)(function(e){r({type:"error",error:e})},[]),c=(0,t.useCallback)(function(e){r({type:"value",value:e})},[]);return(0,t.useMemo)(function(){return{error:i.error,loading:i.loading,reset:a,setError:o,setValue:c,value:i.value}},[i.error,i.loading,a,o,c,i.value])},Ma=function(e,n){var s=La(function(){return e.currentUser}),i=s.error,r=s.loading,a=s.setError,o=s.setValue,c=s.value;return(0,t.useEffect)(function(){var t=function(e,t,n,s){return Wt(e).onAuthStateChanged(t,n,s)}(e,function(e){return ka(void 0,void 0,void 0,function(){var t;return Da(this,function(s){switch(s.label){case 0:if(!(null===n||void 0===n?void 0:n.onUserChanged))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.onUserChanged(e)];case 2:return s.sent(),[3,4];case 3:return t=s.sent(),a(t),[3,4];case 4:return o(e),[2]}})})},a);return function(){t()}},[e]),[c,r,i]};os("firebase","10.12.2","app");var Ua,Va,Fa="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Ba={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var s=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)s[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)s[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var r=e.g[3],a=t+(r^n&(i^r))+s[0]+3614090360&4294967295;a=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=n+(a<<7&4294967295|a>>>25))+((a=r+(i^t&(n^i))+s[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^r&(t^n))+s[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(r^t))+s[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^n&(i^r))+s[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=r+(i^t&(n^i))+s[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^r&(t^n))+s[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(r^t))+s[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^n&(i^r))+s[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=r+(i^t&(n^i))+s[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^r&(t^n))+s[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(r^t))+s[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^n&(i^r))+s[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=r+(i^t&(n^i))+s[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^r&(t^n))+s[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(r^t))+s[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^r&(n^i))+s[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^i&(t^n))+s[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(r^t))+s[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(i^r))+s[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^r&(n^i))+s[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^i&(t^n))+s[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(r^t))+s[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(i^r))+s[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^r&(n^i))+s[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^i&(t^n))+s[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(r^t))+s[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(i^r))+s[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^r&(n^i))+s[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=r+(n^i&(t^n))+s[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(r^t))+s[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(r^t&(i^r))+s[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^r)+s[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^i)+s[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(r^t^n)+s[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^r^t)+s[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^r)+s[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^i)+s[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(r^t^n)+s[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^r^t)+s[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^r)+s[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^i)+s[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(r^t^n)+s[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^r^t)+s[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^r)+s[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=r+(t^n^i)+s[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(r^t^n)+s[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^r^t)+s[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~r))+s[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~i))+s[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(r|~n))+s[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(r^(i|~t))+s[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~r))+s[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~i))+s[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(r|~n))+s[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(r^(i|~t))+s[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~r))+s[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~i))+s[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(r|~n))+s[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(r^(i|~t))+s[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((r=(t=n+((a=t+(i^(n|~r))+s[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=r+(n^(t|~i))+s[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=r+((a=i+(t^(r|~n))+s[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+r&4294967295}function s(e,t){this.h=t;for(var n=[],s=!0,i=e.length-1;0<=i;i--){var r=0|e[i];s&&r==t||(n[i]=r,s=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var s=t-this.blockSize,i=this.B,r=this.h,a=0;a<t;){if(0==r)for(;a<=s;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(i[r++]=e.charCodeAt(a++),r==this.blockSize){n(this,i),r=0;break}}else for(;a<t;)if(i[r++]=e[a++],r==this.blockSize){n(this,i),r=0;break}}this.h=r,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var s=0;32>s;s+=8)e[n++]=this.g[t]>>>s&255;return e};var i={};function r(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new s([0|e],0>e?-1:0)}):new s([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(0>e)return h(a(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new s(t,0)}var o=r(0),c=r(1),l=r(16777216);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new s(n,~e.h).add(c)}function p(e,t){return e.add(h(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function f(e,t){this.g=e,this.h=t}function g(e,t){if(d(t))throw Error("division by zero");if(d(e))return new f(o,o);if(u(e))return t=g(h(e),t),new f(h(t.g),h(t.h));if(u(t))return t=g(e,h(t)),new f(h(t.g),t.h);if(30<e.g.length){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,s=t;0>=s.l(e);)n=y(n),s=y(s);var i=v(n,1),r=v(s,1);for(s=v(s,2),n=v(n,2);!d(s);){var l=r.add(s);0>=l.l(e)&&(i=i.add(n),r=l),s=v(s,1),n=v(n,1)}return t=p(e,i.j(t)),new f(i,t)}for(i=o;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),l=(r=a(n)).j(t);u(l)||0<l.l(e);)l=(r=a(n-=s)).j(t);d(r)&&(r=c),i=i.add(r),e=p(e,l)}return new f(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new s(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,r=[],a=0;a<i;a++)r[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new s(r,e.h)}(e=s.prototype).m=function(){if(u(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var s=this.i(n);e+=(0<=s?s:4294967296+s)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(u(this))return"-"+h(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,s="";;){var i=g(n,t).g,r=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(d(n=i))return r+s;for(;6>r.length;)r="0"+r;s=r+s}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=p(this,e))?-1:d(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,r=0;r<=t;r++){var a=i+(65535&this.i(r))+(65535&e.i(r)),o=(a>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);i=o>>>16,a&=65535,o&=65535,n[r]=o<<16|a}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return o;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(0>this.l(l)&&0>e.l(l))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<e.g.length;r++){var c=this.i(i)>>>16,p=65535&this.i(i),f=e.i(r)>>>16,g=65535&e.i(r);n[2*i+2*r]+=p*g,m(n,2*i+2*r),n[2*i+2*r+1]+=c*g,m(n,2*i+2*r+1),n[2*i+2*r+1]+=p*f,m(n,2*i+2*r+1),n[2*i+2*r+2]+=c*f,m(n,2*i+2*r+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new s(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new s(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new s(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Va=Ba.Md5=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=a,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=a(Math.pow(n,8)),i=o,r=0;r<t.length;r+=8){var c=Math.min(8,t.length-r),l=parseInt(t.substring(r,r+c),n);8>c?(c=a(Math.pow(n,c)),i=i.j(c).add(a(l))):i=(i=i.j(s)).add(a(l))}return i},Ua=Ba.Integer=s}).apply("undefined"!==typeof Fa?Fa:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Ga,Wa,Ha,Ka,za,qa,Ya,Xa,Ja,Qa="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Za={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Qa&&Qa];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,s){if(s)e:{var i=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in i))break e;i=i[a]}(s=s(r=i[e=e[e.length-1]]))!=r&&null!=s&&t(i,e,{configurable:!0,writable:!0,value:s})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,s=!1,i={next:function(){if(!s&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return s=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});var s=s||{},i=this||self;function r(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:c).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.prototype[n].apply(e,i)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let s=0;s<t;s++)n[s]=e[s];return n}return[]}function p(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(r(t)){const n=e.length||0,s=t.length||0;e.length=n+s;for(let i=0;i<s;i++)e[n+i]=t[i]}else e.push(t)}}function m(e){return/^[\s\xa0]*$/.test(e)}function f(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=-1!=f().indexOf("Gecko")&&!(-1!=f().toLowerCase().indexOf("webkit")&&-1==f().indexOf("Edge"))&&!(-1!=f().indexOf("Trident")||-1!=f().indexOf("MSIE"))&&-1==f().indexOf("Edge");function v(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function _(e){const t={};for(const n in e)t[n]=e[n];return t}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let n,s;for(let i=1;i<arguments.length;i++){for(n in s=arguments[i],s)e[n]=s[n];for(let t=0;t<E.length;t++)n=E[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function x(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function w(e){i.setTimeout(()=>{throw e},0)}function S(){var e=I;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var N=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,R=!1,I=new class{constructor(){this.h=this.g=null}add(e,t){const n=N.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},A=()=>{const e=i.Promise.resolve(void 0);C=()=>{e.then(O)}};var O=()=>{for(var e;e=S();){try{e.h.call(e.g)}catch(n){w(n)}var t=N;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}R=!1};function k(){this.s=this.s,this.C=this.C}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}k.prototype.s=!1,k.prototype.ma=function(){this.s||(this.s=!0,this.N())},k.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},D.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function j(e,t){if(D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var i=!0;break e}catch(ze){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:L[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&j.aa.h.call(this)}}u(j,D);var L={2:"touch",3:"pen",4:"mouse"};j.prototype.h=function(){j.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(e,t,n,s,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.ha=i,this.key=++U,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function G(e,t){var n=t.type;if(n in e.g){var s,i=e.g[n],r=Array.prototype.indexOf.call(i,t,void 0);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(F(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function W(e,t,n,s){for(var i=0;i<e.length;++i){var r=e[i];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==s)return i}return-1}B.prototype.add=function(e,t,n,s,i){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var a=W(e,t,s,i);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new V(t,this.src,r,!!s,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),K={};function z(e,t,n,s,i){if(s&&s.once)return Y(e,t,n,s,i);if(Array.isArray(t)){for(var r=0;r<t.length;r++)z(e,t[r],n,s,i);return null}return n=te(n),e&&e[M]?e.K(t,n,a(s)?!!s.capture:!!s,i):q(e,t,n,!1,s,i)}function q(e,t,n,s,i,r){if(!t)throw Error("Invalid event type");var o=a(i)?!!i.capture:!!i,c=$(e);if(c||(e[H]=c=new B(e)),(n=c.add(t,n,s,o,r)).proxy)return n;if(s=function(){function e(n){return t.call(e.src,e.listener,n)}const t=Z;return e}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)P||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),s,i);else if(e.attachEvent)e.attachEvent(Q(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}function Y(e,t,n,s,i){if(Array.isArray(t)){for(var r=0;r<t.length;r++)Y(e,t[r],n,s,i);return null}return n=te(n),e&&e[M]?e.L(t,n,a(s)?!!s.capture:!!s,i):q(e,t,n,!0,s,i)}function X(e,t,n,s,i){if(Array.isArray(t))for(var r=0;r<t.length;r++)X(e,t[r],n,s,i);else s=a(s)?!!s.capture:!!s,n=te(n),e&&e[M]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=W(r=e.g[t],n,s,i))&&(F(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--)))):e&&(e=$(e))&&(t=e.g[t.toString()],e=-1,t&&(e=W(t,n,s,i)),(n=-1<e?t[e]:null)&&J(n))}function J(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])G(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent(Q(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=$(t))?(G(n,e),0==n.h&&(n.src=null,t[H]=null)):F(e)}}}function Q(e){return e in K?K[e]:K[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new j(t,this);var n=e.listener,s=e.ha||e.src;e.fa&&J(e),e=n.call(s,t)}return e}function $(e){return(e=e[H])instanceof B?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){k.call(this),this.i=new B(this),this.M=this,this.F=null}function se(e,t){var n,s=e.F;if(s)for(n=[];s;s=s.F)n.push(s);if(e=e.M,s=t.type||t,"string"===typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var i=t;b(t=new D(s,e),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var a=t.g=n[r];i=ie(a,s,!0,t)&&i}if(i=ie(a=t.g=e,s,!0,t)&&i,i=ie(a,s,!1,t)&&i,n)for(r=0;r<n.length;r++)i=ie(a=t.g=n[r],s,!1,t)&&i}function ie(e,t,n,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,r=0;r<t.length;++r){var a=t[r];if(a&&!a.da&&a.capture==n){var o=a.listener,c=a.ha||a.src;a.fa&&G(e.i,a),i=!1!==o.call(c,s)&&i}}return i&&!s.defaultPrevented}function re(e,t,n){if("function"===typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ae(e){e.g=re(()=>{e.g=null,e.i&&(e.i=!1,ae(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(ne,k),ne.prototype[M]=!0,ne.prototype.removeEventListener=function(e,t,n,s){X(this,e,t,n,s)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)F(n[s]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,s){return this.i.add(String(e),t,!1,n,s)},ne.prototype.L=function(e,t,n,s){return this.i.add(String(e),t,!0,n,s)};class oe extends k{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ae(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){k.call(this),this.h=e,this.g={}}u(ce,k);var le=[];function de(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&J(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),de(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ue=i.JSON.stringify,he=i.JSON.parse,pe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function me(){}function fe(e){return e.h||(e.h=e.i())}function ge(){}me.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){D.call(this,"d")}function _e(){D.call(this,"c")}u(ve,D),u(_e,D);var Ee={},be=null;function xe(){return be=be||new ne}function we(e){D.call(this,Ee.La,e)}function Se(e){const t=xe();se(t,new we(t))}function Ne(e,t){D.call(this,Ee.STAT_EVENT,e),this.stat=t}function Te(e){const t=xe();se(t,new Ne(t,e))}function Ce(e,t){D.call(this,Ee.Ma,e),this.size=t}function Re(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ie(){this.g=!0}function Ae(e,t,n,s){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var s=n[e];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var a=1;a<i.length;a++)i[a]=""}}}return ue(n)}catch(Ke){return t}}(e,n)+(s?" "+s:"")})}Ee.La="serverreachability",u(we,D),Ee.STAT_EVENT="statevent",u(Ne,D),Ee.Ma="timingevent",u(Ce,D),Ie.prototype.xa=function(){this.g=!1},Ie.prototype.info=function(){};var Oe,ke={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},De={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Pe(){}function je(e,t,n,s){this.j=e,this.i=t,this.l=n,this.R=s||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Le}function Le(){this.i=null,this.g="",this.h=!1}u(Pe,me),Pe.prototype.g=function(){return new XMLHttpRequest},Pe.prototype.i=function(){return{}},Oe=new Pe;var Me={},Ue={};function Ve(e,t,n){e.L=1,e.v=ft(dt(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),He(e),e.A=dt(e.v);var n=e.A,s=e.R;Array.isArray(s)||(s=[String(s)]),It(n.i,"t",s),e.C=0,n=e.j.J,e.h=new Le,e.g=yn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new oe(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,s=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(le[0]=i.toString()),i=le);for(var r=0;r<i.length;r++){var a=z(n,i[r],s||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?_(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Se(),function(e,t,n,s,i,r){e.info(function(){if(e.g)if(r)for(var a="",o=r.split("&"),c=0;c<o.length;c++){var l=o[c].split("=");if(1<l.length){var d=l[0];l=l[1];var u=d.split("_");a=2<=u.length&&"type"==u[1]?a+(d+"=")+l+"&":a+(d+"=redacted&")}}else a=null;else a=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Be(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ge(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?Ue:(n=Number(t.substring(n,s)),isNaN(n)?Me:(s+=1)+n>t.length?Ue:(t=t.slice(s,s+n),e.C=s+n,t))}function He(e){e.S=Date.now()+e.I,qe(e,e.I)}function qe(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Re(l(e.ba,e),t)}function Ye(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function Xe(e){0==e.j.G||e.J||hn(e.j,e)}function Je(e){Ye(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,de(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Qe(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||st(n.h,e)))if(!e.K&&st(n.h,e)&&3==n.G){try{var s=n.Da.g.parse(t)}catch(d){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;un(n),en(n)}cn(n),Te(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Re(l(n.Za,n),6e3));if(1>=nt(n.h)&&n.ca){try{n.ca()}catch(d){}n.ca=void 0}}else mn(n,11)}else if((e.K||n.g==e)&&un(n),!m(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=l[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const d=l[5];null!=d&&"number"===typeof d&&0<d&&(s=1.5*d,n.L=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=s.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(it(r,r.h),r.h=null))}if(s.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.ya=e,mt(s.I,s.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((s=n).qa=gn(s,s.J?s.ia:null,s.W),a.K){rt(s.h,a);var o=a,c=s.L;c&&(o.I=c),o.B&&(Ye(o),He(o)),s.g=a}else on(s);0<n.i.length&&nn(n)}else"stop"!=l[0]&&"close"!=l[0]||mn(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?mn(n,7):$t(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}Se()}catch(d){}}je.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Xt(e)?t.j():this.Y(e)},je.prototype.Y=function(e){try{if(e==this.g)e:{const h=Xt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Jt(this.g)))){this.J||4!=h||7==t||Se(),Ye(this);var n=this.g.Z();this.X=n;t:if(Be(this)){var s=Jt(this.g);e="";var r=s.length,a=4==Xt(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Je(this),Xe(this);var o="";break t}this.h.i=new i.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(s[t],{stream:!(a&&t==r-1)});s.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,s,i,r,a){e.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+r+" "+a})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(c)){var d=c;break t}}d=null}if(!(n=d)){this.o=!1,this.s=3,Te(12),Je(this),Xe(this);break e}Ae(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qe(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;){if(e=Ge(this,o),e==Ue){4==h&&(this.s=4,Te(14),n=!1),Ae(this.i,this.l,null,"[Incomplete Response]");break}if(e==Me){this.s=4,Te(15),Ae(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}Ae(this.i,this.l,e,null),Qe(this,e)}if(Be(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=o.length||this.h.h||(this.s=1,Te(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),ln(u),u.M=!0,Te(11))}}else Ae(this.i,this.l,o,"[Invalid Chunked Response]"),Je(this),Xe(this)}else Ae(this.i,this.l,o,null),Qe(this,o);4==h&&Je(this),this.o&&!this.J&&(4==h?hn(this.j,this):(this.o=!1,He(this)))}else(function(e){const t={};e=(e.g&&2<=Xt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(m(e[s]))continue;var n=x(e[s]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const r=t[i]||[];t[i]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Te(12)):(this.s=0,Te(13)),Je(this),Xe(this)}}}catch(h){}},je.prototype.cancel=function(){this.J=!0,Je(this)},je.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Se(),Te(17)),Je(this),this.s=2,Xe(this)):qe(this,this.S-e)};var Ze=class{constructor(e,t){this.g=e,this.map=t}};function et(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function tt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function nt(e){return e.h?1:e.g?e.g.size:0}function st(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function it(e,t){e.g?e.g.add(t):e.h=t}function rt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function at(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function ot(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(r(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(r(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const s in e)t[n++]=s;return t}}}(e),s=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(r(e)){for(var t=[],n=e.length,s=0;s<n;s++)t.push(e[s]);return t}for(s in t=[],n=0,e)t[n++]=e[s];return t}(e),i=s.length,a=0;a<i;a++)t.call(void 0,s[a],n&&n[a],e)}et.prototype.cancel=function(){if(this.i=at(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ct=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof lt){this.h=e.h,ut(this,e.j),this.o=e.o,this.g=e.g,ht(this,e.s),this.l=e.l;var t=e.i,n=new Nt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),pt(this,n),this.m=e.m}else e&&(t=String(e).match(ct))?(this.h=!1,ut(this,t[1]||"",!0),this.o=gt(t[2]||""),this.g=gt(t[3]||"",!0),ht(this,t[4]),this.l=gt(t[5]||"",!0),pt(this,t[6]||"",!0),this.m=gt(t[7]||"")):(this.h=!1,this.i=new Nt(null,this.h))}function dt(e){return new lt(e)}function ut(e,t,n){e.j=n?gt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ht(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function pt(e,t,n){t instanceof Nt?(e.i=t,function(e,t){t&&!e.j&&(Tt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Ct(this,t),It(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=yt(t,wt)),e.i=new Nt(t,e.h))}function mt(e,t,n){e.i.set(t,n)}function ft(e){return mt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function gt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function yt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,vt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function vt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}lt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(yt(t,Et,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(yt(t,Et,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(yt(n,"/"==n.charAt(0)?xt:bt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",yt(n,St)),e.join("")};var _t,Et=/[#\/\?@]/g,bt=/[#\?:]/g,xt=/[#\?]/g,wt=/[#\?@]/g,St=/#/g;function Nt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Tt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var s=e[n].indexOf("="),i=null;if(0<=s){var r=e[n].substring(0,s);i=e[n].substring(s+1)}else r=e[n];t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Ct(e,t){Tt(e),t=At(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Rt(e,t){return Tt(e),t=At(e,t),e.g.has(t)}function It(e,t,n){Ct(e,t),0<n.length&&(e.i=null,e.g.set(At(e,t),h(n)),e.h+=n.length)}function At(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ot(e,t,n,s,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),s(n)}catch(ze){}}function kt(){this.g=new pe}function Dt(e,t,n){const s=n||"";try{ot(e,function(e,n){let i=e;a(e)&&(i=ue(e)),t.push(s+n+"="+encodeURIComponent(i))})}catch(mv){throw t.push(s+"type="+encodeURIComponent("_badmap")),mv}}function Pt(e){this.l=e.Ub||null,this.j=e.eb||!1}function jt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Lt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Mt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ut(e)}function Ut(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Vt(e){let t="";return v(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Ft(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=Vt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):mt(e,t,n))}function Bt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Nt.prototype).add=function(e,t){Tt(this),this.i=null,e=At(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Tt(this),this.g.forEach(function(n,s){n.forEach(function(n){e.call(t,n,s,this)},this)},this)},e.na=function(){Tt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let s=0;s<t.length;s++){const i=e[s];for(let e=0;e<i.length;e++)n.push(t[s])}return n},e.V=function(e){Tt(this);let t=[];if("string"===typeof e)Rt(this,e)&&(t=t.concat(this.g.get(At(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Tt(this),this.i=null,Rt(this,e=At(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var s=t[n];const r=encodeURIComponent(String(s)),a=this.V(s);for(s=0;s<a.length;s++){var i=r;""!==a[s]&&(i+="="+encodeURIComponent(String(a[s]))),e.push(i)}}return this.i=e.join("&")},u(Pt,me),Pt.prototype.g=function(){return new jt(this.l,this.j)},Pt.prototype.i=(_t={},function(){return _t}),u(jt,ne),(e=jt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ut(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ut(this)),this.g&&(this.readyState=3,Ut(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mt(this):Ut(this),3==this.readyState&&Lt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Mt(this))},e.Qa=function(e){this.g&&(this.response=e,Mt(this))},e.ga=function(){this.g&&Mt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(jt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Bt,ne);var Gt=/^https?$/i,Wt=["POST","PUT"];function Ht(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Kt(e),qt(e)}function Kt(e){e.A||(e.A=!0,se(e,"complete"),se(e,"error"))}function zt(e){if(e.h&&"undefined"!=typeof s&&(!e.v[1]||4!=Xt(e)||2!=e.Z()))if(e.u&&4==Xt(e))re(e.Ea,0,e);else if(se(e,"readystatechange"),4==Xt(e)){e.h=!1;try{const s=e.Z();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){var a=String(e.D).match(ct)[1]||null;!a&&i.self&&i.self.location&&(a=i.self.location.protocol.slice(0,-1)),r=!Gt.test(a?a.toLowerCase():"")}n=r}if(n)se(e,"complete"),se(e,"success");else{e.m=6;try{var o=2<Xt(e)?e.g.statusText:""}catch(Ke){o=""}e.l=o+" ["+e.Z()+"]",Kt(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){Yt(e);const n=e.g,s=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||se(e,"ready");try{n.onreadystatechange=s}catch(mv){}}}function Yt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Xt(e){return e.g?e.g.readyState:0}function Jt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch($e){return null}}function Qt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Zt(e){this.Aa=0,this.i=[],this.j=new Ie,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qt("baseRetryDelayMs",5e3,e),this.cb=Qt("retryDelaySeedMs",1e4,e),this.Wa=Qt("forwardChannelMaxRetries",2,e),this.wa=Qt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new et(e&&e.concurrentRequestLimit),this.Da=new kt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function $t(e){if(tn(e),3==e.G){var t=e.U++,n=dt(e.I);if(mt(n,"SID",e.K),mt(n,"RID",t),mt(n,"TYPE","terminate"),rn(e,n),(t=new je(e,e.j,t)).L=2,t.v=ft(dt(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(We){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=yn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),He(t)}fn(e)}function en(e){e.g&&(ln(e),e.g.cancel(),e.g=null)}function tn(e){en(e),e.u&&(i.clearTimeout(e.u),e.u=null),un(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function nn(e){if(!tt(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||A(),R||(C(),R=!0),I.add(t,e),e.B=0}}function sn(e,t){var n;n=t?t.l:e.U++;const s=dt(e.I);mt(s,"SID",e.K),mt(s,"RID",n),mt(s,"AID",e.T),rn(e,s),e.m&&e.o&&Ft(s,e.m,e.o),n=new je(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=an(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),it(e.h,n),Ve(n,s,t)}function rn(e,t){e.H&&v(e.H,function(e,n){mt(t,n,e)}),e.l&&ot({},function(e,n){mt(t,n,e)})}function an(e,t,n){n=Math.min(e.i.length,n);var s=e.l?l(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let a=!0;for(let o=0;o<n;o++){let n=i[o].g;const c=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),a=!1;else try{Dt(c,e,"req"+n+"_")}catch(r){s&&s(c)}}if(a){s=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,s}function on(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||A(),R||(C(),R=!0),I.add(t,e),e.v=0}}function cn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Re(l(e.Fa,e),pn(e,e.v)),e.v++,!0)}function ln(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function dn(e){e.g=new je(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=dt(e.qa);mt(t,"RID","rpc"),mt(t,"SID",e.K),mt(t,"AID",e.T),mt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&mt(t,"TO",e.ja),mt(t,"TYPE","xmlhttp"),rn(e,t),e.m&&e.o&&Ft(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ft(dt(t)),n.m=null,n.P=!0,Fe(n,e)}function un(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function hn(e,t){var n=null;if(e.g==t){un(e),ln(e),e.g=null;var s=2}else{if(!st(e.h,t))return;n=t.D,rt(e.h,t),s=1}if(0!=e.G)if(t.o)if(1==s){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;se(s=xe(),new Ce(s,n)),nn(e)}else on(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==s&&function(e,t){return!(nt(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Re(l(e.Ga,e,t),pn(e,e.B)),e.B++,!0))}(e,t)||2==s&&cn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:mn(e,5);break;case 4:mn(e,10);break;case 3:mn(e,6);break;default:mn(e,2)}}function pn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function mn(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),s=e.Xa;const t=!s;s=new lt(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ut(s,"https"),ft(s),t?function(e,t){const n=new Ie;if(i.Image){const s=new Image;s.onload=d(Ot,n,"TestLoadImage: loaded",!0,t,s),s.onerror=d(Ot,n,"TestLoadImage: error",!1,t,s),s.onabort=d(Ot,n,"TestLoadImage: abort",!1,t,s),s.ontimeout=d(Ot,n,"TestLoadImage: timeout",!1,t,s),i.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=e}else t(!1)}(s.toString(),n):function(e,t){new Ie;const n=new AbortController,s=setTimeout(()=>{n.abort(),Ot(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(s),e.ok?Ot(0,0,!0,t):Ot(0,0,!1,t)}).catch(()=>{clearTimeout(s),Ot(0,0,!1,t)})}(s.toString(),n)}else Te(2);e.G=0,e.l&&e.l.sa(t),fn(e),tn(e)}function fn(e){if(e.G=0,e.ka=[],e.l){const t=at(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function gn(e,t,n){var s=n instanceof lt?dt(n):new lt(n);if(""!=s.g)t&&(s.g=t+"."+s.g),ht(s,s.s);else{var r=i.location;s=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var a=new lt(null);s&&ut(a,s),t&&(a.g=t),r&&ht(a,r),n&&(a.l=n),s=a}return n=e.D,t=e.ya,n&&t&&mt(s,n,t),mt(s,"VER",e.la),rn(e,s),s}function yn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Bt(new Pt({eb:n})):new Bt(e.pa)).Ha(e.J),t}function vn(){}function _n(){}function En(e,t){ne.call(this),this.g=new Zt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new wn(this)}function bn(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function xn(){_e.call(this),this.status=1}function wn(e){this.g=e}(e=Bt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Oe.g(),this.v=this.o?fe(this.o):fe(Oe),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(ze){return void Ht(this,ze)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!==typeof s.keys||"function"!==typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Wt,t,void 0))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Yt(this),this.u=!0,this.g.send(e),this.u=!1}catch(ze){Ht(this,ze)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,se(this,"complete"),se(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),Bt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?zt(this):this.bb())},e.bb=function(){zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Xt(this)?this.g.status:-1}catch(_t){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(_t){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Zt.prototype).la=8,e.G=1,e.connect=function(e,t,n,s){Te(0),this.W=e,this.H=t||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.I=gn(this,null,this.W),nn(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new je(this,this.j,e);let r=this.o;if(this.S&&(r?(r=_(r),b(r,this.S)):r=this.S),null!==this.m||this.O||(i.H=r,r=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"===typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(t+=s)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=an(this,i,t),mt(n=dt(this.I),"RID",e),mt(n,"CVER",22),this.D&&mt(n,"X-HTTP-Session-Id",this.D),rn(this,n),r&&(this.O?t="headers="+encodeURIComponent(String(Vt(r)))+"&"+t:this.m&&Ft(n,this.m,r)),it(this.h,i),this.Ua&&mt(n,"TYPE","init"),this.P?(mt(n,"$req",t),mt(n,"SID","null"),i.T=!0,Ve(i,n,null)):Ve(i,n,t),this.G=2}}else 3==this.G&&(e?sn(this,e):0==this.i.length||tt(this.h)||sn(this))},e.Fa=function(){if(this.u=null,dn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Re(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Te(10),en(this),dn(this))},e.Za=function(){null!=this.C&&(this.C=null,en(this),cn(this),Te(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=vn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},_n.prototype.g=function(e,t){return new En(e,t)},u(En,ne),En.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},En.prototype.close=function(){$t(this.g)},En.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ue(e),e=n);t.i.push(new Ze(t.Ya++,e)),3==t.G&&nn(t)},En.prototype.N=function(){this.g.l=null,delete this.j,$t(this.g),delete this.g,En.aa.N.call(this)},u(bn,ve),u(xn,_e),u(wn,vn),wn.prototype.ua=function(){se(this.g,"a")},wn.prototype.ta=function(e){se(this.g,new bn(e))},wn.prototype.sa=function(e){se(this.g,new xn)},wn.prototype.ra=function(){se(this.g,"b")},_n.prototype.createWebChannel=_n.prototype.g,En.prototype.send=En.prototype.o,En.prototype.open=En.prototype.m,En.prototype.close=En.prototype.close,Ja=Za.createWebChannelTransport=function(){return new _n},Xa=Za.getStatEventTarget=function(){return xe()},Ya=Za.Event=Ee,qa=Za.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ke.NO_ERROR=0,ke.TIMEOUT=8,ke.HTTP_ERROR=6,za=Za.ErrorCode=ke,De.COMPLETE="complete",Ka=Za.EventType=De,ge.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,Ha=Za.WebChannel=ge,Wa=Za.FetchXmlHttpFactory=Pt,Bt.prototype.listenOnce=Bt.prototype.L,Bt.prototype.getLastError=Bt.prototype.Ka,Bt.prototype.getLastErrorCode=Bt.prototype.Ba,Bt.prototype.getStatus=Bt.prototype.Z,Bt.prototype.getResponseJson=Bt.prototype.Oa,Bt.prototype.getResponseText=Bt.prototype.oa,Bt.prototype.send=Bt.prototype.ea,Bt.prototype.setWithCredentials=Bt.prototype.Ha,Ga=Za.XhrIo=Bt}).apply("undefined"!==typeof Qa?Qa:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const $a="@firebase/firestore";class eo{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}eo.UNAUTHENTICATED=new eo(null),eo.GOOGLE_CREDENTIALS=new eo("google-credentials-uid"),eo.FIRST_PARTY=new eo("first-party-uid"),eo.MOCK_USER=new eo("mock-user");let to="10.12.1";const no=new en("@firebase/firestore");function so(){return no.logLevel}function io(e){if(no.logLevel<=Xt.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const i=n.map(oo);no.debug("Firestore (".concat(to,"): ").concat(e),...i)}}function ro(e){if(no.logLevel<=Xt.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const i=n.map(oo);no.error("Firestore (".concat(to,"): ").concat(e),...i)}}function ao(e){if(no.logLevel<=Xt.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];const i=n.map(oo);no.warn("Firestore (".concat(to,"): ").concat(e),...i)}}function oo(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function co(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(to,") INTERNAL ASSERTION FAILED: ")+e;throw ro(t),new Error(t)}function lo(e,t){e||co()}function uo(e,t){return e}const ho={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class po extends Dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class mo{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class fo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class go{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(eo.UNAUTHENTICATED))}shutdown(){}}class yo{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vo{constructor(e){this.t=e,this.currentUser=eo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new mo;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new mo,e.enqueueRetryable(()=>s(this.currentUser))};const r=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await s(this.currentUser)})},a=e=>{io("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(io("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new mo)}},0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(io("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(lo("string"==typeof t.accessToken),new fo(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return lo(null===e||"string"==typeof e),new eo(e)}}class _o{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=eo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Eo{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new _o(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(eo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class bo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class xo{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&io("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,io("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const s=e=>{io("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>s(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?s(e):io("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(lo("string"==typeof e.token),this.R=e.token,new bo(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function wo(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let s=0;s<e;s++)n[s]=Math.floor(256*Math.random());return n}class So{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=wo(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+=e.charAt(s[i]%62))}return n}}function No(e,t){return e<t?-1:e>t?1:0}function To(e,t,n){return e.length===t.length&&e.every((e,s)=>n(e,t[s]))}class Co{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new po(ho.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new po(ho.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new po(ho.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new po(ho.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Co.fromMillis(Date.now())}static fromDate(e){return Co.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Co(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?No(this.nanoseconds,e.nanoseconds):No(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ro{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ro(e)}static min(){return new Ro(new Co(0,0))}static max(){return new Ro(new Co(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Io{constructor(e,t,n){void 0===t?t=0:t>e.length&&co(),void 0===n?n=e.length-t:n>e.length-t&&co(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Io.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Io?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=e.get(s),i=t.get(s);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ao extends Io{construct(e,t,n){return new Ao(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];for(const i of n){if(i.indexOf("//")>=0)throw new po(ho.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter(e=>e.length>0))}return new Ao(e)}static emptyPath(){return new Ao([])}}const Oo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ko extends Io{construct(e,t,n){return new ko(e,t,n)}static isValidIdentifier(e){return Oo.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ko.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ko(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new po(ho.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let r=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new po(ho.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new po(ho.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(r=!r,s++):"."!==t||r?(n+=t,s++):(i(),s++)}if(i(),r)throw new po(ho.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ko(t)}static emptyPath(){return new ko([])}}class Do{constructor(e){this.path=e}static fromPath(e){return new Do(Ao.fromString(e))}static fromName(e){return new Do(Ao.fromString(e).popFirst(5))}static empty(){return new Do(Ao.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ao.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ao.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Do(new Ao(e.slice()))}}class Po{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}}Po.UNKNOWN_ID=-1;function jo(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,i=Ro.fromTimestamp(1e9===s?new Co(n+1,0):new Co(n,s));return new Mo(i,Do.empty(),t)}function Lo(e){return new Mo(e.readTime,e.key,-1)}class Mo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Mo(Ro.min(),Do.empty(),-1)}static max(){return new Mo(Ro.max(),Do.empty(),-1)}}function Uo(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Do.comparator(e.documentKey,t.documentKey),0!==n?n:No(e.largestBatchId,t.largestBatchId))}const Vo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Bo(e){if(e.code!==ho.FAILED_PRECONDITION||e.message!==Vo)throw e;io("LocalStore","Unexpectedly lost primary lease")}class Go{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&co(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Go((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Go?t:Go.resolve(t)}catch(e){return Go.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Go.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Go.reject(t)}static resolve(e){return new Go((t,n)=>{t(e)})}static reject(e){return new Go((t,n)=>{n(e)})}static waitFor(e){return new Go((t,n)=>{let s=0,i=0,r=!1;e.forEach(e=>{++s,e.next(()=>{++i,r&&i===s&&t()},e=>n(e))}),r=!0,i===s&&t()})}static or(e){let t=Go.resolve(!1);for(const n of e)t=t.next(e=>e?Go.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,s)=>{n.push(t.call(this,e,s))}),this.waitFor(n)}static mapArray(e,t){return new Go((n,s)=>{const i=e.length,r=new Array(i);let a=0;for(let o=0;o<i;o++){const c=o;t(e[c]).next(e=>{r[c]=e,++a,a===i&&n(r)},e=>s(e))}})}static doWhile(e,t){return new Go((n,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):n()};i()})}}function Wo(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Ho(e){return"IndexedDbTransactionError"===e.name}class Ko{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function zo(e){return null==e}function qo(e){return 0===e&&1/e==-1/0}function Yo(e){return"number"==typeof e&&Number.isInteger(e)&&!qo(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}Ko.oe=-1;const Xo=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Jo=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Qo=Jo;function Zo(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function $o(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ec(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tc{constructor(e,t){this.comparator=e,this.root=t||sc.EMPTY}insert(e,t){return new tc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sc.BLACK,null,null))}remove(e){return new tc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nc(this.root,e,this.comparator,!1)}getReverseIterator(){return new nc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nc(this.root,e,this.comparator,!0)}}class nc{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sc{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=null!=n?n:sc.RED,this.left=null!=s?s:sc.EMPTY,this.right=null!=i?i:sc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new sc(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return sc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return sc.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,sc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,sc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw co();if(this.right.isRed())throw co();const e=this.left.check();if(e!==this.right.check())throw co();return e+(this.isRed()?0:1)}}sc.EMPTY=null,sc.RED=!0,sc.BLACK=!1,sc.EMPTY=new class{constructor(){this.size=0}get key(){throw co()}get value(){throw co()}get color(){throw co()}get left(){throw co()}get right(){throw co()}copy(e,t,n,s,i){return this}insert(e,t,n){return new sc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ic{constructor(e){this.comparator=e,this.data=new tc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rc(this.data.getIterator())}getIteratorFrom(e){return new rc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ic))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ic(this.comparator);return t.data=e,t}}class rc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ac{constructor(e){this.fields=e,e.sort(ko.comparator)}static empty(){return new ac([])}unionWith(e){let t=new ic(ko.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ac(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return To(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class oc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class cc{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new oc("Invalid base64 string: "+e):e}}(e);return new cc(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new cc(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return No(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}cc.EMPTY_BYTE_STRING=new cc("");const lc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dc(e){if(lo(!!e),"string"==typeof e){let t=0;const n=lc.exec(e);if(lo(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:uc(e.seconds),nanos:uc(e.nanos)}}function uc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function hc(e){return"string"==typeof e?cc.fromBase64String(e):cc.fromUint8Array(e)}function pc(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function mc(e){const t=e.mapValue.fields.__previous_value__;return pc(t)?mc(t):t}function fc(e){const t=dc(e.mapValue.fields.__local_write_time__.timestampValue);return new Co(t.seconds,t.nanos)}class gc{constructor(e,t,n,s,i,r,a,o,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=c}}class yc{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new yc("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof yc&&e.projectId===this.projectId&&e.database===this.database}}const vc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function _c(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?pc(e)?4:Dc(e)?9007199254740991:10:co()}function Ec(e,t){if(e===t)return!0;const n=_c(e);if(n!==_c(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return fc(e).isEqual(fc(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=dc(e.timestampValue),s=dc(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return hc(e.bytesValue).isEqual(hc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return uc(e.geoPointValue.latitude)===uc(t.geoPointValue.latitude)&&uc(e.geoPointValue.longitude)===uc(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return uc(e.integerValue)===uc(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=uc(e.doubleValue),s=uc(t.doubleValue);return n===s?qo(n)===qo(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return To(e.arrayValue.values||[],t.arrayValue.values||[],Ec);case 10:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(Zo(n)!==Zo(s))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===s[i]||!Ec(n[i],s[i])))return!1;return!0}(e,t);default:return co()}}function bc(e,t){return void 0!==(e.values||[]).find(e=>Ec(e,t))}function xc(e,t){if(e===t)return 0;const n=_c(e),s=_c(t);if(n!==s)return No(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return No(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=uc(e.integerValue||e.doubleValue),s=uc(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return wc(e.timestampValue,t.timestampValue);case 4:return wc(fc(e),fc(t));case 5:return No(e.stringValue,t.stringValue);case 6:return function(e,t){const n=hc(e),s=hc(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let i=0;i<n.length&&i<s.length;i++){const e=No(n[i],s[i]);if(0!==e)return e}return No(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=No(uc(e.latitude),uc(t.latitude));return 0!==n?n:No(uc(e.longitude),uc(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],s=t.values||[];for(let i=0;i<n.length&&i<s.length;++i){const e=xc(n[i],s[i]);if(e)return e}return No(n.length,s.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===vc.mapValue&&t===vc.mapValue)return 0;if(e===vc.mapValue)return 1;if(t===vc.mapValue)return-1;const n=e.fields||{},s=Object.keys(n),i=t.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let a=0;a<s.length&&a<r.length;++a){const e=No(s[a],r[a]);if(0!==e)return e;const t=xc(n[s[a]],i[r[a]]);if(0!==t)return t}return No(s.length,r.length)}(e.mapValue,t.mapValue);default:throw co()}}function wc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return No(e,t);const n=dc(e),s=dc(t),i=No(n.seconds,s.seconds);return 0!==i?i:No(n.nanos,s.nanos)}function Sc(e){return Nc(e)}function Nc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=dc(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return hc(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Do.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=Nc(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const i of t)s?s=!1:n+=",",n+="".concat(i,":").concat(Nc(e.fields[i]));return n+"}"}(e.mapValue):co()}function Tc(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Cc(e){return!!e&&"integerValue"in e}function Rc(e){return!!e&&"arrayValue"in e}function Ic(e){return!!e&&"nullValue"in e}function Ac(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Oc(e){return!!e&&"mapValue"in e}function kc(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return $o(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=kc(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=kc(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Dc(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Pc{constructor(e){this.value=e}static empty(){return new Pc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Oc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=kc(t)}setAll(e){let t=ko.emptyPath(),n={},s=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=i.popLast()}e?n[i.lastSegment()]=kc(e):s.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());Oc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ec(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Oc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){$o(t,(t,n)=>e[t]=n);for(const s of n)delete e[s]}clone(){return new Pc(kc(this.value))}}function jc(e){const t=[];return $o(e.fields,(e,n)=>{const s=new ko([e]);if(Oc(n)){const e=jc(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)}),new ac(t)}class Lc{constructor(e,t,n,s,i,r,a){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=a}static newInvalidDocument(e){return new Lc(e,0,Ro.min(),Ro.min(),Ro.min(),Pc.empty(),0)}static newFoundDocument(e,t,n,s){return new Lc(e,1,t,Ro.min(),n,s,0)}static newNoDocument(e,t){return new Lc(e,2,t,Ro.min(),Ro.min(),Pc.empty(),0)}static newUnknownDocument(e,t){return new Lc(e,3,t,Ro.min(),Ro.min(),Pc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ro.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ro.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Lc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Lc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class Mc{constructor(e,t){this.position=e,this.inclusive=t}}function Uc(e,t,n){let s=0;for(let i=0;i<e.position.length;i++){const r=t[i],a=e.position[i];if(s=r.field.isKeyField()?Do.comparator(Do.fromName(a.referenceValue),n.key):xc(a,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function Vc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ec(e.position[n],t.position[n]))return!1;return!0}class Fc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Bc(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Gc{}class Wc extends Gc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Qc(e,t,n):"array-contains"===t?new tl(e,n):"in"===t?new nl(e,n):"not-in"===t?new sl(e,n):"array-contains-any"===t?new il(e,n):new Wc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Zc(e,n):new $c(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(xc(t,this.value)):null!==t&&_c(this.value)===_c(t)&&this.matchesComparison(xc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return co()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Hc extends Gc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Hc(e,t)}matches(e){return Kc(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Kc(e){return"and"===e.op}function zc(e){return qc(e)&&Kc(e)}function qc(e){for(const t of e.filters)if(t instanceof Hc)return!1;return!0}function Yc(e){if(e instanceof Wc)return e.field.canonicalString()+e.op.toString()+Sc(e.value);if(zc(e))return e.filters.map(e=>Yc(e)).join(",");{const t=e.filters.map(e=>Yc(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Xc(e,t){return e instanceof Wc?function(e,t){return t instanceof Wc&&e.op===t.op&&e.field.isEqual(t.field)&&Ec(e.value,t.value)}(e,t):e instanceof Hc?function(e,t){return t instanceof Hc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,s)=>e&&Xc(n,t.filters[s]),!0)}(e,t):void co()}function Jc(e){return e instanceof Wc?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Sc(e.value))}(e):e instanceof Hc?function(e){return e.op.toString()+" {"+e.getFilters().map(Jc).join(" ,")+"}"}(e):"Filter"}class Qc extends Wc{constructor(e,t,n){super(e,t,n),this.key=Do.fromName(n.referenceValue)}matches(e){const t=Do.comparator(e.key,this.key);return this.matchesComparison(t)}}class Zc extends Wc{constructor(e,t){super(e,"in",t),this.keys=el("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class $c extends Wc{constructor(e,t){super(e,"not-in",t),this.keys=el("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function el(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Do.fromName(e.referenceValue))}class tl extends Wc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Rc(t)&&bc(t.arrayValue,this.value)}}class nl extends Wc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&bc(this.value.arrayValue,t)}}class sl extends Wc{constructor(e,t){super(e,"not-in",t)}matches(e){if(bc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!bc(this.value.arrayValue,t)}}class il extends Wc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Rc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>bc(this.value.arrayValue,e))}}class rl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=a,this.ue=null}}function al(e){return new rl(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function ol(e){const t=uo(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Yc(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),zo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Sc(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Sc(e)).join(",")),t.ue=e}return t.ue}function cl(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Bc(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Xc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Vc(e.startAt,t.startAt)&&Vc(e.endAt,t.endAt)}function ll(e){return Do.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class dl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function ul(e,t,n,s,i,r,a,o){return new dl(e,t,n,s,i,r,a,o)}function hl(e){return new dl(e)}function pl(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ml(e){return null!==e.collectionGroup}function fl(e){const t=uo(e);if(null===t.ce){t.ce=[];const e=new Set;for(const i of t.explicitOrderBy)t.ce.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",s=function(e){let t=new ic(ko.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);s.forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new Fc(s,n))}),e.has(ko.keyField().canonicalString())||t.ce.push(new Fc(ko.keyField(),n))}return t.ce}function gl(e){const t=uo(e);return t.le||(t.le=yl(t,fl(e))),t.le}function yl(e,t){if("F"===e.limitType)return al(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Fc(e.field,t)});const n=e.endAt?new Mc(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new Mc(e.startAt.position,e.startAt.inclusive):null;return al(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}}function vl(e,t){const n=e.filters.concat([t]);return new dl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function _l(e,t,n){return new dl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function El(e,t){return cl(gl(e),gl(t))&&e.limitType===t.limitType}function bl(e){return"".concat(ol(gl(e)),"|lt:").concat(e.limitType)}function xl(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>Jc(e)).join(", "),"]")),zo(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Sc(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Sc(e)).join(",")),"Target(".concat(t,")")}(gl(e)),"; limitType=").concat(e.limitType,")")}function wl(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Do.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of fl(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const s=Uc(e,t,n);return e.inclusive?s<=0:s<0}(e.startAt,fl(e),t))&&!(e.endAt&&!function(e,t,n){const s=Uc(e,t,n);return e.inclusive?s>=0:s>0}(e.endAt,fl(e),t))}(e,t)}function Sl(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Nl(e){return(t,n)=>{let s=!1;for(const i of fl(e)){const e=Tl(i,t,n);if(0!==e)return e;s=s||i.field.isKeyField()}return 0}}function Tl(e,t,n){const s=e.field.isKeyField()?Do.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),i=n.data.field(e);return null!==s&&null!==i?xc(s,i):co()}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return co()}}class Cl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,i]of n)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){$o(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return ec(this.inner)}size(){return this.innerSize}}const Rl=new tc(Do.comparator);function Il(){return Rl}const Al=new tc(Do.comparator);function Ol(){let e=Al;for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];for(const i of n)e=e.insert(i.key,i);return e}function kl(e){let t=Al;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Dl(){return jl()}function Pl(){return jl()}function jl(){return new Cl(e=>e.toString(),(e,t)=>e.isEqual(t))}const Ll=new tc(Do.comparator),Ml=new ic(Do.comparator);function Ul(){let e=Ml;for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];for(const i of n)e=e.add(i);return e}const Vl=new ic(No);function Fl(){return Vl}function Bl(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qo(t)?"-0":t}}function Gl(e){return{integerValue:""+e}}function Wl(e,t){return Yo(t)?Gl(t):Bl(e,t)}class Hl{constructor(){this._=void 0}}function Kl(e,t,n){return e instanceof Yl?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&pc(t)&&(t=mc(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Xl?Jl(e,t):e instanceof Ql?Zl(e,t):function(e,t){const n=ql(e,t),s=ed(n)+ed(e.Pe);return Cc(n)&&Cc(e.Pe)?Gl(s):Bl(e.serializer,s)}(e,t)}function zl(e,t,n){return e instanceof Xl?Jl(e,t):e instanceof Ql?Zl(e,t):n}function ql(e,t){return e instanceof $l?function(e){return Cc(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Yl extends Hl{}class Xl extends Hl{constructor(e){super(),this.elements=e}}function Jl(e,t){const n=td(t);for(const s of e.elements)n.some(e=>Ec(e,s))||n.push(s);return{arrayValue:{values:n}}}class Ql extends Hl{constructor(e){super(),this.elements=e}}function Zl(e,t){let n=td(t);for(const s of e.elements)n=n.filter(e=>!Ec(e,s));return{arrayValue:{values:n}}}class $l extends Hl{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function ed(e){return uc(e.integerValue||e.doubleValue)}function td(e){return Rc(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nd{constructor(e,t){this.field=e,this.transform=t}}class sd{constructor(e,t){this.version=e,this.transformResults=t}}class id{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new id}static exists(e){return new id(void 0,e)}static updateTime(e){return new id(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rd(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ad{}function od(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new yd(e.key,id.none()):new hd(e.key,e.data,id.none());{const n=e.data,s=Pc.empty();let i=new ic(ko.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),i=i.add(e)}return new pd(e.key,s,new ac(i.toArray()),id.none())}}function cd(e,t,n){e instanceof hd?function(e,t,n){const s=e.value.clone(),i=fd(e.fieldTransforms,t,n.transformResults);s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof pd?function(e,t,n){if(!rd(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=fd(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(md(e)),i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ld(e,t,n,s){return e instanceof hd?function(e,t,n,s){if(!rd(e.precondition,t))return n;const i=e.value.clone(),r=gd(e.fieldTransforms,s,t);return i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,s):e instanceof pd?function(e,t,n,s){if(!rd(e.precondition,t))return n;const i=gd(e.fieldTransforms,s,t),r=t.data;return r.setAll(md(e)),r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,s):function(e,t,n){return rd(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function dd(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),i=ql(s.transform,e||null);null!=i&&(null===n&&(n=Pc.empty()),n.set(s.field,i))}return n||null}function ud(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&To(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Xl&&t instanceof Xl||e instanceof Ql&&t instanceof Ql?To(e.elements,t.elements,Ec):e instanceof $l&&t instanceof $l?Ec(e.Pe,t.Pe):e instanceof Yl&&t instanceof Yl}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class hd extends ad{constructor(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class pd extends ad{constructor(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function md(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}}),t}function fd(e,t,n){const s=new Map;lo(e.length===n.length);for(let i=0;i<n.length;i++){const r=e[i],a=r.transform,o=t.data.field(r.field);s.set(r.field,zl(a,o,n[i]))}return s}function gd(e,t,n){const s=new Map;for(const i of e){const e=i.transform,r=n.data.field(i.field);s.set(i.field,Kl(e,r,t))}return s}class yd extends ad{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vd extends ad{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class _d{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const t=this.mutations[s];t.key.isEqual(e.key)&&cd(t,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ld(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ld(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Pl();return this.mutations.forEach(s=>{const i=e.get(s.key),r=i.overlayedDocument;let a=this.applyToLocalView(r,i.mutatedFields);a=t.has(s.key)?null:a;const o=od(r,a);null!==o&&n.set(s.key,o),r.isValidDocument()||r.convertToNoDocument(Ro.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ul())}isEqual(e){return this.batchId===e.batchId&&To(this.mutations,e.mutations,(e,t)=>ud(e,t))&&To(this.baseMutations,e.baseMutations,(e,t)=>ud(e,t))}}class Ed{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){lo(e.mutations.length===n.length);let s=Ll;const i=e.mutations;for(let r=0;r<i.length;r++)s=s.insert(i[r].key,n[r].version);return new Ed(e,t,n,s)}}class bd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class xd{constructor(e,t){this.count=e,this.unchangedNames=t}}var wd,Sd;function Nd(e){switch(e){default:return co();case ho.CANCELLED:case ho.UNKNOWN:case ho.DEADLINE_EXCEEDED:case ho.RESOURCE_EXHAUSTED:case ho.INTERNAL:case ho.UNAVAILABLE:case ho.UNAUTHENTICATED:return!1;case ho.INVALID_ARGUMENT:case ho.NOT_FOUND:case ho.ALREADY_EXISTS:case ho.PERMISSION_DENIED:case ho.FAILED_PRECONDITION:case ho.ABORTED:case ho.OUT_OF_RANGE:case ho.UNIMPLEMENTED:case ho.DATA_LOSS:return!0}}function Td(e){if(void 0===e)return ro("GRPC error has no .code"),ho.UNKNOWN;switch(e){case wd.OK:return ho.OK;case wd.CANCELLED:return ho.CANCELLED;case wd.UNKNOWN:return ho.UNKNOWN;case wd.DEADLINE_EXCEEDED:return ho.DEADLINE_EXCEEDED;case wd.RESOURCE_EXHAUSTED:return ho.RESOURCE_EXHAUSTED;case wd.INTERNAL:return ho.INTERNAL;case wd.UNAVAILABLE:return ho.UNAVAILABLE;case wd.UNAUTHENTICATED:return ho.UNAUTHENTICATED;case wd.INVALID_ARGUMENT:return ho.INVALID_ARGUMENT;case wd.NOT_FOUND:return ho.NOT_FOUND;case wd.ALREADY_EXISTS:return ho.ALREADY_EXISTS;case wd.PERMISSION_DENIED:return ho.PERMISSION_DENIED;case wd.FAILED_PRECONDITION:return ho.FAILED_PRECONDITION;case wd.ABORTED:return ho.ABORTED;case wd.OUT_OF_RANGE:return ho.OUT_OF_RANGE;case wd.UNIMPLEMENTED:return ho.UNIMPLEMENTED;case wd.DATA_LOSS:return ho.DATA_LOSS;default:return co()}}(Sd=wd||(wd={}))[Sd.OK=0]="OK",Sd[Sd.CANCELLED=1]="CANCELLED",Sd[Sd.UNKNOWN=2]="UNKNOWN",Sd[Sd.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Sd[Sd.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Sd[Sd.NOT_FOUND=5]="NOT_FOUND",Sd[Sd.ALREADY_EXISTS=6]="ALREADY_EXISTS",Sd[Sd.PERMISSION_DENIED=7]="PERMISSION_DENIED",Sd[Sd.UNAUTHENTICATED=16]="UNAUTHENTICATED",Sd[Sd.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Sd[Sd.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Sd[Sd.ABORTED=10]="ABORTED",Sd[Sd.OUT_OF_RANGE=11]="OUT_OF_RANGE",Sd[Sd.UNIMPLEMENTED=12]="UNIMPLEMENTED",Sd[Sd.INTERNAL=13]="INTERNAL",Sd[Sd.UNAVAILABLE=14]="UNAVAILABLE",Sd[Sd.DATA_LOSS=15]="DATA_LOSS";let Cd=null;function Rd(){return new TextEncoder}const Id=new Ua([4294967295,4294967295],0);function Ad(e){const t=Rd().encode(e),n=new Va;return n.update(t),new Uint8Array(n.digest())}function Od(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),i=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new Ua([n,s],0),new Ua([i,r],0)]}class kd{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Dd("Invalid padding: ".concat(t));if(n<0)throw new Dd("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new Dd("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new Dd("Invalid padding when bitmap length is 0: ".concat(t));this.Ie=8*e.length-t,this.Te=Ua.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(Ua.fromNumber(n)));return 1===s.compare(Id)&&(s=new Ua([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Ad(e),[n,s]=Od(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,s,i);if(!this.de(e))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),r=new kd(i,s,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.Ie)return;const t=Ad(e),[n,s]=Od(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,s,i);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Dd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Pd{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,jd.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Pd(Ro.min(),s,new tc(No),Il(),Ul())}}class jd{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new jd(n,t,Ul(),Ul(),Ul())}}class Ld{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class Md{constructor(e,t){this.targetId=e,this.me=t}}class Ud{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cc.EMPTY_BYTE_STRING,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Vd{constructor(){this.fe=0,this.ge=Gd(),this.pe=cc.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=Ul(),t=Ul(),n=Ul();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:co()}}),new jd(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=Gd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,lo(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Fd{constructor(e){this.Le=e,this.Be=new Map,this.ke=Il(),this.qe=Bd(),this.Qe=new tc(No)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:co()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const i=s.target;if(ll(i))if(0===n){const e=new Do(i.path);this.Ue(t,e,Lc.newNoDocument(e,Ro.min()))}else lo(1===n);else{const s=this.Ye(t);if(s!==n){const n=this.Ze(e),i=n?this.Xe(n,e,s):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==Cd||Cd.et(function(e,t,n,s,i){var r,a,o,c,l,d;const u={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(u.bloomFilter={applied:0===i,hashCount:null!==(r=null==h?void 0:h.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(c=null===(o=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==c?c:0,padding:null!==(d=null===(l=null==h?void 0:h.bits)||void 0===l?void 0:l.padding)&&void 0!==d?d:0,mightContain:e=>{var t;return null!==(t=null==s?void 0:s.mightContain(e))&&void 0!==t&&t}}),u}(s,e.me,this.Le.tt(),n,i))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let r,a;try{r=hc(n).toUint8Array()}catch(e){if(e instanceof oc)return ao("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new kd(r,s,i)}catch(e){return ao(e instanceof Dd?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(n=>{const i=this.Le.tt(),r="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(r)||(this.Ue(t,n,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((n,s)=>{const i=this.Je(s);if(i){if(n.current&&ll(i.target)){const t=new Do(i.target.path);null!==this.ke.get(t)||this.it(s,t)||this.Ue(s,t,Lc.newNoDocument(t,e))}n.be&&(t.set(s,n.Ce()),n.ve())}});let n=Ul();this.qe.forEach((e,t)=>{let s=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)}),s&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));const s=new Pd(e,t,this.Qe,this.ke,n);return this.ke=Il(),this.qe=Bd(),this.Qe=new tc(No),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Vd,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ic(No),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||io("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Vd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Bd(){return new tc(Do.comparator)}function Gd(){return new tc(Do.comparator)}const Wd={asc:"ASCENDING",desc:"DESCENDING"},Hd={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kd={and:"AND",or:"OR"};class zd{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function qd(e,t){return e.useProto3Json||zo(t)?t:{value:t}}function Yd(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Xd(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Jd(e,t){return Yd(e,t.toTimestamp())}function Qd(e){return lo(!!e),Ro.fromTimestamp(function(e){const t=dc(e);return new Co(t.seconds,t.nanos)}(e))}function Zd(e,t){return $d(e,t).canonicalString()}function $d(e,t){const n=function(e){return new Ao(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function eu(e){const t=Ao.fromString(e);return lo(Eu(t)),t}function tu(e,t){return Zd(e.databaseId,t.path)}function nu(e,t){const n=eu(t);if(n.get(1)!==e.databaseId.projectId)throw new po(ho.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new po(ho.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Do(au(n))}function su(e,t){return Zd(e.databaseId,t)}function iu(e){const t=eu(e);return 4===t.length?Ao.emptyPath():au(t)}function ru(e){return new Ao(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function au(e){return lo(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ou(e,t,n){return{name:tu(e,t),fields:n.value.mapValue.fields}}function cu(e,t){let n;if(t instanceof hd)n={update:ou(e,t.key,t.value)};else if(t instanceof yd)n={delete:tu(e,t.key)};else if(t instanceof pd)n={update:ou(e,t.key,t.data),updateMask:_u(t.fieldMask)};else{if(!(t instanceof vd))return co();n={verify:tu(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Yl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Xl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ql)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof $l)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw co()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Jd(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:co()}(e,t.precondition)),n}function lu(e,t){return{documents:[su(e,t.path)]}}function du(e,t){const n={structuredQuery:{}},s=t.path;let i;null!==t.collectionGroup?(i=s,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=su(e,i);const r=function(e){if(0!==e.length)return vu(Hc.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:gu(e.field),direction:pu(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=qd(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i}}function uu(e){let t=iu(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){lo(1===s);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=hu(e);return t instanceof Hc&&zc(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new Fc(yu(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,zo(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Mc(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new Mc(n,t)}(n.endAt)),ul(t,i,a,r,o,"F",c,l)}function hu(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=yu(e.unaryFilter.field);return Wc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=yu(e.unaryFilter.field);return Wc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=yu(e.unaryFilter.field);return Wc.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=yu(e.unaryFilter.field);return Wc.create(i,"!=",{nullValue:"NULL_VALUE"});default:return co()}}(e):void 0!==e.fieldFilter?function(e){return Wc.create(yu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return co()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Hc.create(e.compositeFilter.filters.map(e=>hu(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return co()}}(e.compositeFilter.op))}(e):co()}function pu(e){return Wd[e]}function mu(e){return Hd[e]}function fu(e){return Kd[e]}function gu(e){return{fieldPath:e.canonicalString()}}function yu(e){return ko.fromServerFormat(e.fieldPath)}function vu(e){return e instanceof Wc?function(e){if("=="===e.op){if(Ac(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NAN"}};if(Ic(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ac(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NOT_NAN"}};if(Ic(e.value))return{unaryFilter:{field:gu(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gu(e.field),op:mu(e.op),value:e.value}}}(e):e instanceof Hc?function(e){const t=e.getFilters().map(e=>vu(e));return 1===t.length?t[0]:{compositeFilter:{op:fu(e.op),filters:t}}}(e):co()}function _u(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Eu(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class bu{constructor(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ro.min(),r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ro.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:cc.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new bu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new bu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class xu{constructor(e){this.ct=e}}function wu(e){const t=uu({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?_l(t,t.limit,"L"):t}class Su{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(uc(e.integerValue));else if("doubleValue"in e){const n=uc(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),qo(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=dc(n)),t.At("".concat(n.seconds||"")),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(hc(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Dc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):co()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const s of Object.keys(n))this.Rt(s,t),this.It(n[s],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const s of n)this.It(s,t)}gt(e,t){this.Et(t,37),Do.fromName(e).path.forEach(e=>{this.Et(t,60),this.St(e,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}Su.bt=new Su;class Nu{constructor(){this._n=new Tu}addToCollectionParentIndex(e,t){return this._n.add(t),Go.resolve()}getCollectionParents(e,t){return Go.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Go.resolve()}deleteFieldIndex(e,t){return Go.resolve()}deleteAllFieldIndexes(e){return Go.resolve()}createTargetIndexes(e,t){return Go.resolve()}getDocumentsMatchingTarget(e,t){return Go.resolve(null)}getIndexType(e,t){return Go.resolve(0)}getFieldIndexes(e,t){return Go.resolve([])}getNextCollectionGroupToUpdate(e){return Go.resolve(null)}getMinOffset(e,t){return Go.resolve(Mo.min())}getMinOffsetFromCollectionGroup(e,t){return Go.resolve(Mo.min())}updateCollectionGroup(e,t,n){return Go.resolve()}updateIndexEntries(e,t){return Go.resolve()}}class Tu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new ic(Ao.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new ic(Ao.comparator)).toArray()}}new Uint8Array(0);class Cu{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Cu(e,Cu.DEFAULT_COLLECTION_PERCENTILE,Cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Cu.DEFAULT_COLLECTION_PERCENTILE=10,Cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Cu.DEFAULT=new Cu(41943040,Cu.DEFAULT_COLLECTION_PERCENTILE,Cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Cu.DISABLED=new Cu(-1,0,0);class Ru{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Ru(0)}static Ln(){return new Ru(-1)}}class Iu{constructor(){this.changes=new Cl(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Lc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Go.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Au{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ou{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ld(n.mutation,e,ac.empty(),Co.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Ul()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ul();const s=Dl();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(e=>{let t=Ol();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Dl();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ul()))}populateOverlays(e,t,n){const s=[];return n.forEach(e=>{t.has(e)||s.push(e)}),this.documentOverlayCache.getOverlays(e,s).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,s){let i=Il();const r=jl(),a=jl();return t.forEach((e,t)=>{const a=n.get(t.key);s.has(t.key)&&(void 0===a||a.mutation instanceof pd)?i=i.insert(t.key,t):void 0!==a?(r.set(t.key,a.mutation.getFieldMask()),ld(a.mutation,t,a.mutation.getFieldMask(),Co.now())):r.set(t.key,ac.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>r.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new Au(t,null!==(n=r.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=jl();let s=new tc((e,t)=>e-t),i=Ul();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const r=t.get(e);if(null===r)return;let a=n.get(e)||ac.empty();a=i.applyToLocalView(r,a),n.set(e,a);const o=(s.get(i.batchId)||Ul()).add(e);s=s.insert(i.batchId,o)})}).next(()=>{const r=[],a=s.getReverseIterator();for(;a.hasNext();){const s=a.getNext(),o=s.key,c=s.value,l=Pl();c.forEach(e=>{if(!i.has(e)){const s=od(t.get(e),n.get(e));null!==s&&l.set(e,s),i=i.add(e)}}),r.push(this.documentOverlayCache.saveOverlays(e,o,l))}return Go.waitFor(r)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,s){return function(e){return Do.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ml(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):Go.resolve(Dl());let a=-1,o=i;return r.next(t=>Go.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?Go.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,Ul())).next(e=>({batchId:a,changes:kl(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Do(t)).next(e=>{let t=Ol();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let r=Ol();return this.indexManager.getCollectionParents(e,i).next(a=>Go.forEach(a,a=>{const o=function(e,t){return new dl(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,s).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(e=>{i.forEach((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,Lc.newInvalidDocument(s)))});let n=Ol();return e.forEach((e,s)=>{const r=i.get(e);void 0!==r&&ld(r.mutation,s,ac.empty(),Co.now()),wl(t,s)&&(n=n.insert(e,s))}),n})}}class ku{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Go.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Qd(e.createTime)}}(t)),Go.resolve()}getNamedQuery(e,t){return Go.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:wu(e.bundledQuery),readTime:Qd(e.readTime)}}(t)),Go.resolve()}}class Du{constructor(){this.overlays=new tc(Do.comparator),this.hr=new Map}getOverlay(e,t){return Go.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Dl();return Go.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,s)=>{this.ht(e,t,s)}),Go.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.hr.get(n);return void 0!==s&&(s.forEach(e=>this.overlays=this.overlays.remove(e)),this.hr.delete(n)),Go.resolve()}getOverlaysForCollection(e,t,n){const s=Dl(),i=t.length+1,r=new Do(t.child("")),a=this.overlays.getIteratorFrom(r);for(;a.hasNext();){const e=a.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===i&&e.largestBatchId>n&&s.set(e.getKey(),e)}return Go.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new tc((e,t)=>e-t);const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Dl(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Dl(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=s)););return Go.resolve(a)}ht(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.hr.get(s.largestBatchId).delete(n.key);this.hr.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new bd(t,n));let i=this.hr.get(t);void 0===i&&(i=Ul(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class Pu{constructor(){this.Pr=new ic(ju.Ir),this.Tr=new ic(ju.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new ju(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Ar(new ju(e,t))}Rr(e,t){e.forEach(e=>this.removeReference(e,t))}Vr(e){const t=new Do(new Ao([])),n=new ju(t,e),s=new ju(t,e+1),i=[];return this.Tr.forEachInRange([n,s],e=>{this.Ar(e),i.push(e.key)}),i}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new Do(new Ao([])),n=new ju(t,e),s=new ju(t,e+1);let i=Ul();return this.Tr.forEachInRange([n,s],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new ju(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ju{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return Do.comparator(e.key,t.key)||No(e.pr,t.pr)}static Er(e,t){return No(e.pr,t.pr)||Do.comparator(e.key,t.key)}}class Lu{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new ic(ju.Ir)}checkEmpty(e){return Go.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new _d(i,t,n,s);this.mutationQueue.push(r);for(const a of s)this.wr=this.wr.add(new ju(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Go.resolve(r)}lookupMutationBatch(e,t){return Go.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.br(n),i=s<0?0:s;return Go.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Go.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Go.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ju(t,0),s=new ju(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,s],e=>{const t=this.Sr(e.pr);i.push(t)}),Go.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ic(No);return t.forEach(e=>{const t=new ju(e,0),s=new ju(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,s],e=>{n=n.add(e.pr)})}),Go.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;Do.isDocumentKey(i)||(i=i.child(""));const r=new ju(new Do(i),0);let a=new ic(No);return this.wr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(a=a.add(e.pr)),!0)},r),Go.resolve(this.Dr(a))}Dr(e){const t=[];return e.forEach(e=>{const n=this.Sr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){lo(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Go.forEach(t.mutations,s=>{const i=new ju(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){const n=new ju(t,0),s=this.wr.firstAfterOrEqual(n);return Go.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,Go.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Mu{constructor(e){this.vr=e,this.docs=new tc(Do.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,r=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Go.resolve(n?n.document.mutableCopy():Lc.newInvalidDocument(t))}getEntries(e,t){let n=Il();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Lc.newInvalidDocument(e))}),Go.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=Il();const r=t.path,a=new Do(r.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||Uo(Lo(a),n)<=0||(s.has(a.key)||wl(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return Go.resolve(i)}getAllFromCollectionGroup(e,t,n,s){co()}Fr(e,t){return Go.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Uu(this)}getSize(e){return Go.resolve(this.size)}}class Uu extends Iu{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.ar.addEntry(e,s)):this.ar.removeEntry(n)}),Go.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Vu{constructor(e){this.persistence=e,this.Mr=new Cl(e=>ol(e),cl),this.lastRemoteSnapshotVersion=Ro.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Pu,this.targetCount=0,this.Lr=Ru.Nn()}forEachTarget(e,t){return this.Mr.forEach((e,n)=>t(n)),Go.resolve()}getLastRemoteSnapshotVersion(e){return Go.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Go.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),Go.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Go.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new Ru(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Go.resolve()}updateTargetData(e,t){return this.qn(t),Go.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Go.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Mr.forEach((r,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Mr.delete(r),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),Go.waitFor(i).next(()=>s)}getTargetCount(e){return Go.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Go.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Go.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(t=>{i.push(s.markPotentiallyOrphaned(e,t))}),Go.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Go.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Go.resolve(n)}containsKey(e,t){return Go.resolve(this.Nr.containsKey(t))}}class Fu{constructor(e,t){this.Br={},this.overlays={},this.kr=new Ko(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Vu(this),this.indexManager=new Nu,this.remoteDocumentCache=function(e){return new Mu(e)}(e=>this.referenceDelegate.Kr(e)),this.serializer=new xu(t),this.$r=new ku(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Du,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new Lu(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){io("MemoryPersistence","Starting transaction:",e);const s=new Bu(this.kr.next());return this.referenceDelegate.Ur(),n(s).next(e=>this.referenceDelegate.Wr(s).next(()=>e)).toPromise().then(e=>(s.raiseOnCommittedEvent(),e))}Gr(e,t){return Go.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}}class Bu extends Fo{constructor(e){super(),this.currentSequenceNumber=e}}class Gu{constructor(e){this.persistence=e,this.zr=new Pu,this.jr=null}static Hr(e){return new Gu(e)}get Jr(){if(this.jr)return this.jr;throw co()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Go.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Go.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Go.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(e=>this.Jr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Jr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Go.forEach(this.Jr,n=>{const s=Do.fromPath(n);return this.Yr(e,s).next(e=>{e||t.removeEntry(s,Ro.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return Go.or([()=>Go.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Wu{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=s}static Ki(e,t){let n=Ul(),s=Ul();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Wu(e,t.fromCache,n,s)}}class Hu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ku{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=Ot()?8:Wo(At())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.ji(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Hi(e,t,s,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new Hu;return this.Ji(e,t,n).next(s=>{if(i.result=s,this.Ui)return this.Yi(e,t,n,s.size)})}).next(()=>i.result)}Yi(e,t,n,s){return n.documentReadCount<this.Wi?(so()<=Xt.DEBUG&&io("QueryEngine","SDK will not create cache indexes for query:",xl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Go.resolve()):(so()<=Xt.DEBUG&&io("QueryEngine","Query:",xl(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Gi*s?(so()<=Xt.DEBUG&&io("QueryEngine","The SDK decides to create cache indexes for query:",xl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,gl(t))):Go.resolve())}ji(e,t){if(pl(t))return Go.resolve(null);let n=gl(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=_l(t,null,"F"),n=gl(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const i=Ul(...s);return this.zi.getDocuments(e,i).next(s=>this.indexManager.getMinOffset(e,n).next(n=>{const r=this.Zi(t,s);return this.Xi(t,r,i,n.readTime)?this.ji(e,_l(t,null,"F")):this.es(e,r,t,n)}))})))}Hi(e,t,n,s){return pl(t)||s.isEqual(Ro.min())?Go.resolve(null):this.zi.getDocuments(e,n).next(i=>{const r=this.Zi(t,i);return this.Xi(t,r,n,s)?Go.resolve(null):(so()<=Xt.DEBUG&&io("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),xl(t)),this.es(e,r,t,jo(s,-1)).next(e=>e))})}Zi(e,t){let n=new ic(Nl(e));return t.forEach((t,s)=>{wl(e,s)&&(n=n.add(s))}),n}Xi(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ji(e,t,n){return so()<=Xt.DEBUG&&io("QueryEngine","Using full collection scan to execute query:",xl(t)),this.zi.getDocumentsMatchingQuery(e,t,Mo.min(),n)}es(e,t,n,s){return this.zi.getDocumentsMatchingQuery(e,n,s).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class zu{constructor(e,t,n,s){this.persistence=e,this.ts=t,this.serializer=s,this.ns=new tc(No),this.rs=new Cl(e=>ol(e),cl),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ou(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function qu(e,t,n,s){return new zu(e,t,n,s)}async function Yu(e,t){const n=uo(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next(i=>(s=i,n._s(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],r=[];let a=Ul();for(const e of s){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({us:e,removedBatchIds:i,addedBatchIds:r}))})})}function Xu(e){const t=uo(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function Ju(e,t,n){let s=Ul(),i=Ul();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=Il();return n.forEach((n,r)=>{const a=e.get(n);r.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(Ro.min())?(t.removeEntry(n,r.readTime),s=s.insert(n,r)):!a.isValidDocument()||r.version.compareTo(a.version)>0||0===r.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(r),s=s.insert(n,r)):io("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",r.version)}),{cs:s,ls:i}})}function Qu(e,t){const n=uo(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Zu(e,t){const n=uo(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let s;return n.Qr.getTargetData(e,t).next(i=>i?(s=i,Go.resolve(s)):n.Qr.allocateTargetId(e).next(i=>(s=new bu(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,s).next(()=>s))))}).then(e=>{const s=n.ns.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e})}async function $u(e,t,n){const s=uo(e),i=s.ns.get(t),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,e=>s.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Ho(e))throw e;io("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}s.ns=s.ns.remove(t),s.rs.delete(i.target)}function eh(e,t,n){const s=uo(e);let i=Ro.min(),r=Ul();return s.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const s=uo(e),i=s.rs.get(n);return void 0!==i?Go.resolve(s.ns.get(i)):s.Qr.getTargetData(t,n)}(s,e,gl(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,s.Qr.getMatchingKeysForTargetId(e,t.targetId).next(e=>{r=e})}).next(()=>s.ts.getDocumentsMatchingQuery(e,t,n?i:Ro.min(),n?r:Ul())).next(e=>(th(s,Sl(t),e),{documents:e,hs:r})))}function th(e,t,n){let s=e.ss.get(t)||Ro.min();n.forEach((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)}),e.ss.set(t,s)}class nh{constructor(){this.activeTargetIds=Fl()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sh{constructor(){this.no=new nh,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new nh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ih{io(e){}shutdown(){}}class rh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){io("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){io("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ah=null;function oh(){return null===ah?ah=268435456+Math.round(2147483648*Math.random()):ah++,"0x"+ah.toString(16)}const ch={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lh{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const dh="WebChannelConnection";class uh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=t+"://"+e.host,this.So="projects/".concat(n,"/databases/").concat(s),this.bo="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(s)}get Do(){return!1}Co(e,t,n,s,i){const r=oh(),a=this.vo(e,t.toUriEncodedString());io("RestConnection","Sending RPC '".concat(e,"' ").concat(r,":"),a,n);const o={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(o,s,i),this.Mo(e,a,o,n).then(t=>(io("RestConnection","Received RPC '".concat(e,"' ").concat(r,": "),t),t),t=>{throw ao("RestConnection","RPC '".concat(e,"' ").concat(r," failed with error: "),t,"url: ",a,"request:",n),t})}xo(e,t,n,s,i,r){return this.Co(e,t,n,s,i)}Fo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+to,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}vo(e,t){const n=ch[e];return"".concat(this.wo,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,s){const i=oh();return new Promise((r,a)=>{const o=new Ga;o.setWithCredentials(!0),o.listenOnce(Ka.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case za.NO_ERROR:const t=o.getResponseJson();io(dh,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),r(t);break;case za.TIMEOUT:io(dh,"RPC '".concat(e,"' ").concat(i," timed out")),a(new po(ho.DEADLINE_EXCEEDED,"Request time out"));break;case za.HTTP_ERROR:const n=o.getStatus();if(io(dh,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(ho).indexOf(t)>=0?t:ho.UNKNOWN}(t.status);a(new po(e,t.message))}else a(new po(ho.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new po(ho.UNAVAILABLE,"Connection failed."));break;default:co()}}finally{io(dh,"RPC '".concat(e,"' ").concat(i," completed."))}});const c=JSON.stringify(s);io(dh,"RPC '".concat(e,"' ").concat(i," sending request:"),s),o.send(t,"POST",c,n,15)})}Oo(e,t,n){const s=oh(),i=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=Ja(),a=Xa(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(o.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(o.xmlHttpFactory=new Wa({})),this.Fo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const l=i.join("");io(dh,"Creating RPC '".concat(e,"' stream ").concat(s,": ").concat(l),o);const d=r.createWebChannel(l,o);let u=!1,h=!1;const p=new lh({lo:t=>{h?io(dh,"Not sending because RPC '".concat(e,"' stream ").concat(s," is closed:"),t):(u||(io(dh,"Opening RPC '".concat(e,"' stream ").concat(s," transport.")),d.open(),u=!0),io(dh,"RPC '".concat(e,"' stream ").concat(s," sending:"),t),d.send(t))},ho:()=>d.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(d,Ha.EventType.OPEN,()=>{h||(io(dh,"RPC '".concat(e,"' stream ").concat(s," transport opened.")),p.mo())}),m(d,Ha.EventType.CLOSE,()=>{h||(h=!0,io(dh,"RPC '".concat(e,"' stream ").concat(s," transport closed")),p.po())}),m(d,Ha.EventType.ERROR,t=>{h||(h=!0,ao(dh,"RPC '".concat(e,"' stream ").concat(s," transport errored:"),t),p.po(new po(ho.UNAVAILABLE,"The operation could not be completed")))}),m(d,Ha.EventType.MESSAGE,t=>{var n;if(!h){const i=t.data[0];lo(!!i);const r=i,a=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(a){io(dh,"RPC '".concat(e,"' stream ").concat(s," received error:"),a);const t=a.status;let n=function(e){const t=wd[e];if(void 0!==t)return Td(t)}(t),i=a.message;void 0===n&&(n=ho.INTERNAL,i="Unknown error status: "+t+" with message "+a.message),h=!0,p.po(new po(n,i)),d.close()}else io(dh,"RPC '".concat(e,"' stream ").concat(s," received:"),i),p.yo(i)}}),m(a,Ya.STAT_EVENT,t=>{t.stat===qa.PROXY?io(dh,"RPC '".concat(e,"' stream ").concat(s," detected buffering proxy")):t.stat===qa.NOPROXY&&io(dh,"RPC '".concat(e,"' stream ").concat(s," detected no buffering proxy"))}),setTimeout(()=>{p.fo()},0),p}}function hh(){return"undefined"!=typeof document?document:null}function ph(e){return new zd(e,!0)}class mh{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.oi=e,this.timerId=t,this.No=n,this.Lo=s,this.Bo=i,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),s=Math.max(0,t-n);s>0&&io("ExponentialBackoff","Backing off for ".concat(s," ms (base delay: ").concat(this.ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.qo=this.oi.enqueueAfterDelay(this.timerId,s,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class fh{constructor(e,t,n,s,i,r,a,o){this.oi=e,this.Go=n,this.zo=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new mh(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(e,t){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==e?this.Yo.reset():t&&t.code===ho.RESOURCE_EXHAUSTED?(ro(t.toString()),ro("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===ho.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ao(t)}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,s]=e;this.jo===t&&this.u_(n,s)},t=>{e(()=>{const e=new po(ho.UNKNOWN,"Fetching auth token failed: "+t.message);return this.c_(e)})})}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(e=>{n(()=>this.c_(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}e_(){this.state=5,this.Yo.$o(async()=>{this.state=0,this.start()})}c_(e){return io("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(io("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gh extends fh{constructor(e,t,n,s,i,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const s=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:co()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(lo(void 0===t||"string"==typeof t),cc.fromBase64String(t||"")):(lo(void 0===t||t instanceof Buffer||t instanceof Uint8Array),cc.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?ho.UNKNOWN:Td(e.code);return new po(t,e.message||"")}(a);n=new Ud(s,i,r,o||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const i=nu(e,s.document.name),r=Qd(s.document.updateTime),a=s.document.createTime?Qd(s.document.createTime):Ro.min(),o=new Pc({mapValue:{fields:s.document.fields}}),c=Lc.newFoundDocument(i,r,a,o),l=s.targetIds||[],d=s.removedTargetIds||[];n=new Ld(l,d,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const i=nu(e,s.document),r=s.readTime?Qd(s.readTime):Ro.min(),a=Lc.newNoDocument(i,r),o=s.removedTargetIds||[];n=new Ld([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const i=nu(e,s.document),r=s.removedTargetIds||[];n=new Ld([],r,i,null)}else{if(!("filter"in t))return co();{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:i}=e,r=new xd(s,i),a=e.targetId;n=new Md(a,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Ro.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ro.min():t.readTime?Qd(t.readTime):Ro.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=ru(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=ll(s)?{documents:lu(e,s)}:{query:du(e,s)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Xd(e,t.resumeToken);const s=qd(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(Ro.min())>0){n.readTime=Yd(e,t.snapshotVersion.toTimestamp());const s=qd(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return co()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=ru(this.serializer),t.removeTarget=e,this.i_(t)}}class yh extends fh{constructor(e,t,n,s,i,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(lo(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function(e,t){return e&&e.length>0?(lo(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?Qd(e.updateTime):Qd(t);return n.isEqual(Ro.min())&&(n=Qd(t)),new sd(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Qd(e.commitTime);return this.listener.A_(n,t)}return lo(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=ru(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>cu(this.serializer,e))};this.i_(t)}}class vh extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.m_=!1}f_(){if(this.m_)throw new po(ho.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[r,a]=i;return this.connection.Co(e,$d(t,n),s,r,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===ho.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new po(ho.UNKNOWN,e.toString())})}xo(e,t,n,s,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(r=>{let[a,o]=r;return this.connection.xo(e,$d(t,n),s,a,o,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===ho.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new po(ho.UNKNOWN,e.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class _h{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.y_?(ro(t),this.y_=!1):io("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Eh{constructor(e,t,n,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=i,this.O_.io(e=>{n.enqueueAndForget(async()=>{Ih(this)&&(io("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=uo(e);t.M_.add(4),await xh(t),t.N_.set("Unknown"),t.M_.delete(4),await bh(t)}(this))})}),this.N_=new _h(n,s)}}async function bh(e){if(Ih(e))for(const t of e.x_)await t(!0)}async function xh(e){for(const t of e.x_)await t(!1)}function wh(e,t){const n=uo(e);n.F_.has(t.targetId)||(n.F_.set(t.targetId,t),Rh(n)?Ch(n):Yh(n).Xo()&&Nh(n,t))}function Sh(e,t){const n=uo(e),s=Yh(n);n.F_.delete(t),s.Xo()&&Th(n,t),0===n.F_.size&&(s.Xo()?s.n_():Ih(n)&&n.N_.set("Unknown"))}function Nh(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Ro.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Yh(e).P_(t)}function Th(e,t){e.L_.xe(t),Yh(e).I_(t)}function Ch(e){e.L_=new Fd({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.F_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),Yh(e).start(),e.N_.w_()}function Rh(e){return Ih(e)&&!Yh(e).Zo()&&e.F_.size>0}function Ih(e){return 0===uo(e).M_.size}function Ah(e){e.L_=void 0}async function Oh(e){e.N_.set("Online")}async function kh(e){e.F_.forEach((t,n)=>{Nh(e,t)})}async function Dh(e,t){Ah(e),Rh(e)?(e.N_.D_(t),Ch(e)):e.N_.set("Unknown")}async function Ph(e,t,n){if(e.N_.set("Online"),t instanceof Ud&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.F_.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.F_.delete(s),e.L_.removeTarget(s))}(e,t)}catch(n){io("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await jh(e,n)}else if(t instanceof Ld?e.L_.Ke(t):t instanceof Md?e.L_.He(t):e.L_.We(t),!n.isEqual(Ro.min()))try{const t=await Xu(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.L_.rt(t);return n.targetChanges.forEach((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.F_.get(s);i&&e.F_.set(s,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const s=e.F_.get(t);if(!s)return;e.F_.set(t,s.withResumeToken(cc.EMPTY_BYTE_STRING,s.snapshotVersion)),Th(e,t);const i=new bu(s.target,t,n,s.sequenceNumber);Nh(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){io("RemoteStore","Failed to raise snapshot:",t),await jh(e,t)}}async function jh(e,t,n){if(!Ho(t))throw t;e.M_.add(1),await xh(e),e.N_.set("Offline"),n||(n=()=>Xu(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{io("RemoteStore","Retrying IndexedDB access"),await n(),e.M_.delete(1),await bh(e)})}function Lh(e,t){return t().catch(n=>jh(e,n,t))}async function Mh(e){const t=uo(e),n=Xh(t);let s=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;Uh(t);)try{const e=await Qu(t.localStore,s);if(null===e){0===t.v_.length&&n.n_();break}s=e.batchId,Vh(t,e)}catch(e){await jh(t,e)}Fh(t)&&Bh(t)}function Uh(e){return Ih(e)&&e.v_.length<10}function Vh(e,t){e.v_.push(t);const n=Xh(e);n.Xo()&&n.E_&&n.d_(t.mutations)}function Fh(e){return Ih(e)&&!Xh(e).Zo()&&e.v_.length>0}function Bh(e){Xh(e).start()}async function Gh(e){Xh(e).V_()}async function Wh(e){const t=Xh(e);for(const n of e.v_)t.d_(n.mutations)}async function Hh(e,t,n){const s=e.v_.shift(),i=Ed.from(s,t,n);await Lh(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await Mh(e)}async function Kh(e,t){t&&Xh(e).E_&&await async function(e,t){if(function(e){return Nd(e)&&e!==ho.ABORTED}(t.code)){const n=e.v_.shift();Xh(e).t_(),await Lh(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Mh(e)}}(e,t),Fh(e)&&Bh(e)}async function zh(e,t){const n=uo(e);n.asyncQueue.verifyOperationInProgress(),io("RemoteStore","RemoteStore received new credentials");const s=Ih(n);n.M_.add(3),await xh(n),s&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.M_.delete(3),await bh(n)}async function qh(e,t){const n=uo(e);t?(n.M_.delete(2),await bh(n)):t||(n.M_.add(2),await xh(n),n.N_.set("Unknown"))}function Yh(e){return e.B_||(e.B_=function(e,t,n){const s=uo(e);return s.f_(),new gh(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Po:Oh.bind(null,e),To:kh.bind(null,e),Ao:Dh.bind(null,e),h_:Ph.bind(null,e)}),e.x_.push(async t=>{t?(e.B_.t_(),Rh(e)?Ch(e):e.N_.set("Unknown")):(await e.B_.stop(),Ah(e))})),e.B_}function Xh(e){return e.k_||(e.k_=function(e,t,n){const s=uo(e);return s.f_(),new yh(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Po:()=>Promise.resolve(),To:Gh.bind(null,e),Ao:Kh.bind(null,e),R_:Wh.bind(null,e),A_:Hh.bind(null,e)}),e.x_.push(async t=>{t?(e.k_.t_(),await Mh(e)):(await e.k_.stop(),e.v_.length>0&&(io("RemoteStore","Stopping write stream with ".concat(e.v_.length," pending writes")),e.v_=[]))})),e.k_}class Jh{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new mo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const r=Date.now()+n,a=new Jh(e,t,r,s,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new po(ho.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qh(e,t){if(ro("AsyncQueue","".concat(t,": ").concat(e)),Ho(e))return new po(ho.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Zh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Do.comparator(t.key,n.key):(e,t)=>Do.comparator(e.key,t.key),this.keyedMap=Ol(),this.sortedSet=new tc(this.comparator)}static emptySet(e){return new Zh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Zh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Zh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class $h{constructor(){this.q_=new tc(Do.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):co():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ep{constructor(e,t,n,s,i,r,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,i){const r=[];return t.forEach(e=>{r.push({type:0,doc:e})}),new ep(e,t,Zh.emptySet(t),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&El(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class tp{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class np{constructor(){this.queries=new Cl(e=>bl(e),El),this.onlineState="Unknown",this.z_=new Set}}async function sp(e,t){const n=uo(e);let s=3;const i=t.query;let r=n.queries.get(i);r?!r.W_()&&t.G_()&&(s=2):(r=new tp,s=t.G_()?0:1);try{switch(s){case 0:r.K_=await n.onListen(i,!0);break;case 1:r.K_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Qh(e,"Initialization of query '".concat(xl(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,r),r.U_.push(t),t.j_(n.onlineState),r.K_&&t.H_(r.K_)&&op(n)}async function ip(e,t){const n=uo(e),s=t.query;let i=3;const r=n.queries.get(s);if(r){const e=r.U_.indexOf(t);e>=0&&(r.U_.splice(e,1),0===r.U_.length?i=t.G_()?0:1:!r.W_()&&t.G_()&&(i=2))}switch(i){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}function rp(e,t){const n=uo(e);let s=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.U_)e.H_(i)&&(s=!0);t.K_=i}}s&&op(n)}function ap(e,t,n){const s=uo(e),i=s.queries.get(t);if(i)for(const r of i.U_)r.onError(n);s.queries.delete(t)}function op(e){e.z_.forEach(e=>{e.next()})}var cp,lp;(lp=cp||(cp={})).J_="default",lp.Cache="cache";class dp{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ep(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==t;return(!this.options.ra||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){if(e.docChanges.length>0)return!0;const t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}na(e){e=ep.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==cp.Cache}}class up{constructor(e){this.key=e}}class hp{constructor(e){this.key=e}}class pp{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=Ul(),this.mutatedKeys=Ul(),this.Ia=Nl(e),this.Ta=new Zh(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new $h,s=t?t.Ta:this.Ta;let i=t?t.mutatedKeys:this.mutatedKeys,r=s,a=!1;const o="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((e,t)=>{const l=s.get(e),d=wl(this.query,t)?t:null,u=!!l&&this.mutatedKeys.has(l.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let p=!1;l&&d?l.data.isEqual(d.data)?u!==h&&(n.track({type:3,doc:d}),p=!0):this.Ra(l,d)||(n.track({type:2,doc:d}),p=!0,(o&&this.Ia(d,o)>0||c&&this.Ia(d,c)<0)&&(a=!0)):!l&&d?(n.track({type:0,doc:d}),p=!0):l&&!d&&(n.track({type:1,doc:l}),p=!0,(o||c)&&(a=!0)),p&&(d?(r=r.add(d),i=h?i.add(e):i.delete(e)):(r=r.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ta:r,Aa:n,Xi:a,mutatedKeys:i}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const r=e.Aa.Q_();r.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return co()}};return n(e)-n(t)}(e.type,t.type)||this.Ia(e.doc,t.doc)),this.Va(n),s=null!=s&&s;const a=t&&!s?this.ma():[],o=0===this.Pa.size&&this.current&&!s?1:0,c=o!==this.ha;return this.ha=o,0!==r.length||c?{snapshot:new ep(this.query,e.Ta,i,r,e.mutatedKeys,0===o,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new $h,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(e=>this.la=this.la.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=Ul(),this.Ta.forEach(e=>{this.ga(e.key)&&(this.Pa=this.Pa.add(e.key))});const t=[];return e.forEach(e=>{this.Pa.has(e)||t.push(new hp(e))}),this.Pa.forEach(n=>{e.has(n)||t.push(new up(n))}),t}pa(e){this.la=e.hs,this.Pa=Ul();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return ep.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class mp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fp{constructor(e){this.key=e,this.wa=!1}}class gp{constructor(e,t,n,s,i,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.Sa={},this.ba=new Cl(e=>bl(e),El),this.Da=new Map,this.Ca=new Set,this.va=new tc(Do.comparator),this.Fa=new Map,this.Ma=new Pu,this.xa={},this.Oa=new Map,this.Na=Ru.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function yp(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=Up(e);let i;const r=s.ba.get(t);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.ya()):i=await _p(s,t,n,!0),i}async function vp(e,t){const n=Up(e);await _p(n,t,!0,!1)}async function _p(e,t,n,s){const i=await Zu(e.localStore,gl(t)),r=i.targetId,a=n?e.sharedClientState.addLocalQueryTarget(r):"not-current";let o;return s&&(o=await Ep(e,t,r,"current"===a,i.resumeToken)),e.isPrimaryClient&&n&&wh(e.remoteStore,i),o}async function Ep(e,t,n,s,i){e.Ba=(t,n,s)=>async function(e,t,n,s){let i=t.view.da(n);i.Xi&&(i=await eh(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.da(n,i)}));const r=s&&s.targetChanges.get(t.targetId),a=s&&null!=s.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,r,a);return kp(e,t.targetId,o.fa),o.snapshot}(e,t,n,s);const r=await eh(e.localStore,t,!0),a=new pp(t,r.hs),o=a.da(r.documents),c=jd.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,i),l=a.applyChanges(o,e.isPrimaryClient,c);kp(e,n,l.fa);const d=new mp(t,n,a);return e.ba.set(t,d),e.Da.has(n)?e.Da.get(n).push(t):e.Da.set(n,[t]),l.snapshot}async function bp(e,t,n){const s=uo(e),i=s.ba.get(t),r=s.Da.get(i.targetId);if(r.length>1)return s.Da.set(i.targetId,r.filter(e=>!El(e,t))),void s.ba.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await $u(s.localStore,i.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(i.targetId),n&&Sh(s.remoteStore,i.targetId),Ap(s,i.targetId)}).catch(Bo)):(Ap(s,i.targetId),await $u(s.localStore,i.targetId,!0))}async function xp(e,t){const n=uo(e),s=n.ba.get(t),i=n.Da.get(s.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),Sh(n.remoteStore,s.targetId))}async function wp(e,t){const n=uo(e);try{const e=await function(e,t){const n=uo(e),s=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const r=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const a=[];t.targetChanges.forEach((r,o)=>{const c=i.get(o);if(!c)return;a.push(n.Qr.removeMatchingKeys(e,r.removedDocuments,o).next(()=>n.Qr.addMatchingKeys(e,r.addedDocuments,o)));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?l=l.withResumeToken(cc.EMPTY_BYTE_STRING,Ro.min()).withLastLimboFreeSnapshotVersion(Ro.min()):r.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(r.resumeToken,s)),i=i.insert(o,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,r)&&a.push(n.Qr.updateTargetData(e,l))});let o=Il(),c=Ul();if(t.documentUpdates.forEach(s=>{t.resolvedLimboDocuments.has(s)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))}),a.push(Ju(e,r,t.documentUpdates).next(e=>{o=e.cs,c=e.ls})),!s.isEqual(Ro.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next(t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,s));a.push(t)}return Go.waitFor(a).next(()=>r.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,c)).next(()=>o)}).then(e=>(n.ns=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const s=n.Fa.get(t);s&&(lo(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?s.wa=!0:e.modifiedDocuments.size>0?lo(s.wa):e.removedDocuments.size>0&&(lo(s.wa),s.wa=!1))}),await jp(n,e,t)}catch(e){await Bo(e)}}function Sp(e,t,n){const s=uo(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.ba.forEach((n,s)=>{const i=s.view.j_(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=uo(e);n.onlineState=t;let s=!1;n.queries.forEach((e,n)=>{for(const i of n.U_)i.j_(t)&&(s=!0)}),s&&op(n)}(s.eventManager,t),e.length&&s.Sa.h_(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function Np(e,t,n){const s=uo(e);s.sharedClientState.updateQueryState(t,"rejected",n);const i=s.Fa.get(t),r=i&&i.key;if(r){let e=new tc(Do.comparator);e=e.insert(r,Lc.newNoDocument(r,Ro.min()));const n=Ul().add(r),i=new Pd(Ro.min(),new Map,new tc(No),e,n);await wp(s,i),s.va=s.va.remove(r),s.Fa.delete(t),Pp(s)}else await $u(s.localStore,t,!1).then(()=>Ap(s,t,n)).catch(Bo)}async function Tp(e,t){const n=uo(e),s=t.batch.batchId;try{const e=await function(e,t){const n=uo(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const s=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const i=n.batch,r=i.keys();let a=Go.resolve();return r.forEach(e=>{a=a.next(()=>s.getEntry(t,e)).next(t=>{const r=n.docVersions.get(e);lo(null!==r),t.version.compareTo(r)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Ul();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,s))})}(n.localStore,t);Ip(n,s,null),Rp(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await jp(n,e)}catch(e){await Bo(e)}}async function Cp(e,t,n){const s=uo(e);try{const e=await function(e,t){const n=uo(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(lo(null!==t),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s)).next(()=>n.localDocuments.getDocuments(e,s))})}(s.localStore,t);Ip(s,t,n),Rp(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await jp(s,e)}catch(n){await Bo(n)}}function Rp(e,t){(e.Oa.get(t)||[]).forEach(e=>{e.resolve()}),e.Oa.delete(t)}function Ip(e,t,n){const s=uo(e);let i=s.xa[s.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),s.xa[s.currentUser.toKey()]=i}}function Ap(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Da.get(t))e.ba.delete(s),n&&e.Sa.ka(s,n);e.Da.delete(t),e.isPrimaryClient&&e.Ma.Vr(t).forEach(t=>{e.Ma.containsKey(t)||Op(e,t)})}function Op(e,t){e.Ca.delete(t.path.canonicalString());const n=e.va.get(t);null!==n&&(Sh(e.remoteStore,n),e.va=e.va.remove(t),e.Fa.delete(n),Pp(e))}function kp(e,t,n){for(const s of n)s instanceof up?(e.Ma.addReference(s.key,t),Dp(e,s)):s instanceof hp?(io("SyncEngine","Document no longer in limbo: "+s.key),e.Ma.removeReference(s.key,t),e.Ma.containsKey(s.key)||Op(e,s.key)):co()}function Dp(e,t){const n=t.key,s=n.path.canonicalString();e.va.get(n)||e.Ca.has(s)||(io("SyncEngine","New document in limbo: "+n),e.Ca.add(s),Pp(e))}function Pp(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){const t=e.Ca.values().next().value;e.Ca.delete(t);const n=new Do(Ao.fromString(t)),s=e.Na.next();e.Fa.set(s,new fp(n)),e.va=e.va.insert(n,s),wh(e.remoteStore,new bu(gl(hl(n.path)),s,"TargetPurposeLimboResolution",Ko.oe))}}async function jp(e,t,n){const s=uo(e),i=[],r=[],a=[];s.ba.isEmpty()||(s.ba.forEach((e,o)=>{a.push(s.Ba(o,t,n).then(e=>{if((e||n)&&s.isPrimaryClient){const t=e&&!e.fromCache;s.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);const t=Wu.Ki(o.targetId,e);r.push(t)}}))}),await Promise.all(a),s.Sa.h_(i),await async function(e,t){const n=uo(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Go.forEach(t,t=>Go.forEach(t.qi,s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s)).next(()=>Go.forEach(t.Qi,s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))}catch(e){if(!Ho(e))throw e;io("LocalStore","Failed to update sequence numbers: "+e)}for(const s of t){const e=s.targetId;if(!s.fromCache){const t=n.ns.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.ns=n.ns.insert(e,i)}}}(s.localStore,r))}async function Lp(e,t){const n=uo(e);if(!n.currentUser.isEqual(t)){io("SyncEngine","User change. New user:",t.toKey());const e=await Yu(n.localStore,t);n.currentUser=t,function(e,t){e.Oa.forEach(e=>{e.forEach(e=>{e.reject(new po(ho.CANCELLED,t))})}),e.Oa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await jp(n,e.us)}}function Mp(e,t){const n=uo(e),s=n.Fa.get(t);if(s&&s.wa)return Ul().add(s.key);{let e=Ul();const s=n.Da.get(t);if(!s)return e;for(const t of s){const s=n.ba.get(t);e=e.unionWith(s.view.Ea)}return e}}function Up(e){const t=uo(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=wp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Np.bind(null,t),t.Sa.h_=rp.bind(null,t.eventManager),t.Sa.ka=ap.bind(null,t.eventManager),t}function Vp(e){const t=uo(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Tp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Cp.bind(null,t),t}class Fp{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=ph(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return qu(this.persistence,new Ku,e.initialUser,this.serializer)}createPersistence(e){return new Fu(Gu.Hr,this.serializer)}createSharedClientState(e){return new sh}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Bp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Sp(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Lp.bind(null,this.syncEngine),await qh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new np}createDatastore(e){const t=ph(e.databaseInfo.databaseId),n=function(e){return new uh(e)}(e.databaseInfo);return function(e,t,n,s){return new vh(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,s,i){return new Eh(e,t,n,s,i)}(this.localStore,this.datastore,e.asyncQueue,e=>Sp(this.syncEngine,e,0),rh.D()?new rh:new ih)}createSyncEngine(e,t){return function(e,t,n,s,i,r,a){const o=new gp(e,t,n,s,i,r);return a&&(o.La=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=uo(e);io("RemoteStore","RemoteStore shutting down."),t.M_.add(5),await xh(t),t.O_.shutdown(),t.N_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class Gp{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):ro("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Wp{constructor(e,t,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=eo.UNAUTHENTICATED,this.clientId=So.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{io("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(io("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new po(ho.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new mo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Qh(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Hp(e,t){e.asyncQueue.verifyOperationInProgress(),io("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener(async e=>{s.isEqual(e)||(await Yu(t.localStore,e),s=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Kp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await qp(e);io("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>zh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>zh(t.remoteStore,n)),e._onlineComponents=t}function zp(e){return"FirebaseError"===e.name?e.code===ho.FAILED_PRECONDITION||e.code===ho.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function qp(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){io("FirestoreClient","Using user provided OfflineComponentProvider");try{await Hp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!zp(n))throw n;ao("Error using user provided cache. Falling back to memory cache: "+n),await Hp(e,new Fp)}}else io("FirestoreClient","Using default OfflineComponentProvider"),await Hp(e,new Fp);return e._offlineComponents}async function Yp(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(io("FirestoreClient","Using user provided OnlineComponentProvider"),await Kp(e,e._uninitializedComponentsProvider._online)):(io("FirestoreClient","Using default OnlineComponentProvider"),await Kp(e,new Bp))),e._onlineComponents}function Xp(e){return Yp(e).then(e=>e.syncEngine)}async function Jp(e){const t=await Yp(e),n=t.eventManager;return n.onListen=yp.bind(null,t.syncEngine),n.onUnlisten=bp.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=vp.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=xp.bind(null,t.syncEngine),n}function Qp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=new mo;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,s,i){const r=new Gp({next:r=>{t.enqueueAndForget(()=>ip(e,a));const o=r.docs.has(n);!o&&r.fromCache?i.reject(new po(ho.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&r.fromCache&&s&&"server"===s.source?i.reject(new po(ho.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new dp(hl(n.path),r,{includeMetadataChanges:!0,ra:!0});return sp(e,a)}(await Jp(e),e.asyncQueue,t,n,s)),s.promise}function Zp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=new mo;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,s,i){const r=new Gp({next:n=>{t.enqueueAndForget(()=>ip(e,a)),n.fromCache&&"server"===s.source?i.reject(new po(ho.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new dp(n,r,{includeMetadataChanges:!0,ra:!0});return sp(e,a)}(await Jp(e),e.asyncQueue,t,n,s)),s.promise}function $p(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const em=new Map;function tm(e,t,n){if(!n)throw new po(ho.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function nm(e){if(!Do.isDocumentKey(e))throw new po(ho.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function sm(e){if(Do.isDocumentKey(e))throw new po(ho.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function im(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":co()}function rm(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new po(ho.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=im(e);throw new po(ho.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function am(e,t){if(t<=0)throw new po(ho.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}class om{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new po(ho.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new po(ho.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,s){if(!0===t&&!0===s)throw new po(ho.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$p(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new po(ho.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new po(ho.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new po(ho.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cm{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new om({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new po(ho.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new po(ho.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new om(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new go;switch(e.type){case"firstParty":return new Eo(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new po(ho.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=em.get(e);t&&(io("ComponentProvider","Removing Datastore"),em.delete(e),t.terminate())}(this),Promise.resolve()}}function lm(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var i;const r=(e=rm(e,cm))._getSettings(),a="".concat(t,":").concat(n);if("firestore.googleapis.com"!==r.host&&r.host!==a&&ao("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},r),{host:a,ssl:!1})),s.mockUserToken){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=eo.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[bt(JSON.stringify({alg:"none",type:"JWT"})),bt(JSON.stringify(r)),""].join(".")}(s.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new po(ho.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new eo(r)}e._authCredentials=new yo(new fo(t,n))}}class dm{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new dm(this.firestore,e,this._query)}}class um{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new um(this.firestore,e,this._key)}}class hm extends dm{constructor(e,t,n){super(e,t,hl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new um(this.firestore,null,new Do(e))}withConverter(e){return new hm(this.firestore,e,this._path)}}function pm(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];if(e=Wt(e),tm("collection","path",t),e instanceof cm){const n=Ao.fromString(t,...s);return sm(n),new hm(e,null,n)}{if(!(e instanceof um||e instanceof hm))throw new po(ho.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ao.fromString(t,...s));return sm(n),new hm(e.firestore,null,n)}}function mm(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];if(e=Wt(e),1===arguments.length&&(t=So.newId()),tm("doc","path",t),e instanceof cm){const n=Ao.fromString(t,...s);return nm(n),new um(e,null,new Do(n))}{if(!(e instanceof um||e instanceof hm))throw new po(ho.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ao.fromString(t,...s));return nm(n),new um(e.firestore,e instanceof hm?e.converter:null,new Do(n))}}class fm{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new mh(this,"async_queue_retry"),this.hu=()=>{const e=hh();e&&io("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};const e=hh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=hh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new mo;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(mv){if(!Ho(mv))throw mv;io("AsyncQueue","Operation failed with retryable error: "+mv)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(e=>{this.au=e,this.uu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw ro("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.uu=!1,e))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const s=Jh.createAndSchedule(this,e,t,n,e=>this.Eu(e));return this._u.push(s),s}Pu(){this.au&&co()}verifyOperationInProgress(){}async du(){let e;do{e=this.iu,await e}while(e!==this.iu)}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function gm(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const s of t)if(s in n&&"function"==typeof n[s])return!0;return!1}(e,["next","error","complete"])}class ym extends cm{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new fm,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||_m(this),this._firestoreClient.terminate()}}function vm(e){return e._firestoreClient||_m(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function _m(e){var t,n,s;const i=e._freezeSettings(),r=function(e,t,n,s){return new gc(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,$p(s.experimentalLongPollingOptions),s.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Wp(e._authCredentials,e._appCheckCredentials,e._queue,r),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=i.localCache)||void 0===s?void 0:s._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Em{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Em(cc.fromBase64String(e))}catch(e){throw new po(ho.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Em(cc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class bm{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let s=0;s<t.length;++s)if(0===t[s].length)throw new po(ho.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ko(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class xm{constructor(e){this._methodName=e}}class wm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new po(ho.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new po(ho.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return No(this._lat,e._lat)||No(this._long,e._long)}}const Sm=/^__.*__$/;class Nm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new pd(e,this.data,this.fieldMask,t,this.fieldTransforms):new hd(e,this.data,t,this.fieldTransforms)}}class Tm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new pd(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Cm(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw co()}}class Rm{constructor(e,t,n,s,i,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.mu(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new Rm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.gu({path:n,yu:!1});return s.wu(e),s}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.gu({path:n,yu:!1});return s.mu(),s}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Hm(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(Cm(this.fu)&&Sm.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class Im{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ph(e)}Fu(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Rm({fu:e,methodName:t,vu:n,path:ko.emptyPath(),yu:!1,Cu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Am(e){const t=e._freezeSettings(),n=ph(e._databaseId);return new Im(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Om(e,t,n,s,i){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Fu(r.merge||r.mergeFields?2:0,t,n,i);Fm("Data must be an object, but it was:",a,s);const o=Um(s,a);let c,l;if(r.merge)c=new ac(a.fieldMask),l=a.fieldTransforms;else if(r.mergeFields){const e=[];for(const s of r.mergeFields){const i=Bm(t,s,n);if(!a.contains(i))throw new po(ho.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));Km(e,i)||e.push(i)}c=new ac(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new Nm(new Pc(o),c,l)}class km extends xm{_toFieldTransform(e){if(2!==e.fu)throw 1===e.fu?e.Du("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Du("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof km}}class Dm extends xm{_toFieldTransform(e){return new nd(e.path,new Yl)}isEqual(e){return e instanceof Dm}}function Pm(e,t,n,s){const i=e.Fu(1,t,n);Fm("Data must be an object, but it was:",i,s);const r=[],a=Pc.empty();$o(s,(e,s)=>{const o=Wm(t,e,n);s=Wt(s);const c=i.Su(o);if(s instanceof km)r.push(o);else{const e=Mm(s,c);null!=e&&(r.push(o),a.set(o,e))}});const o=new ac(r);return new Tm(a,o,i.fieldTransforms)}function jm(e,t,n,s,i,r){const a=e.Fu(1,t,n),o=[Bm(t,s,n)],c=[i];if(r.length%2!=0)throw new po(ho.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let h=0;h<r.length;h+=2)o.push(Bm(t,r[h])),c.push(r[h+1]);const l=[],d=Pc.empty();for(let h=o.length-1;h>=0;--h)if(!Km(l,o[h])){const e=o[h];let t=c[h];t=Wt(t);const n=a.Su(e);if(t instanceof km)l.push(e);else{const s=Mm(t,n);null!=s&&(l.push(e),d.set(e,s))}}const u=new ac(l);return new Tm(d,u,a.fieldTransforms)}function Lm(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Mm(n,e.Fu(s?4:3,t))}function Mm(e,t){if(Vm(e=Wt(e)))return Fm("Unsupported field value:",t,e),Um(e,t);if(e instanceof xm)return function(e,t){if(!Cm(t.fu))throw t.Du("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Du("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const i of e){let e=Mm(i,t.bu(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Wt(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Wl(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Co.fromDate(e);return{timestampValue:Yd(t.serializer,n)}}if(e instanceof Co){const n=new Co(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Yd(t.serializer,n)}}if(e instanceof wm)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Em)return{bytesValue:Xd(t.serializer,e._byteString)};if(e instanceof um){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.Du("Document reference is for database ".concat(s.projectId,"/").concat(s.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:Zd(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Du("Unsupported field value: ".concat(im(e)))}(e,t)}function Um(e,t){const n={};return ec(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):$o(e,(e,s)=>{const i=Mm(s,t.pu(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Vm(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Co||e instanceof wm||e instanceof Em||e instanceof um||e instanceof xm)}function Fm(e,t,n){if(!Vm(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const s=im(n);throw"an object"===s?t.Du(e+" a custom object"):t.Du(e+" "+s)}}function Bm(e,t,n){if((t=Wt(t))instanceof bm)return t._internalPath;if("string"==typeof t)return Wm(e,t);throw Hm("Field path arguments must be of type string or ",e,!1,void 0,n)}const Gm=new RegExp("[~\\*/\\[\\]]");function Wm(e,t,n){if(t.search(Gm)>=0)throw Hm("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new bm(...t.split("."))._internalPath}catch(Ue){throw Hm("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Hm(e,t,n,s,i){const r=s&&!s.isEmpty(),a=void 0!==i;let o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(r||a)&&(c+=" (found",r&&(c+=" in field ".concat(s)),a&&(c+=" in document ".concat(i)),c+=")"),new po(ho.INVALID_ARGUMENT,o+e+c)}function Km(e,t){return e.some(e=>e.isEqual(t))}class zm{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new um(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new qm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ym("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class qm extends zm{data(){return super.data()}}function Ym(e,t){return"string"==typeof t?Wm(e,t):t instanceof bm?t._internalPath:t._delegate._internalPath}function Xm(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new po(ho.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jm{}class Qm extends Jm{}function Zm(e,t){let n=[];for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];t instanceof Jm&&n.push(t),n=n.concat(i),function(e){const t=e.filter(e=>e instanceof tf).length,n=e.filter(e=>e instanceof $m).length;if(t>1||t>0&&n>0)throw new po(ho.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class $m extends Qm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new $m(e,t,n)}_apply(e){const t=this._parse(e);return cf(e._query,t),new dm(e.firestore,e.converter,vl(e._query,t))}_parse(e){const t=Am(e.firestore),n=function(e,t,n,s,i,r,a){let o;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new po(ho.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(r,"' queries on documentId()."));if("in"===r||"not-in"===r){of(a,r);const t=[];for(const n of a)t.push(af(s,e,n));o={arrayValue:{values:t}}}else o=af(s,e,a)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||of(a,r),o=Lm(n,t,a,"in"===r||"not-in"===r);return Wc.create(i,r,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function ef(e,t,n){const s=t,i=Ym("where",e);return $m._create(i,s,n)}class tf extends Jm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new tf(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Hc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const s=t.getFlattenedFilters();for(const i of s)cf(n,i),n=vl(n,i)}(e._query,t),new dm(e.firestore,e.converter,vl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class nf extends Qm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new nf(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new po(ho.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new po(ho.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Fc(t,n)}(e._query,this._field,this._direction);return new dm(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new dl(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function sf(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Ym("orderBy",e);return nf._create(n,t)}class rf extends Qm{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new rf(e,t,n)}_apply(e){return new dm(e.firestore,e.converter,_l(e._query,this._limit,this._limitType))}}function af(e,t,n){if("string"==typeof(n=Wt(n))){if(""===n)throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ml(t)&&-1!==n.indexOf("/"))throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const s=t.path.child(Ao.fromString(n));if(!Do.isDocumentKey(s))throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(s,"' is not because it has an odd number of segments (").concat(s.length,")."));return Tc(e,new Do(s))}if(n instanceof um)return Tc(e,n._key);throw new po(ho.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(im(n),"."))}function of(e,t){if(!Array.isArray(e)||0===e.length)throw new po(ho.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function cf(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new po(ho.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new po(ho.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class lf{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(_c(e)){case 0:return null;case 1:return e.booleanValue;case 2:return uc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(hc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw co()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return $o(e,(e,s)=>{n[e]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new wm(uc(e.latitude),uc(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=mc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(fc(e));default:return null}}convertTimestamp(e){const t=dc(e);return new Co(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ao.fromString(e);lo(Eu(n));const s=new yc(n.get(1),n.get(3)),i=new Do(n.popFirst(5));return s.isEqual(t)||ro("Document ".concat(i," contains a document reference within a different database (").concat(s.projectId,"/").concat(s.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function df(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class uf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hf extends zm{constructor(e,t,n,s,i,r){super(e,t,n,s,r),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new pf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Ym("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class pf extends hf{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class mf{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new uf(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new pf(this._firestore,this._userDataWriter,n.key,n,new uf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new po(ho.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const s=new pf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new uf(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const s=new pf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,r=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:ff(t.type),doc:s,oldIndex:i,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function ff(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return co()}}function gf(e){e=rm(e,um);const t=rm(e.firestore,ym);return Qp(vm(t),e._key).then(n=>Sf(t,e,n))}class yf extends lf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Em(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new um(this.firestore,null,t)}}function vf(e){e=rm(e,dm);const t=rm(e.firestore,ym),n=vm(t),s=new yf(t);return Xm(e._query),Zp(n,e._query).then(n=>new mf(t,s,e,n))}function _f(e,t,n){e=rm(e,um);const s=rm(e.firestore,ym),i=df(e.converter,t,n);return wf(s,[Om(Am(s),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,id.none())])}function Ef(e,t,n){e=rm(e,um);const s=rm(e.firestore,ym),i=Am(s);let r;for(var a=arguments.length,o=new Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];return r="string"==typeof(t=Wt(t))||t instanceof bm?jm(i,"updateDoc",e._key,t,n,o):Pm(i,"updateDoc",e._key,t),wf(s,[r.toMutation(e._key,id.exists(!0))])}function bf(e,t){const n=rm(e.firestore,ym),s=mm(e),i=df(e.converter,t);return wf(n,[Om(Am(e.firestore),"addDoc",s._key,i,null!==e.converter,{}).toMutation(s._key,id.exists(!1))]).then(()=>s)}function xf(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];var i,r,a;e=Wt(e);let o={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof n[c]||gm(n[c])||(o=n[c],c++);const l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(gm(n[c])){const e=n[c];n[c]=null===(i=e.next)||void 0===i?void 0:i.bind(e),n[c+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),n[c+2]=null===(a=e.complete)||void 0===a?void 0:a.bind(e)}let d,u,h;if(e instanceof um)u=rm(e.firestore,ym),h=hl(e._key.path),d={next:t=>{n[c]&&n[c](Sf(u,e,t))},error:n[c+1],complete:n[c+2]};else{const t=rm(e,dm);u=rm(t.firestore,ym),h=t._query;const s=new yf(u);d={next:e=>{n[c]&&n[c](new mf(u,s,t,e))},error:n[c+1],complete:n[c+2]},Xm(e._query)}return function(e,t,n,s){const i=new Gp(s),r=new dp(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>sp(await Jp(e),r)),()=>{i.$a(),e.asyncQueue.enqueueAndForget(async()=>ip(await Jp(e),r))}}(vm(u),h,l,d)}function wf(e,t){return function(e,t){const n=new mo;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const s=Vp(e);try{const e=await function(e,t){const n=uo(e),s=Co.now(),i=t.reduce((e,t)=>e.add(t.key),Ul());let r,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=Il(),c=Ul();return n.os.getEntries(e,i).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(i=>{r=i;const a=[];for(const e of t){const t=dd(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new pd(e.key,t,jc(t.value.mapValue),id.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{a=t;const s=t.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:a.batchId,changes:kl(r)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.xa[e.currentUser.toKey()];s||(s=new tc(No)),s=s.insert(t,n),e.xa[e.currentUser.toKey()]=s}(s,e.batchId,n),await jp(s,e.changes),await Mh(s.remoteStore)}catch(e){const t=Qh(e,"Failed to persist write");n.reject(t)}}(await Xp(e),t,n)),n.promise}(vm(e),t)}function Sf(e,t,n){const s=n.docs.get(t._key),i=new yf(e);return new hf(e,i,t._key,s,new uf(n.hasPendingWrites,n.fromCache),t.converter)}function Nf(){return new Dm("serverTimestamp")}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){to=e}(is),$n(new Ht("firestore",(e,n)=>{let{instanceIdentifier:s,options:i}=n;const r=e.getProvider("app").getImmediate(),a=new ym(new vo(e.getProvider("auth-internal")),new xo(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new po(ho.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yc(e.options.projectId,t)}(r,s),r);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),os($a,"4.6.3",e),os($a,"4.6.3","esm2017")}();const Tf="functions";class Cf{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(mv){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(mv){return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const Rf="us-central1";class If{constructor(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Rf,r=arguments.length>5?arguments[5]:void 0;this.app=e,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new Cf(t,n,s),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(i);this.customDomain=e.origin,this.region=Rf}catch(mv){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){const n=this.emulatorOrigin;return"".concat(n,"/").concat(t,"/").concat(this.region,"/").concat(e)}return null!==this.customDomain?"".concat(this.customDomain,"/").concat(e):"https://".concat(this.region,"-").concat(t,".cloudfunctions.net/").concat(e)}}const Af="@firebase/functions",Of="0.11.5";!function(e,t){$n(new Ht(Tf,(t,n)=>{let{instanceIdentifier:s}=n;const i=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),a=t.getProvider("messaging-internal"),o=t.getProvider("app-check-internal");return new If(i,r,a,o,s,e)},"PUBLIC").setMultipleInstances(!0)),os(Af,Of,t),os(Af,Of,"esm2017")}(fetch.bind(self));const kf=rs({apiKey:"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",authDomain:"elderx-f5c2b.firebaseapp.com",projectId:"elderx-f5c2b",storageBucket:"elderx-f5c2b.firebasestorage.app",messagingSenderId:"987610993096",appId:"1:987610993096:web:97c82732772d1223d3f0fd"}),Df=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:as();const t=es(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=es(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Lt(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Ss(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Na,persistence:[Mr,Er,xr]}),s=Rt("authTokenSyncURL");if(s&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(s,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ia)return;const s=null===t||void 0===t?void 0:t.token;Aa!==s&&(Aa=s,await fetch(i,{method:s?"POST":"DELETE",headers:s?{Authorization:"Bearer ".concat(s)}:{}}))});!function(e,t,n){Wt(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,s){Wt(e).onIdTokenChanged(t,n,s)}(n,e=>t(e))}}var i;const r=Nt("auth");return r&&Fi(n,"http://".concat(r)),n}(kf),Pf=function(e,t){const n="string"==typeof e?e:t||"(default)",s=es("object"==typeof e?e:as(),"firestore").getImmediate({identifier:n});if(!s._initialized){const e=Tt("firestore");e&&lm(s,...e)}return s}(kf);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:as(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rf;const n=es(Wt(e),Tf).getImmediate({identifier:t}),s=Tt("functions");s&&function(e,t,n){!function(e,t,n){e.emulatorOrigin="http://".concat(t,":").concat(n)}(Wt(e),t,n)}(n,...s)}(kf);var jf={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Lf=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],Mf=(e,n)=>{const s=(0,t.forwardRef)((s,i)=>{let{color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:l="",children:d}=s,u=Me(s,Lf);return(0,t.createElement)("svg",Le(Le({ref:i},jf),{},{width:a,height:a,stroke:r,strokeWidth:c?24*Number(o)/Number(a):o,className:["lucide","lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),l].join(" ")},u),[...n.map(e=>{let[n,s]=e;return(0,t.createElement)(n,s)}),...Array.isArray(d)?d:[d]]);var h});return s.displayName="".concat(e),s},Uf=Mf("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Vf=Mf("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Ff=Mf("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Bf=Mf("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),Gf=Mf("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),Wf=Mf("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Hf=Mf("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Kf=Mf("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),zf=Mf("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),qf=Mf("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Yf=Mf("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var Xf=n(579);const Jf=()=>{const[e,n]=(0,t.useState)(!1),s=ee(),i=Z(),r=async()=>{try{await gr(Df),yt.success("Signed out successfully"),s("/login")}catch(e){yt.error("Error signing out"),console.error("Sign out error:",e)}},a=[{name:"Overview",href:"/dashboard",icon:Uf},{name:"Request Care",href:"/appointments",icon:Vf},{name:"Health Vitals",href:"/vital-signs",icon:Ff},{name:"Telemedicine",href:"/telemedicine",icon:Bf},{name:"Messages",href:"/messages",icon:Gf},{name:"Subscription",href:"/subscription",icon:Wf}],o=e=>i.pathname===e;return(0,Xf.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Xf.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Xf.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>n(!1)}),(0,Xf.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white shadow-xl",children:[(0,Xf.jsxs)("div",{className:"flex h-16 items-center justify-between px-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]}),(0,Xf.jsx)("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Hf,{className:"h-6 w-6"})})]}),(0,Xf.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Xf.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),s(e.href),n(!1)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Xf.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Xf.jsxs)("button",{onClick:r,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Xf.jsx)(Kf,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})]}),(0,Xf.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,Xf.jsxs)("div",{className:"flex flex-col flex-grow bg-white border-r border-gray-200 shadow-sm",children:[(0,Xf.jsx)("div",{className:"flex h-16 items-center px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]})}),(0,Xf.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Xf.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),s(e.href)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Xf.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Xf.jsxs)("button",{onClick:r,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Xf.jsx)(Kf,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})}),(0,Xf.jsxs)("div",{className:"lg:pl-64",children:[(0,Xf.jsxs)("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[(0,Xf.jsx)("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>n(!0),children:(0,Xf.jsx)(zf,{className:"h-6 w-6"})}),(0,Xf.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[(0,Xf.jsx)("div",{className:"flex flex-1"}),(0,Xf.jsxs)("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:[(0,Xf.jsxs)("button",{className:"p-2 text-gray-400 hover:text-gray-500",children:[(0,Xf.jsx)(qf,{className:"h-5 w-5"}),(0,Xf.jsx)("span",{className:"sr-only",children:"Notifications"})]}),(0,Xf.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-400"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Mrs. Adunni Okafor"})]})]})]})]}),(0,Xf.jsx)("main",{className:"py-6",children:(0,Xf.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,Xf.jsx)(ge,{})})})]})]})},Qf=Mf("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Zf=Mf("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),$f=Mf("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),eg=Mf("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),tg=Mf("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),ng=Mf("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),sg=Mf("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),ig=Mf("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),rg=Mf("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),ag=Mf("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),og=Mf("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),cg=Mf("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),lg=()=>{const[e,n]=(0,t.useState)(!1),s=ee(),i=Z(),r=[{name:"Dashboard",href:"/admin",icon:Qf},{name:"Users",href:"/admin/users",icon:Zf},{name:"Appointments",href:"/admin/appointments",icon:$f},{name:"Emergency",href:"/admin/emergency",icon:eg},{name:"Medications",href:"/admin/medications",icon:tg},{name:"Caregivers",href:"/admin/caregivers",icon:ng},{name:"Analytics",href:"/admin/analytics",icon:sg},{name:"Communication",href:"/admin/communication",icon:ig},{name:"Audit Logs",href:"/admin/audit-logs",icon:rg},{name:"Reports",href:"/admin/reports",icon:ag},{name:"Settings",href:"/admin/settings",icon:og}],a=e=>i.pathname===e;return(0,Xf.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,Xf.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>n(!1)}),(0,Xf.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Xf.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Xf.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>n(!1),children:(0,Xf.jsx)(Hf,{className:"h-6 w-6 text-white"})})}),(0,Xf.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Xf.jsx)(cg,{className:"h-8 w-8 text-blue-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Admin"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(a(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(a(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Xf.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Xf.jsx)("div",{className:"flex flex-col w-64",children:(0,Xf.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Xf.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Xf.jsx)(cg,{className:"h-8 w-8 text-blue-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Admin"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(a(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(a(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Xf.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-3",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Admin User"}),(0,Xf.jsxs)("button",{onClick:async()=>{try{await gr(Df),yt.success("Signed out successfully"),s("/login")}catch(e){yt.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Xf.jsx)(Kf,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Xf.jsxs)("div",{className:"lg:pl-64 flex flex-col flex-1 min-w-0 dashboard-container",children:[(0,Xf.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Xf.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 lg:hidden",onClick:()=>n(!0),children:(0,Xf.jsx)(zf,{className:"h-6 w-6"})}),(0,Xf.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Xf.jsx)("div",{className:"flex-1 flex",children:(0,Xf.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Xf.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Xf.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:"Admin Panel"})})})})}),(0,Xf.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Xf.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:(0,Xf.jsx)(qf,{className:"h-6 w-6"})}),(0,Xf.jsx)("div",{className:"ml-3 relative",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Admin User"})})]})})]})]})]}),(0,Xf.jsx)("main",{className:"flex-1 overflow-auto w-full dashboard-main",children:(0,Xf.jsx)("div",{className:"h-full",children:(0,Xf.jsx)(ge,{})})})]})]})},dg=Mf("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ug=Mf("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),hg=Mf("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),pg=Mf("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),mg=Mf("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),fg=Mf("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),gg=Mf("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),yg=Mf("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),vg=Mf("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),_g=()=>{const e=[{icon:Ff,title:"Health Monitoring",description:"Continuous monitoring of vital signs and health metrics"},{icon:cg,title:"Secure & Private",description:"Your health data is protected with enterprise-grade security"},{icon:Zf,title:"Caregiver Support",description:"Professional caregivers available 24/7 for your needs"},{icon:dg,title:"24/7 Access",description:"Round-the-clock support and emergency response"}],t=[{icon:ug,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",color:"text-blue-600",bgColor:"bg-blue-100"},{icon:$f,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",color:"text-green-600",bgColor:"bg-green-100"},{icon:qf,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",color:"text-red-600",bgColor:"bg-red-100"},{icon:Bf,title:"Telemedicine",description:"Video consultations with doctors and specialists.",color:"text-purple-600",bgColor:"bg-purple-100"},{icon:Zf,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",color:"text-orange-600",bgColor:"bg-orange-100"},{icon:cg,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",color:"text-blue-600",bgColor:"bg-blue-100"}];return(0,Xf.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,Xf.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:(0,Xf.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsxs)("div",{className:"flex-shrink-0 flex items-center",children:[(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Xf.jsx)("p",{className:"ml-4 text-sm text-gray-600 hidden sm:block",children:"Professional Home Healthcare"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)(Re,{to:"/login",className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Sign In"}),(0,Xf.jsx)(Re,{to:"/signup",className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700",children:"Get Started"})]})]})})}),(0,Xf.jsx)("section",{className:"relative py-16 sm:py-24 lg:py-32",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[(0,Xf.jsxs)("div",{className:"text-center lg:text-left",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:"NG Proudly Nigerian \u2022 NDPR Compliant"}),(0,Xf.jsxs)("h1",{className:"mt-4 text-4xl font-extrabold text-gray-900 sm:text-5xl md:text-6xl",children:["Quality ",(0,Xf.jsx)("span",{className:"text-teal-600",children:"Healthcare"})," At Your ",(0,Xf.jsx)("span",{className:"text-green-600",children:"Doorstep"})]}),(0,Xf.jsx)("p",{className:"mt-6 text-lg text-gray-600 max-w-xl mx-auto lg:mx-0",children:"ElderCare Nigeria provides compassionate and professional home healthcare services, ensuring comfort and well-being for your loved ones."}),(0,Xf.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center lg:justify-start",children:[(0,Xf.jsxs)(Re,{to:"/signup",className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700",children:["Start Your Care Journey",(0,Xf.jsx)(hg,{className:"ml-2 h-5 w-5"})]}),(0,Xf.jsxs)("a",{href:"tel:0800-ELDERCARE",className:"inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[(0,Xf.jsx)(pg,{className:"mr-2 h-5 w-5 text-blue-600"}),"Call: 0800-ELDERCARE"]})]}),(0,Xf.jsxs)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-3 gap-6 text-gray-600",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Xf.jsx)(mg,{className:"h-5 w-5 text-green-500 mr-2"}),"Licensed Professionals"]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 text-blue-500 mr-2"}),"Secure & Private"]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Xf.jsx)(dg,{className:"h-5 w-5 text-purple-500 mr-2"}),"24/7 Emergency Support"]})]})]}),(0,Xf.jsx)("div",{className:"relative mt-12 lg:mt-0 flex justify-center",children:(0,Xf.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-sm",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)("img",{className:"h-12 w-12 rounded-full object-cover",src:"https://images.unsplash.com/photo-1559839734-2b716b1772a1?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",alt:"Nurse Fatima Abdullahi"}),(0,Xf.jsxs)("div",{className:"ml-3",children:[(0,Xf.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"Nurse Fatima Abdullahi"}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500 flex items-center",children:[(0,Xf.jsx)(Ff,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-yellow-500",children:"\u2605"})," 4.9 (156 visits)"]})]})]}),(0,Xf.jsx)("div",{className:"bg-green-50 p-3 rounded-lg mb-4",children:(0,Xf.jsx)("p",{className:"text-sm text-green-800",children:'"Hello! I\'ll be arriving at your location in 15 minutes. Please ensure the gate is open."'})}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center border-t border-gray-200 pt-4",children:[(0,Xf.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800",children:[(0,Xf.jsx)(Gf,{className:"h-5 w-5 mr-1"}),"Reply"]}),(0,Xf.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800",children:[(0,Xf.jsx)(Bf,{className:"h-5 w-5 mr-1"}),"Video Call"]})]})]})})]})}),(0,Xf.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-12",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Why Choose ElderCare Nigeria?"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"We provide comprehensive healthcare solutions designed specifically for Nigerian families"})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:e.map((e,t)=>{const n=e.icon;return(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Xf.jsx)(n,{className:"h-8 w-8 text-blue-600"})}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),(0,Xf.jsx)("p",{className:"text-gray-600",children:e.description})]},t)})})]})}),(0,Xf.jsx)("section",{className:"py-16",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-12",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map((e,t)=>{const n=e.icon;return(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Xf.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Xf.jsx)(n,{className:"h-8 w-8 ".concat(e.color)})}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Xf.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]})}),(0,Xf.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-12",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"What Our Clients Say"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600",children:"Real stories from families who trust ElderCare Nigeria"})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{name:"Mrs. Adunni Okafor",location:"Lagos, Nigeria",rating:5,text:"ElderCare Nigeria has been a blessing for my family. The caregivers are professional and caring, and the 24/7 support gives us peace of mind."},{name:"Dr. Kemi Adebayo",location:"Abuja, Nigeria",rating:5,text:"As a healthcare professional, I can confidently recommend ElderCare Nigeria. Their services are top-notch and their technology is cutting-edge."},{name:"Mr. Chinedu Okoro",location:"Port Harcourt, Nigeria",rating:5,text:"The medication management system has been incredibly helpful. I never miss a dose anymore, and my family is always informed about my health status."}].map((e,t)=>(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,Xf.jsx)("div",{className:"flex items-center mb-4",children:[...Array(e.rating)].map((e,t)=>(0,Xf.jsx)(fg,{className:"h-5 w-5 text-yellow-400 fill-current"},t))}),(0,Xf.jsxs)("p",{className:"text-gray-600 mb-4 italic",children:['"',e.text,'"']}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-blue-600"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500 flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-1"}),e.location]})]})]})]},t))})]})}),(0,Xf.jsx)("section",{className:"py-16 bg-gradient-to-r from-blue-600 to-green-600",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Ready to Get Started?"}),(0,Xf.jsx)("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Join thousands of Nigerian families who trust ElderCare Nigeria for their healthcare needs"}),(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,Xf.jsxs)(Re,{to:"/signup",className:"inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-gray-50",children:[(0,Xf.jsx)(yg,{className:"mr-2 h-5 w-5"}),"Start Your Care Journey"]}),(0,Xf.jsxs)(Re,{to:"/pricing",className:"inline-flex items-center justify-center px-8 py-3 border border-white text-base font-medium rounded-md text-white hover:bg-white hover:text-blue-600",children:[(0,Xf.jsx)(vg,{className:"mr-2 h-5 w-5"}),"View Our Plans"]})]})]})}),(0,Xf.jsx)("footer",{className:"bg-white py-8 border-t border-gray-200",children:(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,Xf.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Xf.jsx)("p",{className:"text-gray-600 mb-4",children:"Professional home healthcare services for Nigerian families. Compassionate care, advanced technology, and 24/7 support."}),(0,Xf.jsxs)("div",{className:"flex space-x-4",children:[(0,Xf.jsx)("a",{href:"tel:0800-ELDERCARE",className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-5 w-5"})}),(0,Xf.jsx)("a",{href:"mailto:info@eldercare.ng",className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(Gf,{className:"h-5 w-5"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Services"}),(0,Xf.jsxs)("ul",{className:"space-y-2",children:[(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Home Visits"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Vitals Monitoring"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Emergency Support"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Telemedicine"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Company"}),(0,Xf.jsxs)("ul",{className:"space-y-2",children:[(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/pricing",className:"text-gray-600 hover:text-blue-600",children:"Pricing"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/about",className:"text-gray-600 hover:text-blue-600",children:"About Us"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/contact",className:"text-gray-600 hover:text-blue-600",children:"Contact"})}),(0,Xf.jsx)("li",{children:(0,Xf.jsx)("a",{href:"/privacy",className:"text-gray-600 hover:text-blue-600",children:"Privacy Policy"})})]})]})]}),(0,Xf.jsxs)("div",{className:"border-t border-gray-200 mt-8 pt-8 text-center",children:[(0,Xf.jsx)("p",{className:"text-gray-500 text-sm",children:"\xa9 2024 ElderCare Nigeria. All rights reserved."}),(0,Xf.jsxs)("p",{className:"text-gray-500 text-sm mt-2",children:["Made by ",(0,Xf.jsx)("a",{href:"https://mgx.dev",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"MGX"})]})]})]})})]})},Eg=Mf("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),bg=Mf("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),xg=()=>{const[e,n]=(0,t.useState)(""),[s,i]=(0,t.useState)(""),[r,a]=(0,t.useState)("patient"),[o,c]=(0,t.useState)(!1),l=ee();return(0,Xf.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,Xf.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"flex justify-center mb-6",children:(0,Xf.jsx)("div",{className:"p-4 bg-blue-100 rounded-2xl",children:(0,Xf.jsx)(Ff,{className:"h-12 w-12 text-blue-600"})})}),(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to ElderX"}),(0,Xf.jsx)("p",{className:"text-gray-600 text-lg",children:"Your trusted health companion"})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{t.preventDefault(),c(!0);try{await function(e,t,n){return ts(e.app)?Promise.reject(Cs(e)):pr(Wt(e),Zi.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&mr(e),t})}(Df,e,s),yt.success("Welcome back!"),l("caregiver"===r?"/caregiver":"admin"===r?"/admin":"/dashboard")}catch(n){console.error("Login error:",n);let e="An error occurred during login";switch(n.code){case"auth/user-not-found":e="No account found with this email";break;case"auth/wrong-password":e="Incorrect password";break;case"auth/invalid-credential":e="Invalid email or password. Please check your credentials.";break;case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/operation-not-allowed":e="Email/password login is not enabled. Please contact support.";break;case"auth/too-many-requests":e="Too many failed attempts. Please try again later.";break;default:e=n.message||"An unexpected error occurred"}yt.error(e)}finally{c(!1)}},children:[(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"I am a:"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,Xf.jsxs)("button",{type:"button",onClick:()=>a("patient"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("patient"===r?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 mr-2"}),"Patient"]}),(0,Xf.jsxs)("button",{type:"button",onClick:()=>a("caregiver"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("caregiver"===r?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(ng,{className:"h-5 w-5 mr-2"}),"Caregiver"]}),(0,Xf.jsxs)("button",{type:"button",onClick:()=>a("admin"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("admin"===r?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 mr-2"}),"Admin"]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"email",className:"form-label",children:[(0,Xf.jsx)(Eg,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,Xf.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Enter your email",value:e,onChange:e=>n(e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"password",className:"form-label",children:[(0,Xf.jsx)(bg,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,Xf.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"form-input",placeholder:"Enter your password",value:s,onChange:e=>i(e.target.value)})]})]}),(0,Xf.jsx)("div",{children:(0,Xf.jsx)("button",{type:"submit",disabled:o,className:"btn btn-primary w-full",children:o?"Signing in...":"Sign In"})}),(0,Xf.jsxs)("div",{className:"text-center space-y-2",children:[(0,Xf.jsxs)("p",{className:"text-gray-600",children:["Don't have an account?"," ",(0,Xf.jsx)(Re,{to:"/signup",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign up here"})]}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,Xf.jsx)("p",{children:"Demo Account:"}),(0,Xf.jsx)("p",{children:"Email: demo@elderx.com | Password: demo123"})]})]})]})})]})})},wg=()=>{const[e,n]=(0,t.useState)({displayName:"",email:"",password:"",confirmPassword:"",userType:"patient"}),[s,i]=(0,t.useState)(!1),r=ee(),a=t=>{n(Le(Le({},e),{},{[t.target.name]:t.target.value}))};return(0,Xf.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,Xf.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"flex justify-center mb-6",children:(0,Xf.jsx)("div",{className:"p-4 bg-blue-100 rounded-2xl",children:(0,Xf.jsx)(Ff,{className:"h-12 w-12 text-blue-600"})})}),(0,Xf.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Join ElderX"}),(0,Xf.jsx)("p",{className:"text-gray-600 text-lg",children:"Create your account to get started"})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{if(t.preventDefault(),e.password===e.confirmPassword)if(e.password.length<6)yt.error("Password must be at least 6 characters");else{i(!0);try{const{user:t}=await async function(e,t,n){if(ts(e.app))return Promise.reject(Cs(e));const s=ki(e),i=Vi(s,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rr),r=await i.catch(t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&mr(e),t}),a=await ar._fromIdTokenResponse(s,"signIn",r);return await s._updateCurrentUser(a.user),a}(Df,e.email,e.password);await fr(t,{displayName:e.displayName}),yt.success("Account created successfully!"),"caregiver"===e.userType?r("/caregiver"):"admin"===e.userType?r("/admin"):r("/dashboard")}catch(n){console.error("Signup error:",n);let e="An error occurred during signup";switch(n.code){case"auth/email-already-in-use":e="This email is already registered";break;case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/operation-not-allowed":e="Email/password signup is not enabled. Please contact support.";break;case"auth/weak-password":e="Password should be at least 6 characters";break;default:e=n.message||"An unexpected error occurred"}yt.error(e)}finally{i(!1)}}else yt.error("Passwords do not match")},children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"displayName",className:"form-label",children:[(0,Xf.jsx)(Yf,{className:"inline h-4 w-4 mr-2"}),"Full Name"]}),(0,Xf.jsx)("input",{id:"displayName",name:"displayName",type:"text",autoComplete:"name",required:!0,className:"form-input",placeholder:"Enter your full name",value:e.displayName,onChange:a})]}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"I am a:"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,Xf.jsxs)("button",{type:"button",onClick:()=>n(Le(Le({},e),{},{userType:"patient"})),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("patient"===e.userType?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 mr-2"}),"Patient"]}),(0,Xf.jsxs)("button",{type:"button",onClick:()=>n(Le(Le({},e),{},{userType:"caregiver"})),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("caregiver"===e.userType?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(ng,{className:"h-5 w-5 mr-2"}),"Caregiver"]}),(0,Xf.jsxs)("button",{type:"button",onClick:()=>n(Le(Le({},e),{},{userType:"admin"})),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("admin"===e.userType?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 mr-2"}),"Admin"]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"email",className:"form-label",children:[(0,Xf.jsx)(Eg,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,Xf.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Enter your email",value:e.email,onChange:a})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"password",className:"form-label",children:[(0,Xf.jsx)(bg,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,Xf.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Create a password",value:e.password,onChange:a})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("label",{htmlFor:"confirmPassword",className:"form-label",children:[(0,Xf.jsx)(bg,{className:"inline h-4 w-4 mr-2"}),"Confirm Password"]}),(0,Xf.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Confirm your password",value:e.confirmPassword,onChange:a})]})]}),(0,Xf.jsx)("div",{children:(0,Xf.jsx)("button",{type:"submit",disabled:s,className:"btn btn-primary w-full",children:s?"Creating Account...":"Create Account"})}),(0,Xf.jsx)("div",{className:"text-center",children:(0,Xf.jsxs)("p",{className:"text-gray-600",children:["Already have an account?"," ",(0,Xf.jsx)(Re,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in here"})]})})]})})]})})},Sg=()=>(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Welcome back, Adunni"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Age"}),(0,Xf.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:"72 years"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Emergency Contact"}),(0,Xf.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:"Dr. Kemi Okafor"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"+234 801 987 6543"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Subscription"}),(0,Xf.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:"Premium"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Medical Conditions"}),(0,Xf.jsxs)("div",{className:"flex flex-wrap gap-2 mt-1",children:[(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:"Hypertension"}),(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:"Diabetes Type 2"})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("button",{className:"w-full bg-red-600 text-white py-4 px-6 rounded-lg font-bold text-lg hover:bg-red-700 transition-colors",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 inline mr-2"}),"EMERGENCY - NEED HELP NOW"]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Xf.jsxs)("button",{className:"bg-orange-100 text-orange-700 py-3 px-4 rounded-lg hover:bg-orange-200 transition-colors",children:[(0,Xf.jsx)(pg,{className:"h-5 w-5 inline mr-2"}),"Family"]}),(0,Xf.jsxs)("button",{className:"bg-blue-100 text-blue-700 py-3 px-4 rounded-lg hover:bg-blue-200 transition-colors",children:[(0,Xf.jsx)(Ff,{className:"h-5 w-5 inline mr-2"}),"Doctor"]})]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(Vf,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"1"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"Upcoming Visits"})]}),(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-red-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"140/90"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"Last BP Reading"})]}),(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(Gf,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"3"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"New Messages"})]}),(0,Xf.jsxs)("div",{className:"card text-center",children:[(0,Xf.jsx)(pg,{className:"h-8 w-8 text-purple-600 mx-auto mb-2"}),(0,Xf.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"24/7"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:"Support Available"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upcoming Care Visits"}),(0,Xf.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900",children:"Medication Administration"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Caregiver TBD"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Time TBD"})]}),(0,Xf.jsx)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:"Pending"})]})})]})]}),Ng=Mf("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Tg=Mf("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Cg=Mf("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),Rg=Mf("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ig=()=>{const[e,n]=(0,t.useState)(!1),[s,i]=(0,t.useState)(null),[r,a]=(0,t.useState)([{id:1,name:"Aspirin",dosage:"100mg",frequency:"Daily",instructions:"Take with food",nextDose:"8:00 AM",taken:!0,startDate:"2024-01-15",endDate:null},{id:2,name:"Vitamin D",dosage:"2000IU",frequency:"Weekly",instructions:"Take in the morning",nextDose:"9:00 AM",taken:!1,startDate:"2024-01-10",endDate:null},{id:3,name:"Blood Pressure Medication",dosage:"10mg",frequency:"Twice Daily",instructions:"Take with water",nextDose:"2:00 PM",taken:!1,startDate:"2024-01-20",endDate:null}]),[o,c]=(0,t.useState)({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:"",endDate:""});return(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medications"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your medications and track doses"})]}),(0,Xf.jsxs)("button",{onClick:()=>n(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4"}),"Add Medication"]})]}),e&&(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Medication"}),(0,Xf.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=Le(Le({id:Date.now()},o),{},{nextDose:"8:00 AM",taken:!1});a([...r,t]),c({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:"",endDate:""}),n(!1),yt.success("Medication added successfully")},className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Medication Name"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:o.name,onChange:e=>c(Le(Le({},o),{},{name:e.target.value})),required:!0})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Dosage"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:o.dosage,onChange:e=>c(Le(Le({},o),{},{dosage:e.target.value})),required:!0})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Frequency"}),(0,Xf.jsxs)("select",{className:"form-input",value:o.frequency,onChange:e=>c(Le(Le({},o),{},{frequency:e.target.value})),children:[(0,Xf.jsx)("option",{value:"Daily",children:"Daily"}),(0,Xf.jsx)("option",{value:"Twice Daily",children:"Twice Daily"}),(0,Xf.jsx)("option",{value:"Weekly",children:"Weekly"}),(0,Xf.jsx)("option",{value:"As Needed",children:"As Needed"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Start Date"}),(0,Xf.jsx)("input",{type:"date",className:"form-input",value:o.startDate,onChange:e=>c(Le(Le({},o),{},{startDate:e.target.value})),required:!0})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"form-label",children:"Instructions"}),(0,Xf.jsx)("textarea",{className:"form-input form-textarea",value:o.instructions,onChange:e=>c(Le(Le({},o),{},{instructions:e.target.value})),placeholder:"e.g., Take with food, Take on empty stomach"})]}),(0,Xf.jsxs)("div",{className:"flex space-x-4",children:[(0,Xf.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Add Medication"}),(0,Xf.jsx)("button",{type:"button",onClick:()=>n(!1),className:"btn btn-outline",children:"Cancel"})]})]})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 gap-4",children:r.map(e=>(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(tg,{className:"h-8 w-8 text-blue-600 mr-4"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-gray-600",children:[e.dosage," \u2022 ",e.frequency]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:e.instructions}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-400",children:[(0,Xf.jsx)(Vf,{className:"h-3 w-3 mr-1"}),"Started: ",e.startDate]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsxs)("div",{className:"text-right",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Next Dose"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:e.nextDose}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[e.taken?(0,Xf.jsx)(mg,{className:"h-4 w-4 text-green-500 mr-1"}):(0,Xf.jsx)(Tg,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-xs text-gray-500",children:e.taken?"Taken":"Pending"})]})]}),(0,Xf.jsxs)("div",{className:"flex space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,a(r.map(e=>e.id===t?Le(Le({},e),{},{taken:!e.taken}):e)),void yt.success("Medication status updated");var t},className:"btn ".concat(e.taken?"btn-outline":"btn-success"),children:e.taken?"Mark as Missed":"Mark as Taken"}),(0,Xf.jsx)("button",{onClick:()=>i(e),className:"btn btn-outline",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,a(r.filter(e=>e.id!==t)),void yt.success("Medication deleted successfully");var t},className:"btn btn-danger",children:(0,Xf.jsx)(Rg,{className:"h-4 w-4"})})]})]})]})},e.id))}),0===r.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(tg,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No medications added yet"}),(0,Xf.jsx)("p",{className:"text-gray-500 mb-4",children:"Start by adding your first medication"}),(0,Xf.jsxs)("button",{onClick:()=>n(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Add Your First Medication"]})]})]})},Ag=Mf("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),Og=Mf("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),kg=()=>{const[e,n]=(0,t.useState)({vitalType:"Blood Pressure",reading:"",notes:""}),s=[{id:1,type:"Blood Pressure",value:"140/90",unit:"mmHg",timestamp:"9/3/2025, 9:00:00 AM",status:"Warning",statusColor:"bg-yellow-100 text-yellow-800",icon:Ff},{id:2,type:"Blood Sugar",value:"120",unit:"mg/dL",timestamp:"9/3/2025, 9:15:00 AM",status:"Normal",statusColor:"bg-green-100 text-green-800",icon:Ag}],i=[{id:1,type:"Blood Pressure",trend:"Improving",trendColor:"text-green-600",average:"Average",icon:Ff}],r=e=>{switch(e){case"Normal":return"bg-green-100 text-green-800";case"Warning":return"bg-yellow-100 text-yellow-800";case"Critical":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,Xf.jsxs)("div",{className:"space-y-8",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Current Vitals"})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(e=>{const t=e.icon;return(0,Xf.jsxs)("div",{className:"p-6 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.type})]}),(0,Xf.jsx)("span",{className:"px-3 py-1 rounded text-sm font-medium ".concat(r(e.status)),children:e.status})]}),(0,Xf.jsxs)("div",{className:"mb-2",children:[(0,Xf.jsx)("span",{className:"text-3xl font-bold text-gray-900",children:e.value}),(0,Xf.jsx)("span",{className:"text-lg text-gray-600 ml-2",children:e.unit})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:e.timestamp})]},e.id)})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(Ng,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Record New Reading"})]}),(0,Xf.jsxs)("form",{onSubmit:t=>{t.preventDefault(),console.log("Vital reading submitted:",e),yt.success("Vital reading saved successfully"),n({vitalType:"Blood Pressure",reading:"",notes:""})},className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vital Type"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("select",{value:e.vitalType,onChange:t=>n(Le(Le({},e),{},{vitalType:t.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure","Blood Sugar","Heart Rate","Temperature","Weight","Oxygen Saturation","Respiratory Rate","Pain Level"].map(e=>(0,Xf.jsx)("option",{value:e,children:e},e))}),(0,Xf.jsx)(Og,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reading"}),(0,Xf.jsx)("input",{type:"text",value:e.reading,onChange:t=>n(Le(Le({},e),{},{reading:t.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., 120/80 or 98.6",required:!0})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,Xf.jsx)("textarea",{value:e.notes,onChange:t=>n(Le(Le({},e),{},{notes:t.target.value})),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Any additional observations..."})]}),(0,Xf.jsx)("div",{className:"flex justify-end",children:(0,Xf.jsxs)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center hover:bg-blue-700 transition-colors",children:[(0,Xf.jsx)(Ng,{className:"h-5 w-5 mr-2"}),"Save Reading"]})})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(sg,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Health Trends (Last 7 Days)"})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:i.map(e=>{const t=e.icon;return(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900",children:e.type}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium ".concat(e.trendColor),children:e.trend}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:e.average})]})]})]}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"View Details"})]},e.id)})})]})]})},Dg=Mf("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Pg=()=>{const[e,n]=(0,t.useState)("immediate"),[s,i]=(0,t.useState)({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""}),r=e=>{switch(e){case"Available":return"bg-green-100 text-green-800";case"Busy":default:return"bg-gray-100 text-gray-800";case"In Progress":return"bg-blue-100 text-blue-800";case"Pending":return"bg-yellow-100 text-yellow-800"}},a=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-orange-100 text-orange-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return(0,Xf.jsxs)("div",{className:"space-y-8",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(ug,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Request Care Service"})]}),(0,Xf.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,Xf.jsxs)("button",{onClick:()=>n("immediate"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("immediate"===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Xf.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-current flex items-center justify-center mr-3",children:(0,Xf.jsx)("span",{className:"text-xs font-bold",children:"!"})}),"Need Care Now"]}),(0,Xf.jsxs)("button",{onClick:()=>n("scheduled"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("scheduled"===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Xf.jsx)(Vf,{className:"h-5 w-5 mr-3"}),"Schedule Visit"]})]}),(0,Xf.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Care request submitted:",s),i({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""})},className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type of Care Needed"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("select",{value:s.careType,onChange:e=>i(Le(Le({},s),{},{careType:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure Check","Medication Administration","Wound Care","Physical Therapy","Vital Signs Monitoring","Meal Preparation","Companionship","Transportation","Housekeeping","Emergency Response"].map(e=>(0,Xf.jsx)("option",{value:e,children:e},e))}),(0,Xf.jsx)(Og,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),"scheduled"===e&&(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Date"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("input",{type:"date",value:s.preferredDate,onChange:e=>i(Le(Le({},s),{},{preferredDate:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"mm/dd/yyyy"}),(0,Xf.jsx)(Vf,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Time"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("input",{type:"time",value:s.preferredTime,onChange:e=>i(Le(Le({},s),{},{preferredTime:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"--:--"}),(0,Xf.jsx)(dg,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("textarea",{value:s.additionalNotes,onChange:e=>i(Le(Le({},s),{},{additionalNotes:e.target.value})),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Please describe your symptoms or specific care needs..."}),(0,Xf.jsx)(Dg,{className:"absolute bottom-3 right-3 h-4 w-4 text-gray-400"})]})]}),(0,Xf.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors",children:"immediate"===e?"Request Immediate Care":"Schedule Care Visit"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Caregivers Nearby"})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:[{id:1,name:"Nurse Fatima Abdullahi",specialty:"Geriatric Care",rating:4.8,location:"Victoria Island, Lagos",status:"Available",visits:156,avatar:null},{id:2,name:"Dr. Chinedu Okoro",specialty:"General Medicine",rating:4.9,location:"Ikeja, Lagos",status:"Busy",visits:89,avatar:null}].map(e=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.specialty}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e.rating})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e.location})]})]})]})]}),(0,Xf.jsxs)("div",{className:"text-right",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(r(e.status)),children:e.status}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e.visits," visits"]})]})]},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Recent Care Requests"}),(0,Xf.jsx)("div",{className:"space-y-4",children:[{id:1,title:"Blood Pressure Check",assignedCaregiver:"Nurse Fatima Abdullahi",createdDate:"9/1/2025",scheduledDate:"9/3/2025, 2:00:00 PM",description:"Regular weekly checkup",status:"In Progress",priority:"Medium"},{id:2,title:"Medication Administration",assignedCaregiver:"Caregiver not assigned yet",createdDate:"9/3/2025",scheduledDate:null,description:"Daily medication reminder and administration",status:"Pending",priority:"High"}].map(e=>(0,Xf.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:e.title}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.assignedCaregiver}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{children:e.createdDate})]}),e.scheduledDate&&(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{children:e.scheduledDate})]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,Xf.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(r(e.status)),children:e.status}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(a(e.priority)),children:e.priority})]})]})},e.id))})]})]})},jg=()=>{const e="John Doe",t="john.doe@example.com",n="elderly",s="1950-05-15",i={name:"Alice Johnson",phone:"555-1234"},r="Dr. Smith",a="Penicillin, Shellfish",o="Hypertension, Diabetes Type 2";return(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your personal and medical information"})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Personal Information"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Full Name"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:e})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:t})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Date of Birth"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:s})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Account Type"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900 capitalize",children:n})]})]})]}),(0,Xf.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Personal Info"})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medical Information"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Primary Care Doctor"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:r})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Allergies"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:a})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Medical Conditions"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:o})]})]}),(0,Xf.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Medical Info"})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Emergency Contact"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Name"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:i.name})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,Xf.jsx)("p",{className:"font-medium text-gray-900",children:i.phone})]})]})]}),(0,Xf.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Emergency Contact"})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Health Summary"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Active Medications"}),(0,Xf.jsx)("span",{className:"font-semibold text-gray-900",children:"5"})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Upcoming Appointments"}),(0,Xf.jsx)("span",{className:"font-semibold text-gray-900",children:"2"})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Vital Signs This Week"}),(0,Xf.jsx)("span",{className:"font-semibold text-gray-900",children:"12"})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Medication Adherence"}),(0,Xf.jsx)("span",{className:"font-semibold text-green-600",children:"95%"})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary mt-4",children:[(0,Xf.jsx)(Ff,{className:"h-4 w-4 mr-2"}),"View Health Reports"]})]})]})]})},Lg=Mf("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Mg=Mf("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Ug=Mf("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Vg=()=>{const[e,n]=(0,t.useState)(null),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)([]),[o,c]=(0,t.useState)({}),[l,d]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e={id:1,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",profileImage:null,rating:4.8,totalPatients:8,currentPatients:3,experience:"5 years",joinDate:"2023-06-15",hourlyRate:2500,totalEarnings:21e5,thisMonthEarnings:18e4,performance:{punctuality:95,patientSatisfaction:4.8,taskCompletion:98,communication:4.7,safety:100}};n(e),i([{id:1,patientName:"Adunni Okafor",patientId:"ELD001",time:"09:00",duration:"8 hours",address:"123 Victoria Island, Lagos",tasks:["Morning medication administration","Breakfast preparation","Physical therapy exercises","Lunch preparation","Afternoon medication","Evening care routine"],status:"upcoming",notes:"Patient has diabetes - monitor blood sugar levels",emergencyContact:"+234 801 987 6543"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",time:"14:00",duration:"4 hours",address:"456 Ikoyi, Lagos",tasks:["Medication administration","Light housekeeping","Companionship","Evening meal preparation"],status:"upcoming",notes:"Patient prefers quiet environment",emergencyContact:"+234 803 456 7890"}]),a([{id:1,patientName:"Adunni Okafor",task:"Medication Administration",completedAt:"2024-01-20T08:30:00Z",status:"completed",notes:"Patient took medication without issues"},{id:2,patientName:"Grace Johnson",task:"Physical Therapy",completedAt:"2024-01-20T10:15:00Z",status:"completed",notes:"Completed 30 minutes of exercises"},{id:3,patientName:"Adunni Okafor",task:"Blood Sugar Check",completedAt:"2024-01-20T12:00:00Z",status:"completed",notes:"Blood sugar: 120 mg/dL - within normal range"}]),c(e.performance),d(!1)},1e3)}catch(e){console.error("Error loading caregiver data:",e),d(!1)}})()},[]);const u=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"upcoming":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return l?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-white font-semibold text-lg",children:null===e||void 0===e?void 0:e.name.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Welcome, ",null===e||void 0===e?void 0:e.name]}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Caregiver Dashboard"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,Xf.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Xf.jsx)(qf,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Xf.jsx)(og,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Xf.jsx)(Kf,{className:"h-6 w-6"})})]})]})}),(0,Xf.jsx)("div",{className:"w-full p-8 dashboard-full-width",children:(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:[(0,Xf.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Today's Visits"}),(0,Xf.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:s.length})]}),(0,Xf.jsx)("div",{className:"p-3 bg-blue-50 rounded-xl",children:(0,Xf.jsx)(Vf,{className:"h-8 w-8 text-blue-600"})})]})}),(0,Xf.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Completed Tasks"}),(0,Xf.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:r.filter(e=>"completed"===e.status).length})]}),(0,Xf.jsx)("div",{className:"p-3 bg-green-50 rounded-xl",children:(0,Xf.jsx)(mg,{className:"h-8 w-8 text-green-600"})})]})}),(0,Xf.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Rating"}),(0,Xf.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:null===e||void 0===e?void 0:e.rating})]}),(0,Xf.jsx)("div",{className:"p-3 bg-yellow-50 rounded-xl",children:(0,Xf.jsx)(fg,{className:"h-8 w-8 text-yellow-600"})})]})}),(0,Xf.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"This Month"}),(0,Xf.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["\u20a6",null===e||void 0===e?void 0:e.thisMonthEarnings.toLocaleString()]})]}),(0,Xf.jsx)("div",{className:"p-3 bg-purple-50 rounded-xl",children:(0,Xf.jsx)(sg,{className:"h-8 w-8 text-purple-600"})})]})})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Xf.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Today's Schedule"})}),(0,Xf.jsx)("div",{className:"p-8",children:(0,Xf.jsx)("div",{className:"space-y-6",children:s.map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,Xf.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:e.patientName}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(u(e.status)),children:e.status})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-5 w-5 mr-2 text-gray-500"}),(0,Xf.jsxs)("span",{className:"font-medium",children:[e.time," (",e.duration,")"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-5 w-5 mr-2 text-gray-500"}),(0,Xf.jsx)("span",{className:"font-medium",children:e.address})]})]}),(0,Xf.jsxs)("div",{className:"mb-4",children:[(0,Xf.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Tasks:"}),(0,Xf.jsx)("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:e.tasks.map((e,t)=>(0,Xf.jsxs)("li",{className:"flex items-center text-sm text-gray-600",children:[(0,Xf.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),e]},t))})]}),e.notes&&(0,Xf.jsxs)("div",{className:"mb-4",children:[(0,Xf.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Notes:"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:e.notes})]})]}),(0,Xf.jsxs)("div",{className:"flex flex-col space-y-3 ml-8",children:[(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock in for schedule:",t);var t},className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Clock In"}),(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock out for schedule:",t);var t},className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Clock Out"}),(0,Xf.jsxs)("button",{onClick:()=>{return t=e.patientId,void console.log("Emergency for patient:",t);var t},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium flex items-center justify-center",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 mr-2"}),"Emergency"]})]})]})},e.id))})})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Xf.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Tasks"})}),(0,Xf.jsx)("div",{className:"p-8",children:(0,Xf.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-md transition-shadow",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"p-2 bg-green-50 rounded-lg",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-base font-semibold text-gray-900",children:e.task}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.patientName}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.completedAt).toLocaleString()})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(u(e.status)),children:e.status}),(0,Xf.jsx)("button",{className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",children:(0,Xf.jsx)(Lg,{className:"h-5 w-5"})})]})]},e.id))})})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Xf.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Performance Overview"})}),(0,Xf.jsx)("div",{className:"p-8",children:(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Punctuality"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Xf.jsx)("div",{className:"bg-green-600 h-3 rounded-full",style:{width:"".concat(o.punctuality,"%")}})}),(0,Xf.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[o.punctuality,"%"]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Task Completion"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Xf.jsx)("div",{className:"bg-blue-600 h-3 rounded-full",style:{width:"".concat(o.taskCompletion,"%")}})}),(0,Xf.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[o.taskCompletion,"%"]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Patient Satisfaction"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-5 w-5 text-yellow-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:o.patientSatisfaction})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Communication"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-5 w-5 text-yellow-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:o.communication})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Safety Record"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Xf.jsx)("div",{className:"bg-green-600 h-3 rounded-full",style:{width:"".concat(o.safety,"%")}})}),(0,Xf.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[o.safety,"%"]})]})]})]})})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Xf.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Quick Actions"})}),(0,Xf.jsx)("div",{className:"p-8",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Xf.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Xf.jsx)(ig,{className:"h-8 w-8 text-blue-600 mb-3"}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Messages"})]}),(0,Xf.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Xf.jsx)(Mg,{className:"h-8 w-8 text-green-600 mb-3"}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Photo Update"})]}),(0,Xf.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Xf.jsx)(ag,{className:"h-8 w-8 text-purple-600 mb-3"}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Add Note"})]}),(0,Xf.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Xf.jsx)(Ug,{className:"h-8 w-8 text-orange-600 mb-3"}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Navigation"})]})]})})]})]})]})})]})},Fg=Mf("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Bg=Mf("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Gg=Mf("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Wg=()=>{const[e,n]=(0,t.useState)(new Date),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(new Date);(0,t.useEffect)(()=>{l()},[o]);const l=async()=>{try{a(!0),setTimeout(()=>{i([{id:1,patientName:"Adunni Okafor",patientAge:72,patientAddress:"123 Victoria Island, Lagos",patientPhone:"+234 801 234 5678",appointmentTime:"09:00",duration:60,type:"Home Visit",status:"scheduled",tasks:["Medication administration","Vital signs check","Meal preparation","Light housekeeping"],notes:"Patient has diabetes, check blood sugar levels",priority:"high",estimatedTravelTime:25},{id:2,patientName:"Tunde Adebayo",patientAge:68,patientAddress:"456 Ikoyi, Lagos",patientPhone:"+234 802 345 6789",appointmentTime:"11:30",duration:90,type:"Home Visit",status:"scheduled",tasks:["Physical therapy exercises","Medication reminder","Grocery shopping","Companionship"],notes:"Patient recovering from hip surgery",priority:"medium",estimatedTravelTime:15},{id:3,patientName:"Grace Johnson",patientAge:75,patientAddress:"789 Lekki, Lagos",patientPhone:"+234 803 456 7890",appointmentTime:"14:00",duration:45,type:"Home Visit",status:"completed",tasks:["Medication administration","Vital signs check","Meal preparation"],notes:"Regular checkup visit",priority:"low",estimatedTravelTime:30}]),a(!1)},1e3)}catch(e){console.error("Error loading schedule data:",e),a(!1)}},d=e=>{switch(e){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},u=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},h=e=>e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),p=e=>{const t=new Date(o);t.setDate(t.getDate()+e),c(t)};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Today's Schedule"}),(0,Xf.jsxs)("p",{className:"text-gray-600",children:["Your appointments and tasks for ",h(o)]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("button",{onClick:()=>p(-1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Xf.jsx)(Bg,{className:"h-5 w-5"})}),(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:h(o)}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500",children:[s.filter(e=>"scheduled"===e.status).length," appointments scheduled"]})]}),(0,Xf.jsx)("button",{onClick:()=>p(1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Xf.jsx)(Gg,{className:"h-5 w-5"})})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Schedule Timeline"}),(0,Xf.jsx)("div",{className:"space-y-4",children:s.filter(e=>"scheduled"===e.status).sort((e,t)=>e.appointmentTime.localeCompare(t.appointmentTime)).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-green-600 font-medium",children:e.patientName.split(" ").map(e=>e[0]).join("")})})}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge]}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.priority)),children:[e.priority," priority"]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(u(e.status)),children:e.status})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:[e.appointmentTime," (",e.duration," minutes)"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsx)("span",{children:e.patientAddress})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsx)("span",{children:e.patientPhone})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Ug,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:[e.estimatedTravelTime," min travel time"]})]})]}),(0,Xf.jsx)("div",{className:"mb-3",children:(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.notes})}),(0,Xf.jsxs)("div",{className:"mb-3",children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tasks:"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tasks.map((e,t)=>(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,Xf.jsx)(mg,{className:"h-3 w-3 mr-1"}),e]},t))})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Ug,{className:"h-4 w-4 mr-2"}),"Navigate"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-2"}),"Start Visit"]})]})]})},e.id))})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>"scheduled"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>"completed"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Hours"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.reduce((e,t)=>e+t.duration,0)/60})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"High Priority"}),(0,Xf.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>"high"===e.priority).length})]})]})})]})]})},Hg=Mf("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Kg=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n([{id:1,name:"Adunni Okafor",age:72,gender:"Female",phone:"+234 801 234 5678",address:"123 Victoria Island, Lagos",medicalCondition:"Diabetes",emergencyContact:"+234 802 345 6789",lastVisit:"2024-01-20",nextAppointment:"2024-01-22",status:"active",notes:"Patient has diabetes - monitor blood sugar levels regularly",medications:["Metformin","Insulin"],allergies:["Penicillin"],caregiverNotes:"Very cooperative, prefers morning visits",rating:4.8},{id:2,name:"Grace Johnson",age:68,gender:"Female",phone:"+234 803 456 7890",address:"456 Ikoyi, Lagos",medicalCondition:"Hypertension",emergencyContact:"+234 804 567 8901",lastVisit:"2024-01-19",nextAppointment:"2024-01-21",status:"active",notes:"Patient prefers quiet environment",medications:["Amlodipine","Lisinopril"],allergies:["Shellfish"],caregiverNotes:"Loves gardening, very independent",rating:4.9},{id:3,name:"Michael Adebayo",age:75,gender:"Male",phone:"+234 805 678 9012",address:"789 Lekki, Lagos",medicalCondition:"Arthritis",emergencyContact:"+234 806 789 0123",lastVisit:"2024-01-18",nextAppointment:"2024-01-23",status:"inactive",notes:"Requires assistance with mobility",medications:["Ibuprofen","Calcium"],allergies:["Latex"],caregiverNotes:"Needs help with daily activities",rating:4.7}]),i(!1)},1e3)}catch(e){console.error("Error loading patients:",e),i(!1)}})()},[]);const l=e.filter(e=>{const t=e.name.toLowerCase().includes(r.toLowerCase())||e.medicalCondition.toLowerCase().includes(r.toLowerCase()),n="all"===o||e.status===o;return t&&n}),d=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"critical":return"bg-red-100 text-red-800"}};return s?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"My Patients"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your patient information and care"})]})]}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4",children:(0,Xf.jsxs)("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Xf.jsx)(Ng,{className:"h-5 w-5 mr-2"}),"Add Patient"]})})]})}),(0,Xf.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Xf.jsx)("div",{className:"mb-8",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search patients by name or condition...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:r,onChange:e=>a(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Patients"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"inactive",children:"Inactive"}),(0,Xf.jsx)("option",{value:"critical",children:"Critical"})]}),(0,Xf.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Xf.jsx)(Fg,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:l.map(e=>(0,Xf.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:(0,Xf.jsxs)("div",{className:"p-6",children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-blue-600 font-semibold text-lg",children:e.name.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-600",children:[e.age,"y, ",e.gender]})]})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.status)),children:e.status})]}),(0,Xf.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Xf.jsx)(Ff,{className:"h-4 w-4 mr-2 text-red-500"}),(0,Xf.jsx)("span",{className:"font-medium",children:e.medicalCondition})]}),(0,Xf.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 mr-2 text-green-500"}),(0,Xf.jsx)("span",{children:e.phone})]}),(0,Xf.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-2 text-blue-500"}),(0,Xf.jsx)("span",{children:e.address})]}),(0,Xf.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-2 text-purple-500"}),(0,Xf.jsxs)("span",{children:["Next: ",new Date(e.nextAppointment).toLocaleDateString()]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)("div",{className:"flex items-center",children:[...Array(5)].map((t,n)=>(0,Xf.jsx)(fg,{className:"h-4 w-4 ".concat(n<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300")},n))}),(0,Xf.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:e.rating})]}),(0,Xf.jsxs)("div",{className:"flex space-x-2",children:[(0,Xf.jsxs)("button",{className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center text-sm",children:[(0,Xf.jsx)(Lg,{className:"h-4 w-4 mr-1"}),"View"]}),(0,Xf.jsxs)("button",{className:"flex-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center text-sm",children:[(0,Xf.jsx)(ig,{className:"h-4 w-4 mr-1"}),"Message"]}),(0,Xf.jsx)("button",{className:"px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})})]})]})},e.id))}),0===l.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(Ff,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No patients found"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:r?"Try adjusting your search criteria":"No patients match the selected filter"})]})]})]})},zg=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n([{id:1,title:"Morning Medication Administration",patientName:"Adunni Okafor",patientId:"ELD001",description:"Administer morning diabetes medications and check blood sugar levels",status:"pending",priority:"high",dueDate:"2024-01-21T09:00:00Z",estimatedDuration:30,location:"123 Victoria Island, Lagos",type:"medication",notes:"Patient has diabetes - monitor blood sugar levels",completedAt:null,createdAt:"2024-01-20T08:00:00Z"},{id:2,title:"Physical Therapy Session",patientName:"Grace Johnson",patientId:"ELD002",description:"Assist with 30-minute physical therapy exercises",status:"completed",priority:"medium",dueDate:"2024-01-20T10:00:00Z",estimatedDuration:45,location:"456 Ikoyi, Lagos",type:"therapy",notes:"Patient prefers gentle exercises",completedAt:"2024-01-20T10:30:00Z",createdAt:"2024-01-20T07:00:00Z"},{id:3,title:"Lunch Preparation",patientName:"Adunni Okafor",patientId:"ELD001",description:"Prepare diabetic-friendly lunch meal",status:"in-progress",priority:"medium",dueDate:"2024-01-21T12:00:00Z",estimatedDuration:60,location:"123 Victoria Island, Lagos",type:"meal",notes:"Follow diabetic diet guidelines",completedAt:null,createdAt:"2024-01-20T08:30:00Z"},{id:4,title:"Emergency Response",patientName:"Michael Adebayo",patientId:"ELD003",description:"Respond to emergency alert - check patient condition",status:"pending",priority:"critical",dueDate:"2024-01-21T14:30:00Z",estimatedDuration:15,location:"789 Lekki, Lagos",type:"emergency",notes:"Patient has mobility issues",completedAt:null,createdAt:"2024-01-20T14:15:00Z"},{id:5,title:"Evening Care Routine",patientName:"Grace Johnson",patientId:"ELD002",description:"Evening medication and bedtime routine",status:"pending",priority:"medium",dueDate:"2024-01-21T18:00:00Z",estimatedDuration:45,location:"456 Ikoyi, Lagos",type:"care",notes:"Patient prefers quiet environment",completedAt:null,createdAt:"2024-01-20T17:00:00Z"}]),i(!1)},1e3)}catch(e){console.error("Error loading tasks:",e),i(!1)}})()},[]);const u=e.filter(e=>{const t=e.title.toLowerCase().includes(r.toLowerCase())||e.patientName.toLowerCase().includes(r.toLowerCase()),n="all"===o||e.status===o,s="all"===l||e.priority===l;return t&&n&&s}),h=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},p=e=>{switch(e){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},m=e=>{switch(e){case"medication":return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-blue-600"});case"therapy":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-green-600"});case"meal":return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-orange-600"});case"emergency":return(0,Xf.jsx)(eg,{className:"h-5 w-5 text-red-600"});case"care":return(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-purple-600"});default:return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-gray-600"})}},f=t=>{n(e.map(e=>e.id===t?Le(Le({},e),{},{status:"completed",completedAt:(new Date).toISOString()}):e))};return s?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Xf.jsx)(mg,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your care tasks and assignments"})]})]}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4",children:(0,Xf.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Xf.jsx)(Ng,{className:"h-5 w-5 mr-2"}),"Add Task"]})})]})}),(0,Xf.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Xf.jsx)("div",{className:"mb-8",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search tasks by title or patient name...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:r,onChange:e=>a(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"pending",children:"Pending"}),(0,Xf.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,Xf.jsx)("option",{value:"completed",children:"Completed"}),(0,Xf.jsx)("option",{value:"overdue",children:"Overdue"})]}),(0,Xf.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Priority"}),(0,Xf.jsx)("option",{value:"critical",children:"Critical"}),(0,Xf.jsx)("option",{value:"high",children:"High"}),(0,Xf.jsx)("option",{value:"medium",children:"Medium"}),(0,Xf.jsx)("option",{value:"low",children:"Low"})]}),(0,Xf.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Xf.jsx)(Fg,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsx)("div",{className:"space-y-4",children:u.map(t=>(0,Xf.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:(0,Xf.jsx)("div",{className:"p-6",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,Xf.jsx)("div",{className:"p-2 bg-gray-50 rounded-lg",children:m(t.type)}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t.title}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Xf.jsxs)("span",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-4 w-4 mr-1"}),t.patientName]}),(0,Xf.jsxs)("span",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-1"}),t.location]}),(0,Xf.jsxs)("span",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-1"}),t.estimatedDuration," min"]})]})]})]}),(0,Xf.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-1"}),(0,Xf.jsxs)("span",{children:["Due: ",new Date(t.dueDate).toLocaleDateString()," ",new Date(t.dueDate).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(h(t.status)),children:t.status}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(p(t.priority)),children:t.priority})]}),t.notes&&(0,Xf.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:(0,Xf.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,Xf.jsx)("strong",{children:"Notes:"})," ",t.notes]})})]}),(0,Xf.jsxs)("div",{className:"flex flex-col space-y-2 ml-6",children:["pending"===t.status&&(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("button",{onClick:()=>{return s=t.id,void n(e.map(e=>e.id===s?Le(Le({},e),{},{status:"in-progress"}):e));var s},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Start Task"}),(0,Xf.jsx)("button",{onClick:()=>f(t.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Complete"})]}),"in-progress"===t.status&&(0,Xf.jsx)("button",{onClick:()=>f(t.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Mark Complete"}),"completed"===t.status&&(0,Xf.jsxs)("div",{className:"flex items-center text-green-600 text-sm",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-1"}),"Completed"]}),(0,Xf.jsxs)("div",{className:"flex space-x-1",children:[(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})})]})]})]})})},t.id))}),0===u.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(mg,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tasks found"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:r?"Try adjusting your search criteria":"No tasks match the selected filters"})]})]})]})},qg=Mf("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Yg=Mf("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),Xg=Mf("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Jg=Mf("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),Qg=Mf("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),Zg=Mf("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),$g=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(null),[r,a]=(0,t.useState)([]),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)("");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",lastMessage:"Thank you for the medication reminder",lastMessageTime:"2024-01-21T10:30:00Z",unreadCount:2,avatar:null,status:"online",lastSeen:"2024-01-21T10:35:00Z"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",lastMessage:"See you tomorrow for therapy session",lastMessageTime:"2024-01-21T09:15:00Z",unreadCount:0,avatar:null,status:"offline",lastSeen:"2024-01-21T09:20:00Z"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",lastMessage:"Emergency alert received - all clear now",lastMessageTime:"2024-01-21T08:45:00Z",unreadCount:1,avatar:null,status:"online",lastSeen:"2024-01-21T08:50:00Z"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",lastMessage:"Lunch was delicious, thank you!",lastMessageTime:"2024-01-21T08:00:00Z",unreadCount:0,avatar:null,status:"offline",lastSeen:"2024-01-21T08:05:00Z"}];n(e),i(e[0]),d(!1)},1e3)}catch(e){console.error("Error loading conversations:",e),d(!1)}})()},[]),(0,t.useEffect)(()=>{s&&p(s.id)},[s]);const p=async e=>{try{setTimeout(()=>{a([{id:1,senderId:"caregiver",senderName:"You",message:"Good morning! Time for your morning medication.",timestamp:"2024-01-21T09:00:00Z",type:"text",status:"delivered"},{id:2,senderId:"ELD001",senderName:"Adunni Okafor",message:"Good morning! I'm ready for my medication.",timestamp:"2024-01-21T09:05:00Z",type:"text",status:"read"},{id:3,senderId:"caregiver",senderName:"You",message:"Perfect! I'll be there in 10 minutes.",timestamp:"2024-01-21T09:06:00Z",type:"text",status:"delivered"},{id:4,senderId:"ELD001",senderName:"Adunni Okafor",message:"Thank you for the medication reminder",timestamp:"2024-01-21T10:30:00Z",type:"text",status:"read"}])},500)}catch(t){console.error("Error loading messages:",t)}},m=e.filter(e=>e.patientName.toLowerCase().includes(u.toLowerCase())),f=()=>{if(o.trim()&&s){const t={id:Date.now(),senderId:"caregiver",senderName:"You",message:o.trim(),timestamp:(new Date).toISOString(),type:"text",status:"sending"};a([...r,t]),c(""),n(e.map(e=>e.id===s.id?Le(Le({},e),{},{lastMessage:t.message,lastMessageTime:t.timestamp}):e))}},g=e=>"online"===e?"bg-green-500":"bg-gray-400",y=e=>{const t=new Date(e),n=(new Date-t)/36e5;return n<1?"Just now":n<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString()};return l?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Xf.jsx)(Gf,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Communicate with your patients and family members"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("button",{className:"p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:(0,Xf.jsx)(pg,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Xf.jsx)(Bf,{className:"h-5 w-5"})})]})]})}),(0,Xf.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Xf.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Xf.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value)})]})}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto",children:m.map(e=>(0,Xf.jsx)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-blue-50 border-blue-200":""),onClick:()=>i(e),children:(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-gray-600"})}),(0,Xf.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white ".concat(g(e.status))})]}),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.patientName}),(0,Xf.jsx)("span",{className:"text-xs text-gray-500",children:y(e.lastMessageTime)})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 truncate mt-1",children:e.lastMessage}),e.unreadCount>0&&(0,Xf.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:["ID: ",e.patientId]}),(0,Xf.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unreadCount})]})]})]})},e.id))})]}),(0,Xf.jsx)("div",{className:"flex-1 flex flex-col",children:s?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})}),(0,Xf.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white ".concat(g(s.status))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:s.patientName}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",s.patientId," \u2022 ",s.status]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(pg,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Bf,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(qg,{className:"h-5 w-5"})})]})]})}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:r.map(e=>(0,Xf.jsx)("div",{className:"flex ".concat("caregiver"===e.senderId?"justify-end":"justify-start"),children:(0,Xf.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("caregiver"===e.senderId?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"),children:[(0,Xf.jsx)("p",{className:"text-sm",children:e.message}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between mt-1 text-xs ".concat("caregiver"===e.senderId?"text-blue-100":"text-gray-500"),children:[(0,Xf.jsx)("span",{children:y(e.timestamp)}),"caregiver"===e.senderId&&(0,Xf.jsx)("div",{className:"flex items-center ml-2",children:"read"===e.status?(0,Xf.jsx)(Yg,{className:"h-3 w-3"}):(0,Xf.jsx)(Xg,{className:"h-3 w-3"})})]})]})},e.id))}),(0,Xf.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Jg,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Mg,{className:"h-5 w-5"})}),(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsx)("input",{type:"text",placeholder:"Type a message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),onKeyPress:e=>"Enter"===e.key&&f()})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Qg,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{onClick:f,className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Xf.jsx)(Zg,{className:"h-5 w-5"})})]})})]}):(0,Xf.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Gf,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Choose a conversation from the list to start messaging"})]})})})]})]})},ey=Mf("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),ty=Mf("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),ny=Mf("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),sy=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(null),[r,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",address:"123 Victoria Island, Lagos",coordinates:{lat:6.4281,lng:3.4219},distance:2.5,estimatedTime:15,priority:"high",visitTime:"2024-01-21T09:00:00Z",status:"scheduled",notes:"Morning medication administration",contactNumber:"+234 801 234 5678",lastVisited:"2024-01-20T09:00:00Z"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",address:"456 Ikoyi, Lagos",coordinates:{lat:6.4474,lng:3.4288},distance:5.2,estimatedTime:25,priority:"medium",visitTime:"2024-01-21T10:00:00Z",status:"scheduled",notes:"Physical therapy session",contactNumber:"+234 802 345 6789",lastVisited:"2024-01-19T10:00:00Z"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",address:"789 Lekki, Lagos",coordinates:{lat:6.4698,lng:3.5852},distance:8.7,estimatedTime:35,priority:"low",visitTime:"2024-01-21T14:00:00Z",status:"scheduled",notes:"Regular checkup and medication review",contactNumber:"+234 803 456 7890",lastVisited:"2024-01-18T14:00:00Z"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",address:"321 Surulere, Lagos",coordinates:{lat:6.5018,lng:3.3584},distance:12.3,estimatedTime:45,priority:"medium",visitTime:"2024-01-21T16:00:00Z",status:"scheduled",notes:"Lunch preparation and care routine",contactNumber:"+234 804 567 8901",lastVisited:"2024-01-17T16:00:00Z"}];n(e),i(e[0]),c(!1)},1e3)}catch(e){console.error("Error loading routes:",e),c(!1)}})()},[]);const p=e.filter(e=>{const t=e.patientName.toLowerCase().includes(l.toLowerCase())||e.address.toLowerCase().includes(l.toLowerCase()),n="all"===u||e.priority===u;return t&&n}),m=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},f=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),y=e=>new Date(e).toLocaleDateString();return o?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-purple-600 flex items-center justify-center",children:(0,Xf.jsx)(Ug,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Navigation"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Plan your routes and navigate to patient locations"})]})]}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4",children:(0,Xf.jsxs)("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[(0,Xf.jsx)(ey,{className:"h-5 w-5 mr-2"}),"Optimize Route"]})})]})}),(0,Xf.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Xf.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Xf.jsxs)("div",{className:"p-4 border-b border-gray-200 space-y-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search patients or addresses...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value)})]}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Priorities"}),(0,Xf.jsx)("option",{value:"high",children:"High Priority"}),(0,Xf.jsx)("option",{value:"medium",children:"Medium Priority"}),(0,Xf.jsx)("option",{value:"low",children:"Low Priority"})]})]}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto",children:p.map(e=>(0,Xf.jsxs)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-purple-50 border-purple-200":""),onClick:()=>i(e),children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-600",children:["ID: ",e.patientId]})]}),(0,Xf.jsxs)("div",{className:"flex flex-col items-end space-y-1",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(m(e.priority)),children:e.priority}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(f(e.status)),children:e.status})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center text-xs text-gray-600 mb-2",children:[(0,Xf.jsx)(gg,{className:"h-3 w-3 mr-1"}),(0,Xf.jsx)("span",{className:"truncate",children:e.address})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsxs)("span",{className:"flex items-center",children:[(0,Xf.jsx)(ty,{className:"h-3 w-3 mr-1"}),e.distance," km"]}),(0,Xf.jsxs)("span",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-3 w-3 mr-1"}),e.estimatedTime," min"]})]}),(0,Xf.jsx)("span",{className:"font-medium",children:g(e.visitTime)})]})]},e.id))})]}),(0,Xf.jsx)("div",{className:"flex-1 flex flex-col",children:s?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsxs)("div",{className:"h-1/2 bg-gray-200 relative",children:[(0,Xf.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(gg,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Interactive Map"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Map integration would go here"})]})}),(0,Xf.jsx)("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-3",children:(0,Xf.jsxs)("div",{className:"text-sm",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-1",children:[(0,Xf.jsx)(ty,{className:"h-4 w-4 mr-2 text-blue-600"}),(0,Xf.jsxs)("span",{className:"font-medium",children:[s.distance," km"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-2 text-green-600"}),(0,Xf.jsxs)("span",{className:"font-medium",children:[s.estimatedTime," min"]})]})]})})]}),(0,Xf.jsx)("div",{className:"h-1/2 bg-white border-t border-gray-200 overflow-y-auto",children:(0,Xf.jsxs)("div",{className:"p-6",children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:s.patientName}),(0,Xf.jsxs)("p",{className:"text-gray-600",children:["ID: ",s.patientId]})]}),(0,Xf.jsxs)("div",{className:"flex space-x-2",children:["scheduled"===s.status&&(0,Xf.jsxs)("button",{onClick:()=>{return t=s,void n(e.map(e=>e.id===t.id?Le(Le({},e),{},{status:"in-progress"}):e));var t},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[(0,Xf.jsx)(Ug,{className:"h-4 w-4 mr-2"}),"Start Navigation"]}),"in-progress"===s.status&&(0,Xf.jsxs)("button",{onClick:()=>{return t=s,void n(e.map(e=>e.id===t.id?Le(Le({},e),{},{status:"completed"}):e));var t},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-2"}),"Complete Visit"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Route Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Address"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:s.address})]})]}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(ny,{className:"h-4 w-4"})})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Visit Time"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:g(s.visitTime)})]})]}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:y(s.visitTime)})]}),(0,Xf.jsx)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(ty,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Distance & Time"}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-600",children:[s.distance," km \u2022 ",s.estimatedTime," min"]})]})]})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Patient Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Contact"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:s.contactNumber})]})]}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]}),(0,Xf.jsx)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Last Visit"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:y(s.lastVisited)})]})]})}),(0,Xf.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,Xf.jsxs)("div",{className:"flex items-start",children:[(0,Xf.jsx)(Gf,{className:"h-5 w-5 text-gray-600 mr-3 mt-0.5"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Notes"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:s.notes})]})]})})]})]})]})]})})]}):(0,Xf.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Ug,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a route"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Choose a patient route from the list to view details and start navigation"})]})})})]})]})},iy=Mf("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),ry=Mf("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),ay=Mf("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),oy=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n([{id:1,patientName:"Adunni Okafor",patientId:"ELD001",title:"Morning medication administration",description:"Patient taking morning diabetes medication as prescribed",category:"medication",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T09:30:00Z",location:"123 Victoria Island, Lagos",tags:["medication","morning","diabetes"],status:"approved",notes:"Patient compliant with medication schedule"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",title:"Physical therapy progress",description:"Patient completing physical therapy exercises",category:"therapy",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T10:15:00Z",location:"456 Ikoyi, Lagos",tags:["therapy","exercise","progress"],status:"pending",notes:"Good progress in mobility exercises"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",title:"Lunch meal preparation",description:"Healthy diabetic-friendly meal prepared",category:"meal",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T12:45:00Z",location:"789 Lekki, Lagos",tags:["meal","nutrition","diabetic"],status:"approved",notes:"Meal follows dietary guidelines"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",title:"Evening care routine",description:"Patient ready for evening medication and bedtime routine",category:"care",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T18:30:00Z",location:"321 Surulere, Lagos",tags:["care","evening","routine"],status:"pending",notes:"Patient comfortable and ready for rest"},{id:5,patientName:"Adunni Okafor",patientId:"ELD001",title:"Blood sugar monitoring",description:"Blood glucose level check - within normal range",category:"health",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T14:00:00Z",location:"123 Victoria Island, Lagos",tags:["health","monitoring","diabetes"],status:"approved",notes:"Blood sugar levels stable"}]),i(!1)},1e3)}catch(e){console.error("Error loading photos:",e),i(!1)}})()},[]);const f=e.filter(e=>{const t=e.title.toLowerCase().includes(r.toLowerCase())||e.patientName.toLowerCase().includes(r.toLowerCase())||e.description.toLowerCase().includes(r.toLowerCase()),n="all"===o||e.patientId===o,s="all"===l||e.category===l;return t&&n&&s}),g=e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=e=>{switch(e){case"medication":return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-blue-600"});case"therapy":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-green-600"});case"meal":return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-orange-600"});case"care":return(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-purple-600"});case"health":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-red-600"});default:return(0,Xf.jsx)(iy,{className:"h-5 w-5 text-gray-600"})}},v=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return s?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-indigo-600 flex items-center justify-center",children:(0,Xf.jsx)(Mg,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Photo Updates"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Document patient care activities with photos and updates"})]})]}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4",children:(0,Xf.jsxs)("button",{onClick:()=>{m(!0)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center",children:[(0,Xf.jsx)(Ng,{className:"h-5 w-5 mr-2"}),"Upload Photo"]})})]})}),(0,Xf.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Xf.jsx)("div",{className:"mb-8",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search photos by title, patient, or description...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:r,onChange:e=>a(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Patients"}),(0,Xf.jsx)("option",{value:"ELD001",children:"Adunni Okafor"}),(0,Xf.jsx)("option",{value:"ELD002",children:"Grace Johnson"}),(0,Xf.jsx)("option",{value:"ELD003",children:"Michael Adebayo"}),(0,Xf.jsx)("option",{value:"ELD004",children:"Sarah Williams"})]}),(0,Xf.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Categories"}),(0,Xf.jsx)("option",{value:"medication",children:"Medication"}),(0,Xf.jsx)("option",{value:"therapy",children:"Therapy"}),(0,Xf.jsx)("option",{value:"meal",children:"Meal"}),(0,Xf.jsx)("option",{value:"care",children:"Care"}),(0,Xf.jsx)("option",{value:"health",children:"Health"})]}),(0,Xf.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Xf.jsx)(Fg,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:f.map(t=>{return(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("div",{className:"aspect-w-16 aspect-h-12 bg-gray-200 rounded-t-xl overflow-hidden",children:(0,Xf.jsx)("div",{className:"w-full h-48 bg-gray-200 flex items-center justify-center",children:(0,Xf.jsx)(iy,{className:"h-16 w-16 text-gray-400"})})}),(0,Xf.jsx)("div",{className:"absolute top-3 left-3",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(g(t.status)),children:t.status})}),(0,Xf.jsx)("div",{className:"absolute top-3 right-3",children:(0,Xf.jsxs)("div",{className:"flex space-x-1",children:[(0,Xf.jsx)("button",{className:"p-1 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 transition-all",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4 text-gray-600"})}),(0,Xf.jsx)("button",{className:"p-1 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 transition-all",children:(0,Xf.jsx)(ry,{className:"h-4 w-4 text-gray-600"})})]})})]}),(0,Xf.jsxs)("div",{className:"p-4",children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Xf.jsx)("h3",{className:"text-sm font-semibold text-gray-900 line-clamp-2",children:t.title}),(0,Xf.jsx)("div",{className:"p-1 bg-gray-100 rounded-lg ml-2",children:y(t.category)})]}),(0,Xf.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),(0,Xf.jsxs)("div",{className:"space-y-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Xf.jsx)(Yf,{className:"h-3 w-3 mr-1"}),(0,Xf.jsx)("span",{children:t.patientName})]}),(0,Xf.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Xf.jsx)(Vf,{className:"h-3 w-3 mr-1"}),(0,Xf.jsx)("span",{children:(s=t.uploadedAt,new Date(s).toLocaleDateString())})]}),(0,Xf.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Xf.jsx)(dg,{className:"h-3 w-3 mr-1"}),(0,Xf.jsx)("span",{children:v(t.uploadedAt)})]}),(0,Xf.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Xf.jsx)(gg,{className:"h-3 w-3 mr-1"}),(0,Xf.jsx)("span",{className:"truncate",children:t.location})]})]}),(0,Xf.jsxs)("div",{className:"mt-3 flex flex-wrap gap-1",children:[t.tags.slice(0,3).map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700",children:e},t)),t.tags.length>3&&(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700",children:["+",t.tags.length-3]})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,Xf.jsx)("button",{onClick:()=>h(t),className:"px-3 py-1 text-xs bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"View Details"}),(0,Xf.jsxs)("div",{className:"flex space-x-1",children:[(0,Xf.jsx)("button",{className:"p-1 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>{return s=t.id,void n(e.filter(e=>e.id!==s));var s},className:"p-1 text-gray-400 hover:text-red-600",children:(0,Xf.jsx)(Rg,{className:"h-4 w-4"})})]})]})]})]},t.id);var s})}),0===f.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(Mg,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No photos found"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:r?"Try adjusting your search criteria":"No photos match the selected filters"})]})]}),p&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Xf.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Photo Update"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Patient"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,Xf.jsx)("option",{children:"Adunni Okafor"}),(0,Xf.jsx)("option",{children:"Grace Johnson"}),(0,Xf.jsx)("option",{children:"Michael Adebayo"}),(0,Xf.jsx)("option",{children:"Sarah Williams"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,Xf.jsx)("option",{value:"medication",children:"Medication"}),(0,Xf.jsx)("option",{value:"therapy",children:"Therapy"}),(0,Xf.jsx)("option",{value:"meal",children:"Meal"}),(0,Xf.jsx)("option",{value:"care",children:"Care"}),(0,Xf.jsx)("option",{value:"health",children:"Health"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),(0,Xf.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter photo title"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,Xf.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:"3",placeholder:"Enter photo description"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Photo"}),(0,Xf.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,Xf.jsx)(ay,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"})]})]})]}),(0,Xf.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),(0,Xf.jsx)("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Upload Photo"})]})]})})]})},cy=()=>{var e,n,s,i,r,a,o,c,l,d,u,h,p,m;const[f,g]=(0,t.useState)({}),[y,v]=(0,t.useState)(!0),[_,E]=(0,t.useState)("week"),[b,x]=(0,t.useState)("overall");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{g({overall:{rating:4.8,totalPatients:12,totalTasks:156,completedTasks:148,onTimeRate:94.9,patientSatisfaction:96.2,emergencyResponseTime:8.5},weekly:{tasksCompleted:32,tasksOnTime:30,patientsServed:8,hoursWorked:40,emergencyResponses:2,patientCalls:15,medicationAdministrations:24,therapySessions:8},monthly:{tasksCompleted:148,tasksOnTime:141,patientsServed:12,hoursWorked:160,emergencyResponses:8,patientCalls:65,medicationAdministrations:96,therapySessions:32},trends:{tasksCompleted:[28,32,30,35,32,38,32],onTimeRate:[92,94,91,96,94,98,95],patientSatisfaction:[94,95,93,97,96,98,96]},achievements:[{id:1,title:"Perfect Week",description:"Completed all tasks on time for 5 consecutive days",icon:"\ud83c\udfc6",earnedDate:"2024-01-20",category:"consistency"},{id:2,title:"Emergency Response Hero",description:"Responded to emergency calls within 5 minutes",icon:"\ud83d\udea8",earnedDate:"2024-01-18",category:"emergency"},{id:3,title:"Patient Favorite",description:"Received 5-star ratings from 10+ patients",icon:"\u2b50",earnedDate:"2024-01-15",category:"satisfaction"}],patientFeedback:[{id:1,patientName:"Adunni Okafor",rating:5,comment:"Excellent care and always on time. Very professional and caring.",date:"2024-01-20",category:"medication"},{id:2,patientName:"Grace Johnson",rating:5,comment:"The therapy sessions have been very helpful. Thank you for your patience.",date:"2024-01-19",category:"therapy"},{id:3,patientName:"Michael Adebayo",rating:4,comment:"Good care overall. Sometimes a bit rushed but very knowledgeable.",date:"2024-01-18",category:"general"}]}),v(!1)},1e3)}catch(e){console.error("Error loading performance data:",e),v(!1)}})()},[]);const w=(e,t)=>"rate"===t?e>=95?"text-green-600":e>=85?"text-yellow-600":"text-red-600":"text-gray-900",S=f[_]||{};f.trends;return y?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Xf.jsx)(sg,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Performance"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Track your care performance and achievements"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsxs)("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:_,onChange:e=>E(e.target.value),children:[(0,Xf.jsx)("option",{value:"week",children:"This Week"}),(0,Xf.jsx)("option",{value:"monthly",children:"This Month"}),(0,Xf.jsx)("option",{value:"overall",children:"Overall"})]}),(0,Xf.jsxs)("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Xf.jsx)(ry,{className:"h-5 w-5 mr-2"}),"Export Report"]})]})]})}),(0,Xf.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Overall Rating"}),(0,Xf.jsx)("p",{className:"text-3xl font-bold ".concat((N=(null===(e=f.overall)||void 0===e?void 0:e.rating)||0,N>=4.5?"text-green-600":N>=3.5?"text-yellow-600":"text-red-600")),children:(null===(n=f.overall)||void 0===n?void 0:n.rating)||0})]}),(0,Xf.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-xl flex items-center justify-center",children:(0,Xf.jsx)(fg,{className:"h-6 w-6 text-green-600"})})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Based on patient feedback"})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Tasks Completed"}),(0,Xf.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:S.tasksCompleted||0})]}),(0,Xf.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-blue-600"})})]}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:[S.tasksOnTime||0," on time (",Math.round((S.tasksOnTime||0)/(S.tasksCompleted||1)*100),"%)"]})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Patients Served"}),(0,Xf.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:S.patientsServed||(null===(s=f.overall)||void 0===s?void 0:s.totalPatients)||0})]}),(0,Xf.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-xl flex items-center justify-center",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-purple-600"})})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Active patients"})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Emergency Response"}),(0,Xf.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:[(null===(i=f.overall)||void 0===i?void 0:i.emergencyResponseTime)||0,"m"]})]}),(0,Xf.jsx)("div",{className:"h-12 w-12 bg-red-100 rounded-xl flex items-center justify-center",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Average response time"})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,Xf.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key Performance Indicators"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"On-Time Rate"}),(0,Xf.jsxs)("span",{className:"text-lg font-semibold ".concat(w((null===(r=f.overall)||void 0===r?void 0:r.onTimeRate)||0,"rate")),children:[(null===(a=f.overall)||void 0===a?void 0:a.onTimeRate)||0,"%"]})]}),(0,Xf.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Xf.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat((null===(o=f.overall)||void 0===o?void 0:o.onTimeRate)||0,"%")}})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Patient Satisfaction"}),(0,Xf.jsxs)("span",{className:"text-lg font-semibold ".concat(w((null===(c=f.overall)||void 0===c?void 0:c.patientSatisfaction)||0,"rate")),children:[(null===(l=f.overall)||void 0===l?void 0:l.patientSatisfaction)||0,"%"]})]}),(0,Xf.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Xf.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat((null===(d=f.overall)||void 0===d?void 0:d.patientSatisfaction)||0,"%")}})})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Hours Worked"}),(0,Xf.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:S.hoursWorked||0})]})}),(0,Xf.jsx)("div",{className:"space-y-4",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Emergency Responses"}),(0,Xf.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:S.emergencyResponses||0})]})})]})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Activity Breakdown"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(ag,{className:"h-5 w-5 text-blue-600 mr-3"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Medication Administration"})]}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.medicationAdministrations||0})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-green-600 mr-3"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Therapy Sessions"})]}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.therapySessions||0})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-5 w-5 text-purple-600 mr-3"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Patient Calls"})]}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.patientCalls||0})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-5 w-5 text-red-600 mr-3"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Emergency Responses"})]}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:S.emergencyResponses||0})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Achievements"}),(0,Xf.jsx)("div",{className:"space-y-3",children:null===(u=f.achievements)||void 0===u?void 0:u.map(e=>(0,Xf.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("div",{className:"text-2xl",children:e.icon}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,Xf.jsx)("p",{className:"text-xs text-gray-600",children:e.description}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.earnedDate).toLocaleDateString()})]})]},e.id))})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Feedback"}),(0,Xf.jsx)("div",{className:"space-y-3",children:null===(h=f.patientFeedback)||void 0===h?void 0:h.map(e=>(0,Xf.jsxs)("div",{className:"border-b border-gray-100 pb-3 last:border-b-0",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("div",{className:"flex items-center",children:[...Array(5)].map((t,n)=>(0,Xf.jsx)(fg,{className:"h-3 w-3 ".concat(n<e.rating?"text-yellow-400 fill-current":"text-gray-300")},n))})]}),(0,Xf.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:e.comment}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleDateString()})]},e.id))})]}),(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Goals"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-blue-900",children:"On-Time Rate"}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-blue-900",children:"95%"})]}),(0,Xf.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,Xf.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat((null===(p=f.overall)||void 0===p?void 0:p.onTimeRate)||0,"%")}})})]}),(0,Xf.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-green-900",children:"Patient Satisfaction"}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-green-900",children:"98%"})]}),(0,Xf.jsx)("div",{className:"w-full bg-green-200 rounded-full h-2",children:(0,Xf.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat((null===(m=f.overall)||void 0===m?void 0:m.patientSatisfaction)||0,"%")}})})]}),(0,Xf.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-purple-900",children:"Emergency Response"}),(0,Xf.jsx)("span",{className:"text-sm font-semibold text-purple-900",children:"<5 min"})]}),(0,Xf.jsx)("div",{className:"w-full bg-purple-200 rounded-full h-2",children:(0,Xf.jsx)("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:"85%"}})})]})]})]})]})]})]})]});var N},ly=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(null),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",type:"medical",severity:"critical",description:"Patient experiencing chest pain and difficulty breathing",location:"123 Victoria Island, Lagos",coordinates:{lat:6.4281,lng:3.4219},reportedAt:"2024-01-21T14:30:00Z",status:"active",reportedBy:"Patient",contactNumber:"+234 801 234 5678",emergencyContacts:[{name:"Dr. Adebayo",number:"+234 805 123 4567",type:"doctor"},{name:"Family Contact",number:"+234 802 345 6789",type:"family"}],actions:[{timestamp:"2024-01-21T14:30:00Z",action:"Emergency reported",user:"System"},{timestamp:"2024-01-21T14:31:00Z",action:"Caregiver notified",user:"System"},{timestamp:"2024-01-21T14:32:00Z",action:"En route to patient",user:"You"}],notes:"Patient has diabetes and hypertension. Last medication taken at 9 AM."},{id:2,patientName:"Grace Johnson",patientId:"ELD002",type:"fall",severity:"high",description:"Patient fell in bathroom and cannot get up",location:"456 Ikoyi, Lagos",coordinates:{lat:6.4474,lng:3.4288},reportedAt:"2024-01-21T12:15:00Z",status:"resolved",reportedBy:"Caregiver",contactNumber:"+234 802 345 6789",emergencyContacts:[{name:"Dr. Johnson",number:"+234 806 234 5678",type:"doctor"},{name:"Son - David",number:"+234 803 456 7890",type:"family"}],actions:[{timestamp:"2024-01-21T12:15:00Z",action:"Fall reported",user:"Caregiver"},{timestamp:"2024-01-21T12:20:00Z",action:"Patient assessed",user:"You"},{timestamp:"2024-01-21T12:25:00Z",action:"Patient assisted to bed",user:"You"},{timestamp:"2024-01-21T12:30:00Z",action:"Doctor contacted",user:"You"},{timestamp:"2024-01-21T12:35:00Z",action:"Emergency resolved",user:"You"}],notes:"No serious injuries. Patient is comfortable and resting."},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",type:"medication",severity:"medium",description:"Patient missed critical medication and showing symptoms",location:"789 Lekki, Lagos",coordinates:{lat:6.4698,lng:3.5852},reportedAt:"2024-01-21T10:45:00Z",status:"in-progress",reportedBy:"Family Member",contactNumber:"+234 803 456 7890",emergencyContacts:[{name:"Dr. Adebayo",number:"+234 807 345 6789",type:"doctor"},{name:"Wife - Mary",number:"+234 804 567 8901",type:"family"}],actions:[{timestamp:"2024-01-21T10:45:00Z",action:"Medication emergency reported",user:"Family"},{timestamp:"2024-01-21T10:50:00Z",action:"Caregiver dispatched",user:"System"},{timestamp:"2024-01-21T11:00:00Z",action:"Arrived at patient location",user:"You"},{timestamp:"2024-01-21T11:05:00Z",action:"Medication administered",user:"You"}],notes:"Patient feeling better after medication. Monitoring for any adverse effects."}];n(e),i(e[0]),a(!1)},1e3)}catch(e){console.error("Error loading emergencies:",e),a(!1)}})()},[]);const p=e.filter(e=>{const t=e.patientName.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase()),n="all"===l||e.status===l;return t&&n}),m=e=>{switch(e){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},f=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"resolved":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"medical":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-red-600"});case"fall":return(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-orange-600"});case"medication":return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-blue-600"});case"fire":return(0,Xf.jsx)(yg,{className:"h-5 w-5 text-red-600"});default:return(0,Xf.jsx)(eg,{className:"h-5 w-5 text-gray-600"})}},y=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),v=e=>new Date(e).toLocaleDateString(),_=(t,r)=>{const a={timestamp:(new Date).toISOString(),action:r,user:"You"};n(e.map(e=>e.id===t?Le(Le({},e),{},{actions:[...e.actions,a],status:r.includes("resolved")?"resolved":r.includes("responding")?"in-progress":e.status}):e)),(null===s||void 0===s?void 0:s.id)===t&&i(Le(Le({},s),{},{actions:[...s.actions,a],status:r.includes("resolved")?"resolved":r.includes("responding")?"in-progress":s.status}))};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-red-600 flex items-center justify-center",children:(0,Xf.jsx)(eg,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Response"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage emergency situations and patient safety"})]})]}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4",children:(0,Xf.jsxs)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center",children:[(0,Xf.jsx)(Ng,{className:"h-5 w-5 mr-2"}),"Report Emergency"]})})]})}),(0,Xf.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Xf.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Xf.jsxs)("div",{className:"p-4 border-b border-gray-200 space-y-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search emergencies...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value)})]}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,Xf.jsx)("option",{value:"resolved",children:"Resolved"}),(0,Xf.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto",children:p.map(e=>(0,Xf.jsxs)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-red-50 border-red-200":""),onClick:()=>i(e),children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[g(e.type),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-600",children:["ID: ",e.patientId]})]})]}),(0,Xf.jsxs)("div",{className:"flex flex-col items-end space-y-1",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ".concat(m(e.severity)),children:e.severity}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(f(e.status)),children:e.status})]})]}),(0,Xf.jsx)("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:e.description}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-3 w-3 mr-1"}),(0,Xf.jsx)("span",{children:y(e.reportedAt)})]}),(0,Xf.jsx)("span",{className:"font-medium",children:v(e.reportedAt)})]})]},e.id))})]}),(0,Xf.jsx)("div",{className:"flex-1 flex flex-col",children:s?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:g(s.type)}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:s.patientName}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",s.patientId," \u2022 ",s.type," emergency"]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat(m(s.severity)),children:s.severity}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(f(s.status)),children:s.status})]})]})}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,Xf.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Emergency Details"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Description"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:s.description})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Location"})]}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:s.location})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Reported At"})]}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-600",children:[y(s.reportedAt)," ",v(s.reportedAt)]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Reported By"})]}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:s.reportedBy})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Emergency Contacts"}),(0,Xf.jsx)("div",{className:"space-y-3",children:s.emergencyContacts.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("p",{className:"text-xs text-gray-600",children:e.type}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.number})]}),(0,Xf.jsx)("button",{onClick:()=>(e=>{console.log("Calling ".concat(e.name," at ").concat(e.number))})(e),className:"p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Action Timeline"}),(0,Xf.jsx)("div",{className:"space-y-3",children:s.actions.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-2"}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.action}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-600",children:[y(e.timestamp)," \u2022 ",e.user]})]})]},t))})]}),s.notes&&(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Notes"}),(0,Xf.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:s.notes})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Quick Actions"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["active"===s.status&&(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsxs)("button",{onClick:()=>_(s.id,"Responding to emergency"),className:"p-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:[(0,Xf.jsx)($f,{className:"h-5 w-5 mx-auto mb-1"}),"Responding"]}),(0,Xf.jsxs)("button",{onClick:()=>_(s.id,"Emergency resolved"),className:"p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[(0,Xf.jsx)(mg,{className:"h-5 w-5 mx-auto mb-1"}),"Resolve"]})]}),(0,Xf.jsxs)("button",{className:"p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[(0,Xf.jsx)(Gf,{className:"h-5 w-5 mx-auto mb-1"}),"Message"]}),(0,Xf.jsxs)("button",{className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:[(0,Xf.jsx)(Mg,{className:"h-5 w-5 mx-auto mb-1"}),"Photo"]})]})]})]})})]}):(0,Xf.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(eg,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select an emergency"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Choose an emergency from the list to view details and take action"})]})})})]}),u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Xf.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Report Emergency"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Patient"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Xf.jsx)("option",{children:"Adunni Okafor"}),(0,Xf.jsx)("option",{children:"Grace Johnson"}),(0,Xf.jsx)("option",{children:"Michael Adebayo"}),(0,Xf.jsx)("option",{children:"Sarah Williams"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Type"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Xf.jsx)("option",{value:"medical",children:"Medical"}),(0,Xf.jsx)("option",{value:"fall",children:"Fall"}),(0,Xf.jsx)("option",{value:"medication",children:"Medication"}),(0,Xf.jsx)("option",{value:"fire",children:"Fire"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Xf.jsx)("option",{value:"critical",children:"Critical"}),(0,Xf.jsx)("option",{value:"high",children:"High"}),(0,Xf.jsx)("option",{value:"medium",children:"Medium"}),(0,Xf.jsx)("option",{value:"low",children:"Low"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,Xf.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:"3",placeholder:"Describe the emergency situation..."})]})]}),(0,Xf.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,Xf.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),(0,Xf.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Report Emergency"})]})]})})]})},dy=Mf("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),uy=Mf("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),hy=()=>{var e,n,s,i,r,a,o,c,l,d,u,h,p,m,f,g,y,v,_,E,b,x,w;const[S,N]=(0,t.useState)({}),[T,C]=(0,t.useState)(!0),[R,I]=(0,t.useState)("profile"),[A,O]=(0,t.useState)(!1),[k,D]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{N({profile:{firstName:"Sarah",lastName:"Johnson",email:"sarah.johnson@elderx.com",phone:"+234 805 123 4567",profileImage:null,dateOfBirth:"1985-03-15",address:"456 Victoria Island, Lagos",emergencyContact:"+234 802 345 6789",licenseNumber:"CAR123456",specialization:"Elderly Care",experience:"8 years",languages:["English","Yoruba","Hausa"],bio:"Dedicated caregiver with 8 years of experience in elderly care. Specialized in diabetes management and physical therapy assistance."},notifications:{emailNotifications:!0,smsNotifications:!0,pushNotifications:!0,taskReminders:!0,emergencyAlerts:!0,appointmentReminders:!0,medicationAlerts:!0,weeklyReports:!0,patientUpdates:!0,systemUpdates:!1},privacy:{profileVisibility:"private",locationSharing:!0,dataCollection:!0,analytics:!1,marketingEmails:!1,dataRetention:"2 years"},preferences:{theme:"light",language:"en",timezone:"Africa/Lagos",dateFormat:"DD/MM/YYYY",timeFormat:"24h",workingHours:{start:"08:00",end:"18:00"},breakDuration:30,maxPatientsPerDay:8},security:{twoFactorAuth:!1,biometricLogin:!0,sessionTimeout:30,passwordChangeRequired:!1,lastPasswordChange:"2024-01-01",loginNotifications:!0}}),C(!1)},1e3)}catch(e){console.error("Error loading settings:",e),C(!1)}})()},[]);const P=(e,t,n)=>{N(s=>Le(Le({},s),{},{[e]:Le(Le({},s[e]),{},{[t]:n})}))},j=[{id:"profile",name:"Profile",icon:Yf},{id:"notifications",name:"Notifications",icon:qf},{id:"privacy",name:"Privacy",icon:cg},{id:"preferences",name:"Preferences",icon:og},{id:"security",name:"Security",icon:cg}];return T?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Xf.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-600 flex items-center justify-center",children:(0,Xf.jsx)(og,{className:"h-8 w-8 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]})]}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4",children:(0,Xf.jsxs)("button",{onClick:()=>{console.log("Saving settings:",S)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Xf.jsx)(dy,{className:"h-5 w-5 mr-2"}),"Save Changes"]})})]})}),(0,Xf.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Xf.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 flex flex-col",children:(0,Xf.jsx)("div",{className:"p-4",children:(0,Xf.jsx)("nav",{className:"space-y-1",children:j.map(e=>{const t=e.icon;return(0,Xf.jsxs)("button",{onClick:()=>I(e.id),className:"w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(R===e.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"h-5 w-5 mr-3"}),e.name]},e.id)})})})}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,Xf.jsxs)("div",{className:"p-8",children:["profile"===R&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Profile Information"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,Xf.jsx)("div",{className:"h-24 w-24 bg-gray-200 rounded-full flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-12 w-12 text-gray-400"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Xf.jsx)(Mg,{className:"h-4 w-4 mr-2"}),"Change Photo"]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"JPG, PNG up to 2MB"})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),(0,Xf.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(e=S.profile)||void 0===e?void 0:e.firstName)||"",onChange:e=>P("profile","firstName",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),(0,Xf.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(n=S.profile)||void 0===n?void 0:n.lastName)||"",onChange:e=>P("profile","lastName",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,Xf.jsx)("input",{type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(s=S.profile)||void 0===s?void 0:s.email)||"",onChange:e=>P("profile","email",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),(0,Xf.jsx)("input",{type:"tel",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(i=S.profile)||void 0===i?void 0:i.phone)||"",onChange:e=>P("profile","phone",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth"}),(0,Xf.jsx)("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(r=S.profile)||void 0===r?void 0:r.dateOfBirth)||"",onChange:e=>P("profile","dateOfBirth",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Number"}),(0,Xf.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(a=S.profile)||void 0===a?void 0:a.licenseNumber)||"",onChange:e=>P("profile","licenseNumber",e.target.value)})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),(0,Xf.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",value:(null===(o=S.profile)||void 0===o?void 0:o.address)||"",onChange:e=>P("profile","address",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,Xf.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"4",value:(null===(c=S.profile)||void 0===c?void 0:c.bio)||"",onChange:e=>P("profile","bio",e.target.value)})]})]}),"notifications"===R&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Notification Preferences"}),(0,Xf.jsx)("div",{className:"space-y-4",children:Object.entries(S.notifications||{}).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900 capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-600",children:["emailNotifications"===t&&"Receive notifications via email","smsNotifications"===t&&"Receive notifications via SMS","pushNotifications"===t&&"Receive push notifications","taskReminders"===t&&"Get reminded about upcoming tasks","emergencyAlerts"===t&&"Get immediate alerts for emergencies","appointmentReminders"===t&&"Get reminded about appointments","medicationAlerts"===t&&"Get alerts for medication schedules","weeklyReports"===t&&"Receive weekly performance reports","patientUpdates"===t&&"Get updates about patient status","systemUpdates"===t&&"Receive system maintenance notifications"]})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:e=>P("notifications",t,e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})})]}),"privacy"===R&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Privacy Settings"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profile Visibility"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(l=S.privacy)||void 0===l?void 0:l.profileVisibility)||"private",onChange:e=>P("privacy","profileVisibility",e.target.value),children:[(0,Xf.jsx)("option",{value:"public",children:"Public"}),(0,Xf.jsx)("option",{value:"private",children:"Private"}),(0,Xf.jsx)("option",{value:"contacts",children:"Contacts Only"})]})]}),(0,Xf.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Retention"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(d=S.privacy)||void 0===d?void 0:d.dataRetention)||"2 years",onChange:e=>P("privacy","dataRetention",e.target.value),children:[(0,Xf.jsx)("option",{value:"1 year",children:"1 Year"}),(0,Xf.jsx)("option",{value:"2 years",children:"2 Years"}),(0,Xf.jsx)("option",{value:"5 years",children:"5 Years"}),(0,Xf.jsx)("option",{value:"indefinite",children:"Indefinite"})]})]}),Object.entries(S.privacy||{}).filter(e=>{let[t]=e;return["locationSharing","dataCollection","analytics","marketingEmails"].includes(t)}).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900 capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-600",children:["locationSharing"===t&&"Allow location sharing for emergency response","dataCollection"===t&&"Allow data collection for service improvement","analytics"===t&&"Allow analytics tracking","marketingEmails"===t&&"Receive marketing emails and promotions"]})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:e=>P("privacy",t,e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})]})]}),"preferences"===R&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Preferences"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Theme"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(u=S.preferences)||void 0===u?void 0:u.theme)||"light",onChange:e=>P("preferences","theme",e.target.value),children:[(0,Xf.jsx)("option",{value:"light",children:"Light"}),(0,Xf.jsx)("option",{value:"dark",children:"Dark"}),(0,Xf.jsx)("option",{value:"auto",children:"Auto"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Language"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(h=S.preferences)||void 0===h?void 0:h.language)||"en",onChange:e=>P("preferences","language",e.target.value),children:[(0,Xf.jsx)("option",{value:"en",children:"English"}),(0,Xf.jsx)("option",{value:"yo",children:"Yoruba"}),(0,Xf.jsx)("option",{value:"ha",children:"Hausa"}),(0,Xf.jsx)("option",{value:"ig",children:"Igbo"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(p=S.preferences)||void 0===p?void 0:p.timezone)||"Africa/Lagos",onChange:e=>P("preferences","timezone",e.target.value),children:[(0,Xf.jsx)("option",{value:"Africa/Lagos",children:"Africa/Lagos (GMT+1)"}),(0,Xf.jsx)("option",{value:"Africa/Abuja",children:"Africa/Abuja (GMT+1)"}),(0,Xf.jsx)("option",{value:"Africa/Kano",children:"Africa/Kano (GMT+1)"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Format"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(m=S.preferences)||void 0===m?void 0:m.dateFormat)||"DD/MM/YYYY",onChange:e=>P("preferences","dateFormat",e.target.value),children:[(0,Xf.jsx)("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),(0,Xf.jsx)("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),(0,Xf.jsx)("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Format"}),(0,Xf.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(f=S.preferences)||void 0===f?void 0:f.timeFormat)||"24h",onChange:e=>P("preferences","timeFormat",e.target.value),children:[(0,Xf.jsx)("option",{value:"24h",children:"24 Hour"}),(0,Xf.jsx)("option",{value:"12h",children:"12 Hour"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Patients Per Day"}),(0,Xf.jsx)("input",{type:"number",min:"1",max:"15",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(g=S.preferences)||void 0===g?void 0:g.maxPatientsPerDay)||8,onChange:e=>P("preferences","maxPatientsPerDay",parseInt(e.target.value))})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Working Hours Start"}),(0,Xf.jsx)("input",{type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(y=S.preferences)||void 0===y||null===(v=y.workingHours)||void 0===v?void 0:v.start)||"08:00",onChange:e=>{var t;return P("preferences","workingHours",Le(Le({},null===(t=S.preferences)||void 0===t?void 0:t.workingHours),{},{start:e.target.value}))}})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Working Hours End"}),(0,Xf.jsx)("input",{type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(_=S.preferences)||void 0===_||null===(E=_.workingHours)||void 0===E?void 0:E.end)||"18:00",onChange:e=>{var t;return P("preferences","workingHours",Le(Le({},null===(t=S.preferences)||void 0===t?void 0:t.workingHours),{},{end:e.target.value}))}})]})]})]}),"security"===R&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Security Settings"}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Change Password"}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("input",{type:A?"text":"password",className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter current password"}),(0,Xf.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>O(!A),children:A?(0,Xf.jsx)(uy,{className:"h-4 w-4 text-gray-400"}):(0,Xf.jsx)(Lg,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("input",{type:k?"text":"password",className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter new password"}),(0,Xf.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>D(!k),children:k?(0,Xf.jsx)(uy,{className:"h-4 w-4 text-gray-400"}):(0,Xf.jsx)(Lg,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),(0,Xf.jsx)("input",{type:"password",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm new password"})]}),(0,Xf.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Change Password"})]})]}),(0,Xf.jsx)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Two-Factor Authentication"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Add an extra layer of security to your account"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:(null===(b=S.security)||void 0===b?void 0:b.twoFactorAuth)||!1,onChange:e=>P("security","twoFactorAuth",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),(0,Xf.jsx)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Biometric Login"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Use fingerprint or face recognition to log in"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:(null===(x=S.security)||void 0===x?void 0:x.biometricLogin)||!0,onChange:e=>P("security","biometricLogin",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),(0,Xf.jsxs)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Session Timeout"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Auto-logout after"}),(0,Xf.jsxs)("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(w=S.security)||void 0===w?void 0:w.sessionTimeout)||30,onChange:e=>P("security","sessionTimeout",parseInt(e.target.value)),children:[(0,Xf.jsx)("option",{value:"15",children:"15 minutes"}),(0,Xf.jsx)("option",{value:"30",children:"30 minutes"}),(0,Xf.jsx)("option",{value:"60",children:"1 hour"}),(0,Xf.jsx)("option",{value:"120",children:"2 hours"})]})]})]})]})]})]})})]})]})},py=Mf("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),my=Mf("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),fy=Mf("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),gy=Mf("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),yy=Mf("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]),vy=Mf("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),_y=Mf("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);var Ey=n(635),by=n.n(Ey);const xy=new class{constructor(){this.client=null,this.localVideoTrack=null,this.localAudioTrack=null,this.remoteUsers=new Map,this.isJoined=!1,this.isPublished=!1,this.isInitialized=!1,this.eventListeners=new Map,this.config={appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_APP_ID||"43c43dc3e6a44a99b2b75a4997e3b1a4",channel:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_CHANNEL||"elderx_dev",token:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_TOKEN||"007eJxTYAj736zimGlilN56YtmltxEzVy/6tjyKYx73BPWFcnNFEswVGEyMk02MU5KNU80STUwSLS2TjJLMTRNNLC3NU42TDBNNeP4ezmgIZGRIe8LJwAiFID4XQ2pOSmpRRXxKahkDAwDgxiEn",uid:null,mode:"rtc",codec:"vp8"}}async initialize(){try{if(this.isInitialized)return!0;if(!this.config.appId)throw new Error("Agora App ID is required");return this.client=by().createClient({mode:this.config.mode,codec:this.config.codec}),this.setupEventListeners(),this.isInitialized=!0,this.triggerEvent("initialized",{}),!0}catch(e){throw console.error("Failed to initialize Agora client:",e),this.triggerEvent("error",{type:"initialization",error:e.message}),e}}setupEventListeners(){this.client&&(this.client.on("user-published",async(e,t)=>{console.log("User published:",e,t);try{if(await this.client.subscribe(e,t),"video"===t&&this.remoteUsers.set(e.uid,Le(Le({},e),{},{videoTrack:e.videoTrack})),"audio"===t&&this.remoteUsers.set(e.uid,Le(Le({},e),{},{audioTrack:e.audioTrack})),"video"===t){const t=document.getElementById("remote-video-".concat(e.uid));t&&e.videoTrack.play(t)}"audio"===t&&e.audioTrack.play(),this.triggerEvent("user-published",{user:e,mediaType:t})}catch(n){console.error("Failed to subscribe user:",n)}}),this.client.on("user-unpublished",(e,t)=>{console.log("User unpublished:",e,t),"video"===t&&this.remoteUsers.delete(e.uid),this.triggerEvent("user-unpublished",{user:e,mediaType:t})}),this.client.on("user-left",e=>{console.log("User left:",e),this.remoteUsers.delete(e.uid),this.triggerEvent("user-left",{user:e})}),this.client.on("connection-state-change",(e,t)=>{console.log("Connection state changed:",e,t),this.triggerEvent("connection-state-change",{curState:e,revState:t})}))}async joinChannel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(this.isInitialized||await this.initialize(),this.isJoined)return console.warn("Already joined a channel"),this.config.uid;const n=t||this.config.channel,s=e||Math.floor(1e5*Math.random());if(this.config.uid=s,!n||""===n.trim())throw new Error("Channel name is required");return await this.client.join(this.config.appId,n,this.config.token,s),this.isJoined=!0,console.log("Successfully joined channel:",n),await this.createLocalTracks(),await this.publishLocalTracks(),this.triggerEvent("joined",{uid:s,channel:n}),s}catch(n){throw console.error("Failed to join channel:",n),this.triggerEvent("error",{type:"join",error:n.message}),n}}async createLocalTracks(){try{const e=await this.checkCameraPermission(),t=await this.checkMicrophonePermission();if(!e&&!t)throw new Error("Camera and microphone access are required for video calls");if(e&&(this.localVideoTrack=await by().createCameraVideoTrack({encoderConfig:"720p_1"})),t&&(this.localAudioTrack=await by().createMicrophoneAudioTrack()),this.localVideoTrack){const e=document.getElementById("local-video");e&&this.localVideoTrack.play(e)}console.log("Local tracks created successfully"),this.triggerEvent("tracks-created",{hasVideo:!!this.localVideoTrack,hasAudio:!!this.localAudioTrack})}catch(e){throw console.error("Failed to create local tracks:",e),this.triggerEvent("error",{type:"track-creation",error:e.message}),e}}async checkCameraPermission(){try{return(await by().getCameras()).length>0}catch(e){return console.warn("Camera permission check failed:",e),!1}}async checkMicrophonePermission(){try{return(await by().getMicrophones()).length>0}catch(e){return console.warn("Microphone permission check failed:",e),!1}}async publishLocalTracks(){try{if(!this.client)throw new Error("Client not initialized");const e=[];if(this.localVideoTrack&&e.push(this.localVideoTrack),this.localAudioTrack&&e.push(this.localAudioTrack),0===e.length)throw new Error("No tracks available to publish");await this.client.publish(e),this.isPublished=!0,console.log("Local tracks published successfully"),this.triggerEvent("published",{videoPublished:!!this.localVideoTrack,audioPublished:!!this.localAudioTrack})}catch(e){throw console.error("Failed to publish local tracks:",e),this.triggerEvent("error",{type:"publish",error:e.message}),e}}async leaveChannel(){try{this.client&&this.isJoined&&(this.isPublished&&await this.client.unpublish([this.localVideoTrack,this.localAudioTrack]),await this.client.leave(),this.isJoined=!1,this.isPublished=!1),this.localVideoTrack&&(this.localVideoTrack.stop(),this.localVideoTrack.close(),this.localVideoTrack=null),this.localAudioTrack&&(this.localAudioTrack.stop(),this.localAudioTrack.close(),this.localAudioTrack=null),this.remoteUsers.clear(),console.log("Successfully left channel"),this.triggerEvent("left",{})}catch(e){throw console.error("Failed to leave channel:",e),e}}async toggleVideo(){try{if(this.localVideoTrack)return await this.localVideoTrack.setEnabled(!this.localVideoTrack.enabled),this.triggerEvent("video-toggled",{enabled:this.localVideoTrack.enabled}),this.localVideoTrack.enabled}catch(e){throw console.error("Failed to toggle video:",e),e}}async toggleAudio(){try{if(this.localAudioTrack)return await this.localAudioTrack.setEnabled(!this.localAudioTrack.enabled),this.triggerEvent("audio-toggled",{enabled:this.localAudioTrack.enabled}),this.localAudioTrack.enabled}catch(e){throw console.error("Failed to toggle audio:",e),e}}getConnectionState(){return this.client?this.client.connectionState:"DISCONNECTED"}getRemoteUsers(){return Array.from(this.remoteUsers.values())}isVideoEnabled(){return!!this.localVideoTrack&&this.localVideoTrack.enabled}isAudioEnabled(){return!!this.localAudioTrack&&this.localAudioTrack.enabled}async getAvailableDevices(){try{const[e,t]=await Promise.all([by().getCameras(),by().getMicrophones()]);return{cameras:e.map(e=>({deviceId:e.deviceId,label:e.label||"Camera"})),microphones:t.map(e=>({deviceId:e.deviceId,label:e.label||"Microphone"}))}}catch(e){return console.error("Failed to get devices:",e),{cameras:[],microphones:[]}}}async switchCamera(e){try{if(!this.localVideoTrack)throw new Error("No video track available");await this.localVideoTrack.setDevice(e),this.triggerEvent("camera-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch camera:",t),this.triggerEvent("error",{type:"camera-switch",error:t.message}),t}}async switchMicrophone(e){try{if(!this.localAudioTrack)throw new Error("No audio track available");await this.localAudioTrack.setDevice(e),this.triggerEvent("microphone-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch microphone:",t),this.triggerEvent("error",{type:"microphone-switch",error:t.message}),t}}async startRecording(){try{if(!this.client||!this.isJoined)throw new Error("Must be in a call to start recording");return this.triggerEvent("recording-started",{}),!0}catch(e){throw console.error("Failed to start recording:",e),this.triggerEvent("error",{type:"recording-start",error:e.message}),e}}async stopRecording(){try{return this.triggerEvent("recording-stopped",{}),!0}catch(e){throw console.error("Failed to stop recording:",e),this.triggerEvent("error",{type:"recording-stop",error:e.message}),e}}getRecordingStatus(){return{isRecording:!1,recordingId:null,startTime:null}}triggerEvent(e,t){const n=new CustomEvent("agora-".concat(e),{detail:t});window.dispatchEvent(n)}destroy(){this.leaveChannel(),this.client=null}},wy=xy,Sy="telemedicine_appointments",Ny="telemedicine_calls",Ty="telemedicine_recordings",Cy="doctors";const Ry=new class{async createAppointment(e){try{const t=Le(Le({},e),{},{createdAt:Nf(),updatedAt:Nf(),status:"scheduled"});return Le({id:(await bf(pm(Pf,Sy),t)).id},t)}catch(t){throw console.error("Error creating appointment:",t),t}}async getAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const n="patient"===t?"patientId":"doctorId",s=Zm(pm(Pf,Sy),ef(n,"==",e),sf("appointmentDate","asc")),i=await vf(s),r=[];return i.forEach(e=>{r.push(Le({id:e.id},e.data()))}),r}catch(n){throw console.error("Error getting appointments:",n),n}}async getUpcomingAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const n=new Date,s="patient"===t?"patientId":"doctorId",i=Zm(pm(Pf,Sy),ef(s,"==",e),ef("appointmentDate",">=",Co.fromDate(n)),ef("status","==","scheduled"),sf("appointmentDate","asc")),r=await vf(i),a=[];return r.forEach(e=>{a.push(Le({id:e.id},e.data()))}),a}catch(n){throw console.error("Error getting upcoming appointments:",n),n}}async updateAppointmentStatus(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const s=mm(Pf,Sy,e);return await Ef(s,Le({status:t,updatedAt:Nf()},n)),!0}catch(s){throw console.error("Error updating appointment status:",s),s}}async startCall(e,t){try{const n=Le(Le({appointmentId:e},t),{},{startTime:Nf(),status:"active",createdAt:Nf()}),s=await bf(pm(Pf,Ny),n);return await this.updateAppointmentStatus(e,"in-progress",{callId:s.id}),Le({id:s.id},n)}catch(n){throw console.error("Error starting call:",n),n}}async endCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=mm(Pf,Ny,e);await Ef(n,Le({endTime:Nf(),status:"completed",updatedAt:Nf()},t));const s=await gf(n);if(s.exists()){const e=s.data();await this.updateAppointmentStatus(e.appointmentId,"completed")}return!0}catch(n){throw console.error("Error ending call:",n),n}}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const s="patient"===t?"patientId":"doctorId",i=Zm(pm(Pf,Ny),ef(s,"==",e),sf("startTime","desc"),(am("limit",n=50),rf._create("limit",n,"F"))),r=await vf(i),a=[];return r.forEach(e=>{a.push(Le({id:e.id},e.data()))}),a}catch(s){throw console.error("Error getting call history:",s),s}var n}async saveRecording(e,t){try{const n=Le(Le({callId:e},t),{},{createdAt:Nf()}),s=await bf(pm(Pf,Ty),n),i=mm(Pf,Ny,e);return await Ef(i,{recordingId:s.id,hasRecording:!0,updatedAt:Nf()}),Le({id:s.id},n)}catch(n){throw console.error("Error saving recording:",n),n}}async getCallRecordings(e){try{const t=Zm(pm(Pf,Ty),ef("callId","==",e)),n=await vf(t),s=[];return n.forEach(e=>{s.push(Le({id:e.id},e.data()))}),s}catch(t){throw console.error("Error getting call recordings:",t),t}}async getAvailableDoctors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=Zm(pm(Pf,Cy),ef("isActive","==",!0));e&&(t=Zm(t,ef("specialty","==",e)));const n=await vf(t),s=[];return n.forEach(e=>{s.push(Le({id:e.id},e.data()))}),s}catch(t){throw console.error("Error getting available doctors:",t),t}}async getDoctor(e){try{const t=mm(Pf,Cy,e),n=await gf(t);if(n.exists())return Le({id:n.id},n.data());throw new Error("Doctor not found")}catch(t){throw console.error("Error getting doctor:",t),t}}subscribeToAppointments(e,t,n){const s="patient"===t?"patientId":"doctorId";return xf(Zm(pm(Pf,Sy),ef(s,"==",e),sf("appointmentDate","asc")),e=>{const t=[];e.forEach(e=>{t.push(Le({id:e.id},e.data()))}),n(t)})}subscribeToCalls(e,t,n){const s="patient"===t?"patientId":"doctorId";return xf(Zm(pm(Pf,Ny),ef(s,"==",e),sf("startTime","desc")),e=>{const t=[];e.forEach(e=>{t.push(Le({id:e.id},e.data()))}),n(t)})}convertTimestamp(e){return e&&e.toDate?e.toDate():e}formatAppointmentForDisplay(e){return Le(Le({},e),{},{appointmentDate:this.convertTimestamp(e.appointmentDate),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}formatCallForDisplay(e){return Le(Le({},e),{},{startTime:this.convertTimestamp(e.startTime),endTime:this.convertTimestamp(e.endTime),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}},Iy=Ry,Ay=()=>{const[e,n]=Ma(Df),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)(!0),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)(0),[_,E]=(0,t.useState)([]),[b,x]=(0,t.useState)("disconnected"),[w,S]=(0,t.useState)(null),[N,T]=(0,t.useState)({cameras:[],microphones:[]}),[C,R]=(0,t.useState)(!1),[I,A]=(0,t.useState)("patient");(0,t.useEffect)(()=>(e&&!n&&(D(),k(),O()),()=>{f&&wy.leaveChannel()}),[e,n]),(0,t.useEffect)(()=>{if(e){var t;const n=null!==(t=e.displayName)&&void 0!==t&&t.includes("Dr.")?"doctor":"patient";A(n)}},[e]);const O=async()=>{try{const e=await wy.getAvailableDevices();T(e)}catch(w){console.error("Failed to load devices:",w)}},k=()=>{window.addEventListener("agora-user-published",e=>{const{user:t}=e.detail;E(e=>[...e,t]),yt.success("".concat(t.uid," joined the call"))}),window.addEventListener("agora-user-left",e=>{const{user:t}=e.detail;E(e=>e.filter(e=>e.uid!==t.uid)),yt.info("".concat(t.uid," left the call"))}),window.addEventListener("agora-connection-state-change",e=>{const{curState:t}=e.detail;x(t),console.log("Connection state:",t),"CONNECTED"===t?yt.success("Connected to call"):"DISCONNECTED"===t&&yt.warning("Connection lost")}),window.addEventListener("agora-error",e=>{const{type:t,error:n}=e.detail;switch(S(n),console.error("Agora error:",t,n),t){case"initialization":yt.error("Failed to initialize video calling");break;case"join":yt.error("Failed to join call");break;case"track-creation":yt.error("Failed to access camera/microphone");break;case"publish":yt.error("Failed to start video/audio");break;default:yt.error("Video call error occurred")}}),window.addEventListener("agora-tracks-created",e=>{const{hasVideo:t,hasAudio:n}=e.detail;c(t),d(n),t||n?t?n||yt.warning("Microphone access not available - video only"):yt.warning("Camera access not available - audio only"):yt.warning("No camera or microphone access available")}),window.addEventListener("agora-recording-started",e=>{h(!0),yt.success("Recording started")}),window.addEventListener("agora-recording-stopped",e=>{h(!1),yt.success("Recording stopped")})},D=async()=>{try{if(m(!0),S(null),!e)return void m(!1);const t=(await Iy.getAppointments(e.uid,I)).map(e=>Iy.formatAppointmentForDisplay(e));i(t),m(!1)}catch(w){console.error("Error loading telemedicine data:",w),S("Failed to load appointments. Please try again."),m(!1),P()}},P=()=>{const e=[{id:"mock-1",doctorName:"Dr. Kemi Adebayo",doctorSpecialty:"Cardiologist",doctorImage:null,patientName:"Adunni Okafor",patientAge:72,appointmentDate:new Date("2024-01-20T15:00:00Z"),duration:30,status:"scheduled",type:"video",notes:"Follow-up consultation for heart condition",symptoms:["Chest pain","Shortness of breath"],vitalSigns:{bloodPressure:"140/90",heartRate:85,temperature:98.6},prescription:null,recording:null},{id:"mock-2",doctorName:"Dr. Tunde Williams",doctorSpecialty:"General Practitioner",doctorImage:null,patientName:"Grace Johnson",patientAge:68,appointmentDate:new Date("2024-01-20T16:30:00Z"),duration:45,status:"completed",type:"video",notes:"Regular checkup and medication review",symptoms:["Fatigue","Joint pain"],vitalSigns:{bloodPressure:"130/80",heartRate:72,temperature:98.4},prescription:{medications:[{name:"Metformin",dosage:"500mg",frequency:"twice daily"},{name:"Ibuprofen",dosage:"200mg",frequency:"as needed"}]},recording:{url:"https://example.com/recording1.mp4",duration:"42 minutes",size:"1.2GB"}}];i(e),yt.warning("Using offline data. Some features may be limited.")},j=async()=>{try{const e=await wy.toggleVideo();c(e),yt.info(e?"Video enabled":"Video disabled")}catch(w){console.error("Failed to toggle video:",w),yt.error("Failed to toggle video")}},L=async()=>{try{const e=await wy.toggleAudio();d(e),yt.info(e?"Audio enabled":"Audio disabled")}catch(w){console.error("Failed to toggle audio:",w),yt.error("Failed to toggle audio")}},M=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},U=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return n?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e?p?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Telemedicine"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Virtual consultations and remote healthcare"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{onClick:async()=>{try{yt.info("Seeding sample data..."),await(async()=>{try{console.log("\ud83c\udf31 Seeding telemedicine data...");const e=[{id:"doctor-1",name:"Dr. Kemi Adebayo",specialty:"Cardiologist",email:"kemi.adebayo@elderx.ng",phone:"+234 801 234 5678",isActive:!0,rating:4.9,experience:"15 years",qualifications:["MBBS","MD Cardiology"],languages:["English","Yoruba"],consultationFee:15e3,availableSlots:["09:00","10:00","11:00","14:00","15:00"],createdAt:Nf()},{id:"doctor-2",name:"Dr. Tunde Williams",specialty:"General Practitioner",email:"tunde.williams@elderx.ng",phone:"+234 802 345 6789",isActive:!0,rating:4.8,experience:"12 years",qualifications:["MBBS","MD General Medicine"],languages:["English","Hausa"],consultationFee:1e4,availableSlots:["08:00","09:00","10:00","13:00","14:00"],createdAt:Nf()},{id:"doctor-3",name:"Dr. Sarah Okafor",specialty:"Dermatologist",email:"sarah.okafor@elderx.ng",phone:"+234 803 456 7890",isActive:!0,rating:4.7,experience:"10 years",qualifications:["MBBS","MD Dermatology"],languages:["English","Igbo"],consultationFee:12e3,availableSlots:["10:00","11:00","12:00","15:00","16:00"],createdAt:Nf()}],t=[{id:"patient-1",name:"Adunni Okafor",email:"adunni.okafor@email.com",phone:"+234 804 567 8901",age:72,gender:"Female",medicalConditions:["Hypertension","Diabetes Type 2"],allergies:["Penicillin"],emergencyContact:{name:"Kemi Okafor",phone:"+234 801 987 6543",relationship:"Daughter"},createdAt:Nf()},{id:"patient-2",name:"Grace Johnson",email:"grace.johnson@email.com",phone:"+234 805 678 9012",age:68,gender:"Female",medicalConditions:["Arthritis"],allergies:["None"],emergencyContact:{name:"John Johnson",phone:"+234 802 876 5432",relationship:"Son"},createdAt:Nf()},{id:"patient-3",name:"Tunde Adebayo",email:"tunde.adebayo@email.com",phone:"+234 806 789 0123",age:75,gender:"Male",medicalConditions:["High Blood Pressure"],allergies:["Shellfish"],emergencyContact:{name:"Funmi Adebayo",phone:"+234 803 765 4321",relationship:"Wife"},createdAt:Nf()}],n=[{patientId:"patient-1",doctorId:"doctor-1",appointmentDate:new Date("2024-01-20T15:00:00Z"),duration:30,type:"video",status:"scheduled",notes:"Follow-up consultation for heart condition",symptoms:["Chest pain","Shortness of breath"],vitalSigns:{bloodPressure:"140/90",heartRate:85,temperature:98.6},createdAt:Nf()},{patientId:"patient-2",doctorId:"doctor-2",appointmentDate:new Date("2024-01-20T16:30:00Z"),duration:45,type:"video",status:"completed",notes:"Regular checkup and medication review",symptoms:["Fatigue","Joint pain"],vitalSigns:{bloodPressure:"130/80",heartRate:72,temperature:98.4},prescription:{medications:[{name:"Metformin",dosage:"500mg",frequency:"twice daily"},{name:"Ibuprofen",dosage:"200mg",frequency:"as needed"}]},createdAt:Nf()},{patientId:"patient-3",doctorId:"doctor-3",appointmentDate:new Date("2024-01-21T10:00:00Z"),duration:20,type:"audio",status:"scheduled",notes:"Skin condition consultation",symptoms:["Rash on arms","Itching"],createdAt:Nf()}];console.log("Adding doctors...");for(const s of e)await _f(mm(Pf,"doctors",s.id),s),console.log("\u2705 Added doctor: ".concat(s.name));console.log("Adding patients...");for(const s of t)await _f(mm(Pf,"patients",s.id),s),console.log("\u2705 Added patient: ".concat(s.name));console.log("Adding appointments...");for(const s of n){const e=await bf(pm(Pf,"telemedicine_appointments"),s);console.log("\u2705 Added appointment: ".concat(e.id))}return console.log("\ud83c\udf89 Telemedicine data seeded successfully!"),!0}catch(w){throw console.error("\u274c Error seeding telemedicine data:",w),w}})(),yt.success("Sample data seeded successfully!"),D()}catch(w){console.error("Failed to seed data:",w),yt.error("Failed to seed sample data")}},className:"btn btn-secondary",title:"Add sample data to Firebase",children:[(0,Xf.jsx)(ay,{className:"h-4 w-4 mr-2"}),"Seed Data"]}),(0,Xf.jsxs)("button",{onClick:async()=>{try{yt.info("Running telemedicine tests...");const e=await(async()=>{const e={initialization:!1,deviceDetection:!1,permissions:!1,errors:[]};try{console.log("\ud83e\uddea Testing Telemedicine Service...");try{await wy.initialize(),e.initialization=!0,console.log("\u2705 Service initialization: PASSED")}catch(w){e.errors.push("Initialization failed: ".concat(w.message)),console.error("\u274c Service initialization: FAILED",w)}try{const t=await wy.getAvailableDevices();e.deviceDetection=t.cameras.length>0||t.microphones.length>0,console.log("\u2705 Device detection: PASSED",t)}catch(w){e.errors.push("Device detection failed: ".concat(w.message)),console.error("\u274c Device detection: FAILED",w)}try{const t=await wy.checkCameraPermission(),n=await wy.checkMicrophonePermission();e.permissions=t||n,console.log("\u2705 Permission checks: PASSED",{hasCamera:t,hasMicrophone:n})}catch(w){e.errors.push("Permission checks failed: ".concat(w.message)),console.error("\u274c Permission checks: FAILED",w)}return e.initialization&&e.deviceDetection&&e.permissions?console.log("\ud83c\udf89 All telemedicine tests PASSED!"):console.log("\u26a0\ufe0f Some telemedicine tests FAILED:",e.errors),e}catch(w){return console.error("\ud83d\udca5 Telemedicine test suite failed:",w),e.errors.push("Test suite failed: ".concat(w.message)),e}})();0===e.errors.length?yt.success("All telemedicine tests passed!"):(yt.warning("Some tests failed: ".concat(e.errors.length," errors")),console.log("Test results:",e))}catch(w){console.error("Test failed:",w),yt.error("Telemedicine test failed")}},className:"btn btn-secondary",title:"Test telemedicine functionality",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-2"}),"Test System"]}),(0,Xf.jsxs)("button",{onClick:O,className:"btn btn-secondary",title:"Refresh device list",children:[(0,Xf.jsx)(og,{className:"h-4 w-4 mr-2"}),"Refresh Devices"]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-2"}),"Schedule Appointment"]}),(0,Xf.jsxs)("button",{onClick:async()=>{try{const t={patientId:"patient"===I?e.uid:"sample-patient-id",doctorId:"doctor"===I?e.uid:"sample-doctor-id",appointmentDate:new Date(Date.now()+864e5),duration:30,type:"video",notes:"New consultation appointment",status:"scheduled"};await Iy.createAppointment(t);yt.success("New appointment created successfully!"),D()}catch(w){console.error("Failed to create appointment:",w),yt.error("Failed to create appointment")}},className:"btn btn-primary",title:"Create new consultation appointment",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"New Consultation"]})]})]}),N.cameras.length>0||N.microphones.length>0?(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Available Devices"}),(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:[N.cameras.length," camera(s), ",N.microphones.length," microphone(s)"]})]})}):(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-5 w-5 text-yellow-600 mr-2"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"No Devices Detected"}),(0,Xf.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"Please ensure your camera and microphone are connected and permissions are granted."})]})]})})}),(w||"disconnected"!==b)&&(0,Xf.jsxs)("div",{className:"card",children:[w&&(0,Xf.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Connection Error"}),(0,Xf.jsx)("p",{className:"text-sm text-red-700 mt-1",children:w})]})]})}),"disconnected"!==b&&(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat("CONNECTED"===b?"bg-green-500":"CONNECTING"===b?"bg-yellow-500":"bg-red-500")}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-600",children:["Status: ",b.toLowerCase()]})]}),C&&(0,Xf.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Initializing..."]})]})]}),r&&(0,Xf.jsxs)("div",{className:"card bg-gray-900 text-white",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-white font-medium",children:r.doctorName?r.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold",children:r.doctorName||"Doctor"}),(0,Xf.jsx)("p",{className:"text-gray-300",children:r.doctorSpecialty})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsxs)("span",{className:"text-sm text-gray-300",children:["Call Duration: ",(e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))})(y)]}),u&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-1 bg-red-600 px-2 py-1 rounded-full",children:[(0,Xf.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,Xf.jsx)("span",{className:"text-xs text-white",children:"REC"})]}),(0,Xf.jsx)("button",{onClick:async()=>{try{if(null!==r&&void 0!==r&&r.timer&&clearInterval(r.timer),await wy.leaveChannel(),null!==r&&void 0!==r&&r.callId)try{const e={duration:y,endReason:"user_ended",hasRecording:u};await Iy.endCall(r.callId,e)}catch(e){console.warn("Failed to save call end to Firebase:",e)}a(null),g(!1),v(0),E([]),c(!0),d(!0),h(!1),yt.success("Call ended successfully!")}catch(w){console.error("Failed to end call:",w),yt.error("Failed to end call properly.")}},className:"p-2 bg-red-600 rounded-full hover:bg-red-700",title:"End call",children:(0,Xf.jsx)(py,{className:"h-5 w-5"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,Xf.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Xf.jsx)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:_.length>0?_.map((e,t)=>(0,Xf.jsx)("div",{id:"remote-video-".concat(e.uid),className:"w-full h-full"},e.uid)):(0,Xf.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Mg,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Xf.jsx)("p",{className:"text-gray-400",children:"Waiting for doctor to join..."})]})})}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-300",children:_.length>0?"".concat(_.length," participant(s)"):"No participants"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:j,className:"p-2 rounded-full ".concat(o?"bg-gray-700":"bg-red-600"),children:o?(0,Xf.jsx)(Bf,{className:"h-4 w-4"}):(0,Xf.jsx)(my,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:L,className:"p-2 rounded-full ".concat(l?"bg-gray-700":"bg-red-600"),children:l?(0,Xf.jsx)(fy,{className:"h-4 w-4"}):(0,Xf.jsx)(gy,{className:"h-4 w-4"})})]})]})]}),(0,Xf.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Xf.jsxs)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:[(0,Xf.jsx)("div",{id:"local-video",className:"w-full h-full"}),!o&&(0,Xf.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-600",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(my,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Xf.jsx)("p",{className:"text-gray-400",children:"Your video is off"})]})})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-300",children:"You"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:j,className:"p-2 rounded-full ".concat(o?"bg-gray-700":"bg-red-600"),children:o?(0,Xf.jsx)(Bf,{className:"h-4 w-4"}):(0,Xf.jsx)(my,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:L,className:"p-2 rounded-full ".concat(l?"bg-gray-700":"bg-red-600"),children:l?(0,Xf.jsx)(fy,{className:"h-4 w-4"}):(0,Xf.jsx)(gy,{className:"h-4 w-4"})})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,Xf.jsx)("button",{onClick:j,className:"p-3 rounded-full transition-colors ".concat(o?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:o?"Turn off video":"Turn on video",children:o?(0,Xf.jsx)(Bf,{className:"h-6 w-6"}):(0,Xf.jsx)(my,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{onClick:L,className:"p-3 rounded-full transition-colors ".concat(l?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:l?"Mute microphone":"Unmute microphone",children:l?(0,Xf.jsx)(fy,{className:"h-6 w-6"}):(0,Xf.jsx)(gy,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{onClick:async()=>{try{if(u){if(await wy.stopRecording(),h(!1),null!==r&&void 0!==r&&r.callId)try{const e={duration:y,status:"completed",recordingUrl:null,fileSize:null};await Iy.saveRecording(r.callId,e)}catch(e){console.warn("Failed to save recording data to Firebase:",e)}yt.success("Recording stopped")}else{if(await wy.startRecording(),h(!0),null!==r&&void 0!==r&&r.callId)try{const e={status:"recording",startTime:new Date};await Iy.saveRecording(r.callId,e)}catch(e){console.warn("Failed to save recording start to Firebase:",e)}yt.success("Recording started")}}catch(w){console.error("Failed to toggle recording:",w),yt.error("Failed to toggle recording")}},className:"p-3 rounded-full transition-colors ".concat(u?"bg-red-600 hover:bg-red-700":"bg-gray-700 hover:bg-gray-600"),title:u?"Stop recording":"Start recording",children:u?(0,Xf.jsx)(yy,{className:"h-6 w-6"}):(0,Xf.jsx)(vy,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Share screen",children:(0,Xf.jsx)(_y,{className:"h-6 w-6"})}),(0,Xf.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Settings",children:(0,Xf.jsx)(og,{className:"h-6 w-6"})})]}),(N.cameras.length>1||N.microphones.length>1)&&(0,Xf.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[N.cameras.length>1&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(Mg,{className:"h-4 w-4"}),(0,Xf.jsx)("select",{onChange:e=>(async e=>{try{await wy.switchCamera(e),yt.success("Camera switched successfully")}catch(w){console.error("Failed to switch camera:",w),yt.error("Failed to switch camera")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:N.cameras.map(e=>(0,Xf.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]}),N.microphones.length>1&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(fy,{className:"h-4 w-4"}),(0,Xf.jsx)("select",{onChange:e=>(async e=>{try{await wy.switchMicrophone(e),yt.success("Microphone switched successfully")}catch(w){console.error("Failed to switch microphone:",w),yt.error("Failed to switch microphone")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:N.microphones.map(e=>(0,Xf.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Appointments"}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Hg,{className:"h-4 w-4 mr-2"}),"Search"]})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:s.filter(e=>"scheduled"===e.status).map(t=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-blue-600 font-medium",children:t.doctorName?t.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.doctorName||"Doctor"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:t.doctorSpecialty||"General Practice"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(M(t.status)),children:t.status})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:["Patient: ",t.patientName||"Patient"," (",t.patientAge||"N/A","y)"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-2"}),(0,Xf.jsx)("span",{children:t.appointmentDate?U(t.appointmentDate).date:"TBD"})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-2"}),(0,Xf.jsxs)("span",{children:[t.appointmentDate?U(t.appointmentDate).time:"TBD"," (",t.duration||30,"min)"]})]})]}),(0,Xf.jsxs)("div",{className:"mt-2",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:t.notes}),t.symptoms&&(0,Xf.jsxs)("div",{className:"mt-2",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Symptoms: "}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t.symptoms.join(", ")})]})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>(async t=>{try{R(!0),S(null),a(t),g(!0),v(0);const s="appointment_".concat(t.id,"_").concat(Date.now()),i=await wy.joinChannel(null,s);console.log("Joined call with UID:",i);let r=null;try{const n={appointmentId:t.id,patientId:"patient"===I?e.uid:t.patientId,doctorId:"doctor"===I?e.uid:t.doctorId,channelName:s,uid:i,callType:t.type||"video",status:"active"},o=await Iy.startCall(t.id,n);r=o.id,a(e=>Le(Le({},e),{},{callId:r}))}catch(n){console.warn("Failed to save call to Firebase:",n)}yt.success("Call started successfully!");const o=setInterval(()=>{v(e=>e+1)},1e3);a(e=>Le(Le({},e),{},{timer:o,channelName:s,uid:i,callId:r}))}catch(w){console.error("Failed to start call:",w),S(w.message),yt.error("Failed to start call: ".concat(w.message)),a(null),g(!1)}finally{R(!1)}})(t),disabled:C,className:"btn btn-primary ".concat(C?"opacity-50 cursor-not-allowed":""),children:C?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Starting..."]}):(0,Xf.jsxs)(Xf.Fragment,{children:["video"===t.type?(0,Xf.jsx)(Bf,{className:"h-4 w-4 mr-2"}):(0,Xf.jsx)(pg,{className:"h-4 w-4 mr-2"}),"Start Call"]})}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ig,{className:"h-4 w-4 mr-2"}),"Chat"]})]})]})},t.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Consultations"}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]})]}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.filter(e=>"completed"===e.status).map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-blue-600 font-medium",children:e.doctorName?e.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.doctorName||"Doctor"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.doctorSpecialty||"General Practice"})]})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.patientName||"Patient"}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge||"N/A"]})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.appointmentDate?U(e.appointmentDate).date:"TBD"}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.appointmentDate?U(e.appointmentDate).time:"TBD"})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:["video"===e.type?(0,Xf.jsx)(Bf,{className:"h-4 w-4 text-blue-600 mr-1"}):(0,Xf.jsx)(pg,{className:"h-4 w-4 text-green-600 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900 capitalize",children:e.type})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(M(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(ag,{className:"h-4 w-4"})}),e.recording&&(0,Xf.jsx)("button",{className:"text-green-600 hover:text-green-900",children:(0,Xf.jsx)(ry,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{className:"text-purple-600 hover:text-purple-900",children:(0,Xf.jsx)(qg,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]}):(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Required"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Please log in to access telemedicine features."})]})})},Oy=()=>{const[e,n]=(0,t.useState)(!1),s=ee(),i=Z(),r=[{name:"Dashboard",href:"/caregiver",icon:$f},{name:"Today's Schedule",href:"/caregiver/schedule",icon:Vf},{name:"My Patients",href:"/caregiver/patients",icon:Ff},{name:"Tasks",href:"/caregiver/tasks",icon:mg},{name:"Messages",href:"/caregiver/messages",icon:ig},{name:"Navigation",href:"/caregiver/navigation",icon:Ug},{name:"Photo Updates",href:"/caregiver/photos",icon:Mg},{name:"Performance",href:"/caregiver/performance",icon:sg},{name:"Emergency",href:"/caregiver/emergency",icon:eg},{name:"Settings",href:"/caregiver/settings",icon:og}],a=e=>i.pathname===e;return(0,Xf.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,Xf.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>n(!1)}),(0,Xf.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Xf.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Xf.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>n(!1),children:(0,Xf.jsx)(Hf,{className:"h-6 w-6 text-white"})})}),(0,Xf.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-green-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Xf.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Xf.jsx)("div",{className:"flex flex-col w-64",children:(0,Xf.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Xf.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Xf.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Xf.jsx)(Ff,{className:"h-8 w-8 text-green-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Xf.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:r.map(e=>{const t=e.icon;return(0,Xf.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Xf.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Xf.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-3",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"}),(0,Xf.jsxs)("button",{onClick:async()=>{try{await gr(Df),yt.success("Signed out successfully"),s("/login")}catch(e){yt.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Xf.jsx)(Kf,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Xf.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 dashboard-container",children:[(0,Xf.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Xf.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500 lg:hidden",onClick:()=>n(!0),children:(0,Xf.jsx)(zf,{className:"h-6 w-6"})}),(0,Xf.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Xf.jsx)("div",{className:"flex-1 flex",children:(0,Xf.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Xf.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Xf.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:"Caregiver Portal"})})})})}),(0,Xf.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Xf.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:(0,Xf.jsx)(qf,{className:"h-6 w-6"})}),(0,Xf.jsx)("div",{className:"ml-3 relative",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})}),(0,Xf.jsx)("div",{className:"ml-3",children:(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"})})]})})]})]})]}),(0,Xf.jsx)("main",{className:"flex-1 overflow-auto w-full dashboard-main",children:(0,Xf.jsx)(ge,{})})]})]})},ky=()=>{const[e,n]=(0,t.useState)(null),[s,i]=(0,t.useState)(""),[r,a]=(0,t.useState)(""),[o,c]=(0,t.useState)([{id:1,name:"Dr. Kemi Adebayo",role:"Cardiologist",avatar:null,lastMessage:"Your blood pressure readings look good. Keep monitoring daily.",timestamp:"2 hours ago",unreadCount:2,status:"online",messages:[{id:1,text:"Hello Mrs. Okafor, how are you feeling today?",sender:"doctor",timestamp:"10:30 AM",read:!0},{id:2,text:"I'm feeling much better, thank you doctor.",sender:"patient",timestamp:"10:32 AM",read:!0},{id:3,text:"Your blood pressure readings look good. Keep monitoring daily.",sender:"doctor",timestamp:"2 hours ago",read:!1}]},{id:2,name:"Nurse Fatima Abdullahi",role:"Caregiver",avatar:null,lastMessage:"I'll be there for your appointment at 2 PM.",timestamp:"1 day ago",unreadCount:0,status:"offline",messages:[{id:1,text:"Good morning! I'm on my way for your home visit.",sender:"caregiver",timestamp:"Yesterday 8:00 AM",read:!0},{id:2,text:"I'll be there for your appointment at 2 PM.",sender:"caregiver",timestamp:"1 day ago",read:!0}]},{id:3,name:"ElderX Support",role:"Support Team",avatar:null,lastMessage:"Your subscription will renew on January 15th.",timestamp:"3 days ago",unreadCount:1,status:"online",messages:[{id:1,text:"Welcome to ElderX! We're here to help with any questions.",sender:"support",timestamp:"3 days ago",read:!0},{id:2,text:"Your subscription will renew on January 15th.",sender:"support",timestamp:"3 days ago",read:!1}]}]),[l,d]=(0,t.useState)(o);(0,t.useEffect)(()=>{if(r){const e=o.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||e.role.toLowerCase().includes(r.toLowerCase()));d(e)}else d(o)},[r,o]);const u=e=>"online"===e?"bg-green-500":"bg-gray-400",h=e=>"patient"===e.sender?e.read?(0,Xf.jsx)(Yg,{className:"h-4 w-4 text-blue-500"}):(0,Xf.jsx)(Xg,{className:"h-4 w-4 text-gray-400"}):null;return(0,Xf.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Xf.jsxs)("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[(0,Xf.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(Gf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Messages"})]}),(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search conversations...",value:r,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto",children:l.map(t=>(0,Xf.jsx)("div",{onClick:()=>n(t),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ".concat((null===e||void 0===e?void 0:e.id)===t.id?"bg-blue-50 border-blue-200":""),children:(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ".concat(u(t.status))})]}),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:t.name}),(0,Xf.jsx)("span",{className:"text-xs text-gray-500",children:t.timestamp})]}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:t.role}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-600 truncate",children:t.lastMessage}),t.unreadCount>0&&(0,Xf.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:t.unreadCount})]})]})]})},t.id))})]}),(0,Xf.jsx)("div",{className:"flex-1 flex flex-col",children:e?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-blue-600"})}),(0,Xf.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ".concat(u(e.status))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:e.role})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(pg,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(Bf,{className:"h-5 w-5"})}),(0,Xf.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(qg,{className:"h-5 w-5"})})]})]})}),(0,Xf.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:e.messages.map(e=>(0,Xf.jsx)("div",{className:"flex ".concat("patient"===e.sender?"justify-end":"justify-start"),children:(0,Xf.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("patient"===e.sender?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,Xf.jsx)("p",{className:"text-sm",children:e.text}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between mt-1 ".concat("patient"===e.sender?"text-blue-100":"text-gray-500"),children:[(0,Xf.jsx)("span",{className:"text-xs",children:e.timestamp}),h(e)]})]})},e.id))}),(0,Xf.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:(0,Xf.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),!s.trim()||!e)return;const n={id:Date.now(),text:s,sender:"patient",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),read:!1};c(t=>t.map(t=>t.id===e.id?Le(Le({},t),{},{messages:[...t.messages,n],lastMessage:s,timestamp:"Just now"}):t)),i("")},className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Xf.jsx)(Jg,{className:"h-5 w-5"})}),(0,Xf.jsxs)("div",{className:"flex-1 relative",children:[(0,Xf.jsx)("input",{type:"text",value:s,onChange:e=>i(e.target.value),placeholder:"Type a message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,Xf.jsx)("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:(0,Xf.jsx)(Qg,{className:"h-5 w-5"})})]}),(0,Xf.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Xf.jsx)(Zg,{className:"h-5 w-5"})})]})})]}):(0,Xf.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Gf,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,Xf.jsx)("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})},Dy=Mf("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),Py=()=>{const[e,n]=(0,t.useState)("premium"),[s,i]=(0,t.useState)("monthly"),r={currentPlan:"Premium",status:"Active",nextBilling:"January 15, 2025",amount:"$49.99",cycle:"Monthly",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications"]},a=[{id:"basic",name:"Basic",price:{monthly:19.99,yearly:199.99},description:"Essential care services",features:["2 home visits per month","Basic health monitoring","Email support","Medication reminders","Emergency contact"],popular:!1,icon:Ff},{id:"premium",name:"Premium",price:{monthly:49.99,yearly:499.99},description:"Comprehensive care package",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications","Priority support"],popular:!0,icon:Dy},{id:"elite",name:"Elite",price:{monthly:99.99,yearly:999.99},description:"Premium concierge service",features:["Everything in Premium","Dedicated care manager","Specialist consultations","Advanced health analytics","Custom care plans","White-glove service","Family dashboard","24/7 concierge support"],popular:!1,icon:fg}],o=e=>{switch(e){case"Active":case"Paid":return"bg-green-100 text-green-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,Xf.jsxs)("div",{className:"space-y-8",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Subscription"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage your ElderX subscription and billing"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Download Invoice"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(og,{className:"h-4 w-4 mr-2"}),"Manage Billing"]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Xf.jsx)(Wf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Current Subscription"})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,Xf.jsxs)("div",{className:"p-6 bg-blue-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(Dy,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[r.currentPlan," Plan"]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(r.status)),children:r.status})]})]}),(0,Xf.jsxs)("div",{className:"space-y-2",children:[(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Amount:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:r.amount})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Cycle:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:r.cycle})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Next billing:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:r.nextBilling})]})]})]}),(0,Xf.jsxs)("div",{className:"p-6 bg-green-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)($f,{className:"h-8 w-8 text-green-600 mr-3"}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Usage This Month"})]}),(0,Xf.jsxs)("div",{className:"space-y-2",children:[(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Home visits:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:"8 / Unlimited"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Telemedicine:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:"3 / Unlimited"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-gray-600",children:"Emergency calls:"}),(0,Xf.jsx)("span",{className:"font-semibold",children:"1 / Unlimited"})]})]})]}),(0,Xf.jsxs)("div",{className:"p-6 bg-purple-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Xf.jsx)(cg,{className:"h-8 w-8 text-purple-600 mr-3"}),(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Benefits"})]}),(0,Xf.jsx)("div",{className:"space-y-1",children:r.features.slice(0,4).map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Xg,{className:"h-4 w-4 text-green-500 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Plans"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>i("monthly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("monthly"===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Monthly"}),(0,Xf.jsx)("button",{onClick:()=>i("yearly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("yearly"===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Yearly (Save 17%)"})]})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.map(t=>{const i=t.icon,r=e===t.id,a="monthly"===s?t.price.monthly:t.price.yearly,o="yearly"===s?Math.round((12*t.price.monthly-t.price.yearly)/(12*t.price.monthly)*100):0;return(0,Xf.jsxs)("div",{className:"relative p-6 border-2 rounded-lg transition-all ".concat(t.popular?"border-blue-500 bg-blue-50":r?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),children:[t.popular&&(0,Xf.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Xf.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),r&&(0,Xf.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Xf.jsx)("span",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Current Plan"})}),(0,Xf.jsxs)("div",{className:"text-center mb-6",children:[(0,Xf.jsx)(i,{className:"h-12 w-12 mx-auto mb-4 ".concat(t.popular?"text-blue-600":r?"text-green-600":"text-gray-600")}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:t.name}),(0,Xf.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,Xf.jsxs)("div",{className:"mb-2",children:[(0,Xf.jsxs)("span",{className:"text-3xl font-bold text-gray-900",children:["$",a]}),(0,Xf.jsxs)("span",{className:"text-gray-600",children:["/","monthly"===s?"month":"year"]})]}),o>0&&(0,Xf.jsxs)("p",{className:"text-sm text-green-600 font-medium",children:["Save ",o,"% with yearly billing"]})]}),(0,Xf.jsx)("div",{className:"space-y-3 mb-6",children:t.features.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Xg,{className:"h-4 w-4 text-green-500 mr-3 flex-shrink-0"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))}),(0,Xf.jsx)("button",{onClick:()=>{return e=t.id,void n(e);var e},className:"w-full py-3 px-4 rounded-lg font-semibold transition-colors ".concat(r?"bg-green-600 text-white hover:bg-green-700":t.popular?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),disabled:r,children:r?"Current Plan":"Choose Plan"})]},t.id)})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Wf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Payment Methods"})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Wf,{className:"h-4 w-4 mr-2"}),"Add Payment Method"]})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:[{id:1,type:"Visa",last4:"4242",expiry:"12/26",isDefault:!0},{id:2,type:"Mastercard",last4:"5555",expiry:"08/25",isDefault:!1}].map(e=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"w-12 h-8 bg-blue-600 rounded flex items-center justify-center",children:(0,Xf.jsx)(Wf,{className:"h-5 w-5 text-white"})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.type," \u2022\u2022\u2022\u2022 ",e.last4]}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-500",children:["Expires ",e.expiry]})]}),e.isDefault&&(0,Xf.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"Default"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),(0,Xf.jsx)("button",{className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]})]},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Xf.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Billing History"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Download All"]})]}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:[{id:1,date:"December 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:2,date:"November 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:3,date:"October 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"}].map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.description}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:e.amount}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(ry,{className:"h-4 w-4"})})})]},e.id))})]})})]})]})},jy=()=>{const e=[{icon:Uf,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",bgColor:"bg-blue-100",iconColor:"text-blue-600"},{icon:Ff,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",bgColor:"bg-green-100",iconColor:"text-green-600"},{icon:eg,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",bgColor:"bg-red-100",iconColor:"text-red-600"},{icon:Bf,title:"Telemedicine",description:"Video consultations with doctors and specialists.",bgColor:"bg-purple-100",iconColor:"text-purple-600"},{icon:Zf,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",bgColor:"bg-orange-100",iconColor:"text-orange-600"},{icon:cg,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",bgColor:"bg-blue-100",iconColor:"text-blue-600"}];return(0,Xf.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-16",children:[(0,Xf.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((e,t)=>{const n=e.icon;return(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Xf.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Xf.jsx)(n,{className:"h-8 w-8 ".concat(e.iconColor)})}),(0,Xf.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Xf.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]}),(0,Xf.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Xf.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Xf.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Xf.jsx)("span",{className:"font-bold",children:"MGX"})]})})]})},Ly=()=>(0,Xf.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Xf.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Xf.jsxs)("div",{className:"text-center mb-16",children:[(0,Xf.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Affordable Care Plans"}),(0,Xf.jsx)("p",{className:"text-lg text-gray-600",children:"Flexible subscription options designed for Nigerian families."})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12",children:[{name:"Basic",price:"\u20a615,000",period:"per month",features:["2 home visits per month","Basic health monitoring","Emergency support"],buttonText:"Choose Basic",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"},{name:"Premium",price:"\u20a625,000",period:"per month",features:["4 home visits per month","Video consultations","Family notifications"],buttonText:"Choose Premium",buttonStyle:"bg-blue-600 text-white hover:bg-blue-700",popular:!0},{name:"Family",price:"\u20a640,000",period:"per month",features:["Unlimited home visits","24/7 emergency support","Specialist consultations"],buttonText:"Choose Family",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}].map((e,t)=>(0,Xf.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 relative ".concat(e.popular?"border-2 border-blue-600":"border border-gray-200"),children:[e.popular&&(0,Xf.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,Xf.jsx)("div",{className:"bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),(0,Xf.jsxs)("div",{className:"text-center mb-6",children:[(0,Xf.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.name}),(0,Xf.jsxs)("div",{className:"mb-2",children:[(0,Xf.jsx)("span",{className:"text-4xl font-bold text-blue-600",children:e.price}),(0,Xf.jsx)("span",{className:"text-gray-500 ml-2",children:e.period})]})]}),(0,Xf.jsx)("ul",{className:"space-y-3 mb-8",children:e.features.map((e,t)=>(0,Xf.jsxs)("li",{className:"flex items-center",children:[(0,Xf.jsx)(Xg,{className:"h-5 w-5 text-green-500 mr-3 flex-shrink-0"}),(0,Xf.jsx)("span",{className:"text-gray-700",children:e})]},t))}),(0,Xf.jsx)("button",{className:"w-full py-3 px-6 rounded-lg font-medium transition-colors ".concat(e.buttonStyle),children:e.buttonText})]},t))}),(0,Xf.jsx)("div",{className:"text-center",children:(0,Xf.jsx)("button",{className:"bg-gradient-to-r from-blue-600 to-green-600 text-white px-8 py-4 rounded-lg font-medium hover:from-blue-700 hover:to-green-700 transition-all",children:"View All Plans & Get Started"})})]}),(0,Xf.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Xf.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Xf.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Xf.jsx)("span",{className:"font-bold",children:"MGX"})]})})]}),My=Mf("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Uy=Mf("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Vy=()=>{const[e,n]=(0,t.useState)({totalUsers:0,elderlyUsers:0,caregivers:0,activeAppointments:0,emergencyAlerts:0,medicationReminders:0,systemHealth:"Good",revenue:0,satisfaction:0,responseTime:0,uptime:0}),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(new Date);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n({totalUsers:1247,elderlyUsers:892,caregivers:355,activeAppointments:23,emergencyAlerts:2,medicationReminders:156,systemHealth:"Good",revenue:45680,satisfaction:94.5,responseTime:2.3,uptime:99.8}),i([{id:1,type:"emergency",message:"Emergency alert from Adunni Okafor",time:"2 minutes ago",status:"active"},{id:2,type:"appointment",message:"New appointment scheduled with Dr. Kemi",time:"15 minutes ago",status:"completed"},{id:3,type:"medication",message:"Medication reminder sent to 12 users",time:"1 hour ago",status:"completed"},{id:4,type:"user",message:"New caregiver registered: Tunde Adebayo",time:"2 hours ago",status:"completed"}]),a([{id:1,name:"Sarah Johnson",rating:4.9,patientsServed:12,tasksCompleted:145,responseTime:2.1,avatar:null},{id:2,name:"Michael Adebayo",rating:4.8,patientsServed:10,tasksCompleted:132,responseTime:2.3,avatar:null},{id:3,name:"Grace Okafor",rating:4.7,patientsServed:8,tasksCompleted:118,responseTime:2.5,avatar:null}]),c([{id:1,type:"warning",message:"High server load detected",time:"5 minutes ago",severity:"medium"},{id:2,type:"info",message:"Database backup completed",time:"1 hour ago",severity:"low"},{id:3,type:"success",message:"New caregiver verification completed",time:"2 hours ago",severity:"low"}]),h(new Date),d(!1)},1e3)}catch(e){console.error("Error loading dashboard data:",e),d(!1)}})()},[]);const p=e=>{switch(e){case"emergency":return(0,Xf.jsx)(eg,{className:"h-4 w-4 text-red-500"});case"appointment":return(0,Xf.jsx)(Vf,{className:"h-4 w-4 text-blue-500"});case"medication":return(0,Xf.jsx)(Ff,{className:"h-4 w-4 text-green-500"});case"user":return(0,Xf.jsx)(ng,{className:"h-4 w-4 text-purple-500"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4 text-gray-500"})}},m=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return l?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Monitor and manage the ElderX platform"}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Last updated: ",u.toLocaleTimeString()]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsxs)("button",{onClick:()=>{d(!0),loadDashboardData()},disabled:l,className:"flex items-center px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:[(0,Xf.jsx)(My,{className:"h-4 w-4 mr-2 ".concat(l?"animate-spin":"")}),"Refresh"]}),(0,Xf.jsxs)("button",{className:"flex items-center px-3 py-2 text-sm bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"System Healthy"})]})]})]}),(0,Xf.jsxs)("div",{className:"w-full p-6 dashboard-full-width",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.totalUsers.toLocaleString()})]}),(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-blue-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+12% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Elderly Users"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.elderlyUsers.toLocaleString()})]}),(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-green-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+8% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Caregivers"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.caregivers.toLocaleString()})]}),(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(ng,{className:"h-6 w-6 text-purple-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+15% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Appointments"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.activeAppointments})]}),(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-orange-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-blue-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-blue-600",children:"Today's schedule"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20a6",e.revenue.toLocaleString()]})]}),(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(Uy,{className:"h-6 w-6 text-green-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+18% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Satisfaction Rate"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.satisfaction,"%"]})]}),(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-yellow-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+2.1% from last month"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Response Time"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.responseTime,"s"]})]}),(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(yg,{className:"h-6 w-6 text-blue-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-red-600",children:"+0.2s from last week"})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"System Uptime"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.uptime,"%"]})]}),(0,Xf.jsx)("div",{className:"p-3 bg-indigo-100 rounded-full",children:(0,Xf.jsx)(cg,{className:"h-6 w-6 text-indigo-600"})})]}),(0,Xf.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600",children:"+0.1% from last month"})]})]})]}),e.emergencyAlerts>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Emergency Alerts"}),(0,Xf.jsxs)("p",{className:"text-red-600",children:[e.emergencyAlerts," active emergency alert",e.emergencyAlerts>1?"s":""," requiring immediate attention"]})]})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/emergency",className:"btn btn-red",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 mr-2"}),"View Emergencies"]})]})}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"System Health"}),(0,Xf.jsx)(cg,{className:"h-5 w-5 text-green-600"})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Database"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Authentication"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Notifications"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"API Response Time"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"45ms"})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),(0,Xf.jsx)($f,{className:"h-5 w-5 text-gray-600"})]}),(0,Xf.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[p(e.type),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:e.message}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:e.time}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(m(e.status)),children:e.status})]})]})]},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Caregivers"}),(0,Xf.jsx)(ng,{className:"h-5 w-5 text-purple-600"})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:r.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center",children:(0,Xf.jsx)(ng,{className:"h-5 w-5 text-purple-600"})})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-600",children:[e.patientsServed," patients"]})]})]}),(0,Xf.jsxs)("div",{className:"text-right",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.rating}),(0,Xf.jsx)("span",{className:"text-xs text-gray-500 ml-1",children:"\u2605"})]}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-600",children:[e.tasksCompleted," tasks"]})]})]},e.id))})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"System Alerts"}),(0,Xf.jsx)(eg,{className:"h-5 w-5 text-orange-600"})]}),(0,Xf.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,Xf.jsx)("div",{className:"p-3 rounded-lg border-l-4 ".concat("high"===e.severity?"bg-red-50 border-red-500":"medium"===e.severity?"bg-yellow-50 border-yellow-500":"bg-green-50 border-green-500"),children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:e.message}),(0,Xf.jsx)("span",{className:"text-xs text-gray-500",children:e.time})]})},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-8 gap-4",children:[(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/users",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(Zf,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Manage Users"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/caregivers",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ng,{className:"h-5 w-5 text-indigo-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Caregivers"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/analytics",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(Qf,{className:"h-5 w-5 text-orange-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Analytics"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/communication",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ig,{className:"h-5 w-5 text-teal-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Messages"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/audit-logs",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ag,{className:"h-5 w-5 text-gray-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Audit Logs"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/emergency",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(eg,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"Emergency Center"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/reports",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(ag,{className:"h-5 w-5 text-green-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"View Reports"})]}),(0,Xf.jsxs)("button",{onClick:()=>window.location.href="/admin/settings",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Xf.jsx)(cg,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium",children:"System Settings"})]})]})]})]})]})},Fy=Mf("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),By=Mf("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Gy=Mf("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Wy=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Adunni Okafor",email:"adunni@example.com",phone:"+234 801 987 6543",type:"elderly",status:"active",joinDate:"2024-01-15",lastActive:"2024-01-20",emergencyContact:"Dr. Kemi Okafor",medicalConditions:["Hypertension","Diabetes Type 2"]},{id:2,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",type:"caregiver",status:"active",joinDate:"2024-01-10",lastActive:"2024-01-20",certifications:["CPR Certified","First Aid"],experience:"5 years"},{id:3,name:"Grace Johnson",email:"grace@example.com",phone:"+234 803 456 7890",type:"elderly",status:"inactive",joinDate:"2023-12-20",lastActive:"2024-01-15",emergencyContact:"Dr. Michael Johnson",medicalConditions:["Arthritis"]},{id:4,name:"Dr. Kemi Okafor",email:"kemi@example.com",phone:"+234 804 789 0123",type:"doctor",status:"active",joinDate:"2023-11-01",lastActive:"2024-01-20",specialization:"Geriatrics",licenseNumber:"MD12345"}];n(e),i(e),a(!1)},1e3)}catch(e){console.error("Error loading users:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.phone.includes(o))),"all"!==l&&(t=t.filter(e=>e.type===l)),i(t)},[o,l,e]);const f=e=>{switch(e){case"elderly":return"bg-blue-100 text-blue-800";case"caregiver":return"bg-green-100 text-green-800";case"doctor":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";case"suspended":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},y=(e,t)=>{if(h(t),"view"===e)m(!0)};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage elderly users, caregivers, and doctors"})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Fy,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search users by name, email, or phone...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Users"}),(0,Xf.jsx)("option",{value:"elderly",children:"Elderly"}),(0,Xf.jsx)("option",{value:"caregiver",children:"Caregivers"}),(0,Xf.jsx)("option",{value:"doctor",children:"Doctors"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Join Date"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(e.type)),children:e.type.charAt(0).toUpperCase()+e.type.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(g(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.joinDate).toLocaleDateString()}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.lastActive).toLocaleDateString()}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>y("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>y("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit User",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("div",{className:"relative",children:(0,Xf.jsx)("button",{className:"text-gray-600 hover:text-gray-900",title:"More Actions",children:(0,Xf.jsx)(qg,{className:"h-4 w-4"})})})]})})]},e.id))})]})}),0===s.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(By,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"Get started by adding a new user."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"User Details"}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Xf.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-lg font-medium text-gray-700",children:u.name.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-xl font-semibold text-gray-900",children:u.name}),(0,Xf.jsxs)("div",{className:"flex space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(u.type)),children:u.type.charAt(0).toUpperCase()+u.type.slice(1)}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(g(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.email})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.phone})]})]})]}),"elderly"===u.type&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Contact"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.emergencyContact})]}),"elderly"===u.type&&u.medicalConditions&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medical Conditions"}),(0,Xf.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:u.medicalConditions.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:e},t))})]}),"caregiver"===u.type&&u.certifications&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Certifications"}),(0,Xf.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:u.certifications.map((e,t)=>(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Xf.jsx)(Gy,{className:"h-3 w-3 mr-1"}),e]},t))})]}),"doctor"===u.type&&(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Specialization"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.specialization})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"License Number"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.licenseNumber})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Join Date"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:new Date(u.joinDate).toLocaleDateString()})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Active"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:new Date(u.lastActive).toLocaleDateString()})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit User"]})]})]})})})]})},Hy=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)({startDate:"",endDate:""}),[o,c]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n([{id:1,title:"User Activity Report",description:"Comprehensive overview of user engagement and activity patterns",type:"user_activity",generatedAt:"2024-01-20T10:30:00Z",period:"Last 30 days",records:1247,status:"ready"},{id:2,title:"Emergency Response Report",description:"Analysis of emergency alerts and response times",type:"emergency",generatedAt:"2024-01-19T15:45:00Z",period:"Last 7 days",records:23,status:"ready"},{id:3,title:"Medication Compliance Report",description:"Medication adherence and reminder effectiveness",type:"medication",generatedAt:"2024-01-18T09:15:00Z",period:"Last 14 days",records:892,status:"ready"},{id:4,title:"Caregiver Performance Report",description:"Caregiver activity and patient satisfaction metrics",type:"caregiver",generatedAt:"2024-01-17T14:20:00Z",period:"Last 30 days",records:355,status:"generating"},{id:5,title:"System Health Report",description:"Platform performance and system metrics",type:"system",generatedAt:"2024-01-16T11:00:00Z",period:"Last 24 hours",records:156,status:"ready"}]),i(!1)},1e3)}catch(e){console.error("Error loading reports:",e),i(!1)}})()},[]);const l=e=>{switch(e){case"user_activity":return(0,Xf.jsx)(Zf,{className:"h-5 w-5 text-blue-600"});case"emergency":return(0,Xf.jsx)($f,{className:"h-5 w-5 text-red-600"});case"medication":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-green-600"});case"caregiver":return(0,Xf.jsx)(Zf,{className:"h-5 w-5 text-purple-600"});case"system":return(0,Xf.jsx)(Qf,{className:"h-5 w-5 text-orange-600"});default:return(0,Xf.jsx)(ag,{className:"h-5 w-5 text-gray-600"})}},d=e=>{switch(e){case"ready":return"bg-green-100 text-green-800";case"generating":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return s?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Reports & Analytics"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Generate and view platform reports"})]}),(0,Xf.jsxs)("button",{onClick:()=>{console.log("Generating report with:",{dateRange:r,reportType:o})},className:"btn btn-primary",children:[(0,Xf.jsx)(Qf,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generate New Report"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),(0,Xf.jsxs)("select",{className:"form-input",value:o,onChange:e=>c(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Reports"}),(0,Xf.jsx)("option",{value:"user_activity",children:"User Activity"}),(0,Xf.jsx)("option",{value:"emergency",children:"Emergency Response"}),(0,Xf.jsx)("option",{value:"medication",children:"Medication Compliance"}),(0,Xf.jsx)("option",{value:"caregiver",children:"Caregiver Performance"}),(0,Xf.jsx)("option",{value:"system",children:"System Health"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,Xf.jsx)("input",{type:"date",className:"form-input",value:r.startDate,onChange:e=>a(Le(Le({},r),{},{startDate:e.target.value}))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,Xf.jsx)("input",{type:"date",className:"form-input",value:r.endDate,onChange:e=>a(Le(Le({},r),{},{endDate:e.target.value}))})]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(ag,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Reports"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(sg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Ready Reports"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"ready"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Generating"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"generating"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Qf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Records"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.reduce((e,t)=>e+t.records,0).toLocaleString()})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Reports"}),(0,Xf.jsx)("div",{className:"flex items-center space-x-2",children:(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:l(e.type)}),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.title}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Generated: ",new Date(e.generatedAt).toLocaleDateString()]}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Period: ",e.period]}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-500",children:["Records: ",e.records.toLocaleString()]})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-1",children:["ready"===e.status&&(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Viewing report:",t);var t},className:"p-2 text-gray-400 hover:text-gray-600",title:"View Report",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Downloading report:",t);var t},className:"p-2 text-gray-400 hover:text-gray-600",title:"Download Report",children:(0,Xf.jsx)(ry,{className:"h-4 w-4"})})]}),"generating"===e.status&&(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,Xf.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"Generating..."})]})]})]})]})},e.id))}),0===e.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(ag,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No reports found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Generate your first report to get started."})]})]})]})},Ky=Mf("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),zy=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientEmail:"adunni@example.com",patientPhone:"+234 801 987 6543",doctorName:"Dr. Kemi Okafor",type:"Regular Checkup",dateTime:"2024-01-22T10:00:00Z",location:"Lagos General Hospital",status:"scheduled",notes:"Follow-up for hypertension medication",duration:30},{id:2,patientName:"Grace Johnson",patientEmail:"grace@example.com",patientPhone:"+234 803 456 7890",doctorName:"Dr. Michael Johnson",type:"Emergency Consultation",dateTime:"2024-01-21T14:30:00Z",location:"Emergency Room",status:"completed",notes:"Emergency visit for chest pain",duration:45},{id:3,patientName:"Tunde Adebayo",patientEmail:"tunde@example.com",patientPhone:"+234 802 123 4567",doctorName:"Dr. Sarah Williams",type:"Medication Review",dateTime:"2024-01-23T09:15:00Z",location:"Cardiology Clinic",status:"scheduled",notes:"Review diabetes medication effectiveness",duration:20},{id:4,patientName:"Mary Okonkwo",patientEmail:"mary@example.com",patientPhone:"+234 805 234 5678",doctorName:"Dr. Kemi Okafor",type:"Physical Therapy",dateTime:"2024-01-20T11:00:00Z",location:"Physical Therapy Center",status:"cancelled",notes:"Patient cancelled due to illness",duration:60}];n(e),i(e),a(!1)},1e3)}catch(e){console.error("Error loading appointments:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.doctorName.toLowerCase().includes(o.toLowerCase())||e.type.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),i(t)},[o,l,e]);const f=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"rescheduled":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"scheduled":return(0,Xf.jsx)(dg,{className:"h-4 w-4"});case"completed":return(0,Xf.jsx)(mg,{className:"h-4 w-4"});case"cancelled":return(0,Xf.jsx)(Tg,{className:"h-4 w-4"});case"rescheduled":return(0,Xf.jsx)(Ky,{className:"h-4 w-4"});default:return(0,Xf.jsx)(Vf,{className:"h-4 w-4"})}},y=(e,t)=>{if(h(t),"view"===e)m(!0)},v=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Appointment Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage patient appointments and schedules"})]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 mr-2"}),"Schedule Appointment"]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Vf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"completed"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Scheduled"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"scheduled"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(Tg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Cancelled"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"cancelled"===e.status).length})]})]})})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search appointments by patient, doctor, or type...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,Xf.jsx)("option",{value:"completed",children:"Completed"}),(0,Xf.jsx)("option",{value:"cancelled",children:"Cancelled"}),(0,Xf.jsx)("option",{value:"rescheduled",children:"Rescheduled"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>{const{date:t,time:n}=v(e.dateTime);return(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(Yf,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.patientEmail})]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.doctorName})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.type})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:t}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:n})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(e.status)),children:[g(e.status),(0,Xf.jsx)("span",{className:"ml-1",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>y("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>y("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Appointment",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),0===s.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(Vf,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No appointments found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No appointments have been scheduled yet."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Appointment Details"}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Name"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.patientName})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Doctor"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.doctorName})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Date & Time"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:v(u.dateTime).date})]}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:v(u.dateTime).time})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Duration"}),(0,Xf.jsxs)("p",{className:"mt-1 text-sm text-gray-900",children:[u.duration," minutes"]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Contact"}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientPhone})]}),(0,Xf.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientEmail})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(u.status)),children:[g(u.status),(0,Xf.jsx)("span",{className:"ml-1",children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.notes})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Appointment"]})]})]})})})]})},qy=Mf("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Yy=()=>{const[e,n]=(0,t.useState)("general"),[s,i]=(0,t.useState)({general:{platformName:"ElderX",platformDescription:"Your trusted health companion for elderly care",supportEmail:"support@elderx.com",supportPhone:"+234 800 ELDERX",timezone:"Africa/Lagos",language:"en"},notifications:{emailNotifications:!0,smsNotifications:!0,pushNotifications:!0,emergencyAlerts:!0,appointmentReminders:!0,medicationReminders:!0,systemAlerts:!0},security:{twoFactorAuth:!0,sessionTimeout:30,passwordPolicy:"strong",loginAttempts:5,ipWhitelist:!1,auditLogging:!0},system:{maintenanceMode:!1,autoBackup:!0,backupFrequency:"daily",dataRetention:365,apiRateLimit:1e3,maxFileSize:10}}),[r,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(null),l=[{id:"general",name:"General",icon:og},{id:"notifications",name:"Notifications",icon:qf},{id:"security",name:"Security",icon:cg},{id:"system",name:"System",icon:qy}],d=(e,t,n)=>{i(s=>Le(Le({},s),{},{[e]:Le(Le({},s[e]),{},{[t]:n})}))},u=()=>(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Platform Information"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Platform Name"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:s.general.platformName,onChange:e=>d("general","platformName",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Support Email"}),(0,Xf.jsx)("input",{type:"email",className:"form-input",value:s.general.supportEmail,onChange:e=>d("general","supportEmail",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Support Phone"}),(0,Xf.jsx)("input",{type:"text",className:"form-input",value:s.general.supportPhone,onChange:e=>d("general","supportPhone",e.target.value)})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),(0,Xf.jsxs)("select",{className:"form-input",value:s.general.timezone,onChange:e=>d("general","timezone",e.target.value),children:[(0,Xf.jsx)("option",{value:"Africa/Lagos",children:"Africa/Lagos"}),(0,Xf.jsx)("option",{value:"Africa/Cairo",children:"Africa/Cairo"}),(0,Xf.jsx)("option",{value:"Africa/Johannesburg",children:"Africa/Johannesburg"}),(0,Xf.jsx)("option",{value:"UTC",children:"UTC"})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6",children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Platform Description"}),(0,Xf.jsx)("textarea",{className:"form-input",rows:3,value:s.general.platformDescription,onChange:e=>d("general","platformDescription",e.target.value)})]})]})}),h=e=>({emailNotifications:"Send notifications via email",smsNotifications:"Send notifications via SMS",pushNotifications:"Send push notifications to mobile apps",emergencyAlerts:"Immediate alerts for emergency situations",appointmentReminders:"Remind users about upcoming appointments",medicationReminders:"Remind users to take medications",systemAlerts:"Notify about system issues and updates"}[e]||"");return(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"System Settings"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Configure platform settings and preferences"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:["success"===o&&(0,Xf.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm",children:"Saved successfully"})]}),"error"===o&&(0,Xf.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm",children:"Save failed"})]}),(0,Xf.jsxs)("button",{onClick:async()=>{a(!0),c(null);try{await new Promise(e=>setTimeout(e,1e3)),c("success"),setTimeout(()=>c(null),3e3)}catch(e){c("error"),setTimeout(()=>c(null),3e3)}finally{a(!1)}},disabled:r,className:"btn btn-primary",children:[(0,Xf.jsx)(dy,{className:"h-4 w-4 mr-2"}),r?"Saving...":"Save Changes"]})]})]}),(0,Xf.jsx)("div",{className:"border-b border-gray-200",children:(0,Xf.jsx)("nav",{className:"-mb-px flex space-x-8",children:l.map(t=>{const s=t.icon;return(0,Xf.jsxs)("button",{onClick:()=>n(t.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center ".concat(e===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(s,{className:"h-4 w-4 mr-2"}),t.name]},t.id)})})}),(0,Xf.jsx)("div",{className:"card",children:(()=>{switch(e){case"general":default:return u();case"notifications":return(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Notification Preferences"}),(0,Xf.jsx)("div",{className:"space-y-4",children:Object.entries(s.notifications).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:h(t)})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:e=>d("notifications",t,e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})})]})});case"security":return(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Security Configuration"}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Two-Factor Authentication"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Require 2FA for admin accounts"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s.security.twoFactorAuth,onChange:e=>d("security","twoFactorAuth",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Timeout (minutes)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:s.security.sessionTimeout,onChange:e=>d("security","sessionTimeout",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password Policy"}),(0,Xf.jsxs)("select",{className:"form-input w-48",value:s.security.passwordPolicy,onChange:e=>d("security","passwordPolicy",e.target.value),children:[(0,Xf.jsx)("option",{value:"basic",children:"Basic (6+ characters)"}),(0,Xf.jsx)("option",{value:"medium",children:"Medium (8+ chars, mixed case)"}),(0,Xf.jsx)("option",{value:"strong",children:"Strong (8+ chars, mixed case, numbers, symbols)"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Login Attempts"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:s.security.loginAttempts,onChange:e=>d("security","loginAttempts",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Audit Logging"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Log all admin actions for security"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s.security.auditLogging,onChange:e=>d("security","auditLogging",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]})});case"system":return(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"System Configuration"}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Maintenance Mode"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Temporarily disable platform access"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s.system.maintenanceMode,onChange:e=>d("system","maintenanceMode",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Auto Backup"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"Automatically backup system data"})]}),(0,Xf.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Xf.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s.system.autoBackup,onChange:e=>d("system","autoBackup",e.target.checked)}),(0,Xf.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Frequency"}),(0,Xf.jsxs)("select",{className:"form-input w-48",value:s.system.backupFrequency,onChange:e=>d("system","backupFrequency",e.target.value),children:[(0,Xf.jsx)("option",{value:"hourly",children:"Hourly"}),(0,Xf.jsx)("option",{value:"daily",children:"Daily"}),(0,Xf.jsx)("option",{value:"weekly",children:"Weekly"}),(0,Xf.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Retention (days)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:s.system.dataRetention,onChange:e=>d("system","dataRetention",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Rate Limit (requests/hour)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:s.system.apiRateLimit,onChange:e=>d("system","apiRateLimit",parseInt(e.target.value))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max File Size (MB)"}),(0,Xf.jsx)("input",{type:"number",className:"form-input w-32",value:s.system.maxFileSize,onChange:e=>d("system","maxFileSize",parseInt(e.target.value))})]})]})]})})}})()})]})},Xy=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({active:0,resolved:0,averageResponseTime:0,totalToday:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",patientPhone:"+234 801 987 6543",patientEmail:"adunni@example.com",emergencyType:"Medical Emergency",severity:"Critical",description:"Chest pain and difficulty breathing",location:"Lagos, Nigeria",coordinates:{lat:6.5244,lng:3.3792},triggeredAt:"2024-01-20T14:30:00Z",status:"active",responseTime:0,assignedTo:"Dr. Kemi Okafor",assignedToPhone:"+234 802 123 4567",familyContact:"Tunde Adebayo",familyPhone:"+234 803 456 7890",medicalHistory:["Hypertension","Diabetes Type 2"],currentMedications:["Metformin","Lisinopril"],notes:"Patient reported severe chest pain. Emergency services contacted.",actions:[{id:1,action:"Emergency services contacted",timestamp:"2024-01-20T14:32:00Z",performedBy:"System",status:"completed"},{id:2,action:"Family notified",timestamp:"2024-01-20T14:35:00Z",performedBy:"Admin",status:"completed"}]},{id:2,patientName:"Grace Johnson",patientId:"ELD002",patientPhone:"+234 803 456 7890",patientEmail:"grace@example.com",emergencyType:"Fall Detection",severity:"High",description:"Patient fell and may be injured",location:"Abuja, Nigeria",coordinates:{lat:9.0765,lng:7.3986},triggeredAt:"2024-01-20T10:15:00Z",status:"resolved",responseTime:12,assignedTo:"Dr. Michael Johnson",assignedToPhone:"+234 804 567 8901",familyContact:"John Johnson",familyPhone:"+234 805 678 9012",medicalHistory:["Arthritis","Osteoporosis"],currentMedications:["Calcium","Vitamin D"],notes:"Patient fell in bathroom. Minor injuries reported. Family assisted.",actions:[{id:1,action:"Fall detected by sensor",timestamp:"2024-01-20T10:15:00Z",performedBy:"IoT Device",status:"completed"},{id:2,action:"Family contacted",timestamp:"2024-01-20T10:18:00Z",performedBy:"System",status:"completed"},{id:3,action:"Emergency resolved",timestamp:"2024-01-20T10:27:00Z",performedBy:"Dr. Michael Johnson",status:"completed"}]},{id:3,patientName:"Tunde Adebayo",patientId:"ELD003",patientPhone:"+234 802 123 4567",patientEmail:"tunde@example.com",emergencyType:"Medication Overdose",severity:"Critical",description:"Patient may have taken double dose of medication",location:"Ibadan, Nigeria",coordinates:{lat:7.3775,lng:3.947},triggeredAt:"2024-01-20T08:45:00Z",status:"active",responseTime:0,assignedTo:"Dr. Sarah Williams",assignedToPhone:"+234 806 789 0123",familyContact:"Adebayo Family",familyPhone:"+234 807 890 1234",medicalHistory:["Diabetes Type 2","Heart Disease"],currentMedications:["Insulin","Metformin","Aspirin"],notes:"Patient accidentally took double dose of insulin. Monitoring blood sugar levels.",actions:[{id:1,action:"Overdose alert triggered",timestamp:"2024-01-20T08:45:00Z",performedBy:"Medication Tracker",status:"completed"},{id:2,action:"Emergency services contacted",timestamp:"2024-01-20T08:47:00Z",performedBy:"System",status:"completed"}]}],t=e.filter(e=>"active"===e.status).length,s=e.filter(e=>"resolved"===e.status).length,r=e.length,o=e.filter(e=>e.responseTime>0).reduce((e,t)=>e+t.responseTime,0)/s||0;g({active:t,resolved:s,averageResponseTime:Math.round(o),totalToday:r}),n(e),i(e),a(!1)},1e3)}catch(e){console.error("Error loading emergency data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.emergencyType.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),i(t)},[o,l,e]);const y=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800 border-red-200";case"High":return"bg-orange-100 text-orange-800 border-orange-200";case"Medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},v=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"resolved":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},_=e=>{switch(e){case"active":return(0,Xf.jsx)(eg,{className:"h-4 w-4"});case"resolved":return(0,Xf.jsx)(mg,{className:"h-4 w-4"});case"in_progress":return(0,Xf.jsx)($f,{className:"h-4 w-4"});default:return(0,Xf.jsx)(dg,{className:"h-4 w-4"})}},E=(e,t)=>{if(h(t),"view"===e)m(!0)},b=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},x=e=>{const t=new Date,n=new Date(e),s=Math.floor((t-n)/6e4);return s<1?"Just now":s<60?"".concat(s,"m ago"):s<1440?"".concat(Math.floor(s/60),"h ago"):"".concat(Math.floor(s/1440),"d ago")};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Monitor and manage emergency alerts in real-time"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(My,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(qf,{className:"h-4 w-4 mr-2"}),"Test Alert"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Emergencies"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-red-600",children:f.active})]})]})}),(0,Xf.jsx)("div",{className:"card border-l-4 border-green-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Resolved Today"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-green-600",children:f.resolved})]})]})}),(0,Xf.jsx)("div",{className:"card border-l-4 border-blue-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Response Time"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[f.averageResponseTime,"m"]})]})]})}),(0,Xf.jsx)("div",{className:"card border-l-4 border-purple-500",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(sg,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Today"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:f.totalToday})]})]})})]}),f.active>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Active Emergency Alert"}),(0,Xf.jsxs)("p",{className:"text-red-600",children:[f.active," emergency",f.active>1?"ies":""," requiring immediate attention"]})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-red",children:[(0,Xf.jsx)(Lg,{className:"h-4 w-4 mr-2"}),"View Active"]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search emergencies by patient, type, or description...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,Xf.jsx)("option",{value:"resolved",children:"Resolved"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Emergency Alerts"}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:"Auto-refresh: ON"}),(0,Xf.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]})]}),(0,Xf.jsx)("div",{className:"space-y-4",children:s.map(e=>{const{date:t,time:n}=b(e.triggeredAt);return(0,Xf.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 ".concat("active"===e.status?"border-red-200 bg-red-50":"border-gray-200"),children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:"active"===e.status?(0,Xf.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}):(0,Xf.jsx)("div",{className:"w-3 h-3 bg-gray-300 rounded-full"})}),(0,Xf.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(y(e.severity)),children:e.severity}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(v(e.status)),children:[_(e.status),(0,Xf.jsx)("span",{className:"ml-1",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 mr-1"}),e.location]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 mr-1"}),x(e.triggeredAt)]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Yf,{className:"h-4 w-4 mr-1"}),e.assignedTo]})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>E("view",e),className:"p-2 text-gray-400 hover:text-gray-600",title:"View Details",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),"active"===e.status&&(0,Xf.jsx)("button",{onClick:()=>E("resolve",e),className:"p-2 text-green-600 hover:text-green-800",title:"Mark as Resolved",children:(0,Xf.jsx)(mg,{className:"h-4 w-4"})})]})]})},e.id)})}),0===s.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(cg,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No emergencies found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No emergency alerts at this time."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Emergency Details"}),(0,Xf.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(v(u.status)),children:[_(u.status),(0,Xf.jsx)("span",{className:"ml-1",children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Patient Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Name"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.patientName})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientPhone})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.patientEmail})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Medical Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medical History"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.medicalHistory.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:e},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Current Medications"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.currentMedications.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Emergency Details"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Type"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.emergencyType})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Severity"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(y(u.severity)),children:u.severity})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.description})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Triggered At"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[b(u.triggeredAt).date," at ",b(u.triggeredAt).time]})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Assigned Personnel"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Assigned Doctor"}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.assignedTo}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Family Contact"}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.familyContact}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Response Actions"}),(0,Xf.jsx)("div",{className:"space-y-2",children:u.actions.map(e=>(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 text-green-500"}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:e.action}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:[b(e.timestamp).date," at ",b(e.timestamp).time," by ",e.performedBy]})]})]},e.id))})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),"active"===u.status&&(0,Xf.jsxs)("button",{className:"btn btn-green",children:[(0,Xf.jsx)(mg,{className:"h-4 w-4 mr-2"}),"Mark as Resolved"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(ig,{className:"h-4 w-4 mr-2"}),"Add Note"]})]})]})})})]})},Jy=Mf("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Qy=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Cardiac Emergency Response",category:"Medical Emergency",severity:"Critical",description:"Standard protocol for handling cardiac emergencies including heart attacks and cardiac arrest",triggerConditions:["Chest pain reported","Heart rate irregular","Cardiac arrest detected","ECG abnormalities"],steps:[{id:1,step:"Immediate Assessment",description:"Assess patient consciousness and vital signs",duration:"2 minutes",responsible:"Emergency Response Team",priority:"Critical"},{id:2,step:"Call Emergency Services",description:"Contact local emergency services (911/999)",duration:"1 minute",responsible:"System/Admin",priority:"Critical"},{id:3,step:"Notify Family",description:"Contact emergency family contacts",duration:"2 minutes",responsible:"Admin",priority:"High"},{id:4,step:"CPR if Needed",description:"Begin CPR if patient is unresponsive",duration:"Ongoing",responsible:"Trained Personnel",priority:"Critical"},{id:5,step:"Medical History Review",description:"Review patient medical history and medications",duration:"3 minutes",responsible:"Medical Team",priority:"Medium"}],escalationRules:[{condition:"No response in 5 minutes",action:"Escalate to senior medical staff",contact:"Dr. Sarah Williams (+234 802 123 4567)"},{condition:"Patient condition worsens",action:"Contact emergency services again",contact:"Emergency Services (911)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Medical Director",name:"Dr. Sarah Williams",phone:"+234 802 123 4567",priority:"High"},{type:"Family Contact",name:"Emergency Family Contact",phone:"Patient-specific",priority:"High"}],isActive:!0,createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-01-20T14:30:00Z",createdBy:"Dr. Sarah Williams"},{id:2,name:"Fall Detection Response",category:"Fall Detection",severity:"High",description:"Protocol for responding to fall detection alerts from IoT devices",triggerConditions:["Fall detected by sensor","Patient reports fall","Caregiver reports fall","Motion sensor alerts"],steps:[{id:1,step:"Immediate Check",description:"Contact patient immediately via phone or app",duration:"1 minute",responsible:"System/Admin",priority:"High"},{id:2,step:"Assess Injury",description:"Determine if patient is injured and needs medical attention",duration:"3 minutes",responsible:"Medical Team",priority:"High"},{id:3,step:"Notify Family",description:"Contact family members about the fall",duration:"2 minutes",responsible:"Admin",priority:"Medium"},{id:4,step:"Arrange Care",description:"Arrange for caregiver or medical assistance if needed",duration:"5 minutes",responsible:"Care Team",priority:"Medium"}],escalationRules:[{condition:"Patient unresponsive",action:"Treat as medical emergency",contact:"Emergency Services (199)"},{condition:"Injury suspected",action:"Arrange immediate medical assessment",contact:"Dr. Michael Johnson (+234 803 456 7890)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Orthopedic Specialist",name:"Dr. Michael Johnson",phone:"+234 803 456 7890",priority:"High"}],isActive:!0,createdAt:"2024-01-10T09:00:00Z",updatedAt:"2024-01-18T16:45:00Z",createdBy:"Dr. Michael Johnson"},{id:3,name:"Medication Overdose Response",category:"Medication Emergency",severity:"Critical",description:"Protocol for handling medication overdoses and adverse reactions",triggerConditions:["Double dose detected","Wrong medication taken","Adverse reaction reported","Medication interaction alert"],steps:[{id:1,step:"Immediate Assessment",description:"Assess patient condition and vital signs",duration:"2 minutes",responsible:"Medical Team",priority:"Critical"},{id:2,step:"Identify Medication",description:"Determine which medication and dosage was taken",duration:"3 minutes",responsible:"Medical Team",priority:"Critical"},{id:3,step:"Contact Poison Control",description:"Contact poison control center for guidance",duration:"2 minutes",responsible:"Medical Team",priority:"Critical"},{id:4,step:"Emergency Services",description:"Call emergency services if needed",duration:"1 minute",responsible:"System/Admin",priority:"Critical"},{id:5,step:"Monitor Patient",description:"Continuous monitoring of patient condition",duration:"Ongoing",responsible:"Medical Team",priority:"High"}],escalationRules:[{condition:"Severe symptoms",action:"Immediate emergency services",contact:"Emergency Services (199)"},{condition:"Unknown medication",action:"Contact poison control immediately",contact:"Poison Control (+234 800 123 4567)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Poison Control",name:"National Poison Control",phone:"+234 800 123 4567",priority:"Critical"},{type:"Pharmacist",name:"Dr. Kemi Okafor",phone:"+234 804 567 8901",priority:"High"}],isActive:!0,createdAt:"2024-01-12T11:30:00Z",updatedAt:"2024-01-19T13:20:00Z",createdBy:"Dr. Kemi Okafor"}];n(e),i(e),a(!1)},1e3)}catch(e){console.error("Error loading protocols:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase())||e.category.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.category===l)),i(t)},[o,l,e]);const _=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800 border-red-200";case"High":return"bg-orange-100 text-orange-800 border-orange-200";case"Medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},E=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800";case"High":return"bg-orange-100 text-orange-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},b=e=>{switch(e){case"Medical Emergency":return(0,Xf.jsx)(Ff,{className:"h-5 w-5 text-red-600"});case"Fall Detection":return(0,Xf.jsx)($f,{className:"h-5 w-5 text-orange-600"});case"Medication Emergency":return(0,Xf.jsx)(cg,{className:"h-5 w-5 text-purple-600"});default:return(0,Xf.jsx)(eg,{className:"h-5 w-5 text-gray-600"})}},x=(e,t)=>{switch(h(t),e){case"view":m(!0);break;case"edit":v(t),g(!0)}},w=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Protocols"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage emergency response protocols and procedures"})]}),(0,Xf.jsxs)("button",{onClick:()=>g(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Create Protocol"]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(cg,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Protocols"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Protocols"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>e.isActive).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Critical Protocols"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"Critical"===e.severity).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Categories"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:new Set(e.map(e=>e.category)).size})]})]})})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search protocols by name, description, or category...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Categories"}),(0,Xf.jsx)("option",{value:"Medical Emergency",children:"Medical Emergency"}),(0,Xf.jsx)("option",{value:"Fall Detection",children:"Fall Detection"}),(0,Xf.jsx)("option",{value:"Medication Emergency",children:"Medication Emergency"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Protocol"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0",children:b(e.category)}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.description})]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e.category})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(_(e.severity)),children:e.severity})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)(mg,{className:"h-3 w-3 mr-1"}),"Active"]}):(0,Xf.jsxs)(Xf.Fragment,{children:[(0,Xf.jsx)(Tg,{className:"h-3 w-3 mr-1"}),"Inactive"]})})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w(e.updatedAt).date}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>x("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>x("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Protocol",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>x("copy",e),className:"text-purple-600 hover:text-purple-900",title:"Copy Protocol",children:(0,Xf.jsx)(Jy,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===s.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(cg,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No protocols found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"Create your first emergency protocol to get started."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[b(u.category),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.name}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(_(u.severity)),children:u.severity})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Description"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-700",children:u.description})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Trigger Conditions"}),(0,Xf.jsx)("ul",{className:"list-disc list-inside space-y-1",children:u.triggerConditions.map((e,t)=>(0,Xf.jsx)("li",{className:"text-sm text-gray-700",children:e},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Response Steps"}),(0,Xf.jsx)("div",{className:"space-y-3",children:u.steps.map(e=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Xf.jsx)("h5",{className:"font-medium text-gray-900",children:e.step}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(E(e.priority)),children:e.priority})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-3 w-3 mr-1"}),e.duration]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Zf,{className:"h-3 w-3 mr-1"}),e.responsible]})]})]},e.id))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Escalation Rules"}),(0,Xf.jsx)("div",{className:"space-y-2",children:u.escalationRules.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 text-yellow-600"}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.condition}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:e.action}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:["Contact: ",e.contact]})]})]},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Emergency Contacts"}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.contacts.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:e.type})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(E(e.priority)),children:e.priority}),(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(pg,{className:"h-4 w-4"})})]})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{onClick:()=>x("edit",u),className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Protocol"]})]})]})})})]})},Zy=Mf("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),$y=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({totalMedications:0,activeMedications:0,complianceRate:0,overdueDoses:0,drugInteractions:0,sideEffects:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",medicationName:"Metformin",genericName:"Metformin HCl",dosage:"500mg",frequency:"Twice daily",route:"Oral",startDate:"2024-01-01",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:92,totalDoses:60,takenDoses:55,missedDoses:5,lastTaken:"2024-01-20T08:00:00Z",nextDose:"2024-01-20T20:00:00Z",sideEffects:["Mild nausea","Occasional diarrhea"],drugInteractions:["Warfarin - Monitor INR"],instructions:"Take with food to reduce stomach upset",notes:"Patient reports good tolerance. Blood sugar well controlled.",reminders:{enabled:!0,times:["08:00","20:00"],methods:["push","sms"]}},{id:2,patientName:"Adunni Okafor",patientId:"ELD001",medicationName:"Lisinopril",genericName:"Lisinopril",dosage:"10mg",frequency:"Once daily",route:"Oral",startDate:"2023-12-15",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:98,totalDoses:35,takenDoses:34,missedDoses:1,lastTaken:"2024-01-20T09:00:00Z",nextDose:"2024-01-21T09:00:00Z",sideEffects:["Dry cough"],drugInteractions:["Potassium supplements - Monitor levels"],instructions:"Take at the same time each day",notes:"Blood pressure well controlled. Patient tolerates well.",reminders:{enabled:!0,times:["09:00"],methods:["push","email"]}},{id:3,patientName:"Grace Johnson",patientId:"ELD002",medicationName:"Calcium Carbonate",genericName:"Calcium Carbonate",dosage:"1000mg",frequency:"Twice daily",route:"Oral",startDate:"2024-01-10",endDate:"2024-12-31",prescribedBy:"Dr. Michael Johnson",status:"active",complianceRate:85,totalDoses:20,takenDoses:17,missedDoses:3,lastTaken:"2024-01-19T12:00:00Z",nextDose:"2024-01-20T12:00:00Z",sideEffects:["Constipation"],drugInteractions:["Iron supplements - Take 2 hours apart"],instructions:"Take with food and plenty of water",notes:"Patient needs reminder to take with meals.",reminders:{enabled:!0,times:["08:00","18:00"],methods:["push","sms","call"]}},{id:4,patientName:"Tunde Adebayo",patientId:"ELD003",medicationName:"Insulin Glargine",genericName:"Insulin Glargine",dosage:"30 units",frequency:"Once daily",route:"Subcutaneous",startDate:"2023-11-01",endDate:"2024-12-31",prescribedBy:"Dr. Sarah Williams",status:"active",complianceRate:95,totalDoses:80,takenDoses:76,missedDoses:4,lastTaken:"2024-01-20T07:00:00Z",nextDose:"2024-01-21T07:00:00Z",sideEffects:["Injection site irritation"],drugInteractions:["Alcohol - Monitor blood sugar"],instructions:"Inject at the same time each day, rotate injection sites",notes:"Blood sugar levels well controlled. Patient self-injects successfully.",reminders:{enabled:!0,times:["07:00"],methods:["push","sms"]}},{id:5,patientName:"Mary Okonkwo",patientId:"ELD004",medicationName:"Warfarin",genericName:"Warfarin Sodium",dosage:"5mg",frequency:"Once daily",route:"Oral",startDate:"2024-01-05",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:88,totalDoses:15,takenDoses:13,missedDoses:2,lastTaken:"2024-01-19T18:00:00Z",nextDose:"2024-01-20T18:00:00Z",sideEffects:["Bruising"],drugInteractions:["Metformin - Monitor INR closely","Aspirin - Increased bleeding risk"],instructions:"Take at the same time each day. Regular INR monitoring required.",notes:"INR levels stable. Patient educated about bleeding precautions.",reminders:{enabled:!0,times:["18:00"],methods:["push","call"]}}],t=e.length,s=e.filter(e=>"active"===e.status).length,r=e.reduce((e,t)=>e+t.complianceRate,0)/t,o=e.filter(e=>new Date(e.nextDose)<new Date&&"active"===e.status).length,c=e.reduce((e,t)=>e+t.drugInteractions.length,0),l=e.reduce((e,t)=>e+t.sideEffects.length,0);g({totalMedications:t,activeMedications:s,complianceRate:Math.round(r),overdueDoses:o,drugInteractions:c,sideEffects:l}),n(e),i(e),a(!1)},1e3)}catch(e){console.error("Error loading medication data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.medicationName.toLowerCase().includes(o.toLowerCase())||e.genericName.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),i(t)},[o,l,e]);const y=e=>e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600",v=e=>e>=90?(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-600"}):e>=80?(0,Xf.jsx)($f,{className:"h-4 w-4 text-yellow-600"}):(0,Xf.jsx)(Zy,{className:"h-4 w-4 text-red-600"}),_=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"paused":return"bg-yellow-100 text-yellow-800";case"discontinued":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=(e,t)=>{if(h(t),"view"===e)m(!0)},b=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},x=e=>new Date(e)<new Date;return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medication Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Monitor medication compliance and manage prescriptions"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Add Medication"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(tg,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Medications"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalMedications})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.activeMedications})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Qf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Compliance Rate"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[f.complianceRate,"%"]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Overdue Doses"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.overdueDoses})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(cg,{className:"h-6 w-6 text-orange-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Drug Interactions"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.drugInteractions})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Side Effects"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.sideEffects})]})]})})]}),f.overdueDoses>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Overdue Medication Doses"}),(0,Xf.jsxs)("p",{className:"text-red-600",children:[f.overdueDoses," medication dose",f.overdueDoses>1?"s":""," are overdue and need immediate attention"]})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-red",children:[(0,Xf.jsx)(qf,{className:"h-4 w-4 mr-2"}),"Send Reminders"]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search medications by patient, medication name, or generic name...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"paused",children:"Paused"}),(0,Xf.jsx)("option",{value:"discontinued",children:"Discontinued"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient & Medication"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dosage & Frequency"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compliance"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Dose"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>{const{date:t,time:n}=b(e.nextDose),s=x(e.nextDose);return(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(s?"bg-red-50":""),children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)(tg,{className:"h-5 w-5 text-gray-600"})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.medicationName}),(0,Xf.jsx)("div",{className:"text-xs text-gray-400",children:e.genericName})]})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.dosage}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.frequency}),(0,Xf.jsx)("div",{className:"text-xs text-gray-400",children:e.route})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[v(e.complianceRate),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(y(e.complianceRate)),children:[e.complianceRate,"%"]})]}),(0,Xf.jsxs)("div",{className:"text-xs text-gray-500",children:[e.takenDoses,"/",e.totalDoses," doses"]})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm ".concat(s?"text-red-600 font-medium":"text-gray-900"),children:t}),(0,Xf.jsx)("div",{className:"text-sm ".concat(s?"text-red-500":"text-gray-500"),children:n}),s&&(0,Xf.jsx)("div",{className:"text-xs text-red-600 font-medium",children:"OVERDUE"})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(_(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>E("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>E("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Medication",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),0===s.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(tg,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No medications found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No medications have been added yet."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)(tg,{className:"h-6 w-6 text-blue-600"}),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Medication Details"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(_(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Medication Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.patientName})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medication Name"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.medicationName}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:["(",u.genericName,")"]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Dosage"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.dosage})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Route"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.route})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Frequency"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.frequency})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Prescribed By"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.prescribedBy})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Compliance Tracking"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Compliance Rate"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[v(u.complianceRate),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(y(u.complianceRate)),children:[u.complianceRate,"%"]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Doses Taken"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.takenDoses,"/",u.totalDoses]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Missed Doses"}),(0,Xf.jsx)("span",{className:"text-sm text-red-600",children:u.missedDoses})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Taken"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(dg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[b(u.lastTaken).date," at ",b(u.lastTaken).time]})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Schedule & Reminders"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Next Dose"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Vf,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm ".concat(x(u.nextDose)?"text-red-600 font-medium":"text-gray-900"),children:[b(u.nextDose).date," at ",b(u.nextDose).time]})]}),x(u.nextDose)&&(0,Xf.jsx)("span",{className:"text-xs text-red-600 font-medium",children:"OVERDUE"})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Reminders"}),(0,Xf.jsxs)("div",{className:"space-y-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(qf,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.reminders.enabled?"Enabled":"Disabled"})]}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:["Times: ",u.reminders.times.join(", ")]}),(0,Xf.jsxs)("div",{className:"text-sm text-gray-500",children:["Methods: ",u.reminders.methods.join(", ")]})]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Safety Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[u.sideEffects.length>0&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Side Effects"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.sideEffects.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:e},t))})]}),u.drugInteractions.length>0&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Drug Interactions"}),(0,Xf.jsx)("div",{className:"space-y-1 mt-1",children:u.drugInteractions.map((e,t)=>(0,Xf.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:e},t))})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Instructions & Notes"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Instructions"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.instructions})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.notes})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Medication"]})]})]})})})]})},ev=()=>{const[e,n]=(0,t.useState)({complianceTrends:[],medicationStats:[],patientCompliance:[],sideEffectReports:[],drugInteractions:[],reminderEffectiveness:[]}),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)("30days"),[o,c]=(0,t.useState)("compliance");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{n({complianceTrends:[{date:"2024-01-01",compliance:85,patients:120},{date:"2024-01-02",compliance:87,patients:122},{date:"2024-01-03",compliance:89,patients:125},{date:"2024-01-04",compliance:88,patients:128},{date:"2024-01-05",compliance:91,patients:130},{date:"2024-01-06",compliance:90,patients:132},{date:"2024-01-07",compliance:92,patients:135},{date:"2024-01-08",compliance:89,patients:138},{date:"2024-01-09",compliance:87,patients:140},{date:"2024-01-10",compliance:90,patients:142},{date:"2024-01-11",compliance:93,patients:145},{date:"2024-01-12",compliance:91,patients:148},{date:"2024-01-13",compliance:88,patients:150},{date:"2024-01-14",compliance:90,patients:152},{date:"2024-01-15",compliance:92,patients:155},{date:"2024-01-16",compliance:89,patients:158},{date:"2024-01-17",compliance:87,patients:160},{date:"2024-01-18",compliance:91,patients:162},{date:"2024-01-19",compliance:93,patients:165},{date:"2024-01-20",compliance:90,patients:167}],medicationStats:[{medication:"Metformin",totalPatients:45,avgCompliance:92,sideEffects:3,interactions:2},{medication:"Lisinopril",totalPatients:38,avgCompliance:88,sideEffects:5,interactions:1},{medication:"Insulin",totalPatients:25,avgCompliance:95,sideEffects:2,interactions:3},{medication:"Warfarin",totalPatients:18,avgCompliance:85,sideEffects:4,interactions:4},{medication:"Calcium",totalPatients:32,avgCompliance:78,sideEffects:6,interactions:1},{medication:"Aspirin",totalPatients:28,avgCompliance:90,sideEffects:2,interactions:2}],patientCompliance:[{patient:"Adunni Okafor",totalMedications:3,compliance:92,missedDoses:5,lastCheck:"2024-01-20"},{patient:"Grace Johnson",totalMedications:2,compliance:85,missedDoses:8,lastCheck:"2024-01-19"},{patient:"Tunde Adebayo",totalMedications:4,compliance:95,missedDoses:2,lastCheck:"2024-01-20"},{patient:"Mary Okonkwo",totalMedications:2,compliance:88,missedDoses:6,lastCheck:"2024-01-18"},{patient:"John Smith",totalMedications:3,compliance:78,missedDoses:12,lastCheck:"2024-01-17"},{patient:"Sarah Williams",totalMedications:1,compliance:96,missedDoses:1,lastCheck:"2024-01-20"}],sideEffectReports:[{medication:"Metformin",sideEffect:"Nausea",frequency:12,severity:"Mild",trend:"decreasing"},{medication:"Lisinopril",sideEffect:"Dry Cough",frequency:8,severity:"Moderate",trend:"stable"},{medication:"Warfarin",sideEffect:"Bruising",frequency:6,severity:"Mild",trend:"stable"},{medication:"Calcium",sideEffect:"Constipation",frequency:15,severity:"Mild",trend:"increasing"},{medication:"Insulin",sideEffect:"Injection Site Irritation",frequency:4,severity:"Mild",trend:"decreasing"}],drugInteractions:[{medication1:"Warfarin",medication2:"Aspirin",severity:"High",frequency:3,action:"Monitor INR closely"},{medication1:"Metformin",medication2:"Warfarin",severity:"Medium",frequency:2,action:"Monitor blood sugar"},{medication1:"Calcium",medication2:"Iron",severity:"Low",frequency:5,action:"Take 2 hours apart"},{medication1:"Lisinopril",medication2:"Potassium",severity:"Medium",frequency:1,action:"Monitor potassium levels"}],reminderEffectiveness:[{method:"Push Notifications",sent:1250,responded:1100,effectiveness:88},{method:"SMS",sent:890,responded:756,effectiveness:85},{method:"Email",sent:650,responded:520,effectiveness:80},{method:"Phone Calls",sent:120,responded:108,effectiveness:90}]}),i(!1)},1e3)}catch(e){console.error("Error loading analytics data:",e),i(!1)}})()},[r]);const l=e=>e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600",d=e=>e>=90?(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-600"}):e>=80?(0,Xf.jsx)($f,{className:"h-4 w-4 text-yellow-600"}):(0,Xf.jsx)(Zy,{className:"h-4 w-4 text-red-600"}),u=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},h=e=>{switch(e){case"increasing":return(0,Xf.jsx)(sg,{className:"h-4 w-4 text-red-600"});case"decreasing":return(0,Xf.jsx)(Zy,{className:"h-4 w-4 text-green-600"});case"stable":return(0,Xf.jsx)($f,{className:"h-4 w-4 text-blue-600"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4 text-gray-600"})}};return s?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medication Analytics"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Comprehensive medication compliance and safety analytics"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("select",{className:"form-input",value:r,onChange:e=>a(e.target.value),children:[(0,Xf.jsx)("option",{value:"7days",children:"Last 7 days"}),(0,Xf.jsx)("option",{value:"30days",children:"Last 30 days"}),(0,Xf.jsx)("option",{value:"90days",children:"Last 90 days"}),(0,Xf.jsx)("option",{value:"1year",children:"Last year"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Qf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Compliance"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"90%"}),(0,Xf.jsx)("p",{className:"text-xs text-green-600",children:"+2% from last month"})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Doses Taken"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"2,847"}),(0,Xf.jsx)("p",{className:"text-xs text-green-600",children:"+5% from last month"})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(Tg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Missed Doses"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"156"}),(0,Xf.jsx)("p",{className:"text-xs text-red-600",children:"-8% from last month"})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Patients"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"167"}),(0,Xf.jsx)("p",{className:"text-xs text-blue-600",children:"+12 from last month"})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Compliance Trends"}),(0,Xf.jsx)("div",{className:"flex items-center space-x-2",children:(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),(0,Xf.jsx)("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)(Qf,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Xf.jsx)("p",{className:"text-gray-500",children:"Compliance trend chart would be displayed here"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-400",children:"Integration with charting library needed"})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medication Performance"}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Medication"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patients"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Compliance"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Side Effects"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Interactions"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.medicationStats.map((e,t)=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(tg,{className:"h-5 w-5 text-blue-600 mr-3"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.medication})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.totalPatients})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[d(e.avgCompliance),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(l(e.avgCompliance)),children:[e.avgCompliance,"%"]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.sideEffects})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.interactions})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})})})]},t))})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Patient Compliance Overview"}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Medications"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compliance"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Missed Doses"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Check"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.patientCompliance.map((e,t)=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center mr-3",children:(0,Xf.jsx)("span",{className:"text-xs font-medium text-gray-700",children:e.patient.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.patient})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.totalMedications})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[d(e.compliance),(0,Xf.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(l(e.compliance)),children:[e.compliance,"%"]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.missedDoses})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e.lastCheck})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})})})]},t))})]})})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Side Effect Reports"}),(0,Xf.jsx)("div",{className:"space-y-3",children:e.sideEffectReports.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(tg,{className:"h-4 w-4 text-blue-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.medication})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[h(e.trend),(0,Xf.jsx)("span",{className:"ml-1 text-xs text-gray-500",children:e.trend})]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.sideEffect}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:["Frequency: ",e.frequency]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("Mild"===e.severity?"bg-green-100 text-green-800":"Moderate"===e.severity?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.severity})]})]},t))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Drug Interactions"}),(0,Xf.jsx)("div",{className:"space-y-3",children:e.drugInteractions.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-4 w-4 text-orange-600 mr-2"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.medication1," + ",e.medication2]})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(u(e.severity)),children:e.severity})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.action}),(0,Xf.jsx)("div",{className:"flex items-center justify-between",children:(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:["Frequency: ",e.frequency]})})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Reminder Effectiveness"}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:e.reminderEffectiveness.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.method}),(0,Xf.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[e.effectiveness,"%"]})]}),(0,Xf.jsxs)("div",{className:"space-y-1",children:[(0,Xf.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:["Sent: ",e.sent]}),(0,Xf.jsxs)("span",{children:["Responded: ",e.responded]})]}),(0,Xf.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Xf.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(e.effectiveness,"%")}})})]})]},t))})]})]})},tv=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({totalCaregivers:0,activeCaregivers:0,averageRating:0,totalPatients:0,pendingAssignments:0,trainingCompleted:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",status:"active",rating:4.8,totalPatients:8,currentPatients:3,experience:"5 years",specializations:["Elderly Care","Dementia Care","Physical Therapy"],certifications:["CPR Certified","First Aid","Dementia Care Specialist"],location:"Lagos, Nigeria",availability:"Full-time",hourlyRate:2500,joinDate:"2023-06-15",lastActive:"2024-01-20T14:30:00Z",profileImage:null,bio:"Experienced caregiver with 5 years of dedicated service to elderly patients. Specializes in dementia care and physical therapy assistance.",languages:["English","Yoruba"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[{patientId:"ELD001",patientName:"Adunni Okafor",startDate:"2024-01-15",schedule:"Mon-Fri, 9AM-5PM",status:"active"},{patientId:"ELD002",patientName:"Grace Johnson",startDate:"2024-01-10",schedule:"Tue-Thu, 2PM-6PM",status:"active"}],performance:{punctuality:95,patientSatisfaction:4.8,taskCompletion:98,communication:4.7,safety:100},earnings:{thisMonth:18e4,lastMonth:175e3,total:21e5}},{id:2,name:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890",status:"active",rating:4.9,totalPatients:12,currentPatients:4,experience:"7 years",specializations:["Post-Surgery Care","Medication Management","Mobility Assistance"],certifications:["CPR Certified","First Aid","Medication Administration","Physical Therapy Aide"],location:"Abuja, Nigeria",availability:"Part-time",hourlyRate:3e3,joinDate:"2022-03-20",lastActive:"2024-01-20T16:45:00Z",profileImage:null,bio:"Highly skilled caregiver with extensive experience in post-surgery care and medication management. Known for excellent patient communication.",languages:["English","Hausa"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[{patientId:"ELD003",patientName:"Tunde Adebayo",startDate:"2024-01-12",schedule:"Mon-Wed-Fri, 10AM-4PM",status:"active"},{patientId:"ELD004",patientName:"Mary Okonkwo",startDate:"2024-01-08",schedule:"Tue-Thu, 1PM-7PM",status:"active"}],performance:{punctuality:98,patientSatisfaction:4.9,taskCompletion:100,communication:4.8,safety:100},earnings:{thisMonth:22e4,lastMonth:21e4,total:28e5}},{id:3,name:"Michael Johnson",email:"michael@example.com",phone:"+234 804 567 8901",status:"pending",rating:0,totalPatients:0,currentPatients:0,experience:"2 years",specializations:["Basic Care","Companionship"],certifications:["CPR Certified","First Aid"],location:"Ibadan, Nigeria",availability:"Full-time",hourlyRate:2e3,joinDate:"2024-01-18",lastActive:"2024-01-19T10:15:00Z",profileImage:null,bio:"New caregiver eager to provide quality care to elderly patients. Recently completed training and ready to start.",languages:["English","Yoruba"],vehicle:!1,backgroundCheck:"Pending",insurance:"Pending",currentAssignments:[],performance:{punctuality:0,patientSatisfaction:0,taskCompletion:0,communication:0,safety:0},earnings:{thisMonth:0,lastMonth:0,total:0}},{id:4,name:"Grace Okafor",email:"grace@example.com",phone:"+234 805 678 9012",status:"inactive",rating:4.6,totalPatients:15,currentPatients:0,experience:"6 years",specializations:["Palliative Care","End-of-Life Care","Family Support"],certifications:["CPR Certified","First Aid","Palliative Care Specialist","Grief Counseling"],location:"Port Harcourt, Nigeria",availability:"On-call",hourlyRate:3500,joinDate:"2021-09-10",lastActive:"2024-01-15T12:00:00Z",profileImage:null,bio:"Specialized in palliative and end-of-life care. Currently on temporary leave for personal reasons.",languages:["English","Igbo"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[],performance:{punctuality:92,patientSatisfaction:4.6,taskCompletion:95,communication:4.5,safety:98},earnings:{thisMonth:0,lastMonth:45e3,total:32e5}}],t=e.length,s=e.filter(e=>"active"===e.status).length,r=e.filter(e=>e.rating>0).reduce((e,t)=>e+t.rating,0)/e.filter(e=>e.rating>0).length,o=e.reduce((e,t)=>e+t.currentPatients,0),c=e.filter(e=>"pending"===e.status).length,l=e.filter(e=>e.certifications.length>=2).length;g({totalCaregivers:t,activeCaregivers:s,averageRating:Math.round(10*r)/10,totalPatients:o,pendingAssignments:c,trainingCompleted:l}),n(e),i(e),a(!1)},1e3)}catch(e){console.error("Error loading caregiver data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.specializations.some(e=>e.toLowerCase().includes(o.toLowerCase())))),"all"!==l&&(t=t.filter(e=>e.status===l)),i(t)},[o,l,e]);const y=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v=e=>e>=4.5?"text-green-600":e>=4?"text-yellow-600":e>=3?"text-orange-600":"text-red-600",_=(e,t)=>{if(h(t),"view"===e)m(!0)};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Caregiver Management"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage caregivers, assignments, and performance"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Fy,{className:"h-4 w-4 mr-2"}),"Add Caregiver"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Caregivers"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalCaregivers})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(mg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.activeCaregivers})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.pendingAssignments})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(fg,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Rating"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.averageRating})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-orange-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Patients"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalPatients})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-indigo-100 rounded-full",children:(0,Xf.jsx)(vg,{className:"h-6 w-6 text-indigo-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Trained"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.trainingCompleted})]})]})})]}),f.pendingAssignments>0&&(0,Xf.jsx)("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(eg,{className:"h-6 w-6 text-yellow-500 mr-3"}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-semibold text-yellow-800",children:"Pending Caregiver Approvals"}),(0,Xf.jsxs)("p",{className:"text-yellow-600",children:[f.pendingAssignments," caregiver",f.pendingAssignments>1?"s":""," waiting for approval and assignment"]})]})]}),(0,Xf.jsxs)("button",{className:"btn btn-yellow",children:[(0,Xf.jsx)(Lg,{className:"h-4 w-4 mr-2"}),"Review Pending"]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search caregivers by name, email, or specialization...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"active",children:"Active"}),(0,Xf.jsx)("option",{value:"pending",children:"Pending"}),(0,Xf.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Caregiver"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating & Experience"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Patients"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Specializations"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Xf.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),(0,Xf.jsx)("div",{className:"text-xs text-gray-400",children:e.location})]})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium ".concat(v(e.rating)),children:e.rating>0?e.rating:"N/A"})]}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.experience}),(0,Xf.jsxs)("div",{className:"text-xs text-gray-400",children:["\u20a6",e.hourlyRate.toLocaleString(),"/hr"]})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.currentPatients}),(0,Xf.jsxs)("div",{className:"text-xs text-gray-500",children:["of ",e.totalPatients," total"]})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.specializations.slice(0,2).map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t)),e.specializations.length>2&&(0,Xf.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.specializations.length-2," more"]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(y(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{onClick:()=>_("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>_("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Caregiver",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>_("assign",e),className:"text-purple-600 hover:text-purple-900",title:"Assign Patient",children:(0,Xf.jsx)(Ng,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===s.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(Zf,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No caregivers found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No caregivers have been added yet."})]})]}),p&&u&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Xf.jsx)("span",{className:"text-lg font-medium text-gray-700",children:u.name.split(" ").map(e=>e[0]).join("")})}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.name}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(y(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]}),(0,Xf.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Contact Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Eg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.email})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(pg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.phone})]}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(gg,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Professional Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Experience"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.experience})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Hourly Rate"}),(0,Xf.jsxs)("p",{className:"text-sm text-gray-900",children:["\u20a6",u.hourlyRate.toLocaleString()]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Availability"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.availability})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Languages"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900",children:u.languages.join(", ")})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Specializations"}),(0,Xf.jsx)("div",{className:"flex flex-wrap gap-2",children:u.specializations.map((e,t)=>(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Certifications"}),(0,Xf.jsx)("div",{className:"space-y-2",children:u.certifications.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(vg,{className:"h-4 w-4 text-green-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:e})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Performance Metrics"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Overall Rating"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium ".concat(v(u.rating)),children:u.rating>0?u.rating:"N/A"})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Punctuality"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.punctuality,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Patient Satisfaction"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.performance.patientSatisfaction})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Task Completion"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.taskCompletion,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Communication"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:u.performance.communication})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Safety Record"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.safety,"%"]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Current Assignments"}),(0,Xf.jsx)("div",{className:"space-y-3",children:u.currentAssignments.length>0?u.currentAssignments.map((e,t)=>(0,Xf.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Xf.jsx)("h5",{className:"font-medium text-gray-900",children:e.patientName}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.schedule}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:["Started: ",e.startDate]})]},t)):(0,Xf.jsx)("p",{className:"text-sm text-gray-500",children:"No current assignments"})})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Earnings Summary"}),(0,Xf.jsxs)("div",{className:"space-y-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"This Month"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["\u20a6",u.earnings.thisMonth.toLocaleString()]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Last Month"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:["\u20a6",u.earnings.lastMonth.toLocaleString()]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-700",children:"Total Earnings"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["\u20a6",u.earnings.total.toLocaleString()]})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4 mr-2"}),"Edit Caregiver"]}),(0,Xf.jsxs)("button",{className:"btn btn-green",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Assign Patient"]})]})]})})})]})},nv=Mf("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),sv=Mf("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),iv=()=>{const[e,n]=(0,t.useState)({overview:{},userMetrics:{},caregiverMetrics:{},emergencyMetrics:{},medicationMetrics:{},financialMetrics:{},geographicData:{},trends:{}}),[s,i]=(0,t.useState)(!0),[r,a]=(0,t.useState)("30d"),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)({overview:!0,users:!0,caregivers:!1,emergencies:!1,medications:!1,financial:!1,geographic:!1,trends:!1});(0,t.useEffect)(()=>{u()},[r]);const u=async()=>{try{i(!0),setTimeout(()=>{n({overview:{totalUsers:1247,activeCaregivers:89,totalAppointments:2341,emergencyAlerts:12,medicationCompliance:94.2,systemUptime:99.8,userGrowth:15.3,caregiverSatisfaction:4.7},userMetrics:{totalUsers:1247,newUsersThisMonth:156,activeUsers:892,inactiveUsers:355,userRetention:87.3,averageAge:72.5,genderDistribution:{male:45.2,female:54.8},locationDistribution:{Lagos:35.2,Abuja:22.1,Kano:15.8,"Port Harcourt":12.4,Ibadan:8.9,Others:5.6},registrationTrend:[{month:"Jan",count:89},{month:"Feb",count:112},{month:"Mar",count:98},{month:"Apr",count:134},{month:"May",count:156},{month:"Jun",count:178}]},caregiverMetrics:{totalCaregivers:89,activeCaregivers:67,pendingCaregivers:12,inactiveCaregivers:10,averageRating:4.6,averageExperience:4.2,topPerformers:[{name:"Tunde Adebayo",rating:4.9,patients:8,earnings:18e4},{name:"Sarah Williams",rating:4.8,patients:6,earnings:165e3},{name:"Grace Okafor",rating:4.7,patients:7,earnings:155e3}],performanceDistribution:{"Excellent (4.5+)":45,"Good (4.0-4.4)":32,"Average (3.5-3.9)":8,"Below Average (<3.5)":4},specializations:{"Elderly Care":67,"Dementia Care":45,"Physical Therapy":38,"Medication Management":52,"Post-Surgery Care":29}},emergencyMetrics:{totalEmergencies:12,resolvedEmergencies:10,activeEmergencies:2,averageResponseTime:8.5,emergencyTypes:{"Medical Emergency":5,Fall:3,"Medication Issue":2,"Equipment Malfunction":1,Other:1},responseTimeTrend:[{day:"Mon",time:7.2},{day:"Tue",time:8.1},{day:"Wed",time:9.3},{day:"Thu",time:6.8},{day:"Fri",time:8.9},{day:"Sat",time:10.2},{day:"Sun",time:9.1}],severityDistribution:{Critical:2,High:4,Medium:5,Low:1}},medicationMetrics:{totalMedications:2341,complianceRate:94.2,missedDoses:89,medicationErrors:3,averageAdherence:96.1,medicationTypes:{"Blood Pressure":456,Diabetes:389,"Heart Medication":234,"Pain Management":567,Vitamins:445,Other:250},complianceTrend:[{week:"Week 1",rate:92.1},{week:"Week 2",rate:94.3},{week:"Week 3",rate:95.8},{week:"Week 4",rate:94.2}]},financialMetrics:{totalRevenue:125e5,monthlyRevenue:21e5,revenueGrowth:12.5,averageTransactionValue:45e3,revenueByService:{"Caregiver Services":85e5,"Medication Management":21e5,"Emergency Services":12e5,Consultation:7e5},paymentMethods:{"Bank Transfer":45.2,"Card Payment":32.1,"Mobile Money":18.7,Cash:4},monthlyRevenueTrend:[{month:"Jan",revenue:18e5},{month:"Feb",revenue:195e4},{month:"Mar",revenue:21e5},{month:"Apr",revenue:205e4},{month:"May",revenue:22e5},{month:"Jun",revenue:21e5}]},geographicData:{userDistribution:{Lagos:439,Abuja:276,Kano:197,"Port Harcourt":155,Ibadan:111,Others:69},caregiverDistribution:{Lagos:31,Abuja:19,Kano:14,"Port Harcourt":11,Ibadan:8,Others:6},serviceAreas:[{city:"Lagos",coverage:95,users:439,caregivers:31},{city:"Abuja",coverage:88,users:276,caregivers:19},{city:"Kano",coverage:75,users:197,caregivers:14},{city:"Port Harcourt",coverage:70,users:155,caregivers:11},{city:"Ibadan",coverage:65,users:111,caregivers:8}]},trends:{userGrowth:[{month:"Jan",growth:8.2},{month:"Feb",growth:12.1},{month:"Mar",growth:9.8},{month:"Apr",growth:15.3},{month:"May",growth:18.7},{month:"Jun",growth:15.3}],caregiverGrowth:[{month:"Jan",growth:5.1},{month:"Feb",growth:8.3},{month:"Mar",growth:6.7},{month:"Apr",growth:11.2},{month:"May",growth:13.8},{month:"Jun",growth:10.5}],serviceDemand:{"Caregiver Services":78.5,"Medication Management":65.2,"Emergency Response":45.8,"Health Monitoring":52.3,"Family Communication":38.7}}}),i(!1)},1500)}catch(e){console.error("Error loading analytics data:",e),i(!1)}},h=e=>{d(t=>Le(Le({},t),{},{[e]:!t[e]}))},p=e=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(e),m=function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e>0?(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500"}):(0,Xf.jsx)(Zy,{className:"h-4 w-4 text-red-500"}):e>0?(0,Xf.jsx)(Zy,{className:"h-4 w-4 text-red-500"}):(0,Xf.jsx)(sg,{className:"h-4 w-4 text-green-500"})},f=function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e>0?"text-green-600":"text-red-600":e>0?"text-red-600":"text-green-600"};return s?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Comprehensive insights and performance metrics"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("select",{className:"form-input",value:r,onChange:e=>a(e.target.value),children:[(0,Xf.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,Xf.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,Xf.jsx)("option",{value:"90d",children:"Last 90 days"}),(0,Xf.jsx)("option",{value:"1y",children:"Last year"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Xf.jsxs)("button",{onClick:u,className:"btn btn-primary",children:[(0,Xf.jsx)(My,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(Zf,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(g=e.overview.totalUsers,g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toString())}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[m(e.overview.userGrowth),(0,Xf.jsxs)("span",{className:"text-sm ".concat(f(e.overview.userGrowth)),children:["+",e.overview.userGrowth,"%"]})]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(ng,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Caregivers"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.overview.activeCaregivers}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[(0,Xf.jsx)(Star,{className:"h-4 w-4 text-yellow-400"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-600 ml-1",children:[e.overview.caregiverSatisfaction," avg rating"]})]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(Ff,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Medication Compliance"}),(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.overview.medicationCompliance,"%"]}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[(0,Xf.jsx)(nv,{className:"h-4 w-4 text-green-500"}),(0,Xf.jsx)("span",{className:"text-sm text-green-600 ml-1",children:"Above target"})]})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Xf.jsx)(Uy,{className:"h-6 w-6 text-orange-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.monthlyRevenue)}),(0,Xf.jsxs)("div",{className:"flex items-center mt-1",children:[m(e.financialMetrics.revenueGrowth),(0,Xf.jsxs)("span",{className:"text-sm ".concat(f(e.financialMetrics.revenueGrowth)),children:["+",e.financialMetrics.revenueGrowth,"%"]})]})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("users"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"User Analytics"}),l.users?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.users&&(0,Xf.jsx)("div",{className:"mt-6 space-y-6",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"User Distribution"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Active Users"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.userMetrics.activeUsers})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"New This Month"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.userMetrics.newUsersThisMonth})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Retention Rate"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.userRetention,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Average Age"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.averageAge," years"]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Gender Distribution"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Male"})]}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.genderDistribution.male,"%"]})]}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"w-3 h-3 bg-pink-500 rounded-full mr-2"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Female"})]}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.genderDistribution.female,"%"]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Top Locations"}),(0,Xf.jsx)("div",{className:"space-y-2",children:Object.entries(e.userMetrics.locationDistribution).slice(0,5).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[n,"%"]})]},t)})})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("caregivers"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Caregiver Analytics"}),l.caregivers?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.caregivers&&(0,Xf.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Performance Distribution"}),(0,Xf.jsx)("div",{className:"space-y-3",children:Object.entries(e.caregiverMetrics.performanceDistribution).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[n," caregivers"]})]},t)})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Top Performers"}),(0,Xf.jsx)("div",{className:"space-y-3",children:e.caregiverMetrics.topPerformers.map((e,t)=>(0,Xf.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsxs)("p",{className:"text-xs text-gray-500",children:[e.patients," patients"]})]}),(0,Xf.jsxs)("div",{className:"text-right",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)(Star,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.rating})]}),(0,Xf.jsx)("p",{className:"text-xs text-gray-500",children:p(e.earnings)})]})]},t))})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Specializations"}),(0,Xf.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries(e.caregiverMetrics.specializations).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("p",{className:"text-lg font-bold text-gray-900",children:n}),(0,Xf.jsx)("p",{className:"text-xs text-gray-600",children:t})]},t)})})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("emergencies"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Emergency Analytics"}),l.emergencies?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.emergencies&&(0,Xf.jsx)("div",{className:"mt-6 space-y-6",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Emergency Summary"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Total Emergencies"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.emergencyMetrics.totalEmergencies})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Resolved"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-green-600",children:e.emergencyMetrics.resolvedEmergencies})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Active"}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-red-600",children:e.emergencyMetrics.activeEmergencies})]}),(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Avg Response Time"}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.emergencyMetrics.averageResponseTime," min"]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Emergency Types"}),(0,Xf.jsx)("div",{className:"space-y-2",children:Object.entries(e.emergencyMetrics.emergencyTypes).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:n})]},t)})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Severity Distribution"}),(0,Xf.jsx)("div",{className:"space-y-2",children:Object.entries(e.emergencyMetrics.severityDistribution).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:n})]},t)})})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("financial"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Financial Analytics"}),l.financial?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.financial&&(0,Xf.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Revenue by Service"}),(0,Xf.jsx)("div",{className:"space-y-3",children:Object.entries(e.financialMetrics.revenueByService).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsx)("span",{className:"text-sm font-medium text-gray-900",children:p(n)})]},t)})})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Payment Methods"}),(0,Xf.jsx)("div",{className:"space-y-3",children:Object.entries(e.financialMetrics.paymentMethods).map(e=>{let[t,n]=e;return(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Xf.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[n,"%"]})]},t)})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Key Financial Metrics"}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.totalRevenue)}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Total Revenue"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.averageTransactionValue)}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Avg Transaction"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["+",e.financialMetrics.revenueGrowth,"%"]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Growth Rate"})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("geographic"),children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Geographic Analytics"}),l.geographic?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),l.geographic&&(0,Xf.jsx)("div",{className:"mt-6 space-y-6",children:(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Service Coverage"}),(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"City"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Coverage"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Users"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Caregivers"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.geographicData.serviceAreas.map((e,t)=>(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.city}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.coverage,"%"]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.users}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.caregivers})]},t))})]})})]})})]})]});var g},rv=Mf("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),av=Mf("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),ov=Mf("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),cv=()=>{const[e,n]=(0,t.useState)("messages"),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)([]),[u,h]=(0,t.useState)(!0),[p,m]=(0,t.useState)(null),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)(!1),[_,E]=(0,t.useState)(""),[b,x]=(0,t.useState)("all"),[w,S]=(0,t.useState)({inbox:!0,sent:!1,drafts:!1,archived:!1});(0,t.useEffect)(()=>{N()},[]);const N=async()=>{try{h(!0),setTimeout(()=>{i([{id:1,type:"inbox",from:"Adunni Okafor",fromEmail:"adunni@example.com",to:"Admin",subject:"Medication Reminder Issue",content:"Hello, I'm having trouble receiving my medication reminders. Can you please check my settings?",timestamp:"2024-01-20T14:30:00Z",status:"unread",priority:"medium",category:"support",attachments:[],tags:["medication","reminder","technical"],replyCount:0,isStarred:!1,isArchived:!1},{id:2,type:"sent",from:"Admin",fromEmail:"admin@elderx.com",to:"Tunde Adebayo",toEmail:"tunde@example.com",subject:"Caregiver Performance Review",content:"Hi Tunde, your performance this month has been excellent. Keep up the great work!",timestamp:"2024-01-20T10:15:00Z",status:"sent",priority:"low",category:"feedback",attachments:[],tags:["performance","caregiver","review"],replyCount:0,isStarred:!0,isArchived:!1},{id:3,type:"inbox",from:"Grace Johnson",fromEmail:"grace@example.com",to:"Admin",subject:"Emergency Contact Update",content:"I need to update my emergency contact information. My daughter's phone number has changed.",timestamp:"2024-01-19T16:45:00Z",status:"read",priority:"high",category:"emergency",attachments:[],tags:["emergency","contact","update"],replyCount:1,isStarred:!1,isArchived:!1},{id:4,type:"draft",from:"Admin",fromEmail:"admin@elderx.com",to:"All Caregivers",toEmail:"caregivers@elderx.com",subject:"Monthly Training Session",content:"We will be conducting a monthly training session on...",timestamp:"2024-01-19T09:00:00Z",status:"draft",priority:"medium",category:"announcement",attachments:[],tags:["training","caregivers","announcement"],replyCount:0,isStarred:!1,isArchived:!1}]),a([{id:1,type:"system",title:"System Maintenance Scheduled",message:"Scheduled maintenance will occur on January 25th from 2:00 AM to 4:00 AM",timestamp:"2024-01-20T12:00:00Z",status:"unread",priority:"medium",category:"system",actionRequired:!1,isRead:!1},{id:2,type:"emergency",title:"Emergency Alert - Adunni Okafor",message:"Emergency alert triggered by Adunni Okafor. Response time: 3 minutes",timestamp:"2024-01-20T11:30:00Z",status:"active",priority:"high",category:"emergency",actionRequired:!0,isRead:!1},{id:3,type:"medication",title:"Medication Compliance Alert",message:"12 patients have missed their medication doses today",timestamp:"2024-01-20T10:00:00Z",status:"read",priority:"medium",category:"medication",actionRequired:!0,isRead:!0},{id:4,type:"caregiver",title:"New Caregiver Registration",message:"Sarah Williams has completed her registration and is ready for approval",timestamp:"2024-01-19T15:20:00Z",status:"read",priority:"low",category:"caregiver",actionRequired:!0,isRead:!0}]),c([{id:1,name:"Welcome Message",subject:"Welcome to ElderX - Your Health Companion",content:"Dear {{name}}, welcome to ElderX! We're excited to be part of your health journey...",category:"welcome",variables:["name","email"],usageCount:45,lastUsed:"2024-01-15T10:00:00Z",isActive:!0},{id:2,name:"Medication Reminder",subject:"Medication Reminder - {{medicationName}}",content:"Hello {{name}}, this is a reminder to take your {{medicationName}} at {{time}}...",category:"medication",variables:["name","medicationName","time"],usageCount:234,lastUsed:"2024-01-20T08:00:00Z",isActive:!0},{id:3,name:"Emergency Contact",subject:"Emergency Alert - {{patientName}}",content:"EMERGENCY ALERT: {{patientName}} has triggered an emergency alert at {{time}}...",category:"emergency",variables:["patientName","time","location"],usageCount:12,lastUsed:"2024-01-20T11:30:00Z",isActive:!0},{id:4,name:"Caregiver Feedback",subject:"Monthly Performance Review - {{caregiverName}}",content:"Hi {{caregiverName}}, here is your monthly performance review...",category:"caregiver",variables:["caregiverName","rating","feedback"],usageCount:67,lastUsed:"2024-01-18T14:00:00Z",isActive:!0}]),d([{id:1,name:"Monthly Health Check Reminder",subject:"Monthly Health Check Reminder",content:"Dear {{name}}, it's time for your monthly health check...",status:"scheduled",scheduledDate:"2024-01-25T09:00:00Z",recipientCount:1247,sentCount:0,openedCount:0,clickedCount:0,category:"health",targetAudience:"all_users",createdAt:"2024-01-20T10:00:00Z"},{id:2,name:"Caregiver Training Announcement",subject:"Upcoming Caregiver Training Session",content:"Dear caregivers, we have an upcoming training session...",status:"sent",scheduledDate:"2024-01-18T14:00:00Z",recipientCount:89,sentCount:89,openedCount:67,clickedCount:23,category:"training",targetAudience:"caregivers",createdAt:"2024-01-17T16:00:00Z"},{id:3,name:"System Update Notification",subject:"ElderX Platform Update",content:"We've released new features to improve your experience...",status:"draft",scheduledDate:null,recipientCount:0,sentCount:0,openedCount:0,clickedCount:0,category:"announcement",targetAudience:"all_users",createdAt:"2024-01-19T11:00:00Z"}]),h(!1)},1e3)}catch(e){console.error("Error loading communication data:",e),h(!1)}},T=e=>{S(t=>Le(Le({},t),{},{[e]:!t[e]}))},C=e=>{switch(e){case"unread":return"bg-blue-100 text-blue-800";case"read":default:return"bg-gray-100 text-gray-800";case"sent":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"archived":return"bg-purple-100 text-purple-800";case"active":return"bg-red-100 text-red-800"}},R=e=>{switch(e){case"high":return"text-red-600";case"medium":return"text-yellow-600";case"low":return"text-green-600";default:return"text-gray-600"}},I=e=>{switch(e){case"support":default:return(0,Xf.jsx)(ig,{className:"h-4 w-4"});case"emergency":return(0,Xf.jsx)(eg,{className:"h-4 w-4"});case"medication":return(0,Xf.jsx)(Ff,{className:"h-4 w-4"});case"caregiver":return(0,Xf.jsx)(ng,{className:"h-4 w-4"});case"system":return(0,Xf.jsx)(cg,{className:"h-4 w-4"});case"announcement":return(0,Xf.jsx)(qf,{className:"h-4 w-4"})}},A=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},O=(e,t)=>{if(m(t),"view"===e)g(!0)},k=s.filter(e=>{const t=e.subject.toLowerCase().includes(_.toLowerCase())||e.from.toLowerCase().includes(_.toLowerCase())||e.content.toLowerCase().includes(_.toLowerCase()),n="all"===b||e.status===b;return t&&n});return u?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Communication Center"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Manage messages, notifications, and communication campaigns"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{onClick:()=>v(!0),className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Compose"]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(og,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(ig,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Messages"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s.length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(qf,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Unread Notifications"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:r.filter(e=>!e.isRead).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(Zg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Campaigns"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:l.filter(e=>"sent"===e.status||"scheduled"===e.status).length})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Xf.jsx)(ag,{className:"h-6 w-6 text-purple-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Templates"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:o.length})]})]})})]}),(0,Xf.jsx)("div",{className:"border-b border-gray-200",children:(0,Xf.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{id:"messages",name:"Messages",icon:ig},{id:"notifications",name:"Notifications",icon:qf},{id:"templates",name:"Templates",icon:ag},{id:"campaigns",name:"Campaigns",icon:Zg}].map(t=>{const s=t.icon;return(0,Xf.jsxs)("button",{onClick:()=>n(t.id),className:"flex items-center py-2 px-1 border-b-2 font-medium text-sm ".concat(e===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Xf.jsx)(s,{className:"h-4 w-4 mr-2"}),t.name]},t.id)})})}),"messages"===e&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search messages...",className:"form-input pl-10",value:_,onChange:e=>E(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:b,onChange:e=>x(e.target.value),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"unread",children:"Unread"}),(0,Xf.jsx)("option",{value:"read",children:"Read"}),(0,Xf.jsx)("option",{value:"sent",children:"Sent"}),(0,Xf.jsx)("option",{value:"draft",children:"Draft"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("inbox"),children:[(0,Xf.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Inbox (",s.filter(e=>"inbox"===e.type).length,")"]}),w.inbox?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),w.inbox&&(0,Xf.jsx)("div",{className:"mt-4 space-y-3",children:k.filter(e=>"inbox"===e.type).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[I(e.category),(0,Xf.jsx)("span",{className:"font-medium text-gray-900",children:e.from}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:e.fromEmail})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status}),(0,Xf.jsxs)("span",{className:"text-xs ".concat(R(e.priority)),children:[e.priority," priority"]})]}),(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.tags.map((e,t)=>(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},t))]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[e.isStarred&&(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400"}),(0,Xf.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"View Message",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("reply",e),className:"text-green-600 hover:text-green-800",title:"Reply",children:(0,Xf.jsx)(rv,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("archive",e),className:"text-purple-600 hover:text-purple-800",title:"Archive",children:(0,Xf.jsx)(av,{className:"h-4 w-4"})})]})]})},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("sent"),children:[(0,Xf.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Sent (",s.filter(e=>"sent"===e.type).length,")"]}),w.sent?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),w.sent&&(0,Xf.jsx)("div",{className:"mt-4 space-y-3",children:k.filter(e=>"sent"===e.type).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(Zg,{className:"h-4 w-4"}),(0,Xf.jsxs)("span",{className:"font-medium text-gray-900",children:["To: ",e.to]}),(0,Xf.jsx)("span",{className:"text-sm text-gray-500",children:e.toEmail})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})]}),(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.tags.map((e,t)=>(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},t))]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[e.isStarred&&(0,Xf.jsx)(fg,{className:"h-4 w-4 text-yellow-400"}),(0,Xf.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"View Message",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("forward",e),className:"text-blue-600 hover:text-blue-800",title:"Forward",children:(0,Xf.jsx)(ov,{className:"h-4 w-4"})})]})]})},e.id))})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("drafts"),children:[(0,Xf.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Drafts (",s.filter(e=>"draft"===e.type).length,")"]}),w.drafts?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),w.drafts&&(0,Xf.jsx)("div",{className:"mt-4 space-y-3",children:k.filter(e=>"draft"===e.type).map(e=>(0,Xf.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)(Cg,{className:"h-4 w-4"}),(0,Xf.jsx)("span",{className:"font-medium text-gray-900",children:"Draft"})]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})]}),(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Xf.jsx)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:(0,Xf.jsxs)("span",{children:["Last saved: ",A(e.timestamp).date," at ",A(e.timestamp).time]})})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,Xf.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"Edit Draft",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{onClick:()=>O("delete",e),className:"text-red-600 hover:text-red-800",title:"Delete Draft",children:(0,Xf.jsx)(Rg,{className:"h-4 w-4"})})]})]})},e.id))})]})]})]}),"notifications"===e&&(0,Xf.jsx)("div",{className:"space-y-6",children:(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Notifications"}),(0,Xf.jsx)("div",{className:"space-y-3",children:r.map(e=>(0,Xf.jsx)("div",{className:"border rounded-lg p-4 ".concat(e.isRead?"bg-gray-50":"bg-white border-blue-200"),children:(0,Xf.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Xf.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Xf.jsx)("div",{className:"p-2 rounded-full ".concat("emergency"===e.category?"bg-red-100":"system"===e.category?"bg-blue-100":"bg-gray-100"),children:I(e.category)}),(0,Xf.jsxs)("div",{className:"flex-1",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900",children:e.title}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status}),(0,Xf.jsxs)("span",{className:"text-xs ".concat(R(e.priority)),children:[e.priority," priority"]})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Xf.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.actionRequired&&(0,Xf.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Action Required"})]})]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),e.actionRequired&&(0,Xf.jsx)("button",{className:"btn btn-primary text-sm",children:"Take Action"})]})]})},e.id))})]})}),"templates"===e&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Message Templates"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Create Template"]})]}),(0,Xf.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(e=>(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Xf.jsx)("h3",{className:"text-md font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.subject}),(0,Xf.jsx)("p",{className:"text-sm text-gray-500 mb-3 line-clamp-3",children:e.content}),(0,Xf.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[(0,Xf.jsxs)("span",{children:["Used ",e.usageCount," times"]}),(0,Xf.jsxs)("span",{children:["Last used: ",A(e.lastUsed).date]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsxs)("button",{className:"btn btn-primary text-sm flex-1",children:[(0,Xf.jsx)(Cg,{className:"h-3 w-3 mr-1"}),"Edit"]}),(0,Xf.jsx)("button",{className:"btn btn-secondary text-sm",children:(0,Xf.jsx)(Lg,{className:"h-3 w-3"})})]})]},e.id))})]}),"campaigns"===e&&(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Communication Campaigns"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(Ng,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campaign"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recipients"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Engagement"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Scheduled"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.subject})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.recipientCount}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,Xf.jsxs)("div",{className:"text-xs",children:[(0,Xf.jsxs)("div",{children:["Opened: ",e.openedCount]}),(0,Xf.jsxs)("div",{children:["Clicked: ",e.clickedCount]})]})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.scheduledDate?A(e.scheduledDate).date:"Not scheduled"}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Xf.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{className:"text-green-600 hover:text-green-900",children:(0,Xf.jsx)(Cg,{className:"h-4 w-4"})}),(0,Xf.jsx)("button",{className:"text-red-600 hover:text-red-900",children:(0,Xf.jsx)(Rg,{className:"h-4 w-4"})})]})})]},e.id))})]})})})]}),f&&p&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:p.subject}),(0,Xf.jsxs)("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Xf.jsxs)("span",{children:[(0,Xf.jsx)("strong",{children:"From:"})," ",p.from," (",p.fromEmail,")"]}),(0,Xf.jsxs)("span",{children:[(0,Xf.jsx)("strong",{children:"To:"})," ",p.to]})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Xf.jsxs)("span",{children:[(0,Xf.jsx)("strong",{children:"Date:"})," ",A(p.timestamp).date," at ",A(p.timestamp).time]}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(p.status)),children:p.status})]}),(0,Xf.jsx)("div",{className:"border-t pt-4",children:(0,Xf.jsx)("p",{className:"text-gray-900 whitespace-pre-wrap",children:p.content})}),p.tags.length>0&&(0,Xf.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Tags:"}),p.tags.map((e,t)=>(0,Xf.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs",children:e},t))]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>g(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(rv,{className:"h-4 w-4 mr-2"}),"Reply"]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(ov,{className:"h-4 w-4 mr-2"}),"Forward"]})]})]})})})]})},lv=Mf("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),dv=()=>{const[e,n]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(null),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)({action:"all",user:"all",resource:"all",status:"all",dateRange:"all",severity:"all"}),[f,g]=(0,t.useState)({overview:!0,recent:!0,security:!1,system:!1,user:!1,data:!1}),[y,v]=(0,t.useState)({totalLogs:0,todayLogs:0,securityEvents:0,systemEvents:0,userEvents:0,dataEvents:0,criticalEvents:0,warningEvents:0});(0,t.useEffect)(()=>{_()},[]),(0,t.useEffect)(()=>{E()},[e,o,p]);const _=async()=>{try{a(!0),setTimeout(()=>{const e=[{id:1,timestamp:"2024-01-20T14:30:00Z",action:"LOGIN",user:"admin@elderx.com",userId:"admin_001",resource:"Authentication",resourceId:"auth_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{loginMethod:"email_password",sessionId:"sess_abc123",location:"Lagos, Nigeria"},changes:null,category:"security"},{id:2,timestamp:"2024-01-20T14:25:00Z",action:"CREATE",user:"admin@elderx.com",userId:"admin_001",resource:"Caregiver",resourceId:"caregiver_002",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{caregiverName:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890"},changes:{before:null,after:{name:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890",status:"pending"}},category:"user"},{id:3,timestamp:"2024-01-20T14:20:00Z",action:"UPDATE",user:"admin@elderx.com",userId:"admin_001",resource:"Medication",resourceId:"med_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{medicationName:"Metformin",patientId:"patient_001",dosage:"500mg"},changes:{before:{dosage:"250mg",frequency:"twice daily"},after:{dosage:"500mg",frequency:"once daily"}},category:"data"},{id:4,timestamp:"2024-01-20T14:15:00Z",action:"DELETE",user:"admin@elderx.com",userId:"admin_001",resource:"Appointment",resourceId:"appt_003",status:"SUCCESS",severity:"WARNING",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{appointmentDate:"2024-01-25",patientName:"Adunni Okafor",doctorName:"Dr. Kemi Adebayo",reason:"Patient requested cancellation"},changes:{before:{status:"scheduled",date:"2024-01-25T10:00:00Z"},after:null},category:"system"},{id:5,timestamp:"2024-01-20T14:10:00Z",action:"LOGIN_FAILED",user:"unknown@example.com",userId:null,resource:"Authentication",resourceId:"auth_002",status:"FAILED",severity:"WARNING",ipAddress:"192.168.1.200",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{loginMethod:"email_password",failureReason:"Invalid password",attemptCount:3},changes:null,category:"security"},{id:6,timestamp:"2024-01-20T14:05:00Z",action:"PERMISSION_CHANGE",user:"admin@elderx.com",userId:"admin_001",resource:"User",resourceId:"user_005",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{targetUser:"caregiver@example.com",permissionType:"admin_access"},changes:{before:{role:"caregiver",permissions:["read_patients","update_medications"]},after:{role:"admin",permissions:["read_patients","update_medications","manage_users","view_analytics"]}},category:"security"},{id:7,timestamp:"2024-01-20T14:00:00Z",action:"DATA_EXPORT",user:"admin@elderx.com",userId:"admin_001",resource:"Patient Data",resourceId:"export_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{exportType:"patient_medications",recordCount:1247,format:"CSV",purpose:"Monthly report"},changes:null,category:"data"},{id:8,timestamp:"2024-01-20T13:55:00Z",action:"SYSTEM_CONFIG",user:"admin@elderx.com",userId:"admin_001",resource:"System Settings",resourceId:"config_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{settingName:"notification_frequency",settingValue:"immediate"},changes:{before:{notification_frequency:"hourly"},after:{notification_frequency:"immediate"}},category:"system"},{id:9,timestamp:"2024-01-20T13:50:00Z",action:"EMERGENCY_ALERT",user:"system",userId:"system",resource:"Emergency System",resourceId:"emergency_001",status:"SUCCESS",severity:"CRITICAL",ipAddress:"system",userAgent:"ElderX Emergency System",details:{patientId:"patient_003",patientName:"Grace Johnson",alertType:"fall_detected",location:"Lagos, Nigeria",responseTime:"2 minutes"},changes:null,category:"system"},{id:10,timestamp:"2024-01-20T13:45:00Z",action:"BACKUP",user:"system",userId:"system",resource:"Database",resourceId:"backup_001",status:"SUCCESS",severity:"INFO",ipAddress:"system",userAgent:"ElderX Backup System",details:{backupType:"full_database",size:"2.5GB",duration:"15 minutes",location:"cloud_storage"},changes:null,category:"system"}],t=e.length,s=e.filter(e=>{const t=new Date(e.timestamp),n=new Date;return t.toDateString()===n.toDateString()}).length,i=e.filter(e=>"security"===e.category).length,r=e.filter(e=>"system"===e.category).length,o=e.filter(e=>"user"===e.category).length,c=e.filter(e=>"data"===e.category).length,l=e.filter(e=>"CRITICAL"===e.severity).length,d=e.filter(e=>"WARNING"===e.severity).length;v({totalLogs:t,todayLogs:s,securityEvents:i,systemEvents:r,userEvents:o,dataEvents:c,criticalEvents:l,warningEvents:d}),n(e),a(!1)},1e3)}catch(e){console.error("Error loading audit logs:",e),a(!1)}},E=()=>{let t=e;o&&(t=t.filter(e=>e.action.toLowerCase().includes(o.toLowerCase())||e.user.toLowerCase().includes(o.toLowerCase())||e.resource.toLowerCase().includes(o.toLowerCase())||e.details&&JSON.stringify(e.details).toLowerCase().includes(o.toLowerCase()))),"all"!==p.action&&(t=t.filter(e=>e.action===p.action)),"all"!==p.user&&(t=t.filter(e=>e.user===p.user)),"all"!==p.resource&&(t=t.filter(e=>e.resource===p.resource)),"all"!==p.status&&(t=t.filter(e=>e.status===p.status)),"all"!==p.severity&&(t=t.filter(e=>e.severity===p.severity)),i(t)},b=e=>{switch(e){case"CRITICAL":return"bg-red-100 text-red-800 border-red-200";case"WARNING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"INFO":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},x=e=>{switch(e){case"SUCCESS":return"bg-green-100 text-green-800";case"FAILED":return"bg-red-100 text-red-800";case"PENDING":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},w=e=>{switch(e){case"security":return(0,Xf.jsx)(cg,{className:"h-4 w-4"});case"system":return(0,Xf.jsx)(og,{className:"h-4 w-4"});case"user":return(0,Xf.jsx)(Yf,{className:"h-4 w-4"});case"data":return(0,Xf.jsx)(qy,{className:"h-4 w-4"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4"})}},S=e=>{switch(e){case"LOGIN":return(0,Xf.jsx)(lv,{className:"h-4 w-4"});case"LOGOUT":return(0,Xf.jsx)(bg,{className:"h-4 w-4"});case"CREATE":return(0,Xf.jsx)(Ng,{className:"h-4 w-4"});case"UPDATE":return(0,Xf.jsx)(Cg,{className:"h-4 w-4"});case"DELETE":return(0,Xf.jsx)(Rg,{className:"h-4 w-4"});case"LOGIN_FAILED":return(0,Xf.jsx)(Tg,{className:"h-4 w-4"});case"PERMISSION_CHANGE":return(0,Xf.jsx)(cg,{className:"h-4 w-4"});case"DATA_EXPORT":return(0,Xf.jsx)(ry,{className:"h-4 w-4"});case"SYSTEM_CONFIG":return(0,Xf.jsx)(og,{className:"h-4 w-4"});case"EMERGENCY_ALERT":return(0,Xf.jsx)(eg,{className:"h-4 w-4"});case"BACKUP":return(0,Xf.jsx)(qy,{className:"h-4 w-4"});default:return(0,Xf.jsx)($f,{className:"h-4 w-4"})}},N=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),full:t.toLocaleString()}};return r?(0,Xf.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Xf.jsxs)("div",{className:"space-y-6",children:[(0,Xf.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Audit Logs"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Comprehensive system activity and security monitoring"})]}),(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Xf.jsxs)("button",{onClick:_,className:"btn btn-secondary",children:[(0,Xf.jsx)(My,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,Xf.jsxs)("button",{onClick:()=>{console.log("Exporting logs...")},className:"btn btn-primary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Xf.jsx)(ag,{className:"h-6 w-6 text-blue-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Logs"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.totalLogs})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Xf.jsx)(dg,{className:"h-6 w-6 text-green-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Today's Events"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.todayLogs})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Xf.jsx)(eg,{className:"h-6 w-6 text-red-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Critical Events"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.criticalEvents})]})]})}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[(0,Xf.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Xf.jsx)(cg,{className:"h-6 w-6 text-yellow-600"})}),(0,Xf.jsxs)("div",{className:"ml-4",children:[(0,Xf.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Security Events"}),(0,Xf.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.securityEvents})]})]})})]}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>{return e="overview",void g(t=>Le(Le({},t),{},{[e]:!t[e]}));var e},children:[(0,Xf.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Activity Overview"}),f.overview?(0,Xf.jsx)(sv,{className:"h-5 w-5"}):(0,Xf.jsx)(Og,{className:"h-5 w-5"})]}),f.overview&&(0,Xf.jsx)("div",{className:"mt-6",children:(0,Xf.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(cg,{className:"h-6 w-6 text-blue-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.securityEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Security Events"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(og,{className:"h-6 w-6 text-green-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.systemEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"System Events"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(Yf,{className:"h-6 w-6 text-purple-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.userEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"User Events"})]}),(0,Xf.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Xf.jsx)(qy,{className:"h-6 w-6 text-orange-600 mr-2"}),(0,Xf.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.dataEvents})]}),(0,Xf.jsx)("p",{className:"text-sm text-gray-600",children:"Data Events"})]})]})})]}),(0,Xf.jsx)("div",{className:"card",children:(0,Xf.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,Xf.jsx)("div",{className:"flex-1",children:(0,Xf.jsxs)("div",{className:"relative",children:[(0,Xf.jsx)(Hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Xf.jsx)("input",{type:"text",placeholder:"Search audit logs...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Xf.jsxs)("div",{className:"flex gap-2",children:[(0,Xf.jsxs)("select",{className:"form-input",value:p.action,onChange:e=>m(Le(Le({},p),{},{action:e.target.value})),children:[(0,Xf.jsx)("option",{value:"all",children:"All Actions"}),(0,Xf.jsx)("option",{value:"LOGIN",children:"Login"}),(0,Xf.jsx)("option",{value:"LOGOUT",children:"Logout"}),(0,Xf.jsx)("option",{value:"CREATE",children:"Create"}),(0,Xf.jsx)("option",{value:"UPDATE",children:"Update"}),(0,Xf.jsx)("option",{value:"DELETE",children:"Delete"}),(0,Xf.jsx)("option",{value:"LOGIN_FAILED",children:"Login Failed"}),(0,Xf.jsx)("option",{value:"PERMISSION_CHANGE",children:"Permission Change"}),(0,Xf.jsx)("option",{value:"DATA_EXPORT",children:"Data Export"}),(0,Xf.jsx)("option",{value:"SYSTEM_CONFIG",children:"System Config"}),(0,Xf.jsx)("option",{value:"EMERGENCY_ALERT",children:"Emergency Alert"}),(0,Xf.jsx)("option",{value:"BACKUP",children:"Backup"})]}),(0,Xf.jsxs)("select",{className:"form-input",value:p.status,onChange:e=>m(Le(Le({},p),{},{status:e.target.value})),children:[(0,Xf.jsx)("option",{value:"all",children:"All Status"}),(0,Xf.jsx)("option",{value:"SUCCESS",children:"Success"}),(0,Xf.jsx)("option",{value:"FAILED",children:"Failed"}),(0,Xf.jsx)("option",{value:"PENDING",children:"Pending"})]}),(0,Xf.jsxs)("select",{className:"form-input",value:p.severity,onChange:e=>m(Le(Le({},p),{},{severity:e.target.value})),children:[(0,Xf.jsx)("option",{value:"all",children:"All Severity"}),(0,Xf.jsx)("option",{value:"CRITICAL",children:"Critical"}),(0,Xf.jsx)("option",{value:"WARNING",children:"Warning"}),(0,Xf.jsx)("option",{value:"INFO",children:"Info"}),(0,Xf.jsx)("option",{value:"DEBUG",children:"Debug"})]}),(0,Xf.jsxs)("button",{className:"btn btn-secondary",children:[(0,Xf.jsx)(Fg,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Xf.jsxs)("div",{className:"card",children:[(0,Xf.jsx)("div",{className:"overflow-x-auto",children:(0,Xf.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Xf.jsx)("thead",{className:"bg-gray-50",children:(0,Xf.jsxs)("tr",{children:[(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Resource"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,Xf.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Xf.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,Xf.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:N(e.timestamp).date}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:N(e.timestamp).time})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsxs)("div",{className:"flex items-center",children:[S(e.action),(0,Xf.jsx)("span",{className:"ml-2 text-sm font-medium text-gray-900",children:e.action})]})}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsx)("div",{className:"text-sm text-gray-900",children:e.user}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.ipAddress})]}),(0,Xf.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Xf.jsxs)("div",{className:"flex items-center",children:[w(e.category),(0,Xf.jsx)("span",{className:"ml-2 text-sm text-gray-900",children:e.resource})]}),(0,Xf.jsx)("div",{className:"text-sm text-gray-500",children:e.resourceId})]}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(x(e.status)),children:e.status})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(b(e.severity)),children:e.severity})}),(0,Xf.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Xf.jsx)("button",{onClick:()=>((e,t)=>{d(t),"view"===e&&h(!0)})("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Xf.jsx)(Lg,{className:"h-4 w-4"})})})]},e.id))})]})}),0===s.length&&(0,Xf.jsxs)("div",{className:"text-center py-12",children:[(0,Xf.jsx)(ag,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Xf.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No audit logs found"}),(0,Xf.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||Object.values(p).some(e=>"all"!==e)?"Try adjusting your search or filter criteria.":"No audit logs have been recorded yet."})]})]}),u&&l&&(0,Xf.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Xf.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Xf.jsxs)("div",{className:"mt-3",children:[(0,Xf.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Xf.jsxs)("div",{className:"flex items-center space-x-3",children:[S(l.action),(0,Xf.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:l.action}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(b(l.severity)),children:l.severity})]}),(0,Xf.jsxs)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Xf.jsx)("span",{className:"sr-only",children:"Close"}),(0,Xf.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Xf.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Xf.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Event Information"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Timestamp:"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:N(l.timestamp).full})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"User:"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:l.user})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"IP Address:"}),(0,Xf.jsx)("span",{className:"text-sm text-gray-900",children:l.ipAddress})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Status:"}),(0,Xf.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(x(l.status)),children:l.status})]}),(0,Xf.jsxs)("div",{className:"flex justify-between",children:[(0,Xf.jsx)("span",{className:"text-sm text-gray-600",children:"Resource:"}),(0,Xf.jsxs)("span",{className:"text-sm text-gray-900",children:[l.resource," (",l.resourceId,")"]})]})]})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Technical Details"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"User Agent"}),(0,Xf.jsx)("p",{className:"text-sm text-gray-900 break-all",children:l.userAgent})]}),(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,Xf.jsxs)("div",{className:"flex items-center",children:[w(l.category),(0,Xf.jsx)("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:l.category})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"space-y-4",children:[(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Event Details"}),(0,Xf.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,Xf.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.details,null,2)})})]}),l.changes&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Changes"}),(0,Xf.jsxs)("div",{className:"space-y-3",children:[l.changes.before&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Before:"}),(0,Xf.jsx)("div",{className:"bg-red-50 rounded-lg p-3",children:(0,Xf.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.changes.before,null,2)})})]}),l.changes.after&&(0,Xf.jsxs)("div",{children:[(0,Xf.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"After:"}),(0,Xf.jsx)("div",{className:"bg-green-50 rounded-lg p-3",children:(0,Xf.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.changes.after,null,2)})})]})]})]})]})]}),(0,Xf.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Xf.jsx)("button",{onClick:()=>h(!1),className:"btn btn-secondary",children:"Close"}),(0,Xf.jsxs)("button",{className:"btn btn-primary",children:[(0,Xf.jsx)(ry,{className:"h-4 w-4 mr-2"}),"Export Log"]})]})]})})})]})},uv=()=>(0,Xf.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,Xf.jsxs)("div",{className:"text-center",children:[(0,Xf.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,Xf.jsx)("p",{className:"text-gray-600",children:"Loading ElderX..."})]})});const hv=function(){const[e,t]=Ma(Df);return t?(0,Xf.jsx)(uv,{}):(0,Xf.jsxs)(_e,{children:[(0,Xf.jsx)(ye,{path:"/",element:(0,Xf.jsx)(_g,{})}),(0,Xf.jsx)(ye,{path:"/login",element:e?(0,Xf.jsx)(fe,{to:"/dashboard",replace:!0}):(0,Xf.jsx)(xg,{})}),(0,Xf.jsx)(ye,{path:"/signup",element:e?(0,Xf.jsx)(fe,{to:"/dashboard",replace:!0}):(0,Xf.jsx)(wg,{})}),(0,Xf.jsx)(ye,{path:"/dashboard",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(Sg,{})})}),(0,Xf.jsx)(ye,{path:"/medications",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(Ig,{})})}),(0,Xf.jsx)(ye,{path:"/vital-signs",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(kg,{})})}),(0,Xf.jsx)(ye,{path:"/appointments",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(Pg,{})})}),(0,Xf.jsx)(ye,{path:"/telemedicine",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(Ay,{})})}),(0,Xf.jsx)(ye,{path:"/profile",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(jg,{})})}),(0,Xf.jsx)(ye,{path:"/messages",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(ky,{})})}),(0,Xf.jsx)(ye,{path:"/subscription",element:e?(0,Xf.jsx)(Jf,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(Py,{})})}),(0,Xf.jsxs)(ye,{path:"/caregiver",element:e?(0,Xf.jsx)(Oy,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(Vg,{})}),(0,Xf.jsx)(ye,{path:"schedule",element:(0,Xf.jsx)(Wg,{})}),(0,Xf.jsx)(ye,{path:"patients",element:(0,Xf.jsx)(Kg,{})}),(0,Xf.jsx)(ye,{path:"tasks",element:(0,Xf.jsx)(zg,{})}),(0,Xf.jsx)(ye,{path:"messages",element:(0,Xf.jsx)($g,{})}),(0,Xf.jsx)(ye,{path:"navigation",element:(0,Xf.jsx)(sy,{})}),(0,Xf.jsx)(ye,{path:"photos",element:(0,Xf.jsx)(oy,{})}),(0,Xf.jsx)(ye,{path:"performance",element:(0,Xf.jsx)(cy,{})}),(0,Xf.jsx)(ye,{path:"emergency",element:(0,Xf.jsx)(ly,{})}),(0,Xf.jsx)(ye,{path:"settings",element:(0,Xf.jsx)(hy,{})})]}),(0,Xf.jsx)(ye,{path:"/services",element:(0,Xf.jsx)(jy,{})}),(0,Xf.jsx)(ye,{path:"/pricing",element:(0,Xf.jsx)(Ly,{})}),(0,Xf.jsxs)(ye,{path:"/admin",element:e?(0,Xf.jsx)(lg,{}):(0,Xf.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Xf.jsx)(ye,{index:!0,element:(0,Xf.jsx)(Vy,{})}),(0,Xf.jsx)(ye,{path:"users",element:(0,Xf.jsx)(Wy,{})}),(0,Xf.jsx)(ye,{path:"appointments",element:(0,Xf.jsx)(zy,{})}),(0,Xf.jsx)(ye,{path:"emergency",element:(0,Xf.jsx)(Xy,{})}),(0,Xf.jsx)(ye,{path:"emergency/protocols",element:(0,Xf.jsx)(Qy,{})}),(0,Xf.jsx)(ye,{path:"medications",element:(0,Xf.jsx)($y,{})}),(0,Xf.jsx)(ye,{path:"medications/analytics",element:(0,Xf.jsx)(ev,{})}),(0,Xf.jsx)(ye,{path:"caregivers",element:(0,Xf.jsx)(tv,{})}),(0,Xf.jsx)(ye,{path:"analytics",element:(0,Xf.jsx)(iv,{})}),(0,Xf.jsx)(ye,{path:"communication",element:(0,Xf.jsx)(cv,{})}),(0,Xf.jsx)(ye,{path:"audit-logs",element:(0,Xf.jsx)(dv,{})}),(0,Xf.jsx)(ye,{path:"reports",element:(0,Xf.jsx)(Hy,{})}),(0,Xf.jsx)(ye,{path:"settings",element:(0,Xf.jsx)(Yy,{})})]}),(0,Xf.jsx)(ye,{path:"*",element:(0,Xf.jsx)(fe,{to:"/",replace:!0})})]})},pv=new Oe.QueryClient;(0,i.H)(document.getElementById("root")).render((0,Xf.jsx)(t.StrictMode,{children:(0,Xf.jsx)(Oe.QueryClientProvider,{client:pv,children:(0,Xf.jsxs)(Ne,{children:[(0,Xf.jsx)(hv,{}),(0,Xf.jsx)(ot,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})})}))})()})();
//# sourceMappingURL=main.60373f26.js.map