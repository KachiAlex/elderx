/*! For license information please see main.00f0e65a.js.LICENSE.txt */
(()=>{var e={75:(e,t,s)=>{"use strict";s.d(t,{B:()=>i,t:()=>r});var n=console;function r(){return n}function i(e){n=e}},477:()=>{},548:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.pad.ZeroPadding={pad:function(e,t){var s=4*t;e.clamp(),e.sigBytes+=s-(e.sigBytes%s||s)},unpad:function(e){var t=e.words,s=e.sigBytes-1;for(s=e.sigBytes-1;s>=0;s--)if(t[s>>>2]>>>24-s%4*8&255){e.sigBytes=s+1;break}}},t.pad.ZeroPadding)}()},579:(e,t,s)=>{"use strict";e.exports=s(1153)},1112:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.mode.CFB=function(){var e=t.lib.BlockCipherMode.extend();function s(e,t,s,n){var r,i=this._iv;i?(r=i.slice(0),this._iv=void 0):r=this._prevBlock,n.encryptBlock(r,0);for(var a=0;a<s;a++)e[t+a]^=r[a]}return e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;s.call(this,e,t,r,n),this._prevBlock=e.slice(t,t+r)}}),e.Decryptor=e.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);s.call(this,e,t,r,n),this._prevBlock=i}}),e}(),t.mode.CFB)}()},1153:(e,t,s)=>{"use strict";var n=s(5043),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,s){var n,i={},l=null,d=null;for(n in void 0!==s&&(l=""+s),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!c.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:r,type:e,key:l,ref:d,props:i,_owner:o.current}}t.Fragment=i,t.jsx=l,t.jsxs=l},1635:function(e,t,s){e.exports=function(){"use strict";function e(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(s){if("default"!==s&&!(s in e)){var n=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,n.get?n:{enumerable:!0,get:function(){return t[s]}})}})}),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof s.g?s.g:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r=function(e){try{return!!e()}catch(e){return!0}},i=!r(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),a=i,o=Function.prototype,c=o.call,l=a&&o.bind.bind(c,c),d=a?l:function(e){return function(){return c.apply(e,arguments)}},u=d({}.isPrototypeOf),h=function(e){return e&&e.Math===Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof t&&t)||h("object"==typeof t&&t)||function(){return this}()||Function("return this")(),m=i,f=Function.prototype,g=f.apply,y=f.call,v="object"==typeof Reflect&&Reflect.apply||(m?y.bind(g):function(){return y.apply(g,arguments)}),x=d,_=x({}.toString),E=x("".slice),b=function(e){return E(_(e),8,-1)},w=b,N=d,S=function(e){if("Function"===w(e))return N(e)},T="object"==typeof document&&document.all,C=void 0===T&&void 0!==T?function(e){return"function"==typeof e||e===T}:function(e){return"function"==typeof e},R={},I=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),A=i,O=Function.prototype.call,j=A?O.bind(O):function(){return O.apply(O,arguments)},k={},D={}.propertyIsEnumerable,P=Object.getOwnPropertyDescriptor,L=P&&!D.call({1:2},1);k.f=L?function(e){var t=P(this,e);return!!t&&t.enumerable}:D;var M,U,V=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},F=r,B=b,G=Object,W=d("".split),H=F(function(){return!G("z").propertyIsEnumerable(0)})?function(e){return"String"===B(e)?W(e,""):G(e)}:G,K=function(e){return null==e},z=K,q=TypeError,Y=function(e){if(z(e))throw new q("Can't call method on "+e);return e},X=H,J=Y,Q=function(e){return X(J(e))},Z=C,$=function(e){return"object"==typeof e?null!==e:Z(e)},ee={},te=ee,se=p,ne=C,re=function(e){return ne(e)?e:void 0},ie=function(e,t){return arguments.length<2?re(te[e])||re(se[e]):te[e]&&te[e][t]||se[e]&&se[e][t]},ae=p.navigator,oe=ae&&ae.userAgent,ce=oe?String(oe):"",le=p,de=ce,ue=le.process,he=le.Deno,pe=ue&&ue.versions||he&&he.version,me=pe&&pe.v8;me&&(U=(M=me.split("."))[0]>0&&M[0]<4?1:+(M[0]+M[1])),!U&&de&&(!(M=de.match(/Edge\/(\d+)/))||M[1]>=74)&&(M=de.match(/Chrome\/(\d+)/))&&(U=+M[1]);var fe=U,ge=fe,ye=r,ve=p.String,xe=!!Object.getOwnPropertySymbols&&!ye(function(){var e=Symbol("symbol detection");return!ve(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ge&&ge<41}),_e=xe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ee=ie,be=C,we=u,Ne=Object,Se=_e?function(e){return"symbol"==typeof e}:function(e){var t=Ee("Symbol");return be(t)&&we(t.prototype,Ne(e))},Te=String,Ce=function(e){try{return Te(e)}catch(e){return"Object"}},Re=C,Ie=Ce,Ae=TypeError,Oe=function(e){if(Re(e))return e;throw new Ae(Ie(e)+" is not a function")},je=Oe,ke=K,De=function(e,t){var s=e[t];return ke(s)?void 0:je(s)},Pe=j,Le=C,Me=$,Ue=TypeError,Ve={exports:{}},Fe=p,Be=Object.defineProperty,Ge=p,We=function(e,t){try{Be(Fe,e,{value:t,configurable:!0,writable:!0})}catch(n){Fe[e]=t}return t},He="__core-js_shared__",Ke=Ve.exports=Ge[He]||We(He,{});(Ke.versions||(Ke.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ze=Ve.exports,qe=ze,Ye=function(e,t){return qe[e]||(qe[e]=t||{})},Xe=Y,Je=Object,Qe=function(e){return Je(Xe(e))},Ze=Qe,$e=d({}.hasOwnProperty),et=Object.hasOwn||function(e,t){return $e(Ze(e),t)},tt=d,st=0,nt=Math.random(),rt=tt(1..toString),it=function(e){return"Symbol("+(void 0===e?"":e)+")_"+rt(++st+nt,36)},at=Ye,ot=et,ct=it,lt=xe,dt=_e,ut=p.Symbol,ht=at("wks"),pt=dt?ut.for||ut:ut&&ut.withoutSetter||ct,mt=function(e){return ot(ht,e)||(ht[e]=lt&&ot(ut,e)?ut[e]:pt("Symbol."+e)),ht[e]},ft=j,gt=$,yt=Se,vt=De,xt=function(e,t){var s,n;if("string"===t&&Le(s=e.toString)&&!Me(n=Pe(s,e)))return n;if(Le(s=e.valueOf)&&!Me(n=Pe(s,e)))return n;if("string"!==t&&Le(s=e.toString)&&!Me(n=Pe(s,e)))return n;throw new Ue("Can't convert object to primitive value")},_t=TypeError,Et=mt("toPrimitive"),bt=function(e,t){if(!gt(e)||yt(e))return e;var s,n=vt(e,Et);if(n){if(void 0===t&&(t="default"),s=ft(n,e,t),!gt(s)||yt(s))return s;throw new _t("Can't convert object to primitive value")}return void 0===t&&(t="number"),xt(e,t)},wt=Se,Nt=function(e){var t=bt(e,"string");return wt(t)?t:t+""},St=$,Tt=p.document,Ct=St(Tt)&&St(Tt.createElement),Rt=function(e){return Ct?Tt.createElement(e):{}},It=Rt,At=!I&&!r(function(){return 7!==Object.defineProperty(It("div"),"a",{get:function(){return 7}}).a}),Ot=I,jt=j,kt=k,Dt=V,Pt=Q,Lt=Nt,Mt=et,Ut=At,Vt=Object.getOwnPropertyDescriptor;R.f=Ot?Vt:function(e,t){if(e=Pt(e),t=Lt(t),Ut)try{return Vt(e,t)}catch(e){}if(Mt(e,t))return Dt(!jt(kt.f,e,t),e[t])};var Ft=r,Bt=C,Gt=/#|\.prototype\./,Wt=function(e,t){var s=Kt[Ht(e)];return s===qt||s!==zt&&(Bt(t)?Ft(t):!!t)},Ht=Wt.normalize=function(e){return String(e).replace(Gt,".").toLowerCase()},Kt=Wt.data={},zt=Wt.NATIVE="N",qt=Wt.POLYFILL="P",Yt=Wt,Xt=Oe,Jt=i,Qt=S(S.bind),Zt=function(e,t){return Xt(e),void 0===t?e:Jt?Qt(e,t):function(){return e.apply(t,arguments)}},$t={},es=I&&r(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),ts=$,ss=String,ns=TypeError,rs=function(e){if(ts(e))return e;throw new ns(ss(e)+" is not an object")},is=I,as=At,os=es,cs=rs,ls=Nt,ds=TypeError,us=Object.defineProperty,hs=Object.getOwnPropertyDescriptor,ps="enumerable",ms="configurable",fs="writable";$t.f=is?os?function(e,t,s){if(cs(e),t=ls(t),cs(s),"function"==typeof e&&"prototype"===t&&"value"in s&&fs in s&&!s[fs]){var n=hs(e,t);n&&n[fs]&&(e[t]=s.value,s={configurable:ms in s?s[ms]:n[ms],enumerable:ps in s?s[ps]:n[ps],writable:!1})}return us(e,t,s)}:us:function(e,t,s){if(cs(e),t=ls(t),cs(s),as)try{return us(e,t,s)}catch(e){}if("get"in s||"set"in s)throw new ds("Accessors not supported");return"value"in s&&(e[t]=s.value),e};var gs=$t,ys=V,vs=I?function(e,t,s){return gs.f(e,t,ys(1,s))}:function(e,t,s){return e[t]=s,e},xs=p,_s=v,Es=S,bs=C,ws=R.f,Ns=Yt,Ss=ee,Ts=Zt,Cs=vs,Rs=et,Is=function(e){var t=function(s,n,r){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,n)}return new e(s,n,r)}return _s(e,this,arguments)};return t.prototype=e.prototype,t},As=function(e,t){var s,n,r,i,a,o,c,l,d,u=e.target,h=e.global,p=e.stat,m=e.proto,f=h?xs:p?xs[u]:xs[u]&&xs[u].prototype,g=h?Ss:Ss[u]||Cs(Ss,u,{})[u],y=g.prototype;for(i in t)n=!(s=Ns(h?i:u+(p?".":"#")+i,e.forced))&&f&&Rs(f,i),o=g[i],n&&(c=e.dontCallGetSet?(d=ws(f,i))&&d.value:f[i]),a=n&&c?c:t[i],(s||m||typeof o!=typeof a)&&(l=e.bind&&n?Ts(a,xs):e.wrap&&n?Is(a):m&&bs(a)?Es(a):a,(e.sham||a&&a.sham||o&&o.sham)&&Cs(l,"sham",!0),Cs(g,i,l),m&&(Rs(Ss,r=u+"Prototype")||Cs(Ss,r,{}),Cs(Ss[r],i,a),e.real&&y&&(s||!y[i])&&Cs(y,i,a)))},Os=Math.ceil,js=Math.floor,ks=Math.trunc||function(e){var t=+e;return(t>0?js:Os)(t)},Ds=ks,Ps=function(e){var t=+e;return t!=t||0===t?0:Ds(t)},Ls=Ps,Ms=Math.max,Us=Math.min,Vs=function(e,t){var s=Ls(e);return s<0?Ms(s+t,0):Us(s,t)},Fs=Ps,Bs=Math.min,Gs=function(e){var t=Fs(e);return t>0?Bs(t,9007199254740991):0},Ws=Gs,Hs=function(e){return Ws(e.length)},Ks=Q,zs=Vs,qs=Hs,Ys=function(e){return function(t,s,n){var r=Ks(t),i=qs(r);if(0===i)return!e&&-1;var a,o=zs(n,i);if(e&&s!=s){for(;i>o;)if((a=r[o++])!=a)return!0}else for(;i>o;o++)if((e||o in r)&&r[o]===s)return e||o||0;return!e&&-1}},Xs={includes:Ys(!0),indexOf:Ys(!1)},Js=Xs.includes;As({target:"Array",proto:!0,forced:r(function(){return!Array(1).includes()})},{includes:function(e){return Js(this,e,arguments.length>1?arguments[1]:void 0)}});var Qs=p,Zs=ee,$s=function(e,t){var s=Zs[e+"Prototype"],n=s&&s[t];if(n)return n;var r=Qs[e],i=r&&r.prototype;return i&&i[t]},en=$s("Array","includes"),tn=$,sn=b,nn=mt("match"),rn=function(e){var t;return tn(e)&&(void 0!==(t=e[nn])?!!t:"RegExp"===sn(e))},an=rn,on=TypeError,cn={};cn[mt("toStringTag")]="z";var ln="[object z]"===String(cn),dn=ln,un=C,hn=b,pn=mt("toStringTag"),mn=Object,fn="Arguments"===hn(function(){return arguments}()),gn=dn?hn:function(e){var t,s,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(s=function(e,t){try{return e[t]}catch(e){}}(t=mn(e),pn))?s:fn?hn(t):"Object"===(n=hn(t))&&un(t.callee)?"Arguments":n},yn=gn,vn=String,xn=function(e){if("Symbol"===yn(e))throw new TypeError("Cannot convert a Symbol value to a string");return vn(e)},_n=mt("match"),En=As,bn=function(e){if(an(e))throw new on("The method doesn't accept regular expressions");return e},wn=Y,Nn=xn,Sn=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[_n]=!1,"/./"[e](t)}catch(e){}}return!1},Tn=d("".indexOf);En({target:"String",proto:!0,forced:!Sn("includes")},{includes:function(e){return!!~Tn(Nn(wn(this)),Nn(bn(e)),arguments.length>1?arguments[1]:void 0)}});var Cn=$s("String","includes"),Rn=u,In=en,An=Cn,On=Array.prototype,jn=String.prototype,kn=function(e){var t=e.includes;return e===On||Rn(On,e)&&t===On.includes?In:"string"==typeof e||e===jn||Rn(jn,e)&&t===jn.includes?An:t},Dn=n(kn),Pn=Oe,Ln=Qe,Mn=H,Un=Hs,Vn=TypeError,Fn="Reduce of empty array with no initial value",Bn=function(e){return function(t,s,n,r){var i=Ln(t),a=Mn(i),o=Un(i);if(Pn(s),0===o&&n<2)throw new Vn(Fn);var c=e?o-1:0,l=e?-1:1;if(n<2)for(;;){if(c in a){r=a[c],c+=l;break}if(c+=l,e?c<0:o<=c)throw new Vn(Fn)}for(;e?c>=0:o>c;c+=l)c in a&&(r=s(r,a[c],c,i));return r}},Gn={left:Bn(!1),right:Bn(!0)},Wn=r,Hn=function(e,t){var s=[][e];return!!s&&Wn(function(){s.call(null,t||function(){return 1},1)})},Kn=p,zn=ce,qn=b,Yn=function(e){return zn.slice(0,e.length)===e},Xn=Yn("Bun/")?"BUN":Yn("Cloudflare-Workers")?"CLOUDFLARE":Yn("Deno/")?"DENO":Yn("Node.js/")?"NODE":Kn.Bun&&"string"==typeof Bun.version?"BUN":Kn.Deno&&"object"==typeof Deno.version?"DENO":"process"===qn(Kn.process)?"NODE":Kn.window&&Kn.document?"BROWSER":"REST",Jn="NODE"===Xn,Qn=Gn.left;As({target:"Array",proto:!0,forced:!Jn&&fe>79&&fe<83||!Hn("reduce")},{reduce:function(e){var t=arguments.length;return Qn(this,e,t,t>1?arguments[1]:void 0)}});var Zn=$s("Array","reduce"),$n=u,er=Zn,tr=Array.prototype,sr=function(e){var t=e.reduce;return e===tr||$n(tr,e)&&t===tr.reduce?er:t},nr=sr,rr=n(nr),ir=b,ar=Array.isArray||function(e){return"Array"===ir(e)},or=As,cr=ar,lr=d([].reverse),dr=[1,2];or({target:"Array",proto:!0,forced:String(dr)===String(dr.reverse())},{reverse:function(){return cr(this)&&(this.length=this.length),lr(this)}});var ur=$s("Array","reverse"),hr=u,pr=ur,mr=Array.prototype,fr=function(e){var t=e.reverse;return e===mr||hr(mr,e)&&t===mr.reverse?pr:t},gr=fr,yr=n(gr),vr=it,xr=Ye("keys"),_r=function(e){return xr[e]||(xr[e]=vr(e))},Er=!r(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),br=et,wr=C,Nr=Qe,Sr=Er,Tr=_r("IE_PROTO"),Cr=Object,Rr=Cr.prototype,Ir=Sr?Cr.getPrototypeOf:function(e){var t=Nr(e);if(br(t,Tr))return t[Tr];var s=t.constructor;return wr(s)&&t instanceof s?s.prototype:t instanceof Cr?Rr:null},Ar=d,Or=Oe,jr=$,kr=function(e){return jr(e)||null===e},Dr=String,Pr=TypeError,Lr=function(e,t,s){try{return Ar(Or(Object.getOwnPropertyDescriptor(e,t)[s]))}catch(e){}},Mr=$,Ur=Y,Vr=function(e){if(kr(e))return e;throw new Pr("Can't set "+Dr(e)+" as a prototype")},Fr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=Lr(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch(e){}return function(s,n){return Ur(s),Vr(n),Mr(s)?(t?e(s,n):s.__proto__=n,s):s}}():void 0),Br={},Gr={},Wr=et,Hr=Q,Kr=Xs.indexOf,zr=Gr,qr=d([].push),Yr=function(e,t){var s,n=Hr(e),r=0,i=[];for(s in n)!Wr(zr,s)&&Wr(n,s)&&qr(i,s);for(;t.length>r;)Wr(n,s=t[r++])&&(~Kr(i,s)||qr(i,s));return i},Xr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Jr=Yr,Qr=Xr.concat("length","prototype");Br.f=Object.getOwnPropertyNames||function(e){return Jr(e,Qr)};var Zr={};Zr.f=Object.getOwnPropertySymbols;var $r=ie,ei=Br,ti=Zr,si=rs,ni=d([].concat),ri=$r("Reflect","ownKeys")||function(e){var t=ei.f(si(e)),s=ti.f;return s?ni(t,s(e)):t},ii=et,ai=ri,oi=R,ci=$t,li={},di=Yr,ui=Xr,hi=Object.keys||function(e){return di(e,ui)},pi=I,mi=es,fi=$t,gi=rs,yi=Q,vi=hi;li.f=pi&&!mi?Object.defineProperties:function(e,t){gi(e);for(var s,n=yi(t),r=vi(t),i=r.length,a=0;i>a;)fi.f(e,s=r[a++],n[s]);return e};var xi,_i=ie("document","documentElement"),Ei=rs,bi=li,wi=Xr,Ni=Gr,Si=_i,Ti=Rt,Ci="prototype",Ri="script",Ii=_r("IE_PROTO"),Ai=function(){},Oi=function(e){return"<"+Ri+">"+e+"</"+Ri+">"},ji=function(e){e.write(Oi("")),e.close();var t=e.parentWindow.Object;return e=null,t},ki=function(){try{xi=new ActiveXObject("htmlfile")}catch(e){}var e,t,s;ki="undefined"!=typeof document?document.domain&&xi?ji(xi):(t=Ti("iframe"),s="java"+Ri+":",t.style.display="none",Si.appendChild(t),t.src=String(s),(e=t.contentWindow.document).open(),e.write(Oi("document.F=Object")),e.close(),e.F):ji(xi);for(var n=wi.length;n--;)delete ki[Ci][wi[n]];return ki()};Ni[Ii]=!0;var Di=Object.create||function(e,t){var s;return null!==e?(Ai[Ci]=Ei(e),s=new Ai,Ai[Ci]=null,s[Ii]=e):s=ki(),void 0===t?s:bi.f(s,t)},Pi=$,Li=vs,Mi=Error,Ui=d("".replace),Vi=String(new Mi("zxcasd").stack),Fi=/\n\s*at [^:]*:[^\n]*/,Bi=Fi.test(Vi),Gi=V,Wi=!r(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Gi(1,7)),7!==e.stack)}),Hi=vs,Ki=function(e,t){if(Bi&&"string"==typeof e&&!Mi.prepareStackTrace)for(;t--;)e=Ui(e,Fi,"");return e},zi=Wi,qi=Error.captureStackTrace,Yi={},Xi=Yi,Ji=mt("iterator"),Qi=Array.prototype,Zi=function(e){return void 0!==e&&(Xi.Array===e||Qi[Ji]===e)},$i=gn,ea=De,ta=K,sa=Yi,na=mt("iterator"),ra=function(e){if(!ta(e))return ea(e,na)||ea(e,"@@iterator")||sa[$i(e)]},ia=j,aa=Oe,oa=rs,ca=Ce,la=ra,da=TypeError,ua=function(e,t){var s=arguments.length<2?la(e):t;if(aa(s))return oa(ia(s,e));throw new da(ca(e)+" is not iterable")},ha=j,pa=rs,ma=De,fa=function(e,t,s){var n,r;pa(e);try{if(!(n=ma(e,"return"))){if("throw"===t)throw s;return s}n=ha(n,e)}catch(e){r=!0,n=e}if("throw"===t)throw s;if(r)throw n;return pa(n),s},ga=Zt,ya=j,va=rs,xa=Ce,_a=Zi,Ea=Hs,ba=u,wa=ua,Na=ra,Sa=fa,Ta=TypeError,Ca=function(e,t){this.stopped=e,this.result=t},Ra=Ca.prototype,Ia=function(e,t,s){var n,r,i,a,o,c,l,d=s&&s.that,u=!(!s||!s.AS_ENTRIES),h=!(!s||!s.IS_RECORD),p=!(!s||!s.IS_ITERATOR),m=!(!s||!s.INTERRUPTED),f=ga(t,d),g=function(e){return n&&Sa(n,"normal",e),new Ca(!0,e)},y=function(e){return u?(va(e),m?f(e[0],e[1],g):f(e[0],e[1])):m?f(e,g):f(e)};if(h)n=e.iterator;else if(p)n=e;else{if(!(r=Na(e)))throw new Ta(xa(e)+" is not iterable");if(_a(r)){for(i=0,a=Ea(e);a>i;i++)if((o=y(e[i]))&&ba(Ra,o))return o;return new Ca(!1)}n=wa(e,r)}for(c=h?e.next:n.next;!(l=ya(c,n)).done;){try{o=y(l.value)}catch(e){Sa(n,"throw",e)}if("object"==typeof o&&o&&ba(Ra,o))return o}return new Ca(!1)},Aa=xn,Oa=As,ja=u,ka=Ir,Da=Fr,Pa=function(e,t,s){for(var n=ai(t),r=ci.f,i=oi.f,a=0;a<n.length;a++){var o=n[a];ii(e,o)||s&&ii(s,o)||r(e,o,i(t,o))}},La=Di,Ma=vs,Ua=V,Va=function(e,t){Pi(t)&&"cause"in t&&Li(e,"cause",t.cause)},Fa=function(e,t,s,n){zi&&(qi?qi(e,t):Hi(e,"stack",Ki(s,n)))},Ba=Ia,Ga=function(e,t){return void 0===e?arguments.length<2?"":t:Aa(e)},Wa=mt("toStringTag"),Ha=Error,Ka=[].push,za=function(e,t){var s,n=ja(qa,this);Da?s=Da(new Ha,n?ka(this):qa):(s=n?this:La(qa),Ma(s,Wa,"Error")),void 0!==t&&Ma(s,"message",Ga(t)),Fa(s,za,s.stack,1),arguments.length>2&&Va(s,arguments[2]);var r=[];return Ba(e,Ka,{that:r}),Ma(s,"errors",r),s};Da?Da(za,Ha):Pa(za,Ha,{name:!0});var qa=za.prototype=La(Ha.prototype,{constructor:Ua(1,za),message:Ua(1,""),name:Ua(1,"AggregateError")});Oa({global:!0,constructor:!0,arity:2},{AggregateError:za});var Ya,Xa,Ja,Qa=C,Za=p.WeakMap,$a=Qa(Za)&&/native code/.test(String(Za)),eo=p,to=$,so=vs,no=et,ro=ze,io=_r,ao=Gr,oo="Object already initialized",co=eo.TypeError,lo=eo.WeakMap;if($a||ro.state){var uo=ro.state||(ro.state=new lo);uo.get=uo.get,uo.has=uo.has,uo.set=uo.set,Ya=function(e,t){if(uo.has(e))throw new co(oo);return t.facade=e,uo.set(e,t),t},Xa=function(e){return uo.get(e)||{}},Ja=function(e){return uo.has(e)}}else{var ho=io("state");ao[ho]=!0,Ya=function(e,t){if(no(e,ho))throw new co(oo);return t.facade=e,so(e,ho,t),t},Xa=function(e){return no(e,ho)?e[ho]:{}},Ja=function(e){return no(e,ho)}}var po,mo,fo,go={set:Ya,get:Xa,has:Ja,enforce:function(e){return Ja(e)?Xa(e):Ya(e,{})},getterFor:function(e){return function(t){var s;if(!to(t)||(s=Xa(t)).type!==e)throw new co("Incompatible receiver, "+e+" required");return s}}},yo=I,vo=et,xo=Function.prototype,_o=yo&&Object.getOwnPropertyDescriptor,Eo=vo(xo,"name"),bo={EXISTS:Eo,PROPER:Eo&&"something"===function(){}.name,CONFIGURABLE:Eo&&(!yo||yo&&_o(xo,"name").configurable)},wo=vs,No=function(e,t,s,n){return n&&n.enumerable?e[t]=s:wo(e,t,s),e},So=r,To=C,Co=$,Ro=Di,Io=Ir,Ao=No,Oo=mt("iterator"),jo=!1;[].keys&&("next"in(fo=[].keys())?(mo=Io(Io(fo)))!==Object.prototype&&(po=mo):jo=!0);var ko=!Co(po)||So(function(){var e={};return po[Oo].call(e)!==e});To((po=ko?{}:Ro(po))[Oo])||Ao(po,Oo,function(){return this});var Do={IteratorPrototype:po,BUGGY_SAFARI_ITERATORS:jo},Po=gn,Lo=ln?{}.toString:function(){return"[object "+Po(this)+"]"},Mo=ln,Uo=$t.f,Vo=vs,Fo=et,Bo=Lo,Go=mt("toStringTag"),Wo=function(e,t,s,n){var r=s?e:e&&e.prototype;r&&(Fo(r,Go)||Uo(r,Go,{configurable:!0,value:t}),n&&!Mo&&Vo(r,"toString",Bo))},Ho=Do.IteratorPrototype,Ko=Di,zo=V,qo=Wo,Yo=Yi,Xo=function(){return this},Jo=function(e,t,s,n){var r=t+" Iterator";return e.prototype=Ko(Ho,{next:zo(+!n,s)}),qo(e,r,!1,!0),Yo[r]=Xo,e},Qo=As,Zo=j,$o=Jo,ec=Ir,tc=Wo,sc=No,nc=Yi,rc=Do,ic=bo.PROPER,ac=rc.BUGGY_SAFARI_ITERATORS,oc=mt("iterator"),cc="keys",lc="values",dc="entries",uc=function(){return this},hc=function(e,t,s,n,r,i,a){$o(s,t,n);var o,c,l,d=function(e){if(e===r&&f)return f;if(!ac&&e&&e in p)return p[e];switch(e){case cc:case lc:case dc:return function(){return new s(this,e)}}return function(){return new s(this)}},u=t+" Iterator",h=!1,p=e.prototype,m=p[oc]||p["@@iterator"]||r&&p[r],f=!ac&&m||d(r),g="Array"===t&&p.entries||m;if(g&&(o=ec(g.call(new e)))!==Object.prototype&&o.next&&(tc(o,u,!0,!0),nc[u]=uc),ic&&r===lc&&m&&m.name!==lc&&(h=!0,f=function(){return Zo(m,this)}),r)if(c={values:d(lc),keys:i?f:d(cc),entries:d(dc)},a)for(l in c)(ac||h||!(l in p))&&sc(p,l,c[l]);else Qo({target:t,proto:!0,forced:ac||h},c);return a&&p[oc]!==f&&sc(p,oc,f,{name:r}),nc[t]=f,c},pc=function(e,t){return{value:e,done:t}},mc=Q,fc=Yi,gc=go;$t.f;var yc=hc,vc=pc,xc="Array Iterator",_c=gc.set,Ec=gc.getterFor(xc);yc(Array,"Array",function(e,t){_c(this,{type:xc,target:mc(e),index:0,kind:t})},function(){var e=Ec(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,vc(void 0,!0);switch(e.kind){case"keys":return vc(s,!1);case"values":return vc(t[s],!1)}return vc([s,t[s]],!1)},"values"),fc.Arguments=fc.Array;var bc=$t,wc=function(e,t,s){return bc.f(e,t,s)},Nc=ie,Sc=wc,Tc=I,Cc=mt("species"),Rc=u,Ic=TypeError,Ac=function(e,t){if(Rc(t,e))return e;throw new Ic("Incorrect invocation")},Oc=C,jc=ze,kc=d(Function.toString);Oc(jc.inspectSource)||(jc.inspectSource=function(e){return kc(e)});var Dc=jc.inspectSource,Pc=d,Lc=r,Mc=C,Uc=gn,Vc=Dc,Fc=function(){},Bc=ie("Reflect","construct"),Gc=/^\s*(?:class|function)\b/,Wc=Pc(Gc.exec),Hc=!Gc.test(Fc),Kc=function(e){if(!Mc(e))return!1;try{return Bc(Fc,[],e),!0}catch(e){return!1}},zc=function(e){if(!Mc(e))return!1;switch(Uc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Hc||!!Wc(Gc,Vc(e))}catch(e){return!0}};zc.sham=!0;var qc,Yc,Xc,Jc,Qc=!Bc||Lc(function(){var e;return Kc(Kc.call)||!Kc(Object)||!Kc(function(){e=!0})||e})?zc:Kc,Zc=Qc,$c=Ce,el=TypeError,tl=rs,sl=function(e){if(Zc(e))return e;throw new el($c(e)+" is not a constructor")},nl=K,rl=mt("species"),il=function(e,t){var s,n=tl(e).constructor;return void 0===n||nl(s=tl(n)[rl])?t:sl(s)},al=d([].slice),ol=TypeError,cl=function(e,t){if(e<t)throw new ol("Not enough arguments");return e},ll=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),dl=p,ul=v,hl=Zt,pl=C,ml=et,fl=r,gl=_i,yl=al,vl=Rt,xl=cl,_l=ll,El=Jn,bl=dl.setImmediate,wl=dl.clearImmediate,Nl=dl.process,Sl=dl.Dispatch,Tl=dl.Function,Cl=dl.MessageChannel,Rl=dl.String,Il=0,Al={},Ol="onreadystatechange";fl(function(){qc=dl.location});var jl=function(e){if(ml(Al,e)){var t=Al[e];delete Al[e],t()}},kl=function(e){return function(){jl(e)}},Dl=function(e){jl(e.data)},Pl=function(e){dl.postMessage(Rl(e),qc.protocol+"//"+qc.host)};bl&&wl||(bl=function(e){xl(arguments.length,1);var t=pl(e)?e:Tl(e),s=yl(arguments,1);return Al[++Il]=function(){ul(t,void 0,s)},Yc(Il),Il},wl=function(e){delete Al[e]},El?Yc=function(e){Nl.nextTick(kl(e))}:Sl&&Sl.now?Yc=function(e){Sl.now(kl(e))}:Cl&&!_l?(Jc=(Xc=new Cl).port2,Xc.port1.onmessage=Dl,Yc=hl(Jc.postMessage,Jc)):dl.addEventListener&&pl(dl.postMessage)&&!dl.importScripts&&qc&&"file:"!==qc.protocol&&!fl(Pl)?(Yc=Pl,dl.addEventListener("message",Dl,!1)):Yc=Ol in vl("script")?function(e){gl.appendChild(vl("script"))[Ol]=function(){gl.removeChild(this),jl(e)}}:function(e){setTimeout(kl(e),0)});var Ll={set:bl,clear:wl},Ml=p,Ul=I,Vl=Object.getOwnPropertyDescriptor,Fl=function(e){if(!Ul)return Ml[e];var t=Vl(Ml,e);return t&&t.value},Bl=function(){this.head=null,this.tail=null};Bl.prototype={add:function(e){var t={item:e,next:null},s=this.tail;s?s.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Gl,Wl,Hl,Kl,zl,ql=Bl,Yl=/ipad|iphone|ipod/i.test(ce)&&"undefined"!=typeof Pebble,Xl=/web0s(?!.*chrome)/i.test(ce),Jl=p,Ql=Fl,Zl=Zt,$l=Ll.set,ed=ql,td=ll,sd=Yl,nd=Xl,rd=Jn,id=Jl.MutationObserver||Jl.WebKitMutationObserver,ad=Jl.document,od=Jl.process,cd=Jl.Promise,ld=Ql("queueMicrotask");if(!ld){var dd=new ed,ud=function(){var e,t;for(rd&&(e=od.domain)&&e.exit();t=dd.get();)try{t()}catch(e){throw dd.head&&Gl(),e}e&&e.enter()};td||rd||nd||!id||!ad?!sd&&cd&&cd.resolve?((Kl=cd.resolve(void 0)).constructor=cd,zl=Zl(Kl.then,Kl),Gl=function(){zl(ud)}):rd?Gl=function(){od.nextTick(ud)}:($l=Zl($l,Jl),Gl=function(){$l(ud)}):(Wl=!0,Hl=ad.createTextNode(""),new id(ud).observe(Hl,{characterData:!0}),Gl=function(){Hl.data=Wl=!Wl}),ld=function(e){dd.head||Gl(),dd.add(e)}}var hd=ld,pd=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},md=p.Promise,fd=p,gd=md,yd=C,vd=Yt,xd=Dc,_d=mt,Ed=Xn,bd=fe,wd=gd&&gd.prototype,Nd=_d("species"),Sd=!1,Td=yd(fd.PromiseRejectionEvent),Cd=vd("Promise",function(){var e=xd(gd),t=e!==String(gd);if(!t&&66===bd)return!0;if(!wd.catch||!wd.finally)return!0;if(!bd||bd<51||!/native code/.test(e)){var s=new gd(function(e){e(1)}),n=function(e){e(function(){},function(){})};if((s.constructor={})[Nd]=n,!(Sd=s.then(function(){})instanceof n))return!0}return!(t||"BROWSER"!==Ed&&"DENO"!==Ed||Td)}),Rd={CONSTRUCTOR:Cd,REJECTION_EVENT:Td,SUBCLASSING:Sd},Id={},Ad=Oe,Od=TypeError,jd=function(e){var t,s;this.promise=new e(function(e,n){if(void 0!==t||void 0!==s)throw new Od("Bad Promise constructor");t=e,s=n}),this.resolve=Ad(t),this.reject=Ad(s)};Id.f=function(e){return new jd(e)};var kd,Dd,Pd=As,Ld=Jn,Md=p,Ud=j,Vd=No,Fd=Wo,Bd=function(e){var t=Nc(e);Tc&&t&&!t[Cc]&&Sc(t,Cc,{configurable:!0,get:function(){return this}})},Gd=Oe,Wd=C,Hd=$,Kd=Ac,zd=il,qd=Ll.set,Yd=hd,Xd=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}},Jd=pd,Qd=ql,Zd=go,$d=md,eu=Rd,tu=Id,su="Promise",nu=eu.CONSTRUCTOR,ru=eu.REJECTION_EVENT,iu=Zd.getterFor(su),au=Zd.set,ou=$d&&$d.prototype,cu=$d,lu=ou,du=Md.TypeError,uu=Md.document,hu=Md.process,pu=tu.f,mu=pu,fu=!!(uu&&uu.createEvent&&Md.dispatchEvent),gu="unhandledrejection",yu=function(e){var t;return!(!Hd(e)||!Wd(t=e.then))&&t},vu=function(e,t){var s,n,r,i=t.value,a=1===t.state,o=a?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{o?(a||(2===t.rejection&&wu(t),t.rejection=1),!0===o?s=i:(d&&d.enter(),s=o(i),d&&(d.exit(),r=!0)),s===e.promise?l(new du("Promise-chain cycle")):(n=yu(s))?Ud(n,s,c,l):c(s)):l(i)}catch(e){d&&!r&&d.exit(),l(e)}},xu=function(e,t){e.notified||(e.notified=!0,Yd(function(){for(var s,n=e.reactions;s=n.get();)vu(s,e);e.notified=!1,t&&!e.rejection&&Eu(e)}))},_u=function(e,t,s){var n,r;fu?((n=uu.createEvent("Event")).promise=t,n.reason=s,n.initEvent(e,!1,!0),Md.dispatchEvent(n)):n={promise:t,reason:s},!ru&&(r=Md["on"+e])?r(n):e===gu&&Xd("Unhandled promise rejection",s)},Eu=function(e){Ud(qd,Md,function(){var t,s=e.facade,n=e.value;if(bu(e)&&(t=Jd(function(){Ld?hu.emit("unhandledRejection",n,s):_u(gu,s,n)}),e.rejection=Ld||bu(e)?2:1,t.error))throw t.value})},bu=function(e){return 1!==e.rejection&&!e.parent},wu=function(e){Ud(qd,Md,function(){var t=e.facade;Ld?hu.emit("rejectionHandled",t):_u("rejectionhandled",t,e.value)})},Nu=function(e,t,s){return function(n){e(t,n,s)}},Su=function(e,t,s){e.done||(e.done=!0,s&&(e=s),e.value=t,e.state=2,xu(e,!0))},Tu=function(e,t,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===t)throw new du("Promise can't be resolved itself");var n=yu(t);n?Yd(function(){var s={done:!1};try{Ud(n,t,Nu(Tu,s,e),Nu(Su,s,e))}catch(t){Su(s,t,e)}}):(e.value=t,e.state=1,xu(e,!1))}catch(t){Su({done:!1},t,e)}}};nu&&(lu=(cu=function(e){Kd(this,lu),Gd(e),Ud(kd,this);var t=iu(this);try{e(Nu(Tu,t),Nu(Su,t))}catch(e){Su(t,e)}}).prototype,(kd=function(e){au(this,{type:su,done:!1,notified:!1,parent:!1,reactions:new Qd,rejection:!1,state:0,value:null})}).prototype=Vd(lu,"then",function(e,t){var s=iu(this),n=pu(zd(this,cu));return s.parent=!0,n.ok=!Wd(e)||e,n.fail=Wd(t)&&t,n.domain=Ld?hu.domain:void 0,0===s.state?s.reactions.add(n):Yd(function(){vu(n,s)}),n.promise}),Dd=function(){var e=new kd,t=iu(e);this.promise=e,this.resolve=Nu(Tu,t),this.reject=Nu(Su,t)},tu.f=pu=function(e){return e===cu||void 0===e?new Dd(e):mu(e)}),Pd({global:!0,constructor:!0,wrap:!0,forced:nu},{Promise:cu}),Fd(cu,su,!1,!0),Bd(su);var Cu=mt("iterator"),Ru=!1;try{var Iu=0,Au={next:function(){return{done:!!Iu++}},return:function(){Ru=!0}};Au[Cu]=function(){return this},Array.from(Au,function(){throw 2})}catch(e){}var Ou=md,ju=function(e,t){try{if(!t&&!Ru)return!1}catch(e){return!1}var s=!1;try{var n={};n[Cu]=function(){return{next:function(){return{done:s=!0}}}},e(n)}catch(e){}return s},ku=Rd.CONSTRUCTOR||!ju(function(e){Ou.all(e).then(void 0,function(){})}),Du=j,Pu=Oe,Lu=Id,Mu=pd,Uu=Ia;As({target:"Promise",stat:!0,forced:ku},{all:function(e){var t=this,s=Lu.f(t),n=s.resolve,r=s.reject,i=Mu(function(){var s=Pu(t.resolve),i=[],a=0,o=1;Uu(e,function(e){var c=a++,l=!1;o++,Du(s,t,e).then(function(e){l||(l=!0,i[c]=e,--o||n(i))},r)}),--o||n(i)});return i.error&&r(i.value),s.promise}});var Vu=As,Fu=Rd.CONSTRUCTOR;md&&md.prototype,Vu({target:"Promise",proto:!0,forced:Fu,real:!0},{catch:function(e){return this.then(void 0,e)}});var Bu=j,Gu=Oe,Wu=Id,Hu=pd,Ku=Ia;As({target:"Promise",stat:!0,forced:ku},{race:function(e){var t=this,s=Wu.f(t),n=s.reject,r=Hu(function(){var r=Gu(t.resolve);Ku(e,function(e){Bu(r,t,e).then(s.resolve,n)})});return r.error&&n(r.value),s.promise}});var zu=Id;As({target:"Promise",stat:!0,forced:Rd.CONSTRUCTOR},{reject:function(e){var t=zu.f(this);return(0,t.reject)(e),t.promise}});var qu=rs,Yu=$,Xu=Id,Ju=function(e,t){if(qu(e),Yu(t)&&t.constructor===e)return t;var s=Xu.f(e);return(0,s.resolve)(t),s.promise},Qu=As,Zu=md,$u=Rd.CONSTRUCTOR,eh=Ju,th=ie("Promise"),sh=!$u;Qu({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return eh(sh&&this===th?Zu:this,e)}});var nh=j,rh=Oe,ih=Id,ah=pd,oh=Ia;As({target:"Promise",stat:!0,forced:ku},{allSettled:function(e){var t=this,s=ih.f(t),n=s.resolve,r=s.reject,i=ah(function(){var s=rh(t.resolve),r=[],i=0,a=1;oh(e,function(e){var o=i++,c=!1;a++,nh(s,t,e).then(function(e){c||(c=!0,r[o]={status:"fulfilled",value:e},--a||n(r))},function(e){c||(c=!0,r[o]={status:"rejected",reason:e},--a||n(r))})}),--a||n(r)});return i.error&&r(i.value),s.promise}});var ch=j,lh=Oe,dh=ie,uh=Id,hh=pd,ph=Ia,mh="No one promise resolved";As({target:"Promise",stat:!0,forced:ku},{any:function(e){var t=this,s=dh("AggregateError"),n=uh.f(t),r=n.resolve,i=n.reject,a=hh(function(){var n=lh(t.resolve),a=[],o=0,c=1,l=!1;ph(e,function(e){var d=o++,u=!1;c++,ch(n,t,e).then(function(e){u||l||(l=!0,r(e))},function(e){u||l||(u=!0,a[d]=e,--c||i(new s(a,mh)))})}),--c||i(new s(a,mh))});return a.error&&i(a.value),n.promise}});var fh=As,gh=v,yh=al,vh=Id,xh=Oe,_h=pd,Eh=p.Promise,bh=!1;fh({target:"Promise",stat:!0,forced:!Eh||!Eh.try||_h(function(){Eh.try(function(e){bh=8===e},8)}).error||!bh},{try:function(e){var t=arguments.length>1?yh(arguments,1):[],s=vh.f(this),n=_h(function(){return gh(xh(e),void 0,t)});return(n.error?s.reject:s.resolve)(n.value),s.promise}});var wh=Id;As({target:"Promise",stat:!0},{withResolvers:function(){var e=wh.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Nh=As,Sh=md,Th=r,Ch=ie,Rh=C,Ih=il,Ah=Ju,Oh=Sh&&Sh.prototype;Nh({target:"Promise",proto:!0,real:!0,forced:!!Sh&&Th(function(){Oh.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=Ih(this,Ch("Promise")),s=Rh(e);return this.then(s?function(s){return Ah(t,e()).then(function(){return s})}:e,s?function(s){return Ah(t,e()).then(function(){throw s})}:e)}});var jh=d,kh=Ps,Dh=xn,Ph=Y,Lh=jh("".charAt),Mh=jh("".charCodeAt),Uh=jh("".slice),Vh=function(e){return function(t,s){var n,r,i=Dh(Ph(t)),a=kh(s),o=i.length;return a<0||a>=o?e?"":void 0:(n=Mh(i,a))<55296||n>56319||a+1===o||(r=Mh(i,a+1))<56320||r>57343?e?Lh(i,a):n:e?Uh(i,a,a+2):r-56320+(n-55296<<10)+65536}},Fh={codeAt:Vh(!1),charAt:Vh(!0)},Bh=Fh.charAt,Gh=xn,Wh=go,Hh=hc,Kh=pc,zh="String Iterator",qh=Wh.set,Yh=Wh.getterFor(zh);Hh(String,"String",function(e){qh(this,{type:zh,string:Gh(e),index:0})},function(){var e,t=Yh(this),s=t.string,n=t.index;return n>=s.length?Kh(void 0,!0):(e=Bh(s,n),t.index+=e.length,Kh(e,!1))});var Xh=ee.Promise,Jh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Qh=p,Zh=Wo,$h=Yi;for(var ep in Jh)Zh(Qh[ep],ep),$h[ep]=$h.Array;var tp=Xh,sp=n(tp),np=$s("Array","values"),rp=gn,ip=et,ap=u,op=np,cp=Array.prototype,lp={DOMTokenList:!0,NodeList:!0},dp=function(e){var t=e.values;return e===cp||ap(cp,e)&&t===cp.values||ip(lp,rp(e))?op:t},up=n(dp),hp=Ce,pp=TypeError,mp=al,fp=Math.floor,gp=function(e,t){var s=e.length;if(s<8)for(var n,r,i=1;i<s;){for(r=i,n=e[i];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==i++&&(e[r]=n)}else for(var a=fp(s/2),o=gp(mp(e,0,a),t),c=gp(mp(e,a),t),l=o.length,d=c.length,u=0,h=0;u<l||h<d;)e[u+h]=u<l&&h<d?t(o[u],c[h])<=0?o[u++]:c[h++]:u<l?o[u++]:c[h++];return e},yp=gp,vp=ce.match(/firefox\/(\d+)/i),xp=!!vp&&+vp[1],_p=/MSIE|Trident/.test(ce),Ep=ce.match(/AppleWebKit\/(\d+)\./),bp=!!Ep&&+Ep[1],wp=As,Np=d,Sp=Oe,Tp=Qe,Cp=Hs,Rp=function(e,t){if(!delete e[t])throw new pp("Cannot delete property "+hp(t)+" of "+hp(e))},Ip=xn,Ap=r,Op=yp,jp=Hn,kp=xp,Dp=_p,Pp=fe,Lp=bp,Mp=[],Up=Np(Mp.sort),Vp=Np(Mp.push),Fp=Ap(function(){Mp.sort(void 0)}),Bp=Ap(function(){Mp.sort(null)}),Gp=jp("sort"),Wp=!Ap(function(){if(Pp)return Pp<70;if(!(kp&&kp>3)){if(Dp)return!0;if(Lp)return Lp<603;var e,t,s,n,r="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(n=0;n<47;n++)Mp.push({k:t+n,v:s})}for(Mp.sort(function(e,t){return t.v-e.v}),n=0;n<Mp.length;n++)t=Mp[n].k.charAt(0),r.charAt(r.length-1)!==t&&(r+=t);return"DGBEFHACIJK"!==r}});wp({target:"Array",proto:!0,forced:Fp||!Bp||!Gp||!Wp},{sort:function(e){void 0!==e&&Sp(e);var t=Tp(this);if(Wp)return void 0===e?Up(t):Up(t,e);var s,n,r=[],i=Cp(t);for(n=0;n<i;n++)n in t&&Vp(r,t[n]);for(Op(r,function(e){return function(t,s){return void 0===s?-1:void 0===t?1:void 0!==e?+e(t,s)||0:Ip(t)>Ip(s)?1:-1}}(e)),s=Cp(r),n=0;n<s;)t[n]=r[n++];for(;n<i;)Rp(t,n++);return t}});var Hp=$s("Array","sort"),Kp=u,zp=Hp,qp=Array.prototype,Yp=function(e){var t=e.sort;return e===qp||Kp(qp,e)&&t===qp.sort?zp:t},Xp=n(Yp),Jp=As,Qp=d,Zp=Vs,$p=RangeError,em=String.fromCharCode,tm=String.fromCodePoint,sm=Qp([].join);Jp({target:"String",stat:!0,arity:1,forced:!!tm&&1!==tm.length},{fromCodePoint:function(e){for(var t,s=[],n=arguments.length,r=0;n>r;){if(t=+arguments[r++],Zp(t,1114111)!==t)throw new $p(t+" is not a valid code point");s[r]=t<65536?em(t):em(55296+((t-=65536)>>10),t%1024+56320)}return sm(s,"")}});var nm=r,rm=mt("iterator"),im=!nm(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),n="";return e.pathname="c%20d",t.forEach(function(e,s){t.delete("b"),n+=s+e}),s.delete("a",2),s.delete("b",void 0),!e.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!t.size&&!0||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[rm]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("https://a#\u0431").hash||"a1c3"!==n||"x"!==new URL("https://x",void 0).host}),am=No,om=As,cm=p,lm=Fl,dm=ie,um=j,hm=d,pm=I,mm=im,fm=No,gm=wc,ym=function(e,t,s){for(var n in t)s&&s.unsafe&&e[n]?e[n]=t[n]:am(e,n,t[n],s);return e},vm=Wo,xm=Jo,_m=go,Em=Ac,bm=C,wm=et,Nm=Zt,Sm=gn,Tm=rs,Cm=$,Rm=xn,Im=Di,Am=V,Om=ua,jm=ra,km=pc,Dm=cl,Pm=yp,Lm=mt("iterator"),Mm="URLSearchParams",Um=Mm+"Iterator",Vm=_m.set,Fm=_m.getterFor(Mm),Bm=_m.getterFor(Um),Gm=lm("fetch"),Wm=lm("Request"),Hm=lm("Headers"),Km=Wm&&Wm.prototype,zm=Hm&&Hm.prototype,qm=cm.TypeError,Ym=cm.encodeURIComponent,Xm=String.fromCharCode,Jm=dm("String","fromCodePoint"),Qm=parseInt,Zm=hm("".charAt),$m=hm([].join),ef=hm([].push),tf=hm("".replace),sf=hm([].shift),nf=hm([].splice),rf=hm("".split),af=hm("".slice),of=hm(/./.exec),cf=/\+/g,lf=/^[0-9a-f]+$/i,df=function(e,t){var s=af(e,t,t+2);return of(lf,s)?Qm(s,16):NaN},uf=function(e){for(var t=0,s=128;s>0&&0!=(e&s);s>>=1)t++;return t},hf=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},pf=function(e){for(var t=(e=tf(e,cf," ")).length,s="",n=0;n<t;){var r=Zm(e,n);if("%"===r){if("%"===Zm(e,n+1)||n+3>t){s+="%",n++;continue}var i=df(e,n+1);if(i!=i){s+=r,n++;continue}n+=2;var a=uf(i);if(0===a)r=Xm(i);else{if(1===a||a>4){s+="\ufffd",n++;continue}for(var o=[i],c=1;c<a&&!(3+ ++n>t||"%"!==Zm(e,n));){var l=df(e,n+1);if(l!=l){n+=3;break}if(l>191||l<128)break;ef(o,l),n+=2,c++}if(o.length!==a){s+="\ufffd";continue}var d=hf(o);null===d?s+="\ufffd":r=Jm(d)}}s+=r,n++}return s},mf=/[!'()~]|%20/g,ff={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},gf=function(e){return ff[e]},yf=function(e){return tf(Ym(e),mf,gf)},vf=xm(function(e,t){Vm(this,{type:Um,target:Fm(e).entries,index:0,kind:t})},Mm,function(){var e=Bm(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,km(void 0,!0);var n=t[s];switch(e.kind){case"keys":return km(n.key,!1);case"values":return km(n.value,!1)}return km([n.key,n.value],!1)},!0),xf=function(e){this.entries=[],this.url=null,void 0!==e&&(Cm(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Zm(e,0)?af(e,1):e:Rm(e)))};xf.prototype={type:Mm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,s,n,r,i,a,o,c=this.entries,l=jm(e);if(l)for(s=(t=Om(e,l)).next;!(n=um(s,t)).done;){if(i=(r=Om(Tm(n.value))).next,(a=um(i,r)).done||(o=um(i,r)).done||!um(i,r).done)throw new qm("Expected sequence with length 2");ef(c,{key:Rm(a.value),value:Rm(o.value)})}else for(var d in e)wm(e,d)&&ef(c,{key:d,value:Rm(e[d])})},parseQuery:function(e){if(e)for(var t,s,n=this.entries,r=rf(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(s=rf(t,"="),ef(n,{key:pf(sf(s)),value:pf($m(s,"="))}))},serialize:function(){for(var e,t=this.entries,s=[],n=0;n<t.length;)e=t[n++],ef(s,yf(e.key)+"="+yf(e.value));return $m(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var _f=function(){Em(this,Ef);var e=Vm(this,new xf(arguments.length>0?arguments[0]:void 0));pm||(this.size=e.entries.length)},Ef=_f.prototype;if(ym(Ef,{append:function(e,t){var s=Fm(this);Dm(arguments.length,2),ef(s.entries,{key:Rm(e),value:Rm(t)}),pm||this.length++,s.updateURL()},delete:function(e){for(var t=Fm(this),s=Dm(arguments.length,1),n=t.entries,r=Rm(e),i=s<2?void 0:arguments[1],a=void 0===i?i:Rm(i),o=0;o<n.length;){var c=n[o];if(c.key!==r||void 0!==a&&c.value!==a)o++;else if(nf(n,o,1),void 0!==a)break}pm||(this.size=n.length),t.updateURL()},get:function(e){var t=Fm(this).entries;Dm(arguments.length,1);for(var s=Rm(e),n=0;n<t.length;n++)if(t[n].key===s)return t[n].value;return null},getAll:function(e){var t=Fm(this).entries;Dm(arguments.length,1);for(var s=Rm(e),n=[],r=0;r<t.length;r++)t[r].key===s&&ef(n,t[r].value);return n},has:function(e){for(var t=Fm(this).entries,s=Dm(arguments.length,1),n=Rm(e),r=s<2?void 0:arguments[1],i=void 0===r?r:Rm(r),a=0;a<t.length;){var o=t[a++];if(o.key===n&&(void 0===i||o.value===i))return!0}return!1},set:function(e,t){var s=Fm(this);Dm(arguments.length,1);for(var n,r=s.entries,i=!1,a=Rm(e),o=Rm(t),c=0;c<r.length;c++)(n=r[c]).key===a&&(i?nf(r,c--,1):(i=!0,n.value=o));i||ef(r,{key:a,value:o}),pm||(this.size=r.length),s.updateURL()},sort:function(){var e=Fm(this);Pm(e.entries,function(e,t){return e.key>t.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,s=Fm(this).entries,n=Nm(e,arguments.length>1?arguments[1]:void 0),r=0;r<s.length;)n((t=s[r++]).value,t.key,this)},keys:function(){return new vf(this,"keys")},values:function(){return new vf(this,"values")},entries:function(){return new vf(this,"entries")}},{enumerable:!0}),fm(Ef,Lm,Ef.entries,{name:"entries"}),fm(Ef,"toString",function(){return Fm(this).serialize()},{enumerable:!0}),pm&&gm(Ef,"size",{get:function(){return Fm(this).entries.length},configurable:!0,enumerable:!0}),vm(_f,Mm),om({global:!0,constructor:!0,forced:!mm},{URLSearchParams:_f}),!mm&&bm(Hm)){var bf=hm(zm.has),wf=hm(zm.set),Nf=function(e){if(Cm(e)){var t,s=e.body;if(Sm(s)===Mm)return t=e.headers?new Hm(e.headers):new Hm,bf(t,"content-type")||wf(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Im(e,{body:Am(0,Rm(s)),headers:Am(0,t)})}return e};if(bm(Gm)&&om({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Gm(e,arguments.length>1?Nf(arguments[1]):{})}}),bm(Wm)){var Sf=function(e){return Em(this,Km),new Wm(e,arguments.length>1?Nf(arguments[1]):{})};Km.constructor=Sf,Sf.prototype=Km,om({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Sf})}}var Tf,Cf={URLSearchParams:_f,getState:Fm},Rf=ee.URLSearchParams,If=I,Af=d,Of=j,jf=r,kf=hi,Df=Zr,Pf=k,Lf=Qe,Mf=H,Uf=Object.assign,Vf=Object.defineProperty,Ff=Af([].concat),Bf=!Uf||jf(function(){if(If&&1!==Uf({b:1},Uf(Vf({},"a",{enumerable:!0,get:function(){Vf(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},s=Symbol("assign detection"),n="abcdefghijklmnopqrst";return e[s]=7,n.split("").forEach(function(e){t[e]=e}),7!==Uf({},e)[s]||kf(Uf({},t)).join("")!==n})?function(e,t){for(var s=Lf(e),n=arguments.length,r=1,i=Df.f,a=Pf.f;n>r;)for(var o,c=Mf(arguments[r++]),l=i?Ff(kf(c),i(c)):kf(c),d=l.length,u=0;d>u;)o=l[u++],If&&!Of(a,c,o)||(s[o]=c[o]);return s}:Uf,Gf=rs,Wf=fa,Hf=I,Kf=$t,zf=V,qf=function(e,t,s){Hf?Kf.f(e,t,zf(0,s)):e[t]=s},Yf=Zt,Xf=j,Jf=Qe,Qf=function(e,t,s,n){try{return n?t(Gf(s)[0],s[1]):t(s)}catch(t){Wf(e,"throw",t)}},Zf=Zi,$f=Qc,eg=Hs,tg=qf,sg=ua,ng=ra,rg=Array,ig=d,ag=2147483647,og=/[^\0-\u007E]/,cg=/[.\u3002\uFF0E\uFF61]/g,lg="Overflow: input needs wider integers to process",dg=RangeError,ug=ig(cg.exec),hg=Math.floor,pg=String.fromCharCode,mg=ig("".charCodeAt),fg=ig([].join),gg=ig([].push),yg=ig("".replace),vg=ig("".split),xg=ig("".toLowerCase),_g=function(e){return e+22+75*(e<26)},Eg=function(e,t,s){var n=0;for(e=s?hg(e/700):e>>1,e+=hg(e/t);e>455;)e=hg(e/35),n+=36;return hg(n+36*e/(e+38))},bg=function(e){var t=[];e=function(e){for(var t=[],s=0,n=e.length;s<n;){var r=mg(e,s++);if(r>=55296&&r<=56319&&s<n){var i=mg(e,s++);56320==(64512&i)?gg(t,((1023&r)<<10)+(1023&i)+65536):(gg(t,r),s--)}else gg(t,r)}return t}(e);var s,n,r=e.length,i=128,a=0,o=72;for(s=0;s<e.length;s++)(n=e[s])<128&&gg(t,pg(n));var c=t.length,l=c;for(c&&gg(t,"-");l<r;){var d=ag;for(s=0;s<e.length;s++)(n=e[s])>=i&&n<d&&(d=n);var u=l+1;if(d-i>hg((ag-a)/u))throw new dg(lg);for(a+=(d-i)*u,i=d,s=0;s<e.length;s++){if((n=e[s])<i&&++a>ag)throw new dg(lg);if(n===i){for(var h=a,p=36;;){var m=p<=o?1:p>=o+26?26:p-o;if(h<m)break;var f=h-m,g=36-m;gg(t,pg(_g(m+f%g))),h=hg(f/g),p+=36}gg(t,pg(_g(h))),o=Eg(a,u,l===c),a=0,l++}}a++,i++}return fg(t,"")},wg=As,Ng=I,Sg=im,Tg=p,Cg=Zt,Rg=d,Ig=No,Ag=wc,Og=Ac,jg=et,kg=Bf,Dg=function(e){var t=Jf(e),s=$f(this),n=arguments.length,r=n>1?arguments[1]:void 0,i=void 0!==r;i&&(r=Yf(r,n>2?arguments[2]:void 0));var a,o,c,l,d,u,h=ng(t),p=0;if(!h||this===rg&&Zf(h))for(a=eg(t),o=s?new this(a):rg(a);a>p;p++)u=i?r(t[p],p):t[p],tg(o,p,u);else for(o=s?new this:[],d=(l=sg(t,h)).next;!(c=Xf(d,l)).done;p++)u=i?Qf(l,r,[c.value,p],!0):c.value,tg(o,p,u);return o.length=p,o},Pg=al,Lg=Fh.codeAt,Mg=function(e){var t,s,n=[],r=vg(yg(xg(e),cg,"."),".");for(t=0;t<r.length;t++)s=r[t],gg(n,ug(og,s)?"xn--"+bg(s):s);return fg(n,".")},Ug=xn,Vg=Wo,Fg=cl,Bg=Cf,Gg=go,Wg=Gg.set,Hg=Gg.getterFor("URL"),Kg=Bg.URLSearchParams,zg=Bg.getState,qg=Tg.URL,Yg=Tg.TypeError,Xg=Tg.parseInt,Jg=Math.floor,Qg=Math.pow,Zg=Rg("".charAt),$g=Rg(/./.exec),ey=Rg([].join),ty=Rg(1..toString),sy=Rg([].pop),ny=Rg([].push),ry=Rg("".replace),iy=Rg([].shift),ay=Rg("".split),oy=Rg("".slice),cy=Rg("".toLowerCase),ly=Rg([].unshift),dy="Invalid scheme",uy="Invalid host",hy="Invalid port",py=/[a-z]/i,my=/[\d+-.a-z]/i,fy=/\d/,gy=/^0x/i,yy=/^[0-7]+$/,vy=/^\d+$/,xy=/^[\da-f]+$/i,_y=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Ey=/[\0\t\n\r #/:<>?@[\\\]^|]/,by=/^[\u0000-\u0020]+/,wy=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Ny=/[\t\n\r]/g,Sy=function(e){var t,s,n,r;if("number"==typeof e){for(t=[],s=0;s<4;s++)ly(t,e%256),e=Jg(e/256);return ey(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,s=1,n=null,r=0,i=0;i<8;i++)0!==e[i]?(r>s&&(t=n,s=r),n=null,r=0):(null===n&&(n=i),++r);return r>s?n:t}(e),s=0;s<8;s++)r&&0===e[s]||(r&&(r=!1),n===s?(t+=s?":":"::",r=!0):(t+=ty(e[s],16),s<7&&(t+=":")));return"["+t+"]"}return e},Ty={},Cy=kg({},Ty,{" ":1,'"':1,"<":1,">":1,"`":1}),Ry=kg({},Cy,{"#":1,"?":1,"{":1,"}":1}),Iy=kg({},Ry,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ay=function(e,t){var s=Lg(e,0);return s>32&&s<127&&!jg(t,e)?e:encodeURIComponent(e)},Oy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},jy=function(e,t){var s;return 2===e.length&&$g(py,Zg(e,0))&&(":"===(s=Zg(e,1))||!t&&"|"===s)},ky=function(e){var t;return e.length>1&&jy(oy(e,0,2))&&(2===e.length||"/"===(t=Zg(e,2))||"\\"===t||"?"===t||"#"===t)},Dy=function(e){return"."===e||"%2e"===cy(e)},Py={},Ly={},My={},Uy={},Vy={},Fy={},By={},Gy={},Wy={},Hy={},Ky={},zy={},qy={},Yy={},Xy={},Jy={},Qy={},Zy={},$y={},ev={},tv={},sv=function(e,t,s){var n,r,i,a=Ug(e);if(t){if(r=this.parse(a))throw new Yg(r);this.searchParams=null}else{if(void 0!==s&&(n=new sv(s,!0)),r=this.parse(a,null,n))throw new Yg(r);(i=zg(new Kg)).bindURL(this),this.searchParams=i}};sv.prototype={type:"URL",parse:function(e,t,s){var n,r,i,a,o,c=this,l=t||Py,d=0,u="",h=!1,p=!1,m=!1;for(e=Ug(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=ry(e,by,""),e=ry(e,wy,"$1")),e=ry(e,Ny,""),n=Dg(e);d<=n.length;){switch(r=n[d],l){case Py:if(!r||!$g(py,r)){if(t)return dy;l=My;continue}u+=cy(r),l=Ly;break;case Ly:if(r&&($g(my,r)||"+"===r||"-"===r||"."===r))u+=cy(r);else{if(":"!==r){if(t)return dy;u="",l=My,d=0;continue}if(t&&(c.isSpecial()!==jg(Oy,u)||"file"===u&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&Oy[c.scheme]===c.port&&(c.port=null));u="","file"===c.scheme?l=Yy:c.isSpecial()&&s&&s.scheme===c.scheme?l=Uy:c.isSpecial()?l=Gy:"/"===n[d+1]?(l=Vy,d++):(c.cannotBeABaseURL=!0,ny(c.path,""),l=$y)}break;case My:if(!s||s.cannotBeABaseURL&&"#"!==r)return dy;if(s.cannotBeABaseURL&&"#"===r){c.scheme=s.scheme,c.path=Pg(s.path),c.query=s.query,c.fragment="",c.cannotBeABaseURL=!0,l=tv;break}l="file"===s.scheme?Yy:Fy;continue;case Uy:if("/"!==r||"/"!==n[d+1]){l=Fy;continue}l=Wy,d++;break;case Vy:if("/"===r){l=Hy;break}l=Zy;continue;case Fy:if(c.scheme=s.scheme,r===Tf)c.username=s.username,c.password=s.password,c.host=s.host,c.port=s.port,c.path=Pg(s.path),c.query=s.query;else if("/"===r||"\\"===r&&c.isSpecial())l=By;else if("?"===r)c.username=s.username,c.password=s.password,c.host=s.host,c.port=s.port,c.path=Pg(s.path),c.query="",l=ev;else{if("#"!==r){c.username=s.username,c.password=s.password,c.host=s.host,c.port=s.port,c.path=Pg(s.path),c.path.length--,l=Zy;continue}c.username=s.username,c.password=s.password,c.host=s.host,c.port=s.port,c.path=Pg(s.path),c.query=s.query,c.fragment="",l=tv}break;case By:if(!c.isSpecial()||"/"!==r&&"\\"!==r){if("/"!==r){c.username=s.username,c.password=s.password,c.host=s.host,c.port=s.port,l=Zy;continue}l=Hy}else l=Wy;break;case Gy:if(l=Wy,"/"!==r||"/"!==Zg(u,d+1))continue;d++;break;case Wy:if("/"!==r&&"\\"!==r){l=Hy;continue}break;case Hy:if("@"===r){h&&(u="%40"+u),h=!0,i=Dg(u);for(var f=0;f<i.length;f++){var g=i[f];if(":"!==g||m){var y=Ay(g,Iy);m?c.password+=y:c.username+=y}else m=!0}u=""}else if(r===Tf||"/"===r||"?"===r||"#"===r||"\\"===r&&c.isSpecial()){if(h&&""===u)return"Invalid authority";d-=Dg(u).length+1,u="",l=Ky}else u+=r;break;case Ky:case zy:if(t&&"file"===c.scheme){l=Jy;continue}if(":"!==r||p){if(r===Tf||"/"===r||"?"===r||"#"===r||"\\"===r&&c.isSpecial()){if(c.isSpecial()&&""===u)return uy;if(t&&""===u&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(u))return a;if(u="",l=Qy,t)return;continue}"["===r?p=!0:"]"===r&&(p=!1),u+=r}else{if(""===u)return uy;if(a=c.parseHost(u))return a;if(u="",l=qy,t===zy)return}break;case qy:if(!$g(fy,r)){if(r===Tf||"/"===r||"?"===r||"#"===r||"\\"===r&&c.isSpecial()||t){if(""!==u){var v=Xg(u,10);if(v>65535)return hy;c.port=c.isSpecial()&&v===Oy[c.scheme]?null:v,u=""}if(t)return;l=Qy;continue}return hy}u+=r;break;case Yy:if(c.scheme="file","/"===r||"\\"===r)l=Xy;else{if(!s||"file"!==s.scheme){l=Zy;continue}switch(r){case Tf:c.host=s.host,c.path=Pg(s.path),c.query=s.query;break;case"?":c.host=s.host,c.path=Pg(s.path),c.query="",l=ev;break;case"#":c.host=s.host,c.path=Pg(s.path),c.query=s.query,c.fragment="",l=tv;break;default:ky(ey(Pg(n,d),""))||(c.host=s.host,c.path=Pg(s.path),c.shortenPath()),l=Zy;continue}}break;case Xy:if("/"===r||"\\"===r){l=Jy;break}s&&"file"===s.scheme&&!ky(ey(Pg(n,d),""))&&(jy(s.path[0],!0)?ny(c.path,s.path[0]):c.host=s.host),l=Zy;continue;case Jy:if(r===Tf||"/"===r||"\\"===r||"?"===r||"#"===r){if(!t&&jy(u))l=Zy;else if(""===u){if(c.host="",t)return;l=Qy}else{if(a=c.parseHost(u))return a;if("localhost"===c.host&&(c.host=""),t)return;u="",l=Qy}continue}u+=r;break;case Qy:if(c.isSpecial()){if(l=Zy,"/"!==r&&"\\"!==r)continue}else if(t||"?"!==r)if(t||"#"!==r){if(r!==Tf&&(l=Zy,"/"!==r))continue}else c.fragment="",l=tv;else c.query="",l=ev;break;case Zy:if(r===Tf||"/"===r||"\\"===r&&c.isSpecial()||!t&&("?"===r||"#"===r)){if(".."===(o=cy(o=u))||"%2e."===o||".%2e"===o||"%2e%2e"===o?(c.shortenPath(),"/"===r||"\\"===r&&c.isSpecial()||ny(c.path,"")):Dy(u)?"/"===r||"\\"===r&&c.isSpecial()||ny(c.path,""):("file"===c.scheme&&!c.path.length&&jy(u)&&(c.host&&(c.host=""),u=Zg(u,0)+":"),ny(c.path,u)),u="","file"===c.scheme&&(r===Tf||"?"===r||"#"===r))for(;c.path.length>1&&""===c.path[0];)iy(c.path);"?"===r?(c.query="",l=ev):"#"===r&&(c.fragment="",l=tv)}else u+=Ay(r,Ry);break;case $y:"?"===r?(c.query="",l=ev):"#"===r?(c.fragment="",l=tv):r!==Tf&&(c.path[0]+=Ay(r,Ty));break;case ev:t||"#"!==r?r!==Tf&&("'"===r&&c.isSpecial()?c.query+="%27":c.query+="#"===r?"%23":Ay(r,Ty)):(c.fragment="",l=tv);break;case tv:r!==Tf&&(c.fragment+=Ay(r,Cy))}d++}},parseHost:function(e){var t,s,n;if("["===Zg(e,0)){if("]"!==Zg(e,e.length-1))return uy;if(t=function(e){var t,s,n,r,i,a,o,c=[0,0,0,0,0,0,0,0],l=0,d=null,u=0,h=function(){return Zg(e,u)};if(":"===h()){if(":"!==Zg(e,1))return;u+=2,d=++l}for(;h();){if(8===l)return;if(":"!==h()){for(t=s=0;s<4&&$g(xy,h());)t=16*t+Xg(h(),16),u++,s++;if("."===h()){if(0===s)return;if(u-=s,l>6)return;for(n=0;h();){if(r=null,n>0){if(!("."===h()&&n<4))return;u++}if(!$g(fy,h()))return;for(;$g(fy,h());){if(i=Xg(h(),10),null===r)r=i;else{if(0===r)return;r=10*r+i}if(r>255)return;u++}c[l]=256*c[l]+r,2!=++n&&4!==n||l++}if(4!==n)return;break}if(":"===h()){if(u++,!h())return}else if(h())return;c[l++]=t}else{if(null!==d)return;u++,d=++l}}if(null!==d)for(a=l-d,l=7;0!==l&&a>0;)o=c[l],c[l--]=c[d+a-1],c[d+--a]=o;else if(8!==l)return;return c}(oy(e,1,-1)),!t)return uy;this.host=t}else if(this.isSpecial()){if(e=Mg(e),$g(_y,e))return uy;if(t=function(e){var t,s,n,r,i,a,o,c=ay(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(s=[],n=0;n<t;n++){if(""===(r=c[n]))return e;if(i=10,r.length>1&&"0"===Zg(r,0)&&(i=$g(gy,r)?16:8,r=oy(r,8===i?1:2)),""===r)a=0;else{if(!$g(10===i?vy:8===i?yy:xy,r))return e;a=Xg(r,i)}ny(s,a)}for(n=0;n<t;n++)if(a=s[n],n===t-1){if(a>=Qg(256,5-t))return null}else if(a>255)return null;for(o=sy(s),n=0;n<s.length;n++)o+=s[n]*Qg(256,3-n);return o}(e),null===t)return uy;this.host=t}else{if($g(Ey,e))return uy;for(t="",s=Dg(e),n=0;n<s.length;n++)t+=Ay(s[n],Ty);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return jg(Oy,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&jy(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,s=e.username,n=e.password,r=e.host,i=e.port,a=e.path,o=e.query,c=e.fragment,l=t+":";return null!==r?(l+="//",e.includesCredentials()&&(l+=s+(n?":"+n:"")+"@"),l+=Sy(r),null!==i&&(l+=":"+i)):"file"===t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+ey(a,"/"):"",null!==o&&(l+="?"+o),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw new Yg(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new nv(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+Sy(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ug(e)+":",Py)},getUsername:function(){return this.username},setUsername:function(e){var t=Dg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<t.length;s++)this.username+=Ay(t[s],Iy)}},getPassword:function(){return this.password},setPassword:function(e){var t=Dg(Ug(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<t.length;s++)this.password+=Ay(t[s],Iy)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Sy(e):Sy(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Ky)},getHostname:function(){var e=this.host;return null===e?"":Sy(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,zy)},getPort:function(){var e=this.port;return null===e?"":Ug(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=Ug(e))?this.port=null:this.parse(e,qy))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ey(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Qy))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=Ug(e))?this.query=null:("?"===Zg(e,0)&&(e=oy(e,1)),this.query="",this.parse(e,ev)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=Ug(e))?("#"===Zg(e,0)&&(e=oy(e,1)),this.fragment="",this.parse(e,tv)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var nv=function(e){var t=Og(this,rv),s=Fg(arguments.length,1)>1?arguments[1]:void 0,n=Wg(t,new sv(e,!1,s));Ng||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},rv=nv.prototype,iv=function(e,t){return{get:function(){return Hg(this)[e]()},set:t&&function(e){return Hg(this)[t](e)},configurable:!0,enumerable:!0}};if(Ng&&(Ag(rv,"href",iv("serialize","setHref")),Ag(rv,"origin",iv("getOrigin")),Ag(rv,"protocol",iv("getProtocol","setProtocol")),Ag(rv,"username",iv("getUsername","setUsername")),Ag(rv,"password",iv("getPassword","setPassword")),Ag(rv,"host",iv("getHost","setHost")),Ag(rv,"hostname",iv("getHostname","setHostname")),Ag(rv,"port",iv("getPort","setPort")),Ag(rv,"pathname",iv("getPathname","setPathname")),Ag(rv,"search",iv("getSearch","setSearch")),Ag(rv,"searchParams",iv("getSearchParams")),Ag(rv,"hash",iv("getHash","setHash"))),Ig(rv,"toJSON",function(){return Hg(this).serialize()},{enumerable:!0}),Ig(rv,"toString",function(){return Hg(this).serialize()},{enumerable:!0}),qg){var av=qg.createObjectURL,ov=qg.revokeObjectURL;av&&Ig(nv,"createObjectURL",Cg(av,qg)),ov&&Ig(nv,"revokeObjectURL",Cg(ov,qg))}Vg(nv,"URL"),wg({global:!0,constructor:!0,forced:!Sg,sham:!Ng},{URL:nv});var cv=As,lv=r,dv=cl,uv=xn,hv=im,pv=ie("URL"),mv=hv&&lv(function(){pv.canParse()}),fv=lv(function(){return 1!==pv.canParse.length});cv({target:"URL",stat:!0,forced:!mv||fv},{canParse:function(e){var t=dv(arguments.length,1),s=uv(e),n=t<2||void 0===arguments[1]?void 0:uv(arguments[1]);try{return!!new pv(s,n)}catch(e){return!1}}});var gv=As,yv=cl,vv=xn,xv=im,_v=ie("URL");gv({target:"URL",stat:!0,forced:!xv},{parse:function(e){var t=yv(arguments.length,1),s=vv(e),n=t<2||void 0===arguments[1]?void 0:vv(arguments[1]);try{return new _v(s,n)}catch(e){return null}}});var Ev=n(ee.URL);let bv=!0,wv=!0;function Nv(e,t,s){const n=e.match(t);return n&&n.length>=s&&parseInt(n[s],10)}function Sv(e,t,s){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return r.apply(this,arguments);const i=e=>{const t=s(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,i),r.apply(this,[e,i])};const i=n.removeEventListener;n.removeEventListener=function(e,s){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(s))return i.apply(this,arguments);const n=this._eventMap[t].get(s);return this._eventMap[t].delete(s),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Tv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(bv=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Cv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(wv=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Rv(){if("object"==typeof window){if(bv)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Iv(e,t){wv&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Av(e){return"[object Object]"===Object.prototype.toString.call(e)}function Ov(e){var t;return Av(e)?rr(t=Object.keys(e)).call(t,function(t,s){const n=Av(e[s]),r=n?Ov(e[s]):e[s],i=n&&!Object.keys(r).length;return void 0===r||i?t:Object.assign(t,{[s]:r})},{}):e}function jv(e,t,s){t&&!s.has(t.id)&&(s.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?jv(e,e.get(t[n]),s):n.endsWith("Ids")&&t[n].forEach(t=>{jv(e,e.get(t),s)})}))}function kv(e,t,s){const n=s?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const i=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(t=>{e.forEach(s=>{s.type===n&&s.trackId===t.id&&jv(e,s,r)})}),r}const Dv=Rv;function Pv(e,t){const s=e&&e.navigator;if(!s.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(s=>{if("require"===s||"advanced"===s||"mediaSource"===s)return;const n="object"==typeof e[s]?e[s]:{ideal:e[s]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[r("min",s)]=n.ideal,t.optional.push(e),e={},e[r("max",s)]=n.ideal,t.optional.push(e)):(e[r("",s)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",s)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,s)]=n[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,s){t in e&&!(s in e)&&(e[s]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});const a=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return s.mediaDevices.enumerateDevices().then(s=>{s=s.filter(e=>"videoinput"===e.kind);let a=s.find(e=>t.some(t=>{var s;return Dn(s=e.label.toLowerCase()).call(s,t)}));return!a&&s.length&&Dn(t).call(t,"back")&&(a=s[s.length-1]),a&&(e.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=n(e.video),Dv("chrome: "+JSON.stringify(e)),r(e)})}e.video=n(e.video)}return Dv("chrome: "+JSON.stringify(e)),r(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=function(e,t,n){r(e,e=>{s.webkitGetUserMedia(e,t,e=>{n&&n(i(e))})})}.bind(s),s.mediaDevices.getUserMedia){const e=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>sp.reject(i(e))))}}}function Lv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Mv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",s=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===s.track.id):{track:s.track};const r=new Event("track");r.track=s.track,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(s=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===s.id):{track:s};const r=new Event("track");r.track=s,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Sv(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Uv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let r=s.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,s,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach(e=>{const s={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{s[t]=e.stat(t)}),t[s.id]=s}),t},i=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const n=function(e){s(i(r(e)))};return t.apply(this,[n,e])}return new sp((e,s)=>{t.apply(this,[function(t){e(i(r(t)))},s])}).then(s,n)}}function Fv(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=s.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>kv(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Sv(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>kv(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,s,n;return this.getSenders().forEach(s=>{s.track===e&&(t?n=!0:t=s)}),this.getReceivers().forEach(t=>(t.track===e&&(s?n=!0:s=t),t.track===e)),n||t&&s?sp.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():s?s.getStats():sp.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Bv(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,s){if(!s)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[s.id]?-1===this._shimmedLocalStreams[s.id].indexOf(n)&&this._shimmedLocalStreams[s.id].push(n):this._shimmedLocalStreams[s.id]=[s,n],n};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();s.apply(this,arguments);const n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const s=this._shimmedLocalStreams[t].indexOf(e);-1!==s&&this._shimmedLocalStreams[t].splice(s,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function Gv(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Bv(e);const s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=s.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const s=new e.MediaStream(t.getTracks());this._streams[t.id]=s,this._reverseStreams[s.id]=t,t=s}n.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let s=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],r=e._streams[n.id];s=s.replace(new RegExp(r.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:s})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,s){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const r=this.getSenders().find(e=>e.track===t);if(r)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[s.id];if(i)i.addTrack(t),sp.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const n=new e.MediaStream([t]);this._streams[s.id]=n,this._reverseStreams[n.id]=s,this.addStream(n)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const s=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?s.apply(this,[t=>{const s=i(this,t);e[0].apply(null,[s])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):s.apply(this,arguments).then(e=>i(this,e))}};e.RTCPeerConnection.prototype[t]=n[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let s=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],r=e._streams[n.id];s=s.replace(new RegExp(n.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:s})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(s=>{this._streams[s].getTracks().find(t=>e.track===t)&&(t=this._streams[s])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wv(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const s=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]})}function Hv(e,t){Sv(e,"negotiationneeded",e=>{const s=e.target;if(!(t.version<72||s.getConfiguration&&"plan-b"===s.getConfiguration().sdpSemantics)||"stable"===s.signalingState)return e})}var Kv=Object.freeze({__proto__:null,fixNegotiationNeeded:Hv,shimAddTrackRemoveTrack:Gv,shimAddTrackRemoveTrackWithNative:Bv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(t=>{const n=s.video&&s.video.width,r=s.video&&s.video.height,i=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},n&&(s.video.mandatory.maxWidth=n),r&&(s.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Uv,shimGetStats:Vv,shimGetUserMedia:Pv,shimMediaStream:Lv,shimOnTrack:Mv,shimPeerConnection:Wv,shimSenderReceiverGetStats:Fv});function zv(e,t){const s=e&&e.navigator,n=e&&e.MediaStreamTrack;if(s.getUserMedia=function(e,t,n){Iv("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const e=function(e,t,s){t in e&&!(s in e)&&(e[s]=e[t],delete e[t])},t=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(s){return"object"==typeof s&&"object"==typeof s.audio&&(s=JSON.parse(JSON.stringify(s)),e(s.audio,"autoGainControl","mozAutoGainControl"),e(s.audio,"noiseSuppression","mozNoiseSuppression")),t(s)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const s=t.apply(this,arguments);return e(s,"mozAutoGainControl","autoGainControl"),e(s,"mozNoiseSuppression","noiseSuppression"),s}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(s){return"audio"===this.kind&&"object"==typeof s&&(s=JSON.parse(JSON.stringify(s)),e(s,"autoGainControl","mozAutoGainControl"),e(s,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[s])}}}}function qv(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Yv(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const s=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,i]=arguments;return n.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=s[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:s[t.type]||t.type}))})}return e}).then(r,i)}}function Xv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=s.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):sp.resolve(new Map)}}function Jv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Sv(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Qv(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Iv("removeStream","removeTrack"),this.getSenders().forEach(t=>{var s;t.track&&Dn(s=e.getTracks()).call(s,t.track)&&this.removeTrack(t)})})}function Zv(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $v(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const s=e.length>0;s&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const n=t.apply(this,arguments);if(s){const{sender:t}=n,s=t.getParameters();(!("encodings"in s)||1===s.encodings.length&&0===Object.keys(s.encodings[0]).length)&&(s.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(s).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return n})}function ex(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function tx(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?sp.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function sx(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?sp.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var nx=Object.freeze({__proto__:null,shimAddTransceiver:$v,shimCreateAnswer:sx,shimCreateOffer:tx,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,sp.reject(e)}return!0===s.video?s.video={mediaSource:t}:s.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:ex,shimGetUserMedia:zv,shimOnTrack:qv,shimPeerConnection:Yv,shimRTCDataChannel:Zv,shimReceiverGetStats:Jv,shimRemoveStream:Qv,shimSenderGetStats:Xv});function rx(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var s;this._localStreams||(this._localStreams=[]),Dn(s=this._localStreams).call(s,e)||this._localStreams.push(e),e.getAudioTracks().forEach(s=>t.call(this,s,e)),e.getVideoTracks().forEach(s=>t.call(this,s,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];return n&&n.forEach(e=>{var t;this._localStreams?Dn(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const s=e.getTracks();this.getSenders().forEach(e=>{Dn(s).call(s,e.track)&&this.removeTrack(e)})})}}function ix(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Dn(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const s=new Event("addstream");s.stream=e,this.dispatchEvent(s)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const s=new Event("addstream");s.stream=t,e.dispatchEvent(s)})}),t.apply(e,arguments)}}}function ax(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,s=t.createOffer,n=t.createAnswer,r=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=s.apply(this,[n]);return t?(r.then(e,t),sp.resolve()):r},t.createAnswer=function(e,t){const s=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[s]);return t?(r.then(e,t),sp.resolve()):r};let o=function(e,t,s){const n=r.apply(this,[e]);return s?(n.then(t,s),sp.resolve()):n};t.setLocalDescription=o,o=function(e,t,s){const n=i.apply(this,[e]);return s?(n.then(t,s),sp.resolve()):n},t.setRemoteDescription=o,o=function(e,t,s){const n=a.apply(this,[e]);return s?(n.then(t,s),sp.resolve()):n},t.addIceCandidate=o}function ox(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,s=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>s(cx(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,s,n){t.mediaDevices.getUserMedia(e).then(s,n)}.bind(t))}function cx(e){return e&&void 0!==e.video?Object.assign({},e,{video:Ov(e.video)}):e}function lx(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,s){if(e&&e.iceServers){const t=[];for(let s=0;s<e.iceServers.length;s++){let n=e.iceServers[s];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(Iv("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[s])}e.iceServers=t}return new t(e,s)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function dx(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ux(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const s=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0!==e.offerToReceiveVideo||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function hx(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var px=Object.freeze({__proto__:null,shimAudioContext:hx,shimCallbacksAPI:ax,shimConstraints:cx,shimCreateOfferLegacy:ux,shimGetUserMedia:ox,shimLocalStreamsAPI:rx,shimRTCIceServerUrls:lx,shimRemoteStreamsAPI:ix,shimTrackEventTransceiver:dx}),mx="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",fx=Y,gx=xn,yx=mx,vx=d("".replace),xx=RegExp("^["+yx+"]+"),_x=RegExp("(^|[^"+yx+"])["+yx+"]+$"),Ex=function(e){return function(t){var s=gx(fx(t));return 1&e&&(s=vx(s,xx,"")),2&e&&(s=vx(s,_x,"$1")),s}},bx={start:Ex(1),end:Ex(2),trim:Ex(3)},wx=bo.PROPER,Nx=r,Sx=mx,Tx=bx.trim;As({target:"String",proto:!0,forced:function(e){return Nx(function(){return!!Sx[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||wx&&Sx[e].name!==e})}("trim")},{trim:function(){return Tx(this)}});var Cx=$s("String","trim"),Rx=u,Ix=Cx,Ax=String.prototype,Ox=function(e){var t=e.trim;return"string"==typeof e||e===Ax||Rx(Ax,e)&&t===Ax.trim?Ix:t},jx=n(Ox),kx={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const s=t.splitSections(e);return s&&s[0]},t.getMediaSections=function(e){const s=t.splitSections(e);return s.shift(),s},t.matchPrefix=function(e,s){return t.splitLines(e).filter(e=>0===e.indexOf(s))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const s={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":s.relatedAddress=t[n+1];break;case"rport":s.relatedPort=parseInt(t[n+1],10);break;case"tcptype":s.tcpType=t[n+1];break;case"ufrag":s.ufrag=t[n+1],s.usernameFragment=t[n+1];break;default:void 0===s[t[n]]&&(s[t[n]]=t[n+1])}return s},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const s=e.component;"rtp"===s?t.push(1):"rtcp"===s?t.push(2):t.push(s),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const s={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),s.name=t[0],s.clockRate=parseInt(t[1],10),s.channels=3===t.length?parseInt(t[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const s=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==s?"/"+s:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let s;const n=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<n.length;r++)s=n[r].trim().split("="),t[s[0].trim()]=s[1];return t},t.writeFmtp=function(e){let t="",s=e.payloadType;if(void 0!==e.preferredPayloadType&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+s+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",s=e.payloadType;return void 0!==e.preferredPayloadType&&(s=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+s+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),s={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(s.attribute=e.substring(t+1,n),s.value=e.substring(n+1)):s.attribute=e.substring(t+1),s},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const s=t.matchPrefix(e,"a=mid:")[0];if(s)return s.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,s){return{role:"auto",fingerprints:t.matchPrefix(e+s,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let s="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{s+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),s},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,s){return t.matchPrefix(e+s,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,s){const n=t.matchPrefix(e+s,"a=ice-ufrag:")[0],r=t.matchPrefix(e+s,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");s.profile=n[2];for(let i=3;i<n.length;i++){const r=n[i],a=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){const n=t.parseRtpMap(a),i=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(n.parameters=i.length?t.parseFmtp(i[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),s.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(n.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{s.headerExtensions.push(t.parseExtmap(e))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return s.codecs.forEach(e=>{r.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),s},t.writeRtpDescription=function(e,s){let n="";n+="m="+e+" ",n+=s.codecs.length>0?"9":"0",n+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=s.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",s.codecs.forEach(e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)});let r=0;return s.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),s.headerExtensions&&s.headerExtensions.forEach(e=>{n+=t.writeExtmap(e)}),n},t.parseRtpEncodingParameters=function(e){const s=[],n=t.parseRtpParameters(e),r=-1!==n.fecMechanisms.indexOf("RED"),i=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),o=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===o&&(c=l[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&c&&(t.rtx={ssrc:c}),s.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:i?"red+ulpfec":"red"},s.push(t))}}),0===s.length&&o&&s.push({ssrc:o});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,s.forEach(e=>{e.maxBitrate=d})),s},t.parseRtcpParameters=function(e){const s={},n=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];n&&(s.cname=n.value,s.ssrc=n.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");s.reducedSize=r.length>0,s.compound=0===r.length;const i=t.matchPrefix(e,"a=rtcp-mux");return s.mux=i.length>0,s},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let s;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return s=n[0].substring(7).split(" "),{stream:s[0],track:s[1]};const r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return r.length>0?(s=r[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},t.parseSctpDescription=function(e){const s=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let r;n.length>0&&(r=parseInt(n[0].substring(19),10)),isNaN(r)&&(r=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substring(12),10),protocol:s.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let s=[];return s="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&s.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,s,n){let r;const i=void 0!==s?s:2;return r=e||t.generateSessionId(),"v=0\r\no="+(n||"thisisadapterortc")+" "+r+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,s){const n=t.splitLines(e);for(let t=0;t<n.length;t++)switch(n[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[t].substring(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const s=t.splitLines(e)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(e){const s=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const s=t.splitLines(e);for(let t=0;t<s.length;t++)if(s[t].length<2||"="!==s[t].charAt(1))return!1;return!0},e.exports=t}(kx);var Dx=kx.exports,Px=n(Dx),Lx=e({__proto__:null,default:Px},[Dx]);function Mx(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const s=new t(e),n=Px.parseCandidate(e.candidate),r=Object.assign(s,n);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Sv(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Ux(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Sv(e,"icecandidate",e=>{if(e.candidate){const t=Px.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Vx(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const s=function(e){if(!e||!e.sdp)return!1;const t=Px.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Px.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const s=parseInt(t[1],10);return s!=s?-1:s},r=function(e){let s=65536;return"firefox"===t.browser&&(s=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),s},i=function(e,s){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const r=Px.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?n=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==s&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const e=n(arguments[0]),t=r(e),s=i(arguments[0],e);let a;a=0===t&&0===s?Number.POSITIVE_INFINITY:0===t||0===s?Math.max(t,s):Math.min(t,s);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>a}),this._sctp=o}return a.apply(this,arguments)}}function Fx(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const s=e.send;e.send=function(){const n=arguments[0],r=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return s.apply(e,arguments)}}const s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=s.apply(this,arguments);return t(e,this),e},Sv(e,"datachannel",e=>(t(e.channel,e.target),e))}function Bx(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const s=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const s=new Event("connectionstatechange",e);t.dispatchEvent(s)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function Gx(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const s=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==jx(e).call(e)).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:s}):t.sdp=s}return s.apply(this,arguments)}}function Wx(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.addIceCandidate;s&&0!==s.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?sp.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),sp.resolve())})}function Hx(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.setLocalDescription;s&&0!==s.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return s.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?s.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>s.apply(this,[e]))})}var Kx=Object.freeze({__proto__:null,removeExtmapAllowMixed:Gx,shimAddIceCandidateNullOrEmpty:Wx,shimConnectionState:Bx,shimMaxMessageSize:Vx,shimParameterlessSetLocalDescription:Hx,shimRTCIceCandidate:Mx,shimRTCIceCandidateRelayProtocol:Ux,shimSendThrowTypeError:Fx});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=Rv,n=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:s}=e;if(s.mozGetUserMedia)t.browser="firefox",t.version=Nv(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Nv(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!s.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Nv(s.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:n,commonShim:Kx,extractVersion:Nv,disableLog:Tv,disableWarnings:Cv,sdp:Lx};switch(n.browser){case"chrome":if(!Kv||!Wv||!t.shimChrome)return s("Chrome shim is not included in this adapter release."),r;if(null===n.version)return s("Chrome shim can not determine version, not shimming."),r;s("adapter.js shimming chrome."),r.browserShim=Kv,Wx(e,n),Hx(e),Pv(e,n),Lv(e),Wv(e,n),Mv(e),Gv(e,n),Uv(e),Vv(e),Fv(e),Hv(e,n),Mx(e),Ux(e),Bx(e),Vx(e,n),Fx(e),Gx(e,n);break;case"firefox":if(!nx||!Yv||!t.shimFirefox)return s("Firefox shim is not included in this adapter release."),r;s("adapter.js shimming firefox."),r.browserShim=nx,Wx(e,n),Hx(e),zv(e,n),Yv(e,n),qv(e),Qv(e),Xv(e),Jv(e),Zv(e),$v(e),ex(e),tx(e),sx(e),Mx(e),Bx(e),Vx(e,n),Fx(e);break;case"safari":if(!px||!t.shimSafari)return s("Safari shim is not included in this adapter release."),r;s("adapter.js shimming safari."),r.browserShim=px,Wx(e,n),Hx(e),lx(e),ux(e),ax(e),rx(e),ix(e),dx(e),ox(e),hx(e),Mx(e),Ux(e),Vx(e,n),Fx(e),Gx(e,n);break;default:s("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var zx=p;As({global:!0,forced:zx.globalThis!==zx},{globalThis:zx});var qx=n(p),Yx={exports:{}};!function(e,s){!function(t,n){var r="function",i="undefined",a="object",o="string",c="major",l="model",d="name",u="type",h="vendor",p="version",m="architecture",f="console",g="mobile",y="tablet",v="smarttv",x="wearable",_="embedded",E="Amazon",b="Apple",w="ASUS",N="BlackBerry",S="Browser",T="Chrome",C="Firefox",R="Google",I="Huawei",A="LG",O="Microsoft",j="Motorola",k="Opera",D="Samsung",P="Sharp",L="Sony",M="Xiaomi",U="Zebra",V="Facebook",F="Chromium OS",B="Mac OS",G=" Browser",W=function(e){for(var t={},s=0;s<e.length;s++)t[e[s].toUpperCase()]=e[s];return t},H=function(e,t){return typeof e===o&&-1!==K(t).indexOf(K(e))},K=function(e){return e.toLowerCase()},z=function(e,t){if(typeof e===o)return e=e.replace(/^\s\s*/,""),typeof t===i?e:e.substring(0,500)},q=function(e,t){for(var s,i,o,c,l,d,u=0;u<t.length&&!l;){var h=t[u],p=t[u+1];for(s=i=0;s<h.length&&!l&&h[s];)if(l=h[s++].exec(e))for(o=0;o<p.length;o++)d=l[++i],typeof(c=p[o])===a&&c.length>0?2===c.length?typeof c[1]==r?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==r||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):n:this[c[0]]=d?c[1].call(this,d,c[2]):n:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):n):this[c]=d||n;u+=2}},Y=function(e,t){for(var s in t)if(typeof t[s]===a&&t[s].length>0){for(var r=0;r<t[s].length;r++)if(H(t[s][r],e))return"?"===s?n:s}else if(H(t[s],e))return"?"===s?n:s;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,p],[/opios[\/ ]+([\w\.]+)/i],[p,[d,k+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[d,k+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[d,k]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[p,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[d,"UC"+S]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[d,"Smart Lenovo "+S]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+S],p],[/\bfocus\/([\w\.]+)/i],[p,[d,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[d,k+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[d,k+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI"+G]],[/fxios\/([\w\.-]+)/i],[p,[d,C]],[/\bqihoobrowser\/?([\w\.]*)/i],[p,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+G],p],[/samsungbrowser\/([\w\.]+)/i],[p,[d,D+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[p,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,p],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[p,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,V],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[d,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,T+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[d,"Android "+S]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[p,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],p],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[d,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,K]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",K]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,K]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,D],[u,y]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,D],[u,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[h,b],[u,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,b],[u,y]],[/(macintosh);/i],[l,[h,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,P],[u,g]],[/(?:honor)([-\w ]+)[;\)]/i],[l,[h,"Honor"],[u,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,I],[u,y]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,I],[u,g]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,g]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,M],[u,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[u,g]],[/\b(opd2\d{3}a?) bui/i],[l,[h,"OPPO"],[u,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[u,g]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[u,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,j],[u,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,j],[u,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,A],[u,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,A],[u,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[u,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[u,g]],[/(pixel c)\b/i],[l,[h,R],[u,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,R],[u,g]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,L],[u,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,L],[u,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[u,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,E],[u,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,E],[u,g]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[u,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,N],[u,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,w],[u,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,w],[u,g]],[/(nexus 9)/i],[l,[h,"HTC"],[u,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[u,g]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[l,[h,"TCL"],[u,y]],[/(itel) ((\w+))/i],[[h,K],l,[u,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[u,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[u,g]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[h,"Ulefone"],[u,g]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[h,"Energizer"],[u,g]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[h,"Cat"],[u,g]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[h,"Smartfren"],[u,g]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[h,"Nothing"],[u,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[u,g]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[u,y]],[/(surface duo)/i],[l,[h,O],[u,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[u,g]],[/(u304aa)/i],[l,[h,"AT&T"],[u,g]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[u,g]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[u,y]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[u,y]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[u,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[u,y]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[u,y]],[/\b(k88) b/i],[l,[h,"ZTE"],[u,y]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[u,g]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[u,g]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[u,y]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[u,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[u,y]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[u,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[u,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[u,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[u,g]],[/\b(ph-1) /i],[l,[h,"Essential"],[u,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[u,y]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[u,y]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[u,y]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[u,y]],[/(sprint) (\w+)/i],[h,l,[u,g]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,O],[u,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,U],[u,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,U],[u,g]],[/smart-tv.+(samsung)/i],[h,[u,v]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,D],[u,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,A],[u,v]],[/(apple) ?tv/i],[h,[l,b+" TV"],[u,v]],[/crkey/i],[[l,T+"cast"],[h,R],[u,v]],[/droid.+aft(\w+)( bui|\))/i],[l,[h,E],[u,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,P],[u,v]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,L],[u,v]],[/(mitv-\w{5}) bui/i],[l,[h,M],[u,v]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[u,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,z],[l,z],[u,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[u,f]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[u,f]],[/(playstation [345portablevi]+)/i],[l,[h,L],[u,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,O],[u,f]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[l,[h,D],[u,x]],[/((pebble))app/i],[h,l,[u,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,b],[u,x]],[/droid.+; (glass) \d/i],[l,[h,R],[u,x]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,U],[u,x]],[/droid.+; (glass) \d/i],[l,[h,R],[u,x]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,l,[u,x]],[/; (quest( \d| pro)?)/i],[l,[h,V],[u,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[u,_]],[/(aeobc)\b/i],[l,[h,E],[u,_]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[l,[u,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[u,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,g]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,p],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[p,Y,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,Y,X],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,p],[/\(bb(10);/i],[p,[d,N]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[d,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[d,T+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,F],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,p],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,p]]},Q=function(e,s){if(typeof e===a&&(s=e,e=n),!(this instanceof Q))return new Q(e,s).getResult();var f=typeof t!==i&&t.navigator?t.navigator:n,v=e||(f&&f.userAgent?f.userAgent:""),x=f&&f.userAgentData?f.userAgentData:n,_=s?function(e,t){var s={};for(var n in e)t[n]&&t[n].length%2==0?s[n]=t[n].concat(e[n]):s[n]=e[n];return s}(J,s):J,E=f&&f.userAgent==v;return this.getBrowser=function(){var e={};return e[d]=n,e[p]=n,q.call(e,v,_.browser),e[c]=function(e){return typeof e===o?e.replace(/[^\d\.]/g,"").split(".")[0]:n}(e[p]),E&&f&&f.brave&&typeof f.brave.isBrave==r&&(e[d]="Brave"),e},this.getCPU=function(){var e={};return e[m]=n,q.call(e,v,_.cpu),e},this.getDevice=function(){var e={};return e[h]=n,e[l]=n,e[u]=n,q.call(e,v,_.device),E&&!e[u]&&x&&x.mobile&&(e[u]=g),E&&"Macintosh"==e[l]&&f&&typeof f.standalone!==i&&f.maxTouchPoints&&f.maxTouchPoints>2&&(e[l]="iPad",e[u]=y),e},this.getEngine=function(){var e={};return e[d]=n,e[p]=n,q.call(e,v,_.engine),e},this.getOS=function(){var e={};return e[d]=n,e[p]=n,q.call(e,v,_.os),E&&!e[d]&&x&&x.platform&&"Unknown"!=x.platform&&(e[d]=x.platform.replace(/chrome os/i,F).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(e){return v=typeof e===o&&e.length>500?z(e,500):e,this},this.setUA(v),this};Q.VERSION="0.7.40",Q.BROWSER=W([d,p,c]),Q.CPU=W([m]),Q.DEVICE=W([l,h,u,f,g,v,y,x,_]),Q.ENGINE=Q.OS=W([d,p]),e.exports&&(s=e.exports=Q),s.UAParser=Q;var Z=typeof t!==i&&(t.jQuery||t.Zepto);if(Z&&!Z.ua){var $=new Q;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var s in t)Z.ua[s]=t[s]}}}("object"==typeof window?window:t)}(Yx,Yx.exports);var Xx=n(Yx.exports),Jx=Ll.clear;As({global:!0,bind:!0,enumerable:!0,forced:p.clearImmediate!==Jx},{clearImmediate:Jx});var Qx=p,Zx=v,$x=C,e_=Xn,t_=ce,s_=al,n_=cl,r_=Qx.Function,i_=/MSIE .\./.test(t_)||"BUN"===e_&&function(){var e=Qx.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}(),a_=As,o_=p,c_=Ll.set,l_=function(e,t){var s=t?2:1;return i_?function(n,r){var i=n_(arguments.length,1)>s,a=$x(n)?n:r_(n),o=i?s_(arguments,s):[],c=i?function(){Zx(a,this,o)}:a;return t?e(c,r):e(c)}:e},d_=o_.setImmediate?l_(c_,!1):c_;a_({global:!0,bind:!0,enumerable:!0,forced:o_.setImmediate!==d_},{setImmediate:d_});var u_=n(ee.setImmediate),h_=p,p_=hd,m_=Oe,f_=cl,g_=I;As({global:!0,enumerable:!0,dontCallGetSet:!0,forced:r(function(){return g_&&1!==Object.getOwnPropertyDescriptor(h_,"queueMicrotask").value.length})},{queueMicrotask:function(e){f_(arguments.length,1),p_(m_(e))}});var y_=n(ee.queueMicrotask);function v_(e,t){return function(){return e.apply(t,arguments)}}const{toString:x_}=Object.prototype,{getPrototypeOf:__}=Object,{iterator:E_,toStringTag:b_}=Symbol,w_=(N_=Object.create(null),e=>{const t=x_.call(e);return N_[t]||(N_[t]=t.slice(8,-1).toLowerCase())});var N_;const S_=e=>(e=e.toLowerCase(),t=>w_(t)===e),T_=e=>t=>typeof t===e,{isArray:C_}=Array,R_=T_("undefined"),I_=S_("ArrayBuffer"),A_=T_("string"),O_=T_("function"),j_=T_("number"),k_=e=>null!==e&&"object"==typeof e,D_=e=>{if("object"!==w_(e))return!1;const t=__(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||b_ in e||E_ in e)},P_=S_("Date"),L_=S_("File"),M_=S_("Blob"),U_=S_("FileList"),V_=S_("URLSearchParams"),[F_,B_,G_,W_]=["ReadableStream","Request","Response","Headers"].map(S_);function H_(e,t){let s,n,{allOwnKeys:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),C_(e))for(s=0,n=e.length;s<n;s++)t.call(null,e[s],s,e);else{const n=r?Object.getOwnPropertyNames(e):Object.keys(e),i=n.length;let a;for(s=0;s<i;s++)a=n[s],t.call(null,e[a],a,e)}}function K_(e,t){t=t.toLowerCase();const s=Object.keys(e);let n,r=s.length;for(;r-- >0;)if(n=s[r],t===n.toLowerCase())return n;return null}const z_=void 0!==qx?qx:"undefined"!=typeof self?self:"undefined"!=typeof window?window:s.g,q_=e=>!R_(e)&&e!==z_,Y_=(X_="undefined"!=typeof Uint8Array&&__(Uint8Array),e=>X_&&e instanceof X_);var X_;const J_=S_("HTMLFormElement"),Q_=(e=>{let{hasOwnProperty:t}=e;return(e,s)=>t.call(e,s)})(Object.prototype),Z_=S_("RegExp"),$_=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),n={};H_(s,(s,r)=>{let i;!1!==(i=t(s,r,e))&&(n[r]=i||s)}),Object.defineProperties(e,n)},eE=S_("AsyncFunction"),tE=(sE="function"==typeof u_,nE=O_(z_.postMessage),sE?u_:nE?(rE="axios@".concat(Math.random()),iE=[],z_.addEventListener("message",e=>{let{source:t,data:s}=e;t===z_&&s===rE&&iE.length&&iE.shift()()},!1),e=>{iE.push(e),z_.postMessage(rE,"*")}):e=>setTimeout(e));var sE,nE,rE,iE;const aE=void 0!==y_?y_.bind(z_):"undefined"!=typeof process&&process.nextTick||tE;var oE={isArray:C_,isArrayBuffer:I_,isBuffer:function(e){return null!==e&&!R_(e)&&null!==e.constructor&&!R_(e.constructor)&&O_(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||O_(e.append)&&("formdata"===(t=w_(e))||"object"===t&&O_(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&I_(e.buffer),t},isString:A_,isNumber:j_,isBoolean:e=>!0===e||!1===e,isObject:k_,isPlainObject:D_,isReadableStream:F_,isRequest:B_,isResponse:G_,isHeaders:W_,isUndefined:R_,isDate:P_,isFile:L_,isBlob:M_,isRegExp:Z_,isFunction:O_,isStream:e=>k_(e)&&O_(e.pipe),isURLSearchParams:V_,isTypedArray:Y_,isFileList:U_,forEach:H_,merge:function e(){const{caseless:t}=q_(this)&&this||{},s={},n=(n,r)=>{const i=t&&K_(s,r)||r;D_(s[i])&&D_(n)?s[i]=e(s[i],n):D_(n)?s[i]=e({},n):C_(n)?s[i]=n.slice():s[i]=n};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&H_(arguments[r],n);return s},extend:function(e,t,s){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return H_(t,(t,n)=>{s&&O_(t)?e[n]=v_(t,s):e[n]=t},{allOwnKeys:n}),e},trim:e=>jx(e)?jx(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,s,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,n)=>{let r,i,a;const o={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),i=r.length;i-- >0;)a=r[i],n&&!n(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==s&&__(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:w_,kindOfTest:S_,endsWith:(e,t,s)=>{e=String(e),(void 0===s||s>e.length)&&(s=e.length),s-=t.length;const n=e.indexOf(t,s);return-1!==n&&n===s},toArray:e=>{if(!e)return null;if(C_(e))return e;let t=e.length;if(!j_(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[E_]).call(e);let n;for(;(n=s.next())&&!n.done;){const s=n.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let s;const n=[];for(;null!==(s=e.exec(t));)n.push(s);return n},isHTMLForm:J_,hasOwnProperty:Q_,hasOwnProp:Q_,reduceDescriptors:$_,freezeMethods:e=>{$_(e,(t,s)=>{if(O_(e)&&-1!==["arguments","caller","callee"].indexOf(s))return!1;const n=e[s];O_(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},n=e=>{e.forEach(e=>{s[e]=!0})};return C_(e)?n(e):n(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,s){return t.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:K_,global:z_,isContextDefined:q_,isSpecCompliantForm:function(e){return!!(e&&O_(e.append)&&"FormData"===e[b_]&&e[E_])},toJSONObject:e=>{const t=new Array(10),s=(e,n)=>{if(k_(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const r=C_(e)?[]:{};return H_(e,(e,t)=>{const i=s(e,n+1);!R_(i)&&(r[t]=i)}),t[n]=void 0,r}}return e};return s(e,0)},isAsyncFn:eE,isThenable:e=>e&&(k_(e)||O_(e))&&O_(e.then)&&O_(e.catch),setImmediate:tE,asap:aE,isIterable:e=>null!=e&&O_(e[E_])};function cE(e,t,s,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}oE.inherits(cE,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:oE.toJSONObject(this.config),code:this.code,status:this.status}}});const lE=cE.prototype,dE={};function uE(e){return oE.isPlainObject(e)||oE.isArray(e)}function hE(e){return oE.endsWith(e,"[]")?e.slice(0,-2):e}function pE(e,t,s){return e?e.concat(t).map(function(e,t){return e=hE(e),!s&&t?"["+e+"]":e}).join(s?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{dE[e]={value:e}}),Object.defineProperties(cE,dE),Object.defineProperty(lE,"isAxiosError",{value:!0}),cE.from=(e,t,s,n,r,i)=>{const a=Object.create(lE);return oE.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),cE.call(a,e.message,t,s,n,r),a.cause=e,a.name=e.name,i&&Object.assign(a,i),a};const mE=oE.toFlatObject(oE,{},null,function(e){return/^is[A-Z]/.test(e)});function fE(e,t,s){if(!oE.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(s=oE.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!oE.isUndefined(t[e])})).metaTokens,r=s.visitor||l,i=s.dots,a=s.indexes,o=(s.Blob||"undefined"!=typeof Blob&&Blob)&&oE.isSpecCompliantForm(t);if(!oE.isFunction(r))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(oE.isDate(e))return e.toISOString();if(!o&&oE.isBlob(e))throw new cE("Blob is not supported. Use a Buffer instead.");return oE.isArrayBuffer(e)||oE.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,s,r){let o=e;if(e&&!r&&"object"==typeof e)if(oE.endsWith(s,"{}"))s=n?s:s.slice(0,-2),e=JSON.stringify(e);else if(oE.isArray(e)&&function(e){return oE.isArray(e)&&!e.some(uE)}(e)||(oE.isFileList(e)||oE.endsWith(s,"[]"))&&(o=oE.toArray(e)))return s=hE(s),o.forEach(function(e,n){!oE.isUndefined(e)&&null!==e&&t.append(!0===a?pE([s],n,i):null===a?s:s+"[]",c(e))}),!1;return!!uE(e)||(t.append(pE(r,s,i),c(e)),!1)}const d=[],u=Object.assign(mE,{defaultVisitor:l,convertValue:c,isVisitable:uE});if(!oE.isObject(e))throw new TypeError("data must be an object");return function e(s,n){if(!oE.isUndefined(s)){if(-1!==d.indexOf(s))throw Error("Circular reference detected in "+n.join("."));d.push(s),oE.forEach(s,function(s,i){!0===(!(oE.isUndefined(s)||null===s)&&r.call(t,s,oE.isString(i)?jx(i).call(i):i,n,u))&&e(s,n?n.concat(i):[i])}),d.pop()}}(e),t}function gE(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function yE(e,t){this._pairs=[],e&&fE(e,this,t)}const vE=yE.prototype;function xE(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _E(e,t,s){if(!t)return e;const n=s&&s.encode||xE;oE.isFunction(s)&&(s={serialize:s});const r=s&&s.serialize;let i;if(i=r?r(t,s):oE.isURLSearchParams(t)?t.toString():new yE(t,s).toString(n),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}vE.append=function(e,t){this._pairs.push([e,t])},vE.toString=function(e){const t=e?function(t){return e.call(this,t,gE)}:gE;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var EE=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){oE.forEach(this.handlers,function(t){null!==t&&e(t)})}},bE={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wE={exports:{}},NE=As,SE=I,TE=$t.f;NE({target:"Object",stat:!0,forced:Object.defineProperty!==TE,sham:!SE},{defineProperty:TE});var CE=ee.Object,RE=wE.exports=function(e,t,s){return CE.defineProperty(e,t,s)};CE.defineProperty.sham&&(RE.sham=!0);var IE=n(wE.exports),AE=TypeError,OE=ar,jE=Qc,kE=$,DE=mt("species"),PE=Array,LE=function(e){var t;return OE(e)&&(t=e.constructor,(jE(t)&&(t===PE||OE(t.prototype))||kE(t)&&null===(t=t[DE]))&&(t=void 0)),void 0===t?PE:t},ME=function(e,t){return new(LE(e))(0===t?0:t)},UE=r,VE=fe,FE=mt("species"),BE=function(e){return VE>=51||!UE(function(){var t=[];return(t.constructor={})[FE]=function(){return{foo:1}},1!==t[e](Boolean).foo})},GE=As,WE=r,HE=ar,KE=$,zE=Qe,qE=Hs,YE=function(e){if(e>9007199254740991)throw AE("Maximum allowed index exceeded");return e},XE=qf,JE=ME,QE=BE,ZE=fe,$E=mt("isConcatSpreadable"),eb=ZE>=51||!WE(function(){var e=[];return e[$E]=!1,e.concat()[0]!==e}),tb=function(e){if(!KE(e))return!1;var t=e[$E];return void 0!==t?!!t:HE(e)};GE({target:"Array",proto:!0,arity:1,forced:!eb||!QE("concat")},{concat:function(e){var t,s,n,r,i,a=zE(this),o=JE(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(tb(i=-1===t?a:arguments[t]))for(r=qE(i),YE(c+r),s=0;s<r;s++,c++)s in i&&XE(o,c,i[s]);else YE(c+1),XE(o,c++,i);return o.length=c,o}});var sb={},nb=b,rb=Q,ib=Br.f,ab=al,ob="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];sb.f=function(e){return ob&&"Window"===nb(e)?function(e){try{return ib(e)}catch(e){return ab(ob)}}(e):ib(rb(e))};var cb={},lb=mt;cb.f=lb;var db=ee,ub=et,hb=cb,pb=$t.f,mb=function(e){var t=db.Symbol||(db.Symbol={});ub(t,e)||pb(t,e,{value:hb.f(e)})},fb=j,gb=ie,yb=mt,vb=No,xb=function(){var e=gb("Symbol"),t=e&&e.prototype,s=t&&t.valueOf,n=yb("toPrimitive");t&&!t[n]&&vb(t,n,function(e){return fb(s,this)},{arity:1})},_b=Zt,Eb=H,bb=Qe,wb=Hs,Nb=ME,Sb=d([].push),Tb=function(e){var t=1===e,s=2===e,n=3===e,r=4===e,i=6===e,a=7===e,o=5===e||i;return function(c,l,d,u){for(var h,p,m=bb(c),f=Eb(m),g=wb(f),y=_b(l,d),v=0,x=u||Nb,_=t?x(c,g):s||a?x(c,0):void 0;g>v;v++)if((o||v in f)&&(p=y(h=f[v],v,m),e))if(t)_[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:Sb(_,h)}else switch(e){case 4:return!1;case 7:Sb(_,h)}return i?-1:n||r?r:_}},Cb={forEach:Tb(0),map:Tb(1),filter:Tb(2),some:Tb(3),every:Tb(4),find:Tb(5),findIndex:Tb(6),filterReject:Tb(7)},Rb=As,Ib=p,Ab=j,Ob=d,jb=I,kb=xe,Db=r,Pb=et,Lb=u,Mb=rs,Ub=Q,Vb=Nt,Fb=xn,Bb=V,Gb=Di,Wb=hi,Hb=Br,Kb=sb,zb=Zr,qb=R,Yb=$t,Xb=li,Jb=k,Qb=No,Zb=wc,$b=Ye,ew=Gr,tw=it,sw=mt,nw=cb,rw=mb,iw=xb,aw=Wo,ow=go,cw=Cb.forEach,lw=_r("hidden"),dw="Symbol",uw="prototype",hw=ow.set,pw=ow.getterFor(dw),mw=Object[uw],fw=Ib.Symbol,gw=fw&&fw[uw],yw=Ib.RangeError,vw=Ib.TypeError,xw=Ib.QObject,_w=qb.f,Ew=Yb.f,bw=Kb.f,ww=Jb.f,Nw=Ob([].push),Sw=$b("symbols"),Tw=$b("op-symbols"),Cw=$b("wks"),Rw=!xw||!xw[uw]||!xw[uw].findChild,Iw=function(e,t,s){var n=_w(mw,t);n&&delete mw[t],Ew(e,t,s),n&&e!==mw&&Ew(mw,t,n)},Aw=jb&&Db(function(){return 7!==Gb(Ew({},"a",{get:function(){return Ew(this,"a",{value:7}).a}})).a})?Iw:Ew,Ow=function(e,t){var s=Sw[e]=Gb(gw);return hw(s,{type:dw,tag:e,description:t}),jb||(s.description=t),s},jw=function(e,t,s){e===mw&&jw(Tw,t,s),Mb(e);var n=Vb(t);return Mb(s),Pb(Sw,n)?(s.enumerable?(Pb(e,lw)&&e[lw][n]&&(e[lw][n]=!1),s=Gb(s,{enumerable:Bb(0,!1)})):(Pb(e,lw)||Ew(e,lw,Bb(1,Gb(null))),e[lw][n]=!0),Aw(e,n,s)):Ew(e,n,s)},kw=function(e,t){Mb(e);var s=Ub(t),n=Wb(s).concat(Mw(s));return cw(n,function(t){jb&&!Ab(Dw,s,t)||jw(e,t,s[t])}),e},Dw=function(e){var t=Vb(e),s=Ab(ww,this,t);return!(this===mw&&Pb(Sw,t)&&!Pb(Tw,t))&&(!(s||!Pb(this,t)||!Pb(Sw,t)||Pb(this,lw)&&this[lw][t])||s)},Pw=function(e,t){var s=Ub(e),n=Vb(t);if(s!==mw||!Pb(Sw,n)||Pb(Tw,n)){var r=_w(s,n);return!r||!Pb(Sw,n)||Pb(s,lw)&&s[lw][n]||(r.enumerable=!0),r}},Lw=function(e){var t=bw(Ub(e)),s=[];return cw(t,function(e){Pb(Sw,e)||Pb(ew,e)||Nw(s,e)}),s},Mw=function(e){var t=e===mw,s=bw(t?Tw:Ub(e)),n=[];return cw(s,function(e){!Pb(Sw,e)||t&&!Pb(mw,e)||Nw(n,Sw[e])}),n};kb||(fw=function(){if(Lb(gw,this))throw new vw("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Fb(arguments[0]):void 0,t=tw(e),s=function(e){var n=void 0===this?Ib:this;n===mw&&Ab(s,Tw,e),Pb(n,lw)&&Pb(n[lw],t)&&(n[lw][t]=!1);var r=Bb(1,e);try{Aw(n,t,r)}catch(e){if(!(e instanceof yw))throw e;Iw(n,t,r)}};return jb&&Rw&&Aw(mw,t,{configurable:!0,set:s}),Ow(t,e)},Qb(gw=fw[uw],"toString",function(){return pw(this).tag}),Qb(fw,"withoutSetter",function(e){return Ow(tw(e),e)}),Jb.f=Dw,Yb.f=jw,Xb.f=kw,qb.f=Pw,Hb.f=Kb.f=Lw,zb.f=Mw,nw.f=function(e){return Ow(sw(e),e)},jb&&Zb(gw,"description",{configurable:!0,get:function(){return pw(this).description}})),Rb({global:!0,constructor:!0,wrap:!0,forced:!kb,sham:!kb},{Symbol:fw}),cw(Wb(Cw),function(e){rw(e)}),Rb({target:dw,stat:!0,forced:!kb},{useSetter:function(){Rw=!0},useSimple:function(){Rw=!1}}),Rb({target:"Object",stat:!0,forced:!kb,sham:!jb},{create:function(e,t){return void 0===t?Gb(e):kw(Gb(e),t)},defineProperty:jw,defineProperties:kw,getOwnPropertyDescriptor:Pw}),Rb({target:"Object",stat:!0,forced:!kb},{getOwnPropertyNames:Lw}),iw(),aw(fw,dw),ew[lw]=!0;var Uw=xe&&!!Symbol.for&&!!Symbol.keyFor,Vw=As,Fw=ie,Bw=et,Gw=xn,Ww=Ye,Hw=Uw,Kw=Ww("string-to-symbol-registry"),zw=Ww("symbol-to-string-registry");Vw({target:"Symbol",stat:!0,forced:!Hw},{for:function(e){var t=Gw(e);if(Bw(Kw,t))return Kw[t];var s=Fw("Symbol")(t);return Kw[t]=s,zw[s]=t,s}});var qw=As,Yw=et,Xw=Se,Jw=Ce,Qw=Uw,Zw=Ye("symbol-to-string-registry");qw({target:"Symbol",stat:!0,forced:!Qw},{keyFor:function(e){if(!Xw(e))throw new TypeError(Jw(e)+" is not a symbol");if(Yw(Zw,e))return Zw[e]}});var $w=ar,eN=C,tN=b,sN=xn,nN=d([].push),rN=As,iN=ie,aN=v,oN=j,cN=d,lN=r,dN=C,uN=Se,hN=al,pN=function(e){if(eN(e))return e;if($w(e)){for(var t=e.length,s=[],n=0;n<t;n++){var r=e[n];"string"==typeof r?nN(s,r):"number"!=typeof r&&"Number"!==tN(r)&&"String"!==tN(r)||nN(s,sN(r))}var i=s.length,a=!0;return function(e,t){if(a)return a=!1,t;if($w(this))return t;for(var n=0;n<i;n++)if(s[n]===e)return t}}},mN=xe,fN=String,gN=iN("JSON","stringify"),yN=cN(/./.exec),vN=cN("".charAt),xN=cN("".charCodeAt),_N=cN("".replace),EN=cN(1..toString),bN=/[\uD800-\uDFFF]/g,wN=/^[\uD800-\uDBFF]$/,NN=/^[\uDC00-\uDFFF]$/,SN=!mN||lN(function(){var e=iN("Symbol")("stringify detection");return"[null]"!==gN([e])||"{}"!==gN({a:e})||"{}"!==gN(Object(e))}),TN=lN(function(){return'"\\udf06\\ud834"'!==gN("\udf06\ud834")||'"\\udead"'!==gN("\udead")}),CN=function(e,t){var s=hN(arguments),n=pN(t);if(dN(n)||void 0!==e&&!uN(e))return s[1]=function(e,t){if(dN(n)&&(t=oN(n,this,fN(e),t)),!uN(t))return t},aN(gN,null,s)},RN=function(e,t,s){var n=vN(s,t-1),r=vN(s,t+1);return yN(wN,e)&&!yN(NN,r)||yN(NN,e)&&!yN(wN,n)?"\\u"+EN(xN(e,0),16):e};gN&&rN({target:"JSON",stat:!0,arity:3,forced:SN||TN},{stringify:function(e,t,s){var n=hN(arguments),r=aN(SN?CN:gN,null,n);return TN&&"string"==typeof r?_N(r,bN,RN):r}});var IN=Zr,AN=Qe;As({target:"Object",stat:!0,forced:!xe||r(function(){IN.f(1)})},{getOwnPropertySymbols:function(e){var t=IN.f;return t?t(AN(e)):[]}}),mb("asyncIterator"),mb("hasInstance"),mb("isConcatSpreadable"),mb("iterator"),mb("match"),mb("matchAll"),mb("replace"),mb("search"),mb("species"),mb("split");var ON=xb;mb("toPrimitive"),ON();var jN=ie,kN=Wo;mb("toStringTag"),kN(jN("Symbol"),"Symbol"),mb("unscopables"),Wo(p.JSON,"JSON",!0);var DN=ee.Symbol,PN=mt,LN=$t.f,MN=PN("metadata"),UN=Function.prototype;void 0===UN[MN]&&LN(UN,MN,{value:null}),mb("asyncDispose"),mb("dispose"),mb("metadata");var VN=DN,FN=d,BN=ie("Symbol"),GN=BN.keyFor,WN=FN(BN.prototype.valueOf),HN=BN.isRegisteredSymbol||function(e){try{return void 0!==GN(WN(e))}catch(e){return!1}};As({target:"Symbol",stat:!0},{isRegisteredSymbol:HN});for(var KN=Ye,zN=ie,qN=d,YN=Se,XN=mt,JN=zN("Symbol"),QN=JN.isWellKnownSymbol,ZN=zN("Object","getOwnPropertyNames"),$N=qN(JN.prototype.valueOf),eS=KN("wks"),tS=0,sS=ZN(JN),nS=sS.length;tS<nS;tS++)try{var rS=sS[tS];YN(JN[rS])&&XN(rS)}catch(e){}var iS=function(e){if(QN&&QN(e))return!0;try{for(var t=$N(e),s=0,n=ZN(eS),r=n.length;s<r;s++)if(eS[n[s]]==t)return!0}catch(e){}return!1};As({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:iS}),mb("customMatcher"),mb("observable"),As({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:HN}),As({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:iS}),mb("matcher"),mb("metadataKey"),mb("patternMatch"),mb("replaceAll");var aS=n(VN),oS=n(cb.f("iterator"));function cS(e){return cS="function"==typeof aS&&"symbol"==typeof oS?function(e){return typeof e}:function(e){return e&&"function"==typeof aS&&e.constructor===aS&&e!==aS.prototype?"symbol":typeof e},cS(e)}var lS=n(cb.f("toPrimitive"));function dS(e){var t=function(e,t){if("object"!=cS(e)||!e)return e;var s=e[lS];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=cS(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==cS(t)?t:t+""}function uS(e,t,s){return(t=dS(t))in e?IE(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var hS=n(Rf),pS={isBrowser:!0,classes:{URLSearchParams:void 0!==hS?hS:yE,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const mS="undefined"!=typeof window&&"undefined"!=typeof document,fS="object"==typeof navigator&&navigator||void 0,gS=mS&&(!fS||["ReactNative","NativeScript","NS"].indexOf(fS.product)<0),yS="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,vS=mS&&window.location.href||"http://localhost";function xS(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function _S(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?xS(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):xS(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var ES=_S(_S({},Object.freeze({__proto__:null,hasBrowserEnv:mS,hasStandardBrowserEnv:gS,hasStandardBrowserWebWorkerEnv:yS,navigator:fS,origin:vS})),pS),bS=rs,wS=j,NS=et,SS=u,TS=function(){var e=bS(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},CS=RegExp.prototype,RS=function(e){var t=e.flags;return void 0!==t||"flags"in CS||NS(e,"flags")||!SS(CS,e)?t:wS(TS,e)},IS=Fh.charAt,AS=j,OS=rs,jS=C,kS=b,DS=/./.exec,PS=TypeError,LS=As,MS=j,US=S,VS=Jo,FS=pc,BS=Y,GS=Gs,WS=xn,HS=rs,KS=$,zS=b,qS=rn,YS=RS,XS=De,JS=r,QS=il,ZS=function(e,t,s){return t+(s?IS(e,t).length:1)},$S=function(e,t){var s=e.exec;if(jS(s)){var n=AS(s,e,t);return null!==n&&OS(n),n}if("RegExp"===kS(e))return AS(DS,e,t);throw new PS("RegExp#exec called on incompatible receiver")},eT=go,tT=mt("matchAll"),sT="RegExp String",nT=sT+" Iterator",rT=eT.set,iT=eT.getterFor(nT),aT=TypeError,oT=US("".indexOf),cT=US("".matchAll),lT=!!cT&&!JS(function(){cT("a",/./)}),dT=VS(function(e,t,s,n){rT(this,{type:nT,regexp:e,string:t,global:s,unicode:n,done:!1})},sT,function(){var e=iT(this);if(e.done)return FS(void 0,!0);var t=e.regexp,s=e.string,n=$S(t,s);return null===n?(e.done=!0,FS(void 0,!0)):e.global?(""===WS(n[0])&&(t.lastIndex=ZS(s,GS(t.lastIndex),e.unicode)),FS(n,!1)):(e.done=!0,FS(n,!1))}),uT=function(e){var t,s,n,r=HS(this),i=WS(e),a=QS(r,RegExp),o=WS(YS(r));return t=new a(a===RegExp?r.source:r,o),s=!!~oT(o,"g"),n=!!~oT(o,"u"),t.lastIndex=GS(r.lastIndex),new dT(t,i,s,n)};LS({target:"String",proto:!0,forced:lT},{matchAll:function(e){var t,s,n,r,i=BS(this);if(KS(e)){if(qS(e)&&(t=WS(BS(YS(e))),!~oT(t,"g")))throw new aT("`.matchAll` does not allow non-global regexes");if(lT)return cT(i,e);if(void 0===(n=XS(e,tT))&&"RegExp"===zS(e)&&(n=uT),n)return MS(n,e,i)}else if(lT)return cT(i,e);return s=WS(i),r=new RegExp(e,"g"),MS(uT,r,s)}});var hT=$s("String","matchAll"),pT=u,mT=hT,fT=String.prototype,gT=function(e){var t=e.matchAll;return"string"==typeof e||e===fT||pT(fT,e)&&t===fT.matchAll?mT:t},yT=n(gT);function vT(e){function t(e,s,n,r){let i=e[r++];if("__proto__"===i)return!0;const a=Number.isFinite(+i),o=r>=e.length;return i=!i&&oE.isArray(n)?n.length:i,o?(oE.hasOwnProp(n,i)?n[i]=[n[i],s]:n[i]=s,!a):(n[i]&&oE.isObject(n[i])||(n[i]=[]),t(e,s,n[i],r)&&oE.isArray(n[i])&&(n[i]=function(e){const t={},s=Object.keys(e);let n;const r=s.length;let i;for(n=0;n<r;n++)i=s[n],t[i]=e[i];return t}(n[i])),!a)}if(oE.isFormData(e)&&oE.isFunction(e.entries)){const s={};return oE.forEachEntry(e,(e,n)=>{t(function(e){return yT(oE).call(oE,/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,s,0)}),s}return null}const xT={transitional:bE,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,r=oE.isObject(e);if(r&&oE.isHTMLForm(e)&&(e=new FormData(e)),oE.isFormData(e))return n?JSON.stringify(vT(e)):e;if(oE.isArrayBuffer(e)||oE.isBuffer(e)||oE.isStream(e)||oE.isFile(e)||oE.isBlob(e)||oE.isReadableStream(e))return e;if(oE.isArrayBufferView(e))return e.buffer;if(oE.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return fE(e,new ES.classes.URLSearchParams,Object.assign({visitor:function(e,t,s,n){return ES.isNode&&oE.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=oE.isFileList(e))||s.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return fE(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),function(e,t,s){if(oE.isString(e))try{return(t||JSON.parse)(e),jx(oE).call(oE,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||xT.transitional,s=t&&t.forcedJSONParsing,n="json"===this.responseType;if(oE.isResponse(e)||oE.isReadableStream(e))return e;if(e&&oE.isString(e)&&(s&&!this.responseType||n)){const s=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(s){if("SyntaxError"===e.name)throw cE.from(e,cE.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ES.classes.FormData,Blob:ES.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};oE.forEach(["delete","get","head","post","put","patch"],e=>{xT.headers[e]={}});var _T=xT;const ET=oE.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bT=Symbol("internals");function wT(e){var t;return e&&jx(t=String(e)).call(t).toLowerCase()}function NT(e){return!1===e||null==e?e:oE.isArray(e)?e.map(NT):String(e)}function ST(e,t,s,n,r){return oE.isFunction(n)?n.call(this,t,s):(r&&(t=s),oE.isString(t)?oE.isString(n)?-1!==t.indexOf(n):oE.isRegExp(n)?n.test(t):void 0:void 0)}class TT{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function r(e,t,s){const r=wT(t);if(!r)throw new Error("header name must be a non-empty string");const i=oE.findKey(n,r);(!i||void 0===n[i]||!0===s||void 0===s&&!1!==n[i])&&(n[i||t]=NT(e))}const i=(e,t)=>oE.forEach(e,(e,s)=>r(e,s,t));if(oE.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(oE.isString(e)&&(e=jx(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(jx(a=e).call(a)))i((e=>{const t={};let s,n,r;return e&&e.split("\n").forEach(function(e){var i,a;r=e.indexOf(":"),s=jx(i=e.substring(0,r)).call(i).toLowerCase(),n=jx(a=e.substring(r+1)).call(a),!s||t[s]&&ET[s]||("set-cookie"===s?t[s]?t[s].push(n):t[s]=[n]:t[s]=t[s]?t[s]+", "+n:n)}),t})(e),t);else if(oE.isObject(e)&&oE.isIterable(e)){let s,n,r={};for(const t of e){if(!oE.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[n=t[0]]=(s=r[n])?oE.isArray(s)?[...s,t[1]]:[s,t[1]]:t[1]}i(r,t)}else null!=e&&r(t,e,s);var a;return this}get(e,t){if(e=wT(e)){const s=oE.findKey(this,e);if(s){const e=this[s];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(e);)t[n[1]]=n[2];return t}(e);if(oE.isFunction(t))return t.call(this,e,s);if(oE.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=wT(e)){const s=oE.findKey(this,e);return!(!s||void 0===this[s]||t&&!ST(0,this[s],s,t))}return!1}delete(e,t){const s=this;let n=!1;function r(e){if(e=wT(e)){const r=oE.findKey(s,e);!r||t&&!ST(0,s[r],r,t)||(delete s[r],n=!0)}}return oE.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const r=t[s];e&&!ST(0,this[r],r,e,!0)||(delete this[r],n=!0)}return n}normalize(e){const t=this,s={};return oE.forEach(this,(n,r)=>{var i;const a=oE.findKey(s,r);if(a)return t[a]=NT(n),void delete t[r];const o=e?function(e){return jx(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}(r):jx(i=String(r)).call(i);o!==r&&delete t[r],t[o]=NT(n),s[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return oE.forEach(this,(s,n)=>{null!=s&&!1!==s&&(t[n]=e&&oE.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,s]=e;return t+": "+s}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];return n.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[bT]=this[bT]={accessors:{}}).accessors,s=this.prototype;function n(e){const n=wT(e);t[n]||(function(e,t){const s=oE.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+s,{value:function(e,s,r){return this[n].call(this,t,e,s,r)},configurable:!0})})}(s,e),t[n]=!0)}return oE.isArray(e)?e.forEach(n):n(e),this}}TT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),oE.reduceDescriptors(TT.prototype,(e,t)=>{let{value:s}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(e){this[n]=e}}}),oE.freezeMethods(TT);var CT=TT;function RT(e,t){const s=this||_T,n=t||s,r=CT.from(n.headers);let i=n.data;return oE.forEach(e,function(e){i=e.call(s,i,r.normalize(),t?t.status:void 0)}),r.normalize(),i}function IT(e){return!(!e||!e.__CANCEL__)}function AT(e,t,s){cE.call(this,null==e?"canceled":e,cE.ERR_CANCELED,t,s),this.name="CanceledError"}function OT(e,t,s){const n=s.config.validateStatus;s.status&&n&&!n(s.status)?t(new cE("Request failed with status code "+s.status,[cE.ERR_BAD_REQUEST,cE.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}oE.inherits(AT,cE,{__CANCEL__:!0});const jT=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const r=function(e,t){e=e||10;const s=new Array(e),n=new Array(e);let r,i=0,a=0;return t=void 0!==t?t:1e3,function(o){const c=Date.now(),l=n[a];r||(r=c),s[i]=o,n[i]=c;let d=a,u=0;for(;d!==i;)u+=s[d++],d%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),c-r<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let s,n,r=0,i=1e3/t;const a=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();r=i,s=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-r;for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];t>=i?a(c,e):(s=c,n||(n=setTimeout(()=>{n=null,a(s)},i-t)))},()=>s&&a(s)]}(s=>{const i=s.loaded,a=s.lengthComputable?s.total:void 0,o=i-n,c=r(o);n=i,e({loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&i<=a?(a-i)/c:void 0,event:s,lengthComputable:null!=a,[t?"download":"upload"]:!0})},s)},kT=(e,t)=>{const s=null!=e;return[n=>t[0]({lengthComputable:s,total:e,loaded:n}),t[1]]},DT=e=>function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return oE.asap(()=>e(...s))};var PT=ES.hasStandardBrowserEnv?((e,t)=>s=>(s=new Ev(s,ES.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new Ev(ES.origin),ES.navigator&&/(msie|trident)/i.test(ES.navigator.userAgent)):()=>!0,LT=ES.hasStandardBrowserEnv?{write(e,t,s,n,r,i){const a=[e+"="+encodeURIComponent(t)];oE.isNumber(s)&&a.push("expires="+new Date(s).toGMTString()),oE.isString(n)&&a.push("path="+n),oE.isString(r)&&a.push("domain="+r),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function MT(e,t,s){let n=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(n||0==s)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function UT(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}const VT=e=>e instanceof CT?function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?UT(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):UT(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},e):e;function FT(e,t){t=t||{};const s={};function n(e,t,s,n){return oE.isPlainObject(e)&&oE.isPlainObject(t)?oE.merge.call({caseless:n},e,t):oE.isPlainObject(t)?oE.merge({},t):oE.isArray(t)?t.slice():t}function r(e,t,s,r){return oE.isUndefined(t)?oE.isUndefined(e)?void 0:n(void 0,e,0,r):n(e,t,0,r)}function i(e,t){if(!oE.isUndefined(t))return n(void 0,t)}function a(e,t){return oE.isUndefined(t)?oE.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(s,r,i){return i in t?n(s,r):i in e?n(void 0,s):void 0}const c={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,s)=>r(VT(e),VT(t),0,!0)};return oE.forEach(Object.keys(Object.assign({},e,t)),function(n){const i=c[n]||r,a=i(e[n],t[n],n);oE.isUndefined(a)&&i!==o||(s[n]=a)}),s}var BT=e=>{const t=FT({},e);let s,{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:a,headers:o,auth:c}=t;if(t.headers=o=CT.from(o),t.url=_E(MT(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),oE.isFormData(n))if(ES.hasStandardBrowserEnv||ES.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(s=o.getContentType())){const[e,...t]=s?s.split(";").map(e=>jx(e).call(e)).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(ES.hasStandardBrowserEnv&&(r&&oE.isFunction(r)&&(r=r(t)),r||!1!==r&&PT(t.url))){const e=i&&a&&LT.read(a);e&&o.set(i,e)}return t},GT="undefined"!=typeof XMLHttpRequest&&function(e){return new sp(function(t,s){const n=BT(e);let r=n.data;const i=CT.from(n.headers).normalize();let a,o,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){l&&l(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}let f=new XMLHttpRequest;function g(){if(!f)return;const n=CT.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());OT(function(e){t(e),m()},function(e){s(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(s(new cE("Request aborted",cE.ECONNABORTED,e,f)),f=null)},f.onerror=function(){s(new cE("Network Error",cE.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const r=n.transitional||bE;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),s(new cE(t,r.clarifyTimeoutError?cE.ETIMEDOUT:cE.ECONNABORTED,e,f)),f=null},void 0===r&&i.setContentType(null),"setRequestHeader"in f&&oE.forEach(i.toJSON(),function(e,t){f.setRequestHeader(t,e)}),oE.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([c,d]=jT(p,!0),f.addEventListener("progress",c)),h&&f.upload&&([o,l]=jT(h),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",l)),(n.cancelToken||n.signal)&&(a=t=>{f&&(s(!t||t.type?new AT(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const y=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);y&&-1===ES.protocols.indexOf(y)?s(new cE("Unsupported protocol "+y+":",cE.ERR_BAD_REQUEST,e)):f.send(r||null)})},WT=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let s,n=new AbortController;const r=function(e){if(!s){s=!0,a();const t=e instanceof Error?e:this.reason;n.abort(t instanceof cE?t:new AT(t instanceof Error?t.message:t))}};let i=t&&setTimeout(()=>{i=null,r(new cE("timeout ".concat(t," of ms exceeded"),cE.ETIMEDOUT))},t);const a=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));const{signal:o}=n;return o.unsubscribe=()=>oE.asap(a),o}},HT=n(tp),KT=cb.f("asyncIterator"),zT=n(KT);function qT(e,t){this.v=e,this.k=t}function YT(e){return function(){return new XT(e.apply(this,arguments))}}function XT(e){var t,s;function n(t,s){try{var i=e[t](s),a=i.value,o=a instanceof qT;HT.resolve(o?a.v:a).then(function(s){if(o){var c="return"===t?"return":"next";if(!a.k||s.done)return n(c,s);s=e[c](s).value}r(i.done?"return":"normal",s)},function(e){n("throw",e)})}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?n(t.key,t.arg):s=null}this._invoke=function(e,r){return new HT(function(i,a){var o={key:e,arg:r,resolve:i,reject:a,next:null};s?s=s.next=o:(t=s=o,n(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}function JT(e){return new qT(e,0)}function QT(e){var t={},s=!1;function n(t,n){return s=!0,n=new HT(function(s){s(e[t](n))}),{done:!1,value:new qT(n,1)}}return t[void 0!==aS&&oS||"@@iterator"]=function(){return this},t.next=function(e){return s?(s=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(s)throw s=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return s?(s=!1,e):n("return",e)}),t}XT.prototype["function"==typeof aS&&zT||"@@asyncIterator"]=function(){return this},XT.prototype.next=function(e){return this._invoke("next",e)},XT.prototype.throw=function(e){return this._invoke("throw",e)},XT.prototype.return=function(e){return this._invoke("return",e)};var ZT=n(KT);function $T(e){var t,s,n,r=2;for("undefined"!=typeof Symbol&&(s=ZT,n=Symbol.iterator);r--;){if(s&&null!=(t=e[s]))return t.call(e);if(n&&null!=(t=e[n]))return new eC(t.call(e));s="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function eC(e){function t(e){if(Object(e)!==e)return sp.reject(new TypeError(e+" is not an object."));var t=e.done;return sp.resolve(e.value).then(function(e){return{value:e,done:t}})}return eC=function(e){this.s=e,this.n=e.next},eC.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var s=this.s.return;return void 0===s?sp.resolve({value:e,done:!0}):t(s.apply(this.s,arguments))},throw:function(e){var s=this.s.return;return void 0===s?sp.reject(e):t(s.apply(this.s,arguments))}},new eC(e)}const tC=function*(e,t){let s=e.byteLength;if(!t||s<t)return void(yield e);let n,r=0;for(;r<s;)n=r+t,yield e.slice(r,n),r=n},sC=function(){var e=YT(function*(e,t){var s,n=!1,r=!1;try{for(var i,a=$T(nC(e));n=!(i=yield JT(a.next())).done;n=!1){const e=i.value;yield*QT($T(tC(e,t)))}}catch(e){r=!0,s=e}finally{try{n&&null!=a.return&&(yield JT(a.return()))}finally{if(r)throw s}}});return function(t,s){return e.apply(this,arguments)}}(),nC=function(){var e=YT(function*(e){if(e[ZT])return void(yield*QT($T(e)));const t=e.getReader();try{for(;;){const{done:e,value:s}=yield JT(t.read());if(e)break;yield s}}finally{yield JT(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),rC=(e,t,s,n)=>{const r=sC(e,t);let i,a=0,o=e=>{i||(i=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await r.next();if(t)return o(),void e.close();let i=n.byteLength;if(s){let e=a+=i;s(e)}e.enqueue(new Uint8Array(n))}catch(e){throw o(e),e}},cancel:e=>(o(e),r.return())},{highWaterMark:2})};function iC(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function aC(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?iC(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):iC(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const oC="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,cC=oC&&"function"==typeof ReadableStream,lC=oC&&("function"==typeof TextEncoder?(dC=new TextEncoder,e=>dC.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var dC;const uC=function(e){try{for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return!!e(...s)}catch(e){return!1}},hC=cC&&uC(()=>{let e=!1;const t=new Request(ES.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),pC=cC&&uC(()=>oE.isReadableStream(new Response("").body)),mC={stream:pC&&(e=>e.body)};var fC;oC&&(fC=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!mC[e]&&(mC[e]=oE.isFunction(fC[e])?t=>t[e]():(t,s)=>{throw new cE("Response type '".concat(e,"' is not supported"),cE.ERR_NOT_SUPPORT,s)})}));const gC=async(e,t)=>{const s=oE.toFiniteNumber(e.getContentLength());return null==s?(async e=>{if(null==e)return 0;if(oE.isBlob(e))return e.size;if(oE.isSpecCompliantForm(e)){const t=new Request(ES.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return oE.isArrayBufferView(e)||oE.isArrayBuffer(e)?e.byteLength:(oE.isURLSearchParams(e)&&(e+=""),oE.isString(e)?(await lC(e)).byteLength:void 0)})(t):s};var yC=oC&&(async e=>{let{url:t,method:s,data:n,signal:r,cancelToken:i,timeout:a,onDownloadProgress:o,onUploadProgress:c,responseType:l,headers:d,withCredentials:u="same-origin",fetchOptions:h}=BT(e);l=l?(l+"").toLowerCase():"text";let p,m=WT([r,i&&i.toAbortSignal()],a);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(c&&hC&&"get"!==s&&"head"!==s&&0!==(g=await gC(d,n))){let e,s=new Request(t,{method:"POST",body:n,duplex:"half"});if(oE.isFormData(n)&&(e=s.headers.get("content-type"))&&d.setContentType(e),s.body){const[e,t]=kT(g,jT(DT(c)));n=rC(s.body,65536,e,t)}}oE.isString(u)||(u=u?"include":"omit");const r="credentials"in Request.prototype;p=new Request(t,aC(aC({},h),{},{signal:m,method:s.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:r?u:void 0}));let i=await fetch(p);const a=pC&&("stream"===l||"response"===l);if(pC&&(o||a&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=i[t]});const t=oE.toFiniteNumber(i.headers.get("content-length")),[s,n]=o&&kT(t,jT(DT(o),!0))||[];i=new Response(rC(i.body,65536,s,()=>{n&&n(),f&&f()}),e)}l=l||"text";let y=await mC[oE.findKey(mC,l)||"text"](i,e);return!a&&f&&f(),await new sp((t,s)=>{OT(t,s,{data:y,headers:CT.from(i.headers),status:i.status,statusText:i.statusText,config:e,request:p})})}catch(t){if(f&&f(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new cE("Network Error",cE.ERR_NETWORK,e,p),{cause:t.cause||t});throw cE.from(t,t&&t.code,e,p)}});const vC={http:null,xhr:GT,fetch:yC};oE.forEach(vC,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const xC=e=>"- ".concat(e),_C=e=>oE.isFunction(e)||null===e||!1===e;var EC={getAdapter:e=>{e=oE.isArray(e)?e:[e];const{length:t}=e;let s,n;const r={};for(let i=0;i<t;i++){let t;if(s=e[i],n=s,!_C(s)&&(n=vC[(t=String(s)).toLowerCase()],void 0===n))throw new cE("Unknown adapter '".concat(t,"'"));if(n)break;r[t||"#"+i]=n}if(!n){const e=Object.entries(r).map(e=>{let[t,s]=e;return"adapter ".concat(t," ")+(!1===s?"is not supported by the environment":"is not available in the build")});throw new cE("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(xC).join("\n"):" "+xC(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:vC};function bC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new AT(null,e)}function wC(e){return bC(e),e.headers=CT.from(e.headers),e.data=RT.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),EC.getAdapter(e.adapter||_T.adapter)(e).then(function(t){return bC(e),t.data=RT.call(e,e.transformResponse,t),t.headers=CT.from(t.headers),t},function(t){return IT(t)||(bC(e),t&&t.response&&(t.response.data=RT.call(e,e.transformResponse,t.response),t.response.headers=CT.from(t.response.headers))),sp.reject(t)})}const NC="1.9.0",SC={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{SC[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const TC={};SC.transitional=function(e,t,s){function n(e,t){return"[Axios v"+NC+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}return(s,r,i)=>{if(!1===e)throw new cE(n(r," has been removed"+(t?" in "+t:"")),cE.ERR_DEPRECATED);return t&&!TC[r]&&(TC[r]=!0,console.warn(n(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,r,i)}},SC.spelling=function(e){return(t,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};var CC={assertOptions:function(e,t,s){if("object"!=typeof e)throw new cE("options must be an object",cE.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let r=n.length;for(;r-- >0;){const i=n[r],a=t[i];if(a){const t=e[i],s=void 0===t||a(t,i,e);if(!0!==s)throw new cE("option "+i+" must be "+s,cE.ERR_BAD_OPTION_VALUE)}else if(!0!==s)throw new cE("Unknown option "+i,cE.ERR_BAD_OPTION)}},validators:SC};const RC=CC.validators;let IC=class{constructor(e){this.defaults=e||{},this.interceptors={request:new EE,response:new EE}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const s=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?s&&!String(e.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+s):e.stack=s}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=FT(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:r}=t;void 0!==s&&CC.assertOptions(s,{silentJSONParsing:RC.transitional(RC.boolean),forcedJSONParsing:RC.transitional(RC.boolean),clarifyTimeoutError:RC.transitional(RC.boolean)},!1),null!=n&&(oE.isFunction(n)?t.paramsSerializer={serialize:n}:CC.assertOptions(n,{encode:RC.function,serialize:RC.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),CC.assertOptions(t,{baseUrl:RC.spelling("baseURL"),withXsrfToken:RC.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=r&&oE.merge(r.common,r[t.method]);r&&oE.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),t.headers=CT.concat(i,r);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const c=[];let l;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let d,u=0;if(!o){const e=[wC.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),d=e.length,l=sp.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=a.length;let h=t;for(u=0;u<d;){const t=a[u++],s=a[u++];try{h=t(h)}catch(e){s.call(this,e);break}}try{l=wC.call(this,h)}catch(e){return sp.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return _E(MT((e=FT(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};oE.forEach(["delete","get","head","options"],function(e){IC.prototype[e]=function(t,s){return this.request(FT(s||{},{method:e,url:t,data:(s||{}).data}))}}),oE.forEach(["post","put","patch"],function(e){function t(t){return function(s,n,r){return this.request(FT(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:n}))}}IC.prototype[e]=t(),IC.prototype[e+"Form"]=t(!0)});var AC=IC;class OC{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new sp(function(e){t=e});const s=this;this.promise.then(e=>{if(!s._listeners)return;let t=s._listeners.length;for(;t-- >0;)s._listeners[t](e);s._listeners=null}),this.promise.then=e=>{let t;const n=new sp(e=>{s.subscribe(e),t=e}).then(e);return n.cancel=function(){s.unsubscribe(t)},n},e(function(e,n,r){s.reason||(s.reason=new AT(e,n,r),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new OC(function(t){e=t}),cancel:e}}}var jC=OC;const kC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kC).forEach(e=>{let[t,s]=e;kC[s]=t});var DC=kC;const PC=function e(t){const s=new AC(t),n=v_(AC.prototype.request,s);return oE.extend(n,AC.prototype,s,{allOwnKeys:!0}),oE.extend(n,s,null,{allOwnKeys:!0}),n.create=function(s){return e(FT(t,s))},n}(_T);PC.Axios=AC,PC.CanceledError=AT,PC.CancelToken=jC,PC.isCancel=IT,PC.VERSION=NC,PC.toFormData=fE,PC.AxiosError=cE,PC.Cancel=PC.CanceledError,PC.all=function(e){return sp.all(e)},PC.spread=function(e){return function(t){return e.apply(null,t)}},PC.isAxiosError=function(e){return oE.isObject(e)&&!0===e.isAxiosError},PC.mergeConfig=FT,PC.AxiosHeaders=CT,PC.formToJSON=e=>vT(oE.isHTMLForm(e)?new FormData(e):e),PC.getAdapter=EC.getAdapter,PC.HttpStatusCode=DC,PC.default=PC;var LC=PC;const MC=()=>{};function UC(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:MC};return e.promise=new sp((t,s)=>{e.resolve=s=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(s),e.value=s)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,s(t))}}),e}const VC=new Map,FC=new Map,BC=new Map;let GC=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),WC=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const HC=new Xx;let KC=HC.getResult(),zC=null;function qC(e){if(!zC){e&&HC.setUA(e),KC=HC.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return WC.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return WC.CHROME;case"Safari":case"Mobile Safari":return WC.SAFARI;case"Edge":return WC.EDGE;case"Firefox":return WC.FIREFOX;case"QQ":case"QQBrowser":return WC.QQ;case"Opera":return WC.OPERA;case"WeChat":return WC.WECHAT;default:return e.browser.name||""}}(KC),s=YC(KC),n=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(KC),r=KC.os.version,i=YC(KC,!1),a=KC.device.type;if(!(t&&s&&n&&r))return{name:t,version:s,os:n,osVersion:r,browserVersion:i,deviceType:a};zC={name:t,version:s,os:n,osVersion:r,browserVersion:i,deviceType:a}}return zC}function YC(e){let t,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",s?t.split(".")[0]:t}function XC(){return qC().os}function JC(){const e=qC();return"".concat(e.os," ").concat(e.osVersion)}function QC(){const e=qC();return!!("WebKit"===KC.engine.name&&e.os===GC.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==WC.SAFARI||nR()&&e.name!==WC.SAFARI)}function ZC(){return qC().name===WC.CHROME}function $C(){return qC().name===WC.SAFARI}function eR(){const e=qC();if(e.name!==WC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}function tR(){return qC().name===WC.EDGE}function sR(){return qC().name===WC.FIREFOX}function nR(){return qC().os===GC.IOS}function rR(e){const t=qC();return!(t.name!==WC.CHROME||!t.osVersion)&&Number(t.version)>=e}function iR(e){const t=qC();return!(t.name!==WC.CHROME||!t.osVersion)&&Number(t.version)<e}function aR(e,t,s){const n=qC();return!(n.name!==e||!n.osVersion)&&(s?Number(n.version)>=t&&Number(n.version)<=s:Number(n.version)===t)}function oR(e){const t=qC();return!(t.name!==WC.EDGE||!t.osVersion)&&Number(t.version)>=e}function cR(e){const t=qC();return!(t.name!==WC.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function lR(e){const t=qC();return!(t.name!==WC.SAFARI||!t.osVersion)&&Number(t.version)>=e}function dR(e,t,s){const n=qC();if(n.os!==GC.IOS||!n.osVersion)return!1;const r=n.osVersion.split(".");return s?t&&Number(r[0])===e&&Number(r[1])>t||Number(r[0])>e:t?Number(r[0])===e&&Number(r[1])>=t||Number(r[0])>e:Number(r[0])>=e}function uR(e,t,s){const n=qC();if(n.os!==GC.IOS||!n.osVersion)return!1;const r=n.osVersion.split(".");return s?t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e:t?Number(r[0])===e&&Number(r[1])<=t||Number(r[0])<e:Number(r[0])<=e}function hR(e,t,s){const n=qC();if(n.name!==WC.SAFARI||!n.osVersion||!n.browserVersion)return!1;const r=n.browserVersion.split(".");return s?t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e:t?Number(r[0])===e&&Number(r[1])<=t||Number(r[0])<e:Number(r[0])<=e}function pR(e){const t=qC();return!(t.name!==WC.OPERA||!t.osVersion)&&Number(t.version)>=e}function mR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function fR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function gR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function yR(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function vR(){return $C()&&navigator.maxTouchPoints>0}function xR(){return qC().name===WC.WECHAT}function _R(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ER(){const e=XC();return function(){const{deviceType:e}=qC();return"mobile"===e||"tablet"===e}()||e===GC.ANDROID||e===GC.IOS||e===GC.HARMONY_OS}function bR(){const e=qC();return e.name!==WC.EDGE&&e.name!==WC.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function wR(){return XC()===GC.ANDROID}function NR(){const e=qC();return wR()&&(e.name===WC.CHROME||e.name===WC.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function SR(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function TR(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function CR(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?TR(Object(s),!0).forEach(function(t){SR(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):TR(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let RR=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),IR=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(t),SR(this,"code",void 0),SR(this,"message",void 0),SR(this,"data",void 0),SR(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=s}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function AR(e,t){if("boolean"!=typeof e)throw new IR(RR.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function OR(e,t,s){if(!Dn(s).call(s,e))throw new IR(RR.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(s)))}function jR(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<s||e>n||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new IR(RR.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(s,", ").concat(n,"]. integer only"))}function kR(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new IR(RR.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&jR(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&jR(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&jR(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&jR(e.ideal,"".concat(t,".ideal"),1,1/0)}else jR(e,t,1,1/0)}function DR(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new IR(RR.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!MR(e,s,n,r))throw new IR(RR.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(s,",").concat(n,"].").concat(r?" ASCII characters only.":""))}function PR(e,t){if(!Array.isArray(e))throw new IR(RR.INVALID_PARAMS,"".concat(t," should be an array"))}function LR(e){return null==e}function MR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=s&&e.length>=t&&(!n||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const s=e.charCodeAt(t);if(s<0||s>255)return!1}return!0}(e))}var UR=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(UR||{}),VR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(VR||{});const FR=new class{constructor(){SR(this,"_clientSize",null),SR(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),SR(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),SR(this,"getStyle",e=>window.getComputedStyle(e,null)),SR(this,"checkCssVisibleProperty",e=>{var t;let s=!0;const n=this.getStyle(e),{display:r,visibility:i,opacity:a,filter:o}=n;return("none"===r||Dn(t=["hidden","collapse"]).call(t,i)||Number(a)<.1)&&(s=!1),!!s&&(o&&o.split(" ").filter(e=>{var t;const s=e.split("(")[0];return Dn(t=["brightness","blur","opacity"]).call(t,s)}).map(e=>{const[t,s]=e.split(/\(|\)/);return[t,Number(s.match(/^[0-9\.]+/))]}).forEach(e=>{const[t,n]=e;switch(t){case"brightness":(n<.1||n>3)&&(s=!1);break;case"blur":n>3&&(s=!1);break;case"opacity":n<.1&&(s=!1)}}),s)}),SR(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let s=!0,n=!0;const r=e=>t(e);let i=e;for(;i&&n;)r(i)||(s=!1,n=!1),i=i.parentElement,i||(n=!1);return s}),SR(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),SR(this,"getSizeAboutClient",e=>{const{width:t,height:s,left:n,right:r,top:i,bottom:a}=e.getBoundingClientRect(),o=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:s,left:n,right:r,top:i,bottom:a,clientWidth:o,clientHeight:c,clientMin:Math.min(o,c)}}),SR(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(e,t,s)}),SR(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),SR(this,"checkCoverForAPoint",(e,t,s)=>{const n=this.elementFromPoint(e,t);return null!==n&&n!==s}),SR(this,"getPointPositionList",()=>{const{width:e,height:t,left:s,top:n}=this._clientSize,r=e/6,i=t/6,a=[],o=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(s*o+(0===c?.1:4===c?(r*c*o-1e5)/o:r*c)*o)/o,l=(n*o+(0===e?.1:4===e?(i*e*o-1e5)/o:i*e)*o)/o;a.push({x:t,y:l})}return[...a]}),SR(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(e=>!!e).length>6),SR(this,"checkSizeIsVisible",(e,t,s)=>(e>50||s/e<=10)&&(t>50||s/t<=10)),SR(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:s,bottom:n,clientHeight:r,clientWidth:i,clientMin:a}=this._clientSize;let o,c,l,d;if(e<0)o=0;else{if(!(e<i))return!1;o=e}if(t<0)return!1;if(c=t<i?t:i,s<0)l=0;else{if(!(s<r))return!1;l=s}if(n<0)return!1;d=n<r?n:r;const u=c-o,h=d-l;return this.checkSizeIsVisible(u,h,a)}),SR(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),SR(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(UR.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(UR.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(UR.SIZE)}}return this.returnHiddenResult(UR.STYLE)}return this.returnHiddenResult(VR.UNMOUNTED)}return this.returnHiddenResult(VR.INVALID_HTML_ELEMENT)}),SR(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))}};function BR(e){return(new TextEncoder).encode(e)}const GR=function(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s},WR=async e=>function(e,t){let s="";return new Uint8Array(e).forEach(e=>{s+=e.toString(t).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",BR(e)),16);class HR{constructor(){SR(this,"_events",{}),SR(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const s=this._events[e];-1===this._indexOfListener(s,t)&&s.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const s=this._events[e];-1===this._indexOfListener(s,t)&&s.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const s=this._events[e],n=this._indexOfListener(s,t);-1!==n&&s.splice(n,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(e=>e);for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];for(let i=0;i<t.length;i+=1){const s=t[i];s.once&&this.off(e,s.listener),s.listener.apply(this,n||[])}}safeEmit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];[...this._events[e]||[]].forEach(t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,s)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}})}_indexOfListener(e,t){let s=e.length;for(;s--;)if(e[s].listener===t)return s;return-1}}let KR=null;function zR(){if(KR)return KR;if(window.electron)return KR=window.electron;if(!window.require)return null;try{return KR=window.require("electron"),KR}catch(e){return null}}let qR=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),YR=function(e){return e.TRACER="tracer",e}({});function XR(e){return jR(e.timeout,"config.timeout",0,1e5),jR(e.timeoutFactor,"config.timeoutFactor",0,100,!1),jR(e.maxRetryCount,"config.maxRetryConfig",0,1/0),jR(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let JR=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),QR=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ZR(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(e=>{if(!e.urls)throw Error()})}catch(e){return!1}return!0}function $R(e){return DR(e.turnServerURL,"turnServerURL"),DR(e.username,"username"),DR(e.password,"password"),e.udpport&&jR(e.udpport,"udpport",1,99999,!0),e.forceturn&&AR(e.forceturn,"forceturn"),e.security&&AR(e.security,"security"),e.tcpport&&jR(e.tcpport,"tcpport",1,99999,!0),!0}function eI(e){return void 0!==e.level&&OR(e.level,"level",[1,2,3]),void 0!==e.delay&&jR(e.delay,"delay",0,3e3,!0),!0}let tI=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),sI=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),nI=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),rI=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function iI(e,t){for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];return 0===e.getListeners(t).length?sp.reject(new IR(RR.UNEXPECTED_ERROR,"can not emit promise")):new sp((s,r)=>{e.emit(t,...n,s,r)})}function aI(e,t){if(0===e.getListeners(t).length)return sp.resolve();for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];return iI(e,t,...n)}function oI(e,t){if(0===e.getListeners(t).length)return null;for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];return cI(e,t,...n)}function cI(e,t){let s=null,n=null;for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if(e.emit(t,...i,e=>{s=e},e=>{n=e}),null!==n)throw n;if(null===s)throw new IR(RR.UNEXPECTED_ERROR,"handler is not sync");return s}const lI=new class extends HR{set networkState(e){this.emit(rI.NETWORK_STATE_CHANGE,e,this._networkState),e===nI.ONLINE?this.emit(rI.ONLINE):e===nI.OFFLINE&&(this.onlineWaiter=new sp(e=>{this.once(rI.ONLINE,()=>{this.onlineWaiter=void 0,e(nI.ONLINE)})}),this.emit(rI.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===nI.ONLINE}constructor(){super(),SR(this,"_moduleName","network-indicator"),SR(this,"_networkState",nI.ONLINE),SR(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=nI.ONLINE}),window.addEventListener("offline",()=>{this.networkState=nI.OFFLINE})}};function dI(e,t){const s=e.indexOf(t);-1!==s&&e.splice(s,1)}function uI(e){const t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function hI(e){void 0!==sp?sp.resolve().then(e):setTimeout(e,0)}function pI(e){return JSON.parse(JSON.stringify(e))}function mI(e){try{return pI(e)}catch(t){return e}}const fI={};function gI(e,t){fI[t]||(fI[t]=!0,e())}function yI(e){const t=window.atob(e),s=new Uint8Array(new ArrayBuffer(t.length));for(let n=0;n<t.length;n+=1)s[n]=t.charCodeAt(n);return s}function vI(e){let t="";for(let s=0;s<e.length;s+=1)t+=String.fromCharCode(e[s]);return window.btoa(t)}function xI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,s=(new TextEncoder).encode(e);if(s.length>t)s=s.slice(0,t);else if(s.length<t){const e=new Uint8Array(t);e.set(s),s=e}return s}function _I(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=rr(t).call(t,(e,t)=>e+t.length,0),r=new Uint8Array(new ArrayBuffer(n));let i=0;return t.forEach(e=>{r.set(e,i),i+=e.length}),r}function EI(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function bI(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(e=>{t+="string"==typeof e?EI(e):e.size}),t+138}function wI(e){const t=new IR(RR.TIMEOUT,"timeout");return new sp((s,n)=>{window.setTimeout(()=>n(t),e)})}function NI(e){return new sp(t=>{window.setTimeout(t,e)})}function SI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,e).toLowerCase();return s.length===e?"".concat(t).concat(s):"".concat(t).concat(s)+SI(e-s.length,"")}function TI(){return SI(32,"").toUpperCase()}const CI=()=>{},RI=new class{constructor(){SR(this,"fnMap",new Map)}throttleByKey(e,t,s,n){for(var r=arguments.length,i=new Array(r>4?r-4:0),a=4;a<r;a++)i[a-4]=arguments[a];if(this.fnMap.has(t)){const r=this.fnMap.get(t);if(r.threshold!==s){r.fn(...r.args),clearTimeout(r.timer);const a=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:a,args:i,skipFn:n})}else r.skipFn&&r.skipFn(...r.args),this.fnMap.set(t,CR(CR({},r),{},{fn:e,args:i,skipFn:n}))}else{const r=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:r,args:i,skipFn:n})}}},II=RI.throttleByKey.bind(RI);function AI(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function OI(e,t){if(!AI(e)||!AI(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const s=[...e];for(let n=0;n<t.length;n++)s[n]=OI(e[n],t[n]);return s}{const s=CR({},e);for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)?s[n]=OI(e[n],t[n]):s[n]=t[n]);return s}}function jI(e,t){let s=[0];if(t&&(s=new Array(t).fill(0)),0===e)return s;let n=0;for(;e>0&&(s[n]=255&e,e>>=8,n++,!t||n!==t););return s}function kI(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function DI(e){return rr(e).call(e,(e,t)=>e+t,0)}function PI(e){const t="0123456789abcdef";function s(e){let s,n="";for(s=0;s<=3;s++)n+=t.charAt(e>>8*s+4&15)+t.charAt(e>>8*s&15);return n}function n(e,t){const s=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(s>>16)<<16|65535&s}function r(e,t,s,r,i,a){return n(function(e,t){return e<<t|e>>>32-t}(n(n(t,e),n(r,a)),i),s)}function i(e,t,s,n,i,a,o){return r(t&s|~t&n,e,t,i,a,o)}function a(e,t,s,n,i,a,o){return r(t&n|s&~n,e,t,i,a,o)}function o(e,t,s,n,i,a,o){return r(t^s^n,e,t,i,a,o)}function c(e,t,s,n,i,a,o){return r(s^(t|~n),e,t,i,a,o)}const l=function(e){let t;const s=1+(e.length+8>>6),n=new Array(16*s);for(t=0;t<16*s;t++)n[t]=0;for(t=0;t<e.length;t++)n[t>>2]|=e.charCodeAt(t)<<t%4*8;return n[t>>2]|=128<<t%4*8,n[16*s-2]=8*e.length,n}(e);let d,u,h,p,m,f=1732584193,g=-271733879,y=-1732584194,v=271733878;for(d=0;d<l.length;d+=16)u=f,h=g,p=y,m=v,f=i(f,g,y,v,l[d+0],7,-680876936),v=i(v,f,g,y,l[d+1],12,-389564586),y=i(y,v,f,g,l[d+2],17,606105819),g=i(g,y,v,f,l[d+3],22,-1044525330),f=i(f,g,y,v,l[d+4],7,-176418897),v=i(v,f,g,y,l[d+5],12,1200080426),y=i(y,v,f,g,l[d+6],17,-1473231341),g=i(g,y,v,f,l[d+7],22,-45705983),f=i(f,g,y,v,l[d+8],7,1770035416),v=i(v,f,g,y,l[d+9],12,-1958414417),y=i(y,v,f,g,l[d+10],17,-42063),g=i(g,y,v,f,l[d+11],22,-1990404162),f=i(f,g,y,v,l[d+12],7,1804603682),v=i(v,f,g,y,l[d+13],12,-40341101),y=i(y,v,f,g,l[d+14],17,-1502002290),g=i(g,y,v,f,l[d+15],22,1236535329),f=a(f,g,y,v,l[d+1],5,-165796510),v=a(v,f,g,y,l[d+6],9,-1069501632),y=a(y,v,f,g,l[d+11],14,643717713),g=a(g,y,v,f,l[d+0],20,-373897302),f=a(f,g,y,v,l[d+5],5,-701558691),v=a(v,f,g,y,l[d+10],9,38016083),y=a(y,v,f,g,l[d+15],14,-660478335),g=a(g,y,v,f,l[d+4],20,-405537848),f=a(f,g,y,v,l[d+9],5,568446438),v=a(v,f,g,y,l[d+14],9,-1019803690),y=a(y,v,f,g,l[d+3],14,-187363961),g=a(g,y,v,f,l[d+8],20,1163531501),f=a(f,g,y,v,l[d+13],5,-1444681467),v=a(v,f,g,y,l[d+2],9,-51403784),y=a(y,v,f,g,l[d+7],14,1735328473),g=a(g,y,v,f,l[d+12],20,-1926607734),f=o(f,g,y,v,l[d+5],4,-378558),v=o(v,f,g,y,l[d+8],11,-2022574463),y=o(y,v,f,g,l[d+11],16,1839030562),g=o(g,y,v,f,l[d+14],23,-35309556),f=o(f,g,y,v,l[d+1],4,-1530992060),v=o(v,f,g,y,l[d+4],11,1272893353),y=o(y,v,f,g,l[d+7],16,-155497632),g=o(g,y,v,f,l[d+10],23,-1094730640),f=o(f,g,y,v,l[d+13],4,681279174),v=o(v,f,g,y,l[d+0],11,-358537222),y=o(y,v,f,g,l[d+3],16,-722521979),g=o(g,y,v,f,l[d+6],23,76029189),f=o(f,g,y,v,l[d+9],4,-640364487),v=o(v,f,g,y,l[d+12],11,-421815835),y=o(y,v,f,g,l[d+15],16,530742520),g=o(g,y,v,f,l[d+2],23,-995338651),f=c(f,g,y,v,l[d+0],6,-198630844),v=c(v,f,g,y,l[d+7],10,1126891415),y=c(y,v,f,g,l[d+14],15,-1416354905),g=c(g,y,v,f,l[d+5],21,-57434055),f=c(f,g,y,v,l[d+12],6,1700485571),v=c(v,f,g,y,l[d+3],10,-1894986606),y=c(y,v,f,g,l[d+10],15,-1051523),g=c(g,y,v,f,l[d+1],21,-2054922799),f=c(f,g,y,v,l[d+8],6,1873313359),v=c(v,f,g,y,l[d+15],10,-30611744),y=c(y,v,f,g,l[d+6],15,-1560198380),g=c(g,y,v,f,l[d+13],21,1309151649),f=c(f,g,y,v,l[d+4],6,-145523070),v=c(v,f,g,y,l[d+11],10,-1120210379),y=c(y,v,f,g,l[d+2],15,718787259),g=c(g,y,v,f,l[d+9],21,-343485551),f=n(f,u),g=n(g,h),y=n(y,p),v=n(v,m);return s(f)+s(g)+s(y)+s(v)}let LI=1,MI=console,UI=class{static setLogger(e){MI=e}constructor(e,t){SR(this,"id",void 0),SR(this,"lockingPromise",sp.resolve()),SR(this,"locks",0),SR(this,"name",""),SR(this,"lockId",void 0),this.lockId=LI++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),n="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");MI.debug("".concat(s," ").concat(n))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const s=new sp(s=>{t=()=>{this.locks-=1,this.logger("unlocked",e),s()}}),n=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>s),n}};function VI(e,t){return function(s,n,r){const i=r.value;if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){const s=this[t];if(!s)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const r=await s.lock("From ".concat(e,".").concat(n));try{for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return await i.apply(this,o)}finally{r()}},r}}const FI={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function BI(e,t){const s=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,s)}function GI(e,t,s,n){const r=Object.assign({},FI,n);let i=r.timeout;const a=async()=>{await function(e){return new sp(t=>{window.setTimeout(t,e)})}(i),i*=r.timeoutFactor,i=Math.min(r.maxRetryTimeout,i)};let o=!1;const c=new sp(async(n,i)=>{t=t||(()=>!1),s=s||(()=>!0);for(let c=0;c<r.maxRetryCount;c+=1){if(o)return i(new IR(RR.OPERATION_ABORTED));try{const s=await e();if(!t(s,c))return n(s);if(c+1===r.maxRetryCount)return n(s);await a()}catch(e){if(!s(e,c))return i(e);if(c+1===r.maxRetryCount)return i(e);await a()}}});return c.cancel=()=>o=!0,c}let WI,HI=class{constructor(e){SR(this,"input",[]),SR(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:rr(e=this.input).call(e,(e,t)=>e+t)/this.input.length}},KI=0,zI=0;function qI(e,t,s,n){return new sp((r,i)=>{t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),KI+=EI(t.data)):s&&(t.data.size?KI+=t.data.size:t.data instanceof FormData?KI+=bI(t.data):KI+=EI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,LC.request(t).then(e=>{"string"==typeof e.data?zI+=EI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?zI+=e.data.byteLength:zI+=EI(JSON.stringify(e.data)),n&&r({data:e.data,headers:e.headers}),r(e.data)}).catch(e=>{LC.isCancel(e)?i(new IR(RR.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?i(new IR(RR.NETWORK_TIMEOUT,e.message)):e.response?i(new IR(RR.NETWORK_RESPONSE_ERROR,e.response.status)):i(new IR(RR.NETWORK_ERROR,e.message))})})}async function YI(e,t){const s=new Blob([t.data],{type:"buffer"});return await qI(e,CR(CR({},t),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XI=()=>void 0!==window.isSecureContext;function JI(e){if(Array.isArray(e))return e.map(e=>e);if(!QI(e))return e;const t={};for(const s in e){const n=e[s];QI(n)||Array.isArray(n)?t[s]=JI(n):t[s]=n}return t}function QI(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let ZI=class{constructor(e){SR(this,"input",[]),SR(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const $I={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},eA={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:$I,remoteCandidate:$I},updateInterval:0},tA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},sA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},nA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},rA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let iA=class{constructor(e,t){SR(this,"onFirstVideoReceived",void 0),SR(this,"onFirstVideoDecoded",void 0),SR(this,"onFirstAudioReceived",void 0),SR(this,"onFirstVideoDecodedTimeout",void 0),SR(this,"onFirstAudioDecoded",void 0),SR(this,"onSelectedLocalCandidateChanged",void 0),SR(this,"onSelectedRemoteCandidateChanged",void 0),SR(this,"videoIsReady",!1),SR(this,"videoIsReady2",{}),SR(this,"pc",void 0),SR(this,"options",void 0),SR(this,"intervalTimer",void 0),SR(this,"stats",JI(eA)),SR(this,"isFirstVideoReceived",{}),SR(this,"isFirstVideoDecoded",{}),SR(this,"isFirstAudioReceived",{}),SR(this,"isFirstAudioDecoded",{}),SR(this,"isFirstVideoDecodedTimeout",{}),SR(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new sp(e=>{e({local:CR({},$I),remote:CR({},$I)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let n=0,r=0,i=0,a=0;for(const o of s)e[o].forEach((e,s)=>{if(!this.lossRateWindowStats[t-1][o][s]||!this.lossRateWindowStats[0][o][s])return;const c=this.lossRateWindowStats[t-1][o][s].packets-this.lossRateWindowStats[0][o][s].packets,l=this.lossRateWindowStats[t-1][o][s].packetsLost-this.lossRateWindowStats[0][o][s].packetsLost;"videoSend"===o||"audioSend"===o?(n+=c,i+=l):(r+=c,a+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)});e.sendPacketLossRate=n<=0||i<=0?0:i/(n+i),e.recvPacketLossRate=r<=0||a<=0?0:a/(r+a)}},aA=class extends iA{constructor(){super(...arguments),SR(this,"_stats",eA),SR(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=JI(eA);const s=t.filter(e=>"ssrc"===e.type);this.processSSRCStats(s);const n=t.find(e=>"VideoBwe"===e.type);n&&this.processBandwidthStats(n),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(e=>{var t;const s=Dn(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const t=JI(sA);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=JI(tA),s=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),s){const n=s.stats,r=Date.now()-s.lts;t.framesDecodeFreezeTime=n.framesDecodeFreezeTime,t.framesDecodeInterval=n.framesDecodeInterval,t.framesDecodeCount>n.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(s.lts=Date.now(),t.framesDecodeInterval=r,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<s.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CR({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=JI(rA);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=JI(nA);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}})}_getStats(){return new sp((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(e=>{const s={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(t=>{s[t]=e.stat(t)}),t.push(s)}),t}},oA=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),cA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),lA=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),dA=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var uA=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(uA||{});function hA(e,t,s,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:uA.kNone;if(!t)return;const i=Number(t[s]);if("number"!=typeof i)return;const a=Number(t[n]);if("number"!=typeof a)return;if(!e)return a?i/a*r:void 0;const o=Number(e[s]);if("number"!=typeof o)return;const c=Number(e[n]);if("number"!=typeof c)return;const l=a-c;return l?(i-o)/l*r:void 0}let pA=class extends iA{constructor(){super(...arguments),SR(this,"_stats",eA),SR(this,"report",void 0),SR(this,"lastDecodeVideoReceiverStats",new Map),SR(this,"lastVideoFramesRecv",new Map),SR(this,"lastVideoFramesSent",new Map),SR(this,"lastVideoFramesDecode",new Map),SR(this,"lastVideoFramesOutput",new Map),SR(this,"lastVideoJBDelay",new Map),SR(this,"lastAudioJBDelay",new Map),SR(this,"mediaBytesSent",new Map),SR(this,"mediaBytesRetransmit",new Map),SR(this,"mediaBytesTargetEncode",new Map),SR(this,"lastDecodeAudioReceiverStats",new Map),SR(this,"lastAudioConcealment",new Map),SR(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=JI(eA),this.report.forEach(e=>{switch(e.type){case dA.OUTBOUND:case dA.INBOUND:{const t=e.mediaType||e.kind,s=!t&&"frameWidth"in e,n=!t&&!("frameWidth"in e);e.type===dA.OUTBOUND?"audio"===t||n?this.processAudioOutboundStats(e):("video"===t||s)&&this.processVideoOutboundStats(e):e.type===dA.INBOUND&&("audio"===t||n?this.processAudioInboundStats(e):("video"===t||s)&&this.processVideoInboundStats(e));break}case dA.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case dA.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:CR({},$I),remote:CR({},$I)};return e.forEach(s=>{let n;if(s.type===dA.TRANSPORT&&(n=e.get(s.selectedCandidatePairId)),s.type===dA.CANDIDATE_PAIR&&s.selected&&(n=s),n){const s=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(n.localCandidateId){const r=e.get(n.localCandidateId);r&&s(t.local,r)}if(n.remoteCandidateId){const r=e.get(n.remoteCandidateId);r&&s(t.remote,r)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===dA.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===dA.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===dA.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(CR({},t),CR({},this.stats.selectedCandidatePair.localCandidate)),e.type===dA.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(CR({},t),CR({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(t=>t.ssrc===e.ssrc);t||(t=JI(rA),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=hA(s,t,"totalProcessingDelay","jitterBufferEmittedCount",uA.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,s,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,CR({},t))}calculateAudioFreeze(e,t,s){const n=this.lastAudioConcealment.get(e.ssrc);if(null!=t&&null!=n){const r=n.lts,i=s.timestamp,a=i-r;if(a<=0)return;const o=e.concealedSamples-t.concealedSamples-0,c=n.nonSilent+o,l=e.totalSamplesReceived-t.totalSamplesReceived;if(l<=0)return;const d=80*l/a,u=200*l/a,h=a/l;let p=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,c>d&&(n.plc80>0?(e.freezeSamples80+=o,e.freezeMs80+=Math.round(o*h)):(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*h)),p=n.plc80+1);let m=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,c>u&&(n.plc200>0?(e.freezeSamples200+=o,e.freezeMs200+=Math.round(o*h)):(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*h)),m=n.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:o,lts:i,plc80:p,plc200:m})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(t=>t.ssrc===e.ssrc);t||(t=JI(tA),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(t.ssrc),n=this.lastVideoFramesDecode.get(t.ssrc),r=this.lastVideoFramesOutput.get(t.ssrc),i=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,s=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,s),this.isFirstVideoDecoded[t.ssrc]=!0}if(s){const n=s.stats,r=i-s.lts;t.framesDecodeFreezeTime=n.framesDecodeFreezeTime,t.framesDecodeInterval=n.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&r>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>n.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(s.lts=Date.now(),t.framesDecodeInterval=r,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(s.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-s.qpSum)/(e.framesDecoded-s.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=hA(null==s?void 0:s.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=hA(null==s?void 0:s.stats,t,"totalProcessingDelay","framesDecodeCount",uA.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=hA(null==s?void 0:s.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",uA.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=hA(null==s?void 0:s.stats,t,"totalInterFrameDelay","framesDecodeCount",uA.kMillisecondsFromSeconds),n&&i-n.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-n.count)/((i-n.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):n?t.decodeFrameRate=n.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),t.framesDroppedCount&&e.framesReceived&&(r&&i-r.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:i,rate:Math.max(t.outputFrameRate,0)})):r?t.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:i,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:CR({},t),lts:s?s.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(t=>t.ssrc===e.ssrc);t||(t=JI(sA),this._stats.videoSend.push(t));const s=this.mediaBytesSent.get(e.ssrc);if(s)s.add(e.bytesSent);else{const t=new ZI(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new ZI(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new ZI(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const s=this.lastEncoderMs.get(e.ssrc);if(!s||s.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const n=e.framesEncoded-s.lastFrameCount,r=e.totalEncodeTime-s.lastEncoderTime;t.avgEncodeMs=1e3*r/n}}if(e.framesEncoded&&e.qpSum){const s=this.lastEncoderMs.get(e.ssrc);!s||s.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-s.lastQpSum)/(e.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const s=this.findRemoteStatsId(e.ssrc,dA.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(t=>t.ssrc===e.ssrc);if(t||(t=JI(nA),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const s=this.findRemoteStatsId(e.ssrc,dA.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}findRemoteStatsId(e,t){var s;const n=Array.from(up(s=this.report).call(s)).find(s=>s.type===t&&s.ssrc===e);return n?n.id:null}processVideoMediaSource(e,t){const s=this.report.get(e);s&&s.width&&s.height&&s.framesPerSecond&&(t.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(e,t){const s=this.report.get(e);s&&(t.inputLevel=s.audioLevel)}processVideoTrackSenderStats(e,t,s){var n,r,i,a;const o=t?this.report.get(t):void 0,c=null!==(n=null==o?void 0:o.framesSent)&&void 0!==n?n:e.framesSent;if("number"!=typeof c)return;let l=null!==(r=null==o?void 0:o.frameWidth)&&void 0!==r?r:e.frameWidth,d=null!==(i=null==o?void 0:o.frameHeight)&&void 0!==i?i:e.frameHeight,u=null!==(a=null==o?void 0:o.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof l&&"number"==typeof d||(l=0,d=0),null==u){const e=Date.now(),t=this.lastVideoFramesSent.get(s.ssrc);t&&e-t.lts>=800?(u=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:c,lts:e,rate:u})):t?u=t.rate:this.lastVideoFramesSent.set(s.ssrc,{count:c,lts:e,rate:0})}s.sentFrame={width:l,height:d,frameRate:Math.max(0,u)}}processVideoTrackReceiverStats(e,t,s){var n,r,i,a,o;const c=t?this.report.get(t):void 0,l=null!==(n=null==c?void 0:c.framesReceived)&&void 0!==n?n:e.framesReceived,d=null!==(r=null==c?void 0:c.frameWidth)&&void 0!==r?r:e.frameWidth,u=null!==(i=null==c?void 0:c.frameHeight)&&void 0!==i?i:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(o=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(s.ssrc),t=Date.now();s.framesReceivedCount=l;let n=0;e&&t-e.lts>=800?(n=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:l,lts:t,rate:n})):e?n=e.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:l,lts:t,rate:0}),s.receivedFrame={width:d||0,height:u||0,frameRate:n||0},s.decodedFrame={width:d||0,height:u||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:d||0,height:u||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const n=p-e.jitterBufferEmittedCount;n>0&&(t=1e3*(h-e.jitterBufferDelay)/n),s.jitterBufferMs=t,s.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(e,t,s){var n,r,i,a;const o=t?this.report.get(t):void 0,c=null!==(n=null!==(r=null==o?void 0:o.echoReturnLoss)&&void 0!==r?r:e.echoReturnLoss)&&void 0!==n?n:0,l=null!==(i=null!==(a=null==o?void 0:o.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==i?i:0;s.aecReturnLoss=c,s.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,s){var n,r,i,a,o,c,l,d,u;const h=t?this.report.get(t):void 0,p=null!==(n=null==h?void 0:h.removedSamplesForAcceleration)&&void 0!==n?n:e.removedSamplesForAcceleration,m=null!==(r=null==h?void 0:h.totalSamplesReceived)&&void 0!==r?r:e.totalSamplesReceived,f=null!==(i=null==h?void 0:h.jitterBufferDelay)&&void 0!==i?i:e.jitterBufferDelay,g=null!==(a=null==h?void 0:h.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,y=null!==(o=null==h?void 0:h.audioLevel)&&void 0!==o?o:null==e?void 0:e.audioLevel,v=null!==(c=null==h?void 0:h.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,x=null!==(l=null==h?void 0:h.concealedSamples)&&void 0!==l?l:e.concealedSamples,_=null!==(d=null==h?void 0:h.silentConcealedSamples)&&void 0!==d?d:e.silentConcealedSamples,E=null!==(u=null==h?void 0:h.concealmentEvents)&&void 0!==u?u:e.concealmentEvents;if("number"==typeof m&&(s.totalSamplesReceived=m),"number"==typeof _&&(s.silentConcealedSamples=_),"number"==typeof E&&(s.concealmentEvents=E),"number"==typeof x&&(s.concealedSamples=x),p&&m&&(s.accelerateRate=p/m),f&&g){const e=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const n=g-e.jitterBufferEmittedCount;n>0&&(t=1e3*(f-e.jitterBufferDelay)/n),s.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:f,jitterBufferEmittedCount:g,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=y;let b=1920;v&&m&&(b=m/v/50,s.receivedFrames=Math.round(m/b)),x&&(s.droppedFrames=Math.round(x/b))}processRemoteInboundStats(e,t){const s=this.report.get(e);s&&(t.packetsLost=s.packetsLost,s.roundTripTime&&(t.rttMs=1e3*s.roundTripTime),s.jitter&&(t.jitterMs=1e3*s.jitter),s.timestamp&&(t.timestamp=s.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const s=t.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let e=0,t=null,s=null;this.mediaBytesSent.forEach(t=>{e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(e=>{t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(e=>{s=null===s?e.diffMean():s+e.diffMean()});const n=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*n/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==s&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},mA=class extends iA{updateStats(){return sp.resolve()}};function fA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const i=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return i?i<76?new aA(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:n,firstVideoDecodedTimeout:r}):new pA(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:n,firstVideoDecodedTimeout:r}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof sp||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new pA(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:n,firstVideoDecodedTimeout:r}):new mA(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:n,firstVideoDecodedTimeout:r})}const gA="websdk_ng_install_id";function yA(){try{if(RA("INSTALL_ID"))return RA("INSTALL_ID");let e=window.localStorage.getItem(gA);return e||(e=TI(),window.localStorage.setItem(gA,e)),CA("INSTALL_ID",e),e}catch(e){return}}const vA=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],s=t[2];return"".concat(e,".").concat(s)}return"4.0.0.999"}("4.24.0"),xA=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let _A=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const EA=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const n=s.join(""),r=[];for(let o=0;o<6;o++)r.push("1");const i=r.join(""),a={};return a[e]=n,a[t]=i,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=EA;const bA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},wA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},NA="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",SA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},TA=CR(CR(CR(CR({},SA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:wA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},bA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function CA(e,t,s){var n,r,i;Dn(n=Object.keys(TA)).call(n,e)&&(!s&&Dn(r=Object.keys(AA)).call(r,e)||(TA[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS"!==e||!0!==t||(TA.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(i=!!t,TA.USE_NEW_NETWORK_CONFIG=i,i&&(TA.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],TA.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],TA.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],TA.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],TA.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",TA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",TA.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(TA.ENABLE_INSTANT_VIDEO=!0,TA.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(TA.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(TA.NEW_TURN_MODE||(TA.NEW_TURN_MODE=4))))}function RA(e){return TA[e]}xA||(TA.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],TA.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],TA.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],TA.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],TA.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],TA.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],TA.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",TA.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",TA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",TA.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",TA.AREAS=["NORTH_AMERICA","OVERSEA"]);let IA=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const AA={};var OA=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(OA||{});let jA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const kA=128,DA=96,PA=1e3,LA=10;let MA=0;var UA=(()=>{var e={8:(e,t,s)=>{s.r(t),s.d(t,{Parser:()=>b,Printer:()=>C,parse:()=>O,print:()=>j});const n="\n",r="".concat("\r").concat(n),i=" ";let a;function o(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function m(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function f(e){return h(e)||o(e)||"+"===e||"/"===e}function g(e){return o(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function y(e){return h(e)||o(e)||"+"===e||"/"===e}function v(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function x(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?v(Object(s),!0).forEach(function(t){_(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):v(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function _(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));class E{consumeText(e,t){let s=t;for(;s<e.length;){const t=e[s];if("\0"===t||"\r"===t||t===n)break;s+=1}if(s-t==0)throw new Error("Invalid text, at ".concat(e));return s}consumeUnicastAddress(e,t,s){return this.consumeTill(e,t,i)}consumeOneOrMore(e,t,s){let n=t;for(;s(e[n]);)n++;if(n-t==0)throw new Error("Invalid rule at ".concat(t,"."));return n}consumeSpace(e,t){if(e[t]===i)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let s=t;for(let n=0;n<4;n++)if(s=this.consumeDecimalUChar(e,s),3!==n){if("."!==e[s])throw new Error("Invalid IP4 address.");s++}return s}consumeDecimalUChar(e,t){let s=t;for(let r=0;r<3&&o(e[s]);r++,s++);if(s-t==0)throw new Error("Invalid decimal uchar.");const n=parseInt(e.slice(t,s));if(n>=0&&n<=255)return s;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let s=this.consumeHexpart(e,t);return":"===e[s]?(s+=1,s=this.consumeIP4Address(e,s),s):s}consumeHexpart(e,t){let s=t;if(":"===e[s]&&":"===e[s+1]){s+=2;try{s=this.consumeHexseq(e,s)}catch(e){}return s}if(s=this.consumeHexseq(e,s),":"===e[s]&&":"===e[s+1]){s+=2;try{s=this.consumeHexseq(e,s)}catch(e){}return s}return s}consumeHexseq(e,t){let s=t;for(;s=this.consumeHex4(e,s),":"===e[s]&&":"!==e[s+1];)s+=1;return s}consumeHex4(e,t){let s=0;for(;s<4;s++)if(!((n=e[t+s])>="0"&&n<="9"||n>="a"&&n<="f"||n>="A"&&n<="F")){if(0===s)throw new Error("Invalid hex 4");break}var n;return t+s}consumeFQDN(e,t){let s=t;for(;o(e[s])||h(e[s])||"-"===e[s]||"."===e[s];)s+=1;if(s-t<4)throw new Error("Invalid FQDN");return s}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,s){switch(s){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(s){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const s=this.consumeHexpart(e,t);return"/"===e[s]?this.consumeInteger(e,s+1):s}consumeIP4MulticastAddress(e,t){let s=t+3;const n=e.slice(t,s),r=parseInt(n);if(r<224||r>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let i=0;i<3;i++){if("."!==e[s])throw new Error("Invalid IP4 multicast address.");s+=1,s=this.consumeDecimalUChar(e,s)}return"/"===e[s]&&(s+=1),s=this.consumeTTL(e,s),"/"===e[s]&&(s=this.consumeInteger(e,s)),s}consumeInteger(e,t){if(!u(e[t]))throw new Error("Invalid integer.");for(t+=1;o(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw new Error("Invalid TTL.");t+=1;for(let s=0;s<2&&o(e[t]);s++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let s=t;if("0"===e[s])return s+1;for(u(e[s])&&(s+=1);o(e[s]);)s++;if(s-t<10)throw new Error("Invalid time");return s}consumeAddress(e,t){return this.consumeTill(e,t,i)}consumeTypedTime(e,t){let s=t;return s=this.consumeOneOrMore(e,s,o),p(e[s])?s+1:s}consumeRepeatInterval(e,t){if(!u(e[t]))throw new Error("Invalid repeat interval");for(t+=1;o(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,o)}consume(e,t,s){for(let n=0;n<s.length;n++){if(t+n>=e.length)throw new Error("consume exceeding value length");if(e[t+n]!==s[n])throw new Error("consume ".concat(s," failed at ").concat(n))}return t+s.length}consumeTill(e,t,s){let n=t;for(;n<e.length&&("string"!=typeof s||e[n]!==s)&&("function"!=typeof s||!s(e[n]));)n++;return n}}class b extends E{constructor(){super(),_(this,"records",[]),_(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter(e=>!!jx(e).call(e)).map(this.parseLine),this.currentLine=0;const s=this.parseVersion(),n=this.parseOrigin(),r=this.parseSessionName(),i=this.parseInformation(),a=this.parseUri(),o=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),d=this.parseBandWidth(),u=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),m=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:s,origin:n,sessionName:r,information:i,uri:a,emails:o,phones:c,connection:l,bandwidths:d,timeFields:u,key:h,attributes:p,mediaDescriptions:m}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===n)return"\r"===e[t-1]?r:n;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const s=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:s,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new N;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;const s={attField:this.extractOneOrMore(t,e=>d(e)&&":"!==e),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,s.attValue=this.extractOneOrMore(t,m)),e.parse(s),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new S(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==a.ATTRIBUTE)break;const s={attField:this.extractOneOrMore(e,e=>d(e)&&":"!==e),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,s.attValue=this.extractOneOrMore(e,m)),t.parse(s),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const s=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let n=!1;"-"===e.value[e.cur]&&(n=!0,e.cur+=1);const r=this.extract(e,this.consumeTypedTime);t.push({time:s,typedTime:r,back:n})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;{const s=this.extract(t,this.consumeRepeatInterval),n=this.parseTypedTime(t);e.push({repeatInterval:s,typedTimes:n}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const s=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:s}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;{const s=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const n=this.extractOneOrMore(t,o);e.push({bwtype:s,bandwidth:n}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,o));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const s=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,o);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:s,sessVersion:n,nettype:r,addrtype:i,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==a.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===a.CONNECTION){const t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const s=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:s,address:n}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let s=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,s+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const n=[];for(n.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,n.push(this.extract(e,this.consumeToken));if(0===n.length)throw new Error("Invalid proto");const r=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:s,protos:n,fmts:r}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===a.TIME;){const t=this.parseTime(),s=this.parseRepeat(),n=this.parseZone();e.push({time:t,repeats:s,zones:n})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){const t=this.parseMedia(),s=this.parseInformation(),n=this.parseConnections(),r=this.parseBandWidth(),i=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:s,connections:n,bandwidths:r,key:i,attributes:a})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];const i=t.call(this,e.value,e.cur,...n),a=e.value.slice(e.cur,i);return e.cur=i,a}extractOneOrMore(e,t){const s=this.consumeOneOrMore(e.value,e.cur,t),n=e.value.slice(e.cur,s);return e.cur=s,n}consumeSpaceForRecord(e){if(e.value[e.cur]!==i)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class w extends E{constructor(){super(...arguments),_(this,"attributes",void 0),_(this,"digested",!1)}extractOneOrMore(e,t,s){const n=this.consumeOneOrMore(e.attValue,e._cur,t),r=e.attValue.slice(e._cur,n),[i,a]=s||[];if("number"==typeof i&&r.length<i)throw new Error("error in length, should be more or equal than ".concat(i," characters."));if("number"==typeof a&&r.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=n,r}consumeAttributeSpace(e){if(e.attValue[e._cur]!==i)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];const i=t.call(this,e.attValue,e._cur,...n),a=e.attValue.slice(e._cur,i);return e._cur=i,a}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let s=0;s<t.length;s++)if(t[s]!==e.attValue[e._cur+s])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:s})}parseExtmap(e){const t=this.extractOneOrMore(e,o);let s;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),s=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,i),r=x(x({entry:parseInt(t,10)},s&&{direction:s}),{},{extensionName:n});this.peekChar(e)===i&&(this.consumeAttributeSpace(e),r.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(r)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class N extends w{constructor(){super(...arguments),_(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),s=[];for(;!this.atEnd(e)&&this.peekChar(e)===i;)this.consumeAttributeSpace(e),s.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:s})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,y),s=[];for(;!this.atEnd(e)&&this.peekChar(e)===i;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const n=this.extractOneOrMore(e,e=>e!==i&&m(e));s.push({name:t,value:n})}this.attributes.identities.push({assertionValue:t,extensions:s})}parseMsidSemantic(e){this.peekChar(e)===i&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const s=this.extract(e,this.consumeTill,i);t.identifierList.push(s)}}this.attributes.msidSemantic=t}}class S extends w{constructor(e){super(),_(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);const s=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const r=this.extractOneOrMore(e,o,[1,10]);this.consumeAttributeSpace(e);const a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const d={foundation:t,componentId:s,transport:n,priority:r,connectionAddress:a,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));this.peekChar(e)===i;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){const t=[];for(;;){const s=this.extractOneOrMore(e,o,[1,5]);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumePort);t.push({componentId:s,connectionAddress:n,port:r});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const n={encodingName:s,clockRate:this.extractOneOrMore(e,o)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),n.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const r=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));r?r.rtpMap=n:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:n,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,o);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeTill,":");let n;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),n=this.extract(e,this.consumeTill));const r=this.attributes.ssrcs.find(e=>e.ssrcId===parseInt(t,10));r?r.attributes[s]=n:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[s]:n}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,i);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeTill),n={};s.split(";").forEach(e=>{let[t,s]=e.split("=");t=jx(t).call(t);const r="string"==typeof s?jx(s).call(s):null;"string"==typeof t&&t.length>0&&(n[t]=r)});const r=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));r?r.fmtp={parameters:n}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:n}})}parseFmtParameters(e){const t={},s=this.extract(e,this.consumeTill,"=");e._cur++;const n=this.extract(e,this.consumeTill,";");for(t[s]=n;";"===e.attValue[e._cur];){const s=this.extract(e,this.consumeTill,"=");e._cur++;const n=this.extract(e,this.consumeTill,";");t[s]=n}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,i),this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeTill,i);let n;if("trr-int"===s)n={type:s,interval:this.extract(e,this.consumeTill)};else{const t={type:s};this.peekChar(e)===i&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===i&&(t.additional=this.extract(e,this.consumeTill))),n=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(n);else{const e=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));e?e.rtcpFeedbacks.push(n):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[n]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===i&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,d,[1,64])};this.peekChar(e)===i&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,e=>h(e)||o(e)||"_"===e||"-"===e);this.consumeAttributeSpace(e);const s={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===i){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const s=this.extract(e,this.consumeToken);t.push(s);try{this.extract(e,this.consume,",")}catch(e){break}}s.payloads=t,this.peekChar(e)===i&&this.extract(e,this.consume,i)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const n={type:t,rids:this.extract(e,this.consume,"=").split(",")};s.params.push(n);break}default:{const n={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),n.val=this.extract(e,this.consumeTill,";")),s.params.push(n)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(s)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,o,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,o,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),s=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);s.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:s})}}function T(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class C{constructor(){T(this,"eol",r)}print(e,t){let s="";return t&&(this.eol=t),s+=this.printVersion(e.version),s+=this.printOrigin(e.origin),s+=this.printSessionName(e.sessionName),s+=this.printInformation(e.information),s+=this.printUri(e.uri),s+=this.printEmail(e.emails),s+=this.printPhone(e.phones),s+=this.printConnection(e.connection),s+=this.printBandwidth(e.bandwidths),s+=this.printTimeFields(e.timeFields),s+=this.printKey(e.key),s+=this.printSessionAttributes(e.attributes),s+=this.printMediaDescription(e.mediaDescriptions),s}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const s of e)t+="e=".concat(s).concat(this.eol);return t}printPhone(e){let t="";for(const s of e)t+="e=".concat(s).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const s of e)t+="b=".concat(s.bwtype,":").concat(s.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const s of e){t+="t=".concat(s.time.startTime," ").concat(s.time.startTime).concat(this.eol);for(const e of s.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);s.zoneAdjustments&&(t+="z=",t+="z=".concat(s.zoneAdjustments.map(e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const s of e)t+="a=".concat(s.attField).concat(s.attValue?":".concat(s.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const s of e)t+=this.printMedia(s.media),t+=this.printInformation(s.information),t+=this.printConnections(s.connections),t+=this.printBandwidth(s.bandwidths),t+=this.printKey(s.key),t+=this.printMediaAttributes(s);return t}printConnections(e){let t="";for(const s of e)t+=this.printConnection(s);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new I(this.eol).print(e)}printMediaAttributes(e){return new A(this.eol).print(e)}}class R{constructor(e){T(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(i)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(e=>"a=fingerprint:".concat(e.hashFunction).concat(i).concat(e.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(i).concat(e.extensionName).concat(e.extensionAttributes?"".concat(i).concat(e.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol)).join("")}}class I extends R{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map(e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map(e=>"".concat(i).concat(e)).join("")).concat(this.eol)).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map(e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map(e=>"".concat(i).concat(e.name).concat(e.value?"=".concat(e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(i,"*"):e.identifierList.length>0&&(t+=e.identifierList.map(e=>"".concat(i).concat(e))),t+this.eol}}class A extends R{print(e){const t=e.attributes;let s="";return s+=this.printRTCP(t.rtcp),s+=this.printIceUfrag(t.iceUfrag),s+=this.printIcePwd(t.icePwd),s+=this.printIceOptions(t.iceOptions),s+=this.printCandidates(t.candidates),s+=this.printRemoteCandidatesList(t.remoteCandidatesList),s+=this.printEndOfCandidates(t.endOfCandidates),s+=this.printFingerprints(t.fingerprints),s+=this.printSetup(t.setup),s+=this.printMid(t.mid),s+=this.printExtmap(t.extmaps),s+=this.printRTPRelated(t),s+=this.printPtime(t.ptime),s+=this.printMaxPtime(t.maxPtime),s+=this.printDirection(t.direction),s+=this.printSSRCGroups(t.ssrcGroups),s+=this.printSSRC(t.ssrcs),s+=this.printRTCPMux(t.rtcpMux),s+=this.printRTCPMuxOnly(t.rtcpMuxOnly),s+=this.printRTCPRsize(t.rtcpRsize),s+=this.printMSId(t.msids),s+=this.printImageattr(t.imageattr),s+=this.printRid(t.rids),s+=this.printSimulcast(t.simulcast),s+=this.printSCTPPort(t.sctpPort),s+=this.printMaxMessageSize(t.maxMessageSize),s+=this.printUnrecognized(t.unrecognized),s}printCandidates(e){return e.map(e=>"a=candidate:".concat(e.foundation).concat(i).concat(e.componentId).concat(i).concat(e.transport).concat(i).concat(e.priority).concat(i).concat(e.connectionAddress).concat(i).concat(e.port).concat(i,"typ").concat(i).concat(e.type).concat(e.relAddr?"".concat(i,"raddr").concat(i).concat(e.relAddr):"").concat(e.relPort?"".concat(i,"rport").concat(i).concat(e.relPort):"").concat(Object.keys(e.extension).map(t=>"".concat(i).concat(t).concat(i).concat(e.extension[t])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(e=>"a=remote-candidates:".concat(e.join(i)).concat(this.eol)).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let s="";s+=e.rtcpFeedbackWildcards.map(e=>this.printRTCPFeedback("*",e)).join("");for(const n of t)s+=this.printRtpMap(n.payloadType,n.rtpMap),s+=this.printFmtp(n.payloadType,n.fmtp),s+=n.rtcpFeedbacks.map(e=>this.printRTCPFeedback(n.payloadType,e)).join("");return s}printFmtp(e,t){if(!t)return"";const s=Object.keys(t.parameters);return 1===s.length&&null===t.parameters[s[0]]?"a=fmtp:".concat(e).concat(i).concat(s[0]).concat(this.eol):"a=fmtp:".concat(e).concat(i).concat(Object.keys(t.parameters).map(e=>"".concat(e,"=").concat(t.parameters[e])).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(i).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let s="a=rtcp-fb:".concat(e).concat(i),n=t;return"trr-int"===n.type?s+="ttr-int".concat(i).concat(n.interval):(s+="".concat(n.type),n.parameter&&(s+="".concat(i).concat(n.parameter),n.additional&&(s+="".concat(i).concat(n.additional)))),s+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(e=>Object.keys(e.attributes).map(t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(i).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(i).concat(e.netType)),e.addressType&&(t+="".concat(i).concat(e.addressType)),e.address&&(t+="".concat(i).concat(e.address)),t+this.eol}printMSId(e){return e.map(e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(i).concat(e.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(e=>"a=imageattr:".concat(e).concat(this.eol)).join("")}printRid(e){return e.map(e=>{let t="a=rid:".concat(e.id).concat(i).concat(e.direction);return e.payloads&&(t+="".concat(i,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(i).concat(e.params.map(e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)).join(";"))),t+this.eol}).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map(e=>"".concat(i).concat(e.toString(10))).join("")).concat(this.eol)).join("")}}function O(e){return(new b).parse(e)}function j(e,t){return(new C).print(e,t)}}},t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,s),r.exports}return s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(8)})();function VA(e){return UA.parse(e)}function FA(e,t){return UA.print(e,t)}var BA=$s("Array","keys"),GA=gn,WA=et,HA=u,KA=BA,zA=Array.prototype,qA={DOMTokenList:!0,NodeList:!0},YA=function(e){var t=e.keys;return e===zA||HA(zA,e)&&t===zA.keys||WA(qA,GA(e))?KA:t},XA=n(YA);function JA(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function QA(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function ZA(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?QA(Object(s),!0).forEach(function(t){JA(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):QA(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const $A=new class extends HR{constructor(){super(...arguments),JA(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class eO{constructor(e){JA(this,"logger",void 0),JA(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function sO(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const nO={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},rO=Date.now(),iO=e=>{for(const t in nO)if(Object.prototype.hasOwnProperty.call(nO,t)&&nO[t]===e)return t;return"DEFAULT"},aO=new class{constructor(){JA(this,"proxyServerURL",void 0),JA(this,"logLevel",nO.DEBUG),JA(this,"uploadState","collecting"),JA(this,"uploadLogWaitingList",[]),JA(this,"uploadLogUploadingList",[]),JA(this,"uploadErrorCount",0),JA(this,"currentLogID",0),JA(this,"url",void 0),JA(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=[nO.DEBUG].concat(t);this.log.apply(this,n)}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=[nO.INFO].concat(t);this.log.apply(this,n)}warning(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=[nO.WARNING].concat(t);this.log.apply(this,n)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=[nO.ERROR].concat(t);this.log.apply(this,n)}upload(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const n=[nO.DEBUG].concat(t);this.uploadLog.apply(this,n)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){CA("UPLOAD_LOG",!0)}disableLogUpload(){CA("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new eO(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-rO<100)return void setTimeout(()=>{this.log(...t)},Date.now()-rO);const n=Math.max(0,Math.min(4,t[0]));if(t[0]=tO()+" Agora-SDK [".concat(iO(n),"]:"),this.appendLogToWaitingList(n,...t),n<this.logLevel)return;const r=tO()+" %cAgora-SDK [".concat(iO(n),"]:");let i=[];if(!RA("USE_NEW_LOG"))switch(n){case nO.DEBUG:i=[r,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,i);break;case nO.INFO:i=[r,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,i);break;case nO.WARNING:i=[r,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,i);break;case nO.ERROR:i=[r,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,i)}}uploadLog(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-rO<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-rO);const n=Math.max(0,Math.min(4,t[0]));t[0]=tO()+" Agora-SDK [".concat(iO(n),"]:"),this.appendLogToWaitingList(n,...t)}appendLogToWaitingList(e){if(!RA("UPLOAD_LOG"))return;for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];Array.isArray(s[0])?s[0][0]=sO()+" Agora-SDK [".concat(iO(e),"]:"):s[0]=sO()+" Agora-SDK [".concat(iO(e),"]:");let r="";s.forEach(e=>{"object"==typeof e&&(e=JSON.stringify(e)),r+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:vA,process_id:RA("PROCESS_ID"),payload:JSON.stringify(e)};return GI(async()=>{const e=await LC.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(RA("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(RA("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}},()=>(this.uploadLogUploadingList=[],!1),t=>{const s={status:-1,message:t.message,errorRange:e.map(e=>e.log_item_id)};return t.response?(s.status=t.response.status,s.data=t.response.data,s.headers=t.response.headers):t.request&&(s.status=t.request.status),$A.reportLogUploadError(s),!0},{timeout:RA("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:RA("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,RA("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),RA("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var oO;function cO(e){return DR(e.reportId,"params.reportId",0,100,!1),DR(e.category,"params.category",0,100,!1),DR(e.event,"params.event",0,100,!1),DR(e.label,"params.label",0,100,!1),jR(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(oO={}).FREE="free",oO.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const lO={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let dO=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),uO=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let hO=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function pO(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,s,n){const r=n.value;if("function"==typeof r){const i=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);n.value=function(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];let c=a;if(e.argsMap)try{c=e.argsMap(this,...a)}catch(e){aO.warning(e),c=[]}try{JSON.stringify(c)}catch(e){aO.warning("arguments for method ".concat(i,".").concat(String(s)," not serializable for apiInvoke.")),c=[]}const l=(e.report||mO).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(i,".").concat(String(s)),options:c,tag:YR.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=r.apply(this,a);return t instanceof sp?t.then(t=>(l.onSuccess(e.reportResult&&t),t)).catch(e=>{throw l.onError(e),e}):(l.onSuccess(e.reportResult&&t),t)}catch(e){throw l.onError(e),e}}}return n}}const mO=new class{constructor(){JA(this,"baseInfoMap",new Map),JA(this,"proxyServer",void 0),JA(this,"eventUploadTimer",void 0),JA(this,"setSessionIdTimer",void 0),JA(this,"url",void 0),JA(this,"sids",new Set),JA(this,"backupUrl",void 0),JA(this,"_appId",void 0),JA(this,"_aid",0),JA(this,"keyEventUploadPendingItems",[]),JA(this,"normalEventUploadPendingItems",[]),JA(this,"apiInvokeUploadPendingItems",[]),JA(this,"apiInvokeCount",0),JA(this,"apiInvokeLoggedCount",0),JA(this,"ltsList",[]),JA(this,"lastSendNormalEventTime",Date.now()),JA(this,"customReportCounterTimer",void 0),JA(this,"customReportCount",0),JA(this,"extApiInvoke",async e=>{for(const t of e){const e=ZA(ZA({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:YR.TRACER});this.sendApiInvoke(e)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),RA("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),RA("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,s]=e;return t+s}),16)||0}reportApiInvoke(e,t,s){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const n=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,i=!!RA("SHOW_REPORT_INVOKER_LOG"),a=!!RA("SHOW_REPORT_USER_INVOKER_LOG"),o=i||a&&t.id;o&&(this.apiInvokeLoggedCount+=1);const c=this.apiInvokeLoggedCount;function l(e,s){if(o){let n="[apiInvoke-".concat(c,"]");if(t.id&&(n+="[".concat(t.id,"]")),t.name&&(n+="[".concat(t.name,"]"),t.name===qR.JOIN))return aO.info("".concat(n," ").concat(e));aO.info("".concat(n," ").concat(e),"start"===e?t.options:s||"")}}const d=()=>({tag:t.tag,invokeId:r,sid:e,name:t.name,apiInvokeTime:n,options:t.options,states:t.states||null});l("start");let u=!1;NI(t.timeout).then(()=>{u||(this.sendApiInvoke(ZA(ZA({},d()),{},{error:RR.API_INVOKE_TIMEOUT,success:!1})),l("timeout"))});const h=new IR(RR.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const n=()=>{if(u)throw h;return u=!0,this.sendApiInvoke(ZA(ZA({},d()),{},{success:!0},t.reportResult&&{result:e})),l("onSuccess"),e};return s?II(n,t.name+"Success",s,()=>u=!0):n()},onError:e=>{const n=()=>{if(u)throw e;u=!0,this.sendApiInvoke(ZA(ZA({},d()),{},{success:!1,error:e})),l("onFailure",e.toString())};return s?II(n,t.name+"Error",s,()=>u=!0):n()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const s=Date.now(),n=this.createBaseInfo(e,s);n.cname=t.cname;const r=Object.assign({},{willUploadConsoleLog:RA("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:xA?"global":"oversea",areas:RA("AREAS")&&RA("AREAS").join(",")},t.extend),{stringUid:i,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientRole:d}=t,u=Date.now(),h=ZA(ZA({},n),{},{eventType:dO.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:NA,lts:u,elapse:u-s,extend:JSON.stringify(r),mode:t.mode,process:RA("PROCESS_ID"),appType:RA("APP_TYPE"),success:!0,version:vA,stringUid:i,channelProfile:a,channelMode:o,isABTestSuccess:c,lsid:l,clientType:Dn(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:d,serviceId:RA("PROCESS_ID"),extensionID:RA("PLUGIN_INFO").join(",")||""});var p;this.send({type:uO.SESSION,data:h},!0)}joinChooseServer(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA({},n),{},{role:t.role,eventType:dO.JOIN_CHOOSE_SERVER,lts:r,eventElapse:t.elapse||r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-s.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:uO.JOIN_CHOOSE_SERVER,data:i},!0)}reqUserAccount(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA({},n),{},{eventType:dO.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||r-s.startTime,eventElapse:r-t.lts,extend:JSON.stringify(t.extend)});this.send({type:uO.REQ_USER_ACCOUNT,data:i},!0)}joinGateway(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info;t.vid&&(n.vid=t.vid),n.uid=t.uid,n.cid=t.cid;const r=Date.now(),{firstSuccess:i,addr:a,isProxy:o}=t,c=r-s.startTime,l=ZA(ZA({},n),{},{eventType:dO.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:r-t.lts,firstSuccess:i,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:yA(),isABTestSuccess:t.isABTestSuccess?1:0}),d=l.success?1:0;if(t.succ&&(s.lastJoinSuccessTime=r),i)this.send({type:uO.JOIN_GATEWAY,data:l},!0);else{let e;if(a)if(o){const t=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),s=a.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:s&&s.length?s[0].split("=")[1]:"",isProxy:o?1:0}}else{const t=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),s=a.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:s&&s.length?s[0].split(/:|p=/g)[1]:"",isProxy:o?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:o?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const t=Object.assign({},l,e,{eventType:dO.REJOIN_GATEWAY});this.send({type:uO.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=Date.now(),r=ZA(ZA({},s.info),{},{lts:n,timeout:t,elapse:n-s.startTime});this.send({type:uO.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA({},n),{},{eventType:dO.PUBLISH,lts:r,eventElapse:t.eventElapse,elapse:r-s.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:uO.PUBLISH,data:i},!0)}subscribe(e,t,s){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{eventType:dO.SUBSCRIBE,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:uO.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const s=[...XA(t=this.baseInfoMap).call(t)],n=s.length?s[0]:"UnableToGetSid",r=this.baseInfoMap.get(n);if(!r)return;const i=r.info,a=Date.now(),o=ZA(ZA({},i),{},{eventType:dO.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-r.startTime,status:e.status?1:2});this.send({type:uO.WS_COMPRESSOR_INIT,data:o},!0)}firstXLAPeerFirstVideoFrame(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=t.peerPubStatusMs-(s.lastJoinSuccessTime||r),a=ZA(ZA({},n),{},{elapse:r-s.startTime,eventType:dO.XLA_PEER_FIRST_VIDEO_FRAME,lts:r,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:i,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>i?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:uO.XLA_PEER_FIRST_VIDEO_FRAME,data:a},!0)}firstRemoteVideoDecode(e,t,s,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,a=Date.now(),o=ZA(ZA(ZA({},i),n),{},{elapse:a-r.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((n.firstFrame||a)-r.startTime,0),apEnd:Math.max(n.apEnd-r.startTime,0),apStart:Math.max(n.apStart-r.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-r.startTime,0),joinGwStart:Math.max(n.joinGwStart-r.startTime,0),pcEnd:Math.max(n.pcEnd-r.startTime,0),pcStart:Math.max(n.pcStart-r.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-r.startTime,0),subscriberStart:Math.max(n.subscriberStart-r.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-r.startTime,0)});this.send({type:s,data:o},!0)}firstRemoteFrame(e,t,s,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,a=Date.now(),o=ZA(ZA(ZA({},i),n),{},{elapse:a-r.startTime,eventType:t,lts:a});this.send({type:s,data:o},!0)}abTest(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA(ZA({},n),t),{},{vid:void 0===n.vid?0:Number(n.vid),elapse:r-s.startTime,eventType:dO.AB_TEST,lts:r});this.send({type:uO.AB_TEST,data:i},!0)}pcStats(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA(ZA({},n),t),{},{vid:void 0===n.vid?0:Number(n.vid),elapse:r-s.startTime,eventType:dO.PC_STATS,lts:r,preallocation:t.preallocation?1:0});this.send({type:uO.PC_STATS,data:i},!0)}updateRemoteRTPCapabilities(e,t){if(e){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA(ZA({},n),t),{},{vid:void 0===n.vid?0:Number(n.vid),eventType:dO.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:uO.UPDATE_REMOTE_RTPCAPABILITIES,data:i},!0)}}onGatewayStream(e,t,s,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,a=Date.now(),o=ZA(ZA(ZA({},i),n),{},{eventType:t,lts:a});this.send({type:s,data:o},!0)}streamSwitch(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA({},n),{},{eventType:dO.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-s.startTime,success:t.succ});this.send({type:uO.STREAM_SWITCH,data:i},!0)}requestProxyAppCenter(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA({},n),{},{eventType:dO.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-s.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_APPCENTER,data:i},!0)}requestProxyWorkerManager(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA({},n),{},{eventType:dO.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-s.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:uO.REQUEST_PROXY_WORKER_MANAGER,data:i},!0)}setProxyServer(e){this.proxyServer=e,e?aO.debug("reportProxyServerurl: ".concat(e)):aO.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA({},n),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:r,elapse:r-s.startTime,joinChannelSuccessElapse:r-(s.lastJoinSuccessTime||r),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:uO.PEER_PUBLISH_STATUS,data:i},!0)}workerEvent(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now();(function(e,t,s){const n=e[t];if(!n||"string"!=typeof n)return[e];e[t]="";const r=EI(JSON.stringify(e));let i=0;const a=[];let o=0;for(let c=0;c<n.length;c++)o+=n.charCodeAt(c)<=127?1:3,o<=s-r||(a[a.length]=CR(CR({},e),{},{[t]:n.substring(i,c)}),i=c,o=n.charCodeAt(c)<=127?1:3);return i!==n.length-1&&(a[a.length]=CR(CR({},e),{},{[t]:n.substring(i)})),a})(ZA(ZA(ZA({},n),t),{},{elapse:r-s.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(e=>this.send({type:uO.WORKER_EVENT,data:e},!0))}apworkerEvent(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA(ZA({},n),t),{},{elapse:r-s.startTime,lts:r});this.send({type:uO.AP_WORKER_EVENT,data:i},!0)}joinWebProxyAP(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA(ZA({},n),t),{},{elapse:r-s.startTime,lts:r,extend:t.extend||void 0});this.send({type:uO.JOIN_WEB_PROXY_AP,data:i},!0)}WebSocketQuit(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const n=s.info,r=Date.now(),i=ZA(ZA(ZA({},n),t),{},{elapse:r-s.startTime,lts:r});this.send({type:uO.WEBSOCKET_QUIT,data:i},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>RA("CUSTOM_REPORT_LIMIT"))throw new IR(RR.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),n=t.map(t=>({type:uO.USER_ANALYTICS,data:ZA(ZA({sid:e},t),{},{lts:s})}));try{RA("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(e){throw aO.error("send custom report message failed",e.toString()),new IR(RR.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=RA("NOT_REPORT_EVENT");if(e.tag&&Dn(t)&&Dn(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const s=this.baseInfoMap.get(e.sid);if(!s)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:n,uid:r,cid:i}=s.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof IR){const{code:t,message:s}=e.error;a=t||s||e.error.toString()}else a=e.error.toString();const o={invokeId:e.invokeId,sid:e.sid,cname:n,cid:i,uid:r,lts:e.lts,success:e.success,elapse:e.lts-s.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:uO.API_INVOKE,data:o},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find(e=>null!==e);t&&e.forEach(e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>RA("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const s=[],n=[];for(;e.length;){const t=e.shift();s.length<20?s.push(t):n.push(t)}e.push(...n);for(const i of[...s]){var r;-1!==this.ltsList.indexOf(i.data.lts)?(i.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(i.data.lts)):(this.ltsList.push(i.data.lts),Xp(r=this.ltsList).call(r,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=Date.now()),RA("ENABLE_EVENT_REPORT")?(s.length&&(RA("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((e=>s=>{RA("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>RA("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-RA("NORMAL_EVENT_QUEUE_CAPACITY")),aO.warning("report: drop normal events"))))})(s)),e):e}async postDataToStatsCollector2(e){lI.networkState===nI.OFFLINE&&await sp.race([lI.onlineWaiter,NI(2*FI.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach(e=>{const s=BR(JSON.stringify(e.data)),n=new ArrayBuffer(5),r=(e=>{let t=0;return Object.entries(uO).forEach(s=>{let[n,r]=s;r===e.type&&(t=hO[n])}),t})(e),i=new DataView(n);i.setUint16(0,s.byteLength,!0),i.setUint8(2,255&r),i.setUint8(3,r>>>8&255),i.setUint8(4,r>>>16&255),t=GR(t,new Uint8Array(n)),t=GR(t,s)}),t},s="event";let n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(RA("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let r=0;r<2;r+=1){1===r&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(RA("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await qI(n,{timeout:1e4,data:t(e),headers:ZA(ZA({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===r)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),n=s?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(e=>JSON.stringify(e)),vid:s,aid:n};lI.networkState===nI.OFFLINE&&await sp.race([lI.onlineWaiter,NI(2*FI.maxRetryTimeout)]);const i=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("EVENT_REPORT_DOMAIN"),"&p=").concat(RA("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(RA("EVENT_REPORT_DOMAIN"),":").concat(RA("STATS_COLLECTOR_PORT")).concat(i));for(let o=0;o<2;o+=1){1===o&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(RA("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(RA("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(RA("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(RA("STATS_COLLECTOR_PORT")).concat(i)));try{t?await YI(a,{timeout:1e4,data:r}):await qI(a,{timeout:1e4,data:r})}catch(t){if(1===o)throw t;continue}return}}createBaseInfo(e,t){const s=Object.assign({},lO);return s.sid=e,this.baseInfoMap.set(e,{info:s,startTime:t}),s}reportResourceTiming(e,t){const s=performance.getEntriesByName(e),n=s[s.length-1];n&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:n,tag:YR.TRACER}).onSuccess()}};$A.on("REPORT_LOG_UPLOAD",e=>{e.networkState=lI.networkState,mO.reportApiInvoke(null,{name:"logUploadError",options:e,tag:YR.TRACER}).onSuccess("logUploadError")});class fO extends IR{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),JA(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,aO)}throw(){super.throw(aO)}}const gO={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function yO(){return gO}function vO(){return"setSinkId"in HTMLAudioElement.prototype&&(!RA("RESTRICTION_SET_PLAYBACK_DEVICE")||(ZC()||tR())&&!ER())}function xO(){return!gO.supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&bR()}function _O(e){return!(sR()||iR(87)||xO()||!RA("ENABLE_PRE_SUB")&&(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB")))}function EO(e){return!!RA("ENABLE_INSTANT_VIDEO")||!(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB"))}let bO=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function wO(e,t,s){return{sampleRate:e,stereo:t,bitrate:s}}function NO(e,t,s,n,r){return{width:e,height:t,frameRate:s,bitrateMin:n,bitrateMax:r}}function SO(e,t,s,n,r){return{width:{max:e},height:{max:t},frameRate:s,bitrateMin:n,bitrateMax:r}}function TO(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const CO={"90p":NO(160,90),"90p_1":NO(160,90),"120p":NO(160,120,15,30,65),"120p_1":NO(160,120,15,30,65),"120p_3":NO(120,120,15,30,50),"120p_4":NO(212,120),"180p":NO(320,180,15,30,140),"180p_1":NO(320,180,15,30,140),"180p_3":NO(180,180,15,30,100),"180p_4":NO(240,180,15,30,120),"240p":NO(320,240,15,40,200),"240p_1":NO(320,240,15,40,200),"240p_3":NO(240,240,15,40,140),"240p_4":NO(424,240,15,40,220),"360p":NO(640,360,15,80,400),"360p_1":NO(640,360,15,80,400),"360p_3":NO(360,360,15,80,260),"360p_4":NO(640,360,30,80,600),"360p_6":NO(360,360,30,80,400),"360p_7":NO(480,360,15,80,320),"360p_8":NO(480,360,30,80,490),"360p_9":NO(640,360,15,80,800),"360p_10":NO(640,360,24,80,800),"360p_11":NO(640,360,24,80,1e3),"480p":NO(640,480,15,100,500),"480p_1":NO(640,480,15,100,500),"480p_2":NO(640,480,30,100,1e3),"480p_3":NO(480,480,15,100,400),"480p_4":NO(640,480,30,100,750),"480p_6":NO(480,480,30,100,600),"480p_8":NO(848,480,15,100,610),"480p_9":NO(848,480,30,100,930),"480p_10":NO(640,480,10,100,400),"720p":NO(1280,720,15,120,1130),"720p_auto":NO(1280,720,30,900,3e3),"720p_1":NO(1280,720,15,120,1130),"720p_2":NO(1280,720,30,120,2e3),"720p_3":NO(1280,720,30,120,1710),"720p_5":NO(960,720,15,120,910),"720p_6":NO(960,720,30,120,1380),"1080p":NO(1920,1080,15,120,2080),"1080p_1":NO(1920,1080,15,120,2080),"1080p_2":NO(1920,1080,30,120,3e3),"1080p_3":NO(1920,1080,30,120,3150),"1080p_5":NO(1920,1080,60,120,4780),"1440p":NO(2560,1440,30,120,4850),"1440p_1":NO(2560,1440,30,120,4850),"1440p_2":NO(2560,1440,60,120,7350),"4k":NO(3840,2160,30,120,8910),"4k_1":NO(3840,2160,30,120,8910),"4k_3":NO(3840,2160,60,120,13500)},RO={"480p":SO(640,480,5),"480p_1":SO(640,480,5),"480p_2":SO(640,480,30),"480p_3":SO(640,480,15),"720p":SO(1280,720,5),"720p_auto":NO(1280,720,30,900,3e3),"720p_1":SO(1280,720,5),"720p_2":SO(1280,720,30),"720p_3":SO(1280,720,15),"1080p":SO(1920,1080,5),"1080p_1":SO(1920,1080,5),"1080p_2":SO(1920,1080,30),"1080p_3":SO(1920,1080,15)},IO={"1SL1TL":TO(1,1),"3SL3TL":TO(3,3),"2SL3TL":TO(2,3)};function AO(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},CO[e]):e}function OO(e){return"string"==typeof e?Object.assign({},RO[e]):e}function jO(e){return"string"==typeof e?Object.assign({},IO[e]):e}const kO={speech_low_quality:wO(16e3,!1),speech_standard:wO(32e3,!1,18),music_standard:wO(48e3,!1),standard_stereo:wO(48e3,!0,56),high_quality:wO(48e3,!1,128),high_quality_stereo:wO(48e3,!0,192)};function DO(e){return"string"==typeof e?Object.assign({},kO[e]):e}const PO=[];function LO(e){return OR(e,"mediaSource",["screen","window","application"]),!0}let MO=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),UO=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),VO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),FO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),BO=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),GO=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),WO=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),HO=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),KO=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),zO=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const qO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},XO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},JO={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ZO=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),$O=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),ej=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),tj=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),sj=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),nj=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const rj={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ij=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function aj(e,t,s,n,r){var i,a,o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=rr(i=yr(a=s.slice()).call(a)).call(i,function(s,n){return n(e,t,s)||s},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function oj(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function cj(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function lj(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?cj(Object(s),!0).forEach(function(t){oj(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):cj(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class dj extends HR{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(GO.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),oj(this,"trackMediaType",void 0),oj(this,"_ID",void 0),oj(this,"_rtpTransceiver",void 0),oj(this,"_lowRtpTransceiver",void 0),oj(this,"_hints",[]),oj(this,"_isClosed",!1),oj(this,"_originMediaStreamTrack",void 0),oj(this,"mediaStreamTrack",void 0),oj(this,"_external",{}),this._ID=t||SI(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Dn(PO).call(PO,e)||PO.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||gI(()=>{var e;mO.reportApiInvoke(null,{name:qR.GET_MEDIA_STREAM_TRACK,options:[],tag:YR.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===VO.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=PO.indexOf(e);-1!==t&&PO.splice(t,1)}(this),this.emit(WO.CLOSED),this.removeAllListeners(GO.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===VO.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(GO.TRANSCEIVER_UPDATED,e,t)}}class uj extends dj{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),oj(this,"_enabled",!0),oj(this,"_muted",!1),oj(this,"_isExternalTrack",!1),oj(this,"_isClosed",!1),oj(this,"_enabledMutex",void 0),oj(this,"processor",void 0),oj(this,"_processorContext",void 0),oj(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new UI("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,aO.debug("[".concat(this.getTrackId(),"] close")),this.emit(MO.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=s,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}stateCheck(e,t){if(aO.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),AR(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new IR(RR.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",aO);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new IR(RR.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",aO)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():sp.resolve([])}}const hj=window.AudioContext||window.webkitAudioContext;let pj=null;const mj=new class extends HR{constructor(){super(...arguments),oj(this,"prevState",void 0),oj(this,"curState",void 0),oj(this,"currentTime",void 0),oj(this,"currentTimeStuckAt",void 0),oj(this,"interruptDetectorTrack",void 0),oj(this,"onLocalAudioTrackMute",()=>{aO.info("ios15-interruption-start"),this.emit(bO.IOS_15_16_INTERRUPTION_START)}),oj(this,"onLocalAudioTrackUnmute",async()=>{aO.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?aO.info("ios15-interruption-end-canceled"):(pj&&await pj.suspend(),this.emit(bO.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){aO.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){aO.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function fj(){if(!pj){if(function(){if(!hj)return void aO.error("your browser is not support web audio");aO.info("create audio context");const e=lj({},RA("WEBAUDIO_INIT_OPTIONS"));aO.debug("audio context init option:",JSON.stringify(e)),pj=new hj(e),mj.curState=pj.state,pj.onstatechange=()=>{mj.prevState=mj.curState,mj.curState=pj?pj.state:void 0;const{prevState:e,curState:t}=mj,s="running"===t,n="interrupted"===t,r="running"===e,i="suspended"===e,a="interrupted"===e,o=qC().osVersion;(nR()||vR())&&r&&n&&(aO.info("ios".concat(o,"-interruption-start")),mj.emit(bO.IOS_INTERRUPTION_START)),(nR()||vR())&&(i||a)&&s&&(aO.info("ios".concat(o,"-interruption-end")),mj.emit(bO.IOS_INTERRUPTION_END)),e!==t&&mj.emit(bO.STATE_CHANGE,t,e)},setInterval(()=>{var e;const t=null===(e=pj)||void 0===e?void 0:e.currentTime;mj.currentTime!==t?(mj.currentTimeStuckAt&&(aO.debug("AudioContext current time resume at ".concat(t)),mj.currentTimeStuckAt=void 0),mj.currentTime=t):(t!==mj.currentTimeStuckAt&&(mO.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:YR.TRACER}).onSuccess(),aO.warning("AudioContext current time stuck at ".concat(t))),mj.currentTimeStuckAt=t)},5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,n=!1,r=!1,i=!1;function a(t){"running"===e.state?o(!1):nR()||vR()?"suspended"===e.state&&(o(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(o(!0),t&&e.resume().then(c,c))}function o(e){if(n!==e){n=e;for(let s=0,n=t;s<n.length;s+=1){const t=n[s];e?window.addEventListener(t,l,{capture:!0,passive:!0}):window.removeEventListener(t,l,{capture:!0,passive:!0})}}}function c(){a(!1)}function l(){a(!0)}function d(e){if(!i)if(s.paused)if(e){let t;u(!1),i=!0;try{t=s.play(),t?t.then(h,h):(s.addEventListener("playing",h),s.addEventListener("abort",h),s.addEventListener("error",h))}catch(e){h()}}else u(!0);else u(!1)}function u(e){if(r!==e){r=e;for(let s=0,n=t;s<n.length;s++){const t=n[s];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){s.removeEventListener("playing",h),s.removeEventListener("abort",h),s.removeEventListener("error",h),i=!1,d(!1)}function p(){d(!0)}if(nR()){const t=e.createMediaStreamDestination(),n=document.createElement("div");n.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=n.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=t.stream,d(!0)}mj.on(bO.STATE_CHANGE,function(){a(!0)}),a(!1)}(pj)}(),!pj)throw new IR(RR.NOT_SUPPORTED,"can not create audio context");return pj}return pj}function gj(e){if(function(){if(null!==yj)return yj;const e=fj(),t=e.createBufferSource(),s=e.createGain(),n=e.createGain();t.connect(s),t.connect(n),t.disconnect(s);let r=!1;try{t.disconnect(s)}catch(e){r=!0}return t.disconnect(),yj=r,r}())return;const t=e.connect,s=e.disconnect;e.connect=(s,n,r)=>{var i;return e._inputNodes||(e._inputNodes=[]),Dn(i=e._inputNodes).call(i,s)||(s instanceof AudioNode?(e._inputNodes.push(s),t.call(e,s,n,r)):t.call(e,s,n)),e},e.disconnect=(n,r,i)=>{s.call(e),n?dI(e._inputNodes,n):e._inputNodes=[];for(const s of e._inputNodes)t.call(e,s)}}let yj=null;function vj(e,t){let s=!1;const n=1/t;if(RA("DISABLE_WEBAUDIO")){const t=window.setInterval(()=>{s?window.clearInterval(t):e(performance.now()/1e3)},1e3*n)}else{const t=fj();let r=t.createGain();r.gain.value=0,r.connect(t.destination);const i=()=>{if(s)return void(r=null);const a=t.createOscillator();a.onended=i,a.connect(r),a.start(0),a.stop(t.currentTime+n),e(t.currentTime)};i()}return()=>{s=!0}}class xj{constructor(){oj(this,"context",void 0),oj(this,"analyserNode",void 0),oj(this,"sourceNode",void 0),this.context=fj(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||nR()||vR()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let s=0;s<e.length;++s)e[s]=t[s]/128-1}const t=rr(e).call(e,(e,t)=>e+t*t,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){aO.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class _j extends HR{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var s;null===(s=this.sourceNode)||void 0===s||s.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),oj(this,"outputNode",void 0),oj(this,"outputTrack",void 0),oj(this,"isPlayed",!1),oj(this,"sourceNode",void 0),oj(this,"context",void 0),oj(this,"audioBufferNode",void 0),oj(this,"destNode",void 0),oj(this,"audioOutputLevel",0),oj(this,"volumeLevelAnalyser",void 0),oj(this,"_processedNode",void 0),oj(this,"playNode",void 0),oj(this,"isDestroyed",!1),oj(this,"onNoAudioInput",void 0),oj(this,"isNoAudioInput",!1),oj(this,"_noAudioInputCount",0),this.context=fj(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),gj(this.outputNode),this.volumeLevelAnalyser=new xj}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(zO.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const s=e.outputBuffer.getChannelData(t);for(let e=0;e<s.length;e+=1)s[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!yO().webAudioMediaStreamDest)throw new IR(RR.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&hI(()=>{mj.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;nR()||vR()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let s;t.getFloatTimeDomainData?(s=new Float32Array(t.fftSize),t.getFloatTimeDomainData(s)):(s=new Uint8Array(t.fftSize),t.getByteTimeDomainData(s));let n=!1;for(let r=0;r<s.length;r++)0!==s[r]&&(n=!0);return n?(this.isNoAudioInput=!1,!0):(await NI(200),await this.checkHasAudioInput(e?e+1:1)&&n)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Ej extends _j{get isFreeze(){return!1}constructor(e,t,s){var n;if(super(),oj(this,"sourceNode",void 0),oj(this,"track",void 0),oj(this,"clonedTrack",void 0),oj(this,"audioElement",void 0),oj(this,"isCurrentTrackCloned",!1),oj(this,"isRemoteTrack",!1),oj(this,"originVolumeLevelAnalyser",void 0),oj(this,"rebuildWebAudio",async()=>{if(aO.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void aO.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>aO.info("resume success")),aO.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),gj(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const s=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(s,this.context.currentTime),gj(this.outputNode),this.emit(zO.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),"audio"!==e.kind)throw new IR(RR.UNEXPECTED_ERROR);this.track=e;const r=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(r),gj(this.sourceNode),s){const e=s.clone();e.enabled=!0,this.clonedTrack=e,aO.debug("create an unmuted track ".concat(e.id," from the original track ").concat(s.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));gj(t),this.originVolumeLevelAnalyser=new xj,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=r;const i=qC();t&&i.os===GC.IOS&&Number(null===(n=i.osVersion)||void 0===n?void 0:n.split(".")[0])<15&&(mj.on(bO.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),gj(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(zO.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),mj.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),aO.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([t]));gj(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function bj(e,t,s){const n=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,r={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function wj(e,t){const s=await Nj(e.mediaSource),{sourceId:n,audio:r}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new sp((s,n)=>{const r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",n(e)};let d=t;const u=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=d,e.onchange=()=>{d=e.checked},u.appendChild(e),u.appendChild(t)}c.appendChild(u),c.appendChild(l),i.appendChild(a),i.appendChild(o),i.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(r),h.appendChild(i),document.body.appendChild(h),e.map(e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let n=e.thumbnail;try{const{width:e}=n.getSize();e>1920&&(n=n.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+n.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",t.onclick=()=>{document.body.removeChild(h),s({sourceId:e.id,audio:d})},o.appendChild(t)}})})}(s,t);return await bj(n,e,r)}async function Nj(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const s=zR();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new IR(RR.ELECTRON_IS_NULL);let n=null;try{var r;n=(null===(r=s.desktopCapturer)||void 0===r?void 0:r.getSources({types:t}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){n=null}n&&n.then||(n=new sp((e,n)=>{s.desktopCapturer.getSources({types:t},(t,s)=>{t?n(t):e(s)})}));try{return await n}catch(e){throw new IR(RR.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const Sj=new UI("safari");let Tj=!1,Cj=!1;async function Rj(e,t){let s=0,n=null;for(;s<2;)try{n=await Ij(e,t,s>0);break}catch(e){if(e instanceof IR)throw aO.error("[".concat(t,"] ").concat(e.toString())),e;const n=Aj(e.name||e.code||e,e.message);if(n.code===RR.MEDIA_OPTION_INVALID){aO.debug("[".concat(t,"] detect media option invalid, retry")),s+=1,await NI(500);continue}throw aO.error("[".concat(t,"] ").concat(n.toString())),n}if(!n)throw new IR(RR.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n}async function Ij(e,t,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new IR(RR.NOT_SUPPORTED,"can not find getUserMedia");s&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const n=yO(),r=new MediaStream;if(e.audioSource&&r.addTrack(e.audioSource),e.videoSource&&r.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return aO.debug("Using Video Source/ Audio Source"),r;if(e.screen)if(zR())e.screen.sourceId?Oj(r,await bj(e.screen.sourceId,e.screen,!!e.screenAudio)):Oj(r,await wj(e.screen,!!e.screenAudio));else if(ZC()&&e.screen.extensionId&&e.screen.mandatory){if(!n.getStreamFromExtension)throw new IR(RR.NOT_SUPPORTED,"This browser does not support screen sharing");aO.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const s=await(a=e.screen.extensionId,o=t,new sp((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},s=>{if(!s||!s.streamId)return aO.error("[".concat(o,"] No response from Chrome Plugin. Plugin not installed properly"),s),void t(new IR(RR.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(s.streamId)})}catch(e){aO.error("[".concat(o,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),e.toString()),t(new IR(RR.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=s,Oj(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(n.getDisplayMedia){var i;e.screen.mediaSource&&LO(e.screen.mediaSource);const s={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(i=e.screen.displaySurface)&&void 0!==i?i:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:n,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c}=e.screen,l={selfBrowserSurface:n,surfaceSwitching:a,systemAudio:o,preferCurrentTab:c};!n&&delete l.selfBrowserSurface,!a&&delete l.surfaceSwitching,!o&&delete l.systemAudio,!c&&delete l.preferCurrentTab,aO.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:s,audio:e.screenAudio,controls:l})),Oj(r,await navigator.mediaDevices.getDisplayMedia(lj({video:s,audio:e.screenAudio},l)))}else{if(!sR())throw aO.error("[".concat(t,"] This browser does not support screenSharing")),new IR(RR.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&LO(e.screen.mediaSource);const s={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};aO.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(s))),Oj(r,await navigator.mediaDevices.getUserMedia(s))}}var a,o;if(!e.video&&!e.audio)return r;let c={video:e.video,audio:e.audio},l=RA("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=OI(c,l)}catch(e){}aO.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),qC();let d,u=null;($C()||nR()||QC())&&(u=await Sj.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw u&&u(),e}return c.audio&&(Tj=!0),c.video&&(Cj=!0),Oj(r,d),u&&u(),r}function Aj(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new IR(RR.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new IR(RR.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new IR(RR.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new IR(RR.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new IR(RR.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new IR(RR.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return aO.error("getUserMedia unexpected error",e),new IR(RR.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Oj(e,t){const s=e.getVideoTracks()[0],n=e.getAudioTracks()[0],r=t.getVideoTracks()[0],i=t.getAudioTracks()[0];i&&(n&&e.removeTrack(n),e.addTrack(i)),r&&(s&&e.removeTrack(s),e.addTrack(r))}const jj=new class extends HR{get state(){return this._state}set state(e){e!==this._state&&(this.emit(tj.STATE_CHANGE,e),this._state=e)}constructor(){super(),oj(this,"_state",ej.IDLE),oj(this,"isAccessMicrophonePermission",!1),oj(this,"isAccessCameraPermission",!1),oj(this,"lastAccessMicrophonePermission",!1),oj(this,"lastAccessCameraPermission",!1),oj(this,"checkdeviceMatched",!1),oj(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(RA("ENUMERATE_DEVICES_INTERVAL")||(wR()||XC()===GC.HARMONY_OS)&&bR())&&this.updateDevicesInfo()},RA("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>aO.error(e.toString()))}async enumerateDevices(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new IR(RR.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const n=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(n);let i=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;r.audio&&(i=!1),r.video&&(a=!1);let o=null,c=null,l=null;if(!s&&(i||a)){if(Sj.isLocked&&(aO.debug("[device manager] wait GUM lock"),(await Sj.lock())(),aO.debug("[device manager] GUM unlock")),Tj&&(i=!1,this.isAccessMicrophonePermission=!0),Cj&&(a=!1,this.isAccessCameraPermission=!0),aO.debug("[device manager] check media device permissions",e,t,i,a),i&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=Aj(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(i){try{o=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=Aj(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=Aj(e.name||e.code||e,e.message);if(t.code===RR.PERMISSION_DENIED)throw t;aO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}aO.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,e}catch(e){return o&&o.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop()),o=null,c=null,l=null,new IR(RR.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audioinput"===e.kind)}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(e=>"videoinput"===e.kind)}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audiooutput"===e.kind)}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(s=>{s.device.label===e&&(t=s.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===e);if(!t)throw new IR(RR.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=ej.INITING;try{await this.updateDevicesInfo(),this.state=ej.INITEND}catch(e){throw aO.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ej.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new IR(RR.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),s=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find(e=>"audioinput"===e.kind&&"default"===e.deviceId),s=e.find(e=>"audiooutput"===e.kind&&"default"===e.deviceId);t&&s?s.groupId===t.groupId?aO.debug("[device-check] default input ".concat(t.label," and output ").concat(s.label," is the same group")):aO.debug("[device-check] default input ".concat(t.label," and output ").concat(s.label," is not the same group")):aO.debug("[device-check] default input or output not found")}const n=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(e=>{if(!e.deviceId)return;const n=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(n?n.state:"INACTIVE")){const n={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),n),s.push(n)}n&&(n.updateAt=t)}),this.deviceInfoMap.forEach((e,n)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",s.push(e))}),this.state!==ej.INITEND)return n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tj.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(tj.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tj.PLAYOUT_DEVICE_CHANGED,e)}}),n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(e=>"audioinput"===e.kind),s=e.filter(e=>"videoinput"===e.kind),n={audio:!1,video:!1};for(const r of t)if(r.label&&r.deviceId){n.audio=!0;break}for(const r of s)if(r.label&&r.deviceId){n.video=!0;break}return n}};let kj=!1;const Dj=new class extends HR{constructor(){super(...arguments),oj(this,"onAutoplayFailed",void 0),oj(this,"onAudioAutoplayFailed",void 0)}};function Pj(){if(qC(),!kj){const e=t=>{t.preventDefault(),kj=!1,NR()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};kj=!0,NR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),aO.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Dj.onAutoplayFailed?Dj.onAutoplayFailed():Dj.onAudioAutoplayFailed?aO.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):aO.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Dj.emit("autoplay-failed")}}function Lj(e,t,s,n){if(!e)return;const r=mO.getBaseInfoBySessionId(e);if(!r)return;const i=r.info,a=Date.now(),o=lj(lj({},i),{},{vid:void 0===i.vid?0:Number(i.vid),lts:a,elapse:a-r.startTime,cbRegistered:Dj.onAutoplayFailed||Dj.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:t,trackId:n,extend:void 0});mO.send({type:uO.AUTOPLAY_FAILED,data:o},!0)}const Mj=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Uj=new class{constructor(){oj(this,"onAutoplayFailed",void 0),oj(this,"elementMap",new Map),oj(this,"elementStateMap",new Map),oj(this,"elementsNeedToResume",[]),oj(this,"sinkIdMap",new Map),oj(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[s,n]=t;const r=this.elementStateMap.get(s),i=n.srcObject.getAudioTracks()[0],a=i&&i.readyState;if(aO.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return n.pause(),void n.play();if("running"===mj.curState)return fR()?(n.pause(),void n.play()):void(r&&"paused"===r&&n.play())}})}),oj(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,s]=e;const n=s.srcObject.getAudioTracks()[0];n&&"live"===n.readyState&&(aO.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),mj.on(bO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mj.on(bO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),mj.on(bO.STATE_CHANGE,()=>{nR()&&"suspended"===mj.prevState&&"running"===mj.curState&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const s=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),s)try{await s.setSinkId(t)}catch(e){throw new IR(RR.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,s,n){if(this.elementMap.has(t))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,r),this.elementMap.set(t,r),this.elementStateMap.set(t,sj.INIT),this.setVolume(t,s);const i=this.sinkIdMap.get(t);if(i)try{r.setSinkId(i).catch(e=>{aO.warning("[".concat(t,"] set sink id failed"),e.toString())})}catch(e){aO.warning("[".concat(t,"] set sink id failed"),e.toString())}const a=r.play();a&&a.then&&a.catch(e=>{n&&Lj(n,"audio",e.message,t),aO.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(aO.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),hI(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Pj()}))})}updateTrack(e,t){const s=this.elementMap.get(e);s&&(s.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const s=this.elementMap.get(e);s&&(t=Math.max(0,Math.min(100,t)),s.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const s=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(s,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Mj.forEach(s=>{t.addEventListener(s,s=>{const n=this.elementStateMap.get(e),r="pause"===s.type?"paused":s.type;if(aO.debug("[".concat(e,"] audio-element-status change ").concat(n," => ").concat(r)),"error"===s.type){const s=null==t?void 0:t.error;s&&aO.error("[".concat(e,"] media error, code: ").concat(s.code,", message: ").concat(s.message))}this.elementStateMap.set(e,r)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(e=>{aO.debug("Auto resume audio element success")}).catch(e=>{aO.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new sp(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{NR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Vj(){return function(e,t,s){const n=s.value;return"function"==typeof n&&(s.value=function(){this._isClosed&&new IR(RR.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",aO);for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=n.apply(this,t);return r instanceof sp?new sp((e,t)=>{r.then(e).catch(t)}):r}),s}}class Fj extends HR{constructor(e){super(),oj(this,"name","VideoProcessorDestination"),oj(this,"ID","0"),oj(this,"_source",void 0),oj(this,"videoContext",void 0),oj(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new IR(RR.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new IR(RR.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ZO.ON_TRACK,void 0)}}class Bj extends HR{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),oj(this,"constraintsMap",new Map),oj(this,"statsRegistry",[]),oj(this,"usageRegistry",[]),oj(this,"trackId",void 0),oj(this,"direction",void 0),oj(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await iI(this,$O.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var s;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(s=this.constraintsMap).call(s)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return aO.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,s){this.statsRegistry.find(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:s})}unregisterStats(e,t){const s=this.statsRegistry.findIndex(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:s,type:n,cb:r}of this.statsRegistry)try{const i=r();e.push({processorID:t,processorName:s,type:n,stats:i})}catch(e){aO.error(new IR(RR.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let s=t();s instanceof sp&&(s=await s),e.push(lj(lj({},s),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Gj extends HR{constructor(e){super(),oj(this,"name","AudioProcessorDestination"),oj(this,"ID","0"),oj(this,"inputTrack",void 0),oj(this,"inputNode",void 0),oj(this,"audioProcessorContext",void 0),oj(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new IR(RR.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new IR(RR.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ZO.ON_TRACK,void 0),this.emit(ZO.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(ZO.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(ZO.ON_NODE,this.inputNode))}}class Wj extends HR{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,s){super(),oj(this,"constraintsMap",new Map),oj(this,"statsRegistry",[]),oj(this,"audioContext",void 0),oj(this,"trackId",void 0),oj(this,"direction",void 0),oj(this,"usageRegistry",[]),oj(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=s}async getConstraints(){return iI(this,$O.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var s;return aO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(s=this.constraintsMap).call(s)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),aI(this,$O.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,s){this.statsRegistry.find(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:s})}unregisterStats(e,t){const s=this.statsRegistry.findIndex(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:s,type:n,cb:r}of this.statsRegistry)try{const i=r();e.push({processorID:t,processorName:s,type:n,stats:i})}catch(e){aO.error(new IR(RR.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let s=t();s instanceof sp&&(s=await s),e.push(lj(lj({},s),{},{direction:this.direction}))}catch(e){aO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Hj extends HR{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),oj(this,"context",void 0),oj(this,"processSourceNode",void 0),oj(this,"outputTrack",void 0),oj(this,"processedNode",void 0),oj(this,"clonedTrack",void 0),oj(this,"outputNode",void 0),this.outputNode=new Kj}setVolume(){}createOutputTrack(){throw new IR(RR.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Kj{disconnect(){}connect(){}}function zj(e){return new sp((t,s)=>{let n=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const i=nR()?"canplay":"playing";r.addEventListener(i,()=>{const e=r.videoWidth,s=r.videoHeight;!e&&sR()||(n=!0,r.srcObject=null,r.remove(),t([e,s]))}),r.srcObject=new MediaStream([e]),r.play().catch(CI),setTimeout(()=>{n||(r.srcObject=null,r.remove(),t([r.videoWidth,r.videoHeight]))},4e3)})}function qj(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const s=AO(e.encoderConfig);return null!=s.width&&(t.width=s.width),null!=s.height&&(t.height=s.height),!_R()&&s.frameRate&&(t.frameRate=s.frameRate),tR()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),sR()&&(t.frameRate={ideal:30,max:30}),t}function Yj(e){const t={};return _R()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,ZC()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function Xj(e){const t=Yj(e);if(e.encoderConfig){const s=DO(e.encoderConfig);t.channelCount=s.stereo?2:1,t.sampleRate=s.sampleRate,t.sampleSize=s.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),wR()&&(t.sampleRate=void 0),t}const Jj=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:s,width:n,height:r}=e.getMediaStreamTrackSettings();let{frameRate:i=s,width:a=n,height:o=r}=t;if(!i||!a||!o)return;a=kI(a),o=kI(o),i=kI(i);const{max:c,min:l}=function(e,t,s){const n=200*Math.pow(s/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(n),max:Math.floor(4*n)}}(a,o,i),{bitrateMax:d,bitrateMin:u}=t||{};d||aO.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(o,", fps: ").concat(i,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));const{maxFramerate:h}=RA("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(i=Math.min(i,h)),{frameRate:i,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}},Qj=async(e,t,s)=>await(async(e,t,s)=>{const n=function(e){const t=[];for(let s=0;s<e.length;s+=2)t.push(parseInt(e.slice(s,s+2),16));return Uint8Array.from(t)}(PI(""+t+s)).slice(0,16),r=n.slice(0,12),i=await window.crypto.subtle.importKey("raw",n,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,e))})(e.buffer,t,s),Zj=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new sp((s,n)=>{t.toBlob(async e=>{if(t.remove(),e){const n=await $j(e);s({buffer:n,width:t.width,height:t.height})}else n(new IR(RR.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},$j=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var ek,tk,sk,nk,rk,ik,ak,ok,ck,lk,dk,uk,hk,pk,mk,fk,gk,yk,vk,xk,_k,Ek,bk,wk,Nk,Sk,Tk,Ck,Rk,Ik,Ak,Ok,jk,kk,Dk,Pk,Lk,Mk,Uk,Vk;let Fk=(ek=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tk=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),sk=Vj(),nk=VI("LocalAudioTrack","_enabledMutex"),rk=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),ik=Vj(),ak=VI("LocalAudioTrack","_enabledMutex"),ok=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),ck=Vj(),lk=Vj(),dk=Vj(),uk=pO({argsMap:e=>[e.getTrackId()]}),hk=Vj(),pk=pO({argsMap:e=>[e.getTrackId()]}),mk=Vj(),fk=pO({argsMap:e=>[e.getTrackId()]}),gk=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),yk=pO({argsMap:e=>[e.getTrackId()]}),aj((vk=class extends uj{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Uj.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,s,n){super(e,s),oj(this,"trackMediaType",KO.AUDIO),oj(this,"_encoderConfig",void 0),oj(this,"_trackSource",void 0),oj(this,"metadata",[]),oj(this,"_enabled",!0),oj(this,"_volume",100),oj(this,"_useAudioElement",!0),oj(this,"_bypassWebAudio",!1),oj(this,"processor",void 0),oj(this,"_processorContext",void 0),oj(this,"_processorDestination",void 0),oj(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!n,this._trackSource=new Hj,RA("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),RA("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$C()&&!pj?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){jR(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Uj.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void aO.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,aI(this,MO.NEED_REPLACE_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!vO())throw new IR(RR.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Uj.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,s){return this._setEnabled(e,t,s)}async _setEnabled(e,t,s){if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await aI(this,MO.NEED_ENABLE_TRACK,this),aO.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw s||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw s||(this._enabled=!0),aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aI(this,MO.NEED_MUTE_TRACK,this):await aI(this,MO.NEED_UNMUTE_TRACK,this))}getStats(){return gI(()=>{aO.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lj({},qO)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),this._source.on(zO.ON_AUDIO_BUFFER,t=>e(t))}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Uj.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Uj.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Uj.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return sp.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new IR(RR.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this))}),e.on(ZO.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ZO.ON_TRACK),e.removeAllListeners(ZO.ON_NODE)}bindProcessorContextEvents(e){e.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners($O.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Hj&&(this._trackSource=new Ej(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new Wj(this._source.context,this.getTrackId(),"local"),t=new Gj(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(zO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Uj.stop(this.getTrackId()),this._source.play()),aI(this,MO.NEED_REPLACE_MIXING_TRACK,this).then(()=>{aO.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(e=>{aO.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[ek],Object.getOwnPropertyDescriptor(vk.prototype,"setVolume"),vk.prototype),aj(vk.prototype,"setPlaybackDevice",[tk,sk],Object.getOwnPropertyDescriptor(vk.prototype,"setPlaybackDevice"),vk.prototype),aj(vk.prototype,"setEnabled",[nk,rk,ik],Object.getOwnPropertyDescriptor(vk.prototype,"setEnabled"),vk.prototype),aj(vk.prototype,"setMuted",[ak,ok,ck],Object.getOwnPropertyDescriptor(vk.prototype,"setMuted"),vk.prototype),aj(vk.prototype,"getStats",[lk],Object.getOwnPropertyDescriptor(vk.prototype,"getStats"),vk.prototype),aj(vk.prototype,"setAudioFrameCallback",[dk],Object.getOwnPropertyDescriptor(vk.prototype,"setAudioFrameCallback"),vk.prototype),aj(vk.prototype,"play",[uk,hk],Object.getOwnPropertyDescriptor(vk.prototype,"play"),vk.prototype),aj(vk.prototype,"stop",[pk,mk],Object.getOwnPropertyDescriptor(vk.prototype,"stop"),vk.prototype),aj(vk.prototype,"close",[fk],Object.getOwnPropertyDescriptor(vk.prototype,"close"),vk.prototype),aj(vk.prototype,"pipe",[gk],Object.getOwnPropertyDescriptor(vk.prototype,"pipe"),vk.prototype),aj(vk.prototype,"unpipe",[yk],Object.getOwnPropertyDescriptor(vk.prototype,"unpipe"),vk.prototype),vk),Bk=(xk=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),_k=Vj(),Ek=VI("MicrophoneAudioTrack","_enabledMutex"),bk=pO({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),wk=Vj(),Nk=pO({argsMap:e=>[e.getTrackId()]}),aj((Sk=class extends Fk{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,s,n){super(e,t.encoderConfig?DO(t.encoderConfig):{},n,RA("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),oj(this,"_config",void 0),oj(this,"_deviceName","default"),oj(this,"_constraints",void 0),oj(this,"_originalConstraints",void 0),oj(this,"_enabled",!0),this._config=t,this._constraints=s,this._originalConstraints=s,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(fR()||gR())&&mj.bindInterruptDetectorTrack(this)}async setDevice(e){if(aO.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await jj.getDeviceById(e),s={};s.audio=lj({},this._constraints),s.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let n=null;try{n=await Rj(s,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),n=await Rj({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await jj.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,s){if(t)return aO.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),RA("AUTO_RESET_AUDIO_ROUTE")&&(nR()||vR())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var n;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(n=this._source.clonedTrack)||void 0===n||n.stop(),s||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const r=lj({},this._constraints),i=jj.searchDeviceIdByName(this._deviceName);i&&!r.deviceId&&(r.deviceId=i);try{s||(this._enabled=!0);const e=await Rj({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw s||(this._enabled=!1),aO.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(fR()||gR())&&mj.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((nR()||vR())&&this._enabled&&!this._isClosed&&mj.duringInterruption){const e=async()=>{mj.off(bO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mj.on(bO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,s=jj.searchDeviceIdByName(this._deviceName);if(s&&!t.deviceId&&(t.deviceId=s),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await Rj({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,s)=>{try{const s=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(s),t()}catch(e){s(e)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[xk,_k],Object.getOwnPropertyDescriptor(Sk.prototype,"setDevice"),Sk.prototype),aj(Sk.prototype,"setEnabled",[Ek,bk,wk],Object.getOwnPropertyDescriptor(Sk.prototype,"setEnabled"),Sk.prototype),aj(Sk.prototype,"close",[Nk],Object.getOwnPropertyDescriptor(Sk.prototype,"close"),Sk.prototype),Sk),Gk=(Tk=pO({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Ck=Vj(),Rk=pO({argsMap:e=>[e.getTrackId()]}),Ik=Vj(),Ak=pO({argsMap:e=>[e.getTrackId()]}),Ok=Vj(),jk=pO({argsMap:e=>[e.getTrackId()]}),kk=Vj(),Dk=pO({argsMap:e=>[e.getTrackId()]}),Pk=Vj(),Lk=pO({argsMap:e=>[e.getTrackId()]}),Mk=pO({argsMap:e=>[e.getTrackId()]}),Uk=Vj(),aj((Vk=class extends Fk{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,s,n){super(t.createOutputTrack(),s,n),oj(this,"source",void 0),oj(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(zO.AUDIO_SOURCE_STATE_CHANGE,e=>{this.safeEmit(WO.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){jR(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Tk,Ck],Object.getOwnPropertyDescriptor(Vk.prototype,"startProcessAudioBuffer"),Vk.prototype),aj(Vk.prototype,"pauseProcessAudioBuffer",[Rk,Ik],Object.getOwnPropertyDescriptor(Vk.prototype,"pauseProcessAudioBuffer"),Vk.prototype),aj(Vk.prototype,"seekAudioBuffer",[Ak,Ok],Object.getOwnPropertyDescriptor(Vk.prototype,"seekAudioBuffer"),Vk.prototype),aj(Vk.prototype,"resumeProcessAudioBuffer",[jk,kk],Object.getOwnPropertyDescriptor(Vk.prototype,"resumeProcessAudioBuffer"),Vk.prototype),aj(Vk.prototype,"stopProcessAudioBuffer",[Dk,Pk],Object.getOwnPropertyDescriptor(Vk.prototype,"stopProcessAudioBuffer"),Vk.prototype),aj(Vk.prototype,"close",[Lk],Object.getOwnPropertyDescriptor(Vk.prototype,"close"),Vk.prototype),aj(Vk.prototype,"setAudioBufferPlaybackSpeed",[Mk,Uk],Object.getOwnPropertyDescriptor(Vk.prototype,"setAudioBufferPlaybackSpeed"),Vk.prototype),Vk);class Wk extends Fk{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=fj().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,SI(8,"track-mix-")),oj(this,"trackList",void 0),oj(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(aO.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):aO.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){aO.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}dI(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof Wk?t.emit(GO.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class Hk extends _j{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(zO.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),oj(this,"audioBuffer",void 0),oj(this,"sourceNode",void 0),oj(this,"startPlayTime",0),oj(this,"startPlayOffset",0),oj(this,"pausePlayTime",0),oj(this,"options",void 0),oj(this,"currentLoopCount",0),oj(this,"currentPlaybackSpeed",100),oj(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):aO.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Kk=new Map;function zk(e,t){if(0===e.length||0===t.length)return 1/0;const s=DI(e),n=DI(t);return Math.floor(n/s)}class qk{get rendFrameRate(){const e=Math.max(1,zk(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:sj.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(aO.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){oj(this,"trackId",void 0),oj(this,"config",void 0),oj(this,"onFirstVideoFrameDecoded",void 0),oj(this,"onFirstVideoFrameRender",void 0),oj(this,"onVideoStateChanged",void 0),oj(this,"freezeTimeCounterList",[]),oj(this,"renderFreezeAccTime",0),oj(this,"renderFreezeAccTime2",0),oj(this,"isKeepLastFrame",!1),oj(this,"isDestroyed",!1),oj(this,"timeUpdatedCount",0),oj(this,"freezeTime",0),oj(this,"playbackTime",0),oj(this,"lastTimeUpdatedTime",0),oj(this,"autoplayFailed",!1),oj(this,"videoTrack",void 0),oj(this,"videoElement",void 0),oj(this,"cacheVideoElement",void 0),oj(this,"internal",!1),oj(this,"_render_interframe_delays",[]),oj(this,"_render_interframe_delays_sizes",[]),oj(this,"_videoState",nj.VideoStateStopped),oj(this,"videoElementCheckInterval",void 0),oj(this,"videoElementFreezeTimeout",void 0),oj(this,"_videoElementStatus",sj.NONE),oj(this,"_isInPage",!0),oj(this,"isGettingVideoDimensions",!1),oj(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return aO.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),oj(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===mj.curState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),yR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),oj(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":"play"===e.type&&aO.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=sj.PLAYING;break;case"loadeddata":if(this.videoState=nj.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=sj.CANPLAY;break;case"stalled":this.videoElementStatus=sj.STALLED;break;case"suspend":this.videoElementStatus=sj.SUSPEND;break;case"pause":this.videoElementStatus=sj.PAUSED,nR()||vR()||$C()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=sj.WAITING;break;case"abort":this.videoElementStatus=sj.ABORT;break;case"ended":this.videoElementStatus=sj.ENDED;break;case"emptied":this.videoElementStatus=sj.EMPTIED;break;case"error":{const e=this.videoElement.error;e&&(this.videoElementStatus=sj.ERROR,aO.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,ZD.lastVisibleTime<ZD.lastHiddenTime||s<ZD.lastHiddenTime||s<ZD.lastVisibleTime)return;if(this.isSkipCalcRenderFreezeTime())return;for(t>RA("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),oj(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(aO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(JC())),yR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),mj.on(bO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mj.on(bO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch(t=>{e&&Lj(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(aO.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):aO.warning("[".concat(this.trackId,"] play warning: "),t)});const s=qC();if(("Safari"===s.name&&15===Number(s.version)||fR())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return aO.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const s=t.getImageData(0,0,e.width,e.height);return e.remove(),s}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const n=s.getContext("2d");return n?(n.drawImage(this.videoElement,0,0,s.width,s.height),new sp((n,r)=>{s.toBlob(async e=>{if(s.remove(),e){const t=await $j(e);n({buffer:t,width:s.width,height:s.height})}else r(new IR(RR.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await Zj(e)}destroy(){this.isDestroyed=!0,mj.off(bO.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mj.off(bO.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=nj.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=sj.INIT,!this.videoElementCheckInterval&&(Yk.forEach(e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(e){return e!==document.body&&document.body.contains(e)}(this.videoElement)},1e3),RA("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let s;const n=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",n),this.videoElementFreezeTimeout=window.setTimeout(r,RA("VIDEO_FREEZE_DURATION")))},r=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===nj.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=nj.VideoStateFrozen:document.addEventListener("visibilitychange",n))},i=(e,t)=>{if(this.videoElementStatus===sj.PLAYING){if(s){const e=t.presentationTime-s.presentationTime,n=t.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(n),this._render_interframe_delays.push(e);const i=DI(this._render_interframe_delays_sizes),a=i-this._render_interframe_delays_sizes[0];if(i>30&&a>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===nj.VideoStateStarting&&(this.videoState=nj.VideoStateDecoding),this.videoState===nj.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(r,RA("VIDEO_FREEZE_DURATION"))),e<RA("VIDEO_FREEZE_DURATION")&&this.videoState===nj.VideoStateFrozen&&(this.videoState=nj.VideoStateDecoding),e>RA("VIDEO_FREEZE_DURATION")&&ZD.lastVisibleTime>=ZD.lastHiddenTime&&s.timestamp>ZD.lastVisibleTime&&s.timestamp>ZD.lastHiddenTime){const t=Math.min(66,zk(this._render_interframe_delays_sizes,this._render_interframe_delays)),s=Math.max(0,e-(n-1)*t);this.renderFreezeAccTime2+=s>t?s:0,this.renderFreezeAccTime+=e}}s=lj(lj({},t),{},{timestamp:e})}else this.isSkipCalcRenderFreezeTime()&&(s=lj(lj({},t),{},{timestamp:e}));var n,a;RA("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(n=(a=this.videoElement).requestVideoFrameCallback)||void 0===n||n.call(a,i))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,i)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),wR()&&!RA("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=qC();"Safari"===s.name&&15===Number(s.version)||fR()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,sR()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,sR()&&this.videoElement.load());const n=this.videoElement.play();void 0!==n&&n.catch(e=>{aO.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}resetVideoElement(){Yk.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=sj.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===sj.DESTROYED||this.internal}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{aO.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(e=>{aO.error(e)}),this.autoplayFailed=!1,NR()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};NR()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Pj()}}const Yk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Xk extends qk{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),oj(this,"container",void 0),oj(this,"slot",void 0),this.slot=e.element,this.internal=t,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;var s;!this.internal||this.slot?(t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()):(this.slot=t,t&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",null===(s=this.slot)||void 0===s||s.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,s):await Zj(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),null===(e=this.slot)||void 0===e||e.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",RA("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),null===(e=this.slot)||void 0===e||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Jk,Qk,Zk,$k,eD,tD,sD,nD,rD,iD,aD,oD,cD,lD,dD,uD,hD,pD,mD,fD,gD,yD,vD,xD,_D,ED,bD,wD,ND,SD,TD,CD,RD,ID,AD,OD,jD,kD;let DD=(Jk=pO({argsMap:(e,t,s)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),Qk=Vj(),Zk=pO({argsMap:e=>[e.getTrackId()]}),$k=VI("LocalVideoTrack","_enabledMutex"),eD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),tD=Vj(),sD=VI("LocalVideoTrack","_enabledMutex"),nD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),rD=Vj(),iD=pO({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),aD=Vj(),oD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),cD=Vj(),lD=Vj(),dD=pO({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),uD=Vj(),hD=Vj(),pD=Vj(),mD=pO({argsMap:e=>[e.getTrackId()]}),fD=Vj(),gD=Vj(),yD=Vj(),vD=Vj(),xD=Vj(),_D=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ED=pO({argsMap:e=>[e.getTrackId()]}),bD=pO({argsMap:e=>[e.getTrackId()]}),wD=pO({argsMap:(e,t,s)=>[e.getTrackId(),t.label,s]}),ND=class e extends uj{get videoHeight(){if($C()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if($C()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==sj.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,s,n,r,i){if(super(e,r),oj(this,"trackMediaType",KO.VIDEO),oj(this,"_player",void 0),oj(this,"isUseScaleResolutionDownBy",!1),oj(this,"_videoVisibleTimer",null),oj(this,"_previousVideoVisibleStatus",void 0),oj(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oj(this,"_encoderConfig",void 0),oj(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),oj(this,"_optimizationMode",void 0),oj(this,"_saveEncodeBitrateRatio",1),oj(this,"_videoHeight",void 0),oj(this,"_videoWidth",void 0),oj(this,"_forceBitrateLimit",void 0),oj(this,"_enabled",!0),oj(this,"_processorDestination",void 0),oj(this,"_processorContext",void 0),$C()){const{width:t,height:s}=e.getSettings();this._videoWidth=t,this._videoHeight=s}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=s,this._optimizationMode=n,this._hints=i||[],t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)?this._encoderConfig=pI(t):this._encoderConfig=t,-1===this._hints.indexOf(UO.SCREEN_TRACK))this.updateBitrateFromProfile();else if(aR(WC.CHROME,115)&&-1!==XC().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&yO().supportWebRTCInsertableStream){const s=new MediaStreamTrackProcessor(e),n=new MediaStreamTrackGenerator({kind:"video"});let r,i,a=Date.now();const o=()=>{c&&(clearInterval(c),c=void 0),r&&(r.close(),r=void 0),e.stop(),i=void 0,n.removeEventListener("ended",o)};let c=window.setInterval(()=>{if(i&&r&&Date.now()-a>(null!=t?t:1e3))try{"live"===n.readyState?i.enqueue(r.clone()):o()}catch(e){o()}},null!=t?t:1e3);const l=new TransformStream({transform:(e,t)=>{"live"===n.readyState?(i=t,a=Date.now(),void 0===r?(r=e,t.enqueue(e.clone())):(t.enqueue(r),r=e)):e.close()}});return n.addEventListener("ended",o),s.readable.pipeThrough(l).pipeTo(n.writable),n}}(e);t&&(aO.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(UO.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new Bj(this.getTrackId(),"local"),this._processorDestination=new Fj(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const s=lj(lj(lj({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(s):(e instanceof HTMLVideoElement?this._player=new qk(s):this._player=new Xk(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(WO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},RA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,aO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await aI(this,MO.NEED_MUTE_TRACK,this):await aI(this,MO.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._saveEncodeBitrateRatio;if(1!==this._saveEncodeBitrateRatio&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),aO.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=AO(e),RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=qj({encoderConfig:e});($C()||nR()||vR())&&(t.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new IR(RR.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}getStats(){return gI(()=>{aO.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lj({},YO)}async setBeautyEffect(e){aO.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await Zj(e)}async findClosestProfile(){const{width:e,height:t,frameRate:s}=this.getMediaStreamTrackSettings(),{width:n,height:r,frameRate:i}=this._encoderConfig||{},a=kI(this._videoWidth||e||n||0),o=kI(this._videoHeight||t||r||0),c=function(e,t,s){if(!Array.isArray(RA("VIDEO_ENCODER_CONFIG_LIST")))return!1;if(0===RA("VIDEO_ENCODER_CONFIG_LIST").length)return!1;const n=Math.min(e,t);return!(n>=480)&&lj(lj({},RA("VIDEO_ENCODER_CONFIG_LIST").find(e=>e.height>n)),{},{frameRate:s})}(a,o,kI(s||i||15));if(c)return aO.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(a,"x").concat(o," => ").concat(JSON.stringify(c))),this.setEncoderConfiguration(c)}async setBitrateLimit(e){aO.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void aO.error(RR.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await aI(this,MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,aO.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return aO.error(RR.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,aO.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){zj(this._originMediaStreamTrack).then(e=>{let[t,s]=e;this._videoHeight=s,this._videoWidth=t}).catch(CI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");aO.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=AO(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:s}=this.getMediaStreamTrackSettings();if(!e||!t||!s)return;const{bitrateMax:n,bitrateMin:r}=this._encoderConfig;if(null==r||null==n){const{max:i,min:a}=function(e,t,s,n,r){const i=RA("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===i)return{min:n,max:r};if(void 0===r){const a=Math.floor(200*Math.pow(s/15,.6)*Math.pow(e*t/640/360,.75));r="STANDARD_BITRATE"===i?4*a:2*a,n=null!=n?n:a}else n=null!=n?n:Math.floor(r/10);return{min:n,max:r}}(e,t,s,r,n);if(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=i,RA("VIDEO_STANDARD_BITRATE_VERSION")&&null==r&&null==n){const[n,r]=function(e,t,s){const n=4*Math.floor(2e5*Math.pow(s/15,.6)*Math.pow(e*t/230400,.75)),r=e*t,i=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),a=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let o=up(i).call(i).next().value,c=1;if(i.has(r))o=i.get(r);else{var l;const e=Xp(l=Array.from(i.entries())).call(l,(e,t)=>{let[s]=e,[n]=t;return s-n}),t=e.find(e=>{let[t]=e;return t>r});if(t){const s=e.indexOf(t);if(s>0){const n=e[s-1],i=(r-n[0])/(t[0]-n[0]);o=n[1]+i*(t[1]-n[1])}else o=t[1]}else o=e[e.length-1][1]}if(a.has(r))c=a.get(r);else{var d;const e=Xp(d=Array.from(a.entries())).call(d,(e,t)=>{let[s]=e,[n]=t;return s-n}),t=e.find(e=>{let[t]=e;return t>r});if(t){const s=e.indexOf(t);if(s>0){const n=e[s-1],i=(r-n[0])/(t[0]-n[0]);c=n[1]+i*(t[1]-n[1])}else c=t[1]}else c=e[e.length-1][1]}const u=RA("VIDEO_NEW_BITRATE_RATIO");u&&u>0&&(o=u/100);const h=Math.floor(n*o),p=Math.floor(65e4*Math.pow(e*t/230400,.5)*Math.pow(s/15,.69));let m=h;const f=RA("VIDEO_STANDARD_BITRATE_VERSION");return f&&f>0&&(1===f?m=n:2===f?m=h:3===f&&(m=p)),[Math.floor(m/1e3),c]}(e,t,s);this._encoderConfig.bitrateMax=n,this._encoderConfig.bitrateMin=a?Math.min(a,n):n,this._saveEncodeBitrateRatio=r,aO.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(s,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else aO.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(s,"] => [brMax: ").concat(i,", brMin: ").concat(a,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;const s=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),n={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==s?void 0:s.parentElement},{element:r,slot:i}=n;if(this.isPlaying&&r instanceof HTMLVideoElement&&i instanceof HTMLElement){const e=FR.checkOneElementVisible(r),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new IR(RR.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._encoderConfig;t&&(n=lj(lj({},n),AO(t))),n=mI(n);const r=SI(8,"track-video-cloned-"),i=new e(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,mI(this._scalabilityMode),this._optimizationMode,r,mI(this._hints));return t&&n&&i.setEncoderConfiguration(n),aO.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(s)),i}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new IR(RR.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new IR(RR.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(gI(()=>{mO.reportApiInvoke(null,{name:qR.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:YR.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!RA("ENABLE_VIDEO_SEI")||!RA("ENABLE_ENCODED_TRANSFORM"))return void aO.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new IR(RR.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void aO.warning("Video track is not published, SEI can not be send");const s=t.sender.getParameters();if(0===s.codecs.length)return;const n=s.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===n||"video/h265"===n?this.safeEmit("sei-to-send",e):aO.warning("SEI is not supported by ".concat(n))}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await aI(this,MO.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($O.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($O.REQUEST_CONSTRAINTS)}},aj(ND.prototype,"play",[Jk,Qk],Object.getOwnPropertyDescriptor(ND.prototype,"play"),ND.prototype),aj(ND.prototype,"stop",[Zk],Object.getOwnPropertyDescriptor(ND.prototype,"stop"),ND.prototype),aj(ND.prototype,"setEnabled",[$k,eD,tD],Object.getOwnPropertyDescriptor(ND.prototype,"setEnabled"),ND.prototype),aj(ND.prototype,"setMuted",[sD,nD,rD],Object.getOwnPropertyDescriptor(ND.prototype,"setMuted"),ND.prototype),aj(ND.prototype,"setSaveEncodeBitrateRatio",[iD,aD],Object.getOwnPropertyDescriptor(ND.prototype,"setSaveEncodeBitrateRatio"),ND.prototype),aj(ND.prototype,"setEncoderConfiguration",[oD,cD],Object.getOwnPropertyDescriptor(ND.prototype,"setEncoderConfiguration"),ND.prototype),aj(ND.prototype,"getStats",[lD],Object.getOwnPropertyDescriptor(ND.prototype,"getStats"),ND.prototype),aj(ND.prototype,"setBeautyEffect",[dD,uD],Object.getOwnPropertyDescriptor(ND.prototype,"setBeautyEffect"),ND.prototype),aj(ND.prototype,"getCurrentFrameData",[hD],Object.getOwnPropertyDescriptor(ND.prototype,"getCurrentFrameData"),ND.prototype),aj(ND.prototype,"getCurrentFrameImage",[pD],Object.getOwnPropertyDescriptor(ND.prototype,"getCurrentFrameImage"),ND.prototype),aj(ND.prototype,"findClosestProfile",[mD,fD],Object.getOwnPropertyDescriptor(ND.prototype,"findClosestProfile"),ND.prototype),aj(ND.prototype,"setBitrateLimit",[gD],Object.getOwnPropertyDescriptor(ND.prototype,"setBitrateLimit"),ND.prototype),aj(ND.prototype,"setOptimizationMode",[yD],Object.getOwnPropertyDescriptor(ND.prototype,"setOptimizationMode"),ND.prototype),aj(ND.prototype,"setScalabiltyMode",[vD],Object.getOwnPropertyDescriptor(ND.prototype,"setScalabiltyMode"),ND.prototype),aj(ND.prototype,"updateMediaStreamTrackResolution",[xD],Object.getOwnPropertyDescriptor(ND.prototype,"updateMediaStreamTrackResolution"),ND.prototype),aj(ND.prototype,"pipe",[_D],Object.getOwnPropertyDescriptor(ND.prototype,"pipe"),ND.prototype),aj(ND.prototype,"unpipe",[ED],Object.getOwnPropertyDescriptor(ND.prototype,"unpipe"),ND.prototype),aj(ND.prototype,"close",[bD],Object.getOwnPropertyDescriptor(ND.prototype,"close"),ND.prototype),aj(ND.prototype,"replaceTrack",[wD],Object.getOwnPropertyDescriptor(ND.prototype,"replaceTrack"),ND.prototype),ND),PD=(SD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),TD=Vj(),CD=VI("CameraVideoTrack","_enabledMutex"),RD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),ID=Vj(),AD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),OD=Vj(),jD=pO({argsMap:e=>[e.getTrackId()]}),kD=class e extends DD{get __className__(){return"CameraVideoTrack"}constructor(e,t,s,n,r,i){super(e,AO(t.encoderConfig),n,r,i),oj(this,"_config",void 0),oj(this,"_originalConstraints",void 0),oj(this,"_constraints",void 0),oj(this,"_enabled",!0),oj(this,"_deviceName","default"),oj(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(fR()||gR())&&!function(){const e=qC();if(e.os!==GC.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&xR()&&this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=s,this._constraints=s,this._deviceName=e.label,this._encoderConfig=AO(this._config.encoderConfig),mj.on(bO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mj.on(bO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(aO.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await jj.getDeviceById(e),s={};s.video=lj({},this._constraints),s.video.deviceId={exact:e},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let n=null;try{n=await Rj(s,this.getTrackId())}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),n=await Rj({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await jj.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){aO.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:lj(lj({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await Rj(t,this.getTrackId())}catch(t){throw aO.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await Rj({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=lj({},t.video),aO.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(aO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await Rj({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await aI(this,MO.NEED_ENABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),aO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await aI(this,MO.NEED_DISABLE_TRACK,this)}catch(e){throw aO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}aO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new IR(RR.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=AO(e),RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const s=pI(this._config);s.encoderConfig=e;const n=qj(s);($C()||nR()||vR())&&(n.deviceId=void 0),aO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(e){const t=new IR(RR.UNEXPECTED_ERROR,e.toString());throw aO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=s,this._constraints=n,this._originalConstraints=n,this._encoderConfig=e,-1===this._hints.indexOf(UO.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await aI(this,MO.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(aO)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((nR()||vR())&&this._enabled&&!this._isClosed&&mj.duringInterruption){const e=async()=>{mj.off(bO.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(aO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mj.on(bO.IOS_INTERRUPTION_END,e)}else aO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(WO.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,s=jj.searchDeviceIdByName(this._deviceName);if(s&&!t.deviceId&&(t.deviceId={exact:s}),this._enabled){const e=await Rj({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),mj.off(bO.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mj.off(bO.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._encoderConfig;t&&(n=lj(lj({},n),AO(t))),n=mI(n);const r=SI(8,"track-cam-cloned-"),i=new e(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,mI(lj(lj({},this._config),{},{encoderConfig:n})),mI(this._constraints),mI(this._scalabilityMode),this._optimizationMode,r);return t&&n&&i.setEncoderConfiguration(n),aO.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(s)),i}bindProcessorContextEvents(){this.processorContext.on($O.REQUEST_UPDATE_CONSTRAINTS,async(e,t,s)=>{try{const s=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(s),t()}catch(e){s(e)}}),this.processorContext.on($O.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},aj(kD.prototype,"setDevice",[SD,TD],Object.getOwnPropertyDescriptor(kD.prototype,"setDevice"),kD.prototype),aj(kD.prototype,"setEnabled",[CD,RD,ID],Object.getOwnPropertyDescriptor(kD.prototype,"setEnabled"),kD.prototype),aj(kD.prototype,"setEncoderConfiguration",[AD,OD],Object.getOwnPropertyDescriptor(kD.prototype,"setEncoderConfiguration"),kD.prototype),aj(kD.prototype,"close",[jD],Object.getOwnPropertyDescriptor(kD.prototype,"close"),kD.prototype),kD);function LD(e,t,s,n){s.optimizationMode&&(n&&n.width&&n.height?(s.encoderConfig=lj(lj({},n),{},{bitrateMin:n.bitrateMin,bitrateMax:n.bitrateMax}),"motion"!==s.optimizationMode&&"detail"!==s.optimizationMode||(t.contentHint=s.optimizationMode,t.contentHint===s.optimizationMode?aO.debug("[".concat(e,"] set content hint to"),s.optimizationMode):aO.debug("[".concat(e,"] set content hint failed")))):aO.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MD,UD,VD,FD,BD,GD,WD,HD,KD,zD,qD,YD;class XD extends dj{getUserId(){return this._userId}constructor(e,t,s,n){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(n.clientId,"_").concat(SI(5,""))),oj(this,"_userId",void 0),oj(this,"_uintId",void 0),oj(this,"_isDestroyed",!1),oj(this,"store",void 0),oj(this,"processor",void 0),oj(this,"processorContext",void 0),this._userId=t,this._uintId=s,this.store=n}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,aO.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let JD=(MD=pO({argsMap:(e,t,s)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),UD=pO({argsMap:e=>[e.getTrackId()]}),VD=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FD=pO({argsMap:e=>[e.getTrackId()]}),aj((BD=class extends XD{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==sj.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,s,n,r){super(e,t,s,n),oj(this,"_videoVisibleTimer",null),oj(this,"_previousVideoVisibleStatus",void 0),oj(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oj(this,"trackMediaType",KO.VIDEO),oj(this,"_videoWidth",void 0),oj(this,"_videoHeight",void 0),oj(this,"_player",void 0),oj(this,"_prePlayer",void 0),oj(this,"processorDestination",void 0),oj(this,"processorContext",void 0),this._prePlayer=r,this.updateMediaStreamTrackResolution(),this.processorContext=new Bj(this.getTrackId(),"remote"),this.processorDestination=new Fj(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return gI(()=>{aO.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lj({},QO)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.safeEmit(HO.PLAY_START),"string"==typeof e){const t=document.getElementById(e);t?e=t:(aO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}aO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const s=lj(lj({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(s);else{let t=!1,n=!1;e instanceof HTMLVideoElement?(this._player=new qk(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,n=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,t=this._player.videoState>0,this._player.updateConfig(s)):this._player=new Xk(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(HO.FIRST_FRAME_DECODED),n&&this.safeEmit(HO.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=e=>{this.safeEmit(HO.VIDEO_STATE_CHANGED,e)},t&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(HO.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},RA("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(HO.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,aO.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){zj(this._originMediaStreamTrack).then(e=>{let[t,s]=e;this._videoHeight=s,this._videoWidth=t}).catch(CI)}_updatePlayerSource(){aO.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const s=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),n={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==s?void 0:s.parentElement},{element:r,slot:i}=n;if(this.isPlaying&&r instanceof HTMLVideoElement&&i instanceof HTMLElement){const e=FR.checkOneElementVisible(r),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new IR(RR.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(GO.SEI_RECEIVED,e)}}).prototype,"play",[MD],Object.getOwnPropertyDescriptor(BD.prototype,"play"),BD.prototype),aj(BD.prototype,"stop",[UD],Object.getOwnPropertyDescriptor(BD.prototype,"stop"),BD.prototype),aj(BD.prototype,"pipe",[VD],Object.getOwnPropertyDescriptor(BD.prototype,"pipe"),BD.prototype),aj(BD.prototype,"unpipe",[FD],Object.getOwnPropertyDescriptor(BD.prototype,"unpipe"),BD.prototype),BD),QD=(GD=pO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),WD=pO({argsMap:(e,t)=>[e.getTrackId(),t]}),HD=pO({argsMap:e=>[e.getTrackId()]}),KD=pO({argsMap:e=>[e.getTrackId()]}),zD=pO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),qD=pO({argsMap:e=>[e.getTrackId()]}),aj((YD=class extends XD{get isPlaying(){return this._useAudioElement?Uj.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,s,n){super(e,t,s,n),oj(this,"trackMediaType",KO.AUDIO),oj(this,"_source",void 0),oj(this,"_useAudioElement",!0),oj(this,"_volume",100),oj(this,"processorContext",void 0),oj(this,"processorDestination",void 0),oj(this,"_played",!1),oj(this,"_bypassWebAudio",!1),RA("DISABLE_WEBAUDIO")?(this._source=new Hj,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Ej(e,!0),RA("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(zO.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(HO.FIRST_FRAME_DECODED)}),this.processorContext=new Wj(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Gj(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(zO.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zO.ON_AUDIO_BUFFER),this._source.on(zO.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){this._volume=e,this._useAudioElement?Uj.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!vO())throw new IR(RR.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Uj.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return gI(()=>{aO.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),oI(this,MO.GET_STATS)||lj({},XO)}play(){aO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(aO.debug("[".concat(this.getTrackId(),"] use audio element to play")),Uj.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){aO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Uj.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];aO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Uj.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new IR(RR.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ZO.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ZO.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ZO.ON_TRACK),this.processorDestination.removeAllListeners(ZO.ON_NODE)}}).prototype,"setVolume",[GD],Object.getOwnPropertyDescriptor(YD.prototype,"setVolume"),YD.prototype),aj(YD.prototype,"setPlaybackDevice",[WD],Object.getOwnPropertyDescriptor(YD.prototype,"setPlaybackDevice"),YD.prototype),aj(YD.prototype,"play",[HD],Object.getOwnPropertyDescriptor(YD.prototype,"play"),YD.prototype),aj(YD.prototype,"stop",[KD],Object.getOwnPropertyDescriptor(YD.prototype,"stop"),YD.prototype),aj(YD.prototype,"pipe",[zD],Object.getOwnPropertyDescriptor(YD.prototype,"pipe"),YD.prototype),aj(YD.prototype,"unpipe",[qD],Object.getOwnPropertyDescriptor(YD.prototype,"unpipe"),YD.prototype),YD);const ZD=new class extends HR{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),oj(this,"_lastHiddenTime",0),oj(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),aO.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class $D extends HR{constructor(e,t){super(),oj(this,"trackMediaType",KO.DATA),oj(this,"_version",1),oj(this,"_type",3),oj(this,"_config",void 0),oj(this,"_originDataChannel",void 0),oj(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),oj(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),oj(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return RA("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new sp((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const s=setTimeout(()=>{var e;t(new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new IR(RR.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[ij.OPEN,ij.CLOSE,ij.ERROR].forEach(t=>{const s=()=>{this.emit(t)};this._datachannelEventMap.set(t,s),e.addEventListener(t,s)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[s,n]=t;e.removeEventListener(s,n)}),this._datachannelEventMap.clear()}}class eP extends $D{constructor(e){super(e),oj(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(t).getUint8(3);if(s!==this.id)return void(RA("SHOW_DATASTREAM2_LOG")&&aO.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let n=e.data.slice(this._dataStreamPacketHeader.byteLength);n=this._dataStreamPacketHandler.deserialize(n),this.emit(ij.MESSAGE,n)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class tP extends $D{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function sP(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Ev.revokeObjectURL(e),0),new Worker(Ev.createObjectURL(e))}const nP=71,rP=1,iP=2,aP=1,oP=2;var cP=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(cP||{});function lP(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=e.getUint8(0);if(s!==nP)return;const n=e.getUint16(1),r=rP+iP+n,i=new Uint8Array(e.byteLength-r);i.set(new Uint8Array(e.buffer,r,e.byteLength-r));const a={m:s,tlvLen:n,tlv:[],frame:i};let o=rP+iP;for(;o<r;){const s=e.getUint8(o),n=e.getUint16(o+aP),r=aP+oP;if(s===cP.AUDIO_LEVEL){let i=e.getUint8(o+r);for(let t=1;t<n;t++)i=i<<8|e.getUint8(o+r+t);a.tlv.push({tag:s,length:n,value:t?127^i>>1:127&i})}else if(s===cP.METADATA||s===cP.AUDIO_64_BIT_PTS){const t=new Uint8Array(n);for(let s=0;s<n;s++)t[s]=e.getUint8(o+r+s);a.tlv.push({tag:s,length:n,value:t})}o+=r+n}return a}const dP=new Map,uP=127,hP=1e-10,pP=139/13,mP=new Map;function fP(e,t,s){const n="".concat(e,"-").concat(t,"-").concat(s);let r=0;if(mP.has(n))r=mP.get(n);else{const i=.5;r=Math.log(function(e,t){const s=e-t;t<s&&(t=s);let n=1;for(let r=e,i=1;r>t;r--,i++)n=n*r/i;return n}(t,e))+e*Math.log(i)+(t-e)*Math.log(1-i)-Math.log(s)+s*e,mP.set(n,r)}return r<hP&&(r=hP),r}function gP(e,t,s){const n=t.length,r=e.length/n;let i=!1;for(let a=0,o=0;a<n;a++){let n=0;for(let t=o+r;o<t;o++)e[o]>s&&n++;t[a]!==n&&(t[a]=n,i=!0)}return i}window.cache=mP;let yP=0;class vP{constructor(e){oj(this,"id",void 0),oj(this,"immediates",[]),oj(this,"lastNonSilence",-1),oj(this,"immediateSpeechActivityScore",hP),oj(this,"lastLevelChangedTime",Date.now()),oj(this,"levels",[]),oj(this,"longs",[]),oj(this,"longSpeechActivityScore",hP),oj(this,"mediums",[]),oj(this,"mediumSpeechActivityScore",hP),oj(this,"minLevel",0),oj(this,"nextMinLevel",0),oj(this,"nextMinLevelWindowLength",0),oj(this,"energyScore",0),this.id=e||"".concat(yP++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,t=this.levels,s=this.minLevel+pP;let n=!1;for(let r=0;r<e.length;++r){let i=t[r];i<s&&(i=0);const a=Math.floor(i/pP);e[r]!==a&&(e[r]=a,n=!0)}return n}computeLongs(){return gP(this.mediums,this.longs,4)}computeMediums(){return gP(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=fP(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=fP(this.longs[0],10,47),this.longSpeechActivityScore>hP&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=fP(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(yr(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let s=e;return e<0&&(s=0),e>uP&&(s=uP),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+pP?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>uP&&(e=uP),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class xP{constructor(e){oj(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class _P{constructor(e,t,s){oj(this,"isDominant",void 0),oj(this,"energyRanking",void 0),oj(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=s}}class EP extends HR{constructor(e){super(),oj(this,"dominantId",null),oj(this,"lastDecisionTime",0),oj(this,"lastLevelChangedTime",0),oj(this,"lastLevelIdleTime",0),oj(this,"relativeSpeechActivities",[]),oj(this,"speakers",new Map),oj(this,"enableSilence",!1),oj(this,"timeoutToSilenceInterval",0),oj(this,"decisionMaker",null),oj(this,"loudest",[]),oj(this,"numLoudestToTrack",3),oj(this,"energyExpireTimeMs",250),oj(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=s&&(this.energyAlphaPct=s),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(t=>t.id===e)}levelChanged(e,t){const s=Date.now(),n=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const r=n.levelChanged(t,s);return this.updateLoudestList(n,r,s)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)})}removeSpeakers(e){e.forEach(e=>{this.speakers.delete(e.id)})}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new vP(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,s){const n=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new _P(n,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new _P(n,0,e.energyScore);const r=s-this.energyExpireTimeMs;let i=0;for(;i<this.loudest.length;){const t=this.loudest[i];if(t.getLastLevelChangedTime()<r&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(i,1);else if(t.id!==e.id)++i;else if(this.loudest.splice(i,1),this.loudest.length<this.numLoudestToTrack)break}let a=0;for(;a<this.loudest.length&&!(this.loudest[a].energyScore<e.energyScore);)++a;return a<this.numLoudestToTrack&&(this.loudest.splice(a,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new _P(n,a,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new xP(this),this.decisionMaker.execute())}makeDecision(e){let t=null,s=null;const n=this.speakers.size;let r=null;if(0===n)r=null;else if(1===n){var i;const t=up(i=this.speakers).call(i).next().value;this.enableSilence&&t&&(r=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(r=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){const e=this.speakers.entries().next();e.value&&(r=e.value[0],t=e.value[1])}else r=t.id;null!=t&&t.evaluateSpeechActivityScores(e);const s=this.relativeSpeechActivities;let n=2;for(const i of this.speakers.entries()){const[a,o]=i;if(o===t)continue;o.evaluateSpeechActivityScores(e);for(let e=0;e<s.length;++e){const n=null==t?hP:t.getSpeechActivityScore(e);s[e]=Math.log(o.getSpeechActivityScore(e)/n)}const c=s[0],l=s[1],d=s[2];c>3&&l>2&&d>0&&l>n&&(n=l,r=a)}this.enableSilence&&null!=t&&r===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(r=null)}null==r&&!this.enableSilence||r===this.dominantId||(t=this.dominantId,this.dominantId=r,s=this.dominantId),null==s&&!this.enableSilence||s===t||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const e=Date.now(),t=300-(e-this.lastLevelIdleTime);let s=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):s=t;let n=300-(e-this.lastDecisionTime);return n<=0&&(this.lastDecisionTime=e,this.makeDecision(e),n=300-(Date.now()-e)),n>0&&s>n&&(s=n),s}timeoutIdleLevels(e){const t=[];for(const n of up(s=this.speakers).call(s)){var s;const r=e-n.getLastLevelChangedTime();36e5<r&&(null==this.dominantId||n.id!==this.dominantId)?t.push(n.id):300<r&&n.levelTimedOut()}t.forEach(e=>this.speakers.delete(e))}}const bP=new Map;let wP=null,NP=null;const SP=3;let TP=[];const CP=new Map,RP=new Map;class IP{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){oj(this,"id",void 0),oj(this,"track",void 0),oj(this,"score",0),oj(this,"active",!0),oj(this,"muted",!1),oj(this,"timer",0),oj(this,"actives",0),oj(this,"inactives",0),this.id=e,this.track=t,this.setActive(CP.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:t,inactives:s}=function(){const e=[],t=[];return Array.from(up(CP).call(CP)).forEach(s=>{s.active?e.push(s):t.push(s)}),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach(t=>{(!e||e.score>t.score)&&(e=t)}),e&&e.setActive(!1)}if(t.length<3&&s.length>0){let t;s.forEach(e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)}),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(e){let t;return Array.from(up(CP).call(CP)).forEach(s=>{!s.active||s.id===e||s.samples<40||(!t||s.score<t.score)&&(t=s)}),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(e){let t;return Array.from(up(CP).call(CP)).forEach(s=>{s.active||s.id===e||s.samples<40||(!t||s.score>t.score)&&(t=s)}),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let AP;function OP(e){const t=CP.get(e);t&&(CP.delete(e),t.clearTimer())}const jP=new Map,kP=new Map,DP="video/h264",PP="video/h265";function LP(e,t,s){let n=new Uint8Array(e,t,s),r=[],i=0;for(;r.length<s;)i+3<s&&0===n[i]&&0===n[i+1]&&3===n[i+2]&&(0===n[i+3]||1===n[i+3]||2===n[i+3]||3===n[i+3])?(r.push(n[i],n[i+1],n[i+3]),i+=4):(r.push(n[i]),i++);return new Uint8Array(r)}function MP(e){const t=e.length;let s=[],n=0;for(;n<t;)n+2<t&&0===e[n]&&0===e[n+1]&&(0===e[n+2]||1===e[n+2]||2===e[n+2]||3===e[n+2])?(s.push(e[n],e[n+1],3,e[n+2]),n+=3):(s.push(e[n]),n++);return new Uint8Array(s)}function UP(e){if(e.length<5)return"";let t=-1;for(let r=0;r<e.length-3;r++){if(0===e[r]&&0===e[r+1]&&1===e[r+2]){t=r;break}if(r<e.length-4&&0===e[r]&&0===e[r+1]&&0===e[r+2]&&1===e[r+3]){t=r;break}}if(-1===t)return"";const s=t+(0===e[t+2]?4:3);if(s>=e.length)return"";const n=e[s];return 128&n?"":(n>>1&63)>=32||s+1<e.length&&0==(248&e[s+1])?PP:(31&n)<=31?DP:""}const VP=new Map,FP=new Map;!function(){const e=qC();gO.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gO.getStreamFromExtension=e.name===WC.CHROME&&Number(e.version)>34,gO.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),gO.supportMinBitrate=e.name===WC.CHROME||e.name===WC.EDGE,gO.supportSetRtpSenderParameters=function(){const e=qC();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!bR()||!(!$C()&&!QC())||e.name===WC.FIREFOX&&Number(e.version)>=64)}(),e.name===WC.SAFARI&&(Number(e.version)>=14?gO.supportDualStream=!0:gO.supportDualStream=!1),gO.webAudioMediaStreamDest=function(){const e=qC();return!(e.name===WC.SAFARI&&Number(e.version)<12)}(),gO.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,gO.supportWebGL="undefined"!=typeof WebGLRenderingContext,gO.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,bR()||(gO.webAudioWithAEC=!0),gO.supportShareAudio=function(){const e=qC();return(e.os===GC.WIN_10||e.os===GC.WIN_81||e.os===GC.WIN_7||e.os===GC.LINUX||e.os===GC.MAC_OS||e.os===GC.CHROMIUM_OS)&&e.name===WC.CHROME&&Number(e.version)>=74}(),gO.supportDataChannel=!!(rR(76)||cR(68)||lR(14)),gO.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!sR()&&!!e&&e.prototype.setConfiguration instanceof Function}(),gO.supportWebRTCEncodedTransform=rR(87)||eR()||cR(117),gO.supportWebRTCInsertableStream=function(){const e=qC();return(e.name===WC.CHROME||e.name===WC.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gO.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gO.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,hI(()=>{gO.supportDualStreamEncoding=function(){const e=qC();return!!RA("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&RA("CHROME_DUAL_STREAM_USE_ENCODING"))}(),aO.debug("browser ua: ",navigator.userAgent),aO.info("browser info: ",e),aO.info("browser compatibility: ",gO)})}();const BP=["CHINA","GLOBAL"],GP=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],WP=[],HP=[];function KP(e,t){return!!t&&WP.some(s=>s.uid===e&&s.channelName===t)}function zP(){return HP.length>0}var qP=Cb.forEach,YP=Hn("forEach")?[].forEach:function(e){return qP(this,e,arguments.length>1?arguments[1]:void 0)};As({target:"Array",proto:!0,forced:[].forEach!==YP},{forEach:YP});var XP=$s("Array","forEach"),JP=gn,QP=et,ZP=u,$P=XP,eL=Array.prototype,tL={DOMTokenList:!0,NodeList:!0},sL=function(e){var t=e.forEach;return e===eL||ZP(eL,e)&&t===eL.forEach||QP(tL,JP(e))?$P:t},nL=n(sL),rL=Qe,iL=hi;As({target:"Object",stat:!0,forced:r(function(){iL(1)})},{keys:function(e){return iL(rL(e))}});var aL=n(ee.Object.keys),oL=n(nr),cL=n(gr),lL=As,dL=ar,uL=Qc,hL=$,pL=Vs,mL=Hs,fL=Q,gL=qf,yL=mt,vL=al,xL=BE("slice"),_L=yL("species"),EL=Array,bL=Math.max;lL({target:"Array",proto:!0,forced:!xL},{slice:function(e,t){var s,n,r,i=fL(this),a=mL(i),o=pL(e,a),c=pL(void 0===t?a:t,a);if(dL(i)&&(s=i.constructor,(uL(s)&&(s===EL||dL(s.prototype))||hL(s)&&null===(s=s[_L]))&&(s=void 0),s===EL||void 0===s))return vL(i,o,c);for(n=new(void 0===s?EL:s)(bL(c-o,0)),r=0;o<c;o++,r++)o in i&&gL(n,r,i[o]);return n.length=r,n}});var wL=$s("Array","slice"),NL=u,SL=wL,TL=Array.prototype,CL=function(e){var t=e.slice;return e===TL||NL(TL,e)&&t===TL.slice?SL:t},RL=n(CL);function IL(e,t,s,n,r){var i,a,o,c={};return nL(i=aL(n)).call(i,function(e){c[e]=n[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=oL(a=cL(o=RL(s).call(s)).call(o)).call(a,function(s,n){return n(e,t,s)||s},c),r&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(r):void 0,c.initializer=void 0),void 0===c.initializer?(IE(e,t,c),null):c}let AL=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),OL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),jL=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),kL=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),DL=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),PL=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),LL=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),ML=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),UL=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),VL=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),FL=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),BL=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function GL(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw aO.error("Invalid Channel Name ".concat(e)),new fO(RR.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function WL(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||MR(e,1,255)))throw new fO(RR.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&aO.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let HL=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const KL={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},zL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qL(e,t){DR(e.url,"".concat(t,".url"),1,1e3,!1),LR(e.x)||jR(e.x,"".concat(t,".x"),0,1e4),LR(e.y)||jR(e.y,"".concat(t,".y"),0,1e4),LR(e.width)||jR(e.width,"".concat(t,".width"),0,1e4),LR(e.height)||jR(e.height,"".concat(t,".height"),0,1e4),LR(e.zOrder)||jR(e.zOrder,"".concat(t,".zOrder"),0,255),LR(e.alpha)||jR(e.alpha,"".concat(t,".alpha"),0,1,!1)}const YL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let XL=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),JL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),QL=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function ZL(e){if(!e.channelName)throw new fO(RR.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new fO(RR.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&DR(e.token,"info.token",1,2047),WL(e.uid),GL(e.channelName),!0}let $L=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),eM=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),tM=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),sM=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),nM=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),rM=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),iM=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),aM=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),oM=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const cM=[oM.AFRICA,oM.ASIA,oM.CHINA,oM.EUROPE,oM.GLOBAL,oM.INDIA,oM.JAPAN,oM.NORTH_AMERICA,oM.OCEANIA,oM.OVERSEA,oM.SOUTH_AMERICA];let lM=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const dM={CHINA:{},ASIA:{CODE:lM.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:lM.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:lM.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:lM.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:lM.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:lM.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:lM.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:lM.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:lM.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:lM.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:lM.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:lM.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:lM.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};xA&&(dM.CHINA={CODE:lM.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let uM=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function hM(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class pM extends HR{constructor(e,t){super(),uS(this,"onICEConnectionStateChange",void 0),uS(this,"onConnectionStateChange",void 0),uS(this,"onDTLSTransportStateChange",void 0),uS(this,"onDTLSTransportError",void 0),uS(this,"onICETransportStateChange",void 0),uS(this,"onFirstAudioReceived",void 0),uS(this,"onFirstVideoReceived",void 0),uS(this,"onFirstAudioDecoded",void 0),uS(this,"onFirstVideoDecoded",void 0),uS(this,"onFirstVideoRender",void 0),uS(this,"onFirstVideoDecodedTimeout",void 0),uS(this,"onSelectedLocalCandidateChanged",void 0),uS(this,"onSelectedRemoteCandidateChanged",void 0),uS(this,"onICECandidateError",void 0),uS(this,"getLocalVideoStats",void 0)}}class mM extends pM{constructor(e,t){super(e,t),uS(this,"establishPromise",void 0)}}let fM=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),gM=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),yM=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const vM=["disconnected","failed"];let xM=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),_M=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),EM=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),bM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),wM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),NM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),SM=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),TM=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),CM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),RM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),IM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),AM=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),OM=function(e){return e.ABORT="abort",e}({}),jM=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),kM=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const DM={[AL.ACCESS_POINT]:{[kL.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[kL.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[kL.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[kL.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[kL.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[kL.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[kL.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[AL.UNILBS]:{[jL.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[jL.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[jL.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[jL.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[jL.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[jL.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[jL.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[jL.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[jL.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[jL.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[jL.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[jL.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[AL.STRING_UID_ALLOCATOR]:{[OL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[OL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[OL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function PM(e){const t=DM[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const s=t[e%1e4];if(!s){if(Math.floor(e/1e4)===AL.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const LM={[DL.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[DL.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[DL.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[DL.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[DL.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[DL.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[DL.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[DL.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[DL.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[DL.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[DL.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[DL.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[DL.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[DL.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[DL.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[DL.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[DL.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[DL.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[DL.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[DL.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[DL.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[DL.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[DL.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[DL.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[DL.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[DL.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[DL.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[DL.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[DL.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[DL.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[DL.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[DL.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[DL.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[DL.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[DL.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[DL.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[DL.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[DL.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[DL.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[DL.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[DL.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[DL.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[DL.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[DL.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[DL.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[DL.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[DL.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[DL.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[DL.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[DL.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[DL.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[DL.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[DL.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[DL.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[DL.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[DL.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[DL.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[DL.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[DL.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[DL.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[DL.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[DL.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[DL.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[DL.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function MM(e){return LM[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function UM(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function VM(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?UM(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):UM(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function FM(e,t){if("string"==typeof e)return e;const{proxy:s,host:n,port:r}=e;if(t){const e=RA("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(n,"/ws/?p=").concat(Number(r)+150):"wss://".concat(n,":").concat(e,"/ws/?p=").concat(Number(r)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(n,"&p=").concat(r):"wss://".concat(n,":").concat(r)}const BM=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,GM=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,WM=/wss:\/\/(.+):([0-9]+)\/?/,HM=/wss:\/\/(.[^\/]+)\/?/;let KM=0;class zM{constructor(e,t){uS(this,"id",0),uS(this,"store",void 0),uS(this,"recordIndex",void 0),uS(this,"websockets",[]),uS(this,"try443PortDuration",2e3),uS(this,"forceCloseWSDuration",5e3),uS(this,"try443PortTimeout",null),uS(this,"forceCloseTimeout",null),uS(this,"isTry443PortFailed",!1),uS(this,"isNormalPortFailed",!1),uS(this,"useDoubleDomain",!1),uS(this,"useProxy",!1),uS(this,"startTime",Date.now()),this.id=++KM,this.try443PortDuration=RA("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const t=Date.now()-this.startTime;for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];aO.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...n)}createWebSocket(e,t,s){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:s});const n=RA("GATEWAY_DOMAINS"),r=Date.now(),i=[],a=n.find(t=>{var s;return Dn(s=e.host).call(s,t)});a||(this.useDoubleDomain=!1);const o=[];if(this.useDoubleDomain)n.forEach(s=>{o.push(FM(VM(VM({},e),{},{host:e.host.replace(a,s)}),t))});else{const s=VM({},e);if(t&&a){const e=n.find(e=>e!==a);e&&(s.host=s.host.replace(a,e))}o.push(FM(s,t))}try{o.forEach(e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",i.push(t),this.logger("ws is connecting:",t.url)})}catch(n){if(this.logger("ws create failed"),i.forEach(e=>e.close()),i.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,s);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,s);throw new fO(RR.WS_ERR,"init websocket failed! Error: ".concat(n.toString()))}const c=UC();this.store&&this.store.recordJoinChannelService({urls:i.map(e=>e.url),service:"gateway"},this.recordIndex),i.forEach(e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-r,"ms")),this.websockets.forEach(t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))}),this.websockets.length=0,c.resolve(e)},e.onclose=s=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-r,"ms state: ").concat(e.readyState));const n=i.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(n)),n&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(s.reason)),c.reject({code:s.code,reason:iM.A_ROUND_WS_FAILED})):!t&&n&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),d()),t?this.isTry443PortFailed=n:this.isNormalPortFailed=n},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))}),this.websockets.push(...i);const l=()=>{this.websockets.forEach(e=>e.readyState!==WebSocket.OPEN&&e.close())},d=()=>{if(c.isResolved)return l();qC().os===GC.MAC_OS&&sR()&&l(),this.createWebSocket(e,!0,!0).then(e=>{c.resolve(e)}).catch(e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,l()},this.forceCloseWSDuration)};return s||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,l()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,d()},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,s,n){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,s,n;return[,t,s,n]=e.match(BM)||[],t||([,s,n]=e.match(GM)||[]),s&&n||([,s,n]=e.match(WM)||[]),s&&n||([,s]=e.match(HM)||[]),s||aO.warning("un-destructible url: ",e),{proxy:t,host:s,port:n||"443"}}(e)),this.recordIndex=n,this.useProxy=!!e.proxy,s&&this.useProxy&&(aO.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(e,!!s,!1).finally(()=>this.clearTimeout())}}function qM(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}class YM extends HR{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Dn(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(BL.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(BL.CONNECTED):"closed"===this._state?this.emit(BL.CLOSED):"failed"===this._state&&this.emit(BL.FAILED))}resetReconnectCount(e){aO.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;super(),uS(this,"_websocketUrl",null),uS(this,"connectionID",0),uS(this,"currentURLIndex",0),uS(this,"urls",[]),uS(this,"_reconnectMode","tryNext"),uS(this,"reconnectReason",void 0),uS(this,"_initMutex",void 0),uS(this,"name",void 0),uS(this,"_state","closed"),uS(this,"reconnectInterrupter",void 0),uS(this,"websocket",void 0),uS(this,"retryConfig",void 0),uS(this,"reconnectCount",0),uS(this,"forceCloseTimeout",5e3),uS(this,"onlineReconnectListener",void 0),uS(this,"useCompress",void 0),uS(this,"tryDoubleDomain",!1),uS(this,"use443PortOnly",!1),uS(this,"wsInflateLength",0),uS(this,"wsDeflateLength",0),uS(this,"closeEstablishingWs",()=>{}),uS(this,"store",void 0),uS(this,"joinGatewayRecordIndex",void 0),this.store=i,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?qM(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):qM(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},t),this.useCompress=s,this.tryDoubleDomain=n,this.use443PortOnly=r,this._initMutex=new UI("websocket",i?i.clientId:void 0);const{timeout:a,timeoutFactor:o}=t,c=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*o)/10);nI.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),lI.on(rI.NETWORK_STATE_CHANGE,(e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===nI.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=o))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{var n;const e=UC(),t=this.urls[this.currentURLIndex];null===(n=this.store)||void 0===n||n.beforeConnect(),function(e){return!(xO()||RA("USE_NEW_TOKEN")||!RA("ENABLE_PREALLOC_PC")&&(null==e||!e.autoSubscribe||RA("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(SM.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(BL.CLOSED,()=>{e.reject(new IR(RR.WS_DISCONNECT))}),this.once(BL.CONNECTED,e.resolve),await e.promise}catch(e){}finally{s()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout(()=>e.close(),500):e.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void aO.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),aO.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new IR(RR.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new IR(RR.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const s=UC();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const n=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),aO.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},r=async e=>{var t;if(aO.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new IR(RR.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=oI(this,BL.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,n=await this.reconnectWithAction(t);if("closed"===this.state)return void aO.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!n)return s.reject(new IR(RR.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);s.resolve()}},i=e=>{this.emit(BL.ON_MESSAGE,e)},a=e=>{aO.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),RA("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=RA("GATEWAY_WSS_ADDRESS")),aO.debug("[".concat(this.name,"] start connect, url:"),e);const o=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;this._websocketUrl=FM(e);const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,n&&n(this.websocket.url),this.websocket.onclose=r,this.websocket.onmessage=i,this.websocket.onerror=a,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},o),this.joinGatewayRecordIndex=o}catch(e){const t="closed"===this.state,n=e instanceof IR,i=n&&e.code===RR.WS_ABORT,a=n&&e.code===RR.WS_ERR,c=n?e.message:e&&(e.reason||e.toString());aO.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:i?"aborted":"error",errors:[e]},o),t||a?(s.reject(t?new IR(RR.WS_DISCONNECT,"websocket is closed: ".concat(c)):new IR(RR.WS_ERR,"init websocket failed: ".concat(c))),a&&aO.error("[".concat(this.name,"] init websocket failed: ").concat(c))):r&&r(e)}return s.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;aO.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||lI.isOnline||!lI.onlineWaiter||(this.onlineReconnectListener=lI.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,t){const t=BI(this.reconnectCount,this.retryConfig);aO.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await sp.race([NI(t),this.onlineReconnectListener||new sp(()=>{})])}if("closed"===this._state||!s)return!1;this.reconnectCount+=1;const n=async(e,t)=>{this.emit(BL.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await n(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);aO.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await n(this.urls[this.currentURLIndex],e)}else"recover"===e&&(aO.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await iI(this,BL.REQUEST_NEW_URLS),this.currentURLIndex=0,await n(this.urls[this.currentURLIndex],e))}catch(s){var r;aO.error("[".concat(this.name,"] reconnect failed ").concat(s&&s.toString()));const n=null==s||null===(r=s.data)||void 0===r?void 0:r.desc;return Array.isArray(n)&&Dn(n).call(n,"dynamic key expired")?(this.emit(BL.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class XM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const s=UC(),n=function(e,t){return new zM(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),n.closeAllWebsockets(),s.reject(new IR(RR.WS_ABORT,"choose best websocket aborted"))};const r=RA("GATEWAY_DOMAINS");return aO.debug("[choose-best-ws] currentDomain: ",e,", domains: ",r,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),n.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class JM extends YM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new sp((s,n)=>{let r=!1;const i=[];this.closeEstablishingWs=()=>{aO.debug("[choose-best-ws] close establishing websockets"),i.forEach(e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()}),n(new IR(RR.WS_ABORT,"choose best websocket aborted"))};const a=RA("GATEWAY_DOMAINS");let o;const c=e.indexOf("?h="),l=a.find(t=>-1!==c?Dn(e).call(e,t,c):Dn(e).call(e,t));aO.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let d=!this.tryDoubleDomain||!l;if(!d&&l){var u;const h=Date.now();try{a.forEach(t=>{const s=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),n=new WebSocket(s);n.binaryType="arraybuffer",i.push(n),aO.debug("[choose-best-ws] ws is connecting:",n.url)})}catch(e){for(aO.debug("[choose-best-ws] ws create failed, fallback to single url"),i.forEach(e=>e.close());i.length;)i.pop();d=!0}null===(u=this.store)||void 0===u||u.recordJoinChannelService({urls:i.map(e=>e.url),service:"gateway"},t),i.forEach(e=>{e.onopen=()=>{if(r)return;const t=Date.now()-h;aO.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),i.filter(t=>t!==e).forEach(e=>{aO.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()}),r=!0,s(e)},e.onclose=e=>{o=e,r||i.find(e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))||(aO.debug("[choose-best-ws] all websocket is closed"),r=!0,n(o))},e.onmessage=t=>{aO.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}}),NI(this.forceCloseTimeout).then(()=>{i.forEach(e=>{e.readyState!==WebSocket.OPEN&&e.close()})})}if(d){var h;let r;aO.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{r=new WebSocket(e),i.push(r),r.binaryType="arraybuffer"}catch(e){const s=new IR(RR.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return aO.error("[".concat(this.name,"]").concat(s)),void n(s)}r.onopen=()=>{s(r)},r.onclose=e=>{n(e)},r.onmessage=e=>{aO.debug("[choose-best-ws]".concat(r.url," onmessage: ").concat(e.data))},NI(this.forceCloseTimeout).then(()=>{r&&r.readyState!==WebSocket.OPEN&&r.close()})}}).then(e=>(this.closeEstablishingWs=void 0,e)).catch(e=>{throw this.closeEstablishingWs=void 0,e})}}class QM extends HR{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===PL.CONNECTED?this.emit(LL.WS_CONNECTED):e===PL.RECONNECTING?this.emit(LL.WS_RECONNECTING,this._websocketReconnectReason):e===PL.CLOSED&&this.emit(LL.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uS(this,"_disconnectedReason",void 0),uS(this,"_websocketReconnectReason",void 0),uS(this,"_connectionState",PL.CLOSED),uS(this,"reconnectToken",void 0),uS(this,"websocket",void 0),uS(this,"openConnectionTime",void 0),uS(this,"clientId",void 0),uS(this,"lastMsgTime",Date.now()),uS(this,"uploadCache",[]),uS(this,"uploadCacheInterval",void 0),uS(this,"rttRolling",new HI(5)),uS(this,"pingpongTimer",void 0),uS(this,"wsInflateDataTimer",void 0),uS(this,"pingpongTimeoutCount",0),uS(this,"ortc",void 0),uS(this,"joinResponse",void 0),uS(this,"multiIpOption",void 0),uS(this,"initError",void 0),uS(this,"spec",void 0),uS(this,"store",void 0),uS(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(LL.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===VL.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===VL.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QR.UID_BANNED);break;case 15:this.close(QR.IP_BANNED);break;case 16:this.close(QR.CHANNEL_BANNED)}if(t._type===VL.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case DL.ERR_LICENSE_MISSING:this.close(QR.LICENSE_MISSING);break;case DL.ERR_LICENSE_EXPIRED:this.close(QR.LICENSE_EXPIRED);break;case DL.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QR.LICENSE_MINUTES_EXCEEDED);break;case DL.ERR_LICENSE_PERIOD_INVALID:this.close(QR.LICENSE_PERIOD_INVALID);break;case DL.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QR.LICENSE_MULTIPLE_SDK_SERVICE);break;case DL.ERR_LICENSE_ILLEGAL:this.close(QR.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,RA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),RA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===PL.CONNECTED&&this.reconnect("retry",sI.OFFLINE)})}async request(e,t,s,n){const r=SI(6,""),i={_id:r,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new sp((t,s)=>{if(this.connectionState===PL.CONNECTED)return t();const n=()=>{this.off(LL.WS_CLOSED,r),t()},r=()=>{this.off(LL.WS_CONNECTED,n),s(new fO(RR.WS_ABORT))};this.once(LL.WS_CONNECTED,n),this.once(LL.WS_CLOSED,r),e!==ML.PUBLISH&&e!==ML.PUBLISH_DATASTREAM&&e!==ML.SUBSCRIBE&&e!==ML.SUBSCRIBE_DATASTREAM&&e!==ML.UNSUBSCRIBE&&e!==ML.UNSUBSCRIBE_DATASTREAM&&e!==ML.UNPUBLISH&&e!==ML.UNPUBLISH_DATASTREAM&&e!==ML.CONTROL&&e!==ML.RESTART_ICE||this.once(LL.DISCONNECT_P2P,()=>{s(new fO(RR.DISCONNECT_P2P))}),e!==ML.PUBLISH&&e!==ML.RESTART_ICE||this.once(LL.ABORT_P2P_EXECUTION,()=>{s(new fO(RR.DISCONNECT_P2P))})});if(this.connectionState!==PL.CONNECTING&&this.connectionState!==PL.RECONNECTING||e===ML.JOIN||e===ML.REJOIN||await o(),this.websocket.sendMessage(i,!0),n)return;const c=new sp((s,n)=>{let i=!1;const o=(n,r)=>{i=!0,s({isSuccess:"success"===n,message:r||{}}),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.emit(LL.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(r),o);const c=()=>{n(new fO(RR.WS_ABORT,"type: ".concat(e))),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.off("res-@".concat(r),o)};this.once(LL.WS_CLOSED,c),this.once(LL.WS_RECONNECTING,c),NI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||i||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(LL.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(n){if(this.connectionState===PL.CLOSED||e===ML.LEAVE)throw new fO(RR.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?n.throw():e===ML.JOIN||e===ML.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new fO(RR.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===DL.ERR_TOO_MANY_BROADCASTERS?e===ML.JOIN||e===ML.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===DL.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sI.MULTI_IP)):this.reconnect(u.action,sI.SERVER_ERROR),e===ML.JOIN||e===ML.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new sp(s=>{const n=r=>{(!t||t(r))&&(this.off(e,n),s(r))};this.on(e,n)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(UL.WRTC_STATS,t)}upload(e,t){const s={_type:e,_message:t};try{this.websocket.sendMessage(s)}catch(e){const t=RA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==PL.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},RA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const s={_type:e,_message:t};this.websocket.sendMessage(s)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new sp((t,s)=>{this.once(LL.WS_CONNECTED,()=>t(this.joinResponse)),this.once(LL.WS_CLOSED,e=>s(this.initError||new fO(RR.WS_ABORT,e))),this.connectionState=PL.CONNECTING,this.websocket.init(e).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||QR.LEAVE,this.connectionState=PL.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(LL.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await iI(this,LL.REQUEST_JOIN_INFO);this.store.joinReq();const t=await this.request(ML.JOIN,e);if(this.ortc=null==e?void 0:e.ortc,this.store.joinRep(),!t)return this.emit(LL.REPORT_JOIN_GATEWAY,iM.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(LL.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=PL.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new fO(RR.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=cI(this,LL.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(ML.REJOIN,e);return!!t&&(this.connectionState=PL.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(e=>{this.emit(VL.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(VL.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(VL.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(VL.MUTE_AUDIO,{uid:e.uid}):this.emit(VL.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(VL.MUTE_VIDEO,{uid:e.uid}):this.emit(VL.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(VL.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(VL.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(VL.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(VL.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(VL.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){if(!this.ortc)return!1;const t={downgrade_codec:e,ortc:this.ortc};return!!await this.request(ML.DOWNGRADE_CODEC,t)}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if(28===e.code&&"detail"in e&&(aO.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(LL.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QR.UID_BANNED),void this.close()):void this.reconnect(t.action,sI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=RA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>RA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sI.TIMEOUT):this.request(ML.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),RA("REPORT_STATS")&&this.send(ML.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(UL.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(BL.RECONNECT_CREATE_CONNECTION,e=>{this.emit(LL.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(BL.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(BL.CLOSED,()=>{this.connectionState=PL.CLOSED}),this.websocket.on(BL.FAILED,()=>{this._disconnectedReason=QR.NETWORK_ERROR,this.connectionState=PL.CLOSED}),this.websocket.on(BL.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===PL.CONNECTED?this.connectionState=PL.RECONNECTING:this.connectionState=PL.CONNECTING}),this.websocket.on(BL.WILL_RECONNECT,(e,t,s)=>{const n=cI(this,LL.IS_P2P_DISCONNECTED),r=n||"retry"!==e;n&&"retry"===e&&(aO.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=iM.P2P_DISCONNECTED),r&&(aO.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(LL.REPORT_JOIN_GATEWAY,t||iM.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(LL.DISCONNECT_P2P)),s(e)}),this.websocket.on(BL.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{aO.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",sI.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(LL.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof fO){if(e.code===RR.UNEXPECTED_RESPONSE&&e.data.code===DL.ERR_NO_AUTHORIZED)return this.initError=new fO(RR.TOKEN_EXPIRE,"dynamic key expired"),void this.close(QR.TOKEN_EXPIRE);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sI.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(BL.REQUEST_NEW_URLS,(e,t)=>{iI(this,LL.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(BL.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(VL.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(SM.PRE_CONNECT_PC,()=>{this.emit(LL.PRE_CONNECT_PC)})}}let ZM=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),$M=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function eU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function tU(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?eU(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):eU(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function sU(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(RA("TURN_DOMAIN")):(aO.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function nU(e){try{const t=RA("GATEWAY_DOMAINS").concat(RA("TURN_DOMAIN")).find(t=>Dn(e).call(e,t));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch(t){return aO.debug("serverUrlToIp error, fallback to url",e),e}}function rU(e,t){e.addresses||(e.addresses=[]);const s=function(e,t){if(RA("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map(e=>{let{ip:t,port:s}=e;return{address:"".concat(t,":").concat(s)}});const s=RA("GATEWAY_DOMAINS");let n=s[1]&&Dn(t).call(t,s[1])?1:0;return e.map(e=>{let{domain_prefix:t,port:r,ip:i}=e;if(t)return{address:"".concat(t,".").concat(s[n++%s.length],":").concat(r)};const a=/^[\.\:\d]+$/.test(i),o=a?"".concat(i.replace(/[^\d]/g,"-"),".").concat(s[n++%s.length],":").concat(r):"".concat(i,":").concat(r);return a||aO.debug("Cannot recognized as ip address: ".concat(i,", use as host3")),{ip:i,port:r,address:o}})}(e.addresses,t),n=Array.isArray(e.detail)&&e.detail[18];if(n&&"string"==typeof n){const e=n.split(";");for(let t=0;t<e.length;t++){var r;const n=jx(r=e[t]).call(r);s[t]&&n&&(s[t].ip6=n)}}const i=e.detail&&e.detail.candidate;let a;if(i){const[e,t]=i.split(":");e&&t&&(a={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:s,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function iU(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function aU(e){const t=e._encoderConfig;if(!t)return{};const s={resolution:t.width&&t.height?"".concat(iU(t.width),"x").concat(iU(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(s.maxFrameRate=t.frameRate,s.minFrameRate=t.frameRate):t.frameRate&&(s.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,s.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),s}function oU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function cU(e,t){let s,n,r;switch(t){case $M.CHOOSE_SERVER:n=4096,r="choose server";break;case $M.CLOUD_PROXY:n=1048576,r="proxy";break;case $M.CLOUD_PROXY_5:n=4194304,r="proxy5";break;case $M.CLOUD_PROXY_FALLBACK:n=4194310,r="proxy fallback";break;default:throw new fO(RR.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(t=>{t.buffer&&t.buffer.flag===n&&(s={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map(e=>tU(tU({},e),{},{ticket:t.buffer.cert})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:tU(tU({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})}),!s)throw new fO(RR.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function lU(e,t){return await sp.all(e.addresses.map(async e=>({address:sU(e.ip),tcpport:e.port,udpport:e.port,username:t&&RA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():EA.username,password:t&&RA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await WR(t.toString()):EA.password})))}function dU(e,t){const s=t.getMediaStreamTrack(!0).getSettings(),n=t.videoHeight||s.height,r=t.videoWidth||s.width;return n&&r?Math.max(Math.min(n,r)/Math.min(iU(e.height),iU(e.width)),1):(aO.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function uU(e){let{candidateType:t,relayProtocol:s,type:n,address:r,port:i,protocol:a}=e;const o={candidateType:t,relayProtocol:s,protocol:a};if("local-candidate"!==n){const e=r.split(".");e.length>=4&&(e[1]="*",e[2]="*"),o.address=e.join("."),o.port=i}return o}function hU(e){const t=e.split(":"),s=e.split(/[-.]/),n=Dn(e).call(e,"-")?"-":".";let r=e;return t.length>1?s.length>1?(s[1]="**",r=s[0]+n+"**:"+t[t.length-1]):r=t.length>2?t[0]+n+"**:"+t[t.length-1]:"**:"+t[t.length-1]:s.length>1&&(r=s[0]+n+"**"),r}function pU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RA("SVC_MODE");if(RA("ENABLE_SVC"))return function(e){return e in cA}(e)?e:cA.L1T3}const mU={[fM.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[fM.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function fU(e,t,s){t.forEach(t=>{var n;const r=mU[e].find(e=>{var s;let{key:n}=e;return Dn(s=t.extensionName).call(s,n)});if(!r)return;const i=s.find(e=>{let{extensionName:t}=e;return Dn(t).call(t,r.key)});i&&Dn(n=i.extensionName).call(n,"gdpr_forbidden")&&(t.extensionName=i.extensionName)})}function gU(e,t){t.forEach(t=>{var s;const n=mU[e].find(e=>{var s;let{key:n}=e;return Dn(s=t.extensionName).call(s,n)});Dn(s=t.extensionName).call(s,"gdpr_forbidden")&&n&&(t.extensionName=n.extensionName)})}function yU(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Dn(e).call(e,"abs-send-time")}function vU(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Dn(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function xU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function _U(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?xU(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):xU(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function EU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:i,filterAudioFec:a,filterAudioCodec:o,filterVideoCodec:c,unsupportedVideoUplinkCodec:l,unsupportedVideoDownlinkCodec:d}=t,{useXR:u}=s;let h=[],p=[],m=[],f=[],g=!1,y=!1;if(VA(e).mediaDescriptions.forEach(e=>{n&&n!==e.attributes.direction||("video"!==e.media.mediaType||g||(p=e.attributes.payloads,f=e.attributes.extmaps,g=!0),"audio"!==e.media.mediaType||y||(h=e.attributes.payloads,m=e.attributes.extmaps,y=!0))}),!f||0===p.length)throw new Error("Cannot get video capabilities from SDP.");if(!m||0===h.length)throw new Error("Cannot get audio capabilities from SDP.");if(p.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),h.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),r&&(h=h.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}),p=p.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),i){const e=p.filter(e=>{var t;return/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}),t=VU(e,p).map(e=>e.payloadType),s=[...e.map(e=>e.payloadType),...t];p=p.filter(e=>!Dn(s).call(s,e.payloadType))}if(a&&(h=h.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),o&&(null==o?void 0:o.length)>0&&(h=h.filter(e=>{var t;return Dn(o).call(o,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})),c&&(null==c?void 0:c.length)>0){const e=p.filter(e=>{var t;return Dn(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")});p=e.concat(r?[]:VU(e,p))}const v=RA("UNSUPPORTED_VIDEO_CODEC");if(v&&v.length>0){const e=p.filter(e=>e.rtpMap&&Dn(v).call(v,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),s=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Dn(s).call(s,e.payloadType)),aO.debug("unsupportedVideoCodec: ".concat(v,", toBeRemoved: ").concat(s))}if(l&&l.length>0&&"sendonly"===n){const e=p.filter(e=>e.rtpMap&&Dn(l).call(l,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),s=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Dn(s).call(s,e.payloadType)),aO.debug("unsupportedVideoUplinkCodec: ".concat(l,", toBeRemoved: ").concat(s))}if(d&&d.length>0&&"recvonly"===n){const e=p.filter(e=>e.rtpMap&&Dn(d).call(d,e.rtpMap.encodingName.toLowerCase())),t=VU(e,p),s=e.concat(t).map(e=>e.payloadType);p=p.filter(e=>!Dn(s).call(s,e.payloadType)),aO.debug("unsupportedVideoDownlinkCodec: ".concat(d,", toBeRemoved: ").concat(s))}return{audioCodecs:h,videoCodecs:p,audioExtensions:m,videoExtensions:f}}function bU(e){const t=VA(e);let s,n;for(const r of t.mediaDescriptions){if(!s){const e=r.attributes.iceUfrag,t=r.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:e,icePwd:t}}if(!n){const e=r.attributes.fingerprints;e.length>0&&(n={fingerprints:e})}}if(!n&&t.attributes.fingerprints.length>0&&(n={fingerprints:t.attributes.fingerprints}),!n||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:n}}function wU(e,t){const s=[],n=e.attributes.ssrcGroups.filter(e=>"FID"===e.semantic),r=e.attributes.ssrcGroups.find(e=>"SIM"===e.semantic),i=e.attributes.ssrcs;if(r)r.ssrcIds.forEach(e=>{var r;const i=null===(r=n.find(t=>t.ssrcIds[0]===e))||void 0===r?void 0:r.ssrcIds[1];s.push({ssrcId:e,rtx:t?i:void 0})});else if(n.length>0){const e=n[0].ssrcIds[0],r=n[0].ssrcIds[1];s.push({ssrcId:e,rtx:t?r:void 0})}else{if(0===i.length)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:i[0].ssrcId})}return s}function NU(e,t,s){const{cname:n}=e;let r=[];t&&(r=SU(t)),0===r.length&&(r=e.iceParameters.candidates.map(e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})),aO.debug("Using candidates from gateway."));const i={fingerprints:e.dtlsParameters.fingerprints.map(e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let o;switch(e.dtlsParameters.role){case"server":o="passive";break;case"client":o="active";break;case"auto":o="actpass"}const c=LU(e.rtpCapabilities),l=[];return Array.isArray(s)&&s.length>0&&s.forEach(e=>{l.push({kind:fM.VIDEO,ssrcMsg:[{ssrcId:e.v,rtx:e.v_rtx}],mslabel:"".concat(e.v,"_").concat(e.a)},{kind:fM.AUDIO,ssrcMsg:[{ssrcId:e.a}],mslabel:"".concat(e.v,"_").concat(e.a)})}),{dtlsParameters:i,iceParameters:a,candidates:r,rtpCapabilities:c,setup:o,cname:n,preSSRCs:l}}function SU(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],aO.debug("Using remote candidate from AP ".concat(hU(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),aO.debug("Using IPV6 remote candidate from AP ".concat(hU(e.ip6),":").concat(e.port)))),t}function TU(e,t,s){const n=[],r=[];return e.forEach(e=>{let{ssrcId:i,rtx:a}=e;const o=SI(8,"track-"),c={ssrcId:i,attributes:_U({label:o,mslabel:s=s||SI(10,""),msid:"".concat(s," ").concat(o)},t&&{cname:t})};if(n.push(c),void 0!==a){const e={ssrcId:a,attributes:_U({label:o,mslabel:s,msid:"".concat(s," ").concat(o)},t&&{cname:t})};n.push(e),r.push({semantic:"FID",ssrcIds:[i,a]})}}),e.length>1&&r.push({semantic:"SIM",ssrcIds:e.map(e=>{let{ssrcId:t}=e;return t})}),{ssrcs:n,ssrcGroups:r}}function CU(e,t){t instanceof Fk&&e.attributes.payloads.forEach(e=>{var s;const n=null===(s=e.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase();if(!n||-1===["opus","pcmu","pcma","g722"].indexOf(n))return;e.fmtp||(e.fmtp={parameters:{}}),"opus"===n&&"number"==typeof RA("OPUS_PTIME")?e.fmtp.parameters.ptime=RA("OPUS_PTIME"):e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const r=t._encoderConfig;r&&("pcmu"!==n&&"pcma"!==n&&"g722"!==n&&(r.bitrate&&!sR()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*r.bitrate))),r.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(r.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(r.sampleRate)),r.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1")),t instanceof Bk&&"opus"===n&&t._config.DTX&&(e.fmtp.parameters.usedtx="1"))})}function RU(e){const t=e.attributes.unrecognized.findIndex(e=>"x-google-flag"===e.attField&&"conference"===e.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}function IU(e,t){var s;if(!(t instanceof DD&&t._encoderConfig&&-1===t._hints.indexOf(UO.SCREEN_TRACK)))return;const n=t._encoderConfig;yO().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(e=>{var t,s;Dn(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(s=e.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),yO().supportMinBitrate&&!Dn(s=t._hints).call(s,UO.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(e=>{var t,s;Dn(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(s=e.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(RA("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function AU(e){if("video"!==e.media.mediaType)return;const t=qC();if(t.name!==WC.SAFARI&&t.os!==GC.IOS)return;const s=e.attributes.extmaps.findIndex(e=>/video-orientation/g.test(e.extensionName));-1!==s&&e.attributes.extmaps.splice(s,1)}function OU(e,t,s){if(!t)return;let n,r;if("video"===e.media.mediaType?(n=s.videoExtensions,r=s.videoCodecs):(n=s.audioExtensions,r=s.audioCodecs),!0===t.twcc){const t=n.find(e=>vU(e.extensionName));if(t){const s=t.extensionName;e.attributes.extmaps.find(e=>vU(e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:s});const n=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)))}(r,e.attributes.payloads);n.forEach(e=>{e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)||e.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex(e=>vU(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}if(!0===t.remb){const t=n.find(e=>yU(e.extensionName));if(t){const s=t.extensionName;e.attributes.extmaps.find(e=>e.extensionName===s)||e.attributes.extmaps.push({entry:t.entry,extensionName:s});const n=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)))}(r,e.attributes.payloads);n.forEach(e=>{e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)||e.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex(e=>yU(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"goog-remb"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}}function jU(e,t,s){if(sR())return;if("video"!==e.media.mediaType)return;if(!(t instanceof DD))return;if("vp9"!==s&&"vp8"!==s)return;if("vp8"===s&&!RA("SIMULCAST"))return;if("vp9"===s&&RA("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const n="vp8"===s?2:t._scalabilityMode.numSpatialLayers,r=e.attributes.ssrcs[0],i=e.attributes.ssrcGroups.find(e=>"FID"===e.semantic&&e.ssrcIds[0]===r.ssrcId),a={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let o=1;o<n;o++)e.attributes.ssrcs.push({ssrcId:r.ssrcId+o,attributes:pI(r.attributes)}),a.ssrcIds.push(r.ssrcId+o),i&&(e.attributes.ssrcs.push({ssrcId:i.ssrcIds[1]+o,attributes:pI(r.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+o,i.ssrcIds[1]+o]}));e.attributes.ssrcGroups.unshift(a)}async function kU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const n=(await s.createOffer()).sdp,{send:r,recv:i,sendrecv:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const n=EU(s,e,t,"sendonly"),r=EU(s,e,t,"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(PU(n,r,"videoExtensions",i,a,o),PU(n,r,"videoCodecs",i,a,o),PU(n,r,"audioExtensions",i,a,o),PU(n,r,"audioCodecs",i,a,o),RA("RAISE_H264_BASELINE_PRIORITY")){const e=[],t=[];if(o.videoCodecs.forEach((s,n)=>{var r;if("h264"===(null===(r=s.rtpMap)||void 0===r?void 0:r.encodingName.toLocaleLowerCase())){var i,a;const r=o.videoCodecs[n+1],c=r&&HU(s,r),l=null===(i=s.fmtp)||void 0===i?void 0:i.parameters["profile-level-id"],d=null===(a=s.fmtp)||void 0===a?void 0:a.parameters["packetization-mode"];!l||l!==RA("FIRST_H264_PROFILE_LEVEL_ID")||RA("FIRST_PACKETIZATION_MODE")&&d!==RA("FIRST_PACKETIZATION_MODE")?c?t.push([s,r]):t.push([s]):c?e.push([s,r]):e.push([s])}}),e.length>0&&t.length>0){aO.debug("raising H264 baseline profile priority"),o.videoCodecs.forEach((s,n)=>{var r;if("h264"===(null===(r=s.rtpMap)||void 0===r?void 0:r.encodingName.toLocaleLowerCase())){const r=HU(s,o.videoCodecs[n+1]),i=e.shift()||t.shift()||[];i.length>0&&(r?o.videoCodecs.splice(n,2,...i):o.videoCodecs.splice(n,1,...i))}});const s=a.videoCodecs.filter(e=>{var t,s;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(s=e.fmtp)||void 0===s?void 0:s.parameters["profile-level-id"])!==RA("FIRST_H264_PROFILE_LEVEL_ID")});if(s.length>0){const e=VU(s,a.videoCodecs).map(e=>e.payloadType),t=[...s.map(e=>e.payloadType),...e];a.videoCodecs=a.videoCodecs.filter(e=>!Dn(t).call(t,e.payloadType))}RA("FILTER_SEND_H264_BASELINE")&&(i.videoCodecs=i.videoCodecs.filter(e=>{var t,s;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(s=e.fmtp)||void 0===s?void 0:s.parameters["profile-level-id"])!==RA("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:i,recv:a,sendrecv:o}}return{send:i,recv:a,sendrecv:o}}(e,t,n);try{s.close()}catch(e){}return{send:r,recv:i,sendrecv:a}}function DU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=EU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(PU(e,t,"videoExtensions",s,n,r),PU(e,t,"videoCodecs",s,n,r),PU(e,t,"audioExtensions",s,n,r),PU(e,t,"audioCodecs",s,n,r),RA("RAISE_H264_BASELINE_PRIORITY")){const e=r.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=r.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const s=r.videoCodecs[e];r.videoCodecs.splice(e,1),r.videoCodecs.splice(t,0,s)}-1!==t&&(n.videoCodecs=n.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:s,recv:n,sendrecv:r}}function PU(e,t,s,n,r,i){if("videoExtensions"===s||"audioExtensions"===s){const a=[];return e[s].forEach(e=>{t[s].some((t,s)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(s),!0})?i[s].push(e):n[s].push(e)}),void t[s].forEach((e,t)=>{-1===a.indexOf(t)&&r[s].push(e)})}if("videoCodecs"===s||"audioCodecs"===s){const a=[];return e[s].forEach(e=>{t[s].some((t,s)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(s),!0})?i[s].push(e):n[s].push(e)}),void t[s].forEach((e,t)=>{-1===a.indexOf(t)&&r[s].push(e)})}}function LU(e){const{send:t,recv:s,sendrecv:n}=e;if(!n){if(!t||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:s}}let r,i;return t?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...t.audioCodecs,...n.audioCodecs],r.videoCodecs=[...t.videoCodecs,...n.videoCodecs],r.audioExtensions=[...t.audioExtensions,...n.audioExtensions],r.videoExtensions=[...t.videoExtensions,...n.videoExtensions]):r=n,s?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...s.audioCodecs,...n.audioCodecs],i.videoCodecs=[...s.videoCodecs,...n.videoCodecs],i.audioExtensions=[...s.audioExtensions,...n.audioExtensions],i.videoExtensions=[...s.videoExtensions,...n.videoExtensions]):i=n,{send:r,recv:i}}function MU(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function UU(e,t,s,n){let r=[];if(e===fM.VIDEO){if(RA("H264_PROFILE_LEVEL_ID")&&"h264"===n&&(r=t.videoCodecs.filter(e=>{var t;return Dn(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,n)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===RA("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||0===r.length){let e=[];const i=[],a=[],o=[];if(s.videoCodecs.forEach(t=>{const s=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Dn(s).call(s,n)?e.push(t):Dn(s).call(s,"vp9")?i.push(t):Dn(s).call(s,"vp8")?a.push(t):Dn(s).call(s,"h264")&&o.push(t)}),0===e.length){let t="";0!==i.length?(e=i,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==o.length&&(e=o,t="h264"),aO.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(r=t.videoCodecs.filter(t=>e.some(e=>e.payloadType===t.payloadType)))}if(0===r.length&&(aO.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),r=t.videoCodecs),RA("USE_PUB_RTX")||RA("USE_SUB_RTX")){const e=VU(r,t.videoCodecs);r=[...r,...e]}}else{r=t.audioCodecs.filter(e=>{var t;return Dn(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,n)});const e=t.audioCodecs.filter(e=>{var t;return Dn(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"red")});0===r.length&&(aO.warning("codec ".concat(n," not included in rtpCapabilities, fallback to opus")),r=t.audioCodecs.filter(e=>{var t;return Dn(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})),RA("ENABLE_AUDIO_RED")&&0!==e.length&&(r=[...e,...r])}return r}function VU(e,t){const s=e.map(e=>e.payloadType.toString());return t.filter(e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Dn(s).call(s,e.fmtp&&e.fmtp.parameters.apt))}async function FU(e,t,s){const n=t.toString(),r=GU(n,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:n});const i=await e.createAnswer();if(!i.sdp)throw new Error("cannot get answer sdp");let a=i.sdp;a=BU(a,s||{}),null==r||r(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function BU(e,t,s){const n=VA(e),{useXR:r}=t;return n.mediaDescriptions.forEach(e=>{var t;e.attributes.mid&&(Array.isArray(s)&&!Dn(s).call(s,e.attributes.mid)||("audio"===e.media.mediaType&&MU(e),r&&Dn(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach(e=>{-1===e.rtcpFeedbacks.findIndex(e=>"rrtr"===e.type)&&e.rtcpFeedbacks.push({type:"rrtr"})})))}),FA(n)}function GU(e,t,s,n){if(RA("SDP_LOGGING"))return aO.upload("exchanging ".concat(s," ").concat(t," SDP during P2PConnection.").concat(n,"\n"),e),"offer"===t?e=>{GU(e,"answer","local"===s?"remote":"local",n)}:void 0}function WU(e){const t=RA("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(t=>Dn(e).call(e,t))}function HU(e,t){try{var s;return(null===(s=e.fmtp)||void 0===s?void 0:s.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function KU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function zU(e,t){return typeof RA(e)===t?RA(e):void 0}function qU(){try{const e=RA("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?KU(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):KU(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},e)}catch(e){return aO.debug("handle gateway attributes failed: ",e),{}}}const YU={};function XU(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&aO.debug("install service ".concat(e.name)),YU[e.name]=e}function JU(e){const t=YU[e];if(!t)throw new IR(RR.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function QU(e,t){return JU("DataStream").create(e,t)}function ZU(){return JU("InterceptFrame").create()}function $U(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function eV(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?$U(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$U(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const tV=new Map;class sV extends HR{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(rM.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(rM.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){aO.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var s,n,r;super(),uS(this,"store",void 0),uS(this,"joinInfo",void 0),uS(this,"key",void 0),uS(this,"ntpOffset",0),uS(this,"signal",void 0),uS(this,"role",void 0),uS(this,"isPreallocation",void 0),uS(this,"isPreSub",void 0),uS(this,"inChannelInfo",{joinAt:null,duration:0}),uS(this,"spec",void 0),uS(this,"_state","DISCONNECTED"),uS(this,"_statsCollector",void 0),uS(this,"_disconnectedReason",void 0),uS(this,"isSignalRecover",!1),uS(this,"hasChangeBGPAddress",!1),uS(this,"trafficStatsInterval",void 0),uS(this,"networkQualityInterval",void 0),uS(this,"_joinGatewayStartTime",0),uS(this,"_signalTimeout",!1),uS(this,"_clientRoleOptions",void 0),uS(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(s={spec:eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(n=(r=JU("P2PChannel")).createSubmodule)||void 0===n?void 0:n.call(r,s)):new QM(eV(eV({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,s){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const n=Date.now();let r=tV.get(e.cname);if(r||(r=new Map,tV.set(e.cname,r)),this._isProactiveJoin=!0,r.has(e.uid)){const t=new fO(RR.UID_CONFLICT);throw mO.joinGateway(e.sid,{lts:n,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}r.set(e.uid,!0),this.joinInfo=e,this.key=t;let i=0;this.joinGatewayStartTime=n;const a=e.proxyServer;try{aO.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(i));const t=e.gatewayAddrs.map(t=>{let{address:s}=t;const[n,r]=s.split(":"),i={host:n,port:r};return e.proxyServer&&(i.proxy=e.proxyServer),i});i=(await this.signal.init(t)).uid,aO.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(i," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var o;throw aO.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),mO.joinGateway(e.sid,{lts:n,succ:!1,ec:(null===(o=t.data)||void 0===o?void 0:o.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!a,signalChannel:"0",preload:e.preload}),r.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),aO.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{aO.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(rM.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(rM.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(rM.NETWORK_QUALITY,{uplinkNetworkQuality:oU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:oU(this._statsCollector.trafficStats.B_dnq)}):this.emit(rM.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),i}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==QR.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==PL.CONNECTED||await function(e,t){return t===1/0?e:sp.race([e,wI(t)])}(this.signal.request(ML.LEAVE,void 0,!0),3e3)}catch(e){aO.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==QR.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,s){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const n={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:RA("PUB_EXTEND"),twcc:!!RA("PUBLISH_TWCC"),rtx:!!RA("USE_PUB_RTX")};try{return(await this.signal.request(ML.PUBLISH,n,!0))._message}catch(n){if(s&&n.data&&n.data.code===DL.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),n.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw n}}async publishDataChannel(e,t,s){var n;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(n=t.maxRetransmits)&&void 0!==n?n:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(ML.PUBLISH_DATASTREAM,r,!0)}catch(n){if(s&&n.data&&n.data.code===DL.ERR_PUBLISH_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),n.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw n}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ML.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await sp.all(e.map(e=>this.signal.request(ML.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){aO.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,s){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const n={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!RA("SUBSCRIBE_TWCC"),rtx:!!RA("USE_SUB_RTX")||void 0,extend:RA("SUB_EXTEND"),svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return await this.signal.request(ML.PRE_SUBSCRIBE,n,!0)}catch(n){if(s&&n.data&&n.data.code===DL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),n.toString()),this.presubscribe(e,t,!1);throw n}}async subscribe(e,t,s){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const n={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!RA("SUBSCRIBE_TWCC"),rtx:!!RA("USE_SUB_RTX"),extend:RA("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return(await this.signal.request(ML.SUBSCRIBE,n,!0))._message}catch(n){if(s&&n.data&&n.data.code===DL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),n.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw n}}async subscribeDataChannel(e,t,s){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const n={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(ML.SUBSCRIBE_DATASTREAM,n,!0)}catch(n){if(s&&n.data&&n.data.code===DL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),n.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw n}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!RA("USE_SUB_RTX"),twcc:!!RA("SUBSCRIBE_TWCC"),svc:Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0};try{return await this.signal.request(ML.SUBSCRIBE_STREAMS,s,!0)}catch(s){if(t&&s.data&&s.data.code===DL.ERR_SUBSCRIBE_REQUEST_INVALID)return aO.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw s}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,s=e.width,n=e.height,r=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(r=!1)),"number"!=typeof s&&(s=s.exact||s.ideal||s.max||s.min||0,s||(r=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,t||(r=!1)),r?{stream_type:0,width:s,height:n,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(ML.SET_VIDEO_PROFILE,t);aO.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(ML.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new fO(RR.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await sp.all(e.map(e=>this.signal.request(ML.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0)))}catch(e){aO.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(ML.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){aO.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:s,rtpCapabilities:n}=e;return{gatewayEstablishParams:await this.signal.request(ML.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:s,rtpCapabilities:n}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ML.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ML.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),RA("CLIENT_ROLE_OPTIONS")&&(aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(RA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},RA("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),RA("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},RA("CLIENT_ROLE_OPTIONS")),aO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(RA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let s,n=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,n=1):n=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:n=0;const r=Object.assign({},t);delete r.delay,delete r.level,await this.signal.request(ML.SET_CLIENT_ROLE,eV(eV({role:e,level:n,delay:s},r),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(ML.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ML.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(ML.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(ML.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ML.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),eV({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ML.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=tV.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:EA.username,password:EA.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(eV(eV({},EA),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(ML.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(t=>t.peer_uid===e.peer_uid);t&&t.B_st!==e.B_st&&hI(()=>{this.emit(rM.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t,s;if(!this.joinInfo||!this.key)throw new fO(RR.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=RA("REPORT_APP_SCENARIO");if("string"!=typeof r)try{r=JSON.stringify(r)}catch(e){r=void 0}var i;r&&r.length>128&&(r=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(rM.UPDATE_GATEWAY_CONFIG),i=this.store.clientId,Dn(HP).call(HP,i)||HP.push(i);const a=_O(this.store),o=!(null===(t=this.isPreallocation)||void 0===t||!t.call(this)),c=EO(this.store),l=qU(),d=rR(87)||eR()||cR(117),u=(function(){const e=qC();if(e.name!==WC.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>18||18===Number(t[0])&&Number(t[1])>=4}()||dR(18,4,!1))&&hR(18,6,!0)&&"h264"===this.spec.codec&&RA("ENABLE_ABSSENDTIME_AS_SENTTS"),h=eV({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:vA,browser:navigator.userAgent,process_id:RA("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:RA("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:eV(eV({enableEncodedTransform:(!!RA("ENABLE_AUDIO_METADATA")||!!RA("ENABLE_AUDIO_PTS"))&&d||!!RA("ENABLE_AUDIO_TOPN")&&aR(WC.CHROME,87,116)||void 0,enableAudioMetadata:!!RA("ENABLE_AUDIO_METADATA")&&d,enableAudioPts:!!RA("ENABLE_AUDIO_PTS")&&d,topnSmoothLevel:RA("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:RA("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:RA("TOPN_SWITCH_HOLD_MS"),topnAudioGain:RA("TOPN_AUDIO_GAIN"),enablePublishedUserList:RA("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:RA("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:zU("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:zU("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:zU("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===RA("USE_PUB_RTX")||!0===RA("USE_SUB_RTX")||void 0,disableFEC:RA("DISABLE_FEC"),enableNTPReport:!!RA("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:c,enableFulllinkAvSync:!!RA("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:zU("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!RA("FORCE_ENABLE_AUT_CC")||!xO()&&(!!RA("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!RA("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:zU("USE_XR","boolean"),enableLossbasedBwe:zU("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!RA("FORCE_ENABLE_AUT_CC")||!xO()&&(!!RA("ENABLE_AUT_CC")||void 0),enableCCFallback:zU("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:a?zU("PRE_SUB_NUM","number"):void 0,enablePubTWCC:zU("PUBLISH_TWCC","boolean"),enableSubTWCC:zU("SUBSCRIBE_TWCC","boolean"),enablePubRTX:zU("USE_PUB_RTX","boolean"),enableSubRTX:zU("USE_SUB_RTX","boolean"),enableSubSVC:RA("ENABLE_SVC")?RA("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(RA("SVC"))&&0!==RA("SVC").length?RA("SVC"):void 0,enableSvcExtended:RA("ENABLE_SVC")&&Array.isArray(RA("SVC_EXTENDED"))&&0!==RA("SVC_EXTENDED").length?RA("SVC_EXTENDED"):void 0},l),{},{audioDuplicate:zU("ENABLE_AUDIO_RED","boolean")?null!==(s=zU("AUDIO_DUPLICATE_NUM","number"))&&void 0!==s?s:2:void 0,senttsUsesAbsSendTime:!!u||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,RA("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),void 0!==this.joinInfo.defaultVideoStream&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new fO(RR.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(LL.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(LL.WS_RECONNECTING,e=>{this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||sI.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",mO.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(LL.WS_CLOSED,e=>{let t;switch(e){case QR.LEAVE:t=sI.LEAVE;break;case QR.UID_BANNED:case QR.IP_BANNED:case QR.CHANNEL_BANNED:case QR.SERVER_ERROR:t=sI.SERVER_ERROR;break;case QR.FALLBACK:t=sI.FALLBACK;break;case QR.LICENSE_MISSING:case QR.LICENSE_EXPIRED:case QR.LICENSE_MINUTES_EXCEEDED:case QR.LICENSE_PERIOD_INVALID:case QR.LICENSE_MULTIPLE_SDK_SERVICE:case QR.LICENSE_ILLEGAL:case QR.TOKEN_EXPIRE:t=e;break;default:t=sI.NETWORK_ERROR}aO.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+sI.NETWORK_ERROR)),this.joinInfo&&mO.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===QR.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==QR.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(LL.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){const e=RA("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(aO.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void aO.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));CA("EVENT_REPORT_DOMAIN",e[1]),CA("EVENT_REPORT_BACKUP_DOMAIN",e[1]),CA("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(VL.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(LL.REQUEST_RECOVER,(e,t,s)=>{if(!this.joinInfo)return s(new fO(RR.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,iI(this,rM.REQUEST_NEW_GATEWAY_LIST).then(t).catch(s)}),this.signal.on(LL.REQUEST_JOIN_INFO,async(e,t,s)=>{var n,r,i;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const a=pI(null===(n=this.joinInfo)||void 0===n?void 0:n.turnServer);if(RA("NEW_TURN_MODE")&&a&&"disabled"===(null===(r=this.joinInfo)||void 0===r?void 0:r.cloudProxyServer)){var o;let e=a.servers.map(e=>"turnServerURL"in e&&RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:nU(e.turnServerURL)}):e),t=null===(o=a.serversFromGateway)||void 0===o?void 0:o.map(e=>RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:nU(e.turnServerURL)}):e);const s=this.signal.currentURLIndex;e.length>0&&(e=[e[s%e.length]],a.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],a.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(s))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await iI(this,rM.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:a,cloudProxyServer:null===(i=this.joinInfo)||void 0===i?void 0:i.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(e){t(e)}}),this.signal.on(LL.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(LL.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let s,n="";var r;e instanceof fO?(s=(null===(r=e.data)||void 0===r?void 0:r.desc)||e.code,n=e.message):s=e,mO.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:n,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(LL.IS_P2P_DISCONNECTED,e=>{e(cI(this,rM.IS_P2P_DISCONNECTED))}),this.signal.on(LL.DISCONNECT_P2P,()=>{this.emit(rM.DISCONNECT_P2P)}),this.signal.on(LL.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(LL.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(LL.JOIN_RESPONSE,e=>{const t=this.getCurrentGatewayAddress();this.emit(rM.JOIN_RESPONSE,e,t)}),this.signal.on(LL.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,t;this.updateTurnConfigFromSignal();const n=this.getCurrentGatewayAddress(),r=pI(null===(e=this.joinInfo)||void 0===e?void 0:e.turnServer);if(RA("NEW_TURN_MODE")&&r&&"disabled"===(null===(t=this.joinInfo)||void 0===t?void 0:t.cloudProxyServer)){var s;let e=r.servers.map(e=>"turnServerURL"in e&&RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:nU(e.turnServerURL)}):e),t=null===(s=r.serversFromGateway)||void 0===s?void 0:s.map(e=>RA("USE_TURN_IP")?eV(eV({},e),{},{turnServerURL:nU(e.turnServerURL)}):e);const n=this.signal.currentURLIndex;e.length>0&&(e=[e[n%e.length]],r.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],r.serversFromGateway=t),aO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(n,",in pre pc"))}const i=RA("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&i){const e=SU(n);this.emit(rM.PRE_CONNECT_PC,{candidates:e,fingerprint:i,turnServer:r})}}}),this.signal.on(LL.RECOVER_NOTIFICATION,e=>{this.joinInfo&&"string"==typeof RA("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(RA("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(ML.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(ML.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw aO.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(ML.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(ML.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw aO.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map(e=>({stream_id:e.stream_id,stream_type:e.stream_type}))};try{await this.signal.request(ML.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const s={action:e.find(e=>e.stream_type===nM.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ML.CONTROL,s,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const s={action:e.find(e=>e.stream_type===nM.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ML.CONTROL,s,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const s={action:e===fM.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ML.CONTROL,s,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const s={action:e===fM.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ML.CONTROL,s,!0,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ML.RESTART_ICE,t,!0)}catch(e){throw aO.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||sI.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!RA("GATEWAY_WSS_ADDRESS"))return RA("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(aO.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ML.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let nV=0,rV=0;function iV(e,t,s,n){return new sp((r,i)=>{t.timeout=t.timeout||RA("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),nV+=EI(t.data)):s&&(t.data.size?nV+=t.data.size:t.data instanceof FormData?nV+=bI(t.data):nV+=EI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,LC.request(t).then(e=>{"string"==typeof e.data?rV+=EI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?rV+=e.data.byteLength:rV+=EI(JSON.stringify(e.data)),n&&r({data:e.data,headers:e.headers}),r(e.data)}).catch(e=>{LC.isCancel(e)?i(new fO(RR.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?i(new fO(RR.NETWORK_TIMEOUT,e.message)):e.response?i(new fO(RR.NETWORK_RESPONSE_ERROR,e.response.status)):i(new fO(RR.NETWORK_ERROR,e.message))})})}!function(){var e;function s(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){return e==Array.prototype||e==Object.prototype||(e[t]=s.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var s=0;s<e.length;++s){var n=e[s];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var s=i;e=e.split(".");for(var n=0;n<e.length-1;n++){var a=e[n];if(!(a in s))break e;s=s[a]}(t=t(n=s[e=e[e.length-1]]))!=n&&null!=t&&r(s,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:s(e)}}if(a("Symbol",function(e){function t(e,t){this.A=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var s="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",n=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(s+(r||"")+"_"+n++,r)}}),a("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<t.length;n++){var a=i[t[n]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&r(a.prototype,e,{configurable:!0,writable:!0,value:function(){return o(s(this))}})}return e}),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var l;e:{var d={};try{d.__proto__={a:!0},l=d.a;break e}catch(e){}l=!1}n=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var u=n;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function m(e,t){return e.h=3,{value:t}}function f(e){this.g=new h,this.G=e}function g(e,t,s,n){try{var r=t.call(e.g.j,s);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return e.g.m=!1,r;var i=r.value}catch(t){return e.g.j=null,e.g.s(t),y(e)}return e.g.j=null,n.call(e.g,i),y(e)}function y(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function v(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var s=e.g.j;return s?g(e,"return"in s?s.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),y(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function x(e,t){return t=new v(new f(t)),u&&e.prototype&&u(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return p(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),y(this))},f.prototype.s=function(e){return p(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),y(this))},a("Array.prototype.entries",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var s=0,n=!1,r={next:function(){if(!n&&s<e.length){var r=s++;return{value:t(r,e[r]),done:!1}}return n=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,function(e,t){return[e,t]})}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var _=function(e,t){for(var s=0;s<e.length;s++)t(e[s])},E=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},b=function(e,t,s){return t instanceof Blob?(s=void 0!==s?String(s+""):"string"==typeof t.name?t.name:"blob",t.name===s&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],s)),[String(e),t]):[String(e),String(t)]},w=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},N="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,S=N.FormData,T=N.XMLHttpRequest&&N.XMLHttpRequest.prototype.send,C=N.Request&&N.fetch,R=N.navigator&&N.navigator.sendBeacon,I=N.Element&&N.Element.prototype,A=N.Symbol&&Symbol.toStringTag;A&&(Blob.prototype[A]||(Blob.prototype[A]="Blob"),"File"in N&&!File.prototype[A]&&(File.prototype[A]="File"));try{new File([],"")}catch(e){N.File=function(e,t,s){return e=new Blob(e,s||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(s&&void 0!==s.lastModified?new Date(s.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),A&&Object.defineProperty(e,A,{value:"File"}),e}}var O=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},j=function(e){this.i=[];var t=this;e&&_(e.elements,function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var s=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];_(s,function(s){t.append(e.name,s)})}else"select-multiple"===e.type||"select-one"===e.type?_(e.options,function(s){!s.disabled&&s.selected&&t.append(e.name,s.value)}):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(s="textarea"===e.type?E(e.value):e.value,t.append(e.name,s))})};if((e=j.prototype).append=function(e,t,s){w(arguments,2),this.i.push(b(e,t,s))},e.delete=function(e){w(arguments,1);var t=[];e=String(e),_(this.i,function(s){s[0]!==e&&t.push(s)}),this.i=t},e.entries=function e(){var t,s=this;return x(e,function(e){if(1==e.h&&(t=0),3!=e.h)return t<s.i.length?e=m(e,s.i[t]):(e.h=0,e=void 0),e;t++,e.h=2})},e.forEach=function(e,t){w(arguments,1);for(var s=c(this),n=s.next();!n.done;n=s.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.call(t,r,n,this)}},e.get=function(e){w(arguments,1);var t=this.i;e=String(e);for(var s=0;s<t.length;s++)if(t[s][0]===e)return t[s][1];return null},e.getAll=function(e){w(arguments,1);var t=[];return e=String(e),_(this.i,function(s){s[0]===e&&t.push(s[1])}),t},e.has=function(e){w(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,s,n,r=this;return x(e,function(e){if(1==e.h&&(t=c(r),s=t.next()),3!=e.h)return s.done?void(e.h=0):(n=s.value,m(e,c(n).next().value));s=t.next(),e.h=2})},e.set=function(e,t,s){w(arguments,2),e=String(e);var n=[],r=b(e,t,s),i=!0;_(this.i,function(t){t[0]===e?i&&(i=!n.push(r)):n.push(t)}),i&&n.push(r),this.i=n},e.values=function e(){var t,s,n,r,i=this;return x(e,function(e){if(1==e.h&&(t=c(i),s=t.next()),3!=e.h)return s.done?void(e.h=0):(n=s.value,(r=c(n)).next(),m(e,r.next().value));s=t.next(),e.h=2})},j.prototype._asNative=function(){for(var e=new S,t=c(this),s=t.next();!s.done;s=t.next()){var n=c(s.value);s=n.next().value,n=n.next().value,e.append(s,n)}return e},j.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],s="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(e,n){return"string"==typeof e?t.push(s+O(E(n))+'"\r\n\r\n'+E(e)+"\r\n"):t.push(s+O(E(n))+'"; filename="'+O(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")}),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},j.prototype[Symbol.iterator]=function(){return this.entries()},j.prototype.toString=function(){return"[object FormData]"},I&&!I.matches&&(I.matches=I.matchesSelector||I.mozMatchesSelector||I.msMatchesSelector||I.oMatchesSelector||I.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),A&&(j.prototype[A]="FormData"),T){var k=N.XMLHttpRequest.prototype.setRequestHeader;N.XMLHttpRequest.prototype.setRequestHeader=function(e,t){k.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},N.XMLHttpRequest.prototype.send=function(e){e instanceof j?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),T.call(this,e)):T.call(this,e)}}C&&(N.fetch=function(e,t){return t&&t.body&&t.body instanceof j&&(t.body=t.body._blob()),C.call(this,e,t)}),R&&(N.navigator.sendBeacon=function(e,t){return t instanceof j&&(t=t._asNative()),R.call(this,e,t)}),N.FormData=j}}();const aV=()=>{const e=RA("AREAS");return 0===e.length&&e.push(oM.GLOBAL),rr(e).call(e,(e,t,s)=>{const n=oV(t);return n?0===s?n:"".concat(e,",").concat(n):e},"")},oV=e=>e===oM.OVERSEA?"".concat(lM.ASIA,",").concat(lM.EUROPE,",").concat(lM.AFRICA,",").concat(lM.NORTH_AMERICA,",").concat(lM.SOUTH_AMERICA,",").concat(lM.OCEANIA):lM[e],cV=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(e=>{const s=dM[e],n=Object.keys(s);n&&n.map(e=>{"CODE"!==e&&(t[e]=t[e].concat(s[e]))})}),t},lV={GLOBAL:{ASIA:[oM.CHINA,oM.JAPAN,oM.INDIA,oM.KOREA,oM.HKMC],EUROPE:[],NORTH_AMERICA:[oM.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dV=Object.keys(lV[oM.GLOBAL]),uV=[oM.CHINA,oM.NORTH_AMERICA,oM.EUROPE,oM.ASIA,oM.JAPAN,oM.INDIA,oM.OCEANIA,oM.SOUTH_AMERICA,oM.AFRICA,oM.KOREA,oM.HKMC,oM.US],hV=function(e,t){let s=[];if(Dn(e).call(e,oM.GLOBAL)){const i=[oM.GLOBAL,oM.OVERSEA],a=Object.keys(dM);if(t===oM.GLOBAL)throw new fO(RR.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===oM.CHINA)s=[oM.OVERSEA];else if(r=t,Dn(dV).call(dV,r)){const e=(n=t,lV[oM.GLOBAL][n]||[]),r=[...i,t,...e];s=a.filter(e=>!Dn(r).call(r,e))}else if(function(e){let t=!1;return dV.forEach(s=>{var n;Dn(n=lV[oM.GLOBAL][s]).call(n,e)&&(t=!0)}),t}(t)){const e=function(e){let t;return dV.forEach(s=>{var n;Dn(n=lV[oM.GLOBAL][s]).call(n,e)&&(t=s)}),t}(t),n=[...i,e,t];s=a.filter(e=>!Dn(n).call(n,e))}else s=e;s=function(e){const t=[];return uV.forEach(s=>{Dn(e).call(e,s)&&t.push(s)}),t.concat(e.filter(e=>!Dn(uV).call(uV,e)))}(s)}else s=e;var n,r;return s};function pV(e){var t,s;if(!e&&Dn(t=RA("AREAS")).call(t,oM.EXTENSIONS))return aO.debug("update area from ap : reset"),void mV(BP,!0);if(!Dn(s=RA("AREAS")).call(s,oM.GLOBAL)||!e)return;let n=dM.EXTENSIONS;n&&(n={CODE:oV(oM.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},aO.debug("update area from ap success: ".concat(e,",config is "),n),CA("AREAS",[oM.EXTENSIONS],!0),Object.keys(n).map(e=>{CA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?n[e][0]:n[e])}))}function mV(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=mO.reportApiInvoke(null,{name:qR.SET_AREA,options:e,tag:YR.TRACER});try{let n=[];if("string"==typeof e&&(n=[e]),Array.isArray(e)&&(e.forEach(e=>{if(!Dn(cM).call(cM,e))throw new fO(RR.INVALID_PARAMS,"invalid area code")}),n=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:s}=e;if(!t)throw new fO(RR.INVALID_PARAMS,"area code is needed");let r=t;"string"==typeof t&&(r=[t]),n=s?hV(r,s):r}if(!t){if(AA.AREAS){const e=new fO(RR.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(e),void aO.warning("setArea is prohibited because of config-distribute")}if(Dn(n).call(n,oM.GLOBAL)&&RA("AREAS")===oM.EXTENSIONS){const e=new fO(RR.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(e),void aO.warning("setArea is prohibited because of ap extensions")}}CA("AREAS",n,t);const r=cV(n);Object.keys(r).map(e=>{CA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])}),aO.debug("set area success:",n.join(","))}catch(e){throw s.onError(e),e}s.onSuccess()}function fV(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function gV(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?fV(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):fV(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let yV=1;function vV(e,t,s,n,r){yV+=1;const i={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:yV,requestId:yV,version:vA,cname:s.cname},a={service_name:t,json_body:JSON.stringify(i)};let o,c,l=e[0];return GI(async()=>{o=Date.now();const e=await iV(l,{data:a,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-o,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw aO.error(t.toString()),t}const s=JSON.parse(e.json_body);if(200!==s.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(s.code,", reason: ").concat(s.reason),{code:s.code,responseTime:c});throw aO.error(e.toString()),e}if(!s.servers||0===s.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:s.code,responseTime:c});throw aO.error(e.toString()),e}const r=function(e,t){return{addressList:e.servers.map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(RA("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))),workerToken:e.workerToken,vid:e.vid}}(s,t);return RA("LIVE_STREAMING_ADDRESS")&&(r.addressList=RA("LIVE_STREAMING_ADDRESS")instanceof Array?RA("LIVE_STREAMING_ADDRESS"):[RA("LIVE_STREAMING_ADDRESS")]),gV(gV({},r),{},{responseTime:c})},(n,r)=>(mO.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(n.addressList),firstSuccess:0===r,responseTime:c,serverIp:e[r%e.length]}),!1),(n,r)=>(mO.apworkerEvent(s.sid,{success:!1,sc:n.data&&n.data.code||200,serviceName:t,responseTime:c,serverIp:e[r%e.length]}),!!(n.code!==RR.OPERATION_ABORTED&&n.code!==RR.UNEXPECTED_RESPONSE||n.data&&n.data.retry)&&(l=e[(r+1)%e.length],!0)),r)}let xV=1;function _V(e,t,s,n){let{url:r,areaCode:i}=e;const{clientId:a,sid:o}=t,c=Date.now();let l;const d=t.role,[u,h]=SV(t,i,[$M.CHOOSE_SERVER]);let p=lI.networkState;return GI(async()=>{p&&lI.networkState===nI.OFFLINE&&lI.onlineWaiter&&await sp.race([lI.onlineWaiter,NI(n&&n.maxRetryTimeout||FI.maxRetryTimeout)]),p=lI.networkState;const{data:e,headers:i}=await iV(r,{data:u,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===i.http3?1:-1,mO.reportResourceTiming(r,o),bV(e,r,t,c,[$M.CHOOSE_SERVER],l);const a=cU(e,$M.CHOOSE_SERVER);return wV(a),rU(a,r)},e=>(e&&mO.joinChooseServer(o,{role:d,lts:c,succ:!0,csAddr:r,opid:h,serverList:e.gatewayAddrs.map(e=>e.address),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1),e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinChooseServer(o,{role:d,lts:c,succ:!1,csAddr:r,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),aO.warning("[".concat(a||"sid-".concat(o.slice(0,6)),"] Choose server network error, retry"),e),!0)),n)}function EV(e,t,s,n){let r,{url:i,areaCode:a,serviceIds:o}=e;const c=Date.now(),l=t.role,[d,u]=SV(t,a,o);let h;return GI(async()=>{h&&lI.networkState===nI.OFFLINE&&lI.onlineWaiter&&await sp.race([lI.onlineWaiter,NI(n&&n.maxRetryTimeout||FI.maxRetryTimeout)]),h=lI.networkState;const{data:e,headers:a}=await iV(i,{data:d,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===a.http3?1:-1,mO.reportResourceTiming(i,t.sid),bV(e,i,t,c,o,r);const l=cU(e,$M.CHOOSE_SERVER),u=cU(e,"proxy5"===t.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK),p=performance.getEntriesByName(i),m=p[p.length-1];let f;return m&&(f={name:m.name,protocol:"nextHopProtocol"in m?m.nextHopProtocol:"",dnscost:"domainLookupEnd"in m&&"domainLookupStart"in m&&"number"==typeof m.domainLookupEnd&&"number"==typeof m.domainLookupStart?m.domainLookupEnd-m.domainLookupStart:-1,tcpTlsCost:"connectEnd"in m&&"connectStart"in m&&"number"==typeof m.connectEnd&&"number"==typeof m.connectStart?m.connectEnd-m.connectStart:-1,reqCost:"requestStart"in m&&"number"==typeof m.requestStart&&"responseEnd"in m&&"number"==typeof m.responseEnd?m.responseEnd-m.requestStart:-1,handleCost:"leave_ts"in e&&"enter_ts"in e&&"number"==typeof e.leave_ts&&"number"==typeof e.enter_ts?e.leave_ts-e.enter_ts:-1}),wV(l),{gatewayInfo:rU(l,i),proxyInfo:u,url:i,resourceTimingInfo:f}},e=>(e.gatewayInfo&&mO.joinChooseServer(t.sid,{role:l,lts:c,succ:!0,csAddr:i,serverList:e.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,opid:u,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:o.toString(),isHttp3:r,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38],resourceTimingInfo:e.resourceTimingInfo?JSON.stringify(e.resourceTimingInfo):void 0}),e.proxyInfo&&mO.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:i,turnServerAddrList:e.proxyInfo.addresses.map(e=>e.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:o.toString()}),!1),e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(mO.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:o.toString(),extend:JSON.stringify({networkState:h})}),aO.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0)),n)}const bV=(e,t,s,n,r,i)=>{const{sid:a,clientId:o,cloudProxyServer:c}=s,l=[],d=o=>{4096===o.flag?mO.joinChooseServer(a,{role:s.role,lts:n,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:o.error.message,csIp:o.error.data&&o.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:i,corssRegionTagReq:s.apRequestDetail}):1048576!==o.flag&&4194304!==o.flag&&4194310!==o.flag||mO.joinWebProxyAP(a,{lts:n,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:o.error.code,eventType:c,unilbsServerIds:r.toString()})};if(e.response_body.forEach(t=>{const s=t.buffer.code;if(23===t.uri&&0===s&&!t.buffer.edges_services)if(4194310===t.buffer.flag)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const s={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};l.push(s),d(s)}if(0!==s){const n=PM(s),r={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,n.desc,{desc:n.desc,retry:n.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?aO.warning(r.error.toString()):l.push(r),d(r)}}),l.length)throw aO.warning("[".concat(o||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)).join(" | "))),new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,l.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!l.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(l.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})},wV=e=>{var t,s,n,r;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(RA("AP_AREA")&&(null!==(n=e.detail)&&void 0!==n&&n[23]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[23])?pV(e.detail[23].toLowerCase()):pV()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(s=e.detail)||void 0===s?void 0:s[19])){const t=e.detail[19],s=null==t?void 0:t.split(";");for(let n=0;n<s.length;n++){var i;const t=jx(i=s[n]).call(i);e.addresses[n]&&s&&(e.addresses[n].fingerprint=t)}}if(RA("GATEWAY_ADDRESS")&&RA("GATEWAY_ADDRESS").length>0){aO.debug("assign gateway address to",RA("GATEWAY_ADDRESS"));const t=RA("GATEWAY_ADDRESS").map(t=>{var s,n;const r=null!==(s=null===(n=e.addresses.find(e=>e.ip===t.ip&&e.port===t.port))||void 0===n?void 0:n.fingerprint)&&void 0!==s?s:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:r}});e.addresses=t}},NV=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=PM(t.buffer.code);throw new fO(RR.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw aO.debug("update ticket request received ap response without response body:",t),new fO(RR.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},SV=(e,t,s)=>{const n=Math.floor(Math.random()*10**12),r="host"===e.role?"1":"audience"===e.role?"2":void 0,i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:gV(gV(gV({6:e.stringUid,11:t,12:RA("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:s,uid:e.uid||0}}]};i.request_bodies.forEach(t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(i)),[a,n]},TV=(e,t)=>{const s=Math.floor(Math.random()*10**12),n={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(e=>({ip:e.ip,port:e.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(n)),[r,s]};let CV=0;function RV(e){return sp.all(e.map(e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}const IV=async e=>{let{fragementLength:t,referenceList:s,asyncMapHandler:n,allFailedhandler:r,promisesCollector:i}=e,a=0;const o=t;let c,l=0;const d=async()=>{const e=(()=>{const e=a*o,t=e+o;return s.slice(e,t).map(n)})();i&&i.push(...e);try{c=await RV(e)}catch(e){if(l+=o,a++,!(l>=s.length))return void await d();r(e)}e.forEach(e=>e.cancel())};return await d(),c},AV=async e=>{let{referenceList:t,asyncMapHandler:s,closeFn:n}=e;const r=t.length;let i=0;const a=async()=>{const e=s(t.shift());try{return await e}catch(e){if(i++,i>=r||null!=n&&n(e))throw e;return a()}};return a()};async function OV(){if("undefined"==typeof VideoDecoder)return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],r=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],i=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],a=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128],o=await new sp((o,c)=>{let l;!async function(){e&&"closed"!==e.state||await async function(){e=new VideoDecoder({output:e=>{e.close(),clearTimeout(l),o(!0)},error:e=>{clearTimeout(l),o(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const c=[t,s,n,r,i,a];for(let t=0;t<c.length;t++){const s=new EncodedVideoChunk({type:0==t?"key":"delta",timestamp:33333*t,duration:33333,data:new Uint8Array(c[t])});try{await e.decode(s)}catch(e){return void o(!1)}}}(),l=setTimeout(()=>{o(!1)},5e3)});return o}async function jV(e,t,s,n){const r=async function(e,t,s,n){let r=null;const i=[],a=async()=>{const r=RA("WEBCS_DOMAIN").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),a=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:r.map(e=>e.url)}),o=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:r,asyncMapHandler:n=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),n.url),_V(n,e,t,s)),allFailedhandler:e=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:i});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},a),o},o=async()=>{if(await NI(1e3),null!==r)return r;const a=RA("WEBCS_DOMAIN_BACKUP_LIST").map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:aV()})),o=n.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map(e=>e.url)}),c=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:n=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),n.url),_V(n,e,t,s)),allFailedhandler:e=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:i});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},o),c};try{return r=await RV([a(),o()]),i.length&&i.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),r}catch(e){throw e[0]}}(e,t,s,n);return{gatewayInfo:await r}}async function kV(e,t,s,n,r){const i=e.cloudProxyServer;if("disabled"===i){if(!n)return;if(e.useLocalAccessPoint)return await jV(e,t,s,r);if(RA("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:n,proxyInfo:i}=await UV(e,t,s,r);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:n};const o=i.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||EA.tcpport,udpport:e.udpport||EA.udpport,username:e.username||EA.username,password:e.password||EA.password,forceturn:!1,security:!0}));if(r.useP2P){var a;const t=null!==(a=e.uid)&&void 0!==a?a:n.uid,s="glb:".concat(t.toString()),r=await WR(s),c=i.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||EA.tcpport,udpport:e.udpport||EA.udpport,username:s,password:r,forceturn:!1,security:!0}));o.push(...c)}return e.turnServer={mode:"manual",servers:o},{gatewayInfo:n}}return await jV(e,t,s,r)}const{proxyInfo:o,gatewayInfo:c}=await UV(e,t,s,r),l={gatewayInfo:c},d=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===i?void 0:e.tcpport?e.tcpport:EA.tcpport,udpport:"proxy4"===i?void 0:e.udpport?e.udpport:EA.udpport,username:e.username||EA.username,password:e.password||EA.password,forceturn:"proxy4"!==i,security:"proxy5"===i}));if(r.useP2P){var u;const t=null!==(u=e.uid)&&void 0!==u?u:c.uid,s="glb:".concat(t.toString()),n=await WR(s),r=o.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===i?void 0:e.tcpport||EA.tcpport,udpport:"proxy4"===i?void 0:e.udpport||EA.udpport,username:s,password:n,forceturn:"proxy4"!==i,security:"proxy5"===i}));d.push(...r)}return e.turnServer={mode:"manual",servers:d},aO.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(i)),l}async function DV(e,t,s,n,r){const i=RA("ACCOUNT_REGISTER").slice(0,RA("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?i.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):i.map(e=>"https://".concat(e,"/api/v1"));const o=null==r?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const i=await async function(e,t,s,n,r){const i=Date.now(),a={sid:s.sid,opid:10,appid:s.appId,string_uid:t};let o=e[0];const c=await GI(()=>iV(o+"".concat(-1===o.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(s,n)=>{if(0===s.code){if(s.uid<=0||s.uid>=Math.pow(2,32))throw aO.error("Invalid Uint Uid ".concat(t," => ").concat(s.uid),s),mO.reqUserAccount(a.sid,{lts:i,success:!1,serverAddr:o,stringUid:a.string_uid,uid:s.uid,errorCode:RR.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new fO(RR.INVALID_UINT_UID_FROM_STRING_UID);return mO.reqUserAccount(a.sid,{lts:i,success:!0,serverAddr:o,stringUid:a.string_uid,uid:s.uid,errorCode:null,extend:a}),!1}const r=PM(s.code);return r.retry&&(o=e[(n+1)%e.length]),mO.reqUserAccount(a.sid,{lts:i,success:!1,serverAddr:o,stringUid:a.string_uid,uid:s.uid,errorCode:r.desc,extend:a}),r.retry},(t,s)=>t.code!==RR.OPERATION_ABORTED&&(mO.reqUserAccount(a.sid,{lts:i,success:!1,serverAddr:o,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),o=e[(s+1)%e.length],!0),r);if(0!==c.code){const e=PM(c.code);throw new fO(RR.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,s,n);return null==r||r.recordJoinChannelService({status:"success",endTs:Date.now()},o),i.uid}catch(e){throw null==r||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},o),e}}async function PV(e,t,s){const n=RA("ACCOUNT_REGISTER");let r=[];r=t.proxyServer?n.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):n.map(e=>"https://".concat(e,"/api/v1"));try{const n=await AV({referenceList:r,asyncMapHandler:n=>async function(e,t,s,n){const r=Date.now(),i={sid:s.sid,opid:10,appid:s.appId,string_uid:t};try{const t=await iV(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:i,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=PM(t.code);throw new fO(RR.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new fO(RR.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:r,url:e,req:i,uid:t.uid,elapse:Date.now()-r}}catch(e){throw e}}(n,e,t,s),closeFn:e=>e.code===RR.OPERATION_ABORTED||e.code===RR.UNEXPECTED_RESPONSE&&!e.data.retry});return n}catch(e){throw e}}async function LV(e,t,s){const n=RA("CDS_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")),r=n.map(n=>function(e,t,s,n){const r=qC(),i={flag:64,cipher_method:0,features:gV(gV(gV(gV(gV({install_id:yA(),device:r.name,system:r.os,system_general:navigator.userAgent,vendor:t.appId,version:vA,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:ZM.WEB_RTC,browser_name:r.name,browser_version:r.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),r.os&&{os_name:r.os}),r.osVersion&&{os_version:r.osVersion}),{},{detail:""})};return GI(()=>iV(e,{data:i,timeout:1e3,cancelToken:s,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==RR.OPERATION_ABORTED,n)}(n,e,t,s));let i=null,a=null,o={};try{i=await RV(r)}catch(e){if(e.code===RR.OPERATION_ABORTED)throw e;a=e}if(r.forEach(e=>e.cancel()),mO.reportApiInvoke(e.sid,{name:qR.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:i}}).onSuccess(),i&&i.test_tags)try{o=function(e){if(!e.test_tags)return{};const t=e.test_tags,s=Object.keys(t),n={};return s.forEach(e=>{var s;const r=jx(s=e.slice(4)).call(s),i=JSON.parse(t[e]),a=i[1];n[r]={tag:i[0]||"",value:a}}),n}(i)}catch(e){}return o}async function MV(e,t){const s=RA("WEBCS_DOMAIN").concat(RA("WEBCS_DOMAIN_BACKUP_LIST")).map(e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK]}));try{const n=await AV({referenceList:s,asyncMapHandler:s=>async function(e,t,s){let n,{url:r,areaCode:i,serviceIds:a}=e;const o=Date.now(),[c,l]=SV(t,i,a);let d=lI.networkState;try{d&&lI.networkState===nI.OFFLINE&&lI.onlineWaiter&&await sp.race([lI.onlineWaiter,NI(FI.maxRetryTimeout)]),d=lI.networkState;const{data:e,headers:t}=await iV(r,{data:c,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);n="1"===t.http3?1:-1;const i=e=>{const t=[];if(e.response_body.forEach(s=>{const n=s.buffer.code;if(23===s.uri&&0===n&&!s.buffer.edges_services)if(4194310===s.buffer.flag)s.buffer.edges_services=[];else{const n={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:s.buffer.flag};t.push(n)}if(0!==n){const r=PM(n),i={error:new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:s.buffer.flag};4194310===s.buffer.flag?aO.warning(i.error.toString()):t.push(i)}}),t.length)throw new fO(RR.CAN_NOT_GET_GATEWAY_SERVER,t.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!t.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(t.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})};i(e);const a=cU(e,$M.CHOOSE_SERVER),u=cU(e,$M.CLOUD_PROXY_FALLBACK);return wV(a),{gatewayInfo:rU(a,r),proxyInfo:u,opid:l,requestTime:o,url:r,isHttp3:n,elapse:Date.now()-o}}catch(e){throw e}}(s,e,t),closeFn:e=>e.code===RR.OPERATION_ABORTED||e.code===RR.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return n}catch(e){throw e}}async function UV(e,t,s,n){const r=RA("PROXY_SERVER_TYPE3"),i=(e,t,s)=>{let n=s||r;return Array.isArray(n)&&(n=t%2==0&&r[1]||r[0]),"https://".concat(n,"/ap/?url=").concat(e)};let a=null;const o=[],c=async()=>{const r=RA("WEBCS_DOMAIN").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map((t,s)=>{let n;return n="disabled"===e.cloudProxyServer&&e.proxyServer?i("".concat(t,"/api/v2/transpond/webrtc?v=2"),s,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):i("".concat(t,"/api/v2/transpond/webrtc?v=2"),s),{url:n,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),a=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:r.map(e=>e.url)}),c=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:r,asyncMapHandler:n=>(aO.debug("[".concat(e.clientId,"] Connect to choose_server:"),n.url),EV(n,e,t,s)),allFailedhandler:e=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c},l=async()=>{if(await NI(1e3),null!==a)return a;const r=RA("WEBCS_DOMAIN_BACKUP_LIST").map((t,s)=>{let n;return n="disabled"===e.cloudProxyServer&&e.proxyServer?i("".concat(t,"/api/v2/transpond/webrtc?v=2"),s,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):i("".concat(t,"/api/v2/transpond/webrtc?v=2"),s),{url:n,areaCode:aV(),serviceIds:[$M.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$M.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$M.CLOUD_PROXY:$M.CLOUD_PROXY_FALLBACK]}}),c=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:r.map(e=>e.url)}),l=await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:r,asyncMapHandler:n=>(aO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),n.url),EV(n,e,t,s)),allFailedhandler:e=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:o});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let d,u,h;try{({gatewayInfo:d,proxyInfo:u,url:h}=await RV([c(),l()]))}catch(e){throw e[0]}if(o.length&&o.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),!d||!u)throw new fO(RR.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(r)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Dn(r).call(r,t)&&(e.proxyServer=t,aO.setProxyServer(t),mO.setProxyServer(t))}return a={gatewayInfo:d,proxyInfo:await lU(u,d.uid)},a}async function VV(e,t,s){const n=RA("UAP_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")),r=n.map(n=>function(e,t,s,n){const r={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:vA,cname:t.cname,uid:t.uid.toString(),requestId:xV,seq:xV};xV+=1;const i={service_name:"tele_channel",json_body:JSON.stringify(r)};return GI(async()=>{const t=await iV(e,{data:i,cancelToken:s,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw aO.error(e.toString()),e}const n=JSON.parse(t.json_body);if(200!==n.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(n.code,", reason: ").concat(n.reason));throw aO.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw aO.error(e.toString()),e}return{vid:n.vid,workerToken:n.workerToken,addressList:(RA("CHANNEL_MEDIA_RELAY_SERVERS")||n.servers).map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(RA("WORKER_DOMAIN"),":").concat(e.wss))}},void 0,e=>!!(e.code!==RR.OPERATION_ABORTED&&e.code!==RR.UNEXPECTED_RESPONSE||e.data&&e.data.retry),n)}(n,e,t,s));try{const e=await RV(r);return r.forEach(e=>e.cancel()),e}catch(e){throw e[0]}}async function FV(e,t,s){let n=null;const r=[],i=async i=>{const a=RA(i?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"));return i&&(await NI(1e3),null!==n)?n:await IV({fragementLength:RA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:n=>(aO.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(i?"backup":""," choose_server:"),n),function(e,t,s,n){const[r]=TV(t,[$M.CHOOSE_SERVER]);let i=lI.networkState;return GI(async()=>{i&&lI.networkState===nI.OFFLINE&&lI.onlineWaiter&&await sp.race([lI.onlineWaiter,NI(n&&n.maxRetryTimeout||FI.maxRetryTimeout)]),i=lI.networkState;const t=await iV(e,{data:r,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0);return NV(t,e)},()=>!1,e=>e.code!==RR.OPERATION_ABORTED&&(e.code===RR.UPDATE_TICKET_FAILED?e.data.retry:(aO.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0)),n)}(n,e,t,s)),allFailedhandler:e=>{throw e[0]},promisesCollector:r})};try{return n=await RV([i(!1),i(!0)]),r.length&&r.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),n}catch(e){throw e[0]}}function BV(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function GV(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?BV(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):BV(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class WV extends HR{get isSuccess(){return!!this.configs}constructor(e,t){super(),uS(this,"configs",void 0),uS(this,"store",void 0),uS(this,"joinInfo",void 0),uS(this,"cancelToken",void 0),uS(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),uS(this,"interval",void 0),uS(this,"mutex",void 0),uS(this,"mutableParamsRead",!1),uS(this,"configCache",{}),uS(this,"limit_bitrate",void 0),this.mutex=new UI("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),RA("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},RA("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,mO.reportApiInvoke(null,{options:void 0,name:qR.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:YR.TRACER}).onSuccess(JSON.stringify(AA))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void aO.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await LV(this.joinInfo,this.cancelToken,this.retryConfig),aO.debug("[config-distribute] get config distribute",JSON.stringify(e));const t=function(e){var t;const s=Xp(t=Object.keys(e).filter(e=>/^webrtc_ng_global_parameter/.test(e))).call(t);for(let i=0;i<s.length;i++)for(let t=s.length-1;t>i;t--){const n=s[t],r=e[n].value;if("number"==typeof r.__priority){const i=r.__priority,a=s[t-1],o=e[a].value;if("number"==typeof o.__priority){if(!(i>o.__priority))continue;{const e=n;s[t]=s[t-1],s[t-1]=e}}else{const e=n;s[t]=s[t-1],s[t-1]=e}}}const n=Date.now();let r={};return s.forEach(t=>{const s=e[t].value.__expires;s&&s<=n||(r[t]=e[t])}),r}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(e){const t=new fO(RR.NETWORK_RESPONSE_ERROR,e);aO.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){hM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(uM.UPDATE_BITRATE_LIMIT,e):this.emit(uM.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&GV({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const t={},s=Object.keys(e),n=[];s.forEach(s=>{const r=e[s].value;t[s]=r;const i=r.__id;if(i&&this.configCache[s]&&this.configCache[s].__id===i)return;const a=r.__type,o=e[s].value,c=e[s].tag;let l=0;a?a===IA.REALTIME&&(l=1):Object.keys(o).some(e=>Object.prototype.hasOwnProperty.call(SA,e)||!zP()&&Object.prototype.hasOwnProperty.call(bA,e)?(l=1,!0):void 0),n.push({tag:c,isApplied:l,feature:s,params:JSON.stringify(r)})}),n.forEach(e=>{let{tag:t,feature:s,params:n,isApplied:r}=e;this.store.sessionId&&mO.abTest(this.store.sessionId,{intSucc:1,isApplied:r,tag:t,feature:s,params:n,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(e){aO.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){const t=function(e){const t={};return Object.keys(e).forEach(s=>{const n=e[s].value,r=n.__expires,i=n.__type;Object.keys(n).forEach(e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=GV(GV({value:n[e]},r&&{expires:r}),i&&{type:i}))})}),t}(e);try{var s;const n=null===(s=t.LIMIT_BITRATE)||void 0===s?void 0:s.value;delete t.LIMIT_BITRATE,n&&hM(n)&&this.handleBitrateLimit(n),this.limit_bitrate=n,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{const t=Date.now();Object.keys(e).forEach(s=>{const{value:n,type:r,expires:i}=e[s];i&&i<=t||((r===IA.REALTIME||Object.prototype.hasOwnProperty.call(SA,s))&&(AA[s]=n,TA[s]=n,aO.debug("Update realtime parameters from config distribute",s,n)),r||zP()||!Object.prototype.hasOwnProperty.call(bA,s)||(AA[s]=n,TA[s]=n,aO.debug("Update gateway parameters from config distribute",s,n)))})}catch(t){aO.error("Error update config immediately: ".concat(e),t.message)}}(t);const r=JSON.stringify(t),i=window.btoa(r);window.localStorage.setItem("websdk_ng_global_parameter",i),aO.debug("Caching global parameters ".concat(r))}catch(e){aO.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{const t=Date.now();Object.keys(e).forEach(s=>{if("CLIENT_ROLE_OPTIONS"===s&&Object.prototype.hasOwnProperty.call(TA,s)){const{value:n,expires:r}=e[s];if(r&&r<=t)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(TA[s],n)||(AA[s]=n,TA[s]=n,this.emit(uM.UPDATE_CLIENT_ROLE_OPTIONS,n),aO.debug("Updating client role options: ".concat(JSON.stringify(n))))}})}catch(e){aO.error("Error handling global parameter config:",e.message)}}}class HV extends HR{constructor(){super(...arguments),uS(this,"resultStorage",new Map)}setLocalAudioStats(e,t,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(s,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(s,t))}setLocalVideoStats(e,t,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(s,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(s,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(s)),!t.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(s))}setRemoteAudioStats(e,t){const s=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const s=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(t))}record(e,t,s){if(RA("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const n=this.resultStorage.get(e);if(!n)return;n.result.push(s);const r="VIDEO_ENCODE_FAILED"===e?RA("ENCODE_EXCEPTION_TIMES"):5;if(n.result.length>=r){var i;const s=Dn(i=n.result).call(i,!0);n.isPrevNormal&&!s&&this.emit("exception",KV[e],e,t),!n.isPrevNormal&&s&&this.emit("exception",KV[e]+2e3,e+"_RECOVER",t),n.isPrevNormal=s,n.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof Wk&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let s=null;t._encoderConfig&&t._encoderConfig.frameRate&&(s=iU(t._encoderConfig.frameRate));const n=e.captureFrameRate;return!s||!n||!(s>10&&n<5||s<10&&s>=5&&n<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var t;return!(!e.codecType||Dn(t=RA("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(t,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||0!==e.sendFrameRate||0!==e.sendResolutionWidth||0!==e.sendResolutionHeight}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof Wk&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const KV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},zV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(s.length>0){const e=s[s.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(s.length>0){const e=s[s.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function qV(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function YV(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?qV(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):qV(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class XV{constructor(e){uS(this,"store",void 0),uS(this,"onStatsException",void 0),uS(this,"onUploadPublishDuration",void 0),uS(this,"onStatsChanged",void 0),uS(this,"onVideoCodecChanged",void 0),uS(this,"localStats",new Map),uS(this,"remoteStats",new Map),uS(this,"updateStatsInterval",void 0),uS(this,"trafficStats",void 0),uS(this,"trafficStatsPeerList",[]),uS(this,"uplinkStats",void 0),uS(this,"exceptionMonitor",void 0),uS(this,"p2pChannel",void 0),uS(this,"scalabilityMode",cA.L1T1),uS(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new HV,this.exceptionMonitor.on("exception",(e,t,s)=>{this.onStatsException&&this.onStatsException(e,t,s)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(xM.LocalAudioTrack)||YV({},qO)}getLocalVideoTrackStats(){return this.localStats.get(xM.LocalVideoTrack)||YV({},YO)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const s=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return s&&(t.publishDuration=s.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},s={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.audioStats;r&&(s[e]=t(e,r))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[n,{audioStats:r}]=e;r&&(s[n]=t(n,r))});return s}getRemoteNetworkQualityStats(e){const t={};if(e){var s;const n=null===(s=this.remoteStats.get(e))||void 0===s?void 0:s.networkStats;n&&(t[e]=n)}else Array.from(this.remoteStats.entries()).forEach(e=>{let[s,{networkStats:n}]=e;n&&(t[s]=n)});return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const s=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return s&&(t.publishDuration=s.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},s={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.videoStats;r&&(s[e]=t(e,r))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[n,{videoStats:r}]=e;r&&(s[n]=t(n,r))});return s}getRTCStats(){let e=0,t=0,s=0,n=0;const r=this.localStats.get(xM.LocalAudioTrack);r&&(e+=r.sendBytes,t+=r.sendBitrate);const i=this.localStats.get(xM.LocalVideoTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const a=this.localStats.get(xM.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach(e=>{let{audioStats:t,videoStats:r}=e;t&&(s+=t.receiveBytes,n+=t.receiveBitrate),r&&(s+=r.receiveBytes,n+=r.receiveBitrate)});let o=1;return this.trafficStats&&(o+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:o,SendBitrate:t,SendBytes:e,RecvBytes:s,RecvBitrate:n,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(e=>void 0!==e.B_ppad||void 0!==e.B_ppvd),e.peer_delay.filter(e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid)).forEach(e=>{var t;const s=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),n=null!=s&&s.videoSSRC?zV.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,r=null!=s&&s.audioSSRC?zV.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,n>r?n:r),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&aO.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,s){if(!e)return!1;const n=!!s&&t.framesDecodeFreezeTime>s.framesDecodeFreezeTime,r=!s||t.framesDecodeCount>s.framesDecodeCount;return n||!r}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[s,n]=t;switch(s){case xM.LocalVideoTrack:case xM.LocalVideoLowTrack:{const t=n,a=YV({},YO),o=e.getStats(),c=e.getLocalMedia(s);if(o){const s=o.videoSend.find(e=>e.ssrc===(null==c?void 0:c.ssrcs[0].ssrcId));if(s){const n=e.getLocalVideoSize(),i=e.getEncoderConfig(xM.LocalVideoTrack);var r;"H264"!==s.codec&&"H265"!==s.codec&&"VP8"!==s.codec&&"VP9"!==s.codec&&"AV1X"!==s.codec&&"AV1"!==s.codec||(a.codecType=s.codec,(null==t?void 0:t.codecType)!==s.codec&&(null===(r=this.onVideoCodecChanged)||void 0===r||r.call(this,s.codec.toLocaleLowerCase()))),a.sendBytes=s.bytes,a.sendBitrate=t?8*Math.max(0,a.sendBytes-t.sendBytes):0,s.inputFrame?(a.captureFrameRate=s.inputFrame.frameRate,a.captureResolutionHeight=s.inputFrame.height,a.captureResolutionWidth=s.inputFrame.width):n&&(a.captureResolutionWidth=n.width,a.captureResolutionHeight=n.height),s.sentFrame?(a.sendFrameRate=s.sentFrame.frameRate,a.sendResolutionHeight=s.sentFrame.height,a.sendResolutionWidth=s.sentFrame.width):n&&(a.sendResolutionWidth=n.width,a.sendResolutionHeight=n.height),s.avgEncodeMs&&(a.encodeDelay=s.avgEncodeMs),i&&i.bitrateMax?a.targetSendBitrate=1e3*i.bitrateMax:s.targetBitrate&&(a.targetSendBitrate=s.targetBitrate),a.sendPackets=s.packets,a.sendPacketsLost=s.packetsLost,a.sendJitterMs=s.jitterMs,a.sendRttMs=s.rttMs,a.totalDuration=t?t.totalDuration+1:1,a.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(s)&&(a.totalFreezeTime+=1),s.scalabilityMode&&this.scalabilityMode!==s.scalabilityMode&&(aO.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(s.scalabilityMode)),this.scalabilityMode=s.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var i;this.localStats.set(s,a),((null==t?void 0:t.sendResolutionWidth)!==a.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==a.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&c&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,c.track,a);break}case xM.LocalAudioTrack:{const t=n,r=YV({},qO),i=e.getStats(),a=e.getLocalMedia(s);if(i){const s=i.audioSend.find(e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(s){if("opus"!==s.codec&&"aac"!==s.codec&&"PCMU"!==s.codec&&"PCMA"!==s.codec&&"G722"!==s.codec||(r.codecType=s.codec),s.inputLevel)r.sendVolumeLevel=Math.round(32767*s.inputLevel);else{const t=e.getLocalAudioVolume();t&&(r.sendVolumeLevel=Math.round(32767*t))}r.sendBytes=s.bytes,r.sendPackets=s.packets,r.sendPacketsLost=s.packetsLost,r.sendJitterMs=s.jitterMs,r.sendRttMs=s.rttMs,r.sendBitrate=t?8*Math.max(0,r.sendBytes-t.sendBytes):0}}this.trafficStats&&(r.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(xM.LocalAudioTrack,r),r&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,r);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var s,n;let[r,{videoStats:i,audioStats:a,videoPcStats:o}]=t;const c=a,l=i,d=o,u=YV({},XO),h=YV({},QO),p=YV({},JO),{audioTrack:m,videoTrack:f,audioSSRC:g,videoSSRC:y}=e.getRemoteMedia(r);let v;v=this.store.useP2P?e.getStats(!0):e.getStats();const x=null===(s=v)||void 0===s?void 0:s.audioRecv.find(e=>e.ssrc===g),_=null===(n=v)||void 0===n?void 0:n.videoRecv.find(e=>e.ssrc===y),E=this.trafficStats&&this.trafficStats.peer_delay.find(e=>e.peer_uid===r);if(x&&("opus"!==x.codec&&"aac"!==x.codec&&"PCMU"!==x.codec&&"PCMA"!==x.codec&&"G722"!==x.codec||(u.codecType=x.codec),x.outputLevel?u.receiveLevel=Math.round(32767*x.outputLevel):m&&(u.receiveLevel=Math.round(32767*m.getVolumeLevel())),u.receiveBytes=x.bytes,u.receivePackets=x.packets,u.receivePacketsLost=x.packetsLost,u.receivePacketsDiscarded=x.packetsDiscarded,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.receiveBitrate=c?8*Math.max(0,u.receiveBytes-c.receiveBytes):0,u.totalDuration=c?c.totalDuration+1:1,u.totalFreezeTime=c?c.totalFreezeTime:0,u.freezeRate=u.totalFreezeTime/u.totalDuration,u.receiveDelay=x.jitterBufferMs,u.totalDuration>10&&XV.isRemoteAudioFreeze(m)&&(u.totalFreezeTime+=1)),_){var b;"H264"!==_.codec&&"H265"!==_.codec&&"VP8"!==_.codec&&"VP9"!==_.codec&&"AV1X"!==_.codec&&"AV1"!==_.codec||(h.codecType=_.codec),h.receiveBytes=_.bytes,h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.decodeFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,h.renderFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,_.outputFrame&&(h.renderFrameRate=_.outputFrame.frameRate),_.receivedFrame?(h.receiveFrameRate=_.receivedFrame.frameRate,h.receiveResolutionHeight=_.receivedFrame.height,h.receiveResolutionWidth=_.receivedFrame.width):f&&(h.receiveResolutionHeight=f._videoHeight||0,h.receiveResolutionWidth=f._videoWidth||0),void 0!==_.framesRateFirefox&&(h.receiveFrameRate=Math.round(_.framesRateFirefox)),h.receivePackets=_.packets,h.receivePacketsLost=_.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost);const t=l?l.totalFreezeTime:0,s=l?l.totalDuration:0;h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=null!==(b=_.totalFreezesDuration)&&void 0!==b?b:t||0,h.receiveDelay=_.jitterBufferMs||0;const n=!!y&&e.getRemoteVideoIsReady(y);void 0===_.totalFreezesDuration&&f&&n&&XV.isRemoteVideoFreeze(f,_,d)&&(h.totalFreezeTime+=1),h.freezeRate=Math.max(0,Math.min((h.totalFreezeTime-t)/(h.totalDuration-s),1))}E&&(u.end2EndDelay=E.B_ad,h.end2EndDelay=E.B_vd,u.transportDelay=E.B_ed,h.transportDelay=E.B_ed,u.currentPacketLossRate=E.B_ealr4/100,h.currentPacketLossRate=E.B_evlr4/100,p.uplinkNetworkQuality=E.B_punq?E.B_punq:0,p.downlinkNetworkQuality=E.B_pdnq?E.B_pdnq:0),this.remoteStats.set(r,{audioStats:u,videoStats:h,videoPcStats:_,networkStats:p}),m&&this.exceptionMonitor.setRemoteAudioStats(m,u),f&&this.exceptionMonitor.setRemoteVideoStats(f,h)})}}class JV{constructor(){uS(this,"destChannelMediaInfos",new Map),uS(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){ZL(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){ZL(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){GL(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QV(e){if(!(e instanceof JV))return new fO(RR.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),s=e.getDestChannelMediaInfo();return t?0===s.size?new fO(RR.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new fO(RR.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class ZV{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){uS(this,"uid",void 0),uS(this,"_uintid",void 0),uS(this,"_trust_in_room_",!0),uS(this,"_trust_audio_enabled_state_",!0),uS(this,"_trust_video_enabled_state_",!0),uS(this,"_trust_audio_mute_state_",!0),uS(this,"_trust_video_mute_state_",!0),uS(this,"_audio_muted_",!1),uS(this,"_video_muted_",!1),uS(this,"_audio_enabled_",!0),uS(this,"_video_enabled_",!0),uS(this,"_audio_added_",!1),uS(this,"_video_added_",!1),uS(this,"_is_pre_created",!1),uS(this,"_video_pre_subscribed",!1),uS(this,"_audio_pre_subscribed",!1),uS(this,"_trust_video_stream_added_state_",!0),uS(this,"_trust_audio_stream_added_state_",!0),uS(this,"_audioTrack",void 0),uS(this,"_videoTrack",void 0),uS(this,"_dataChannels",[]),uS(this,"_audioSSRC",void 0),uS(this,"_videoSSRC",void 0),uS(this,"_audioOrtc",void 0),uS(this,"_videoOrtc",void 0),uS(this,"_cname",void 0),uS(this,"_rtxSsrcId",void 0),uS(this,"_videoMid",void 0),uS(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function $V(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function eF(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?$V(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$V(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const tF="9",sF=2e4,nF=4e4;function rF(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function iF(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?rF(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):rF(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var aF=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(aF||{});const oF=new Map;function cF(e,t,s,n){let{scale:r}=e;if(0===r&&n===aF.UP||r>=t.length-1&&n===aF.DOWN)return e;let i=iF(iF({},e),{},{scale:n===aF.DOWN?++r:--r});switch(s){case"maintain-framerate":i=iF(iF({},i),t[r].motion);break;case"maintain-resolution":i=iF(iF({},i),t[r].detail);break;case"balanced":i=iF(iF({},i),t[r].balanced)}return i}function lF(e,t){if(t){const s={overUse:0,underUse:0,adaptationList:dF(t)};oF.set(e,s)}else oF.delete(e)}function dF(e){const t=iF({},e),{bitrateMax:s,frameRate:n,scaleResolutionDownBy:r,bitrateMin:i}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:o,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:m,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:y,MOTION_RESOLUTION_FACTOR:v,MOTION_BITRATE_FACTOR:x,DETAIL_FRAMERATE_FACTOR:_,DETAIL_BITRATE_FACTOR:E}=wA,b=Math.min(t.frameRate,o),w=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(p,1)*b),fps_up:n},balanced:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:s,bitrateMin:i},motion:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:s,bitrateMin:i},detail:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:s,bitrateMin:i}}];for(let N=1;N<=c;N++){const e={bwe_up:Math.round(Math.pow(u,N)*s),bwe_down:Math.round(Math.pow(h,N+1)*s),fps_up:Math.round(Math.pow(m,N)*b),fps_down:Math.round(Math.pow(p,N+1)*b)},t={scaleResolutionDownBy:r/Math.pow(y,N),frameRate:Math.max(Math.round(Math.pow(g,N)*n),a),bitrateMax:Math.max(Math.round(Math.pow(f,N)*s),d),bitrateMin:Math.max(Math.round(Math.pow(f,N)*i),l)},o={scaleResolutionDownBy:r/Math.pow(v,N),frameRate:n,bitrateMax:Math.max(Math.round(Math.pow(x,N)*s),d),bitrateMin:Math.max(Math.round(Math.pow(x,N)*i),l)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_,N)*n),a),bitrateMax:Math.max(Math.round(Math.pow(E,N)*s),d),bitrateMin:Math.max(Math.round(Math.pow(E,N)*i),l)};w.push({scale:N,threshold:e,balanced:t,motion:o,detail:c})}return w}function uF(e,t,s,n,r,i){const a=oF.get(e)||{overUse:0,underUse:0,adaptationList:dF(r)},{adaptationList:o}=a;oF.set(e,a);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=wA,{scale:d}=n;let u,h;return"number"==typeof t&&t>0&&function(e,t,s,n){if(t>=s.length)return!1;let{threshold:{fps_down:r}}=s[t];return RA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===n&&(r=s[0].threshold.fps_down),e<r}(t,d,o,i)&&(a.overUse++,h=oA.CPU,a.overUse>c)||"number"==typeof s&&s>0&&function(e,t,s){if(t>=s.length)return!1;const{threshold:{bwe_down:n}}=s[t];return e<n}(s,d,o)&&(a.overUse++,h=oA.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,u=cF(n,o,i,aF.DOWN),[u,h]):("number"==typeof t&&t>0&&"number"==typeof s&&s>0&&function(e,t,s,n){if(0===t)return;let{threshold:{fps_up:r}}=s[t];return RA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===n&&(r=s[1].threshold.fps_up),e>r}(t,d,o,i)&&function(e,t,s){if(0===t)return;const{threshold:{bwe_up:n}}=s[t];return e>n}(s,d,o)&&(a.underUse++,a.underUse>l&&(a.overUse=0,a.underUse=0,u=cF(n,o,i,aF.UP),0===u.scale&&(h=oA.NONE))),[u,h])}function hF(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function pF(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?hF(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):hF(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const mF=new Map;function fF(e,t){const s=mF.get(e);if(s){const{timer:t}=s;window.clearTimeout(t),mF.delete(e)}t.qualityLimitationReason=oA.NONE,lF(e)}function gF(e,t){var s;let n;switch(t){case xM.LocalAudioTrack:n=nM.Audio;break;case xM.LocalVideoTrack:n=Dn(s=e._hints).call(s,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalVideoLowTrack:n=nM.Low}return n}function yF(e){const t=yO();if(e.some(e=>e._bypassWebAudio))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function vF(e,t){yF(e);const s=t||new Wk;return e.forEach(e=>s.addAudioTrack(e)),s}const xF=!yO().supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&bR();function _F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s;return xF?(s={spec:t,store:e},JU("PlanBConnection").create(s)):new TF(t,e)}function EF(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function bF(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(ZR(e.turnServer.servers))return!1;if(RA("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch(e){return!1}}var wF;function NF(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function SF(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?NF(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):NF(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let TF=(wF=class e extends mM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dn(t=Object.keys(jA)).call(t,e)}))]}constructor(t,s){super(t,s),uS(this,"id",SI(5,"connection-")),uS(this,"store",void 0),uS(this,"peerConnection",void 0),uS(this,"forceTurn",!1),uS(this,"remoteSDP",void 0),uS(this,"initialOffer",void 0),uS(this,"transportEventReceiver",void 0),uS(this,"statsFilter",void 0),uS(this,"extension",{useXR:RA("USE_XR")}),uS(this,"localCapabilities",void 0),uS(this,"remoteCodecs",void 0),uS(this,"localCandidateCount",0),uS(this,"allCandidatesReceived",!1),uS(this,"isPreallocation",!1),uS(this,"preMediaMap",new Map),uS(this,"dataStreamChannelMap",new Map),uS(this,"establishPromise",void 0),uS(this,"recoveredDataChannelIds",[]),uS(this,"currentDataChannelId",1),uS(this,"supportAV1RtpSpec",!1),uS(this,"mutex",void 0),uS(this,"qualityLimitationReason",oA.NONE),uS(this,"isFirstConnected",!1),this.store=s,this.forceTurn=bF(t),this.mutex=new UI("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,sR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const s=this.remoteSDP.toString();null==t||t(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else aO.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else aO.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=bU(s.sdp),r=await kU({filterRTX:!RA("USE_PUB_RTX")&&!RA("USE_SUB_RTX"),filterVideoFec:RA("FILTER_VIDEO_FEC"),filterAudioFec:RA("FILTER_AUDIO_FEC"),filterVideoCodec:RA("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:RA("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:RA("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=LU(r),this.initialOffer=s,RA("ENABLE_SVC")&&"av1"==this.store.codec){const t=await async function(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:cA.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const s=VA(t.sdp).mediaDescriptions[0];if(!s)return;const n=s.attributes.extmaps.find(e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName);return e.close(),n}catch(e){return}}();var e;t&&(this.supportAV1RtpSpec=!0,null===(e=r.send)||void 0===e||e.videoExtensions.push(t))}let i;return s.sdp&&WU(s.sdp)&&(i=pI(r),(t=i).send&&(gU(fM.VIDEO,t.send.videoExtensions),gU(fM.AUDIO,t.send.audioExtensions)),t.recv&&(gU(fM.VIDEO,t.recv.videoExtensions),gU(fM.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(gU(fM.VIDEO,t.sendrecv.videoExtensions),gU(fM.AUDIO,t.sendrecv.audioExtensions))),SF(SF({},n),{},{rtpCapabilities:i||r,offerSDP:s.sdp})}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&WU(this.initialOffer.sdp)&&(t=e.rtpCapabilities,s=this.localCapabilities,t.send&&(fU(fM.VIDEO,t.send.videoExtensions,s.send.videoExtensions),fU(fM.AUDIO,t.send.audioExtensions,s.send.audioExtensions)),t.recv&&(fU(fM.VIDEO,t.recv.videoExtensions,s.recv.videoExtensions),fU(fM.AUDIO,t.recv.audioExtensions,s.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return pI(this._localCapabilities)}get rtpCapabilities(){return pI(this._rtpCapabilities)}get candidates(){return pI(this._candidates)}get iceParameters(){return pI(this._iceParameters)}get dtlsParameters(){return pI(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];uS(this,"sessionDesc",void 0),uS(this,"_localCapabilities",void 0),uS(this,"_rtpCapabilities",void 0),uS(this,"_candidates",void 0),uS(this,"_originCandidates",void 0),uS(this,"_iceParameters",void 0),uS(this,"_isUseExtmapAllowMixed",void 0),uS(this,"_isUseLocalCodecs",void 0),uS(this,"_dtlsParameters",void 0),uS(this,"setup",void 0),uS(this,"currentMidIndex",void 0),uS(this,"cname",void 0),uS(this,"useLocalCodecsMids",[]),uS(this,"preloadSsrcs",[]),uS(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=s,e=pI(e);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:a,setup:o,localCapabilities:c,cname:l}=e;this._rtpCapabilities=a,this._candidates=i,this._originCandidates=pI(i),this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=c,this.setup=o,this.cname=l,[this.sessionDesc]=this.updateRemoteRTPCapabilities(a),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(e=>{var t;return Dn(t=this.preloadSsrcs).call(t,e)})}preloadRemoteMedia(e){let t=0;const s=[],n=[];for(;e>0;){const r=[eF({ssrcId:nF+t},RA("USE_SUB_RTX")?{rtx:nF+t+1}:{})],i="".concat(nF+t,"_").concat(sF+t),{ssrcs:a,ssrcGroups:o}=TU(r,this.cname,RA("SYNC_GROUP")?i:void 0),c=this.preCreateOrRecycleSendMedia("video",a,o,void 0),l=[{ssrcId:sF+t}],d="".concat(nF+t,"_").concat(sF+t),{ssrcs:u,ssrcGroups:h}=TU(l,this.cname,RA("SYNC_GROUP")?d:void 0),p=this.preCreateOrRecycleSendMedia("audio",u,h,void 0);e--,t+=2,s.push(c,p),n.push(a[0].ssrcId,u[0].ssrcId)}return this.useLocalCodecsMids.push(...s),this.preloadSsrcs=n,{mids:s,preSSRCs:n,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,s,n){const r=this.rtpCapabilities.send.videoCodecs,i=this._isUseLocalCodecs||0===r.length?this.localCapabilities.recv:this.rtpCapabilities.send;aO.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const a=e===fM.VIDEO?i.videoCodecs:i.audioCodecs,o=e===fM.VIDEO?i.videoExtensions:i.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:o,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};return l=this.mungSendMediaDesc(l,n),this.sessionDesc.mediaDescriptions.push(l),this.updateBundleMids(),c}toString(){return FA(this.sessionDesc)}send(e,t,s,n){const{ssrcs:r,ssrcGroups:i}=TU(t,this.cname,RA("SYNC_GROUP")?s:void 0),a=this.findPreloadMediaDesc(r);if(a){if(sR()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,a.attributes.mid),n&&(n.twcc||n.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,n),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,r);let s;return-1===t||1===t&&($C()||function(){const e=qC();return!(e.name!==WC.CHROME||!e.osVersion)&&Number(e.version)<=90}()||RA("ENABLE_ENCODED_TRANSFORM")&&ZC())||0===t&&!function(e){const t=qC();return!(t.name!==WC.FIREFOX||!t.osVersion)&&Number(t.version)===e}(138)&&RA("USE_SUB_RTX")||mR()?(s=this.createOrRecycleSendMedia(e,r,i,"sendonly",n),this.updateBundleMids()):(s=pI(this.sessionDesc.mediaDescriptions[t]),s.attributes.direction="sendonly",s.attributes.ssrcs=r,s.attributes.ssrcGroups=i,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(s,n)),sR()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,s.attributes.mid),{mid:s.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(e=>{let{kind:t,ssrcMsg:s,mslabel:n}=e;return this.send(t,s,n)}),s=[];let n=!1;return t.forEach(e=>{let{mid:t,needExchangeSDP:r}=e;r&&(n=!0),s.push(t)}),{mids:s,needExchangeSDP:n}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{"0"===e.attributes.mid||sR()||mR()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}receive(e,t,s,n){e.forEach((e,r)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,s,n[r])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||VA((s=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(s?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));var s;this._rtpCapabilities=e;let n=!1;const r=this.rtpCapabilities.send,i=this.localCapabilities.send,a=this.localCapabilities.recv,o=a.videoCodecs,c=a.audioCodecs,l=a.videoExtensions,d=a.audioExtensions;for(const m of t.mediaDescriptions){var u;if("sendonly"!==m.attributes.direction||"string"!=typeof m.attributes.mid||!Dn(u=this.useLocalCodecsMids).call(u,m.attributes.mid)){if(n=!0,m.attributes.iceUfrag=this._iceParameters.iceUfrag,m.attributes.icePwd=this._iceParameters.icePwd,m.attributes.fingerprints=this._dtlsParameters.fingerprints,m.attributes.candidates=this._candidates,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var h;m.media.fmts=o.map(e=>e.payloadType.toString(10)),m.attributes.payloads=o,m.attributes.extmaps=l;const e=m.attributes.mid;"string"!=typeof e||Dn(h=this.useLocalCodecsMids).call(h,e)||this.useLocalCodecsMids.push(e)}else if(0===r.videoCodecs.length){const e=i.videoCodecs.filter(e=>{var t,s;return null===(t=e.rtpMap)||void 0===t?void 0:Dn(s=t.encodingName.toLowerCase()).call(s,"vp8")})||[i.videoCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=r.videoCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=r.videoCodecs,m.attributes.extmaps=r.videoExtensions;if("audio"===m.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===m.attributes.direction){var p;m.media.fmts=c.map(e=>e.payloadType.toString(10)),m.attributes.payloads=c,m.attributes.extmaps=d;const e=m.attributes.mid;"string"!=typeof e||Dn(p=this.useLocalCodecsMids).call(p,e)||this.useLocalCodecsMids.push(e)}else if(0===r.audioCodecs.length){const e=i.audioCodecs.filter(e=>{var t,s;return null===(t=e.rtpMap)||void 0===t?void 0:Dn(s=t.encodingName.toLowerCase()).call(s,"opus")})||[i.audioCodecs[0]];m.media.fmts=e.map(e=>e.payloadType.toString(10)),m.attributes.payloads=e,m.attributes.extmaps=[]}else m.media.fmts=r.audioCodecs.map(e=>e.payloadType.toString(10)),m.attributes.payloads=r.audioCodecs,m.attributes.extmaps=r.audioExtensions,MU(m)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,n]}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),s=[];if(t.forEach(e=>{s.push(eF(eF({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this._candidates=s;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this._candidates=[...t,...s];break;default:this._candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const n=s.media.mediaType===e&&"0"!==s.media.port&&("sendonly"===s.attributes.direction||"sendrecv"===s.attributes.direction)&&0===s.attributes.ssrcs.length;if(sR()){if(n){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==s.attributes.mid&&"1"!==s.attributes.mid)||!(!e||e!==s.attributes.mid)}return!1}return n})}createOrRecycleDataChannel(){for(const s of this.sessionDesc.mediaDescriptions)if("application"===s.media.mediaType)return{mediaDesc:s,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:tF,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,s,n,r,i){const a=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=UU(a,o,this.localCapabilities.send,a===fM.VIDEO?n:r),l=a===fM.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let u={media:{mediaType:a,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e,i);const h=this.findFirstClosedMedia(a);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(e=>e.fingerprint)),s=new Set(e.map(e=>e.fingerprint));let n=!1;t.size!==s.size&&(n=!0);for(const r of t)s.has(r)||(n=!0);return n}updateRemoteCodec(e,t,s){const n=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dn(t=Object.keys(jA)).call(t,e)}))],r=new Set(t);if(n.every(e=>r.has(e)))return aO.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const i=this._rtpCapabilities.recv.videoCodecs.filter(e=>t.some(t=>{var s;return Dn(s=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(s,t)}));if(0===i.length)return aO.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(n," codecs: ").concat(t)),!1;const a=[...new Set(i.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""))];let o;if(aO.debug("updateRemoteCodec, from ".concat(n," to ").concat(a)),0===e.length)o=this.sessionDesc.mediaDescriptions.filter(e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction);else if(o=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&"video"===t.media.mediaType&&Dn(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction),o.length!==e.length)return aO.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(RA("USE_PUB_RTX")||RA("USE_SUB_RTX")){const e=VU(i,this.rtpCapabilities.recv.videoCodecs);i.push(...e)}this._rtpCapabilities.recv.videoCodecs=i;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,d=UU(fM.VIDEO,l,c,s);return o.forEach(e=>{const t=d.map(e=>e.payloadType.toString(10));aO.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",d),e.attributes.payloads=d,e.media.fmts=t}),!0}createOrRecycleSendMedia(e,t,s,n,r){const i=this.rtpCapabilities.send.videoCodecs,a=this._isUseLocalCodecs||0===i.length?this.localCapabilities.recv:this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:e,port:tF,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungSendMediaDesc(d,r);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,s){const n=pI(e);return RU(n),CU(n,t),IU(n,t),AU(n),OU(n,s,this.localCapabilities.send),n}mungSendMediaDesc(e,t){const s=pI(e);return OU(s,t,this.localCapabilities.recv),MU(s),s}updateRecvMedia(e,t){const s=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==s){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>sR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return(null===(s=t.attributes)||void 0===s||null===(s=s.ssrcs[0])||void 0===s?void 0:s.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===t?void 0:t.attributes.ssrcs}}(SF(SF({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!RA("ENABLE_PRE_SUB_WITH_PRE_PC")||!RA("PRE_USE_LOCAL_CODECS"))&&_O(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),r=BU(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==i||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const a=this.peerConnection.getTransceivers()[0];if(null!=a&&a.receiver&&this.tryBindTransportEvents(a.receiver),_O(this.store))if(e.preallocation&&RA("ENABLE_PRE_SUB_WITH_PRE_PC")){const e=RA("PRE_SUB_NUM"),{mids:t,preSSRCs:s}=this.remoteSDP.preloadRemoteMedia(e);await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(s)),this.presetMedia(t,s)}else{const{preSSRCs:t=[]}=e,s=t.map(e=>e.ssrcMsg[0].ssrcId);if(0===t.length)return;const{mids:n}=this.remoteSDP.batchSend(t.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(n,s)}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}var t,s}presetMedia(e,t){e.forEach((e,s)=>{this.peerConnection.getTransceivers().forEach(n=>{if(null!=n.mid&&e===n.mid&&n.receiver.track){const r=n.receiver.track;let i;"video"===r.kind&&RA("ENABLE_PRE_RENDER")&&(i=new Xk({trackId:"track-".concat(r.kind,"-unknown-").concat(this.store.clientId,"_").concat(SI(5,""))},!0),i.updateVideoTrack(r),i.onFirstVideoFrameRender=()=>{var e;const n=this.preMediaMap.get(t[s]);n&&(n.firstVideoRender=Date.now()),null===(e=this.onFirstVideoRender)||void 0===e||e.call(this,t[s])},i.play(this.store.sessionId||void 0)),this.preMediaMap.set(t[s],{mid:e,track:r,player:i,transceiver:n})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let t=!1;const{rtpCapabilities:s}=e;if([,t]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const e=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);t=t||e}const{preSSRCs:n=[]}=e,r=n.map(e=>e.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(r)){const e=[],t=[];if(Array.from(this.preMediaMap.entries()).every(s=>{let[n,{mid:r,player:i,track:a}]=s;return e.push(r),t.push(n),this.preMediaMap.delete(n),i&&i.destroy(),!0}),e.length>0&&(this.remoteSDP.stopSending(e),await FU(this.peerConnection,this.remoteSDP,this.extension),aO.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(t)),mO.reportApiInvoke(this.store.sessionId,{name:qR.PRELOAD_MEDIA_FAILED,options:[n,t],tag:YR.TRACER}).onSuccess()),n.length>0){const{mids:e}=this.remoteSDP.batchSend(n.map(e=>Object.assign({},e)));await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(r)),this.presetMedia(e,r)}}t?(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):aO.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,s){var n=this;return YT(function*(){const r=yield JT(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],a=pU();e.forEach(e=>{const t=n.peerConnection.addTransceiver(e._mediaStreamTrack,SF({direction:"sendonly"},"video"===e.trackMediaType&&n.supportAV1RtpSpec&&a?{sendEncodings:[{scalabilityMode:a}]}:{}));i.push(t),e._updateRtpTransceiver(t)}),sR()&&!0===RA("SIMULCAST")&&(yield JT(n.applySimulcastForFirefox(i,e)));const o=yield JT(n.peerConnection.createOffer()),c=n.remoteSDP.predictReceivingMids(e.length),l=n.mungSendOfferSDP(o.sdp,e,c),d=VA(l),u=c.map(e=>{const t=d.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(t,RA("USE_PUB_RTX"))});let h;try{h=yield u}catch(r){h=[],n.remoteSDP.receive(e,t,s,h);const i=n.remoteSDP.toString();throw yield JT(n.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JT(n.peerConnection.setRemoteDescription({type:"answer",sdp:i})),yield JT(n.stopSending(c,!0)),r}n.remoteSDP.receive(e,t,s,h);const p=n.remoteSDP.toString(),m=n.logSDPExchange(l,"offer","local","send");return yield JT(n.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield JT(n.applySimulcastEncodings(i,e)),yield JT(n.applySendEncodings(i,e)),null==m||m(p),yield JT(n.peerConnection.setRemoteDescription({type:"answer",sdp:p})),i.map((e,t)=>{const s=c[t];return{localSSRC:u[t],id:s,transceiver:e}})}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(e);if(s&&"open"===s.readyState)aO.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:RA("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,s)}t.forEach(e=>{e._updateOriginDataChannel(s)});const{needExchangeSDP:n}=this.remoteSDP.sendDataChannel();if(n){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),aO.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else aO.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof IR?e:new IR(RR.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const s=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{var t;fF(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const s=await this.peerConnection.createOffer(),n=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();null==n||n(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{s&&s()}}async receive(e,t,s,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:r,needExchangeSDP:i}=this.remoteSDP.send(e,t,s,n);i&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(e=>e.mid===r);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:r,transceiver:a}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:s}=this.remoteSDP.batchSend(e);return s&&(await FU(this.peerConnection,this.remoteSDP,this.extension),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(e=>{const t=this.peerConnection.getTransceivers().find(t=>t.mid===e);if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(e=>{Array.from(this.preMediaMap.entries()).some(t=>{let[s,{mid:n,player:r}]=t;if(n===e)return this.preMediaMap.delete(s),r&&r.destroy(),!0})}),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),s=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();null==s||s(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),s=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();null==s||s(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),s=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();null==s||s(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const s=await this.peerConnection.createOffer(),n=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(e);const r=this.remoteSDP.toString();null==n||n(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(e,t)=>{e.direction="sendonly"});const s=await this.peerConnection.createOffer(),n=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString();null==n||n(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YT(function*(){const s=yield JT(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=yO().supportPCSetConfiguration,n=RA("FORCE_TURN_TCP")||t.forceTurn;if(e===gM.RELAY&&!s)return;if(s&&!n){const s=e===gM.RELAY?"relay":"all",n=t.peerConnection.getConfiguration();n.iceTransportPolicy!==s&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(s,"]")),n.iceTransportPolicy=s,t.peerConnection.setConfiguration(n))}t.remoteSDP.updateCandidates(e);const r=yield JT(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=bU(r.sdp),{remoteIceParameters:a}=yield i.iceParameters;t.remoteSDP.restartICE(a);const o=t.remoteSDP.toString(),c=t.logSDPExchange(r.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield JT(t.peerConnection.setLocalDescription(r)),null==c||c(o),yield JT(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(gM.TCP_RELAY),await FU(this.peerConnection,this.remoteSDP,this.extension)}catch(e){aO.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(e=>{fF(this.id+e.mid,this)}),this.preMediaMap.forEach(e=>{let{player:t}=e;t&&t.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return SF(SF({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(s.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const r=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),null==i||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const s=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===s.length&&(this.isVP8Simulcast(t)?sR()||await this.applySimulcastEncodings(s,[t]):await this.applySendEncodings(s,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const s=this.peerConnection.getTransceivers().find(e=>e.mid===t);s&&await s.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:s,remote:n}=t.getSelectedCandidatePair();return{local:SF(SF({},$I),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:SF(SF({},$I),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;const s="code: ".concat(e.errorCode,", message: ").concat(e.errorText),n=e.port?"local: ".concat(e.port):"",r=hU(e.url||"");aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(r||"",", host_candidate:").concat(n)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,s)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},RA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[]},n=t.cloudProxyServer||"disabled";return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&(ZR(t.turnServer.servers)?s.iceServers=t.turnServer.servers:RA("NEW_TURN_MODE")&&s.iceServers&&"disabled"===n?(RA("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&s.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):s.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),RA("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(s.iceServers&&s.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),RA("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),RA("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(s.iceTransportPolicy="relay")}))),RA("ENABLE_ENCODED_TRANSFORM")&&yO().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(sU(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!RA("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{const s=RA("NEW_TURN_MODE");1===s?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===s?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===s?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(sU(e.turnServerURL),":443?transport=tcp")}):4===s&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(sU(e.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const s=t.iceTransport;s&&(s.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var s;e&&(null===(s=this.onICETransportStateChange)||void 0===s||s.call(this,e))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:e,remote:t}=s.getSelectedCandidatePair()||{};if(e&&t){const s=e.address+":"+e.port,n=t.address+":"+t.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(s)),", remote ").concat(JSON.stringify(hU(n))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var s,n;if(!t){const s=this.peerConnection.getSenders();t=s.find(t=>t.track===e._mediaStreamTrack)}if(!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!yO().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;case"balanced":r.degradationPreference="balanced"}const a=function(e,t){return e.getTransceivers().find(e=>e.sender.track===t||e.receiver.track===t)}(this.peerConnection,e._mediaStreamTrack),o=Jj(e);if(function(e){var t;return!(!RA("ENABLE_AG_ADAPTATION")||!(e instanceof PD||Dn(t=e._hints).call(t,UO.CUSTOM_TRACK))||!RA("FORCE_SUPPORT_AG_ADAPTATION")&&!(dR(14,0,!1)&&uR(17,4,!0)||lR(14)&&hR(17,4,!0)))}(e)&&a&&t&&o&&this.getLocalVideoStats&&Dn(s=["vp8","vp9"]).call(s,this.store.codec)){var c;const s=r.degradationPreference||(Dn(c=e._hints).call(c,UO.CUSTOM_TRACK)?RA("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,s,n,r,i){if(fF(e,s),r(t),"balanced"!==n&&"maintain-framerate"!==n&&"maintain-resolution"!==n)return;let a=-1;lF(e,t);const o=window.setInterval(()=>{const o=mF.get(e);if(!RA("ENABLE_AG_ADAPTATION")||!o)return fF(e,s),void r(t);const c=i();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;const i=c.sendFrameRate,l=c.OutgoingAvailableBandwidth,[d,u]=uF(e,i,l,o.adaptationConfig,t,n);u&&(s.qualityLimitationReason=u),d&&o.adaptationConfig.scale!==d.scale&&(aO.debug("[".concat(e,"] applyAdaptation: ").concat(s.qualityLimitationReason,"\n           sendFps ").concat(i,", bwe ").concat(l,", switch from ").concat(o.adaptationConfig.scale," to ").concat(d.scale," ")),o.adaptationConfig=pF(pF({},o.adaptationConfig),d),r(d))}},RA("CHECK_LOCAL_STATS_INTERVAL")),c=pF({},t);mF.set(e,{timer:o,adaptationConfig:c,originConfig:t,adaptationFunc:r}),aO.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(n))}(this.id+a.mid,o,this,s,e=>{t&&this.updateAdaptation(t,e)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:t,frameRate:s,scaleResolutionDownBy:n}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),(Dn(l=e._hints).call(l,UO.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(s&&(i.maxFramerate=iU(s)),n&&n>=1&&(i.scaleResolutionDownBy=n))}const{maxFramerate:d}=RA("ENCODER_CONFIG_LIMIT");if(d&&"number"==typeof d&&(i.maxFramerate=i.maxFramerate?Math.min(i.maxFramerate,d):d),RA("DSCP_TYPE")&&bR()){var u;const e=RA("DSCP_TYPE");Dn(u=["very-low","low","medium","high"]).call(u,e)&&(i.networkPriority=e)}const h=t.getParameters(),p=null===(n=h.encodings)||void 0===n?void 0:n[0];sR()&&!p&&(r.encodings=[i]),p&&Object.assign(p,i),Object.assign(h,r),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,s){try{var n;if(!yO().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e||"av1"===e}(e)||!RA("ENABLE_SVC"))return;const r={},i={},a=t.getParameters(),o=null===(n=a.encodings)||void 0===n?void 0:n[0];i.scalabilityMode=pU(s),o&&Object.assign(o,i),Object.assign(a,r),await t.setParameters(a),aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){aO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,RA("SVC_MODE"))}async updateAdaptation(e,t){var s,n;if(!e)return aO.debug("[updateAdaptation] no rtpSender found");if(!yO().supportSetRtpSenderParameters)return aO.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const r={},{bitrateMax:i,frameRate:a,scaleResolutionDownBy:o}=t;i&&(r.maxBitrate=1e3*i),a&&(r.maxFramerate=iU(a)),o&&o>=1&&Dn(s=["vp8","vp9"]).call(s,this.store.codec)&&(r.scaleResolutionDownBy=o);const c=e.getParameters(),l=null===(n=c.encodings)||void 0===n?void 0:n[0];l&&Object.assign(l,r),Object.assign(c,{});try{await e.setParameters(c),aO.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?aO.debug("[updateAdaptation] peerConnection not connected}"):aO.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):aO.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!yO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let s=0;s<e.length;s++){const n=e[s],r=t[s];r instanceof DD&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,n.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,s){const n=VA(e);return t.forEach((e,t)=>{const r=s[t],i=n.mediaDescriptions.find(e=>e.attributes.mid===r);i&&(CU(i,e),jU(i,e,this.store.codec))}),FA(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,s)=>{var n;null===(n=this.onFirstVideoDecoded)||void 0===n||n.call(this,e,t,s)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var s,n,r,i,a;const c=e[o],l=t[o];if(l instanceof DD&&!Dn(s=l._hints).call(s,UO.LOW_STREAM)&&null!==(n=l._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=l._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=l._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const s=c.sender.getParameters();await c.sender.setParameters(Object.assign(s,e))}}}async applySimulcastEncodings(e,t){if(!sR()&&e.length===t.length)for(let s=0;s<e.length;s++){const n=t[s];if(n instanceof DD&&this.isVP8Simulcast(n)){const t=e[s],r={},i={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};r.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:i.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:i.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,r))}}}isVP8Simulcast(e){var t,s,n,r,i;return!!(e instanceof DD&&RA("SIMULCAST")&&"vp8"===this.store.codec&&!Dn(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(s=e._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabilityMode)||void 0===i?void 0:i.numSpatialLayers)>1)}logSDPExchange(e,t,s,n){if(RA("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(t," SDP during P2PConnection.").concat(n,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===s?"remote":"local",n)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(yO().supportPCSetConfiguration){const s=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}t.isPreallocation&&(this.isPreallocation=!0)}},IL(wF.prototype,"updateRemoteRTPCapabilities",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateRemoteRTPCapabilities"),wF.prototype),IL(wF.prototype,"connect",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"connect"),wF.prototype),IL(wF.prototype,"updateRemoteConnect",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateRemoteConnect"),wF.prototype),IL(wF.prototype,"createDataChannels",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"createDataChannels"),wF.prototype),IL(wF.prototype,"receive",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"receive"),wF.prototype),IL(wF.prototype,"batchReceive",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"batchReceive"),wF.prototype),IL(wF.prototype,"stopReceiving",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"stopReceiving"),wF.prototype),IL(wF.prototype,"muteRemote",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"muteRemote"),wF.prototype),IL(wF.prototype,"unmuteRemote",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"unmuteRemote"),wF.prototype),IL(wF.prototype,"muteLocal",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"muteLocal"),wF.prototype),IL(wF.prototype,"unmuteLocal",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"unmuteLocal"),wF.prototype),IL(wF.prototype,"close",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"close"),wF.prototype),IL(wF.prototype,"updateEncoderConfig",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateEncoderConfig"),wF.prototype),IL(wF.prototype,"updateSendParameters",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateSendParameters"),wF.prototype),IL(wF.prototype,"replaceTrack",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"replaceTrack"),wF.prototype),IL(wF.prototype,"updateAdaptation",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"updateAdaptation"),wF.prototype),IL(wF.prototype,"getRemoteSSRC",[CF],Object.getOwnPropertyDescriptor(wF.prototype,"getRemoteSSRC"),wF.prototype),wF);function CF(e,t,s){const n=e[t];if("function"!=typeof n)throw new Error("Cannot use mutex on object property.");return s.value=async function(){const e=this.mutex,s=await e.lock("From P2PConnection.".concat(t));try{for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return await n.apply(this,i)}finally{s()}},s}function RF(e,t){let s=document.createElement("video"),n=document.createElement("canvas");s.setAttribute("style","display:none"),n.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),n.width=iU(t.width),n.height=iU(t.height);const r=iU(t.framerate||15);document.body.append(s),document.body.append(n);let i=e._mediaStreamTrack;s.srcObject=new MediaStream([i]),s.play();const a=n.getContext("2d");if(!a)throw new fO(RR.UNEXPECTED_ERROR,"can not get canvas context");const o=yO(),c=n.captureStream(o.supportRequestFrame?0:r).getVideoTracks()[0];c.canvas||(c.canvas=n),n.startCapture=()=>{if(!s)return n.stopCapture&&n.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const e=s.videoWidth,t=s.videoHeight/e,r=n.width*t;Math.abs(r-n.height)>=2&&(aO.debug("adjust low stream resolution","".concat(n.width,"x").concat(n.height," -> ").concat(n.width,"x").concat(r)),n.height=r)}a.drawImage(s,0,0,n.width,n.height),c.requestFrame&&c.requestFrame(),i!==e._mediaStreamTrack&&(i=e._mediaStreamTrack,s.srcObject=new MediaStream([i]))},n.stopCapture=vj(()=>n.startCapture&&n.startCapture(),r);const l=c.stop;return c.stop=()=>{l.call(c),s&&(s.remove(),s.srcObject=null,s=null),n&&(n.width=0,n.remove(),n.stopCapture&&n.stopCapture(),n.startCapture=void 0,n.stopCapture=void 0,n=null),aO.debug("clean low stream renderer")},c}var IF=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(IF||{}),AF=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(AF||{}),OF=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(OF||{}),jF=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(jF||{}),kF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(kF||{}),DF=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(DF||{});const PF=1e3,LF=6,MF=3,UF=Math.max(LF,MF,60);function VF(e,t,s){null!=s&&Number.isFinite(s)&&(e[t]=Math.round(Math.max(0,s)))}function FF(e){const t={[kF.CONN_TYPE]:0,[kF.RTT]:e.rtt,[kF.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===s&&(t[kF.CONN_TYPE]=1),"tcp"===s&&(t[kF.CONN_TYPE]=3),"tls"===s&&(t[kF.CONN_TYPE]=4);break}case"srflx":t[kF.CONN_TYPE]=2;break;case"unknown":t[kF.CONN_TYPE]=5;break;default:t[kF.CONN_TYPE]=0}return t}function BF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class GF extends HR{constructor(e){super(),uS(this,"store",void 0),uS(this,"uploadWRTCStatsTimer",void 0),uS(this,"uploadOutboundDenoiserStatsTimer",void 0),uS(this,"uploadExtStatsTimer",void 0),uS(this,"uploadExtUsageStatsTimer",void 0),uS(this,"uploadInboundExtStatsTimer",void 0),uS(this,"requestStats",void 0),uS(this,"requestTransportStats",void 0),uS(this,"requestLocalMedia",void 0),uS(this,"requestRemoteMedia",void 0),uS(this,"requestAllTracks",void 0),uS(this,"requestVideoIsReady",void 0),uS(this,"requestUploadStats",void 0),uS(this,"requestUpload",void 0),uS(this,"uploadOutboundStarted",!1),uS(this,"uploadInboundStarted",!1),uS(this,"uploadTransportStarted",!1),uS(this,"uploadBaseStatsStarted",!1),uS(this,"uploadExtensionUsageStarted",!1),uS(this,"lastRecvStats",void 0),uS(this,"lastSendStats",void 0),uS(this,"lastRefRecvStats",void 0),uS(this,"lastRefSendStats",void 0),uS(this,"lastNormalRecvStats",void 0),uS(this,"lastNormalSendStats",void 0),uS(this,"lastExtendStats",{}),uS(this,"needUploadStats",{}),uS(this,"needUploadRenderFreezeTime",!0),uS(this,"lastUploadCompensateTime",-1),uS(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const t=e%MF==0,s=e%LF==0,n=e%60==0;let r,i;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),r||i){var a;const o={};if(this.uploadTransportStarted&&r){const e=this.getTransportStats(r,i,t);e&&(o.misc=[e])}if(this.uploadOutboundStarted&&r){const e=this.getOutboundStats(r,s?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats,n);e&&(o.outbound=[e])}if(this.uploadInboundStarted&&i){this.uploadCompensateStats(e);const n=this.getInboundStats(i,s?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);n&&(o.inbound=n)}const c=null===(a=this.requestTransportStats)||void 0===a?void 0:a.call(this).connectState;c&&(Array.isArray(o.misc)?o.misc[0]&&o.misc[0].addition&&(o.misc[0].addition[DF.RTC_PEER_CONNECTION_STATE]=lA[c]):o.misc=[{addition:{[DF.RTC_PEER_CONNECTION_STATE]:lA[c]}}]),this.needUploadStats.sendType&&(Array.isArray(o.outbound)&&o.outbound[0]&&o.outbound[0].high&&(o.outbound[0].high[IF.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(o)}this.lastRecvStats=i,this.lastSendStats=r,s&&(this.lastNormalRecvStats=i,this.lastNormalSendStats=r),t&&(this.lastRefRecvStats=i,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,s;const e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(s=this.requestUploadStats)||void 0===s||s.call(this,{misc:[{addition:{[DF.RTC_PEER_CONNECTION_STATE]:lA[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===UF+1&&(e=1)},PF)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const t=e%MF==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(-1===this.lastUploadCompensateTime)return void(this.lastUploadCompensateTime=Date.now());const s=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=s,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const n=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*n;const r=this.requestStats(!0);new Array(n).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const e={};if(this.uploadInboundStarted&&r){const t=this.requestRemoteMedia()||[],s=[];t.forEach(e=>{let[t,n]=e;const i={peer:t.uid};if(t._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(t._videoSSRC)&&n.has(fM.VIDEO)&&t.videoTrack){const e=function(e,t,s){if(!t.videoRecv.find(t=>t.ssrc===e))return;const n={};if(s&&s._player){const e=s._player,{renderFreezeAccTime2:t,videoElementStatus:r}=e;if("visible"===ZD.visibility&&r===sj.PLAYING&&yO().supportRequestVideoFrameCallback){const s=Math.min(6e3,t);e.renderFreezeAccTime2=Math.max(0,t-s),VF(n,AF.Video_Render_Freeze_Time_Render2,s),RA("USE_NEW_RENDER_FREEZE_TIME")&&VF(n,AF.Video_Render_Freeze_Time_Render,s)}}return n}(t._videoSSRC,r,t.videoTrack);e&&(i.video=e)}i.video&&s.push(i)}),s.length>0&&(e.inbound=s,this.requestUploadStats(e))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,s){if(!this.requestStats)return;if(!s)return null==e.rtt?void 0:{addition:{[kF.RTT]:e.rtt,[kF.CONN_TYPE]:void 0,[kF.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const n=FF(e);if(this.store.useP2P){if(t){const e=FF(t);n[kF.CONN_TYPE]+=e[kF.CONN_TYPE]<<3}n[kF.CONN_TYPE]+=110}else n[kF.CONN_TYPE]+=100;return{addition:n}}getOutboundStats(e,t,s,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||0===i.length)return;let a,o,c;return i.forEach(n=>{let[i,{track:l,ssrcs:d}]=n;switch(i){case xM.LocalVideoLowTrack:case xM.LocalVideoTrack:if(i===xM.LocalVideoTrack){var u;const n=function(e,t,s,n,r){const i=t.videoSend.find(t=>t.ssrc===e);if(!i)return;const a={},{sentFrame:o,inputFrame:c}=i;if(n&&(VF(a,AF.Video_Send_Qp_Sum,i.qpSumPerFrame),c&&o)){const e=c.frameRate,t=o.frameRate;a[AF.Video_Send_Freeze]=function(e,t){let s=!0;return s=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),s}(e,t)?1:0}if(r){switch(o&&(VF(a,OF.Video_Send_Height,o.height),VF(a,OF.Video_Send_Width,o.width),VF(a,OF.Video_Send_Frame_Rate,o.frameRate)),a[OF.Video_Send_Disabled]=s._originMediaStreamTrack&&!s._originMediaStreamTrack.enabled||s._mediaStreamTrack&&!s._mediaStreamTrack.enabled?1:0,i.adaptionChangeReason){case"none":a[OF.Video_Send_Adaptation]=0;break;case"cpu":a[OF.Video_Send_Adaptation]=1;break;case"bandwidth":a[OF.Video_Send_Adaptation]=2;break;case"other":a[OF.Video_Send_Adaptation]=3}let n=0;i.adaptionChangeReason&&(n+=BF(i.adaptionChangeReason)),t.qualityLimitationReason&&(n+=BF(t.qualityLimitationReason)<<3),a[OF.Video_Send_Adaptation]=n,a[OF.Video_Send_Player_Status]=rj[s._player?s._player.videoElementStatus:"uninit"],VF(a,OF.Video_Send_Nacks,i.nacksCount),VF(a,OF.Video_Send_Plis,i.plisCount),VF(a,OF.Video_Send_Firs,i.firsCount),VF(a,OF.Video_Send_Avg_Encode,i.avgEncodeMs),VF(a,OF.Video_Send_Huge_Frame_Sent,i.hugeFramesSent),VF(a,OF.Video_Send_Bytes_Retransmit,i.retransmittedBytesSent),VF(a,OF.Video_Send_Packages_Retransmit,i.retransmittedPacketsSent),VF(a,OF.Video_Send_Key_Frames_Encoded,i.keyFramesEncoded);const c=r.videoSend.find(t=>t.ssrc===e);if(c){let e=PF*MF;c.timestamp&&i.timestamp&&(e=i.timestamp-c.timestamp),null!=c.packets&&null!=i.packets&&VF(a,OF.Video_Send_Package_Rate,1e3*(i.packets-c.packets)/e),null!=i.packetsLost&&null!=c.packetsLost&&VF(a,OF.Video_Send_Package_Lost,i.packetsLost-c.packetsLost),null!=c.bytes&&null!=i.bytes&&VF(a,OF.Video_Send_Bitrate,8*(i.bytes-c.bytes)/e)}}return a}(d[0].ssrcId,e,l,t,s),i="CameraVideoTrack"===l.__className__?3:Dn(u=l._hints).call(u,UO.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==i||r)&&(this.needUploadStats={sendType:i},this.lastExtendStats.sendType=i);const a=l&&function(e,t,s,n){const r=t.videoSend.find(t=>t.ssrc===e);if(!r)return null;const i={};if(n){const e=r.inputFrame,t=e&&e.height||s.videoHeight||0,n=e&&e.width||s.videoWidth||0,a=e&&e.frameRate||0;VF(i,OF.Video_Capture_Height,t),VF(i,OF.Video_Capture_Width,n),VF(i,OF.Video_Capture_Frame_Rate,a)}return i}(d[0].ssrcId,e,l,!!s),c=function(e,t){const s={};return t&&(VF(s,OF.Video_Send_Retransmit,e.bitrate.retransmit),VF(s,OF.Video_Send_Target_Encoded,e.bitrate.targetEncoded),VF(s,OF.Video_Send_Actual_Encoded,e.bitrate.actualEncoded),VF(s,OF.Video_Send_Transmit,e.bitrate.transmit),VF(s,OF.Video_Send_Bandwidth,e.sendBandwidth)),s}(e,!!s);o=Object.assign({},n,a,c)}else c=function(e,t,s,n){const r=t.videoSend.find(t=>t.ssrc===e);if(!r)return;const i={};if(n){const t=r.sentFrame;t&&(VF(i,OF.Video_Send_Low_Height,t.height),VF(i,OF.Video_Send_Low_Width,t.width),VF(i,OF.Video_Send_Low_Frame_Rate,t.frameRate));const s=n.videoSend.find(t=>t.ssrc===e);if(s){let e=PF*LF;s.timestamp&&r.timestamp&&(e=r.timestamp-s.timestamp),null!=s.packets&&null!=r.packets&&VF(i,OF.Video_Send_Low_Package_Rate,1e3*(r.packets-s.packets)/e),null!=r.packetsLost&&null!=s.packetsLost&&VF(i,OF.Video_Send_Low_Package_Lost,r.packetsLost-s.packetsLost),null!=s.bytes&&null!=r.bytes&&VF(i,OF.Video_Send_Low_Bitrate,8*(r.bytes-s.bytes)/e)}}return i}(d[0].ssrcId,e,0,s);break;case xM.LocalAudioTrack:a=l&&function(e,t,s,n,r){const i=t.audioSend.find(t=>t.ssrc===e);if(!i)return;const a={};if(r){a[OF.Audio_Send_Disabled]=s._originMediaStreamTrack&&!s._originMediaStreamTrack.enabled||s._mediaStreamTrack&&!s._mediaStreamTrack.enabled?1:0;const t=100*s._source.getAccurateVolumeLevel(),n=i.inputLevel;if(null!=n){const e=Math.ceil(50*Math.log10(100*n+1));VF(a,OF.Audio_Send_Level,e)}VF(a,OF.Audio_Capture_PCM_Level,t),VF(a,OF.Audio_Send_AEC_Return_Loss,i.aecReturnLoss),VF(a,OF.Audio_Send_AEC_Return_Loss_Enhancement,i.aecReturnLossEnhancement),VF(a,OF.Audio_Send_Bytes_Retransmit,i.retransmittedBytesSent),VF(a,OF.Audio_Send_Packages_Retransmit,i.retransmittedPacketsSent),a[OF.Audio_Send_Freeze]=0;const o=r.audioSend.find(t=>t.ssrc===e);if(o){let e=PF*LF;o.timestamp&&i.timestamp&&(e=i.timestamp-o.timestamp),null!=o.bytes&&null!=i.bytes&&VF(a,OF.Audio_Send_Bitrate,8*(i.bytes-o.bytes)/e),null!=o.packets&&null!=i.packets&&VF(a,OF.Audio_Send_Package_Rate,1e3*(i.packets-o.packets)/e)}}return a}(d[0].ssrcId,e,l,0,s)}}),{high:o,low:c,audio:a}}getInboundStats(e,t,s,n){if(!this.requestRemoteMedia)return;const r=this.requestRemoteMedia()||[],i=[];return r.forEach(r=>{let[a,o]=r;const c={peer:a.uid};if(o.has(fM.VIDEO)&&a.videoTrack){const r=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,i=a.videoTrack?function(e,t,s,n,r,i,a,o){const c=t.videoRecv.find(t=>t.ssrc===e);if(!c)return;const l={},{receivedFrame:d,outputFrame:u,decodeFrameRate:h}=c;VF(l,jF.Video_Render_Frame_Rate_Decode,h),c.framesRateFirefox&&VF(l,jF.Video_Recv_Frame_Rate,c.framesRateFirefox),d&&VF(l,jF.Video_Recv_Frame_Rate,d.frameRate),VF(l,jF.Video_Recv_Frame_Dropped,c.framesDroppedCount),VF(l,jF.Video_Recv_Bytes_Retransmit,c.retransmittedBytesReceived),VF(l,jF.Video_Recv_Packages_Retransmit,c.retransmittedPacketsReceived),VF(l,jF.Video_Recv_Packages_Discarded,c.packetsDiscarded),VF(l,jF.Video_Recv_Avg_Decode,c.avgDecodeMs),VF(l,jF.Video_Recv_Avg_Processing_Delay,c.avgProcessingDelayMs),VF(l,jF.Video_Recv_Avg_Assembly_Time,c.avgFramesAssembledFromMultiplePacketsMs),VF(l,jF.Video_Recv_Avg_Inter_Frame_Delay,c.avgInterFrameDelayMs),VF(l,jF.Video_Recv_Key_Frames_Decoded,c.keyFramesDecoded);const p=o&&o.videoRecv.find(t=>t.ssrc===e);if(p){const e=t.timestamp-o.timestamp||PF;null!=c.packetsLost&&null!=p.packetsLost&&VF(l,jF.Video_Recv_Package_Lost,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&VF(l,jF.Video_Recv_Bitrate,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&VF(l,jF.Video_Recv_Package_Rate,1e3*(c.packets-p.packets)/e)}const m=i&&i.videoRecv.find(t=>t.ssrc===e);if(m&&(VF(l,AF.Video_Recv_Qp_Sum,c.qpSumPerFrame),l[AF.Video_Recv_Freeze]=n&&XV.isRemoteVideoFreeze(s,c,m)?1:0),a){var f;const t=a.videoRecv.find(t=>t.ssrc===e);d?(VF(l,OF.Video_Recv_Height,d.height),VF(l,OF.Video_Recv_Width,d.width)):s&&(VF(l,OF.Video_Recv_Height,s._videoHeight||0),VF(l,OF.Video_Recv_Width,s._videoWidth||0)),u&&VF(l,OF.Video_Recv_Frame_Rate_Output,u.frameRate);const n=null===(f=s._player)||void 0===f?void 0:f.rendFrameRate.toFixed(0);if(n&&VF(l,OF.Video_Render_Frame_Rate_Render,+n),VF(l,OF.Video_Recv_Jitter_Buffer,c.jitterBufferMs),VF(l,OF.Video_Recv_Current_Delay,c.currentDelayMs),VF(l,OF.Video_Recv_Firs,c.firsCount),VF(l,OF.Video_Recv_Nacks,c.nacksCount),VF(l,OF.Video_Recv_Plis,c.plisCount),s){l[OF.Video_Recv_Disabled]=s._originMediaStreamTrack.enabled&&s._mediaStreamTrack.enabled?0:1;const e=s._player;if(e){const{freezeTimeCounterList:s,renderFreezeAccTime:n,renderFreezeAccTime2:i,videoElementStatus:a}=e;if(s&&s.length>0&&VF(l,AF.Video_Render_Freeze_Time,s.splice(0,1)[0]),r&&"visible"===ZD.visibility&&a===sj.PLAYING&&yO().supportRequestVideoFrameCallback){const t=Math.min(6e3,i);e.renderFreezeAccTime2=Math.max(0,i-t),VF(l,AF.Video_Render_Freeze_Time_Render2,t);const s=Math.min(6e3,n);e.renderFreezeAccTime=Math.max(0,n-s),VF(l,AF.Video_Render_Freeze_Time_Render,RA("USE_NEW_RENDER_FREEZE_TIME")?t:s)}if("number"==typeof c.totalFreezesDuration){const e=t&&t.totalFreezesDuration?c.totalFreezesDuration-t.totalFreezesDuration:c.totalFreezesDuration;VF(l,OF.Video_Render_Freeze_Duration,1e3*e)}}}if(l[OF.Video_Recv_Player_Status]=rj[s._player?s._player.videoElementStatus:"uninit"],t&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-t.totalInterFrameDelay,s=c.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,n=c.framesDecodeCount-t.framesDecodeCount,r=e/n*1e3,i=Math.round(1e3*Math.sqrt((s-Math.pow(e,2)/n)/n));!isNaN(i)&&r+i>Math.max(3*r,r+150)&&(l[OF.Video_Recv_I_Frame_Delay]=i)}}return l}(a._videoSSRC,e,a.videoTrack,!0===r,this.needUploadRenderFreezeTime,t,s,n):void 0;i&&(c.video=i)}if(o.has(fM.AUDIO)&&a.audioTrack){const r=a.audioTrack?function(e,t,s,n,r,i){const a=t.audioRecv.find(t=>t.ssrc===e);if(!a)return;const o={};VF(o,jF.Audio_Recv_Jitter,a.jitterMs),VF(o,jF.Audio_Recv_Bytes_Retransmit,a.retransmittedBytesReceived),VF(o,jF.Audio_Recv_Packages_Retransmit,a.retransmittedPacketsReceived),VF(o,jF.Audio_Recv_Packages_Discarded,a.packetsDiscarded),VF(o,jF.Audio_Recv_Avg_Processing_Delay,a.avgProcessingDelayMs);const c=i&&i.audioRecv.find(t=>t.ssrc===e);if(c){const e=PF;null!=a.packets&&null!=c.packets&&VF(o,jF.Audio_Recv_Package_Rate,1e3*(a.packets-c.packets)/e),null!=a.packetsLost&&null!=c.packetsLost&&VF(o,jF.Audio_Recv_Package_Lost,a.packetsLost-c.packetsLost)}if(n){const{receivedFrames:e,droppedFrames:t}=a;null!=e&&null!=t&&(o[AF.Audio_Recv_Freeze]=0===(l=e)||100*t/l>20?1:0)}var l;if(r){const t=100*s._source.getAccurateVolumeLevel(),n=a.outputLevel;if(null!=n){const e=Math.ceil(50*Math.log10(100*n+1));VF(o,OF.Audio_Render_Level,e)}VF(o,OF.Audio_Recv_PCM_Level,t),s&&(o[OF.Audio_Recv_Disabled]=s._originMediaStreamTrack.enabled&&s._mediaStreamTrack.enabled?0:1),VF(o,OF.Audio_Recv_Jitter_Buffer,a.jitterBufferMs),VF(o,OF.Audio_Recv_Current_Delay,a.jitterBufferMs),o[OF.Audio_Recv_Player_Status]=rj[Uj.getPlayerState(s.getTrackId())];const i=r.audioRecv.find(t=>t.ssrc===e);if(i){null!=i.bytes&&null!=a.bytes&&VF(o,OF.Audio_Recv_Bitrate,8*(a.bytes-i.bytes)/(PF*MF));const e=a.concealedSamples-i.concealedSamples;e>0&&VF(o,OF.Audio_Recv_Concealed_Samples,e);const t=a.totalSamplesReceived-i.totalSamplesReceived;t>0&&VF(o,OF.Audio_Recv_Total_Samples_Received,t);const s=a.freezeSamples80-i.freezeSamples80;s>0&&VF(o,OF.Audio_Render_Freeze_Samples_80ms,s);const n=a.freezeSamples200-i.freezeSamples200;n>0&&VF(o,OF.Audio_Render_Freeze_Samples_200ms,n);const r=a.freezeMs80-i.freezeMs80;VF(o,OF.Audio_Render_Freeze_Time_80ms,r<0?0:r);const c=a.freezeMs200-i.freezeMs200;VF(o,OF.Audio_Render_Freeze_Time_200ms,c<0?0:c)}}return o}(a._audioSSRC,e,a.audioTrack,t,s,n):void 0;r&&(c.audio=r)}(c.video||c.audio)&&i.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,i}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(e=>e instanceof Bk);if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(UL.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach(e=>{let[t,s]=e;s.has(fM.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}),s.has(fM.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const t=Date.now(),s={connectionInterval:RA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let n=[];const r=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of r)!e.muted&&e.enabled&&(n=n.concat(await e.getProcessorUsage()));const i=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of i)c.has(fM.VIDEO)&&e.videoTrack&&(n=n.concat(await e.videoTrack.getProcessorUsage())),c.has(fM.AUDIO)&&e.audioTrack&&(n=n.concat(await e.audioTrack.getProcessorUsage()));if(0===n.length)return;s.details=function(e,t){const s={};for(const{id:a,value:o,level:c,direction:l}of e){var n;const e=null!==(n=t.get(a))&&void 0!==n?n:0,d=2===o?e+RA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var r,i;t.set(a,d),s[a]?(2===o&&(s[a].value=o),c>s[a].level&&(s[a].level=c),"remote"===l&&(s[a].remoteUidCount+=1),s[a].totalTs=null!==(r=t.get(a))&&void 0!==r?r:0):s[a]={value:o,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(i=t.get(a))&&void 0!==i?i:0}}return Object.keys(s).map(e=>{const{level:t,value:n,totalTs:r}=s[e];return{id:e,level:t,value:n,totalTs:r}})}(n,e);const a=Date.now(),o=a>t?a:t+1;this.requestUpload&&this.requestUpload(UL.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:o})},RA("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const WF=RA("ICE_RESTART_INTERVAL");let HF=new Map,KF=new Map,zF=[gM.UDP_TCP_RELAY,gM.TCP_RELAY,gM.RELAY],qF=RA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&yO().supportPCSetConfiguration;function YF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=HF.get(e.id);s&&(window.clearTimeout(s),HF.delete(e.id));const n=KF.get(e.id);t&&n&&n.index===zF.length-1&&(aO.debug("[".concat(e.id,"] reset ICE restart policy")),KF.delete(e.id))}function XF(e,t,s){if(0===HF.size&&0===KF.size&&(Array.isArray(RA("RESTART_SEQUENCE"))&&RA("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s+=1){const n=e[s];if(e.filter(e=>e===n).length!==t.filter(e=>e===n).length)return!1}return!0}(zF,RA("RESTART_SEQUENCE"))&&(zF=RA("RESTART_SEQUENCE").filter(e=>{var t;if(Dn(t=Object.values(gM)).call(t,e))return!0}),aO.debug("use reconnection policy from config distribution, queues: ".concat(zF.join(" => ")))),qF=RA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&yO().supportPCSetConfiguration),0===zF.length)return void s();let n,{index:r=0,type:i}=KF.get(e.id)||{};if(qF&&i===gM.RELAY)return void s();let a=i&&r>=zF.length-1;if(qF)i=gM.RELAY;else{if(a)return void s();i?(r++,i=zF[r]):(i=zF[0],r=0)}aO.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(i,", index: ").concat(r)),t(i),KF.set(e.id,{index:r,type:i}),n=window.setTimeout(()=>XF(e,t,s),WF),HF.set(e.id,n)}var JF;function QF(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function ZF(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?QF(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):QF(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function $F(e){var t,s,n,r=2;for("undefined"!=typeof Symbol&&(s=ZT,n=Symbol.iterator);r--;){if(s&&null!=(t=e[s]))return t.call(e);if(n&&null!=(t=e[n]))return new eB(t.call(e));s="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function eB(e){function t(e){if(Object(e)!==e)return sp.reject(new TypeError(e+" is not an object."));var t=e.done;return sp.resolve(e.value).then(function(e){return{value:e,done:t}})}return eB=function(e){this.s=e,this.n=e.next},eB.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var s=this.s.return;return void 0===s?sp.resolve({value:e,done:!0}):t(s.apply(this.s,arguments))},throw:function(e){var s=this.s.return;return void 0===s?sp.reject(e):t(s.apply(this.s,arguments))}},new eB(e)}let tB=(JF=class extends HR{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(EM.StateChange,t,this._state)}constructor(e,t){super(),uS(this,"isPlanB",void 0),uS(this,"store",void 0),uS(this,"statsUploader",void 0),uS(this,"connection",void 0),uS(this,"localTrackMap",new Map),uS(this,"remoteUserMap",new Map),uS(this,"localDataChannels",[]),uS(this,"remoteDataChannelMap",new Map),uS(this,"pendingLocalTracks",[]),uS(this,"pendingRemoteTracks",[]),uS(this,"pendingLocalDataChannels",[]),uS(this,"pendingRemoteDataChannels",[]),uS(this,"statsCollector",void 0),uS(this,"shouldForwardP2PCreation",void 0),uS(this,"iceFailedCount",0),uS(this,"dtlsFailedCount",0),uS(this,"mutex",void 0),uS(this,"_state",_M.Disconnected),uS(this,"_pcStatsUploadType",RA("NEW_ICE_RESTART")?yM.FIRST_CONNECTION:yM.OLD_FIRST_CONNECTION),uS(this,"_isStartRestartIce",!1),uS(this,"_restartTimer",void 0),uS(this,"_isTryConnecting",!1),uS(this,"_iceError",null),uS(this,"_forceTurn",!1),uS(this,"_isWaitPcToRePub",!1),uS(this,"handleMuteLocalTrack",async(e,t,s)=>{const n=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==_M.Connected)return void s(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const n=this.filterTobeMutedTracks(e);if(0===n.length)return void t();const r=n.find(e=>"videoLowTrack"===e[0]);if(r){const e=r[1];this.store.enableInstantMuteRestore?(e.track._originMediaStreamTrack.enabled=!1,aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):e.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(n.map(e=>{let[,{id:t}]=e;return t}));const i=this.createMuteMessage(n);await aI(this,EM.RequestMuteLocal,i),t()}catch(e){s(e)}finally{n()}}),uS(this,"handleUnmuteLocalTrack",async(e,t,s)=>{const n=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==_M.Connected)return void s(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const n=this.filterTobeUnmutedTracks(e);if(0===n.length)return void t();const r=n.find(e=>"videoLowTrack"===e[0]);if(r){const t=r[1];if(this.store.enableInstantMuteRestore)t.track._originMediaStreamTrack.enabled=!0,aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(t.track._originMediaStreamTrack.stop(),!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding){const s=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=s,t.track._originMediaStreamTrack=s}else{const s=RF(e,cI(this,EM.RequestLowStreamParameter));t.track._mediaStreamTrack=s,t.track._originMediaStreamTrack=s}await new sp((e,s)=>{this.handleReplaceTrack(t.track,e,s,!0)})}}this.store.enableInstantMuteRestore?aO.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(n.map(e=>{let[,{id:t}]=e;return t}));const i=this.createUnmuteMessage(n);await aI(this,EM.RequestUnmuteLocal,i),t()}catch(e){s(e)}finally{n()}}),uS(this,"handleUpdateVideoEncoder",async(e,t,s,n)=>{let r;n||(r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const s=this.localTrackMap.get(xM.LocalVideoTrack);if(!this.connection||!s||s.track!==e||this.state!==_M.Connected)return void t();const{id:n,track:r}=s;await this.connection.updateSendParameters(n,r),await this.connection.updateEncoderConfig(n,r),this.emit(EM.UpdateVideoEncoder,r),t()}catch(e){s(e)}finally{var i;null===(i=r)||void 0===i||i()}}),uS(this,"handleUpdateVideoSendParameters",async(e,t,s)=>{const n=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const s=this.localTrackMap.get(xM.LocalVideoTrack);if(!this.connection||!s||s.track!==e||this.state!==_M.Connected)return void t();const{id:n,track:r}=s;await this.connection.updateSendParameters(n,r),t()}catch(e){s(e)}finally{n()}}),uS(this,"handleReplaceMixingTrack",async(e,t,s,n)=>{if(!this.connection||this.state!==_M.Connected)return void t();const r=vF([e]);let i;aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(r.getTrackId(),"]")),"boolean"==typeof n&&n||(i=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,r),t()}catch(e){s(e)}finally{var a;null===(a=i)||void 0===a||a()}}),uS(this,"handleReplaceTrack",async(e,t,s,n)=>{let r;aO.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof n&&n||(r=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var i;const s=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:s}]=t;return e===s});if(!this.connection||!s||this.state!==_M.Connected)return void t();if(await(null===(i=this.connection)||void 0===i?void 0:i.replaceTrack(e,s[1].id)),this.isPlanB){const t=s[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(s[0],t)}if(s[0]===xM.LocalVideoTrack&&!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding){const t=this.localTrackMap.get(xM.LocalVideoLowTrack);if(t){const s=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=s,t.track._originMediaStreamTrack=s,await new sp((e,s)=>{this.handleReplaceTrack(t.track,e,s,!0)})}}t()}catch(e){s(e)}finally{var a;null===(a=r)||void 0===a||a()}}),uS(this,"handleGetRTCStats",e=>{e(this.statsCollector.getRTCStats())}),uS(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uS(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uS(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uS(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(this.store),this.bindStatsUploaderEvents(),this.mutex=new UI("P2PChannel-mutex",this.store.clientId),this.isPlanB=!yO().supportUnifiedPlan||RA("CHROME_FORCE_PLAN_B")&&bR(),this.shouldForwardP2PCreation=RA("FORWARD_P2P_CREATION")&&yO().supportPCSetConfiguration&&ER(),this.shouldForwardP2PCreation&&(this.connection=_F(this.store),this.emit(EM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var s;this.state=_M.New,this._forceTurn=bF(e),aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&"closed"===(null===(s=this.connection)||void 0===s?void 0:s.peerConnectionState);if((!this.shouldForwardP2PCreation||n||t)&&((n||t)&&this.connection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=_F(this.store,e),this.emit(EM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=RA("NEW_ICE_RESTART")?yM.FIRST_CONNECTION:yM.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===_M.Connected){if(this.connection instanceof TF&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),mO.reportApiInvoke(this.store.sessionId,{name:qR.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:YR.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(EM.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=_M.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(e=>{var t;let[s]=e;return Dn(t=[xM.LocalVideoLowTrack,xM.LocalVideoTrack]).call(t,s)}),s=t.map(e=>{let[,{id:t}]=e;return t}),n=t.map(e=>{let[t]=e;return t});if(this.connection instanceof TF){if(mO.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Dn(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find(t=>Dn(e).call(e,t));t&&(this.store.codec=t,aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(s,e)}}async getEstablishParams(){var e;if(this.connection instanceof TF&&"closed"!==this.connection.peerConnectionState&&Dn(e=[_M.New,_M.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==_M.Connected){if(this.state===_M.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(e=>{var t;Dn(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach(e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)}),e.map(e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId})))}publish(e,t,s){var n=this;return YT(function*(){const r=yield JT(n.mutex.lock("From P2PChannel.publish"));try{var i;const r=n.connection&&Dn(i=["disconnected","failed"]).call(i,n.connection.peerConnectionState);if(!n.connection||n.state!==_M.Connected||r){if(n.state===_M.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===n.pendingLocalTracks.indexOf(e));return n.pendingLocalTracks=n.pendingLocalTracks.concat(t),void(r&&(n._isWaitPcToRePub=!0))}n.store.pubId=n.store.pubId+1,zV.markPublishStart(n.store.clientId,n.store.pubId);const a=n.filterTobePublishedTracks(e,t,s);if(0===a.length)return void(yield JT(n.tryToUnmuteAudio(e)));yield*QT($F(n.doPublish(n.connection,a)))}finally{r()}})()}doPublish(e,t){var s=this;return YT(function*(){t.forEach(e=>{let{track:t,type:n}=e;const r=Date.now();s.store.publish(t.getTrackId(),n===xM.LocalAudioTrack?"audio":"video",r)}),s.bindLocalTrackEvents(t);const n=t.map(e=>{let{track:t}=e;return t}),r=yield JT(e.send(n,s.store.codec,s.store.audioCodec)),i=(yield JT(r.next())).value,a=s.createGatewayPublishMessage(t,i);let o;try{o=yield a}catch(e){throw r.throw(e),(null==e?void 0:e.code)===RR.WS_ABORT&&t.forEach(e=>{let{track:t}=e;-1===s.pendingLocalTracks.indexOf(t)&&s.pendingLocalTracks.push(t)}),s.unbindLocalTrackEvents(t),e}const c=s.mapPubResToRemoteConfig(a,o,n),l=(yield JT(r.next(c))).value;if(s.state===_M.Disconnected)throw new IR(RR.UNEXPECTED_ERROR,"PeerConnection already disconnected.");RA("ENABLE_VIDEO_SEI");const d=RA("ENABLE_ENCODED_TRANSFORM"),u=RA("ENABLE_AUDIO_METADATA");n.forEach(async e=>{const t=e.getRTCRtpTransceiver();if(!t||!d)return;const{interceptLocalVideoFrame:s,interceptLocalAudioFrame:n}=ZU();e.trackMediaType===fM.VIDEO?await s(t.sender,e):e.trackMediaType===fM.AUDIO&&await n(t.sender,{metadata:u?()=>{const t=e.metadata.shift();return t&&t.value}:void 0})}),t.forEach(e=>{let{type:t}=e;s.statsCollector.addLocalStats(t)}),s.assignLocalTracks(t,l),s.statsUploader.startUploadOutboundStats(),t.forEach(e=>{let{track:t,type:n}=e;const r=Date.now();s.store.publish(t.getTrackId(),n===xM.LocalAudioTrack?"audio":"video",void 0,r)})})()}async updateVideoStreamParameter(e,t){const s=this.localTrackMap.get(t);if(!s||!this.connection)return;if(!(s.track instanceof DD))return aO.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:n}=s,r=function(e,t){const s={};return e.height&&e.width&&(s.scaleResolutionDownBy=dU(e,t)),s.maxFramerate=e.framerate?iU(e.framerate):void 0,s.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,s}(e,n);if(n._encoderConfig||(n._encoderConfig={}),t!==xM.LocalVideoLowTrack||!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding)null!=r.scaleResolutionDownBy&&(n._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const t=n._originMediaStreamTrack;if(!t.canvas)return aO.warn("[".concat(n.getTrackId(),"] no canvas on track"));!function(e,t){const s=e.canvas;t.width&&(s.width=iU(t.width)),t.height&&(s.height=iU(t.height)),t.framerate&&(s.stopCapture&&s.stopCapture(),s.stopCapture=vj(()=>{!s.startCapture&&s.stopCapture&&s.stopCapture(),s.startCapture&&s.startCapture()},iU(t.framerate)))}(t,e)}null!=r.maxBitrate&&(n._encoderConfig.bitrateMax=r.maxBitrate/1e3),null!=r.maxFramerate&&(n._encoderConfig.frameRate&&"object"==typeof n._encoderConfig.frameRate?n._encoderConfig.frameRate.max=r.maxFramerate:n._encoderConfig.frameRate={max:r.maxFramerate}),aO.debug("[".concat(n.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n._encoderConfig))),await this.connection.updateRtpSenderEncodings(n)}publishLowStream(e){var t=this;return YT(function*(){if(!t.connection||t.state!==_M.Connected)return;const s=yield JT(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const s=t.localTrackMap.get(xM.LocalVideoTrack);if(!s)throw new IR(RR.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(xM.LocalVideoLowTrack))throw new IR(RR.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const r=[{track:t.getLowVideoTrack(s.track,e),type:xM.LocalVideoLowTrack}];if(yield*QT($F(t.doPublish(t.connection,r))),s.track.muted||!s.track.enabled){var n;const e=null===(n=t.localTrackMap.get(xM.LocalVideoLowTrack))||void 0===n?void 0:n.id;void 0!==e&&(yield JT(t.connection.muteLocal([e])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await iI(this,EM.RequestRePublish,this.pendingLocalTracks),this.emit(EM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(aO.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await iI(this,EM.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:s}=this.pendingRemoteTracks[t];(s!==fM.AUDIO||e._audio_added_&&e._audioSSRC)&&(s!==fM.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await iI(this,EM.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:s}of this.pendingRemoteTracks)await this.subscribe(t,s,s===fM.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(EM.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==_M.Connected)return void e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)});const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const s=t.find(e=>"videoLowTrack"===e[0]);return s&&s[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==_M.Connected)return void e.forEach(e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)});const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach(e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)}),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map(e=>e.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==_M.Connected)return;const e=this.localTrackMap.get(xM.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[xM.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const s=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:s}]=e;return{type:t,track:s}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(e,t){if(!this.connection||this.state!==_M.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=t.filter(t=>{var s;return!(null!==(s=this.remoteDataChannelMap.get(e))&&void 0!==s&&s.get(t.id))});if(0!==s.length)return await this.connection.createDataChannels(e.uid,s),s.forEach(t=>{var s;this.remoteDataChannelMap.has(e)?null===(s=this.remoteDataChannelMap.get(e))||void 0===s||s.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const n=this.pendingRemoteDataChannels.findIndex(s=>{let{user:n,id:r}=s;return n.uid===e.uid&&r===t.id});-1!==n&&this.pendingRemoteDataChannels.splice(n,1)}),s.map(e=>e.id)}async subscribe(e,t,s,n,r){var i;if(!this.connection||this.state!==_M.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;let a,o,c,l;const d=this.connection.getPreMedia(s);if(d)aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),c=d.transceiver,a=d.track,o=d.mid,l=d.player,d.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:d.firstVideoRender});else if(r){const s=r.find(e=>{let{stream_type:s}=e;return s===t});if(!s)throw new IR(RR.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const n=await this.connection.receive(t,s.ssrcs,String(e._uintid),s.attributes);this.connection instanceof TF&&(c=n.transceiver),a=n.track,o=n.id}else{const r=await this.connection.receive(t,[{ssrcId:s,rtx:n}],String(e._uintid),void 0);this.connection instanceof TF&&(c=r.transceiver),a=r.track,o=r.id}if(t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new QD(a,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new JD(a,e.uid,e._uintid,this.store,l),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(HO.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(HO.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),l?e._videoTrack.once(HO.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(HO.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&RA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:s,interceptRemoteAudioFrame:n}=ZU();t==fM.VIDEO?await s(c.receiver,{onSei:RA("ENABLE_VIDEO_SEI")&&(t=>{var s;return null===(s=e._videoTrack)||void 0===s?void 0:s._onSei(t)})}):t==fM.AUDIO&&await n(c.receiver,{enableTopn:!!RA("ENABLE_AUDIO_TOPN"),enableMetadata:!!RA("ENABLE_AUDIO_METADATA"),enablePts:!!RA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(EM.AudioMetadata,e)},onPts:e=>{this.safeEmit(EM.AudioPts,e)}})}const u=this.remoteUserMap.get(e);u?u.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const h=this.pendingRemoteTracks.findIndex(s=>{let{user:n,kind:r}=s;return n.uid===e.uid&&t===r});-1!==h&&(this.pendingRemoteTracks.splice(h,1),this.emit(EM.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==_M.Connected)throw new IR(RR.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(e=>{var t;let{user:s,mediaType:n}=e;return!(null!==(t=this.remoteUserMap.get(s))&&void 0!==t&&t.has(n))});const t=[],s=new Map;e.forEach(e=>{if(!this.connection)return;const n=this.connection.getPreMedia(e.ssrcId);if(n){const{track:t,mid:r,transceiver:i,player:a}=n;s.set(e.ssrcId,{track:t,id:r,transceiver:i,player:a})}else t.push(e)});const n=await this.connection.batchReceive(t.map(e=>{let{user:t,mediaType:s,ssrcId:n,rtxSsrcId:r}=e;return{kind:s,ssrcMsg:[{ssrcId:n,rtx:r}],mslabel:String(t._uintid)}}));t.forEach((e,t)=>{s.set(e.ssrcId,n[t])});for(const{user:r,mediaType:i,ssrcId:a}of e){const e=s.get(a);if(!e)return void aO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(i,", ").concat(a));const{track:t,id:n,transceiver:o,player:c}=e;if(o&&RA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();i==fM.VIDEO?await e(o.receiver,{onSei:RA("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=r._videoTrack)||void 0===t?void 0:t._onSei(e)})}):i==fM.AUDIO&&await t(o.receiver,{enableTopn:!!RA("ENABLE_AUDIO_TOPN"),enableMetadata:!!RA("ENABLE_AUDIO_METADATA"),enablePts:!!RA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(EM.AudioMetadata,e)},onPts:e=>{this.safeEmit(EM.AudioPts,e)}})}if(i===fM.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(t):(r._audioTrack=new QD(t,r.uid,r._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),o&&r._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(t):(r._videoTrack=new JD(t,r.uid,r._uintid,this.store,c),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),o&&r._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(r,r._videoTrack)),RA("ENABLE_VIDEO_SEI")&&o){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZU();i==fM.VIDEO?await e(o.receiver,{onSei:e=>{var t;null===(t=r._videoTrack)||void 0===t||t._onSei(e)}}):i==fM.AUDIO&&await t(o.receiver)}const l=this.remoteUserMap.get(r);l?l.set(i,n):this.remoteUserMap.set(r,new Map([[i,n]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const d=this.pendingRemoteTracks.findIndex(e=>{let{user:t,kind:s}=e;return t.uid===r.uid&&i===s});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(EM.MediaReconnectEnd,r.uid))}}async unsubscribe(e,t,s){const n=this.pendingRemoteTracks.filter(s=>{let{user:n,kind:r}=s;return void 0!==t?n.uid===e.uid&&t===r:n.uid===e.uid});if(n.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.connection&&this.state===_M.Connected||s||n.forEach(t=>{let{kind:s}=t;var n;if(s===fM.AUDIO)null===(n=e._audioTrack)||void 0===n||n._destroy(),e._audioTrack=void 0;else if(s===fM.VIDEO){var r;null===(r=e._videoTrack)||void 0===r||r._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==_M.Connected)return;const r=this.filterTobeUnSubscribedTracks(e,t);if(0===r.length)return;await this.connection.stopReceiving(r.map(e=>{let[,{id:t}]=e;return t}));const i=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),r.forEach(e=>{let[t,{kind:n}]=e;var r,i;if(n===fM.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),s||(null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0);else if(n===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),s||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),i}async unsubscribeDataChannel(e,t){if(t.forEach(e=>{const t=this.pendingRemoteDataChannels.findIndex(t=>t.id===e.id);-1!==t&&this.pendingRemoteDataChannels.splice(t,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(e,t);if(0===s.length)return;t.forEach(e=>{e._close()});const n=this.remoteDataChannelMap.get(e);return s.forEach(e=>{n&&n.delete(e.id)}),n&&0===n.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),s.map(e=>e.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:r,mediaType:i}of e){const e=this.pendingRemoteTracks.filter(e=>{let{user:t,kind:s}=e;return void 0!==i?t.uid===r.uid&&i===s:t.uid===r.uid});e.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),t=t.concat(e)}if(!this.connection||this.state!==_M.Connected)return void t.forEach(e=>{let{user:t,kind:s}=e;var n;if(s===fM.AUDIO)null===(n=t._audioTrack)||void 0===n||n._destroy(),t._audioTrack=void 0;else if(s===fM.VIDEO){var r;null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0}});const s=rr(e).call(e,(e,t)=>{let{user:s,mediaType:n}=t;const r=this.filterTobeUnSubscribedTracks(s,n);return e.concat(r)},[]);if(0===s.length)return;await this.connection.stopReceiving(s.map(e=>{let[,{id:t}]=e;return t}));const n=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),s.forEach(e=>{let[t,{kind:s}]=e;var n,r;if(s===fM.VIDEO&&t._videoSSRC&&(null===(n=this.connection)||void 0===n||n.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),s===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0;else if(s===fM.AUDIO){var i;this.unbindRemoteTrackEvents(t._audioTrack),null===(i=t._audioTrack)||void 0===i||i._destroy(),t._audioTrack=void 0}}),n}isPreSubScribe(e){return!(!this.connection||this.state!==_M.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const n=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==n&&this.connection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const s=this.remoteUserMap.get(e);s?s.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(xM.LocalAudioTrack),s=t&&t.track;s&&s.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(xM.LocalAudioTrack);if((null==t?void 0:t.track)instanceof Wk){const s=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==xM.LocalAudioTrack}).filter(t=>{let[s]=t;return!(e&&s===xM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[s]=t;return!(e&&s===xM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,s,n,r){if(e){const s=this.localTrackMap.get(xM.LocalAudioTrack),i=n?this.localTrackMap.get(xM.LocalVideoLowTrack):this.localTrackMap.get(xM.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.track.getTrackLabel(),videoName:null==i?void 0:i.track.getTrackLabel(),screenshare:-1!==(null==i?void 0:i.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!s,video:!!i,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var i;s||(s=[]);const a=s.find(e=>e instanceof Fk),o=n?null===(i=this.localTrackMap.get(xM.LocalVideoTrack))||void 0===i?void 0:i.track:s.find(e=>e instanceof DD);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,s,n){const r=n===fM.VIDEO?s._videoSSRC:s._audioSSRC;r&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===fM.VIDEO,audio:n===fM.AUDIO,peerid:s.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new UI("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=_F(this.store),this.emit(EM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(xM.LocalAudioTrack);if((null==e?void 0:e.track)instanceof Wk){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=_M.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(xM.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(xM.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof DD||t&&t.track instanceof Fk?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(xM.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.connection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=_M.Reconnecting,RA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&(null===(s=t._videoTrack._player.getVideoElement())||void 0===s||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=_F(this.store),this.emit(EM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:n}]=e;switch(s){case xM.LocalVideoTrack:Dn(t=n._hints).call(t,UO.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case xM.LocalAudioTrack:n instanceof Wk?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case xM.LocalVideoLowTrack:}}),this.emit(EM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(XA(s).call(s)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(EM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,s]=e;Array.from(XA(s).call(s)).forEach(e=>{this.setPendingRemoteDataChannel(t,e)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const s of this.pendingRemoteDataChannels){const{user:n,id:r}=s;if((e instanceof ZV?e.uid:e)===n.uid&&r===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const s of this.pendingRemoteTracks){const{user:n,kind:r}=s;if((e instanceof ZV?e.uid:e)===n.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return YT(function*(){if(!t.connection||t.state!==_M.Connected)return;const s=yield JT(t.mutex.lock("From P2PChannel.restartICE"));let n;try{n=yield JT(t.connection.restartICE(e));const s=yield JT(n.next());if(s.done)return;const r=s.value,i=yield r;switch(EF(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case gM.UDP_TCP_RELAY:t._pcStatsUploadType=yM.UDP_TCP_RESTART;break;case gM.TCP_RELAY:t._pcStatsUploadType=yM.TCP_RESTART;break;case gM.RELAY:t._pcStatsUploadType=yM.RELAY_RESTART;break;default:t._pcStatsUploadType=yM.OLD_RESTART}t._isTryConnecting=!0,n.next(i)}catch(e){var r;null===(r=n)||void 0===r||r.throw(e)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(xM.LocalVideoTrack),s=this.localTrackMap.get(xM.LocalAudioTrack),n=e.videoSend.find(e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)),r=e.audioSend.find(e=>e.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId));if(!n||!r)return 1;const i=oI(this,EM.NeedSignalRTT),a=n?n.rttMs:void 0,o=r?r.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&i?(c+i)/2:c||i)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,s=e.bitrate.actualEncoded;if(t&&s){const e=(1e3*t-s)/(1e3*t);return GP[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[n]=s;const r=n._audioSSRC,i=n._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===r),o=e.videoRecv.find(e=>e.ssrc===i);if(!a&&!o)return void(t+=1);const c=oI(this,EM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new sp((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}async replaceTrack(e,t){var s;if(aO.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==_M.Connected)return;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:s}]=t;return e===s});if(!n)return;const r=n[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:r}]),this.bindLocalTrackEvents([{track:t,type:r}]),n[1].track=t),await(null===(s=this.connection)||void 0===s?void 0:s.replaceTrack(t,n[1].id)),this.isPlanB){const e=n[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(r,e)}if(r===xM.LocalVideoTrack&&!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding){const t=this.localTrackMap.get(xM.LocalVideoLowTrack);if(t){const s=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=s,t.track._originMediaStreamTrack=s,await new sp((e,s)=>{this.handleReplaceTrack(t.track,e,s,!0)})}}}filterTobePublishedTracks(e,t,s){const n=[],r=this.getAllTracks();e=uI(e=e.filter(e=>-1===r.indexOf(e)));let i,a=!1;const o=this.localTrackMap.get(xM.LocalAudioTrack);for(const c of e){if(c instanceof DD&&(this.localTrackMap.has(xM.LocalVideoTrack)||a?new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:c,type:xM.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,s);n.push({track:e,type:xM.LocalVideoLowTrack})}if(c instanceof Fk)if(o){const e=o.track;if(e instanceof Wk)yF([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=vF([e,c]);aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else i instanceof Wk?(yF([c]),i.addAudioTrack(c)):i=i||!c._useAudioElement&&yO().webAudioMediaStreamDest&&!c._bypassWebAudio?vF(i?[c,i]:[c]):c}return i&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(i.getTrackId(),"]")),n.push({track:i,type:xM.LocalAudioTrack})),n}filterTobeUnpublishedTracks(e){const t=[],s=this.getAllTracks();e=uI(e=e.filter(e=>-1!==s.indexOf(e)));for(const n of e){if(n instanceof Fk){const e=this.localTrackMap.get(xM.LocalAudioTrack);if(!e)continue;e.track instanceof Wk?(e.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===e.track.trackList.length&&(t.push([xM.LocalAudioTrack,e]),e.track.close())):t.push([xM.LocalAudioTrack,e])}if(n instanceof DD){const e=this.localTrackMap.get(xM.LocalVideoTrack);if(!e)continue;t.push([xM.LocalVideoTrack,e]);const s=this.localTrackMap.get(xM.LocalVideoLowTrack);s&&t.push([xM.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return(e=uI(e)).filter(e=>-1===this.localDataChannels.findIndex(t=>t.id===e.id))}filterTobeUnpublishedDataChannels(e){return(e=(e=uI(e)).filter(e=>-1!==this.localDataChannels.indexOf(e))).filter(e=>e._originDataChannel)}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:s}=e;switch(s){case xM.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xM.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case xM.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Wk?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:s}]=e;return{track:s,type:t}})),e.forEach(e=>{let{track:t,type:s}=e;switch(s){case xM.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.GET_RTC_STATS,this.handleGetRTCStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xM.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case xM.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Wk?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,s)=>{var n;let r,i,{track:a,type:o}=e;switch(o){case xM.LocalAudioTrack:r=nM.Audio,i={dtx:a instanceof Bk&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case xM.LocalVideoTrack:r=Dn(n=a._hints).call(n,UO.SCREEN_TRACK)?nM.Screen:nM.High,i=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()});break;case xM.LocalVideoLowTrack:r=nM.Low,i=ZF(ZF({},aU(a)),{},{codec:this.store.codec,svc_mode:pU()})}return{stream_type:r,attributes:i,ssrcs:t[s]}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let s,[n,{track:r,ssrcs:i,id:a}]=e;switch(n){case xM.LocalVideoTrack:s=Dn(t=r._hints).call(t,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalAudioTrack:s=nM.Audio;break;case xM.LocalVideoLowTrack:s=nM.Low}return{stream_type:s,ssrcs:i,mid:a}})}assignLocalTracks(e,t){e.forEach((e,s)=>{let{track:n,type:r}=e;this.localTrackMap.set(r,{track:n,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(EM.PeerConnectionStateChange,t),"connecting"===t&&e instanceof TF&&!sR()&&RA("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{"connecting"===t&&e.extendCandidate()},RA("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof TF&&YF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=yM.DISCONNECTED_OR_FAILED,"CONNECTED"===oI(this,EM.QueryClientConnectionState)&&this._isWaitPcToRePub)){const e=this.pendingLocalTracks.map(e=>e.getTrackId()),t=this.pendingLocalDataChannels.map(e=>"dc_".concat(e.id));mO.reportApiInvoke(this.store.sessionId,{name:qR.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:YR.TRACER}).onSuccess(),this.republish()}if(RA("NEW_ICE_RESTART")&&e instanceof TF&&!sR()&&!this._forceTurn){if(Dn(vM).call(vM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{EF(e)&&(aO.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===oI(this,EM.QueryClientConnectionState)&&this.emit(EM.RequestRestartICE,t))},s=()=>{EF(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),aO.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(EM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{XF(e,t,s)},800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&RA("ICE_RESTART")&&"CONNECTED"===oI(this,EM.QueryClientConnectionState)&&this.emit(EM.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(EM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);"failed"===t&&(aO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(EM.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YR.TRACER}).onSuccess(),this.emit(EM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var n;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),null===(n=s.audioTrack)||void 0===n||n.emit(HO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);s&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,s)=>{var n;const r=Array.from(XA(n=this.remoteUserMap).call(n)).find(t=>t._videoSSRC===e);r&&this.store.firstVideoFrameDecoded(r.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,t,s)},e.onFirstVideoRender=e=>{var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(s))},e.onFirstVideoReceived=e=>{var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstReceived:Date.now()}),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(e,t)=>{const s="relay"===e.candidateType,n="relay"===t.candidateType;"unknown"!==t.candidateType&&s===n||this.emit(EM.ConnectionTypeChange,s),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return ZF(ZF({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){e instanceof TF&&function(e){KF.delete(e.id),YF(e)}(e),e.close(),this.emit(EM.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const s=this.localTrackMap.get(xM.LocalAudioTrack);if(e instanceof Fk&&(null==s?void 0:s.track)instanceof Wk)return s.track.isActive||t.push([xM.LocalAudioTrack,s]),t;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:s}]=t;return e===s});if(n&&(t.push(n),n[0]===xM.LocalVideoTrack)){const e=this.localTrackMap.get(xM.LocalVideoLowTrack);e&&t.push([xM.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],s=this.localTrackMap.get(xM.LocalAudioTrack);if(e instanceof Fk&&(null==s?void 0:s.track)instanceof Wk)return s.track.isActive&&t.push([xM.LocalAudioTrack,s]),t;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:s}]=t;return e===s});if(n)if(n[0]===xM.LocalVideoTrack){t.push(n);const e=this.localTrackMap.get(xM.LocalVideoLowTrack);e&&t.push([xM.LocalVideoLowTrack,e])}else t.push(n);return t}createMuteMessage(e){return e.map(e=>{var t;let s,[n,{track:r,ssrcs:i,id:a}]=e;switch(n){case xM.LocalAudioTrack:s=nM.Audio;break;case xM.LocalVideoTrack:s=Dn(t=r._hints).call(t,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalVideoLowTrack:s=nM.Low}return{stream_type:s,ssrcs:i,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let s,[n,{track:r,ssrcs:i,id:a}]=e;switch(n){case xM.LocalAudioTrack:s=nM.Audio;break;case xM.LocalVideoTrack:s=Dn(t=r._hints).call(t,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalVideoLowTrack:s=nM.Low}return{stream_type:s,ssrcs:i,mid:a}})}filterTobeUnSubscribedTracks(e,t){const s=[],n=this.remoteUserMap.get(e);if(!n)return s;if(t){const r=n.get(t);if(!r)return s;s.push([e,{kind:t,id:r}])}else Array.from(n.entries()).forEach(t=>{let[n,r]=t;s.push([e,{kind:n,id:r}])});return s}filterTobeUnSubscribedDataChannels(e,t){const s=[];return t.forEach(t=>{var n;null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.has(t.id)&&s.push(t)}),s}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[s,{kind:n,id:r}]=e;switch(n){case fM.VIDEO:return void(s._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:s._videoSSRC}));case fM.AUDIO:return void(s._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:s._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(e=>{let[s,{kind:n}]=e;if(t.has(s)){let e=t.get(s);n===fM.VIDEO?e|=aM.Video:e|=aM.Audio,t.set(s,e)}else n===fM.VIDEO?t.set(s,aM.Video):t.set(s,aM.Audio)}),{users:Array.from(t.entries()).map(e=>{let[t,s]=e;return{stream_id:t.uid,stream_type:s}})}}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:s}]=e;const n=this.remoteUserMap.get(t);n&&(n.delete(s),0===Array.from(n.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(xM.LocalVideoTrack),s=this.localTrackMap.get(xM.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new sp((e,s)=>{this.handleUpdateVideoEncoder(t.track,e,s,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new sp((e,t)=>{this.handleUpdateVideoEncoder(s.track,e,t,!0)}))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}isPreallocation(){return this.connection instanceof TF&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof TF&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,s){return e.map((e,n)=>{var r;let{stream_type:i}=e;const a=null===(r=t.find(e=>{let{stream_type:t}=e;return i===t}))||void 0===r?void 0:r.attributes;if(a&&RA("DISABLE_SCREEN_SHARE_REMB")){const e=s[n]._hints;(Dn(e).call(e,UO.SCREEN_TRACK)||Dn(e).call(e,UO.SCREEN_LOW_TRACK))&&(a.remb=!1,aO.debug("disable remb for screen share, hints:",e))}return a})}async tryToUnmuteAudio(e){for(let s=0;s<e.length;s++)if(e[s]instanceof Fk){var t;const n=this.filterTobeUnmutedTracks(e[s]);if(0===n.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(n.map(e=>{let[,{id:t}]=e;return t})));const r=this.createUnmuteMessage(n);return void await aI(this,EM.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(EM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(EM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await NI(BI(this.dtlsFailedCount,FI)),this.emit(EM.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await iI(this,EM.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(EM.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(xM.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof DD)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof DD).length>1)throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Fk).length>1&&(e.some(e=>e instanceof Fk&&e._bypassWebAudio)||!yO().webAudioMediaStreamDest))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof DD&&this.pendingLocalTracks.some(e=>e instanceof DD))throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fk&&this.pendingLocalTracks.some(e=>e instanceof Fk)&&(!yO().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Fk&&e._bypassWebAudio)))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var s;const n=!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding,r=ZF(ZF({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():RF(e,r);const a=SI(8,"track-low-"),o=new DD(i,ZF(ZF({},n&&{scaleResolutionDownBy:dU(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return o.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),o._hints.push(UO.LOW_STREAM),Dn(s=e._hints).call(s,UO.SCREEN_TRACK)&&o._hints.push(UO.SCREEN_LOW_TRACK),e.on("sei-to-send",e=>{o.emit("sei-to-send",e)}),e.addListener(MO.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof TF){var r,i,a,o;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();mO.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:this._iceError||n||"",selectedLocalCandidateProtocol:null!==(r=null==h?void 0:h.protocol)&&void 0!==r?r:"",selectedLocalCandidateType:null!==(i=h.candidateType)&&void 0!==i?i:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(o=p.candidateType)&&void 0!==o?o:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,s=t.firstVideoFrameDecoded.find(t=>t.userId===e.uid);if(!s)return;const{isInternalUpload:n,isExternalUpload:r}=s;if(n&&r)return;const{subscribeEnd:i,firstPreRender:a,peerPublishDuration:o,peerPubStatusMs:c}=s;let{firstRender:l=0}=s;if(i&&(l||a)&&o&&c){s.isInternalUpload=!0;const{playEnd:n}=s;n&&(s.isExternalUpload=!0);const{firstPreRender:r=0}=s;l=r||l;const a=e.videoTrack,d={peer:e._uintid,width:(null==a?void 0:a._videoWidth)||0,height:(null==a?void 0:a._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:o,peerPubStatusMs:c,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:r||0,firstRender:n?Math.max(l,n):Math.max(l,i),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:EO(this.store)};mO.firstXLAPeerFirstVideoFrame(this.store.sessionId,d)}}reportVideoFirstFrameDecoded(e,t,s,n){var r;const i=Array.from(XA(r=this.remoteUserMap).call(r)).find(t=>t._videoSSRC===e);if(i){n||this.store.subscribe(i.uid,"video",void 0,void 0,void 0,void 0,Date.now());const r=this.store.keyMetrics,a=r.subscribe.find(e=>e.userId===i.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:i._uintid,videowidth:t,videoheight:s,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:r.requestAPEnd||0,apStart:r.requestAPStart||0,joinGwEnd:r.joinGatewayEnd||0,joinGwStart:r.joinGatewayStart||0,pcEnd:r.peerConnectionEnd||0,pcStart:r.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:n?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.connection)return!1;const n=this.remoteUserMap.get(e);if(!n)return!1;const r=n.get(t);if(!r)return!1;const i=await this.connection.getRemoteSSRC(r);return void 0!==i&&i!==s}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===xM.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,VO.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},IL(JF.prototype,"startP2PConnection",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"startP2PConnection"),JF.prototype),IL(JF.prototype,"connect",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"connect"),JF.prototype),IL(JF.prototype,"updateRemoteRTPCapabilities",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"updateRemoteRTPCapabilities"),JF.prototype),IL(JF.prototype,"publishDataChannel",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"publishDataChannel"),JF.prototype),IL(JF.prototype,"unpublish",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublish"),JF.prototype),IL(JF.prototype,"unpublishDataChannel",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishDataChannel"),JF.prototype),IL(JF.prototype,"unpublishLowStream",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"unpublishLowStream"),JF.prototype),IL(JF.prototype,"subscribeDataChannel",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribeDataChannel"),JF.prototype),IL(JF.prototype,"subscribe",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"subscribe"),JF.prototype),IL(JF.prototype,"massSubscribe",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"massSubscribe"),JF.prototype),IL(JF.prototype,"unsubscribe",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribe"),JF.prototype),IL(JF.prototype,"unsubscribeDataChannel",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"unsubscribeDataChannel"),JF.prototype),IL(JF.prototype,"massUnsubscribe",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"massUnsubscribe"),JF.prototype),IL(JF.prototype,"muteRemote",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"muteRemote"),JF.prototype),IL(JF.prototype,"unmuteRemote",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"unmuteRemote"),JF.prototype),IL(JF.prototype,"hasRemoteMediaWithLock",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"hasRemoteMediaWithLock"),JF.prototype),IL(JF.prototype,"disconnectForReconnect",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"disconnectForReconnect"),JF.prototype),IL(JF.prototype,"updateBitrateLimit",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"updateBitrateLimit"),JF.prototype),IL(JF.prototype,"remoteMediaSsrcChanged",[sB],Object.getOwnPropertyDescriptor(JF.prototype,"remoteMediaSsrcChanged"),JF.prototype),JF);function sB(e,t,s){const n=e[t];if("function"!=typeof n)throw new Error("Cannot use mutex on object property.");return s.value=async function(){const e=this.mutex,s=await e.lock("From P2PChannel.".concat(t));try{for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return await n.apply(this,i)}finally{s()}},s}function nB(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function rB(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?nB(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):nB(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const iB=Date.now(),aB=20,oB=new Map,cB=new Map;async function lB(e){const t=oB.get(e),s=Array.isArray(t)&&t[t.length-1],n=cB.get(e);if(!s)return void(n.isSyncing=!1);const r={uid:s.uid,payload:s.payload};0===n.firstRecvTs&&(n.firstRecvTs=s.recvTs,n.firstSendTs=s.sendTs);const i=s.sendTs-n.firstSendTs,a=i-(Date.now()-n.firstRecvTs);a>0&&(n.firstRecvTs=Date.now()-i);let o=s.mediaDelay+a;o<=0?(t.pop(),dB(s.context,r),o=0):o=Math.min(o,aB),setTimeout(()=>t.length&&lB(e),o)}function dB(e,t){e.safeEmit(tI.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function uB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return dB(s,{uid:e.uid,payload:e.payload});const n="".concat(s.id,"-").concat(e.uid),r=oB.get(n)||[],i=r.findIndex(t=>e.sendTs>=t.sendTs),a=rB(rB({},e),{},{context:s,mediaDelay:t,recvTs:Date.now()});-1===i?r.push(a):r.splice(i,0,a),oB.set(n,r);let o=!1;var c;cB.has(n)?o=!(null===(c=cB.get(n))||void 0===c||!c.isSyncing):cB.set(n,{isSyncing:o,firstRecvTs:0,firstSendTs:0}),o||lB(n)}const hB=qC().name;function pB(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function mB(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?pB(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):pB(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const fB="websdk_ng_cache_parameter",gB=RA("MAX_PRELOAD_ASYNC_LENGTH"),yB=1e4,vB=new Map,xB=[];let _B=null,EB=0,bB=0;const wB=new Map,NB=function(e,t){const s=[];let n=0;const r=async()=>{const e=s.shift();e&&await e(),s.length>0&&n<t?r():n--};return async function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return new sp(async(i,o)=>{s.push(async()=>{try{const t=await e(...a);i(t)}catch(e){o(e)}}),n<t&&(n++,r())})}}(TB,gB),SB=LC.CancelToken.source();async function TB(e,t,s,n,r,i){try{if(!RA("ENABLE_PRELOAD"))return;if(!yO().supportWebCrypto)return void gI(()=>{aO.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&null!==s)throw new IR(RR.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&DR(s,"token",1,2047),DR(e,"appid",1,2047),GL(t),n&&WL(n);const a=TI();aO.debug("preload channel ".concat(t,", uid is ").concat(n));const o={appId:e,cname:t,token:s||e,uid:"string"!=typeof n?n:null,sid:a,proxyServer:r};let c,l;"string"==typeof n?(o.stringUid=n,[l,c]=await sp.all([PV(n,{sid:a,appId:e},SB.token),MV(mB(mB({},o),{},{token:s||e,uid:0}),SB.token)]),o.uid=l.uid,c.gatewayInfo.uid=o.uid,c.gatewayInfo.res.uid=o.uid):(i&&(o.stringUid=i),c=await MV(o,SB.token));const d={sid:a,appId:e,cname:t,token:s||e,uid:o.stringUid||n,intUid:o.uid||c.gatewayInfo.uid,stringUid:o.stringUid,ts:Date.now(),sua:l,ap:c};await async function(e){let t;try{e.uid&&RB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const s=DB(e),n=await async function(e,t){try{const s=await window.crypto.subtle.importKey("raw",xI(t),"AES-GCM",!1,["encrypt"]),n=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,yI(window.btoa(JSON.stringify(e))));return vI(new Uint8Array(n))}catch(e){return}}(e,e.token||e.appId);if(!n)return;t=jB(fB);const r=t?JSON.parse(t):[];r.push({[s]:n}),r.length>RA("AP_CACHE_NUM")&&r.shift(),kB(fB,JSON.stringify(r))}catch(e){aO.warn("Error caching server parameters:",e.message),kB(fB,"")}}(d),EB++}catch(e){throw bB++,function(e){_B||(_B=window.setTimeout(()=>{let t="";wB.forEach((e,s)=>{t+="".concat(s,": ").concat(e," ;")}),mO.reportApiInvoke(null,{name:qR.PRELOAD,options:{success:EB,failed:bB,err:t}}).onError(e),EB=0,bB=0,wB.clear(),_B=null},yB));const t=wB.get(e.code)||0;wB.set(e.code,t+1)}(e),e}}async function CB(e){try{if(RA("AP_REQUEST_DETAIL")||RA("ENABLE_ROLE_SELECT_EDGE"))return;const t=RB(e);if(!t||"disabled"!==e.cloudProxyServer)return;const s=await async function(e,t){try{const s=await window.crypto.subtle.importKey("raw",xI(t),"AES-GCM",!1,["decrypt"]),n=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,yI(e));return JSON.parse(window.atob(vI(new Uint8Array(n))))}catch(e){return}}(t,e.token||e.appId);if(!s)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(s,e))return;if(s&&Date.now()-s.ts<RA("AP_CACHE_LIFETIME"))return s}catch(e){aO.warn("Error get preloadInfo",e.message)}}function RB(e){let t;try{if(t=jB(fB),!t)return;const s=JSON.parse(t),n=DB(e),r=function(e,t){for(let s=e.length-1;s>=0;s--)if(t(e[s]))return s;return-1}(s,e=>n in e);if(-1===r)return;const i=s.splice(r,1)[0];return kB(fB,JSON.stringify(s)),i[n]}catch(e){aO.warn("Error delete preload info: ".concat(t),e.message),kB(fB,"")}}function IB(e){if(e){let t=vB.get(e);t&&(window.clearTimeout(t),t=null,vB.delete(e)),Dn(xB).call(xB,e)||"disabled"!==e.cloudProxyServer||xB.push(e)}if(vB.size<RA("AP_CACHE_NUM")&&xB.length>0){const e=xB.shift();vB.set(e,window.setTimeout(async()=>{const{appId:t,cname:s,token:n,stringUid:r,uid:i,proxyServer:a}=e;try{await NB(t,s,n,i,a,r),vB.has(e)&&IB(e)}catch(t){aO.warn("update preload failed",t.message),AB(e)}},RA("AP_UPDATE_INTERVAL")))}}function AB(e){const t=xB.indexOf(e);-1!==t&&xB.splice(t,1);let s=vB.get(e);s&&(window.clearTimeout(s),s=null,vB.delete(e),IB())}function OB(e,t){const s=e.sua,n=e.ap;t&&s&&mO.reqUserAccount(e.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:t,uid:e.intUid,errorCode:null,extend:s.req}),mO.reportResourceTiming(e.ap.url,e.sid),mO.joinWebProxyAP(e.sid,{lts:n.requestTime,elapse:n.elapse,sucess:1,apServerAddr:n.url,turnServerAddrList:n.proxyInfo.addresses.map(e=>e.ip).join(","),eventType:"disabled",unilbsServerIds:[$M.CHOOSE_SERVER,$M.CLOUD_PROXY_FALLBACK].toString()}),mO.joinChooseServer(e.sid,{lts:n.requestTime,elapse:n.elapse,succ:!0,csAddr:n.url,opid:n.opid,serverList:n.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,cid:n.gatewayInfo.cid.toString(),uid:n.gatewayInfo.uid.toString(),csIp:n.gatewayInfo.csIp,unilbsServerIds:[$M.CHOOSE_SERVER].toString(),isHttp3:n.isHttp3})}function jB(e){return window.atob(window.localStorage.getItem(e)||"")}function kB(e,t){window.localStorage.setItem(e,window.btoa(t))}function DB(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),PI(t)}function PB(e){let t=function(){const e=VB.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let s=e.appId;void 0!==s&&(JB(t,10),zB(t,s));let n=e.cid;void 0!==n&&(JB(t,16),JB(t,n));let r=e.cname;void 0!==r&&(JB(t,26),zB(t,r));let i=e.deviceId;void 0!==i&&(JB(t,34),zB(t,i));let a=e.elapse;void 0!==a&&(JB(t,40),ZB(t,a));let o=e.fileSize;void 0!==o&&(JB(t,48),ZB(t,UB(o)));let c=e.height;void 0!==c&&(JB(t,56),ZB(t,UB(c)));let l=e.jpg;void 0!==l&&(JB(t,66),JB(t,l.length),HB(t,l));let d=e.networkType;void 0!==d&&(JB(t,72),ZB(t,UB(d)));let u=e.osType;void 0!==u&&(JB(t,80),ZB(t,UB(u)));let h=e.requestId;void 0!==h&&(JB(t,90),zB(t,h));let p=e.sdkVersion;void 0!==p&&(JB(t,98),zB(t,p));let m=e.sequence;void 0!==m&&(JB(t,104),ZB(t,UB(m)));let f=e.sid;void 0!==f&&(JB(t,114),zB(t,f));let g=e.timestamp;void 0!==g&&(JB(t,120),ZB(t,g));let y=e.uid;void 0!==y&&(JB(t,128),JB(t,y));let v=e.vid;void 0!==v&&(JB(t,136),JB(t,v));let x=e.width;void 0!==x&&(JB(t,144),ZB(t,UB(x)));let _=e.service;void 0!==_&&(JB(t,152),JB(t,_));let E=e.callbackData;void 0!==E&&(JB(t,162),JB(t,E.length),HB(t,E));let b=e.ticket;void 0!==b&&(JB(t,170),zB(t,b));let w=e.vendorConfigs;void 0!==w&&(JB(t,178),zB(t,w))}(e,t),function(e){let t=e.bytes,s=e.limit;return t.length===s?t:t.subarray(0,s)}(t)}function LB(e){return function(e){let t={};e:for(;!BB(e);){let s=XB(e);switch(s>>>3){case 0:break e;case 1:t.code=XB(e);break;case 2:t.msg=KB(e,XB(e));break;case 3:t.requestId=KB(e,XB(e));break;case 4:t.timestamp=QB(e,!1);break;default:MB(e,7&s)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function MB(e,t){switch(t){case 0:for(;128&qB(e););break;case 2:FB(e,XB(e));break;case 5:FB(e,4);break;case 1:FB(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function UB(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let VB=[];function FB(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function BB(e){return e.offset>=e.limit}function GB(e,t){let s=e.bytes,n=e.offset,r=e.limit,i=n+t;if(i>s.length){let t=new Uint8Array(2*i);t.set(s),e.bytes=t}return e.offset=i,i>r&&(e.limit=i),n}function WB(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function HB(e,t){let s=GB(e,t.length);e.bytes.set(t,s)}function KB(e,t){let s=WB(e,t),n=String.fromCharCode,r=e.bytes,i="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=r[o+s];0==(128&u)?a+=n(u):192==(224&u)?o+1>=t?a+=i:(e=r[o+s+1],128!=(192&e)?a+=i:(d=(31&u)<<6|63&e,d<128?a+=i:(a+=n(d),o++))):224==(240&u)?o+2>=t?a+=i:(e=r[o+s+1],c=r[o+s+2],32896!=(49344&(e|c<<8))?a+=i:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=i:(a+=n(d),o+=2))):240==(248&u)?o+3>=t?a+=i:(e=r[o+s+1],c=r[o+s+2],l=r[o+s+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=i:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=i:(d-=65536,a+=n(55296+(d>>10),56320+(1023&d)),o+=3))):a+=i}return a}function zB(e,t){let s=t.length,n=0;for(let a=0;a<s;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<s&&(e=(e<<10)+t.charCodeAt(++a)-56613888),n+=e<128?1:e<2048?2:e<65536?3:4}JB(e,n);let r=GB(e,n),i=e.bytes;for(let a=0;a<s;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<s&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?i[r++]=e:(e<2048?i[r++]=e>>6&31|192:(e<65536?i[r++]=e>>12&15|224:(i[r++]=e>>18&7|240,i[r++]=e>>12&63|128),i[r++]=e>>6&63|128),i[r++]=63&e|128)}}function qB(e){return e.bytes[WB(e,1)]}function YB(e,t){let s=GB(e,1);e.bytes[s]=t}function XB(e){let t,s=0,n=0;do{t=qB(e),s<32&&(n|=(127&t)<<s),s+=7}while(128&t);return n}function JB(e,t){for(t>>>=0;t>=128;)YB(e,127&t|128),t>>>=7;YB(e,t)}function QB(e,t){let s,n=0,r=0,i=0;return s=qB(e),n=127&s,128&s&&(s=qB(e),n|=(127&s)<<7,128&s&&(s=qB(e),n|=(127&s)<<14,128&s&&(s=qB(e),n|=(127&s)<<21,128&s&&(s=qB(e),r=127&s,128&s&&(s=qB(e),r|=(127&s)<<7,128&s&&(s=qB(e),r|=(127&s)<<14,128&s&&(s=qB(e),r|=(127&s)<<21,128&s&&(s=qB(e),i=127&s,128&s&&(s=qB(e),i|=(127&s)<<7))))))))),{low:n|r<<28,high:r>>>4|i<<24,unsigned:t}}function ZB(e,t){let s=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,i=0===r?0===n?s<16384?s<128?1:2:s<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:r<128?9:10,a=GB(e,i),o=e.bytes;switch(i){case 10:o[a+9]=r>>>7&1;case 9:o[a+8]=9!==i?128|r:127&r;case 8:o[a+7]=8!==i?n>>>21|128:n>>>21&127;case 7:o[a+6]=7!==i?n>>>14|128:n>>>14&127;case 6:o[a+5]=6!==i?n>>>7|128:n>>>7&127;case 5:o[a+4]=5!==i?128|n:127&n;case 4:o[a+3]=4!==i?s>>>21|128:s>>>21&127;case 3:o[a+2]=3!==i?s>>>14|128:s>>>14&127;case 2:o[a+1]=2!==i?s>>>7|128:s>>>7&127;case 1:o[a]=1!==i?128|s:127&s}}const $B={},eG={},tG=4294967296,sG=tG*tG,nG=sG/2,rG=lG(0,!0),iG=lG(0),aG=dG(0,-2147483648,!1),oG=dG(-1,2147483647,!1),cG=dG(-1,-1,!0);function lG(e,t){let s,n,r;return t?(r=0<=(e>>>=0)&&e<256)&&(n=eG[e],n)?n:(s=dG(e,0,!0),r&&(eG[e]=s),s):(r=-128<=(e|=0)&&e<128)&&(n=$B[e],n)?n:(s=dG(e,e<0?-1:0,!1),r&&($B[e]=s),s)}function dG(e,t,s){return{low:0|e,high:0|t,unsigned:!!s}}function uG(e,t){if(isNaN(e))return t?rG:iG;if(t){if(e<0)return rG;if(e>=sG)return cG}else{if(e<=-nG)return aG;if(e+1>=nG)return oG}return e<0?t?rG:iG:dG(e%tG|0,e/tG|0,t)}function hG(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}class pG extends HR{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(RM.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),uS(this,"name","AgoraRTCImageModeration"),uS(this,"_connectionState",CM.CONNECTING),uS(this,"_sequence",0),uS(this,"_moderationStartTime",void 0),uS(this,"_workerConnection",void 0),uS(this,"_workerMessageLengthLimit",void 0),uS(this,"_qualityRatio",void 0),uS(this,"_connectInfo",void 0),uS(this,"_cancelTokenSource",LC.CancelToken.source()),uS(this,"_retryConfig",void 0),uS(this,"_moderationInterval",void 0),uS(this,"_moderationTimer",null),uS(this,"_moderationMode",1),uS(this,"_quality",1),uS(this,"_qualityTimer",null),uS(this,"_ticket",void 0),uS(this,"_moderationIntervalMinimum",void 0),uS(this,"_uploadFailedNum",0),uS(this,"_uploadNum",0),uS(this,"_uploadTimer",null),uS(this,"_extraInfo",void 0),uS(this,"_vendor",""),uS(this,"_encoder",new TextEncoder),uS(this,"_moderationId",void 0),uS(this,"inspectImage",()=>{if(this.connectionState!==CM.CONNECTED)throw new fO(RR.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===CM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=SI(5,"image-moderation-"),this._workerMessageLengthLimit=RA("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=RA("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=RA("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new JM("worker-"+this._moderationId,FI),this.on(RM.STATE_CHANGE,(e,t)=>{aO.debug("[".concat(this._moderationId,"] Moderation operation :").concat(IM[e]," ").concat(t||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(RM.STATE_CHANGE,IM.CONNECT_AP),this._connectInfo=e;const s=this._cancelTokenSource.token;return this._retryConfig=t,new sp((n,r)=>{this.on(RM.CONNECTION_STATE_CHANGE,(e,t)=>{e===CM.CONNECTED&&n()}),this.requestAP(e,s,t).then(e=>{this.connectWorker(e)}).catch(e=>{r(e)})})}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),aO.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===CM.CONNECTED&&this.inspectImage()}async requestAP(e,t,s){const n=RA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),r=await function(e,t,s,n){let{appId:r,areaCode:i,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="moderation_plugin",u={service_name:d,json_body:JSON.stringify({appId:r,areaCode:i,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,appToken:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GI(async()=>{h=Date.now();const e=await iV(m,{data:u,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers.some(e=>!!e.wss)){const e=new fO(RR.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const n=RA("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map(e=>{let{address:t,wss:s}=e;if(t&&s)return"wss://".concat(t.replace(/\./g,"-"),".").concat(n,":").concat(s,"/moderation")}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}},(t,s)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===s,responseTime:p,serverIp:e[s%e.length]}),!1),(t,s)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[s%e.length]}),!!(t.code!==RR.OPERATION_ABORTED&&t.code!==RR.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(s+1)%e.length],!0)),n)}(n,e,t,s);this.emit(RM.STATE_CHANGE,IM.AP_CONNECTED);const{addressList:i,ticket:a}=r;return this._ticket=a,i}async connectWorker(e){this.emit(RM.STATE_CHANGE,IM.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(BL.CONNECTED,async()=>{this.emit(RM.STATE_CHANGE,IM.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=CM.CONNECTED}),this._workerConnection.on(BL.CLOSED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(BL.FAILED,()=>{this.connectionState=CM.CLOSED}),this._workerConnection.on(BL.RECONNECTING,()=>{this.connectionState=this.connectionState===CM.CONNECTED?CM.RECONNECTING:CM.CONNECTING}),this._workerConnection.on(BL.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const t=LB(new Uint8Array(e.data));RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,aO.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{mO.reportApiInvoke(this._connectInfo.sid||null,{name:qR.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:YR.TRACER}).onError(new fO(RR.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},RA("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else aO.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(BL.WILL_RECONNECT,(e,t,s)=>{"recover"===e&&s(e),s("tryNext")}),this._workerConnection.on(BL.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=oI(this,RM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(e,t);this._workerConnection.sendMessage(s,!0,!0)}else RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&aO.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:s,cname:n,cid:r,vid:i,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await Qj(l,s,n),u=this._sequence+"-"+r+"-"+o+"-"+c+"-"+SI(12,""),h={appId:s,cid:r,cname:n,deviceId:"",elapse:pG.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this._sequence,sid:a,timestamp:uG(c),uid:o,vid:i,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=PB(h);if(p.byteLength<this._workerMessageLengthLimit){if(RA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?hG(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):hG(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:s,cname:n,cid:r,vid:i,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=LC.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=CM.CLOSED,this.emit(RM.STATE_CHANGE,IM.CLOSED)}}function mG(e){if(jR(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(RR.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new fO(RR.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fG={name:"ImageModeration",create:function(e){let{config:t}=e;return mG(t),new pG(t)}};var gG,yG,vG,xG,_G,EG,bG,wG,NG,SG,TG,CG,RG,IG,AG,OG,jG,kG,DG,PG,LG,MG,UG,VG,FG,BG,GG,WG,HG,KG,zG,qG,YG,XG,JG,QG,ZG,$G,eW,tW,sW,nW;function rW(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function iW(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?rW(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):rW(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}UI.setLogger(aO);let aW=(gG=pO(),yG=pO({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof uj))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),vG=pO({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==KO.DATA?(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())):[t.getChannelId()])}),xG=pO({argsMap:(e,t,s,n)=>["object"==typeof t?t.uid:t,s,n]}),_G=pO({argsMap:(e,t,s)=>[t,s]}),EG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:s}=e;return[null==t?void 0:t.uid,s]})}),bG=pO({argsMap:(e,t,s,n)=>["object"==typeof t?t.uid:t,s,n]}),wG=pO({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:s}=e;return{uid:null==t?void 0:t.uid,mediaType:s}})}),NG=pO(),SG=pO(),TG=pO(),CG=pO(),RG=pO(),IG=pO(),AG=pO(),OG=pO(),jG=pO(),kG=pO(),DG=pO(),PG=pO(),LG=pO(),MG=pO(),UG=pO(),VG=pO({argsMap:(e,t)=>[t]}),FG=pO(),BG=pO(),GG=pO(),WG=pO(),HG=pO(),KG=pO(),zG=pO(),qG=pO(),YG=pO({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),XG=pO(),JG=pO(),QG=pO(),ZG=pO(),$G=pO(),eW=pO(),tW=pO({reportResult:!0}),sW=pO(),nW=class extends HR{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let s;if(super(),uS(this,"store",void 0),uS(this,"_uid",void 0),uS(this,"_channelName",void 0),uS(this,"_uintUid",void 0),uS(this,"_users",[]),uS(this,"_config",void 0),uS(this,"_clientId",void 0),uS(this,"_appId",void 0),uS(this,"_sessionId",null),uS(this,"_key",void 0),uS(this,"_rtmConfig",{}),uS(this,"_joinInfo",void 0),uS(this,"_gateway",void 0),uS(this,"_statsCollector",void 0),uS(this,"_configDistribute",void 0),uS(this,"_leaveMutex",void 0),uS(this,"_publishMutex",void 0),uS(this,"_renewTokenMutex",void 0),uS(this,"_subscribeMutex",void 0),uS(this,"_encryptionMode","none"),uS(this,"_encryptionSecret",null),uS(this,"_encryptionSalt",null),uS(this,"_encryptDataStream",!1),uS(this,"_encryptDataStreamKey",null),uS(this,"_encryptDataStreamIv",null),uS(this,"_proxyServer",void 0),uS(this,"_turnServer",{servers:[],mode:"auto"}),uS(this,"_cloudProxyServerMode","disabled"),uS(this,"_isDualStreamEnabled",!1),uS(this,"_defaultStreamFallbackType",void 0),uS(this,"_lowStreamParameter",void 0),uS(this,"_streamFallbackTypeCacheMap",new Map),uS(this,"_remoteStreamTypeCacheMap",new Map),uS(this,"_axiosCancelSource",LC.CancelToken.source()),uS(this,"_audioVolumeIndicationInterval",void 0),uS(this,"_networkQualityInterval",void 0),uS(this,"_userOfflineTimeout",void 0),uS(this,"_streamRemovedTimeout",void 0),uS(this,"_liveTranscodeStreamingClient",void 0),uS(this,"_liveRawStreamingClient",void 0),uS(this,"_channelMediaRelayClient",void 0),uS(this,"_networkQualitySensitivity","normal"),uS(this,"_p2pChannel",void 0),uS(this,"_useLocalAccessPoint",!1),uS(this,"_setLocalAPVersion",void 0),uS(this,"_joinAndNotLeaveYet",!1),uS(this,"_numberOfJoinCount",0),uS(this,"_joinResponse",null),uS(this,"_remoteDefaultVideoStreamType",void 0),uS(this,"_inspect",void 0),uS(this,"_moderation",void 0),uS(this,"_license",void 0),uS(this,"_pendingPublishedUsers",[]),uS(this,"ntpAlignErrorCount",0),uS(this,"remoteInboundOffset",0),uS(this,"_peerConnectionState",void 0),uS(this,"_handleLocalTrackEnable",(e,t,s)=>{this.publish(e,!1).then(t).catch(s)}),uS(this,"_handleLocalTrackDisable",(e,t,s)=>{this.unpublish(e).then(t).catch(s)}),uS(this,"_handleUserOnline",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&KP(e.uid,this.channelName))return void aO.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&aO.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find(t=>t.uid===e.uid);if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(tI.USER_JOINED,t));else{const t=new ZV(e.uid,e.uint_id||e.uid);this._users.push(t),aO.debug("[".concat(this._clientId,"] user online"),e.uid),this.store.firstVideoFrameDecoded(t.uid,{userJoinNotify:Date.now()}),this.safeEmit(tI.USER_JOINED,t)}}),uS(this,"_handleUserOffline",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&KP(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:dI(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),aO.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(tI.USER_LEAVED,t,e.reason))}),uS(this,"_handleAddAudioOrVideoStream",(e,t,s,n,r,i,a,o)=>{if(RA("BLOCK_LOCAL_CLIENT")&&KP(t,this.channelName))return;const c=this._users.find(e=>e.uid===t);if(!c)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now()),"video"===e&&this.store.firstVideoFrameDecoded(c.uid,{videoAddNotify:Date.now()});const l="audio"===e?c.hasAudio:c.hasVideo;if(c._uintid||(c._uintid=i||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==s&&(c._audioSSRC=s),void 0!==n&&(c._cname=n),a&&(c._audioOrtc=a)):(c._video_added_=!0,void 0!==s&&(c._videoSSRC=s),void 0!==n&&(c._cname=n),void 0!==o&&(c._rtxSsrcId=o),a&&(c._videoOrtc=a)),("audio"===e?c.hasAudio:c.hasVideo)&&!l&&(aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(e)),this.safeEmit(tI.USER_PUBLISHED,c,e)),"video"===e?mO.onGatewayStream(this._sessionId,dO.ON_ADD_VIDEO_STREAM,uO.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:c._videoSSRC}):mO.onGatewayStream(this._sessionId,dO.ON_ADD_AUDIO_STREAM,uO.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:c._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(c,e,s).then(t=>{if(t&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tB))return this._p2pChannel.unsubscribe(c,e,!0).then(()=>this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(c,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})),"video"===e&&!$C()&&!nR()){const e=this._getEncodingName(r);(null==e?void 0:e.toLocaleLowerCase())==jA.av1&&OV().then(t=>{t||this._gateway.downgradeCodec(e)})}}),uS(this,"_handleRemoveStream",e=>{if(RA("BLOCK_LOCAL_CLIENT")&&KP(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);if(!t)return void aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));aO.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let s=()=>{};t.hasAudio&&t.hasVideo?s=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"audio"),aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"video")}:t.hasVideo?s=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(s=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tI.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof tB&&this._p2pChannel.unsubscribe(t).then(e=>{if(e)return this._gateway.unsubscribe(e,t.uid)}),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),mO.onGatewayStream(this._sessionId,dO.ON_REMOVE_STREAM,uO.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),s()}),uS(this,"_handleSetStreamLocalEnable",(e,t,s)=>{if(RA("BLOCK_LOCAL_CLIENT")&&KP(t,this.channelName))return;const n=this._users.find(e=>e.uid===t);if(!n)return void aO.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));aO.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(s?"enabled":"disabled"," with uid ").concat(t));const r="audio"===e?n.hasAudio:n.hasVideo;if("audio"===e){n._trust_audio_enabled_state_=!0;const e=n._audio_enabled_;if(n._audio_enabled_=s,n._audio_enabled_===e)return;{const e=n._audio_enabled_?"enable-local-audio":"disable-local-audio";aO.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tI.USER_INFO_UPDATED,t,e)}}else{n._trust_video_enabled_state_=!0;const e=n._video_enabled_;if(n._video_enabled_=s,n._video_enabled_===e)return;{const e=n._video_enabled_?"enable-local-video":"disable-local-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tI.USER_INFO_UPDATED,t,e)}}const i="audio"===e?n.hasAudio:n.hasVideo;return r!==i?!r&&i?(aO.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(tI.USER_PUBLISHED,n,e)):("video"===e&&n._videoTrack&&n._videoTrack._destroy(),"audio"===e&&n._audioTrack,this._p2pChannel.muteRemote(n,e),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(tI.USER_UNPUBLISHED,n,e)):void 0}),uS(this,"_handleMuteStream",(e,t,s)=>{if(RA("BLOCK_LOCAL_CLIENT")&&KP(e,this.channelName))return;aO.debug("[".concat(this._clientId,"] receive mute message"),e,t,s);const n=this._users.find(t=>t.uid===e);if(!n)return void aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const r="audio"===t?n.hasAudio:n.hasVideo;if("audio"===t){n._trust_audio_mute_state_=!0;const t=n._audio_muted_;if(n._audio_muted_=s,n._audio_muted_===t)return;{const t=n._audio_muted_?"mute-audio":"unmute-audio";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tI.USER_INFO_UPDATED,e,t)}}else{n._trust_video_mute_state_=!0;const t=n._video_muted_;if(n._video_muted_=s,n._video_muted_===t)return;{const t=n._video_muted_?"mute-video":"unmute-video";aO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tI.USER_INFO_UPDATED,e,t)}}const i="audio"===t?n.hasAudio:n.hasVideo;if(r!==i){if(!r&&i)return("audio"===t?n._audioSSRC:n._videoSSRC)?(aO.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(tI.USER_PUBLISHED,n,t)):void aO.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&n._videoTrack&&!n._video_pre_subscribed&&n._videoTrack._destroy(),"audio"===t&&n._audioTrack,this._p2pChannel.muteRemote(n,t),aO.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(tI.USER_UNPUBLISHED,n,t)}}),uS(this,"_handleP2PLost",async e=>{aO.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():aO.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)}),uS(this,"_handleTokenWillExpire",()=>{aO.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(tI.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),uS(this,"_handleBeforeUnload",e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),aO.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),uS(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(tI.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(tI.NETWORK_QUALITY,e)}),uS(this,"_handleP2PAddAudioOrVideoStream",(e,t,s,n)=>{const r=this._users.find(e=>e.uid===t);if(!r)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));aO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(r.uid,e,void 0,void 0,void 0,Date.now());const i="audio"===e?r.hasAudio:r.hasVideo;"audio"===e?r._trust_audio_stream_added_state_=!0:r._trust_video_stream_added_state_=!0,"audio"===e?(r._audio_added_=!0,void 0!==s&&(r._audioSSRC=s),void 0!==n&&(r._audioMid=n)):(r._video_added_=!0,void 0!==s&&(r._videoSSRC=s),void 0!==n&&(r._videoMid=n)),("audio"===e?r.hasAudio:r.hasVideo)&&!i&&(aO.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published ").concat(e)),this.safeEmit(tI.USER_PUBLISHED,r,e)),this._p2pChannel.hasPendingRemoteMedia(r,e)&&(aO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(r.uid," after reconnect.")),this._subscribe(r,e,!0).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._config=e,this._clientId=t||SI(5,"client-"),this.store=new class{constructor(e,t,s,n){SR(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:s,clientId:n,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:_A.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case OA.SET_SESSION_ID:return CR(CR({},e),{},{sessionId:t.sessionId});case OA.SET_P2P_ID:return CR(CR({},e),{},{p2pId:t.p2pId});case OA.SET_UID:return CR(CR({},e),{},{uid:t.uid});case OA.SET_INT_UID:return CR(CR({},e),{},{intUid:t.intUid});case OA.SET_PUB_ID:return CR(CR({},e),{},{pubId:t.pubId});case OA.KEY_METRIC_CLIENT_CREATED:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{clientCreated:t.metric})});case OA.KEY_METRIC_JOIN_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinStart:t.metric})});case OA.KEY_METRIC_PRELOAD_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{preloadStart:t.metric})});case OA.KEY_METRIC_PRELOAD_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{preloadEnd:t.metric})});case OA.KEY_METRIC_JOIN_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinEnd:t.metric})});case OA.KEY_METRIC_REQUEST_AP_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestAPStart:t.metric})});case OA.KEY_METRIC_REQUEST_AP_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestAPEnd:t.metric})});case OA.KEY_METRIC_REQUEST_SUA_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{requestSUAEnd:t.metric})});case OA.KEY_METRIC_BEFORE_CONNECT:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{beforeConnect:t.metric})});case OA.KEY_METRIC_PEER_RECEIVER:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerReceiver:t.metric})});case OA.KEY_METRIC_SIGNAL_CONNECTED:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{signalConnected:t.metric})});case OA.KEY_METRIC_JOIN_REQ:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinReq:t.metric})});case OA.KEY_METRIC_JOIN_REP:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinRep:t.metric})});case OA.KEY_METRIC_JOIN_GATEWAY_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case OA.KEY_METRIC_JOIN_GATEWAY_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case OA.KEY_METRIC_PEER_CONNECTION_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case OA.KEY_METRIC_PEER_CONNECTION_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case OA.KEY_METRIC_DESCRIPTION_START:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{descriptionStart:t.metric})});case OA.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case OA.KEY_METRIC_ICE_CONNECTION_END:return CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case OA.KEY_METRIC_PUBLISH:{const s=e.keyMetrics.publish,n=s.findIndex(e=>e.trackId===t.metric.trackId);return-1!==n?(s[n]=CR(CR({},s[n]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{publish:[...s]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case OA.KEY_METRIC_SUBSCRIBE:{const s=e.keyMetrics.subscribe,n=s.findIndex(e=>e.userId===t.metric.userId&&e.type===t.metric.type);return-1!==n?(s[n]=CR(CR({},s[n]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{subscribe:[...s]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case OA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const s=e.keyMetrics.firstVideoFrameDecoded,n=s.findIndex(e=>e.userId===t.metric.userId);return-1!==n?(s[n]=CR(CR({},s[n]),t.metric),CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{firstVideoFrameDecoded:[...s]})})):CR(CR({},e),{},{keyMetrics:CR(CR({},e.keyMetrics),{},{firstVideoFrameDecoded:[...e.keyMetrics.firstVideoFrameDecoded,t.metric]})})}case OA.RESET_FIRST_VIDEO_FRAME_DECODED:return e.keyMetrics.firstVideoFrameDecoded=[],e;case OA.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case OA.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=CR(CR({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case OA.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case OA.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},e;case OA.SET_USE_P2P:return CR(CR({},e),{},{useP2P:t.val});case OA.SET_TRANSPORT_TYPE:return CR(CR({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set autoSubscribe(e){this.state.autoSubscribe=e}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(e){this.state.enableInstantMuteRestore=e}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(e){this.dispatch({type:OA.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:OA.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:OA.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:OA.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:OA.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:OA.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:OA.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:OA.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:OA.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:OA.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:OA.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:OA.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:OA.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:OA.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:OA.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:OA.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:OA.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:OA.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:OA.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:OA.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:OA.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:OA.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:OA.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:OA.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:OA.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:OA.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(e,t){this.dispatch({type:OA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:CR({userId:e},t)})}descriptionStart(){this.dispatch({type:OA.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:OA.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:OA.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,s,n){this.dispatch({type:OA.KEY_METRIC_PUBLISH,metric:CR(CR({trackId:e,type:t},s&&{publishStart:s}),n&&{publishEnd:n})})}subscribe(e,t,s,n,r,i,a){this.dispatch({type:OA.KEY_METRIC_SUBSCRIBE,metric:CR(CR(CR(CR(CR({userId:e,type:t},s&&{subscribeStart:s}),n&&{subscribeEnd:n}),r&&{firstFrame:r}),i&&{streamAdded:i}),a&&{firstDecoded:a})})}massSubscribe(e,t,s,n){e.forEach(e=>{this.dispatch({type:OA.KEY_METRIC_SUBSCRIBE,metric:CR(CR(CR({userId:e.userId,type:e.type},t&&{subscribeStart:t}),s&&{subscribeEnd:s}),n&&{firstFrame:n})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map(e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof t?(this.dispatch({type:OA.RECORD_JOIN_CHANNEL_SERVICE,record:CR(CR({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:OA.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:OA.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:OA.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:OA.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new UI("client-leave",this._clientId),this._publishMutex=new UI("client-publish",this._clientId),this._renewTokenMutex=new UI("client-renewtoken",this._clientId),this._subscribeMutex=new UI("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),aO.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(vA," build: ").concat(NA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{eI(e.clientRoleOptions),s=Object.assign({},e.clientRoleOptions)}catch(e){aO.warning("[".concat(this._clientId,"] ").concat(e.toString()))}var n;this._statsCollector=new XV(this.store),this._statsCollector.onStatsException=(e,t,s)=>{aO.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(s)),e===KV.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(e=>{e instanceof PD&&RA("ENABLE_ENCODE_EXCEPTION")&&e.findClosestProfile()}),this.safeEmit(tI.EXCEPTION,{code:e,msg:t,uid:s})},this._statsCollector.onUploadPublishDuration=(e,t,s,n)=>{const r=this._users.find(t=>t.uid===e);r&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(r._uintid,{peerPublishDuration:s,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(r)),mO.peerPublishStatus(this._sessionId,{subscribeElapse:n,audioPublishDuration:t,videoPublishDuration:s,peer:r._uintid}))},this._statsCollector.onVideoCodecChanged=e=>{if(RA("VIDEO_STANDARD_BITRATE_VERSION")&&("av1"===e||"h265"===e||"h264"===e)){const t=this.localTracks.find(e=>e instanceof DD);t&&1!==t._saveEncodeBitrateRatio&&t.setSaveEncodeBitrateRatio("h264"===e?RA("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P="p2p"===e.mode,this._gateway=new sV(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||FI,httpRetryConfig:e.httpRetryConfig||FI,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._configDistribute=new WV(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(n={store:this.store,statsCollector:this._statsCollector},JU("P2PChannel").create(n)),this._handleP2PEvents()):this._p2pChannel=new tB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,s,n,r){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];CA("JOIN_GATEWAY_USE_443PORT_ONLY",i),CA("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const o=this._gateway.signal.websocket;return o instanceof XM&&(o.use443PortOnly=i,o.tryDoubleDomain=a),async function(e,t,s){VC.get(e)||VC.set(e,[]),FC.get(e)||FC.set(e,t),BC.get(e)||BC.set(e,0);const n=VC.get(e),r=FC.get(e);if(!n||!r)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(BC.get(e)===r){const e=UC();n.push(e),await e.promise}BC.set(e,BC.get(e)+1);for(var i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];const c=await s(...a);return BC.set(e,BC.get(e)-1),BC.get(e)===r-1&&n.length>0&&(n[0].resolve(),n.shift()),0===BC.get(e)&&(VC.set(e,[]),FC.set(e,0),BC.set(e,0)),c}("client.join",RA("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,s,n,r)}async join(e,t,s,n,r){const i=++this._numberOfJoinCount;this.store.joinStart(),n&&(this.store.uid=n);const a="HTTPS"===(WI||WI||(WI=(window.location.protocol.split(":")[0]||"").toUpperCase(),WI)),o=XI()?window.isSecureContext:"Browser Not Support";if(!XI()&&!a||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";aO.warning(e)}let c;mO.setAppId(e);try{if(!s&&null!==s)throw new fO(RR.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&DR(s,"token",1,2047),DR(e,"appid",1,2047),GL(t),n&&WL(n),r)if("string"==typeof r)DR(r,"optionalInfo",1,256),c=r;else{if("object"!=typeof r)throw new fO(RR.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:e,enableInstantMuteRestore:t}=r;e&&(AR(e,"autoSubscribe"),aO.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(e)),this.store.autoSubscribe=e),t&&(AR(t,"enableInstantMuteRestore"),aO.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(t)),this.store.enableInstantMuteRestore=t)}}}catch(r){throw mO.reportApiInvoke(TI(),{name:qR.JOIN,options:[e,t,s,n],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}).onError(r),r}if(this._leaveMutex.isLocked&&(aO.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),aO.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const r=new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw mO.reportApiInvoke(TI(),{name:qR.JOIN,options:[e,t,s,n],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}).onError(r),r}this._gateway.state="CONNECTING",this.store.preloadStart();const l=await CB({appId:e,cname:t,uid:n,stringUid:"string"==typeof n?n:void 0,token:s||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const d=(null==l?void 0:l.sid)||TI();aO.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(i)),this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId);const u=mO.reportApiInvoke(d,{id:this._clientId,name:qR.JOIN,options:[e,t,s,n],states:{isHttps:a,isSecureContext:o},tag:YR.TRACER}),h=iW(iW(iW({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof n?n:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!l},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:RA("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(h.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof n&&(h.stringUid=n,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(h.aesmode=this._encryptionMode,h.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let s=0;s<e.length;s+=1)t[s]=e.charCodeAt(s);return t}(),s=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),n=BR(e),r=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},s,n);return function(e){let t="";for(let s=0;s<e.length;s+=1)t+=String.fromCharCode(e[s]);return window.btoa(t)}(new Uint8Array(r))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(h.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=RA("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(h.appId+this._encryptionSecret+this._encryptionSecret):e.encode(h.appId+h.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,s){const n=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),r="aes-128-gcm2"===e?128:256,i=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:PA,hash:"SHA-256",salt:s},n,r+DA);return new Uint8Array(i).subarray(r/8)}(this._encryptionMode,t,yI(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,s){const n=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),r="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:PA,hash:"SHA-256",salt:s},n,{name:"AES-GCM",length:r},!0,["encrypt","decrypt"])}(this._encryptionMode,t,yI(this._encryptionSalt))}else o?aO.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):aO.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,aO.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:h.stringUid});const p=this._sessionId;setTimeout(()=>{"CONNECTING"===this.connectionState&&p===this._sessionId&&mO.joinChannelTimeout(this._sessionId,5)},5e3);try{var m;let n;const r=h.cloudProxyServer;if(Dn(m=["proxy3","proxy4","proxy5"]).call(m,r)){const e=RA("PROXY_SERVER_TYPE3");Array.isArray(e)?h.proxyServer=e[0]:h.proxyServer=e}if(mO.setProxyServer(h.proxyServer),aO.setProxyServer(h.proxyServer),this.store.requestAPStart(),l){if(aO.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(h.stringUid?", ".concat(h.stringUid," => ").concat(l.intUid):""," ")),h.stringUid&&!h.uid&&(h.uid=l.intUid),n={gatewayInfo:l.ap.gatewayInfo},RA("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===h.turnServer.mode)if(0===l.ap.proxyInfo.addresses.length)aO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await lU(l.ap.proxyInfo,l.ap.gatewayInfo.uid)).map(e=>({turnServerURL:e.address,tcpport:e.tcpport||EA.tcpport,udpport:e.udpport||EA.udpport,username:e.username||EA.username,password:e.password||EA.password,forceturn:!1,security:!0}));h.turnServer={mode:"manual",servers:e}}OB(l,h.stringUid)}else{if(h.stringUid&&!h.uid){let e;[e,n]=await sp.all([DV(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,this.store).finally(()=>{this.store.requestSUAEnd()}),kV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),aO.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(h.stringUid," => ").concat(e)),h.uid=e,n.gatewayInfo.uid=e,n.gatewayInfo.res.uid=e}else n=await kV(h,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,!0,this.store);if(!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(uM.UPDATE_BITRATE_LIMIT,e=>{this._p2pChannel.updateBitrateLimit(e)}),this._configDistribute.on(uM.UPDATE_CLIENT_ROLE_OPTIONS,e=>{this._setClientRoleOptions(e)})},0),this._key=s||e;const i=n.gatewayInfo,a=h.uid?h.uid:i.uid;this._joinInfo=iW(iW({},h),{},{cid:i.cid,uid:a,vid:i.vid,apResponse:i.res,apGatewayAddress:i.apGatewayAddress,uni_lbs_ip:i.uni_lbs_ip,gatewayAddrs:i.gatewayAddrs}),this.store.intUid=a,this.store.cid=i.cid;const o=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(o),this._appId=e,this._channelName=h.cname,this._uid=o,this.store.uid=o,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const c=h.stringUid?"string uid: ".concat(h.stringUid,",uid: ").concat(h.uid):"uid: ".concat(this._uid);return aO.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(c)),setTimeout(()=>{aO.startUpload()},5e3),this.store.joinEnd(),f=this,Dn(WP).call(WP,f)||WP.push(f),"disabled"===this._cloudProxyServerMode&&yO().supportWebCrypto&&RA("ENABLE_PRELOAD")&&IB(this._joinInfo),o}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===RR.OPERATION_ABORTED?aO.warning("[".concat(this._clientId,"] join number: ").concat(i,", Joining channel failed, rollback"),t):aO.error("[".concat(this._clientId,"] join number: ").concat(i,", Joining channel failed, rollback"),t),t.code!==RR.OPERATION_ABORTED&&this._numberOfJoinCount===i&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(t),t}var f}_joinGateway(){if(!this._joinInfo||!this._key)throw new fO(RR.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!RA("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){aO.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($C()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=WP.indexOf(e);-1!==t&&WP.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return aO.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,QR.LEAVE),aO.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof uj))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new fO(RR.INVALID_PARAMS,"param list is empty");const s=e;if("audience"===this._gateway.role)throw new fO(RR.INVALID_OPERATION,"audience can not publish stream");for(const r of s){if(!(r instanceof uj))throw new fO(RR.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&t)throw new fO(RR.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}aO.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(e=>"".concat(e.getTrackId()," "))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&s.forEach(e=>{const t=this._configDistribute.getBitrateLimit();e instanceof DD&&t&&e.setBitrateLimit(t.uplink)});try{await this._publishHighStream(s),aO.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(e=>"".concat(e.getTrackId()," "))))}catch(e){throw aO.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{n()}}async _publishDataChannel(e){if(null==e)throw new fO(RR.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));jR(e.id,"id",0,65535,!0),AR(e.ordered,"ordered"),DR(e.metadata,"metadata",0,512),aO.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex(t=>t.id===e.id))throw new fO(RR.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&RA("FORCE_TURN")&&!RA("TURN_ENABLE_TCP")&&!RA("TURN_ENABLE_UDP"))throw new fO(RR.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return QU(e,!1)}(e),s=await this._p2pChannel.publishDataChannel([t]);if(s.length>0){if("number"!=typeof t._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new fO(RR.CREATE_DATACHANNEL_ERROR);try{await sp.all(s.map(e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0))),await t._waitTillOpen()}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw e}}return aO.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw aO.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof uj))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);aO.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(e=>"".concat(e.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(AM.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),aO.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(e=>"".concat(e.getTrackId()))))}}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{s&&s()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),aO.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(e=>"".concat(e.id," "))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),aO.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(e=>"".concat(e.id))))}catch(e){throw aO.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,s){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,s):this._subscribe(e,t)}async presubscribe(e,t){if(OR(t,"mediaType",["audio","video"]),this.store.useP2P)throw new fO(RR.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=t===fM.AUDIO,n=t===fM.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:r,ortc:i,rtxSsrcId:a,cname:o,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==r)throw new fO(RR.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(t=>t.uid===e);l||(l=new ZV(e,c||e),l._is_pre_created=!0,this._users.push(l)),o&&(l._cname=o),l._uintid||(l._uintid=c||e),s&&(l._audioSSRC=r,l._audio_pre_subscribed=!0,i&&(l._audioOrtc=i)),n&&(l._videoSSRC=r,l._video_pre_subscribed=!0,i&&(l._videoOrtc=i),null!=a&&(l._rtxSsrcId=a)),aO.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(r)),await this._p2pChannel.subscribe(l,t,r,a,i);const d=s?l._audioTrack:l._videoTrack;if(!d)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),n&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),d}catch(t){throw aO.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{r()}}async _subscribeDataChannel(e,t){var s;if(jR(t,"channelId",0,65535,!0),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const n=this._users.find(t=>t===e);if(!n)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new fO(RR.INVALID_REMOTE_USER,"user is not published");const r=null===(s=e._dataChannels)||void 0===s?void 0:s.find(e=>e.id===t);if(!r)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);const i=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const s=await this._p2pChannel.subscribeDataChannel(e,[r]);if(s&&Dn(s).call(s,r.id))try{var a;if("number"!=typeof r._originDataChannelId)throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new fO(RR.CREATE_DATACHANNEL_ERROR);const t={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:null!==(a=r.metadata)&&void 0!==a?a:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await r._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==RR.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),t;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{i()}}async _p2pSubscribe(e,t,s){if(OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=this._users.find(t=>t===e);if(!n){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(RR.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!s&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const s=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const r=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const s="audio"===t?e._audioSSRC:e._videoSSRC,n="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,s,n)}catch(e){throw e}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const s="audio"===t?e._audioTrack:e._videoTrack;if(!s)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{r()}}async _subscribe(e,t,s){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=this._users.find(t=>t===e);if(!n){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new fO(RR.INVALID_REMOTE_USER,"user is not published");throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(s||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const s=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}let r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:r};"video"===t&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const c=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==n&&n!==r&&(r=n,i="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?fM.AUDIO:fM.VIDEO,ssrcId:r}),zV.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,a,i);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(e.uid,o,!0)}catch(s){if((null==s?void 0:s.code)!==RR.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),s;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(s){throw this._p2pChannel.reportSubscribeEvent(!1,null==s?void 0:s.code,e,t),s}aO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new fO(RR.UNEXPECTED_ERROR,"can not find remote track in user object");return"video"===t&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),n}catch(t){throw aO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(PR(e,"subscribeList"),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),s=new Map,n=await this._subscribeMutex.lock();aO.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(e=>{let{user:t,mediaType:s}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(s)}).join("; ")));const r=(e=[...e]).map(e=>{let{user:t,mediaType:s}=e;return{user:t,mediaType:s}}),i=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){const n=e[t],{user:i,mediaType:a}=n;if(OR(a,"mediaType",["audio","video"]),!i){const e=new fO(RR.INVALID_PARAMS,"user property does not exist in subscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const o=this._users.find(e=>e===i);if(!o){const s=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");aO.error("[".concat(this._clientId,"] can not massSubscribe ").concat(i.uid,", this user is not in the channel")),r[t].error=s,e.splice(t,1);continue}if("audio"===a&&(!i.hasAudio||void 0===i._audioSSRC)||"video"===a&&(!i.hasVideo||void 0===i._videoSSRC)){const s=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);aO.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(a,", remote user is not published")),r[t].error=s,e.splice(t,1);continue}const c=aM.Video|aM.LwoVideo,l=s.get(i);if(l){if("video"===a?l&c:l&aM.Audio){e.splice(t,1),aO.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(i.uid,", mediaType:").concat(a," twice"));continue}s.set(i,l|("video"===a?c:aM.Audio))}else s.set(i,"video"===a?c:aM.Audio)}for(let t=e.length-1;t>=0;t--){const n=e[t],{user:r,mediaType:i}=n,a=aM.Video|aM.LwoVideo;if(this._p2pChannel.hasRemoteMedia(r,i)){await this._p2pChannel.unmuteRemoteNoLock(r,i);const n=s.get(r);s.set(r,"video"===i?n^a:n^aM.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map(e=>({userId:e.user.uid,type:e.mediaType})),t);let n=rr(a=Array.from(s.entries())).call(a,(e,t)=>{let[s,n]=t;if(0===n)return e;const r={stream_id:s.uid,stream_type:n};return n&aM.Audio&&(r.audio_ssrc=s._audioSSRC),n&aM.Video&&(r.video_ssrc=s._videoSSRC),e.push(r),e},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(e=>{let{user:t,mediaType:s}=e;return{user:t,mediaType:s,ssrcId:s===fM.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:s===fM.VIDEO?t._rtxSsrcId:void 0}}));const s=new Map;if(n=n.filter(e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc),n.length>0){const e=await this._gateway.subscribeAll(n,!0);((null==e?void 0:e.users)||[]).forEach(e=>{let{stream_id:t,video_error_code:n,audio_error_code:r,error_code:i}=e;(n||r||i)&&s.set(t,{video_error_code:n,audio_error_code:r,error_code:i})})}if(Array.from(s.entries()).length>0){const e=[];Array.from(s.entries()).forEach(t=>{let[s,n]=t;const r=this.remoteUsers.find(e=>e.uid===s);if(r){let t;n.error_code||n.video_error_code&&n.audio_error_code?t=void 0:n.video_error_code?t=fM.VIDEO:n.audio_error_code&&(t=fM.AUDIO),e.push({user:r,mediaType:t})}}),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of r){const t=s.get(e.user.uid);if(t){const s=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(s){const t=MM(s);aO.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new fO(RR.SUBSCRIBE_FAILED,"code ".concat(s,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(r.filter(e=>!e.error).map(e=>({userId:e.user.uid,type:e.mediaType})),void 0,Date.now()),r.forEach(e=>{var s;mO.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(s=e.error)||void 0===s?void 0:s.code)||null,video:e.mediaType===fM.VIDEO,audio:e.mediaType===fM.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===fM.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)}),aO.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(e=>{let{user:t,mediaType:s}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(s)}).join("; "))),r}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{i(),n()}}async unsubscribe(e,t,s){if(!(e instanceof ZV)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,s)}else await this._unsubscribeDataChannel(e,s);if(t&&OR(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const n=this._users.find(t=>t===e);if(!n){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&dI(this._users,e),aO.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===RR.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&jR(t,"id",0,65535,!0),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const s=this._users.find(t=>t===e);if(!s){const t=new fO(RR.INVALID_REMOTE_USER,"user is not in the channel");throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let n;if("number"==typeof t){const s=e._dataChannels.find(e=>e.id===t);s&&(n=[s])}else n=e._dataChannels;if(void 0===n){const s=new fO(RR.REMOTE_USER_IS_NOT_PUBLISHED);throw aO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),s}aO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n.map(e=>e.id)));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,n);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),aO.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===RR.DISCONNECT_P2P)return void aO.warning("disconnecting p2p, abort unsubscribe request.");throw aO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(PR(e,"unsubscribeList"),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");aO.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(e=>{let{user:t,mediaType:s}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(s,";")}).join())),e=[...e];const t=new Map;for(let s=e.length-1;s>=0;s--){const{user:n,mediaType:r}=e[s];if(!n){const e=new fO(RR.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw aO.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}OR(r,"mediaType",["video","audio",void 0]);const i=this._users.find(e=>e===n);if(!i){aO.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),e.splice(s,1);continue}const a=aM.Video|aM.LwoVideo;if(t.has(n)){const i=t.get(n);let o;switch(r){case"video":o=i&a;break;case"audio":o=i&aM.Audio;break;default:o=i&(aM.Audio|a)}if(o){aO.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(r," twice.")),e.splice(s,1);continue}r?"audio"===r?t.set(n,i|aM.Audio):"video"===r&&t.set(n,i|a):t.set(n,i|aM.Audio|a)}else r?"audio"===r?t.set(n,aM.Audio):"video"===r&&t.set(n,a):t.set(n,aM.Audio|a)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),aO.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(e=>{let{user:t,mediaType:s}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(s,";")}).join()))}catch(e){if(e.code===RR.DISCONNECT_P2P)return void aO.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw aO.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new IR(RR.INVALID_PARAMS);LR(e.width)||kR(e.width,"streamParameter.width"),LR(e.height)||kR(e.height,"streamParameter.height"),LR(e.framerate)||kR(e.framerate,"streamParameter.framerate"),LR(e.bitrate)||jR(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&aO.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),aO.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,xM.LocalVideoLowTrack)}async enableDualStream(){if(!yO().supportDualStream)throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new fO(RR.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new fO(RR.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),aO.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(xM.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,mO.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),aO.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){OR(e,"role",["audience","host"])}(e),t&&eI(t),"rtc"===this.mode||"p2p"===this.mode)throw aO.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new fO(RR.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new fO(RR.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new fO(RR.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==s&&RA("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",sI.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),aO.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode)return;if("audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&eI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{aO.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const s=t.timestamp-Date.now();return Math.abs(s)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(DR(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,mO.setProxyServer(this._proxyServer),aO.setProxyServer(this._proxyServer),aO.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy")}if(ZR(e))return this._turnServer={servers:e,mode:"original-manual"},void aO.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(e=>e.urls).join(","),"."));e.forEach(e=>$R(e)),this._turnServer={servers:e,mode:"manual"},aO.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"you should set license before join channel");if(DR(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new fO(RR.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,aO.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new fO(RR.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let s;switch(void 0===e&&(e=3),e){case 1:case 2:throw new fO(RR.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new fO(RR.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"Stop proxy server after leave channel");mO.setProxyServer(),aO.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",aO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new fO(RR.INVALID_PARAMS,"accessPoints is required.");PR(e.accessPoints.serverList,"accessPoints.serverList"),DR(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{jR(e,t,0,65535,!0)};let s=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),s=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(RR.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");RA("CLOSE_AFB_FOR_LOCAL_AP")&&(CA("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),CA("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const n=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=e.accessPoints.domain,i=e.accessPoints.serverList.map(e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(r):e),a=i.map(e=>"".concat(e,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,CA("WEBCS_DOMAIN",a),CA("WEBCS_DOMAIN_BACKUP_LIST",a),CA("GATEWAY_DOMAINS",[r]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(PR(e.report.hostname,"report.hostname"),CA("EVENT_REPORT_DOMAIN",e.report.hostname[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(CA("EVENT_REPORT_DOMAIN",i[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",i[1]||i[0]));let o=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),o=e.report.port),CA("STATS_COLLECTOR_PORT",o),e.report?CA("ENABLE_EVENT_REPORT",!0):CA("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(PR(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=i[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),CA("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(PR(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=i;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),CA("CDS_AP",d.map(e=>"".concat(e,":").concat(u))),e.cds?CA("ENABLE_CONFIG_DISTRIBUTE",!0):CA("ENABLE_CONFIG_DISTRIBUTE",!1),aO.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(PR(e,"serverList"),DR(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new fO(RR.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(e=>s.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,CA("WEBCS_DOMAIN",e),CA("WEBCS_DOMAIN_BACKUP_LIST",e),CA("GATEWAY_DOMAINS",[t]),CA("EVENT_REPORT_DOMAIN",e[0]),CA("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),CA("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),aO.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(OR(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw aO.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else aO.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){OR(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const t=this._users.find(t=>t.uid===e);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(e){throw aO.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){OR(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}aO.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,s,n){!function(e){OR(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),DR(t,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(Dn(r).call(r,e)){if(!s||!(s instanceof Uint8Array&&32===s.length))throw new fO(RR.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new fO(RR.INVALID_PARAMS,"current encrypt mode does not need salt");if(n){if(AR(n,"encryptDataStream"),!Dn(r).call(r,e))throw new fO(RR.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||aO.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,s&&(this._encryptionSalt=vI(s))}async renewToken(e){if(DR(e,"token",1,2047),!this._key||!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const s=await this._renewTokenMutex.lock();try{if(RA("USE_NEW_TOKEN")){aO.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await FV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FI);aO.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else aO.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});aO.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,aO.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?aO.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(tI.VOLUME_INDICATOR,e)},RA("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new fO(RR.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new fO(RR.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new fO(RR.LIVE_STREAMING_TASK_CONFLICT);const s=t?HL.TRANSCODE:HL.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(e,s)}setLiveTranscoding(e){return this._createLiveStreamingClient(HL.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(e));if(!t.length)throw new fO(RR.INVALID_PARAMS,"can not find live streaming url to stop");await sp.all(t.map(t=>t&&t.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QV(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof tB&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let n=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(n=!0,e.payload=await async function(e,t,s){var n;const r=rr(n=Array.from(s)).call(n,(e,t)=>e+t,0),i={serverTs:0,seq:MA++,length:s.length,checkSum:r},a=new Uint8Array(jI(r,2)),o=new ArrayBuffer(LA),c=new DataView(o);c.setUint32(0,i.serverTs),c.setUint16(4,i.seq),c.setUint16(6,i.length),c.setUint16(8,i.checkSum);const l=16-s.length%16;s=_I(s,new Uint8Array(l));const d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:kA,additionalData:a},t,s);return _I(new Uint8Array(o),new Uint8Array(d))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new fO(RR.INVALID_PARAMS,n?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ML.DATA_STREAM,{payload:vI(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-iB},!s)}sendMetadata(e){if(!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new fO(RR.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ML.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vI(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(cO),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not send custom report, not joined");await mO.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(RA("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(e=>e.uid+"");Object.keys(e).forEach(s=>{Dn(t).call(t,s)||delete e[s]})}return e}async pickSVCLayer(e,t){OR(t.spatialLayer,"spatialLayer",[0,1,2,3]),OR(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw aO.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:s}=e;if(AR(t,"apRTM"),jR(s,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=s,aO.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(aO.debug("[".concat(this._clientId,"] reset client")),function(e){const t=HP.indexOf(e);-1!==t&&HP.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=LC.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&AB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&mO.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(e=>e._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new UI("client-publish",this._clientId),this._subscribeMutex=new UI("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var s;const n=e||TI();e?aO.debug("[".concat(this._clientId,"] new Session ").concat(n)):aO.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n));const r=e?"":this._sessionId||"";this._sessionId=n,this.store.sessionId=n,mO.addSid(n);const i={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(s=this._joinInfo)||void 0===s?void 0:s.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:"audience"===this.role?2:1};mO.sessionInit(this._sessionId,iW({cname:t.channel,appid:t.appId},i)),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&RA("FORCE_TURN")&&!RA("TURN_ENABLE_TCP")&&!RA("TURN_ENABLE_UDP"))throw new fO(RR.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");aO.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const t=(await s.next()).value;if(t){try{await this._gateway.sendExtensionMessage(AM.PUBLISH,t,!0)}catch(e){throw s.throw(e),e}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const n=(await s.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw s.throw(e),e}await s.next((null===(t=r)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof DD&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch(e=>{aO.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===RR.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new fO(RR.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));aO.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await e.next()).value;if(s){var t;let n;try{n=await this._gateway.publish(this._uid,s,!0)}catch(t){if(t.code!==RR.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=n)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===RR.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new fO(RR.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},JU("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qR.ON_LIVE_STREAM_ERROR,options:[e,t],tag:YR.TRACER}).onSuccess(),this.safeEmit(tI.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{mO.reportApiInvoke(this._sessionId,{name:qR.ON_LIVE_STREAM_WARNING,options:[e,t],tag:YR.TRACER}).onSuccess(),this.safeEmit(tI.LIVE_STREAMING_WARNING,e,t)},e.on(JL.REQUEST_WORKER_MANAGER_LIST,(e,t,s)=>{if(!this._joinInfo)return s(new fO(RR.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,s,n){const r=RA("UAP_AP").slice(0,RA("AJAX_REQUEST_CONCURRENT")).map(e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"));return await vV(r,e,t,s,n)})(e,this._joinInfo,this._axiosCancelSource.token,FI).then(t).catch(s)}),e};return e===HL.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new fO(RR.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:s}=this.getLocalVideoStats(),n=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:s}},JU("ChannelMediaRelay").create(e));n.on("state",e=>{e===tM.RELAY_STATE_FAILURE&&n&&n.dispose(),this.safeEmit(tI.CHANNEL_MEDIA_RELAY_STATE,e)}),n.on("event",e=>{this.safeEmit(tI.CHANNEL_MEDIA_RELAY_EVENT,e)}),this._channelMediaRelayClient=n,this._statsCollector.onStatsChanged=(e,t)=>{var s;"resolution"===e&&(null===(s=this._channelMediaRelayClient)||void 0===s||s.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:s,deleted:n}=e,r=[];if(t){const e=[];this._users.forEach(t=>{t._dataChannels.forEach(n=>{s.every(e=>e.uid!==t._uintid||e.stream_id!==n.id)&&e.push({uid:t._uintid,stream_id:n.id,ordered:n.ordered,max_retrans_times:n.maxRetransmits,metadata:n.metadata})})}),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(s)&&s.length>0&&s.forEach(e=>{const{uid:s,stream_id:n,ordered:i,max_retrans_times:a,metadata:o}=e,c=this._users.find(e=>e._uintid===s);if(c){if(aO.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s)),Dn(r).call(r,c)||r.push(c),c._uintid||(c._uintid=s),-1===c._dataChannels.findIndex(t=>t.id===e.stream_id)){const e={id:n,ordered:!!i,maxRetransmits:a,metadata:o},s=function(e){return QU(e,!0)}(e);c._dataChannels.push(s),aO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(tI.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(aO.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch(e=>{aO.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())}))}else aO.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),t&&(this.safeEmit(tI.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n)&&n.length>0&&n.forEach(e=>{const{uid:t,stream_id:s}=e,n=this._users.find(e=>e._uintid===t);if(!n)return void aO.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const r=n._dataChannels.find(t=>t.id===e.stream_id);r&&(aO.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(n,[r]).then(e=>{if(n._dataChannels=n._dataChannels.filter(e=>e!==r),e)return this._gateway.unsubscribeDataChannel(e,n.uid)}),aO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(r.id)),this.safeEmit(tI.USER_UNPUBLISHED,n,"datachannel",r._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const s=null===(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)||void 0===t?void 0:t.videoCodecs;if(s)for(const r of s){var n;if(r.payloadType===e)return null==r||null===(n=r.rtpMap)||void 0===n?void 0:n.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(t=>t.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){aO.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const s=()=>{aO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(e=>{this.safeEmit(tI.USER_UNPUBLISHED,t,"datachannel",e._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)}),s()}}else aO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(rM.UPDATE_GATEWAY_CONFIG,()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),s=Date.now();Object.keys(t).forEach(e=>{const{value:n,type:r,expires:i}=t[e];i&&i<=s||r||zP()||!Object.prototype.hasOwnProperty.call(bA,e)||(AA[e]=n,TA[e]=n,aO.debug("Update gateway parameters from config distribute",e,n))})}catch(e){aO.error("Error update config from local cache",e.message)}}()}),this._gateway.on(rM.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(rM.CONNECTION_STATE_CHANGE,(e,t,s)=>{var n;if(s===QR.FALLBACK)return;const r=()=>{this.safeEmit(tI.CONNECTION_STATE_CHANGE,e,t,s)};if(mO.reportApiInvoke(this._sessionId||(null===(n=this._gateway.joinInfo)||void 0===n?void 0:n.sid)||null,{name:qR.CONNECTION_STATE_CHANGE,options:[e,t,s],tag:YR.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:s})),aO.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void r();if("RECONNECTING"===e)this._users.forEach(e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var i;this._streamFallbackTypeCacheMap.forEach((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)})}),this._remoteStreamTypeCacheMap.forEach((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>{aO.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(i=this._joinInfo)||void 0===i?void 0:i.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{aO.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(e=>{aO.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(e=>!e._trust_in_room_).forEach(e=>{aO.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(e=>{e._trust_audio_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.AUDIO,!1)),e._trust_video_mute_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,fM.VIDEO,!1)),e._trust_audio_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(aO.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(aO.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3))}r()}),this._gateway.on(rM.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new fO(RR.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const s=await CB(iW(iW({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));s?(t=s.ap,OB(s),this._joinInfo.preload=!0):(t=await jV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||FI,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const n=[];t.gatewayInfo.gatewayAddrs.forEach(e=>{let{address:t}=e;const[s,r]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?n.push({proxy:this._joinInfo.proxyServer,host:s,port:r}):n.push({host:s,port:r})}),e(n)}catch(e){t(e)}}),this._gateway.on(rM.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(tI.NETWORK_QUALITY,e)}),this._gateway.on(rM.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(tI.STREAM_TYPE_CHANGED,e,t),mO.reportApiInvoke(this._sessionId,{name:qR.STREAM_TYPE_CHANGE,options:[e,t],tag:YR.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(rM.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(rM.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,s)=>{try{let s=await this._p2pChannel.getEstablishParams();s&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(s=await this._p2pChannel.startP2PConnection(e)),t(s)}catch(e){s(e)}}),this._gateway.on(rM.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let s;this._joinResponse=e,e.attributes?s=e.attributes.userAttributes.preSubSsrcs:aO.debug("no attributes in joinResponse");const n=NU(e.ortc,t,s);this._p2pChannel.connect(n)}),this._gateway.on(rM.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:s,turnServer:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:i,cid:a}=this._joinInfo.apResponse,o="".concat(a,"_").concat(i);if(o.length<4||o.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var r;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(i),icePwd:"".concat(a,"_").concat(i)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(r=RA("FINGERPRINT"))&&void 0!==r?r:s}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(e){e.code&&e.code===RR.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(VL.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(VL.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(VL.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(VL.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(VL.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(VL.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(VL.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(VL.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(VL.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!0)),this._gateway.signal.on(VL.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,fM.AUDIO,!1)),this._gateway.signal.on(VL.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!0)),this._gateway.signal.on(VL.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,fM.VIDEO,!1)),this._gateway.signal.on(VL.RECEIVE_METADATA,e=>{const t=yI(e.metadata);this.safeEmit(tI.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(VL.ON_DATA_STREAM,async e=>{var t;if(!e)return;let s=yI(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<LA)throw new fO(RR.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(LA));const t=await async function(e,t,s){const n=s.subarray(0,LA),r=n.slice(8,LA),i=(r[0]<<8)+r[1],a=(n[6]<<8)+n[7],o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:kA,additionalData:new Uint8Array(jI(i,2))},t,s.subarray(LA));return new Uint8Array(o).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s);s=t}let n=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),s=this.remoteUsers.find(t=>t.uid===e.uid),r=null==t?void 0:t.audioRecv.find(e=>e.ssrc===(null==s?void 0:s._audioSSRC));n=null==r?void 0:r.jitterBufferMs}(null==n||Number.isNaN(n))&&(n=0),uB(iW(iW({},e),{},{payload:s}),n,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(VL.ON_CRYPT_ERROR,()=>{gI(()=>{aO.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(tI.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(VL.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(VL.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{aO.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,QR.TOKEN_EXPIRE),this.safeEmit(tI.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(VL.ON_STREAM_FALLBACK_UPDATE,e=>{aO.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(tI.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(VL.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),aO.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(VL.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(VL.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(LL.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ML.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var s,n;const r=e.some(e=>{let{stream_type:t}=e;return t===nM.Audio}),i=e.some(e=>{let{stream_type:t}=e;return t!==nM.Audio}),a=e.some(e=>{let{stream_type:t}=e;return t===nM.Screen||t===nM.ScreenLow});"offer"===t.state&&mO.publish(this._joinInfo.sid,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:RR.TIMEOUT,audio:r,video:i,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:r?null===(s=e.find(e=>{let{stream_type:t}=e;return t===nM.Audio}))||void 0===s||null===(s=s.ssrcs[0])||void 0===s?void 0:s.ssrcId.toString():void 0,videoName:i?null===(n=e.find(e=>{let{stream_type:t}=e;return t!==nM.Audio}))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0})}break}case ML.SUBSCRIBE:t&&mO.subscribe(this._joinInfo.sid,{succ:!1,ec:RR.TIMEOUT,audio:t.stream_type===fM.AUDIO,video:t.stream_type===fM.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(VL.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(VL.ON_PUBLISHED_USER_LIST,e=>{if(null==e||!e.users)return;RA("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(e=>!KP(e.string_id||e.stream_id,this.channelName)));const t=[],s=[];for(const n of e.users){let e=this._users.find(e=>e._uintid===n.stream_id);e?e._trust_in_room_=!0:(e=new ZV(n.string_id||n.stream_id,n.stream_id),this._users.push(e),this.store.firstVideoFrameDecoded(e.uid,{userJoinNotify:Date.now()}),0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.debug("[".concat(this._clientId,"] user online"),n.stream_id),this.safeEmit(tI.USER_JOINED,e)));const r=aM.Audio&n.stream_type,i=(aM.Video|aM.LwoVideo)&n.stream_type,a=0!=(65280&n.stream_type),o=r&&e.hasAudio,c=i&&e.hasVideo;i&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=n.video_ssrc,e._rtxSsrcId=n.video_rtx),r&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=n.audio_ssrc),r&&!o&&0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(tI.USER_PUBLISHED,e,"audio")),i&&!c&&0===this.getListeners(tI.PUBLISHED_USER_LIST).length&&(aO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(tI.USER_PUBLISHED,e,"video")),(r&&!o||i&&!c||a)&&t.push(e),i&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&s.push({user:e,mediaType:"video"}),r&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&s.push({user:e,mediaType:"audio"})}s.length>0&&(aO.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(e=>{aO.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())})),this.getListeners(tI.PUBLISHED_USER_LIST).length>0?RA("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(aO.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(e=>e.uid).join(", "))),this.safeEmit(tI.PUBLISHED_USER_LIST,t)):aO.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(e=>e.uid).join(", ")))}),this._gateway.signal.on(VL.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof tB&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(e=>e.toLowerCase()).filter(e=>{var t;return Dn(t=Object.keys(jA)).call(t,e)}))})}_handleP2PEvents(){this._gateway.signal.on(VL.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(AM.PUBLISH,(e,t,s)=>{const{uid:n}=e;e.forEach(e=>{const{kind:r,ssrcs:i,mid:a,isMuted:o}=e;this._handleP2PAddAudioOrVideoStream(r,n,i[0].ssrcId,a);const c=this._users.find(e=>e.uid===n);return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,r,i[0].ssrcId,a).then(()=>{t()}).catch(s):t(),this._handleMuteStream(n,r,!!o)})}),this._gateway.signal.on(AM.CALL,async(e,t,s)=>{if(this.store.useP2P)try{var n;t(await this._p2pChannel.startP2P({turnServer:null===(n=this._joinInfo)||void 0===n?void 0:n.turnServer},e))}catch(e){s(e)}}),this._gateway.signal.on(LL.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(AM.UNPUBLISH,async(e,t,s)=>{if(this.store.useP2P){const{unpubMsg:n,uid:r}=e,i=this._users.find(e=>e.uid===r);if(!i)return aO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void t();try{n.forEach(async e=>{let{stream_type:t}=e;const s=t===nM.Audio?fM.AUDIO:fM.VIDEO;await this._p2pChannel.unsubscribe(i,s),this._handleMuteStream(r,s,!0)}),t()}catch(e){s(e)}}}),this._gateway.signal.on(AM.CONTROL,async(e,t)=>{const{action:s}=e;switch(s){case jM.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,fM.VIDEO,!0);break;case jM.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,fM.AUDIO,!0);break;case jM.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,fM.VIDEO,!1);break;case jM.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,fM.AUDIO,!1)}}),this._gateway.signal.on(AM.RESTART_ICE,async(e,t,s)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:n}=e;s!==FL.SEND_ONLY||n?t(await this._p2pChannel.restartICE(s,n)):(this._p2pChannel.handleDisconnect(s),t())}catch(e){s(e)}}),this._gateway.signal.on(AM.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:s}=e;this._p2pChannel.addRemoteCandidate(t,s)}}),this._p2pChannel.on(EM.RequestP2PRestartICE,async(e,t,s)=>{try{const{direction:s}=e;t(await this._gateway.sendExtensionMessage(AM.RESTART_ICE,e,s===FL.SEND_ONLY))}catch(e){s(e)}}),this._p2pChannel.on(EM.LocalCandidate,e=>{this._gateway.sendExtensionMessage(AM.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(EM.RequestP2PMuteLocal,async(e,t,s)=>{try{await this._gateway.sendExtensionMessage(AM.CONTROL,e,!0),t()}catch(e){s(e)}}),this._p2pChannel.on(EM.RequestP2PUnmuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():s(e)}else t()}),this._p2pChannel.on(EM.RequestP2PMuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():s(e)}else t()}),this._p2pChannel.on(EM.StateChange,(e,t)=>{t===_M.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(EM.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(tI.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(EM.RequestMuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():s(e)}else t()}),this._p2pChannel.on(EM.RequestUnmuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===RR.DISCONNECT_P2P?t():s(e)}else t()}),this._p2pChannel.on(EM.RequestRePublish,(e,t,s)=>{this.publish(e,!1).then(t).catch(s)}),this._p2pChannel.on(EM.RequestRePublishDataChannel,(e,t,s)=>{sp.all(e.map(async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach(e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)})}catch(e){if(e.code!==RR.DISCONNECT_P2P)throw e}})).then(t).catch(s)}),this._p2pChannel.on(EM.RequestReSubscribe,async(e,t,s)=>{try{for(const{user:t,kind:s}of e)s===fM.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){s(e)}}),this._p2pChannel.on(EM.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(EM.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(EM.MediaReconnectStart,e=>{this.safeEmit(tI.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(EM.MediaReconnectEnd,e=>{this.safeEmit(tI.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(EM.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(EM.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),s=await t.next();if(s.done)return;const n=s.value;let r;try{r=await this._gateway.restartICE({iceParameters:n})}catch(e){return void t.throw(e)}const{iceParameters:i}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(r);await t.next({remoteIceParameters:i})}),this._p2pChannel.on(EM.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(EM.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:s,rtpCapabilities:n}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:r,gatewayAddress:i}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:s,rtpCapabilities:n}),a=NU(r,i);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(EM.RequestUnpublishForReconnectPC,async(e,t,s)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):s()}),this._p2pChannel.on(EM.P2PLost,()=>{this.safeEmit(tI.P2P_LOST,this.store.uid)}),this._p2pChannel.on(EM.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(EM.ConnectionTypeChange,e=>{this.safeEmit(tI.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(EM.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(EM.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(EM.AudioMetadata,e=>{this.safeEmit(tI.AUDIO_METADATA,e)}),this._p2pChannel.on(EM.AudioPts,e=>{this.safeEmit(tI.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(t={config:e},JU("ContentInspect").create(t));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:n,cname:r,sid:i,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await s.init({appId:n,areaCode:"",cname:r,sid:i,token:a,uid:o,cid:c,vid:l?Number(l):0},FI)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(NM.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(tI.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,s),s===bM.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(tI.CONTENT_INSPECT_ERROR,new fO(RR.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(NM.INSPECT_RESULT,(e,t)=>{var s;if((null==t?void 0:t.code)===RR.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return aO.debug("Stop inspect content because that has left channel"),null==this||null===(s=this._inspect)||void 0===s||s.close(),void(this._inspect=void 0);this.safeEmit(tI.CONTENT_INSPECT_RESULT,e,t)}),e.on(NM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}async disableContentInspect(){if(!this._inspect)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(AR(e,"enabled"),e){if(!t)throw new fO(RR.INVALID_PARAMS,"config is required");if(mG(t),!this._joinInfo)throw new fO(RR.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(s={config:t},JU("ImageModeration").create(s));this._moderation=e,this.handleImageModerationEvents(e);const{appId:n,cname:r,sid:i,token:a,uid:o,cid:c,vid:l}=this._joinInfo;await e.init({appId:n,areaCode:"",cname:r,sid:i,token:a,uid:o,cid:c,vid:l?Number(l):0},FI)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var s;if(!this._moderation)throw new fO(RR.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(RM.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(tI.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,s),t===CM.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new fO(RR.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(RM.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}setP2PTransport(e){if(function(e){OR(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new fO(RR.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,aO.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return aO.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){AR(e,"enabled"),CA("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},IL(nW.prototype,"leave",[gG],Object.getOwnPropertyDescriptor(nW.prototype,"leave"),nW.prototype),IL(nW.prototype,"publish",[yG],Object.getOwnPropertyDescriptor(nW.prototype,"publish"),nW.prototype),IL(nW.prototype,"unpublish",[vG],Object.getOwnPropertyDescriptor(nW.prototype,"unpublish"),nW.prototype),IL(nW.prototype,"subscribe",[xG],Object.getOwnPropertyDescriptor(nW.prototype,"subscribe"),nW.prototype),IL(nW.prototype,"presubscribe",[_G],Object.getOwnPropertyDescriptor(nW.prototype,"presubscribe"),nW.prototype),IL(nW.prototype,"massSubscribe",[EG],Object.getOwnPropertyDescriptor(nW.prototype,"massSubscribe"),nW.prototype),IL(nW.prototype,"unsubscribe",[bG],Object.getOwnPropertyDescriptor(nW.prototype,"unsubscribe"),nW.prototype),IL(nW.prototype,"massUnsubscribe",[wG],Object.getOwnPropertyDescriptor(nW.prototype,"massUnsubscribe"),nW.prototype),IL(nW.prototype,"setLowStreamParameter",[NG],Object.getOwnPropertyDescriptor(nW.prototype,"setLowStreamParameter"),nW.prototype),IL(nW.prototype,"enableDualStream",[SG],Object.getOwnPropertyDescriptor(nW.prototype,"enableDualStream"),nW.prototype),IL(nW.prototype,"disableDualStream",[TG],Object.getOwnPropertyDescriptor(nW.prototype,"disableDualStream"),nW.prototype),IL(nW.prototype,"setClientRole",[CG],Object.getOwnPropertyDescriptor(nW.prototype,"setClientRole"),nW.prototype),IL(nW.prototype,"_setClientRoleOptions",[RG],Object.getOwnPropertyDescriptor(nW.prototype,"_setClientRoleOptions"),nW.prototype),IL(nW.prototype,"setProxyServer",[IG],Object.getOwnPropertyDescriptor(nW.prototype,"setProxyServer"),nW.prototype),IL(nW.prototype,"setTurnServer",[AG],Object.getOwnPropertyDescriptor(nW.prototype,"setTurnServer"),nW.prototype),IL(nW.prototype,"setLicense",[OG],Object.getOwnPropertyDescriptor(nW.prototype,"setLicense"),nW.prototype),IL(nW.prototype,"startProxyServer",[jG],Object.getOwnPropertyDescriptor(nW.prototype,"startProxyServer"),nW.prototype),IL(nW.prototype,"stopProxyServer",[kG],Object.getOwnPropertyDescriptor(nW.prototype,"stopProxyServer"),nW.prototype),IL(nW.prototype,"setLocalAccessPointsV2",[DG],Object.getOwnPropertyDescriptor(nW.prototype,"setLocalAccessPointsV2"),nW.prototype),IL(nW.prototype,"setLocalAccessPoints",[PG],Object.getOwnPropertyDescriptor(nW.prototype,"setLocalAccessPoints"),nW.prototype),IL(nW.prototype,"setRemoteDefaultVideoStreamType",[LG],Object.getOwnPropertyDescriptor(nW.prototype,"setRemoteDefaultVideoStreamType"),nW.prototype),IL(nW.prototype,"setRemoteVideoStreamType",[MG],Object.getOwnPropertyDescriptor(nW.prototype,"setRemoteVideoStreamType"),nW.prototype),IL(nW.prototype,"setStreamFallbackOption",[UG],Object.getOwnPropertyDescriptor(nW.prototype,"setStreamFallbackOption"),nW.prototype),IL(nW.prototype,"setEncryptionConfig",[VG],Object.getOwnPropertyDescriptor(nW.prototype,"setEncryptionConfig"),nW.prototype),IL(nW.prototype,"renewToken",[FG],Object.getOwnPropertyDescriptor(nW.prototype,"renewToken"),nW.prototype),IL(nW.prototype,"enableAudioVolumeIndicator",[BG],Object.getOwnPropertyDescriptor(nW.prototype,"enableAudioVolumeIndicator"),nW.prototype),IL(nW.prototype,"startLiveStreaming",[GG],Object.getOwnPropertyDescriptor(nW.prototype,"startLiveStreaming"),nW.prototype),IL(nW.prototype,"setLiveTranscoding",[WG],Object.getOwnPropertyDescriptor(nW.prototype,"setLiveTranscoding"),nW.prototype),IL(nW.prototype,"stopLiveStreaming",[HG],Object.getOwnPropertyDescriptor(nW.prototype,"stopLiveStreaming"),nW.prototype),IL(nW.prototype,"startChannelMediaRelay",[KG],Object.getOwnPropertyDescriptor(nW.prototype,"startChannelMediaRelay"),nW.prototype),IL(nW.prototype,"updateChannelMediaRelay",[zG],Object.getOwnPropertyDescriptor(nW.prototype,"updateChannelMediaRelay"),nW.prototype),IL(nW.prototype,"stopChannelMediaRelay",[qG],Object.getOwnPropertyDescriptor(nW.prototype,"stopChannelMediaRelay"),nW.prototype),IL(nW.prototype,"sendCustomReportMessage",[YG],Object.getOwnPropertyDescriptor(nW.prototype,"sendCustomReportMessage"),nW.prototype),IL(nW.prototype,"pickSVCLayer",[XG],Object.getOwnPropertyDescriptor(nW.prototype,"pickSVCLayer"),nW.prototype),IL(nW.prototype,"setRTMConfig",[JG],Object.getOwnPropertyDescriptor(nW.prototype,"setRTMConfig"),nW.prototype),IL(nW.prototype,"enableContentInspect",[QG],Object.getOwnPropertyDescriptor(nW.prototype,"enableContentInspect"),nW.prototype),IL(nW.prototype,"disableContentInspect",[ZG],Object.getOwnPropertyDescriptor(nW.prototype,"disableContentInspect"),nW.prototype),IL(nW.prototype,"setImageModeration",[$G],Object.getOwnPropertyDescriptor(nW.prototype,"setImageModeration"),nW.prototype),IL(nW.prototype,"setP2PTransport",[eW],Object.getOwnPropertyDescriptor(nW.prototype,"setP2PTransport"),nW.prototype),IL(nW.prototype,"getJoinChannelServiceRecords",[tW],Object.getOwnPropertyDescriptor(nW.prototype,"getJoinChannelServiceRecords"),nW.prototype),IL(nW.prototype,"setPublishAudioFilterEnabled",[sW],Object.getOwnPropertyDescriptor(nW.prototype,"setPublishAudioFilterEnabled"),nW.prototype),nW);class oW{constructor(e,t){uS(this,"id",0),uS(this,"element",void 0),uS(this,"peerPair",void 0),uS(this,"context",void 0),uS(this,"audioPlayerElement",void 0),uS(this,"audioTrack",void 0),oW.count+=1,this.id=oW.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const s="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(s),"complete"===e.iceGatheringState?e.localDescription:new sp(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})},t=async(e,t)=>await e.setRemoteDescription(t);try{const s=await e(this.peerPair[0],"offer");await t(this.peerPair[1],s);const n=await e(this.peerPair[1],"answer");await t(this.peerPair[0],n)}catch(e){throw new fO(RR.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new fO(RR.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new fO(RR.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=t.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){aO.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var cW,lW;uS(oW,"count",0);const dW=window.AudioContext||window.webkitAudioContext,uW=new(cW=pO({report:mO}),IL((lW=class{constructor(){uS(this,"units",[]),uS(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return aO.debug("the system does not need to process local aec"),-1;this.context||(this.context=new dW);let t=this.units.find(t=>t&&t.getElement()===e);return t||(t=new oW(e,this.context),this.units.push(t)),t.startEchoCancellation(),aO.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qC().name!==WC.SAFARI}}).prototype,"processExternalMediaAEC",[cW],Object.getOwnPropertyDescriptor(lW.prototype,"processExternalMediaAEC"),lW.prototype),lW);function hW(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function pW(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?hW(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):hW(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const mW=window||document;function fW(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!mW)return;const s=PY._cspEventHandlerPointer;if(s&&t)return void console.error(s,t);const n=e=>{if(!(e&&e.blockedURI&&(PY.onSecurityPolicyViolation||PY.getListeners(TM.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;RA("CSP_DETECTED_HOSTNAME_LIST").some(e=>Dn(t).call(t,e))&&(PY.onSecurityPolicyViolation&&"function"==typeof PY.onSecurityPolicyViolation&&PY.onSecurityPolicyViolation(e),PY.getListeners(TM.SECURITY_POLICY_VIOLATION).length>0&&PY.safeEmit(TM.SECURITY_POLICY_VIOLATION,e))};s&&mW.removeEventListener("securitypolicyviolation",s),(t||e&&"function"==typeof e||PY.getListeners(TM.SECURITY_POLICY_VIOLATION).length>0)&&mW.addEventListener("securitypolicyviolation",n),PY._cspEventHandlerPointer=n}var gW=u,yW=RS,vW=RegExp.prototype,xW=function(e){return e===vW||gW(vW,e)?yW(e):e.flags},_W=n(xW);function EW(e){let t=e.length;for(;--t>=0;)e[t]=0}const bW=256,wW=286,NW=30,SW=15,TW=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),CW=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),RW=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),IW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AW=new Array(576);EW(AW);const OW=new Array(60);EW(OW);const jW=new Array(512);EW(jW);const kW=new Array(256);EW(kW);const DW=new Array(29);EW(DW);const PW=new Array(NW);function LW(e,t,s,n,r){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=n,this.max_length=r,this.has_stree=e&&e.length}let MW,UW,VW;function FW(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}EW(PW);const BW=e=>e<256?jW[e]:jW[256+(e>>>7)],GW=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},WW=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,GW(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},HW=(e,t,s)=>{WW(e,s[2*t],s[2*t+1])},KW=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},zW=(e,t,s)=>{const n=new Array(16);let r,i,a=0;for(r=1;r<=SW;r++)a=a+s[r-1]<<1,n[r]=a;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=KW(n[t]++,t))}},qW=e=>{let t;for(t=0;t<wW;t++)e.dyn_ltree[2*t]=0;for(t=0;t<NW;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},YW=e=>{e.bi_valid>8?GW(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},XW=(e,t,s,n)=>{const r=2*t,i=2*s;return e[r]<e[i]||e[r]===e[i]&&n[t]<=n[s]},JW=(e,t,s)=>{const n=e.heap[s];let r=s<<1;for(;r<=e.heap_len&&(r<e.heap_len&&XW(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!XW(t,n,e.heap[r],e.depth));)e.heap[s]=e.heap[r],s=r,r<<=1;e.heap[s]=n},QW=(e,t,s)=>{let n,r,i,a,o=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+o++],n+=(255&e.pending_buf[e.sym_buf+o++])<<8,r=e.pending_buf[e.sym_buf+o++],0===n?HW(e,r,t):(i=kW[r],HW(e,i+bW+1,t),a=TW[i],0!==a&&(r-=DW[i],WW(e,r,a)),n--,i=BW(n),HW(e,i,s),a=CW[i],0!==a&&(n-=PW[i],WW(e,n,a)))}while(o<e.sym_next);HW(e,256,t)},ZW=(e,t)=>{const s=t.dyn_tree,n=t.stat_desc.static_tree,r=t.stat_desc.has_stree,i=t.stat_desc.elems;let a,o,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<i;a++)0!==s[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):s[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,s[2*c]=1,e.depth[c]=0,e.opt_len--,r&&(e.static_len-=n[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)JW(e,s,a);c=i;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],JW(e,s,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,s[2*c]=s[2*a]+s[2*o],e.depth[c]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,s[2*a+1]=s[2*o+1]=c,e.heap[1]=c++,JW(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,n=t.max_code,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,d,u,h,p,m,f=0;for(h=0;h<=SW;h++)e.bl_count[h]=0;for(s[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)d=e.heap[l],h=s[2*s[2*d+1]+1]+1,h>c&&(h=c,f++),s[2*d+1]=h,d>n||(e.bl_count[h]++,p=0,d>=o&&(p=a[d-o]),m=s[2*d],e.opt_len+=m*(h+p),i&&(e.static_len+=m*(r[2*d+1]+p)));if(0!==f){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,f-=2}while(f>0);for(h=c;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--l],u>n||(s[2*u+1]!==h&&(e.opt_len+=(h-s[2*u+1])*s[2*u],s[2*u+1]=h),d--)}})(e,t),zW(s,l,e.bl_count)},$W=(e,t,s)=>{let n,r,i=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(s+1)+1]=65535,n=0;n<=s;n++)r=a,a=t[2*(n+1)+1],++o<c&&r===a||(o<l?e.bl_tree[2*r]+=o:0!==r?(r!==i&&e.bl_tree[2*r]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4))},eH=(e,t,s)=>{let n,r,i=-1,a=t[1],o=0,c=7,l=4;for(0===a&&(c=138,l=3),n=0;n<=s;n++)if(r=a,a=t[2*(n+1)+1],!(++o<c&&r===a)){if(o<l)do{HW(e,r,e.bl_tree)}while(0!=--o);else 0!==r?(r!==i&&(HW(e,r,e.bl_tree),o--),HW(e,16,e.bl_tree),WW(e,o-3,2)):o<=10?(HW(e,17,e.bl_tree),WW(e,o-3,3)):(HW(e,18,e.bl_tree),WW(e,o-11,7));o=0,i=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4)}};let tH=!1;const sH=(e,t,s,n)=>{WW(e,0+(n?1:0),3),YW(e),GW(e,s),GW(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var nH=e=>{tH||((()=>{let e,t,s,n,r;const i=new Array(16);for(s=0,n=0;n<28;n++)for(DW[n]=s,e=0;e<1<<TW[n];e++)kW[s++]=n;for(kW[s-1]=n,r=0,n=0;n<16;n++)for(PW[n]=r,e=0;e<1<<CW[n];e++)jW[r++]=n;for(r>>=7;n<NW;n++)for(PW[n]=r<<7,e=0;e<1<<CW[n]-7;e++)jW[256+r++]=n;for(t=0;t<=SW;t++)i[t]=0;for(e=0;e<=143;)AW[2*e+1]=8,e++,i[8]++;for(;e<=255;)AW[2*e+1]=9,e++,i[9]++;for(;e<=279;)AW[2*e+1]=7,e++,i[7]++;for(;e<=287;)AW[2*e+1]=8,e++,i[8]++;for(zW(AW,287,i),e=0;e<NW;e++)OW[2*e+1]=5,OW[2*e]=KW(e,5);MW=new LW(AW,TW,257,wW,SW),UW=new LW(OW,CW,0,NW,SW),VW=new LW(new Array(0),RW,0,19,7)})(),tH=!0),e.l_desc=new FW(e.dyn_ltree,MW),e.d_desc=new FW(e.dyn_dtree,UW),e.bl_desc=new FW(e.bl_tree,VW),e.bi_buf=0,e.bi_valid=0,qW(e)},rH=(e,t,s,n)=>{let r,i,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<bW;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ZW(e,e.l_desc),ZW(e,e.d_desc),a=(e=>{let t;for($W(e,e.dyn_ltree,e.l_desc.max_code),$W(e,e.dyn_dtree,e.d_desc.max_code),ZW(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*IW[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),r=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=r&&(r=i)):r=i=s+5,s+4<=r&&-1!==t?sH(e,t,s,n):4===e.strategy||i===r?(WW(e,2+(n?1:0),3),QW(e,AW,OW)):(WW(e,4+(n?1:0),3),((e,t,s,n)=>{let r;for(WW(e,t-257,5),WW(e,s-1,5),WW(e,n-4,4),r=0;r<n;r++)WW(e,e.bl_tree[2*IW[r]+1],3);eH(e,e.dyn_ltree,t-1),eH(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),QW(e,e.dyn_ltree,e.dyn_dtree)),qW(e),n&&YW(e)},iH=(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(kW[s]+bW+1)]++,e.dyn_dtree[2*BW(t)]++),e.sym_next===e.sym_end),aH=e=>{WW(e,2,3),HW(e,256,AW),(e=>{16===e.bi_valid?(GW(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},oH={_tr_init:nH,_tr_stored_block:sH,_tr_flush_block:rH,_tr_tally:iH,_tr_align:aH},cH=(e,t,s,n)=>{let r=65535&e,i=e>>>16&65535,a=0;for(;0!==s;){a=s>2e3?2e3:s,s-=a;do{r=r+t[n++]|0,i=i+r|0}while(--a);r%=65521,i%=65521}return r|i<<16};const lH=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var dH=(e,t,s,n)=>{const r=lH,i=n+s;e^=-1;for(let a=n;a<i;a++)e=e>>>8^r[255&(e^t[a])];return-1^e},uH={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},hH={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:pH,_tr_stored_block:mH,_tr_flush_block:fH,_tr_tally:gH,_tr_align:yH}=oH,{Z_NO_FLUSH:vH,Z_PARTIAL_FLUSH:xH,Z_FULL_FLUSH:_H,Z_FINISH:EH,Z_BLOCK:bH,Z_OK:wH,Z_STREAM_END:NH,Z_STREAM_ERROR:SH,Z_DATA_ERROR:TH,Z_BUF_ERROR:CH,Z_DEFAULT_COMPRESSION:RH,Z_FILTERED:IH,Z_HUFFMAN_ONLY:AH,Z_RLE:OH,Z_FIXED:jH,Z_DEFAULT_STRATEGY:kH,Z_UNKNOWN:DH,Z_DEFLATED:PH}=hH,LH=286,MH=30,UH=19,VH=2*LH+1,FH=15,BH=258,GH=262,WH=42,HH=113,KH=666,zH=(e,t)=>(e.msg=uH[t],t),qH=e=>2*e-(e>4?9:0),YH=e=>{let t=e.length;for(;--t>=0;)e[t]=0},XH=e=>{let t,s,n,r=e.w_size;t=e.hash_size,n=t;do{s=e.head[--n],e.head[n]=s>=r?s-r:0}while(--t);t=r,n=t;do{s=e.prev[--n],e.prev[n]=s>=r?s-r:0}while(--t)};let JH=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const QH=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},ZH=(e,t)=>{fH(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,QH(e.strm)},$H=(e,t)=>{e.pending_buf[e.pending++]=t},eK=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},tK=(e,t,s,n)=>{let r=e.avail_in;return r>n&&(r=n),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),s),1===e.state.wrap?e.adler=cH(e.adler,t,r,s):2===e.state.wrap&&(e.adler=dH(e.adler,t,r,s)),e.next_in+=r,e.total_in+=r,r)},sK=(e,t)=>{let s,n,r=e.max_chain_length,i=e.strstart,a=e.prev_length,o=e.nice_match;const c=e.strstart>e.w_size-GH?e.strstart-(e.w_size-GH):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+BH;let p=l[i+a-1],m=l[i+a];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(s=t,l[s+a]===m&&l[s+a-1]===p&&l[s]===l[i]&&l[++s]===l[i+1]){i+=2,s++;do{}while(l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&i<h);if(n=BH-(h-i),i=h-BH,n>a){if(e.match_start=t,a=n,n>=o)break;p=l[i+a-1],m=l[i+a]}}}while((t=u[t&d])>c&&0!=--r);return a<=e.lookahead?a:e.lookahead},nK=e=>{const t=e.w_size;let s,n,r;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-GH)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),XH(e),n+=t),0===e.strm.avail_in)break;if(s=tK(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=s,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=JH(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=JH(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<GH&&0!==e.strm.avail_in)},rK=(e,t)=>{let s,n,r,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(s=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r)break;if(r=e.strm.avail_out-r,n=e.strstart-e.block_start,s>n+e.strm.avail_in&&(s=n+e.strm.avail_in),s>r&&(s=r),s<i&&(0===s&&t!==EH||t===vH||s!==n+e.strm.avail_in))break;a=t===EH&&s===n+e.strm.avail_in?1:0,mH(e,0,0,a),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,QH(e.strm),n&&(n>s&&(n=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,s-=n),s&&(tK(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==vH&&t!==EH&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(tK(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,i=r>e.w_size?e.w_size:r,n=e.strstart-e.block_start,(n>=i||(n||t===EH)&&t!==vH&&0===e.strm.avail_in&&n<=r)&&(s=n>r?r:n,a=t===EH&&0===e.strm.avail_in&&s===n?1:0,mH(e,e.block_start,s,a),e.block_start+=s,QH(e.strm)),a?3:1)},iK=(e,t)=>{let s,n;for(;;){if(e.lookahead<GH){if(nK(e),e.lookahead<GH&&t===vH)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-GH&&(e.match_length=sK(e,s)),e.match_length>=3)if(n=gH(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=JH(e,e.ins_h,e.window[e.strstart+1]);else n=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===EH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2},aK=(e,t)=>{let s,n,r;for(;;){if(e.lookahead<GH){if(nK(e),e.lookahead<GH&&t===vH)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-GH&&(e.match_length=sK(e,s),e.match_length<=5&&(e.strategy===IH||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,n=gH(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=JH(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(ZH(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=gH(e,0,e.window[e.strstart-1]),n&&ZH(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=gH(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===EH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2};function oK(e,t,s,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=n,this.func=r}const cK=[new oK(0,0,0,0,rK),new oK(4,4,8,4,iK),new oK(4,5,16,8,iK),new oK(4,6,32,32,iK),new oK(4,4,16,16,aK),new oK(8,16,32,32,aK),new oK(8,16,128,128,aK),new oK(8,32,128,256,aK),new oK(32,128,258,1024,aK),new oK(32,258,258,4096,aK)];function lK(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=PH,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*VH),this.dyn_dtree=new Uint16Array(2*(2*MH+1)),this.bl_tree=new Uint16Array(2*(2*UH+1)),YH(this.dyn_ltree),YH(this.dyn_dtree),YH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(FH+1),this.heap=new Uint16Array(2*LH+1),YH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*LH+1),YH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dK=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==WH&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==HH&&t.status!==KH?1:0},uK=e=>{if(dK(e))return zH(e,SH);e.total_in=e.total_out=0,e.data_type=DH;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?WH:HH,e.adler=2===t.wrap?0:1,t.last_flush=-2,pH(t),wH},hK=e=>{const t=uK(e);return t===wH&&(e=>{e.window_size=2*e.w_size,YH(e.head),e.max_lazy_match=cK[e.level].max_lazy,e.good_match=cK[e.level].good_length,e.nice_match=cK[e.level].nice_length,e.max_chain_length=cK[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},pK=(e,t,s,n,r,i)=>{if(!e)return SH;let a=1;if(t===RH&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),r<1||r>9||s!==PH||n<8||n>15||t<0||t>9||i<0||i>jH||8===n&&1!==a)return zH(e,SH);8===n&&(n=9);const o=new lK;return e.state=o,o.strm=e,o.status=WH,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=s,hK(e)};var mK=(e,t)=>{if(dK(e)||t>bH||t<0)return e?zH(e,SH):SH;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===KH&&t!==EH)return zH(e,0===e.avail_out?CH:SH);const n=s.last_flush;if(s.last_flush=t,0!==s.pending){if(QH(e),0===e.avail_out)return s.last_flush=-1,wH}else if(0===e.avail_in&&qH(t)<=qH(n)&&t!==EH)return zH(e,CH);if(s.status===KH&&0!==e.avail_in)return zH(e,CH);if(s.status===WH&&0===s.wrap&&(s.status=HH),s.status===WH){let t=PH+(s.w_bits-8<<4)<<8,n=-1;if(n=s.strategy>=AH||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=n<<6,0!==s.strstart&&(t|=32),t+=31-t%31,eK(s,t),0!==s.strstart&&(eK(s,e.adler>>>16),eK(s,65535&e.adler)),e.adler=1,s.status=HH,QH(e),0!==s.pending)return s.last_flush=-1,wH}if(57===s.status)if(e.adler=0,$H(s,31),$H(s,139),$H(s,8),s.gzhead)$H(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),$H(s,255&s.gzhead.time),$H(s,s.gzhead.time>>8&255),$H(s,s.gzhead.time>>16&255),$H(s,s.gzhead.time>>24&255),$H(s,9===s.level?2:s.strategy>=AH||s.level<2?4:0),$H(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&($H(s,255&s.gzhead.extra.length),$H(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=dH(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if($H(s,0),$H(s,0),$H(s,0),$H(s,0),$H(s,0),$H(s,9===s.level?2:s.strategy>=AH||s.level<2?4:0),$H(s,3),s.status=HH,QH(e),0!==s.pending)return s.last_flush=-1,wH;if(69===s.status){if(s.gzhead.extra){let t=s.pending,n=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+n>s.pending_buf_size;){let r=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+r),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=dH(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=r,QH(e),0!==s.pending)return s.last_flush=-1,wH;t=0,n-=r}let r=new Uint8Array(s.gzhead.extra);s.pending_buf.set(r.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending+=n,s.gzhead.hcrc&&s.pending>t&&(e.adler=dH(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(e.adler=dH(e.adler,s.pending_buf,s.pending-n,n)),QH(e),0!==s.pending)return s.last_flush=-1,wH;n=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,$H(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>n&&(e.adler=dH(e.adler,s.pending_buf,s.pending-n,n)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(e.adler=dH(e.adler,s.pending_buf,s.pending-n,n)),QH(e),0!==s.pending)return s.last_flush=-1,wH;n=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,$H(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>n&&(e.adler=dH(e.adler,s.pending_buf,s.pending-n,n))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(QH(e),0!==s.pending))return s.last_flush=-1,wH;$H(s,255&e.adler),$H(s,e.adler>>8&255),e.adler=0}if(s.status=HH,QH(e),0!==s.pending)return s.last_flush=-1,wH}if(0!==e.avail_in||0!==s.lookahead||t!==vH&&s.status!==KH){let n=0===s.level?rK(s,t):s.strategy===AH?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(nK(e),0===e.lookahead)){if(t===vH)return 1;break}if(e.match_length=0,s=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===EH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===OH?((e,t)=>{let s,n,r,i;const a=e.window;for(;;){if(e.lookahead<=BH){if(nK(e),e.lookahead<=BH&&t===vH)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=e.strstart-1,n=a[r],n===a[++r]&&n===a[++r]&&n===a[++r])){i=e.strstart+BH;do{}while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<i);e.match_length=BH-(i-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=gH(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=gH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(ZH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===EH?(ZH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZH(e,!1),0===e.strm.avail_out)?1:2})(s,t):cK[s.level].func(s,t);if(3!==n&&4!==n||(s.status=KH),1===n||3===n)return 0===e.avail_out&&(s.last_flush=-1),wH;if(2===n&&(t===xH?yH(s):t!==bH&&(mH(s,0,0,!1),t===_H&&(YH(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),QH(e),0===e.avail_out))return s.last_flush=-1,wH}return t!==EH?wH:s.wrap<=0?NH:(2===s.wrap?($H(s,255&e.adler),$H(s,e.adler>>8&255),$H(s,e.adler>>16&255),$H(s,e.adler>>24&255),$H(s,255&e.total_in),$H(s,e.total_in>>8&255),$H(s,e.total_in>>16&255),$H(s,e.total_in>>24&255)):(eK(s,e.adler>>>16),eK(s,65535&e.adler)),QH(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?wH:NH)},fK=(e,t)=>{let s=t.length;if(dK(e))return SH;const n=e.state,r=n.wrap;if(2===r||1===r&&n.status!==WH||n.lookahead)return SH;if(1===r&&(e.adler=cH(e.adler,t,s,0)),n.wrap=0,s>=n.w_size){0===r&&(YH(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(s-n.w_size,s),0),t=e,s=n.w_size}const i=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,nK(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=JH(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,nK(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=a,e.input=o,e.avail_in=i,n.wrap=r,wH},gK={deflateInit:(e,t)=>pK(e,t,PH,15,8,kH),deflateInit2:pK,deflateReset:hK,deflateResetKeep:uK,deflateSetHeader:(e,t)=>dK(e)||2!==e.state.wrap?SH:(e.state.gzhead=t,wH),deflate:mK,deflateEnd:e=>{if(dK(e))return SH;const t=e.state.status;return e.state=null,t===HH?zH(e,TH):wH},deflateSetDictionary:fK,deflateInfo:"pako deflate (from Nodeca project)"};const yK=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var vK={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)yK(s,t)&&(e[t]=s[t])}}return e},flattenChunks:e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const s=new Uint8Array(t);for(let n=0,r=0,i=e.length;n<i;n++){let t=e[n];s.set(t,r),r+=t.length}return s}};let xK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){xK=!1}const _K=new Uint8Array(256);for(let s=0;s<256;s++)_K[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;_K[254]=_K[254]=1;var EK={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,n,r,i,a=e.length,o=0;for(r=0;r<a;r++)s=e.charCodeAt(r),55296==(64512&s)&&r+1<a&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),r++)),o+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(o),i=0,r=0;i<o;r++)s=e.charCodeAt(r),55296==(64512&s)&&r+1<a&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),r++)),s<128?t[i++]=s:s<2048?(t[i++]=192|s>>>6,t[i++]=128|63&s):s<65536?(t[i++]=224|s>>>12,t[i++]=128|s>>>6&63,t[i++]=128|63&s):(t[i++]=240|s>>>18,t[i++]=128|s>>>12&63,t[i++]=128|s>>>6&63,t[i++]=128|63&s);return t},buf2string:(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,r;const i=new Array(2*s);for(r=0,n=0;n<s;){let t=e[n++];if(t<128){i[r++]=t;continue}let a=_K[t];if(a>4)i[r++]=65533,n+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&n<s;)t=t<<6|63&e[n++],a--;a>1?i[r++]=65533:t<65536?i[r++]=t:(t-=65536,i[r++]=55296|t>>10&1023,i[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&xK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let n=0;n<t;n++)s+=String.fromCharCode(e[n]);return s})(i,r)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+_K[e[s]]>t?s:t}},bK=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const wK=Object.prototype.toString,{Z_NO_FLUSH:NK,Z_SYNC_FLUSH:SK,Z_FULL_FLUSH:TK,Z_FINISH:CK,Z_OK:RK,Z_STREAM_END:IK,Z_DEFAULT_COMPRESSION:AK,Z_DEFAULT_STRATEGY:OK,Z_DEFLATED:jK}=hH;function kK(e){this.options=vK.assign({level:AK,method:jK,chunkSize:16384,windowBits:15,memLevel:8,strategy:OK},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new bK,this.strm.avail_out=0;let s=gK.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==RK)throw new Error(uH[s]);if(t.header&&gK.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?EK.string2buf(t.dictionary):"[object ArrayBuffer]"===wK.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=gK.deflateSetDictionary(this.strm,e),s!==RK)throw new Error(uH[s]);this._dict_set=!0}}function DK(e,t){const s=new kK(t);if(s.push(e,!0),s.err)throw s.msg||uH[s.err];return s.result}kK.prototype.push=function(e,t){const s=this.strm,n=this.options.chunkSize;let r,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?CK:NK,"string"==typeof e?s.input=EK.string2buf(e):"[object ArrayBuffer]"===wK.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),(i===SK||i===TK)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(r=gK.deflate(s,i),r===IK)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),r=gK.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===RK;if(0!==s.avail_out){if(i>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},kK.prototype.onData=function(e){this.chunks.push(e)},kK.prototype.onEnd=function(e){e===RK&&(this.result=vK.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var PK={Deflate:kK,deflate:DK,deflateRaw:function(e,t){return(t=t||{}).raw=!0,DK(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,DK(e,t)},constants:hH};const LK=16209;var MK=function(e,t){let s,n,r,i,a,o,c,l,d,u,h,p,m,f,g,y,v,x,_,E,b,w,N,S;const T=e.state;s=e.next_in,N=e.input,n=s+(e.avail_in-5),r=e.next_out,S=e.output,i=r-(t-e.avail_out),a=r+(e.avail_out-257),o=T.dmax,c=T.wsize,l=T.whave,d=T.wnext,u=T.window,h=T.hold,p=T.bits,m=T.lencode,f=T.distcode,g=(1<<T.lenbits)-1,y=(1<<T.distbits)-1;e:do{p<15&&(h+=N[s++]<<p,p+=8,h+=N[s++]<<p,p+=8),v=m[h&g];t:for(;;){if(x=v>>>24,h>>>=x,p-=x,x=v>>>16&255,0===x)S[r++]=65535&v;else{if(!(16&x)){if(0==(64&x)){v=m[(65535&v)+(h&(1<<x)-1)];continue t}if(32&x){T.mode=16191;break e}e.msg="invalid literal/length code",T.mode=LK;break e}_=65535&v,x&=15,x&&(p<x&&(h+=N[s++]<<p,p+=8),_+=h&(1<<x)-1,h>>>=x,p-=x),p<15&&(h+=N[s++]<<p,p+=8,h+=N[s++]<<p,p+=8),v=f[h&y];s:for(;;){if(x=v>>>24,h>>>=x,p-=x,x=v>>>16&255,!(16&x)){if(0==(64&x)){v=f[(65535&v)+(h&(1<<x)-1)];continue s}e.msg="invalid distance code",T.mode=LK;break e}if(E=65535&v,x&=15,p<x&&(h+=N[s++]<<p,p+=8,p<x&&(h+=N[s++]<<p,p+=8)),E+=h&(1<<x)-1,E>o){e.msg="invalid distance too far back",T.mode=LK;break e}if(h>>>=x,p-=x,x=r-i,E>x){if(x=E-x,x>l&&T.sane){e.msg="invalid distance too far back",T.mode=LK;break e}if(b=0,w=u,0===d){if(b+=c-x,x<_){_-=x;do{S[r++]=u[b++]}while(--x);b=r-E,w=S}}else if(d<x){if(b+=c+d-x,x-=d,x<_){_-=x;do{S[r++]=u[b++]}while(--x);if(b=0,d<_){x=d,_-=x;do{S[r++]=u[b++]}while(--x);b=r-E,w=S}}}else if(b+=d-x,x<_){_-=x;do{S[r++]=u[b++]}while(--x);b=r-E,w=S}for(;_>2;)S[r++]=w[b++],S[r++]=w[b++],S[r++]=w[b++],_-=3;_&&(S[r++]=w[b++],_>1&&(S[r++]=w[b++]))}else{b=r-E;do{S[r++]=S[b++],S[r++]=S[b++],S[r++]=S[b++],_-=3}while(_>2);_&&(S[r++]=S[b++],_>1&&(S[r++]=S[b++]))}break}}break}}while(s<n&&r<a);_=p>>3,s-=_,p-=_<<3,h&=(1<<p)-1,e.next_in=s,e.next_out=r,e.avail_in=s<n?n-s+5:5-(s-n),e.avail_out=r<a?a-r+257:257-(r-a),T.hold=h,T.bits=p};const UK=15,VK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),FK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),BK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),GK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var WK=(e,t,s,n,r,i,a,o)=>{const c=o.bits;let l,d,u,h,p,m,f=0,g=0,y=0,v=0,x=0,_=0,E=0,b=0,w=0,N=0,S=null;const T=new Uint16Array(16),C=new Uint16Array(16);let R,I,A,O=null;for(f=0;f<=UK;f++)T[f]=0;for(g=0;g<n;g++)T[t[s+g]]++;for(x=c,v=UK;v>=1&&0===T[v];v--);if(x>v&&(x=v),0===v)return r[i++]=20971520,r[i++]=20971520,o.bits=1,0;for(y=1;y<v&&0===T[y];y++);for(x<y&&(x=y),b=1,f=1;f<=UK;f++)if(b<<=1,b-=T[f],b<0)return-1;if(b>0&&(0===e||1!==v))return-1;for(C[1]=0,f=1;f<UK;f++)C[f+1]=C[f]+T[f];for(g=0;g<n;g++)0!==t[s+g]&&(a[C[t[s+g]]++]=g);if(0===e?(S=O=a,m=20):1===e?(S=VK,O=FK,m=257):(S=BK,O=GK,m=0),N=0,g=0,f=y,p=i,_=x,E=0,u=-1,w=1<<x,h=w-1,1===e&&w>852||2===e&&w>592)return 1;for(;;){R=f-E,a[g]+1<m?(I=0,A=a[g]):a[g]>=m?(I=O[a[g]-m],A=S[a[g]-m]):(I=96,A=0),l=1<<f-E,d=1<<_,y=d;do{d-=l,r[p+(N>>E)+d]=R<<24|I<<16|A}while(0!==d);for(l=1<<f-1;N&l;)l>>=1;if(0!==l?(N&=l-1,N+=l):N=0,g++,0==--T[f]){if(f===v)break;f=t[s+a[g]]}if(f>x&&(N&h)!==u){for(0===E&&(E=x),p+=y,_=f-E,b=1<<_;_+E<v&&(b-=T[_+E],!(b<=0));)_++,b<<=1;if(w+=1<<_,1===e&&w>852||2===e&&w>592)return 1;u=N&h,r[u]=x<<24|_<<16|p-i}}return 0!==N&&(r[p+N]=f-E<<24|64<<16),o.bits=x,0};const{Z_FINISH:HK,Z_BLOCK:KK,Z_TREES:zK,Z_OK:qK,Z_STREAM_END:YK,Z_NEED_DICT:XK,Z_STREAM_ERROR:JK,Z_DATA_ERROR:QK,Z_MEM_ERROR:ZK,Z_BUF_ERROR:$K,Z_DEFLATED:ez}=hH,tz=16180,sz=16190,nz=16191,rz=16192,iz=16194,az=16199,oz=16200,cz=16206,lz=16209,dz=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function uz(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const hz=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<tz||t.mode>16211?1:0},pz=e=>{if(hz(e))return JK;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=tz,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qK},mz=e=>{if(hz(e))return JK;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,pz(e)},fz=(e,t)=>{let s;if(hz(e))return JK;const n=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?JK:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=s,n.wbits=t,mz(e))},gz=(e,t)=>{if(!e)return JK;const s=new uz;e.state=s,s.strm=e,s.window=null,s.mode=tz;const n=fz(e,t);return n!==qK&&(e.state=null),n};let yz,vz,xz=!0;const _z=e=>{if(xz){yz=new Int32Array(512),vz=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(WK(1,e.lens,0,288,yz,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;WK(2,e.lens,0,32,vz,0,e.work,{bits:5}),xz=!1}e.lencode=yz,e.lenbits=9,e.distcode=vz,e.distbits=5},Ez=(e,t,s,n)=>{let r;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(t.subarray(s-i.wsize,s),0),i.wnext=0,i.whave=i.wsize):(r=i.wsize-i.wnext,r>n&&(r=n),i.window.set(t.subarray(s-n,s-n+r),i.wnext),(n-=r)?(i.window.set(t.subarray(s-n,s),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=r,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=r))),0};var bz=(e,t)=>{let s,n,r,i,a,o,c,l,d,u,h,p,m,f,g,y,v,x,_,E,b,w,N=0;const S=new Uint8Array(4);let T,C;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(hz(e)||!e.output||!e.input&&0!==e.avail_in)return JK;s=e.state,s.mode===nz&&(s.mode=rz),a=e.next_out,r=e.output,c=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,l=s.hold,d=s.bits,u=o,h=c,w=qK;e:for(;;)switch(s.mode){case tz:if(0===s.wrap){s.mode=rz;break}for(;d<16;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(2&s.wrap&&35615===l){0===s.wbits&&(s.wbits=15),s.check=0,S[0]=255&l,S[1]=l>>>8&255,s.check=dH(s.check,S,2,0),l=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",s.mode=lz;break}if((15&l)!==ez){e.msg="unknown compression method",s.mode=lz;break}if(l>>>=4,d-=4,b=8+(15&l),0===s.wbits&&(s.wbits=b),b>15||b>s.wbits){e.msg="invalid window size",s.mode=lz;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&l?16189:nz,l=0,d=0;break;case 16181:for(;d<16;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(s.flags=l,(255&_W(s))!==ez){e.msg="unknown compression method",s.mode=lz;break}if(57344&_W(s)){e.msg="unknown header flags set",s.mode=lz;break}s.head&&(s.head.text=l>>8&1),512&_W(s)&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,s.check=dH(s.check,S,2,0)),l=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}s.head&&(s.head.time=l),512&_W(s)&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,S[2]=l>>>16&255,S[3]=l>>>24&255,s.check=dH(s.check,S,4,0)),l=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}s.head&&(s.head.xflags=255&l,s.head.os=l>>8),512&_W(s)&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,s.check=dH(s.check,S,2,0)),l=0,d=0,s.mode=16184;case 16184:if(1024&_W(s)){for(;d<16;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}s.length=l,s.head&&(s.head.extra_len=l),512&_W(s)&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,s.check=dH(s.check,S,2,0)),l=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&_W(s)&&(p=s.length,p>o&&(p=o),p&&(s.head&&(b=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(n.subarray(i,i+p),b)),512&_W(s)&&4&s.wrap&&(s.check=dH(s.check,n,p,i)),o-=p,i+=p,s.length-=p),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&_W(s)){if(0===o)break e;p=0;do{b=n[i+p++],s.head&&b&&s.length<65536&&(s.head.name+=String.fromCharCode(b))}while(b&&p<o);if(512&_W(s)&&4&s.wrap&&(s.check=dH(s.check,n,p,i)),o-=p,i+=p,b)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&_W(s)){if(0===o)break e;p=0;do{b=n[i+p++],s.head&&b&&s.length<65536&&(s.head.comment+=String.fromCharCode(b))}while(b&&p<o);if(512&_W(s)&&4&s.wrap&&(s.check=dH(s.check,n,p,i)),o-=p,i+=p,b)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&_W(s)){for(;d<16;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(4&s.wrap&&l!==(65535&s.check)){e.msg="header crc mismatch",s.mode=lz;break}l=0,d=0}s.head&&(s.head.hcrc=_W(s)>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=nz;break;case 16189:for(;d<32;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}e.adler=s.check=dz(l),l=0,d=0,s.mode=sz;case sz:if(0===s.havedict)return e.next_out=a,e.avail_out=c,e.next_in=i,e.avail_in=o,s.hold=l,s.bits=d,XK;e.adler=s.check=1,s.mode=nz;case nz:if(t===KK||t===zK)break e;case rz:if(s.last){l>>>=7&d,d-=7&d,s.mode=cz;break}for(;d<3;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}switch(s.last=1&l,l>>>=1,d-=1,3&l){case 0:s.mode=16193;break;case 1:if(_z(s),s.mode=az,t===zK){l>>>=2,d-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=lz}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",s.mode=lz;break}if(s.length=65535&l,l=0,d=0,s.mode=iz,t===zK)break e;case iz:s.mode=16195;case 16195:if(p=s.length,p){if(p>o&&(p=o),p>c&&(p=c),0===p)break e;r.set(n.subarray(i,i+p),a),o-=p,i+=p,c-=p,a+=p,s.length-=p;break}s.mode=nz;break;case 16196:for(;d<14;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(s.nlen=257+(31&l),l>>>=5,d-=5,s.ndist=1+(31&l),l>>>=5,d-=5,s.ncode=4+(15&l),l>>>=4,d-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=lz;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}s.lens[R[s.have++]]=7&l,l>>>=3,d-=3}for(;s.have<19;)s.lens[R[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,T={bits:s.lenbits},w=WK(0,s.lens,0,19,s.lencode,0,s.work,T),s.lenbits=T.bits,w){e.msg="invalid code lengths set",s.mode=lz;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;N=s.lencode[l&(1<<s.lenbits)-1],g=N>>>24,y=N>>>16&255,v=65535&N,!(g<=d);){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(v<16)l>>>=g,d-=g,s.lens[s.have++]=v;else{if(16===v){for(C=g+2;d<C;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(l>>>=g,d-=g,0===s.have){e.msg="invalid bit length repeat",s.mode=lz;break}b=s.lens[s.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===v){for(C=g+3;d<C;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}l>>>=g,d-=g,b=0,p=3+(7&l),l>>>=3,d-=3}else{for(C=g+7;d<C;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}l>>>=g,d-=g,b=0,p=11+(127&l),l>>>=7,d-=7}if(s.have+p>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=lz;break}for(;p--;)s.lens[s.have++]=b}}if(s.mode===lz)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=lz;break}if(s.lenbits=9,T={bits:s.lenbits},w=WK(1,s.lens,0,s.nlen,s.lencode,0,s.work,T),s.lenbits=T.bits,w){e.msg="invalid literal/lengths set",s.mode=lz;break}if(s.distbits=6,s.distcode=s.distdyn,T={bits:s.distbits},w=WK(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,T),s.distbits=T.bits,w){e.msg="invalid distances set",s.mode=lz;break}if(s.mode=az,t===zK)break e;case az:s.mode=oz;case oz:if(o>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=i,e.avail_in=o,s.hold=l,s.bits=d,MK(e,h),a=e.next_out,r=e.output,c=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,l=s.hold,d=s.bits,s.mode===nz&&(s.back=-1);break}for(s.back=0;N=s.lencode[l&(1<<s.lenbits)-1],g=N>>>24,y=N>>>16&255,v=65535&N,!(g<=d);){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(y&&0==(240&y)){for(x=g,_=y,E=v;N=s.lencode[E+((l&(1<<x+_)-1)>>x)],g=N>>>24,y=N>>>16&255,v=65535&N,!(x+g<=d);){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}l>>>=x,d-=x,s.back+=x}if(l>>>=g,d-=g,s.back+=g,s.length=v,0===y){s.mode=16205;break}if(32&y){s.back=-1,s.mode=nz;break}if(64&y){e.msg="invalid literal/length code",s.mode=lz;break}s.extra=15&y,s.mode=16201;case 16201:if(s.extra){for(C=s.extra;d<C;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}s.length+=l&(1<<s.extra)-1,l>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;N=s.distcode[l&(1<<s.distbits)-1],g=N>>>24,y=N>>>16&255,v=65535&N,!(g<=d);){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(0==(240&y)){for(x=g,_=y,E=v;N=s.distcode[E+((l&(1<<x+_)-1)>>x)],g=N>>>24,y=N>>>16&255,v=65535&N,!(x+g<=d);){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}l>>>=x,d-=x,s.back+=x}if(l>>>=g,d-=g,s.back+=g,64&y){e.msg="invalid distance code",s.mode=lz;break}s.offset=v,s.extra=15&y,s.mode=16203;case 16203:if(s.extra){for(C=s.extra;d<C;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}s.offset+=l&(1<<s.extra)-1,l>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=lz;break}s.mode=16204;case 16204:if(0===c)break e;if(p=h-c,s.offset>p){if(p=s.offset-p,p>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=lz;break}p>s.wnext?(p-=s.wnext,m=s.wsize-p):m=s.wnext-p,p>s.length&&(p=s.length),f=s.window}else f=r,m=a-s.offset,p=s.length;p>c&&(p=c),c-=p,s.length-=p;do{r[a++]=f[m++]}while(--p);0===s.length&&(s.mode=oz);break;case 16205:if(0===c)break e;r[a++]=s.length,c--,s.mode=oz;break;case cz:if(s.wrap){for(;d<32;){if(0===o)break e;o--,l|=n[i++]<<d,d+=8}if(h-=c,e.total_out+=h,s.total+=h,4&s.wrap&&h&&(e.adler=s.check=_W(s)?dH(s.check,r,h,a-h):cH(s.check,r,h,a-h)),h=c,4&s.wrap&&(_W(s)?l:dz(l))!==s.check){e.msg="incorrect data check",s.mode=lz;break}l=0,d=0}s.mode=16207;case 16207:if(s.wrap&&_W(s)){for(;d<32;){if(0===o)break e;o--,l+=n[i++]<<d,d+=8}if(4&s.wrap&&l!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=lz;break}l=0,d=0}s.mode=16208;case 16208:w=YK;break e;case lz:w=QK;break e;case 16210:return ZK;default:return JK}return e.next_out=a,e.avail_out=c,e.next_in=i,e.avail_in=o,s.hold=l,s.bits=d,(s.wsize||h!==e.avail_out&&s.mode<lz&&(s.mode<cz||t!==HK))&&Ez(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,s.total+=h,4&s.wrap&&h&&(e.adler=s.check=_W(s)?dH(s.check,r,h,e.next_out-h):cH(s.check,r,h,e.next_out-h)),e.data_type=s.bits+(s.last?64:0)+(s.mode===nz?128:0)+(s.mode===az||s.mode===iz?256:0),(0===u&&0===h||t===HK)&&w===qK&&(w=$K),w},wz={inflateReset:mz,inflateReset2:fz,inflateResetKeep:pz,inflateInit:e=>gz(e,15),inflateInit2:gz,inflate:bz,inflateEnd:e=>{if(hz(e))return JK;let t=e.state;return t.window&&(t.window=null),e.state=null,qK},inflateGetHeader:(e,t)=>{if(hz(e))return JK;const s=e.state;return 0==(2&s.wrap)?JK:(s.head=t,t.done=!1,qK)},inflateSetDictionary:(e,t)=>{const s=t.length;let n,r,i;return hz(e)?JK:(n=e.state,0!==n.wrap&&n.mode!==sz?JK:n.mode===sz&&(r=1,r=cH(r,t,s,0),r!==n.check)?QK:(i=Ez(e,t,s,s),i?(n.mode=16210,ZK):(n.havedict=1,qK)))},inflateInfo:"pako inflate (from Nodeca project)"},Nz=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Sz=Object.prototype.toString,{Z_NO_FLUSH:Tz,Z_FINISH:Cz,Z_OK:Rz,Z_STREAM_END:Iz,Z_NEED_DICT:Az,Z_STREAM_ERROR:Oz,Z_DATA_ERROR:jz,Z_MEM_ERROR:kz}=hH;function Dz(e){this.options=vK.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new bK,this.strm.avail_out=0;let s=wz.inflateInit2(this.strm,t.windowBits);if(s!==Rz)throw new Error(uH[s]);if(this.header=new Nz,wz.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=EK.string2buf(t.dictionary):"[object ArrayBuffer]"===Sz.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=wz.inflateSetDictionary(this.strm,t.dictionary),s!==Rz)))throw new Error(uH[s])}function Pz(e,t){const s=new Dz(t);if(s.push(e),s.err)throw s.msg||uH[s.err];return s.result}Dz.prototype.push=function(e,t){const s=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let i,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Cz:Tz,"[object ArrayBuffer]"===Sz.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),i=wz.inflate(s,a),i===Az&&r&&(i=wz.inflateSetDictionary(s,r),i===Rz?i=wz.inflate(s,a):i===jz&&(i=Az));s.avail_in>0&&i===Iz&&s.state.wrap>0&&0!==e[s.next_in];)wz.inflateReset(s),i=wz.inflate(s,a);switch(i){case Oz:case jz:case Az:case kz:return this.onEnd(i),this.ended=!0,!1}if(o=s.avail_out,s.next_out&&(0===s.avail_out||i===Iz))if("string"===this.options.to){let e=EK.utf8border(s.output,s.next_out),t=s.next_out-e,r=EK.buf2string(s.output,e);s.next_out=t,s.avail_out=n-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(r)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(i!==Rz||0!==o){if(i===Iz)return i=wz.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Dz.prototype.onData=function(e){this.chunks.push(e)},Dz.prototype.onEnd=function(e){e===Rz&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=vK.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Lz={Inflate:Dz,inflate:Pz,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Pz(e,t)},ungzip:Pz,constants:hH};const{Deflate:Mz,deflate:Uz,deflateRaw:Vz,gzip:Fz}=PK,{Inflate:Bz,inflate:Gz,inflateRaw:Wz,ungzip:Hz}=Lz;var Kz=Uz,zz=Gz,qz=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(qz||{});class Yz{constructor(){uS(this,"_sequence",0),uS(this,"_startTime",Date.now()),uS(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const s=new Uint8Array(4);s.set([1,0,0,0]);const n={id:0,length:4,data:s.buffer},r={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[n]};t.commonPacketHeader.extension=1,t.extension=r,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;RA("SHOW_DATASTREAM2_LOG")&&aO.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const s=new ArrayBuffer(t.commonPacketHeader.length),n=new Uint8Array(s),r=new DataView(s);let i=0;if(r.setUint16(i,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),i+=2,r.setUint32(i,t.commonPacketHeader.sequence,!0),i+=4,r.setUint16(i,t.commonStreamHeader,!0),i+=2,t.extension){const e=this.serializeExtension(t.extension);n.set(new Uint8Array(e),i),i+=e.byteLength}if(n.set(new Uint8Array(t.payload),i),i+=t.payload.byteLength,i!==t.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let s=0;const n=t.getUint16(s,!0);s+=2;const r={length:16383&n,reserved:(16384&n)>>14,extension:(32768&n)>>15,sequence:t.getUint16(s+2,!0)<<16|t.getUint16(s,!0)};let i,a;if(s+=4,RA("SHOW_DATASTREAM2_LOG")&&aO.debug("receive data header: ".concat(JSON.stringify(r))),t.getUint16(s,!0),s+=2,r.extension){a=this.deserializeExtension(e.slice(s)),s+=2+a.length,i=e.slice(s);let t=!1;if(a.datas.length>0){const e=a.datas.find(e=>0===e.id);e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}i=t?this.decompress(i):i}else i=e.slice(8);return i}serializeExtension(e){const{profile:t,length:s,datas:n}=e,r=new ArrayBuffer(s+2),i=new Uint8Array(r),a=new DataView(r);let o=0;if(a.setUint8(o++,t),a.setUint8(o++,s),n.forEach(e=>{t?(a.setUint8(o++,e.id),a.setUint8(o++,e.length),i.set(new Uint8Array(e.data),o),o+=e.data.byteLength):(a.setUint8(o++,e.id|e.length<<4),i.set(new Uint8Array(e.data),o),o+=e.data.byteLength)}),o!==s+2)throw Error("serialize extension error, is ".concat(o,"!==").concat(s+2));return r}deserializeExtension(e){const t=new DataView(e);let s=0;const n=t.getUint8(s);s++;const r=t.getUint8(s);s++;const i=n===qz.TWO_BYTE,a=[],o=new DataView(e,2);let c=0;for(;c<r;){let e=0,t=0,s=new ArrayBuffer(0);i?(e=o.getUint8(c),c++,t=o.getUint8(c),c++):(e=15&o.getUint8(c),t=o.getUint8(c)>>4,c++),t>0&&(s=o.buffer.slice(c+2,c+2+t),c+=s.byteLength),a.push({id:e,length:t,data:s})}if(c!==r)throw Error("parse error");return{profile:n,length:r,datas:a}}decompress(e){return zz(new Uint8Array(e))}compress(e){return Kz(new Uint8Array(e))}}const Xz={name:"DataStream",create:(e,t)=>{const s=t?new eP(e):new tP(e);return s.useDataStream(new Yz),s}};class Jz extends HR{constructor(e,t,s){super(),uS(this,"ws",void 0),uS(this,"requestId",1),uS(this,"heartBeatTimer",void 0),uS(this,"joinInfo",void 0),uS(this,"clientId",void 0),uS(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),uS(this,"onClose",e=>{this.emit("close"),this.dispose()}),uS(this,"onMessage",e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)}),this.joinInfo=e,this.clientId=t,this.ws=new JM("cross-channel-".concat(this.clientId),s),this.ws.on(BL.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(BL.CONNECTED,this.onOpen),this.ws.on(BL.ON_MESSAGE,this.onMessage),this.ws.on(BL.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new sp((t,s)=>{const n=window.setTimeout(()=>{s(new fO(RR.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,r=>{window.clearTimeout(n),r.state&&0!==r.state?s(new fO(RR.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(n),s(new fO(RR.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new fO(RR.WS_DISCONNECT);const t=()=>new sp((e,t)=>{this.ws.once(BL.CLOSED,()=>t(new fO(RR.WS_ABORT))),this.ws.once(BL.CONNECTED,e)});"connected"!==this.ws.state&&await t();const s=this.sendMessage(e),n=new sp((e,t)=>{const n=()=>{t(new fO(RR.WS_ABORT))};this.ws.once(BL.RECONNECTING,n),this.ws.once(BL.CLOSED,n),this.once("req_".concat(s),e),NI(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(BL.RECONNECTING,n),this.ws.off(BL.CLOSED,n),t(new fO(RR.TIMEOUT,"cross channel ws request timeout"))})}),r=await n;if(!r||200!==r.code)throw new fO(RR.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(e){this.ws.removeAllListeners(BL.REQUEST_NEW_URLS),this.ws.on(BL.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Qz extends HR{set state(e){e!==this._state&&(e!==tM.RELAY_STATE_FAILURE&&(this.errorCode=sM.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,s,n,r){super(),uS(this,"joinInfo",void 0),uS(this,"sid",void 0),uS(this,"clientId",void 0),uS(this,"cancelToken",LC.CancelToken.source()),uS(this,"workerToken",void 0),uS(this,"requestId",0),uS(this,"signal",void 0),uS(this,"prevChannelMediaConfig",void 0),uS(this,"httpRetryConfig",void 0),uS(this,"_resolution",void 0),uS(this,"_state",tM.RELAY_STATE_IDLE),uS(this,"errorCode",sM.RELAY_OK),uS(this,"onStatus",e=>{aO.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",eM.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=sM.SRC_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=sM.DEST_TOKEN_EXPIRED,this.state=tM.RELAY_STATE_FAILURE))}),uS(this,"onReconnect",async()=>{aO.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",eM.NETWORK_DISCONNECTED),this.state=tM.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{this.state!==tM.RELAY_STATE_IDLE&&(aO.error("auto restart channel media relay failed",e.toString()),this.errorCode=sM.SERVER_CONNECTION_LOST,this.state=tM.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=TI(),this.signal=new Jz(this.joinInfo,this.clientId,s),this.httpRetryConfig=n,this._resolution=r}async startChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_IDLE)throw new fO(RR.INVALID_OPERATION);this.state=tM.RELAY_STATE_CONNECTING,await this.connect(),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new fO(RR.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==tM.RELAY_STATE_RUNNING)throw new fO(RR.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==tM.RELAY_STATE_RUNNING)throw new fO(RR.INVALID_OPERATION);const t=this.genMessage($L.SetVideoProfile);await this.signal.request(t),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),aO.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tM.RELAY_STATE_IDLE,this.dispose()}dispose(){aO.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=LC.CancelToken.source(),this.state=tM.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await VV(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",eM.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage($L.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const s=this.genMessage($L.SetSdkProfile,e);await this.signal.request(s),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const n=this.genMessage($L.SetSourceChannel,e);await this.signal.request(n),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",eM.PACKET_JOINED_SRC_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const r=this.genMessage($L.SetSourceUserId,e);await this.signal.request(r),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const i=this.genMessage($L.SetDestChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",eM.PACKET_JOINED_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage($L.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",eM.PACKET_SENT_TO_DEST_CHANNEL),this.state=tM.RELAY_STATE_RUNNING,aO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage($L.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",eM.PACKET_UPDATE_DEST_CHANNEL),aO.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage($L.StopPacketTransfer);await this.signal.request(e),aO.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const s=[],n=[],r=[];this.requestId+=1;const i={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:vA,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.24.0"===i.sdkVersion&&(i.sdkVersion="0.0.1");let a=null,o=null;switch(e){case $L.SetSdkProfile:return i.clientRequest={command:"SetSdkProfile",type:"multi_channel"},i;case $L.SetSourceChannel:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(RR.UNEXPECTED_ERROR,"can not find source config");return i.clientRequest={command:"SetSourceChannel",uid:"0",channelName:o.channelName,token:o.token||this.joinInfo.appId},i;case $L.SetSourceUserId:if(o=t&&t.getSrcChannelMediaInfo(),!o)throw new fO(RR.UNEXPECTED_ERROR,"can not find source config");return i.clientRequest={command:"SetSourceUserId",uid:o.uid+""},i;case $L.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(RR.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{s.push(e.channelName),n.push(e.uid+""),r.push(e.token||this.joinInfo.appId)}),i.clientRequest={command:"SetDestChannel",channelName:s,uid:n,token:r},i;case $L.StartPacketTransfer:return i.clientRequest={command:"StartPacketTransfer"},i;case $L.Reconnect:return i.clientRequest={command:"Reconnect"},i;case $L.StopPacketTransfer:return i.clientRequest={command:"StopPacketTransfer"},i;case $L.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new fO(RR.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{s.push(e.channelName),n.push(e.uid+""),r.push(e.token||this.joinInfo.appId)}),i.clientRequest={command:"UpdateDestChannel",channelName:s,uid:n,token:r},i;case $L.SetVideoProfile:i.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return i}}const Zz={name:"ChannelMediaRelay",create:function(e){return new Qz(e.joinInfo,e.clientId,e.websocketRetryConfig||FI,e.httpRetryConfig||FI,e.resolution)}};function $z(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function eq(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?$z(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$z(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class tq extends HR{constructor(e,t,s,n){super(),uS(this,"spec",void 0),uS(this,"token",void 0),uS(this,"websocket",void 0),uS(this,"pingpongTimer",void 0),uS(this,"reconnectMode","retry"),uS(this,"serviceMode",void 0),uS(this,"reqId",0),uS(this,"commandReqId",0),uS(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),uS(this,"handleWebSocketMessage",e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(mO.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===HL.TRANSCODE?1:2}),this.emit(XL.PUBLISH_STREAM_STATUS,t))}),this.spec=t,this.token=e,this.serviceMode=n,this.websocket=new JM("live-streaming",s),this.websocket.on(BL.CONNECTED,this.handleWebSocketOpen),this.websocket.on(BL.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(BL.REQUEST_NEW_URLS,(e,t)=>{iI(this,XL.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(BL.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,s,n){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const r=this.commandReqId,i=this.reqId;if(!i||!this.websocket)throw new fO(RR.UNEXPECTED_ERROR);const a=eq({command:e,sdkVersion:"4.24.0"===vA?"0.0.1":vA,seq:i,requestId:i,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new fO(RR.WS_DISCONNECT);const o=()=>new sp((e,t)=>{this.websocket.once(BL.CLOSED,()=>t(new fO(RR.WS_ABORT))),this.websocket.once(BL.CONNECTED,e)});"connected"!==this.websocket.state&&await o(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const c=new sp((e,t)=>{const s=()=>{t(new fO(RR.WS_ABORT))};this.websocket.once(BL.RECONNECTING,s),this.websocket.once(BL.CLOSED,s),this.once("@".concat(i,"-").concat(this.spec.sid),t=>{e(t)})});n&&mO.workerEvent(this.spec.sid,eq(eq({},n),{},{requestId:r,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let d=null;try{d=await c}catch(n){if("closed"===this.websocket.state)throw n;return await o(),await this.request(e,t,s)}return n&&mO.workerEvent(this.spec.sid,eq(eq({},n),{},{requestId:r,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-l})),200!==d.code&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.24.0"===vA?"0.0.1":vA;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case QL.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void aO.warning("live stream response already exists stream");case QL.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case QL.LIVE_STREAM_RESPONSE_BAD_STREAM:case QL.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new fO(RR.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case QL.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new fO(RR.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new fO(RR.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(XL.WARNING,t,e.serverResponse.url)}case QL.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new fO(RR.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(XL.WARNING,t,e.serverResponse.url)}case QL.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case QL.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new fO(RR.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new fO(RR.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(XL.WARNING,t,e.serverResponse.url)}case QL.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case QL.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case QL.LIVE_STREAM_RESPONSE_WORKER_LOST:case QL.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case QL.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case QL.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new fO(RR.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(CI)},6e3)}}function sq(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function nq(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?sq(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):sq(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class rq extends HR{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FI,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FI;super(),uS(this,"onLiveStreamWarning",void 0),uS(this,"onLiveStreamError",void 0),uS(this,"spec",void 0),uS(this,"retryTimeout",1e4),uS(this,"connection",void 0),uS(this,"httpRetryConfig",void 0),uS(this,"wsRetryConfig",void 0),uS(this,"streamingTasks",new Map),uS(this,"isStartingStreamingTask",!1),uS(this,"taskMutex",new UI("live-streaming")),uS(this,"cancelToken",LC.CancelToken.source()),uS(this,"transcodingConfig",void 0),uS(this,"uapResponse",void 0),uS(this,"lastTaskId",1),uS(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=s,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=nq(nq({},YL),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(aO.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(e=>nq(nq(nq({},KL),e),{},{zOrder:e.zOrder?e.zOrder+1:1}))),function(e){LR(e.width)||jR(e.width,"config.width",0,1e4),LR(e.height)||jR(e.height,"config.height",0,1e4),LR(e.videoBitrate)||jR(e.videoBitrate,"config.videoBitrate",1,1e6),LR(e.videoFrameRate)||jR(e.videoFrameRate,"config.videoFrameRate"),LR(e.lowLatency)||AR(e.lowLatency,"config.lowLatency"),LR(e.audioSampleRate)||OR(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),LR(e.audioBitrate)||jR(e.audioBitrate,"config.audioBitrate",1,128),LR(e.audioChannels)||OR(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),LR(e.videoGop)||jR(e.videoGop,"config.videoGop"),LR(e.videoCodecProfile)||OR(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),LR(e.userCount)||jR(e.userCount,"config.userCount",0,17),LR(e.backgroundColor)||jR(e.backgroundColor,"config.backgroundColor",0,16777215),LR(e.userConfigExtraInfo)||DR(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!LR(e.transcodingUsers)&&(PR(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((e,t)=>{WL(e.uid),LR(e.x)||jR(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),LR(e.y)||jR(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),LR(e.width)||jR(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),LR(e.height)||jR(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),LR(e.zOrder)||jR(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),LR(e.alpha)||jR(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),LR(e.watermark)||qL(e.watermark,"watermark"),LR(e.backgroundImage)||qL(e.backgroundImage,"backgroundImage"),e.images&&!LR(e.images)&&(PR(e.images,"config.images"),e.images.forEach((e,t)=>{qL(e,"images[".concat(t,"]"))}))}(t);const s=[];t.images&&s.push(...t.images.map(e=>nq(nq(nq({},zL),e),{},{zOrder:255}))),t.backgroundImage&&(s.push(nq(nq(nq({},zL),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(s.push(nq(nq(nq({},zL),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=s,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(e=>nq({},e)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const n=(t.userConfigs||[]).map(e=>"number"==typeof e.uid?sp.resolve(e.uid):DV(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await sp.all(n)).forEach((e,s)=>{t.userConfigs&&t.userConfigs[s]&&(t.userConfigs[s].uid=e)}),this.transcodingConfig=t,this.connection)try{var r;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(up(r=this.streamingTasks).call(r)).map(e=>e.taskId).join("#")});aO.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(t=>{aO.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then(()=>{aO.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))}).catch(e=>{aO.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)})})}}async startLiveStreamingTask(e,t,s){if(!this.transcodingConfig&&t===HL.TRANSCODE)throw new fO(RR.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const n={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};aO.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const r=await this.taskMutex.lock();if(!this.connection&&s)return void r();if(this.streamingTasks.get(e)&&!s)return r(),new fO(RR.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw r(),e}switch(t){case HL.TRANSCODE:n.transcodingConfig=nq({},this.transcodingConfig);case HL.RAW:}this.uapResponse&&this.uapResponse.vid&&(n.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const i=this.lastTaskId++;try{const a=new sp((t,n)=>{NI(this.retryTimeout).then(()=>{if(s)return n(s);const t=this.statusError.get(e);return t?(this.statusError.delete(e),n(t)):void 0})}),o=await sp.race([this.connection.request("request",{clientRequest:n},!0,{url:e,command:"PublishStream",workerType:t===HL.TRANSCODE?1:2,requestByUser:!s,tid:i.toString()}),a]);this.isStartingStreamingTask=!1,aO.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(o.code)),this.streamingTasks.set(e,{clientRequest:n,mode:t,url:e,taskId:i}),r()}catch(n){if(r(),this.isStartingStreamingTask=!1,!n.data||!n.data.retry||s)throw n;return n.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,n)):await this.startLiveStreamingTask(e,t,n)}}stopLiveStreamingTask(e){return new sp((t,s)=>{const n=this.streamingTasks.get(e);if(!n||!this.connection)return new fO(RR.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const r=n.mode;n.abortTask=()=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:n.url}},!1,{url:e,command:"UnPublishStream",workerType:r===HL.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s=>{aO.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(s)})}resetAllTask(){var e;const t=Array.from(up(e=this.streamingTasks).call(e));this.terminate();for(const s of t)this.startLiveStreamingTask(s.url,s.mode).catch(e=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,e)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=LC.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new fO(RR.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await iI(this,JL.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new tq(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(XL.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(XL.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(XL.REQUEST_NEW_ADDRESS,(t,s)=>{if(!this.connection)return s(new fO(RR.UNEXPECTED_ERROR,"can not get new live streaming address list"));iI(this,JL.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(s)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",s=this.streamingTasks.get(t),n=e.reason;switch(e.code){case QL.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case QL.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const n=new fO(RR.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(s)return aO.error(n.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,n);if(!this.isStartingStreamingTask)return;this.statusError.set(t,n)}case QL.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new fO(RR.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,n);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case QL.LIVE_STREAM_RESPONSE_WORKER_LOST:case QL.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var r;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(up(r=this.streamingTasks).call(r));for(const s of t)s.abortTask?s.abortTask():(aO.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",s.url),this.startLiveStreamingTask(s.url,s.mode,new fO(RR.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{aO.debug("[".concat(this.spec.clientId,"] republish live stream success"),s.url)}).catch(e=>{aO.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(s.url,e)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const iq={name:"LiveStreaming",create:function(e){return new rq(e.joinInfo,e.websocketRetryConfig||FI,e.httpRetryConfig||FI)}};function aq(e){let t=yq();return function(e,t){let s=e.appId;void 0!==s&&(Oq(t,10),Nq(t,s));let n=e.cid;void 0!==n&&(Oq(t,16),Oq(t,n));let r=e.cname;void 0!==r&&(Oq(t,26),Nq(t,r));let i=e.deviceId;void 0!==i&&(Oq(t,34),Nq(t,i));let a=e.elapse;void 0!==a&&(Oq(t,40),jq(t,a));let o=e.fileSize;void 0!==o&&(Oq(t,48),jq(t,fq(o)));let c=e.height;void 0!==c&&(Oq(t,56),jq(t,fq(c)));let l=e.jpg;void 0!==l&&(Oq(t,66),Oq(t,l.length),function(e,t){let s=Eq(e,t.length);e.bytes.set(t,s)}(t,l));let d=e.networkType;void 0!==d&&(Oq(t,72),jq(t,fq(d)));let u=e.osType;void 0!==u&&(Oq(t,80),jq(t,fq(u)));let h=e.requestId;void 0!==h&&(Oq(t,90),Nq(t,h));let p=e.sdkVersion;void 0!==p&&(Oq(t,98),Nq(t,p));let m=e.sequence;void 0!==m&&(Oq(t,104),jq(t,fq(m)));let f=e.sid;void 0!==f&&(Oq(t,114),Nq(t,f));let g=e.timestamp;void 0!==g&&(Oq(t,120),jq(t,g));let y=e.uid;void 0!==y&&(Oq(t,128),Oq(t,y));let v=e.vid;void 0!==v&&(Oq(t,136),Oq(t,v));let x=e.width;void 0!==x&&(Oq(t,144),jq(t,fq(x)));let _=e.service;void 0!==_&&(Oq(t,152),Oq(t,_));let E=e.callbackData;void 0!==E&&(Oq(t,162),Nq(t,E));let b=e.jpgEncryption;void 0!==b&&(Oq(t,168),Oq(t,b));let w=e.requestType;void 0!==w&&(Oq(t,176),Oq(t,w));let N=e.scorePorn;void 0!==N&&(Oq(t,185),Iq(t,N));let S=e.scoreSexy;void 0!==S&&(Oq(t,193),Iq(t,S));let T=e.scoreNeutral;void 0!==T&&(Oq(t,201),Iq(t,T));let C=e.scene;void 0!==C&&(Oq(t,208),Oq(t,C));let R=e.ossFilePrefix;void 0!==R&&(Oq(t,218),Nq(t,R));let I=e.serviceVendor;if(void 0!==I)for(let A of I){Oq(t,226);let e=yq();lq(A,e),Oq(t,e.limit),Sq(t,e),vq(e)}}(e,t),function(e){let t=e.bytes,s=e.limit;return t.length===s?t:t.subarray(0,s)}(t)}function oq(e){return function(e){let t={};e:for(;!_q(e);){let s=Aq(e);switch(s>>>3){case 0:break e;case 1:t.code=Aq(e);break;case 2:t.msg=wq(e,Aq(e));break;case 3:{let s=dq(e);t.data=cq(e),e.limit=s;break}default:uq(e,7&s)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function cq(e){let t={};e:for(;!_q(e);){let s=Aq(e);switch(s>>>3){case 0:break e;case 1:t.requestId=wq(e,Aq(e));break;case 2:t.requestType=Aq(e)>>>0;break;case 3:t.scorePorn=Rq(e);break;case 4:t.scoreSexy=Rq(e);break;case 5:t.scoreNeutral=Rq(e);break;case 6:t.requestScene=Aq(e)>>>0;break;case 7:t.scene=Aq(e)>>>0;break;default:uq(e,7&s)}}return t}function lq(e,t){let s=e.service;void 0!==s&&(Oq(t,8),Oq(t,s));let n=e.vendor;void 0!==n&&(Oq(t,16),Oq(t,n));let r=e.token;void 0!==r&&(Oq(t,26),Nq(t,r));let i=e.callbackUrl;void 0!==i&&(Oq(t,34),Nq(t,i))}function dq(e){let t=Aq(e),s=e.limit;return e.limit=e.offset+t,s}function uq(e,t){switch(t){case 0:for(;128&Tq(e););break;case 2:xq(e,Aq(e));break;case 5:xq(e,4);break;case 1:xq(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let hq=new Float32Array(1);new Uint8Array(hq.buffer);let pq=new Float64Array(1),mq=new Uint8Array(pq.buffer);function fq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let gq=[];function yq(){const e=gq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function vq(e){gq.push(e)}function xq(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function _q(e){return e.offset>=e.limit}function Eq(e,t){let s=e.bytes,n=e.offset,r=e.limit,i=n+t;if(i>s.length){let t=new Uint8Array(2*i);t.set(s),e.bytes=t}return e.offset=i,i>r&&(e.limit=i),n}function bq(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function wq(e,t){let s=bq(e,t),n=String.fromCharCode,r=e.bytes,i="\ufffd",a="";for(let o=0;o<t;o++){let e,c,l,d,u=r[o+s];0==(128&u)?a+=n(u):192==(224&u)?o+1>=t?a+=i:(e=r[o+s+1],128!=(192&e)?a+=i:(d=(31&u)<<6|63&e,d<128?a+=i:(a+=n(d),o++))):224==(240&u)?o+2>=t?a+=i:(e=r[o+s+1],c=r[o+s+2],32896!=(49344&(e|c<<8))?a+=i:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=i:(a+=n(d),o+=2))):240==(248&u)?o+3>=t?a+=i:(e=r[o+s+1],c=r[o+s+2],l=r[o+s+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=i:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=i:(d-=65536,a+=n(55296+(d>>10),56320+(1023&d)),o+=3))):a+=i}return a}function Nq(e,t){let s=t.length,n=0;for(let a=0;a<s;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<s&&(e=(e<<10)+t.charCodeAt(++a)-56613888),n+=e<128?1:e<2048?2:e<65536?3:4}Oq(e,n);let r=Eq(e,n),i=e.bytes;for(let a=0;a<s;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<s&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?i[r++]=e:(e<2048?i[r++]=e>>6&31|192:(e<65536?i[r++]=e>>12&15|224:(i[r++]=e>>18&7|240,i[r++]=e>>12&63|128),i[r++]=e>>6&63|128),i[r++]=63&e|128)}}function Sq(e,t){let s=Eq(e,t.limit),n=e.bytes,r=t.bytes;for(let i=0,a=t.limit;i<a;i++)n[i+s]=r[i]}function Tq(e){return e.bytes[bq(e,1)]}function Cq(e,t){let s=Eq(e,1);e.bytes[s]=t}function Rq(e){let t=bq(e,8),s=e.bytes;return mq[0]=s[t++],mq[1]=s[t++],mq[2]=s[t++],mq[3]=s[t++],mq[4]=s[t++],mq[5]=s[t++],mq[6]=s[t++],mq[7]=s[t++],pq[0]}function Iq(e,t){let s=Eq(e,8),n=e.bytes;pq[0]=t,n[s++]=mq[0],n[s++]=mq[1],n[s++]=mq[2],n[s++]=mq[3],n[s++]=mq[4],n[s++]=mq[5],n[s++]=mq[6],n[s++]=mq[7]}function Aq(e){let t,s=0,n=0;do{t=Tq(e),s<32&&(n|=(127&t)<<s),s+=7}while(128&t);return n}function Oq(e,t){for(t>>>=0;t>=128;)Cq(e,127&t|128),t>>>=7;Cq(e,t)}function jq(e,t){let s=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,i=0===r?0===n?s<16384?s<128?1:2:s<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:r<128?9:10,a=Eq(e,i),o=e.bytes;switch(i){case 10:o[a+9]=r>>>7&1;case 9:o[a+8]=9!==i?128|r:127&r;case 8:o[a+7]=8!==i?n>>>21|128:n>>>21&127;case 7:o[a+6]=7!==i?n>>>14|128:n>>>14&127;case 6:o[a+5]=6!==i?n>>>7|128:n>>>7&127;case 5:o[a+4]=5!==i?128|n:127&n;case 4:o[a+3]=4!==i?s>>>21|128:s>>>21&127;case 3:o[a+2]=3!==i?s>>>14|128:s>>>14&127;case 2:o[a+1]=2!==i?s>>>7|128:s>>>7&127;case 1:o[a]=1!==i?128|s:127&s}}function kq(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}const Dq=new Map([["moderation",1],["supervise",2]]);class Pq extends HR{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(NM.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=rr(t=e.map(e=>Dq.get(e)||0)).call(t,(e,t)=>e+t),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),uS(this,"name","AgoraRTCVideoContentInspect"),uS(this,"_connectionState",bM.CONNECTING),uS(this,"_innerConnectionState",void 0),uS(this,"sequence",0),uS(this,"inspectStartTime",void 0),uS(this,"workerManagerConnection",void 0),uS(this,"workerConnection",void 0),uS(this,"workerMessageLengthLimit",void 0),uS(this,"inspectIntervalMinimum",void 0),uS(this,"qualityRatio",void 0),uS(this,"_connectInfo",void 0),uS(this,"_cancelTokenSource",LC.CancelToken.source()),uS(this,"_retryConfig",void 0),uS(this,"wmSequence",0),uS(this,"inspectInterval",void 0),uS(this,"inspectTimer",null),uS(this,"ossFilePrefix",void 0),uS(this,"extraInfo",void 0),uS(this,"_inspectType",void 0),uS(this,"_inspectMode",void 0),uS(this,"_quality",1),uS(this,"qualityTimer",null),uS(this,"_inspectId",void 0),uS(this,"_needWorkUrlOnly",!1),uS(this,"inspectImage",()=>{if(this.connectionState!==bM.CONNECTED)throw new fO(RR.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===bM.CONNECTED?this.requestToInspectImage():aO.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=SI(5,"inspect-"),this.workerMessageLengthLimit=RA("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=RA("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=RA("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new JM("worker-manager-"+this._inspectId,FI),this.on(NM.STATE_CHANGE,(e,t)=>{this._innerConnectionState=e,aO.debug("[".concat(this._inspectId,"] Inspect operation :").concat(wM[e]," ").concat(t||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new JM("worker-"+this._inspectId,FI),this.handleWorkerEvents()}async init(e,t){this.emit(NM.STATE_CHANGE,wM.CONNECT_AP),this._connectInfo=e;const s=this._cancelTokenSource.token;return this._retryConfig=t,new sp((n,r)=>{this.on(NM.CONNECTION_STATE_CHANGE,(e,t)=>{t===bM.CONNECTED&&n()}),this.requestAP(e,s,t).then(e=>{this.connectWorkerManager(e)}).catch(e=>{r(e)})})}async requestAP(e,t,s){const n=RA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),r=await function(e,t,s,n){let{appId:r,areaCode:i,cname:a,sid:o,token:c,uid:l}=t;CV++;const d="image_moderation_api",u={service_name:d,json_body:JSON.stringify({appId:r,areaCode:i,cname:a,command:"allocateEdge",requestId:CV,seq:CV,sid:o,token:c,ts:Date.now(),uid:l+""})};let h,p,m=e[0];return GI(async()=>{h=Date.now();const e=await iV(m,{data:u,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw aO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw aO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new fO(RR.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw aO.error(e.toString()),e}const n=RA("VIDEO_INSPECT_WORKER_MANAGER_HOST"),r=RA("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map(e=>{let{address:t,wss:s}=e;if(t&&s)return"wss://".concat(t.replace(/\./g,"-"),".").concat(n,":").concat(r||s)}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,responseTime:p}},(t,s)=>(mO.apworkerEvent(o,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===s,responseTime:p,serverIp:e[s%e.length]}),!1),(t,s)=>(mO.apworkerEvent(o,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[s%e.length]}),!!(t.code!==RR.OPERATION_ABORTED&&t.code!==RR.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(s+1)%e.length],!0)),n)}(n,e,t,s);this.emit(NM.STATE_CHANGE,wM.AP_CONNECTED);const{addressList:i}=r;return this.wmSequence++,i}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(NM.STATE_CHANGE,wM.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(BL.CONNECTED,async()=>{this.emit(NM.STATE_CHANGE,wM.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(BL.CLOSED,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(BL.FAILED,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(BL.RECONNECTING,()=>{this._innerConnectionState<wM.GET_WORKER_MANAGER_RESPONSE&&aO.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(BL.ON_MESSAGE,async e=>{this.emit(NM.STATE_CHANGE,wM.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(e.data);if(200!==s.code)throw aO.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new fO(RR.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&t))throw aO.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new fO(RR.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const e=RA("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,n=t.replace(/:\d+\/?$/,":".concat(e));this.emit(NM.STATE_CHANGE,wM.CONNECT_WORKER,n),this._needWorkUrlOnly?this.emit(NM.REQUEST_NEW_WORKER_URL,n):await this.connectWorker(n)}}),this.workerManagerConnection.on(BL.WILL_RECONNECT,(e,t,s)=>{s(e)}),this.workerManagerConnection.on(BL.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(BL.CONNECTED,async()=>{this.emit(NM.STATE_CHANGE,wM.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=bM.CONNECTED}),this.workerConnection.on(BL.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const s=oq(new Uint8Array(e.data));if(RA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&aO.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),200===s.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(NM.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var t;const e={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},n=rr(t=Object.keys(e)).call(t,(t,s)=>e[t]>e[s]?t:s,"porn"),r=Object.keys(e).find(e=>e===n);this.emit(NM.INSPECT_RESULT,r)}else this.emit(NM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(NM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else aO.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(NM.INSPECT_RESULT,void 0,new fO(RR.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(BL.CLOSED,()=>{this.connectionState=bM.CLOSED}),this.workerConnection.on(BL.FAILED,()=>{this.connectionState=bM.CLOSED}),this.workerConnection.on(BL.RECONNECTING,()=>{this.connectionState=this.connectionState===bM.CONNECTED?bM.RECONNECTING:bM.CONNECTING}),this.workerConnection.on(BL.WILL_RECONNECT,(e,t,s)=>{"recover"===e&&s(e),s("tryNext")}),this.workerConnection.on(BL.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(NM.REQUEST_NEW_WORKER_URL,t=>{e([t])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e=>{this.connectWorkerManager(e,!0)}).catch(e=>{t(e)})})}async requestToInspectImage(){this.sequence++;const e=oI(this,NM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(NM.INSPECT_RESULT,void 0,new fO(RR.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(e,t);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(NM.INSPECT_RESULT,void 0,new fO(RR.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:s,cname:n,cid:r,vid:i,sid:a,uid:o}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await Qj(l,s,n),u=this.sequence+"-"+r+"-"+o+"-"+c+"-"+SI(12,""),h={appId:s,cid:r,cname:n,deviceId:"",elapse:(p=Number(c-this.inspectStartTime),{low:p|=0,high:p>>31,unsigned:p>=0}),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.24.0",sequence:this.sequence,sid:a,timestamp:uG(c),uid:o,vid:i,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var p;void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const m=aq(h);if(m.byteLength<this.workerMessageLengthLimit){if(RA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?kq(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):kq(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},h);delete e.jpg,aO.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return m}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:s,cname:n,cid:r,vid:i,sid:a,uid:o})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=LC.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=bM.CLOSED,this.emit(NM.STATE_CHANGE,wM.CLOSED)}}const Lq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new fO(RR.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new fO(RR.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach(e=>{var t;if(!Dn(t=["supervise","moderation"]).call(t,e))throw new fO(RR.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new fO(RR.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Pq(t)}};var Mq=n(ee.Object.getOwnPropertySymbols),Uq=As,Vq=Xs.indexOf,Fq=Hn,Bq=S([].indexOf),Gq=!!Bq&&1/Bq([1],1,-0)<0;Uq({target:"Array",proto:!0,forced:Gq||!Fq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Gq?Bq(this,e,t)||0:Vq(this,e,t)}});var Wq=$s("Array","indexOf"),Hq=u,Kq=Wq,zq=Array.prototype,qq=function(e){var t=e.indexOf;return e===zq||Hq(zq,e)&&t===zq.indexOf?Kq:t},Yq=n(qq);function Xq(e,t){if(null==e)return{};var s,n,r=function(e,t){if(null==e)return{};var s={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==Yq(t).call(t,n))continue;s[n]=e[n]}return s}(e,t);if(Mq){var i=Mq(e);for(n=0;n<i.length;n++)s=i[n],-1===Yq(t).call(t,s)&&{}.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}let Jq=class{get localCapabilities(){return pI(this._localCapabilities)}get rtpCapabilities(){return pI(this._rtpCapabilities)}get candidates(){return pI(this._candidates)}get iceParameters(){return pI(this._iceParameters)}get dtlsParameters(){return pI(this._dtlsParameters)}constructor(e){uS(this,"sessionDesc",void 0),uS(this,"_localCapabilities",void 0),uS(this,"_rtpCapabilities",void 0),uS(this,"_candidates",void 0),uS(this,"_iceParameters",void 0),uS(this,"_dtlsParameters",void 0),uS(this,"setup",void 0),uS(this,"currentMidIndex",void 0),uS(this,"cname","o/i14u9pJrxRKAsu"),uS(this,"firefoxSsrcMidMap",new Map),e=pI(e);const{remoteIceParameters:t,remoteDtlsParameters:s,candidates:n,remoteRTPCapabilities:r,localCapabilities:i,direction:a,setup:o,videoCodec:c,audioCodec:l}=e;let d;this.setup=o,d=a===FL.RECEIVE_ONLY?VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=r,this._candidates=n,this._iceParameters=t,this._dtlsParameters=s,this._localCapabilities=i;const u=a===FL.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===FL.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===FL.RECEIVE_ONLY?r.send.videoCodecs:UU(fM.VIDEO,u,h,c),m=a===FL.RECEIVE_ONLY?r.send.audioCodecs:UU(fM.AUDIO,u,h,l);for(const f of d.mediaDescriptions)f.attributes.iceUfrag=t.iceUfrag,f.attributes.icePwd=t.icePwd,f.attributes.fingerprints=s.fingerprints,f.attributes.candidates=n,f.attributes.setup=this.setup,"application"===f.media.mediaType&&(f.attributes.sctpPort="5000"),"video"===f.media.mediaType&&(f.media.fmts=p.map(e=>e.payloadType.toString(10)),f.attributes.payloads=p,f.attributes.extmaps=u.videoExtensions),"audio"===f.media.mediaType&&(f.media.fmts=m.map(e=>e.payloadType.toString(10)),f.attributes.payloads=m,f.attributes.extmaps=u.audioExtensions,MU(f));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return FA(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,s,n,r){s=s.replace(/ /g,"-");const{ssrcs:i,ssrcGroups:a}=TU(t,this.cname,RA("SYNC_GROUP")?s:void 0),o=this.findPreloadMediaDesc(i);if(o){if(sR()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,o.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(o,r),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i,n);let s;return-1===t?(s=this.createOrRecycleSendMedia(e,i,a,"sendonly",n,r),this.updateBundleMids()):(s=pI(this.sessionDesc.mediaDescriptions[t]),s.attributes.direction="sendonly",s.attributes.ssrcs=i,s.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(s,r)),sR()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),{needExchangeSDP:!0,mid:s.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{e.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,s){const n=[];return e.forEach(e=>{const r=e._mediaStreamTrack.kind,i=this.findAvailableRecvMediaIndex(r);let a,o=!1;-1===i?(o=!0,a=this.createOrRecycleRecvMedia(e,[],"recvonly",t,s),this.updateBundleMids()):(a=pI(this.sessionDesc.mediaDescriptions[i]),a.attributes.direction="recvonly"),n.push({mid:a.attributes.mid,needCreateTransceiver:o})}),n}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:s,address:n,port:r,type:i,relatedAddress:a,relatedPort:o,priority:c}=new RTCIceCandidate(e),l={foundation:null!=t?t:"",componentId:"1",transport:null!=s?s:"",priority:c?c+"":"",connectionAddress:null!=n?n:"",port:r?r+"":"",type:i?i+"":"",relAddr:null!=a?a:"",relPort:o?o+"":"",extension:{}};this.candidates.some(e=>e.priority===l.priority&&e.connectionAddress===l.connectionAddress&&e.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,s,n,r){const i=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,o=UU(i,a,this.localCapabilities.send,i===fM.AUDIO?r:n),c=i===fM.VIDEO?a.videoExtensions:a.audioExtensions,l="".concat(++this.currentMidIndex);let d={media:{mediaType:i,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);const u=this.findFirstClosedMedia(i);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,s){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(sR()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r&&n.attributes.mid===s})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const s=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&s})}predictReceivingMids(e){const t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}restartICE(e){e=pI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,s,n,r,i){const a=this.rtpCapabilities.send,o=e===fM.VIDEO?a.videoCodecs:a.audioCodecs,c=e===fM.VIDEO?a.videoExtensions:a.audioExtensions;sR()&&(r="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:r}};l=this.mungSendMediaDesc(l,i);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,s){const n=pI(e);return RU(n),CU(n,t),IU(n,t),AU(n),OU(n,s,this.localCapabilities.send),n}mungSendMediaDesc(e,t){const s=pI(e);return OU(s,t,this.localCapabilities.recv),MU(s),s}updateRecvMedia(e,t){const s=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==s){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return(null===(s=t.attributes)||void 0===s||null===(s=s.ssrcs[0])||void 0===s?void 0:s.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>sR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}};const Qq=["sdp"];var Zq;function $q(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function eY(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?$q(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$q(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let tY=(Zq=class e extends pM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,s,n){super(t,s),uS(this,"direction",void 0),uS(this,"name",void 0),uS(this,"store",void 0),uS(this,"spec",void 0),uS(this,"peerConnection",void 0),uS(this,"initialOffer",void 0),uS(this,"transport",void 0),uS(this,"statsFilter",void 0),uS(this,"localCandidateCount",0),uS(this,"_isInRestartIce",!1),uS(this,"mutex",void 0),uS(this,"onLocalCandidate",void 0),uS(this,"remoteSDP",void 0),uS(this,"pendingCandidates",[]),uS(this,"localCapabilities",void 0),uS(this,"isReady",!1),uS(this,"restartCnt",0),uS(this,"curTurnServerIndex",0),this.store=s,this.spec=t,this.mutex=new UI("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=n?n:FL.SEND_ONLY,this.name=this.direction===FL.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,sR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await kU();if(this.localCapabilities=LU(t),e){const{sdp:t}=e,s=Xq(e,Qq),n=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=EU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(PU(t,e,"videoExtensions",s,n,r),PU(t,e,"videoCodecs",s,n,r),PU(t,e,"audioExtensions",s,n,r),PU(t,e,"audioCodecs",s,n,r),RA("RAISE_H264_BASELINE_PRIORITY")){const e=r.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=r.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){aO.debug("raising H264 baseline profile priority");const s=r.videoCodecs[e];r.videoCodecs.splice(e,1),r.videoCodecs.splice(t,0,s)}-1!==t&&RA("FILTER_SEND_H264_BASELINE")&&(s.videoCodecs=s.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:s,recv:n,sendrecv:r}}({},{},t);this.remoteSDP=new Jq({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:n,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const i=bU(r.sdp);await this.peerConnection.setLocalDescription(r);const a=await DU({},{},r.sdp);this.localCapabilities=LU(a);const o=this.peerConnection.getTransceivers()[0];return null!=o&&o.receiver&&o.receiver.transport&&this.tryBindTransportEvents(o.receiver.transport),eY(eY({},i),{},{sdp:r.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=bU(e.sdp);return this.initialOffer=e,eY(eY({},t),{},{sdp:e.sdp})}}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:s,dtlsParameters:n}=e,r=await DU({},{},t);this.remoteSDP=new Jq({remoteIceParameters:s,remoteDtlsParameters:n,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const i=this.peerConnection.getTransceivers()[0];null!=i&&i.sender&&i.sender.transport&&this.tryBindTransportEvents(i.sender.transport)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(e=>{this.peerConnection.addIceCandidate(e)}),this.pendingCandidates=[])}catch(e){throw new IR(RR.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,s){var n=this;return YT(function*(){const r=yield JT(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=[],i=n.remoteSDP.receive(e,t,s);e.forEach((e,t)=>{if(i[t].needCreateTransceiver){const t=n.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});r.push(t),e._updateRtpTransceiver(t)}else{const s=n.peerConnection.getTransceivers().find(e=>e.mid===i[t].mid);if(!s)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(i[t].mid));r.push(s),e._updateRtpTransceiver(s)}}),sR()&&!0===RA("SIMULCAST")&&(yield JT(n.applySimulcastForFirefox(r,e)));const a=i.map(e=>e.mid),o=yield JT(n.peerConnection.createOffer()),c=n.mungSendOfferSDP(o.sdp,e,a),l=VA(c),d=a.map(e=>{const t=l.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(t,RA("USE_PUB_RTX"))}),u=r.map((e,t)=>{const s=a[t];return{localSSRC:d[t],id:s}});yield JT(n.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield u}catch(e){const s=n.remoteSDP.toString();throw yield JT(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JT(n.peerConnection.setRemoteDescription({type:"answer",sdp:s})),yield JT(n.stopSending(a,!0)),e}yield JT(n.applySimulcastEncodings(r,e)),yield JT(n.applySendEncodings(r,e));const h=n.remoteSDP.toString(),p=n.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield JT(n.setRemoteDescription({type:"answer",sdp:h})),r.map((e,t)=>{const s=a[t];return{localSSRC:d[t],id:s}})}catch(e){throw e instanceof IR?e:new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}})()}async stopSending(e,t){const s=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map(e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const s=await this.peerConnection.createOffer(),n=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();null==n||n(r),await this.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{s&&s()}}async receive(e,t,s,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:r,needExchangeSDP:i}=this.remoteSDP.send(e,t,s,n);if(i){const t=this.remoteSDP.toString(),s=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer(),i=this.mungReceiveAnswerSDP(n.sdp,r,e);null==s||s(i||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:i}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(e=>e.mid===r);if(!a||null===a.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,s,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:r,needExchangeSDP:i}=this.remoteSDP.send(e,t,s,n);if(i){const t=this.remoteSDP.toString(),s=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer(),i=this.mungReceiveAnswerSDP(n.sdp,r,e);null==s||s(i||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:i}),aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else aO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),s=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();null==s||s(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===_A.Auto&&(this.store.p2pTransport=_A.SdRtn,yO().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,yO().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=bU(e.sdp);return this.store.descriptionStart(),this.direction===FL.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===FL.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=bU(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(s.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const r=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),null==i||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const s=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===s.length&&(this.isVP8Simulcast(t)?sR()||await this.applySimulcastEncodings(s,[t]):await this.applySendEncodings(s,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const s=this.peerConnection.getTransceivers().find(e=>e.mid===t);s&&await s.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:s,remote:n}=t.getSelectedCandidatePair();return{local:eY(eY({},$I),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:eY(eY({},$I),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Dn(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,s){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r={iceServers:[]};var i;return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZR(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,s,n)),RA("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,s,n)),Dn(i=[_A.Relay,_A.SdRtn]).call(i,s)&&(r.iceTransportPolicy="relay"),RA("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(r.iceTransportPolicy="relay")}))),RA("ENABLE_ENCODED_TRANSFORM")&&yO().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),aO.debug("P2PConnection p2pTransport is ".concat(s)),r}static turnServerConfigToIceServers(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=[],r=e.filter(e=>e.tcpport);aO.debug("P2PConnection turnServers is ".concat(r,", current index is ").concat(s));const i=r.length>s?r[s]:r[0];switch(t){case _A.SdRtn:const t=e.filter(e=>{var t;return Dn(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL}),r=t.length>s?t[s]:t[0];r&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(sU(r.turnServerURL),":").concat(r.tcpport,"?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(sU(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}));break;case _A.Relay:i&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(sU(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;default:i&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(sU(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"stun:".concat(i.turnServerURL,":").concat(i.tcpport)}))}return n}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var s;t&&(null===(s=this.onICETransportStateChange)||void 0===s||s.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:s}=t.getSelectedCandidatePair()||{};if(e&&s){const t=e.address+":"+e.port,n=s.address+":"+s.port;aO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(hU(t)),", remote ").concat(JSON.stringify(hU(n))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var s;if(t||(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return aO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!yO().supportSetRtpSenderParameters)return aO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const n={},r={};switch(e._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(e._encoderConfig){var i;const{bitrateMax:t,frameRate:s,scaleResolutionDownBy:n}=e._encoderConfig;t&&(r.maxBitrate=1e3*t),Dn(i=e._hints).call(i,UO.LOW_STREAM)&&(s&&(r.maxFramerate=iU(s)),n&&n>=1&&(r.scaleResolutionDownBy=n))}if(RA("DSCP_TYPE")&&bR()){var a;const e=RA("DSCP_TYPE");Dn(a=["very-low","low","medium","high"]).call(a,e)&&(r.networkPriority=e)}const o=t.getParameters(),c=null===(s=o.encodings)||void 0===s?void 0:s[0];sR()&&!c&&(n.encodings=[r]),c&&Object.assign(c,r),Object.assign(o,n),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await t.setParameters(o)}async applySendEncodings(e,t){try{if(!yO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let s=0;s<e.length;s++){const n=e[s],r=t[s];r instanceof DD&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,n.sender)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,s){const n=VA(e);return t.forEach((e,t)=>{const r=s[t],i=n.mediaDescriptions.find(e=>e.attributes.mid===r);i&&(CU(i,e),jU(i,e,this.store.codec))}),FA(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,s)=>{var n;null===(n=this.onFirstVideoDecoded)||void 0===n||n.call(this,e,t,s)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let o=0;o<e.length;o++){var s,n,r,i,a;const c=e[o],l=t[o];if(l instanceof DD&&!Dn(s=l._hints).call(s,UO.LOW_STREAM)&&null!==(n=l._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=l._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=l._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const s=c.sender.getParameters();await c.sender.setParameters(Object.assign(s,e))}}}async applySimulcastEncodings(e,t){if(!sR()&&e.length===t.length)for(let s=0;s<e.length;s++){const n=t[s];if(n instanceof DD&&this.isVP8Simulcast(n)){const t=e[s],r={},i={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};r.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:i.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:i.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,r))}}}isVP8Simulcast(e){var t,s,n,r,i;return!!(e instanceof DD&&RA("SIMULCAST")&&"vp8"===this.store.codec&&!Dn(t=e._hints).call(t,UO.LOW_STREAM)&&null!==(s=e._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabilityMode)||void 0===i?void 0:i.numSpatialLayers)>1)}logSDPExchange(e,t,s,n){if(RA("SDP_LOGGING"))return aO.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(t," SDP during P2PConnection.").concat(n,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===s?"remote":"local",n)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const s=await this.peerConnection.createOffer(),n=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(e);const r=this.remoteSDP.toString();null==n||n(r),await this.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async e=>{e.direction="sendonly"});const s=await this.peerConnection.createOffer(),n=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(e);const r=this.remoteSDP.toString();null==n||n(r),await this.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var s;if(t=null!=t?t:null===(s=this.currentRemoteDescription)||void 0===s?void 0:s.sdp){var n;const s=null===(n=VA(t).mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===n?void 0:n.attributes.ssrcs;return null==s?void 0:s[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Dn(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,s){const n=VA(e),r=n.mediaDescriptions.find(e=>e.attributes.mid===t);return r&&s===fM.AUDIO&&"audio"===r.media.mediaType&&MU(r),FA(n)}},IL(Zq.prototype,"establish",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"establish"),Zq.prototype),IL(Zq.prototype,"connect",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"connect"),Zq.prototype),IL(Zq.prototype,"receive",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"receive"),Zq.prototype),IL(Zq.prototype,"mockReceive",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"mockReceive"),Zq.prototype),IL(Zq.prototype,"stopReceiving",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"stopReceiving"),Zq.prototype),IL(Zq.prototype,"restartICE",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"restartICE"),Zq.prototype),IL(Zq.prototype,"close",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"close"),Zq.prototype),IL(Zq.prototype,"updateEncoderConfig",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateEncoderConfig"),Zq.prototype),IL(Zq.prototype,"updateSendParameters",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"updateSendParameters"),Zq.prototype),IL(Zq.prototype,"replaceTrack",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"replaceTrack"),Zq.prototype),IL(Zq.prototype,"muteLocal",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"muteLocal"),Zq.prototype),IL(Zq.prototype,"unmuteLocal",[sY],Object.getOwnPropertyDescriptor(Zq.prototype,"unmuteLocal"),Zq.prototype),Zq);function sY(e,t,s){const n=e[t];if("function"!=typeof n)throw new Error("Cannot use mutex on object property.");return s.value=async function(){const e=this.mutex,s=await e.lock("From P2PConnection.".concat(t));try{for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return await n.apply(this,i)}finally{s()}},s}let nY=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var rY,iY,aY,oY,cY,lY,dY,uY,hY,pY,mY,fY;function gY(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function yY(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?gY(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):gY(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let vY=(rY=xY(nY.SEND_ONLY),iY=xY(nY.SEND_ONLY),aY=xY(),oY=xY(nY.RECEIVE_ONLY),cY=xY(nY.RECEIVE_ONLY),lY=xY(nY.RECEIVE_ONLY),dY=xY(nY.RECEIVE_ONLY),uY=xY(nY.RECEIVE_ONLY),hY=xY(nY.RECEIVE_ONLY),pY=xY(),mY=xY(nY.RECEIVE_ONLY),fY=class extends HR{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(EM.StateChange,t,this._state)}constructor(e,t){super(),uS(this,"isPlanB",!1),uS(this,"store",void 0),uS(this,"statsUploader",void 0),uS(this,"sendConnection",void 0),uS(this,"recvConnection",void 0),uS(this,"localTrackMap",new Map),uS(this,"remoteUserMap",new Map),uS(this,"localDataChannels",[]),uS(this,"pendingLocalTracks",[]),uS(this,"pendingRemoteTracks",[]),uS(this,"statsCollector",void 0),uS(this,"dtlsFailedCount",0),uS(this,"sendMutex",void 0),uS(this,"recvMutex",void 0),uS(this,"_state",_M.Disconnected),uS(this,"_restartStates",["disconnected","failed"]),uS(this,"reconnectInterval",void 0),uS(this,"uploadUnplinkStarted",!1),uS(this,"uploadDownlinkStarted",!1),uS(this,"uplinkStateUploadInterval",void 0),uS(this,"downlinkStatsUploadInterval",void 0),uS(this,"handleMuteLocalTrack",async(e,t,s)=>{const n=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==_M.Connected)return void s(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const n=this.filterTobeMutedTracks(e);if(0===n.length)return void t();const a=n.find(e=>"videoLowTrack"===e[0]);a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(n.map(e=>{let[,{id:t}]=e;return t}));let o=!1;var r,i;o="video"===e.trackMediaType?!(null===(r=this.localTrackMap.get(xM.LocalAudioTrack))||void 0===r||!r.track._muted):void 0===(null===(i=this.localTrackMap.get(xM.LocalVideoTrack))||void 0===i?void 0:i.id);const c=this.createMuteMessage(n);await aI(this,EM.RequestMuteLocal,c);const l="video"===e.trackMediaType?jM.MUTE_LOCAL_VIDEO:jM.MUTE_LOCAL_AUDIO;await aI(this,EM.RequestP2PMuteLocal,{action:l,message:c,isMuteAll:o}),t()}catch(e){s(e)}finally{n()}}),uS(this,"handleUnmuteLocalTrack",async(e,t,s)=>{const n=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==_M.Connected)return void s(new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const n=this.filterTobeUnmutedTracks(e);if(0===n.length)return void t();await this.sendConnection.unmuteLocal(n.map(e=>{let[,{id:t}]=e;return t}));const r=this.createUnmuteMessage(n),i="video"===e.trackMediaType?jM.UNMUTE_LOCAL_VIDEO:jM.UNMUTE_LOCAL_AUDIO;await aI(this,EM.RequestP2PMuteLocal,{action:i,message:r}),t()}catch(e){s(e)}finally{n()}}),uS(this,"handleUpdateVideoEncoder",async(e,t,s,n)=>{let r;"boolean"==typeof n&&n||(r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const s=this.localTrackMap.get(xM.LocalVideoTrack);if(!this.sendConnection||!s||s.track!==e||this.state!==_M.Connected)return void t();const{id:n,track:r}=s;n&&(await this.sendConnection.updateSendParameters(n,r),await this.sendConnection.updateEncoderConfig(n,r),this.emit(EM.UpdateVideoEncoder,r)),t()}catch(e){s(e)}finally{var i;null===(i=r)||void 0===i||i()}}),uS(this,"handleUpdateVideoSendParameters",async(e,t,s)=>{const n=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const s=this.localTrackMap.get(xM.LocalVideoTrack);if(!this.sendConnection||!s||s.track!==e||this.state!==_M.Connected)return void t();const{id:n,track:r}=s;n&&await this.sendConnection.updateSendParameters(n,r),t()}catch(e){s(e)}finally{n()}}),uS(this,"handleReplaceTrack",async(e,t,s,n)=>{let r;aO.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof n&&n||(r=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var i;const s=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:s}]=t;return e===s});if(!this.sendConnection||!s||void 0===s[1].id||this.state!==_M.Connected)return void t();if(await(null===(i=this.sendConnection)||void 0===i?void 0:i.replaceTrack(e,s[1].id)),s[0]===xM.LocalVideoTrack&&yO().supportDualStreamEncoding){const t=this.localTrackMap.get(xM.LocalVideoLowTrack);if(t){const s=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=s,t.track._originMediaStreamTrack=s,await new sp((e,s)=>{this.handleReplaceTrack(t.track,e,s,!0)})}}t()}catch(e){s(e)}finally{var a;null===(a=r)||void 0===a||a()}}),uS(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),uS(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),uS(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),uS(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new GF(e),this.bindStatsUploaderEvents(),this.sendMutex=new UI("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new UI("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))})},RA("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let s;try{if(t){this.recvConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new tY(e,this.store,FL.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const n=await this.recvConnection.establish(t);return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}{this.state=_M.New,this.sendConnection&&(aO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new tY(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{s&&s()}}async p2pConnect(e){if(!this.sendConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=_M.Connected}async addRemoteCandidate(e,t){if(t===FL.RECEIVE_ONLY){if(!this.sendConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new IR(RR.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,s){var n=this;return YT(function*(){const r=yield JT(n.sendMutex.lock("From P2PChannel.publish"));try{if(!n.sendConnection||n.state!==_M.Connected){n.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===n.pendingLocalTracks.indexOf(e));return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(t))}n.store.pubId=n.store.pubId+1,zV.markPublishStart(n.store.clientId,n.store.pubId);const r=n.filterTobePublishedTracks(e,t,s);if(0===r.length)return void(yield JT(n.tryToUnmuteAudio(e)));r.forEach(e=>{let{track:t,type:s}=e;const r=Date.now();n.store.publish(t.getTrackId(),s===xM.LocalAudioTrack?"audio":"video",r)}),n.bindLocalTrackEvents(r);const i=yield JT(n.sendConnection.send(r.map(e=>{let{track:t}=e;return t}),n.store.codec,n.store.audioCodec)),a=(yield JT(i.next())).value,o=n.createGatewayPublishMessage(r,a);try{yield o}catch(e){throw i.throw(e),(null==e?void 0:e.code)===RR.WS_ABORT&&r.forEach(e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)}),n.unbindLocalTrackEvents(r),e}yield JT(i.next()),r.forEach(e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)}),n.statsUploader.startUploadOutboundStats(),n.assignLocalTracks(r,a),r.forEach(e=>{let{track:t,type:s}=e;const r=Date.now();n.store.publish(t.getTrackId(),s===xM.LocalAudioTrack?"audio":"video",void 0,r)}),n.startUploadUplinkState()}finally{r()}})()}async unpublish(e){if(!this.sendConnection||this.state!==_M.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(t=>!Dn(e).call(e,t)));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const s=t.find(e=>"videoLowTrack"===e[0]);s&&s[1].track.close();const n=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:s}]=e;return{type:t,track:s}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===_M.Connected)return s&&s[1].track.close(),n;e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[n,{track:r,ssrcs:i}]=s;const a={stream_type:gF(r,n),ssrcs:i};r._muted||!r._enabled?e.push(a):t.push(a)}),e.length>0&&e.forEach(e=>{aI(this,EM.RequestMuteLocal,[e])}),t.length>0&&t.forEach(e=>{aI(this,EM.RequestUnmuteLocal,[e])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return YT(function*(){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(aO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await iI(this,EM.RequestRePublish,this.pendingLocalTracks),this.emit(EM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,s,n){var r;if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(r=this.remoteUserMap.get(e))&&void 0!==r&&r.has(t))return;const{track:i,mid:a,transceiver:o}=await this.recvConnection.receive(t,[{ssrcId:s}],String(e.uid),n);t===fM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(i):(e._audioTrack=new QD(i,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),o&&e._audioTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=s,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(i):(e._videoTrack=new JD(i,e.uid,e._uintid,this.store),aO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),o&&e._videoTrack._updateRtpTransceiver(o),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex(s=>{let{user:n,kind:r}=s;return n.uid===e.uid&&t===r});-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(EM.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,s,n){if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:s}],String(e.uid),n)}async unsubscribe(e,t,s){const n=this.pendingRemoteTracks.filter(s=>{let{user:n,kind:r}=s;return void 0!==t?n.uid===e.uid&&t===r:n.uid===e.uid});if(n.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.recvConnection||s||n.forEach(t=>{let{kind:s}=t;var n;if(s===fM.AUDIO)null===(n=e._audioTrack)||void 0===n||n._destroy(),e._audioTrack=void 0;else if(s===fM.VIDEO){var r;null===(r=e._videoTrack)||void 0===r||r._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(e,t);0!==r.length&&(await this.recvConnection.stopReceiving(r.map(e=>{let[,{id:t}]=e;return t})),this.withdrawRemoteTracks(r),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(e=>{let[t,{kind:n}]=e;var r,i;if(n===fM.VIDEO&&t._videoSSRC&&(null===(r=this.recvConnection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===fM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),s||(null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0);else if(n===fM.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),s||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),r.forEach(e=>{let[,{kind:t}]=e;aI(this,EM.RequestP2PMuteRemote,t)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[fM.VIDEO,fM.AUDIO].forEach(e=>{t.has(e)?aI(this,EM.RequestP2PUnmuteRemote,e):aI(this,EM.RequestP2PMuteRemote,e)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new IR(RR.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void aO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const n=t===fM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==n&&this.recvConnection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);s?s.get(t)||aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):aO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(xM.LocalAudioTrack);if((null==t?void 0:t.track)instanceof Wk){const s=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==xM.LocalAudioTrack}).filter(t=>{let[s]=t;return!(e&&s===xM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[s]=t;return!(e&&s===xM.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}reportPublishEvent(e,t,s,n,r){if(e){const s=this.localTrackMap.get(xM.LocalAudioTrack),i=n?this.localTrackMap.get(xM.LocalVideoLowTrack):this.localTrackMap.get(xM.LocalVideoTrack);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.track.getTrackLabel(),videoName:null==i?void 0:i.track.getTrackLabel(),screenshare:-1!==(null==i?void 0:i.track._hints.indexOf(UO.SCREEN_TRACK)),audio:!!s,video:!!i,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var i;s||(s=[]);const a=s.find(e=>e instanceof Fk),o=n?null===(i=this.localTrackMap.get(xM.LocalVideoTrack))||void 0===i?void 0:i.track:s.find(e=>e instanceof DD);mO.publish(this.store.sessionId,{eventElapse:zV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==o?void 0:o.getTrackLabel(),screenshare:-1!==(null==o?void 0:o._hints.indexOf(UO.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,s,n){const r=n===fM.VIDEO?s._videoSSRC:s._audioSSRC;r&&mO.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===fM.VIDEO,audio:n===fM.AUDIO,peerid:s.uid,subscribeRequestid:n===fM.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:zV.measureFromSubscribeStart(this.store.clientId,r)})}reset(){aO.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new UI("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new UI("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(xM.LocalAudioTrack);if((null==e?void 0:e.track)instanceof Wk){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=_M.Disconnected}getStats(e){var t,s;return e?null===(s=this.recvConnection)||void 0===s?void 0:s.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(xM.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(xM.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof DD||t&&t.track instanceof Fk?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(xM.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xp(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(aO.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=_M.Reconnecting,RA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&(null===(s=t._videoTrack._player.getVideoElement())||void 0===s||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:n}]=e;switch(s){case xM.LocalVideoTrack:Dn(t=n._hints).call(t,UO.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case xM.LocalAudioTrack:n instanceof Wk?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case xM.LocalVideoLowTrack:}}),this.emit(EM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(XA(s).call(s)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(EM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),aO.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const s of this.pendingRemoteTracks){const{user:n,kind:r}=s;if((e instanceof ZV?e.uid:e)===n.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let s,n;if(e===FL.SEND_ONLY){if(!this.sendConnection)throw new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),n=this.sendConnection}else{if(!this.recvConnection)throw new IR(RR.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),n=this.recvConnection}try{if(t){const e=await n.restartICE(t);return n.isInRestartIce=!1,e}{const e=await n.restartICE();if(e){const t=await iI(this,EM.RequestP2PRestartICE,{direction:FL.RECEIVE_ONLY,iceParameter:e});await n.restartICE(t),n.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(xM.LocalVideoTrack),s=this.localTrackMap.get(xM.LocalAudioTrack),n=e.videoSend.find(e=>{var s;return e.ssrc===(null==t||null===(s=t.ssrcs)||void 0===s?void 0:s[0].ssrcId)}),r=e.audioSend.find(e=>{var t;return e.ssrc===(null==s||null===(t=s.ssrcs)||void 0===t?void 0:t[0].ssrcId)});if(!n||!r)return 1;const i=oI(this,EM.NeedSignalRTT),a=n?n.rttMs:void 0,o=r?r.rttMs:void 0,c=a&&o?(a+o)/2:a||o,l=(c&&i?(c+i)/2:c||i)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(UO.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,s=e.bitrate.actualEncoded;if(t&&s){const e=(1e3*t-s)/(1e3*t);return GP[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[n]=s;const r=n._audioSSRC,i=n._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===r),o=e.videoRecv.find(e=>e.ssrc===i);if(!a&&!o)return void(t+=1);const c=oI(this,EM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new sp((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}filterTobePublishedTracks(e,t,s){const n=[],r=yO(),i=this.getAllTracks();e=uI(e=e.filter(e=>-1===i.indexOf(e)));let a=!1,o=!1;for(const c of e){if(c instanceof DD&&(this.localTrackMap.has(xM.LocalVideoTrack)||a?new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:c,type:xM.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,s);n.push({track:e,type:xM.LocalVideoLowTrack})}if(c instanceof Fk){const e=this.localTrackMap.get(xM.LocalAudioTrack);if(e){if(!(e.track instanceof Wk))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(o){const e=n.find(e=>{let{type:t}=e;return t===xM.LocalAudioTrack});if(!(e.track instanceof Wk))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!r.webAudioMediaStreamDest||c instanceof Wk||c._bypassWebAudio)n.push({track:c,type:xM.LocalAudioTrack});else{const e=new Wk;e.addAudioTrack(c),n.push({track:e,type:xM.LocalAudioTrack})}o=!0}}}return n}filterTobeUnpublishedTracks(e){const t=[],s=this.getAllTracks();e=uI(e=e.filter(e=>-1!==s.indexOf(e)));for(const n of e){if(n instanceof Fk){const e=this.localTrackMap.get(xM.LocalAudioTrack);if(!e)continue;e.track instanceof Wk?(e.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===e.track.trackList.length&&(t.push([xM.LocalAudioTrack,e]),e.track.close())):t.push([xM.LocalAudioTrack,e])}if(n instanceof DD){const e=this.localTrackMap.get(xM.LocalVideoTrack);if(!e)continue;t.push([xM.LocalVideoTrack,e]);const s=this.localTrackMap.get(xM.LocalVideoLowTrack);s&&t.push([xM.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:s}=e;switch(s){case xM.LocalVideoTrack:t.addListener(MO.GET_STATS,this.handleGetLocalVideoStats),t.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xM.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case xM.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Wk?e.trackList.forEach(e=>{e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(MO.GET_STATS,this.handleGetLocalAudioStats),e.addListener(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:s}]=e;return{track:s,type:t}})),e.forEach(e=>{let{track:t,type:s}=e;switch(s){case xM.LocalVideoTrack:t.off(MO.GET_STATS,this.handleGetLocalVideoStats),t.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(MO.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(MO.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xM.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case xM.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Wk?e.trackList.forEach(e=>{e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(MO.GET_STATS,this.handleGetLocalAudioStats),e.off(MO.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(MO.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(MO.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(MO.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof JD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof QD&&t.addListener(MO.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(MO.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(fM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(fM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,s)=>{var n;let r,{track:i,type:a}=e;switch(a){case xM.LocalAudioTrack:r=nM.Audio;break;case xM.LocalVideoTrack:r=Dn(n=i._hints).call(n,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalVideoLowTrack:r=nM.Low}return{kind:a===xM.LocalAudioTrack?fM.AUDIO:fM.VIDEO,stream_type:r,mid:t[s].id,ssrcs:t[s].localSSRC,isMuted:i.muted||!i.enabled}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let s,[n,{track:r,ssrcs:i,id:a}]=e;switch(n){case xM.LocalVideoTrack:s=Dn(t=r._hints).call(t,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalAudioTrack:s=nM.Audio;break;case xM.LocalVideoLowTrack:s=nM.Low}return{stream_type:s,ssrcs:i,mid:a}})}assignLocalTracks(e,t){e.forEach((e,s)=>{let{track:n,type:r}=e;this.localTrackMap.set(r,{track:n,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var s;aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(EM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Dn(s=this._restartStates).call(s,t)&&!e.isInRestartIce&&("disconnected"===t&&await NI(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),mO.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:YR.TRACER}).onSuccess(),this.emit(EM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var n;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),null===(n=s.audioTrack)||void 0===n||n.emit(HO.FIRST_FRAME_DECODED),mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_DECODE,uO.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);s&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_AUDIO_RECEIVED,uO.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,s)=>{this.reportVideoFirstFrameDecoded(e,t,s)},e.onFirstVideoReceived=e=>{var t;const s=Array.from(XA(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);s&&mO.firstRemoteFrame(this.store.sessionId,dO.FIRST_VIDEO_RECEIVED,uO.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const s="relay"===e.candidateType,n="relay"===t.candidateType;"unknown"!==t.candidateType&&s===n||this.emit(EM.ConnectionTypeChange,s),aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{aO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uU(t))," -> ").concat(JSON.stringify(uU(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(EM.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===FL.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,aO.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===FL.SEND_ONLY?this.restartICE(e):iI(this,EM.RequestP2PRestartICE,{direction:FL.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const s=this.localTrackMap.get(xM.LocalAudioTrack);if(e instanceof Fk&&(null==s?void 0:s.track)instanceof Wk)return s.track.isActive||t.push([xM.LocalAudioTrack,s]),t;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:s}]=t;return e===s});if(n&&(t.push(n),n[0]===xM.LocalVideoTrack)){const e=this.localTrackMap.get(xM.LocalVideoLowTrack);e&&t.push([xM.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],s=this.localTrackMap.get(xM.LocalAudioTrack);if(e instanceof Fk&&(null==s?void 0:s.track)instanceof Wk)return s.track.isActive&&t.push([xM.LocalAudioTrack,s]),t;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:s}]=t;return e===s});if(n)if(n[0]===xM.LocalVideoTrack){t.push(n);const e=this.localTrackMap.get(xM.LocalVideoLowTrack);e&&t.push([xM.LocalVideoLowTrack,e])}else t.push(n);return t}createMuteMessage(e){return e.map(e=>{var t;let s,[n,{track:r,ssrcs:i,id:a}]=e;switch(n){case xM.LocalAudioTrack:s=nM.Audio;break;case xM.LocalVideoTrack:s=Dn(t=r._hints).call(t,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalVideoLowTrack:s=nM.Low}return{stream_type:s,ssrcs:i,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let s,[n,{track:r,ssrcs:i,id:a}]=e;switch(n){case xM.LocalAudioTrack:s=nM.Audio;break;case xM.LocalVideoTrack:s=Dn(t=r._hints).call(t,UO.SCREEN_TRACK)?nM.Screen:nM.High;break;case xM.LocalVideoLowTrack:s=nM.Low}return{stream_type:s,ssrcs:i,mid:a}})}filterTobeUnSubscribedTracks(e,t){const s=[],n=this.remoteUserMap.get(e);if(!n)return s;if(t){const r=n.get(t);if(!r)return s;s.push([e,{kind:t,id:r}])}else Array.from(n.entries()).forEach(t=>{let[n,r]=t;s.push([e,{kind:n,id:r}])});return s}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[s,{kind:n,id:r}]=e;switch(n){case fM.VIDEO:return void(s._videoSSRC&&t.push({stream_type:fM.VIDEO,ssrcId:s._videoSSRC}));case fM.AUDIO:return void(s._audioSSRC&&t.push({stream_type:fM.AUDIO,ssrcId:s._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:s}]=e;const n=this.remoteUserMap.get(t);n&&(n.delete(s),0===Array.from(n.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(xM.LocalVideoTrack),s=this.localTrackMap.get(xM.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new sp((e,s)=>{this.handleUpdateVideoEncoder(t.track,e,s,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new sp((e,t)=>{this.handleUpdateVideoEncoder(s.track,e,t,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Fk){const s=this.filterTobeUnmutedTracks(e[t]);if(0===s.length)continue;const n=this.createUnmuteMessage(s);return void await aI(this,EM.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(EM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(EM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await NI(BI(this.dtlsFailedCount,FI)),this.emit(EM.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(xM.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof DD)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof DD).length>1)throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Fk).length>1&&(e.some(e=>e instanceof Fk&&e._bypassWebAudio)||!yO().webAudioMediaStreamDest))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof DD&&this.pendingLocalTracks.some(e=>e instanceof DD))throw new IR(RR.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Fk&&this.pendingLocalTracks.some(e=>e instanceof Fk)&&(!yO().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Fk&&e._bypassWebAudio)))throw new IR(RR.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const s=!RA("DISABLE_DUAL_STREAM_USE_ENCODING")&&yO().supportDualStreamEncoding,n=yY(yY({},{width:160,height:120,framerate:15,bitrate:50}),t);let r;r=s?e._mediaStreamTrack.clone():RF(e,n);const i=SI(8,"track-low-"),a=new DD(r,yY(yY({},s&&{scaleResolutionDownBy:dU(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,i);return a.on(GO.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,VO.LOW_STREAM)}),a._hints.push(UO.LOW_STREAM),e.addListener(MO.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,s,n){var r;const i=Array.from(XA(r=this.remoteUserMap).call(r)).find(t=>t._videoSSRC===e);if(i){n||this.store.subscribe(i.uid,"video",void 0,void 0,void 0,void 0,Date.now());const r=this.store.keyMetrics,a=r.subscribe.find(e=>e.userId===i.uid&&"video"===e.type);mO.firstRemoteVideoDecode(this.store.sessionId,dO.FIRST_VIDEO_DECODE,uO.FIRST_VIDEO_DECODE,{peer:i._uintid,videowidth:t,videoheight:s,subscribeElapse:zV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:r.requestAPEnd||0,apStart:r.requestAPStart||0,joinGwEnd:r.joinGatewayEnd||0,joinGwStart:r.joinGatewayStart||0,pcEnd:r.peerConnectionEnd||0,pcStart:r.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:n?1:0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.recvConnection)return!1;const n=this.remoteUserMap.get(e);if(!n)return!1;const r=n.get(t);if(!r)return!1;const i=await this.recvConnection.getRemoteSSRC(r);return void 0!==i&&i!==s}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new IR(RR.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new IR(RR.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new IR(RR.NOT_SUPPORTED)}async preConnect(e){throw new IR(RR.NOT_SUPPORTED)}getEstablishParams(){throw new IR(RR.NOT_SUPPORTED)}async reSubscribe(e){throw new IR(RR.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new IR(RR.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===xM.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,VO.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},IL(fY.prototype,"p2pConnect",[rY],Object.getOwnPropertyDescriptor(fY.prototype,"p2pConnect"),fY.prototype),IL(fY.prototype,"unpublish",[iY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublish"),fY.prototype),IL(fY.prototype,"unpublishLowStream",[aY],Object.getOwnPropertyDescriptor(fY.prototype,"unpublishLowStream"),fY.prototype),IL(fY.prototype,"subscribe",[oY],Object.getOwnPropertyDescriptor(fY.prototype,"subscribe"),fY.prototype),IL(fY.prototype,"mockSubscribe",[cY],Object.getOwnPropertyDescriptor(fY.prototype,"mockSubscribe"),fY.prototype),IL(fY.prototype,"unsubscribe",[lY],Object.getOwnPropertyDescriptor(fY.prototype,"unsubscribe"),fY.prototype),IL(fY.prototype,"muteRemote",[dY],Object.getOwnPropertyDescriptor(fY.prototype,"muteRemote"),fY.prototype),IL(fY.prototype,"unmuteRemote",[uY],Object.getOwnPropertyDescriptor(fY.prototype,"unmuteRemote"),fY.prototype),IL(fY.prototype,"hasRemoteMediaWithLock",[hY],Object.getOwnPropertyDescriptor(fY.prototype,"hasRemoteMediaWithLock"),fY.prototype),IL(fY.prototype,"disconnectForReconnect",[pY],Object.getOwnPropertyDescriptor(fY.prototype,"disconnectForReconnect"),fY.prototype),IL(fY.prototype,"remoteMediaSsrcChanged",[mY],Object.getOwnPropertyDescriptor(fY.prototype,"remoteMediaSsrcChanged"),fY.prototype),fY);function xY(e){return function(t,s,n){const r=t[s];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];switch(e){case nY.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await r.apply(this,n)}finally{e()}}case nY.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await r.apply(this,n)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(s)),t=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await r.apply(this,n)}finally{e(),t()}}}},n}}class _Y extends HR{constructor(e,t){super(),uS(this,"signal",void 0),uS(this,"token",void 0),uS(this,"tokenTimeout",void 0),uS(this,"tokenInterval",void 0),uS(this,"_sequence",0),uS(this,"userMap",new Map),uS(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const s=()=>{this.signal.connectionState===PL.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*RA("P2P_TOKEN_INTERVAL"))};s()}async send(e,t,s,n,r){var i;if(0===this.userMap.size)return;const a=Array.from(up(i=this.userMap).call(i))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),n=null!=n?n:SI(6,""),r=null!=r?r:this._sequence++;const o={_id:n,_type:e,_seq:r,_message:t,token:"".concat(this.token,"_").concat(a)};RA("SHOW_P2P_LOG")&&aO.debug("send message",o,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(o)).forEach(e=>{this.signal.request(ML.DATA_STREAM,{payload:vI(this.encoder.encode(e))})});const c=new sp((t,r)=>{const i=window.setTimeout(()=>{this.off("res-@".concat(n,"_ack"),a),this.off("res-@".concat(n),l),this.off(OM.ABORT,c),aO.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(n)),0===this.userMap.size?r(new IR(RR.INVALID_REMOTE_USER)):r(new IR(RR.TIMEOUT))},RA("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{i&&window.clearTimeout(i),this.off(OM.ABORT,c),s&&t()},c=()=>{i&&window.clearTimeout(i),this.off("res-@".concat(n,"_ack"),a),this.off("res-@".concat(n),l),r(new IR(RR.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(n)))};this.once(OM.ABORT,c),this.once("res-@".concat(n,"_ack"),a);const l=(s,o)=>{d=!0,i&&window.clearTimeout(i),this.off("res-@".concat(n,"_ack"),a),this.off(OM.ABORT,c),"success"===s?t(o):r(new IR(RR.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(n)))};let d=!1;s||(this.once("res-@".concat(n),l),NI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d||aO.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(n,", ").concat(o))}))});try{return await c}catch(i){if(i.code===RR.TIMEOUT)return await this.send(e,t,s,n,r);throw i}}onMessage(e){var t;const{_uid:s}=e;let n,r=this.userMap.get(s);if(r)n=r.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==AM.CHECK)return;const{token:t}=e;n=new Map,r={uid:s,isStart:!0,token:t,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,r),this.signal.emit(VL.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in e&&"total"in e){var i;const{id:t,total:r}=e,a=null!==(i=n.get(t))&&void 0!==i?i:[];if(a.push(e),n.has(t)||n.set(t,a),a.length!==r)return;{const r=Xp(a).call(a,(e,t)=>e.index-t.index).map(e=>e.payload).join("");n.delete(t),(e=JSON.parse(r))._uid=s}}const{_type:a,token:o}=e;if(Dn(t=[AM.ACK,AM.CHECK]).call(t,a))return a===AM.CHECK&&this.handleCheckToken(r,o),void this.receiveMessage(e);o==="".concat(r.token,"_").concat(this.token)?this.handleReceivedMessage(e):aO.debug('Receive unexpected message", '.concat(o,", cur_token: ").concat(r.token,"_").concat(this.token),e)}check(){const e={_id:SI(6,""),token:this.token,_type:AM.CHECK};RA("SHOW_P2P_LOG")&&aO.debug("send message",e),this.signal.request(ML.DATA_STREAM,{payload:vI(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:AM.ACK,token:this.token};RA("SHOW_P2P_LOG")&&aO.debug("send message",t),this.signal.request(ML.DATA_STREAM,{payload:vI(this.encoder.encode(JSON.stringify(t)))})}response(e,t,s){this.send(AM.RESPONSE,JSON.stringify({success:!s,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach(e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:s}=e;for(;t.has(s);){const n=t.get(s);t.delete(s),this.receiveMessage(n),e.nextExpectedSequenceNumber++}})};if(!e)return void t();const{_uid:s,_seq:n}=e,r=this.userMap.get(s),{receivedMessagesMap:i,isStart:a,nextExpectedSequenceNumber:o}=r;if(n<o)return this.ack(e._id),void aO.debug("[external-signal] receive old message, seq: ".concat(n,", ").concat(e._message));i.set(n,e),a&&n===o&&(this.receiveMessage(e),i.delete(o),r.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:s,_message:n,_uid:r}=e;if(RA("SHOW_P2P_LOG")&&aO.debug("receive message",e),t){let i;switch(e._type!==AM.ACK&&(n&&(i=JSON.parse(n)),this.ack(e._id)),e._type){case AM.CANDIDATE:case AM.CONTROL:this.signal.emit(s,i,r);break;case AM.PUBLISH:case AM.UNPUBLISH:case AM.RESTART_ICE:case AM.CALL:i.uid=r,iI(this.signal,s,i).then(t=>{this.response(e._id,t)}).catch(()=>{this.response(e._id,void 0,!0)});break;case AM.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case AM.RESPONSE:{const{success:e,message:s}=i;this.emit("res-@".concat(t),e?"success":"failed",s);break}}}}splitMessage(e){if(e.length<_Y.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:s}=JSON.parse(e),n=SI(6,"");let r=0,i=800;const a=Math.ceil(e.length/i);for(;e.length>0;){r++;const o={id:n,index:r,total:a,payload:e.slice(0,i),token:"".concat(this.token,"_").concat(s)};JSON.stringify(o).length>_Y.MAX_MESSAGE_SIZE?i-=50:(t.push(o),e=e.slice(i))}return t.map(e=>JSON.stringify(e))}handleCheckToken(e,t){return e.token!==t?(aO.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{aO.debug("token timeout, ".concat(t)),this.reset(e.uid)},RA("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await iI(this.signal,AM.CALL,void 0),t=await this.send(AM.CALL,e);this.signal.emit(LL.P2P_CONNECTION,t,!0)}async reset(e,t){const s=this.userMap.get(e);s&&(this.emit(OM.ABORT),this.signal.emit(VL.ON_USER_OFFLINE,{uid:s.uid,reason:kM.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(aO.debug("change local token from ".concat(t," to ").concat(t)),this.token=SI(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(OM.ABORT)}}uS(_Y,"MAX_SIZE",1),uS(_Y,"MAX_MESSAGE_SIZE",1024);class EY extends HR{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===PL.CONNECTED?this.emit(LL.WS_CONNECTED):e===PL.RECONNECTING?this.emit(LL.WS_RECONNECTING,this._websocketReconnectReason):e===PL.CLOSED&&this.emit(LL.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uS(this,"_disconnectedReason",void 0),uS(this,"_websocketReconnectReason",void 0),uS(this,"_connectionState",PL.CLOSED),uS(this,"reconnectToken",void 0),uS(this,"p2pToken",void 0),uS(this,"websocket",void 0),uS(this,"openConnectionTime",void 0),uS(this,"clientId",void 0),uS(this,"lastMsgTime",Date.now()),uS(this,"uploadCache",[]),uS(this,"uploadCacheInterval",void 0),uS(this,"rttRolling",new HI(5)),uS(this,"pingpongTimer",void 0),uS(this,"pingpongTimeoutCount",0),uS(this,"joinResponse",void 0),uS(this,"multiIpOption",void 0),uS(this,"initError",void 0),uS(this,"spec",void 0),uS(this,"store",void 0),uS(this,"_external_signal",void 0),uS(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(LL.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case VL.ON_DATA_STREAM:return void this.handleDataStream(t._message);case VL.MUTE_AUDIO:case VL.MUTE_VIDEO:case VL.ON_P2P_LOST:case VL.ON_USER_ONLINE:return;case VL.ON_USER_OFFLINE:const{uid:e}=t._message;return aO.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===VL.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===VL.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(QR.UID_BANNED);break;case 15:this.close(QR.IP_BANNED);break;case 16:this.close(QR.CHANNEL_BANNED)}if(t._type===VL.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case DL.ERR_LICENSE_MISSING:this.close(QR.LICENSE_MISSING);break;case DL.ERR_LICENSE_EXPIRED:this.close(QR.LICENSE_EXPIRED);break;case DL.ERR_LICENSE_MINUTES_EXCEEDED:this.close(QR.LICENSE_MINUTES_EXCEEDED);break;case DL.ERR_LICENSE_PERIOD_INVALID:this.close(QR.LICENSE_PERIOD_INVALID);break;case DL.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(QR.LICENSE_MULTIPLE_SDK_SERVICE);break;case DL.ERR_LICENSE_ILLEGAL:this.close(QR.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new XM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,RA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),RA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===PL.CONNECTED&&this.reconnect("retry",sI.OFFLINE)}),this.p2pToken=SI(6,""),this._external_signal=new _Y(this,this.p2pToken)}async request(e,t,s,n){const r=SI(6,""),i={_id:r,_type:e,_message:t},a=this.websocket.connectionID,o=()=>new sp((e,t)=>{if(this.connectionState===PL.CONNECTED)return e();const s=()=>{this.off(LL.WS_CLOSED,n),e()},n=()=>{this.off(LL.WS_CONNECTED,s),t(new IR(RR.WS_ABORT))};this.once(LL.WS_CONNECTED,s),this.once(LL.WS_CLOSED,n)});if(this.connectionState!==PL.CONNECTING&&this.connectionState!==PL.RECONNECTING||e===ML.JOIN||e===ML.REJOIN||await o(),this.websocket.sendMessage(i,!0),n)return;const c=new sp((s,n)=>{let i=!1;const o=(n,r)=>{i=!0,s({isSuccess:"success"===n,message:r||{}}),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.emit(LL.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(r),o);const c=()=>{n(new IR(RR.WS_ABORT,"type: ".concat(e))),this.off(LL.WS_CLOSED,c),this.off(LL.WS_RECONNECTING,c),this.off("res-@".concat(r),o)};this.once(LL.WS_CLOSED,c),this.once(LL.WS_RECONNECTING,c),NI(RA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||i||(aO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(LL.REQUEST_TIMEOUT,e,t))})});let l=null;try{l=await c}catch(n){if(this.connectionState===PL.CLOSED||e===ML.LEAVE)throw new IR(RR.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?n.throw():e===ML.JOIN||e===ML.REJOIN?null:(await o(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=MM(d),h=new IR(RR.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(aO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===DL.ERR_TOO_MANY_BROADCASTERS?e===ML.JOIN||e===ML.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===DL.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,aO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sI.MULTI_IP)):this.reconnect(u.action,sI.SERVER_ERROR),e===ML.JOIN||e===ML.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new sp(s=>{const n=r=>{(!t||t(r))&&(this.off(e,n),s(r))};this.on(e,n)})}uploadWRTCStats(e){if(!this.store.sessionId)return void aO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(UL.WRTC_STATS,t)}upload(e,t){const s={_type:e,_message:t};try{this.websocket.sendMessage(s)}catch(e){const t=RA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==PL.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},RA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const s={_type:e,_message:t};this.websocket.sendMessage(s)}async sendExtensionMessage(e,t,s){return await this._external_signal.send(e,t,s)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new sp((t,s)=>{this.once(LL.WS_CONNECTED,()=>t(this.joinResponse)),this.once(LL.WS_CLOSED,()=>s(this.initError||new IR(RR.WS_ABORT))),this.connectionState=PL.CONNECTING,this.websocket.init(e).catch(s)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||QR.LEAVE,this.connectionState=PL.CLOSED,aO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=SI(6,""),this._external_signal.clear(),this._external_signal=new _Y(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(LL.ABORT_P2P_EXECUTION);const e=await iI(this,LL.REQUEST_JOIN_INFO),t=await this.request(ML.JOIN,e);if(!t)return this.emit(LL.REPORT_JOIN_GATEWAY,RR.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(LL.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=PL.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){return!1}handleDataStream(e){try{var t;const s=yI(e.payload),n=(new TextDecoder).decode(s),r=JSON.parse(n);"total"in r&&"id"in r||Dn(t=Object.values(AM)).call(t,r._type)?(r._uid=e.uid,this._external_signal.onMessage(r)):this.emit(VL.ON_DATA_STREAM,e)}catch(t){this.emit(VL.ON_DATA_STREAM,e)}}handleNotification(e){aO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=MM(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(QR.UID_BANNED),void this.close()):void this.reconnect(t.action,sI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=RA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(aO.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>RA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sI.TIMEOUT):this.request(ML.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),RA("REPORT_STATS")&&this.send(ML.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWebsocketEvents(){this.websocket.on(BL.RECONNECT_CREATE_CONNECTION,e=>{this.emit(LL.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(BL.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(BL.CLOSED,()=>{this.connectionState=PL.CLOSED}),this.websocket.on(BL.FAILED,()=>{this._disconnectedReason=QR.NETWORK_ERROR,this.connectionState=PL.CLOSED}),this.websocket.on(BL.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===PL.CONNECTED?this.connectionState=PL.RECONNECTING:this.connectionState=PL.CONNECTING}),this.websocket.on(BL.WILL_RECONNECT,(e,t,s)=>{"retry"!==e?(aO.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):aO.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(e)}),this.websocket.on(BL.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(LL.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof IR&&e.code===RR.UNEXPECTED_RESPONSE&&e.data.code===DL.ERR_NO_AUTHORIZED)return aO.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",sI.SERVER_ERROR);aO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sI.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(BL.REQUEST_NEW_URLS,(e,t)=>{iI(this,LL.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(BL.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(VL.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const bY={name:"P2PChannel",create:function(e){let{store:t,statsCollector:s}=e;return new vY(t,s)},createSubmodule:function(e){let{store:t,spec:s}=e;return new EY(s,t)}};function wY(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function NY(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?wY(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):wY(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class SY{constructor(e){uS(this,"sessionDesc",void 0),uS(this,"localCapabilities",void 0),uS(this,"rtpCapabilities",void 0),uS(this,"candidates",void 0),uS(this,"_originCandidates",void 0),uS(this,"iceParameters",void 0),uS(this,"dtlsParameters",void 0),uS(this,"setup",void 0),uS(this,"currentMidIndex",void 0),uS(this,"cname",void 0),e=pI(e);const{iceParameters:t,dtlsParameters:s,candidates:n,rtpCapabilities:r,setup:i,localCapabilities:a,sdkCodec:o,cname:c}=e,l=VA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=r,this.candidates=n,this._originCandidates=pI(n),this.iceParameters=t,this.dtlsParameters=s,this.setup=i,this.localCapabilities=a,this.cname=c;for(let d=0;d<l.mediaDescriptions.length;d++){const e=l.mediaDescriptions[d];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=s.fingerprints,e.attributes.candidates=n,e.attributes.setup=i,"video"===e.media.mediaType){e.media.fmts=r.videoCodecs.map(e=>e.payloadType.toString(10));const t=r.videoCodecs.filter(e=>{var t,s;return null===(t=e.rtpMap)||void 0===t?void 0:Dn(s=t.encodingName.toLowerCase()).call(s,o)}),s=r.videoCodecs.filter(e=>!Dn(t).call(t,e));e.attributes.payloads=[...t,...s],e.attributes.extmaps=r.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=r.audioCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=r.audioCodecs,e.attributes.extmaps=r.audioExtensions),l.mediaDescriptions[d]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return FA(this.sessionDesc)}send(e,t,s){const{ssrcs:n,ssrcGroups:r}=TU(t,this.cname),i=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType),a=n[0].attributes.label,o=n[0].attributes.mslabel;return i.attributes.ssrcs=i.attributes.ssrcs.concat(n),i.attributes.ssrcGroups=i.attributes.ssrcGroups.concat(r),{id:a,mslabel:o}}batchSend(e){return e.map(e=>{let{kind:t,ssrcMsg:s}=e;return this.send(t,s,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{const s=[],n=[],r=[];t.attributes.ssrcs.forEach(t=>{Dn(e).call(e,t.attributes.label||"")?r.push(t):s.push(t)}),t.attributes.ssrcGroups.forEach(e=>{var t;Dn(t=r.map(e=>e.ssrcId)).call(t,e.ssrcIds[0])||n.push(e)}),t.attributes.ssrcs=s,t.attributes.ssrcGroups=n})}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,s){e.forEach((e,t)=>{const s=e._mediaStreamTrack,n=this.sessionDesc.mediaDescriptions.findIndex(e=>e.attributes.mid===s.kind),r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=r})}stopReceiving(e){}updateCandidates(e){const t=this._originCandidates.filter(e=>"udp"===e.transport),s=[];if(t.forEach(e=>{s.push(NY(NY({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case gM.TCP_RELAY:this.candidates=s;break;case gM.UDP_TCP_RELAY:case gM.RELAY:this.candidates=[...t,...s];break;default:this.candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=pI(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}mungRecvMediaDsec(e,t){const s=pI(e);return CU(s,t),IU(s,t),s}updateRecvMedia(e,t){const s=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==s){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,s){const n=this.sessionDesc.mediaDescriptions.find(t=>e===fM.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid);if(n){const e=n.attributes.ssrcs.find(e=>e.attributes.label===t);var r;e&&(e.attributes.label=s,null===(r=e.attributes.msid)||void 0===r||r.replace(t,s))}}mungMediaDesc(e){const t=pI(e);return RU(t),function(e){const t=e.attributes.extmaps.find(e=>vU(e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const s of t.attributes.ssrcs)if(s.attributes.label===e)return[s]}}var TY;function CY(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function RY(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?CY(Object(s),!0).forEach(function(t){uS(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):CY(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let IY=(TY=class e extends mM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dn(t=Object.keys(jA)).call(t,e)}))]}constructor(t,s){super(t,s),uS(this,"store",void 0),uS(this,"peerConnection",void 0),uS(this,"remoteSDP",void 0),uS(this,"initialOffer",void 0),uS(this,"statsFilter",void 0),uS(this,"useRTX",!1),uS(this,"localCapabilities",void 0),uS(this,"localCandidateCount",0),uS(this,"allCandidatesReceived",!1),uS(this,"establishPromise",void 0),uS(this,"mutex",void 0),this.store=s,this.mutex=new UI("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=fA(this.peerConnection,RA("STATS_UPDATE_INTERVAL"),void 0,sR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=bU(e.sdp),s=EU(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:RA("FILTER_VIDEO_FEC"),filterAudioFec:RA("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=e,RY(RY({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:e.sdp})}catch(e){throw new IR(RR.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new SY(RY(RY({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var s=this;return YT(function*(){const n=yield JT(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const n=e.map(e=>s.peerConnection.addTrack(e._mediaStreamTrack)),r=yield JT(s.peerConnection.createOffer()),i=VA(r.sdp),a=e.map(e=>{const t=e._mediaStreamTrack,n=i.mediaDescriptions.find(e=>e.attributes.mid===t.kind);if(!n)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,s){const n=e.attributes.ssrcs.filter(e=>e.attributes.label===t),r=e.attributes.ssrcGroups;if(0===n.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(r&&n.length>1){const e=r.find(e=>-1!==e.ssrcIds.indexOf(n[0].ssrcId));return e?[{ssrcId:e.ssrcIds[0],rtx:s?e.ssrcIds[1]:void 0}]:[{ssrcId:n[0].ssrcId}]}return[{ssrcId:n[0].ssrcId}]}(n,t.id,s.useRTX)});let o;try{o=yield a}catch(e){throw n.forEach(e=>{$C()&&e.replaceTrack(null),s.peerConnection.removeTrack(e)}),e}const c=s.mungSendOfferSDP(r.sdp,e);s.remoteSDP.receive(e,t,o);const l=s.remoteSDP.toString();return yield JT(s.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield JT(s.applySendEncodings(n,e)),yield JT(s.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map((e,t)=>{const s=e._mediaStreamTrack.id;return{localSSRC:a[t],id:s}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{n()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter(t=>{var s;return-1!==e.indexOf((null===(s=t.track)||void 0===s?void 0:s.id)||"")});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{$C()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,s,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:r}=this.remoteSDP.send(e,t,n),i=new sp((t,n)=>{const i=setTimeout(()=>{n(new Error("Cannot receive track, id: ".concat(s)))},1e4),a=n=>{const o=qC();if(("Safari"===o.name&&11===Number(o.version)||nR())&&n.track.id!==s&&n.streams[0].id===r){var c;const r=n.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,s,n.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(i),void t(r)}if(n.track.id===s)return this.peerConnection.removeEventListener("track",a),clearTimeout(i),void t(n.track)};this.peerConnection.addEventListener("track",a)}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),{track:await i,id:s}}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var s;return-1!==e.indexOf((null===(s=t.track)||void 0===s?void 0:s.id)||"")});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(e=>{if($C()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!1),e.setParameters(t)}})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var s;return-1!==e.indexOf((null===(s=t.track)||void 0===s?void 0:s.id)||"")});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async e=>{if($C()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!0),await e.setParameters(t)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YT(function*(){const s=yield JT(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=yO().supportPCSetConfiguration;if(e===gM.RELAY&&!s)return;if(s){const s=t.peerConnection.getConfiguration(),n=e===gM.RELAY?"relay":"all";s.iceTransportPolicy!==n&&(aO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(s.iceTransportPolicy,"] to [").concat(n,"]")),s.iceTransportPolicy=n,t.peerConnection.setConfiguration(s))}e!==gM.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield JT(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=bU(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const a=t.remoteSDP.toString();yield JT(t.peerConnection.setLocalDescription(n)),yield JT(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(e){aO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{s()}})()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const s=this.peerConnection.getSenders().filter(t=>{var s;return(null===(s=t.track)||void 0===s?void 0:s.id)===e});1===s.length&&await this.applySendEncodings(s,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const s=this.peerConnection.getSenders().find(e=>{var s;return(null===(s=e.track)||void 0===s?void 0:s.id)===t});s&&await s.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new IR(RR.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,aO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},RA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZR(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),RA("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var s;if(t||(t=this.peerConnection.getSenders().find(t=>{var s;return(null===(s=t.track)||void 0===s?void 0:s.id)===e._mediaStreamTrack.id})),!t)return aO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!yO().supportSetRtpSenderParameters)return aO.warn("Browser not support set rtp-sender parameters");const n={},r={};if(e instanceof DD)switch(e._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(RA("DSCP_TYPE")&&bR()){var i;const e=RA("DSCP_TYPE");Dn(i=["very-low","low","medium","high"]).call(i,e)&&(r.networkPriority=e)}const a=t.getParameters(),o=null===(s=a.encodings)||void 0===s?void 0:s[0];o&&Object.assign(o,r),Object.assign(a,n),aO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!yO().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let s=0;s<e.length;s++){const n=e[s],r=t[s];n&&r&&await this.updateRtpSenderEncodings(r,n)}}catch(e){aO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const s=VA(e);return t.forEach((e,t)=>{const n=e._mediaStreamTrack,r=s.mediaDescriptions.find(e=>e.attributes.mid===n.kind);r&&CU(r,e)}),FA(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,s)=>{var n;null===(n=this.onFirstVideoDecoded)||void 0===n||n.call(this,e,t,s)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map((t,s)=>{let{id:n,mslabel:r}=t;const{kind:i}=e[s];return new sp((e,t)=>{const s=setTimeout(()=>{t(new Error("Cannot receive track, id: ".concat(n)))},1e4),a=t=>{const o=qC();if("Safari"===o.name&&11===Number(o.version)&&t.track.id!==n&&t.streams[0].id===r){var c;const r=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(i,n,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(s),void e({track:r,id:n})}if(t.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(s),void e({track:t.track,id:n})};this.peerConnection.addEventListener("track",a)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const n=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(n),await sp.all(t)}catch(e){throw new IR(RR.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(yO().supportPCSetConfiguration){const s=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}}},IL(TY.prototype,"connect",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"connect"),TY.prototype),IL(TY.prototype,"stopSending",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"stopSending"),TY.prototype),IL(TY.prototype,"receive",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"receive"),TY.prototype),IL(TY.prototype,"stopReceiving",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"stopReceiving"),TY.prototype),IL(TY.prototype,"muteRemote",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"muteRemote"),TY.prototype),IL(TY.prototype,"unmuteRemote",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"unmuteRemote"),TY.prototype),IL(TY.prototype,"muteLocal",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"muteLocal"),TY.prototype),IL(TY.prototype,"unmuteLocal",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"unmuteLocal"),TY.prototype),IL(TY.prototype,"close",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"close"),TY.prototype),IL(TY.prototype,"updateEncoderConfig",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"updateEncoderConfig"),TY.prototype),IL(TY.prototype,"updateSendParameters",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"updateSendParameters"),TY.prototype),IL(TY.prototype,"replaceTrack",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"replaceTrack"),TY.prototype),IL(TY.prototype,"getRemoteSSRC",[AY],Object.getOwnPropertyDescriptor(TY.prototype,"getRemoteSSRC"),TY.prototype),TY);function AY(e,t,s){const n=e[t];if("function"!=typeof n)throw new Error("Cannot use mutex on object property.");return s.value=async function(){const e=this.mutex,s=await e.lock("Locking from P2PConnection.".concat(t));try{for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return await n.apply(this,i)}finally{s()}},s}const OY={name:"PlanBConnection",create:function(e){let{store:t,spec:s}=e;return new IY(s,t)}},jY={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(dP.has(e))return;if(!e.track)return;const s={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(r,i){s.controller||(s.controller=i),e.track&&e.track.id!==s.track.id&&(aO.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n));const a=t.metadata&&t.metadata();a?function(e,t){const{chunk:s,controller:n}=t,r=cP.METADATA;s.data=function(e,t,s){const n=s.byteLength,r=n+aP+oP,i=rP+iP+r,a=new ArrayBuffer(e.byteLength+i),o=new DataView(a);o.setUint8(0,nP),o.setUint16(1,r),o.setUint8(3,t),o.setUint16(4,n);for(let l=0;l<n;l++)o.setUint8(6+l,s[l]);const c=new Uint8Array(o.buffer);return c.set(new Uint8Array(e),i),c.buffer}(s.data,r,e),n.enqueue(s)}(a,{sender:e,chunk:r,controller:i}):i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const r=sP(),i=new MessageChannel;await new sp(e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:i.port2},[i.port2]);e.transform=a,await new sp(e=>r.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=r=>{var a;if(r.data.transformed&&e.track&&(null===(a=e.track)||void 0===a?void 0:a.id)!==s.track.id)aO.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n);else if(r.data.getMetadata){const e=t.metadata&&t.metadata();e&&i.port1.postMessage({metadata:e})}},s.worker=r}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}const t=dP.get(e);if(t){dP.delete(e);try{var s,r;null===(s=t.controller)||void 0===s||s.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){aO.warning(e&&e.message)}}}dP.set(e,s),e.track.addEventListener("ended",n)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support audio encoded transform");if(jP.has(e))return;const s={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ZC()&&!nR()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");aR(WC.CHROME,87,116)||(t.enableTopn=!1);let r=null;try{r=e.createEncodedStreams()}catch(e){return void aO.error("create audio-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(r,i){s.controller||(s.controller=i),e.track&&e.track.id!==s.track.id&&(aO.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n)),t.enableTopn?function(e,t,s){var n;const r=lP(new DataView(t.data));if(!r)return s.enqueue(t);const i=e.track.id;kP.set(i,e.track);const a=null===(n=r.tlv.find(e=>e.tag===cP.AUDIO_LEVEL))||void 0===n?void 0:n.value;let o=0;"number"==typeof a&&(o=127-a);const c=Math.round(Math.pow(10,o/60)-1),{selected:l,speaker:d}=function(e,t){let s=bP.get(e);if(s||(s=function(e){const t=new vP;return bP.set(e,t),wP||(wP=new EP(RA("TOPN_SILENCE_THRESHOLD")||500),wP.on("ActiveSpeakerChanged",e=>{null!=e&&(NP=e)})),wP.addSpeakers([t]),t}(e)),bP.size<=SP)return{selected:!0,speaker:s};if(!wP)throw new Error("no active speaker detector");return wP.levelChanged(s.id,t),TP=wP.loudest.map(e=>e.id),NP&&!Dn(TP).call(TP,NP)&&TP.length>=SP&&TP.pop(),{selected:Dn(TP).call(TP,s.id)||s.id===NP,speaker:s}}(e,c),u=function(e,t,s){const n=CP.get(e)||new IP(e,t);return n.score=s,CP.set(e,n),function(e){if(RP.set(e,!0),!AP)return void(AP=Date.now());const t=Date.now();t-AP>1e3&&(RP.get(e)?RP.set(e,!1):(OP(e),RP.delete(e)),AP=t)}(e),n}(i,e.track,d.energyScore);u.addSample(l),u.active&&(t.data=r.frame.buffer,s.enqueue(t))}(e,r,i):t.enableMetadata||t.enablePts?function(e,t,s,n){const r=new DataView(e.data),i=r.getUint8(0);let a;if(0!=(128&i)&&71!==i){const t=function(e){if(e.byteLength<=0)return[];const t=[];let s=0;for(;s<e.byteLength;){const n=(128&e.getUint8(s))>>7,r=127&e.getUint8(s);if(!(n&&s+4<=e.byteLength)){s++;break}{const n=e.getUint32(s,!1),i=(16776192&n)>>10,a=1023&n;t.push({pt:r,ts_offset:i,length:a,data:new Uint8Array}),s+=4}}let n=e.byteLength-s;for(const r of t){if(r.length>n)return console.warn("Broken red payload"),[];r.length>0&&(r.data=new Uint8Array(e.buffer,e.byteOffset+s,r.length),s+=r.length,n-=r.length)}if(n>0){const r={pt:t.length>0?t[t.length-1].pt:0,ts_offset:0,length:n,data:new Uint8Array(e.buffer,e.byteOffset+s,n)};t.push(r)}return t}(r);if(t.length>0){const s=function(e){let t=0;for(let r=0;r<e.length;r++)t+=r<e.length-1?4:1,t+=e[r].length;const s=new Uint8Array(t);let n=0;for(let r=0;r<e.length;r++)if(r<e.length-1){const t=(2147483648|(127&e[r].pt)<<24|(262143&e[r].ts_offset)<<10|1023&e[r].length)>>>0;s[n++]=t>>24&255,s[n++]=t>>16&255,s[n++]=t>>8&255,s[n++]=255&t}else s[n++]=127&e[r].pt;for(const r of e)s.set(r.data,n),n+=r.length;return s}(t.map(e=>{const t=new Uint8Array(e.length);t.set(e.data);const s=lP(new DataView(t.buffer));return null!=s&&s.frame&&(e.data=null==s?void 0:s.frame),a=s,e}));e.data=s.buffer}}else a=lP(r),a&&(e.data=a.frame.buffer);if(t.enqueue(e),!a)return;const o=a.tlv.find(e=>e.tag===cP.METADATA);o&&s&&o.value instanceof Uint8Array&&s(o.value);const c=a.tlv.find(e=>e.tag===cP.AUDIO_64_BIT_PTS);c&&n&&c.value instanceof Uint8Array&&8==c.value.length&&n(new DataView(c.value.buffer).getBigUint64(0,!0))}(r,i,t.onMetadata,t.onPts):i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=sP(),r=new MessageChannel;await new sp(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const i=new RTCRtpScriptTransform(t,{name:"audio-metadata-rx",port:r.port2},[r.port2]);e.transform=i,await new sp(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),r.port1.onmessage=t=>{var r;t.data.transformed&&e.track&&(null===(r=e.track)||void 0===r?void 0:r.id)!==s.track.id?(aO.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n)):t.data.metadata&&s.onMetadata?s.onMetadata(t.data.metadata):t.data.pts&&s.onPts&&s.onPts(t.data.pts)},s.worker=t}function n(){e.track.removeEventListener("ended",n),function(e){const t=jP.get(e);if(t){!function(e){const t=bP.get(e);t&&(bP.delete(e),wP&&(wP.removeSpeakers([t]),0===bP.size&&(wP.destroy(),wP=null)))}(e),OP(e.track.id),jP.delete(e);try{var s,n;null===(s=t.controller)||void 0===s||s.terminate(),null===(n=t.worker)||void 0===n||n.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}jP.set(e,s),e.track.addEventListener("ended",n)},interceptLocalVideoFrame:async function(e,t){if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(VP.has(e))return;if(!e.track)return;const s={track:e.track};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const i=[];t.on("sei-to-send",e=>{i.push(e)});const a=new TransformStream({transform(t,r){s.controller||(s.controller=r),e.track&&e.track.id!==s.track.id&&(aO.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n));const a=UP(new Uint8Array(t.data)),o=i.shift();if(o){const e=function(e,t,s){switch(s){case DP:return function(e,t){const s=MP(t),n=s.length,r=Math.floor(n/255),i=n%255,a=new Uint8Array(6+r+1+n+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=6,a[5]=101;let o=0;for(;o<r;)a[6+o]=255,o++;return a[6+o]=i,o++,a.set(s,6+o),a.set(new Uint8Array(e),6+o+n),a.buffer}(e,t);case PP:return function(e,t){const s=MP(t),n=s.length,r=Math.floor(n/255),i=n%255,a=new Uint8Array(7+r+1+n+1+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=78,a[5]=1,a[6]=101;let o=0;for(;o<r;)a[7+o]=255,o++;return a[7+o]=i,o++,a.set(s,7+o),o+=n,a[7+o]=128,o++,a.set(new Uint8Array(e),7+o),a.buffer}(e,t);default:return null}}(t.data,o,a);e&&(t.data=e)}r.enqueue(t)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else{if(!$C())return;{if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const r=sP(),i=new MessageChannel;await new sp(e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(r,{name:"sei-tx",port:i.port2},[i.port2]);e.transform=a,await new sp(e=>r.onmessage=t=>{"started"===t.data&&e(void 0)}),t.on("sei-to-send",e=>{i.port1.postMessage({sei:e})}),i.port1.onmessage=t=>{var r;t.data.transformed&&e.track&&(null===(r=e.track)||void 0===r?void 0:r.id)!==s.track.id&&(aO.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n))},s.worker=r}}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}const t=VP.get(e);if(t){VP.delete(e);try{var s,r;null===(s=t.controller)||void 0===s||s.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){aO.warning(e&&e.message)}}}VP.set(e,s),e.track.addEventListener("ended",n)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!yO().supportWebRTCEncodedTransform)return void aO.warning("browser not support video encoded transform");if(!e.track)return;if(FP.has(e)){const s=FP.get(e);return void(s&&(s.onSei=t.onSei))}const s={track:e.track,onSei:t.onSei};if(ZC()){if(!e.createEncodedStreams)return void aO.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void aO.error("create video-encoded-streams error",e&&e.message)}const r=new TransformStream({transform(t,r){s.controller||(s.controller=r),e.track&&e.track.id!==s.track.id&&(aO.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n));const i=function(e,t){switch(t){case DP:return function(e){const t=new DataView(e.data);let s=0;for(;s+4<e.data.byteLength;){if(0===t.getUint8(s+0)&&0===t.getUint8(s+1)&&0===t.getUint8(s+2)&&1===t.getUint8(s+3)&&6===t.getUint8(s+4)){let n=s+6,r=0,i=0;for(;255===(i=t.getUint8(n++));)r+=255;r+=i;const a=LP(e.data,n,r);return new Uint8Array(a)}s++}return null}(e);case PP:return function(e){const t=new DataView(e.data);let s=0;for(;s+5<e.data.byteLength;){if(0===t.getUint8(s+0)&&0===t.getUint8(s+1)&&0===t.getUint8(s+2)&&1===t.getUint8(s+3)&&78===t.getUint8(s+4)&&1===t.getUint8(s+5)&&101===t.getUint8(s+6)){let n=s+7,r=0,i=0;for(;255===(i=t.getUint8(n++));)r+=255;r+=i;const a=LP(e.data,n,r);return new Uint8Array(a)}s++}return null}(e);default:return null}}(t,UP(new Uint8Array(t.data)));i&&s.onSei&&s.onSei(i),r.enqueue(t)}});t.readable.pipeThrough(r).pipeTo(t.writable)}else if($C()){if("undefined"==typeof RTCRtpScriptTransform)return void aO.warning("browser not support RTCRtpScriptTransform");const t=sP(),r=new MessageChannel;await new sp(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const i=new RTCRtpScriptTransform(t,{name:"sei-rx",port:r.port2},[r.port2]);e.transform=i,await new sp(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),r.port1.onmessage=t=>{var r;t.data.transformed&&e.track&&(null===(r=e.track)||void 0===r?void 0:r.id)!==s.track.id?(aO.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",n),s.track=e.track,s.track.addEventListener("ended",n)):t.data.sei&&s.onSei&&s.onSei(t.data.sei)},s.worker=t}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}!function(e){const t=FP.get(e);if(t){FP.delete(e);try{var s,n;null===(s=t.controller)||void 0===s||s.terminate(),null===(n=t.worker)||void 0===n||n.terminate()}catch(e){aO.warning(e&&e.message)}}}(e)}FP.set(e,s),e.track.addEventListener("ended",n)}},kY={name:"InterceptFrame",create:()=>jY};yA(),CA("PROCESS_ID","process-".concat(SI(8,""),"-").concat(SI(4,""),"-").concat(SI(4,""),"-").concat(SI(4,""),"-").concat(SI(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void aO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),s=Date.now();aO.debug("Loading global parameters from cache",t),Object.keys(t).forEach(e=>{if(Object.prototype.hasOwnProperty.call(TA,e)){const{value:n,expires:r}=t[e];if(r&&r<=s)return;AA[e]=n,TA[e]=n}})}catch(t){aO.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(AA.AREAS)&&AA.AREAS.length>0&&mV(AA.AREAS,!0);const DY=(e,t,s)=>{aO.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),CA(e,t,s)};XU(Zz,!1),XU(iq,!1),XU(fG,!1),XU(Lq,!1),XU(Xz,!1),XU(bY,!1),XU(OY,!1),XU(kY,!1);const PY=function(e){const t=new HR,s=e,n={getListeners:t.getListeners.bind(t),on:(e,s)=>(function(e,t){e===TM.SECURITY_POLICY_VIOLATION&&fW(t,!0)}(e,s),t.on.bind(t)(e,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return pW(pW({},s),n)}({__TRACK_LIST__:PO,VERSION:vA,BUILD:NA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:DY,getParameter:RA,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const s=await async function(e){let t;return yO().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!s)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(s)}catch(e){throw new fO(RR.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=mO.reportApiInvoke(null,{name:qR.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:YR.TRACER});let t=!1;try{const e=window.RTCPeerConnection,s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,n=window.WebSocket;t=!!(e&&s&&n),t&&ER()&&iR(75)&&(new e).close()}catch(e){return aO.error("check system requirement failed: ",e),!1}let s=!1;const n=qC();n.name===WC.CHROME&&Number(n.version)>=58&&("WebKit"!==KC.engine.name||function(){const e=qC();if(QC()){if(e.os===GC.MAC_OS)return!0;if(e.os===GC.IOS){const e=KC.os.version&&KC.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(s=!0),(n.name===WC.FIREFOX&&Number(n.version)>=56||n.name===WC.OPERA&&Number(n.version)>=45||n.name===WC.SAFARI&&Number(n.version)>=11||"WebKit"===n.name&&(nR()||vR())&&n.osVersion&&Number(n.osVersion.split(".")[0])>=11||xR()||qC().name===WC.QQ)&&(s=!0),aO.debug("checkSystemRequirements, api:",t,"browser",s);const r=t&&s;return e.onSuccess(r),r},getDevices:function(e){return jj.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return jj.getRecordingDevices(e)},getCameras:function(e){return jj.getCamerasDevices(e)},getElectronScreenSources:Nj,getPlaybackDevices:function(e){return jj.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=SI(5,"client-"),n=mO.reportApiInvoke(null,{id:s,name:qR.CREATE_CLIENT,options:[t],tag:YR.TRACER});try{!function(e){OR(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),OR(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&OR(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&DR(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&$R(e.turnServer),void 0!==e.httpRetryConfig&&XR(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&XR(e.websocketRetryConfig)}(t)}catch(e){throw n.onError(e),e}return(uR(16,0,!0)||hR(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",aO.debug("browser not support vp9, force use vp8")),CA("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),n.onSuccess(),new aW(iW(iW({forceWaitGatewayResponse:!0},t),{},{role:Dn(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),s)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=RA("CAMERA_CAPTURE_CONFIG"),s=SI(8,"track-cam-"),n=mO.reportApiInvoke(null,{id:s,tag:YR.TRACER,name:qR.CREATE_CAM_VIDEO_TRACK,options:[lj({},e),t]});t&&(e.encoderConfig=t);const r=qj(e);let i=null;aO.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{i=(await Rj({video:r},s)).getVideoTracks()[0]||null}catch(e){throw n.onError(e),e}if(!i){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(aO)}if(e.optimizationMode&&LD(s,i,e,AO(e.encoderConfig)),RA("USE_STANDARD_BITRATE_DEFAULT")){const t=AO(e.encoderConfig);e.encoderConfig=t,delete t.bitrateMax,delete t.bitrateMin}const a=new PD(i,e,r,e.scalabiltyMode?jO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return n.onSuccess(a.getTrackId()),aO.info("create camera video success, trackId:",s),a},createCustomVideoTrack:function(e){const t=SI(8,"track-cus-"),s=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});RA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const n=new DD(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?jO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[UO.CUSTOM_TRACK]);return s.onSuccess(n.getTrackId()),aO.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const s="object"==typeof t?function(e){return Yj(e)}(t):void 0;s&&(t="auto");const n=SI(8,"track-scr-v-"),r=mO.reportApiInvoke(null,{id:n,tag:YR.TRACER,name:qR.CREATE_SCREEN_VIDEO_TRACK,options:[lj({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&ZC()&&(t.extensionId=e.extensionId);const{displaySurface:s,selfBrowserSurface:n,surfaceSwitching:r,systemAudio:i,preferCurrentTab:a}=e;(rR(107)||oR(107)||pR(93))&&(s&&(OR(s,"displaySurface",["browser","window","monitor"]),t.displaySurface=s),n?(OR(n,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=n):t.selfBrowserSurface="include",r&&(OR(r,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=r)),(rR(105)||oR(105)||pR(91))&&i&&(OR(i,"systemAudio",["exclude","include"]),t.systemAudio=i),(rR(94)||oR(94)||pR(80))&&a&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const o=e.encoderConfig?OO(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&(o.frameRate&&("number"==typeof o.frameRate?(t.mandatory.maxFrameRate=o.frameRate,t.mandatory.minFrameRate=o.frameRate):(t.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,t.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),t.frameRate=o.frameRate),o.width&&(t.width=o.width),o.height&&(t.height=o.height)),t}(e);let a=null,o=null;const c=yO();if(!c.supportShareAudio&&"enable"===t){const e=new IR(RR.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(e),e.throw(aO)}aO.info("start create screen video track with config",e,"withAudio",t,"trackId",n);const l=c.supportShareAudio&&"disable"!==t;try{const e=await Rj({screen:i,screenAudio:l?s||!0:void 0},n);a=e.getVideoTracks()[0]||null,o=e.getAudioTracks()[0]||null}catch(e){throw r.onError(e),e}if(!a){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(e),e.throw(aO)}if(!o&&"enable"===t){a&&a.stop();const e=new IR(RR.SHARE_AUDIO_NOT_ALLOWED);return r.onError(e),e.throw(aO)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(LD(n,a,e,e.encoderConfig&&OO(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const d=new DD(a,e.encoderConfig?OO(e.encoderConfig):{},e.scalabiltyMode?jO(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[UO.SCREEN_TRACK]);if(!o)return r.onSuccess(d.getTrackId()),aO.info("create screen video track success","video:",d.getTrackId()),d;const u=new Fk(o,void 0,SI(8,"track-scr-a-"),!1);return r.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create screen video track success","video:",d.getTrackId(),"audio:",u.getTrackId()),[d,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=RA("CAMERA_CAPTURE_CONFIG"),n=SI(8,"track-mic-"),r=SI(8,"track-cam-"),i=mO.reportApiInvoke(null,{id:"".concat(n,"-").concat(r),tag:YR.TRACER,name:qR.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,s]});s&&(t.encoderConfig=s);const a=qj(t),o=Xj(e);let c=null,l=null;aO.info("start create camera video track(".concat(r,") and microphone audio track(").concat(n,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await Rj({audio:o,video:a},"".concat(n,"-").concat(r));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw i.onError(e),e}if(!c||!l){const e=new IR(RR.UNEXPECTED_ERROR,"can not find tracks in media stream");return i.onError(e),e.throw(aO)}if(t.optimizationMode&&LD(r,l,t,AO(t.encoderConfig)),RA("USE_STANDARD_BITRATE_DEFAULT")){const e=AO(t.encoderConfig);t.encoderConfig=e,delete e.bitrateMax,delete e.bitrateMin}const d=new Bk(c,e,o,n),u=new PD(l,t,a,t.scalabiltyMode?jO(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r);return i.onSuccess([d.getTrackId(),u.getTrackId()]),aO.info("create camera video track(".concat(r,") and microphone audio track(").concat(n,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=SI(8,"track-mic-"),s=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=Xj(e);let r=null;aO.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{r=(await Rj({audio:n},t)).getAudioTracks()[0]||null}catch(e){throw s.onError(e),e}if(!r){const e=new IR(RR.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(e),e.throw(aO)}const i=new Bk(r,e,n,t);return s.onSuccess(i.getTrackId()),aO.info("create microphone audio track success, trackId:",t),i},createCustomAudioTrack:function(e){const t=SI(8,"track-cus-"),s=mO.reportApiInvoke(null,{id:t,tag:YR.TRACER,name:qR.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new Fk(e.mediaStreamTrack,e.encoderConfig?DO(e.encoderConfig):{},t,!1);return aO.info("create custom audio track success with config",e,"trackId",n.getTrackId()),s.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:s,encoderConfig:n}=e;let{source:r}=e;const i={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":r,cacheOnlineFile:s,encoderConfig:n},a=SI(8,"track-buf-"),o=mO.reportApiInvoke(null,{id:a,tag:YR.TRACER,name:qR.CREATE_BUFFER_AUDIO_TRACK,options:[i]});if(RA("DISABLE_WEBAUDIO"))throw new IR(RR.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");aO.info("start create buffer source audio track with config",JSON.stringify(i),"trackId",a);const c=r;if(!(r instanceof AudioBuffer))try{r=await async function(e,t){let s=null;if("string"==typeof e){const t=Kk.get(e);if(t)return aO.debug("use cached audio resource: ",e),t;try{s=(await GI(()=>LC.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new IR(RR.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new sp((t,s)=>{const n=new FileReader;n.onload=e=>{e.target?t(e.target.result):s(new IR(RR.READ_LOCAL_AUDIO_FILE_ERROR))},n.onerror=()=>{s(new IR(RR.READ_LOCAL_AUDIO_FILE_ERROR))},n.readAsArrayBuffer(e)});s=await t}const n=await function(e){const t=fj();return new sp((s,n)=>{t.decodeAudioData(e,e=>{s(e)},e=>{n(new IR(RR.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(s);return"string"==typeof e&&t&&Kk.set(e,n),n}(r,s)}catch(e){return o.onError(e),e.throw(aO)}const l=new Hk(r),d=new Gk(c,l,n?DO(n):{},a);return aO.info("create buffer source audio track success, trackId:",a),o.onSuccess(d.getTrackId()),d},setAppType:function(e){if(aO.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw aO.debug("Invalid appType"),new fO(RR.INVALID_PARAMS,"invalid app type",e);CA("APP_TYPE",Math.floor(e))},setLogLevel:function(e){aO.setLogLevel(e)},enableLogUpload:function(){RA("USE_NEW_LOG")?CA("UPLOAD_LOG",!0):aO.enableLogUpload()},disableLogUpload:function(){RA("USE_NEW_LOG")?CA("UPLOAD_LOG",!1):aO.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new JV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Fk||e instanceof QD)){const e=new fO(RR.INVALID_TRACK,"the parameter is not a audio track");return s.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const n=e instanceof Fk?e.getTrackLabel():"remote_track",r=e.getVolumeLevel();let i=r,a=r;const o=Date.now();return new sp(r=>{const c=setInterval(()=>{const l=e.getVolumeLevel();i=l>i?l:i,a=l<a?l:a;const d=i-a>1e-4,u=Date.now()-o;if(d||u>t){clearInterval(c);const t=d,a={duration:u,deviceLabel:n,maxVolumeLevel:i,result:t};aO.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),s.onSuccess(a),r(t)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=mO.reportApiInvoke(null,{tag:YR.TRACER,name:qR.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof DD||e instanceof JD)){const e=new fO(RR.INVALID_TRACK,"the parameter is not a video track");return s.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const n=e instanceof DD?e.getTrackLabel():"remote_track",r=e.getMediaStreamTrack(!0),i=document.createElement("video");i.style.width="1px",i.style.height="1px",i.setAttribute("muted",""),i.muted=!0,i.setAttribute("playsinline",""),i.controls=!1,($C()||QC())&&(i.style.opacity="0.01",i.style.position="fixed",i.style.left="0",i.style.top="0",document.body.appendChild(i)),i.srcObject=new MediaStream([r]),i.play();const a=document.createElement("canvas");a.width=160,a.height=120;let o=0,c=0;try{const e=Date.now();o=await function(e,t,s,n){let r,i=0,a=null;return new sp((o,c)=>{function l(){i>n&&r&&(r(),o(i));const t=s.getContext("2d");if(!t){const e=new fO(RR.UNEXPECTED_ERROR,"can not get canvas 2d context.");return aO.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,s.width,s.height),d=Math.floor(l.data.length/3);if(a){for(let e=0;e<d;e+=3)if(l.data[e]!==a[e])return i+=1,void(a=l.data);a=l.data}else a=l.data}setTimeout(()=>{r&&(r(),o(i))},t),r=vj(()=>{l()},30)})}(i,t,a,4),c=Date.now()-e}catch(e){throw s.onError(e),e}hB===WC.SAFARI&&(i.pause(),i.remove()),i.srcObject=null;const l=o>4,d={duration:c,changedPicNum:o,deviceLabel:n,result:l};return aO.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),s.onSuccess(d),l},setArea:mV,audioElementPlayCenter:Uj,resumeAudioContext:function(){Uj.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){uW.processExternalMediaAEC(e)},registerExtensions:function(e){const t=RA("PLUGIN_INFO")||[];e.forEach(e=>{"name"in e&&!Dn(t).call(t,e.name)&&t.push(e.name);const s=e;s.__registered__=!0,s.logger.hookLog=aO.extLog,s.reporter.hookApiInvoke=mO.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(e=>{s.parameters[e]=RA(e)})}),DY("PLUGIN_INFO",t)},ChannelMediaRelayError:sM,ChannelMediaRelayEvent:eM,ChannelMediaRelayState:tM,RemoteStreamFallbackType:BO,RemoteStreamType:FO,ConnectionDisconnectedReason:QR,AudienceLatencyLevelType:JR,AREAS:oM,preload:async function(e,t,s,n){return TB(e,t,s,n)}});return Object.defineProperties(PY,{onAudioAutoplayFailed:{get:()=>Dj.onAudioAutoplayFailed,set:e=>{Dj.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Dj.onAutoplayFailed,set:e=>{Dj.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>PY._onSecurityPolicyViolation,set(e){PY._onSecurityPolicyViolation=e,fW(e)}},__CLIENT_LIST__:{get:()=>RA("SHOW_GLOBAL_CLIENT_LIST")?WP:[]}}),jj.on(tj.CAMERA_DEVICE_CHANGED,e=>{aO.info("camera device changed",JSON.stringify(e)),PY.onCameraChanged&&PY.onCameraChanged(e),PY.safeEmit(TM.CAMERA_CHANGED,e)}),jj.on(tj.RECORDING_DEVICE_CHANGED,e=>{aO.info("microphone device changed",JSON.stringify(e)),PY.onMicrophoneChanged&&PY.onMicrophoneChanged(e),PY.safeEmit(TM.MICROPHONE_CHANGED,e)}),jj.on(tj.PLAYOUT_DEVICE_CHANGED,e=>{aO.debug("playout device changed",JSON.stringify(e)),PY.onPlaybackDeviceChanged&&PY.onPlaybackDeviceChanged(e),PY.safeEmit(TM.PLAYBACK_DEVICE_CHANGED,e)}),Uj.onAutoplayFailed=()=>{aO.info("detect audio element autoplay failed"),Dj.onAudioAutoplayFailed&&Dj.onAudioAutoplayFailed()},mj.on("autoplay-failed",()=>{aO.info("detect webaudio autoplay failed"),Dj.onAudioAutoplayFailed&&Dj.onAudioAutoplayFailed(),PY.safeEmit(TM.AUTOPLAY_FAILED)}),mj.on(bO.STATE_CHANGE,(e,t)=>{aO.info("audio context state changed: ".concat(t," => ").concat(e)),PY.onAudioContextStateChanged&&PY.onAudioContextStateChanged(e,t),PY.safeEmit(TM.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),lI.on(rI.NETWORK_STATE_CHANGE,(e,t)=>{aO.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=PY),PY}()},1641:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(6368),function(){var e=t,s=e.lib.WordArray,n=e.algo,r=n.SHA256,i=n.SHA224=r.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=r._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=r._createHelper(i),e.HmacSHA224=r._createHmacHelper(i)}(),t.SHA224)}()},1659:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(8523),s(4199),s(8211),s(2238),function(){var e=t,s=e.lib.StreamCipher,n=e.algo,r=[],i=[],a=[],o=n.RabbitLegacy=s.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,s=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)n[r]^=s[r+4&7];if(t){var i=t.words,a=i[0],o=i[1],l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=l>>>16|4294901760&d,h=d<<16|65535&l;for(n[0]^=l,n[1]^=u,n[2]^=d,n[3]^=h,n[4]^=l,n[5]^=u,n[6]^=d,n[7]^=h,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var s=this._X;c.call(this),r[0]=s[0]^s[5]>>>16^s[3]<<16,r[1]=s[2]^s[7]>>>16^s[5]<<16,r[2]=s[4]^s[1]>>>16^s[7]<<16,r[3]=s[6]^s[3]>>>16^s[1]<<16;for(var n=0;n<4;n++)r[n]=16711935&(r[n]<<8|r[n]>>>24)|4278255360&(r[n]<<24|r[n]>>>8),e[t+n]^=r[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,s=0;s<8;s++)i[s]=t[s];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,s=0;s<8;s++){var n=e[s]+t[s],r=65535&n,o=n>>>16,c=((r*r>>>17)+r*o>>>15)+o*o,l=((4294901760&n)*n|0)+((65535&n)*n|0);a[s]=c^l}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=s._createHelper(o)}(),t.RabbitLegacy)}()},1884:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.pad.AnsiX923={pad:function(e,t){var s=e.sigBytes,n=4*t,r=n-s%n,i=s+r-1;e.clamp(),e.words[i>>>2]|=r<<24-i%4*8,e.sigBytes+=r},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},t.pad.Ansix923)}()},1991:(e,t,s)=>{"use strict";s.d(t,{j:()=>r});var n=s(8870),r=new(function(){function e(){this.queue=[],this.transactions=0,this.notifyFn=function(e){e()},this.batchNotifyFn=function(e){e()}}var t=e.prototype;return t.batch=function(e){var t;this.transactions++;try{t=e()}finally{this.transactions--,this.transactions||this.flush()}return t},t.schedule=function(e){var t=this;this.transactions?this.queue.push(e):(0,n.G6)(function(){t.notifyFn(e)})},t.batchCalls=function(e){var t=this;return function(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];t.schedule(function(){e.apply(void 0,n)})}},t.flush=function(){var e=this,t=this.queue;this.queue=[],t.length&&(0,n.G6)(function(){e.batchNotifyFn(function(){t.forEach(function(t){e.notifyFn(t)})})})},t.setNotifyFunction=function(e){this.notifyFn=e},t.setBatchNotifyFunction=function(e){this.batchNotifyFn=e},e}())},2002:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(){var e=t,s=e.lib,n=s.WordArray,r=s.Hasher,i=e.algo,a=[],o=i.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=this._hash.words,n=s[0],r=s[1],i=s[2],o=s[3],c=s[4],l=0;l<80;l++){if(l<16)a[l]=0|e[t+l];else{var d=a[l-3]^a[l-8]^a[l-14]^a[l-16];a[l]=d<<1|d>>>31}var u=(n<<5|n>>>27)+c+a[l];u+=l<20?1518500249+(r&i|~r&o):l<40?1859775393+(r^i^o):l<60?(r&i|r&o|i&o)-1894007588:(r^i^o)-899497514,c=o,o=i,i=r<<30|r>>>2,r=n,n=u}s[0]=s[0]+n|0,s[1]=s[1]+r|0,s[2]=s[2]+i|0,s[3]=s[3]+o|0,s[4]=s[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(s/4294967296),t[15+(n+64>>>9<<4)]=s,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=r._createHelper(o),e.HmacSHA1=r._createHmacHelper(o)}(),t.SHA1)}()},2238:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(8211),void(t.lib.Cipher||function(e){var s=t,n=s.lib,r=n.Base,i=n.WordArray,a=n.BufferedBlockAlgorithm,o=s.enc,c=(o.Utf8,o.Base64),l=s.algo.EvpKDF,d=n.Cipher=a.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,s){this.cfg=this.cfg.extend(s),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?x:y}return function(t){return{encrypt:function(s,n,r){return e(n).encrypt(t,s,n,r)},decrypt:function(s,n,r){return e(n).decrypt(t,s,n,r)}}}}()}),u=(n.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),s.mode={}),h=n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=u.CBC=function(){var t=h.extend();function s(t,s,n){var r,i=this._iv;i?(r=i,this._iv=e):r=this._prevBlock;for(var a=0;a<n;a++)t[s+a]^=r[a]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;s.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),s.call(this,e,t,r),this._prevBlock=i}}),t}(),m=(s.pad={}).Pkcs7={pad:function(e,t){for(var s=4*t,n=s-e.sigBytes%s,r=n<<24|n<<16|n<<8|n,a=[],o=0;o<n;o+=4)a.push(r);var c=i.create(a,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},f=(n.BlockCipher=d.extend({cfg:d.cfg.extend({mode:p,padding:m}),reset:function(){var e;d.reset.call(this);var t=this.cfg,s=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,s&&s.words):(this._mode=e.call(n,this,s&&s.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=(s.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,s=e.salt;return(s?i.create([1398893684,1701076831]).concat(s).concat(t):t).toString(c)},parse:function(e){var t,s=c.parse(e),n=s.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(n.slice(2,4)),n.splice(0,4),s.sigBytes-=16),f.create({ciphertext:s,salt:t})}},y=n.SerializableCipher=r.extend({cfg:r.extend({format:g}),encrypt:function(e,t,s,n){n=this.cfg.extend(n);var r=e.createEncryptor(s,n),i=r.finalize(t),a=r.cfg;return f.create({ciphertext:i,key:s,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,s,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(s,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(s.kdf={}).OpenSSL={execute:function(e,t,s,n,r){if(n||(n=i.random(8)),r)a=l.create({keySize:t+s,hasher:r}).compute(e,n);else var a=l.create({keySize:t+s}).compute(e,n);var o=i.create(a.words.slice(t),4*s);return a.sigBytes=4*t,f.create({key:a,iv:o,salt:n})}},x=n.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:v}),encrypt:function(e,t,s,n){var r=(n=this.cfg.extend(n)).kdf.execute(s,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=r.iv;var i=y.encrypt.call(this,e,t,r.key,n);return i.mixIn(r),i},decrypt:function(e,t,s,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var r=n.kdf.execute(s,e.keySize,e.ivSize,t.salt,n.hasher);return n.iv=r.iv,y.decrypt.call(this,e,t,r.key,n)}})}()))}()},2730:(e,t,s)=>{"use strict";var n=s(5043),r=s(8853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,s,n,r,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function x(e,t,s,n){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,s,n){if(null===t||"undefined"===typeof t||function(e,t,s,n){if(null!==s&&0===s.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==s?!s.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,s,n))return!0;if(n)return!1;if(null!==s)switch(s.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,s,r,n)&&(s=null),n||null===r?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===s?e.removeAttribute(t):e.setAttribute(t,""+s)):r.mustUseProperty?e[r.propertyName]=null===s?3!==r.type&&"":s:(t=r.attributeName,n=r.attributeNamespace,null===s?e.removeAttribute(t):(s=3===(r=r.type)||4===r&&!0===s?"":""+s,n?e.setAttributeNS(n,t,s):e.setAttribute(t,s))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,v);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var _=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E=Symbol.for("react.element"),b=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),j=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var k=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function P(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var L,M=Object.assign;function U(e){if(void 0===L)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var V=!1;function F(e,t){if(!e||V)return"";V=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),i=n.stack.split("\n"),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==i[o]){var c="\n"+r[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=o);break}}}finally{V=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case b:return"Portal";case S:return"Profiler";case N:return"StrictMode";case I:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case j:t=e._payload,e=e._init;try{return G(e(t))}catch(s){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function z(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof s&&"function"===typeof s.get&&"function"===typeof s.set){var r=s.get,i=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),n="";return e&&(n=K(e)?e.checked?"true":"false":e.value),(e=n)!==s&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var s=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=s?s:e._wrapperState.initialChecked})}function J(e,t){var s=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;s=H(null!=t.value?t.value:s),e._wrapperState={initialChecked:n,initialValue:s,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function Z(e,t){Q(e,t);var s=H(t.value),n=t.type;if(null!=s)"number"===n?(0===s&&""===e.value||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,s):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}""!==(s=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==s&&(e.name=s)}function ee(e,t,s){"number"===t&&Y(e.ownerDocument)===e||(null==s?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var te=Array.isArray;function se(e,t,s,n){if(e=e.options,t){t={};for(var r=0;r<s.length;r++)t["$"+s[r]]=!0;for(s=0;s<e.length;s++)r=t.hasOwnProperty("$"+e[s].value),e[s].selected!==r&&(e[s].selected=r),r&&n&&(e[s].defaultSelected=!0)}else{for(s=""+H(s),t=null,r=0;r<e.length;r++){if(e[r].value===s)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var s=t.value;if(null==s){if(s=t.children,t=t.defaultValue,null!=s){if(null!=t)throw Error(i(92));if(te(s)){if(1<s.length)throw Error(i(93));s=s[0]}t=s}null==t&&(t=""),s=t}e._wrapperState={initialValue:H(s)}}function ie(e,t){var s=H(t.value),n=H(t.defaultValue);null!=s&&((s=""+s)!==e.value&&(e.value=s),null==t.defaultValue&&e.defaultValue!==s&&(e.defaultValue=s)),null!=n&&(e.defaultValue=""+n)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,s,n){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&3===s.nodeType)return void(s.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,s){return null==t||"boolean"===typeof t||""===t?"":s||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var s in e=e.style,t)if(t.hasOwnProperty(s)){var n=0===s.indexOf("--"),r=fe(s,t[s],n);"float"===s&&(s="cssFloat"),n?e.setProperty(s,r):e[s]=r}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ye=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _e=null;function Ee(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var be=null,we=null,Ne=null;function Se(e){if(e=xr(e)){if("function"!==typeof be)throw Error(i(280));var t=e.stateNode;t&&(t=Er(t),be(e.stateNode,e.type,t))}}function Te(e){we?Ne?Ne.push(e):Ne=[e]:we=e}function Ce(){if(we){var e=we,t=Ne;if(Ne=we=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Re(e,t){return e(t)}function Ie(){}var Ae=!1;function Oe(e,t,s){if(Ae)return e(t,s);Ae=!0;try{return Re(e,t,s)}finally{Ae=!1,(null!==we||null!==Ne)&&(Ie(),Ce())}}function je(e,t){var s=e.stateNode;if(null===s)return null;var n=Er(s);if(null===n)return null;s=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(s&&"function"!==typeof s)throw Error(i(231,t,typeof s));return s}var ke=!1;if(d)try{var De={};Object.defineProperty(De,"passive",{get:function(){ke=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(de){ke=!1}function Pe(e,t,s,n,r,i,a,o,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(s,l)}catch(d){this.onError(d)}}var Le=!1,Me=null,Ue=!1,Ve=null,Fe={onError:function(e){Le=!0,Me=e}};function Be(e,t,s,n,r,i,a,o,c){Le=!1,Me=null,Pe.apply(Fe,arguments)}function Ge(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(s=t.return),e=t.return}while(e)}return 3===t.tag?s:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ge(e)!==e)throw Error(i(188))}function Ke(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(i(188));return t!==e?null:e}for(var s=e,n=t;;){var r=s.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(n=r.return)){s=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===s)return He(r),e;if(a===n)return He(r),t;a=a.sibling}throw Error(i(188))}if(s.return!==n.return)s=r,n=a;else{for(var o=!1,c=r.child;c;){if(c===s){o=!0,s=r,n=a;break}if(c===n){o=!0,n=r,s=a;break}c=c.sibling}if(!o){for(c=a.child;c;){if(c===s){o=!0,s=a,n=r;break}if(c===n){o=!0,n=a,s=r;break}c=c.sibling}if(!o)throw Error(i(189))}}if(s.alternate!==n)throw Error(i(190))}if(3!==s.tag)throw Error(i(188));return s.stateNode.current===s?e:t}(e))?ze(e):null}function ze(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=ze(e);if(null!==t)return t;e=e.sibling}return null}var qe=r.unstable_scheduleCallback,Ye=r.unstable_cancelCallback,Xe=r.unstable_shouldYield,Je=r.unstable_requestPaint,Qe=r.unstable_now,Ze=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,st=r.unstable_LowPriority,nt=r.unstable_IdlePriority,rt=null,it=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/ct|0)|0},ot=Math.log,ct=Math.LN2;var lt=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var s=e.pendingLanes;if(0===s)return 0;var n=0,r=e.suspendedLanes,i=e.pingedLanes,a=268435455&s;if(0!==a){var o=a&~r;0!==o?n=ut(o):0!==(i&=a)&&(n=ut(i))}else 0!==(a=s&~r)?n=ut(a):0!==i&&(n=ut(i));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(i=t&-t)||16===r&&0!==(4194240&i)))return t;if(0!==(4&n)&&(n|=16&s),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(s=31-at(t)),n|=e[s],t&=~r;return n}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function yt(e,t,s){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=s}function vt(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var n=31-at(s),r=1<<n;r&t|e[n]&t&&(e[n]|=t),s&=~r}}var xt=0;function _t(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Et,bt,wt,Nt,St,Tt=!1,Ct=[],Rt=null,It=null,At=null,Ot=new Map,jt=new Map,kt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":jt.delete(t.pointerId)}}function Lt(e,t,s,n,r,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:s,eventSystemFlags:n,nativeEvent:i,targetContainers:[r]},null!==t&&(null!==(t=xr(t))&&bt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Mt(e){var t=vr(e.target);if(null!==t){var s=Ge(t);if(null!==s)if(13===(t=s.tag)){if(null!==(t=We(s)))return e.blockedOn=t,void St(e.priority,function(){wt(s)})}else if(3===t&&s.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===s.tag?s.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var s=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==s)return null!==(t=xr(s))&&bt(t),e.blockedOn=s,!1;var n=new(s=e.nativeEvent).constructor(s.type,s);_e=n,s.target.dispatchEvent(n),_e=null,t.shift()}return!0}function Vt(e,t,s){Ut(e)&&s.delete(t)}function Ft(){Tt=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==It&&Ut(It)&&(It=null),null!==At&&Ut(At)&&(At=null),Ot.forEach(Vt),jt.forEach(Vt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ft)))}function Gt(e){function t(t){return Bt(t,e)}if(0<Ct.length){Bt(Ct[0],e);for(var s=1;s<Ct.length;s++){var n=Ct[s];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Rt&&Bt(Rt,e),null!==It&&Bt(It,e),null!==At&&Bt(At,e),Ot.forEach(t),jt.forEach(t),s=0;s<kt.length;s++)(n=kt[s]).blockedOn===e&&(n.blockedOn=null);for(;0<kt.length&&null===(s=kt[0]).blockedOn;)Mt(s),null===s.blockedOn&&kt.shift()}var Wt=_.ReactCurrentBatchConfig,Ht=!0;function Kt(e,t,s,n){var r=xt,i=Wt.transition;Wt.transition=null;try{xt=1,qt(e,t,s,n)}finally{xt=r,Wt.transition=i}}function zt(e,t,s,n){var r=xt,i=Wt.transition;Wt.transition=null;try{xt=4,qt(e,t,s,n)}finally{xt=r,Wt.transition=i}}function qt(e,t,s,n){if(Ht){var r=Xt(e,t,s,n);if(null===r)Hn(e,t,n,Yt,s),Pt(e,n);else if(function(e,t,s,n,r){switch(t){case"focusin":return Rt=Lt(Rt,e,t,s,n,r),!0;case"dragenter":return It=Lt(It,e,t,s,n,r),!0;case"mouseover":return At=Lt(At,e,t,s,n,r),!0;case"pointerover":var i=r.pointerId;return Ot.set(i,Lt(Ot.get(i)||null,e,t,s,n,r)),!0;case"gotpointercapture":return i=r.pointerId,jt.set(i,Lt(jt.get(i)||null,e,t,s,n,r)),!0}return!1}(r,e,t,s,n))n.stopPropagation();else if(Pt(e,n),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var i=xr(r);if(null!==i&&Et(i),null===(i=Xt(e,t,s,n))&&Hn(e,t,n,Yt,s),i===r)break;r=i}null!==r&&n.stopPropagation()}else Hn(e,t,n,null,s)}}var Yt=null;function Xt(e,t,s,n){if(Yt=null,null!==(e=vr(e=Ee(n))))if(null===(t=Ge(e)))e=null;else if(13===(s=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===s){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case st:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,$t=null;function es(){if($t)return $t;var e,t,s=Zt,n=s.length,r="value"in Qt?Qt.value:Qt.textContent,i=r.length;for(e=0;e<n&&s[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&s[n-t]===r[i-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function ts(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ss(){return!0}function ns(){return!1}function rs(e){function t(t,s,n,r,i){for(var a in this._reactName=t,this._targetInst=n,this.type=s,this.nativeEvent=r,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ss:ns,this.isPropagationStopped=ns,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ss)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ss)},persist:function(){},isPersistent:ss}),t}var is,as,os,cs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ls=rs(cs),ds=M({},cs,{view:0,detail:0}),us=rs(ds),hs=M({},ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ns,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==os&&(os&&"mousemove"===e.type?(is=e.screenX-os.screenX,as=e.screenY-os.screenY):as=is=0,os=e),is)},movementY:function(e){return"movementY"in e?e.movementY:as}}),ps=rs(hs),ms=rs(M({},hs,{dataTransfer:0})),fs=rs(M({},ds,{relatedTarget:0})),gs=rs(M({},cs,{animationName:0,elapsedTime:0,pseudoElement:0})),ys=M({},cs,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vs=rs(ys),xs=rs(M({},cs,{data:0})),_s={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Es={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ws(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=bs[e])&&!!t[e]}function Ns(){return ws}var Ss=M({},ds,{key:function(e){if(e.key){var t=_s[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ts(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Es[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ns,charCode:function(e){return"keypress"===e.type?ts(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ts(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ts=rs(Ss),Cs=rs(M({},hs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rs=rs(M({},ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ns})),Is=rs(M({},cs,{propertyName:0,elapsedTime:0,pseudoElement:0})),As=M({},hs,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Os=rs(As),js=[9,13,27,32],ks=d&&"CompositionEvent"in window,Ds=null;d&&"documentMode"in document&&(Ds=document.documentMode);var Ps=d&&"TextEvent"in window&&!Ds,Ls=d&&(!ks||Ds&&8<Ds&&11>=Ds),Ms=String.fromCharCode(32),Us=!1;function Vs(e,t){switch(e){case"keyup":return-1!==js.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fs(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Bs=!1;var Gs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ws(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gs[e.type]:"textarea"===t}function Hs(e,t,s,n){Te(n),0<(t=zn(t,"onChange")).length&&(s=new ls("onChange","change",null,s,n),e.push({event:s,listeners:t}))}var Ks=null,zs=null;function qs(e){Un(e,0)}function Ys(e){if(q(_r(e)))return e}function Xs(e,t){if("change"===e)return t}var Js=!1;if(d){var Qs;if(d){var Zs="oninput"in document;if(!Zs){var $s=document.createElement("div");$s.setAttribute("oninput","return;"),Zs="function"===typeof $s.oninput}Qs=Zs}else Qs=!1;Js=Qs&&(!document.documentMode||9<document.documentMode)}function en(){Ks&&(Ks.detachEvent("onpropertychange",tn),zs=Ks=null)}function tn(e){if("value"===e.propertyName&&Ys(zs)){var t=[];Hs(t,zs,e,Ee(e)),Oe(qs,t)}}function sn(e,t,s){"focusin"===e?(en(),zs=s,(Ks=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function nn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ys(zs)}function rn(e,t){if("click"===e)return Ys(t)}function an(e,t){if("input"===e||"change"===e)return Ys(t)}var on="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cn(e,t){if(on(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var r=s[n];if(!u.call(t,r)||!on(e[r],t[r]))return!1}return!0}function ln(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dn(e,t){var s,n=ln(e);for(e=0;n;){if(3===n.nodeType){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ln(n)}}function un(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?un(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hn(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var s="string"===typeof t.contentWindow.location.href}catch(n){s=!1}if(!s)break;t=Y((e=t.contentWindow).document)}return t}function pn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mn(e){var t=hn(),s=e.focusedElem,n=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&un(s.ownerDocument.documentElement,s)){if(null!==n&&pn(s))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if((e=(t=s.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=s.textContent.length,i=Math.min(n.start,r);n=void 0===n.end?i:Math.min(n.end,r),!e.extend&&i>n&&(r=n,n=i,i=r),r=dn(s,i);var a=dn(s,n);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=s;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<t.length;s++)(e=t[s]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fn=d&&"documentMode"in document&&11>=document.documentMode,gn=null,yn=null,vn=null,xn=!1;function _n(e,t,s){var n=s.window===s?s.document:9===s.nodeType?s:s.ownerDocument;xn||null==gn||gn!==Y(n)||("selectionStart"in(n=gn)&&pn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},vn&&cn(vn,n)||(vn=n,0<(n=zn(yn,"onSelect")).length&&(t=new ls("onSelect","select",null,t,s),e.push({event:t,listeners:n}),t.target=gn)))}function En(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var bn={animationend:En("Animation","AnimationEnd"),animationiteration:En("Animation","AnimationIteration"),animationstart:En("Animation","AnimationStart"),transitionend:En("Transition","TransitionEnd")},wn={},Nn={};function Sn(e){if(wn[e])return wn[e];if(!bn[e])return e;var t,s=bn[e];for(t in s)if(s.hasOwnProperty(t)&&t in Nn)return wn[e]=s[t];return e}d&&(Nn=document.createElement("div").style,"AnimationEvent"in window||(delete bn.animationend.animation,delete bn.animationiteration.animation,delete bn.animationstart.animation),"TransitionEvent"in window||delete bn.transitionend.transition);var Tn=Sn("animationend"),Cn=Sn("animationiteration"),Rn=Sn("animationstart"),In=Sn("transitionend"),An=new Map,On="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jn(e,t){An.set(e,t),c(t,[e])}for(var kn=0;kn<On.length;kn++){var Dn=On[kn];jn(Dn.toLowerCase(),"on"+(Dn[0].toUpperCase()+Dn.slice(1)))}jn(Tn,"onAnimationEnd"),jn(Cn,"onAnimationIteration"),jn(Rn,"onAnimationStart"),jn("dblclick","onDoubleClick"),jn("focusin","onFocus"),jn("focusout","onBlur"),jn(In,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ln=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pn));function Mn(e,t,s){var n=e.type||"unknown-event";e.currentTarget=s,function(e,t,s,n,r,a,o,c,l){if(Be.apply(this,arguments),Le){if(!Le)throw Error(i(198));var d=Me;Le=!1,Me=null,Ue||(Ue=!0,Ve=d)}}(n,t,void 0,e),e.currentTarget=null}function Un(e,t){t=0!==(4&t);for(var s=0;s<e.length;s++){var n=e[s],r=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],c=o.instance,l=o.currentTarget;if(o=o.listener,c!==i&&r.isPropagationStopped())break e;Mn(r,o,l),i=c}else for(a=0;a<n.length;a++){if(c=(o=n[a]).instance,l=o.currentTarget,o=o.listener,c!==i&&r.isPropagationStopped())break e;Mn(r,o,l),i=c}}}if(Ue)throw e=Ve,Ue=!1,Ve=null,e}function Vn(e,t){var s=t[fr];void 0===s&&(s=t[fr]=new Set);var n=e+"__bubble";s.has(n)||(Wn(t,e,2,!1),s.add(n))}function Fn(e,t,s){var n=0;t&&(n|=4),Wn(s,e,n,t)}var Bn="_reactListening"+Math.random().toString(36).slice(2);function Gn(e){if(!e[Bn]){e[Bn]=!0,a.forEach(function(t){"selectionchange"!==t&&(Ln.has(t)||Fn(t,!1,e),Fn(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bn]||(t[Bn]=!0,Fn("selectionchange",!1,t))}}function Wn(e,t,s,n){switch(Jt(t)){case 1:var r=Kt;break;case 4:r=zt;break;default:r=qt}s=r.bind(null,t,s,e),r=void 0,!ke||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,s,{capture:!0,passive:r}):e.addEventListener(t,s,!0):void 0!==r?e.addEventListener(t,s,{passive:r}):e.addEventListener(t,s,!1)}function Hn(e,t,s,n,r){var i=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===r||8===c.nodeType&&c.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=vr(o)))return;if(5===(c=a.tag)||6===c){n=i=a;continue e}o=o.parentNode}}n=n.return}Oe(function(){var n=i,r=Ee(s),a=[];e:{var o=An.get(e);if(void 0!==o){var c=ls,l=e;switch(e){case"keypress":if(0===ts(s))break e;case"keydown":case"keyup":c=Ts;break;case"focusin":l="focus",c=fs;break;case"focusout":l="blur",c=fs;break;case"beforeblur":case"afterblur":c=fs;break;case"click":if(2===s.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=ps;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ms;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Rs;break;case Tn:case Cn:case Rn:c=gs;break;case In:c=Is;break;case"scroll":c=us;break;case"wheel":c=Os;break;case"copy":case"cut":case"paste":c=vs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Cs}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var p,m=n;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=je(m,h))&&d.push(Kn(m,f,p)))),u)break;m=m.return}0<d.length&&(o=new c(o,l,null,s,r),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||s===_e||!(l=s.relatedTarget||s.fromElement)||!vr(l)&&!l[mr])&&(c||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=n,null!==(l=(l=s.relatedTarget||s.toElement)?vr(l):null)&&(l!==(u=Ge(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=n),c!==l)){if(d=ps,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Cs,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==c?o:_r(c),p=null==l?o:_r(l),(o=new d(f,m+"leave",c,s,r)).target=u,o.relatedTarget=p,f=null,vr(r)===n&&((d=new d(h,m+"enter",l,s,r)).target=p,d.relatedTarget=u,f=d),u=f,c&&l)e:{for(h=l,m=0,p=d=c;p;p=qn(p))m++;for(p=0,f=h;f;f=qn(f))p++;for(;0<m-p;)d=qn(d),m--;for(;0<p-m;)h=qn(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=qn(d),h=qn(h)}d=null}else d=null;null!==c&&Yn(a,o,c,d,!1),null!==l&&null!==u&&Yn(a,u,l,d,!0)}if("select"===(c=(o=n?_r(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var g=Xs;else if(Ws(o))if(Js)g=an;else{g=nn;var y=sn}else(c=o.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=rn);switch(g&&(g=g(e,n))?Hs(a,g,s,r):(y&&y(e,o,n),"focusout"===e&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&ee(o,"number",o.value)),y=n?_r(n):window,e){case"focusin":(Ws(y)||"true"===y.contentEditable)&&(gn=y,yn=n,vn=null);break;case"focusout":vn=yn=gn=null;break;case"mousedown":xn=!0;break;case"contextmenu":case"mouseup":case"dragend":xn=!1,_n(a,s,r);break;case"selectionchange":if(fn)break;case"keydown":case"keyup":_n(a,s,r)}var v;if(ks)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Bs?Vs(e,s)&&(x="onCompositionEnd"):"keydown"===e&&229===s.keyCode&&(x="onCompositionStart");x&&(Ls&&"ko"!==s.locale&&(Bs||"onCompositionStart"!==x?"onCompositionEnd"===x&&Bs&&(v=es()):(Zt="value"in(Qt=r)?Qt.value:Qt.textContent,Bs=!0)),0<(y=zn(n,x)).length&&(x=new xs(x,e,null,s,r),a.push({event:x,listeners:y}),v?x.data=v:null!==(v=Fs(s))&&(x.data=v))),(v=Ps?function(e,t){switch(e){case"compositionend":return Fs(t);case"keypress":return 32!==t.which?null:(Us=!0,Ms);case"textInput":return(e=t.data)===Ms&&Us?null:e;default:return null}}(e,s):function(e,t){if(Bs)return"compositionend"===e||!ks&&Vs(e,t)?(e=es(),$t=Zt=Qt=null,Bs=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ls&&"ko"!==t.locale?null:t.data}}(e,s))&&(0<(n=zn(n,"onBeforeInput")).length&&(r=new xs("onBeforeInput","beforeinput",null,s,r),a.push({event:r,listeners:n}),r.data=v))}Un(a,t)})}function Kn(e,t,s){return{instance:e,listener:t,currentTarget:s}}function zn(e,t){for(var s=t+"Capture",n=[];null!==e;){var r=e,i=r.stateNode;5===r.tag&&null!==i&&(r=i,null!=(i=je(e,s))&&n.unshift(Kn(e,i,r)),null!=(i=je(e,t))&&n.push(Kn(e,i,r))),e=e.return}return n}function qn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yn(e,t,s,n,r){for(var i=t._reactName,a=[];null!==s&&s!==n;){var o=s,c=o.alternate,l=o.stateNode;if(null!==c&&c===n)break;5===o.tag&&null!==l&&(o=l,r?null!=(c=je(s,i))&&a.unshift(Kn(s,c,o)):r||null!=(c=je(s,i))&&a.push(Kn(s,c,o))),s=s.return}0!==a.length&&e.push({event:t,listeners:a})}var Xn=/\r\n?/g,Jn=/\u0000|\uFFFD/g;function Qn(e){return("string"===typeof e?e:""+e).replace(Xn,"\n").replace(Jn,"")}function Zn(e,t,s){if(t=Qn(t),Qn(e)!==t&&s)throw Error(i(425))}function $n(){}var er=null,tr=null;function sr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ir="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ir?function(e){return ir.resolve(null).then(e).catch(or)}:nr;function or(e){setTimeout(function(){throw e})}function cr(e,t){var s=t,n=0;do{var r=s.nextSibling;if(e.removeChild(s),r&&8===r.nodeType)if("/$"===(s=r.data)){if(0===n)return e.removeChild(r),void Gt(t);n--}else"$"!==s&&"$?"!==s&&"$!"!==s||n++;s=r}while(s);Gt(t)}function lr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var s=e.data;if("$"===s||"$!"===s||"$?"===s){if(0===t)return e;t--}else"/$"===s&&t++}e=e.previousSibling}return null}var ur=Math.random().toString(36).slice(2),hr="__reactFiber$"+ur,pr="__reactProps$"+ur,mr="__reactContainer$"+ur,fr="__reactEvents$"+ur,gr="__reactListeners$"+ur,yr="__reactHandles$"+ur;function vr(e){var t=e[hr];if(t)return t;for(var s=e.parentNode;s;){if(t=s[mr]||s[hr]){if(s=t.alternate,null!==t.child||null!==s&&null!==s.child)for(e=dr(e);null!==e;){if(s=e[hr])return s;e=dr(e)}return t}s=(e=s).parentNode}return null}function xr(e){return!(e=e[hr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function _r(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function Er(e){return e[pr]||null}var br=[],wr=-1;function Nr(e){return{current:e}}function Sr(e){0>wr||(e.current=br[wr],br[wr]=null,wr--)}function Tr(e,t){wr++,br[wr]=e.current,e.current=t}var Cr={},Rr=Nr(Cr),Ir=Nr(!1),Ar=Cr;function Or(e,t){var s=e.type.contextTypes;if(!s)return Cr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,i={};for(r in s)i[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function jr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function kr(){Sr(Ir),Sr(Rr)}function Dr(e,t,s){if(Rr.current!==Cr)throw Error(i(168));Tr(Rr,t),Tr(Ir,s)}function Pr(e,t,s){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return s;for(var r in n=n.getChildContext())if(!(r in t))throw Error(i(108,W(e)||"Unknown",r));return M({},s,n)}function Lr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cr,Ar=Rr.current,Tr(Rr,e),Tr(Ir,Ir.current),!0}function Mr(e,t,s){var n=e.stateNode;if(!n)throw Error(i(169));s?(e=Pr(e,t,Ar),n.__reactInternalMemoizedMergedChildContext=e,Sr(Ir),Sr(Rr),Tr(Rr,e)):Sr(Ir),Tr(Ir,s)}var Ur=null,Vr=!1,Fr=!1;function Br(e){null===Ur?Ur=[e]:Ur.push(e)}function Gr(){if(!Fr&&null!==Ur){Fr=!0;var e=0,t=xt;try{var s=Ur;for(xt=1;e<s.length;e++){var n=s[e];do{n=n(!0)}while(null!==n)}Ur=null,Vr=!1}catch(r){throw null!==Ur&&(Ur=Ur.slice(e+1)),qe($e,Gr),r}finally{xt=t,Fr=!1}}return null}var Wr=[],Hr=0,Kr=null,zr=0,qr=[],Yr=0,Xr=null,Jr=1,Qr="";function Zr(e,t){Wr[Hr++]=zr,Wr[Hr++]=Kr,Kr=e,zr=t}function $r(e,t,s){qr[Yr++]=Jr,qr[Yr++]=Qr,qr[Yr++]=Xr,Xr=e;var n=Jr;e=Qr;var r=32-at(n)-1;n&=~(1<<r),s+=1;var i=32-at(t)+r;if(30<i){var a=r-r%5;i=(n&(1<<a)-1).toString(32),n>>=a,r-=a,Jr=1<<32-at(t)+r|s<<r|n,Qr=i+e}else Jr=1<<i|s<<r|n,Qr=e}function ei(e){null!==e.return&&(Zr(e,1),$r(e,1,0))}function ti(e){for(;e===Kr;)Kr=Wr[--Hr],Wr[Hr]=null,zr=Wr[--Hr],Wr[Hr]=null;for(;e===Xr;)Xr=qr[--Yr],qr[Yr]=null,Qr=qr[--Yr],qr[Yr]=null,Jr=qr[--Yr],qr[Yr]=null}var si=null,ni=null,ri=!1,ii=null;function ai(e,t){var s=jl(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,null===(t=e.deletions)?(e.deletions=[s],e.flags|=16):t.push(s)}function oi(e,t){switch(e.tag){case 5:var s=e.type;return null!==(t=1!==t.nodeType||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,si=e,ni=lr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,si=e,ni=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(s=null!==Xr?{id:Jr,overflow:Qr}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},(s=jl(18,null,null,0)).stateNode=t,s.return=e,e.child=s,si=e,ni=null,!0);default:return!1}}function ci(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function li(e){if(ri){var t=ni;if(t){var s=t;if(!oi(e,t)){if(ci(e))throw Error(i(418));t=lr(s.nextSibling);var n=si;t&&oi(e,t)?ai(n,s):(e.flags=-4097&e.flags|2,ri=!1,si=e)}}else{if(ci(e))throw Error(i(418));e.flags=-4097&e.flags|2,ri=!1,si=e}}}function di(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;si=e}function ui(e){if(e!==si)return!1;if(!ri)return di(e),ri=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!sr(e.type,e.memoizedProps)),t&&(t=ni)){if(ci(e))throw hi(),Error(i(418));for(;t;)ai(e,t),t=lr(t.nextSibling)}if(di(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var s=e.data;if("/$"===s){if(0===t){ni=lr(e.nextSibling);break e}t--}else"$"!==s&&"$!"!==s&&"$?"!==s||t++}e=e.nextSibling}ni=null}}else ni=si?lr(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=ni;e;)e=lr(e.nextSibling)}function pi(){ni=si=null,ri=!1}function mi(e){null===ii?ii=[e]:ii.push(e)}var fi=_.ReactCurrentBatchConfig;function gi(e,t){if(e&&e.defaultProps){for(var s in t=M({},t),e=e.defaultProps)void 0===t[s]&&(t[s]=e[s]);return t}return t}var yi=Nr(null),vi=null,xi=null,_i=null;function Ei(){_i=xi=vi=null}function bi(e){var t=yi.current;Sr(yi),e._currentValue=t}function wi(e,t,s){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===s)break;e=e.return}}function Ni(e,t){vi=e,_i=xi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(_o=!0),e.firstContext=null)}function Si(e){var t=e._currentValue;if(_i!==e)if(e={context:e,memoizedValue:t,next:null},null===xi){if(null===vi)throw Error(i(308));xi=e,vi.dependencies={lanes:0,firstContext:e}}else xi=xi.next=e;return t}var Ti=null;function Ci(e){null===Ti?Ti=[e]:Ti.push(e)}function Ri(e,t,s,n){var r=t.interleaved;return null===r?(s.next=s,Ci(t)):(s.next=r.next,r.next=s),t.interleaved=s,Ii(e,n)}function Ii(e,t){e.lanes|=t;var s=e.alternate;for(null!==s&&(s.lanes|=t),s=e,e=e.return;null!==e;)e.childLanes|=t,null!==(s=e.alternate)&&(s.childLanes|=t),s=e,e=e.return;return 3===s.tag?s.stateNode:null}var Ai=!1;function Oi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ji(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ki(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Di(e,t,s){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Ic)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Ii(e,s)}return null===(r=n.interleaved)?(t.next=t,Ci(n)):(t.next=r.next,r.next=t),n.interleaved=t,Ii(e,s)}function Pi(e,t,s){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&s))){var n=t.lanes;s|=n&=e.pendingLanes,t.lanes=s,vt(e,s)}}function Li(e,t){var s=e.updateQueue,n=e.alternate;if(null!==n&&s===(n=n.updateQueue)){var r=null,i=null;if(null!==(s=s.firstBaseUpdate)){do{var a={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};null===i?r=i=a:i=i.next=a,s=s.next}while(null!==s);null===i?r=i=t:i=i.next=t}else r=i=t;return s={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:n.shared,effects:n.effects},void(e.updateQueue=s)}null===(e=s.lastBaseUpdate)?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Mi(e,t,s,n){var r=e.updateQueue;Ai=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var c=o,l=c.next;c.next=null,null===a?i=l:a.next=l,a=c;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=l:o.next=l,d.lastBaseUpdate=c))}if(null!==i){var u=r.baseState;for(a=0,d=l=c=null,o=i;;){var h=o.lane,p=o.eventTime;if((n&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,f=o;switch(h=t,p=s,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=M({},u,h);break e;case 2:Ai=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,a|=h;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(h=o).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===d&&(c=u),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===i&&(r.shared.lanes=0);Mc|=a,e.lanes=a,e.memoizedState=u}}function Ui(e,t,s){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=s,"function"!==typeof r)throw Error(i(191,r));r.call(n)}}}var Vi=(new n.Component).refs;function Fi(e,t,s,n){s=null===(s=s(n,t=e.memoizedState))||void 0===s?t:M({},t,s),e.memoizedState=s,0===e.lanes&&(e.updateQueue.baseState=s)}var Bi={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,s){e=e._reactInternals;var n=tl(),r=sl(e),i=ki(n,r);i.payload=t,void 0!==s&&null!==s&&(i.callback=s),null!==(t=Di(e,i,r))&&(nl(t,e,r,n),Pi(t,e,r))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var n=tl(),r=sl(e),i=ki(n,r);i.tag=1,i.payload=t,void 0!==s&&null!==s&&(i.callback=s),null!==(t=Di(e,i,r))&&(nl(t,e,r,n),Pi(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=tl(),n=sl(e),r=ki(s,n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Di(e,r,n))&&(nl(t,e,n,s),Pi(t,e,n))}};function Gi(e,t,s,n,r,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!cn(s,n)||!cn(r,i))}function Wi(e,t,s){var n=!1,r=Cr,i=t.contextType;return"object"===typeof i&&null!==i?i=Si(i):(r=jr(t)?Ar:Rr.current,i=(n=null!==(n=t.contextTypes)&&void 0!==n)?Or(e,r):Cr),t=new t(s,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Bi,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=i),t}function Hi(e,t,s,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(s,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(s,n),t.state!==e&&Bi.enqueueReplaceState(t,t.state,null)}function Ki(e,t,s,n){var r=e.stateNode;r.props=s,r.state=e.memoizedState,r.refs=Vi,Oi(e);var i=t.contextType;"object"===typeof i&&null!==i?r.context=Si(i):(i=jr(t)?Ar:Rr.current,r.context=Or(e,i)),r.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Fi(e,t,i,s),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Bi.enqueueReplaceState(r,r.state,null),Mi(e,s,r,n),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function zi(e,t,s){if(null!==(e=s.ref)&&"function"!==typeof e&&"object"!==typeof e){if(s._owner){if(s=s._owner){if(1!==s.tag)throw Error(i(309));var n=s.stateNode}if(!n)throw Error(i(147,e));var r=n,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===Vi&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(i(284));if(!s._owner)throw Error(i(290,e))}return e}function qi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yi(e){return(0,e._init)(e._payload)}function Xi(e){function t(t,s){if(e){var n=t.deletions;null===n?(t.deletions=[s],t.flags|=16):n.push(s)}}function s(s,n){if(!e)return null;for(;null!==n;)t(s,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Dl(e,t)).index=0,e.sibling=null,e}function a(t,s,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<s?(t.flags|=2,s):n:(t.flags|=2,s):(t.flags|=1048576,s)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,s,n){return null===t||6!==t.tag?((t=Ul(s,e.mode,n)).return=e,t):((t=r(t,s)).return=e,t)}function l(e,t,s,n){var i=s.type;return i===w?u(e,t,s.props.children,n,s.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===j&&Yi(i)===t.type)?((n=r(t,s.props)).ref=zi(e,t,s),n.return=e,n):((n=Pl(s.type,s.key,s.props,null,e.mode,n)).ref=zi(e,t,s),n.return=e,n)}function d(e,t,s,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==s.containerInfo||t.stateNode.implementation!==s.implementation?((t=Vl(s,e.mode,n)).return=e,t):((t=r(t,s.children||[])).return=e,t)}function u(e,t,s,n,i){return null===t||7!==t.tag?((t=Ll(s,e.mode,n,i)).return=e,t):((t=r(t,s)).return=e,t)}function h(e,t,s){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ul(""+t,e.mode,s)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case E:return(s=Pl(t.type,t.key,t.props,null,e.mode,s)).ref=zi(e,null,t),s.return=e,s;case b:return(t=Vl(t,e.mode,s)).return=e,t;case j:return h(e,(0,t._init)(t._payload),s)}if(te(t)||P(t))return(t=Ll(t,e.mode,s,null)).return=e,t;qi(e,t)}return null}function p(e,t,s,n){var r=null!==t?t.key:null;if("string"===typeof s&&""!==s||"number"===typeof s)return null!==r?null:c(e,t,""+s,n);if("object"===typeof s&&null!==s){switch(s.$$typeof){case E:return s.key===r?l(e,t,s,n):null;case b:return s.key===r?d(e,t,s,n):null;case j:return p(e,t,(r=s._init)(s._payload),n)}if(te(s)||P(s))return null!==r?null:u(e,t,s,n,null);qi(e,s)}return null}function m(e,t,s,n,r){if("string"===typeof n&&""!==n||"number"===typeof n)return c(t,e=e.get(s)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case E:return l(t,e=e.get(null===n.key?s:n.key)||null,n,r);case b:return d(t,e=e.get(null===n.key?s:n.key)||null,n,r);case j:return m(e,t,s,(0,n._init)(n._payload),r)}if(te(n)||P(n))return u(t,e=e.get(s)||null,n,r,null);qi(t,n)}return null}function f(r,i,o,c){for(var l=null,d=null,u=i,f=i=0,g=null;null!==u&&f<o.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var y=p(r,u,o[f],c);if(null===y){null===u&&(u=g);break}e&&u&&null===y.alternate&&t(r,u),i=a(y,i,f),null===d?l=y:d.sibling=y,d=y,u=g}if(f===o.length)return s(r,u),ri&&Zr(r,f),l;if(null===u){for(;f<o.length;f++)null!==(u=h(r,o[f],c))&&(i=a(u,i,f),null===d?l=u:d.sibling=u,d=u);return ri&&Zr(r,f),l}for(u=n(r,u);f<o.length;f++)null!==(g=m(u,r,f,o[f],c))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),i=a(g,i,f),null===d?l=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(r,e)}),ri&&Zr(r,f),l}function g(r,o,c,l){var d=P(c);if("function"!==typeof d)throw Error(i(150));if(null==(c=d.call(c)))throw Error(i(151));for(var u=d=null,f=o,g=o=0,y=null,v=c.next();null!==f&&!v.done;g++,v=c.next()){f.index>g?(y=f,f=null):y=f.sibling;var x=p(r,f,v.value,l);if(null===x){null===f&&(f=y);break}e&&f&&null===x.alternate&&t(r,f),o=a(x,o,g),null===u?d=x:u.sibling=x,u=x,f=y}if(v.done)return s(r,f),ri&&Zr(r,g),d;if(null===f){for(;!v.done;g++,v=c.next())null!==(v=h(r,v.value,l))&&(o=a(v,o,g),null===u?d=v:u.sibling=v,u=v);return ri&&Zr(r,g),d}for(f=n(r,f);!v.done;g++,v=c.next())null!==(v=m(f,r,g,v.value,l))&&(e&&null!==v.alternate&&f.delete(null===v.key?g:v.key),o=a(v,o,g),null===u?d=v:u.sibling=v,u=v);return e&&f.forEach(function(e){return t(r,e)}),ri&&Zr(r,g),d}return function e(n,i,a,c){if("object"===typeof a&&null!==a&&a.type===w&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case E:e:{for(var l=a.key,d=i;null!==d;){if(d.key===l){if((l=a.type)===w){if(7===d.tag){s(n,d.sibling),(i=r(d,a.props.children)).return=n,n=i;break e}}else if(d.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===j&&Yi(l)===d.type){s(n,d.sibling),(i=r(d,a.props)).ref=zi(n,d,a),i.return=n,n=i;break e}s(n,d);break}t(n,d),d=d.sibling}a.type===w?((i=Ll(a.props.children,n.mode,c,a.key)).return=n,n=i):((c=Pl(a.type,a.key,a.props,null,n.mode,c)).ref=zi(n,i,a),c.return=n,n=c)}return o(n);case b:e:{for(d=a.key;null!==i;){if(i.key===d){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){s(n,i.sibling),(i=r(i,a.children||[])).return=n,n=i;break e}s(n,i);break}t(n,i),i=i.sibling}(i=Vl(a,n.mode,c)).return=n,n=i}return o(n);case j:return e(n,i,(d=a._init)(a._payload),c)}if(te(a))return f(n,i,a,c);if(P(a))return g(n,i,a,c);qi(n,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(s(n,i.sibling),(i=r(i,a)).return=n,n=i):(s(n,i),(i=Ul(a,n.mode,c)).return=n,n=i),o(n)):s(n,i)}}var Ji=Xi(!0),Qi=Xi(!1),Zi={},$i=Nr(Zi),ea=Nr(Zi),ta=Nr(Zi);function sa(e){if(e===Zi)throw Error(i(174));return e}function na(e,t){switch(Tr(ta,t),Tr(ea,e),Tr($i,Zi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Sr($i),Tr($i,t)}function ra(){Sr($i),Sr(ea),Sr(ta)}function ia(e){sa(ta.current);var t=sa($i.current),s=ce(t,e.type);t!==s&&(Tr(ea,e),Tr($i,s))}function aa(e){ea.current===e&&(Sr($i),Sr(ea))}var oa=Nr(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var s=t.memoizedState;if(null!==s&&(null===(s=s.dehydrated)||"$?"===s.data||"$!"===s.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var la=[];function da(){for(var e=0;e<la.length;e++)la[e]._workInProgressVersionPrimary=null;la.length=0}var ua=_.ReactCurrentDispatcher,ha=_.ReactCurrentBatchConfig,pa=0,ma=null,fa=null,ga=null,ya=!1,va=!1,xa=0,_a=0;function Ea(){throw Error(i(321))}function ba(e,t){if(null===t)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!on(e[s],t[s]))return!1;return!0}function wa(e,t,s,n,r,a){if(pa=a,ma=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ua.current=null===e||null===e.memoizedState?ao:oo,e=s(n,r),va){a=0;do{if(va=!1,xa=0,25<=a)throw Error(i(301));a+=1,ga=fa=null,t.updateQueue=null,ua.current=co,e=s(n,r)}while(va)}if(ua.current=io,t=null!==fa&&null!==fa.next,pa=0,ga=fa=ma=null,ya=!1,t)throw Error(i(300));return e}function Na(){var e=0!==xa;return xa=0,e}function Sa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ga?ma.memoizedState=ga=e:ga=ga.next=e,ga}function Ta(){if(null===fa){var e=ma.alternate;e=null!==e?e.memoizedState:null}else e=fa.next;var t=null===ga?ma.memoizedState:ga.next;if(null!==t)ga=t,fa=e;else{if(null===e)throw Error(i(310));e={memoizedState:(fa=e).memoizedState,baseState:fa.baseState,baseQueue:fa.baseQueue,queue:fa.queue,next:null},null===ga?ma.memoizedState=ga=e:ga=ga.next=e}return ga}function Ca(e,t){return"function"===typeof t?t(e):t}function Ra(e){var t=Ta(),s=t.queue;if(null===s)throw Error(i(311));s.lastRenderedReducer=e;var n=fa,r=n.baseQueue,a=s.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}n.baseQueue=r=a,s.pending=null}if(null!==r){a=r.next,n=n.baseState;var c=o=null,l=null,d=a;do{var u=d.lane;if((pa&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===l?(c=l=h,o=n):l=l.next=h,ma.lanes|=u,Mc|=u}d=d.next}while(null!==d&&d!==a);null===l?o=n:l.next=c,on(n,t.memoizedState)||(_o=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=l,s.lastRenderedState=n}if(null!==(e=s.interleaved)){r=e;do{a=r.lane,ma.lanes|=a,Mc|=a,r=r.next}while(r!==e)}else null===r&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function Ia(e){var t=Ta(),s=t.queue;if(null===s)throw Error(i(311));s.lastRenderedReducer=e;var n=s.dispatch,r=s.pending,a=t.memoizedState;if(null!==r){s.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);on(a,t.memoizedState)||(_o=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),s.lastRenderedState=a}return[a,n]}function Aa(){}function Oa(e,t){var s=ma,n=Ta(),r=t(),a=!on(n.memoizedState,r);if(a&&(n.memoizedState=r,_o=!0),n=n.queue,Wa(Da.bind(null,s,n,e),[e]),n.getSnapshot!==t||a||null!==ga&&1&ga.memoizedState.tag){if(s.flags|=2048,Ua(9,ka.bind(null,s,n,r,t),void 0,null),null===Ac)throw Error(i(349));0!==(30&pa)||ja(s,t,r)}return r}function ja(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.stores=[e]):null===(s=t.stores)?t.stores=[e]:s.push(e)}function ka(e,t,s,n){t.value=s,t.getSnapshot=n,Pa(t)&&La(e)}function Da(e,t,s){return s(function(){Pa(t)&&La(e)})}function Pa(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!on(e,s)}catch(n){return!0}}function La(e){var t=Ii(e,1);null!==t&&nl(t,e,1,-1)}function Ma(e){var t=Sa();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:e},t.queue=e,e=e.dispatch=to.bind(null,ma,e),[t.memoizedState,e]}function Ua(e,t,s,n){return e={tag:e,create:t,destroy:s,deps:n,next:null},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.lastEffect=e.next=e):null===(s=t.lastEffect)?t.lastEffect=e.next=e:(n=s.next,s.next=e,e.next=n,t.lastEffect=e),e}function Va(){return Ta().memoizedState}function Fa(e,t,s,n){var r=Sa();ma.flags|=e,r.memoizedState=Ua(1|t,s,void 0,void 0===n?null:n)}function Ba(e,t,s,n){var r=Ta();n=void 0===n?null:n;var i=void 0;if(null!==fa){var a=fa.memoizedState;if(i=a.destroy,null!==n&&ba(n,a.deps))return void(r.memoizedState=Ua(t,s,i,n))}ma.flags|=e,r.memoizedState=Ua(1|t,s,i,n)}function Ga(e,t){return Fa(8390656,8,e,t)}function Wa(e,t){return Ba(2048,8,e,t)}function Ha(e,t){return Ba(4,2,e,t)}function Ka(e,t){return Ba(4,4,e,t)}function za(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qa(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,Ba(4,4,za.bind(null,t,e),s)}function Ya(){}function Xa(e,t){var s=Ta();t=void 0===t?null:t;var n=s.memoizedState;return null!==n&&null!==t&&ba(t,n[1])?n[0]:(s.memoizedState=[e,t],e)}function Ja(e,t){var s=Ta();t=void 0===t?null:t;var n=s.memoizedState;return null!==n&&null!==t&&ba(t,n[1])?n[0]:(e=e(),s.memoizedState=[e,t],e)}function Qa(e,t,s){return 0===(21&pa)?(e.baseState&&(e.baseState=!1,_o=!0),e.memoizedState=s):(on(s,t)||(s=ft(),ma.lanes|=s,Mc|=s,e.baseState=!0),t)}function Za(e,t){var s=xt;xt=0!==s&&4>s?s:4,e(!0);var n=ha.transition;ha.transition={};try{e(!1),t()}finally{xt=s,ha.transition=n}}function $a(){return Ta().memoizedState}function eo(e,t,s){var n=sl(e);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},so(e))no(t,s);else if(null!==(s=Ri(e,t,s,n))){nl(s,e,n,tl()),ro(s,t,n)}}function to(e,t,s){var n=sl(e),r={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if(so(e))no(t,r);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=i(a,s);if(r.hasEagerState=!0,r.eagerState=o,on(o,a)){var c=t.interleaved;return null===c?(r.next=r,Ci(t)):(r.next=c.next,c.next=r),void(t.interleaved=r)}}catch(l){}null!==(s=Ri(e,t,r,n))&&(nl(s,e,n,r=tl()),ro(s,t,n))}}function so(e){var t=e.alternate;return e===ma||null!==t&&t===ma}function no(e,t){va=ya=!0;var s=e.pending;null===s?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function ro(e,t,s){if(0!==(4194240&s)){var n=t.lanes;s|=n&=e.pendingLanes,t.lanes=s,vt(e,s)}}var io={readContext:Si,useCallback:Ea,useContext:Ea,useEffect:Ea,useImperativeHandle:Ea,useInsertionEffect:Ea,useLayoutEffect:Ea,useMemo:Ea,useReducer:Ea,useRef:Ea,useState:Ea,useDebugValue:Ea,useDeferredValue:Ea,useTransition:Ea,useMutableSource:Ea,useSyncExternalStore:Ea,useId:Ea,unstable_isNewReconciler:!1},ao={readContext:Si,useCallback:function(e,t){return Sa().memoizedState=[e,void 0===t?null:t],e},useContext:Si,useEffect:Ga,useImperativeHandle:function(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,Fa(4194308,4,za.bind(null,t,e),s)},useLayoutEffect:function(e,t){return Fa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Fa(4,2,e,t)},useMemo:function(e,t){var s=Sa();return t=void 0===t?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var n=Sa();return t=void 0!==s?s(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=eo.bind(null,ma,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},Sa().memoizedState=e},useState:Ma,useDebugValue:Ya,useDeferredValue:function(e){return Sa().memoizedState=e},useTransition:function(){var e=Ma(!1),t=e[0];return e=Za.bind(null,e[1]),Sa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var n=ma,r=Sa();if(ri){if(void 0===s)throw Error(i(407));s=s()}else{if(s=t(),null===Ac)throw Error(i(349));0!==(30&pa)||ja(n,t,s)}r.memoizedState=s;var a={value:s,getSnapshot:t};return r.queue=a,Ga(Da.bind(null,n,a,e),[e]),n.flags|=2048,Ua(9,ka.bind(null,n,a,s,t),void 0,null),s},useId:function(){var e=Sa(),t=Ac.identifierPrefix;if(ri){var s=Qr;t=":"+t+"R"+(s=(Jr&~(1<<32-at(Jr)-1)).toString(32)+s),0<(s=xa++)&&(t+="H"+s.toString(32)),t+=":"}else t=":"+t+"r"+(s=_a++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},oo={readContext:Si,useCallback:Xa,useContext:Si,useEffect:Wa,useImperativeHandle:qa,useInsertionEffect:Ha,useLayoutEffect:Ka,useMemo:Ja,useReducer:Ra,useRef:Va,useState:function(){return Ra(Ca)},useDebugValue:Ya,useDeferredValue:function(e){return Qa(Ta(),fa.memoizedState,e)},useTransition:function(){return[Ra(Ca)[0],Ta().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1},co={readContext:Si,useCallback:Xa,useContext:Si,useEffect:Wa,useImperativeHandle:qa,useInsertionEffect:Ha,useLayoutEffect:Ka,useMemo:Ja,useReducer:Ia,useRef:Va,useState:function(){return Ia(Ca)},useDebugValue:Ya,useDeferredValue:function(e){var t=Ta();return null===fa?t.memoizedState=e:Qa(t,fa.memoizedState,e)},useTransition:function(){return[Ia(Ca)[0],Ta().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Oa,useId:$a,unstable_isNewReconciler:!1};function lo(e,t){try{var s="",n=t;do{s+=B(n),n=n.return}while(n);var r=s}catch(i){r="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:r,digest:null}}function uo(e,t,s){return{value:e,source:null,stack:null!=s?s:null,digest:null!=t?t:null}}function ho(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var po="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,s){(s=ki(-1,s)).tag=3,s.payload={element:null};var n=t.value;return s.callback=function(){Kc||(Kc=!0,zc=n),ho(0,t)},s}function fo(e,t,s){(s=ki(-1,s)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var r=t.value;s.payload=function(){return n(r)},s.callback=function(){ho(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(s.callback=function(){ho(0,t),"function"!==typeof n&&(null===qc?qc=new Set([this]):qc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),s}function go(e,t,s){var n=e.pingCache;if(null===n){n=e.pingCache=new po;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(s)||(r.add(s),e=Tl.bind(null,e,t,s),t.then(e,e))}function yo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,s,n,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,1===s.tag&&(null===s.alternate?s.tag=17:((t=ki(-1,1)).tag=2,Di(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var xo=_.ReactCurrentOwner,_o=!1;function Eo(e,t,s,n){t.child=null===e?Qi(t,null,s,n):Ji(t,e.child,s,n)}function bo(e,t,s,n,r){s=s.render;var i=t.ref;return Ni(t,r),n=wa(e,t,s,n,i,r),s=Na(),null===e||_o?(ri&&s&&ei(t),t.flags|=1,Eo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ko(e,t,r))}function wo(e,t,s,n,r){if(null===e){var i=s.type;return"function"!==typeof i||kl(i)||void 0!==i.defaultProps||null!==s.compare||void 0!==s.defaultProps?((e=Pl(s.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,No(e,t,i,n,r))}if(i=e.child,0===(e.lanes&r)){var a=i.memoizedProps;if((s=null!==(s=s.compare)?s:cn)(a,n)&&e.ref===t.ref)return Ko(e,t,r)}return t.flags|=1,(e=Dl(i,n)).ref=t.ref,e.return=t,t.child=e}function No(e,t,s,n,r){if(null!==e){var i=e.memoizedProps;if(cn(i,n)&&e.ref===t.ref){if(_o=!1,t.pendingProps=n=i,0===(e.lanes&r))return t.lanes=e.lanes,Ko(e,t,r);0!==(131072&e.flags)&&(_o=!0)}}return Co(e,t,s,n,r)}function So(e,t,s){var n=t.pendingProps,r=n.children,i=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tr(Dc,kc),kc|=s;else{if(0===(1073741824&s))return e=null!==i?i.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Tr(Dc,kc),kc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==i?i.baseLanes:s,Tr(Dc,kc),kc|=n}else null!==i?(n=i.baseLanes|s,t.memoizedState=null):n=s,Tr(Dc,kc),kc|=n;return Eo(e,t,r,s),t.child}function To(e,t){var s=t.ref;(null===e&&null!==s||null!==e&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,s,n,r){var i=jr(s)?Ar:Rr.current;return i=Or(t,i),Ni(t,r),s=wa(e,t,s,n,i,r),n=Na(),null===e||_o?(ri&&n&&ei(t),t.flags|=1,Eo(e,t,s,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ko(e,t,r))}function Ro(e,t,s,n,r){if(jr(s)){var i=!0;Lr(t)}else i=!1;if(Ni(t,r),null===t.stateNode)Ho(e,t),Wi(t,s,n),Ki(t,s,n,r),n=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var c=a.context,l=s.contextType;"object"===typeof l&&null!==l?l=Si(l):l=Or(t,l=jr(s)?Ar:Rr.current);var d=s.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==n||c!==l)&&Hi(t,a,n,l),Ai=!1;var h=t.memoizedState;a.state=h,Mi(t,n,a,r),c=t.memoizedState,o!==n||h!==c||Ir.current||Ai?("function"===typeof d&&(Fi(t,s,d,n),c=t.memoizedState),(o=Ai||Gi(t,s,o,n,h,c,l))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),a.props=n,a.state=c,a.context=l,n=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,ji(e,t),o=t.memoizedProps,l=t.type===t.elementType?o:gi(t.type,o),a.props=l,u=t.pendingProps,h=a.context,"object"===typeof(c=s.contextType)&&null!==c?c=Si(c):c=Or(t,c=jr(s)?Ar:Rr.current);var p=s.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==c)&&Hi(t,a,n,c),Ai=!1,h=t.memoizedState,a.state=h,Mi(t,n,a,r);var m=t.memoizedState;o!==u||h!==m||Ir.current||Ai?("function"===typeof p&&(Fi(t,s,p,n),m=t.memoizedState),(l=Ai||Gi(t,s,l,n,h,m,c)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,m,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,m,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=m),a.props=n,a.state=m,a.context=c,n=l):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return Io(e,t,s,n,i,r)}function Io(e,t,s,n,r,i){To(e,t);var a=0!==(128&t.flags);if(!n&&!a)return r&&Mr(t,s,!1),Ko(e,t,i);n=t.stateNode,xo.current=t;var o=a&&"function"!==typeof s.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=Ji(t,e.child,null,i),t.child=Ji(t,null,o,i)):Eo(e,t,o,i),t.memoizedState=n.state,r&&Mr(t,s,!0),t.child}function Ao(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),na(e,t.containerInfo)}function Oo(e,t,s,n,r){return pi(),mi(r),t.flags|=256,Eo(e,t,s,n),t.child}var jo,ko,Do,Po,Lo={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,s){var n,r=t.pendingProps,a=oa.current,o=!1,c=0!==(128&t.flags);if((n=c)||(n=(null===e||null!==e.memoizedState)&&0!==(2&a)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Tr(oa,1&a),null===e)return li(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=r.children,e=r.fallback,o?(r=t.mode,o=t.child,c={mode:"hidden",children:c},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=c):o=Ml(c,r,0,null),e=Ll(e,r,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(s),t.memoizedState=Lo,e):Vo(t,c));if(null!==(a=e.memoizedState)&&null!==(n=a.dehydrated))return function(e,t,s,n,r,a,o){if(s)return 256&t.flags?(t.flags&=-257,Fo(e,t,o,n=uo(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=n.fallback,r=t.mode,n=Ml({mode:"visible",children:n.children},r,0,null),(a=Ll(a,r,o,null)).flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,0!==(1&t.mode)&&Ji(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=Lo,a);if(0===(1&t.mode))return Fo(e,t,o,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var c=n.dgst;return n=c,Fo(e,t,o,n=uo(a=Error(i(419)),n,void 0))}if(c=0!==(o&e.childLanes),_o||c){if(null!==(n=Ac)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(n.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Ii(e,r),nl(n,e,r,-1))}return gl(),Fo(e,t,o,n=uo(Error(i(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Rl.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,ni=lr(r.nextSibling),si=t,ri=!0,ii=null,null!==e&&(qr[Yr++]=Jr,qr[Yr++]=Qr,qr[Yr++]=Xr,Jr=e.id,Qr=e.overflow,Xr=t),t=Vo(t,n.children),t.flags|=4096,t)}(e,t,c,r,n,a,s);if(o){o=r.fallback,c=t.mode,n=(a=e.child).sibling;var l={mode:"hidden",children:r.children};return 0===(1&c)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=Dl(a,l)).subtreeFlags=14680064&a.subtreeFlags,null!==n?o=Dl(n,o):(o=Ll(o,c,s,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,c=null===(c=e.child.memoizedState)?Mo(s):{baseLanes:c.baseLanes|s,cachePool:null,transitions:c.transitions},o.memoizedState=c,o.childLanes=e.childLanes&~s,t.memoizedState=Lo,r}return e=(o=e.child).sibling,r=Dl(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=s),r.return=t,r.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function Vo(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fo(e,t,s,n){return null!==n&&mi(n),Ji(t,e.child,null,s),(e=Vo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bo(e,t,s){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),wi(e.return,t,s)}function Go(e,t,s,n,r){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=s,i.tailMode=r)}function Wo(e,t,s){var n=t.pendingProps,r=n.revealOrder,i=n.tail;if(Eo(e,t,n.children,s),0!==(2&(n=oa.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bo(e,s,t);else if(19===e.tag)Bo(e,s,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Tr(oa,n),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(s=t.child,r=null;null!==s;)null!==(e=s.alternate)&&null===ca(e)&&(r=s),s=s.sibling;null===(s=r)?(r=t.child,t.child=null):(r=s.sibling,s.sibling=null),Go(t,!1,r,s,i);break;case"backwards":for(s=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ca(e)){t.child=r;break}e=r.sibling,r.sibling=s,s=r,r=e}Go(t,!0,s,null,i);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ho(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ko(e,t,s){if(null!==e&&(t.dependencies=e.dependencies),Mc|=t.lanes,0===(s&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(s=Dl(e=t.child,e.pendingProps),t.child=s,s.return=t;null!==e.sibling;)e=e.sibling,(s=s.sibling=Dl(e,e.pendingProps)).return=t;s.sibling=null}return t.child}function zo(e,t){if(!ri)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;null!==t;)null!==t.alternate&&(s=t),t=t.sibling;null===s?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var n=null;null!==s;)null!==s.alternate&&(n=s),s=s.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,s=0,n=0;if(t)for(var r=e.child;null!==r;)s|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)s|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=s,t}function Yo(e,t,s){var n=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:case 17:return jr(t.type)&&kr(),qo(t),null;case 3:return n=t.stateNode,ra(),Sr(Ir),Sr(Rr),da(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ui(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(ol(ii),ii=null))),ko(e,t),qo(t),null;case 5:aa(t);var r=sa(ta.current);if(s=t.type,null!==e&&null!=t.stateNode)Do(e,t,s,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(i(166));return qo(t),null}if(e=sa($i.current),ui(t)){n=t.stateNode,s=t.type;var a=t.memoizedProps;switch(n[hr]=t,n[pr]=a,e=0!==(1&t.mode),s){case"dialog":Vn("cancel",n),Vn("close",n);break;case"iframe":case"object":case"embed":Vn("load",n);break;case"video":case"audio":for(r=0;r<Pn.length;r++)Vn(Pn[r],n);break;case"source":Vn("error",n);break;case"img":case"image":case"link":Vn("error",n),Vn("load",n);break;case"details":Vn("toggle",n);break;case"input":J(n,a),Vn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Vn("invalid",n);break;case"textarea":re(n,a),Vn("invalid",n)}for(var c in ve(s,a),r=null,a)if(a.hasOwnProperty(c)){var l=a[c];"children"===c?"string"===typeof l?n.textContent!==l&&(!0!==a.suppressHydrationWarning&&Zn(n.textContent,l,e),r=["children",l]):"number"===typeof l&&n.textContent!==""+l&&(!0!==a.suppressHydrationWarning&&Zn(n.textContent,l,e),r=["children",""+l]):o.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Vn("scroll",n)}switch(s){case"input":z(n),$(n,a,!0);break;case"textarea":z(n),ae(n);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(n.onclick=$n)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{c=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(s)),"http://www.w3.org/1999/xhtml"===e?"script"===s?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=c.createElement(s,{is:n.is}):(e=c.createElement(s),"select"===s&&(c=e,n.multiple?c.multiple=!0:n.size&&(c.size=n.size))):e=c.createElementNS(e,s),e[hr]=t,e[pr]=n,jo(e,t,!1,!1),t.stateNode=e;e:{switch(c=xe(s,n),s){case"dialog":Vn("cancel",e),Vn("close",e),r=n;break;case"iframe":case"object":case"embed":Vn("load",e),r=n;break;case"video":case"audio":for(r=0;r<Pn.length;r++)Vn(Pn[r],e);r=n;break;case"source":Vn("error",e),r=n;break;case"img":case"image":case"link":Vn("error",e),Vn("load",e),r=n;break;case"details":Vn("toggle",e),r=n;break;case"input":J(e,n),r=X(e,n),Vn("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=M({},n,{value:void 0}),Vn("invalid",e);break;case"textarea":re(e,n),r=ne(e,n),Vn("invalid",e)}for(a in ve(s,r),l=r)if(l.hasOwnProperty(a)){var d=l[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==s||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Vn("scroll",e):null!=d&&x(e,a,d,c))}switch(s){case"input":z(e),$(e,n,!1);break;case"textarea":z(e),ae(e);break;case"option":null!=n.value&&e.setAttribute("value",""+H(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?se(e,!!n.multiple,a,!1):null!=n.defaultValue&&se(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$n)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&null!=t.stateNode)Po(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(i(166));if(s=sa(ta.current),sa($i.current),ui(t)){if(n=t.stateNode,s=t.memoizedProps,n[hr]=t,(a=n.nodeValue!==s)&&null!==(e=si))switch(e.tag){case 3:Zn(n.nodeValue,s,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zn(n.nodeValue,s,0!==(1&e.mode))}a&&(t.flags|=4)}else(n=(9===s.nodeType?s:s.ownerDocument).createTextNode(n))[hr]=t,t.stateNode=n}return qo(t),null;case 13:if(Sr(oa),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ri&&null!==ni&&0!==(1&t.mode)&&0===(128&t.flags))hi(),pi(),t.flags|=98560,a=!1;else if(a=ui(t),null!==n&&null!==n.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[hr]=t}else pi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qo(t),a=!1}else null!==ii&&(ol(ii),ii=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=s,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&oa.current)?0===Pc&&(Pc=3):gl())),null!==t.updateQueue&&(t.flags|=4),qo(t),null);case 4:return ra(),ko(e,t),null===e&&Gn(t.stateNode.containerInfo),qo(t),null;case 10:return bi(t.type._context),qo(t),null;case 19:if(Sr(oa),null===(a=t.memoizedState))return qo(t),null;if(n=0!==(128&t.flags),null===(c=a.rendering))if(n)zo(a,!1);else{if(0!==Pc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ca(e))){for(t.flags|=128,zo(a,!1),null!==(n=c.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=s,s=t.child;null!==s;)e=n,(a=s).flags&=14680066,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return Tr(oa,1&oa.current|2),t.child}e=e.sibling}null!==a.tail&&Qe()>Wc&&(t.flags|=128,n=!0,zo(a,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=ca(c))){if(t.flags|=128,n=!0,null!==(s=e.updateQueue)&&(t.updateQueue=s,t.flags|=4),zo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!c.alternate&&!ri)return qo(t),null}else 2*Qe()-a.renderingStartTime>Wc&&1073741824!==s&&(t.flags|=128,n=!0,zo(a,!1),t.lanes=4194304);a.isBackwards?(c.sibling=t.child,t.child=c):(null!==(s=a.last)?s.sibling=c:t.child=c,a.last=c)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Qe(),t.sibling=null,s=oa.current,Tr(oa,n?1&s|2:1&s),t):(qo(t),null);case 22:case 23:return hl(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&kc)&&(qo(t),6&t.subtreeFlags&&(t.flags|=8192)):qo(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Xo(e,t){switch(ti(t),t.tag){case 1:return jr(t.type)&&kr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ra(),Sr(Ir),Sr(Rr),da(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return aa(t),null;case 13:if(Sr(oa),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));pi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Sr(oa),null;case 4:return ra(),null;case 10:return bi(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}jo=function(e,t){for(var s=t.child;null!==s;){if(5===s.tag||6===s.tag)e.appendChild(s.stateNode);else if(4!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},ko=function(){},Do=function(e,t,s,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,sa($i.current);var i,a=null;switch(s){case"input":r=X(e,r),n=X(e,n),a=[];break;case"select":r=M({},r,{value:void 0}),n=M({},n,{value:void 0}),a=[];break;case"textarea":r=ne(e,r),n=ne(e,n),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof n.onClick&&(e.onclick=$n)}for(d in ve(s,n),s=null,r)if(!n.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var c=r[d];for(i in c)c.hasOwnProperty(i)&&(s||(s={}),s[i]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in n){var l=n[d];if(c=null!=r?r[d]:void 0,n.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(i in c)!c.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(s||(s={}),s[i]="");for(i in l)l.hasOwnProperty(i)&&c[i]!==l[i]&&(s||(s={}),s[i]=l[i])}else s||(a||(a=[]),a.push(d,s)),s=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Vn("scroll",e),a||c===l||(a=[])):(a=a||[]).push(d,l))}s&&(a=a||[]).push("style",s);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Po=function(e,t,s,n){s!==n&&(t.flags|=4)};var Jo=!1,Qo=!1,Zo="function"===typeof WeakSet?WeakSet:Set,$o=null;function ec(e,t){var s=e.ref;if(null!==s)if("function"===typeof s)try{s(null)}catch(n){Sl(e,t,n)}else s.current=null}function tc(e,t,s){try{s()}catch(n){Sl(e,t,n)}}var sc=!1;function nc(e,t,s){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var i=r.destroy;r.destroy=void 0,void 0!==i&&tc(t,s,i)}r=r.next}while(r!==n)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var s=t=t.next;do{if((s.tag&e)===e){var n=s.create;s.destroy=n()}s=s.next}while(s!==t)}}function ic(e){var t=e.ref;if(null!==t){var s=e.stateNode;e.tag,e=s,"function"===typeof t?t(e):t.current=e}}function ac(e){var t=e.alternate;null!==t&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[fr],delete t[gr],delete t[yr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,s){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===s.nodeType?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(8===s.nodeType?(t=s.parentNode).insertBefore(e,s):(t=s).appendChild(e),null!==(s=s._reactRootContainer)&&void 0!==s||null!==t.onclick||(t.onclick=$n));else if(4!==n&&null!==(e=e.child))for(lc(e,t,s),e=e.sibling;null!==e;)lc(e,t,s),e=e.sibling}function dc(e,t,s){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(4!==n&&null!==(e=e.child))for(dc(e,t,s),e=e.sibling;null!==e;)dc(e,t,s),e=e.sibling}var uc=null,hc=!1;function pc(e,t,s){for(s=s.child;null!==s;)mc(e,t,s),s=s.sibling}function mc(e,t,s){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(rt,s)}catch(o){}switch(s.tag){case 5:Qo||ec(s,t);case 6:var n=uc,r=hc;uc=null,pc(e,t,s),hc=r,null!==(uc=n)&&(hc?(e=uc,s=s.stateNode,8===e.nodeType?e.parentNode.removeChild(s):e.removeChild(s)):uc.removeChild(s.stateNode));break;case 18:null!==uc&&(hc?(e=uc,s=s.stateNode,8===e.nodeType?cr(e.parentNode,s):1===e.nodeType&&cr(e,s),Gt(e)):cr(uc,s.stateNode));break;case 4:n=uc,r=hc,uc=s.stateNode.containerInfo,hc=!0,pc(e,t,s),uc=n,hc=r;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(n=s.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var i=r,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&tc(s,t,a),r=r.next}while(r!==n)}pc(e,t,s);break;case 1:if(!Qo&&(ec(s,t),"function"===typeof(n=s.stateNode).componentWillUnmount))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(o){Sl(s,t,o)}pc(e,t,s);break;case 21:pc(e,t,s);break;case 22:1&s.mode?(Qo=(n=Qo)||null!==s.memoizedState,pc(e,t,s),Qo=n):pc(e,t,s);break;default:pc(e,t,s)}}function fc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var s=e.stateNode;null===s&&(s=e.stateNode=new Zo),t.forEach(function(t){var n=Il.bind(null,e,t);s.has(t)||(s.add(t),t.then(n,n))})}}function gc(e,t){var s=t.deletions;if(null!==s)for(var n=0;n<s.length;n++){var r=s[n];try{var a=e,o=t,c=o;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,hc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===uc)throw Error(i(160));mc(a,o,r),uc=null,hc=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(d){Sl(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yc(t,e),t=t.sibling}function yc(e,t){var s=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),vc(e),4&n){try{nc(3,e,e.return),rc(3,e)}catch(g){Sl(e,e.return,g)}try{nc(5,e,e.return)}catch(g){Sl(e,e.return,g)}}break;case 1:gc(t,e),vc(e),512&n&&null!==s&&ec(s,s.return);break;case 5:if(gc(t,e),vc(e),512&n&&null!==s&&ec(s,s.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){Sl(e,e.return,g)}}if(4&n&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==s?s.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&Q(r,a),xe(c,o);var d=xe(c,a);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];"style"===u?ge(r,h):"dangerouslySetInnerHTML"===u?ue(r,h):"children"===u?he(r,h):x(r,u,h,d)}switch(c){case"input":Z(r,a);break;case"textarea":ie(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?se(r,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?se(r,!!a.multiple,a.defaultValue,!0):se(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(g){Sl(e,e.return,g)}}break;case 6:if(gc(t,e),vc(e),4&n){if(null===e.stateNode)throw Error(i(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){Sl(e,e.return,g)}}break;case 3:if(gc(t,e),vc(e),4&n&&null!==s&&s.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){Sl(e,e.return,g)}break;case 4:default:gc(t,e),vc(e);break;case 13:gc(t,e),vc(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Gc=Qe())),4&n&&fc(e);break;case 22:if(u=null!==s&&null!==s.memoizedState,1&e.mode?(Qo=(d=Qo)||u,gc(t,e),Qo=d):gc(t,e),vc(e),8192&n){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for($o=e,u=e.child;null!==u;){for(h=$o=u;null!==$o;){switch(m=(p=$o).child,p.tag){case 0:case 11:case 14:case 15:nc(4,p,p.return);break;case 1:ec(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){n=p,s=p.return;try{t=n,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Sl(n,s,g)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){bc(h);continue}}null!==m?(m.return=p,$o=m):bc(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{r=h.stateNode,d?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,o=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",o))}catch(g){Sl(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Sl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gc(t,e),vc(e),4&n&&fc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var s=e.return;null!==s;){if(oc(s)){var n=s;break e}s=s.return}throw Error(i(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(he(r,""),n.flags&=-33),dc(e,cc(e),r);break;case 3:case 4:var a=n.stateNode.containerInfo;lc(e,cc(e),a);break;default:throw Error(i(161))}}catch(o){Sl(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function xc(e,t,s){$o=e,_c(e,t,s)}function _c(e,t,s){for(var n=0!==(1&e.mode);null!==$o;){var r=$o,i=r.child;if(22===r.tag&&n){var a=null!==r.memoizedState||Jo;if(!a){var o=r.alternate,c=null!==o&&null!==o.memoizedState||Qo;o=Jo;var l=Qo;if(Jo=a,(Qo=c)&&!l)for($o=r;null!==$o;)c=(a=$o).child,22===a.tag&&null!==a.memoizedState?wc(r):null!==c?(c.return=a,$o=c):wc(r);for(;null!==i;)$o=i,_c(i,t,s),i=i.sibling;$o=r,Jo=o,Qo=l}Ec(e)}else 0!==(8772&r.subtreeFlags)&&null!==i?(i.return=r,$o=i):Ec(e)}}function Ec(e){for(;null!==$o;){var t=$o;if(0!==(8772&t.flags)){var s=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||rc(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Qo)if(null===s)n.componentDidMount();else{var r=t.elementType===t.type?s.memoizedProps:gi(t.type,s.memoizedProps);n.componentDidUpdate(r,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ui(t,a,n);break;case 3:var o=t.updateQueue;if(null!==o){if(s=null,null!==t.child)switch(t.child.tag){case 5:case 1:s=t.child.stateNode}Ui(t,o,s)}break;case 5:var c=t.stateNode;if(null===s&&4&t.flags){s=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&s.focus();break;case"img":l.src&&(s.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(i(163))}Qo||512&t.flags&&ic(t)}catch(p){Sl(t,t.return,p)}}if(t===e){$o=null;break}if(null!==(s=t.sibling)){s.return=t.return,$o=s;break}$o=t.return}}function bc(e){for(;null!==$o;){var t=$o;if(t===e){$o=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$o=s;break}$o=t.return}}function wc(e){for(;null!==$o;){var t=$o;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{rc(4,t)}catch(c){Sl(t,s,c)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(c){Sl(t,r,c)}}var i=t.return;try{ic(t)}catch(c){Sl(t,i,c)}break;case 5:var a=t.return;try{ic(t)}catch(c){Sl(t,a,c)}}}catch(c){Sl(t,t.return,c)}if(t===e){$o=null;break}var o=t.sibling;if(null!==o){o.return=t.return,$o=o;break}$o=t.return}}var Nc,Sc=Math.ceil,Tc=_.ReactCurrentDispatcher,Cc=_.ReactCurrentOwner,Rc=_.ReactCurrentBatchConfig,Ic=0,Ac=null,Oc=null,jc=0,kc=0,Dc=Nr(0),Pc=0,Lc=null,Mc=0,Uc=0,Vc=0,Fc=null,Bc=null,Gc=0,Wc=1/0,Hc=null,Kc=!1,zc=null,qc=null,Yc=!1,Xc=null,Jc=0,Qc=0,Zc=null,$c=-1,el=0;function tl(){return 0!==(6&Ic)?Qe():-1!==$c?$c:$c=Qe()}function sl(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==jc?jc&-jc:null!==fi.transition?(0===el&&(el=ft()),el):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function nl(e,t,s,n){if(50<Qc)throw Qc=0,Zc=null,Error(i(185));yt(e,s,n),0!==(2&Ic)&&e===Ac||(e===Ac&&(0===(2&Ic)&&(Uc|=s),4===Pc&&cl(e,jc)),rl(e,n),1===s&&0===Ic&&0===(1&t.mode)&&(Wc=Qe()+500,Vr&&Gr()))}function rl(e,t){var s=e.callbackNode;!function(e,t){for(var s=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-at(i),o=1<<a,c=r[a];-1===c?0!==(o&s)&&0===(o&n)||(r[a]=pt(o,t)):c<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var n=ht(e,e===Ac?jc:0);if(0===n)null!==s&&Ye(s),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=s&&Ye(s),1===t)0===e.tag?function(e){Vr=!0,Br(e)}(ll.bind(null,e)):Br(ll.bind(null,e)),ar(function(){0===(6&Ic)&&Gr()}),s=null;else{switch(_t(n)){case 1:s=$e;break;case 4:s=et;break;case 16:default:s=tt;break;case 536870912:s=nt}s=Al(s,il.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function il(e,t){if($c=-1,el=0,0!==(6&Ic))throw Error(i(327));var s=e.callbackNode;if(wl()&&e.callbackNode!==s)return null;var n=ht(e,e===Ac?jc:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=yl(e,n);else{t=n;var r=Ic;Ic|=2;var a=fl();for(Ac===e&&jc===t||(Hc=null,Wc=Qe()+500,pl(e,t));;)try{xl();break}catch(c){ml(e,c)}Ei(),Tc.current=a,Ic=r,null!==Oc?t=0:(Ac=null,jc=0,t=Pc)}if(0!==t){if(2===t&&(0!==(r=mt(e))&&(n=r,t=al(e,r))),1===t)throw s=Lc,pl(e,0),cl(e,n),rl(e,Qe()),s;if(6===t)cl(e,n);else{if(r=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var s=t.updateQueue;if(null!==s&&null!==(s=s.stores))for(var n=0;n<s.length;n++){var r=s[n],i=r.getSnapshot;r=r.value;try{if(!on(i(),r))return!1}catch(o){return!1}}}if(s=t.child,16384&t.subtreeFlags&&null!==s)s.return=t,t=s;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=yl(e,n))&&(0!==(a=mt(e))&&(n=a,t=al(e,a))),1===t))throw s=Lc,pl(e,0),cl(e,n),rl(e,Qe()),s;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(i(345));case 2:case 5:bl(e,Bc,Hc);break;case 3:if(cl(e,n),(130023424&n)===n&&10<(t=Gc+500-Qe())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&n)!==n){tl(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nr(bl.bind(null,e,Bc,Hc),t);break}bl(e,Bc,Hc);break;case 4:if(cl(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var o=31-at(n);a=1<<o,(o=t[o])>r&&(r=o),n&=~a}if(n=r,10<(n=(120>(n=Qe()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Sc(n/1960))-n)){e.timeoutHandle=nr(bl.bind(null,e,Bc,Hc),n);break}bl(e,Bc,Hc);break;default:throw Error(i(329))}}}return rl(e,Qe()),e.callbackNode===s?il.bind(null,e):null}function al(e,t){var s=Fc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=yl(e,t))&&(t=Bc,Bc=s,null!==t&&ol(t)),e}function ol(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function cl(e,t){for(t&=~Vc,t&=~Uc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-at(t),n=1<<s;e[s]=-1,t&=~n}}function ll(e){if(0!==(6&Ic))throw Error(i(327));wl();var t=ht(e,0);if(0===(1&t))return rl(e,Qe()),null;var s=yl(e,t);if(0!==e.tag&&2===s){var n=mt(e);0!==n&&(t=n,s=al(e,n))}if(1===s)throw s=Lc,pl(e,0),cl(e,t),rl(e,Qe()),s;if(6===s)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bl(e,Bc,Hc),rl(e,Qe()),null}function dl(e,t){var s=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=s)&&(Wc=Qe()+500,Vr&&Gr())}}function ul(e){null!==Xc&&0===Xc.tag&&0===(6&Ic)&&wl();var t=Ic;Ic|=1;var s=Rc.transition,n=xt;try{if(Rc.transition=null,xt=1,e)return e()}finally{xt=n,Rc.transition=s,0===(6&(Ic=t))&&Gr()}}function hl(){kc=Dc.current,Sr(Dc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(-1!==s&&(e.timeoutHandle=-1,rr(s)),null!==Oc)for(s=Oc.return;null!==s;){var n=s;switch(ti(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&kr();break;case 3:ra(),Sr(Ir),Sr(Rr),da();break;case 5:aa(n);break;case 4:ra();break;case 13:case 19:Sr(oa);break;case 10:bi(n.type._context);break;case 22:case 23:hl()}s=s.return}if(Ac=e,Oc=e=Dl(e.current,null),jc=kc=t,Pc=0,Lc=null,Vc=Uc=Mc=0,Bc=Fc=null,null!==Ti){for(t=0;t<Ti.length;t++)if(null!==(n=(s=Ti[t]).interleaved)){s.interleaved=null;var r=n.next,i=s.pending;if(null!==i){var a=i.next;i.next=r,n.next=a}s.pending=n}Ti=null}return e}function ml(e,t){for(;;){var s=Oc;try{if(Ei(),ua.current=io,ya){for(var n=ma.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}ya=!1}if(pa=0,ga=fa=ma=null,va=!1,xa=0,Cc.current=null,null===s||null===s.return){Pc=1,Lc=t,Oc=null;break}e:{var a=e,o=s.return,c=s,l=t;if(t=jc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l,u=c,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=yo(o);if(null!==m){m.flags&=-257,vo(m,o,c,0,t),1&m.mode&&go(a,d,t),l=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}if(0===(1&t)){go(a,d,t),gl();break e}l=Error(i(426))}else if(ri&&1&c.mode){var y=yo(o);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),vo(y,o,c,0,t),mi(lo(l,c));break e}}a=l=lo(l,c),4!==Pc&&(Pc=2),null===Fc?Fc=[a]:Fc.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Li(a,mo(0,l,t));break e;case 1:c=l;var v=a.type,x=a.stateNode;if(0===(128&a.flags)&&("function"===typeof v.getDerivedStateFromError||null!==x&&"function"===typeof x.componentDidCatch&&(null===qc||!qc.has(x)))){a.flags|=65536,t&=-t,a.lanes|=t,Li(a,fo(a,c,t));break e}}a=a.return}while(null!==a)}El(s)}catch(_){t=_,Oc===s&&null!==s&&(Oc=s=s.return);continue}break}}function fl(){var e=Tc.current;return Tc.current=io,null===e?io:e}function gl(){0!==Pc&&3!==Pc&&2!==Pc||(Pc=4),null===Ac||0===(268435455&Mc)&&0===(268435455&Uc)||cl(Ac,jc)}function yl(e,t){var s=Ic;Ic|=2;var n=fl();for(Ac===e&&jc===t||(Hc=null,pl(e,t));;)try{vl();break}catch(r){ml(e,r)}if(Ei(),Ic=s,Tc.current=n,null!==Oc)throw Error(i(261));return Ac=null,jc=0,Pc}function vl(){for(;null!==Oc;)_l(Oc)}function xl(){for(;null!==Oc&&!Xe();)_l(Oc)}function _l(e){var t=Nc(e.alternate,e,kc);e.memoizedProps=e.pendingProps,null===t?El(e):Oc=t,Cc.current=null}function El(e){var t=e;do{var s=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(s=Yo(s,t,kc)))return void(Oc=s)}else{if(null!==(s=Xo(s,t)))return s.flags&=32767,void(Oc=s);if(null===e)return Pc=6,void(Oc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Oc=t);Oc=t=e}while(null!==t);0===Pc&&(Pc=5)}function bl(e,t,s){var n=xt,r=Rc.transition;try{Rc.transition=null,xt=1,function(e,t,s,n){do{wl()}while(null!==Xc);if(0!==(6&Ic))throw Error(i(327));s=e.finishedWork;var r=e.finishedLanes;if(null===s)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=s.lanes|s.childLanes;if(function(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<s;){var r=31-at(s),i=1<<r;t[r]=0,n[r]=-1,e[r]=-1,s&=~i}}(e,a),e===Ac&&(Oc=Ac=null,jc=0),0===(2064&s.subtreeFlags)&&0===(2064&s.flags)||Yc||(Yc=!0,Al(tt,function(){return wl(),null})),a=0!==(15990&s.flags),0!==(15990&s.subtreeFlags)||a){a=Rc.transition,Rc.transition=null;var o=xt;xt=1;var c=Ic;Ic|=4,Cc.current=null,function(e,t){if(er=Ht,pn(e=hn())){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(s=(s=e.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(n&&0!==n.rangeCount){s=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{s.nodeType,a.nodeType}catch(E){s=null;break e}var o=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==s||0!==r&&3!==h.nodeType||(c=o+r),h!==a||0!==n&&3!==h.nodeType||(l=o+n),3===h.nodeType&&(o+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===s&&++d===r&&(c=o),p===a&&++u===n&&(l=o),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}s=-1===c||-1===l?null:{start:c,end:l}}else s=null}s=s||{start:0,end:0}}else s=null;for(tr={focusedElem:e,selectionRange:s},Ht=!1,$o=t;null!==$o;)if(e=(t=$o).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$o=e;else for(;null!==$o;){t=$o;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,y=f.memoizedState,v=t.stateNode,x=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:gi(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(i(163))}}catch(E){Sl(t,t.return,E)}if(null!==(e=t.sibling)){e.return=t.return,$o=e;break}$o=t.return}f=sc,sc=!1}(e,s),yc(s,e),mn(tr),Ht=!!er,tr=er=null,e.current=s,xc(s,e,r),Je(),Ic=c,xt=o,Rc.transition=a}else e.current=s;if(Yc&&(Yc=!1,Xc=e,Jc=r),a=e.pendingLanes,0===a&&(qc=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(s.stateNode),rl(e,Qe()),null!==t)for(n=e.onRecoverableError,s=0;s<t.length;s++)r=t[s],n(r.value,{componentStack:r.stack,digest:r.digest});if(Kc)throw Kc=!1,e=zc,zc=null,e;0!==(1&Jc)&&0!==e.tag&&wl(),a=e.pendingLanes,0!==(1&a)?e===Zc?Qc++:(Qc=0,Zc=e):Qc=0,Gr()}(e,t,s,n)}finally{Rc.transition=r,xt=n}return null}function wl(){if(null!==Xc){var e=_t(Jc),t=Rc.transition,s=xt;try{if(Rc.transition=null,xt=16>e?16:e,null===Xc)var n=!1;else{if(e=Xc,Xc=null,Jc=0,0!==(6&Ic))throw Error(i(331));var r=Ic;for(Ic|=4,$o=e.current;null!==$o;){var a=$o,o=a.child;if(0!==(16&$o.flags)){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var d=c[l];for($o=d;null!==$o;){var u=$o;switch(u.tag){case 0:case 11:case 15:nc(8,u,a)}var h=u.child;if(null!==h)h.return=u,$o=h;else for(;null!==$o;){var p=(u=$o).sibling,m=u.return;if(ac(u),u===d){$o=null;break}if(null!==p){p.return=m,$o=p;break}$o=m}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}$o=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,$o=o;else e:for(;null!==$o;){if(0!==(2048&(a=$o).flags))switch(a.tag){case 0:case 11:case 15:nc(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,$o=v;break e}$o=a.return}}var x=e.current;for($o=x;null!==$o;){var _=(o=$o).child;if(0!==(2064&o.subtreeFlags)&&null!==_)_.return=o,$o=_;else e:for(o=x;null!==$o;){if(0!==(2048&(c=$o).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(b){Sl(c,c.return,b)}if(c===o){$o=null;break e}var E=c.sibling;if(null!==E){E.return=c.return,$o=E;break e}$o=c.return}}if(Ic=r,Gr(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(rt,e)}catch(b){}n=!0}return n}finally{xt=s,Rc.transition=t}}return!1}function Nl(e,t,s){e=Di(e,t=mo(0,t=lo(s,t),1),1),t=tl(),null!==e&&(yt(e,1,t),rl(e,t))}function Sl(e,t,s){if(3===e.tag)Nl(e,e,s);else for(;null!==t;){if(3===t.tag){Nl(t,e,s);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===qc||!qc.has(n))){t=Di(t,e=fo(t,e=lo(s,e),1),1),e=tl(),null!==t&&(yt(t,1,e),rl(t,e));break}}t=t.return}}function Tl(e,t,s){var n=e.pingCache;null!==n&&n.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&s,Ac===e&&(jc&s)===s&&(4===Pc||3===Pc&&(130023424&jc)===jc&&500>Qe()-Gc?pl(e,0):Vc|=s),rl(e,t)}function Cl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var s=tl();null!==(e=Ii(e,t))&&(yt(e,t,s),rl(e,s))}function Rl(e){var t=e.memoizedState,s=0;null!==t&&(s=t.retryLane),Cl(e,s)}function Il(e,t){var s=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(s=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(i(314))}null!==n&&n.delete(t),Cl(e,s)}function Al(e,t){return qe(e,t)}function Ol(e,t,s,n){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jl(e,t,s,n){return new Ol(e,t,s,n)}function kl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dl(e,t){var s=e.alternate;return null===s?((s=jl(e.tag,t,e.key,e.mode)).elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=14680064&e.flags,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Pl(e,t,s,n,r,a){var o=2;if(n=e,"function"===typeof e)kl(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case w:return Ll(s.children,r,a,t);case N:o=8,r|=8;break;case S:return(e=jl(12,s,t,2|r)).elementType=S,e.lanes=a,e;case I:return(e=jl(13,s,t,r)).elementType=I,e.lanes=a,e;case A:return(e=jl(19,s,t,r)).elementType=A,e.lanes=a,e;case k:return Ml(s,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:o=10;break e;case C:o=9;break e;case R:o=11;break e;case O:o=14;break e;case j:o=16,n=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=jl(o,s,t,r)).elementType=e,t.type=n,t.lanes=a,t}function Ll(e,t,s,n){return(e=jl(7,e,n,t)).lanes=s,e}function Ml(e,t,s,n){return(e=jl(22,e,n,t)).elementType=k,e.lanes=s,e.stateNode={isHidden:!1},e}function Ul(e,t,s){return(e=jl(6,e,null,t)).lanes=s,e}function Vl(e,t,s){return(t=jl(4,null!==e.children?e.children:[],e.key,t)).lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fl(e,t,s,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bl(e,t,s,n,r,i,a,o,c){return e=new Fl(e,t,s,o,c),1===t?(t=1,!0===i&&(t|=8)):t=0,i=jl(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Oi(i),e}function Gl(e){if(!e)return Cr;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(jr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var s=e.type;if(jr(s))return Pr(e,s,t)}return t}function Wl(e,t,s,n,r,i,a,o,c){return(e=Bl(s,n,!0,e,0,i,0,o,c)).context=Gl(null),s=e.current,(i=ki(n=tl(),r=sl(s))).callback=void 0!==t&&null!==t?t:null,Di(s,i,r),e.current.lanes=r,yt(e,r,n),rl(e,n),e}function Hl(e,t,s,n){var r=t.current,i=tl(),a=sl(r);return s=Gl(s),null===t.context?t.context=s:t.pendingContext=s,(t=ki(i,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Di(r,t,a))&&(nl(e,r,a,i),Pi(e,r,a)),a}function Kl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function zl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var s=e.retryLane;e.retryLane=0!==s&&s<t?s:t}}function ql(e,t){zl(e,t),(e=e.alternate)&&zl(e,t)}Nc=function(e,t,s){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ir.current)_o=!0;else{if(0===(e.lanes&s)&&0===(128&t.flags))return _o=!1,function(e,t,s){switch(t.tag){case 3:Ao(t),pi();break;case 5:ia(t);break;case 1:jr(t.type)&&Lr(t);break;case 4:na(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Tr(yi,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Tr(oa,1&oa.current),t.flags|=128,null):0!==(s&t.child.childLanes)?Uo(e,t,s):(Tr(oa,1&oa.current),null!==(e=Ko(e,t,s))?e.sibling:null);Tr(oa,1&oa.current);break;case 19:if(n=0!==(s&t.childLanes),0!==(128&e.flags)){if(n)return Wo(e,t,s);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Tr(oa,oa.current),n)break;return null;case 22:case 23:return t.lanes=0,So(e,t,s)}return Ko(e,t,s)}(e,t,s);_o=0!==(131072&e.flags)}else _o=!1,ri&&0!==(1048576&t.flags)&&$r(t,zr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Ho(e,t),e=t.pendingProps;var r=Or(t,Rr.current);Ni(t,s),r=wa(null,t,n,e,r,s);var a=Na();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,jr(n)?(a=!0,Lr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Oi(t),r.updater=Bi,t.stateNode=r,r._reactInternals=t,Ki(t,n,e,s),t=Io(null,t,n,!0,a,s)):(t.tag=0,ri&&a&&ei(t),Eo(null,t,r,s),t=t.child),t;case 16:n=t.elementType;e:{switch(Ho(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"===typeof e)return kl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===O)return 14}return 2}(n),e=gi(n,e),r){case 0:t=Co(null,t,n,e,s);break e;case 1:t=Ro(null,t,n,e,s);break e;case 11:t=bo(null,t,n,e,s);break e;case 14:t=wo(null,t,n,gi(n.type,e),s);break e}throw Error(i(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,Co(e,t,n,r=t.elementType===n?r:gi(n,r),s);case 1:return n=t.type,r=t.pendingProps,Ro(e,t,n,r=t.elementType===n?r:gi(n,r),s);case 3:e:{if(Ao(t),null===e)throw Error(i(387));n=t.pendingProps,r=(a=t.memoizedState).element,ji(e,t),Mi(t,n,null,s);var o=t.memoizedState;if(n=o.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Oo(e,t,n,s,r=lo(Error(i(423)),t));break e}if(n!==r){t=Oo(e,t,n,s,r=lo(Error(i(424)),t));break e}for(ni=lr(t.stateNode.containerInfo.firstChild),si=t,ri=!0,ii=null,s=Qi(t,null,n,s),t.child=s;s;)s.flags=-3&s.flags|4096,s=s.sibling}else{if(pi(),n===r){t=Ko(e,t,s);break e}Eo(e,t,n,s)}t=t.child}return t;case 5:return ia(t),null===e&&li(t),n=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,sr(n,r)?o=null:null!==a&&sr(n,a)&&(t.flags|=32),To(e,t),Eo(e,t,o,s),t.child;case 6:return null===e&&li(t),null;case 13:return Uo(e,t,s);case 4:return na(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Ji(t,null,n,s):Eo(e,t,n,s),t.child;case 11:return n=t.type,r=t.pendingProps,bo(e,t,n,r=t.elementType===n?r:gi(n,r),s);case 7:return Eo(e,t,t.pendingProps,s),t.child;case 8:case 12:return Eo(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Tr(yi,n._currentValue),n._currentValue=o,null!==a)if(on(a.value,o)){if(a.children===r.children&&!Ir.current){t=Ko(e,t,s);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){o=a.child;for(var l=c.firstContext;null!==l;){if(l.context===n){if(1===a.tag){(l=ki(-1,s&-s)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),d.pending=l}}a.lanes|=s,null!==(l=a.alternate)&&(l.lanes|=s),wi(a.return,s,t),c.lanes|=s;break}l=l.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=s,null!==(c=o.alternate)&&(c.lanes|=s),wi(o,s,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}Eo(e,t,r.children,s),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,Ni(t,s),n=n(r=Si(r)),t.flags|=1,Eo(e,t,n,s),t.child;case 14:return r=gi(n=t.type,t.pendingProps),wo(e,t,n,r=gi(n.type,r),s);case 15:return No(e,t,t.type,t.pendingProps,s);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:gi(n,r),Ho(e,t),t.tag=1,jr(n)?(e=!0,Lr(t)):e=!1,Ni(t,s),Wi(t,n,r),Ki(t,n,r,s),Io(null,t,n,!0,e,s);case 19:return Wo(e,t,s);case 22:return So(e,t,s)}throw Error(i(156,t.tag))};var Yl="function"===typeof reportError?reportError:function(e){console.error(e)};function Xl(e){this._internalRoot=e}function Jl(e){this._internalRoot=e}function Ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function ed(e,t,s,n,r){var i=s._reactRootContainer;if(i){var a=i;if("function"===typeof r){var o=r;r=function(){var e=Kl(a);o.call(e)}}Hl(t,a,e,r)}else a=function(e,t,s,n,r){if(r){if("function"===typeof n){var i=n;n=function(){var e=Kl(a);i.call(e)}}var a=Wl(t,n,e,0,null,!1,0,"",$l);return e._reactRootContainer=a,e[mr]=a.current,Gn(8===e.nodeType?e.parentNode:e),ul(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof n){var o=n;n=function(){var e=Kl(c);o.call(e)}}var c=Bl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=c,e[mr]=c.current,Gn(8===e.nodeType?e.parentNode:e),ul(function(){Hl(t,c,s,n)}),c}(s,t,e,r,n);return Kl(a)}Jl.prototype.render=Xl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Hl(e,t,null,null)},Jl.prototype.unmount=Xl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){Hl(null,e,null,null)}),t[mr]=null}},Jl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var s=0;s<kt.length&&0!==t&&t<kt[s].priority;s++);kt.splice(s,0,e),0===s&&Mt(e)}},Et=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=ut(t.pendingLanes);0!==s&&(vt(t,1|s),rl(t,Qe()),0===(6&Ic)&&(Wc=Qe()+500,Gr()))}break;case 13:ul(function(){var t=Ii(e,1);if(null!==t){var s=tl();nl(t,e,1,s)}}),ql(e,1)}},bt=function(e){if(13===e.tag){var t=Ii(e,134217728);if(null!==t)nl(t,e,134217728,tl());ql(e,134217728)}},wt=function(e){if(13===e.tag){var t=sl(e),s=Ii(e,t);if(null!==s)nl(s,e,t,tl());ql(e,t)}},Nt=function(){return xt},St=function(e,t){var s=xt;try{return xt=e,t()}finally{xt=s}},be=function(e,t,s){switch(t){case"input":if(Z(e,s),t=s.name,"radio"===s.type&&null!=t){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var n=s[t];if(n!==e&&n.form===e.form){var r=Er(n);if(!r)throw Error(i(90));q(n),Z(n,r)}}}break;case"textarea":ie(e,s);break;case"select":null!=(t=s.value)&&se(e,!!s.multiple,t,!1)}},Re=dl,Ie=ul;var td={usingClientEntryPoint:!1,Events:[xr,_r,Er,Te,Ce,dl]},sd={findFiberByHostInstance:vr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},nd={bundleType:sd.bundleType,version:sd.version,rendererPackageName:sd.rendererPackageName,rendererConfig:sd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ke(e))?null:e.stateNode},findFiberByHostInstance:sd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rd.isDisabled&&rd.supportsFiber)try{rt=rd.inject(nd),it=rd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=td,t.createPortal=function(e,t){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ql(t))throw Error(i(200));return function(e,t,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:b,key:null==n?null:""+n,children:e,containerInfo:t,implementation:s}}(e,t,null,s)},t.createRoot=function(e,t){if(!Ql(e))throw Error(i(299));var s=!1,n="",r=Yl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(s=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bl(e,1,!1,null,0,s,0,n,r),e[mr]=t.current,Gn(8===e.nodeType?e.parentNode:e),new Xl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=Ke(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,s){if(!Zl(t))throw Error(i(200));return ed(null,e,t,!0,s)},t.hydrateRoot=function(e,t,s){if(!Ql(e))throw Error(i(405));var n=null!=s&&s.hydratedSources||null,r=!1,a="",o=Yl;if(null!==s&&void 0!==s&&(!0===s.unstable_strictMode&&(r=!0),void 0!==s.identifierPrefix&&(a=s.identifierPrefix),void 0!==s.onRecoverableError&&(o=s.onRecoverableError)),t=Wl(t,null,e,1,null!=s?s:null,r,0,a,o),e[mr]=t.current,Gn(e),n)for(e=0;e<n.length;e++)r=(r=(s=n[e])._getVersion)(s._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[s,r]:t.mutableSourceEagerHydrationData.push(s,r);return new Jl(t)},t.render=function(e,t,s){if(!Zl(t))throw Error(i(200));return ed(null,e,t,!1,s)},t.unmountComponentAtNode=function(e){if(!Zl(e))throw Error(i(40));return!!e._reactRootContainer&&(ul(function(){ed(null,null,e,!1,function(){e._reactRootContainer=null,e[mr]=null})}),!0)},t.unstable_batchedUpdates=dl,t.unstable_renderSubtreeIntoContainer=function(e,t,s,n){if(!Zl(s))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return ed(e,t,s,!1,n)},t.version="18.2.0-next-9e3b772b8-20220608"},2907:(e,t,s)=>{"use strict";s.d(t,{QueryClient:()=>n.QueryClient,QueryClientProvider:()=>r.QueryClientProvider});var n=s(5819);s.o(n,"QueryClientProvider")&&s.d(t,{QueryClientProvider:function(){return n.QueryClientProvider}});var r=s(6524)},3930:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(6368),s(4220),function(){var e=t,s=e.lib,n=s.Base,r=s.WordArray,i=e.algo,a=i.SHA256,o=i.HMAC,c=i.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:a,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s=this.cfg,n=o.create(s.hasher,e),i=r.create(),a=r.create([1]),c=i.words,l=a.words,d=s.keySize,u=s.iterations;c.length<d;){var h=n.update(t).finalize(a);n.reset();for(var p=h.words,m=p.length,f=h,g=1;g<u;g++){f=n.finalize(f),n.reset();for(var y=f.words,v=0;v<m;v++)p[v]^=y[v]}i.concat(h),l[0]++}return i.sigBytes=4*d,i}});e.PBKDF2=function(e,t,s){return c.create(s).compute(e,t)}}(),t.PBKDF2)}()},4087:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding)}()},4198:(e,t,s)=>{"use strict";s.d(t,{E:()=>w});var n=s(8168),r=s(8870);function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}var o=s(1991),c=s(75),l=function(){function e(){this.listeners=[]}var t=e.prototype;return t.subscribe=function(e){var t=this,s=e||function(){};return this.listeners.push(s),this.onSubscribe(),function(){t.listeners=t.listeners.filter(function(e){return e!==s}),t.onUnsubscribe()}},t.hasListeners=function(){return this.listeners.length>0},t.onSubscribe=function(){},t.onUnsubscribe=function(){},e}(),d=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!r.S$&&(null==(t=window)?void 0:t.addEventListener)){var s=function(){return e()};return window.addEventListener("visibilitychange",s,!1),window.addEventListener("focus",s,!1),function(){window.removeEventListener("visibilitychange",s),window.removeEventListener("focus",s)}}},t}a(t,e);var s=t.prototype;return s.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},s.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},s.setEventListener=function(e){var t,s=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?s.setFocused(e):s.onFocus()})},s.setFocused=function(e){this.focused=e,e&&this.onFocus()},s.onFocus=function(){this.listeners.forEach(function(e){e()})},s.isFocused=function(){return"boolean"===typeof this.focused?this.focused:"undefined"===typeof document||[void 0,"visible","prerender"].includes(document.visibilityState)},t}(l)),u=new(function(e){function t(){var t;return(t=e.call(this)||this).setup=function(e){var t;if(!r.S$&&(null==(t=window)?void 0:t.addEventListener)){var s=function(){return e()};return window.addEventListener("online",s,!1),window.addEventListener("offline",s,!1),function(){window.removeEventListener("online",s),window.removeEventListener("offline",s)}}},t}a(t,e);var s=t.prototype;return s.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},s.onUnsubscribe=function(){var e;this.hasListeners()||(null==(e=this.cleanup)||e.call(this),this.cleanup=void 0)},s.setEventListener=function(e){var t,s=this;this.setup=e,null==(t=this.cleanup)||t.call(this),this.cleanup=e(function(e){"boolean"===typeof e?s.setOnline(e):s.onOnline()})},s.setOnline=function(e){this.online=e,e&&this.onOnline()},s.onOnline=function(){this.listeners.forEach(function(e){e()})},s.isOnline=function(){return"boolean"===typeof this.online?this.online:"undefined"===typeof navigator||"undefined"===typeof navigator.onLine||navigator.onLine},t}(l));function h(e){return Math.min(1e3*Math.pow(2,e),3e4)}function p(e){return"function"===typeof(null==e?void 0:e.cancel)}var m=function(e){this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent};function f(e){return e instanceof m}var g=function(e){var t,s,n,i,a=this,o=!1;this.abort=e.abort,this.cancel=function(e){return null==t?void 0:t(e)},this.cancelRetry=function(){o=!0},this.continueRetry=function(){o=!1},this.continue=function(){return null==s?void 0:s()},this.failureCount=0,this.isPaused=!1,this.isResolved=!1,this.isTransportCancelable=!1,this.promise=new Promise(function(e,t){n=e,i=t});var c=function(t){a.isResolved||(a.isResolved=!0,null==e.onSuccess||e.onSuccess(t),null==s||s(),n(t))},l=function(t){a.isResolved||(a.isResolved=!0,null==e.onError||e.onError(t),null==s||s(),i(t))};!function n(){if(!a.isResolved){var i;try{i=e.fn()}catch(f){i=Promise.reject(f)}t=function(e){if(!a.isResolved&&(l(new m(e)),null==a.abort||a.abort(),p(i)))try{i.cancel()}catch(t){}},a.isTransportCancelable=p(i),Promise.resolve(i).then(c).catch(function(t){var i,c;if(!a.isResolved){var p=null!=(i=e.retry)?i:3,m=null!=(c=e.retryDelay)?c:h,f="function"===typeof m?m(a.failureCount,t):m,g=!0===p||"number"===typeof p&&a.failureCount<p||"function"===typeof p&&p(a.failureCount,t);!o&&g?(a.failureCount++,null==e.onFail||e.onFail(a.failureCount,t),(0,r.yy)(f).then(function(){if(!d.isFocused()||!u.isOnline())return new Promise(function(t){s=t,a.isPaused=!0,null==e.onPause||e.onPause()}).then(function(){s=void 0,a.isPaused=!1,null==e.onContinue||e.onContinue()})}).then(function(){o?l(t):n()})):l(t)}})}}()},y=function(){function e(e){this.abortSignalConsumed=!1,this.hadObservers=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||this.getDefaultState(this.options),this.state=this.initialState,this.meta=e.meta,this.scheduleGc()}var t=e.prototype;return t.setOptions=function(e){var t;this.options=(0,n.A)({},this.defaultOptions,e),this.meta=null==e?void 0:e.meta,this.cacheTime=Math.max(this.cacheTime||0,null!=(t=this.options.cacheTime)?t:3e5)},t.setDefaultOptions=function(e){this.defaultOptions=e},t.scheduleGc=function(){var e=this;this.clearGcTimeout(),(0,r.gn)(this.cacheTime)&&(this.gcTimeout=setTimeout(function(){e.optionalRemove()},this.cacheTime))},t.clearGcTimeout=function(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)},t.optionalRemove=function(){this.observers.length||(this.state.isFetching?this.hadObservers&&this.scheduleGc():this.cache.remove(this))},t.setData=function(e,t){var s,n,i=this.state.data,a=(0,r.Zw)(e,i);return(null==(s=(n=this.options).isDataEqual)?void 0:s.call(n,i,a))?a=i:!1!==this.options.structuralSharing&&(a=(0,r.BH)(i,a)),this.dispatch({data:a,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt}),a},t.setState=function(e,t){this.dispatch({type:"setState",state:e,setStateOptions:t})},t.cancel=function(e){var t,s=this.promise;return null==(t=this.retryer)||t.cancel(e),s?s.then(r.lQ).catch(r.lQ):Promise.resolve()},t.destroy=function(){this.clearGcTimeout(),this.cancel({silent:!0})},t.reset=function(){this.destroy(),this.setState(this.initialState)},t.isActive=function(){return this.observers.some(function(e){return!1!==e.options.enabled})},t.isFetching=function(){return this.state.isFetching},t.isStale=function(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(function(e){return e.getCurrentResult().isStale})},t.isStaleByTime=function(e){return void 0===e&&(e=0),this.state.isInvalidated||!this.state.dataUpdatedAt||!(0,r.j3)(this.state.dataUpdatedAt,e)},t.onFocus=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnWindowFocus()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.onOnline=function(){var e,t=this.observers.find(function(e){return e.shouldFetchOnReconnect()});t&&t.refetch(),null==(e=this.retryer)||e.continue()},t.addObserver=function(e){-1===this.observers.indexOf(e)&&(this.observers.push(e),this.hadObservers=!0,this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))},t.removeObserver=function(e){-1!==this.observers.indexOf(e)&&(this.observers=this.observers.filter(function(t){return t!==e}),this.observers.length||(this.retryer&&(this.retryer.isTransportCancelable||this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.cacheTime?this.scheduleGc():this.cache.remove(this)),this.cache.notify({type:"observerRemoved",query:this,observer:e}))},t.getObserversCount=function(){return this.observers.length},t.invalidate=function(){this.state.isInvalidated||this.dispatch({type:"invalidate"})},t.fetch=function(e,t){var s,n,i,a=this;if(this.state.isFetching)if(this.state.dataUpdatedAt&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(this.promise){var o;return null==(o=this.retryer)||o.continueRetry(),this.promise}if(e&&this.setOptions(e),!this.options.queryFn){var l=this.observers.find(function(e){return e.options.queryFn});l&&this.setOptions(l.options)}var d=(0,r.HN)(this.queryKey),u=(0,r.jY)(),h={queryKey:d,pageParam:void 0,meta:this.meta};Object.defineProperty(h,"signal",{enumerable:!0,get:function(){if(u)return a.abortSignalConsumed=!0,u.signal}});var p,m,y={fetchOptions:t,options:this.options,queryKey:d,state:this.state,fetchFn:function(){return a.options.queryFn?(a.abortSignalConsumed=!1,a.options.queryFn(h)):Promise.reject("Missing queryFn")},meta:this.meta};(null==(s=this.options.behavior)?void 0:s.onFetch)&&(null==(p=this.options.behavior)||p.onFetch(y));(this.revertState=this.state,this.state.isFetching&&this.state.fetchMeta===(null==(n=y.fetchOptions)?void 0:n.meta))||this.dispatch({type:"fetch",meta:null==(m=y.fetchOptions)?void 0:m.meta});return this.retryer=new g({fn:y.fetchFn,abort:null==u||null==(i=u.abort)?void 0:i.bind(u),onSuccess:function(e){a.setData(e),null==a.cache.config.onSuccess||a.cache.config.onSuccess(e,a),0===a.cacheTime&&a.optionalRemove()},onError:function(e){f(e)&&e.silent||a.dispatch({type:"error",error:e}),f(e)||(null==a.cache.config.onError||a.cache.config.onError(e,a),(0,c.t)().error(e)),0===a.cacheTime&&a.optionalRemove()},onFail:function(){a.dispatch({type:"failed"})},onPause:function(){a.dispatch({type:"pause"})},onContinue:function(){a.dispatch({type:"continue"})},retry:y.options.retry,retryDelay:y.options.retryDelay}),this.promise=this.retryer.promise,this.promise},t.dispatch=function(e){var t=this;this.state=this.reducer(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onQueryUpdate(e)}),t.cache.notify({query:t,type:"queryUpdated",action:e})})},t.getDefaultState=function(e){var t="function"===typeof e.initialData?e.initialData():e.initialData,s="undefined"!==typeof e.initialData?"function"===typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0,n="undefined"!==typeof t;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?null!=s?s:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchMeta:null,isFetching:!1,isInvalidated:!1,isPaused:!1,status:n?"success":"idle"}},t.reducer=function(e,t){var s,r;switch(t.type){case"failed":return(0,n.A)({},e,{fetchFailureCount:e.fetchFailureCount+1});case"pause":return(0,n.A)({},e,{isPaused:!0});case"continue":return(0,n.A)({},e,{isPaused:!1});case"fetch":return(0,n.A)({},e,{fetchFailureCount:0,fetchMeta:null!=(s=t.meta)?s:null,isFetching:!0,isPaused:!1},!e.dataUpdatedAt&&{error:null,status:"loading"});case"success":return(0,n.A)({},e,{data:t.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:null!=(r=t.dataUpdatedAt)?r:Date.now(),error:null,fetchFailureCount:0,isFetching:!1,isInvalidated:!1,isPaused:!1,status:"success"});case"error":var i=t.error;return f(i)&&i.revert&&this.revertState?(0,n.A)({},this.revertState):(0,n.A)({},e,{error:i,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,isFetching:!1,isPaused:!1,status:"error"});case"invalidate":return(0,n.A)({},e,{isInvalidated:!0});case"setState":return(0,n.A)({},e,t.state);default:return e}},e}(),v=function(e){function t(t){var s;return(s=e.call(this)||this).config=t||{},s.queries=[],s.queriesMap={},s}a(t,e);var s=t.prototype;return s.build=function(e,t,s){var n,i=t.queryKey,a=null!=(n=t.queryHash)?n:(0,r.F$)(i,t),o=this.get(a);return o||(o=new y({cache:this,queryKey:i,queryHash:a,options:e.defaultQueryOptions(t),state:s,defaultOptions:e.getQueryDefaults(i),meta:t.meta}),this.add(o)),o},s.add=function(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"queryAdded",query:e}))},s.remove=function(e){var t=this.queriesMap[e.queryHash];t&&(e.destroy(),this.queries=this.queries.filter(function(t){return t!==e}),t===e&&delete this.queriesMap[e.queryHash],this.notify({type:"queryRemoved",query:e}))},s.clear=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(t){e.remove(t)})})},s.get=function(e){return this.queriesMap[e]},s.getAll=function(){return this.queries},s.find=function(e,t){var s=(0,r.b_)(e,t)[0];return"undefined"===typeof s.exact&&(s.exact=!0),this.queries.find(function(e){return(0,r.MK)(s,e)})},s.findAll=function(e,t){var s=(0,r.b_)(e,t)[0];return Object.keys(s).length>0?this.queries.filter(function(e){return(0,r.MK)(s,e)}):this.queries},s.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},s.onFocus=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onFocus()})})},s.onOnline=function(){var e=this;o.j.batch(function(){e.queries.forEach(function(e){e.onOnline()})})},t}(l),x=function(){function e(e){this.options=(0,n.A)({},e.defaultOptions,e.options),this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.observers=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,isPaused:!1,status:"idle",variables:void 0},this.meta=e.meta}var t=e.prototype;return t.setState=function(e){this.dispatch({type:"setState",state:e})},t.addObserver=function(e){-1===this.observers.indexOf(e)&&this.observers.push(e)},t.removeObserver=function(e){this.observers=this.observers.filter(function(t){return t!==e})},t.cancel=function(){return this.retryer?(this.retryer.cancel(),this.retryer.promise.then(r.lQ).catch(r.lQ)):Promise.resolve()},t.continue=function(){return this.retryer?(this.retryer.continue(),this.retryer.promise):this.execute()},t.execute=function(){var e,t=this,s="loading"===this.state.status,n=Promise.resolve();return s||(this.dispatch({type:"loading",variables:this.options.variables}),n=n.then(function(){null==t.mutationCache.config.onMutate||t.mutationCache.config.onMutate(t.state.variables,t)}).then(function(){return null==t.options.onMutate?void 0:t.options.onMutate(t.state.variables)}).then(function(e){e!==t.state.context&&t.dispatch({type:"loading",context:e,variables:t.state.variables})})),n.then(function(){return t.executeMutation()}).then(function(s){e=s,null==t.mutationCache.config.onSuccess||t.mutationCache.config.onSuccess(e,t.state.variables,t.state.context,t)}).then(function(){return null==t.options.onSuccess?void 0:t.options.onSuccess(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(e,null,t.state.variables,t.state.context)}).then(function(){return t.dispatch({type:"success",data:e}),e}).catch(function(e){return null==t.mutationCache.config.onError||t.mutationCache.config.onError(e,t.state.variables,t.state.context,t),(0,c.t)().error(e),Promise.resolve().then(function(){return null==t.options.onError?void 0:t.options.onError(e,t.state.variables,t.state.context)}).then(function(){return null==t.options.onSettled?void 0:t.options.onSettled(void 0,e,t.state.variables,t.state.context)}).then(function(){throw t.dispatch({type:"error",error:e}),e})})},t.executeMutation=function(){var e,t=this;return this.retryer=new g({fn:function(){return t.options.mutationFn?t.options.mutationFn(t.state.variables):Promise.reject("No mutationFn found")},onFail:function(){t.dispatch({type:"failed"})},onPause:function(){t.dispatch({type:"pause"})},onContinue:function(){t.dispatch({type:"continue"})},retry:null!=(e=this.options.retry)?e:0,retryDelay:this.options.retryDelay}),this.retryer.promise},t.dispatch=function(e){var t=this;this.state=function(e,t){switch(t.type){case"failed":return(0,n.A)({},e,{failureCount:e.failureCount+1});case"pause":return(0,n.A)({},e,{isPaused:!0});case"continue":return(0,n.A)({},e,{isPaused:!1});case"loading":return(0,n.A)({},e,{context:t.context,data:void 0,error:null,isPaused:!1,status:"loading",variables:t.variables});case"success":return(0,n.A)({},e,{data:t.data,error:null,status:"success",isPaused:!1});case"error":return(0,n.A)({},e,{data:void 0,error:t.error,failureCount:e.failureCount+1,isPaused:!1,status:"error"});case"setState":return(0,n.A)({},e,t.state);default:return e}}(this.state,e),o.j.batch(function(){t.observers.forEach(function(t){t.onMutationUpdate(e)}),t.mutationCache.notify(t)})},e}();var _=function(e){function t(t){var s;return(s=e.call(this)||this).config=t||{},s.mutations=[],s.mutationId=0,s}a(t,e);var s=t.prototype;return s.build=function(e,t,s){var n=new x({mutationCache:this,mutationId:++this.mutationId,options:e.defaultMutationOptions(t),state:s,defaultOptions:t.mutationKey?e.getMutationDefaults(t.mutationKey):void 0,meta:t.meta});return this.add(n),n},s.add=function(e){this.mutations.push(e),this.notify(e)},s.remove=function(e){this.mutations=this.mutations.filter(function(t){return t!==e}),e.cancel(),this.notify(e)},s.clear=function(){var e=this;o.j.batch(function(){e.mutations.forEach(function(t){e.remove(t)})})},s.getAll=function(){return this.mutations},s.find=function(e){return"undefined"===typeof e.exact&&(e.exact=!0),this.mutations.find(function(t){return(0,r.nJ)(e,t)})},s.findAll=function(e){return this.mutations.filter(function(t){return(0,r.nJ)(e,t)})},s.notify=function(e){var t=this;o.j.batch(function(){t.listeners.forEach(function(t){t(e)})})},s.onFocus=function(){this.resumePausedMutations()},s.onOnline=function(){this.resumePausedMutations()},s.resumePausedMutations=function(){var e=this.mutations.filter(function(e){return e.state.isPaused});return o.j.batch(function(){return e.reduce(function(e,t){return e.then(function(){return t.continue().catch(r.lQ)})},Promise.resolve())})},t}(l);function E(e,t){return null==e.getNextPageParam?void 0:e.getNextPageParam(t[t.length-1],t)}function b(e,t){return null==e.getPreviousPageParam?void 0:e.getPreviousPageParam(t[0],t)}var w=function(){function e(e){void 0===e&&(e={}),this.queryCache=e.queryCache||new v,this.mutationCache=e.mutationCache||new _,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[]}var t=e.prototype;return t.mount=function(){var e=this;this.unsubscribeFocus=d.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onFocus(),e.queryCache.onFocus())}),this.unsubscribeOnline=u.subscribe(function(){d.isFocused()&&u.isOnline()&&(e.mutationCache.onOnline(),e.queryCache.onOnline())})},t.unmount=function(){var e,t;null==(e=this.unsubscribeFocus)||e.call(this),null==(t=this.unsubscribeOnline)||t.call(this)},t.isFetching=function(e,t){var s=(0,r.b_)(e,t)[0];return s.fetching=!0,this.queryCache.findAll(s).length},t.isMutating=function(e){return this.mutationCache.findAll((0,n.A)({},e,{fetching:!0})).length},t.getQueryData=function(e,t){var s;return null==(s=this.queryCache.find(e,t))?void 0:s.state.data},t.getQueriesData=function(e){return this.getQueryCache().findAll(e).map(function(e){return[e.queryKey,e.state.data]})},t.setQueryData=function(e,t,s){var n=(0,r.vh)(e),i=this.defaultQueryOptions(n);return this.queryCache.build(this,i).setData(t,s)},t.setQueriesData=function(e,t,s){var n=this;return o.j.batch(function(){return n.getQueryCache().findAll(e).map(function(e){var r=e.queryKey;return[r,n.setQueryData(r,t,s)]})})},t.getQueryState=function(e,t){var s;return null==(s=this.queryCache.find(e,t))?void 0:s.state},t.removeQueries=function(e,t){var s=(0,r.b_)(e,t)[0],n=this.queryCache;o.j.batch(function(){n.findAll(s).forEach(function(e){n.remove(e)})})},t.resetQueries=function(e,t,s){var i=this,a=(0,r.b_)(e,t,s),c=a[0],l=a[1],d=this.queryCache,u=(0,n.A)({},c,{active:!0});return o.j.batch(function(){return d.findAll(c).forEach(function(e){e.reset()}),i.refetchQueries(u,l)})},t.cancelQueries=function(e,t,s){var n=this,i=(0,r.b_)(e,t,s),a=i[0],c=i[1],l=void 0===c?{}:c;"undefined"===typeof l.revert&&(l.revert=!0);var d=o.j.batch(function(){return n.queryCache.findAll(a).map(function(e){return e.cancel(l)})});return Promise.all(d).then(r.lQ).catch(r.lQ)},t.invalidateQueries=function(e,t,s){var i,a,c,l=this,d=(0,r.b_)(e,t,s),u=d[0],h=d[1],p=(0,n.A)({},u,{active:null==(i=null!=(a=u.refetchActive)?a:u.active)||i,inactive:null!=(c=u.refetchInactive)&&c});return o.j.batch(function(){return l.queryCache.findAll(u).forEach(function(e){e.invalidate()}),l.refetchQueries(p,h)})},t.refetchQueries=function(e,t,s){var i=this,a=(0,r.b_)(e,t,s),c=a[0],l=a[1],d=o.j.batch(function(){return i.queryCache.findAll(c).map(function(e){return e.fetch(void 0,(0,n.A)({},l,{meta:{refetchPage:null==c?void 0:c.refetchPage}}))})}),u=Promise.all(d).then(r.lQ);return(null==l?void 0:l.throwOnError)||(u=u.catch(r.lQ)),u},t.fetchQuery=function(e,t,s){var n=(0,r.vh)(e,t,s),i=this.defaultQueryOptions(n);"undefined"===typeof i.retry&&(i.retry=!1);var a=this.queryCache.build(this,i);return a.isStaleByTime(i.staleTime)?a.fetch(i):Promise.resolve(a.state.data)},t.prefetchQuery=function(e,t,s){return this.fetchQuery(e,t,s).then(r.lQ).catch(r.lQ)},t.fetchInfiniteQuery=function(e,t,s){var n=(0,r.vh)(e,t,s);return n.behavior={onFetch:function(e){e.fetchFn=function(){var t,s,n,i,a,o,c,l=null==(t=e.fetchOptions)||null==(s=t.meta)?void 0:s.refetchPage,d=null==(n=e.fetchOptions)||null==(i=n.meta)?void 0:i.fetchMore,u=null==d?void 0:d.pageParam,h="forward"===(null==d?void 0:d.direction),m="backward"===(null==d?void 0:d.direction),f=(null==(a=e.state.data)?void 0:a.pages)||[],g=(null==(o=e.state.data)?void 0:o.pageParams)||[],y=(0,r.jY)(),v=null==y?void 0:y.signal,x=g,_=!1,w=e.options.queryFn||function(){return Promise.reject("Missing queryFn")},N=function(e,t,s,n){return x=n?[t].concat(x):[].concat(x,[t]),n?[s].concat(e):[].concat(e,[s])},S=function(t,s,n,r){if(_)return Promise.reject("Cancelled");if("undefined"===typeof n&&!s&&t.length)return Promise.resolve(t);var i={queryKey:e.queryKey,signal:v,pageParam:n,meta:e.meta},a=w(i),o=Promise.resolve(a).then(function(e){return N(t,n,e,r)});return p(a)&&(o.cancel=a.cancel),o};if(f.length)if(h){var T="undefined"!==typeof u,C=T?u:E(e.options,f);c=S(f,T,C)}else if(m){var R="undefined"!==typeof u,I=R?u:b(e.options,f);c=S(f,R,I,!0)}else!function(){x=[];var t="undefined"===typeof e.options.getNextPageParam,s=!l||!f[0]||l(f[0],0,f);c=s?S([],t,g[0]):Promise.resolve(N([],g[0],f[0]));for(var n=function(s){c=c.then(function(n){if(!l||!f[s]||l(f[s],s,f)){var r=t?g[s]:E(e.options,n);return S(n,t,r)}return Promise.resolve(N(n,g[s],f[s]))})},r=1;r<f.length;r++)n(r)}();else c=S([]);var A=c.then(function(e){return{pages:e,pageParams:x}});return A.cancel=function(){_=!0,null==y||y.abort(),p(c)&&c.cancel()},A}}},this.fetchQuery(n)},t.prefetchInfiniteQuery=function(e,t,s){return this.fetchInfiniteQuery(e,t,s).then(r.lQ).catch(r.lQ)},t.cancelMutations=function(){var e=this,t=o.j.batch(function(){return e.mutationCache.getAll().map(function(e){return e.cancel()})});return Promise.all(t).then(r.lQ).catch(r.lQ)},t.resumePausedMutations=function(){return this.getMutationCache().resumePausedMutations()},t.executeMutation=function(e){return this.mutationCache.build(this,e).execute()},t.getQueryCache=function(){return this.queryCache},t.getMutationCache=function(){return this.mutationCache},t.getDefaultOptions=function(){return this.defaultOptions},t.setDefaultOptions=function(e){this.defaultOptions=e},t.setQueryDefaults=function(e,t){var s=this.queryDefaults.find(function(t){return(0,r.Od)(e)===(0,r.Od)(t.queryKey)});s?s.defaultOptions=t:this.queryDefaults.push({queryKey:e,defaultOptions:t})},t.getQueryDefaults=function(e){var t;return e?null==(t=this.queryDefaults.find(function(t){return(0,r.Cp)(e,t.queryKey)}))?void 0:t.defaultOptions:void 0},t.setMutationDefaults=function(e,t){var s=this.mutationDefaults.find(function(t){return(0,r.Od)(e)===(0,r.Od)(t.mutationKey)});s?s.defaultOptions=t:this.mutationDefaults.push({mutationKey:e,defaultOptions:t})},t.getMutationDefaults=function(e){var t;return e?null==(t=this.mutationDefaults.find(function(t){return(0,r.Cp)(e,t.mutationKey)}))?void 0:t.defaultOptions:void 0},t.defaultQueryOptions=function(e){if(null==e?void 0:e._defaulted)return e;var t=(0,n.A)({},this.defaultOptions.queries,this.getQueryDefaults(null==e?void 0:e.queryKey),e,{_defaulted:!0});return!t.queryHash&&t.queryKey&&(t.queryHash=(0,r.F$)(t.queryKey,t)),t},t.defaultQueryObserverOptions=function(e){return this.defaultQueryOptions(e)},t.defaultMutationOptions=function(e){return(null==e?void 0:e._defaulted)?e:(0,n.A)({},this.defaultOptions.mutations,this.getMutationDefaults(null==e?void 0:e.mutationKey),e,{_defaulted:!0})},t.clear=function(){this.queryCache.clear(),this.mutationCache.clear()},e}()},4199:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(e){var s=t,n=s.lib,r=n.WordArray,i=n.Hasher,a=s.algo,o=[];!function(){for(var t=0;t<64;t++)o[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var n=t+s,r=e[n];e[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var i=this._hash.words,a=e[t+0],c=e[t+1],p=e[t+2],m=e[t+3],f=e[t+4],g=e[t+5],y=e[t+6],v=e[t+7],x=e[t+8],_=e[t+9],E=e[t+10],b=e[t+11],w=e[t+12],N=e[t+13],S=e[t+14],T=e[t+15],C=i[0],R=i[1],I=i[2],A=i[3];C=l(C,R,I,A,a,7,o[0]),A=l(A,C,R,I,c,12,o[1]),I=l(I,A,C,R,p,17,o[2]),R=l(R,I,A,C,m,22,o[3]),C=l(C,R,I,A,f,7,o[4]),A=l(A,C,R,I,g,12,o[5]),I=l(I,A,C,R,y,17,o[6]),R=l(R,I,A,C,v,22,o[7]),C=l(C,R,I,A,x,7,o[8]),A=l(A,C,R,I,_,12,o[9]),I=l(I,A,C,R,E,17,o[10]),R=l(R,I,A,C,b,22,o[11]),C=l(C,R,I,A,w,7,o[12]),A=l(A,C,R,I,N,12,o[13]),I=l(I,A,C,R,S,17,o[14]),C=d(C,R=l(R,I,A,C,T,22,o[15]),I,A,c,5,o[16]),A=d(A,C,R,I,y,9,o[17]),I=d(I,A,C,R,b,14,o[18]),R=d(R,I,A,C,a,20,o[19]),C=d(C,R,I,A,g,5,o[20]),A=d(A,C,R,I,E,9,o[21]),I=d(I,A,C,R,T,14,o[22]),R=d(R,I,A,C,f,20,o[23]),C=d(C,R,I,A,_,5,o[24]),A=d(A,C,R,I,S,9,o[25]),I=d(I,A,C,R,m,14,o[26]),R=d(R,I,A,C,x,20,o[27]),C=d(C,R,I,A,N,5,o[28]),A=d(A,C,R,I,p,9,o[29]),I=d(I,A,C,R,v,14,o[30]),C=u(C,R=d(R,I,A,C,w,20,o[31]),I,A,g,4,o[32]),A=u(A,C,R,I,x,11,o[33]),I=u(I,A,C,R,b,16,o[34]),R=u(R,I,A,C,S,23,o[35]),C=u(C,R,I,A,c,4,o[36]),A=u(A,C,R,I,f,11,o[37]),I=u(I,A,C,R,v,16,o[38]),R=u(R,I,A,C,E,23,o[39]),C=u(C,R,I,A,N,4,o[40]),A=u(A,C,R,I,a,11,o[41]),I=u(I,A,C,R,m,16,o[42]),R=u(R,I,A,C,y,23,o[43]),C=u(C,R,I,A,_,4,o[44]),A=u(A,C,R,I,w,11,o[45]),I=u(I,A,C,R,T,16,o[46]),C=h(C,R=u(R,I,A,C,p,23,o[47]),I,A,a,6,o[48]),A=h(A,C,R,I,v,10,o[49]),I=h(I,A,C,R,S,15,o[50]),R=h(R,I,A,C,g,21,o[51]),C=h(C,R,I,A,w,6,o[52]),A=h(A,C,R,I,m,10,o[53]),I=h(I,A,C,R,E,15,o[54]),R=h(R,I,A,C,c,21,o[55]),C=h(C,R,I,A,x,6,o[56]),A=h(A,C,R,I,T,10,o[57]),I=h(I,A,C,R,y,15,o[58]),R=h(R,I,A,C,N,21,o[59]),C=h(C,R,I,A,f,6,o[60]),A=h(A,C,R,I,b,10,o[61]),I=h(I,A,C,R,p,15,o[62]),R=h(R,I,A,C,_,21,o[63]),i[0]=i[0]+C|0,i[1]=i[1]+R|0,i[2]=i[2]+I|0,i[3]=i[3]+A|0},_doFinalize:function(){var t=this._data,s=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;s[r>>>5]|=128<<24-r%32;var i=e.floor(n/4294967296),a=n;s[15+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),s[14+(r+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(s.length+1),this._process();for(var o=this._hash,c=o.words,l=0;l<4;l++){var d=c[l];c[l]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return o},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,s,n,r,i,a){var o=e+(t&s|~t&n)+r+a;return(o<<i|o>>>32-i)+t}function d(e,t,s,n,r,i,a){var o=e+(t&n|s&~n)+r+a;return(o<<i|o>>>32-i)+t}function u(e,t,s,n,r,i,a){var o=e+(t^s^n)+r+a;return(o<<i|o>>>32-i)+t}function h(e,t,s,n,r,i,a){var o=e+(s^(t|~n))+r+a;return(o<<i|o>>>32-i)+t}s.MD5=i._createHelper(c),s.HmacMD5=i._createHmacHelper(c)}(Math),t.MD5)}()},4202:(e,t)=>{"use strict";var s=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function y(e,t,s){this.props=e,this.context=t,this.refs=g,this.updater=s||m}function v(){}function x(e,t,s){this.props=e,this.context=t,this.refs=g,this.updater=s||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var _=x.prototype=new v;_.constructor=x,f(_,y.prototype),_.isPureReactComponent=!0;var E=Array.isArray,b=Object.prototype.hasOwnProperty,w={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,n){var r,i={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)b.call(t,r)&&!N.hasOwnProperty(r)&&(i[r]=t[r]);var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){for(var l=Array(c),d=0;d<c;d++)l[d]=arguments[d+2];i.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===i[r]&&(i[r]=c[r]);return{$$typeof:s,type:e,key:a,ref:o,props:i,_owner:w.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===s}var C=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,r,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c=!1;if(null===e)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case s:case n:c=!0}}if(c)return a=a(c=e),e=""===i?"."+R(c,0):i,E(a)?(r="",null!=e&&(r=e.replace(C,"$&/")+"/"),I(a,t,r,"",function(e){return e})):null!=a&&(T(a)&&(a=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+e)),t.push(a)),1;if(c=0,i=""===i?".":i+":",E(e))for(var l=0;l<e.length;l++){var d=i+R(o=e[l],l);c+=I(o,t,r,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),l=0;!(o=e.next()).done;)c+=I(o=o.value,t,r,d=i+R(o,l++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function A(e,t,s){if(null==e)return e;var n=[],r=0;return I(e,n,"","",function(e){return t.call(s,e,r++)}),n}function O(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var j={current:null},k={transition:null},D={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:k,ReactCurrentOwner:w};t.Children={map:A,forEach:function(e,t,s){A(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=r,t.Profiler=a,t.PureComponent=x,t.StrictMode=i,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=f({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=w.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)b.call(t,l)&&!N.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=n;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:s,type:e.type,key:i,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return j.current.useCallback(e,t)},t.useContext=function(e){return j.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return j.current.useDeferredValue(e)},t.useEffect=function(e,t){return j.current.useEffect(e,t)},t.useId=function(){return j.current.useId()},t.useImperativeHandle=function(e,t,s){return j.current.useImperativeHandle(e,t,s)},t.useInsertionEffect=function(e,t){return j.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return j.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return j.current.useMemo(e,t)},t.useReducer=function(e,t,s){return j.current.useReducer(e,t,s)},t.useRef=function(e){return j.current.useRef(e)},t.useState=function(e){return j.current.useState(e)},t.useSyncExternalStore=function(e,t,s){return j.current.useSyncExternalStore(e,t,s)},t.useTransition=function(){return j.current.useTransition()},t.version="18.2.0"},4220:function(e,t,s){!function(){var t;e.exports=(t=s(4488),void function(){var e=t,s=e.lib.Base,n=e.enc.Utf8;e.algo.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var s=e.blockSize,r=4*s;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),o=i.words,c=a.words,l=0;l<s;l++)o[l]^=1549556828,c[l]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,s=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(s))}})}())}()},4298:()=>{},4391:(e,t,s)=>{"use strict";var n=s(7950);t.H=n.createRoot,n.hydrateRoot},4423:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.pad.Iso97971={pad:function(e,s){e.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(e,s)},unpad:function(e){t.pad.ZeroPadding.unpad(e),e.sigBytes--}},t.pad.Iso97971)}()},4488:function(e,t,s){e.exports=function(){var e=e||function(e,t){var n;if("undefined"!==typeof window&&window.crypto&&(n=window.crypto),"undefined"!==typeof self&&self.crypto&&(n=self.crypto),"undefined"!==typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!==typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&"undefined"!==typeof s.g&&s.g.crypto&&(n=s.g.crypto),!n)try{n=s(477)}catch(g){}var r=function(){if(n){if("function"===typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(g){}if("function"===typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),a={},o=a.lib={},c=o.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=o.WordArray=c.extend({init:function(e,s){e=this.words=e||[],this.sigBytes=s!=t?s:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,s=e.words,n=this.sigBytes,r=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<r;i++){var a=s[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var o=0;o<r;o+=4)t[n+o>>>2]=s[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(r());return new l.init(t,e)}}),d=a.enc={},u=d.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],r=0;r<s;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,s=[],n=0;n<t;n+=2)s[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new l.init(s,t/2)}},h=d.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],r=0;r<s;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,s=[],n=0;n<t;n++)s[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new l.init(s,t)}},p=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},m=o.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s,n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,o=i/(4*a),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*a,d=e.min(4*c,i);if(c){for(var u=0;u<c;u+=a)this._doProcessBlock(r,u);s=r.splice(0,c),n.sigBytes-=d}return new l.init(s,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(o.Hasher=m.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new f.HMAC.init(e,s).finalize(t)}}}),a.algo={});return a}(Math);return e}()},4503:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(){if("function"==typeof ArrayBuffer){var e=t.lib.WordArray,s=e.init,n=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!==typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,n=[],r=0;r<t;r++)n[r>>>2]|=e[r]<<24-r%4*8;s.call(this,n,t)}else s.apply(this,arguments)};n.prototype=e}}(),t.lib.WordArray)}()},4646:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(){var e=t,s=e.lib.WordArray;function n(e,t,n){for(var r=[],i=0,a=0;a<t;a++)if(a%4){var o=n[e.charCodeAt(a-1)]<<a%4*2|n[e.charCodeAt(a)]>>>6-a%4*2;r[i>>>2]|=o<<24-i%4*8,i++}return s.create(r,i)}e.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var s=e.words,n=e.sigBytes,r=t?this._safe_map:this._map;e.clamp();for(var i=[],a=0;a<n;a+=3)for(var o=(s[a>>>2]>>>24-a%4*8&255)<<16|(s[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|s[a+2>>>2]>>>24-(a+2)%4*8&255,c=0;c<4&&a+.75*c<n;c++)i.push(r.charAt(o>>>6*(3-c)&63));var l=r.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e,t){void 0===t&&(t=!0);var s=e.length,r=t?this._safe_map:this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var a=0;a<r.length;a++)i[r.charCodeAt(a)]=a}var o=r.charAt(64);if(o){var c=e.indexOf(o);-1!==c&&(s=c)}return n(e,s,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),t.enc.Base64url)}()},4708:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),function(){var e=t,s=e.lib.CipherParams,n=e.enc.Hex;e.format.Hex={stringify:function(e){return e.ciphertext.toString(n)},parse:function(e){var t=n.parse(e);return s.create({ciphertext:t})}}}(),t.format.Hex)}()},5043:(e,t,s)=>{"use strict";e.exports=s(4202)},5787:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(){var e=t,s=e.lib.WordArray,n=e.enc;function r(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],r=0;r<s;r+=2){var i=t[r>>>2]>>>16-r%4*8&65535;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return s.create(n,2*t)}},n.Utf16LE={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],i=0;i<s;i+=2){var a=r(t[i>>>2]>>>16-i%4*8&65535);n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>1]|=r(e.charCodeAt(i)<<16-i%2*16);return s.create(n,2*t)}}}(),t.enc.Utf16)}()},5819:(e,t,s)=>{"use strict";s.d(t,{QueryClient:()=>n.E});var n=s(4198),r=s(4298);s.o(r,"QueryClientProvider")&&s.d(t,{QueryClientProvider:function(){return r.QueryClientProvider}})},6111:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(9749),s(4503),s(5787),s(8523),s(4646),s(4199),s(2002),s(6368),s(1641),s(7061),s(9092),s(6600),s(7423),s(4220),s(3930),s(8211),s(2238),s(1112),s(7962),s(8049),s(6380),s(8099),s(1884),s(9132),s(4423),s(548),s(4087),s(4708),s(7780),s(9475),s(9638),s(8875),s(1659),s(6501),t)}()},6368:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(e){var s=t,n=s.lib,r=n.WordArray,i=n.Hasher,a=s.algo,o=[],c=[];!function(){function t(t){for(var s=e.sqrt(t),n=2;n<=s;n++)if(!(t%n))return!1;return!0}function s(e){return 4294967296*(e-(0|e))|0}for(var n=2,r=0;r<64;)t(n)&&(r<8&&(o[r]=s(e.pow(n,.5))),c[r]=s(e.pow(n,1/3)),r++),n++}();var l=[],d=a.SHA256=i.extend({_doReset:function(){this._hash=new r.init(o.slice(0))},_doProcessBlock:function(e,t){for(var s=this._hash.words,n=s[0],r=s[1],i=s[2],a=s[3],o=s[4],d=s[5],u=s[6],h=s[7],p=0;p<64;p++){if(p<16)l[p]=0|e[t+p];else{var m=l[p-15],f=(m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3,g=l[p-2],y=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;l[p]=f+l[p-7]+y+l[p-16]}var v=n&r^n&i^r&i,x=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),_=h+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&d^~o&u)+c[p]+l[p];h=u,u=d,d=o,o=a+_|0,a=i,i=r,r=n,n=_+(x+v)|0}s[0]=s[0]+n|0,s[1]=s[1]+r|0,s[2]=s[2]+i|0,s[3]=s[3]+a|0,s[4]=s[4]+o|0,s[5]=s[5]+d|0,s[6]=s[6]+u|0,s[7]=s[7]+h|0},_doFinalize:function(){var t=this._data,s=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return s[r>>>5]|=128<<24-r%32,s[14+(r+64>>>9<<4)]=e.floor(n/4294967296),s[15+(r+64>>>9<<4)]=n,t.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});s.SHA256=i._createHelper(d),s.HmacSHA256=i._createHmacHelper(d)}(Math),t.SHA256)}()},6380:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.mode.OFB=function(){var e=t.lib.BlockCipherMode.extend(),s=e.Encryptor=e.extend({processBlock:function(e,t){var s=this._cipher,n=s.blockSize,r=this._iv,i=this._keystream;r&&(i=this._keystream=r.slice(0),this._iv=void 0),s.encryptBlock(i,0);for(var a=0;a<n;a++)e[t+a]^=i[a]}});return e.Decryptor=s,e}(),t.mode.OFB)}()},6501:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(8523),s(4199),s(8211),s(2238),function(){var e=t,s=e.lib.BlockCipher,n=e.algo;const r=16,i=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],a=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var o={pbox:[],sbox:[]};function c(e,t){let s=t>>24&255,n=t>>16&255,r=t>>8&255,i=255&t,a=e.sbox[0][s]+e.sbox[1][n];return a^=e.sbox[2][r],a+=e.sbox[3][i],a}function l(e,t,s){let n,i=t,a=s;for(let o=0;o<r;++o)i^=e.pbox[o],a=c(e,i)^a,n=i,i=a,a=n;return n=i,i=a,a=n,a^=e.pbox[r],i^=e.pbox[r+1],{left:i,right:a}}function d(e,t,s){let n,i=t,a=s;for(let o=r+1;o>1;--o)i^=e.pbox[o],a=c(e,i)^a,n=i,i=a,a=n;return n=i,i=a,a=n,a^=e.pbox[1],i^=e.pbox[0],{left:i,right:a}}function u(e,t,s){for(let r=0;r<4;r++){e.sbox[r]=[];for(let t=0;t<256;t++)e.sbox[r][t]=a[r][t]}let n=0;for(let a=0;a<r+2;a++)e.pbox[a]=i[a]^t[n],n++,n>=s&&(n=0);let o=0,c=0,d=0;for(let i=0;i<r+2;i+=2)d=l(e,o,c),o=d.left,c=d.right,e.pbox[i]=o,e.pbox[i+1]=c;for(let r=0;r<4;r++)for(let t=0;t<256;t+=2)d=l(e,o,c),o=d.left,c=d.right,e.sbox[r][t]=o,e.sbox[r][t+1]=c;return!0}var h=n.Blowfish=s.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,s=e.sigBytes/4;u(o,t,s)}},encryptBlock:function(e,t){var s=l(o,e[t],e[t+1]);e[t]=s.left,e[t+1]=s.right},decryptBlock:function(e,t){var s=d(o,e[t],e[t+1]);e[t]=s.left,e[t+1]=s.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=s._createHelper(h)}(),t.Blowfish)}()},6524:(e,t,s)=>{"use strict";s.d(t,{QueryClientProvider:()=>u});var n=s(1991),r=s(7950).unstable_batchedUpdates;n.j.setBatchNotifyFunction(r);var i=s(75),a=console;(0,i.B)(a);var o=s(5043),c=o.createContext(void 0),l=o.createContext(!1);function d(e){return e&&"undefined"!==typeof window?(window.ReactQueryClientContext||(window.ReactQueryClientContext=c),window.ReactQueryClientContext):c}var u=function(e){var t=e.client,s=e.contextSharing,n=void 0!==s&&s,r=e.children;o.useEffect(function(){return t.mount(),function(){t.unmount()}},[t]);var i=d(n);return o.createElement(l.Provider,{value:n},o.createElement(i.Provider,{value:t},r))}},6600:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(9749),function(e){var s=t,n=s.lib,r=n.WordArray,i=n.Hasher,a=s.x64.Word,o=s.algo,c=[],l=[],d=[];!function(){for(var e=1,t=0,s=0;s<24;s++){c[e+5*t]=(s+1)*(s+2)/2%64;var n=(2*e+3*t)%5;e=t%5,t=n}for(e=0;e<5;e++)for(t=0;t<5;t++)l[e+5*t]=t+(2*e+3*t)%5*5;for(var r=1,i=0;i<24;i++){for(var o=0,u=0,h=0;h<7;h++){if(1&r){var p=(1<<h)-1;p<32?u^=1<<p:o^=1<<p-32}128&r?r=r<<1^113:r<<=1}d[i]=a.create(o,u)}}();var u=[];!function(){for(var e=0;e<25;e++)u[e]=a.create()}();var h=o.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var s=this._state,n=this.blockSize/2,r=0;r<n;r++){var i=e[t+2*r],a=e[t+2*r+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(R=s[r]).high^=a,R.low^=i}for(var o=0;o<24;o++){for(var h=0;h<5;h++){for(var p=0,m=0,f=0;f<5;f++)p^=(R=s[h+5*f]).high,m^=R.low;var g=u[h];g.high=p,g.low=m}for(h=0;h<5;h++){var y=u[(h+4)%5],v=u[(h+1)%5],x=v.high,_=v.low;for(p=y.high^(x<<1|_>>>31),m=y.low^(_<<1|x>>>31),f=0;f<5;f++)(R=s[h+5*f]).high^=p,R.low^=m}for(var E=1;E<25;E++){var b=(R=s[E]).high,w=R.low,N=c[E];N<32?(p=b<<N|w>>>32-N,m=w<<N|b>>>32-N):(p=w<<N-32|b>>>64-N,m=b<<N-32|w>>>64-N);var S=u[l[E]];S.high=p,S.low=m}var T=u[0],C=s[0];for(T.high=C.high,T.low=C.low,h=0;h<5;h++)for(f=0;f<5;f++){var R=s[E=h+5*f],I=u[E],A=u[(h+1)%5+5*f],O=u[(h+2)%5+5*f];R.high=I.high^~A.high&O.high,R.low=I.low^~A.low&O.low}R=s[0];var j=d[o];R.high^=j.high,R.low^=j.low}},_doFinalize:function(){var t=this._data,s=t.words,n=(this._nDataBytes,8*t.sigBytes),i=32*this.blockSize;s[n>>>5]|=1<<24-n%32,s[(e.ceil((n+1)/i)*i>>>5)-1]|=128,t.sigBytes=4*s.length,this._process();for(var a=this._state,o=this.cfg.outputLength/8,c=o/8,l=[],d=0;d<c;d++){var u=a[d],h=u.high,p=u.low;h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),l.push(p),l.push(h)}return new r.init(l,o)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),s=0;s<25;s++)t[s]=t[s].clone();return e}});s.SHA3=i._createHelper(h),s.HmacSHA3=i._createHmacHelper(h)}(Math),t.SHA3)}()},7061:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(9749),function(){var e=t,s=e.lib.Hasher,n=e.x64,r=n.Word,i=n.WordArray,a=e.algo;function o(){return r.create.apply(r,arguments)}var c=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],l=[];!function(){for(var e=0;e<80;e++)l[e]=o()}();var d=a.SHA512=s.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var s=this._hash.words,n=s[0],r=s[1],i=s[2],a=s[3],o=s[4],d=s[5],u=s[6],h=s[7],p=n.high,m=n.low,f=r.high,g=r.low,y=i.high,v=i.low,x=a.high,_=a.low,E=o.high,b=o.low,w=d.high,N=d.low,S=u.high,T=u.low,C=h.high,R=h.low,I=p,A=m,O=f,j=g,k=y,D=v,P=x,L=_,M=E,U=b,V=w,F=N,B=S,G=T,W=C,H=R,K=0;K<80;K++){var z,q,Y=l[K];if(K<16)q=Y.high=0|e[t+2*K],z=Y.low=0|e[t+2*K+1];else{var X=l[K-15],J=X.high,Q=X.low,Z=(J>>>1|Q<<31)^(J>>>8|Q<<24)^J>>>7,$=(Q>>>1|J<<31)^(Q>>>8|J<<24)^(Q>>>7|J<<25),ee=l[K-2],te=ee.high,se=ee.low,ne=(te>>>19|se<<13)^(te<<3|se>>>29)^te>>>6,re=(se>>>19|te<<13)^(se<<3|te>>>29)^(se>>>6|te<<26),ie=l[K-7],ae=ie.high,oe=ie.low,ce=l[K-16],le=ce.high,de=ce.low;q=(q=(q=Z+ae+((z=$+oe)>>>0<$>>>0?1:0))+ne+((z+=re)>>>0<re>>>0?1:0))+le+((z+=de)>>>0<de>>>0?1:0),Y.high=q,Y.low=z}var ue,he=M&V^~M&B,pe=U&F^~U&G,me=I&O^I&k^O&k,fe=A&j^A&D^j&D,ge=(I>>>28|A<<4)^(I<<30|A>>>2)^(I<<25|A>>>7),ye=(A>>>28|I<<4)^(A<<30|I>>>2)^(A<<25|I>>>7),ve=(M>>>14|U<<18)^(M>>>18|U<<14)^(M<<23|U>>>9),xe=(U>>>14|M<<18)^(U>>>18|M<<14)^(U<<23|M>>>9),_e=c[K],Ee=_e.high,be=_e.low,we=W+ve+((ue=H+xe)>>>0<H>>>0?1:0),Ne=ye+fe;W=B,H=G,B=V,G=F,V=M,F=U,M=P+(we=(we=(we=we+he+((ue+=pe)>>>0<pe>>>0?1:0))+Ee+((ue+=be)>>>0<be>>>0?1:0))+q+((ue+=z)>>>0<z>>>0?1:0))+((U=L+ue|0)>>>0<L>>>0?1:0)|0,P=k,L=D,k=O,D=j,O=I,j=A,I=we+(ge+me+(Ne>>>0<ye>>>0?1:0))+((A=ue+Ne|0)>>>0<ue>>>0?1:0)|0}m=n.low=m+A,n.high=p+I+(m>>>0<A>>>0?1:0),g=r.low=g+j,r.high=f+O+(g>>>0<j>>>0?1:0),v=i.low=v+D,i.high=y+k+(v>>>0<D>>>0?1:0),_=a.low=_+L,a.high=x+P+(_>>>0<L>>>0?1:0),b=o.low=b+U,o.high=E+M+(b>>>0<U>>>0?1:0),N=d.low=N+F,d.high=w+V+(N>>>0<F>>>0?1:0),T=u.low=T+G,u.high=S+B+(T>>>0<G>>>0?1:0),R=h.low=R+H,h.high=C+W+(R>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(s/4294967296),t[31+(n+128>>>10<<5)]=s,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=s._createHelper(d),e.HmacSHA512=s._createHmacHelper(d)}(),t.SHA512)}()},7234:(e,t)=>{"use strict";function s(e,t){var s=e.length;e.push(t);e:for(;0<s;){var n=s-1>>>1,r=e[n];if(!(0<i(r,t)))break e;e[n]=t,e[s]=r,s=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],s=e.pop();if(s!==t){e[0]=s;e:for(var n=0,r=e.length,a=r>>>1;n<a;){var o=2*(n+1)-1,c=e[o],l=o+1,d=e[l];if(0>i(c,s))l<r&&0>i(d,c)?(e[n]=d,e[l]=s,n=l):(e[n]=c,e[o]=s,n=o);else{if(!(l<r&&0>i(d,s)))break e;e[n]=d,e[l]=s,n=l}}}return t}function i(e,t){var s=e.sortIndex-t.sortIndex;return 0!==s?s:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,c=o.now();t.unstable_now=function(){return o.now()-c}}var l=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function _(e){for(var t=n(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,s(l,t)}t=n(d)}}function E(e){if(g=!1,_(e),!f)if(null!==n(l))f=!0,k(b);else{var t=n(d);null!==t&&D(E,t.startTime-e)}}function b(e,s){f=!1,g&&(g=!1,v(T),T=-1),m=!0;var i=p;try{for(_(s),h=n(l);null!==h&&(!(h.expirationTime>s)||e&&!I());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=s);s=t.unstable_now(),"function"===typeof o?h.callback=o:h===n(l)&&r(l),_(s)}else r(l);h=n(l)}if(null!==h)var c=!0;else{var u=n(d);null!==u&&D(E,u.startTime-s),c=!1}return c}finally{h=null,p=i,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,N=!1,S=null,T=-1,C=5,R=-1;function I(){return!(t.unstable_now()-R<C)}function A(){if(null!==S){var e=t.unstable_now();R=e;var s=!0;try{s=S(!0,e)}finally{s?w():(N=!1,S=null)}}else N=!1}if("function"===typeof x)w=function(){x(A)};else if("undefined"!==typeof MessageChannel){var O=new MessageChannel,j=O.port2;O.port1.onmessage=A,w=function(){j.postMessage(null)}}else w=function(){y(A,0)};function k(e){S=e,N||(N=!0,w())}function D(e,s){T=y(function(){e(t.unstable_now())},s)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,k(b))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var s=p;p=t;try{return e()}finally{p=s}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var s=p;p=e;try{return t()}finally{p=s}},t.unstable_scheduleCallback=function(e,r,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>a?(e.sortIndex=i,s(d,e),null===n(l)&&e===n(d)&&(g?(v(T),T=-1):g=!0,D(E,i-a))):(e.sortIndex=o,s(l,e),f||m||(f=!0,k(b))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var s=p;p=t;try{return e.apply(this,arguments)}finally{p=s}}}},7423:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(){var e=t,s=e.lib,n=s.WordArray,r=s.Hasher,i=e.algo,a=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=n.create([0,1518500249,1859775393,2400959708,2840853838]),u=n.create([1352829926,1548603684,1836072691,2053994217,0]),h=i.RIPEMD160=r.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var n=t+s,r=e[n];e[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var i,h,x,_,E,b,w,N,S,T,C,R=this._hash.words,I=d.words,A=u.words,O=a.words,j=o.words,k=c.words,D=l.words;for(b=i=R[0],w=h=R[1],N=x=R[2],S=_=R[3],T=E=R[4],s=0;s<80;s+=1)C=i+e[t+O[s]]|0,C+=s<16?p(h,x,_)+I[0]:s<32?m(h,x,_)+I[1]:s<48?f(h,x,_)+I[2]:s<64?g(h,x,_)+I[3]:y(h,x,_)+I[4],C=(C=v(C|=0,k[s]))+E|0,i=E,E=_,_=v(x,10),x=h,h=C,C=b+e[t+j[s]]|0,C+=s<16?y(w,N,S)+A[0]:s<32?g(w,N,S)+A[1]:s<48?f(w,N,S)+A[2]:s<64?m(w,N,S)+A[3]:p(w,N,S)+A[4],C=(C=v(C|=0,D[s]))+T|0,b=T,T=S,S=v(N,10),N=w,w=C;C=R[1]+x+S|0,R[1]=R[2]+_+T|0,R[2]=R[3]+E+b|0,R[3]=R[4]+i+w|0,R[4]=R[0]+h+N|0,R[0]=C},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,i=r.words,a=0;a<5;a++){var o=i[a];i[a]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return r},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function p(e,t,s){return e^t^s}function m(e,t,s){return e&t|~e&s}function f(e,t,s){return(e|~t)^s}function g(e,t,s){return e&s|t&~s}function y(e,t,s){return e^(t|~s)}function v(e,t){return e<<t|e>>>32-t}e.RIPEMD160=r._createHelper(h),e.HmacRIPEMD160=r._createHmacHelper(h)}(Math),t.RIPEMD160)}()},7780:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(8523),s(4199),s(8211),s(2238),function(){var e=t,s=e.lib.BlockCipher,n=e.algo,r=[],i=[],a=[],o=[],c=[],l=[],d=[],u=[],h=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var s=0,n=0;for(t=0;t<256;t++){var m=n^n<<1^n<<2^n<<3^n<<4;m=m>>>8^255&m^99,r[s]=m,i[m]=s;var f=e[s],g=e[f],y=e[g],v=257*e[m]^16843008*m;a[s]=v<<24|v>>>8,o[s]=v<<16|v>>>16,c[s]=v<<8|v>>>24,l[s]=v,v=16843009*y^65537*g^257*f^16843008*s,d[m]=v<<24|v>>>8,u[m]=v<<16|v>>>16,h[m]=v<<8|v>>>24,p[m]=v,s?(s=f^e[e[e[y^f]]],n^=e[e[n]]):s=n=1}}();var m=[0,1,2,4,8,16,32,64,128,27,54],f=n.AES=s.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,s=e.sigBytes/4,n=4*((this._nRounds=s+6)+1),i=this._keySchedule=[],a=0;a<n;a++)a<s?i[a]=t[a]:(l=i[a-1],a%s?s>6&&a%s==4&&(l=r[l>>>24]<<24|r[l>>>16&255]<<16|r[l>>>8&255]<<8|r[255&l]):(l=r[(l=l<<8|l>>>24)>>>24]<<24|r[l>>>16&255]<<16|r[l>>>8&255]<<8|r[255&l],l^=m[a/s|0]<<24),i[a]=i[a-s]^l);for(var o=this._invKeySchedule=[],c=0;c<n;c++){if(a=n-c,c%4)var l=i[a];else l=i[a-4];o[c]=c<4||a<=4?l:d[r[l>>>24]]^u[r[l>>>16&255]]^h[r[l>>>8&255]]^p[r[255&l]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,o,c,l,r)},decryptBlock:function(e,t){var s=e[t+1];e[t+1]=e[t+3],e[t+3]=s,this._doCryptBlock(e,t,this._invKeySchedule,d,u,h,p,i),s=e[t+1],e[t+1]=e[t+3],e[t+3]=s},_doCryptBlock:function(e,t,s,n,r,i,a,o){for(var c=this._nRounds,l=e[t]^s[0],d=e[t+1]^s[1],u=e[t+2]^s[2],h=e[t+3]^s[3],p=4,m=1;m<c;m++){var f=n[l>>>24]^r[d>>>16&255]^i[u>>>8&255]^a[255&h]^s[p++],g=n[d>>>24]^r[u>>>16&255]^i[h>>>8&255]^a[255&l]^s[p++],y=n[u>>>24]^r[h>>>16&255]^i[l>>>8&255]^a[255&d]^s[p++],v=n[h>>>24]^r[l>>>16&255]^i[d>>>8&255]^a[255&u]^s[p++];l=f,d=g,u=y,h=v}f=(o[l>>>24]<<24|o[d>>>16&255]<<16|o[u>>>8&255]<<8|o[255&h])^s[p++],g=(o[d>>>24]<<24|o[u>>>16&255]<<16|o[h>>>8&255]<<8|o[255&l])^s[p++],y=(o[u>>>24]<<24|o[h>>>16&255]<<16|o[l>>>8&255]<<8|o[255&d])^s[p++],v=(o[h>>>24]<<24|o[l>>>16&255]<<16|o[d>>>8&255]<<8|o[255&u])^s[p++],e[t]=f,e[t+1]=g,e[t+2]=y,e[t+3]=v},keySize:8});e.AES=s._createHelper(f)}(),t.AES)}()},7950:(e,t,s)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=s(2730)},7962:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.mode.CTR=function(){var e=t.lib.BlockCipherMode.extend(),s=e.Encryptor=e.extend({processBlock:function(e,t){var s=this._cipher,n=s.blockSize,r=this._iv,i=this._counter;r&&(i=this._counter=r.slice(0),this._iv=void 0);var a=i.slice(0);s.encryptBlock(a,0),i[n-1]=i[n-1]+1|0;for(var o=0;o<n;o++)e[t+o]^=a[o]}});return e.Decryptor=s,e}(),t.mode.CTR)}()},8049:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.mode.CTRGladman=function(){var e=t.lib.BlockCipherMode.extend();function s(e){if(255===(e>>24&255)){var t=e>>16&255,s=e>>8&255,n=255&e;255===t?(t=0,255===s?(s=0,255===n?n=0:++n):++s):++t,e=0,e+=t<<16,e+=s<<8,e+=n}else e+=1<<24;return e}function n(e){return 0===(e[0]=s(e[0]))&&(e[1]=s(e[1])),e}var r=e.Encryptor=e.extend({processBlock:function(e,t){var s=this._cipher,r=s.blockSize,i=this._iv,a=this._counter;i&&(a=this._counter=i.slice(0),this._iv=void 0),n(a);var o=a.slice(0);s.encryptBlock(o,0);for(var c=0;c<r;c++)e[t+c]^=o[c]}});return e.Decryptor=r,e}(),t.mode.CTRGladman)}()},8099:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.mode.ECB=function(){var e=t.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e}(),t.mode.ECB)}()},8168:(e,t,s)=>{"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)({}).hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},n.apply(null,arguments)}s.d(t,{A:()=>n})},8211:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2002),s(4220),function(){var e=t,s=e.lib,n=s.Base,r=s.WordArray,i=e.algo,a=i.MD5,o=i.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s,n=this.cfg,i=n.hasher.create(),a=r.create(),o=a.words,c=n.keySize,l=n.iterations;o.length<c;){s&&i.update(s),s=i.update(e).finalize(t),i.reset();for(var d=1;d<l;d++)s=i.finalize(s),i.reset();a.concat(s)}return a.sigBytes=4*c,a}});e.EvpKDF=function(e,t,s){return o.create(s).compute(e,t)}}(),t.EvpKDF)}()},8523:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(){var e=t,s=e.lib.WordArray;function n(e,t,n){for(var r=[],i=0,a=0;a<t;a++)if(a%4){var o=n[e.charCodeAt(a-1)]<<a%4*2|n[e.charCodeAt(a)]>>>6-a%4*2;r[i>>>2]|=o<<24-i%4*8,i++}return s.create(r,i)}e.enc.Base64={stringify:function(e){var t=e.words,s=e.sigBytes,n=this._map;e.clamp();for(var r=[],i=0;i<s;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;o<4&&i+.75*o<s;o++)r.push(n.charAt(a>>>6*(3-o)&63));var c=n.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,s=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<s.length;i++)r[s.charCodeAt(i)]=i}var a=s.charAt(64);if(a){var o=e.indexOf(a);-1!==o&&(t=o)}return n(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64)}()},8853:(e,t,s)=>{"use strict";e.exports=s(7234)},8870:(e,t,s)=>{"use strict";s.d(t,{BH:()=>v,Cp:()=>g,F$:()=>m,G6:()=>w,HN:()=>c,MK:()=>h,Od:()=>f,S$:()=>r,Zw:()=>a,b_:()=>u,gn:()=>o,j3:()=>l,jY:()=>N,lQ:()=>i,nJ:()=>p,vh:()=>d,yy:()=>b});var n=s(8168),r="undefined"===typeof window;function i(){}function a(e,t){return"function"===typeof e?e(t):e}function o(e){return"number"===typeof e&&e>=0&&e!==1/0}function c(e){return Array.isArray(e)?e:[e]}function l(e,t){return Math.max(e+(t||0)-Date.now(),0)}function d(e,t,s){return E(e)?"function"===typeof t?(0,n.A)({},s,{queryKey:e,queryFn:t}):(0,n.A)({},t,{queryKey:e}):e}function u(e,t,s){return E(e)?[(0,n.A)({},t,{queryKey:e}),s]:[e||{},t]}function h(e,t){var s=e.active,n=e.exact,r=e.fetching,i=e.inactive,a=e.predicate,o=e.queryKey,c=e.stale;if(E(o))if(n){if(t.queryHash!==m(o,t.options))return!1}else if(!g(t.queryKey,o))return!1;var l=function(e,t){return!0===e&&!0===t||null==e&&null==t?"all":!1===e&&!1===t?"none":(null!=e?e:!t)?"active":"inactive"}(s,i);if("none"===l)return!1;if("all"!==l){var d=t.isActive();if("active"===l&&!d)return!1;if("inactive"===l&&d)return!1}return("boolean"!==typeof c||t.isStale()===c)&&(("boolean"!==typeof r||t.isFetching()===r)&&!(a&&!a(t)))}function p(e,t){var s=e.exact,n=e.fetching,r=e.predicate,i=e.mutationKey;if(E(i)){if(!t.options.mutationKey)return!1;if(s){if(f(t.options.mutationKey)!==f(i))return!1}else if(!g(t.options.mutationKey,i))return!1}return("boolean"!==typeof n||"loading"===t.state.status===n)&&!(r&&!r(t))}function m(e,t){return((null==t?void 0:t.queryKeyHashFn)||f)(e)}function f(e){var t,s=c(e);return t=s,JSON.stringify(t,function(e,t){return x(t)?Object.keys(t).sort().reduce(function(e,s){return e[s]=t[s],e},{}):t})}function g(e,t){return y(c(e),c(t))}function y(e,t){return e===t||typeof e===typeof t&&(!(!e||!t||"object"!==typeof e||"object"!==typeof t)&&!Object.keys(t).some(function(s){return!y(e[s],t[s])}))}function v(e,t){if(e===t)return e;var s=Array.isArray(e)&&Array.isArray(t);if(s||x(e)&&x(t)){for(var n=s?e.length:Object.keys(e).length,r=s?t:Object.keys(t),i=r.length,a=s?[]:{},o=0,c=0;c<i;c++){var l=s?c:r[c];a[l]=v(e[l],t[l]),a[l]===e[l]&&o++}return n===i&&o===n?e:a}return t}function x(e){if(!_(e))return!1;var t=e.constructor;if("undefined"===typeof t)return!0;var s=t.prototype;return!!_(s)&&!!s.hasOwnProperty("isPrototypeOf")}function _(e){return"[object Object]"===Object.prototype.toString.call(e)}function E(e){return"string"===typeof e||Array.isArray(e)}function b(e){return new Promise(function(t){setTimeout(t,e)})}function w(e){Promise.resolve().then(e).catch(function(e){return setTimeout(function(){throw e})})}function N(){if("function"===typeof AbortController)return new AbortController}},8875:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(8523),s(4199),s(8211),s(2238),function(){var e=t,s=e.lib.StreamCipher,n=e.algo,r=[],i=[],a=[],o=n.Rabbit=s.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,s=0;s<4;s++)e[s]=16711935&(e[s]<<8|e[s]>>>24)|4278255360&(e[s]<<24|e[s]>>>8);var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,s=0;s<4;s++)c.call(this);for(s=0;s<8;s++)r[s]^=n[s+4&7];if(t){var i=t.words,a=i[0],o=i[1],l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=l>>>16|4294901760&d,h=d<<16|65535&l;for(r[0]^=l,r[1]^=u,r[2]^=d,r[3]^=h,r[4]^=l,r[5]^=u,r[6]^=d,r[7]^=h,s=0;s<4;s++)c.call(this)}},_doProcessBlock:function(e,t){var s=this._X;c.call(this),r[0]=s[0]^s[5]>>>16^s[3]<<16,r[1]=s[2]^s[7]>>>16^s[5]<<16,r[2]=s[4]^s[1]>>>16^s[7]<<16,r[3]=s[6]^s[3]>>>16^s[1]<<16;for(var n=0;n<4;n++)r[n]=16711935&(r[n]<<8|r[n]>>>24)|4278255360&(r[n]<<24|r[n]>>>8),e[t+n]^=r[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,s=0;s<8;s++)i[s]=t[s];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,s=0;s<8;s++){var n=e[s]+t[s],r=65535&n,o=n>>>16,c=((r*r>>>17)+r*o>>>15)+o*o,l=((4294901760&n)*n|0)+((65535&n)*n|0);a[s]=c^l}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=s._createHelper(o)}(),t.Rabbit)}()},9092:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(9749),s(7061),function(){var e=t,s=e.x64,n=s.Word,r=s.WordArray,i=e.algo,a=i.SHA512,o=i.SHA384=a.extend({_doReset:function(){this._hash=new r.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=a._createHelper(o),e.HmacSHA384=a._createHmacHelper(o)}(),t.SHA384)}()},9132:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(2238),t.pad.Iso10126={pad:function(e,s){var n=4*s,r=n-e.sigBytes%n;e.concat(t.lib.WordArray.random(r-1)).concat(t.lib.WordArray.create([r<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},t.pad.Iso10126)}()},9475:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(8523),s(4199),s(8211),s(2238),function(){var e=t,s=e.lib,n=s.WordArray,r=s.BlockCipher,i=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=i.DES=r.extend({_doReset:function(){for(var e=this._key.words,t=[],s=0;s<56;s++){var n=a[s]-1;t[s]=e[n>>>5]>>>31-n%32&1}for(var r=this._subKeys=[],i=0;i<16;i++){var l=r[i]=[],d=c[i];for(s=0;s<24;s++)l[s/6|0]|=t[(o[s]-1+d)%28]<<31-s%6,l[4+(s/6|0)]|=t[28+(o[s+24]-1+d)%28]<<31-s%6;for(l[0]=l[0]<<1|l[0]>>>31,s=1;s<7;s++)l[s]=l[s]>>>4*(s-1)+3;l[7]=l[7]<<5|l[7]>>>27}var u=this._invSubKeys=[];for(s=0;s<16;s++)u[s]=r[15-s]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,s){this._lBlock=e[t],this._rBlock=e[t+1],h.call(this,4,252645135),h.call(this,16,65535),p.call(this,2,858993459),p.call(this,8,16711935),h.call(this,1,1431655765);for(var n=0;n<16;n++){for(var r=s[n],i=this._lBlock,a=this._rBlock,o=0,c=0;c<8;c++)o|=l[c][((a^r[c])&d[c])>>>0];this._lBlock=a,this._rBlock=i^o}var u=this._lBlock;this._lBlock=this._rBlock,this._rBlock=u,h.call(this,1,1431655765),p.call(this,8,16711935),p.call(this,2,858993459),h.call(this,16,65535),h.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function h(e,t){var s=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=s,this._lBlock^=s<<e}function p(e,t){var s=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=s,this._rBlock^=s<<e}e.DES=r._createHelper(u);var m=i.TripleDES=r.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),s=e.length<4?e.slice(0,2):e.slice(2,4),r=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=u.createEncryptor(n.create(t)),this._des2=u.createEncryptor(n.create(s)),this._des3=u.createEncryptor(n.create(r))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=r._createHelper(m)}(),t.TripleDES)}()},9638:function(e,t,s){!function(){var t;e.exports=(t=s(4488),s(8523),s(4199),s(8211),s(2238),function(){var e=t,s=e.lib.StreamCipher,n=e.algo,r=n.RC4=s.extend({_doReset:function(){for(var e=this._key,t=e.words,s=e.sigBytes,n=this._S=[],r=0;r<256;r++)n[r]=r;r=0;for(var i=0;r<256;r++){var a=r%s,o=t[a>>>2]>>>24-a%4*8&255;i=(i+n[r]+o)%256;var c=n[r];n[r]=n[i],n[i]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var e=this._S,t=this._i,s=this._j,n=0,r=0;r<4;r++){s=(s+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[s],e[s]=i,n|=e[(e[t]+e[s])%256]<<24-8*r}return this._i=t,this._j=s,n}e.RC4=s._createHelper(r);var a=n.RC4Drop=r.extend({cfg:r.cfg.extend({drop:192}),_doReset:function(){r._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)i.call(this)}});e.RC4Drop=s._createHelper(a)}(),t.RC4)}()},9749:function(e,t,s){!function(){var t;e.exports=(t=s(4488),function(e){var s=t,n=s.lib,r=n.Base,i=n.WordArray,a=s.x64={};a.Word=r.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=r.extend({init:function(t,s){t=this.words=t||[],this.sigBytes=s!=e?s:8*t.length},toX32:function(){for(var e=this.words,t=e.length,s=[],n=0;n<t;n++){var r=e[n];s.push(r.high),s.push(r.low)}return i.create(s,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),s=t.length,n=0;n<s;n++)t[n]=t[n].clone();return e}})}(),t)}()}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,s),i.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;s.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var i=Object.create(null);s.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>n[e]);return a.default=()=>n,s.d(i,a),i}})(),s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t=s(5043),n=s.t(t,2),r=s(4391),i=s(7950),a=s.t(i,2);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const c="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function d(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(s){}}}function u(e,t){return{usr:e.state,key:e.key,idx:t}}function h(e,t,s,n){return void 0===s&&(s=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?m(t):t,{state:s,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:t="/",search:s="",hash:n=""}=e;return s&&"?"!==s&&(t+="?"===s.charAt(0)?s:"?"+s),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function m(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function f(t,s,n,r){void 0===r&&(r={});let{window:i=document.defaultView,v5Compat:a=!1}=r,d=i.history,m=e.Pop,f=null,g=y();function y(){return(d.state||{idx:null}).idx}function v(){m=e.Pop;let t=y(),s=null==t?null:t-g;g=t,f&&f({action:m,location:_.location,delta:s})}function x(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,s="string"===typeof e?e:p(e);return s=s.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+s),new URL(s,t)}null==g&&(g=0,d.replaceState(o({},d.state,{idx:g}),""));let _={get action(){return m},get location(){return t(i,d)},listen(e){if(f)throw new Error("A history only accepts one active listener");return i.addEventListener(c,v),f=e,()=>{i.removeEventListener(c,v),f=null}},createHref:e=>s(i,e),createURL:x,encodeLocation(e){let t=x(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,s){m=e.Push;let r=h(_.location,t,s);n&&n(r,t),g=y()+1;let o=u(r,g),c=_.createHref(r);try{d.pushState(o,"",c)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;i.location.assign(c)}a&&f&&f({action:m,location:_.location,delta:1})},replace:function(t,s){m=e.Replace;let r=h(_.location,t,s);n&&n(r,t),g=y();let i=u(r,g),o=_.createHref(r);d.replaceState(i,"",o),a&&f&&f({action:m,location:_.location,delta:0})},go:e=>d.go(e)};return _}var g;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(e,t,s){return void 0===s&&(s="/"),v(e,t,s,!1)}function v(e,t,s,n){let r=j(("string"===typeof t?m(t):t).pathname||"/",s);if(null==r)return null;let i=x(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let s=e.length===t.length&&e.slice(0,-1).every((e,s)=>e===t[s]);return s?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let a=null;for(let o=0;null==a&&o<i.length;++o){let e=O(r);a=I(i[o],e,n)}return a}function x(e,t,s,n){void 0===t&&(t=[]),void 0===s&&(s=[]),void 0===n&&(n="");let r=(e,r,i)=>{let a={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(l(a.relativePath.startsWith(n),'Absolute route path "'+a.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(n.length));let o=M([n,a.relativePath]),c=s.concat(a);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),x(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:R(o,e.index),routesMeta:c})};return e.forEach((e,t)=>{var s;if(""!==e.path&&null!=(s=e.path)&&s.includes("?"))for(let n of _(e.path))r(e,t,n);else r(e,t)}),t}function _(e){let t=e.split("/");if(0===t.length)return[];let[s,...n]=t,r=s.endsWith("?"),i=s.replace(/\?$/,"");if(0===n.length)return r?[i,""]:[i];let a=_(n.join("/")),o=[];return o.push(...a.map(e=>""===e?i:[i,e].join("/"))),r&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const E=/^:[\w-]+$/,b=3,w=2,N=1,S=10,T=-2,C=e=>"*"===e;function R(e,t){let s=e.split("/"),n=s.length;return s.some(C)&&(n+=T),t&&(n+=w),s.filter(e=>!C(e)).reduce((e,t)=>e+(E.test(t)?b:""===t?N:S),n)}function I(e,t,s){void 0===s&&(s=!1);let{routesMeta:n}=e,r={},i="/",a=[];for(let o=0;o<n.length;++o){let e=n[o],c=o===n.length-1,l="/"===i?t:t.slice(i.length)||"/",d=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),u=e.route;if(!d&&c&&s&&!n[n.length-1].route.index&&(d=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!d)return null;Object.assign(r,d.params),a.push({params:r,pathname:M([i,d.pathname]),pathnameBase:U(M([i,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(i=M([i,d.pathnameBase]))}return a}function A(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[s,n]=function(e,t,s){void 0===t&&(t=!1);void 0===s&&(s=!0);d("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let n=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,s)=>(n.push({paramName:t,isOptional:null!=s}),s?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(n.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let i=new RegExp(r,t?void 0:"i");return[i,n]}(e.path,e.caseSensitive,e.end),r=t.match(s);if(!r)return null;let i=r[0],a=i.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce((e,t,s)=>{let{paramName:n,isOptional:r}=t;if("*"===n){let e=o[s]||"";a=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const c=o[s];return e[n]=r&&!c?void 0:(c||"").replace(/%2F/g,"/"),e},{}),pathname:i,pathnameBase:a,pattern:e}}function O(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return d(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function j(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,n=e.charAt(s);return n&&"/"!==n?null:e.slice(s)||"/"}function k(e,t,s,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+s+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function D(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function P(e,t){let s=D(e);return t?s.map((e,t)=>t===s.length-1?e.pathname:e.pathnameBase):s.map(e=>e.pathnameBase)}function L(e,t,s,n){let r;void 0===n&&(n=!1),"string"===typeof e?r=m(e):(r=o({},e),l(!r.pathname||!r.pathname.includes("?"),k("?","pathname","search",r)),l(!r.pathname||!r.pathname.includes("#"),k("#","pathname","hash",r)),l(!r.search||!r.search.includes("#"),k("#","search","hash",r)));let i,a=""===e||""===r.pathname,c=a?"/":r.pathname;if(null==c)i=s;else{let e=t.length-1;if(!n&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}i=e>=0?t[e]:"/"}let d=function(e,t){void 0===t&&(t="/");let{pathname:s,search:n="",hash:r=""}="string"===typeof e?m(e):e,i=s?s.startsWith("/")?s:function(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?s.length>1&&s.pop():"."!==e&&s.push(e)}),s.length>1?s.join("/"):"/"}(s,t):t;return{pathname:i,search:V(n),hash:F(r)}}(r,i),u=c&&"/"!==c&&c.endsWith("/"),h=(a||"."===c)&&s.endsWith("/");return d.pathname.endsWith("/")||!u&&!h||(d.pathname+="/"),d}const M=e=>e.join("/").replace(/\/\/+/g,"/"),U=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function B(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const G=["post","put","patch","delete"],W=(new Set(G),["get",...G]);new Set(W),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},H.apply(this,arguments)}const K=t.createContext(null);const z=t.createContext(null);const q=t.createContext(null);const Y=t.createContext(null);const X=t.createContext({outlet:null,matches:[],isDataRoute:!1});const J=t.createContext(null);function Q(){return null!=t.useContext(Y)}function Z(){return Q()||l(!1),t.useContext(Y).location}function $(e){t.useContext(q).static||t.useLayoutEffect(e)}function ee(){let{isDataRoute:e}=t.useContext(X);return e?function(){let{router:e}=ue(le.UseNavigateStable),s=pe(de.UseNavigateStable),n=t.useRef(!1);return $(()=>{n.current=!0}),t.useCallback(function(t,r){void 0===r&&(r={}),n.current&&("number"===typeof t?e.navigate(t):e.navigate(t,H({fromRouteId:s},r)))},[e,s])}():function(){Q()||l(!1);let e=t.useContext(K),{basename:s,future:n,navigator:r}=t.useContext(q),{matches:i}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(P(i,n.v7_relativeSplatPath)),c=t.useRef(!1);return $(()=>{c.current=!0}),t.useCallback(function(t,n){if(void 0===n&&(n={}),!c.current)return;if("number"===typeof t)return void r.go(t);let i=L(t,JSON.parse(o),a,"path"===n.relative);null==e&&"/"!==s&&(i.pathname="/"===i.pathname?s:M([s,i.pathname])),(n.replace?r.replace:r.push)(i,n.state,n)},[s,r,o,a,e])}()}const te=t.createContext(null);function se(e,s){let{relative:n}=void 0===s?{}:s,{future:r}=t.useContext(q),{matches:i}=t.useContext(X),{pathname:a}=Z(),o=JSON.stringify(P(i,r.v7_relativeSplatPath));return t.useMemo(()=>L(e,JSON.parse(o),a,"path"===n),[e,o,a,n])}function ne(s,n,r,i){Q()||l(!1);let{navigator:a}=t.useContext(q),{matches:o}=t.useContext(X),c=o[o.length-1],d=c?c.params:{},u=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let h,p=Z();if(n){var f;let e="string"===typeof n?m(n):n;"/"===u||(null==(f=e.pathname)?void 0:f.startsWith(u))||l(!1),h=e}else h=p;let g=h.pathname||"/",v=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");v="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let x=y(s,{pathname:v});let _=ce(x&&x.map(e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:M([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:M([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,r,i);return n&&_?t.createElement(Y.Provider,{value:{location:H({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:e.Pop}},_):_}function re(){let e=function(){var e;let s=t.useContext(J),n=he(de.UseRouteError),r=pe(de.UseRouteError);if(void 0!==s)return s;return null==(e=n.errors)?void 0:e[r]}(),s=B(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},s),n?t.createElement("pre",{style:i},n):null,null)}const ie=t.createElement(re,null);class ae extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(X.Provider,{value:this.props.routeContext},t.createElement(J.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oe(e){let{routeContext:s,match:n,children:r}=e,i=t.useContext(K);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),t.createElement(X.Provider,{value:s},r)}function ce(e,s,n,r){var i;if(void 0===s&&(s=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var a;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(a=r)&&a.v7_partialHydration&&0===s.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let o=e,c=null==(i=n)?void 0:i.errors;if(null!=c){let e=o.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||l(!1),o=o.slice(0,Math.min(o.length,e+1))}let d=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let t=0;t<o.length;t++){let e=o[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:s}=n,r=e.route.loader&&void 0===t[e.route.id]&&(!s||void 0===s[e.route.id]);if(e.route.lazy||r){d=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,r,i)=>{let a,l=!1,h=null,p=null;var m;n&&(a=c&&r.route.id?c[r.route.id]:void 0,h=r.route.errorElement||ie,d&&(u<0&&0===i?(m="route-fallback",!1||me[m]||(me[m]=!0),l=!0,p=null):u===i&&(l=!0,p=r.route.hydrateFallbackElement||null)));let f=s.concat(o.slice(0,i+1)),g=()=>{let s;return s=a?h:l?p:r.route.Component?t.createElement(r.route.Component,null):r.route.element?r.route.element:e,t.createElement(oe,{match:r,routeContext:{outlet:e,matches:f,isDataRoute:null!=n},children:s})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===i)?t.createElement(ae,{location:n.location,revalidation:n.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):g()},null)}var le=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(le||{}),de=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(de||{});function ue(e){let s=t.useContext(K);return s||l(!1),s}function he(e){let s=t.useContext(z);return s||l(!1),s}function pe(e){let s=function(){let e=t.useContext(X);return e||l(!1),e}(),n=s.matches[s.matches.length-1];return n.route.id||l(!1),n.route.id}const me={};n.startTransition;function fe(e){let{to:s,replace:n,state:r,relative:i}=e;Q()||l(!1);let{future:a,static:o}=t.useContext(q),{matches:c}=t.useContext(X),{pathname:d}=Z(),u=ee(),h=L(s,P(c,a.v7_relativeSplatPath),d,"path"===i),p=JSON.stringify(h);return t.useEffect(()=>u(JSON.parse(p),{replace:n,state:r,relative:i}),[u,p,i,n,r]),null}function ge(e){return function(e){let s=t.useContext(X).outlet;return s?t.createElement(te.Provider,{value:e},s):s}(e.context)}function ye(e){l(!1)}function ve(s){let{basename:n="/",children:r=null,location:i,navigationType:a=e.Pop,navigator:o,static:c=!1,future:d}=s;Q()&&l(!1);let u=n.replace(/^\/*/,"/"),h=t.useMemo(()=>({basename:u,navigator:o,static:c,future:H({v7_relativeSplatPath:!1},d)}),[u,d,o,c]);"string"===typeof i&&(i=m(i));let{pathname:p="/",search:f="",hash:g="",state:y=null,key:v="default"}=i,x=t.useMemo(()=>{let e=j(p,u);return null==e?null:{location:{pathname:e,search:f,hash:g,state:y,key:v},navigationType:a}},[u,p,f,g,y,v,a]);return null==x?null:t.createElement(q.Provider,{value:h},t.createElement(Y.Provider,{children:r,value:x}))}function xe(e){let{children:t,location:s}=e;return ne(_e(t),s)}new Promise(()=>{});t.Component;function _e(e,s){void 0===s&&(s=[]);let n=[];return t.Children.forEach(e,(e,r)=>{if(!t.isValidElement(e))return;let i=[...s,r];if(e.type===t.Fragment)return void n.push.apply(n,_e(e.props.children,i));e.type!==ye&&l(!1),e.props.index&&e.props.children&&l(!1);let a={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=_e(e.props.children,i)),n.push(a)}),n}function Ee(){return Ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Ee.apply(this,arguments)}function be(e,t){if(null==e)return{};var s,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)s=i[n],t.indexOf(s)>=0||(r[s]=e[s]);return r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const we=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(V_){}new Map;const Ne=n.startTransition;a.flushSync,n.useId;function Se(e){let{basename:s,children:n,future:r,window:i}=e,a=t.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:i,v5Compat:!0})&&(o={}),f(function(e,t){let{pathname:s,search:n,hash:r}=e.location;return h("",{pathname:s,search:n,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:p(t)},null,o)));let c=a.current,[l,d]=t.useState({action:c.action,location:c.location}),{v7_startTransition:u}=r||{},m=t.useCallback(e=>{u&&Ne?Ne(()=>d(e)):d(e)},[d,u]);return t.useLayoutEffect(()=>c.listen(m),[c,m]),t.createElement(ve,{basename:s,children:n,location:l.location,navigationType:l.action,navigator:c,future:r})}const Te="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Re=t.forwardRef(function(e,s){let n,{onClick:r,relative:i,reloadDocument:a,replace:o,state:c,target:d,to:u,preventScrollReset:h,unstable_viewTransition:m}=e,f=be(e,we),{basename:g}=t.useContext(q),y=!1;if("string"===typeof u&&Ce.test(u)&&(n=u,Te))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),s=j(t.pathname,g);t.origin===e.origin&&null!=s?u=s+t.search+t.hash:y=!0}catch(V_){}let v=function(e,s){let{relative:n}=void 0===s?{}:s;Q()||l(!1);let{basename:r,navigator:i}=t.useContext(q),{hash:a,pathname:o,search:c}=se(e,{relative:n}),d=o;return"/"!==r&&(d="/"===o?r:M([r,o])),i.createHref({pathname:d,search:c,hash:a})}(u,{relative:i}),x=function(e,s){let{target:n,replace:r,state:i,preventScrollReset:a,relative:o,unstable_viewTransition:c}=void 0===s?{}:s,l=ee(),d=Z(),u=se(e,{relative:o});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let s=void 0!==r?r:p(d)===p(u);l(e,{replace:s,state:i,preventScrollReset:a,relative:o,unstable_viewTransition:c})}},[d,l,u,r,i,n,e,a,o,c])}(u,{replace:o,state:c,target:d,preventScrollReset:h,relative:i,unstable_viewTransition:m});return t.createElement("a",Ee({},f,{href:n||v,onClick:y||a?r:function(e){r&&r(e),e.defaultPrevented||x(e)},ref:s,target:d}))});var Ie,Ae;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ie||(Ie={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ae||(Ae={}));var Oe=s(2907);function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function ke(e){var t=function(e,t){if("object"!=je(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==je(t)?t:t+""}function De(e,t,s){return(t=ke(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Pe(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function Le(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(s),!0).forEach(function(t){De(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Pe(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function Me(e,t){if(null==e)return{};var s,n,r=function(e,t){if(null==e)return{};var s={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;s[n]=e[n]}return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)s=i[n],-1===t.indexOf(s)&&{}.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}function Ue(e){var t,s,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(s=Ue(e[t]))&&(n&&(n+=" "),n+=s);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}const Ve=function(){for(var e,t,s=0,n="";s<arguments.length;)(e=arguments[s++])&&(t=Ue(e))&&(n&&(n+=" "),n+=t);return n},Fe=["theme","type"],Be=["delay","staleId"],Ge=e=>"number"==typeof e&&!isNaN(e),We=e=>"string"==typeof e,He=e=>"function"==typeof e,Ke=e=>We(e)||He(e)?e:null,ze=e=>(0,t.isValidElement)(e)||We(e)||He(e)||Ge(e);function qe(e){let{enter:s,exit:n,appendPosition:r=!1,collapse:i=!0,collapseDuration:a=300}=e;return function(e){let{children:o,position:c,preventExitTransition:l,done:d,nodeRef:u,isIn:h}=e;const p=r?"".concat(s,"--").concat(c):s,m=r?"".concat(n,"--").concat(c):n,f=(0,t.useRef)(0);return(0,t.useLayoutEffect)(()=>{const e=u.current,t=p.split(" "),s=n=>{n.target===u.current&&(e.dispatchEvent(new Event("d")),e.removeEventListener("animationend",s),e.removeEventListener("animationcancel",s),0===f.current&&"animationcancel"!==n.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",s),e.addEventListener("animationcancel",s)},[]),(0,t.useEffect)(()=>{const e=u.current,t=()=>{e.removeEventListener("animationend",t),i?function(e,t,s){void 0===s&&(s=300);const{scrollHeight:n,style:r}=e;requestAnimationFrame(()=>{r.minHeight="initial",r.height=n+"px",r.transition="all ".concat(s,"ms"),requestAnimationFrame(()=>{r.height="0",r.padding="0",r.margin="0",setTimeout(t,s)})})}(e,d,a):d()};h||(l?t():(f.current=1,e.className+=" ".concat(m),e.addEventListener("animationend",t)))},[h]),t.createElement(t.Fragment,null,o)}}function Ye(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const Xe={list:new Map,emitQueue:new Map,on(e,t){return this.list.has(e)||this.list.set(e,[]),this.list.get(e).push(t),this},off(e,t){if(t){const s=this.list.get(e).filter(e=>e!==t);return this.list.set(e,s),this}return this.list.delete(e),this},cancelEmit(e){const t=this.emitQueue.get(e);return t&&(t.forEach(clearTimeout),this.emitQueue.delete(e)),this},emit(e){this.list.has(e)&&this.list.get(e).forEach(t=>{const s=setTimeout(()=>{t(...[].slice.call(arguments,1))},0);this.emitQueue.has(e)||this.emitQueue.set(e,[]),this.emitQueue.get(e).push(s)})}},Je=e=>{let{theme:s,type:n}=e,r=Me(e,Fe);return t.createElement("svg",Le({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===s?"currentColor":"var(--toastify-icon-color-".concat(n,")")},r))},Qe={info:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return t.createElement(Je,Le({},e),t.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return t.createElement("div",{className:"Toastify__spinner"})}};function Ze(e){const[,s]=(0,t.useReducer)(e=>e+1,0),[n,r]=(0,t.useState)([]),i=(0,t.useRef)(null),a=(0,t.useRef)(new Map).current,o=e=>-1!==n.indexOf(e),c=(0,t.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:e,containerId:null,isToastActive:o,getToast:e=>a.get(e)}).current;function l(e){let{containerId:t}=e;const{limit:s}=c.props;!s||t&&c.containerId!==t||(c.count-=c.queue.length,c.queue=[])}function d(e){r(t=>null==e?[]:t.filter(t=>t!==e))}function u(){const{toastContent:e,toastProps:t,staleId:s}=c.queue.shift();p(e,t,s)}function h(e,n){let{delay:r,staleId:o}=n,l=Me(n,Be);if(!ze(e)||function(e){return!i.current||c.props.enableMultiContainer&&e.containerId!==c.props.containerId||a.has(e.toastId)&&null==e.updateId}(l))return;const{toastId:h,updateId:m,data:f}=l,{props:g}=c,y=()=>d(h),v=null==m;v&&c.count++;const x=Le(Le(Le({},g),{},{style:g.toastStyle,key:c.toastKey++},Object.fromEntries(Object.entries(l).filter(e=>{let[t,s]=e;return null!=s}))),{},{toastId:h,updateId:m,data:f,closeToast:y,isIn:!1,className:Ke(l.className||g.toastClassName),bodyClassName:Ke(l.bodyClassName||g.bodyClassName),progressClassName:Ke(l.progressClassName||g.progressClassName),autoClose:!l.isLoading&&(_=l.autoClose,E=g.autoClose,!1===_||Ge(_)&&_>0?_:E),deleteToast(){const e=Ye(a.get(h),"removed");a.delete(h),Xe.emit(4,e);const t=c.queue.length;if(c.count=null==h?c.count-c.displayedToast:c.count-1,c.count<0&&(c.count=0),t>0){const e=null==h?c.props.limit:1;if(1===t||1===e)c.displayedToast++,u();else{const s=e>t?t:e;c.displayedToast=s;for(let e=0;e<s;e++)u()}}else s()}});var _,E;x.iconOut=function(e){let{theme:s,type:n,isLoading:r,icon:i}=e,a=null;const o={theme:s,type:n};return!1===i||(He(i)?a=i(o):(0,t.isValidElement)(i)?a=(0,t.cloneElement)(i,o):We(i)||Ge(i)?a=i:r?a=Qe.spinner():(e=>e in Qe)(n)&&(a=Qe[n](o))),a}(x),He(l.onOpen)&&(x.onOpen=l.onOpen),He(l.onClose)&&(x.onClose=l.onClose),x.closeButton=g.closeButton,!1===l.closeButton||ze(l.closeButton)?x.closeButton=l.closeButton:!0===l.closeButton&&(x.closeButton=!ze(g.closeButton)||g.closeButton);let b=e;(0,t.isValidElement)(e)&&!We(e.type)?b=(0,t.cloneElement)(e,{closeToast:y,toastProps:x,data:f}):He(e)&&(b=e({closeToast:y,toastProps:x,data:f})),g.limit&&g.limit>0&&c.count>g.limit&&v?c.queue.push({toastContent:b,toastProps:x,staleId:o}):Ge(r)?setTimeout(()=>{p(b,x,o)},r):p(b,x,o)}function p(e,t,s){const{toastId:n}=t;s&&a.delete(s);const i={content:e,props:t};a.set(n,i),r(e=>[...e,n].filter(e=>e!==s)),Xe.emit(4,Ye(i,null==i.props.updateId?"added":"updated"))}return(0,t.useEffect)(()=>(c.containerId=e.containerId,Xe.cancelEmit(3).on(0,h).on(1,e=>i.current&&d(e)).on(5,l).emit(2,c),()=>{a.clear(),Xe.emit(3,c)}),[]),(0,t.useEffect)(()=>{c.props=e,c.isToastActive=o,c.displayedToast=n.length}),{getToastToRender:function(t){const s=new Map,n=Array.from(a.values());return e.newestOnTop&&n.reverse(),n.forEach(e=>{const{position:t}=e.props;s.has(t)||s.set(t,[]),s.get(t).push(e)}),Array.from(s,e=>t(e[0],e[1]))},containerRef:i,isToastActive:o}}function $e(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientX:e.clientX}function et(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientY:e.clientY}function tt(e){const[s,n]=(0,t.useState)(!1),[r,i]=(0,t.useState)(!1),a=(0,t.useRef)(null),o=(0,t.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,c=(0,t.useRef)(e),{autoClose:l,pauseOnHover:d,closeToast:u,onClick:h,closeOnClick:p}=e;function m(t){if(e.draggable){"touchstart"===t.nativeEvent.type&&t.nativeEvent.preventDefault(),o.didMove=!1,document.addEventListener("mousemove",v),document.addEventListener("mouseup",x),document.addEventListener("touchmove",v),document.addEventListener("touchend",x);const s=a.current;o.canCloseOnClick=!0,o.canDrag=!0,o.boundingRect=s.getBoundingClientRect(),s.style.transition="",o.x=$e(t.nativeEvent),o.y=et(t.nativeEvent),"x"===e.draggableDirection?(o.start=o.x,o.removalDistance=s.offsetWidth*(e.draggablePercent/100)):(o.start=o.y,o.removalDistance=s.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent/100))}}function f(t){if(o.boundingRect){const{top:s,bottom:n,left:r,right:i}=o.boundingRect;"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&o.x>=r&&o.x<=i&&o.y>=s&&o.y<=n?y():g()}}function g(){n(!0)}function y(){n(!1)}function v(t){const n=a.current;o.canDrag&&n&&(o.didMove=!0,s&&y(),o.x=$e(t),o.y=et(t),o.delta="x"===e.draggableDirection?o.x-o.start:o.y-o.start,o.start!==o.x&&(o.canCloseOnClick=!1),n.style.transform="translate".concat(e.draggableDirection,"(").concat(o.delta,"px)"),n.style.opacity=""+(1-Math.abs(o.delta/o.removalDistance)))}function x(){document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",x),document.removeEventListener("touchmove",v),document.removeEventListener("touchend",x);const t=a.current;if(o.canDrag&&o.didMove&&t){if(o.canDrag=!1,Math.abs(o.delta)>o.removalDistance)return i(!0),void e.closeToast();t.style.transition="transform 0.2s, opacity 0.2s",t.style.transform="translate".concat(e.draggableDirection,"(0)"),t.style.opacity="1"}}(0,t.useEffect)(()=>{c.current=e}),(0,t.useEffect)(()=>(a.current&&a.current.addEventListener("d",g,{once:!0}),He(e.onOpen)&&e.onOpen((0,t.isValidElement)(e.children)&&e.children.props),()=>{const e=c.current;He(e.onClose)&&e.onClose((0,t.isValidElement)(e.children)&&e.children.props)}),[]),(0,t.useEffect)(()=>(e.pauseOnFocusLoss&&(document.hasFocus()||y(),window.addEventListener("focus",g),window.addEventListener("blur",y)),()=>{e.pauseOnFocusLoss&&(window.removeEventListener("focus",g),window.removeEventListener("blur",y))}),[e.pauseOnFocusLoss]);const _={onMouseDown:m,onTouchStart:m,onMouseUp:f,onTouchEnd:f};return l&&d&&(_.onMouseEnter=y,_.onMouseLeave=g),p&&(_.onClick=e=>{h&&h(e),o.canCloseOnClick&&u()}),{playToast:g,pauseToast:y,isRunning:s,preventExitTransition:r,toastRef:a,eventHandlers:_}}function st(e){let{closeToast:s,theme:n,ariaLabel:r="close"}=e;return t.createElement("button",{className:"Toastify__close-button Toastify__close-button--".concat(n),type:"button",onClick:e=>{e.stopPropagation(),s(e)},"aria-label":r},t.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},t.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function nt(e){let{delay:s,isRunning:n,closeToast:r,type:i="default",hide:a,className:o,style:c,controlledProgress:l,progress:d,rtl:u,isIn:h,theme:p}=e;const m=a||l&&0===d,f=Le(Le({},c),{},{animationDuration:"".concat(s,"ms"),animationPlayState:n?"running":"paused",opacity:m?0:1});l&&(f.transform="scaleX(".concat(d,")"));const g=Ve("Toastify__progress-bar",l?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated","Toastify__progress-bar-theme--".concat(p),"Toastify__progress-bar--".concat(i),{"Toastify__progress-bar--rtl":u}),y=He(o)?o({rtl:u,type:i,defaultClassName:g}):Ve(g,o);return t.createElement("div",{role:"progressbar","aria-hidden":m?"true":"false","aria-label":"notification timer",className:y,style:f,[l&&d>=1?"onTransitionEnd":"onAnimationEnd"]:l&&d<1?null:()=>{h&&r()}})}const rt=e=>{const{isRunning:s,preventExitTransition:n,toastRef:r,eventHandlers:i}=tt(e),{closeButton:a,children:o,autoClose:c,onClick:l,type:d,hideProgressBar:u,closeToast:h,transition:p,position:m,className:f,style:g,bodyClassName:y,bodyStyle:v,progressClassName:x,progressStyle:_,updateId:E,role:b,progress:w,rtl:N,toastId:S,deleteToast:T,isIn:C,isLoading:R,iconOut:I,closeOnClick:A,theme:O}=e,j=Ve("Toastify__toast","Toastify__toast-theme--".concat(O),"Toastify__toast--".concat(d),{"Toastify__toast--rtl":N},{"Toastify__toast--close-on-click":A}),k=He(f)?f({rtl:N,position:m,type:d,defaultClassName:j}):Ve(j,f),D=!!w||!c,P={closeToast:h,type:d,theme:O};let L=null;return!1===a||(L=He(a)?a(P):(0,t.isValidElement)(a)?(0,t.cloneElement)(a,P):st(P)),t.createElement(p,{isIn:C,done:T,position:m,preventExitTransition:n,nodeRef:r},t.createElement("div",Le(Le({id:S,onClick:l,className:k},i),{},{style:g,ref:r}),t.createElement("div",Le(Le({},C&&{role:b}),{},{className:He(y)?y({type:d}):Ve("Toastify__toast-body",y),style:v}),null!=I&&t.createElement("div",{className:Ve("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!R})},I),t.createElement("div",null,o)),L,t.createElement(nt,Le(Le({},E&&!D?{key:"pb-".concat(E)}:{}),{},{rtl:N,theme:O,delay:c,isRunning:s,isIn:C,closeToast:h,hide:u,type:d,style:_,className:x,controlledProgress:D,progress:w||0}))))},it=function(e,t){return void 0===t&&(t=!1),{enter:"Toastify--animate Toastify__".concat(e,"-enter"),exit:"Toastify--animate Toastify__".concat(e,"-exit"),appendPosition:t}},at=qe(it("bounce",!0)),ot=(qe(it("slide",!0)),qe(it("zoom")),qe(it("flip")),(0,t.forwardRef)((e,s)=>{const{getToastToRender:n,containerRef:r,isToastActive:i}=Ze(e),{className:a,style:o,rtl:c,containerId:l}=e;function d(e){const t=Ve("Toastify__toast-container","Toastify__toast-container--".concat(e),{"Toastify__toast-container--rtl":c});return He(a)?a({position:e,rtl:c,defaultClassName:t}):Ve(t,Ke(a))}return(0,t.useEffect)(()=>{s&&(s.current=r.current)},[]),t.createElement("div",{ref:r,className:"Toastify",id:l},n((e,s)=>{const n=s.length?Le({},o):Le(Le({},o),{},{pointerEvents:"none"});return t.createElement("div",{className:d(e),style:n,key:"container-".concat(e)},s.map((e,n)=>{let{content:r,props:a}=e;return t.createElement(rt,Le(Le({},a),{},{isIn:i(a.toastId),style:Le(Le({},a.style),{},{"--nth":n+1,"--len":s.length}),key:"toast-".concat(a.key)}),r)}))}))}));ot.displayName="ToastContainer",ot.defaultProps={position:"top-right",transition:at,autoClose:5e3,closeButton:st,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let ct,lt=new Map,dt=[],ut=1;function ht(){return""+ut++}function pt(e){return e&&(We(e.toastId)||Ge(e.toastId))?e.toastId:ht()}function mt(e,t){return lt.size>0?Xe.emit(0,e,t):dt.push({content:e,options:t}),t.toastId}function ft(e,t){return Le(Le({},t),{},{type:t&&t.type||e,toastId:pt(t)})}function gt(e){return(t,s)=>mt(t,ft(e,s))}function yt(e,t){return mt(e,ft("default",t))}yt.loading=(e,t)=>mt(e,ft("default",Le({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},t))),yt.promise=function(e,t,s){let n,{pending:r,error:i,success:a}=t;r&&(n=We(r)?yt.loading(r,s):yt.loading(r.render,Le(Le({},s),r)));const o={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(e,t,r)=>{if(null==t)return void yt.dismiss(n);const i=Le(Le(Le({type:e},o),s),{},{data:r}),a=We(t)?{render:t}:t;return n?yt.update(n,Le(Le({},i),a)):yt(a.render,Le(Le({},i),a)),r},l=He(e)?e():e;return l.then(e=>c("success",a,e)).catch(e=>c("error",i,e)),l},yt.success=gt("success"),yt.info=gt("info"),yt.error=gt("error"),yt.warning=gt("warning"),yt.warn=yt.warning,yt.dark=(e,t)=>mt(e,ft("default",Le({theme:"dark"},t))),yt.dismiss=e=>{lt.size>0?Xe.emit(1,e):dt=dt.filter(t=>null!=e&&t.options.toastId!==e)},yt.clearWaitingQueue=function(e){return void 0===e&&(e={}),Xe.emit(5,e)},yt.isActive=e=>{let t=!1;return lt.forEach(s=>{s.isToastActive&&s.isToastActive(e)&&(t=!0)}),t},yt.update=function(e,t){void 0===t&&(t={}),setTimeout(()=>{const s=function(e,t){let{containerId:s}=t;const n=lt.get(s||ct);return n&&n.getToast(e)}(e,t);if(s){const{props:n,content:r}=s,i=Le(Le(Le({delay:100},n),t),{},{toastId:t.toastId||e,updateId:ht()});i.toastId!==e&&(i.staleId=e);const a=i.render||r;delete i.render,mt(a,i)}},0)},yt.done=e=>{yt.update(e,{progress:1})},yt.onChange=e=>(Xe.on(4,e),()=>{Xe.off(4,e)}),yt.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},yt.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},Xe.on(2,e=>{ct=e.containerId||e,lt.set(ct,e),dt.forEach(e=>{Xe.emit(0,e.content,e.options)}),dt=[]}).on(3,e=>{lt.delete(e.containerId||e),0===lt.size&&Xe.off(0).off(1).off(5)});const vt=function(e){const t=[];let s=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t[s++]=r:r<2048?(t[s++]=r>>6|192,t[s++]=63&r|128):55296===(64512&r)&&n+1<e.length&&56320===(64512&e.charCodeAt(n+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++n)),t[s++]=r>>18|240,t[s++]=r>>12&63|128,t[s++]=r>>6&63|128,t[s++]=63&r|128):(t[s++]=r>>12|224,t[s++]=r>>6&63|128,t[s++]=63&r|128)}return t},xt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<e.length;r+=3){const t=e[r],i=r+1<e.length,a=i?e[r+1]:0,o=r+2<e.length,c=o?e[r+2]:0,l=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|c>>6,h=63&c;o||(h=64,i||(u=64)),n.push(s[l],s[d],s[u],s[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(vt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let s=0,n=0;for(;s<e.length;){const r=e[s++];if(r<128)t[n++]=String.fromCharCode(r);else if(r>191&&r<224){const i=e[s++];t[n++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&e[s++])<<12|(63&e[s++])<<6|63&e[s++])-65536;t[n++]=String.fromCharCode(55296+(i>>10)),t[n++]=String.fromCharCode(56320+(1023&i))}else{const i=e[s++],a=e[s++];t[n++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<e.length;){const t=s[e.charAt(r++)],i=r<e.length?s[e.charAt(r)]:0;++r;const a=r<e.length?s[e.charAt(r)]:64;++r;const o=r<e.length?s[e.charAt(r)]:64;if(++r,null==t||null==i||null==a||null==o)throw new _t;const c=t<<2|i>>4;if(n.push(c),64!==a){const e=i<<4&240|a>>2;if(n.push(e),64!==o){const e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class _t extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Et=function(e){return function(e){const t=vt(e);return xt.encodeByteArray(t,!0)}(e).replace(/\./g,"")},bt=function(e){try{return xt.decodeString(e,!0)}catch(V_){console.error("base64Decode failed: ",V_)}return null};const wt=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof s.g)return s.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Nt=()=>{try{return wt()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(V_){return}const t=e&&bt(e[1]);return t&&JSON.parse(t)})()}catch(V_){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(V_))}},St=e=>{var t,s;return null===(s=null===(t=Nt())||void 0===t?void 0:t.emulatorHosts)||void 0===s?void 0:s[e]},Tt=e=>{const t=St(e);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const n=parseInt(t.substring(s+1),10);return"["===t[0]?[t.substring(1,s-1),n]:[t.substring(0,s),n]},Ct=()=>{var e;return null===(e=Nt())||void 0===e?void 0:e.config},Rt=e=>{var t;return null===(t=Nt())||void 0===t?void 0:t["_".concat(e)]};class It{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,s))}}}function At(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Ot(){return!function(){var e;const t=null===(e=Nt())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(s.g.process)}catch(V_){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jt(){try{return"object"===typeof indexedDB}catch(V_){return!1}}class kt extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name="FirebaseError",Object.setPrototypeOf(this,kt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Dt.prototype.create)}}class Dt{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},s="".concat(this.service,"/").concat(e),n=this.errors[e],r=n?function(e,t){return e.replace(Pt,(e,s)=>{const n=t[s];return null!=n?String(n):"<".concat(s,"?>")})}(n,t):"Error",i="".concat(this.serviceName,": ").concat(r," (").concat(s,").");return new kt(s,i,t)}}const Pt=/\{\$([^}]+)}/g;function Lt(e,t){if(e===t)return!0;const s=Object.keys(e),n=Object.keys(t);for(const r of s){if(!n.includes(r))return!1;const s=e[r],i=t[r];if(Mt(s)&&Mt(i)){if(!Lt(s,i))return!1}else if(s!==i)return!1}for(const r of n)if(!s.includes(r))return!1;return!0}function Mt(e){return null!==e&&"object"===typeof e}function Ut(e){const t=[];for(const[s,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function Vt(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[s,n]=e.split("=");t[decodeURIComponent(s)]=decodeURIComponent(n)}}),t}function Ft(e){const t=e.indexOf("?");if(!t)return"";const s=e.indexOf("#",t);return e.substring(t,s>0?s:void 0)}class Bt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let n;if(void 0===e&&void 0===t&&void 0===s)throw new Error("Missing Observer.");n=function(e,t){if("object"!==typeof e||null===e)return!1;for(const s of t)if(s in e&&"function"===typeof e[s])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:s},void 0===n.next&&(n.next=Gt),void 0===n.error&&(n.error=Gt),void 0===n.complete&&(n.complete=Gt);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(V_){}}),this.observers.push(n),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(V_){"undefined"!==typeof console&&console.error&&console.error(V_)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Gt(){}function Wt(e){return e&&e._delegate?e._delegate:e}class Ht{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Kt="[DEFAULT]";class zt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new It;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&e.resolve(s)}catch(V_){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),n=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(s)&&!this.shouldAutoInitialize()){if(n)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:s})}catch(V_){if(n)return null;throw V_}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Kt})}catch(V_){}for(const[e,t]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:s});t.resolve(e)}catch(V_){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error("".concat(this.name,"(").concat(s,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const n=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,i]of this.instancesDeferred.entries()){s===this.normalizeInstanceIdentifier(r)&&i.resolve(n)}return n}onInit(e,t){var s;const n=this.normalizeInstanceIdentifier(t),r=null!==(s=this.onInitCallbacks.get(n))&&void 0!==s?s:new Set;r.add(e),this.onInitCallbacks.set(n,r);const i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch(n){}}getOrInitializeService(e){let{instanceIdentifier:t,options:s={}}=e,n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===Kt?void 0:r),options:s}),this.instances.set(t,n),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(i){}var r;return n||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;return this.component?this.component.multipleInstances?e:Kt:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class qt{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new zt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Yt=[];var Xt;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Xt||(Xt={}));const Jt={debug:Xt.DEBUG,verbose:Xt.VERBOSE,info:Xt.INFO,warn:Xt.WARN,error:Xt.ERROR,silent:Xt.SILENT},Qt=Xt.INFO,Zt={[Xt.DEBUG]:"log",[Xt.VERBOSE]:"log",[Xt.INFO]:"info",[Xt.WARN]:"warn",[Xt.ERROR]:"error"},$t=function(e,t){if(t<e.logLevel)return;const s=(new Date).toISOString(),n=Zt[t];if(!n)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];console[n]("[".concat(s,"]  ").concat(e.name,":"),...i)};class es{constructor(e){this.name=e,this._logLevel=Qt,this._logHandler=$t,this._userLogHandler=null,Yt.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Xt))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?Jt[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._userLogHandler&&this._userLogHandler(this,Xt.DEBUG,...t),this._logHandler(this,Xt.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._userLogHandler&&this._userLogHandler(this,Xt.VERBOSE,...t),this._logHandler(this,Xt.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._userLogHandler&&this._userLogHandler(this,Xt.INFO,...t),this._logHandler(this,Xt.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._userLogHandler&&this._userLogHandler(this,Xt.WARN,...t),this._logHandler(this,Xt.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this._userLogHandler&&this._userLogHandler(this,Xt.ERROR,...t),this._logHandler(this,Xt.ERROR,...t)}}let ts,ss;const ns=new WeakMap,rs=new WeakMap,is=new WeakMap,as=new WeakMap,os=new WeakMap;let cs={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return rs.get(e);if("objectStoreNames"===t)return e.objectStoreNames||is.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return us(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ls(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ss||(ss=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return e.apply(hs(this),s),us(ns.get(this))}:function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return us(e.apply(hs(this),s))}:function(t){for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];const i=e.call(hs(this),t,...n);return is.set(i,t.sort?t.sort():[t]),us(i)}}function ds(e){return"function"===typeof e?ls(e):(e instanceof IDBTransaction&&function(e){if(rs.has(e))return;const t=new Promise((t,s)=>{const n=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),n()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)});rs.set(e,t)}(e),t=e,(ts||(ts=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,cs):e);var t}function us(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,s)=>{const n=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(us(e.result)),n()},i=()=>{s(e.error),n()};e.addEventListener("success",r),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&ns.set(t,e)}).catch(()=>{}),os.set(t,e),t}(e);if(as.has(e))return as.get(e);const t=ds(e);return t!==e&&(as.set(e,t),os.set(t,e)),t}const hs=e=>os.get(e);const ps=["get","getKey","getAll","getAllKeys","count"],ms=["put","add","delete","clear"],fs=new Map;function gs(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(fs.get(t))return fs.get(t);const s=t.replace(/FromIndex$/,""),n=t!==s,r=ms.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!ps.includes(s))return;const i=async function(e){const t=this.transaction(e,r?"readwrite":"readonly");let i=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=arguments[c];return n&&(i=i.index(o.shift())),(await Promise.all([i[s](...o),r&&t.done]))[0]};return fs.set(t,i),i}cs=(e=>Le(Le({},e),{},{get:(t,s,n)=>gs(t,s)||e.get(t,s,n),has:(t,s)=>!!gs(t,s)||e.has(t,s)}))(cs);class ys{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const vs="@firebase/app",xs="0.10.5",_s=new es("@firebase/app"),Es="@firebase/app-compat",bs="@firebase/analytics-compat",ws="@firebase/analytics",Ns="@firebase/app-check-compat",Ss="@firebase/app-check",Ts="@firebase/auth",Cs="@firebase/auth-compat",Rs="@firebase/database",Is="@firebase/database-compat",As="@firebase/functions",Os="@firebase/functions-compat",js="@firebase/installations",ks="@firebase/installations-compat",Ds="@firebase/messaging",Ps="@firebase/messaging-compat",Ls="@firebase/performance",Ms="@firebase/performance-compat",Us="@firebase/remote-config",Vs="@firebase/remote-config-compat",Fs="@firebase/storage",Bs="@firebase/storage-compat",Gs="@firebase/firestore",Ws="@firebase/vertexai-preview",Hs="@firebase/firestore-compat",Ks="firebase",zs="[DEFAULT]",qs={[vs]:"fire-core",[Es]:"fire-core-compat",[ws]:"fire-analytics",[bs]:"fire-analytics-compat",[Ss]:"fire-app-check",[Ns]:"fire-app-check-compat",[Ts]:"fire-auth",[Cs]:"fire-auth-compat",[Rs]:"fire-rtdb",[Is]:"fire-rtdb-compat",[As]:"fire-fn",[Os]:"fire-fn-compat",[js]:"fire-iid",[ks]:"fire-iid-compat",[Ds]:"fire-fcm",[Ps]:"fire-fcm-compat",[Ls]:"fire-perf",[Ms]:"fire-perf-compat",[Us]:"fire-rc",[Vs]:"fire-rc-compat",[Fs]:"fire-gcs",[Bs]:"fire-gcs-compat",[Gs]:"fire-fst",[Hs]:"fire-fst-compat",[Ws]:"fire-vertex","fire-js":"fire-js",[Ks]:"fire-js-all"},Ys=new Map,Xs=new Map,Js=new Map;function Qs(e,t){try{e.container.addComponent(t)}catch(V_){_s.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),V_)}}function Zs(e){const t=e.name;if(Js.has(t))return _s.debug("There were multiple attempts to register component ".concat(t,".")),!1;Js.set(t,e);for(const s of Ys.values())Qs(s,e);for(const s of Xs.values())Qs(s,e);return!0}function $s(e,t){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(t)}function en(e){return void 0!==e.settings}const tn=new Dt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class sn{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Ht("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tn.create("app-deleted",{appName:this._name})}}const nn="10.12.2";function rn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e;if("object"!==typeof t){t={name:t}}const n=Object.assign({name:zs,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!==typeof r||!r)throw tn.create("bad-app-name",{appName:String(r)});if(s||(s=Ct()),!s)throw tn.create("no-options");const i=Ys.get(r);if(i){if(Lt(s,i.options)&&Lt(n,i.config))return i;throw tn.create("duplicate-app",{appName:r})}const a=new qt(r);for(const c of Js.values())a.addComponent(c);const o=new sn(s,n,a);return Ys.set(r,o),o}function an(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zs;const t=Ys.get(e);if(!t&&e===zs&&Ct())return rn();if(!t)throw tn.create("no-app",{appName:e});return t}function on(e,t,s){var n;let r=null!==(n=qs[e])&&void 0!==n?n:e;s&&(r+="-".concat(s));const i=r.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=['Unable to register library "'.concat(r,'" with version "').concat(t,'":')];return i&&e.push('library name "'.concat(r,'" contains illegal characters (whitespace or "/")')),i&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void _s.warn(e.join(" "))}Zs(new Ht("".concat(r,"-version"),()=>({library:r,version:t}),"VERSION"))}const cn="firebase-heartbeat-store";let ln=null;function dn(){return ln||(ln=function(e,t){let{blocked:s,upgrade:n,blocking:r,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=us(a);return n&&a.addEventListener("upgradeneeded",e=>{n(us(a.result),e.oldVersion,e.newVersion,us(a.transaction),e)}),s&&a.addEventListener("blocked",e=>s(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(cn)}catch(V_){console.warn(V_)}}}).catch(e=>{throw tn.create("idb-open",{originalErrorMessage:e.message})})),ln}async function un(e,t){try{const s=(await dn()).transaction(cn,"readwrite"),n=s.objectStore(cn);await n.put(t,hn(e)),await s.done}catch(V_){if(V_ instanceof kt)_s.warn(V_.message);else{const t=tn.create("idb-set",{originalErrorMessage:null===V_||void 0===V_?void 0:V_.message});_s.warn(t.message)}}}function hn(e){return"".concat(e.name,"!").concat(e.options.appId)}class pn{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new fn(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=mn();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=mn(),{heartbeatsToSend:s,unsentEntries:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const s=[];let n=e.slice();for(const r of e){const e=s.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),gn(s)>t){e.dates.pop();break}}else if(s.push({agent:r.agent,dates:[r.date]}),gn(s)>t){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}(this._heartbeatsCache.heartbeats),r=Et(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function mn(){return(new Date).toISOString().substring(0,10)}class fn{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!jt()&&new Promise((e,t)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),s||self.indexedDB.deleteDatabase(n),e(!0)},r.onupgradeneeded=()=>{s=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(s){t(s)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await dn()).transaction(cn),s=await t.objectStore(cn).get(hn(e));return await t.done,s}catch(V_){if(V_ instanceof kt)_s.warn(V_.message);else{const t=tn.create("idb-get",{originalErrorMessage:null===V_||void 0===V_?void 0:V_.message});_s.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return un(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return un(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}}}function gn(e){return Et(JSON.stringify({version:2,heartbeats:e})).length}var yn;yn="",Zs(new Ht("platform-logger",e=>new ys(e),"PRIVATE")),Zs(new Ht("heartbeat",e=>new pn(e),"PRIVATE")),on(vs,xs,yn),on(vs,xs,"esm2017"),on("fire-js","");function vn(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(s[n[r]]=e[n[r]])}return s}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function xn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const _n=xn,En=new Dt("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),bn=new es("@firebase/auth");function wn(e){if(bn.logLevel<=Xt.ERROR){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];bn.error("Auth (".concat(nn,"): ").concat(e),...s)}}function Nn(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];throw Rn(e,...s)}function Sn(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return Rn(e,...s)}function Tn(e,t,s){const n=Object.assign(Object.assign({},_n()),{[t]:s});return new Dt("auth","Firebase",n).create(t,{appName:e.name})}function Cn(e){return Tn(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Rn(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];if("string"!==typeof e){const t=s[0],n=[...s.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(t,...n)}return En.create(e,...s)}function In(e,t){if(!e){for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];throw Rn(t,...n)}}function An(e){const t="INTERNAL ASSERTION FAILED: "+e;throw wn(t),new Error(t)}function On(e,t){e||An(t)}function jn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function kn(){return"http:"===Dn()||"https:"===Dn()}function Dn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Pn(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(kn()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Ln{constructor(e,t){this.shortDelay=e,this.longDelay=t,On(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(At())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return Pn()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Mn(e,t){On(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return t?"".concat(s).concat(t.startsWith("/")?t.slice(1):t):s}class Un{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void An("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void An("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void An("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Vn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Fn=new Ln(3e4,6e4);function Bn(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Gn(e,t,s,n){return Wn(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let r={},i={};n&&("GET"===t?i=n:r={body:JSON.stringify(n)});const a=Ut(Object.assign({key:e.config.apiKey},i)).slice(1),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode),Un.fetch()(Kn(e,e.config.apiHost,s,a),Object.assign({method:t,headers:o,referrerPolicy:"no-referrer"},r))})}async function Wn(e,t,s){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},Vn),t);try{const t=new qn(e),r=await Promise.race([s(),t.promise]);t.clearNetworkTimeout();const i=await r.json();if("needConfirmation"in i)throw Yn(e,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const t=r.ok?i.errorMessage:i.error.message,[s,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===s)throw Yn(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===s)throw Yn(e,"email-already-in-use",i);if("USER_DISABLED"===s)throw Yn(e,"user-disabled",i);const o=n[s]||s.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw Tn(e,o,a);Nn(e,o)}}catch(V_){if(V_ instanceof kt)throw V_;Nn(e,"network-request-failed",{message:String(V_)})}}async function Hn(e,t,s,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i=await Gn(e,t,s,n,r);return"mfaPendingCredential"in i&&Nn(e,"multi-factor-auth-required",{_serverResponse:i}),i}function Kn(e,t,s,n){const r="".concat(t).concat(s,"?").concat(n);return e.config.emulator?Mn(e.config,r):"".concat(e.config.apiScheme,"://").concat(r)}function zn(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qn{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Sn(this.auth,"network-request-failed")),Fn.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Yn(e,t,s){const n={appName:e.name};s.email&&(n.email=s.email),s.phoneNumber&&(n.phoneNumber=s.phoneNumber);const r=Sn(e,t,n);return r.customData._tokenResponse=s,r}function Xn(e){return void 0!==e&&void 0!==e.getResponse}function Jn(e){return void 0!==e&&void 0!==e.enterprise}class Qn{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return zn(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Zn(e,t){return Gn(e,"GET","/v2/recaptchaConfig",Bn(e,t))}async function $n(e,t){return Gn(e,"POST","/v1/accounts:lookup",t)}function er(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(V_){}}function tr(e){return 1e3*Number(e)}function sr(e){const[t,s,n]=e.split(".");if(void 0===t||void 0===s||void 0===n)return wn("JWT malformed, contained fewer than 3 sections"),null;try{const e=bt(s);return e?JSON.parse(e):(wn("Failed to decode base64 JWT payload"),null)}catch(V_){return wn("Caught error parsing JWT payload as JSON",null===V_||void 0===V_?void 0:V_.toString()),null}}function nr(e){const t=sr(e);return In(t,"internal-error"),In("undefined"!==typeof t.exp,"internal-error"),In("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function rr(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(V_){throw V_ instanceof kt&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(V_)&&e.auth.currentUser===e&&await e.auth.signOut(),V_}}class ir{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(V_){return void((null===V_||void 0===V_?void 0:V_.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class ar{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=er(this.lastLoginAt),this.creationTime=er(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function or(e){var t;const s=e.auth,n=await e.getIdToken(),r=await rr(e,$n(s,{idToken:n}));In(null===r||void 0===r?void 0:r.users.length,s,"internal-error");const i=r.users[0];e._notifyReloadListener(i);const a=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?cr(i.providerUserInfo):[],o=(c=e.providerData,l=a,[...c.filter(e=>!l.some(t=>t.providerId===e.providerId)),...l]);var c,l;const d=e.isAnonymous,u=!(e.email&&i.passwordHash)&&!(null===o||void 0===o?void 0:o.length),h=!!d&&u,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new ar(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(e,p)}function cr(e){return e.map(e=>{var{providerId:t}=e,s=vn(e,["providerId"]);return{providerId:t,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}class lr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){In(e.idToken,"internal-error"),In("undefined"!==typeof e.idToken,"internal-error"),In("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):nr(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){In(0!==e.length,"internal-error");const t=nr(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(In(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:n,expiresIn:r}=await async function(e,t){const s=await Wn(e,{},async()=>{const s=Ut({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:r}=e.config,i=Kn(e,n,"/v1/token","key=".concat(r)),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Un.fetch()(i,{method:"POST",headers:a,body:s})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}(e,t);this.updateTokensAndExpiration(s,n,Number(r))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*s}static fromJSON(e,t){const{refreshToken:s,accessToken:n,expirationTime:r}=t,i=new lr;return s&&(In("string"===typeof s,"internal-error",{appName:e}),i.refreshToken=s),n&&(In("string"===typeof n,"internal-error",{appName:e}),i.accessToken=n),r&&(In("number"===typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new lr,this.toJSON())}_performRefresh(){return An("not implemented")}}function dr(e,t){In("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class ur{constructor(e){var{uid:t,auth:s,stsTokenManager:n}=e,r=vn(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ir(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=s,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new ar(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await rr(this,this.stsTokenManager.getToken(this.auth,e));return In(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=Wt(e),n=await s.getIdToken(t),r=sr(n);In(r&&r.exp&&r.auth_time&&r.iat,s.auth,"internal-error");const i="object"===typeof r.firebase?r.firebase:void 0,a=null===i||void 0===i?void 0:i.sign_in_provider;return{claims:r,token:n,authTime:er(tr(r.auth_time)),issuedAtTime:er(tr(r.iat)),expirationTime:er(tr(r.exp)),signInProvider:a||null,signInSecondFactor:(null===i||void 0===i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Wt(e);await or(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(In(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ur(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){In(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await or(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(en(this.auth.app))return Promise.reject(Cn(this.auth));const e=await this.getIdToken();return await rr(this,async function(e,t){return Gn(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var s,n,r,i,a,o,c,l;const d=null!==(s=t.displayName)&&void 0!==s?s:void 0,u=null!==(n=t.email)&&void 0!==n?n:void 0,h=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(i=t.photoURL)&&void 0!==i?i:void 0,m=null!==(a=t.tenantId)&&void 0!==a?a:void 0,f=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:x,isAnonymous:_,providerData:E,stsTokenManager:b}=t;In(v&&b,e,"internal-error");const w=lr.fromJSON(this.name,b);In("string"===typeof v,e,"internal-error"),dr(d,e.name),dr(u,e.name),In("boolean"===typeof x,e,"internal-error"),In("boolean"===typeof _,e,"internal-error"),dr(h,e.name),dr(p,e.name),dr(m,e.name),dr(f,e.name),dr(g,e.name),dr(y,e.name);const N=new ur({uid:v,auth:e,email:u,emailVerified:x,displayName:d,isAnonymous:_,photoURL:p,phoneNumber:h,tenantId:m,stsTokenManager:w,createdAt:g,lastLoginAt:y});return E&&Array.isArray(E)&&(N.providerData=E.map(e=>Object.assign({},e))),f&&(N._redirectEventId=f),N}static async _fromIdTokenResponse(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=new lr;n.updateFromServerResponse(t);const r=new ur({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:s});return await or(r),r}static async _fromGetAccountInfoResponse(e,t,s){const n=t.users[0];In(void 0!==n.localId,"internal-error");const r=void 0!==n.providerUserInfo?cr(n.providerUserInfo):[],i=!(n.email&&n.passwordHash)&&!(null===r||void 0===r?void 0:r.length),a=new lr;a.updateFromIdToken(s);const o=new ur({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:i}),c={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:r,metadata:new ar(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(null===r||void 0===r?void 0:r.length)};return Object.assign(o,c),o}}const hr=new Map;function pr(e){On(e instanceof Function,"Expected a class definition");let t=hr.get(e);return t?(On(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,hr.set(e,t),t)}class mr{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}mr.type="NONE";const fr=mr;function gr(e,t,s){return"firebase".concat(":",e,":").concat(t,":").concat(s)}class yr{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:n,name:r}=this.auth;this.fullUserKey=gr(this.userKey,n.apiKey,r),this.fullPersistenceKey=gr("persistence",n.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ur._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new yr(pr(fr),e,s);const n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let r=n[0]||pr(fr);const i=gr(s,e.config.apiKey,e.name);let a=null;for(const l of t)try{const t=await l._get(i);if(t){const s=ur._fromJSON(e,t);l!==r&&(a=s),r=l;break}}catch(c){}const o=n.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&o.length?(r=o[0],a&&await r._set(i,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(i)}catch(c){}})),new yr(r,e,s)):new yr(r,e,s)}}function vr(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(br(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(xr(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Nr(t))return"Blackberry";if(Sr(t))return"Webos";if(_r(t))return"Safari";if((t.includes("chrome/")||Er(t))&&!t.includes("edge/"))return"Chrome";if(wr(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=e.match(t);if(2===(null===s||void 0===s?void 0:s.length))return s[1]}return"Other"}function xr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/firefox\//i.test(e)}function _r(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:At()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Er(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/crios\//i.test(e)}function br(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/iemobile/i.test(e)}function wr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/android/i.test(e)}function Nr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/blackberry/i.test(e)}function Sr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/webos/i.test(e)}function Tr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Cr(){return function(){const e=At();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Rr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:At();return Tr(e)||wr(e)||Sr(e)||Nr(e)||/windows phone/i.test(e)||br(e)}function Ir(e){let t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=vr(At());break;case"Worker":t="".concat(vr(At()),"-").concat(e);break;default:t=e}const n=s.length?s.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(nn,"/").concat(n)}class Ar{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=t=>new Promise((s,n)=>{try{s(e(t))}catch(V_){n(V_)}});s.onAbort=t,this.queue.push(s);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(V_){t.reverse();for(const s of t)try{s()}catch(tt){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===V_||void 0===V_?void 0:V_.message})}}}class Or{constructor(e){var t,s,n,r;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(s=e.allowedNonAlphanumericCharacters)||void 0===s?void 0:s.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,s,n,r,i,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(s=o.meetsMaxPasswordLength)||void 0===s||s),o.isValid&&(o.isValid=null===(n=o.containsLowercaseLetter)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsUppercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsNumericCharacter)||void 0===i||i),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let s;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)s=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,n,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class jr{constructor(e,t,s,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Dr(this),this.idTokenSubscription=new Dr(this),this.beforeStateQueue=new Ar(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=En,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=pr(t)),this._initializationPromise=this.queue(async()=>{var s,n;if(!this._deleted&&(this.persistenceManager=await yr.create(this,e),!this._deleted)){if(null===(s=this._popupRedirectResolver)||void 0===s?void 0:s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(V_){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(n=this.currentUser)||void 0===n?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await $n(this,{idToken:e}),s=await ur._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(en(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let n=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null===n||void 0===n?void 0:n._redirectEventId,a=await this.tryRedirectSignIn(e);s&&s!==i||!(null===a||void 0===a?void 0:a.user)||(n=a.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(V_){n=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(V_))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return In(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(V_){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await or(e)}catch(V_){if((null===V_||void 0===V_?void 0:V_.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(en(this.app))return Promise.reject(Cn(this));const t=e?Wt(e):null;return t&&In(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&In(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return en(this.app)?Promise.reject(Cn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return en(this.app)?Promise.reject(Cn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(pr(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return Gn(e,"GET","/v2/passwordPolicy",Bn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new Or(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Dt("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Gn(e,"POST","/v2/accounts:revokeToken",Bn(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return null===e?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&pr(e)||this._popupRedirectResolver;In(t,this,"argument-error"),this.redirectPersistenceManager=await yr.create(this,[pr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,s;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(s=this.redirectUser)||void 0===s?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,n){if(this._deleted)return()=>{};const r="function"===typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(In(a,this,"internal-error"),a.then(()=>{i||r(this.currentUser)}),"function"===typeof t){const r=e.addObserver(t,s,n);return()=>{i=!0,r()}}{const s=e.addObserver(t);return()=>{i=!0,s()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return In(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ir(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const s=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());s&&(t["X-Firebase-Client"]=s);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(bn.logLevel<=Xt.WARN){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];bn.warn("Auth (".concat(nn,"): ").concat(e),...s)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function kr(e){return Wt(e)}class Dr{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const s=new Bt(e,t);return s.subscribe.bind(s)}(e=>this.observer=e)}get next(){return In(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Pr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Lr(e){return Pr.loadJS(e)}function Mr(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Ur{constructor(e){this.type="recaptcha-enterprise",this.auth=kr(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function s(t,s,n){const r=window.grecaptcha;Jn(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{s(e)}).catch(()=>{s("NO_RECAPTCHA")})}):n(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,n)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,s)=>{Zn(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0!==n.recaptchaKey){const s=new Qn(n);return null==e.tenantId?e._agentRecaptchaConfig=s:e._tenantRecaptchaConfigs[e.tenantId]=s,t(s.siteKey)}s(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{s(e)})})})(this.auth).then(r=>{if(!t&&Jn(window.grecaptcha))s(r,e,n);else{if("undefined"===typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let t=Pr.recaptchaEnterpriseScript;0!==t.length&&(t+=r),Lr(t).then(()=>{s(r,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function Vr(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=new Ur(e);let i;try{i=await r.verify(s)}catch(o){i=await r.verify(s,!0)}const a=Object.assign({},t);return n?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Fr(e,t,s,n){var r;if(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await Vr(e,t,s,"getOobCode"===s);return n(e,r)}return n(e,t).catch(async r=>{if(r.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(s," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const r=await Vr(e,t,s,"getOobCode"===s);return n(e,r)}return Promise.reject(r)})}function Br(e,t,s){const n=kr(e);In(n._canInitEmulator,n,"emulator-config-failed"),In(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const r=!!(null===s||void 0===s?void 0:s.disableWarnings),i=Gr(t),{host:a,port:o}=function(e){const t=Gr(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!s)return{host:"",port:null};const n=s[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const e=r[1];return{host:e,port:Wr(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:Wr(t)}}}(t),c=null===o?"":":".concat(o);n.config.emulator={url:"".concat(i,"//").concat(a).concat(c,"/")},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Gr(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Wr(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Hr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return An("not implemented")}_getIdTokenResponse(e){return An("not implemented")}_linkToIdToken(e,t){return An("not implemented")}_getReauthenticationResolver(e){return An("not implemented")}}async function Kr(e,t){return Gn(e,"POST","/v1/accounts:signUp",t)}async function zr(e,t){return Hn(e,"POST","/v1/accounts:signInWithPassword",Bn(e,t))}async function qr(e,t){return Gn(e,"POST","/v1/accounts:sendOobCode",Bn(e,t))}async function Yr(e,t){return qr(e,t)}class Xr extends Hr{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",s),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new Xr(e,t,"password")}static _fromEmailAndCode(e,t){return new Xr(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Fr(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",zr);case"emailLink":return async function(e,t){return Hn(e,"POST","/v1/accounts:signInWithEmailLink",Bn(e,t))}(e,{email:this._email,oobCode:this._password});default:Nn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Fr(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Kr);case"emailLink":return async function(e,t){return Hn(e,"POST","/v1/accounts:signInWithEmailLink",Bn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Nn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Jr(e,t){return Hn(e,"POST","/v1/accounts:signInWithIdp",Bn(e,t))}class Qr extends Hr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Qr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Nn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:s,signInMethod:n}=t,r=vn(t,["providerId","signInMethod"]);if(!s||!n)return null;const i=new Qr(s,n);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return Jr(e,this.buildRequest())}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Jr(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ut(t)}return e}}const Zr={USER_NOT_FOUND:"user-not-found"};class $r extends Hr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new $r({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new $r({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Hn(e,"POST","/v1/accounts:signInWithPhoneNumber",Bn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const s=await Hn(e,"POST","/v1/accounts:signInWithPhoneNumber",Bn(e,t));if(s.temporaryProof)throw Yn(e,"account-exists-with-different-credential",s);return s}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Hn(e,"POST","/v1/accounts:signInWithPhoneNumber",Bn(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Zr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:s,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:s,code:n}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:s,phoneNumber:n,temporaryProof:r}=e;return s||t||n||r?new $r({verificationId:t,verificationCode:s,phoneNumber:n,temporaryProof:r}):null}}class ei{constructor(e){var t,s,n,r,i,a;const o=Vt(Ft(e)),c=null!==(t=o.apiKey)&&void 0!==t?t:null,l=null!==(s=o.oobCode)&&void 0!==s?s:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=o.mode)&&void 0!==n?n:null);In(c&&l&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=l,this.continueUrl=null!==(r=o.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(i=o.languageCode)&&void 0!==i?i:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=Vt(Ft(e)).link,s=t?Vt(Ft(t)).deep_link_id:null,n=Vt(Ft(e)).deep_link_id;return(n?Vt(Ft(n)).link:null)||n||s||t||e}(e);try{return new ei(t)}catch(s){return null}}}class ti{constructor(){this.providerId=ti.PROVIDER_ID}static credential(e,t){return Xr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=ei.parseLink(t);return In(s,"argument-error"),Xr._fromEmailAndCode(e,s.code,s.tenantId)}}ti.PROVIDER_ID="password",ti.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ti.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class si{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ni extends si{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ri extends ni{constructor(){super("facebook.com")}static credential(e){return Qr._fromParams({providerId:ri.PROVIDER_ID,signInMethod:ri.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ri.credentialFromTaggedObject(e)}static credentialFromError(e){return ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ri.credential(t.oauthAccessToken)}catch(s){return null}}}ri.FACEBOOK_SIGN_IN_METHOD="facebook.com",ri.PROVIDER_ID="facebook.com";class ii extends ni{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Qr._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ii.credentialFromTaggedObject(e)}static credentialFromError(e){return ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:s,oauthAccessToken:n}=t;if(!s&&!n)return null;try{return ii.credential(s,n)}catch(r){return null}}}ii.GOOGLE_SIGN_IN_METHOD="google.com",ii.PROVIDER_ID="google.com";class ai extends ni{constructor(){super("github.com")}static credential(e){return Qr._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ai.credential(t.oauthAccessToken)}catch(s){return null}}}ai.GITHUB_SIGN_IN_METHOD="github.com",ai.PROVIDER_ID="github.com";class oi extends ni{constructor(){super("twitter.com")}static credential(e,t){return Qr._fromParams({providerId:oi.PROVIDER_ID,signInMethod:oi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return oi.credentialFromTaggedObject(e)}static credentialFromError(e){return oi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:n}=t;if(!s||!n)return null;try{return oi.credential(s,n)}catch(r){return null}}}async function ci(e,t){return Hn(e,"POST","/v1/accounts:signUp",Bn(e,t))}oi.TWITTER_SIGN_IN_METHOD="twitter.com",oi.PROVIDER_ID="twitter.com";class li{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=await ur._fromIdTokenResponse(e,s,n),i=di(s);return new li({user:r,providerId:i,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const n=di(s);return new li({user:e,providerId:n,_tokenResponse:s,operationType:t})}}function di(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ui extends kt{constructor(e,t,s,n){var r;super(t.code,t.message),this.operationType=s,this.user=n,Object.setPrototypeOf(this,ui.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,n){return new ui(e,t,s,n)}}function hi(e,t,s,n){return("reauthenticate"===t?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(s=>{if(s.code==="auth/".concat("multi-factor-auth-required"))throw ui._fromErrorAndOperation(e,s,t,n);throw s})}async function pi(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=await rr(e,t._linkToIdToken(e.auth,await e.getIdToken()),s);return li._forOperation(e,"link",n)}async function mi(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:n}=e;if(en(n.app))return Promise.reject(Cn(n));const r="reauthenticate";try{const i=await rr(e,hi(n,r,t,e),s);In(i.idToken,n,"internal-error");const a=sr(i.idToken);In(a,n,"internal-error");const{sub:o}=a;return In(e.uid===o,n,"user-mismatch"),li._forOperation(e,r,i)}catch(V_){throw(null===V_||void 0===V_?void 0:V_.code)==="auth/".concat("user-not-found")&&Nn(n,"user-mismatch"),V_}}async function fi(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(en(e.app))return Promise.reject(Cn(e));const n="signIn",r=await hi(e,n,t),i=await li._fromIdTokenResponse(e,n,r);return s||await e._updateCurrentUser(i.user),i}async function gi(e,t){return fi(kr(e),t)}async function yi(e,t){return mi(Wt(e),t)}class vi{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?xi._fromServerResponse(e,t):"totpInfo"in t?_i._fromServerResponse(e,t):Nn(e,"internal-error")}}class xi extends vi{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new xi(t)}}class _i extends vi{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new _i(t)}}function Ei(e,t,s){var n;In((null===(n=s.url)||void 0===n?void 0:n.length)>0,e,"invalid-continue-uri"),In("undefined"===typeof s.dynamicLinkDomain||s.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=s.url,t.dynamicLinkDomain=s.dynamicLinkDomain,t.canHandleCodeInApp=s.handleCodeInApp,s.iOS&&(In(s.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=s.iOS.bundleId),s.android&&(In(s.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=s.android.installApp,t.androidMinimumVersionCode=s.android.minimumVersion,t.androidPackageName=s.android.packageName)}async function bi(e){const t=kr(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function wi(e,t,s){if(en(e.app))return Promise.reject(Cn(e));const n=kr(e),r=Fr(n,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ci),i=await r.catch(t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&bi(e),t}),a=await li._fromIdTokenResponse(n,"signIn",i);return await n._updateCurrentUser(a.user),a}function Ni(e,t,s){return en(e.app)?Promise.reject(Cn(e)):gi(Wt(e),ti.credential(t,s)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&bi(e),t})}async function Si(e,t){let{displayName:s,photoURL:n}=t;if(void 0===s&&void 0===n)return;const r=Wt(e),i={idToken:await r.getIdToken(),displayName:s,photoUrl:n,returnSecureToken:!0},a=await rr(r,async function(e,t){return Gn(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const o=r.providerData.find(e=>{let{providerId:t}=e;return"password"===t});o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}async function Ti(e,t,s){const{auth:n}=e,r={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(r.email=t),s&&(r.password=s);const i=await rr(e,async function(e,t){return Gn(e,"POST","/v1/accounts:update",t)}(n,r));await e._updateTokensIfNecessary(i,!0)}function Ci(e,t,s,n){return Wt(e).onAuthStateChanged(t,s,n)}function Ri(e){return Wt(e).signOut()}class Ii{constructor(e,t,s){this.type=e,this.credential=t,this.user=s}static _fromIdtoken(e,t){return new Ii("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ii("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){var t,s;if(null===e||void 0===e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Ii._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(s=e.multiFactorSession)||void 0===s?void 0:s.idToken)return Ii._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Ai{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>vi._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new Ai(e)}async getSession(){return Ii._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const s=e,n=await this.getSession(),r=await rr(this.user,s._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"===typeof e?e:e.uid,s=await this.user.getIdToken();try{const e=await rr(this.user,function(e,t){return Gn(e,"POST","/v2/accounts/mfaEnrollment:withdraw",Bn(e,t))}(this.user.auth,{idToken:s,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(e=>{let{uid:s}=e;return s!==t}),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(V_){throw V_}}}const Oi=new WeakMap;function ji(e){const t=Wt(e);return Oi.has(t)||Oi.set(t,Ai._fromUser(t)),Oi.get(t)}const ki="__sak";class Di{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ki,"1"),this.storage.removeItem(ki),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Pi extends Di{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=At();return _r(e)||Tr(e)}()&&function(){try{return!(!window||window===window.top)}catch(V_){return!1}}(),this.fallbackToPolling=Rr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),n=this.localCache[t];s!==n&&e(t,n,s)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,s)=>{this.notifyListeners(e,s)});const s=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const n=this.storage.getItem(s);if(e.newValue!==n)null!==e.newValue?this.storage.setItem(s,e.newValue):this.storage.removeItem(s);else if(this.localCache[s]===e.newValue&&!t)return}const n=()=>{const e=this.storage.getItem(s);(t||this.localCache[s]!==e)&&this.notifyListeners(s,e)},r=this.storage.getItem(s);Cr()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const n of Array.from(s))n(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Pi.type="LOCAL";const Li=Pi;class Mi extends Di{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Mi.type="SESSION";const Ui=Mi;class Vi{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const s=new Vi(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:n,data:r}=t.data,i=this.handlersMap[n];if(!(null===i||void 0===i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:n});const a=Array.from(i).map(async e=>e(t.origin,r)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Fi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s="";for(let n=0;n<t;n++)s+=Math.floor(10*Math.random());return e+s}Vi.receivers=[];class Bi{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const n="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,i;return new Promise((a,o)=>{const c=Fi("",20);n.port1.start();const l=setTimeout(()=>{o(new Error("unsupported_event"))},s);i={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),r=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(t.data.response);break;default:clearTimeout(l),clearTimeout(r),o(new Error("invalid_response"))}}},this.handlers.add(i),n.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[n.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Gi(){return window}function Wi(){return"undefined"!==typeof Gi().WorkerGlobalScope&&"function"===typeof Gi().importScripts}const Hi="firebaseLocalStorageDb",Ki="firebaseLocalStorage",zi="fbase_key";class qi{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Yi(e,t){return e.transaction([Ki],t?"readwrite":"readonly").objectStore(Ki)}function Xi(){const e=indexedDB.open(Hi,1);return new Promise((t,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Ki,{keyPath:zi})}catch(V_){s(V_)}}),e.addEventListener("success",async()=>{const s=e.result;s.objectStoreNames.contains(Ki)?t(s):(s.close(),await function(){const e=indexedDB.deleteDatabase(Hi);return new qi(e).toPromise()}(),t(await Xi()))})})}async function Ji(e,t,s){const n=Yi(e,!0).put({[zi]:t,value:s});return new qi(n).toPromise()}function Qi(e,t){const s=Yi(e,!0).delete(t);return new qi(s).toPromise()}class Zi{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Xi()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(V_){if(t++>3)throw V_;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Wi()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Vi._getInstance(Wi()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Bi(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&(null===(e=s[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=s[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xi();return await Ji(e,ki,"1"),await Qi(e,ki),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>Ji(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const s=Yi(e,!1).get(t),n=await new qi(s).toPromise();return void 0===n?null:n.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Qi(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Yi(e,!1).getAll();return new qi(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],s=new Set;if(0!==e.length)for(const{fbase_key:n,value:r}of e)s.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(r)&&(this.notifyListeners(n,r),t.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!s.has(n)&&(this.notifyListeners(n,null),t.push(n));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const n of Array.from(s))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Zi.type="LOCAL";const $i=Zi;const ea=1e12;class ta{constructor(e){this.auth=e,this.counter=ea,this._widgets=new Map}render(e,t){const s=this.counter;return this._widgets.set(s,new sa(e,this.auth.name,t||{})),this.counter++,s}reset(e){var t;const s=e||ea;null===(t=this._widgets.get(s))||void 0===t||t.delete(),this._widgets.delete(s)}getResponse(e){var t;const s=e||ea;return(null===(t=this._widgets.get(s))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const s=e||ea;return null===(t=this._widgets.get(s))||void 0===t||t.execute(),""}}class sa{constructor(e,t,s){this.params=s,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const n="string"===typeof e?document.getElementById(e):e;In(n,"argument-error",{appName:t}),this.container=n,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],s="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<e;n++)t.push(s.charAt(Math.floor(Math.random()*s.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(V_){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(V_){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const na=Mr("rcb"),ra=new Ln(3e4,6e4);class ia{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=Gi().grecaptcha)||void 0===e?void 0:e.render)}load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return In(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Xn(Gi().grecaptcha)?Promise.resolve(Gi().grecaptcha):new Promise((s,n)=>{const r=Gi().setTimeout(()=>{n(Sn(e,"network-request-failed"))},ra.get());Gi()[na]=()=>{Gi().clearTimeout(r),delete Gi()[na];const i=Gi().grecaptcha;if(!i||!Xn(i))return void n(Sn(e,"internal-error"));const a=i.render;i.render=(e,t)=>{const s=a(e,t);return this.counter++,s},this.hostLanguage=t,s(i)};Lr("".concat(Pr.recaptchaV2Script,"?").concat(Ut({onload:na,render:"explicit",hl:t}))).catch(()=>{clearTimeout(r),n(Sn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=Gi().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class aa{async load(e){return new ta(e)}clearedOneInstance(){}}const oa="recaptcha",ca={theme:"light",type:"image"};class la{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.assign({},ca);this.parameters=s,this.type=oa,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=kr(e),this.isInvisible="invisible"===this.parameters.size,In("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");const n="string"===typeof t?document.getElementById(t):t;In(n,this.auth,"argument-error"),this.container=n,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new aa:new ia,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),s=t.getResponse(e);return s||new Promise(s=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),s(e))};this.tokenChangeListeners.add(n),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(V_){return Promise.reject(V_)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){In(!this.parameters.sitekey,this.auth,"argument-error"),In(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),In("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"===typeof e)e(t);else if("string"===typeof e){const s=Gi()[e];"function"===typeof s&&s(t)}}}assertNotDestroyed(){In(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){In(kn()&&!Wi(),this.auth,"internal-error"),await function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Gn(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);In(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return In(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}async function da(e,t,s){var n;const r=await s.verify();try{let i;if(In("string"===typeof r,e,"argument-error"),In(s.type===oa,e,"argument-error"),i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){In("enroll"===t.type,e,"internal-error");const s=await function(e,t){return Gn(e,"POST","/v2/accounts/mfaEnrollment:start",Bn(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:r}});return s.phoneSessionInfo.sessionInfo}{In("signin"===t.type,e,"internal-error");const s=(null===(n=i.multiFactorHint)||void 0===n?void 0:n.uid)||i.multiFactorUid;In(s,e,"missing-multi-factor-info");const a=await function(e,t){return Gn(e,"POST","/v2/accounts/mfaSignIn:start",Bn(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{recaptchaToken:r}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Gn(e,"POST","/v1/accounts:sendVerificationCode",Bn(e,t))}(e,{phoneNumber:i.phoneNumber,recaptchaToken:r});return t}}finally{s._reset()}}class ua{constructor(e){this.providerId=ua.PROVIDER_ID,this.auth=kr(e)}verifyPhoneNumber(e,t){return da(this.auth,e,Wt(t))}static credential(e,t){return $r._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ua.credentialFromTaggedObject(t)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:s,temporaryProof:n}=t;return s&&n?$r._fromTokenResponse(s,n):null}}function ha(e,t){return t?pr(t):(In(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}ua.PROVIDER_ID="phone",ua.PHONE_SIGN_IN_METHOD="phone";class pa extends Hr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Jr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Jr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Jr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ma(e){return fi(e.auth,new pa(e),e.bypassAuthState)}function fa(e){const{auth:t,user:s}=e;return In(s,t,"internal-error"),mi(s,new pa(e),e.bypassAuthState)}async function ga(e){const{auth:t,user:s}=e;return In(s,t,"internal-error"),pi(s,new pa(e),e.bypassAuthState)}class ya{constructor(e,t,s,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=s,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(V_){this.reject(V_)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:n,tenantId:r,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:s,tenantId:r||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(V_){this.reject(V_)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ma;case"linkViaPopup":case"linkViaRedirect":return ga;case"reauthViaPopup":case"reauthViaRedirect":return fa;default:Nn(this.auth,"internal-error")}}resolve(e){On(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){On(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const va=new Ln(2e3,1e4);class xa extends ya{constructor(e,t,s,n,r){super(e,t,n,r),this.provider=s,this.authWindow=null,this.pollId=null,xa.currentPopupAction&&xa.currentPopupAction.cancel(),xa.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return In(e,this.auth,"internal-error"),e}async onExecution(){On(1===this.filter.length,"Popup operations only handle one event");const e=Fi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Sn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Sn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xa.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;(null===(s=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===s?void 0:s.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Sn(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,va.get())};e()}}xa.currentPopupAction=null;const _a=new Map;class Ea extends ya{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=_a.get(this.auth._key());if(!e){try{const t=await async function(e,t){const s=Na(t),n=wa(e);if(!await n._isAvailable())return!1;const r="true"===await n._get(s);return await n._remove(s),r}(this.resolver,this.auth),s=t?await super.execute():null;e=()=>Promise.resolve(s)}catch(V_){e=()=>Promise.reject(V_)}_a.set(this.auth._key(),e)}return this.bypassAuthState||_a.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function ba(e,t){_a.set(e._key(),t)}function wa(e){return pr(e._redirectPersistence)}function Na(e){return gr("pendingRedirect",e.config.apiKey,e.name)}async function Sa(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(en(e.app))return Promise.reject(Cn(e));const n=kr(e),r=ha(n,t),i=new Ea(n,r,s),a=await i.execute();return a&&!s&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}class Ta{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ra(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!Ra(e)){const n=(null===(s=e.error.code)||void 0===s?void 0:s.split("auth/")[1])||"internal-error";t.onError(Sn(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ca(e))}saveEventToCache(e){this.cachedEventUids.add(Ca(e)),this.lastProcessedEventTime=Date.now()}}function Ca(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ra(e){let{type:t,error:s}=e;return"unknown"===t&&(null===s||void 0===s?void 0:s.code)==="auth/".concat("no-auth-event")}const Ia=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Aa=/^https?/;async function Oa(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Gn(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const n of t)try{if(ja(n))return}catch(s){}Nn(e,"unauthorized-domain")}function ja(e){const t=jn(),{protocol:s,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===n?"chrome-extension:"===s&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===s&&r.hostname===n}if(!Aa.test(s))return!1;if(Ia.test(e))return n===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}const ka=new Ln(3e4,6e4);function Da(){const e=Gi().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}function Pa(e){return new Promise((t,s)=>{var n,r,i;function a(){Da(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Da(),s(Sn(e,"network-request-failed"))},timeout:ka.get()})}if(null===(r=null===(n=Gi().gapi)||void 0===n?void 0:n.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=Gi().gapi)||void 0===i?void 0:i.load)){const t=Mr("iframefcb");return Gi()[t]=()=>{gapi.load?a():s(Sn(e,"network-request-failed"))},Lr("".concat(Pr.gapiScript,"?onload=").concat(t)).catch(e=>s(e))}a()}}).catch(e=>{throw La=null,e})}let La=null;const Ma=new Ln(5e3,15e3),Ua={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Va=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Fa(e){const t=e.config;In(t.authDomain,e,"auth-domain-config-required");const s=t.emulator?Mn(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),n={apiKey:t.apiKey,appName:e.name,v:nn},r=Va.get(e.config.apiHost);r&&(n.eid=r);const i=e._getFrameworks();return i.length&&(n.fw=i.join(",")),"".concat(s,"?").concat(Ut(n).slice(1))}async function Ba(e){const t=await function(e){return La=La||Pa(e),La}(e),s=Gi().gapi;return In(s,e,"internal-error"),t.open({where:document.body,url:Fa(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ua,dontclear:!0},t=>new Promise(async(s,n)=>{await t.restyle({setHideOnLeave:!1});const r=Sn(e,"network-request-failed"),i=Gi().setTimeout(()=>{n(r)},Ma.get());function a(){Gi().clearTimeout(i),s(t)}t.ping(a).then(a,()=>{n(r)})}))}const Ga={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Wa{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(V_){}}}function Ha(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const i=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let o="";const c=Object.assign(Object.assign({},Ga),{width:n.toString(),height:r.toString(),top:i,left:a}),l=At().toLowerCase();s&&(o=Er(l)?"_blank":s),xr(l)&&(t=t||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce((e,t)=>{let[s,n]=t;return"".concat(e).concat(s,"=").concat(n,",")},"");if(function(){var e;return Tr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:At())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(l)&&"_self"!==o)return function(e,t){const s=document.createElement("a");s.href=e,s.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(n)}(t||"",o),new Wa(null);const u=window.open(t||"",o,d);In(u,e,"popup-blocked");try{u.focus()}catch(V_){}return new Wa(u)}const Ka="__/auth/handler",za="emulator/auth/handler",qa=encodeURIComponent("fac");async function Ya(e,t,s,n,r,i){In(e.config.authDomain,e,"auth-domain-config-required"),In(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:n,v:nn,eventId:r};if(t instanceof si){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))a[e]=t}if(t instanceof ni){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const d of Object.keys(o))void 0===o[d]&&delete o[d];const c=await e._getAppCheckToken(),l=c?"#".concat(qa,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Ka);return Mn(t,za)}(e),"?").concat(Ut(o).slice(1)).concat(l)}const Xa="webStorageSupport";const Ja=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ui,this._completeRedirectFn=Sa,this._overrideRedirectResult=ba}async _openPopup(e,t,s,n){var r;On(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");return Ha(e,await Ya(e,t,s,jn(),n),Fi())}async _openRedirect(e,t,s,n){await this._originValidation(e);return function(e){Gi().location.href=e}(await Ya(e,t,s,jn(),n)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:s}=this.eventManagers[t];return e?Promise.resolve(e):(On(s,"If manager is not set, promise should be"),s)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await Ba(e),s=new Ta(e);return t.register("authEvent",t=>{In(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:s.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Xa,{type:Xa},s=>{var n;const r=null===(n=null===s||void 0===s?void 0:s[0])||void 0===n?void 0:n[Xa];void 0!==r&&t(!!r),Nn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Oa(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Rr()||_r()||Tr()}};var Qa="@firebase/auth",Za="1.7.4";class $a{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){In(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const eo=Rt("authIdTokenMaxAge")||300;let to=null;var so;function no(e,t,s,n){return new(s||(s=Promise))(function(r,i){function a(e){try{c(n.next(e))}catch(V_){i(V_)}}function o(e){try{c(n.throw(e))}catch(V_){i(V_)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})}function ro(e,t){var s,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(V_){i=[6,V_],n=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}!function(e){Pr=e}({loadJS:e=>new Promise((t,s)=>{const n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=Sn("internal-error");t.customData=e,s(t)},n.type="text/javascript",n.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),so="Browser",Zs(new Ht("auth",(e,t)=>{let{options:s}=t;const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;In(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const c={apiKey:a,authDomain:o,clientPlatform:so,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ir(so)},l=new jr(n,r,i,c);return function(e,t){const s=(null===t||void 0===t?void 0:t.persistence)||[],n=(Array.isArray(s)?s:[s]).map(pr);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,s),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Zs(new Ht("auth-internal",e=>(e=>new $a(e))(kr(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),on(Qa,Za,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(so)),on(Qa,Za,"esm2017");var io=function(){return io=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var r in t=arguments[s])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},io.apply(this,arguments)},ao=function(e){return{loading:void 0===e||null===e,value:e}},oo=function(e){var s=e?e():void 0,n=(0,t.useReducer)(function(e,t){switch(t.type){case"error":return io(io({},e),{error:t.error,loading:!1,value:void 0});case"reset":return ao(t.defaultValue);case"value":return io(io({},e),{error:void 0,loading:!1,value:t.value});default:return e}},ao(s)),r=n[0],i=n[1],a=(0,t.useCallback)(function(){var t=e?e():void 0;i({type:"reset",defaultValue:t})},[e]),o=(0,t.useCallback)(function(e){i({type:"error",error:e})},[]),c=(0,t.useCallback)(function(e){i({type:"value",value:e})},[]);return(0,t.useMemo)(function(){return{error:r.error,loading:r.loading,reset:a,setError:o,setValue:c,value:r.value}},[r.error,r.loading,a,o,c,r.value])},co=function(e,s){var n=oo(function(){return e.currentUser}),r=n.error,i=n.loading,a=n.setError,o=n.setValue,c=n.value;return(0,t.useEffect)(function(){var t=Ci(e,function(e){return no(void 0,void 0,void 0,function(){var t;return ro(this,function(n){switch(n.label){case 0:if(!(null===s||void 0===s?void 0:s.onUserChanged))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s.onUserChanged(e)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),a(t),[3,4];case 4:return o(e),[2]}})})},a);return function(){t()}},[e]),[c,i,r]};on("firebase","10.12.2","app");var lo,uo,ho="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},po={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function s(e,t,s){s||(s=0);var n=Array(16);if("string"===typeof t)for(var r=0;16>r;++r)n[r]=t.charCodeAt(s++)|t.charCodeAt(s++)<<8|t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<24;else for(r=0;16>r;++r)n[r]=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;t=e.g[0],s=e.g[1],r=e.g[2];var i=e.g[3],a=t+(i^s&(r^i))+n[0]+3614090360&4294967295;a=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=(s=(r=(i=(t=s+(a<<7&4294967295|a>>>25))+((a=i+(r^t&(s^r))+n[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=r+(s^i&(t^s))+n[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=s+(t^r&(i^t))+n[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(r^i))+n[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=i+(r^t&(s^r))+n[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=r+(s^i&(t^s))+n[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=s+(t^r&(i^t))+n[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(r^i))+n[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=i+(r^t&(s^r))+n[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=r+(s^i&(t^s))+n[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=s+(t^r&(i^t))+n[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(r^i))+n[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=i+(r^t&(s^r))+n[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=r+(s^i&(t^s))+n[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=s+(t^r&(i^t))+n[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^i&(s^r))+n[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=i+(s^r&(t^s))+n[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^s&(i^t))+n[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=s+(i^t&(r^i))+n[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i&(s^r))+n[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=i+(s^r&(t^s))+n[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^s&(i^t))+n[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=s+(i^t&(r^i))+n[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i&(s^r))+n[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=i+(s^r&(t^s))+n[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^s&(i^t))+n[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=s+(i^t&(r^i))+n[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i&(s^r))+n[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=i+(s^r&(t^s))+n[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^s&(i^t))+n[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=s+(i^t&(r^i))+n[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(s^r^i)+n[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^s^r)+n[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^s)+n[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=s+(r^i^t)+n[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(s^r^i)+n[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^s^r)+n[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^s)+n[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=s+(r^i^t)+n[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(s^r^i)+n[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^s^r)+n[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^s)+n[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=s+(r^i^t)+n[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(s^r^i)+n[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^s^r)+n[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=r+(i^t^s)+n[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=s+(r^i^t)+n[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^(s|~i))+n[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=i+(s^(t|~r))+n[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(i|~s))+n[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=s+(i^(r|~t))+n[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(r^(s|~i))+n[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=i+(s^(t|~r))+n[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(i|~s))+n[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=s+(i^(r|~t))+n[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(r^(s|~i))+n[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=i+(s^(t|~r))+n[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(i|~s))+n[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=s+(i^(r|~t))+n[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((i=(t=s+((a=t+(r^(s|~i))+n[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=i+(s^(t|~r))+n[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((r=i+((a=r+(t^(i|~s))+n[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+i&4294967295}function n(e,t){this.h=t;for(var s=[],n=!0,r=e.length-1;0<=r;r--){var i=0|e[r];n&&i==t||(s[r]=i,n=!1)}this.g=s}!function(e,t){function s(){}s.prototype=t.prototype,e.D=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.C=function(e,s,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[s].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=n;)s(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var s=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&s,s/=256;for(this.u(e),e=Array(16),t=s=0;4>t;++t)for(var n=0;32>n;n+=8)e[s++]=this.g[t]>>>n&255;return e};var r={};function i(e){return-128<=e&&128>e?function(e,t){var s=r;return Object.prototype.hasOwnProperty.call(s,e)?s[e]:s[e]=t(e)}(e,function(e){return new n([0|e],0>e?-1:0)}):new n([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(0>e)return h(a(-e));for(var t=[],s=1,r=0;e>=s;r++)t[r]=e/s|0,s*=4294967296;return new n(t,0)}var o=i(0),c=i(1),l=i(16777216);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){for(var t=e.g.length,s=[],r=0;r<t;r++)s[r]=~e.g[r];return new n(s,~e.h).add(c)}function p(e,t){return e.add(h(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function f(e,t){this.g=e,this.h=t}function g(e,t){if(d(t))throw Error("division by zero");if(d(e))return new f(o,o);if(u(e))return t=g(h(e),t),new f(h(t.g),h(t.h));if(u(t))return t=g(e,h(t)),new f(h(t.g),t.h);if(30<e.g.length){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var s=c,n=t;0>=n.l(e);)s=y(s),n=y(n);var r=v(s,1),i=v(n,1);for(n=v(n,2),s=v(s,2);!d(n);){var l=i.add(n);0>=l.l(e)&&(r=r.add(s),i=l),n=v(n,1),s=v(s,1)}return t=p(e,r.j(t)),new f(r,t)}for(r=o;0<=e.l(t);){for(s=Math.max(1,Math.floor(e.m()/t.m())),n=48>=(n=Math.ceil(Math.log(s)/Math.LN2))?1:Math.pow(2,n-48),l=(i=a(s)).j(t);u(l)||0<l.l(e);)l=(i=a(s-=n)).j(t);d(i)&&(i=c),r=r.add(i),e=p(e,l)}return new f(r,e)}function y(e){for(var t=e.g.length+1,s=[],r=0;r<t;r++)s[r]=e.i(r)<<1|e.i(r-1)>>>31;return new n(s,e.h)}function v(e,t){var s=t>>5;t%=32;for(var r=e.g.length-s,i=[],a=0;a<r;a++)i[a]=0<t?e.i(a+s)>>>t|e.i(a+s+1)<<32-t:e.i(a+s);return new n(i,e.h)}(e=n.prototype).m=function(){if(u(this))return-h(this).m();for(var e=0,t=1,s=0;s<this.g.length;s++){var n=this.i(s);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(u(this))return"-"+h(this).toString(e);for(var t=a(Math.pow(e,6)),s=this,n="";;){var r=g(s,t).g,i=((0<(s=p(s,r.j(t))).g.length?s.g[0]:s.h)>>>0).toString(e);if(d(s=r))return i+n;for(;6>i.length;)i="0"+i;n=i+n}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=p(this,e))?-1:d(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),s=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.i(i))+(65535&e.i(i)),o=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,a&=65535,o&=65535,s[i]=o<<16|a}return new n(s,-2147483648&s[s.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return o;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(0>this.l(l)&&0>e.l(l))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,s=[],r=0;r<2*t;r++)s[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var c=this.i(r)>>>16,p=65535&this.i(r),f=e.i(i)>>>16,g=65535&e.i(i);s[2*r+2*i]+=p*g,m(s,2*r+2*i),s[2*r+2*i+1]+=c*g,m(s,2*r+2*i+1),s[2*r+2*i+1]+=p*f,m(s,2*r+2*i+1),s[2*r+2*i+2]+=c*f,m(s,2*r+2*i+2)}for(r=0;r<t;r++)s[r]=s[2*r+1]<<16|s[2*r];for(r=t;r<2*t;r++)s[r]=0;return new n(s,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),s=[],r=0;r<t;r++)s[r]=this.i(r)&e.i(r);return new n(s,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),s=[],r=0;r<t;r++)s[r]=this.i(r)|e.i(r);return new n(s,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),s=[],r=0;r<t;r++)s[r]=this.i(r)^e.i(r);return new n(s,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,uo=po.Md5=t,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.A,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=a,n.fromString=function e(t,s){if(0==t.length)throw Error("number format error: empty string");if(2>(s=s||10)||36<s)throw Error("radix out of range: "+s);if("-"==t.charAt(0))return h(e(t.substring(1),s));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=a(Math.pow(s,8)),r=o,i=0;i<t.length;i+=8){var c=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+c),s);8>c?(c=a(Math.pow(s,c)),r=r.j(c).add(a(l))):r=(r=r.j(n)).add(a(l))}return r},lo=po.Integer=n}).apply("undefined"!==typeof ho?ho:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var mo,fo,go,yo,vo,xo,_o,Eo,bo,wo="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},No={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){return e==Array.prototype||e==Object.prototype||(e[t]=s.value),e};var s=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof wo&&wo];for(var t=0;t<e.length;++t){var s=e[t];if(s&&s.Math==Math)return s}throw Error("Cannot find global object")}(this);!function(e,n){if(n)e:{var r=s;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in r))break e;r=r[a]}(n=n(i=r[e=e[e.length-1]]))!=i&&null!=n&&t(r,e,{configurable:!0,writable:!0,value:n})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var s=0,n=!1,r={next:function(){if(!n&&s<e.length){var r=s++;return{value:t(r,e[r]),done:!1}}return n=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,function(e,t){return t})}});var n=n||{},r=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,s){return e.call.apply(e.bind,arguments)}function c(e,t,s){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,n),e.apply(t,s)}}return function(){return e.apply(t,arguments)}}function l(e,t,s){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:c).apply(null,arguments)}function d(e,t){var s=Array.prototype.slice.call(arguments,1);return function(){var t=s.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function s(){}s.prototype=t.prototype,e.aa=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.Qb=function(e,s,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[s].apply(e,r)}}function h(e){const t=e.length;if(0<t){const s=Array(t);for(let n=0;n<t;n++)s[n]=e[n];return s}return[]}function p(e,t){for(let s=1;s<arguments.length;s++){const t=arguments[s];if(i(t)){const s=e.length||0,n=t.length||0;e.length=s+n;for(let r=0;r<n;r++)e[s+r]=t[r]}else e.push(t)}}function m(e){return/^[\s\xa0]*$/.test(e)}function f(){var e=r.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=-1!=f().indexOf("Gecko")&&!(-1!=f().toLowerCase().indexOf("webkit")&&-1==f().indexOf("Edge"))&&!(-1!=f().indexOf("Trident")||-1!=f().indexOf("MSIE"))&&-1==f().indexOf("Edge");function v(e,t,s){for(const n in e)t.call(s,e[n],n,e)}function x(e){const t={};for(const s in e)t[s]=e[s];return t}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(e,t){let s,n;for(let r=1;r<arguments.length;r++){for(s in n=arguments[r],n)e[s]=n[s];for(let t=0;t<_.length;t++)s=_[t],Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}}function b(e){var t=1;e=e.split(":");const s=[];for(;0<t&&e.length;)s.push(e.shift()),t--;return e.length&&s.push(e.join(":")),s}function w(e){r.setTimeout(()=>{throw e},0)}function N(){var e=I;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,R=!1,I=new class{constructor(){this.h=this.g=null}add(e,t){const s=S.get();s.set(e,t),this.h?this.h.next=s:this.g=s,this.h=s}},A=()=>{const e=r.Promise.resolve(void 0);C=()=>{e.then(O)}};var O=()=>{for(var e;e=N();){try{e.h.call(e.g)}catch(s){w(s)}var t=S;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}R=!1};function j(){this.s=this.s,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.s=!1,j.prototype.ma=function(){this.s||(this.s=!0,this.N())},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch(s){}return e}();function P(e,t){if(k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var s=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var r=!0;break e}catch(ze){}r=!1}r||(t=null)}}else"mouseover"==s?t=e.fromElement:"mouseout"==s&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:L[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&P.aa.h.call(this)}}u(P,k);var L={2:"touch",3:"pen",4:"mouse"};P.prototype.h=function(){P.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(e,t,s,n,r){this.listener=e,this.proxy=null,this.src=t,this.type=s,this.capture=!!n,this.ha=r,this.key=++U,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function G(e,t){var s=t.type;if(s in e.g){var n,r=e.g[s],i=Array.prototype.indexOf.call(r,t,void 0);(n=0<=i)&&Array.prototype.splice.call(r,i,1),n&&(F(t),0==e.g[s].length&&(delete e.g[s],e.h--))}}function W(e,t,s,n){for(var r=0;r<e.length;++r){var i=e[r];if(!i.da&&i.listener==t&&i.capture==!!s&&i.ha==n)return r}return-1}B.prototype.add=function(e,t,s,n,r){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var a=W(e,t,n,r);return-1<a?(t=e[a],s||(t.fa=!1)):((t=new V(t,this.src,i,!!n,r)).fa=s,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),K={};function z(e,t,s,n,r){if(n&&n.once)return Y(e,t,s,n,r);if(Array.isArray(t)){for(var i=0;i<t.length;i++)z(e,t[i],s,n,r);return null}return s=te(s),e&&e[M]?e.K(t,s,a(n)?!!n.capture:!!n,r):q(e,t,s,!1,n,r)}function q(e,t,s,n,r,i){if(!t)throw Error("Invalid event type");var o=a(r)?!!r.capture:!!r,c=$(e);if(c||(e[H]=c=new B(e)),(s=c.add(t,s,n,o,i)).proxy)return s;if(n=function(){function e(s){return t.call(e.src,e.listener,s)}const t=Z;return e}(),s.proxy=n,n.src=e,n.listener=s,e.addEventListener)D||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),n,r);else if(e.attachEvent)e.attachEvent(Q(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return s}function Y(e,t,s,n,r){if(Array.isArray(t)){for(var i=0;i<t.length;i++)Y(e,t[i],s,n,r);return null}return s=te(s),e&&e[M]?e.L(t,s,a(n)?!!n.capture:!!n,r):q(e,t,s,!0,n,r)}function X(e,t,s,n,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)X(e,t[i],s,n,r);else n=a(n)?!!n.capture:!!n,s=te(s),e&&e[M]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(s=W(i=e.g[t],s,n,r))&&(F(i[s]),Array.prototype.splice.call(i,s,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=$(e))&&(t=e.g[t.toString()],e=-1,t&&(e=W(t,s,n,r)),(s=-1<e?t[e]:null)&&J(s))}function J(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])G(t.i,e);else{var s=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(s,n,e.capture):t.detachEvent?t.detachEvent(Q(s),n):t.addListener&&t.removeListener&&t.removeListener(n),(s=$(t))?(G(s,e),0==s.h&&(s.src=null,t[H]=null)):F(e)}}}function Q(e){return e in K?K[e]:K[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new P(t,this);var s=e.listener,n=e.ha||e.src;e.fa&&J(e),e=s.call(n,t)}return e}function $(e){return(e=e[H])instanceof B?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function se(){j.call(this),this.i=new B(this),this.M=this,this.F=null}function ne(e,t){var s,n=e.F;if(n)for(s=[];n;n=n.F)s.push(n);if(e=e.M,n=t.type||t,"string"===typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var r=t;E(t=new k(n,e),r)}if(r=!0,s)for(var i=s.length-1;0<=i;i--){var a=t.g=s[i];r=re(a,n,!0,t)&&r}if(r=re(a=t.g=e,n,!0,t)&&r,r=re(a,n,!1,t)&&r,s)for(i=0;i<s.length;i++)r=re(a=t.g=s[i],n,!1,t)&&r}function re(e,t,s,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var a=t[i];if(a&&!a.da&&a.capture==s){var o=a.listener,c=a.ha||a.src;a.fa&&G(e.i,a),r=!1!==o.call(c,n)&&r}}return r&&!n.defaultPrevented}function ie(e,t,s){if("function"===typeof e)s&&(e=l(e,s));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:r.setTimeout(e,t||0)}function ae(e){e.g=ie(()=>{e.g=null,e.i&&(e.i=!1,ae(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(se,j),se.prototype[M]=!0,se.prototype.removeEventListener=function(e,t,s,n){X(this,e,t,s,n)},se.prototype.N=function(){if(se.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var s=t.g[e],n=0;n<s.length;n++)F(s[n]);delete t.g[e],t.h--}}this.F=null},se.prototype.K=function(e,t,s,n){return this.i.add(String(e),t,!1,s,n)},se.prototype.L=function(e,t,s,n){return this.i.add(String(e),t,!0,s,n)};class oe extends j{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ae(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){j.call(this),this.h=e,this.g={}}u(ce,j);var le=[];function de(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&J(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),de(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ue=r.JSON.stringify,he=r.JSON.parse,pe=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function me(){}function fe(e){return e.h||(e.h=e.i())}function ge(){}me.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){k.call(this,"d")}function xe(){k.call(this,"c")}u(ve,k),u(xe,k);var _e={},Ee=null;function be(){return Ee=Ee||new se}function we(e){k.call(this,_e.La,e)}function Ne(e){const t=be();ne(t,new we(t))}function Se(e,t){k.call(this,_e.STAT_EVENT,e),this.stat=t}function Te(e){const t=be();ne(t,new Se(t,e))}function Ce(e,t){k.call(this,_e.Ma,e),this.size=t}function Re(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){e()},t)}function Ie(){this.g=!0}function Ae(e,t,s,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var s=JSON.parse(t);if(s)for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var a=1;a<r.length;a++)r[a]=""}}}return ue(s)}catch(Ke){return t}}(e,s)+(n?" "+n:"")})}_e.La="serverreachability",u(we,k),_e.STAT_EVENT="statevent",u(Se,k),_e.Ma="timingevent",u(Ce,k),Ie.prototype.xa=function(){this.g=!1},Ie.prototype.info=function(){};var Oe,je={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ke={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Pe(e,t,s,n){this.j=e,this.i=t,this.l=s,this.R=n||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Le}function Le(){this.i=null,this.g="",this.h=!1}u(De,me),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Oe=new De;var Me={},Ue={};function Ve(e,t,s){e.L=1,e.v=ft(dt(t)),e.m=s,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),He(e),e.A=dt(e.v);var s=e.A,n=e.R;Array.isArray(n)||(n=[String(n)]),It(s.i,"t",n),e.C=0,s=e.j.J,e.h=new Le,e.g=gs(e.j,s?t:null,!e.m),0<e.O&&(e.M=new oe(l(e.Y,e,e.g),e.O)),t=e.U,s=e.g,n=e.ca;var r="readystatechange";Array.isArray(r)||(r&&(le[0]=r.toString()),r=le);for(var i=0;i<r.length;i++){var a=z(s,r[i],n||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?x(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ne(),function(e,t,s,n,r,i){e.info(function(){if(e.g)if(i)for(var a="",o=i.split("&"),c=0;c<o.length;c++){var l=o[c].split("=");if(1<l.length){var d=l[0];l=l[1];var u=d.split("_");a=2<=u.length&&"type"==u[1]?a+(d+"=")+l+"&":a+(d+"=redacted&")}}else a=null;else a=i;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+t+"\n"+s+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Be(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ge(e,t){var s=e.C,n=t.indexOf("\n",s);return-1==n?Ue:(s=Number(t.substring(s,n)),isNaN(s)?Me:(n+=1)+s>t.length?Ue:(t=t.slice(n,n+s),e.C=n+s,t))}function He(e){e.S=Date.now()+e.I,qe(e,e.I)}function qe(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Re(l(e.ba,e),t)}function Ye(e){e.B&&(r.clearTimeout(e.B),e.B=null)}function Xe(e){0==e.j.G||e.J||us(e.j,e)}function Je(e){Ye(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,de(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Qe(e,t){try{var s=e.j;if(0!=s.G&&(s.g==e||nt(s.h,e)))if(!e.K&&nt(s.h,e)&&3==s.G){try{var n=s.Da.g.parse(t)}catch(d){n=null}if(Array.isArray(n)&&3==n.length){var r=n;if(0==r[0]){e:if(!s.u){if(s.g){if(!(s.g.F+3e3<e.F))break e;ds(s),es(s)}os(s),Te(18)}}else s.za=r[1],0<s.za-s.T&&37500>r[2]&&s.F&&0==s.v&&!s.C&&(s.C=Re(l(s.Za,s),6e3));if(1>=st(s.h)&&s.ca){try{s.ca()}catch(d){}s.ca=void 0}}else ps(s,11)}else if((e.K||s.g==e)&&ds(s),!m(t))for(r=s.Da.g.parse(t),t=0;t<r.length;t++){let l=r[t];if(s.T=l[0],l=l[1],2==s.G)if("c"==l[0]){s.K=l[1],s.ia=l[2];const t=l[3];null!=t&&(s.la=t,s.j.info("VER="+s.la));const r=l[4];null!=r&&(s.Aa=r,s.j.info("SVER="+s.Aa));const d=l[5];null!=d&&"number"===typeof d&&0<d&&(n=1.5*d,s.L=n,s.j.info("backChannelRequestTimeoutMs_="+n)),n=s;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=n.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(rt(i,i.h),i.h=null))}if(n.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.ya=e,mt(n.I,n.D,e))}}s.G=3,s.l&&s.l.ua(),s.ba&&(s.R=Date.now()-e.F,s.j.info("Handshake RTT: "+s.R+"ms"));var a=e;if((n=s).qa=fs(n,n.J?n.ia:null,n.W),a.K){it(n.h,a);var o=a,c=n.L;c&&(o.I=c),o.B&&(Ye(o),He(o)),n.g=a}else as(n);0<s.i.length&&ss(s)}else"stop"!=l[0]&&"close"!=l[0]||ps(s,7);else 3==s.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?ps(s,7):$t(s):"noop"!=l[0]&&s.l&&s.l.ta(l),s.v=0)}Ne()}catch(d){}}Pe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Xt(e)?t.j():this.Y(e)},Pe.prototype.Y=function(e){try{if(e==this.g)e:{const h=Xt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Jt(this.g)))){this.J||4!=h||7==t||Ne(),Ye(this);var s=this.g.Z();this.X=s;t:if(Be(this)){var n=Jt(this.g);e="";var i=n.length,a=4==Xt(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Je(this),Xe(this);var o="";break t}this.h.i=new r.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:!(a&&t==i-1)});n.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==s,function(e,t,s,n,r,i,a){e.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+t+"\n"+s+"\n"+i+" "+a})}(this.i,this.u,this.A,this.l,this.R,h,s),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(c)){var d=c;break t}}d=null}if(!(s=d)){this.o=!1,this.s=3,Te(12),Je(this),Xe(this);break e}Ae(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qe(this,s)}if(this.P){let e;for(s=!0;!this.J&&this.C<o.length;){if(e=Ge(this,o),e==Ue){4==h&&(this.s=4,Te(14),s=!1),Ae(this.i,this.l,null,"[Incomplete Response]");break}if(e==Me){this.s=4,Te(15),Ae(this.i,this.l,o,"[Invalid Chunk]"),s=!1;break}Ae(this.i,this.l,e,null),Qe(this,e)}if(Be(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=o.length||this.h.h||(this.s=1,Te(16),s=!1),this.o=this.o&&s,s){if(0<o.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),cs(u),u.M=!0,Te(11))}}else Ae(this.i,this.l,o,"[Invalid Chunked Response]"),Je(this),Xe(this)}else Ae(this.i,this.l,o,null),Qe(this,o);4==h&&Je(this),this.o&&!this.J&&(4==h?us(this.j,this):(this.o=!1,He(this)))}else(function(e){const t={};e=(e.g&&2<=Xt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(m(e[n]))continue;var s=b(e[n]);const r=s[0];if("string"!==typeof(s=s[1]))continue;s=s.trim();const i=t[r]||[];t[r]=i,i.push(s)}!function(e,t){for(const s in e)t.call(void 0,e[s],s,e)}(t,function(e){return e.join(", ")})})(this.g),400==s&&0<o.indexOf("Unknown SID")?(this.s=3,Te(12)):(this.s=0,Te(13)),Je(this),Xe(this)}}}catch(h){}},Pe.prototype.cancel=function(){this.J=!0,Je(this)},Pe.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Ne(),Te(17)),Je(this),this.s=2,Xe(this)):qe(this,this.S-e)};var Ze=class{constructor(e,t){this.g=e,this.map=t}};function et(e){this.l=e||10,r.PerformanceNavigationTiming?e=0<(e=r.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function tt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function st(e){return e.h?1:e.g?e.g.size:0}function nt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function rt(e,t){e.g?e.g.add(t):e.h=t}function it(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function at(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const s of e.g.values())t=t.concat(s.D);return t}return h(e.i)}function ot(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var s=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(i(e)||"string"===typeof e){var t=[];e=e.length;for(var s=0;s<e;s++)t.push(s);return t}t=[],s=0;for(const n in e)t[s++]=n;return t}}}(e),n=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(i(e)){for(var t=[],s=e.length,n=0;n<s;n++)t.push(e[n]);return t}for(n in t=[],s=0,e)t[s++]=e[n];return t}(e),r=n.length,a=0;a<r;a++)t.call(void 0,n[a],s&&s[a],e)}et.prototype.cancel=function(){if(this.i=at(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ct=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof lt){this.h=e.h,ut(this,e.j),this.o=e.o,this.g=e.g,ht(this,e.s),this.l=e.l;var t=e.i,s=new St;s.i=t.i,t.g&&(s.g=new Map(t.g),s.h=t.h),pt(this,s),this.m=e.m}else e&&(t=String(e).match(ct))?(this.h=!1,ut(this,t[1]||"",!0),this.o=gt(t[2]||""),this.g=gt(t[3]||"",!0),ht(this,t[4]),this.l=gt(t[5]||"",!0),pt(this,t[6]||"",!0),this.m=gt(t[7]||"")):(this.h=!1,this.i=new St(null,this.h))}function dt(e){return new lt(e)}function ut(e,t,s){e.j=s?gt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ht(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function pt(e,t,s){t instanceof St?(e.i=t,function(e,t){t&&!e.j&&(Tt(e),e.i=null,e.g.forEach(function(e,t){var s=t.toLowerCase();t!=s&&(Ct(this,t),It(this,s,e))},e)),e.j=t}(e.i,e.h)):(s||(t=yt(t,wt)),e.i=new St(t,e.h))}function mt(e,t,s){e.i.set(t,s)}function ft(e){return mt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function gt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function yt(e,t,s){return"string"===typeof e?(e=encodeURI(e).replace(t,vt),s&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function vt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}lt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(yt(t,_t,!0),":");var s=this.g;return(s||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(yt(t,_t,!0),"@"),e.push(encodeURIComponent(String(s)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(s=this.s)&&e.push(":",String(s))),(s=this.l)&&(this.g&&"/"!=s.charAt(0)&&e.push("/"),e.push(yt(s,"/"==s.charAt(0)?bt:Et,!0))),(s=this.i.toString())&&e.push("?",s),(s=this.m)&&e.push("#",yt(s,Nt)),e.join("")};var xt,_t=/[#\/\?@]/g,Et=/[#\?:]/g,bt=/[#\?]/g,wt=/[#\?@]/g,Nt=/#/g;function St(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Tt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var s=0;s<e.length;s++){var n=e[s].indexOf("="),r=null;if(0<=n){var i=e[s].substring(0,n);r=e[s].substring(n+1)}else i=e[s];t(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,s){e.add(decodeURIComponent(t.replace(/\+/g," ")),s)}))}function Ct(e,t){Tt(e),t=At(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Rt(e,t){return Tt(e),t=At(e,t),e.g.has(t)}function It(e,t,s){Ct(e,t),0<s.length&&(e.i=null,e.g.set(At(e,t),h(s)),e.h+=s.length)}function At(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ot(e,t,s,n,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),n(s)}catch(ze){}}function jt(){this.g=new pe}function kt(e,t,s){const n=s||"";try{ot(e,function(e,s){let r=e;a(e)&&(r=ue(e)),t.push(n+s+"="+encodeURIComponent(r))})}catch(V_){throw t.push(n+"type="+encodeURIComponent("_badmap")),V_}}function Dt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Pt(e,t){se.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Lt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Mt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ut(e)}function Ut(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Vt(e){let t="";return v(e,function(e,s){t+=s,t+=":",t+=e,t+="\r\n"}),t}function Ft(e,t,s){e:{for(n in s){var n=!1;break e}n=!0}n||(s=Vt(s),"string"===typeof e?null!=s&&encodeURIComponent(String(s)):mt(e,t,s))}function Bt(e){se.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=St.prototype).add=function(e,t){Tt(this),this.i=null,e=At(this,e);var s=this.g.get(e);return s||this.g.set(e,s=[]),s.push(t),this.h+=1,this},e.forEach=function(e,t){Tt(this),this.g.forEach(function(s,n){s.forEach(function(s){e.call(t,s,n,this)},this)},this)},e.na=function(){Tt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),s=[];for(let n=0;n<t.length;n++){const r=e[n];for(let e=0;e<r.length;e++)s.push(t[n])}return s},e.V=function(e){Tt(this);let t=[];if("string"===typeof e)Rt(this,e)&&(t=t.concat(this.g.get(At(this,e))));else{e=Array.from(this.g.values());for(let s=0;s<e.length;s++)t=t.concat(e[s])}return t},e.set=function(e,t){return Tt(this),this.i=null,Rt(this,e=At(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var s=0;s<t.length;s++){var n=t[s];const i=encodeURIComponent(String(n)),a=this.V(n);for(n=0;n<a.length;n++){var r=i;""!==a[n]&&(r+="="+encodeURIComponent(String(a[n]))),e.push(r)}}return this.i=e.join("&")},u(Dt,me),Dt.prototype.g=function(){return new Pt(this.l,this.j)},Dt.prototype.i=(xt={},function(){return xt}),u(Pt,se),(e=Pt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ut(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||r).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ut(this)),this.g&&(this.readyState=3,Ut(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mt(this):Ut(this),3==this.readyState&&Lt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Mt(this))},e.Qa=function(e){this.g&&(this.response=e,Mt(this))},e.ga=function(){this.g&&Mt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var s=t.next();!s.done;)s=s.value,e.push(s[0]+": "+s[1]),s=t.next();return e.join("\r\n")},Object.defineProperty(Pt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Bt,se);var Gt=/^https?$/i,Wt=["POST","PUT"];function Ht(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Kt(e),qt(e)}function Kt(e){e.A||(e.A=!0,ne(e,"complete"),ne(e,"error"))}function zt(e){if(e.h&&"undefined"!=typeof n&&(!e.v[1]||4!=Xt(e)||2!=e.Z()))if(e.u&&4==Xt(e))ie(e.Ea,0,e);else if(ne(e,"readystatechange"),4==Xt(e)){e.h=!1;try{const n=e.Z();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var s;if(!(s=t)){var i;if(i=0===n){var a=String(e.D).match(ct)[1]||null;!a&&r.self&&r.self.location&&(a=r.self.location.protocol.slice(0,-1)),i=!Gt.test(a?a.toLowerCase():"")}s=i}if(s)ne(e,"complete"),ne(e,"success");else{e.m=6;try{var o=2<Xt(e)?e.g.statusText:""}catch(Ke){o=""}e.l=o+" ["+e.Z()+"]",Kt(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){Yt(e);const s=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ne(e,"ready");try{s.onreadystatechange=n}catch(V_){}}}function Yt(e){e.I&&(r.clearTimeout(e.I),e.I=null)}function Xt(e){return e.g?e.g.readyState:0}function Jt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch($e){return null}}function Qt(e,t,s){return s&&s.internalChannelParams&&s.internalChannelParams[e]||t}function Zt(e){this.Aa=0,this.i=[],this.j=new Ie,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qt("baseRetryDelayMs",5e3,e),this.cb=Qt("retryDelaySeedMs",1e4,e),this.Wa=Qt("forwardChannelMaxRetries",2,e),this.wa=Qt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new et(e&&e.concurrentRequestLimit),this.Da=new jt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function $t(e){if(ts(e),3==e.G){var t=e.U++,s=dt(e.I);if(mt(s,"SID",e.K),mt(s,"RID",t),mt(s,"TYPE","terminate"),rs(e,s),(t=new Pe(e,e.j,t)).L=2,t.v=ft(dt(s)),s=!1,r.navigator&&r.navigator.sendBeacon)try{s=r.navigator.sendBeacon(t.v.toString(),"")}catch(We){}!s&&r.Image&&((new Image).src=t.v,s=!0),s||(t.g=gs(t.j,null),t.g.ea(t.v)),t.F=Date.now(),He(t)}ms(e)}function es(e){e.g&&(cs(e),e.g.cancel(),e.g=null)}function ts(e){es(e),e.u&&(r.clearTimeout(e.u),e.u=null),ds(e),e.h.cancel(),e.s&&("number"===typeof e.s&&r.clearTimeout(e.s),e.s=null)}function ss(e){if(!tt(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||A(),R||(C(),R=!0),I.add(t,e),e.B=0}}function ns(e,t){var s;s=t?t.l:e.U++;const n=dt(e.I);mt(n,"SID",e.K),mt(n,"RID",s),mt(n,"AID",e.T),rs(e,n),e.m&&e.o&&Ft(n,e.m,e.o),s=new Pe(e,e.j,s,e.B+1),null===e.m&&(s.H=e.o),t&&(e.i=t.D.concat(e.i)),t=is(e,s,1e3),s.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),rt(e.h,s),Ve(s,n,t)}function rs(e,t){e.H&&v(e.H,function(e,s){mt(t,s,e)}),e.l&&ot({},function(e,s){mt(t,s,e)})}function is(e,t,s){s=Math.min(e.i.length,s);var n=e.l?l(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+s];-1==t?0<s?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let a=!0;for(let o=0;o<s;o++){let s=r[o].g;const c=r[o].map;if(s-=t,0>s)t=Math.max(0,r[o].g-100),a=!1;else try{kt(c,e,"req"+s+"_")}catch(i){n&&n(c)}}if(a){n=e.join("&");break e}}}return e=e.i.splice(0,s),t.D=e,n}function as(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||A(),R||(C(),R=!0),I.add(t,e),e.v=0}}function os(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Re(l(e.Fa,e),hs(e,e.v)),e.v++,!0)}function cs(e){null!=e.A&&(r.clearTimeout(e.A),e.A=null)}function ls(e){e.g=new Pe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=dt(e.qa);mt(t,"RID","rpc"),mt(t,"SID",e.K),mt(t,"AID",e.T),mt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&mt(t,"TO",e.ja),mt(t,"TYPE","xmlhttp"),rs(e,t),e.m&&e.o&&Ft(t,e.m,e.o),e.L&&(e.g.I=e.L);var s=e.g;e=e.ia,s.L=1,s.v=ft(dt(t)),s.m=null,s.P=!0,Fe(s,e)}function ds(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function us(e,t){var s=null;if(e.g==t){ds(e),cs(e),e.g=null;var n=2}else{if(!nt(e.h,t))return;s=t.D,it(e.h,t),n=1}if(0!=e.G)if(t.o)if(1==n){s=t.m?t.m.length:0,t=Date.now()-t.F;var r=e.B;ne(n=be(),new Ce(n,s)),ss(e)}else as(e);else if(3==(r=t.s)||0==r&&0<t.X||!(1==n&&function(e,t){return!(st(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Re(l(e.Ga,e,t),hs(e,e.B)),e.B++,!0))}(e,t)||2==n&&os(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),r){case 1:ps(e,5);break;case 4:ps(e,10);break;case 3:ps(e,6);break;default:ps(e,2)}}function hs(e,t){let s=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(s*=2),s*t}function ps(e,t){if(e.j.info("Error code "+t),2==t){var s=l(e.fb,e),n=e.Xa;const t=!n;n=new lt(n||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||ut(n,"https"),ft(n),t?function(e,t){const s=new Ie;if(r.Image){const n=new Image;n.onload=d(Ot,s,"TestLoadImage: loaded",!0,t,n),n.onerror=d(Ot,s,"TestLoadImage: error",!1,t,n),n.onabort=d(Ot,s,"TestLoadImage: abort",!1,t,n),n.ontimeout=d(Ot,s,"TestLoadImage: timeout",!1,t,n),r.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),s):function(e,t){new Ie;const s=new AbortController,n=setTimeout(()=>{s.abort(),Ot(0,0,!1,t)},1e4);fetch(e,{signal:s.signal}).then(e=>{clearTimeout(n),e.ok?Ot(0,0,!0,t):Ot(0,0,!1,t)}).catch(()=>{clearTimeout(n),Ot(0,0,!1,t)})}(n.toString(),s)}else Te(2);e.G=0,e.l&&e.l.sa(t),ms(e),ts(e)}function ms(e){if(e.G=0,e.ka=[],e.l){const t=at(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function fs(e,t,s){var n=s instanceof lt?dt(s):new lt(s);if(""!=n.g)t&&(n.g=t+"."+n.g),ht(n,n.s);else{var i=r.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var a=new lt(null);n&&ut(a,n),t&&(a.g=t),i&&ht(a,i),s&&(a.l=s),n=a}return s=e.D,t=e.ya,s&&t&&mt(n,s,t),mt(n,"VER",e.la),rs(e,n),n}function gs(e,t,s){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Bt(new Dt({eb:s})):new Bt(e.pa)).Ha(e.J),t}function ys(){}function vs(){}function xs(e,t){se.call(this),this.g=new Zt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new bs(this)}function _s(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const s in t){e=s;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Es(){xe.call(this),this.status=1}function bs(e){this.g=e}(e=Bt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,s,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Oe.g(),this.v=this.o?fe(this.o):fe(Oe),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(ze){return void Ht(this,ze)}if(e=s||"",s=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)s.set(i,n[i]);else{if("function"!==typeof n.keys||"function"!==typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const e of n.keys())s.set(e,n.get(e))}n=Array.from(s.keys()).find(e=>"content-type"==e.toLowerCase()),i=r.FormData&&e instanceof r.FormData,!(0<=Array.prototype.indexOf.call(Wt,t,void 0))||n||i||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,a]of s)this.g.setRequestHeader(r,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Yt(this),this.u=!0,this.g.send(e),this.u=!1}catch(ze){Ht(this,ze)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ne(this,"complete"),ne(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),Bt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?zt(this):this.bb())},e.bb=function(){zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Xt(this)?this.g.status:-1}catch(xt){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(xt){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Zt.prototype).la=8,e.G=1,e.connect=function(e,t,s,n){Te(0),this.W=e,this.H=t||{},s&&void 0!==n&&(this.H.OSID=s,this.H.OAID=n),this.F=this.X,this.I=fs(this,null,this.W),ss(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const r=new Pe(this,this.j,e);let i=this.o;if(this.S&&(i?(i=x(i),E(i,this.S)):i=this.S),null!==this.m||this.O||(r.H=i,i=null),this.P)e:{for(var t=0,s=0;s<this.i.length;s++){var n=this.i[s];if(void 0===(n="__data__"in n.map&&"string"===typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(t+=n)){t=s;break e}if(4096===t||s===this.i.length-1){t=s+1;break e}}t=1e3}else t=1e3;t=is(this,r,t),mt(s=dt(this.I),"RID",e),mt(s,"CVER",22),this.D&&mt(s,"X-HTTP-Session-Id",this.D),rs(this,s),i&&(this.O?t="headers="+encodeURIComponent(String(Vt(i)))+"&"+t:this.m&&Ft(s,this.m,i)),rt(this.h,r),this.Ua&&mt(s,"TYPE","init"),this.P?(mt(s,"$req",t),mt(s,"SID","null"),r.T=!0,Ve(r,s,null)):Ve(r,s,t),this.G=2}}else 3==this.G&&(e?ns(this,e):0==this.i.length||tt(this.h)||ns(this))},e.Fa=function(){if(this.u=null,ls(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Re(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Te(10),es(this),ls(this))},e.Za=function(){null!=this.C&&(this.C=null,es(this),os(this),Te(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=ys.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},vs.prototype.g=function(e,t){return new xs(e,t)},u(xs,se),xs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},xs.prototype.close=function(){$t(this.g)},xs.prototype.o=function(e){var t=this.g;if("string"===typeof e){var s={};s.__data__=e,e=s}else this.u&&((s={}).__data__=ue(e),e=s);t.i.push(new Ze(t.Ya++,e)),3==t.G&&ss(t)},xs.prototype.N=function(){this.g.l=null,delete this.j,$t(this.g),delete this.g,xs.aa.N.call(this)},u(_s,ve),u(Es,xe),u(bs,ys),bs.prototype.ua=function(){ne(this.g,"a")},bs.prototype.ta=function(e){ne(this.g,new _s(e))},bs.prototype.sa=function(e){ne(this.g,new Es)},bs.prototype.ra=function(){ne(this.g,"b")},vs.prototype.createWebChannel=vs.prototype.g,xs.prototype.send=xs.prototype.o,xs.prototype.open=xs.prototype.m,xs.prototype.close=xs.prototype.close,bo=No.createWebChannelTransport=function(){return new vs},Eo=No.getStatEventTarget=function(){return be()},_o=No.Event=_e,xo=No.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,vo=No.ErrorCode=je,ke.COMPLETE="complete",yo=No.EventType=ke,ge.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",se.prototype.listen=se.prototype.K,go=No.WebChannel=ge,fo=No.FetchXmlHttpFactory=Dt,Bt.prototype.listenOnce=Bt.prototype.L,Bt.prototype.getLastError=Bt.prototype.Ka,Bt.prototype.getLastErrorCode=Bt.prototype.Ba,Bt.prototype.getStatus=Bt.prototype.Z,Bt.prototype.getResponseJson=Bt.prototype.Oa,Bt.prototype.getResponseText=Bt.prototype.oa,Bt.prototype.send=Bt.prototype.ea,Bt.prototype.setWithCredentials=Bt.prototype.Ha,mo=No.XhrIo=Bt}).apply("undefined"!==typeof wo?wo:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const So="@firebase/firestore";class To{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}To.UNAUTHENTICATED=new To(null),To.GOOGLE_CREDENTIALS=new To("google-credentials-uid"),To.FIRST_PARTY=new To("first-party-uid"),To.MOCK_USER=new To("mock-user");let Co="10.12.1";const Ro=new es("@firebase/firestore");function Io(){return Ro.logLevel}function Ao(e){if(Ro.logLevel<=Xt.DEBUG){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const r=s.map(ko);Ro.debug("Firestore (".concat(Co,"): ").concat(e),...r)}}function Oo(e){if(Ro.logLevel<=Xt.ERROR){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const r=s.map(ko);Ro.error("Firestore (".concat(Co,"): ").concat(e),...r)}}function jo(e){if(Ro.logLevel<=Xt.WARN){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const r=s.map(ko);Ro.warn("Firestore (".concat(Co,"): ").concat(e),...r)}}function ko(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Do(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(Co,") INTERNAL ASSERTION FAILED: ")+e;throw Oo(t),new Error(t)}function Po(e,t){e||Do()}function Lo(e,t){return e}const Mo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Uo extends kt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class Vo{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Fo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class Bo{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(To.UNAUTHENTICATED))}shutdown(){}}class Go{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Wo{constructor(e){this.t=e,this.currentUser=To.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let s=this.i;const n=e=>this.i!==s?(s=this.i,t(e)):Promise.resolve();let r=new Vo;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Vo,e.enqueueRetryable(()=>n(this.currentUser))};const i=()=>{const t=r;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{Ao("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(Ao("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Vo)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Ao("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Po("string"==typeof t.accessToken),new Fo(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Po(null===e||"string"==typeof e),new To(e)}}class Ho{constructor(e,t,s){this.l=e,this.h=t,this.P=s,this.type="FirstParty",this.user=To.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ko{constructor(e,t,s){this.l=e,this.h=t,this.P=s}getToken(){return Promise.resolve(new Ho(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(To.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class zo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qo{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const s=e=>{null!=e.error&&Ao("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const s=e.token!==this.R;return this.R=e.token,Ao("FirebaseAppCheckTokenProvider","Received ".concat(s?"new":"existing"," token.")),s?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>s(t))};const n=e=>{Ao("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?n(e):Ao("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Po("string"==typeof e.token),this.R=e.token,new zo(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Yo(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),s=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(s);else for(let n=0;n<e;n++)s[n]=Math.floor(256*Math.random());return s}class Xo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let s="";for(;s.length<20;){const n=Yo(40);for(let r=0;r<n.length;++r)s.length<20&&n[r]<t&&(s+=e.charAt(n[r]%62))}return s}}function Jo(e,t){return e<t?-1:e>t?1:0}function Qo(e,t,s){return e.length===t.length&&e.every((e,n)=>s(e,t[n]))}class Zo{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Uo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Uo(Mo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Uo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Uo(Mo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Zo.fromMillis(Date.now())}static fromDate(e){return Zo.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*t));return new Zo(t,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Jo(this.nanoseconds,e.nanoseconds):Jo(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class $o{constructor(e){this.timestamp=e}static fromTimestamp(e){return new $o(e)}static min(){return new $o(new Zo(0,0))}static max(){return new $o(new Zo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ec{constructor(e,t,s){void 0===t?t=0:t>e.length&&Do(),void 0===s?s=e.length-t:s>e.length-t&&Do(),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return 0===ec.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ec?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let n=0;n<s;n++){const s=e.get(n),r=t.get(n);if(s<r)return-1;if(s>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class tc extends ec{construct(e,t,s){return new tc(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];for(const r of s){if(r.indexOf("//")>=0)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid segment (".concat(r,"). Paths must not contain // in them."));e.push(...r.split("/").filter(e=>e.length>0))}return new tc(e)}static emptyPath(){return new tc([])}}const sc=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nc extends ec{construct(e,t,s){return new nc(e,t,s)}static isValidIdentifier(e){return sc.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nc.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new nc(["__name__"])}static fromServerFormat(e){const t=[];let s="",n=0;const r=()=>{if(0===s.length)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(s),s=""};let i=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new Uo(Mo.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Uo(Mo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=t,n+=2}else"`"===t?(i=!i,n++):"."!==t||i?(s+=t,n++):(r(),n++)}if(r(),i)throw new Uo(Mo.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nc(t)}static emptyPath(){return new nc([])}}class rc{constructor(e){this.path=e}static fromPath(e){return new rc(tc.fromString(e))}static fromName(e){return new rc(tc.fromString(e).popFirst(5))}static empty(){return new rc(tc.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===tc.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return tc.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rc(new tc(e.slice()))}}class ic{constructor(e,t,s,n){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=n}}ic.UNKNOWN_ID=-1;function ac(e,t){const s=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,r=$o.fromTimestamp(1e9===n?new Zo(s+1,0):new Zo(s,n));return new cc(r,rc.empty(),t)}function oc(e){return new cc(e.readTime,e.key,-1)}class cc{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new cc($o.min(),rc.empty(),-1)}static max(){return new cc($o.max(),rc.empty(),-1)}}function lc(e,t){let s=e.readTime.compareTo(t.readTime);return 0!==s?s:(s=rc.comparator(e.documentKey,t.documentKey),0!==s?s:Jo(e.largestBatchId,t.largestBatchId))}const dc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class uc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function hc(e){if(e.code!==Mo.FAILED_PRECONDITION||e.message!==dc)throw e;Ao("LocalStore","Unexpectedly lost primary lease")}class pc{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Do(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new pc((s,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(s,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(s,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof pc?t:pc.resolve(t)}catch(e){return pc.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):pc.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):pc.reject(t)}static resolve(e){return new pc((t,s)=>{t(e)})}static reject(e){return new pc((t,s)=>{s(e)})}static waitFor(e){return new pc((t,s)=>{let n=0,r=0,i=!1;e.forEach(e=>{++n,e.next(()=>{++r,i&&r===n&&t()},e=>s(e))}),i=!0,r===n&&t()})}static or(e){let t=pc.resolve(!1);for(const s of e)t=t.next(e=>e?pc.resolve(e):s());return t}static forEach(e,t){const s=[];return e.forEach((e,n)=>{s.push(t.call(this,e,n))}),this.waitFor(s)}static mapArray(e,t){return new pc((s,n)=>{const r=e.length,i=new Array(r);let a=0;for(let o=0;o<r;o++){const c=o;t(e[c]).next(e=>{i[c]=e,++a,a===r&&s(i)},e=>n(e))}})}static doWhile(e,t){return new pc((s,n)=>{const r=()=>{!0===e()?t().next(()=>{r()},n):s()};r()})}}function mc(e){const t=e.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function fc(e){return"IndexedDbTransactionError"===e.name}class gc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function yc(e){return null==e}function vc(e){return 0===e&&1/e==-1/0}function xc(e){return"number"==typeof e&&Number.isInteger(e)&&!vc(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}gc.oe=-1;const _c=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ec=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],bc=Ec;function wc(e){let t=0;for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t++;return t}function Nc(e,t){for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t(s,e[s])}function Sc(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Tc{constructor(e,t){this.comparator=e,this.root=t||Rc.EMPTY}insert(e,t){return new Tc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Rc.BLACK,null,null))}remove(e){return new Tc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(0===s)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const n=this.comparator(e,s.key);if(0===n)return t+s.left.size;n<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push("".concat(t,":").concat(s)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Cc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Cc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Cc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Cc(this.root,e,this.comparator,!0)}}class Cc{constructor(e,t,s,n){this.isReverse=n,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?s(e.key,t):1,t&&n&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Rc{constructor(e,t,s,n,r){this.key=e,this.value=t,this.color=null!=s?s:Rc.RED,this.left=null!=n?n:Rc.EMPTY,this.right=null!=r?r:Rc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,n,r){return new Rc(null!=e?e:this.key,null!=t?t:this.value,null!=s?s:this.color,null!=n?n:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let n=this;const r=s(e,n.key);return n=r<0?n.copy(null,null,null,n.left.insert(e,t,s),null):0===r?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,s)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Rc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,n=this;if(t(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return Rc.EMPTY;s=n.right.min(),n=n.copy(s.key,s.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Rc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Rc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Do();if(this.right.isRed())throw Do();const e=this.left.check();if(e!==this.right.check())throw Do();return e+(this.isRed()?0:1)}}Rc.EMPTY=null,Rc.RED=!0,Rc.BLACK=!1,Rc.EMPTY=new class{constructor(){this.size=0}get key(){throw Do()}get value(){throw Do()}get color(){throw Do()}get left(){throw Do()}get right(){throw Do()}copy(e,t,s,n,r){return this}insert(e,t,s){return new Rc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ic{constructor(e){this.comparator=e,this.data=new Tc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const n=s.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let s;for(s=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ac(this.data.getIterator())}getIteratorFrom(e){return new Ac(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ic))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=s.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ic(this.comparator);return t.data=e,t}}class Ac{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Oc{constructor(e){this.fields=e,e.sort(nc.comparator)}static empty(){return new Oc([])}unionWith(e){let t=new Ic(nc.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Oc(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qo(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class jc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class kc{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new jc("Invalid base64 string: "+e):e}}(e);return new kc(t)}static fromUint8Array(e){const t=function(e){let t="";for(let s=0;s<e.length;++s)t+=String.fromCharCode(e[s]);return t}(e);return new kc(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Jo(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}kc.EMPTY_BYTE_STRING=new kc("");const Dc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pc(e){if(Po(!!e),"string"==typeof e){let t=0;const s=Dc.exec(e);if(Po(!!s),s[1]){let e=s[1];e=(e+"000000000").substr(0,9),t=Number(e)}const n=new Date(e);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:Lc(e.seconds),nanos:Lc(e.nanos)}}function Lc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Mc(e){return"string"==typeof e?kc.fromBase64String(e):kc.fromUint8Array(e)}function Uc(e){var t,s;return"server_timestamp"===(null===(s=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===s?void 0:s.stringValue)}function Vc(e){const t=e.mapValue.fields.__previous_value__;return Uc(t)?Vc(t):t}function Fc(e){const t=Pc(e.mapValue.fields.__local_write_time__.timestampValue);return new Zo(t.seconds,t.nanos)}class Bc{constructor(e,t,s,n,r,i,a,o,c){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=c}}class Gc{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Gc("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gc&&e.projectId===this.projectId&&e.database===this.database}}const Wc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Hc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Uc(e)?4:rl(e)?9007199254740991:10:Do()}function Kc(e,t){if(e===t)return!0;const s=Hc(e);if(s!==Hc(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Fc(e).isEqual(Fc(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const s=Pc(e.timestampValue),n=Pc(t.timestampValue);return s.seconds===n.seconds&&s.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Mc(e.bytesValue).isEqual(Mc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Lc(e.geoPointValue.latitude)===Lc(t.geoPointValue.latitude)&&Lc(e.geoPointValue.longitude)===Lc(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Lc(e.integerValue)===Lc(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const s=Lc(e.doubleValue),n=Lc(t.doubleValue);return s===n?vc(s)===vc(n):isNaN(s)&&isNaN(n)}return!1}(e,t);case 9:return Qo(e.arrayValue.values||[],t.arrayValue.values||[],Kc);case 10:return function(e,t){const s=e.mapValue.fields||{},n=t.mapValue.fields||{};if(wc(s)!==wc(n))return!1;for(const r in s)if(s.hasOwnProperty(r)&&(void 0===n[r]||!Kc(s[r],n[r])))return!1;return!0}(e,t);default:return Do()}}function zc(e,t){return void 0!==(e.values||[]).find(e=>Kc(e,t))}function qc(e,t){if(e===t)return 0;const s=Hc(e),n=Hc(t);if(s!==n)return Jo(s,n);switch(s){case 0:case 9007199254740991:return 0;case 1:return Jo(e.booleanValue,t.booleanValue);case 2:return function(e,t){const s=Lc(e.integerValue||e.doubleValue),n=Lc(t.integerValue||t.doubleValue);return s<n?-1:s>n?1:s===n?0:isNaN(s)?isNaN(n)?0:-1:1}(e,t);case 3:return Yc(e.timestampValue,t.timestampValue);case 4:return Yc(Fc(e),Fc(t));case 5:return Jo(e.stringValue,t.stringValue);case 6:return function(e,t){const s=Mc(e),n=Mc(t);return s.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const s=e.split("/"),n=t.split("/");for(let r=0;r<s.length&&r<n.length;r++){const e=Jo(s[r],n[r]);if(0!==e)return e}return Jo(s.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const s=Jo(Lc(e.latitude),Lc(t.latitude));return 0!==s?s:Jo(Lc(e.longitude),Lc(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const s=e.values||[],n=t.values||[];for(let r=0;r<s.length&&r<n.length;++r){const e=qc(s[r],n[r]);if(e)return e}return Jo(s.length,n.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Wc.mapValue&&t===Wc.mapValue)return 0;if(e===Wc.mapValue)return 1;if(t===Wc.mapValue)return-1;const s=e.fields||{},n=Object.keys(s),r=t.fields||{},i=Object.keys(r);n.sort(),i.sort();for(let a=0;a<n.length&&a<i.length;++a){const e=Jo(n[a],i[a]);if(0!==e)return e;const t=qc(s[n[a]],r[i[a]]);if(0!==t)return t}return Jo(n.length,i.length)}(e.mapValue,t.mapValue);default:throw Do()}}function Yc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Jo(e,t);const s=Pc(e),n=Pc(t),r=Jo(s.seconds,n.seconds);return 0!==r?r:Jo(s.nanos,n.nanos)}function Xc(e){return Jc(e)}function Jc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Pc(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Mc(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return rc.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",s=!0;for(const n of e.values||[])s?s=!1:t+=",",t+=Jc(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let s="{",n=!0;for(const r of t)n?n=!1:s+=",",s+="".concat(r,":").concat(Jc(e.fields[r]));return s+"}"}(e.mapValue):Do()}function Qc(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Zc(e){return!!e&&"integerValue"in e}function $c(e){return!!e&&"arrayValue"in e}function el(e){return!!e&&"nullValue"in e}function tl(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sl(e){return!!e&&"mapValue"in e}function nl(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Nc(e.mapValue.fields,(e,s)=>t.mapValue.fields[e]=nl(s)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(e.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=nl(e.arrayValue.values[s]);return t}return Object.assign({},e)}function rl(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class il{constructor(e){this.value=e}static empty(){return new il({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!sl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nl(t)}setAll(e){let t=nc.emptyPath(),s={},n=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,s,n),s={},n=[],t=r.popLast()}e?s[r.lastSegment()]=nl(e):n.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,s,n)}delete(e){const t=this.field(e.popLast());sl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let n=t.mapValue.fields[e.get(s)];sl(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,s){Nc(t,(t,s)=>e[t]=s);for(const n of s)delete e[n]}clone(){return new il(nl(this.value))}}function al(e){const t=[];return Nc(e.fields,(e,s)=>{const n=new nc([e]);if(sl(s)){const e=al(s.mapValue).fields;if(0===e.length)t.push(n);else for(const s of e)t.push(n.child(s))}else t.push(n)}),new Oc(t)}class ol{constructor(e,t,s,n,r,i,a){this.key=e,this.documentType=t,this.version=s,this.readTime=n,this.createTime=r,this.data=i,this.documentState=a}static newInvalidDocument(e){return new ol(e,0,$o.min(),$o.min(),$o.min(),il.empty(),0)}static newFoundDocument(e,t,s,n){return new ol(e,1,t,$o.min(),s,n,0)}static newNoDocument(e,t){return new ol(e,2,t,$o.min(),$o.min(),il.empty(),0)}static newUnknownDocument(e,t){return new ol(e,3,t,$o.min(),$o.min(),il.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($o.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=il.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=il.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$o.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ol&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ol(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class cl{constructor(e,t){this.position=e,this.inclusive=t}}function ll(e,t,s){let n=0;for(let r=0;r<e.position.length;r++){const i=t[r],a=e.position[r];if(n=i.field.isKeyField()?rc.comparator(rc.fromName(a.referenceValue),s.key):qc(a,s.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function dl(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let s=0;s<e.position.length;s++)if(!Kc(e.position[s],t.position[s]))return!1;return!0}class ul{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function hl(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class pl{}class ml extends pl{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,s):new bl(e,t,s):"array-contains"===t?new Tl(e,s):"in"===t?new Cl(e,s):"not-in"===t?new Rl(e,s):"array-contains-any"===t?new Il(e,s):new ml(e,t,s)}static createKeyFieldInFilter(e,t,s){return"in"===t?new wl(e,s):new Nl(e,s)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(qc(t,this.value)):null!==t&&Hc(this.value)===Hc(t)&&this.matchesComparison(qc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Do()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fl extends pl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new fl(e,t)}matches(e){return gl(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function gl(e){return"and"===e.op}function yl(e){return vl(e)&&gl(e)}function vl(e){for(const t of e.filters)if(t instanceof fl)return!1;return!0}function xl(e){if(e instanceof ml)return e.field.canonicalString()+e.op.toString()+Xc(e.value);if(yl(e))return e.filters.map(e=>xl(e)).join(",");{const t=e.filters.map(e=>xl(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function _l(e,t){return e instanceof ml?function(e,t){return t instanceof ml&&e.op===t.op&&e.field.isEqual(t.field)&&Kc(e.value,t.value)}(e,t):e instanceof fl?function(e,t){return t instanceof fl&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,s,n)=>e&&_l(s,t.filters[n]),!0)}(e,t):void Do()}function El(e){return e instanceof ml?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Xc(e.value))}(e):e instanceof fl?function(e){return e.op.toString()+" {"+e.getFilters().map(El).join(" ,")+"}"}(e):"Filter"}class bl extends ml{constructor(e,t,s){super(e,t,s),this.key=rc.fromName(s.referenceValue)}matches(e){const t=rc.comparator(e.key,this.key);return this.matchesComparison(t)}}class wl extends ml{constructor(e,t){super(e,"in",t),this.keys=Sl("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Nl extends ml{constructor(e,t){super(e,"not-in",t),this.keys=Sl("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Sl(e,t){var s;return((null===(s=t.arrayValue)||void 0===s?void 0:s.values)||[]).map(e=>rc.fromName(e.referenceValue))}class Tl extends ml{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return $c(t)&&zc(t.arrayValue,this.value)}}class Cl extends ml{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&zc(this.value.arrayValue,t)}}class Rl extends ml{constructor(e,t){super(e,"not-in",t)}matches(e){if(zc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!zc(this.value.arrayValue,t)}}class Il extends ml{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$c(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>zc(this.value.arrayValue,e))}}class Al{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=n,this.limit=r,this.startAt=i,this.endAt=a,this.ue=null}}function Ol(e){return new Al(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function jl(e){const t=Lo(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>xl(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),yc(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Xc(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Xc(e)).join(",")),t.ue=e}return t.ue}function kl(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<e.orderBy.length;s++)if(!hl(e.orderBy[s],t.orderBy[s]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!_l(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!dl(e.startAt,t.startAt)&&dl(e.endAt,t.endAt)}function Dl(e){return rc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Pl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=n,this.limit=r,this.limitType=i,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ll(e,t,s,n,r,i,a,o){return new Pl(e,t,s,n,r,i,a,o)}function Ml(e){return new Pl(e)}function Ul(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Vl(e){return null!==e.collectionGroup}function Fl(e){const t=Lo(e);if(null===t.ce){t.ce=[];const e=new Set;for(const r of t.explicitOrderBy)t.ce.push(r),e.add(r.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",n=function(e){let t=new Ic(nc.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);n.forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.ce.push(new ul(n,s))}),e.has(nc.keyField().canonicalString())||t.ce.push(new ul(nc.keyField(),s))}return t.ce}function Bl(e){const t=Lo(e);return t.le||(t.le=Gl(t,Fl(e))),t.le}function Gl(e,t){if("F"===e.limitType)return Ol(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new ul(e.field,t)});const s=e.endAt?new cl(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new cl(e.startAt.position,e.startAt.inclusive):null;return Ol(e.path,e.collectionGroup,t,e.filters,e.limit,s,n)}}function Wl(e,t){const s=e.filters.concat([t]);return new Pl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),s,e.limit,e.limitType,e.startAt,e.endAt)}function Hl(e,t,s){return new Pl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,s,e.startAt,e.endAt)}function Kl(e,t){return kl(Bl(e),Bl(t))&&e.limitType===t.limitType}function zl(e){return"".concat(jl(Bl(e)),"|lt:").concat(e.limitType)}function ql(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>El(e)).join(", "),"]")),yc(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Xc(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Xc(e)).join(",")),"Target(".concat(t,")")}(Bl(e)),"; limitType=").concat(e.limitType,")")}function Yl(e,t){return t.isFoundDocument()&&function(e,t){const s=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(s):rc.isDocumentKey(e.path)?e.path.isEqual(s):e.path.isImmediateParentOf(s)}(e,t)&&function(e,t){for(const s of Fl(e))if(!s.field.isKeyField()&&null===t.data.field(s.field))return!1;return!0}(e,t)&&function(e,t){for(const s of e.filters)if(!s.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,s){const n=ll(e,t,s);return e.inclusive?n<=0:n<0}(e.startAt,Fl(e),t))&&!(e.endAt&&!function(e,t,s){const n=ll(e,t,s);return e.inclusive?n>=0:n>0}(e.endAt,Fl(e),t))}(e,t)}function Xl(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Jl(e){return(t,s)=>{let n=!1;for(const r of Fl(e)){const e=Ql(r,t,s);if(0!==e)return e;n=n||r.field.isKeyField()}return 0}}function Ql(e,t,s){const n=e.field.isKeyField()?rc.comparator(t.key,s.key):function(e,t,s){const n=t.data.field(e),r=s.data.field(e);return null!==n&&null!==r?qc(n,r):Do()}(e.field,t,s);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Do()}}class Zl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0!==s)for(const[n,r]of s)if(this.equalsFn(n,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const s=this.mapKeyFn(e),n=this.inner[s];if(void 0===n)return this.inner[s]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0===s)return!1;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],e))return 1===s.length?delete this.inner[t]:s.splice(n,1),this.innerSize--,!0;return!1}forEach(e){Nc(this.inner,(t,s)=>{for(const[n,r]of s)e(n,r)})}isEmpty(){return Sc(this.inner)}size(){return this.innerSize}}const $l=new Tc(rc.comparator);function ed(){return $l}const td=new Tc(rc.comparator);function sd(){let e=td;for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];for(const r of s)e=e.insert(r.key,r);return e}function nd(e){let t=td;return e.forEach((e,s)=>t=t.insert(e,s.overlayedDocument)),t}function rd(){return ad()}function id(){return ad()}function ad(){return new Zl(e=>e.toString(),(e,t)=>e.isEqual(t))}const od=new Tc(rc.comparator),cd=new Ic(rc.comparator);function ld(){let e=cd;for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];for(const r of s)e=e.add(r);return e}const dd=new Ic(Jo);function ud(){return dd}function hd(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vc(t)?"-0":t}}function pd(e){return{integerValue:""+e}}function md(e,t){return xc(t)?pd(t):hd(e,t)}class fd{constructor(){this._=void 0}}function gd(e,t,s){return e instanceof xd?function(e,t){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Uc(t)&&(t=Vc(t)),t&&(s.fields.__previous_value__=t),{mapValue:s}}(s,t):e instanceof _d?Ed(e,t):e instanceof bd?wd(e,t):function(e,t){const s=vd(e,t),n=Sd(s)+Sd(e.Pe);return Zc(s)&&Zc(e.Pe)?pd(n):hd(e.serializer,n)}(e,t)}function yd(e,t,s){return e instanceof _d?Ed(e,t):e instanceof bd?wd(e,t):s}function vd(e,t){return e instanceof Nd?function(e){return Zc(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class xd extends fd{}class _d extends fd{constructor(e){super(),this.elements=e}}function Ed(e,t){const s=Td(t);for(const n of e.elements)s.some(e=>Kc(e,n))||s.push(n);return{arrayValue:{values:s}}}class bd extends fd{constructor(e){super(),this.elements=e}}function wd(e,t){let s=Td(t);for(const n of e.elements)s=s.filter(e=>!Kc(e,n));return{arrayValue:{values:s}}}class Nd extends fd{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Sd(e){return Lc(e.integerValue||e.doubleValue)}function Td(e){return $c(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Cd{constructor(e,t){this.field=e,this.transform=t}}class Rd{constructor(e,t){this.version=e,this.transformResults=t}}class Id{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Id}static exists(e){return new Id(void 0,e)}static updateTime(e){return new Id(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ad(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Od{}function jd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Gd(e.key,Id.none()):new Md(e.key,e.data,Id.none());{const s=e.data,n=il.empty();let r=new Ic(nc.comparator);for(let e of t.fields)if(!r.has(e)){let t=s.field(e);null===t&&e.length>1&&(e=e.popLast(),t=s.field(e)),null===t?n.delete(e):n.set(e,t),r=r.add(e)}return new Ud(e.key,n,new Oc(r.toArray()),Id.none())}}function kd(e,t,s){e instanceof Md?function(e,t,s){const n=e.value.clone(),r=Fd(e.fieldTransforms,t,s.transformResults);n.setAll(r),t.convertToFoundDocument(s.version,n).setHasCommittedMutations()}(e,t,s):e instanceof Ud?function(e,t,s){if(!Ad(e.precondition,t))return void t.convertToUnknownDocument(s.version);const n=Fd(e.fieldTransforms,t,s.transformResults),r=t.data;r.setAll(Vd(e)),r.setAll(n),t.convertToFoundDocument(s.version,r).setHasCommittedMutations()}(e,t,s):function(e,t,s){t.convertToNoDocument(s.version).setHasCommittedMutations()}(0,t,s)}function Dd(e,t,s,n){return e instanceof Md?function(e,t,s,n){if(!Ad(e.precondition,t))return s;const r=e.value.clone(),i=Bd(e.fieldTransforms,n,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,s,n):e instanceof Ud?function(e,t,s,n){if(!Ad(e.precondition,t))return s;const r=Bd(e.fieldTransforms,n,t),i=t.data;return i.setAll(Vd(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===s?null:s.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,s,n):function(e,t,s){return Ad(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):s}(e,t,s)}function Pd(e,t){let s=null;for(const n of e.fieldTransforms){const e=t.data.field(n.field),r=vd(n.transform,e||null);null!=r&&(null===s&&(s=il.empty()),s.set(n.field,r))}return s||null}function Ld(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Qo(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof _d&&t instanceof _d||e instanceof bd&&t instanceof bd?Qo(e.elements,t.elements,Kc):e instanceof Nd&&t instanceof Nd?Kc(e.Pe,t.Pe):e instanceof xd&&t instanceof xd}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Md extends Od{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Ud extends Od{constructor(e,t,s,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=n,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Vd(e){const t=new Map;return e.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const n=e.data.field(s);t.set(s,n)}}),t}function Fd(e,t,s){const n=new Map;Po(e.length===s.length);for(let r=0;r<s.length;r++){const i=e[r],a=i.transform,o=t.data.field(i.field);n.set(i.field,yd(a,o,s[r]))}return n}function Bd(e,t,s){const n=new Map;for(const r of e){const e=r.transform,i=s.data.field(r.field);n.set(r.field,gd(e,i,t))}return n}class Gd extends Od{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wd extends Od{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Hd{constructor(e,t,s,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=n}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let n=0;n<this.mutations.length;n++){const t=this.mutations[n];t.key.isEqual(e.key)&&kd(t,e,s[n])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Dd(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Dd(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=id();return this.mutations.forEach(n=>{const r=e.get(n.key),i=r.overlayedDocument;let a=this.applyToLocalView(i,r.mutatedFields);a=t.has(n.key)?null:a;const o=jd(i,a);null!==o&&s.set(n.key,o),i.isValidDocument()||i.convertToNoDocument($o.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ld())}isEqual(e){return this.batchId===e.batchId&&Qo(this.mutations,e.mutations,(e,t)=>Ld(e,t))&&Qo(this.baseMutations,e.baseMutations,(e,t)=>Ld(e,t))}}class Kd{constructor(e,t,s,n){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=n}static from(e,t,s){Po(e.mutations.length===s.length);let n=od;const r=e.mutations;for(let i=0;i<r.length;i++)n=n.insert(r[i].key,s[i].version);return new Kd(e,t,s,n)}}class zd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class qd{constructor(e,t){this.count=e,this.unchangedNames=t}}var Yd,Xd;function Jd(e){switch(e){default:return Do();case Mo.CANCELLED:case Mo.UNKNOWN:case Mo.DEADLINE_EXCEEDED:case Mo.RESOURCE_EXHAUSTED:case Mo.INTERNAL:case Mo.UNAVAILABLE:case Mo.UNAUTHENTICATED:return!1;case Mo.INVALID_ARGUMENT:case Mo.NOT_FOUND:case Mo.ALREADY_EXISTS:case Mo.PERMISSION_DENIED:case Mo.FAILED_PRECONDITION:case Mo.ABORTED:case Mo.OUT_OF_RANGE:case Mo.UNIMPLEMENTED:case Mo.DATA_LOSS:return!0}}function Qd(e){if(void 0===e)return Oo("GRPC error has no .code"),Mo.UNKNOWN;switch(e){case Yd.OK:return Mo.OK;case Yd.CANCELLED:return Mo.CANCELLED;case Yd.UNKNOWN:return Mo.UNKNOWN;case Yd.DEADLINE_EXCEEDED:return Mo.DEADLINE_EXCEEDED;case Yd.RESOURCE_EXHAUSTED:return Mo.RESOURCE_EXHAUSTED;case Yd.INTERNAL:return Mo.INTERNAL;case Yd.UNAVAILABLE:return Mo.UNAVAILABLE;case Yd.UNAUTHENTICATED:return Mo.UNAUTHENTICATED;case Yd.INVALID_ARGUMENT:return Mo.INVALID_ARGUMENT;case Yd.NOT_FOUND:return Mo.NOT_FOUND;case Yd.ALREADY_EXISTS:return Mo.ALREADY_EXISTS;case Yd.PERMISSION_DENIED:return Mo.PERMISSION_DENIED;case Yd.FAILED_PRECONDITION:return Mo.FAILED_PRECONDITION;case Yd.ABORTED:return Mo.ABORTED;case Yd.OUT_OF_RANGE:return Mo.OUT_OF_RANGE;case Yd.UNIMPLEMENTED:return Mo.UNIMPLEMENTED;case Yd.DATA_LOSS:return Mo.DATA_LOSS;default:return Do()}}(Xd=Yd||(Yd={}))[Xd.OK=0]="OK",Xd[Xd.CANCELLED=1]="CANCELLED",Xd[Xd.UNKNOWN=2]="UNKNOWN",Xd[Xd.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xd[Xd.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xd[Xd.NOT_FOUND=5]="NOT_FOUND",Xd[Xd.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xd[Xd.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xd[Xd.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xd[Xd.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xd[Xd.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xd[Xd.ABORTED=10]="ABORTED",Xd[Xd.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xd[Xd.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xd[Xd.INTERNAL=13]="INTERNAL",Xd[Xd.UNAVAILABLE=14]="UNAVAILABLE",Xd[Xd.DATA_LOSS=15]="DATA_LOSS";let Zd=null;function $d(){return new TextEncoder}const eu=new lo([4294967295,4294967295],0);function tu(e){const t=$d().encode(e),s=new uo;return s.update(t),new Uint8Array(s.digest())}function su(e){const t=new DataView(e.buffer),s=t.getUint32(0,!0),n=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new lo([s,n],0),new lo([r,i],0)]}class nu{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new ru("Invalid padding: ".concat(t));if(s<0)throw new ru("Invalid hash count: ".concat(s));if(e.length>0&&0===this.hashCount)throw new ru("Invalid hash count: ".concat(s));if(0===e.length&&0!==t)throw new ru("Invalid padding when bitmap length is 0: ".concat(t));this.Ie=8*e.length-t,this.Te=lo.fromNumber(this.Ie)}Ee(e,t,s){let n=e.add(t.multiply(lo.fromNumber(s)));return 1===n.compare(eu)&&(n=new lo([n.getBits(0),n.getBits(1)],0)),n.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=tu(e),[s,n]=su(t);for(let r=0;r<this.hashCount;r++){const e=this.Ee(s,n,r);if(!this.de(e))return!1}return!0}static create(e,t,s){const n=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new nu(r,n,t);return s.forEach(e=>i.insert(e)),i}insert(e){if(0===this.Ie)return;const t=tu(e),[s,n]=su(t);for(let r=0;r<this.hashCount;r++){const e=this.Ee(s,n,r);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class ru extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class iu{constructor(e,t,s,n,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=n,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const n=new Map;return n.set(e,au.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new iu($o.min(),n,new Tc(Jo),ed(),ld())}}class au{constructor(e,t,s,n,r){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=n,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new au(s,t,ld(),ld(),ld())}}class ou{constructor(e,t,s,n){this.Re=e,this.removedTargetIds=t,this.key=s,this.Ve=n}}class cu{constructor(e,t){this.targetId=e,this.me=t}}class lu{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kc.EMPTY_BYTE_STRING,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=n}}class du{constructor(){this.fe=0,this.ge=pu(),this.pe=kc.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=ld(),t=ld(),s=ld();return this.ge.forEach((n,r)=>{switch(r){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:s=s.add(n);break;default:Do()}}),new au(this.pe,this.ye,e,t,s)}ve(){this.we=!1,this.ge=pu()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Po(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class uu{constructor(e){this.Le=e,this.Be=new Map,this.ke=ed(),this.qe=hu(),this.Qe=new Tc(Jo)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const s=this.Ge(t);switch(e.state){case 0:this.ze(t)&&s.De(e.resumeToken);break;case 1:s.Oe(),s.Se||s.ve(),s.De(e.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(s.Ne(),s.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),s.De(e.resumeToken));break;default:Do()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,s=e.me.count,n=this.Je(t);if(n){const r=n.target;if(Dl(r))if(0===s){const e=new rc(r.path);this.Ue(t,e,ol.newNoDocument(e,$o.min()))}else Po(1===s);else{const n=this.Ye(t);if(n!==s){const s=this.Ze(e),r=s?this.Xe(s,e,n):1;if(0!==r){this.je(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==Zd||Zd.et(function(e,t,s,n,r){var i,a,o,c,l,d;const u={localCacheCount:e,existenceFilterCount:t.count,databaseId:s.database,projectId:s.projectId},h=t.unchangedNames;return h&&(u.bloomFilter={applied:0===r,hashCount:null!==(i=null==h?void 0:h.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(c=null===(o=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==c?c:0,padding:null!==(d=null===(l=null==h?void 0:h.bits)||void 0===l?void 0:l.padding)&&void 0!==d?d:0,mightContain:e=>{var t;return null!==(t=null==n?void 0:n.mightContain(e))&&void 0!==t&&t}}),u}(n,e.me,this.Le.tt(),s,r))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:n=0},hashCount:r=0}=t;let i,a;try{i=Mc(s).toUint8Array()}catch(e){if(e instanceof jc)return jo("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new nu(i,n,r)}catch(e){return jo(e instanceof ru?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,s){return t.me.count===s-this.nt(e,t.targetId)?0:2}nt(e,t){const s=this.Le.getRemoteKeysForTarget(t);let n=0;return s.forEach(s=>{const r=this.Le.tt(),i="projects/".concat(r.projectId,"/databases/").concat(r.database,"/documents/").concat(s.path.canonicalString());e.mightContain(i)||(this.Ue(t,s,null),n++)}),n}rt(e){const t=new Map;this.Be.forEach((s,n)=>{const r=this.Je(n);if(r){if(s.current&&Dl(r.target)){const t=new rc(r.target.path);null!==this.ke.get(t)||this.it(n,t)||this.Ue(n,t,ol.newNoDocument(t,e))}s.be&&(t.set(n,s.Ce()),s.ve())}});let s=ld();this.qe.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(s=s.add(e))}),this.ke.forEach((t,s)=>s.setReadTime(e));const n=new iu(e,t,this.Qe,this.ke,s);return this.ke=ed(),this.qe=hu(),this.Qe=new Tc(Jo),n}$e(e,t){if(!this.ze(e))return;const s=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,s),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,s){if(!this.ze(e))return;const n=this.Ge(e);this.it(e,t)?n.Fe(t,1):n.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),s&&(this.ke=this.ke.insert(t,s))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new du,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ic(Jo),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||Ao("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new du),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function hu(){return new Tc(rc.comparator)}function pu(){return new Tc(rc.comparator)}const mu={asc:"ASCENDING",desc:"DESCENDING"},fu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gu={and:"AND",or:"OR"};class yu{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function vu(e,t){return e.useProto3Json||yc(t)?t:{value:t}}function xu(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function _u(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Eu(e,t){return xu(e,t.toTimestamp())}function bu(e){return Po(!!e),$o.fromTimestamp(function(e){const t=Pc(e);return new Zo(t.seconds,t.nanos)}(e))}function wu(e,t){return Nu(e,t).canonicalString()}function Nu(e,t){const s=function(e){return new tc(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?s:s.child(t)}function Su(e){const t=tc.fromString(e);return Po(Ku(t)),t}function Tu(e,t){return wu(e.databaseId,t.path)}function Cu(e,t){const s=Su(t);if(s.get(1)!==e.databaseId.projectId)throw new Uo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+e.databaseId.projectId);if(s.get(3)!==e.databaseId.database)throw new Uo(Mo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+e.databaseId.database);return new rc(Ou(s))}function Ru(e,t){return wu(e.databaseId,t)}function Iu(e){const t=Su(e);return 4===t.length?tc.emptyPath():Ou(t)}function Au(e){return new tc(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ou(e){return Po(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ju(e,t,s){return{name:Tu(e,t),fields:s.value.mapValue.fields}}function ku(e,t){let s;if(t instanceof Md)s={update:ju(e,t.key,t.value)};else if(t instanceof Gd)s={delete:Tu(e,t.key)};else if(t instanceof Ud)s={update:ju(e,t.key,t.data),updateMask:Hu(t.fieldMask)};else{if(!(t instanceof Wd))return Do();s={verify:Tu(e,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const s=t.transform;if(s instanceof xd)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof _d)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof bd)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof Nd)return{fieldPath:t.field.canonicalString(),increment:s.Pe};throw Do()}(0,e))),t.precondition.isNone||(s.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Eu(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Do()}(e,t.precondition)),s}function Du(e,t){return{documents:[Ru(e,t.path)]}}function Pu(e,t){const s={structuredQuery:{}},n=t.path;let r;null!==t.collectionGroup?(r=n,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=n.popLast(),s.structuredQuery.from=[{collectionId:n.lastSegment()}]),s.parent=Ru(e,r);const i=function(e){if(0!==e.length)return Wu(fl.create(e,"and"))}(t.filters);i&&(s.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Bu(e.field),direction:Uu(e.dir)}}(e))}(t.orderBy);a&&(s.structuredQuery.orderBy=a);const o=vu(e,t.limit);return null!==o&&(s.structuredQuery.limit=o),t.startAt&&(s.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:s,parent:r}}function Lu(e){let t=Iu(e.parent);const s=e.structuredQuery,n=s.from?s.from.length:0;let r=null;if(n>0){Po(1===n);const e=s.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];s.where&&(i=function(e){const t=Mu(e);return t instanceof fl&&yl(t)?t.getFilters():[t]}(s.where));let a=[];s.orderBy&&(a=function(e){return e.map(e=>function(e){return new ul(Gu(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(s.orderBy));let o=null;s.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,yc(t)?null:t}(s.limit));let c=null;s.startAt&&(c=function(e){const t=!!e.before,s=e.values||[];return new cl(s,t)}(s.startAt));let l=null;return s.endAt&&(l=function(e){const t=!e.before,s=e.values||[];return new cl(s,t)}(s.endAt)),Ll(t,r,a,i,o,"F",c,l)}function Mu(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Gu(e.unaryFilter.field);return ml.create(t,"==",{doubleValue:NaN});case"IS_NULL":const s=Gu(e.unaryFilter.field);return ml.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=Gu(e.unaryFilter.field);return ml.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Gu(e.unaryFilter.field);return ml.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Do()}}(e):void 0!==e.fieldFilter?function(e){return ml.create(Gu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Do()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return fl.create(e.compositeFilter.filters.map(e=>Mu(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Do()}}(e.compositeFilter.op))}(e):Do()}function Uu(e){return mu[e]}function Vu(e){return fu[e]}function Fu(e){return gu[e]}function Bu(e){return{fieldPath:e.canonicalString()}}function Gu(e){return nc.fromServerFormat(e.fieldPath)}function Wu(e){return e instanceof ml?function(e){if("=="===e.op){if(tl(e.value))return{unaryFilter:{field:Bu(e.field),op:"IS_NAN"}};if(el(e.value))return{unaryFilter:{field:Bu(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(tl(e.value))return{unaryFilter:{field:Bu(e.field),op:"IS_NOT_NAN"}};if(el(e.value))return{unaryFilter:{field:Bu(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bu(e.field),op:Vu(e.op),value:e.value}}}(e):e instanceof fl?function(e){const t=e.getFilters().map(e=>Wu(e));return 1===t.length?t[0]:{compositeFilter:{op:Fu(e.op),filters:t}}}(e):Do()}function Hu(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Ku(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class zu{constructor(e,t,s,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$o.min(),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:$o.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:kc.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=n,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new zu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new zu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new zu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new zu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class qu{constructor(e){this.ct=e}}function Yu(e){const t=Lu({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Hl(t,t.limit,"L"):t}class Xu{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Lc(e.integerValue));else if("doubleValue"in e){const s=Lc(e.doubleValue);isNaN(s)?this.Et(t,13):(this.Et(t,15),vc(s)?t.dt(0):t.dt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Et(t,20),"string"==typeof s&&(s=Pc(s)),t.At("".concat(s.seconds||"")),t.dt(s.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Mc(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Et(t,45),t.dt(s.latitude||0),t.dt(s.longitude||0)}else"mapValue"in e?rl(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):Do()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const s=e.fields||{};this.Et(t,55);for(const n of Object.keys(s))this.Rt(n,t),this.It(s[n],t)}wt(e,t){const s=e.values||[];this.Et(t,50);for(const n of s)this.It(n,t)}gt(e,t){this.Et(t,37),rc.fromName(e).path.forEach(e=>{this.Et(t,60),this.St(e,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}Xu.bt=new Xu;class Ju{constructor(){this._n=new Qu}addToCollectionParentIndex(e,t){return this._n.add(t),pc.resolve()}getCollectionParents(e,t){return pc.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return pc.resolve()}deleteFieldIndex(e,t){return pc.resolve()}deleteAllFieldIndexes(e){return pc.resolve()}createTargetIndexes(e,t){return pc.resolve()}getDocumentsMatchingTarget(e,t){return pc.resolve(null)}getIndexType(e,t){return pc.resolve(0)}getFieldIndexes(e,t){return pc.resolve([])}getNextCollectionGroupToUpdate(e){return pc.resolve(null)}getMinOffset(e,t){return pc.resolve(cc.min())}getMinOffsetFromCollectionGroup(e,t){return pc.resolve(cc.min())}updateCollectionGroup(e,t,s){return pc.resolve()}updateIndexEntries(e,t){return pc.resolve()}}class Qu{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),n=this.index[t]||new Ic(tc.comparator),r=!n.has(s);return this.index[t]=n.add(s),r}has(e){const t=e.lastSegment(),s=e.popLast(),n=this.index[t];return n&&n.has(s)}getEntries(e){return(this.index[e]||new Ic(tc.comparator)).toArray()}}new Uint8Array(0);class Zu{constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}static withCacheSize(e){return new Zu(e,Zu.DEFAULT_COLLECTION_PERCENTILE,Zu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Zu.DEFAULT_COLLECTION_PERCENTILE=10,Zu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zu.DEFAULT=new Zu(41943040,Zu.DEFAULT_COLLECTION_PERCENTILE,Zu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zu.DISABLED=new Zu(-1,0,0);class $u{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new $u(0)}static Ln(){return new $u(-1)}}class eh{constructor(){this.changes=new Zl(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ol.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return void 0!==s?pc.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class th{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sh{constructor(e,t,s,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=n}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(s=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==s&&Dd(s.mutation,e,Oc.empty(),Zo.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,ld()).next(()=>t))}getLocalViewOfDocuments(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ld();const n=rd();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,s).next(e=>{let t=sd();return e.forEach((e,s)=>{t=t.insert(e,s.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const s=rd();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,ld()))}populateOverlays(e,t,s){const n=[];return s.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,s)=>{t.set(e,s)})})}computeViews(e,t,s,n){let r=ed();const i=ad(),a=ad();return t.forEach((e,t)=>{const a=s.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof Ud)?r=r.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),Dd(a.mutation,t,a.mutation.getFieldMask(),Zo.now())):i.set(t.key,Oc.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var s;return a.set(e,new th(t,null!==(s=i.get(e))&&void 0!==s?s:null))}),a))}recalculateAndSaveOverlays(e,t){const s=ad();let n=new Tc((e,t)=>e-t),r=ld();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=s.get(e)||Oc.empty();a=r.applyToLocalView(i,a),s.set(e,a);const o=(n.get(r.batchId)||ld()).add(e);n=n.insert(r.batchId,o)})}).next(()=>{const i=[],a=n.getReverseIterator();for(;a.hasNext();){const n=a.getNext(),o=n.key,c=n.value,l=id();c.forEach(e=>{if(!r.has(e)){const n=jd(t.get(e),s.get(e));null!==n&&l.set(e,n),r=r.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,l))}return pc.waitFor(i)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,s,n){return function(e){return rc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Vl(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,n):this.getDocumentsMatchingCollectionQuery(e,t,s,n)}getNextDocuments(e,t,s,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,n).next(r=>{const i=n-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,n-r.size):pc.resolve(rd());let a=-1,o=r;return i.next(t=>pc.forEach(t,(t,s)=>(a<s.largestBatchId&&(a=s.largestBatchId),r.get(t)?pc.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,o,t,ld())).next(e=>({batchId:a,changes:nd(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rc(t)).next(e=>{let t=sd();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,s,n){const r=t.collectionGroup;let i=sd();return this.indexManager.getCollectionParents(e,r).next(a=>pc.forEach(a,a=>{const o=function(e,t){return new Pl(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,s,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,s,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r,n))).next(e=>{r.forEach((t,s)=>{const n=s.getKey();null===e.get(n)&&(e=e.insert(n,ol.newInvalidDocument(n)))});let s=sd();return e.forEach((e,n)=>{const i=r.get(e);void 0!==i&&Dd(i.mutation,n,Oc.empty(),Zo.now()),Yl(t,n)&&(s=s.insert(e,n))}),s})}}class nh{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return pc.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:bu(e.createTime)}}(t)),pc.resolve()}getNamedQuery(e,t){return pc.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Yu(e.bundledQuery),readTime:bu(e.readTime)}}(t)),pc.resolve()}}class rh{constructor(){this.overlays=new Tc(rc.comparator),this.hr=new Map}getOverlay(e,t){return pc.resolve(this.overlays.get(t))}getOverlays(e,t){const s=rd();return pc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&s.set(t,e)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((s,n)=>{this.ht(e,t,n)}),pc.resolve()}removeOverlaysForBatchId(e,t,s){const n=this.hr.get(s);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.hr.delete(s)),pc.resolve()}getOverlaysForCollection(e,t,s){const n=rd(),r=t.length+1,i=new rc(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>s&&n.set(e.getKey(),e)}return pc.resolve(n)}getOverlaysForCollectionGroup(e,t,s,n){let r=new Tc((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>s){let t=r.get(e.largestBatchId);null===t&&(t=rd(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=rd(),o=r.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return pc.resolve(a)}ht(e,t,s){const n=this.overlays.get(s.key);if(null!==n){const e=this.hr.get(n.largestBatchId).delete(s.key);this.hr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(s.key,new zd(t,s));let r=this.hr.get(t);void 0===r&&(r=ld(),this.hr.set(t,r)),this.hr.set(t,r.add(s.key))}}class ih{constructor(){this.Pr=new Ic(ah.Ir),this.Tr=new Ic(ah.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const s=new ah(e,t);this.Pr=this.Pr.add(s),this.Tr=this.Tr.add(s)}dr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Ar(new ah(e,t))}Rr(e,t){e.forEach(e=>this.removeReference(e,t))}Vr(e){const t=new rc(new tc([])),s=new ah(t,e),n=new ah(t,e+1),r=[];return this.Tr.forEachInRange([s,n],e=>{this.Ar(e),r.push(e.key)}),r}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new rc(new tc([])),s=new ah(t,e),n=new ah(t,e+1);let r=ld();return this.Tr.forEachInRange([s,n],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new ah(e,0),s=this.Pr.firstAfterOrEqual(t);return null!==s&&e.isEqual(s.key)}}class ah{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return rc.comparator(e.key,t.key)||Jo(e.pr,t.pr)}static Er(e,t){return Jo(e.pr,t.pr)||rc.comparator(e.key,t.key)}}class oh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Ic(ah.Ir)}checkEmpty(e){return pc.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,s,n){const r=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Hd(r,t,s,n);this.mutationQueue.push(i);for(const a of n)this.wr=this.wr.add(new ah(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return pc.resolve(i)}lookupMutationBatch(e,t){return pc.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,n=this.br(s),r=n<0?0:n;return pc.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return pc.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return pc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new ah(t,0),n=new ah(t,Number.POSITIVE_INFINITY),r=[];return this.wr.forEachInRange([s,n],e=>{const t=this.Sr(e.pr);r.push(t)}),pc.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ic(Jo);return t.forEach(e=>{const t=new ah(e,0),n=new ah(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,n],e=>{s=s.add(e.pr)})}),pc.resolve(this.Dr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,n=s.length+1;let r=s;rc.isDocumentKey(r)||(r=r.child(""));const i=new ah(new rc(r),0);let a=new Ic(Jo);return this.wr.forEachWhile(e=>{const t=e.key.path;return!!s.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.pr)),!0)},i),pc.resolve(this.Dr(a))}Dr(e){const t=[];return e.forEach(e=>{const s=this.Sr(e);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){Po(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let s=this.wr;return pc.forEach(t.mutations,n=>{const r=new ah(n.key,t.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.wr=s})}Mn(e){}containsKey(e,t){const s=new ah(t,0),n=this.wr.firstAfterOrEqual(s);return pc.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,pc.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ch{constructor(e){this.vr=e,this.docs=new Tc(rc.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,n=this.docs.get(s),r=n?n.size:0,i=this.vr(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return pc.resolve(s?s.document.mutableCopy():ol.newInvalidDocument(t))}getEntries(e,t){let s=ed();return t.forEach(e=>{const t=this.docs.get(e);s=s.insert(e,t?t.document.mutableCopy():ol.newInvalidDocument(e))}),pc.resolve(s)}getDocumentsMatchingQuery(e,t,s,n){let r=ed();const i=t.path,a=new rc(i.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||lc(oc(a),s)<=0||(n.has(a.key)||Yl(t,a))&&(r=r.insert(a.key,a.mutableCopy()))}return pc.resolve(r)}getAllFromCollectionGroup(e,t,s,n){Do()}Fr(e,t){return pc.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new lh(this)}getSize(e){return pc.resolve(this.size)}}class lh extends eh{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((s,n)=>{n.isValidDocument()?t.push(this.ar.addEntry(e,n)):this.ar.removeEntry(s)}),pc.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class dh{constructor(e){this.persistence=e,this.Mr=new Zl(e=>jl(e),kl),this.lastRemoteSnapshotVersion=$o.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ih,this.targetCount=0,this.Lr=$u.Nn()}forEachTarget(e,t){return this.Mr.forEach((e,s)=>t(s)),pc.resolve()}getLastRemoteSnapshotVersion(e){return pc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return pc.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),pc.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.Or&&(this.Or=t),pc.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new $u(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,pc.resolve()}updateTargetData(e,t){return this.qn(t),pc.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,pc.resolve()}removeTargets(e,t,s){let n=0;const r=[];return this.Mr.forEach((i,a)=>{a.sequenceNumber<=t&&null===s.get(a.targetId)&&(this.Mr.delete(i),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),pc.waitFor(r).next(()=>n)}getTargetCount(e){return pc.resolve(this.targetCount)}getTargetData(e,t){const s=this.Mr.get(t)||null;return pc.resolve(s)}addMatchingKeys(e,t,s){return this.Nr.dr(t,s),pc.resolve()}removeMatchingKeys(e,t,s){this.Nr.Rr(t,s);const n=this.persistence.referenceDelegate,r=[];return n&&t.forEach(t=>{r.push(n.markPotentiallyOrphaned(e,t))}),pc.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),pc.resolve()}getMatchingKeysForTargetId(e,t){const s=this.Nr.gr(t);return pc.resolve(s)}containsKey(e,t){return pc.resolve(this.Nr.containsKey(t))}}class uh{constructor(e,t){this.Br={},this.overlays={},this.kr=new gc(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new dh(this),this.indexManager=new Ju,this.remoteDocumentCache=function(e){return new ch(e)}(e=>this.referenceDelegate.Kr(e)),this.serializer=new qu(t),this.$r=new nh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new rh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.Br[e.toKey()];return s||(s=new oh(t,this.referenceDelegate),this.Br[e.toKey()]=s),s}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,s){Ao("MemoryPersistence","Starting transaction:",e);const n=new hh(this.kr.next());return this.referenceDelegate.Ur(),s(n).next(e=>this.referenceDelegate.Wr(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Gr(e,t){return pc.or(Object.values(this.Br).map(s=>()=>s.containsKey(e,t)))}}class hh extends uc{constructor(e){super(),this.currentSequenceNumber=e}}class ph{constructor(e){this.persistence=e,this.zr=new ih,this.jr=null}static Hr(e){return new ph(e)}get Jr(){if(this.jr)return this.jr;throw Do()}addReference(e,t,s){return this.zr.addReference(s,t),this.Jr.delete(s.toString()),pc.resolve()}removeReference(e,t,s){return this.zr.removeReference(s,t),this.Jr.add(s.toString()),pc.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),pc.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(e=>this.Jr.add(e.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Jr.add(e.toString()))}).next(()=>s.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pc.forEach(this.Jr,s=>{const n=rc.fromPath(s);return this.Yr(e,n).next(e=>{e||t.removeEntry(n,$o.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return pc.or([()=>pc.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class mh{constructor(e,t,s,n){this.targetId=e,this.fromCache=t,this.qi=s,this.Qi=n}static Ki(e,t){let s=ld(),n=ld();for(const r of t.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:n=n.add(r.doc.key)}return new mh(e,t.fromCache,s,n)}}class fh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class gh{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=Ot()?8:mc(At())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,s,n){const r={result:null};return this.ji(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.Hi(e,t,n,s).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const s=new fh;return this.Ji(e,t,s).next(n=>{if(r.result=n,this.Ui)return this.Yi(e,t,s,n.size)})}).next(()=>r.result)}Yi(e,t,s,n){return s.documentReadCount<this.Wi?(Io()<=Xt.DEBUG&&Ao("QueryEngine","SDK will not create cache indexes for query:",ql(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),pc.resolve()):(Io()<=Xt.DEBUG&&Ao("QueryEngine","Query:",ql(t),"scans",s.documentReadCount,"local documents and returns",n,"documents as results."),s.documentReadCount>this.Gi*n?(Io()<=Xt.DEBUG&&Ao("QueryEngine","The SDK decides to create cache indexes for query:",ql(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bl(t))):pc.resolve())}ji(e,t){if(Ul(t))return pc.resolve(null);let s=Bl(t);return this.indexManager.getIndexType(e,s).next(n=>0===n?null:(null!==t.limit&&1===n&&(t=Hl(t,null,"F"),s=Bl(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(n=>{const r=ld(...n);return this.zi.getDocuments(e,r).next(n=>this.indexManager.getMinOffset(e,s).next(s=>{const i=this.Zi(t,n);return this.Xi(t,i,r,s.readTime)?this.ji(e,Hl(t,null,"F")):this.es(e,i,t,s)}))})))}Hi(e,t,s,n){return Ul(t)||n.isEqual($o.min())?pc.resolve(null):this.zi.getDocuments(e,s).next(r=>{const i=this.Zi(t,r);return this.Xi(t,i,s,n)?pc.resolve(null):(Io()<=Xt.DEBUG&&Ao("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ql(t)),this.es(e,i,t,ac(n,-1)).next(e=>e))})}Zi(e,t){let s=new Ic(Jl(e));return t.forEach((t,n)=>{Yl(e,n)&&(s=s.add(n))}),s}Xi(e,t,s,n){if(null===e.limit)return!1;if(s.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(n)>0)}Ji(e,t,s){return Io()<=Xt.DEBUG&&Ao("QueryEngine","Using full collection scan to execute query:",ql(t)),this.zi.getDocumentsMatchingQuery(e,t,cc.min(),s)}es(e,t,s,n){return this.zi.getDocumentsMatchingQuery(e,s,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class yh{constructor(e,t,s,n){this.persistence=e,this.ts=t,this.serializer=n,this.ns=new Tc(Jo),this.rs=new Zl(e=>jl(e),kl),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(s)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function vh(e,t,s,n){return new yh(e,t,s,n)}async function xh(e,t){const s=Lo(e);return await s.persistence.runTransaction("Handle user change","readonly",e=>{let n;return s.mutationQueue.getAllMutationBatches(e).next(r=>(n=r,s._s(t),s.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],i=[];let a=ld();for(const e of n){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return s.localDocuments.getDocuments(e,a).next(e=>({us:e,removedBatchIds:r,addedBatchIds:i}))})})}function _h(e){const t=Lo(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function Eh(e,t,s){let n=ld(),r=ld();return s.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=ed();return s.forEach((s,i)=>{const a=e.get(s);i.isFoundDocument()!==a.isFoundDocument()&&(r=r.add(s)),i.isNoDocument()&&i.version.isEqual($o.min())?(t.removeEntry(s,i.readTime),n=n.insert(s,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),n=n.insert(s,i)):Ao("LocalStore","Ignoring outdated watch update for ",s,". Current version:",a.version," Watch version:",i.version)}),{cs:n,ls:r}})}function bh(e,t){const s=Lo(e);return s.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),s.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function wh(e,t){const s=Lo(e);return s.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return s.Qr.getTargetData(e,t).next(r=>r?(n=r,pc.resolve(n)):s.Qr.allocateTargetId(e).next(r=>(n=new zu(t,r,"TargetPurposeListen",e.currentSequenceNumber),s.Qr.addTargetData(e,n).next(()=>n))))}).then(e=>{const n=s.ns.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(s.ns=s.ns.insert(e.targetId,e),s.rs.set(t,e.targetId)),e})}async function Nh(e,t,s){const n=Lo(e),r=n.ns.get(t),i=s?"readwrite":"readwrite-primary";try{s||await n.persistence.runTransaction("Release target",i,e=>n.persistence.referenceDelegate.removeTarget(e,r))}catch(e){if(!fc(e))throw e;Ao("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}n.ns=n.ns.remove(t),n.rs.delete(r.target)}function Sh(e,t,s){const n=Lo(e);let r=$o.min(),i=ld();return n.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,s){const n=Lo(e),r=n.rs.get(s);return void 0!==r?pc.resolve(n.ns.get(r)):n.Qr.getTargetData(t,s)}(n,e,Bl(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>n.ts.getDocumentsMatchingQuery(e,t,s?r:$o.min(),s?i:ld())).next(e=>(Th(n,Xl(t),e),{documents:e,hs:i})))}function Th(e,t,s){let n=e.ss.get(t)||$o.min();s.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.ss.set(t,n)}class Ch{constructor(){this.activeTargetIds=ud()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Rh{constructor(){this.no=new Ch,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,s){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Ch,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ih{io(e){}shutdown(){}}class Ah{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Ao("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){Ao("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Oh=null;function jh(){return null===Oh?Oh=268435456+Math.round(2147483648*Math.random()):Oh++,"0x"+Oh.toString(16)}const kh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Dh{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const Ph="WebChannelConnection";class Lh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.wo=t+"://"+e.host,this.So="projects/".concat(s,"/databases/").concat(n),this.bo="(default)"===this.databaseId.database?"project_id=".concat(s):"project_id=".concat(s,"&database_id=").concat(n)}get Do(){return!1}Co(e,t,s,n,r){const i=jh(),a=this.vo(e,t.toUriEncodedString());Ao("RestConnection","Sending RPC '".concat(e,"' ").concat(i,":"),a,s);const o={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(o,n,r),this.Mo(e,a,o,s).then(t=>(Ao("RestConnection","Received RPC '".concat(e,"' ").concat(i,": "),t),t),t=>{throw jo("RestConnection","RPC '".concat(e,"' ").concat(i," failed with error: "),t,"url: ",a,"request:",s),t})}xo(e,t,s,n,r,i){return this.Co(e,t,s,n,r)}Fo(e,t,s){e["X-Goog-Api-Client"]="gl-js/ fire/"+Co,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,s)=>e[s]=t),s&&s.headers.forEach((t,s)=>e[s]=t)}vo(e,t){const s=kh[e];return"".concat(this.wo,"/v1/").concat(t,":").concat(s)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,s,n){const r=jh();return new Promise((i,a)=>{const o=new mo;o.setWithCredentials(!0),o.listenOnce(yo.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case vo.NO_ERROR:const t=o.getResponseJson();Ao(Ph,"XHR for RPC '".concat(e,"' ").concat(r," received:"),JSON.stringify(t)),i(t);break;case vo.TIMEOUT:Ao(Ph,"RPC '".concat(e,"' ").concat(r," timed out")),a(new Uo(Mo.DEADLINE_EXCEEDED,"Request time out"));break;case vo.HTTP_ERROR:const s=o.getStatus();if(Ao(Ph,"RPC '".concat(e,"' ").concat(r," failed with status:"),s,"response text:",o.getResponseText()),s>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Mo).indexOf(t)>=0?t:Mo.UNKNOWN}(t.status);a(new Uo(e,t.message))}else a(new Uo(Mo.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new Uo(Mo.UNAVAILABLE,"Connection failed."));break;default:Do()}}finally{Ao(Ph,"RPC '".concat(e,"' ").concat(r," completed."))}});const c=JSON.stringify(n);Ao(Ph,"RPC '".concat(e,"' ").concat(r," sending request:"),n),o.send(t,"POST",c,s,15)})}Oo(e,t,s){const n=jh(),r=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=bo(),a=Eo(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(o.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(o.xmlHttpFactory=new fo({})),this.Fo(o.initMessageHeaders,t,s),o.encodeInitMessageHeaders=!0;const l=r.join("");Ao(Ph,"Creating RPC '".concat(e,"' stream ").concat(n,": ").concat(l),o);const d=i.createWebChannel(l,o);let u=!1,h=!1;const p=new Dh({lo:t=>{h?Ao(Ph,"Not sending because RPC '".concat(e,"' stream ").concat(n," is closed:"),t):(u||(Ao(Ph,"Opening RPC '".concat(e,"' stream ").concat(n," transport.")),d.open(),u=!0),Ao(Ph,"RPC '".concat(e,"' stream ").concat(n," sending:"),t),d.send(t))},ho:()=>d.close()}),m=(e,t,s)=>{e.listen(t,e=>{try{s(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(d,go.EventType.OPEN,()=>{h||(Ao(Ph,"RPC '".concat(e,"' stream ").concat(n," transport opened.")),p.mo())}),m(d,go.EventType.CLOSE,()=>{h||(h=!0,Ao(Ph,"RPC '".concat(e,"' stream ").concat(n," transport closed")),p.po())}),m(d,go.EventType.ERROR,t=>{h||(h=!0,jo(Ph,"RPC '".concat(e,"' stream ").concat(n," transport errored:"),t),p.po(new Uo(Mo.UNAVAILABLE,"The operation could not be completed")))}),m(d,go.EventType.MESSAGE,t=>{var s;if(!h){const r=t.data[0];Po(!!r);const i=r,a=i.error||(null===(s=i[0])||void 0===s?void 0:s.error);if(a){Ao(Ph,"RPC '".concat(e,"' stream ").concat(n," received error:"),a);const t=a.status;let s=function(e){const t=Yd[e];if(void 0!==t)return Qd(t)}(t),r=a.message;void 0===s&&(s=Mo.INTERNAL,r="Unknown error status: "+t+" with message "+a.message),h=!0,p.po(new Uo(s,r)),d.close()}else Ao(Ph,"RPC '".concat(e,"' stream ").concat(n," received:"),r),p.yo(r)}}),m(a,_o.STAT_EVENT,t=>{t.stat===xo.PROXY?Ao(Ph,"RPC '".concat(e,"' stream ").concat(n," detected buffering proxy")):t.stat===xo.NOPROXY&&Ao(Ph,"RPC '".concat(e,"' stream ").concat(n," detected no buffering proxy"))}),setTimeout(()=>{p.fo()},0),p}}function Mh(){return"undefined"!=typeof document?document:null}function Uh(e){return new yu(e,!0)}class Vh{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.oi=e,this.timerId=t,this.No=s,this.Lo=n,this.Bo=r,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),s=Math.max(0,Date.now()-this.Qo),n=Math.max(0,t-s);n>0&&Ao("ExponentialBackoff","Backing off for ".concat(n," ms (base delay: ").concat(this.ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(s," ms ago)")),this.qo=this.oi.enqueueAfterDelay(this.timerId,n,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class Fh{constructor(e,t,s,n,r,i,a,o){this.oi=e,this.Go=s,this.zo=n,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Vh(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(e,t){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==e?this.Yo.reset():t&&t.code===Mo.RESOURCE_EXHAUSTED?(Oo(t.toString()),Oo("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===Mo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ao(t)}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[s,n]=e;this.jo===t&&this.u_(s,n)},t=>{e(()=>{const e=new Uo(Mo.UNKNOWN,"Fetching auth token failed: "+t.message);return this.c_(e)})})}u_(e,t){const s=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{s(()=>this.listener.Po())}),this.stream.To(()=>{s(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(e=>{s(()=>this.c_(e))}),this.stream.onMessage(e=>{s(()=>this.onMessage(e))})}e_(){this.state=5,this.Yo.$o(async()=>{this.state=0,this.start()})}c_(e){return Ao("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(Ao("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Bh extends Fh{constructor(e,t,s,n,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,n,i),this.serializer=r}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function(e,t){let s;if("targetChange"in t){t.targetChange;const n=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Do()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(Po(void 0===t||"string"==typeof t),kc.fromBase64String(t||"")):(Po(void 0===t||t instanceof Buffer||t instanceof Uint8Array),kc.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?Mo.UNKNOWN:Qd(e.code);return new Uo(t,e.message||"")}(a);s=new lu(n,r,i,o||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const r=Cu(e,n.document.name),i=bu(n.document.updateTime),a=n.document.createTime?bu(n.document.createTime):$o.min(),o=new il({mapValue:{fields:n.document.fields}}),c=ol.newFoundDocument(r,i,a,o),l=n.targetIds||[],d=n.removedTargetIds||[];s=new ou(l,d,c.key,c)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const r=Cu(e,n.document),i=n.readTime?bu(n.readTime):$o.min(),a=ol.newNoDocument(r,i),o=n.removedTargetIds||[];s=new ou([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const r=Cu(e,n.document),i=n.removedTargetIds||[];s=new ou([],i,r,null)}else{if(!("filter"in t))return Do();{t.filter;const e=t.filter;e.targetId;const{count:n=0,unchangedNames:r}=e,i=new qd(n,r),a=e.targetId;s=new cu(a,i)}}return s}(this.serializer,e),s=function(e){if(!("targetChange"in e))return $o.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?$o.min():t.readTime?bu(t.readTime):$o.min()}(e);return this.listener.h_(t,s)}P_(e){const t={};t.database=Au(this.serializer),t.addTarget=function(e,t){let s;const n=t.target;if(s=Dl(n)?{documents:Du(e,n)}:{query:Pu(e,n)._t},s.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){s.resumeToken=_u(e,t.resumeToken);const n=vu(e,t.expectedCount);null!==n&&(s.expectedCount=n)}else if(t.snapshotVersion.compareTo($o.min())>0){s.readTime=xu(e,t.snapshotVersion.toTimestamp());const n=vu(e,t.expectedCount);null!==n&&(s.expectedCount=n)}return s}(this.serializer,e);const s=function(e,t){const s=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Do()}}(t.purpose);return null==s?null:{"goog-listen-tags":s}}(this.serializer,e);s&&(t.labels=s),this.i_(t)}I_(e){const t={};t.database=Au(this.serializer),t.removeTarget=e,this.i_(t)}}class Gh extends Fh{constructor(e,t,s,n,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,n,i),this.serializer=r,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(Po(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function(e,t){return e&&e.length>0?(Po(void 0!==t),e.map(e=>function(e,t){let s=e.updateTime?bu(e.updateTime):bu(t);return s.isEqual($o.min())&&(s=bu(t)),new Rd(s,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),s=bu(e.commitTime);return this.listener.A_(s,t)}return Po(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=Au(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>ku(this.serializer,e))};this.i_(t)}}class Wh extends class{}{constructor(e,t,s,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=n,this.m_=!1}f_(){if(this.m_)throw new Uo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,s,n){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(r=>{let[i,a]=r;return this.connection.Co(e,Nu(t,s),n,i,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Uo(Mo.UNKNOWN,e.toString())})}xo(e,t,s,n,r){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[a,o]=i;return this.connection.xo(e,Nu(t,s),n,a,o,r)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Mo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Uo(Mo.UNKNOWN,e.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class Hh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.y_?(Oo(t),this.y_=!1):Ao("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Kh{constructor(e,t,s,n,r){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=r,this.O_.io(e=>{s.enqueueAndForget(async()=>{ep(this)&&(Ao("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Lo(e);t.M_.add(4),await qh(t),t.N_.set("Unknown"),t.M_.delete(4),await zh(t)}(this))})}),this.N_=new Hh(s,n)}}async function zh(e){if(ep(e))for(const t of e.x_)await t(!0)}async function qh(e){for(const t of e.x_)await t(!1)}function Yh(e,t){const s=Lo(e);s.F_.has(t.targetId)||(s.F_.set(t.targetId,t),$h(s)?Zh(s):xp(s).Xo()&&Jh(s,t))}function Xh(e,t){const s=Lo(e),n=xp(s);s.F_.delete(t),n.Xo()&&Qh(s,t),0===s.F_.size&&(n.Xo()?n.n_():ep(s)&&s.N_.set("Unknown"))}function Jh(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo($o.min())>0){const s=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}xp(e).P_(t)}function Qh(e,t){e.L_.xe(t),xp(e).I_(t)}function Zh(e){e.L_=new uu({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.F_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),xp(e).start(),e.N_.w_()}function $h(e){return ep(e)&&!xp(e).Zo()&&e.F_.size>0}function ep(e){return 0===Lo(e).M_.size}function tp(e){e.L_=void 0}async function sp(e){e.N_.set("Online")}async function np(e){e.F_.forEach((t,s)=>{Jh(e,t)})}async function rp(e,t){tp(e),$h(e)?(e.N_.D_(t),Zh(e)):e.N_.set("Unknown")}async function ip(e,t,s){if(e.N_.set("Online"),t instanceof lu&&2===t.state&&t.cause)try{await async function(e,t){const s=t.cause;for(const n of t.targetIds)e.F_.has(n)&&(await e.remoteSyncer.rejectListen(n,s),e.F_.delete(n),e.L_.removeTarget(n))}(e,t)}catch(s){Ao("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),s),await ap(e,s)}else if(t instanceof ou?e.L_.Ke(t):t instanceof cu?e.L_.He(t):e.L_.We(t),!s.isEqual($o.min()))try{const t=await _h(e.localStore);s.compareTo(t)>=0&&await function(e,t){const s=e.L_.rt(t);return s.targetChanges.forEach((s,n)=>{if(s.resumeToken.approximateByteSize()>0){const r=e.F_.get(n);r&&e.F_.set(n,r.withResumeToken(s.resumeToken,t))}}),s.targetMismatches.forEach((t,s)=>{const n=e.F_.get(t);if(!n)return;e.F_.set(t,n.withResumeToken(kc.EMPTY_BYTE_STRING,n.snapshotVersion)),Qh(e,t);const r=new zu(n.target,t,s,n.sequenceNumber);Jh(e,r)}),e.remoteSyncer.applyRemoteEvent(s)}(e,s)}catch(t){Ao("RemoteStore","Failed to raise snapshot:",t),await ap(e,t)}}async function ap(e,t,s){if(!fc(t))throw t;e.M_.add(1),await qh(e),e.N_.set("Offline"),s||(s=()=>_h(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Ao("RemoteStore","Retrying IndexedDB access"),await s(),e.M_.delete(1),await zh(e)})}function op(e,t){return t().catch(s=>ap(e,s,t))}async function cp(e){const t=Lo(e),s=_p(t);let n=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;lp(t);)try{const e=await bh(t.localStore,n);if(null===e){0===t.v_.length&&s.n_();break}n=e.batchId,dp(t,e)}catch(e){await ap(t,e)}up(t)&&hp(t)}function lp(e){return ep(e)&&e.v_.length<10}function dp(e,t){e.v_.push(t);const s=_p(e);s.Xo()&&s.E_&&s.d_(t.mutations)}function up(e){return ep(e)&&!_p(e).Zo()&&e.v_.length>0}function hp(e){_p(e).start()}async function pp(e){_p(e).V_()}async function mp(e){const t=_p(e);for(const s of e.v_)t.d_(s.mutations)}async function fp(e,t,s){const n=e.v_.shift(),r=Kd.from(n,t,s);await op(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await cp(e)}async function gp(e,t){t&&_p(e).E_&&await async function(e,t){if(function(e){return Jd(e)&&e!==Mo.ABORTED}(t.code)){const s=e.v_.shift();_p(e).t_(),await op(e,()=>e.remoteSyncer.rejectFailedWrite(s.batchId,t)),await cp(e)}}(e,t),up(e)&&hp(e)}async function yp(e,t){const s=Lo(e);s.asyncQueue.verifyOperationInProgress(),Ao("RemoteStore","RemoteStore received new credentials");const n=ep(s);s.M_.add(3),await qh(s),n&&s.N_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.M_.delete(3),await zh(s)}async function vp(e,t){const s=Lo(e);t?(s.M_.delete(2),await zh(s)):t||(s.M_.add(2),await qh(s),s.N_.set("Unknown"))}function xp(e){return e.B_||(e.B_=function(e,t,s){const n=Lo(e);return n.f_(),new Bh(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,s)}(e.datastore,e.asyncQueue,{Po:sp.bind(null,e),To:np.bind(null,e),Ao:rp.bind(null,e),h_:ip.bind(null,e)}),e.x_.push(async t=>{t?(e.B_.t_(),$h(e)?Zh(e):e.N_.set("Unknown")):(await e.B_.stop(),tp(e))})),e.B_}function _p(e){return e.k_||(e.k_=function(e,t,s){const n=Lo(e);return n.f_(),new Gh(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,s)}(e.datastore,e.asyncQueue,{Po:()=>Promise.resolve(),To:pp.bind(null,e),Ao:gp.bind(null,e),R_:mp.bind(null,e),A_:fp.bind(null,e)}),e.x_.push(async t=>{t?(e.k_.t_(),await cp(e)):(await e.k_.stop(),e.v_.length>0&&(Ao("RemoteStore","Stopping write stream with ".concat(e.v_.length," pending writes")),e.v_=[]))})),e.k_}class Ep{constructor(e,t,s,n,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=n,this.removalCallback=r,this.deferred=new Vo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,n,r){const i=Date.now()+s,a=new Ep(e,t,i,n,r);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Uo(Mo.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bp(e,t){if(Oo("AsyncQueue","".concat(t,": ").concat(e)),fc(e))return new Uo(Mo.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class wp{constructor(e){this.comparator=e?(t,s)=>e(t,s)||rc.comparator(t.key,s.key):(e,t)=>rc.comparator(e.key,t.key),this.keyedMap=sd(),this.sortedSet=new Tc(this.comparator)}static emptySet(e){return new wp(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof wp))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=s.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const s=new wp;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class Np{constructor(){this.q_=new Tc(rc.comparator)}track(e){const t=e.doc.key,s=this.q_.get(t);s?0!==e.type&&3===s.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==s.type?this.q_=this.q_.insert(t,{type:s.type,doc:e.doc}):2===e.type&&2===s.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===s.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===s.type?this.q_=this.q_.remove(t):1===e.type&&2===s.type?this.q_=this.q_.insert(t,{type:1,doc:s.doc}):0===e.type&&1===s.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):Do():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,s)=>{e.push(s)}),e}}class Sp{constructor(e,t,s,n,r,i,a,o,c){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=n,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,s,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Sp(e,t,wp.emptySet(t),i,s,n,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(t[n].type!==s[n].type||!t[n].doc.isEqual(s[n].doc))return!1;return!0}}class Tp{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class Cp{constructor(){this.queries=new Zl(e=>zl(e),Kl),this.onlineState="Unknown",this.z_=new Set}}async function Rp(e,t){const s=Lo(e);let n=3;const r=t.query;let i=s.queries.get(r);i?!i.W_()&&t.G_()&&(n=2):(i=new Tp,n=t.G_()?0:1);try{switch(n){case 0:i.K_=await s.onListen(r,!0);break;case 1:i.K_=await s.onListen(r,!1);break;case 2:await s.onFirstRemoteStoreListen(r)}}catch(e){const s=bp(e,"Initialization of query '".concat(ql(t.query),"' failed"));return void t.onError(s)}s.queries.set(r,i),i.U_.push(t),t.j_(s.onlineState),i.K_&&t.H_(i.K_)&&jp(s)}async function Ip(e,t){const s=Lo(e),n=t.query;let r=3;const i=s.queries.get(n);if(i){const e=i.U_.indexOf(t);e>=0&&(i.U_.splice(e,1),0===i.U_.length?r=t.G_()?0:1:!i.W_()&&t.G_()&&(r=2))}switch(r){case 0:return s.queries.delete(n),s.onUnlisten(n,!0);case 1:return s.queries.delete(n),s.onUnlisten(n,!1);case 2:return s.onLastRemoteStoreUnlisten(n);default:return}}function Ap(e,t){const s=Lo(e);let n=!1;for(const r of t){const e=r.query,t=s.queries.get(e);if(t){for(const e of t.U_)e.H_(r)&&(n=!0);t.K_=r}}n&&jp(s)}function Op(e,t,s){const n=Lo(e),r=n.queries.get(t);if(r)for(const i of r.U_)i.onError(s);n.queries.delete(t)}function jp(e){e.z_.forEach(e=>{e.next()})}var kp,Dp;(Dp=kp||(kp={})).J_="default",Dp.Cache="cache";class Pp{constructor(e,t,s){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=s||{}}H_(e){if(!this.options.includeMetadataChanges){const t=[];for(const s of e.docChanges)3!==s.type&&t.push(s);e=new Sp(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache)return!0;if(!this.G_())return!0;const s="Offline"!==t;return(!this.options.ra||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){if(e.docChanges.length>0)return!0;const t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}na(e){e=Sp.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==kp.Cache}}class Lp{constructor(e){this.key=e}}class Mp{constructor(e){this.key=e}}class Up{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=ld(),this.mutatedKeys=ld(),this.Ia=Jl(e),this.Ta=new wp(this.Ia)}get Ea(){return this.la}da(e,t){const s=t?t.Aa:new Np,n=t?t.Ta:this.Ta;let r=t?t.mutatedKeys:this.mutatedKeys,i=n,a=!1;const o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,c="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{const l=n.get(e),d=Yl(this.query,t)?t:null,u=!!l&&this.mutatedKeys.has(l.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let p=!1;l&&d?l.data.isEqual(d.data)?u!==h&&(s.track({type:3,doc:d}),p=!0):this.Ra(l,d)||(s.track({type:2,doc:d}),p=!0,(o&&this.Ia(d,o)>0||c&&this.Ia(d,c)<0)&&(a=!0)):!l&&d?(s.track({type:0,doc:d}),p=!0):l&&!d&&(s.track({type:1,doc:l}),p=!0,(o||c)&&(a=!0)),p&&(d?(i=i.add(d),r=h?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),s.track({type:1,doc:e})}return{Ta:i,Aa:s,Xi:a,mutatedKeys:r}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,n){const r=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const i=e.Aa.Q_();i.sort((e,t)=>function(e,t){const s=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Do()}};return s(e)-s(t)}(e.type,t.type)||this.Ia(e.doc,t.doc)),this.Va(s),n=null!=n&&n;const a=t&&!n?this.ma():[],o=0===this.Pa.size&&this.current&&!n?1:0,c=o!==this.ha;return this.ha=o,0!==i.length||c?{snapshot:new Sp(this.query,e.Ta,r,i,e.mutatedKeys,0===o,c,!1,!!s&&s.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Np,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(e=>this.la=this.la.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=ld(),this.Ta.forEach(e=>{this.ga(e.key)&&(this.Pa=this.Pa.add(e.key))});const t=[];return e.forEach(e=>{this.Pa.has(e)||t.push(new Mp(e))}),this.Pa.forEach(s=>{e.has(s)||t.push(new Lp(s))}),t}pa(e){this.la=e.hs,this.Pa=ld();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Sp.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class Vp{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Fp{constructor(e){this.key=e,this.wa=!1}}class Bp{constructor(e,t,s,n,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=n,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Sa={},this.ba=new Zl(e=>zl(e),Kl),this.Da=new Map,this.Ca=new Set,this.va=new Tc(rc.comparator),this.Fa=new Map,this.Ma=new ih,this.xa={},this.Oa=new Map,this.Na=$u.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function Gp(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=lm(e);let r;const i=n.ba.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.ya()):r=await Hp(n,t,s,!0),r}async function Wp(e,t){const s=lm(e);await Hp(s,t,!0,!1)}async function Hp(e,t,s,n){const r=await wh(e.localStore,Bl(t)),i=r.targetId,a=s?e.sharedClientState.addLocalQueryTarget(i):"not-current";let o;return n&&(o=await Kp(e,t,i,"current"===a,r.resumeToken)),e.isPrimaryClient&&s&&Yh(e.remoteStore,r),o}async function Kp(e,t,s,n,r){e.Ba=(t,s,n)=>async function(e,t,s,n){let r=t.view.da(s);r.Xi&&(r=await Sh(e.localStore,t.query,!1).then(e=>{let{documents:s}=e;return t.view.da(s,r)}));const i=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,i,a);return nm(e,t.targetId,o.fa),o.snapshot}(e,t,s,n);const i=await Sh(e.localStore,t,!0),a=new Up(t,i.hs),o=a.da(i.documents),c=au.createSynthesizedTargetChangeForCurrentChange(s,n&&"Offline"!==e.onlineState,r),l=a.applyChanges(o,e.isPrimaryClient,c);nm(e,s,l.fa);const d=new Vp(t,s,a);return e.ba.set(t,d),e.Da.has(s)?e.Da.get(s).push(t):e.Da.set(s,[t]),l.snapshot}async function zp(e,t,s){const n=Lo(e),r=n.ba.get(t),i=n.Da.get(r.targetId);if(i.length>1)return n.Da.set(r.targetId,i.filter(e=>!Kl(e,t))),void n.ba.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Nh(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),s&&Xh(n.remoteStore,r.targetId),tm(n,r.targetId)}).catch(hc)):(tm(n,r.targetId),await Nh(n.localStore,r.targetId,!0))}async function qp(e,t){const s=Lo(e),n=s.ba.get(t),r=s.Da.get(n.targetId);s.isPrimaryClient&&1===r.length&&(s.sharedClientState.removeLocalQueryTarget(n.targetId),Xh(s.remoteStore,n.targetId))}async function Yp(e,t){const s=Lo(e);try{const e=await function(e,t){const s=Lo(e),n=t.snapshotVersion;let r=s.ns;return s.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=s.os.newChangeBuffer({trackRemovals:!0});r=s.ns;const a=[];t.targetChanges.forEach((i,o)=>{const c=r.get(o);if(!c)return;a.push(s.Qr.removeMatchingKeys(e,i.removedDocuments,o).next(()=>s.Qr.addMatchingKeys(e,i.addedDocuments,o)));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?l=l.withResumeToken(kc.EMPTY_BYTE_STRING,$o.min()).withLastLimboFreeSnapshotVersion($o.min()):i.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(i.resumeToken,n)),r=r.insert(o,l),function(e,t,s){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0}(c,l,i)&&a.push(s.Qr.updateTargetData(e,l))});let o=ed(),c=ld();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(s.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(Eh(e,i,t.documentUpdates).next(e=>{o=e.cs,c=e.ls})),!n.isEqual($o.min())){const t=s.Qr.getLastRemoteSnapshotVersion(e).next(t=>s.Qr.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return pc.waitFor(a).next(()=>i.apply(e)).next(()=>s.localDocuments.getLocalViewOfDocuments(e,o,c)).next(()=>o)}).then(e=>(s.ns=r,e))}(s.localStore,t);t.targetChanges.forEach((e,t)=>{const n=s.Fa.get(t);n&&(Po(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.wa=!0:e.modifiedDocuments.size>0?Po(n.wa):e.removedDocuments.size>0&&(Po(n.wa),n.wa=!1))}),await am(s,e,t)}catch(e){await hc(e)}}function Xp(e,t,s){const n=Lo(e);if(n.isPrimaryClient&&0===s||!n.isPrimaryClient&&1===s){const e=[];n.ba.forEach((s,n)=>{const r=n.view.j_(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const s=Lo(e);s.onlineState=t;let n=!1;s.queries.forEach((e,s)=>{for(const r of s.U_)r.j_(t)&&(n=!0)}),n&&jp(s)}(n.eventManager,t),e.length&&n.Sa.h_(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function Jp(e,t,s){const n=Lo(e);n.sharedClientState.updateQueryState(t,"rejected",s);const r=n.Fa.get(t),i=r&&r.key;if(i){let e=new Tc(rc.comparator);e=e.insert(i,ol.newNoDocument(i,$o.min()));const s=ld().add(i),r=new iu($o.min(),new Map,new Tc(Jo),e,s);await Yp(n,r),n.va=n.va.remove(i),n.Fa.delete(t),im(n)}else await Nh(n.localStore,t,!1).then(()=>tm(n,t,s)).catch(hc)}async function Qp(e,t){const s=Lo(e),n=t.batch.batchId;try{const e=await function(e,t){const s=Lo(e);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const n=t.batch.keys(),r=s.os.newChangeBuffer({trackRemovals:!0});return function(e,t,s,n){const r=s.batch,i=r.keys();let a=pc.resolve();return i.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{const i=s.docVersions.get(e);Po(null!==i),t.version.compareTo(i)<0&&(r.applyToRemoteDocument(t,s),t.isValidDocument()&&(t.setReadTime(s.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(s,e,t,r).next(()=>r.apply(e)).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ld();for(let s=0;s<e.mutationResults.length;++s)e.mutationResults[s].transformResults.length>0&&(t=t.add(e.batch.mutations[s].key));return t}(t))).next(()=>s.localDocuments.getDocuments(e,n))})}(s.localStore,t);em(s,n,null),$p(s,n),s.sharedClientState.updateMutationState(n,"acknowledged"),await am(s,e)}catch(e){await hc(e)}}async function Zp(e,t,s){const n=Lo(e);try{const e=await function(e,t){const s=Lo(e);return s.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return s.mutationQueue.lookupMutationBatch(e,t).next(t=>(Po(null!==t),n=t.keys(),s.mutationQueue.removeMutationBatch(e,t))).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>s.localDocuments.getDocuments(e,n))})}(n.localStore,t);em(n,t,s),$p(n,t),n.sharedClientState.updateMutationState(t,"rejected",s),await am(n,e)}catch(s){await hc(s)}}function $p(e,t){(e.Oa.get(t)||[]).forEach(e=>{e.resolve()}),e.Oa.delete(t)}function em(e,t,s){const n=Lo(e);let r=n.xa[n.currentUser.toKey()];if(r){const e=r.get(t);e&&(s?e.reject(s):e.resolve(),r=r.remove(t)),n.xa[n.currentUser.toKey()]=r}}function tm(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const n of e.Da.get(t))e.ba.delete(n),s&&e.Sa.ka(n,s);e.Da.delete(t),e.isPrimaryClient&&e.Ma.Vr(t).forEach(t=>{e.Ma.containsKey(t)||sm(e,t)})}function sm(e,t){e.Ca.delete(t.path.canonicalString());const s=e.va.get(t);null!==s&&(Xh(e.remoteStore,s),e.va=e.va.remove(t),e.Fa.delete(s),im(e))}function nm(e,t,s){for(const n of s)n instanceof Lp?(e.Ma.addReference(n.key,t),rm(e,n)):n instanceof Mp?(Ao("SyncEngine","Document no longer in limbo: "+n.key),e.Ma.removeReference(n.key,t),e.Ma.containsKey(n.key)||sm(e,n.key)):Do()}function rm(e,t){const s=t.key,n=s.path.canonicalString();e.va.get(s)||e.Ca.has(n)||(Ao("SyncEngine","New document in limbo: "+s),e.Ca.add(n),im(e))}function im(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){const t=e.Ca.values().next().value;e.Ca.delete(t);const s=new rc(tc.fromString(t)),n=e.Na.next();e.Fa.set(n,new Fp(s)),e.va=e.va.insert(s,n),Yh(e.remoteStore,new zu(Bl(Ml(s.path)),n,"TargetPurposeLimboResolution",gc.oe))}}async function am(e,t,s){const n=Lo(e),r=[],i=[],a=[];n.ba.isEmpty()||(n.ba.forEach((e,o)=>{a.push(n.Ba(o,t,s).then(e=>{if((e||s)&&n.isPrimaryClient){const t=e&&!e.fromCache;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){r.push(e);const t=mh.Ki(o.targetId,e);i.push(t)}}))}),await Promise.all(a),n.Sa.h_(r),await async function(e,t){const s=Lo(e);try{await s.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>pc.forEach(t,t=>pc.forEach(t.qi,n=>s.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>pc.forEach(t.Qi,n=>s.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(!fc(e))throw e;Ao("LocalStore","Failed to update sequence numbers: "+e)}for(const n of t){const e=n.targetId;if(!n.fromCache){const t=s.ns.get(e),n=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(n);s.ns=s.ns.insert(e,r)}}}(n.localStore,i))}async function om(e,t){const s=Lo(e);if(!s.currentUser.isEqual(t)){Ao("SyncEngine","User change. New user:",t.toKey());const e=await xh(s.localStore,t);s.currentUser=t,function(e,t){e.Oa.forEach(e=>{e.forEach(e=>{e.reject(new Uo(Mo.CANCELLED,t))})}),e.Oa.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await am(s,e.us)}}function cm(e,t){const s=Lo(e),n=s.Fa.get(t);if(n&&n.wa)return ld().add(n.key);{let e=ld();const n=s.Da.get(t);if(!n)return e;for(const t of n){const n=s.ba.get(t);e=e.unionWith(n.view.Ea)}return e}}function lm(e){const t=Lo(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Yp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=cm.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Jp.bind(null,t),t.Sa.h_=Ap.bind(null,t.eventManager),t.Sa.ka=Op.bind(null,t.eventManager),t}function dm(e){const t=Lo(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Zp.bind(null,t),t}class um{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Uh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return vh(this.persistence,new gh,e.initialUser,this.serializer)}createPersistence(e){return new uh(ph.Hr,this.serializer)}createSharedClientState(e){return new Rh}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class hm{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Xp(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=om.bind(null,this.syncEngine),await vp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Cp}createDatastore(e){const t=Uh(e.databaseInfo.databaseId),s=function(e){return new Lh(e)}(e.databaseInfo);return function(e,t,s,n){return new Wh(e,t,s,n)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(e,t,s,n,r){return new Kh(e,t,s,n,r)}(this.localStore,this.datastore,e.asyncQueue,e=>Xp(this.syncEngine,e,0),Ah.D()?new Ah:new Ih)}createSyncEngine(e,t){return function(e,t,s,n,r,i,a){const o=new Bp(e,t,s,n,r,i);return a&&(o.La=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=Lo(e);Ao("RemoteStore","RemoteStore shutting down."),t.M_.add(5),await qh(t),t.O_.shutdown(),t.N_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class pm{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Oo("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class mm{constructor(e,t,s,n){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=n,this.user=To.UNAUTHENTICATED,this.clientId=Xo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async e=>{Ao("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(s,e=>(Ao("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Uo(Mo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=bp(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function fm(e,t){e.asyncQueue.verifyOperationInProgress(),Ao("FirestoreClient","Initializing OfflineComponentProvider");const s=e.configuration;await t.initialize(s);let n=s.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await xh(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gm(e,t){e.asyncQueue.verifyOperationInProgress();const s=await vm(e);Ao("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(s,e.configuration),e.setCredentialChangeListener(e=>yp(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,s)=>yp(t.remoteStore,s)),e._onlineComponents=t}function ym(e){return"FirebaseError"===e.name?e.code===Mo.FAILED_PRECONDITION||e.code===Mo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function vm(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Ao("FirestoreClient","Using user provided OfflineComponentProvider");try{await fm(e,e._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!ym(s))throw s;jo("Error using user provided cache. Falling back to memory cache: "+s),await fm(e,new um)}}else Ao("FirestoreClient","Using default OfflineComponentProvider"),await fm(e,new um);return e._offlineComponents}async function xm(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Ao("FirestoreClient","Using user provided OnlineComponentProvider"),await gm(e,e._uninitializedComponentsProvider._online)):(Ao("FirestoreClient","Using default OnlineComponentProvider"),await gm(e,new hm))),e._onlineComponents}function _m(e){return xm(e).then(e=>e.syncEngine)}async function Em(e){const t=await xm(e),s=t.eventManager;return s.onListen=Gp.bind(null,t.syncEngine),s.onUnlisten=zp.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=Wp.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=qp.bind(null,t.syncEngine),s}function bm(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new Vo;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,s,n,r){const i=new pm({next:i=>{t.enqueueAndForget(()=>Ip(e,a));const o=i.docs.has(s);!o&&i.fromCache?r.reject(new Uo(Mo.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&i.fromCache&&n&&"server"===n.source?r.reject(new Uo(Mo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(i)},error:e=>r.reject(e)}),a=new Pp(Ml(s.path),i,{includeMetadataChanges:!0,ra:!0});return Rp(e,a)}(await Em(e),e.asyncQueue,t,s,n)),n.promise}function wm(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new Vo;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,s,n,r){const i=new pm({next:s=>{t.enqueueAndForget(()=>Ip(e,a)),s.fromCache&&"server"===n.source?r.reject(new Uo(Mo.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(s)},error:e=>r.reject(e)}),a=new Pp(s,i,{includeMetadataChanges:!0,ra:!0});return Rp(e,a)}(await Em(e),e.asyncQueue,t,s,n)),n.promise}function Nm(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Sm=new Map;function Tm(e,t,s){if(!s)throw new Uo(Mo.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Cm(e){if(!rc.isDocumentKey(e))throw new Uo(Mo.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Rm(e){if(rc.isDocumentKey(e))throw new Uo(Mo.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Im(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":Do()}function Am(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Uo(Mo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Im(e);throw new Uo(Mo.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(s))}}return e}function Om(e,t){if(t<=0)throw new Uo(Mo.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}class jm{constructor(e){var t,s;if(void 0===e.host){if(void 0!==e.ssl)throw new Uo(Mo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Uo(Mo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,s,n){if(!0===t&&!0===n)throw new Uo(Mo.INVALID_ARGUMENT,"".concat(e," and ").concat(s," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Nm(null!==(s=e.experimentalLongPollingOptions)&&void 0!==s?s:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Uo(Mo.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new Uo(Mo.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new Uo(Mo.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class km{constructor(e,t,s,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jm({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Uo(Mo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Uo(Mo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jm(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Bo;switch(e.type){case"firstParty":return new Ko(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Uo(Mo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Sm.get(e);t&&(Ao("ComponentProvider","Removing Datastore"),Sm.delete(e),t.terminate())}(this),Promise.resolve()}}function Dm(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var r;const i=(e=Am(e,km))._getSettings(),a="".concat(t,":").concat(s);if("firestore.googleapis.com"!==i.host&&i.host!==a&&jo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),n.mockUserToken){let t,s;if("string"==typeof n.mockUserToken)t=n.mockUserToken,s=To.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s=t||"demo-project",n=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:"https://securetoken.google.com/".concat(s),aud:s,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Et(JSON.stringify({alg:"none",type:"JWT"})),Et(JSON.stringify(i)),""].join(".")}(n.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new Uo(Mo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new To(i)}e._authCredentials=new Go(new Fo(t,s))}}class Pm{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Pm(this.firestore,e,this._query)}}class Lm{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Lm(this.firestore,e,this._key)}}class Mm extends Pm{constructor(e,t,s){super(e,t,Ml(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Lm(this.firestore,null,new rc(e))}withConverter(e){return new Mm(this.firestore,e,this._path)}}function Um(e,t){for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];if(e=Wt(e),Tm("collection","path",t),e instanceof km){const s=tc.fromString(t,...n);return Rm(s),new Mm(e,null,s)}{if(!(e instanceof Lm||e instanceof Mm))throw new Uo(Mo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(tc.fromString(t,...n));return Rm(s),new Mm(e.firestore,null,s)}}function Vm(e,t){for(var s=arguments.length,n=new Array(s>2?s-2:0),r=2;r<s;r++)n[r-2]=arguments[r];if(e=Wt(e),1===arguments.length&&(t=Xo.newId()),Tm("doc","path",t),e instanceof km){const s=tc.fromString(t,...n);return Cm(s),new Lm(e,null,new rc(s))}{if(!(e instanceof Lm||e instanceof Mm))throw new Uo(Mo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(tc.fromString(t,...n));return Cm(s),new Lm(e.firestore,e instanceof Mm?e.converter:null,new rc(s))}}class Fm{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Vh(this,"async_queue_retry"),this.hu=()=>{const e=Mh();e&&Ao("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};const e=Mh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Mh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new Vo;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(V_){if(!fc(V_))throw V_;Ao("AsyncQueue","Operation failed with retryable error: "+V_)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(e=>{this.au=e,this.uu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Oo("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.uu=!1,e))));return this.iu=t,t}enqueueAfterDelay(e,t,s){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const n=Ep.createAndSchedule(this,e,t,s,e=>this.Eu(e));return this._u.push(n),n}Pu(){this.au&&Do()}verifyOperationInProgress(){}async du(){let e;do{e=this.iu,await e}while(e!==this.iu)}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function Bm(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const s=e;for(const n of t)if(n in s&&"function"==typeof s[n])return!0;return!1}(e,["next","error","complete"])}class Gm extends km{constructor(e,t,s,n){super(e,t,s,n),this.type="firestore",this._queue=new Fm,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Hm(this),this._firestoreClient.terminate()}}function Wm(e){return e._firestoreClient||Hm(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Hm(e){var t,s,n;const r=e._freezeSettings(),i=function(e,t,s,n){return new Bc(e,t,s,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,Nm(n.experimentalLongPollingOptions),n.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._firestoreClient=new mm(e._authCredentials,e._appCheckCredentials,e._queue,i),(null===(s=r.localCache)||void 0===s?void 0:s._offlineComponentProvider)&&(null===(n=r.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}class Km{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Km(kc.fromBase64String(e))}catch(e){throw new Uo(Mo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Km(kc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class zm{constructor(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(let n=0;n<t.length;++n)if(0===t[n].length)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nc(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class qm{constructor(e){this._methodName=e}}class Ym{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Uo(Mo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Uo(Mo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Jo(this._lat,e._lat)||Jo(this._long,e._long)}}const Xm=/^__.*__$/;class Jm{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return null!==this.fieldMask?new Ud(e,this.data,this.fieldMask,t,this.fieldTransforms):new Md(e,this.data,t,this.fieldTransforms)}}class Qm{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new Ud(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Zm(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Do()}}class $m{constructor(e,t,s,n,r,i){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=n,void 0===r&&this.mu(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new $m(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const s=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.gu({path:s,yu:!1});return n.wu(e),n}Su(e){var t;const s=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.gu({path:s,yu:!1});return n.mu(),n}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return gf(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(Zm(this.fu)&&Xm.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class ef{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Uh(e)}Fu(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new $m({fu:e,methodName:t,vu:s,path:nc.emptyPath(),yu:!1,Cu:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function tf(e){const t=e._freezeSettings(),s=Uh(e._databaseId);return new ef(e._databaseId,!!t.ignoreUndefinedProperties,s)}function sf(e,t,s,n,r){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Fu(i.merge||i.mergeFields?2:0,t,s,r);hf("Data must be an object, but it was:",a,n);const o=df(n,a);let c,l;if(i.merge)c=new Oc(a.fieldMask),l=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const n of i.mergeFields){const r=pf(t,n,s);if(!a.contains(r))throw new Uo(Mo.INVALID_ARGUMENT,"Field '".concat(r,"' is specified in your field mask but missing from your input data."));yf(e,r)||e.push(r)}c=new Oc(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new Jm(new il(o),c,l)}class nf extends qm{_toFieldTransform(e){if(2!==e.fu)throw 1===e.fu?e.Du("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Du("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof nf}}class rf extends qm{_toFieldTransform(e){return new Cd(e.path,new xd)}isEqual(e){return e instanceof rf}}function af(e,t,s,n){const r=e.Fu(1,t,s);hf("Data must be an object, but it was:",r,n);const i=[],a=il.empty();Nc(n,(e,n)=>{const o=ff(t,e,s);n=Wt(n);const c=r.Su(o);if(n instanceof nf)i.push(o);else{const e=lf(n,c);null!=e&&(i.push(o),a.set(o,e))}});const o=new Oc(i);return new Qm(a,o,r.fieldTransforms)}function of(e,t,s,n,r,i){const a=e.Fu(1,t,s),o=[pf(t,n,s)],c=[r];if(i.length%2!=0)throw new Uo(Mo.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let h=0;h<i.length;h+=2)o.push(pf(t,i[h])),c.push(i[h+1]);const l=[],d=il.empty();for(let h=o.length-1;h>=0;--h)if(!yf(l,o[h])){const e=o[h];let t=c[h];t=Wt(t);const s=a.Su(e);if(t instanceof nf)l.push(e);else{const n=lf(t,s);null!=n&&(l.push(e),d.set(e,n))}}const u=new Oc(l);return new Qm(d,u,a.fieldTransforms)}function cf(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return lf(s,e.Fu(n?4:3,t))}function lf(e,t){if(uf(e=Wt(e)))return hf("Unsupported field value:",t,e),df(e,t);if(e instanceof qm)return function(e,t){if(!Zm(t.fu))throw t.Du("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Du("".concat(e._methodName,"() is not currently supported inside arrays"));const s=e._toFieldTransform(t);s&&t.fieldTransforms.push(s)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");return function(e,t){const s=[];let n=0;for(const r of e){let e=lf(r,t.bu(n));null==e&&(e={nullValue:"NULL_VALUE"}),s.push(e),n++}return{arrayValue:{values:s}}}(e,t)}return function(e,t){if(null===(e=Wt(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return md(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const s=Zo.fromDate(e);return{timestampValue:xu(t.serializer,s)}}if(e instanceof Zo){const s=new Zo(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:xu(t.serializer,s)}}if(e instanceof Ym)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Km)return{bytesValue:_u(t.serializer,e._byteString)};if(e instanceof Lm){const s=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(s))throw t.Du("Document reference is for database ".concat(n.projectId,"/").concat(n.database," but should be for database ").concat(s.projectId,"/").concat(s.database));return{referenceValue:wu(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Du("Unsupported field value: ".concat(Im(e)))}(e,t)}function df(e,t){const s={};return Sc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Nc(e,(e,n)=>{const r=lf(n,t.pu(e));null!=r&&(s[e]=r)}),{mapValue:{fields:s}}}function uf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Zo||e instanceof Ym||e instanceof Km||e instanceof Lm||e instanceof qm)}function hf(e,t,s){if(!uf(s)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(s)){const n=Im(s);throw"an object"===n?t.Du(e+" a custom object"):t.Du(e+" "+n)}}function pf(e,t,s){if((t=Wt(t))instanceof zm)return t._internalPath;if("string"==typeof t)return ff(e,t);throw gf("Field path arguments must be of type string or ",e,!1,void 0,s)}const mf=new RegExp("[~\\*/\\[\\]]");function ff(e,t,s){if(t.search(mf)>=0)throw gf("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,s);try{return new zm(...t.split("."))._internalPath}catch(Ue){throw gf("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,s)}}function gf(e,t,s,n,r){const i=n&&!n.isEmpty(),a=void 0!==r;let o="Function ".concat(t,"() called with invalid data");s&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=" in field ".concat(n)),a&&(c+=" in document ".concat(r)),c+=")"),new Uo(Mo.INVALID_ARGUMENT,o+e+c)}function yf(e,t){return e.some(e=>e.isEqual(t))}class vf{constructor(e,t,s,n,r){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=n,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Lm(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new xf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(_f("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class xf extends vf{data(){return super.data()}}function _f(e,t){return"string"==typeof t?ff(e,t):t instanceof zm?t._internalPath:t._delegate._internalPath}function Ef(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Uo(Mo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class bf{}class wf extends bf{}function Nf(e,t){let s=[];for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];t instanceof bf&&s.push(t),s=s.concat(r),function(e){const t=e.filter(e=>e instanceof Cf).length,s=e.filter(e=>e instanceof Sf).length;if(t>1||t>0&&s>0)throw new Uo(Mo.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const a of s)e=a._apply(e);return e}class Sf extends wf{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Sf(e,t,s)}_apply(e){const t=this._parse(e);return Df(e._query,t),new Pm(e.firestore,e.converter,Wl(e._query,t))}_parse(e){const t=tf(e.firestore),s=function(e,t,s,n,r,i,a){let o;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(i,"' queries on documentId()."));if("in"===i||"not-in"===i){kf(a,i);const t=[];for(const s of a)t.push(jf(n,e,s));o={arrayValue:{values:t}}}else o=jf(n,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||kf(a,i),o=cf(s,t,a,"in"===i||"not-in"===i);return ml.create(r,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return s}}function Tf(e,t,s){const n=t,r=_f("where",e);return Sf._create(r,n,s)}class Cf extends bf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Cf(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:fl.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let s=e;const n=t.getFlattenedFilters();for(const r of n)Df(s,r),s=Wl(s,r)}(e._query,t),new Pm(e.firestore,e.converter,Wl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Rf extends wf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Rf(e,t)}_apply(e){const t=function(e,t,s){if(null!==e.startAt)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ul(t,s)}(e._query,this._field,this._direction);return new Pm(e.firestore,e.converter,function(e,t){const s=e.explicitOrderBy.concat([t]);return new Pl(e.path,e.collectionGroup,s,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function If(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",s=_f("orderBy",e);return Rf._create(s,t)}class Af extends wf{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new Af(e,t,s)}_apply(e){return new Pm(e.firestore,e.converter,Hl(e._query,this._limit,this._limitType))}}function Of(e){return Om("limit",e),Af._create("limit",e,"F")}function jf(e,t,s){if("string"==typeof(s=Wt(s))){if(""===s)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vl(t)&&-1!==s.indexOf("/"))throw new Uo(Mo.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(s,"' contains a '/' character."));const n=t.path.child(tc.fromString(s));if(!rc.isDocumentKey(n))throw new Uo(Mo.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(n,"' is not because it has an odd number of segments (").concat(n.length,")."));return Qc(e,new rc(n))}if(s instanceof Lm)return Qc(e,s._key);throw new Uo(Mo.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Im(s),"."))}function kf(e,t){if(!Array.isArray(e)||0===e.length)throw new Uo(Mo.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function Df(e,t){const s=function(e,t){for(const s of e)for(const e of s.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==s)throw s===t.op?new Uo(Mo.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new Uo(Mo.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(s.toString(),"' filters."))}class Pf{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Hc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Lc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Mc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Do()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const s={};return Nc(e,(e,n)=>{s[e]=this.convertValue(n,t)}),s}convertGeoPoint(e){return new Ym(Lc(e.latitude),Lc(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Vc(e);return null==s?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Fc(e));default:return null}}convertTimestamp(e){const t=Pc(e);return new Zo(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=tc.fromString(e);Po(Ku(s));const n=new Gc(s.get(1),s.get(3)),r=new rc(s.popFirst(5));return n.isEqual(t)||Oo("Document ".concat(r," contains a document reference within a different database (").concat(n.projectId,"/").concat(n.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),r}}function Lf(e,t,s){let n;return n=e?s&&(s.merge||s.mergeFields)?e.toFirestore(t,s):e.toFirestore(t):t,n}class Mf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Uf extends vf{constructor(e,t,s,n,r,i){super(e,t,s,n,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Vf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const s=this._document.data.field(_f("DocumentSnapshot.get",e));if(null!==s)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}}class Vf extends Uf{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class Ff{constructor(e,t,s,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new Mf(n.hasPendingWrites,n.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new Vf(this._firestore,this._userDataWriter,s.key,s,new Mf(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Uo(Mo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(s=>{const n=new Vf(e._firestore,e._userDataWriter,s.doc.key,s.doc,new Mf(e._snapshot.mutatedKeys.has(s.doc.key),e._snapshot.fromCache),e.query.converter);return s.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let s=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const n=new Vf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Mf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(s=s.add(t.doc),i=s.indexOf(t.doc.key)),{type:Bf(t.type),doc:n,oldIndex:r,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Bf(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Do()}}function Gf(e){e=Am(e,Lm);const t=Am(e.firestore,Gm);return bm(Wm(t),e._key).then(s=>Qf(t,e,s))}class Wf extends Pf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Km(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Lm(this.firestore,null,t)}}function Hf(e){e=Am(e,Pm);const t=Am(e.firestore,Gm),s=Wm(t),n=new Wf(t);return Ef(e._query),wm(s,e._query).then(s=>new Ff(t,n,e,s))}function Kf(e,t,s){e=Am(e,Lm);const n=Am(e.firestore,Gm),r=Lf(e.converter,t,s);return Jf(n,[sf(tf(n),"setDoc",e._key,r,null!==e.converter,s).toMutation(e._key,Id.none())])}function zf(e,t,s){e=Am(e,Lm);const n=Am(e.firestore,Gm),r=tf(n);let i;for(var a=arguments.length,o=new Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];return i="string"==typeof(t=Wt(t))||t instanceof zm?of(r,"updateDoc",e._key,t,s,o):af(r,"updateDoc",e._key,t),Jf(n,[i.toMutation(e._key,Id.exists(!0))])}function qf(e){return Jf(Am(e.firestore,Gm),[new Gd(e._key,Id.none())])}function Yf(e,t){const s=Am(e.firestore,Gm),n=Vm(e),r=Lf(e.converter,t);return Jf(s,[sf(tf(e.firestore),"addDoc",n._key,r,null!==e.converter,{}).toMutation(n._key,Id.exists(!1))]).then(()=>n)}function Xf(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];var r,i,a;e=Wt(e);let o={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof s[c]||Bm(s[c])||(o=s[c],c++);const l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Bm(s[c])){const e=s[c];s[c]=null===(r=e.next)||void 0===r?void 0:r.bind(e),s[c+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),s[c+2]=null===(a=e.complete)||void 0===a?void 0:a.bind(e)}let d,u,h;if(e instanceof Lm)u=Am(e.firestore,Gm),h=Ml(e._key.path),d={next:t=>{s[c]&&s[c](Qf(u,e,t))},error:s[c+1],complete:s[c+2]};else{const t=Am(e,Pm);u=Am(t.firestore,Gm),h=t._query;const n=new Wf(u);d={next:e=>{s[c]&&s[c](new Ff(u,n,t,e))},error:s[c+1],complete:s[c+2]},Ef(e._query)}return function(e,t,s,n){const r=new pm(n),i=new Pp(t,r,s);return e.asyncQueue.enqueueAndForget(async()=>Rp(await Em(e),i)),()=>{r.$a(),e.asyncQueue.enqueueAndForget(async()=>Ip(await Em(e),i))}}(Wm(u),h,l,d)}function Jf(e,t){return function(e,t){const s=new Vo;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,s){const n=dm(e);try{const e=await function(e,t){const s=Lo(e),n=Zo.now(),r=t.reduce((e,t)=>e.add(t.key),ld());let i,a;return s.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=ed(),c=ld();return s.os.getEntries(e,r).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(e,o)).next(r=>{i=r;const a=[];for(const e of t){const t=Pd(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new Ud(e.key,t,al(t.value.mapValue),Id.exists(!0)))}return s.mutationQueue.addMutationBatch(e,n,a,t)}).next(t=>{a=t;const n=t.applyToLocalDocumentSet(i,c);return s.documentOverlayCache.saveOverlays(e,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:nd(i)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),function(e,t,s){let n=e.xa[e.currentUser.toKey()];n||(n=new Tc(Jo)),n=n.insert(t,s),e.xa[e.currentUser.toKey()]=n}(n,e.batchId,s),await am(n,e.changes),await cp(n.remoteStore)}catch(e){const t=bp(e,"Failed to persist write");s.reject(t)}}(await _m(e),t,s)),s.promise}(Wm(e),t)}function Qf(e,t,s){const n=s.docs.get(t._key),r=new Wf(e);return new Uf(e,r,t._key,n,new Mf(s.hasPendingWrites,s.fromCache),t.converter)}function Zf(){return new rf("serverTimestamp")}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Co=e}(nn),Zs(new Ht("firestore",(e,s)=>{let{instanceIdentifier:n,options:r}=s;const i=e.getProvider("app").getImmediate(),a=new Gm(new Wo(e.getProvider("auth-internal")),new qo(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Uo(Mo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gc(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),on(So,"4.6.3",e),on(So,"4.6.3","esm2017")}();const $f="functions";class eg{constructor(e,t,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||s.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(V_){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(V_){return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const tg="us-central1";class sg{constructor(e,t,s,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tg,i=arguments.length>5?arguments[5]:void 0;this.app=e,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new eg(t,s,n),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(r);this.customDomain=e.origin,this.region=tg}catch(V_){this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){const s=this.emulatorOrigin;return"".concat(s,"/").concat(t,"/").concat(this.region,"/").concat(e)}return null!==this.customDomain?"".concat(this.customDomain,"/").concat(e):"https://".concat(this.region,"-").concat(t,".cloudfunctions.net/").concat(e)}}const ng="@firebase/functions",rg="0.11.5";!function(e,t){Zs(new Ht($f,(t,s)=>{let{instanceIdentifier:n}=s;const r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),a=t.getProvider("messaging-internal"),o=t.getProvider("app-check-internal");return new sg(r,i,a,o,n,e)},"PUBLIC").setMultipleInstances(!0)),on(ng,rg,t),on(ng,rg,"esm2017")}(fetch.bind(self));var ig=s(6111),ag=s.n(ig);const og=new class{constructor(){this.config={firebase:{apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_API_KEY,authDomain:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_AUTH_DOMAIN,projectId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_PROJECT_ID,storageBucket:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_STORAGE_BUCKET,messagingSenderId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_APP_ID},ai:{openai:{apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_OPENAI_API_KEY,model:"gpt-4"},googleAI:{apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_GOOGLE_AI_API_KEY},anthropic:{apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ANTHROPIC_API_KEY}},agora:{appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_APP_ID,appCertificate:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_APP_CERTIFICATE},environment:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENVIRONMENT||"development",apiBaseUrl:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL,features:{aiFeatures:"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENABLE_AI_FEATURES,voiceCommands:"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENABLE_VOICE_COMMANDS,emergencyAlerts:"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENABLE_EMERGENCY_ALERTS,medicationReminders:"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENABLE_MEDICATION_REMINDERS},analytics:{googleAnalyticsId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_GOOGLE_ANALYTICS_ID},sms:{twilioAccountSid:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_TWILIO_ACCOUNT_SID,twilioAuthToken:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_TWILIO_AUTH_TOKEN,twilioPhoneNumber:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_TWILIO_PHONE_NUMBER},email:{sendgridApiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SENDGRID_API_KEY,fromEmail:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FROM_EMAIL||"noreply@elderx.com"},security:{encryptionKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENCRYPTION_KEY,jwtSecret:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_JWT_SECRET}}}get(e){return e.split(".").reduce((e,t)=>null===e||void 0===e?void 0:e[t],this.config)}isFeatureEnabled(e){return!0===this.config.features[e]}isDevelopment(){return"development"===this.config.environment}isProduction(){return"production"===this.config.environment}getApiBaseUrl(){return this.config.apiBaseUrl}validate(){const e=["firebase.apiKey","firebase.projectId","firebase.authDomain"].filter(e=>!this.get(e));return!(e.length>0)||(console.warn("Missing required environment variables:",e),!1)}getAll(){return this.config}};og.validate()||console.warn("Environment configuration validation failed. Some features may not work properly.");const cg=og,lg="network",dg="auth",ug="permission",hg="validation",pg="server",mg="unknown",fg="low",gg="medium",yg="high",vg="critical";const xg=new class{constructor(){this.errorLog=[],this.maxLogSize=100,this.isOnline=navigator.onLine,window.addEventListener("online",()=>{this.isOnline=!0,this.syncOfflineErrors()}),window.addEventListener("offline",()=>{this.isOnline=!1})}handleError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=this.analyzeError(e,t);return this.logError(s),this.showUserNotification(s),cg.isProduction()&&this.reportToMonitoring(s),s}analyzeError(e,t){return{id:this.generateErrorId(),timestamp:(new Date).toISOString(),message:e.message||"An unexpected error occurred",stack:e.stack,type:this.determineErrorType(e),severity:this.determineErrorSeverity(e,t),context:t,userMessage:this.generateUserMessage(e,t),action:this.determineAction(e,t),isOnline:this.isOnline}}determineErrorType(e){var t,s;return"auth/user-not-found"===e.code||"auth/wrong-password"===e.code?dg:"permission-denied"===e.code||"auth/insufficient-permission"===e.code?ug:"unavailable"===e.code||null!==(t=e.message)&&void 0!==t&&t.includes("network")?lg:"invalid-argument"===e.code||"failed-precondition"===e.code?hg:null!==(s=e.code)&&void 0!==s&&s.startsWith("functions/")||e.status>=500?pg:mg}determineErrorSeverity(e,t){return"auth/network-request-failed"===e.code&&t.critical||e.type===ug&&t.sensitive?vg:e.type===dg||e.type===pg?yg:e.type===lg||e.type===hg?gg:fg}generateUserMessage(e,t){switch(this.determineErrorType(e)){case dg:return"Please check your login credentials and try again.";case ug:return"You don't have permission to perform this action.";case lg:return"Please check your internet connection and try again.";case hg:return"Please check your input and try again.";case pg:return"Our servers are experiencing issues. Please try again later.";default:return"Something went wrong. Please try again."}}determineAction(e,t){switch(this.determineErrorType(e)){case dg:return{type:"redirect",path:"/login"};case ug:return{type:"redirect",path:"/dashboard"};case lg:return{type:"retry",delay:3e3};case hg:return{type:"fix_input"};case pg:return{type:"retry",delay:5e3};default:return{type:"none"}}}showUserNotification(e){const{severity:t,userMessage:s,action:n}=e;let r="error",i=5e3;switch(t){case vg:r="error",i=!1;break;case yg:r="error",i=7e3;break;case gg:r="warning",i=5e3;break;case fg:r="info",i=3e3}yt[r](s,{autoClose:i,position:"top-right",hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),"redirect"===n.type&&setTimeout(()=>{window.location.href=n.path},2e3)}logError(e){this.errorLog.push(e),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(-this.maxLogSize));try{localStorage.setItem("elderx_error_log",JSON.stringify(this.errorLog))}catch(V_){console.warn("Could not save error log to localStorage:",V_)}cg.isDevelopment()&&console.error("Error handled:",e)}async reportToMonitoring(e){try{console.log("Reporting error to monitoring service:",e)}catch(V_){console.error("Failed to report error to monitoring service:",V_)}}async syncOfflineErrors(){const e=this.errorLog.filter(e=>!e.isOnline);for(const t of e)await this.reportToMonitoring(t)}getErrorLog(){return this.errorLog}clearErrorLog(){this.errorLog=[],localStorage.removeItem("elderx_error_log")}generateErrorId(){return"error_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}handleNetworkError(e,t){return this.handleError(e,Le(Le({},t),{},{type:lg}))}handleAuthError(e,t){return this.handleError(e,Le(Le({},t),{},{type:dg}))}handlePermissionError(e,t){return this.handleError(e,Le(Le({},t),{},{type:ug}))}handleValidationError(e,t){return this.handleError(e,Le(Le({},t),{},{type:hg}))}},_g=0,Eg=1,bg=2,wg=3,Ng=4;const Sg=new class{constructor(){this.logLevel=cg.isDevelopment()?_g:Eg,this.logs=[],this.maxLogSize=1e3}setLogLevel(e){this.logLevel=e}debug(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(_g,"DEBUG",e,t)}info(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(Eg,"INFO",e,t)}warn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(bg,"WARN",e,t)}error(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(wg,"ERROR",e,t)}critical(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log(Ng,"CRITICAL",e,t)}log(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e<this.logLevel)return;const r={timestamp:(new Date).toISOString(),level:t,message:s,data:n,url:window.location.href,userAgent:navigator.userAgent,userId:this.getCurrentUserId()};this.logs.push(r),this.logs.length>this.maxLogSize&&(this.logs=this.logs.slice(-this.maxLogSize)),this.consoleLog(t,s,n),this.persistLog(r),cg.isProduction()&&e>=wg&&this.sendToRemoteService(r)}consoleLog(e,t,s){const n="[".concat(e,"] ").concat(t);switch(e){case"DEBUG":console.debug(n,s);break;case"INFO":console.info(n,s);break;case"WARN":console.warn(n,s);break;case"ERROR":case"CRITICAL":console.error(n,s);break;default:console.log(n,s)}}persistLog(e){try{const t=JSON.parse(localStorage.getItem("elderx_logs")||"[]");t.push(e),t.length>this.maxLogSize&&t.splice(0,t.length-this.maxLogSize),localStorage.setItem("elderx_logs",JSON.stringify(t))}catch(V_){console.warn("Could not persist log to localStorage:",V_)}}async sendToRemoteService(e){try{console.log("Sending log to remote service:",e)}catch(V_){console.error("Failed to send log to remote service:",V_)}}getCurrentUserId(){try{return JSON.parse(localStorage.getItem("elderx_user")||"{}").uid||"anonymous"}catch(V_){return"anonymous"}}getLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,s=this.logs;return e&&(s=this.logs.filter(t=>t.level===e)),s.slice(-t)}clearLogs(){this.logs=[],localStorage.removeItem("elderx_logs")}time(e){console.time(e)}timeEnd(e){console.timeEnd(e)}group(e){console.group(e)}groupEnd(){console.groupEnd()}table(e){console.table(e)}trace(e){console.trace(e)}count(e){console.count(e)}assert(e,t){console.assert(e,t)}},Tg=Sg;const Cg=new class{constructor(){this.encryptionKey={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENCRYPTION_KEY||this.generateKey(),this.algorithm="AES-256-CBC"}generateKey(){const e=ag().lib.WordArray.random(32).toString();return Tg.warn("Using generated encryption key - set REACT_APP_ENCRYPTION_KEY in production"),e}encrypt(e){try{if(!e)return e;const t="string"===typeof e?e:JSON.stringify(e),s=ag().AES.encrypt(t,this.encryptionKey).toString();return Tg.debug("Data encrypted successfully",{dataType:typeof e,encryptedLength:s.length}),s}catch(t){throw Tg.error("Encryption failed",{error:t,dataType:typeof e}),xg.handleError(t,{context:"data_encryption"}),new Error("Failed to encrypt data")}}decrypt(e){try{if(!e)return e;const s=ag().AES.decrypt(e,this.encryptionKey).toString(ag().enc.Utf8);try{return JSON.parse(s)}catch(t){return s}}catch(s){throw Tg.error("Decryption failed",{error:s}),xg.handleError(s,{context:"data_decryption"}),new Error("Failed to decrypt data")}}encryptHealthData(e){const t=Le({},e);return["allergies","medicalConditions","medicationNotes","vitalSignsNotes","appointmentNotes","emergencyContactPhone","primaryCareDoctor"].forEach(e=>{t[e]&&(t[e]=this.encrypt(t[e]))}),t}decryptHealthData(e){const t=Le({},e);return["allergies","medicalConditions","medicationNotes","vitalSignsNotes","appointmentNotes","emergencyContactPhone","primaryCareDoctor"].forEach(e=>{if(t[e])try{t[e]=this.decrypt(t[e])}catch(s){Tg.warn("Failed to decrypt field: ".concat(e),{error:s})}}),t}hash(e){try{return ag().SHA256(e).toString()}catch(t){throw Tg.error("Hashing failed",{error:t}),xg.handleError(t,{context:"data_hashing"}),new Error("Failed to hash data")}}generateSecureToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;return ag().lib.WordArray.random(e).toString()}encryptFile(e){try{return ag().AES.encrypt(e,this.encryptionKey).toString()}catch(t){throw Tg.error("File encryption failed",{error:t}),xg.handleError(t,{context:"file_encryption"}),new Error("Failed to encrypt file")}}decryptFile(e){try{return ag().AES.decrypt(e,this.encryptionKey).toString(ag().enc.Utf8)}catch(t){throw Tg.error("File decryption failed",{error:t}),xg.handleError(t,{context:"file_decryption"}),new Error("Failed to decrypt file")}}validateKeyStrength(e){if(!e||e.length<32)return!1;const t=/[A-Z]/.test(e),s=/[a-z]/.test(e),n=/\d/.test(e),r=/[!@#$%^&*(),.?":{}|<>]/.test(e);return t&&s&&n&&r}rotateKey(e){if(!this.validateKeyStrength(e))throw new Error("New encryption key does not meet security requirements");this.encryptionKey=e,Tg.info("Encryption key rotated successfully")}},Rg=Cg;const Ig=new class{constructor(){this.config=this.loadSecureConfig(),this.validateConfig()}loadSecureConfig(){return{firebase:{apiKey:this.getSecureValue("REACT_APP_FIREBASE_API_KEY"),authDomain:this.getSecureValue("REACT_APP_FIREBASE_AUTH_DOMAIN"),projectId:this.getSecureValue("REACT_APP_FIREBASE_PROJECT_ID"),storageBucket:this.getSecureValue("REACT_APP_FIREBASE_STORAGE_BUCKET"),messagingSenderId:this.getSecureValue("REACT_APP_FIREBASE_MESSAGING_SENDER_ID"),appId:this.getSecureValue("REACT_APP_FIREBASE_APP_ID")},ai:{openai:this.getSecureValue("REACT_APP_OPENAI_API_KEY"),google:this.getSecureValue("REACT_APP_GOOGLE_AI_API_KEY"),anthropic:this.getSecureValue("REACT_APP_ANTHROPIC_API_KEY")},security:{encryptionKey:this.getSecureValue("REACT_APP_ENCRYPTION_KEY"),jwtSecret:this.getSecureValue("REACT_APP_JWT_SECRET"),sessionTimeout:parseInt(this.getSecureValue("REACT_APP_SESSION_TIMEOUT","3600")),maxLoginAttempts:parseInt(this.getSecureValue("REACT_APP_MAX_LOGIN_ATTEMPTS","5")),lockoutDuration:parseInt(this.getSecureValue("REACT_APP_LOCKOUT_DURATION","900"))},features:{twoFactorAuth:"true"===this.getSecureValue("REACT_APP_ENABLE_2FA","false"),biometricAuth:"true"===this.getSecureValue("REACT_APP_ENABLE_BIOMETRIC","false"),dataEncryption:"true"===this.getSecureValue("REACT_APP_ENABLE_ENCRYPTION","true"),auditLogging:"true"===this.getSecureValue("REACT_APP_ENABLE_AUDIT_LOG","true"),rateLimiting:"true"===this.getSecureValue("REACT_APP_ENABLE_RATE_LIMITING","true")},environment:"production",isProduction:!0,isDevelopment:!1}}getSecureValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}[e]||t;if(this.isProduction&&this.isEncryptedValue(s))try{return Rg.decrypt(s)}catch(n){return Tg.error("Failed to decrypt config value: ".concat(e),{error:n}),t}return s}isEncryptedValue(e){return"string"===typeof e&&e.startsWith("enc:")}validateConfig(){const e=["REACT_APP_FIREBASE_API_KEY","REACT_APP_FIREBASE_PROJECT_ID"].filter(e=>!{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}[e]);e.length>0&&Tg.error("Missing required configuration keys",{missingKeys:e}),this.config.firebase.apiKey&&this.config.firebase.projectId||Tg.warn("Firebase configuration incomplete; downstream will use safe fallbacks."),this.config.isProduction&&(this.config.security.encryptionKey?Rg.validateKeyStrength(this.config.security.encryptionKey)||Tg.warn("Encryption key may be weak; consider rotating to a stronger key."):Tg.warn("Encryption key missing in production; continuing with generated key.")),Tg.info("Configuration validated successfully")}get(e){const t=e.split(".");let s=this.config;for(const r of t){var n;if(s=null===(n=s)||void 0===n?void 0:n[r],void 0===s)break}return s}getFirebaseConfig(){return this.config.firebase}getAIKeys(){return this.config.ai}getSecurityConfig(){return this.config.security}getFeatureFlags(){return this.config.features}isFeatureEnabled(e){return!0===this.config.features[e]}getEnvironment(){return{environment:this.config.environment,isProduction:this.config.isProduction,isDevelopment:this.config.isDevelopment}}encryptConfig(e){const t=["apiKey","secret","password","token","key"],s=Le({},e);return Object.keys(s).forEach(e=>{t.some(t=>e.toLowerCase().includes(t))&&"string"===typeof s[e]&&(s[e]="enc:".concat(Rg.encrypt(s[e])))}),s}decryptConfig(e){const t=Le({},e);return Object.keys(t).forEach(e=>{if("string"===typeof t[e]&&t[e].startsWith("enc:"))try{t[e]=Rg.decrypt(t[e].substring(4))}catch(s){Tg.warn("Failed to decrypt config key: ".concat(e),{error:s})}}),t}generateSecureConfig(){const e={firebase:this.config.firebase,security:{sessionTimeout:this.config.security.sessionTimeout,maxLoginAttempts:this.config.security.maxLoginAttempts,lockoutDuration:this.config.security.lockoutDuration},features:this.config.features,environment:this.config.environment};return this.encryptConfig(e)}},Ag=Ig;var Og,jg;let kg=Ag.getFirebaseConfig();null!==(Og=kg)&&void 0!==Og&&Og.apiKey&&null!==(jg=kg)&&void 0!==jg&&jg.projectId||(Tg.warn("Firebase config missing from env; falling back to public config."),kg={apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_API_KEY||"AIzaSyDDwYYZBHf-EnSxRa6ACc6OfUrpT4JdT04",authDomain:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_AUTH_DOMAIN||"elderx-f5c2b.firebaseapp.com",projectId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_PROJECT_ID||"elderx-f5c2b",storageBucket:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_STORAGE_BUCKET||"elderx-f5c2b.firebasestorage.app",messagingSenderId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_MESSAGING_SENDER_ID||"987610993096",appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_FIREBASE_APP_ID||"1:987610993096:web:97c82732772d1223d3f0fd"});const Dg=rn(kg),Pg=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:an();const t=$s(e,"auth");if(t.isInitialized())return t.getImmediate();const s=function(e,t){const s=$s(e,"auth");if(s.isInitialized()){const e=s.getImmediate();if(Lt(s.getOptions(),null!==t&&void 0!==t?t:{}))return e;Nn(e,"already-initialized")}return s.initialize({options:t})}(e,{popupRedirectResolver:Ja,persistence:[$i,Li,Ui]}),n=Rt("authTokenSyncURL");if(n&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(n,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),s=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>eo)return;const n=null===t||void 0===t?void 0:t.token;to!==n&&(to=n,await fetch(r,{method:n?"POST":"DELETE",headers:n?{Authorization:"Bearer ".concat(n)}:{}}))});!function(e,t,s){Wt(e).beforeAuthStateChanged(t,s)}(s,t,()=>t(s.currentUser)),function(e,t,s,n){Wt(e).onIdTokenChanged(t,s,n)}(s,e=>t(e))}}var r;const i=St("auth");return i&&Br(s,"http://".concat(i)),s}(Dg),Lg=function(e,t){const s="string"==typeof e?e:t||"(default)",n=$s("object"==typeof e?e:an(),"firestore").getImmediate({identifier:s});if(!n._initialized){const e=Tt("firestore");e&&Dm(n,...e)}return n}(Dg);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:an(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tg;const s=$s(Wt(e),$f).getImmediate({identifier:t}),n=Tt("functions");n&&function(e,t,s){!function(e,t,s){e.emulatorOrigin="http://".concat(t,":").concat(s)}(Wt(e),t,s)}(s,...n)}(Dg);const Mg=new class{constructor(){this.dataConnect=null}async executeQuery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var s;Tg.debug("Executing Data Connect query: ".concat(e),{variables:t});const n=await this.dataConnect.executeQuery(e,t);return Tg.info("Data Connect query successful: ".concat(e),{resultCount:(null===(s=n.data)||void 0===s?void 0:s.length)||0}),n}catch(n){throw Tg.error("Data Connect query failed: ".concat(e),{error:n,variables:t}),xg.handleError(n,{context:"data_connect_query",queryName:e,variables:t}),n}}async executeMutation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var s;Tg.debug("Executing Data Connect mutation: ".concat(e),{variables:t});const n=await this.dataConnect.executeMutation(e,t);return Tg.info("Data Connect mutation successful: ".concat(e),{resultId:null===(s=n.data)||void 0===s?void 0:s.id}),n}catch(n){throw Tg.error("Data Connect mutation failed: ".concat(e),{error:n,variables:t}),xg.handleError(n,{context:"data_connect_mutation",mutationName:e,variables:t}),n}}async getUserProfile(e){return this.executeQuery("GetUserProfile",{userId:e})}async getCurrentUser(){return this.executeQuery("GetCurrentUser")}async getAllUsers(){return this.executeQuery("GetAllUsers")}async createUserProfile(e){return this.executeMutation("CreateUserProfile",e)}async updateUserProfile(e,t){return this.executeMutation("UpdateUserProfile",Le({userId:e},t))}async getElderlyProfile(e){return this.executeQuery("GetElderlyProfile",{userId:e})}async getCurrentElderlyProfile(){return this.executeQuery("GetCurrentElderlyProfile")}async createElderlyProfile(e){return this.executeMutation("CreateElderlyProfile",e)}async updateElderlyProfile(e,t){return this.executeMutation("UpdateElderlyProfile",Le({profileId:e},t))}async getMedications(e){return this.executeQuery("GetMedications",{elderlyProfileId:e})}async getCurrentUserMedications(){return this.executeQuery("GetCurrentUserMedications")}async getActiveMedications(e){return this.executeQuery("GetActiveMedications",{elderlyProfileId:e})}async getMedicationById(e){return this.executeQuery("GetMedicationById",{medicationId:e})}async createMedication(e){return this.executeMutation("CreateMedication",e)}async updateMedication(e,t){return this.executeMutation("UpdateMedication",Le({medicationId:e},t))}async deleteMedication(e){return this.executeMutation("DeleteMedication",{medicationId:e})}async getMedicationLogs(e){return this.executeQuery("GetMedicationLogs",{medicationId:e})}async getRecentMedicationLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.executeQuery("GetRecentMedicationLogs",{elderlyProfileId:e,limit:t})}async logMedicationDose(e){return this.executeMutation("LogMedicationDose",e)}async getVitalSigns(e){return this.executeQuery("GetVitalSigns",{elderlyProfileId:e})}async getCurrentUserVitalSigns(){return this.executeQuery("GetCurrentUserVitalSigns")}async getVitalSignsByType(e,t){return this.executeQuery("GetVitalSignsByType",{elderlyProfileId:e,type:t})}async getRecentVitalSigns(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.executeQuery("GetRecentVitalSigns",{elderlyProfileId:e,limit:t})}async getVitalSignsByDateRange(e,t,s){return this.executeQuery("GetVitalSignsByDateRange",{elderlyProfileId:e,startDate:t,endDate:s})}async createVitalSign(e){return this.executeMutation("CreateVitalSign",e)}async updateVitalSign(e,t){return this.executeMutation("UpdateVitalSign",Le({vitalSignId:e},t))}async deleteVitalSign(e){return this.executeMutation("DeleteVitalSign",{vitalSignId:e})}async getAppointments(e){return this.executeQuery("GetAppointments",{elderlyProfileId:e})}async getCurrentUserAppointments(){return this.executeQuery("GetCurrentUserAppointments")}async getUpcomingAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return this.executeQuery("GetUpcomingAppointments",{elderlyProfileId:e,limit:t})}async getAppointmentsByDateRange(e,t,s){return this.executeQuery("GetAppointmentsByDateRange",{elderlyProfileId:e,startDate:t,endDate:s})}async getAppointmentById(e){return this.executeQuery("GetAppointmentById",{appointmentId:e})}async createAppointment(e){return this.executeMutation("CreateAppointment",e)}async updateAppointment(e,t){return this.executeMutation("UpdateAppointment",Le({appointmentId:e},t))}async deleteAppointment(e){return this.executeMutation("DeleteAppointment",{appointmentId:e})}async getCaregiverRelationships(e){return this.executeQuery("GetCaregiverRelationships",{elderlyProfileId:e})}async getCurrentUserCaregivers(){return this.executeQuery("GetCurrentUserCaregivers")}async getCaregiverPatients(e){return this.executeQuery("GetCaregiverPatients",{caregiverId:e})}async getCurrentCaregiverPatients(){return this.executeQuery("GetCurrentCaregiverPatients")}async createCaregiverRelationship(e){return this.executeMutation("CreateCaregiverRelationship",e)}async updateCaregiverRelationship(e,t){return this.executeMutation("UpdateCaregiverRelationship",Le({relationshipId:e},t))}async deleteCaregiverRelationship(e){return this.executeMutation("DeleteCaregiverRelationship",{relationshipId:e})}async batchExecute(e){try{Tg.debug("Executing batch operations",{operationCount:e.length});const t=await Promise.allSettled(e.map(e=>{if("query"===e.type)return this.executeQuery(e.name,e.variables);if("mutation"===e.type)return this.executeMutation(e.name,e.variables);throw new Error("Unknown operation type: ".concat(e.type))})),s=t.filter(e=>"fulfilled"===e.status),n=t.filter(e=>"rejected"===e.status);return Tg.info("Batch operations completed",{successful:s.length,failed:n.length}),{successful:s,failed:n}}catch(t){throw Tg.error("Batch operations failed",{error:t}),xg.handleError(t,{context:"data_connect_batch"}),t}}},Ug=Mg;new class{constructor(){this.encryptionEnabled=Ag.isFeatureEnabled("dataEncryption"),this.auditLoggingEnabled=Ag.isFeatureEnabled("auditLogging")}async storeSecureData(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const{encrypt:r=!0,audit:i=!0}=n;let a=Le({},s);r&&this.encryptionEnabled&&(a=Rg.encryptHealthData(a),a._encrypted=!0),a._metadata={createdAt:Zf(),updatedAt:Zf(),version:1,encrypted:r&&this.encryptionEnabled};const o=Vm(Lg,e,t);return await Kf(o,a),i&&this.auditLoggingEnabled&&await this.logAuditEvent("CREATE",e,t,{encrypted:r&&this.encryptionEnabled,dataSize:JSON.stringify(s).length}),Tg.info("Secure data stored",{collection:e,docId:t,encrypted:r&&this.encryptionEnabled}),t}catch(r){throw Tg.error("Failed to store secure data",{collection:e,docId:t,error:r.message}),xg.handleError(r,{context:"store_secure_data",collection:e,docId:t}),r}}async getSecureData(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{decrypt:n=!0,audit:r=!0}=s,i=Vm(Lg,e,t),a=await Gf(i);if(!a.exists())return null;let o=a.data();return n&&o._encrypted&&this.encryptionEnabled&&(o=Rg.decryptHealthData(o),delete o._encrypted),delete o._metadata,r&&this.auditLoggingEnabled&&await this.logAuditEvent("READ",e,t,{encrypted:o._encrypted||!1}),Tg.debug("Secure data retrieved",{collection:e,docId:t,decrypted:n&&o._encrypted}),o}catch(n){throw Tg.error("Failed to get secure data",{collection:e,docId:t,error:n.message}),xg.handleError(n,{context:"get_secure_data",collection:e,docId:t}),n}}async updateSecureData(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const{encrypt:r=!0,audit:i=!0}=n;let a=Le({},s);r&&this.encryptionEnabled&&(a=Rg.encryptHealthData(a),a._encrypted=!0),a._metadata={updatedAt:Zf(),version:Zf()};const o=Vm(Lg,e,t);return await zf(o,a),i&&this.auditLoggingEnabled&&await this.logAuditEvent("UPDATE",e,t,{encrypted:r&&this.encryptionEnabled,updateSize:JSON.stringify(s).length}),Tg.info("Secure data updated",{collection:e,docId:t,encrypted:r&&this.encryptionEnabled}),t}catch(r){throw Tg.error("Failed to update secure data",{collection:e,docId:t,error:r.message}),xg.handleError(r,{context:"update_secure_data",collection:e,docId:t}),r}}async deleteSecureData(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{audit:n=!0}=s;n&&this.auditLoggingEnabled&&await this.logAuditEvent("DELETE",e,t,{reason:"User requested deletion"});const r=Vm(Lg,e,t);return await qf(r),Tg.info("Secure data deleted",{collection:e,docId:t}),!0}catch(n){throw Tg.error("Failed to delete secure data",{collection:e,docId:t,error:n.message}),xg.handleError(n,{context:"delete_secure_data",collection:e,docId:t}),n}}async querySecureData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{decrypt:n=!0,audit:r=!0}=s,i=Nf(Um(Lg,e),...t),a=await Hf(i),o=[];return a.forEach(e=>{let t=Le({id:e.id},e.data());n&&t._encrypted&&this.encryptionEnabled&&(t=Rg.decryptHealthData(t),delete t._encrypted),delete t._metadata,o.push(t)}),r&&this.auditLoggingEnabled&&await this.logAuditEvent("QUERY",e,null,{resultCount:o.length,queryConstraints:t.length}),Tg.debug("Secure data queried",{collection:e,resultCount:o.length}),o}catch(n){throw Tg.error("Failed to query secure data",{collection:e,error:n.message}),xg.handleError(n,{context:"query_secure_data",collection:e}),n}}async batchSecureOperations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{encrypt:s=!0,audit:n=!0}=t,r=[];for(const t of e){const{type:e,collection:n,docId:i,data:a}=t;switch(e){case"CREATE":const t=await this.storeSecureData(n,i,a,{encrypt:s,audit:!1});r.push({type:e,id:t,success:!0});break;case"UPDATE":await this.updateSecureData(n,i,a,{encrypt:s,audit:!1}),r.push({type:e,id:i,success:!0});break;case"DELETE":await this.deleteSecureData(n,i,{audit:!1}),r.push({type:e,id:i,success:!0});break;default:r.push({type:e,id:i,success:!1,error:"Unknown operation type"})}}return n&&this.auditLoggingEnabled&&await this.logAuditEvent("BATCH","multiple",null,{operationCount:e.length,successCount:r.filter(e=>e.success).length}),Tg.info("Batch secure operations completed",{operationCount:e.length,successCount:r.filter(e=>e.success).length}),r}catch(s){throw Tg.error("Batch secure operations failed",{error:s.message}),xg.handleError(s,{context:"batch_secure_operations"}),s}}async anonymizeData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{const s=Le({},e);return t.forEach(e=>{s[e]&&(s[e]=Rg.hash(s[e]))}),Tg.debug("Data anonymized",{fieldsAnonymized:t.length}),s}catch(s){throw Tg.error("Data anonymization failed",{error:s.message}),xg.handleError(s,{context:"anonymize_data"}),s}}async logAuditEvent(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const r=Le({action:e,collection:t,docId:s,userId:Ag.get("auth.currentUser?.uid"),timestamp:Zf(),userAgent:navigator.userAgent,ipAddress:await this.getClientIP()},n),i=Vm(t(Lg,"auditLogs"));await Kf(i,r),Tg.debug("Audit event logged",{action:e,collection:t,docId:s})}catch(r){Tg.error("Failed to log audit event",{error:r.message})}}async getClientIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return"unknown"}}async cleanupExpiredData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:365;try{const s=new Date;s.setDate(s.getDate()-t);const n=Nf(Um(Lg,e),Tf("_metadata.createdAt","<",s)),r=await Hf(n),i=[];return r.forEach(e=>{i.push(qf(e.ref))}),await Promise.all(i),Tg.info("Expired data cleaned up",{collection:e,deletedCount:i.length}),i.length}catch(s){throw Tg.error("Data cleanup failed",{collection:e,error:s.message}),xg.handleError(s,{context:"cleanup_expired_data"}),s}}};const Vg="users",Fg=async()=>{try{const e=Nf(Um(Lg,Vg),If("createdAt","desc")),t=await Hf(e),s=[];return t.forEach(e=>{var t,n,r,i,a,o,c,l;const d=e.data();s.push(Le(Le({id:e.id},d),{},{joinDate:(null===(t=d.joinDate)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||d.joinDate,lastActive:(null===(r=d.lastActive)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||d.lastActive,createdAt:(null===(a=d.createdAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.createdAt,updatedAt:(null===(c=d.updatedAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.updatedAt}))}),s}catch(e){throw console.error("Error fetching users:",e),e}},Bg=async e=>{try{const t=Vm(Lg,Vg,e);return await qf(t),!0}catch(t){throw console.error("Error deleting user:",t),t}},Gg=async(e,t)=>{try{const s=Vm(Lg,Vg,e);return await zf(s,{status:t,updatedAt:Zf()}),!0}catch(s){throw console.error("Error updating user status:",s),s}},Wg=e=>Xf(Nf(Um(Lg,Vg),If("createdAt","desc")),t=>{const s=[];t.forEach(e=>{var t,n,r,i,a,o,c,l;const d=e.data();s.push(Le(Le({id:e.id},d),{},{joinDate:(null===(t=d.joinDate)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||d.joinDate,lastActive:(null===(r=d.lastActive)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||d.lastActive,createdAt:(null===(a=d.createdAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.createdAt,updatedAt:(null===(c=d.updatedAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.updatedAt}))}),e(s)}),Hg=async()=>{try{const e=await Fg();return{total:e.length,elderly:e.filter(e=>"elderly"===e.type).length,caregivers:e.filter(e=>"caregiver"===e.type).length,doctors:e.filter(e=>"doctor"===e.type).length,active:e.filter(e=>"active"===e.status).length,inactive:e.filter(e=>"inactive"===e.status).length,suspended:e.filter(e=>"suspended"===e.status).length}}catch(e){throw console.error("Error getting user stats:",e),e}};var Kg=s(579);const zg=(0,t.createContext)(),qg=()=>{const e=(0,t.useContext)(zg);if(!e)throw new Error("useUser must be used within a UserProvider");return e},Yg=e=>{let{children:s}=e;const[n,r]=(0,t.useState)(null),[i,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(null);(0,t.useEffect)(()=>{const e=Ci(Pg,async e=>{if(e)try{r(e);const t=await(async e=>{try{if(!e)throw new Error("User ID is required");Tg.debug("Fetching user by ID",{userId:e});try{const t=await Ug.getUserProfile(e);if(t.data&&t.data.length>0)return t.data[0]}catch(l){Tg.warn("Data Connect failed, falling back to Firestore",{error:l})}const d=Vm(Lg,Vg,e),u=await Gf(d);if(u.exists()){var t,s,n,r,i,a,o,c;const e=u.data();return Le(Le({id:u.id},e),{},{joinDate:(null===(t=e.joinDate)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||e.joinDate,lastActive:(null===(n=e.lastActive)||void 0===n||null===(r=n.toDate)||void 0===r?void 0:r.call(n))||e.lastActive,createdAt:(null===(i=e.createdAt)||void 0===i||null===(a=i.toDate)||void 0===a?void 0:a.call(i))||e.createdAt,updatedAt:(null===(o=e.updatedAt)||void 0===o||null===(c=o.toDate)||void 0===c?void 0:c.call(o))||e.updatedAt})}return null}catch(d){throw xg.handleError(d,{context:"get_user_by_id",userId:e}),d}})(e.uid);t?(a(t),d(t.type||"elderly")):(console.log("User profile not found in Firestore, user may be new"),a(null),d("elderly"))}catch(t){console.error("Error fetching user profile:",t),a(null),d("elderly")}else r(null),a(null),d(null);c(!1)});return()=>e()},[]);const u={user:n,userProfile:i,userRole:l,loading:o,isServiceProvider:()=>"doctor"===l||"caregiver"===l,isDoctor:()=>"doctor"===l,isCaregiver:()=>"caregiver"===l,isElderly:()=>"elderly"===l,isAdmin:()=>"admin"===l,updateUserProfile:a};return(0,Kg.jsx)(zg.Provider,{value:u,children:s})};var Xg={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Jg=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],Qg=(e,s)=>{const n=(0,t.forwardRef)((n,r)=>{let{color:i="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:l="",children:d}=n,u=Me(n,Jg);return(0,t.createElement)("svg",Le(Le({ref:r},Xg),{},{width:a,height:a,stroke:i,strokeWidth:c?24*Number(o)/Number(a):o,className:["lucide","lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),l].join(" ")},u),[...s.map(e=>{let[s,n]=e;return(0,t.createElement)(s,n)}),...Array.isArray(d)?d:[d]]);var h});return n.displayName="".concat(e),n},Zg=Qg("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),$g=Qg("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ey=Qg("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);class ty extends t.Component{constructor(e){super(e),this.reportError=async(e,t)=>{try{console.error("Error Boundary caught an error:",e,t)}catch(s){console.error("Failed to report error:",s)}},this.handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null})},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1,error:null,errorInfo:null,errorId:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){const s={message:e.message,stack:e.stack,componentStack:t.componentStack,errorBoundary:this.props.name||"Unknown"},n=xg.handleError(e,Le(Le({},s),{},{critical:!0,context:"error_boundary"}));this.setState({error:e,errorInfo:t,errorId:n.id}),this.reportError(e,t)}render(){return this.state.hasError?(0,Kg.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:(0,Kg.jsx)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:(0,Kg.jsxs)("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[(0,Kg.jsx)("div",{className:"flex justify-center",children:(0,Kg.jsx)("div",{className:"flex items-center justify-center w-16 h-16 bg-red-100 rounded-full",children:(0,Kg.jsx)(Zg,{className:"w-8 h-8 text-red-600"})})}),(0,Kg.jsxs)("div",{className:"mt-6 text-center",children:[(0,Kg.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Oops! Something went wrong"}),(0,Kg.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"We're sorry, but something unexpected happened. Our team has been notified."}),this.state.errorId&&(0,Kg.jsxs)("p",{className:"mt-2 text-xs text-gray-500",children:["Error ID: ",this.state.errorId]})]}),(0,Kg.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,Kg.jsxs)("button",{onClick:this.handleRetry,className:"w-full flex justify-center items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,Kg.jsx)($g,{className:"w-4 h-4 mr-2"}),"Try Again"]}),(0,Kg.jsxs)("button",{onClick:this.handleGoHome,className:"w-full flex justify-center items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,Kg.jsx)(ey,{className:"w-4 h-4 mr-2"}),"Go to Home"]})]}),!1,(0,Kg.jsx)("div",{className:"mt-6 text-center",children:(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:"If this problem persists, please contact support with the Error ID above."})})]})})}):this.props.children}}const sy=ty;const ny=new class{constructor(){this.alerts=[],this.threats=[],this.monitoringEnabled=!0,this.alertThresholds={failedLogins:5,suspiciousActivity:3,dataAccess:100,apiCalls:1e3},this.alertCallbacks=[]}initialize(){try{this.setupEventListeners(),this.startPeriodicChecks(),Tg.info("Security monitoring service initialized")}catch(e){Tg.error("Security monitoring initialization failed",{error:e.message}),xg.handleError(e,{context:"security_monitoring_init"})}}setupEventListeners(){window.addEventListener("beforeunload",()=>{this.logSecurityEvent("SESSION_END",{timestamp:(new Date).toISOString(),userAgent:navigator.userAgent})}),document.addEventListener("visibilitychange",()=>{document.hidden?this.logSecurityEvent("SESSION_PAUSE",{timestamp:(new Date).toISOString()}):this.logSecurityEvent("SESSION_RESUME",{timestamp:(new Date).toISOString()})}),window.addEventListener("error",e=>{this.logSecurityEvent("CLIENT_ERROR",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,timestamp:(new Date).toISOString()})}),window.addEventListener("unhandledrejection",e=>{var t;this.logSecurityEvent("UNHANDLED_REJECTION",{reason:null===(t=e.reason)||void 0===t?void 0:t.toString(),timestamp:(new Date).toISOString()})})}startPeriodicChecks(){setInterval(()=>{this.performSecurityChecks()},3e5),setInterval(()=>{this.cleanupOldAlerts()},36e5)}logSecurityEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const s=Le({id:this.generateEventId(),type:e,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,userId:this.getCurrentUserId(),sessionId:this.getSessionId()},t);this.storeEvent(s),this.analyzeEvent(s),this.monitoringEnabled&&this.sendToMonitoringService(s),Tg.debug("Security event logged",{eventType:e,eventId:s.id})}catch(s){Tg.error("Failed to log security event",{error:s.message})}}analyzeEvent(e){try{const t=[];if("LOGIN_FAILED"===e.type){const e=this.getRecentEvents("LOGIN_FAILED",9e5);e.length>=this.alertThresholds.failedLogins&&t.push({type:"BRUTE_FORCE_ATTEMPT",severity:"HIGH",description:"Multiple failed login attempts detected (".concat(e.length,")"),events:e})}if("DATA_ACCESS"===e.type){const e=this.getRecentEvents("DATA_ACCESS",36e5);e.length>=this.alertThresholds.dataAccess&&t.push({type:"EXCESSIVE_DATA_ACCESS",severity:"MEDIUM",description:"Excessive data access detected (".concat(e.length," accesses)"),events:e})}if("API_CALL"===e.type){const e=this.getRecentEvents("API_CALL",36e5);e.length>=this.alertThresholds.apiCalls&&t.push({type:"API_ABUSE",severity:"MEDIUM",description:"Excessive API calls detected (".concat(e.length," calls)"),events:e})}if("LOCATION_ACCESS"===e.type&&e.location){const e=this.getRecentEvents("LOCATION_ACCESS",864e5),s=new Set(e.map(e=>e.location)).size;s>5&&t.push({type:"UNUSUAL_LOCATION_PATTERN",severity:"LOW",description:"Unusual location access pattern detected (".concat(s," locations)"),events:e})}t.forEach(e=>{this.handleThreat(e)})}catch(t){Tg.error("Event analysis failed",{error:t.message})}}handleThreat(e){try{this.threats.push(Le(Le({},e),{},{id:this.generateEventId(),detectedAt:(new Date).toISOString(),status:"ACTIVE"}));const t={id:this.generateEventId(),threatId:e.id,type:e.type,severity:e.severity,message:e.description,timestamp:(new Date).toISOString(),status:"ACTIVE",actions:this.getRecommendedActions(e)};this.alerts.push(t),this.alertCallbacks.forEach(e=>{try{e(t)}catch(s){Tg.error("Alert callback failed",{error:s.message})}}),Tg.warn("Security threat detected",{threatType:e.type,severity:e.severity,threatId:e.id}),"HIGH"===e.severity&&this.handleHighSeverityThreat(e)}catch(t){Tg.error("Threat handling failed",{error:t.message})}}handleHighSeverityThreat(e){try{switch(e.type){case"BRUTE_FORCE_ATTEMPT":this.lockAccount(e.events[0].userId);break;case"UNAUTHORIZED_ACCESS":this.forceLogout();break;case"DATA_BREACH_ATTEMPT":this.alertAdministrators(e);break;default:Tg.warn("Unknown high severity threat type",{type:e.type})}}catch(t){Tg.error("High severity threat handling failed",{error:t.message})}}getRecommendedActions(e){const t=[];switch(e.type){case"BRUTE_FORCE_ATTEMPT":t.push("LOCK_ACCOUNT","NOTIFY_USER","ALERT_ADMIN");break;case"EXCESSIVE_DATA_ACCESS":t.push("REVIEW_ACCESS","NOTIFY_USER");break;case"API_ABUSE":t.push("RATE_LIMIT","REVIEW_USAGE");break;case"UNUSUAL_LOCATION_PATTERN":t.push("VERIFY_IDENTITY","NOTIFY_USER");break;default:t.push("INVESTIGATE","MONITOR")}return t}storeEvent(e){try{const t=this.getStoredEvents();t.push(e),t.length>1e3&&t.splice(0,t.length-1e3),localStorage.setItem("elderx_security_events",JSON.stringify(t))}catch(t){Tg.error("Failed to store security event",{error:t.message})}}getStoredEvents(){try{const e=localStorage.getItem("elderx_security_events");return e?JSON.parse(e):[]}catch(e){return Tg.error("Failed to get stored events",{error:e.message}),[]}}getRecentEvents(e,t){const s=this.getStoredEvents(),n=Date.now()-t;return s.filter(t=>t.type===e&&new Date(t.timestamp).getTime()>n)}async sendToMonitoringService(e){try{Tg.info("Security event sent to monitoring service",{eventType:e.type,eventId:e.id})}catch(t){Tg.error("Failed to send event to monitoring service",{error:t.message})}}performSecurityChecks(){try{this.checkInactiveSessions(),this.checkSuspiciousPatterns(),this.checkSystemIntegrity()}catch(e){Tg.error("Security checks failed",{error:e.message})}}checkInactiveSessions(){const e=this.getLastActivityTime(),t=Date.now()-e,s=18e5;t>s&&this.logSecurityEvent("SESSION_TIMEOUT",{inactiveTime:t,maxInactiveTime:s})}checkSuspiciousPatterns(){const e=this.getStoredEvents().filter(e=>Date.now()-new Date(e.timestamp).getTime()<36e5),t=this.detectRapidFireEvents(e);t.length>0&&this.logSecurityEvent("RAPID_FIRE_DETECTED",{eventCount:t.length,timeWindow:"1 hour"})}checkSystemIntegrity(){["auth","database","encryption"].forEach(e=>{this.isServiceRunning(e)||this.logSecurityEvent("SERVICE_DOWN",{service:e,timestamp:(new Date).toISOString()})})}detectRapidFireEvents(e){const t=[];for(let s=0;s<e.length;s++){const n=new Date(e[s].timestamp).getTime(),r=n-6e4,i=n+6e4,a=e.filter(e=>{const t=new Date(e.timestamp).getTime();return t>=r&&t<=i});a.length>=10&&t.push(...a)}return t}generateEventId(){return"evt_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getCurrentUserId(){return"current_user_id"}getSessionId(){return sessionStorage.getItem("elderx_session_id")||"unknown"}getLastActivityTime(){return parseInt(localStorage.getItem("elderx_last_activity")||Date.now())}isServiceRunning(e){return!0}addAlertCallback(e){this.alertCallbacks.push(e)}removeAlertCallback(e){const t=this.alertCallbacks.indexOf(e);t>-1&&this.alertCallbacks.splice(t,1)}getActiveAlerts(){return this.alerts.filter(e=>"ACTIVE"===e.status)}getActiveThreats(){return this.threats.filter(e=>"ACTIVE"===e.status)}dismissAlert(e){const t=this.alerts.find(t=>t.id===e);t&&(t.status="DISMISSED",t.dismissedAt=(new Date).toISOString())}resolveThreat(e){const t=this.threats.find(t=>t.id===e);t&&(t.status="RESOLVED",t.resolvedAt=(new Date).toISOString())}cleanupOldAlerts(){const e=Date.now()-6048e5;this.alerts=this.alerts.filter(t=>new Date(t.timestamp).getTime()>e),this.threats=this.threats.filter(t=>new Date(t.detectedAt).getTime()>e)}lockAccount(e){Tg.warn("Account locked due to security threat",{userId:e})}forceLogout(){Tg.warn("Forcing logout due to security threat")}alertAdministrators(e){Tg.error("ALERT: Security threat requiring admin attention",{threat:e})}};ny.initialize();const ry=ny;const iy=new class{constructor(){this.isSupported=this.checkBiometricSupport(),this.isEnabled=!1,this.credentialId=null}checkBiometricSupport(){try{return!!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&window.PublicKeyCredential&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable)}catch(e){return Tg.warn("Biometric support check failed",{error:e.message}),!1}}async isPlatformAuthenticatorAvailable(){try{if(!this.isSupported)return!1;const e=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();return Tg.debug("Platform authenticator availability check",{available:e}),e}catch(e){return Tg.error("Platform authenticator check failed",{error:e.message}),!1}}async registerBiometric(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!this.isSupported)throw new Error("Biometric authentication not supported on this device");if(!await this.isPlatformAuthenticatorAvailable())throw new Error("No biometric authenticator available on this device");Tg.info("Starting biometric registration",{userId:e.id});const t=new Uint8Array(32);crypto.getRandomValues(t);const s=await navigator.credentials.create({publicKey:{challenge:t,rp:{name:"ElderX",id:window.location.hostname},user:{id:(new TextEncoder).encode(e.id||"user"),name:e.email||"user@elderx.com",displayName:e.displayName||"ElderX User"},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:6e4,attestation:"direct"}});if(s)return this.credentialId=s.id,this.isEnabled=!0,await this.storeCredentialInfo(s),Tg.info("Biometric registration successful",{credentialId:s.id}),{success:!0,credentialId:s.id,message:"Biometric authentication registered successfully"};throw new Error("Failed to create biometric credential")}catch(t){throw Tg.error("Biometric registration failed",{error:t.message}),xg.handleError(t,{context:"biometric_registration"}),t}}async authenticateBiometric(){try{if(!this.isSupported||!this.isEnabled)throw new Error("Biometric authentication not available");Tg.info("Starting biometric authentication");const e=new Uint8Array(32);crypto.getRandomValues(e);const t=await this.getStoredCredentialInfo();if(!t)throw new Error("No biometric credential found. Please register first.");const s=await navigator.credentials.get({publicKey:{challenge:e,allowCredentials:[{id:t.credentialId,type:"public-key",transports:["internal"]}],userVerification:"required",timeout:6e4}});if(s){if(await this.verifyAssertion(s,e))return Tg.info("Biometric authentication successful"),{success:!0,message:"Biometric authentication successful"};throw new Error("Biometric authentication verification failed")}throw new Error("Biometric authentication failed")}catch(e){throw Tg.error("Biometric authentication failed",{error:e.message}),xg.handleError(e,{context:"biometric_authentication"}),e}}async storeCredentialInfo(e){try{const t={credentialId:e.id,type:e.type,registeredAt:(new Date).toISOString()},s=JSON.stringify(t);localStorage.setItem("elderx_biometric_credential",s),Tg.debug("Biometric credential info stored")}catch(t){throw Tg.error("Failed to store credential info",{error:t.message}),t}}async getStoredCredentialInfo(){try{const e=localStorage.getItem("elderx_biometric_credential");if(!e)return null;const t=JSON.parse(e);return this.credentialId=t.credentialId,this.isEnabled=!0,t}catch(e){return Tg.error("Failed to get stored credential info",{error:e.message}),null}}async verifyAssertion(e,t){try{return e&&e.response&&e.response.signature}catch(s){return Tg.error("Assertion verification failed",{error:s.message}),!1}}async removeBiometric(){try{return localStorage.removeItem("elderx_biometric_credential"),this.credentialId=null,this.isEnabled=!1,Tg.info("Biometric authentication removed"),{success:!0,message:"Biometric authentication removed successfully"}}catch(e){throw Tg.error("Failed to remove biometric authentication",{error:e.message}),xg.handleError(e,{context:"remove_biometric"}),e}}async isBiometricEnabled(){try{return!!await this.getStoredCredentialInfo()}catch(e){return Tg.error("Failed to check biometric status",{error:e.message}),!1}}getStatus(){return{isSupported:this.isSupported,isEnabled:this.isEnabled,credentialId:this.credentialId}}async initialize(){try{this.isSupported?(await this.getStoredCredentialInfo(),Tg.info("Biometric authentication service initialized",this.getStatus())):Tg.info("Biometric authentication not supported on this device")}catch(e){Tg.error("Biometric service initialization failed",{error:e.message})}}handleBiometricError(e){let t="Biometric authentication failed";switch(e.name){case"NotAllowedError":t="Biometric authentication was cancelled or not allowed";break;case"NotSupportedError":t="Biometric authentication is not supported on this device";break;case"SecurityError":t="Security error occurred during biometric authentication";break;case"UnknownError":t="An unknown error occurred during biometric authentication";break;default:t=e.message||t}return Tg.error("Biometric error handled",{errorName:e.name,errorMessage:e.message,userMessage:t}),t}};iy.initialize();const ay=iy,oy=Qg("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),cy=Qg("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),ly=Qg("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),dy=Qg("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),uy=Qg("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),hy=Qg("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),py=Qg("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),my=Qg("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),fy=Qg("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),gy=Qg("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),yy=()=>{const[e,s]=(0,t.useState)(!1),n=ee(),r=Z(),i=async()=>{try{await Ri(Pg),yt.success("Signed out successfully"),n("/login")}catch(e){yt.error("Error signing out"),console.error("Sign out error:",e)}},a=[{name:"Overview",href:"/dashboard",icon:ey},{name:"Request Care",href:"/appointments",icon:oy},{name:"Health Vitals",href:"/vital-signs",icon:cy},{name:"Telemedicine",href:"/telemedicine",icon:ly},{name:"Messages",href:"/messages",icon:dy},{name:"Subscription",href:"/subscription",icon:uy}],o=e=>r.pathname===e;return(0,Kg.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Kg.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Kg.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>s(!1)}),(0,Kg.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white shadow-xl",children:[(0,Kg.jsxs)("div",{className:"flex h-16 items-center justify-between px-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Kg.jsx)(cy,{className:"h-5 w-5 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]}),(0,Kg.jsx)("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(hy,{className:"h-6 w-6"})})]}),(0,Kg.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Kg.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),n(e.href),s(!1)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Kg.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Kg.jsxs)("button",{onClick:i,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Kg.jsx)(py,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})]}),(0,Kg.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,Kg.jsxs)("div",{className:"flex flex-col flex-grow bg-white border-r border-gray-200 shadow-sm",children:[(0,Kg.jsx)("div",{className:"flex h-16 items-center px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-teal-400 to-green-500 rounded-lg flex items-center justify-center mr-3",children:(0,Kg.jsx)(cy,{className:"h-5 w-5 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-lg font-bold text-teal-600",children:"ElderCare Nigeria"}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:"Home Healthcare for the Elderly"})]})]})}),(0,Kg.jsx)("nav",{className:"flex-1 px-4 py-4",children:a.map(e=>{const t=e.icon;return(0,Kg.jsxs)("a",{href:e.href,onClick:t=>{t.preventDefault(),n(e.href)},className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md mb-1 ".concat(o(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,Kg.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,Kg.jsxs)("button",{onClick:i,className:"group flex w-full items-center px-2 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-md",children:[(0,Kg.jsx)(py,{className:"mr-3 h-5 w-5"}),"Sign Out"]})})]})}),(0,Kg.jsxs)("div",{className:"lg:pl-64",children:[(0,Kg.jsxs)("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[(0,Kg.jsx)("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>s(!0),children:(0,Kg.jsx)(my,{className:"h-6 w-6"})}),(0,Kg.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[(0,Kg.jsx)("div",{className:"flex flex-1"}),(0,Kg.jsxs)("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:[(0,Kg.jsxs)("button",{className:"p-2 text-gray-400 hover:text-gray-500",children:[(0,Kg.jsx)(fy,{className:"h-5 w-5"}),(0,Kg.jsx)("span",{className:"sr-only",children:"Notifications"})]}),(0,Kg.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-400"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Mrs. Adunni Okafor"})]})]})]})]}),(0,Kg.jsx)("main",{className:"py-6",children:(0,Kg.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,Kg.jsx)(ge,{})})})]})]})},vy=Qg("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),xy=Qg("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),_y=Qg("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Ey=Qg("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),by=Qg("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),wy=Qg("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Ny=Qg("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Sy=Qg("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),Ty=Qg("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Cy=Qg("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ry=Qg("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Iy=()=>{const[e,s]=(0,t.useState)(!1),n=ee(),r=Z(),i=[{name:"Dashboard",href:"/admin",icon:vy},{name:"Users",href:"/admin/users",icon:xy},{name:"Appointments",href:"/admin/appointments",icon:_y},{name:"Emergency",href:"/admin/emergency",icon:Zg},{name:"Medications",href:"/admin/medications",icon:Ey},{name:"Caregivers",href:"/admin/caregivers",icon:by},{name:"Analytics",href:"/admin/analytics",icon:wy},{name:"Communication",href:"/admin/communication",icon:Ny},{name:"Audit Logs",href:"/admin/audit-logs",icon:Sy},{name:"Reports",href:"/admin/reports",icon:Ty},{name:"Settings",href:"/admin/settings",icon:Cy}],a=e=>r.pathname===e;return(0,Kg.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,Kg.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>s(!1)}),(0,Kg.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Kg.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Kg.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>s(!1),children:(0,Kg.jsx)(hy,{className:"h-6 w-6 text-white"})})}),(0,Kg.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Kg.jsx)(Ry,{className:"h-8 w-8 text-blue-600"})}),(0,Kg.jsx)("div",{className:"ml-3",children:(0,Kg.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Admin"})})]})}),(0,Kg.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:i.map(e=>{const t=e.icon;return(0,Kg.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(a(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(a(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Kg.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Kg.jsx)("div",{className:"flex flex-col w-64",children:(0,Kg.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Kg.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Kg.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Kg.jsx)(Ry,{className:"h-8 w-8 text-blue-600"})}),(0,Kg.jsx)("div",{className:"ml-3",children:(0,Kg.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Admin"})})]})}),(0,Kg.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:i.map(e=>{const t=e.icon;return(0,Kg.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(a(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(a(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Kg.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:(0,Kg.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-600"})})}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Admin User"}),(0,Kg.jsxs)("button",{onClick:async()=>{try{await Ri(Pg),yt.success("Signed out successfully"),n("/login")}catch(e){yt.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Kg.jsx)(py,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Kg.jsxs)("div",{className:"lg:pl-64 flex flex-col flex-1 min-w-0 dashboard-container",children:[(0,Kg.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Kg.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 lg:hidden",onClick:()=>s(!0),children:(0,Kg.jsx)(my,{className:"h-6 w-6"})}),(0,Kg.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Kg.jsx)("div",{className:"flex-1 flex",children:(0,Kg.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Kg.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Kg.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:"Admin Panel"})})})})}),(0,Kg.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Kg.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:(0,Kg.jsx)(fy,{className:"h-6 w-6"})}),(0,Kg.jsx)("div",{className:"ml-3 relative",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-600"})}),(0,Kg.jsx)("div",{className:"ml-3",children:(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Admin User"})})]})})]})]})]}),(0,Kg.jsx)("main",{className:"flex-1 overflow-auto w-full dashboard-main",children:(0,Kg.jsx)("div",{className:"h-full",children:(0,Kg.jsx)(ge,{})})})]})]})},Ay=Qg("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Oy=Qg("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),jy=Qg("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),ky=()=>{var e,s;const[n,r]=(0,t.useState)(!1),i=ee(),a=Z(),{userProfile:o,userRole:c,isDoctor:l,isCaregiver:d}=qg(),u=[{name:"Dashboard",href:"/service-provider",icon:vy},{name:"Schedule",href:"/service-provider/schedule",icon:oy},{name:"Patients",href:"/service-provider/patients",icon:xy},{name:"Messages",href:"/service-provider/messages",icon:Ny},{name:"Calls",href:"/service-provider/calls",icon:Ay},{name:"Settings",href:"/service-provider/settings",icon:Cy}],h=[{name:"Medical Records",href:"/service-provider/medical-records",icon:Ty},{name:"Prescriptions",href:"/service-provider/prescriptions",icon:Ey},{name:"Consultations",href:"/service-provider/consultations",icon:Oy},{name:"Diagnostics",href:"/service-provider/diagnostics",icon:_y}],p=[{name:"Tasks",href:"/service-provider/tasks",icon:Sy},{name:"Care Logs",href:"/service-provider/care-logs",icon:Ty},{name:"Photo Updates",href:"/service-provider/photos",icon:jy},{name:"Activities",href:"/service-provider/activities",icon:_y}],m=(()=>{let e=[...u];return l()?e=[...e,...h]:d()&&(e=[...e,...p]),e})(),f=e=>a.pathname===e,g=()=>{switch(c){case"doctor":return"Doctor";case"caregiver":return"Caregiver";default:return"Service Provider"}},y=()=>{switch(c){case"doctor":return(0,Kg.jsx)(Oy,{className:"h-8 w-8 text-blue-600"});case"caregiver":return(0,Kg.jsx)(by,{className:"h-8 w-8 text-green-600"});default:return(0,Kg.jsx)(Ry,{className:"h-8 w-8 text-gray-600"})}};return(0,Kg.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,Kg.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(n?"block":"hidden"),children:[(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>r(!1)}),(0,Kg.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Kg.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Kg.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>r(!1),children:(0,Kg.jsx)(hy,{className:"h-6 w-6 text-white"})})}),(0,Kg.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:y()}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX"}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:g()})]})]})}),(0,Kg.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:m.map(e=>{const t=e.icon;return(0,Kg.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(f(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(f(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Kg.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Kg.jsx)("div",{className:"flex flex-col w-64",children:(0,Kg.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Kg.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Kg.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:y()}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX"}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:g()})]})]})}),(0,Kg.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:m.map(e=>{const t=e.icon;return(0,Kg.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(f(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(f(e.href)?"text-blue-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Kg.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:(0,Kg.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o||null===(e=o.name)||void 0===e?void 0:e.split(" ").map(e=>e[0]).join(""))||"U"})})}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o?void 0:o.name)||"User"}),(0,Kg.jsxs)("button",{onClick:async()=>{try{await Ri(Pg),yt.success("Signed out successfully"),i("/login")}catch(e){yt.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Kg.jsx)(py,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Kg.jsxs)("div",{className:"lg:pl-64 flex flex-col flex-1 min-w-0 dashboard-container",children:[(0,Kg.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Kg.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 lg:hidden touch-manipulation",onClick:()=>r(!0),children:(0,Kg.jsx)(my,{className:"h-6 w-6"})}),(0,Kg.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Kg.jsx)("div",{className:"flex-1 flex",children:(0,Kg.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Kg.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Kg.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Kg.jsxs)("span",{className:"text-sm text-gray-500",children:[g()," Panel"]})})})})}),(0,Kg.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Kg.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:(0,Kg.jsx)(fy,{className:"h-6 w-6"})}),(0,Kg.jsx)("div",{className:"ml-3 relative",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o||null===(s=o.name)||void 0===s?void 0:s.split(" ").map(e=>e[0]).join(""))||"U"})}),(0,Kg.jsx)("div",{className:"ml-3",children:(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-700",children:(null===o||void 0===o?void 0:o.name)||"User"})})]})})]})]})]}),(0,Kg.jsx)("main",{className:"flex-1 overflow-auto w-full dashboard-main",children:(0,Kg.jsx)("div",{className:"h-full",children:(0,Kg.jsx)(ge,{})})})]})]})},Dy=Qg("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Py=Qg("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Ly=Qg("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),My=Qg("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Uy=Qg("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Vy=Qg("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Fy=Qg("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),By=()=>{const e=[{icon:cy,title:"Health Monitoring",description:"Continuous monitoring of vital signs and health metrics"},{icon:Ry,title:"Secure & Private",description:"Your health data is protected with enterprise-grade security"},{icon:xy,title:"Caregiver Support",description:"Professional caregivers available 24/7 for your needs"},{icon:Dy,title:"24/7 Access",description:"Round-the-clock support and emergency response"}],t=[{icon:Oy,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",color:"text-blue-600",bgColor:"bg-blue-100"},{icon:_y,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",color:"text-green-600",bgColor:"bg-green-100"},{icon:fy,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",color:"text-red-600",bgColor:"bg-red-100"},{icon:ly,title:"Telemedicine",description:"Video consultations with doctors and specialists.",color:"text-purple-600",bgColor:"bg-purple-100"},{icon:xy,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",color:"text-orange-600",bgColor:"bg-orange-100"},{icon:Ry,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",color:"text-blue-600",bgColor:"bg-blue-100"}];return(0,Kg.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,Kg.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:(0,Kg.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsxs)("div",{className:"flex-shrink-0 flex items-center",children:[(0,Kg.jsx)(cy,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Kg.jsx)("p",{className:"ml-4 text-sm text-gray-600 hidden sm:block",children:"Professional Home Healthcare"})]}),(0,Kg.jsx)("div",{className:"flex items-center"})]})})}),(0,Kg.jsxs)("section",{className:"relative py-16 sm:py-24 lg:py-32 overflow-hidden",children:[(0,Kg.jsxs)("div",{className:"absolute inset-0 z-0",children:[(0,Kg.jsxs)("video",{className:"w-full h-full object-cover opacity-20",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,children:[(0,Kg.jsx)("source",{src:"https://videos.pexels.com/video-files/3195394/3195394-uhd_2560_1440_25fps.mp4?v=2",type:"video/mp4"}),(0,Kg.jsx)("img",{src:"https://images.pexels.com/photos/7551675/pexels-photo-7551675.jpeg?auto=compress&cs=tinysrgb&w=2070",alt:"African elderly receiving healthcare",className:"w-full h-full object-cover"})]}),(0,Kg.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-900/50 to-green-900/50"})]}),(0,Kg.jsxs)("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[(0,Kg.jsxs)("div",{className:"text-center lg:text-left text-white",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-white/20 text-white backdrop-blur-sm",children:"\ud83c\uddf3\ud83c\uddec Proudly Nigerian \u2022 NDPR Compliant"}),(0,Kg.jsxs)("h1",{className:"mt-4 text-4xl font-extrabold sm:text-5xl md:text-6xl",children:["Quality ",(0,Kg.jsx)("span",{className:"text-teal-300",children:"Healthcare"})," At Your ",(0,Kg.jsx)("span",{className:"text-green-300",children:"Doorstep"})]}),(0,Kg.jsx)("p",{className:"mt-6 text-lg text-blue-100 max-w-xl mx-auto lg:mx-0",children:"ElderCare Nigeria provides compassionate and professional home healthcare services, ensuring comfort and well-being for your loved ones."}),(0,Kg.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center lg:justify-start",children:[(0,Kg.jsxs)(Re,{to:"/login",className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-gray-50 transition-colors",children:["Get Started",(0,Kg.jsx)(Py,{className:"ml-2 h-5 w-5"})]}),(0,Kg.jsxs)("a",{href:"tel:0800-ELDERCARE",className:"inline-flex items-center justify-center px-6 py-3 border border-white/30 text-base font-medium rounded-md text-white bg-white/10 hover:bg-white/20 backdrop-blur-sm transition-colors",children:[(0,Kg.jsx)(Ay,{className:"mr-2 h-5 w-5"}),"Call: 0800-ELDERCARE"]})]}),(0,Kg.jsxs)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-3 gap-6 text-blue-100",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-300 mr-2"}),"Licensed Professionals"]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Kg.jsx)(Ry,{className:"h-5 w-5 text-blue-300 mr-2"}),"Secure & Private"]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-center lg:justify-start",children:[(0,Kg.jsx)(Dy,{className:"h-5 w-5 text-purple-300 mr-2"}),"24/7 Emergency Support"]})]})]}),(0,Kg.jsx)("div",{className:"mt-12 lg:mt-0 flex lg:items-start lg:justify-start",children:(0,Kg.jsxs)("div",{className:"inline-block transform origin-top-left scale-[1.6] md:scale-[1.8] lg:scale-[2] lg:-translate-y-6 transition-transform duration-300 ease-out hover:-rotate-2 hover:shadow-2xl bg-white rounded-lg shadow-xl p-4 w-72 mx-auto lg:mx-0",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-3",children:[(0,Kg.jsx)("img",{className:"h-10 w-10 rounded-full object-cover",src:"https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80&v=2",alt:"Nurse Fatima Abdullahi"}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Nurse Fatima Abdullahi"}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500 flex items-center",children:[(0,Kg.jsx)(cy,{className:"h-3 w-3 text-red-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-yellow-500",children:"\u2605"})," 4.9 (156 visits)"]})]})]}),(0,Kg.jsx)("div",{className:"bg-green-50 p-2 rounded-lg mb-3",children:(0,Kg.jsx)("p",{className:"text-xs text-green-800",children:'"Hello! I\'ll be arriving at your location in 15 minutes. Please ensure the gate is open."'})}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800 text-xs",children:[(0,Kg.jsx)(dy,{className:"h-3 w-3 mr-1"}),"Reply"]}),(0,Kg.jsxs)("button",{className:"flex items-center text-blue-600 hover:text-blue-800 text-xs",children:[(0,Kg.jsx)(ly,{className:"h-3 w-3 mr-1"}),"Video Call"]})]})]})})]})]}),(0,Kg.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Kg.jsxs)("div",{className:"text-center mb-12",children:[(0,Kg.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Why Choose ElderCare Nigeria?"}),(0,Kg.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"We provide comprehensive healthcare solutions designed specifically for Nigerian families"})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:e.map((e,t)=>{const s=e.icon;return(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Kg.jsx)(s,{className:"h-8 w-8 text-blue-600"})}),(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),(0,Kg.jsx)("p",{className:"text-gray-600",children:e.description})]},t)})})]})}),(0,Kg.jsx)("section",{className:"py-16",children:(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Kg.jsxs)("div",{className:"text-center mb-12",children:[(0,Kg.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Kg.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map((e,t)=>{const s=e.icon;return(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Kg.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Kg.jsx)(s,{className:"h-8 w-8 ".concat(e.color)})}),(0,Kg.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Kg.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]})}),(0,Kg.jsx)("section",{className:"py-16 bg-gray-50",children:(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Kg.jsxs)("div",{className:"text-center mb-12",children:[(0,Kg.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Real Stories from Our Community"}),(0,Kg.jsx)("p",{className:"text-lg text-gray-600",children:"See how ElderCare Nigeria is making a difference in the lives of African families"})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:[(0,Kg.jsxs)("div",{className:"relative group",children:[(0,Kg.jsx)("img",{src:"https://images.pexels.com/photos/7551649/pexels-photo-7551649.jpeg?auto=compress&cs=tinysrgb&w=1200",alt:"African elderly woman receiving home healthcare",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Kg.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Kg.jsx)(cy,{className:"h-8 w-8 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-sm font-medium",children:"Compassionate Care"})]})})]}),(0,Kg.jsxs)("div",{className:"relative group",children:[(0,Kg.jsx)("img",{src:"/images/story-care-checkup-1.png",alt:"African elderly man with healthcare professional",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Kg.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Kg.jsx)(xy,{className:"h-8 w-8 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-sm font-medium",children:"Family Connection"})]})})]}),(0,Kg.jsxs)("div",{className:"relative group",children:[(0,Kg.jsx)("img",{src:"https://images.pexels.com/photos/7551617/pexels-photo-7551617.jpeg?auto=compress&cs=tinysrgb&w=1200",alt:"African elderly woman with technology",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Kg.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Kg.jsx)(_y,{className:"h-8 w-8 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-sm font-medium",children:"Health Monitoring"})]})})]}),(0,Kg.jsxs)("div",{className:"relative group",children:[(0,Kg.jsx)("img",{src:"/images/story-care-checkup-2.png",alt:"African elderly man with family",className:"w-full h-64 object-cover rounded-lg shadow-lg group-hover:shadow-xl transition-shadow"}),(0,Kg.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity text-center",children:[(0,Kg.jsx)(My,{className:"h-8 w-8 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-sm font-medium",children:"Trusted Care"})]})})]})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{name:"Mrs. Adunni Okafor",location:"Lagos, Nigeria",rating:5,text:"ElderCare Nigeria has been a blessing for my family. The caregivers are professional and caring, and the 24/7 support gives us peace of mind.",photo:"https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80&v=2",age:"72 years old"},{name:"Dr. Kemi Adebayo",location:"Abuja, Nigeria",rating:5,text:"As a healthcare professional, I can confidently recommend ElderCare Nigeria. Their services are top-notch and their technology is cutting-edge.",photo:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80&v=2",age:"68 years old"},{name:"Mr. Chinedu Okoro",location:"Port Harcourt, Nigeria",rating:5,text:"The medication management system has been incredibly helpful. I never miss a dose anymore, and my family is always informed about my health status.",photo:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80&v=3",age:"75 years old"}].map((e,t)=>(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Kg.jsx)("div",{className:"flex items-center mb-4",children:[...Array(e.rating)].map((e,t)=>(0,Kg.jsx)(Uy,{className:"h-5 w-5 text-yellow-400 fill-current"},t))}),(0,Kg.jsxs)("p",{className:"text-gray-600 mb-4 italic",children:['"',e.text,'"']}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("img",{src:e.photo,alt:e.name,className:"w-12 h-12 rounded-full object-cover mr-3 border-2 border-blue-100"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-500 flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 mr-1"}),e.location]}),(0,Kg.jsx)("p",{className:"text-xs text-blue-600 font-medium",children:e.age})]})]})]},t))})]})}),(0,Kg.jsx)("section",{className:"py-16 bg-white",children:(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Kg.jsxs)("div",{className:"text-center mb-12",children:[(0,Kg.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"See ElderCare Nigeria in Action"}),(0,Kg.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Watch real stories from African families who have experienced the difference our care makes"})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-center",children:[(0,Kg.jsx)("div",{className:"relative",children:(0,Kg.jsxs)("div",{className:"relative rounded-lg overflow-hidden shadow-2xl",children:[(0,Kg.jsxs)("video",{className:"w-full h-96 object-cover",controls:!0,poster:"https://images.pexels.com/photos/7551675/pexels-photo-7551675.jpeg?auto=compress&cs=tinysrgb&w=1200",children:[(0,Kg.jsx)("source",{src:"https://videos.pexels.com/video-files/8611971/8611971-hd_1920_1080_25fps.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]}),(0,Kg.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"}),(0,Kg.jsxs)("div",{className:"absolute bottom-4 left-4 text-white",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold",children:"Mrs. Adunni's Story"}),(0,Kg.jsx)("p",{className:"text-sm opacity-90",children:"Lagos, Nigeria"})]})]})}),(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Kg.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,Kg.jsx)(cy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Compassionate Care"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Our caregivers provide not just medical care, but emotional support and companionship that makes a real difference in the lives of our patients."})]})]}),(0,Kg.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Kg.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,Kg.jsx)(Ry,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Professional Excellence"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"All our healthcare professionals are licensed, experienced, and trained to provide the highest quality care in the comfort of your home."})]})]}),(0,Kg.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Kg.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,Kg.jsx)(xy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Family-Centered Approach"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"We work closely with families to ensure everyone is informed and involved in the care process, creating a supportive network around each patient."})]})]}),(0,Kg.jsx)("div",{className:"pt-4",children:(0,Kg.jsxs)(Re,{to:"/login",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,Kg.jsx)(ly,{className:"mr-2 h-5 w-5"}),"Get Started"]})})]})]})]})}),(0,Kg.jsx)("section",{className:"py-16 bg-gradient-to-r from-blue-600 to-green-600",children:(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[(0,Kg.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Ready to Get Started?"}),(0,Kg.jsx)("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Join thousands of Nigerian families who trust ElderCare Nigeria for their healthcare needs"}),(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,Kg.jsxs)(Re,{to:"/login",className:"inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-gray-50",children:[(0,Kg.jsx)(Fy,{className:"mr-2 h-5 w-5"}),"Get Started"]}),(0,Kg.jsxs)(Re,{to:"/pricing",className:"inline-flex items-center justify-center px-8 py-3 border border-white text-base font-medium rounded-md text-white hover:bg-white hover:text-blue-600",children:[(0,Kg.jsx)(My,{className:"mr-2 h-5 w-5"}),"View Our Plans"]})]})]})}),(0,Kg.jsx)("footer",{className:"bg-white py-8 border-t border-gray-200",children:(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,Kg.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Kg.jsx)(cy,{className:"h-8 w-8 text-teal-500 mr-2"}),(0,Kg.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"ElderCare Nigeria"})]}),(0,Kg.jsx)("p",{className:"text-gray-600 mb-4",children:"Professional home healthcare services for Nigerian families. Compassionate care, advanced technology, and 24/7 support."}),(0,Kg.jsxs)("div",{className:"flex space-x-4",children:[(0,Kg.jsx)("a",{href:"tel:0800-ELDERCARE",className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(Ay,{className:"h-5 w-5"})}),(0,Kg.jsx)("a",{href:"mailto:info@eldercare.ng",className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(dy,{className:"h-5 w-5"})})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Services"}),(0,Kg.jsxs)("ul",{className:"space-y-2",children:[(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Home Visits"})}),(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Vitals Monitoring"})}),(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Emergency Support"})}),(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/services",className:"text-gray-600 hover:text-blue-600",children:"Telemedicine"})})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Company"}),(0,Kg.jsxs)("ul",{className:"space-y-2",children:[(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/pricing",className:"text-gray-600 hover:text-blue-600",children:"Pricing"})}),(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/about",className:"text-gray-600 hover:text-blue-600",children:"About Us"})}),(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/contact",className:"text-gray-600 hover:text-blue-600",children:"Contact"})}),(0,Kg.jsx)("li",{children:(0,Kg.jsx)("a",{href:"/privacy",className:"text-gray-600 hover:text-blue-600",children:"Privacy Policy"})})]})]})]}),(0,Kg.jsxs)("div",{className:"border-t border-gray-200 mt-8 pt-8 text-center",children:[(0,Kg.jsx)("p",{className:"text-gray-500 text-sm",children:"\xa9 2024 ElderCare Nigeria. All rights reserved."}),(0,Kg.jsxs)("p",{className:"text-gray-500 text-sm mt-2",children:["Made by ",(0,Kg.jsx)("a",{href:"https://mgx.dev",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"MGX"})]})]})]})})]})},Gy=Qg("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Wy=Qg("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Hy=()=>{const[e,s]=(0,t.useState)("signin"),[n,r]=(0,t.useState)(""),[i,a]=(0,t.useState)(""),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("patient"),[p,m]=(0,t.useState)(!1),f=ee();return(0,Kg.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,Kg.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("div",{className:"flex justify-center mb-6",children:(0,Kg.jsx)("div",{className:"p-4 bg-blue-100 rounded-2xl",children:(0,Kg.jsx)(cy,{className:"h-12 w-12 text-blue-600"})})}),(0,Kg.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to ElderX"}),(0,Kg.jsx)("p",{className:"text-gray-600 text-lg",children:"Your trusted health companion"})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[(0,Kg.jsx)("button",{type:"button",onClick:()=>s("signin"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("signin"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Sign In"}),(0,Kg.jsx)("button",{type:"button",onClick:()=>s("signup"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("signup"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Create Account"})]}),"signin"===e&&(0,Kg.jsxs)("form",{className:"space-y-6",onSubmit:async e=>{e.preventDefault(),m(!0);try{await Ni(Pg,n,i),yt.success("Welcome back!"),f("caregiver"===u?"/caregiver":"admin"===u?"/admin":"/dashboard")}catch(t){console.error("Login error:",t);let e="An error occurred during login";switch(t.code){case"auth/user-not-found":e="No account found with this email";break;case"auth/wrong-password":e="Incorrect password";break;case"auth/invalid-credential":e="Invalid email or password. Please check your credentials.";break;case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/operation-not-allowed":e="Email/password login is not enabled. Please contact support.";break;case"auth/too-many-requests":e="Too many failed attempts. Please try again later.";break;default:e=t.message||"An unexpected error occurred"}yt.error(e)}finally{m(!1)}},children:[(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"I am a:"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,Kg.jsxs)("button",{type:"button",onClick:()=>h("patient"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("patient"===u?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(gy,{className:"h-5 w-5 mr-2"}),"Patient"]}),(0,Kg.jsxs)("button",{type:"button",onClick:()=>h("caregiver"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("caregiver"===u?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(by,{className:"h-5 w-5 mr-2"}),"Caregiver"]}),(0,Kg.jsxs)("button",{type:"button",onClick:()=>h("admin"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("admin"===u?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(Ry,{className:"h-5 w-5 mr-2"}),"Admin"]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"email",className:"form-label",children:[(0,Kg.jsx)(Gy,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,Kg.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Enter your email",value:n,onChange:e=>r(e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"password",className:"form-label",children:[(0,Kg.jsx)(Wy,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,Kg.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"form-input",placeholder:"Enter your password",value:i,onChange:e=>a(e.target.value)})]})]}),(0,Kg.jsx)("div",{children:(0,Kg.jsx)("button",{type:"submit",disabled:p,className:"btn btn-primary w-full",children:p?"Signing in...":"Sign In"})}),(0,Kg.jsx)("div",{className:"text-center space-y-2",children:(0,Kg.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,Kg.jsx)("p",{children:"Demo Account:"}),(0,Kg.jsx)("p",{children:"Email: demo@elderx.com | Password: demo123"})]})})]}),"signup"===e&&(0,Kg.jsxs)("form",{className:"space-y-6",onSubmit:async e=>{if(e.preventDefault(),i===o)if(i.length<6)yt.error("Password must be at least 6 characters");else{m(!0);try{const{user:e}=await wi(Pg,n,i);await Si(e,{displayName:l}),yt.success("Account created successfully!"),f("caregiver"===u?"/caregiver":"admin"===u?"/admin":"/dashboard")}catch(t){console.error("Signup error:",t);let e="An error occurred during signup";switch(t.code){case"auth/email-already-in-use":e="This email is already registered";break;case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/operation-not-allowed":e="Email/password signup is not enabled. Please contact support.";break;case"auth/weak-password":e="Password should be at least 6 characters";break;default:e=t.message||"An unexpected error occurred"}yt.error(e)}finally{m(!1)}}else yt.error("Passwords do not match")},children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"displayName",className:"form-label",children:[(0,Kg.jsx)(gy,{className:"inline h-4 w-4 mr-2"}),"Full Name"]}),(0,Kg.jsx)("input",{id:"displayName",name:"displayName",type:"text",autoComplete:"name",required:!0,className:"form-input",placeholder:"Enter your full name",value:l,onChange:e=>d(e.target.value)})]}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"I am a:"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,Kg.jsxs)("button",{type:"button",onClick:()=>h("patient"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("patient"===u?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(gy,{className:"h-5 w-5 mr-2"}),"Patient"]}),(0,Kg.jsxs)("button",{type:"button",onClick:()=>h("caregiver"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("caregiver"===u?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(by,{className:"h-5 w-5 mr-2"}),"Caregiver"]}),(0,Kg.jsxs)("button",{type:"button",onClick:()=>h("admin"),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("admin"===u?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(Ry,{className:"h-5 w-5 mr-2"}),"Admin"]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"email",className:"form-label",children:[(0,Kg.jsx)(Gy,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,Kg.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Enter your email",value:n,onChange:e=>r(e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"password",className:"form-label",children:[(0,Kg.jsx)(Wy,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,Kg.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Create a password",value:i,onChange:e=>a(e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"confirmPassword",className:"form-label",children:[(0,Kg.jsx)(Wy,{className:"inline h-4 w-4 mr-2"}),"Confirm Password"]}),(0,Kg.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Confirm your password",value:o,onChange:e=>c(e.target.value)})]})]}),(0,Kg.jsx)("div",{children:(0,Kg.jsx)("button",{type:"submit",disabled:p,className:"btn btn-primary w-full",children:p?"Creating Account...":"Create Account"})})]})]})]})})},Ky=()=>{const[e,s]=(0,t.useState)({displayName:"",email:"",password:"",confirmPassword:"",userType:"patient"}),[n,r]=(0,t.useState)(!1),i=ee(),a=t=>{s(Le(Le({},e),{},{[t.target.name]:t.target.value}))};return(0,Kg.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,Kg.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("div",{className:"flex justify-center mb-6",children:(0,Kg.jsx)("div",{className:"p-4 bg-blue-100 rounded-2xl",children:(0,Kg.jsx)(cy,{className:"h-12 w-12 text-blue-600"})})}),(0,Kg.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Join ElderX"}),(0,Kg.jsx)("p",{className:"text-gray-600 text-lg",children:"Create your account to get started"})]}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{if(t.preventDefault(),e.password===e.confirmPassword)if(e.password.length<6)yt.error("Password must be at least 6 characters");else{r(!0);try{const{user:t}=await wi(Pg,e.email,e.password);await Si(t,{displayName:e.displayName}),yt.success("Account created successfully!"),"caregiver"===e.userType?i("/caregiver"):"admin"===e.userType?i("/admin"):i("/dashboard")}catch(s){console.error("Signup error:",s);let e="An error occurred during signup";switch(s.code){case"auth/email-already-in-use":e="This email is already registered";break;case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/operation-not-allowed":e="Email/password signup is not enabled. Please contact support.";break;case"auth/weak-password":e="Password should be at least 6 characters";break;default:e=s.message||"An unexpected error occurred"}yt.error(e)}finally{r(!1)}}else yt.error("Passwords do not match")},children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"displayName",className:"form-label",children:[(0,Kg.jsx)(gy,{className:"inline h-4 w-4 mr-2"}),"Full Name"]}),(0,Kg.jsx)("input",{id:"displayName",name:"displayName",type:"text",autoComplete:"name",required:!0,className:"form-input",placeholder:"Enter your full name",value:e.displayName,onChange:a})]}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"I am a:"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,Kg.jsxs)("button",{type:"button",onClick:()=>s(Le(Le({},e),{},{userType:"patient"})),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("patient"===e.userType?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(gy,{className:"h-5 w-5 mr-2"}),"Patient"]}),(0,Kg.jsxs)("button",{type:"button",onClick:()=>s(Le(Le({},e),{},{userType:"caregiver"})),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("caregiver"===e.userType?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(by,{className:"h-5 w-5 mr-2"}),"Caregiver"]}),(0,Kg.jsxs)("button",{type:"button",onClick:()=>s(Le(Le({},e),{},{userType:"admin"})),className:"flex items-center justify-center p-3 rounded-lg border-2 transition-colors ".concat("admin"===e.userType?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(Ry,{className:"h-5 w-5 mr-2"}),"Admin"]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"email",className:"form-label",children:[(0,Kg.jsx)(Gy,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,Kg.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Enter your email",value:e.email,onChange:a})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"password",className:"form-label",children:[(0,Kg.jsx)(Wy,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,Kg.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Create a password",value:e.password,onChange:a})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("label",{htmlFor:"confirmPassword",className:"form-label",children:[(0,Kg.jsx)(Wy,{className:"inline h-4 w-4 mr-2"}),"Confirm Password"]}),(0,Kg.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Confirm your password",value:e.confirmPassword,onChange:a})]})]}),(0,Kg.jsx)("div",{children:(0,Kg.jsx)("button",{type:"submit",disabled:n,className:"btn btn-primary w-full",children:n?"Creating Account...":"Create Account"})}),(0,Kg.jsx)("div",{className:"text-center",children:(0,Kg.jsxs)("p",{className:"text-gray-600",children:["Already have an account?"," ",(0,Kg.jsx)(Re,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in here"})]})})]})})]})})},zy=()=>(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Welcome back, Adunni"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Age"}),(0,Kg.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:"72 years"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Emergency Contact"}),(0,Kg.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:"Dr. Kemi Okafor"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"+234 801 987 6543"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Subscription"}),(0,Kg.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:"Premium"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Medical Conditions"}),(0,Kg.jsxs)("div",{className:"flex flex-wrap gap-2 mt-1",children:[(0,Kg.jsx)("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:"Hypertension"}),(0,Kg.jsx)("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs",children:"Diabetes Type 2"})]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("button",{className:"w-full bg-red-600 text-white py-4 px-6 rounded-lg font-bold text-lg hover:bg-red-700 transition-colors",children:[(0,Kg.jsx)(Zg,{className:"h-6 w-6 inline mr-2"}),"EMERGENCY - NEED HELP NOW"]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Kg.jsxs)("button",{className:"bg-orange-100 text-orange-700 py-3 px-4 rounded-lg hover:bg-orange-200 transition-colors",children:[(0,Kg.jsx)(Ay,{className:"h-5 w-5 inline mr-2"}),"Family"]}),(0,Kg.jsxs)("button",{className:"bg-blue-100 text-blue-700 py-3 px-4 rounded-lg hover:bg-blue-200 transition-colors",children:[(0,Kg.jsx)(cy,{className:"h-5 w-5 inline mr-2"}),"Doctor"]})]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsxs)("div",{className:"card text-center",children:[(0,Kg.jsx)(oy,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),(0,Kg.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"1"}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:"Upcoming Visits"})]}),(0,Kg.jsxs)("div",{className:"card text-center",children:[(0,Kg.jsx)(cy,{className:"h-8 w-8 text-red-600 mx-auto mb-2"}),(0,Kg.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"140/90"}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:"Last BP Reading"})]}),(0,Kg.jsxs)("div",{className:"card text-center",children:[(0,Kg.jsx)(dy,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),(0,Kg.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"3"}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:"New Messages"})]}),(0,Kg.jsxs)("div",{className:"card text-center",children:[(0,Kg.jsx)(Ay,{className:"h-8 w-8 text-purple-600 mx-auto mb-2"}),(0,Kg.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:"24/7"}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:"Support Available"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upcoming Care Visits"}),(0,Kg.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"font-semibold text-gray-900",children:"Medication Administration"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Caregiver TBD"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Time TBD"})]}),(0,Kg.jsx)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:"Pending"})]})})]})]}),qy=Qg("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Yy=Qg("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Xy=Qg("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),Jy=Qg("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Qy=()=>{const[e,s]=(0,t.useState)(!1),[n,r]=(0,t.useState)(null),[i,a]=(0,t.useState)([{id:1,name:"Aspirin",dosage:"100mg",frequency:"Daily",instructions:"Take with food",nextDose:"8:00 AM",taken:!0,startDate:"2024-01-15",endDate:null},{id:2,name:"Vitamin D",dosage:"2000IU",frequency:"Weekly",instructions:"Take in the morning",nextDose:"9:00 AM",taken:!1,startDate:"2024-01-10",endDate:null},{id:3,name:"Blood Pressure Medication",dosage:"10mg",frequency:"Twice Daily",instructions:"Take with water",nextDose:"2:00 PM",taken:!1,startDate:"2024-01-20",endDate:null}]),[o,c]=(0,t.useState)({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:"",endDate:""});return(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medications"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage your medications and track doses"})]}),(0,Kg.jsxs)("button",{onClick:()=>s(!0),className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4"}),"Add Medication"]})]}),e&&(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Medication"}),(0,Kg.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=Le(Le({id:Date.now()},o),{},{nextDose:"8:00 AM",taken:!1});a([...i,t]),c({name:"",dosage:"",frequency:"Daily",instructions:"",startDate:"",endDate:""}),s(!1),yt.success("Medication added successfully")},className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"form-label",children:"Medication Name"}),(0,Kg.jsx)("input",{type:"text",className:"form-input",value:o.name,onChange:e=>c(Le(Le({},o),{},{name:e.target.value})),required:!0})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"form-label",children:"Dosage"}),(0,Kg.jsx)("input",{type:"text",className:"form-input",value:o.dosage,onChange:e=>c(Le(Le({},o),{},{dosage:e.target.value})),required:!0})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"form-label",children:"Frequency"}),(0,Kg.jsxs)("select",{className:"form-input",value:o.frequency,onChange:e=>c(Le(Le({},o),{},{frequency:e.target.value})),children:[(0,Kg.jsx)("option",{value:"Daily",children:"Daily"}),(0,Kg.jsx)("option",{value:"Twice Daily",children:"Twice Daily"}),(0,Kg.jsx)("option",{value:"Weekly",children:"Weekly"}),(0,Kg.jsx)("option",{value:"As Needed",children:"As Needed"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"form-label",children:"Start Date"}),(0,Kg.jsx)("input",{type:"date",className:"form-input",value:o.startDate,onChange:e=>c(Le(Le({},o),{},{startDate:e.target.value})),required:!0})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"form-label",children:"Instructions"}),(0,Kg.jsx)("textarea",{className:"form-input form-textarea",value:o.instructions,onChange:e=>c(Le(Le({},o),{},{instructions:e.target.value})),placeholder:"e.g., Take with food, Take on empty stomach"})]}),(0,Kg.jsxs)("div",{className:"flex space-x-4",children:[(0,Kg.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Add Medication"}),(0,Kg.jsx)("button",{type:"button",onClick:()=>s(!1),className:"btn btn-outline",children:"Cancel"})]})]})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 gap-4",children:i.map(e=>(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ey,{className:"h-8 w-8 text-blue-600 mr-4"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Kg.jsxs)("p",{className:"text-gray-600",children:[e.dosage," \u2022 ",e.frequency]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:e.instructions}),(0,Kg.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-400",children:[(0,Kg.jsx)(oy,{className:"h-3 w-3 mr-1"}),"Started: ",e.startDate]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsxs)("div",{className:"text-right",children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Next Dose"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:e.nextDose}),(0,Kg.jsxs)("div",{className:"flex items-center mt-1",children:[e.taken?(0,Kg.jsx)(Ly,{className:"h-4 w-4 text-green-500 mr-1"}):(0,Kg.jsx)(Yy,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-xs text-gray-500",children:e.taken?"Taken":"Pending"})]})]}),(0,Kg.jsxs)("div",{className:"flex space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,a(i.map(e=>e.id===t?Le(Le({},e),{},{taken:!e.taken}):e)),void yt.success("Medication status updated");var t},className:"btn ".concat(e.taken?"btn-outline":"btn-success"),children:e.taken?"Mark as Missed":"Mark as Taken"}),(0,Kg.jsx)("button",{onClick:()=>r(e),className:"btn btn-outline",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,a(i.filter(e=>e.id!==t)),void yt.success("Medication deleted successfully");var t},className:"btn btn-danger",children:(0,Kg.jsx)(Jy,{className:"h-4 w-4"})})]})]})]})},e.id))}),0===i.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(Ey,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No medications added yet"}),(0,Kg.jsx)("p",{className:"text-gray-500 mb-4",children:"Start by adding your first medication"}),(0,Kg.jsxs)("button",{onClick:()=>s(!0),className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Add Your First Medication"]})]})]})},Zy=Qg("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),$y=Qg("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),ev=()=>{const[e,s]=(0,t.useState)({vitalType:"Blood Pressure",reading:"",notes:""}),n=[{id:1,type:"Blood Pressure",value:"140/90",unit:"mmHg",timestamp:"9/3/2025, 9:00:00 AM",status:"Warning",statusColor:"bg-yellow-100 text-yellow-800",icon:cy},{id:2,type:"Blood Sugar",value:"120",unit:"mg/dL",timestamp:"9/3/2025, 9:15:00 AM",status:"Normal",statusColor:"bg-green-100 text-green-800",icon:Zy}],r=[{id:1,type:"Blood Pressure",trend:"Improving",trendColor:"text-green-600",average:"Average",icon:cy}],i=e=>{switch(e){case"Normal":return"bg-green-100 text-green-800";case"Warning":return"bg-yellow-100 text-yellow-800";case"Critical":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,Kg.jsxs)("div",{className:"space-y-8",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Kg.jsx)(cy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Current Vitals"})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:n.map(e=>{const t=e.icon;return(0,Kg.jsxs)("div",{className:"p-6 border border-gray-200 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.type})]}),(0,Kg.jsx)("span",{className:"px-3 py-1 rounded text-sm font-medium ".concat(i(e.status)),children:e.status})]}),(0,Kg.jsxs)("div",{className:"mb-2",children:[(0,Kg.jsx)("span",{className:"text-3xl font-bold text-gray-900",children:e.value}),(0,Kg.jsx)("span",{className:"text-lg text-gray-600 ml-2",children:e.unit})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:e.timestamp})]},e.id)})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Kg.jsx)(qy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Record New Reading"})]}),(0,Kg.jsxs)("form",{onSubmit:t=>{t.preventDefault(),console.log("Vital reading submitted:",e),yt.success("Vital reading saved successfully"),s({vitalType:"Blood Pressure",reading:"",notes:""})},className:"space-y-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vital Type"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("select",{value:e.vitalType,onChange:t=>s(Le(Le({},e),{},{vitalType:t.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure","Blood Sugar","Heart Rate","Temperature","Weight","Oxygen Saturation","Respiratory Rate","Pain Level"].map(e=>(0,Kg.jsx)("option",{value:e,children:e},e))}),(0,Kg.jsx)($y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reading"}),(0,Kg.jsx)("input",{type:"text",value:e.reading,onChange:t=>s(Le(Le({},e),{},{reading:t.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., 120/80 or 98.6",required:!0})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,Kg.jsx)("textarea",{value:e.notes,onChange:t=>s(Le(Le({},e),{},{notes:t.target.value})),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Any additional observations..."})]}),(0,Kg.jsx)("div",{className:"flex justify-end",children:(0,Kg.jsxs)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center hover:bg-blue-700 transition-colors",children:[(0,Kg.jsx)(qy,{className:"h-5 w-5 mr-2"}),"Save Reading"]})})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Kg.jsx)(wy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Health Trends (Last 7 Days)"})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:r.map(e=>{const t=e.icon;return(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(t,{className:"h-6 w-6 text-gray-600 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"font-semibold text-gray-900",children:e.type}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium ".concat(e.trendColor),children:e.trend}),(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:e.average})]})]})]}),(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"View Details"})]},e.id)})})]})]})},tv=Qg("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),sv=()=>{const[e,s]=(0,t.useState)("immediate"),[n,r]=(0,t.useState)({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""}),i=e=>{switch(e){case"Available":return"bg-green-100 text-green-800";case"Busy":default:return"bg-gray-100 text-gray-800";case"In Progress":return"bg-blue-100 text-blue-800";case"Pending":return"bg-yellow-100 text-yellow-800"}},a=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-orange-100 text-orange-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return(0,Kg.jsxs)("div",{className:"space-y-8",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Kg.jsx)(Oy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Request Care Service"})]}),(0,Kg.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,Kg.jsxs)("button",{onClick:()=>s("immediate"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("immediate"===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Kg.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-current flex items-center justify-center mr-3",children:(0,Kg.jsx)("span",{className:"text-xs font-bold",children:"!"})}),"Need Care Now"]}),(0,Kg.jsxs)("button",{onClick:()=>s("scheduled"),className:"flex items-center px-6 py-3 rounded-lg border-2 transition-colors ".concat("scheduled"===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,Kg.jsx)(oy,{className:"h-5 w-5 mr-3"}),"Schedule Visit"]})]}),(0,Kg.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Care request submitted:",n),r({careType:"Blood Pressure Check",preferredDate:"",preferredTime:"",additionalNotes:""})},className:"space-y-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type of Care Needed"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("select",{value:n.careType,onChange:e=>r(Le(Le({},n),{},{careType:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",children:["Blood Pressure Check","Medication Administration","Wound Care","Physical Therapy","Vital Signs Monitoring","Meal Preparation","Companionship","Transportation","Housekeeping","Emergency Response"].map(e=>(0,Kg.jsx)("option",{value:e,children:e},e))}),(0,Kg.jsx)($y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),"scheduled"===e&&(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Date"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("input",{type:"date",value:n.preferredDate,onChange:e=>r(Le(Le({},n),{},{preferredDate:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"mm/dd/yyyy"}),(0,Kg.jsx)(oy,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Time"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("input",{type:"time",value:n.preferredTime,onChange:e=>r(Le(Le({},n),{},{preferredTime:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"--:--"}),(0,Kg.jsx)(Dy,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("textarea",{value:n.additionalNotes,onChange:e=>r(Le(Le({},n),{},{additionalNotes:e.target.value})),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Please describe your symptoms or specific care needs..."}),(0,Kg.jsx)(tv,{className:"absolute bottom-3 right-3 h-4 w-4 text-gray-400"})]})]}),(0,Kg.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors",children:"immediate"===e?"Request Immediate Care":"Schedule Care Visit"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Kg.jsx)(gy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Caregivers Nearby"})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:[{id:1,name:"Nurse Fatima Abdullahi",specialty:"Geriatric Care",rating:4.8,location:"Victoria Island, Lagos",status:"Available",visits:156,avatar:null},{id:2,name:"Dr. Chinedu Okoro",specialty:"General Medicine",rating:4.9,location:"Ikeja, Lagos",status:"Busy",visits:89,avatar:null}].map(e=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:e.specialty}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Uy,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:e.rating})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 text-gray-400 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:e.location})]})]})]})]}),(0,Kg.jsxs)("div",{className:"text-right",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(i(e.status)),children:e.status}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e.visits," visits"]})]})]},e.id))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Recent Care Requests"}),(0,Kg.jsx)("div",{className:"space-y-4",children:[{id:1,title:"Blood Pressure Check",assignedCaregiver:"Nurse Fatima Abdullahi",createdDate:"9/1/2025",scheduledDate:"9/3/2025, 2:00:00 PM",description:"Regular weekly checkup",status:"In Progress",priority:"Medium"},{id:2,title:"Medication Administration",assignedCaregiver:"Caregiver not assigned yet",createdDate:"9/3/2025",scheduledDate:null,description:"Daily medication reminder and administration",status:"Pending",priority:"High"}].map(e=>(0,Kg.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:e.title}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.assignedCaregiver}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 mr-1"}),(0,Kg.jsx)("span",{children:e.createdDate})]}),e.scheduledDate&&(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 mr-1"}),(0,Kg.jsx)("span",{children:e.scheduledDate})]})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,Kg.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(i(e.status)),children:e.status}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(a(e.priority)),children:e.priority})]})]})},e.id))})]})]})},nv=()=>{const e="John Doe",t="john.doe@example.com",s="elderly",n="1950-05-15",r={name:"Alice Johnson",phone:"555-1234"},i="Dr. Smith",a="Penicillin, Shellfish",o="Hypertension, Diabetes Type 2";return(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage your personal and medical information"})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Personal Information"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Full Name"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:e})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Gy,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:t})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Date of Birth"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:n})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ry,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Account Type"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900 capitalize",children:s})]})]})]}),(0,Kg.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Personal Info"})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medical Information"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Primary Care Doctor"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:i})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Allergies"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:a})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Medical Conditions"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:o})]})]}),(0,Kg.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Medical Info"})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Emergency Contact"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Name"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:r.name})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,Kg.jsx)("p",{className:"font-medium text-gray-900",children:r.phone})]})]})]}),(0,Kg.jsx)("button",{className:"btn btn-outline mt-4",children:"Edit Emergency Contact"})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Health Summary"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Active Medications"}),(0,Kg.jsx)("span",{className:"font-semibold text-gray-900",children:"5"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Upcoming Appointments"}),(0,Kg.jsx)("span",{className:"font-semibold text-gray-900",children:"2"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Vital Signs This Week"}),(0,Kg.jsx)("span",{className:"font-semibold text-gray-900",children:"12"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Medication Adherence"}),(0,Kg.jsx)("span",{className:"font-semibold text-green-600",children:"95%"})]})]}),(0,Kg.jsxs)("button",{className:"btn btn-primary mt-4",children:[(0,Kg.jsx)(cy,{className:"h-4 w-4 mr-2"}),"View Health Reports"]})]})]})]})},rv=Qg("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),iv=Qg("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),av=()=>{const[e,s]=(0,t.useState)(null),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)([]),[o,c]=(0,t.useState)({}),[l,d]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e={id:1,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",profileImage:null,rating:4.8,totalPatients:8,currentPatients:3,experience:"5 years",joinDate:"2023-06-15",hourlyRate:2500,totalEarnings:21e5,thisMonthEarnings:18e4,performance:{punctuality:95,patientSatisfaction:4.8,taskCompletion:98,communication:4.7,safety:100}};s(e),r([{id:1,patientName:"Adunni Okafor",patientId:"ELD001",time:"09:00",duration:"8 hours",address:"123 Victoria Island, Lagos",tasks:["Morning medication administration","Breakfast preparation","Physical therapy exercises","Lunch preparation","Afternoon medication","Evening care routine"],status:"upcoming",notes:"Patient has diabetes - monitor blood sugar levels",emergencyContact:"+234 801 987 6543"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",time:"14:00",duration:"4 hours",address:"456 Ikoyi, Lagos",tasks:["Medication administration","Light housekeeping","Companionship","Evening meal preparation"],status:"upcoming",notes:"Patient prefers quiet environment",emergencyContact:"+234 803 456 7890"}]),a([{id:1,patientName:"Adunni Okafor",task:"Medication Administration",completedAt:"2024-01-20T08:30:00Z",status:"completed",notes:"Patient took medication without issues"},{id:2,patientName:"Grace Johnson",task:"Physical Therapy",completedAt:"2024-01-20T10:15:00Z",status:"completed",notes:"Completed 30 minutes of exercises"},{id:3,patientName:"Adunni Okafor",task:"Blood Sugar Check",completedAt:"2024-01-20T12:00:00Z",status:"completed",notes:"Blood sugar: 120 mg/dL - within normal range"}]),c(e.performance),d(!1)},1e3)}catch(e){console.error("Error loading caregiver data:",e),d(!1)}})()},[]);const u=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"upcoming":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return l?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-white font-semibold text-lg",children:null===e||void 0===e?void 0:e.name.split(" ").map(e=>e[0]).join("")})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Welcome, ",null===e||void 0===e?void 0:e.name]}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Caregiver Dashboard"})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,Kg.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Kg.jsx)(fy,{className:"h-6 w-6"})}),(0,Kg.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Kg.jsx)(Cy,{className:"h-6 w-6"})}),(0,Kg.jsx)("button",{className:"p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition-colors",children:(0,Kg.jsx)(py,{className:"h-6 w-6"})})]})]})}),(0,Kg.jsx)("div",{className:"w-full p-8 dashboard-full-width",children:(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:[(0,Kg.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Today's Visits"}),(0,Kg.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:n.length})]}),(0,Kg.jsx)("div",{className:"p-3 bg-blue-50 rounded-xl",children:(0,Kg.jsx)(oy,{className:"h-8 w-8 text-blue-600"})})]})}),(0,Kg.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Completed Tasks"}),(0,Kg.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:i.filter(e=>"completed"===e.status).length})]}),(0,Kg.jsx)("div",{className:"p-3 bg-green-50 rounded-xl",children:(0,Kg.jsx)(Ly,{className:"h-8 w-8 text-green-600"})})]})}),(0,Kg.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Rating"}),(0,Kg.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:null===e||void 0===e?void 0:e.rating})]}),(0,Kg.jsx)("div",{className:"p-3 bg-yellow-50 rounded-xl",children:(0,Kg.jsx)(Uy,{className:"h-8 w-8 text-yellow-600"})})]})}),(0,Kg.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"This Month"}),(0,Kg.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["\u20a6",null===e||void 0===e?void 0:e.thisMonthEarnings.toLocaleString()]})]}),(0,Kg.jsx)("div",{className:"p-3 bg-purple-50 rounded-xl",children:(0,Kg.jsx)(wy,{className:"h-8 w-8 text-purple-600"})})]})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Kg.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Today's Schedule"})}),(0,Kg.jsx)("div",{className:"p-8",children:(0,Kg.jsx)("div",{className:"space-y-6",children:n.map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,Kg.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:e.patientName}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(u(e.status)),children:e.status})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-5 w-5 mr-2 text-gray-500"}),(0,Kg.jsxs)("span",{className:"font-medium",children:[e.time," (",e.duration,")"]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-5 w-5 mr-2 text-gray-500"}),(0,Kg.jsx)("span",{className:"font-medium",children:e.address})]})]}),(0,Kg.jsxs)("div",{className:"mb-4",children:[(0,Kg.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Tasks:"}),(0,Kg.jsx)("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:e.tasks.map((e,t)=>(0,Kg.jsxs)("li",{className:"flex items-center text-sm text-gray-600",children:[(0,Kg.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),e]},t))})]}),e.notes&&(0,Kg.jsxs)("div",{className:"mb-4",children:[(0,Kg.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Notes:"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:e.notes})]})]}),(0,Kg.jsxs)("div",{className:"flex flex-col space-y-3 ml-8",children:[(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock in for schedule:",t);var t},className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Clock In"}),(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Clock out for schedule:",t);var t},className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Clock Out"}),(0,Kg.jsxs)("button",{onClick:()=>{return t=e.patientId,void console.log("Emergency for patient:",t);var t},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium flex items-center justify-center",children:[(0,Kg.jsx)(Zg,{className:"h-4 w-4 mr-2"}),"Emergency"]})]})]})},e.id))})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Kg.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Tasks"})}),(0,Kg.jsx)("div",{className:"p-8",children:(0,Kg.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:shadow-md transition-shadow",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"p-2 bg-green-50 rounded-lg",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-base font-semibold text-gray-900",children:e.task}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:e.patientName}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.completedAt).toLocaleString()})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(u(e.status)),children:e.status}),(0,Kg.jsx)("button",{className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",children:(0,Kg.jsx)(rv,{className:"h-5 w-5"})})]})]},e.id))})})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Kg.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Performance Overview"})}),(0,Kg.jsx)("div",{className:"p-8",children:(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Punctuality"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Kg.jsx)("div",{className:"bg-green-600 h-3 rounded-full",style:{width:"".concat(o.punctuality,"%")}})}),(0,Kg.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[o.punctuality,"%"]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Task Completion"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Kg.jsx)("div",{className:"bg-blue-600 h-3 rounded-full",style:{width:"".concat(o.taskCompletion,"%")}})}),(0,Kg.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[o.taskCompletion,"%"]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Patient Satisfaction"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Uy,{className:"h-5 w-5 text-yellow-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-lg font-bold text-gray-900",children:o.patientSatisfaction})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Communication"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Uy,{className:"h-5 w-5 text-yellow-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-lg font-bold text-gray-900",children:o.communication})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-base font-medium text-gray-700",children:"Safety Record"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-40 bg-gray-200 rounded-full h-3 mr-4",children:(0,Kg.jsx)("div",{className:"bg-green-600 h-3 rounded-full",style:{width:"".concat(o.safety,"%")}})}),(0,Kg.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[o.safety,"%"]})]})]})]})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,Kg.jsx)("div",{className:"px-8 py-6 border-b border-gray-100",children:(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Quick Actions"})}),(0,Kg.jsx)("div",{className:"p-8",children:(0,Kg.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Kg.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Kg.jsx)(Ny,{className:"h-8 w-8 text-blue-600 mb-3"}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Messages"})]}),(0,Kg.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Kg.jsx)(jy,{className:"h-8 w-8 text-green-600 mb-3"}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Photo Update"})]}),(0,Kg.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Kg.jsx)(Ty,{className:"h-8 w-8 text-purple-600 mb-3"}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Add Note"})]}),(0,Kg.jsxs)("button",{className:"flex flex-col items-center justify-center p-6 border border-gray-200 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all",children:[(0,Kg.jsx)(iv,{className:"h-8 w-8 text-orange-600 mb-3"}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Navigation"})]})]})})]})]})]})})]})},ov=Qg("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),cv=Qg("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),lv=Qg("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),dv=()=>{const[e,s]=(0,t.useState)(new Date),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(new Date);(0,t.useEffect)(()=>{l()},[o]);const l=async()=>{try{a(!0),setTimeout(()=>{r([{id:1,patientName:"Adunni Okafor",patientAge:72,patientAddress:"123 Victoria Island, Lagos",patientPhone:"+234 801 234 5678",appointmentTime:"09:00",duration:60,type:"Home Visit",status:"scheduled",tasks:["Medication administration","Vital signs check","Meal preparation","Light housekeeping"],notes:"Patient has diabetes, check blood sugar levels",priority:"high",estimatedTravelTime:25},{id:2,patientName:"Tunde Adebayo",patientAge:68,patientAddress:"456 Ikoyi, Lagos",patientPhone:"+234 802 345 6789",appointmentTime:"11:30",duration:90,type:"Home Visit",status:"scheduled",tasks:["Physical therapy exercises","Medication reminder","Grocery shopping","Companionship"],notes:"Patient recovering from hip surgery",priority:"medium",estimatedTravelTime:15},{id:3,patientName:"Grace Johnson",patientAge:75,patientAddress:"789 Lekki, Lagos",patientPhone:"+234 803 456 7890",appointmentTime:"14:00",duration:45,type:"Home Visit",status:"completed",tasks:["Medication administration","Vital signs check","Meal preparation"],notes:"Regular checkup visit",priority:"low",estimatedTravelTime:30}]),a(!1)},1e3)}catch(e){console.error("Error loading schedule data:",e),a(!1)}},d=e=>{switch(e){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},u=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},h=e=>e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),p=e=>{const t=new Date(o);t.setDate(t.getDate()+e),c(t)};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Today's Schedule"}),(0,Kg.jsxs)("p",{className:"text-gray-600",children:["Your appointments and tasks for ",h(o)]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"Filter"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("button",{onClick:()=>p(-1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Kg.jsx)(cv,{className:"h-5 w-5"})}),(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:h(o)}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-500",children:[n.filter(e=>"scheduled"===e.status).length," appointments scheduled"]})]}),(0,Kg.jsx)("button",{onClick:()=>p(1),className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50",children:(0,Kg.jsx)(lv,{className:"h-5 w-5"})})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Schedule Timeline"}),(0,Kg.jsx)("div",{className:"space-y-4",children:n.filter(e=>"scheduled"===e.status).sort((e,t)=>e.appointmentTime.localeCompare(t.appointmentTime)).map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-green-600 font-medium",children:e.patientName.split(" ").map(e=>e[0]).join("")})})}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge]}),(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.priority)),children:[e.priority," priority"]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(u(e.status)),children:e.status})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 mr-2"}),(0,Kg.jsxs)("span",{children:[e.appointmentTime," (",e.duration," minutes)"]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 mr-2"}),(0,Kg.jsx)("span",{children:e.patientAddress})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-4 w-4 mr-2"}),(0,Kg.jsx)("span",{children:e.patientPhone})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(iv,{className:"h-4 w-4 mr-2"}),(0,Kg.jsxs)("span",{children:[e.estimatedTravelTime," min travel time"]})]})]}),(0,Kg.jsx)("div",{className:"mb-3",children:(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:e.notes})}),(0,Kg.jsxs)("div",{className:"mb-3",children:[(0,Kg.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tasks:"}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tasks.map((e,t)=>(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,Kg.jsx)(Ly,{className:"h-3 w-3 mr-1"}),e]},t))})]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(iv,{className:"h-4 w-4 mr-2"}),"Navigate"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Ly,{className:"h-4 w-4 mr-2"}),"Start Visit"]})]})]})},e.id))})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Kg.jsx)(oy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n.filter(e=>"scheduled"===e.status).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n.filter(e=>"completed"===e.status).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,Kg.jsx)(Dy,{className:"h-6 w-6 text-yellow-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Hours"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n.reduce((e,t)=>e+t.duration,0)/60})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"High Priority"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n.filter(e=>"high"===e.priority).length})]})]})})]})]})},uv=Qg("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),hv=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)(!0),[i,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{s([{id:1,name:"Adunni Okafor",age:72,gender:"Female",phone:"+234 801 234 5678",address:"123 Victoria Island, Lagos",medicalCondition:"Diabetes",emergencyContact:"+234 802 345 6789",lastVisit:"2024-01-20",nextAppointment:"2024-01-22",status:"active",notes:"Patient has diabetes - monitor blood sugar levels regularly",medications:["Metformin","Insulin"],allergies:["Penicillin"],caregiverNotes:"Very cooperative, prefers morning visits",rating:4.8},{id:2,name:"Grace Johnson",age:68,gender:"Female",phone:"+234 803 456 7890",address:"456 Ikoyi, Lagos",medicalCondition:"Hypertension",emergencyContact:"+234 804 567 8901",lastVisit:"2024-01-19",nextAppointment:"2024-01-21",status:"active",notes:"Patient prefers quiet environment",medications:["Amlodipine","Lisinopril"],allergies:["Shellfish"],caregiverNotes:"Loves gardening, very independent",rating:4.9},{id:3,name:"Michael Adebayo",age:75,gender:"Male",phone:"+234 805 678 9012",address:"789 Lekki, Lagos",medicalCondition:"Arthritis",emergencyContact:"+234 806 789 0123",lastVisit:"2024-01-18",nextAppointment:"2024-01-23",status:"inactive",notes:"Requires assistance with mobility",medications:["Ibuprofen","Calcium"],allergies:["Latex"],caregiverNotes:"Needs help with daily activities",rating:4.7}]),r(!1)},1e3)}catch(e){console.error("Error loading patients:",e),r(!1)}})()},[]);const l=e.filter(e=>{const t=e.name.toLowerCase().includes(i.toLowerCase())||e.medicalCondition.toLowerCase().includes(i.toLowerCase()),s="all"===o||e.status===o;return t&&s}),d=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"critical":return"bg-red-100 text-red-800"}};return n?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Kg.jsx)(cy,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"My Patients"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage your patient information and care"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-4",children:(0,Kg.jsxs)("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Kg.jsx)(qy,{className:"h-5 w-5 mr-2"}),"Add Patient"]})})]})}),(0,Kg.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Kg.jsx)("div",{className:"mb-8",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search patients by name or condition...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:i,onChange:e=>a(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Patients"}),(0,Kg.jsx)("option",{value:"active",children:"Active"}),(0,Kg.jsx)("option",{value:"inactive",children:"Inactive"}),(0,Kg.jsx)("option",{value:"critical",children:"Critical"})]}),(0,Kg.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Kg.jsx)(ov,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:l.map(e=>(0,Kg.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:(0,Kg.jsxs)("div",{className:"p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-blue-600 font-semibold text-lg",children:e.name.split(" ").map(e=>e[0]).join("")})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600",children:[e.age,"y, ",e.gender]})]})]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.status)),children:e.status})]}),(0,Kg.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Kg.jsx)(cy,{className:"h-4 w-4 mr-2 text-red-500"}),(0,Kg.jsx)("span",{className:"font-medium",children:e.medicalCondition})]}),(0,Kg.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Kg.jsx)(Ay,{className:"h-4 w-4 mr-2 text-green-500"}),(0,Kg.jsx)("span",{children:e.phone})]}),(0,Kg.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 mr-2 text-blue-500"}),(0,Kg.jsx)("span",{children:e.address})]}),(0,Kg.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 mr-2 text-purple-500"}),(0,Kg.jsxs)("span",{children:["Next: ",new Date(e.nextAppointment).toLocaleDateString()]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Kg.jsx)("div",{className:"flex items-center",children:[...Array(5)].map((t,s)=>(0,Kg.jsx)(Uy,{className:"h-4 w-4 ".concat(s<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300")},s))}),(0,Kg.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:e.rating})]}),(0,Kg.jsxs)("div",{className:"flex space-x-2",children:[(0,Kg.jsxs)("button",{className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center text-sm",children:[(0,Kg.jsx)(rv,{className:"h-4 w-4 mr-1"}),"View"]}),(0,Kg.jsxs)("button",{className:"flex-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center text-sm",children:[(0,Kg.jsx)(Ny,{className:"h-4 w-4 mr-1"}),"Message"]}),(0,Kg.jsx)("button",{className:"px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})})]})]})},e.id))}),0===l.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(cy,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No patients found"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:i?"Try adjusting your search criteria":"No patients match the selected filter"})]})]})]})},pv=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)(!0),[i,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{s([{id:1,title:"Morning Medication Administration",patientName:"Adunni Okafor",patientId:"ELD001",description:"Administer morning diabetes medications and check blood sugar levels",status:"pending",priority:"high",dueDate:"2024-01-21T09:00:00Z",estimatedDuration:30,location:"123 Victoria Island, Lagos",type:"medication",notes:"Patient has diabetes - monitor blood sugar levels",completedAt:null,createdAt:"2024-01-20T08:00:00Z"},{id:2,title:"Physical Therapy Session",patientName:"Grace Johnson",patientId:"ELD002",description:"Assist with 30-minute physical therapy exercises",status:"completed",priority:"medium",dueDate:"2024-01-20T10:00:00Z",estimatedDuration:45,location:"456 Ikoyi, Lagos",type:"therapy",notes:"Patient prefers gentle exercises",completedAt:"2024-01-20T10:30:00Z",createdAt:"2024-01-20T07:00:00Z"},{id:3,title:"Lunch Preparation",patientName:"Adunni Okafor",patientId:"ELD001",description:"Prepare diabetic-friendly lunch meal",status:"in-progress",priority:"medium",dueDate:"2024-01-21T12:00:00Z",estimatedDuration:60,location:"123 Victoria Island, Lagos",type:"meal",notes:"Follow diabetic diet guidelines",completedAt:null,createdAt:"2024-01-20T08:30:00Z"},{id:4,title:"Emergency Response",patientName:"Michael Adebayo",patientId:"ELD003",description:"Respond to emergency alert - check patient condition",status:"pending",priority:"critical",dueDate:"2024-01-21T14:30:00Z",estimatedDuration:15,location:"789 Lekki, Lagos",type:"emergency",notes:"Patient has mobility issues",completedAt:null,createdAt:"2024-01-20T14:15:00Z"},{id:5,title:"Evening Care Routine",patientName:"Grace Johnson",patientId:"ELD002",description:"Evening medication and bedtime routine",status:"pending",priority:"medium",dueDate:"2024-01-21T18:00:00Z",estimatedDuration:45,location:"456 Ikoyi, Lagos",type:"care",notes:"Patient prefers quiet environment",completedAt:null,createdAt:"2024-01-20T17:00:00Z"}]),r(!1)},1e3)}catch(e){console.error("Error loading tasks:",e),r(!1)}})()},[]);const u=e.filter(e=>{const t=e.title.toLowerCase().includes(i.toLowerCase())||e.patientName.toLowerCase().includes(i.toLowerCase()),s="all"===o||e.status===o,n="all"===l||e.priority===l;return t&&s&&n}),h=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},p=e=>{switch(e){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},m=e=>{switch(e){case"medication":return(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-blue-600"});case"therapy":return(0,Kg.jsx)(cy,{className:"h-5 w-5 text-green-600"});case"meal":return(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-orange-600"});case"emergency":return(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-red-600"});case"care":return(0,Kg.jsx)(gy,{className:"h-5 w-5 text-purple-600"});default:return(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-gray-600"})}},f=t=>{s(e.map(e=>e.id===t?Le(Le({},e),{},{status:"completed",completedAt:(new Date).toISOString()}):e))};return n?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Kg.jsx)(Ly,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage your care tasks and assignments"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-4",children:(0,Kg.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Kg.jsx)(qy,{className:"h-5 w-5 mr-2"}),"Add Task"]})})]})}),(0,Kg.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Kg.jsx)("div",{className:"mb-8",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search tasks by title or patient name...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:i,onChange:e=>a(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"pending",children:"Pending"}),(0,Kg.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,Kg.jsx)("option",{value:"completed",children:"Completed"}),(0,Kg.jsx)("option",{value:"overdue",children:"Overdue"})]}),(0,Kg.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Priority"}),(0,Kg.jsx)("option",{value:"critical",children:"Critical"}),(0,Kg.jsx)("option",{value:"high",children:"High"}),(0,Kg.jsx)("option",{value:"medium",children:"Medium"}),(0,Kg.jsx)("option",{value:"low",children:"Low"})]}),(0,Kg.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Kg.jsx)(ov,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsx)("div",{className:"space-y-4",children:u.map(t=>(0,Kg.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:(0,Kg.jsx)("div",{className:"p-6",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,Kg.jsx)("div",{className:"p-2 bg-gray-50 rounded-lg",children:m(t.type)}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t.title}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Kg.jsxs)("span",{className:"flex items-center",children:[(0,Kg.jsx)(gy,{className:"h-4 w-4 mr-1"}),t.patientName]}),(0,Kg.jsxs)("span",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 mr-1"}),t.location]}),(0,Kg.jsxs)("span",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 mr-1"}),t.estimatedDuration," min"]})]})]})]}),(0,Kg.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 mr-1"}),(0,Kg.jsxs)("span",{children:["Due: ",new Date(t.dueDate).toLocaleDateString()," ",new Date(t.dueDate).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(h(t.status)),children:t.status}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(p(t.priority)),children:t.priority})]}),t.notes&&(0,Kg.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:(0,Kg.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,Kg.jsx)("strong",{children:"Notes:"})," ",t.notes]})})]}),(0,Kg.jsxs)("div",{className:"flex flex-col space-y-2 ml-6",children:["pending"===t.status&&(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("button",{onClick:()=>{return n=t.id,void s(e.map(e=>e.id===n?Le(Le({},e),{},{status:"in-progress"}):e));var n},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Start Task"}),(0,Kg.jsx)("button",{onClick:()=>f(t.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Complete"})]}),"in-progress"===t.status&&(0,Kg.jsx)("button",{onClick:()=>f(t.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Mark Complete"}),"completed"===t.status&&(0,Kg.jsxs)("div",{className:"flex items-center text-green-600 text-sm",children:[(0,Kg.jsx)(Ly,{className:"h-4 w-4 mr-1"}),"Completed"]}),(0,Kg.jsxs)("div",{className:"flex space-x-1",children:[(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})})]})]})]})})},t.id))}),0===u.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(Ly,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tasks found"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:i?"Try adjusting your search criteria":"No tasks match the selected filters"})]})]})]})},mv=Qg("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),fv=Qg("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),gv=Qg("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),yv=Qg("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),vv=Qg("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),xv=Qg("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),_v=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)(null),[i,a]=(0,t.useState)([]),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)("");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",lastMessage:"Thank you for the medication reminder",lastMessageTime:"2024-01-21T10:30:00Z",unreadCount:2,avatar:null,status:"online",lastSeen:"2024-01-21T10:35:00Z"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",lastMessage:"See you tomorrow for therapy session",lastMessageTime:"2024-01-21T09:15:00Z",unreadCount:0,avatar:null,status:"offline",lastSeen:"2024-01-21T09:20:00Z"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",lastMessage:"Emergency alert received - all clear now",lastMessageTime:"2024-01-21T08:45:00Z",unreadCount:1,avatar:null,status:"online",lastSeen:"2024-01-21T08:50:00Z"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",lastMessage:"Lunch was delicious, thank you!",lastMessageTime:"2024-01-21T08:00:00Z",unreadCount:0,avatar:null,status:"offline",lastSeen:"2024-01-21T08:05:00Z"}];s(e),r(e[0]),d(!1)},1e3)}catch(e){console.error("Error loading conversations:",e),d(!1)}})()},[]),(0,t.useEffect)(()=>{n&&p(n.id)},[n]);const p=async e=>{try{setTimeout(()=>{a([{id:1,senderId:"caregiver",senderName:"You",message:"Good morning! Time for your morning medication.",timestamp:"2024-01-21T09:00:00Z",type:"text",status:"delivered"},{id:2,senderId:"ELD001",senderName:"Adunni Okafor",message:"Good morning! I'm ready for my medication.",timestamp:"2024-01-21T09:05:00Z",type:"text",status:"read"},{id:3,senderId:"caregiver",senderName:"You",message:"Perfect! I'll be there in 10 minutes.",timestamp:"2024-01-21T09:06:00Z",type:"text",status:"delivered"},{id:4,senderId:"ELD001",senderName:"Adunni Okafor",message:"Thank you for the medication reminder",timestamp:"2024-01-21T10:30:00Z",type:"text",status:"read"}])},500)}catch(t){console.error("Error loading messages:",t)}},m=e.filter(e=>e.patientName.toLowerCase().includes(u.toLowerCase())),f=()=>{if(o.trim()&&n){const t={id:Date.now(),senderId:"caregiver",senderName:"You",message:o.trim(),timestamp:(new Date).toISOString(),type:"text",status:"sending"};a([...i,t]),c(""),s(e.map(e=>e.id===n.id?Le(Le({},e),{},{lastMessage:t.message,lastMessageTime:t.timestamp}):e))}},g=e=>"online"===e?"bg-green-500":"bg-gray-400",y=e=>{const t=new Date(e),s=(new Date-t)/36e5;return s<1?"Just now":s<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString()};return l?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Kg.jsx)(dy,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Communicate with your patients and family members"})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("button",{className:"p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:(0,Kg.jsx)(Ay,{className:"h-5 w-5"})}),(0,Kg.jsx)("button",{className:"p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Kg.jsx)(ly,{className:"h-5 w-5"})})]})]})}),(0,Kg.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Kg.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Kg.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value)})]})}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto",children:m.map(e=>(0,Kg.jsx)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===n||void 0===n?void 0:n.id)===e.id?"bg-blue-50 border-blue-200":""),onClick:()=>r(e),children:(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-6 w-6 text-gray-600"})}),(0,Kg.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white ".concat(g(e.status))})]}),(0,Kg.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.patientName}),(0,Kg.jsx)("span",{className:"text-xs text-gray-500",children:y(e.lastMessageTime)})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 truncate mt-1",children:e.lastMessage}),e.unreadCount>0&&(0,Kg.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,Kg.jsxs)("span",{className:"text-xs text-gray-500",children:["ID: ",e.patientId]}),(0,Kg.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unreadCount})]})]})]})},e.id))})]}),(0,Kg.jsx)("div",{className:"flex-1 flex flex-col",children:n?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-600"})}),(0,Kg.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white ".concat(g(n.status))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:n.patientName}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",n.patientId," \u2022 ",n.status]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(Ay,{className:"h-5 w-5"})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(ly,{className:"h-5 w-5"})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(mv,{className:"h-5 w-5"})})]})]})}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:i.map(e=>(0,Kg.jsx)("div",{className:"flex ".concat("caregiver"===e.senderId?"justify-end":"justify-start"),children:(0,Kg.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("caregiver"===e.senderId?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"),children:[(0,Kg.jsx)("p",{className:"text-sm",children:e.message}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between mt-1 text-xs ".concat("caregiver"===e.senderId?"text-blue-100":"text-gray-500"),children:[(0,Kg.jsx)("span",{children:y(e.timestamp)}),"caregiver"===e.senderId&&(0,Kg.jsx)("div",{className:"flex items-center ml-2",children:"read"===e.status?(0,Kg.jsx)(fv,{className:"h-3 w-3"}):(0,Kg.jsx)(gv,{className:"h-3 w-3"})})]})]})},e.id))}),(0,Kg.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(yv,{className:"h-5 w-5"})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(jy,{className:"h-5 w-5"})}),(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsx)("input",{type:"text",placeholder:"Type a message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),onKeyPress:e=>"Enter"===e.key&&f()})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(vv,{className:"h-5 w-5"})}),(0,Kg.jsx)("button",{onClick:f,className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Kg.jsx)(xv,{className:"h-5 w-5"})})]})})]}):(0,Kg.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(dy,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Choose a conversation from the list to start messaging"})]})})})]})]})},Ev=Qg("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),bv=Qg("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),wv=Qg("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Nv=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)(null),[i,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",address:"123 Victoria Island, Lagos",coordinates:{lat:6.4281,lng:3.4219},distance:2.5,estimatedTime:15,priority:"high",visitTime:"2024-01-21T09:00:00Z",status:"scheduled",notes:"Morning medication administration",contactNumber:"+234 801 234 5678",lastVisited:"2024-01-20T09:00:00Z"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",address:"456 Ikoyi, Lagos",coordinates:{lat:6.4474,lng:3.4288},distance:5.2,estimatedTime:25,priority:"medium",visitTime:"2024-01-21T10:00:00Z",status:"scheduled",notes:"Physical therapy session",contactNumber:"+234 802 345 6789",lastVisited:"2024-01-19T10:00:00Z"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",address:"789 Lekki, Lagos",coordinates:{lat:6.4698,lng:3.5852},distance:8.7,estimatedTime:35,priority:"low",visitTime:"2024-01-21T14:00:00Z",status:"scheduled",notes:"Regular checkup and medication review",contactNumber:"+234 803 456 7890",lastVisited:"2024-01-18T14:00:00Z"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",address:"321 Surulere, Lagos",coordinates:{lat:6.5018,lng:3.3584},distance:12.3,estimatedTime:45,priority:"medium",visitTime:"2024-01-21T16:00:00Z",status:"scheduled",notes:"Lunch preparation and care routine",contactNumber:"+234 804 567 8901",lastVisited:"2024-01-17T16:00:00Z"}];s(e),r(e[0]),c(!1)},1e3)}catch(e){console.error("Error loading routes:",e),c(!1)}})()},[]);const p=e.filter(e=>{const t=e.patientName.toLowerCase().includes(l.toLowerCase())||e.address.toLowerCase().includes(l.toLowerCase()),s="all"===u||e.priority===u;return t&&s}),m=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},f=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),y=e=>new Date(e).toLocaleDateString();return o?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-purple-600 flex items-center justify-center",children:(0,Kg.jsx)(iv,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Navigation"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Plan your routes and navigate to patient locations"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-4",children:(0,Kg.jsxs)("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[(0,Kg.jsx)(Ev,{className:"h-5 w-5 mr-2"}),"Optimize Route"]})})]})}),(0,Kg.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Kg.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Kg.jsxs)("div",{className:"p-4 border-b border-gray-200 space-y-3",children:[(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search patients or addresses...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value)})]}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Priorities"}),(0,Kg.jsx)("option",{value:"high",children:"High Priority"}),(0,Kg.jsx)("option",{value:"medium",children:"Medium Priority"}),(0,Kg.jsx)("option",{value:"low",children:"Low Priority"})]})]}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto",children:p.map(e=>(0,Kg.jsxs)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===n||void 0===n?void 0:n.id)===e.id?"bg-purple-50 border-purple-200":""),onClick:()=>r(e),children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-600",children:["ID: ",e.patientId]})]}),(0,Kg.jsxs)("div",{className:"flex flex-col items-end space-y-1",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(m(e.priority)),children:e.priority}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(f(e.status)),children:e.status})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center text-xs text-gray-600 mb-2",children:[(0,Kg.jsx)(Vy,{className:"h-3 w-3 mr-1"}),(0,Kg.jsx)("span",{className:"truncate",children:e.address})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsxs)("span",{className:"flex items-center",children:[(0,Kg.jsx)(bv,{className:"h-3 w-3 mr-1"}),e.distance," km"]}),(0,Kg.jsxs)("span",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-3 w-3 mr-1"}),e.estimatedTime," min"]})]}),(0,Kg.jsx)("span",{className:"font-medium",children:g(e.visitTime)})]})]},e.id))})]}),(0,Kg.jsx)("div",{className:"flex-1 flex flex-col",children:n?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsxs)("div",{className:"h-1/2 bg-gray-200 relative",children:[(0,Kg.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(Vy,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Interactive Map"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Map integration would go here"})]})}),(0,Kg.jsx)("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-3",children:(0,Kg.jsxs)("div",{className:"text-sm",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-1",children:[(0,Kg.jsx)(bv,{className:"h-4 w-4 mr-2 text-blue-600"}),(0,Kg.jsxs)("span",{className:"font-medium",children:[n.distance," km"]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 mr-2 text-green-600"}),(0,Kg.jsxs)("span",{className:"font-medium",children:[n.estimatedTime," min"]})]})]})})]}),(0,Kg.jsx)("div",{className:"h-1/2 bg-white border-t border-gray-200 overflow-y-auto",children:(0,Kg.jsxs)("div",{className:"p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:n.patientName}),(0,Kg.jsxs)("p",{className:"text-gray-600",children:["ID: ",n.patientId]})]}),(0,Kg.jsxs)("div",{className:"flex space-x-2",children:["scheduled"===n.status&&(0,Kg.jsxs)("button",{onClick:()=>{return t=n,void s(e.map(e=>e.id===t.id?Le(Le({},e),{},{status:"in-progress"}):e));var t},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[(0,Kg.jsx)(iv,{className:"h-4 w-4 mr-2"}),"Start Navigation"]}),"in-progress"===n.status&&(0,Kg.jsxs)("button",{onClick:()=>{return t=n,void s(e.map(e=>e.id===t.id?Le(Le({},e),{},{status:"completed"}):e));var t},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Kg.jsx)(Ly,{className:"h-4 w-4 mr-2"}),"Complete Visit"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Route Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Address"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:n.address})]})]}),(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(wv,{className:"h-4 w-4"})})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Visit Time"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:g(n.visitTime)})]})]}),(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:y(n.visitTime)})]}),(0,Kg.jsx)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(bv,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Distance & Time"}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600",children:[n.distance," km \u2022 ",n.estimatedTime," min"]})]})]})})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Patient Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Contact"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:n.contactNumber})]})]}),(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(Ay,{className:"h-4 w-4"})})]}),(0,Kg.jsx)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-5 w-5 text-gray-600 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Last Visit"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:y(n.lastVisited)})]})]})}),(0,Kg.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-start",children:[(0,Kg.jsx)(dy,{className:"h-5 w-5 text-gray-600 mr-3 mt-0.5"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Notes"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:n.notes})]})]})})]})]})]})]})})]}):(0,Kg.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(iv,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a route"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Choose a patient route from the list to view details and start navigation"})]})})})]})]})},Sv=Qg("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Tv=Qg("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Cv=Qg("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Rv=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)(!0),[i,a]=(0,t.useState)(""),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{s([{id:1,patientName:"Adunni Okafor",patientId:"ELD001",title:"Morning medication administration",description:"Patient taking morning diabetes medication as prescribed",category:"medication",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T09:30:00Z",location:"123 Victoria Island, Lagos",tags:["medication","morning","diabetes"],status:"approved",notes:"Patient compliant with medication schedule"},{id:2,patientName:"Grace Johnson",patientId:"ELD002",title:"Physical therapy progress",description:"Patient completing physical therapy exercises",category:"therapy",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T10:15:00Z",location:"456 Ikoyi, Lagos",tags:["therapy","exercise","progress"],status:"pending",notes:"Good progress in mobility exercises"},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",title:"Lunch meal preparation",description:"Healthy diabetic-friendly meal prepared",category:"meal",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T12:45:00Z",location:"789 Lekki, Lagos",tags:["meal","nutrition","diabetic"],status:"approved",notes:"Meal follows dietary guidelines"},{id:4,patientName:"Sarah Williams",patientId:"ELD004",title:"Evening care routine",description:"Patient ready for evening medication and bedtime routine",category:"care",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T18:30:00Z",location:"321 Surulere, Lagos",tags:["care","evening","routine"],status:"pending",notes:"Patient comfortable and ready for rest"},{id:5,patientName:"Adunni Okafor",patientId:"ELD001",title:"Blood sugar monitoring",description:"Blood glucose level check - within normal range",category:"health",imageUrl:"/api/placeholder/400/300",thumbnailUrl:"/api/placeholder/200/150",uploadedAt:"2024-01-21T14:00:00Z",location:"123 Victoria Island, Lagos",tags:["health","monitoring","diabetes"],status:"approved",notes:"Blood sugar levels stable"}]),r(!1)},1e3)}catch(e){console.error("Error loading photos:",e),r(!1)}})()},[]);const f=e.filter(e=>{const t=e.title.toLowerCase().includes(i.toLowerCase())||e.patientName.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase()),s="all"===o||e.patientId===o,n="all"===l||e.category===l;return t&&s&&n}),g=e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=e=>{switch(e){case"medication":return(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-blue-600"});case"therapy":return(0,Kg.jsx)(cy,{className:"h-5 w-5 text-green-600"});case"meal":return(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-orange-600"});case"care":return(0,Kg.jsx)(gy,{className:"h-5 w-5 text-purple-600"});case"health":return(0,Kg.jsx)(cy,{className:"h-5 w-5 text-red-600"});default:return(0,Kg.jsx)(Sv,{className:"h-5 w-5 text-gray-600"})}},v=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return n?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-indigo-600 flex items-center justify-center",children:(0,Kg.jsx)(jy,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Photo Updates"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Document patient care activities with photos and updates"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-4",children:(0,Kg.jsxs)("button",{onClick:()=>{m(!0)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center",children:[(0,Kg.jsx)(qy,{className:"h-5 w-5 mr-2"}),"Upload Photo"]})})]})}),(0,Kg.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Kg.jsx)("div",{className:"mb-8",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search photos by title, patient, or description...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:i,onChange:e=>a(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Patients"}),(0,Kg.jsx)("option",{value:"ELD001",children:"Adunni Okafor"}),(0,Kg.jsx)("option",{value:"ELD002",children:"Grace Johnson"}),(0,Kg.jsx)("option",{value:"ELD003",children:"Michael Adebayo"}),(0,Kg.jsx)("option",{value:"ELD004",children:"Sarah Williams"})]}),(0,Kg.jsxs)("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Categories"}),(0,Kg.jsx)("option",{value:"medication",children:"Medication"}),(0,Kg.jsx)("option",{value:"therapy",children:"Therapy"}),(0,Kg.jsx)("option",{value:"meal",children:"Meal"}),(0,Kg.jsx)("option",{value:"care",children:"Care"}),(0,Kg.jsx)("option",{value:"health",children:"Health"})]}),(0,Kg.jsxs)("button",{className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[(0,Kg.jsx)(ov,{className:"h-5 w-5 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:f.map(t=>{return(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("div",{className:"aspect-w-16 aspect-h-12 bg-gray-200 rounded-t-xl overflow-hidden",children:(0,Kg.jsx)("div",{className:"w-full h-48 bg-gray-200 flex items-center justify-center",children:(0,Kg.jsx)(Sv,{className:"h-16 w-16 text-gray-400"})})}),(0,Kg.jsx)("div",{className:"absolute top-3 left-3",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(g(t.status)),children:t.status})}),(0,Kg.jsx)("div",{className:"absolute top-3 right-3",children:(0,Kg.jsxs)("div",{className:"flex space-x-1",children:[(0,Kg.jsx)("button",{className:"p-1 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 transition-all",children:(0,Kg.jsx)(rv,{className:"h-4 w-4 text-gray-600"})}),(0,Kg.jsx)("button",{className:"p-1 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 transition-all",children:(0,Kg.jsx)(Tv,{className:"h-4 w-4 text-gray-600"})})]})})]}),(0,Kg.jsxs)("div",{className:"p-4",children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Kg.jsx)("h3",{className:"text-sm font-semibold text-gray-900 line-clamp-2",children:t.title}),(0,Kg.jsx)("div",{className:"p-1 bg-gray-100 rounded-lg ml-2",children:y(t.category)})]}),(0,Kg.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Kg.jsx)(gy,{className:"h-3 w-3 mr-1"}),(0,Kg.jsx)("span",{children:t.patientName})]}),(0,Kg.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Kg.jsx)(oy,{className:"h-3 w-3 mr-1"}),(0,Kg.jsx)("span",{children:(n=t.uploadedAt,new Date(n).toLocaleDateString())})]}),(0,Kg.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Kg.jsx)(Dy,{className:"h-3 w-3 mr-1"}),(0,Kg.jsx)("span",{children:v(t.uploadedAt)})]}),(0,Kg.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,Kg.jsx)(Vy,{className:"h-3 w-3 mr-1"}),(0,Kg.jsx)("span",{className:"truncate",children:t.location})]})]}),(0,Kg.jsxs)("div",{className:"mt-3 flex flex-wrap gap-1",children:[t.tags.slice(0,3).map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700",children:e},t)),t.tags.length>3&&(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-700",children:["+",t.tags.length-3]})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,Kg.jsx)("button",{onClick:()=>h(t),className:"px-3 py-1 text-xs bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"View Details"}),(0,Kg.jsxs)("div",{className:"flex space-x-1",children:[(0,Kg.jsx)("button",{className:"p-1 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>{return n=t.id,void s(e.filter(e=>e.id!==n));var n},className:"p-1 text-gray-400 hover:text-red-600",children:(0,Kg.jsx)(Jy,{className:"h-4 w-4"})})]})]})]})]},t.id);var n})}),0===f.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(jy,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No photos found"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:i?"Try adjusting your search criteria":"No photos match the selected filters"})]})]}),p&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Kg.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Photo Update"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Patient"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{children:"Adunni Okafor"}),(0,Kg.jsx)("option",{children:"Grace Johnson"}),(0,Kg.jsx)("option",{children:"Michael Adebayo"}),(0,Kg.jsx)("option",{children:"Sarah Williams"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"medication",children:"Medication"}),(0,Kg.jsx)("option",{value:"therapy",children:"Therapy"}),(0,Kg.jsx)("option",{value:"meal",children:"Meal"}),(0,Kg.jsx)("option",{value:"care",children:"Care"}),(0,Kg.jsx)("option",{value:"health",children:"Health"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),(0,Kg.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter photo title"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,Kg.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:"3",placeholder:"Enter photo description"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Photo"}),(0,Kg.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,Kg.jsx)(Cv,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"})]})]})]}),(0,Kg.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,Kg.jsx)("button",{onClick:()=>m(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),(0,Kg.jsx)("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Upload Photo"})]})]})})]})},Iv=()=>{var e,s,n,r,i,a,o,c,l,d,u,h,p,m;const[f,g]=(0,t.useState)({}),[y,v]=(0,t.useState)(!0),[x,_]=(0,t.useState)("week"),[E,b]=(0,t.useState)("overall");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{g({overall:{rating:4.8,totalPatients:12,totalTasks:156,completedTasks:148,onTimeRate:94.9,patientSatisfaction:96.2,emergencyResponseTime:8.5},weekly:{tasksCompleted:32,tasksOnTime:30,patientsServed:8,hoursWorked:40,emergencyResponses:2,patientCalls:15,medicationAdministrations:24,therapySessions:8},monthly:{tasksCompleted:148,tasksOnTime:141,patientsServed:12,hoursWorked:160,emergencyResponses:8,patientCalls:65,medicationAdministrations:96,therapySessions:32},trends:{tasksCompleted:[28,32,30,35,32,38,32],onTimeRate:[92,94,91,96,94,98,95],patientSatisfaction:[94,95,93,97,96,98,96]},achievements:[{id:1,title:"Perfect Week",description:"Completed all tasks on time for 5 consecutive days",icon:"\ud83c\udfc6",earnedDate:"2024-01-20",category:"consistency"},{id:2,title:"Emergency Response Hero",description:"Responded to emergency calls within 5 minutes",icon:"\ud83d\udea8",earnedDate:"2024-01-18",category:"emergency"},{id:3,title:"Patient Favorite",description:"Received 5-star ratings from 10+ patients",icon:"\u2b50",earnedDate:"2024-01-15",category:"satisfaction"}],patientFeedback:[{id:1,patientName:"Adunni Okafor",rating:5,comment:"Excellent care and always on time. Very professional and caring.",date:"2024-01-20",category:"medication"},{id:2,patientName:"Grace Johnson",rating:5,comment:"The therapy sessions have been very helpful. Thank you for your patience.",date:"2024-01-19",category:"therapy"},{id:3,patientName:"Michael Adebayo",rating:4,comment:"Good care overall. Sometimes a bit rushed but very knowledgeable.",date:"2024-01-18",category:"general"}]}),v(!1)},1e3)}catch(e){console.error("Error loading performance data:",e),v(!1)}})()},[]);const w=(e,t)=>"rate"===t?e>=95?"text-green-600":e>=85?"text-yellow-600":"text-red-600":"text-gray-900",N=f[x]||{};f.trends;return y?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-green-600 flex items-center justify-center",children:(0,Kg.jsx)(wy,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Performance"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Track your care performance and achievements"})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsxs)("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:x,onChange:e=>_(e.target.value),children:[(0,Kg.jsx)("option",{value:"week",children:"This Week"}),(0,Kg.jsx)("option",{value:"monthly",children:"This Month"}),(0,Kg.jsx)("option",{value:"overall",children:"Overall"})]}),(0,Kg.jsxs)("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[(0,Kg.jsx)(Tv,{className:"h-5 w-5 mr-2"}),"Export Report"]})]})]})}),(0,Kg.jsxs)("div",{className:"w-full p-8 dashboard-full-width",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Overall Rating"}),(0,Kg.jsx)("p",{className:"text-3xl font-bold ".concat((S=(null===(e=f.overall)||void 0===e?void 0:e.rating)||0,S>=4.5?"text-green-600":S>=3.5?"text-yellow-600":"text-red-600")),children:(null===(s=f.overall)||void 0===s?void 0:s.rating)||0})]}),(0,Kg.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-xl flex items-center justify-center",children:(0,Kg.jsx)(Uy,{className:"h-6 w-6 text-green-600"})})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Based on patient feedback"})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Tasks Completed"}),(0,Kg.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:N.tasksCompleted||0})]}),(0,Kg.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-blue-600"})})]}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:[N.tasksOnTime||0," on time (",Math.round((N.tasksOnTime||0)/(N.tasksCompleted||1)*100),"%)"]})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Patients Served"}),(0,Kg.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:N.patientsServed||(null===(n=f.overall)||void 0===n?void 0:n.totalPatients)||0})]}),(0,Kg.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-xl flex items-center justify-center",children:(0,Kg.jsx)(xy,{className:"h-6 w-6 text-purple-600"})})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Active patients"})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Emergency Response"}),(0,Kg.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:[(null===(r=f.overall)||void 0===r?void 0:r.emergencyResponseTime)||0,"m"]})]}),(0,Kg.jsx)("div",{className:"h-12 w-12 bg-red-100 rounded-xl flex items-center justify-center",children:(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-600"})})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Average response time"})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,Kg.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key Performance Indicators"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"On-Time Rate"}),(0,Kg.jsxs)("span",{className:"text-lg font-semibold ".concat(w((null===(i=f.overall)||void 0===i?void 0:i.onTimeRate)||0,"rate")),children:[(null===(a=f.overall)||void 0===a?void 0:a.onTimeRate)||0,"%"]})]}),(0,Kg.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Kg.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat((null===(o=f.overall)||void 0===o?void 0:o.onTimeRate)||0,"%")}})})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Patient Satisfaction"}),(0,Kg.jsxs)("span",{className:"text-lg font-semibold ".concat(w((null===(c=f.overall)||void 0===c?void 0:c.patientSatisfaction)||0,"rate")),children:[(null===(l=f.overall)||void 0===l?void 0:l.patientSatisfaction)||0,"%"]})]}),(0,Kg.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Kg.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat((null===(d=f.overall)||void 0===d?void 0:d.patientSatisfaction)||0,"%")}})})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Hours Worked"}),(0,Kg.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:N.hoursWorked||0})]})}),(0,Kg.jsx)("div",{className:"space-y-4",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Emergency Responses"}),(0,Kg.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:N.emergencyResponses||0})]})})]})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Activity Breakdown"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-blue-600 mr-3"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Medication Administration"})]}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:N.medicationAdministrations||0})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(cy,{className:"h-5 w-5 text-green-600 mr-3"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Therapy Sessions"})]}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:N.therapySessions||0})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-5 w-5 text-purple-600 mr-3"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Patient Calls"})]}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:N.patientCalls||0})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-red-600 mr-3"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Emergency Responses"})]}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:N.emergencyResponses||0})]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Achievements"}),(0,Kg.jsx)("div",{className:"space-y-3",children:null===(u=f.achievements)||void 0===u?void 0:u.map(e=>(0,Kg.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("div",{className:"text-2xl",children:e.icon}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,Kg.jsx)("p",{className:"text-xs text-gray-600",children:e.description}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.earnedDate).toLocaleDateString()})]})]},e.id))})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Feedback"}),(0,Kg.jsx)("div",{className:"space-y-3",children:null===(h=f.patientFeedback)||void 0===h?void 0:h.map(e=>(0,Kg.jsxs)("div",{className:"border-b border-gray-100 pb-3 last:border-b-0",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Kg.jsx)("div",{className:"flex items-center",children:[...Array(5)].map((t,s)=>(0,Kg.jsx)(Uy,{className:"h-3 w-3 ".concat(s<e.rating?"text-yellow-400 fill-current":"text-gray-300")},s))})]}),(0,Kg.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:e.comment}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleDateString()})]},e.id))})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Goals"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-blue-900",children:"On-Time Rate"}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-blue-900",children:"95%"})]}),(0,Kg.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,Kg.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat((null===(p=f.overall)||void 0===p?void 0:p.onTimeRate)||0,"%")}})})]}),(0,Kg.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-green-900",children:"Patient Satisfaction"}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-green-900",children:"98%"})]}),(0,Kg.jsx)("div",{className:"w-full bg-green-200 rounded-full h-2",children:(0,Kg.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat((null===(m=f.overall)||void 0===m?void 0:m.patientSatisfaction)||0,"%")}})})]}),(0,Kg.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-purple-900",children:"Emergency Response"}),(0,Kg.jsx)("span",{className:"text-sm font-semibold text-purple-900",children:"<5 min"})]}),(0,Kg.jsx)("div",{className:"w-full bg-purple-200 rounded-full h-2",children:(0,Kg.jsx)("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:"85%"}})})]})]})]})]})]})]})]});var S},Av=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)(null),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",type:"medical",severity:"critical",description:"Patient experiencing chest pain and difficulty breathing",location:"123 Victoria Island, Lagos",coordinates:{lat:6.4281,lng:3.4219},reportedAt:"2024-01-21T14:30:00Z",status:"active",reportedBy:"Patient",contactNumber:"+234 801 234 5678",emergencyContacts:[{name:"Dr. Adebayo",number:"+234 805 123 4567",type:"doctor"},{name:"Family Contact",number:"+234 802 345 6789",type:"family"}],actions:[{timestamp:"2024-01-21T14:30:00Z",action:"Emergency reported",user:"System"},{timestamp:"2024-01-21T14:31:00Z",action:"Caregiver notified",user:"System"},{timestamp:"2024-01-21T14:32:00Z",action:"En route to patient",user:"You"}],notes:"Patient has diabetes and hypertension. Last medication taken at 9 AM."},{id:2,patientName:"Grace Johnson",patientId:"ELD002",type:"fall",severity:"high",description:"Patient fell in bathroom and cannot get up",location:"456 Ikoyi, Lagos",coordinates:{lat:6.4474,lng:3.4288},reportedAt:"2024-01-21T12:15:00Z",status:"resolved",reportedBy:"Caregiver",contactNumber:"+234 802 345 6789",emergencyContacts:[{name:"Dr. Johnson",number:"+234 806 234 5678",type:"doctor"},{name:"Son - David",number:"+234 803 456 7890",type:"family"}],actions:[{timestamp:"2024-01-21T12:15:00Z",action:"Fall reported",user:"Caregiver"},{timestamp:"2024-01-21T12:20:00Z",action:"Patient assessed",user:"You"},{timestamp:"2024-01-21T12:25:00Z",action:"Patient assisted to bed",user:"You"},{timestamp:"2024-01-21T12:30:00Z",action:"Doctor contacted",user:"You"},{timestamp:"2024-01-21T12:35:00Z",action:"Emergency resolved",user:"You"}],notes:"No serious injuries. Patient is comfortable and resting."},{id:3,patientName:"Michael Adebayo",patientId:"ELD003",type:"medication",severity:"medium",description:"Patient missed critical medication and showing symptoms",location:"789 Lekki, Lagos",coordinates:{lat:6.4698,lng:3.5852},reportedAt:"2024-01-21T10:45:00Z",status:"in-progress",reportedBy:"Family Member",contactNumber:"+234 803 456 7890",emergencyContacts:[{name:"Dr. Adebayo",number:"+234 807 345 6789",type:"doctor"},{name:"Wife - Mary",number:"+234 804 567 8901",type:"family"}],actions:[{timestamp:"2024-01-21T10:45:00Z",action:"Medication emergency reported",user:"Family"},{timestamp:"2024-01-21T10:50:00Z",action:"Caregiver dispatched",user:"System"},{timestamp:"2024-01-21T11:00:00Z",action:"Arrived at patient location",user:"You"},{timestamp:"2024-01-21T11:05:00Z",action:"Medication administered",user:"You"}],notes:"Patient feeling better after medication. Monitoring for any adverse effects."}];s(e),r(e[0]),a(!1)},1e3)}catch(e){console.error("Error loading emergencies:",e),a(!1)}})()},[]);const p=e.filter(e=>{const t=e.patientName.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase()),s="all"===l||e.status===l;return t&&s}),m=e=>{switch(e){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},f=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"resolved":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"medical":return(0,Kg.jsx)(cy,{className:"h-5 w-5 text-red-600"});case"fall":return(0,Kg.jsx)(gy,{className:"h-5 w-5 text-orange-600"});case"medication":return(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-blue-600"});case"fire":return(0,Kg.jsx)(Fy,{className:"h-5 w-5 text-red-600"});default:return(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-gray-600"})}},y=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),v=e=>new Date(e).toLocaleDateString(),x=(t,i)=>{const a={timestamp:(new Date).toISOString(),action:i,user:"You"};s(e.map(e=>e.id===t?Le(Le({},e),{},{actions:[...e.actions,a],status:i.includes("resolved")?"resolved":i.includes("responding")?"in-progress":e.status}):e)),(null===n||void 0===n?void 0:n.id)===t&&r(Le(Le({},n),{},{actions:[...n.actions,a],status:i.includes("resolved")?"resolved":i.includes("responding")?"in-progress":n.status}))};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-red-600 flex items-center justify-center",children:(0,Kg.jsx)(Zg,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Response"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage emergency situations and patient safety"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-4",children:(0,Kg.jsxs)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center",children:[(0,Kg.jsx)(qy,{className:"h-5 w-5 mr-2"}),"Report Emergency"]})})]})}),(0,Kg.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Kg.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col",children:[(0,Kg.jsxs)("div",{className:"p-4 border-b border-gray-200 space-y-3",children:[(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search emergencies...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:o,onChange:e=>c(e.target.value)})]}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"active",children:"Active"}),(0,Kg.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,Kg.jsx)("option",{value:"resolved",children:"Resolved"}),(0,Kg.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto",children:p.map(e=>(0,Kg.jsxs)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===n||void 0===n?void 0:n.id)===e.id?"bg-red-50 border-red-200":""),onClick:()=>r(e),children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[g(e.type),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-600",children:["ID: ",e.patientId]})]})]}),(0,Kg.jsxs)("div",{className:"flex flex-col items-end space-y-1",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ".concat(m(e.severity)),children:e.severity}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(f(e.status)),children:e.status})]})]}),(0,Kg.jsx)("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:e.description}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-3 w-3 mr-1"}),(0,Kg.jsx)("span",{children:y(e.reportedAt)})]}),(0,Kg.jsx)("span",{className:"font-medium",children:v(e.reportedAt)})]})]},e.id))})]}),(0,Kg.jsx)("div",{className:"flex-1 flex flex-col",children:n?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:g(n.type)}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:n.patientName}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",n.patientId," \u2022 ",n.type," emergency"]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat(m(n.severity)),children:n.severity}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(f(n.status)),children:n.status})]})]})}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,Kg.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Emergency Details"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Description"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:n.description})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Location"})]}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:n.location})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Reported At"})]}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-600",children:[y(n.reportedAt)," ",v(n.reportedAt)]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gy,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Reported By"})]}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:n.reportedBy})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Emergency Contacts"}),(0,Kg.jsx)("div",{className:"space-y-3",children:n.emergencyContacts.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("p",{className:"text-xs text-gray-600",children:e.type}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:e.number})]}),(0,Kg.jsx)("button",{onClick:()=>(e=>{console.log("Calling ".concat(e.name," at ").concat(e.number))})(e),className:"p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:(0,Kg.jsx)(Ay,{className:"h-4 w-4"})})]},t))})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Action Timeline"}),(0,Kg.jsx)("div",{className:"space-y-3",children:n.actions.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-2"}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.action}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-600",children:[y(e.timestamp)," \u2022 ",e.user]})]})]},t))})]}),n.notes&&(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Notes"}),(0,Kg.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:n.notes})})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"Quick Actions"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["active"===n.status&&(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsxs)("button",{onClick:()=>x(n.id,"Responding to emergency"),className:"p-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-medium",children:[(0,Kg.jsx)(_y,{className:"h-5 w-5 mx-auto mb-1"}),"Responding"]}),(0,Kg.jsxs)("button",{onClick:()=>x(n.id,"Emergency resolved"),className:"p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:[(0,Kg.jsx)(Ly,{className:"h-5 w-5 mx-auto mb-1"}),"Resolve"]})]}),(0,Kg.jsxs)("button",{className:"p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[(0,Kg.jsx)(dy,{className:"h-5 w-5 mx-auto mb-1"}),"Message"]}),(0,Kg.jsxs)("button",{className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:[(0,Kg.jsx)(jy,{className:"h-5 w-5 mx-auto mb-1"}),"Photo"]})]})]})]})})]}):(0,Kg.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(Zg,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select an emergency"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Choose an emergency from the list to view details and take action"})]})})})]}),u&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Kg.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Report Emergency"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Patient"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{children:"Adunni Okafor"}),(0,Kg.jsx)("option",{children:"Grace Johnson"}),(0,Kg.jsx)("option",{children:"Michael Adebayo"}),(0,Kg.jsx)("option",{children:"Sarah Williams"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Type"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"medical",children:"Medical"}),(0,Kg.jsx)("option",{value:"fall",children:"Fall"}),(0,Kg.jsx)("option",{value:"medication",children:"Medication"}),(0,Kg.jsx)("option",{value:"fire",children:"Fire"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"critical",children:"Critical"}),(0,Kg.jsx)("option",{value:"high",children:"High"}),(0,Kg.jsx)("option",{value:"medium",children:"Medium"}),(0,Kg.jsx)("option",{value:"low",children:"Low"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,Kg.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:"3",placeholder:"Describe the emergency situation..."})]})]}),(0,Kg.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,Kg.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),(0,Kg.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Report Emergency"})]})]})})]})},Ov=Qg("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),jv=Qg("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),kv=()=>{var e,s,n,r,i,a,o,c,l,d,u,h,p,m,f,g,y,v,x,_,E,b,w;const[N,S]=(0,t.useState)({}),[T,C]=(0,t.useState)(!0),[R,I]=(0,t.useState)("profile"),[A,O]=(0,t.useState)(!1),[j,k]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{S({profile:{firstName:"Sarah",lastName:"Johnson",email:"sarah.johnson@elderx.com",phone:"+234 805 123 4567",profileImage:null,dateOfBirth:"1985-03-15",address:"456 Victoria Island, Lagos",emergencyContact:"+234 802 345 6789",licenseNumber:"CAR123456",specialization:"Elderly Care",experience:"8 years",languages:["English","Yoruba","Hausa"],bio:"Dedicated caregiver with 8 years of experience in elderly care. Specialized in diabetes management and physical therapy assistance."},notifications:{emailNotifications:!0,smsNotifications:!0,pushNotifications:!0,taskReminders:!0,emergencyAlerts:!0,appointmentReminders:!0,medicationAlerts:!0,weeklyReports:!0,patientUpdates:!0,systemUpdates:!1},privacy:{profileVisibility:"private",locationSharing:!0,dataCollection:!0,analytics:!1,marketingEmails:!1,dataRetention:"2 years"},preferences:{theme:"light",language:"en",timezone:"Africa/Lagos",dateFormat:"DD/MM/YYYY",timeFormat:"24h",workingHours:{start:"08:00",end:"18:00"},breakDuration:30,maxPatientsPerDay:8},security:{twoFactorAuth:!1,biometricLogin:!0,sessionTimeout:30,passwordChangeRequired:!1,lastPasswordChange:"2024-01-01",loginNotifications:!0}}),C(!1)},1e3)}catch(e){console.error("Error loading settings:",e),C(!1)}})()},[]);const D=(e,t,s)=>{S(n=>Le(Le({},n),{},{[e]:Le(Le({},n[e]),{},{[t]:s})}))},P=[{id:"profile",name:"Profile",icon:gy},{id:"notifications",name:"Notifications",icon:fy},{id:"privacy",name:"Privacy",icon:Ry},{id:"preferences",name:"Preferences",icon:Cy},{id:"security",name:"Security",icon:Ry}];return T?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container",children:[(0,Kg.jsx)("div",{className:"w-full bg-white shadow-sm border-b border-gray-200 px-8 py-6",children:(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-600 flex items-center justify-center",children:(0,Kg.jsx)(Cy,{className:"h-8 w-8 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-4",children:(0,Kg.jsxs)("button",{onClick:()=>{console.log("Saving settings:",N)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Kg.jsx)(Ov,{className:"h-5 w-5 mr-2"}),"Save Changes"]})})]})}),(0,Kg.jsxs)("div",{className:"w-full h-full flex dashboard-full-width",children:[(0,Kg.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 flex flex-col",children:(0,Kg.jsx)("div",{className:"p-4",children:(0,Kg.jsx)("nav",{className:"space-y-1",children:P.map(e=>{const t=e.icon;return(0,Kg.jsxs)("button",{onClick:()=>I(e.id),className:"w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(R===e.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"h-5 w-5 mr-3"}),e.name]},e.id)})})})}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,Kg.jsxs)("div",{className:"p-8",children:["profile"===R&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Profile Information"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,Kg.jsx)("div",{className:"h-24 w-24 bg-gray-200 rounded-full flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-12 w-12 text-gray-400"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[(0,Kg.jsx)(jy,{className:"h-4 w-4 mr-2"}),"Change Photo"]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"JPG, PNG up to 2MB"})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),(0,Kg.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(e=N.profile)||void 0===e?void 0:e.firstName)||"",onChange:e=>D("profile","firstName",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),(0,Kg.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(s=N.profile)||void 0===s?void 0:s.lastName)||"",onChange:e=>D("profile","lastName",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,Kg.jsx)("input",{type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(n=N.profile)||void 0===n?void 0:n.email)||"",onChange:e=>D("profile","email",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),(0,Kg.jsx)("input",{type:"tel",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(r=N.profile)||void 0===r?void 0:r.phone)||"",onChange:e=>D("profile","phone",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth"}),(0,Kg.jsx)("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(i=N.profile)||void 0===i?void 0:i.dateOfBirth)||"",onChange:e=>D("profile","dateOfBirth",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Number"}),(0,Kg.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(a=N.profile)||void 0===a?void 0:a.licenseNumber)||"",onChange:e=>D("profile","licenseNumber",e.target.value)})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),(0,Kg.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",value:(null===(o=N.profile)||void 0===o?void 0:o.address)||"",onChange:e=>D("profile","address",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,Kg.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"4",value:(null===(c=N.profile)||void 0===c?void 0:c.bio)||"",onChange:e=>D("profile","bio",e.target.value)})]})]}),"notifications"===R&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Notification Preferences"}),(0,Kg.jsx)("div",{className:"space-y-4",children:Object.entries(N.notifications||{}).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900 capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600",children:["emailNotifications"===t&&"Receive notifications via email","smsNotifications"===t&&"Receive notifications via SMS","pushNotifications"===t&&"Receive push notifications","taskReminders"===t&&"Get reminded about upcoming tasks","emergencyAlerts"===t&&"Get immediate alerts for emergencies","appointmentReminders"===t&&"Get reminded about appointments","medicationAlerts"===t&&"Get alerts for medication schedules","weeklyReports"===t&&"Receive weekly performance reports","patientUpdates"===t&&"Get updates about patient status","systemUpdates"===t&&"Receive system maintenance notifications"]})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:e=>D("notifications",t,e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})})]}),"privacy"===R&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Privacy Settings"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profile Visibility"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(l=N.privacy)||void 0===l?void 0:l.profileVisibility)||"private",onChange:e=>D("privacy","profileVisibility",e.target.value),children:[(0,Kg.jsx)("option",{value:"public",children:"Public"}),(0,Kg.jsx)("option",{value:"private",children:"Private"}),(0,Kg.jsx)("option",{value:"contacts",children:"Contacts Only"})]})]}),(0,Kg.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Retention"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(d=N.privacy)||void 0===d?void 0:d.dataRetention)||"2 years",onChange:e=>D("privacy","dataRetention",e.target.value),children:[(0,Kg.jsx)("option",{value:"1 year",children:"1 Year"}),(0,Kg.jsx)("option",{value:"2 years",children:"2 Years"}),(0,Kg.jsx)("option",{value:"5 years",children:"5 Years"}),(0,Kg.jsx)("option",{value:"indefinite",children:"Indefinite"})]})]}),Object.entries(N.privacy||{}).filter(e=>{let[t]=e;return["locationSharing","dataCollection","analytics","marketingEmails"].includes(t)}).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900 capitalize",children:t.replace(/([A-Z])/g," $1").trim()}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600",children:["locationSharing"===t&&"Allow location sharing for emergency response","dataCollection"===t&&"Allow data collection for service improvement","analytics"===t&&"Allow analytics tracking","marketingEmails"===t&&"Receive marketing emails and promotions"]})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:e=>D("privacy",t,e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})]})]}),"preferences"===R&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Preferences"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Theme"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(u=N.preferences)||void 0===u?void 0:u.theme)||"light",onChange:e=>D("preferences","theme",e.target.value),children:[(0,Kg.jsx)("option",{value:"light",children:"Light"}),(0,Kg.jsx)("option",{value:"dark",children:"Dark"}),(0,Kg.jsx)("option",{value:"auto",children:"Auto"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Language"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(h=N.preferences)||void 0===h?void 0:h.language)||"en",onChange:e=>D("preferences","language",e.target.value),children:[(0,Kg.jsx)("option",{value:"en",children:"English"}),(0,Kg.jsx)("option",{value:"yo",children:"Yoruba"}),(0,Kg.jsx)("option",{value:"ha",children:"Hausa"}),(0,Kg.jsx)("option",{value:"ig",children:"Igbo"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(p=N.preferences)||void 0===p?void 0:p.timezone)||"Africa/Lagos",onChange:e=>D("preferences","timezone",e.target.value),children:[(0,Kg.jsx)("option",{value:"Africa/Lagos",children:"Africa/Lagos (GMT+1)"}),(0,Kg.jsx)("option",{value:"Africa/Abuja",children:"Africa/Abuja (GMT+1)"}),(0,Kg.jsx)("option",{value:"Africa/Kano",children:"Africa/Kano (GMT+1)"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Format"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(m=N.preferences)||void 0===m?void 0:m.dateFormat)||"DD/MM/YYYY",onChange:e=>D("preferences","dateFormat",e.target.value),children:[(0,Kg.jsx)("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),(0,Kg.jsx)("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),(0,Kg.jsx)("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Format"}),(0,Kg.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(f=N.preferences)||void 0===f?void 0:f.timeFormat)||"24h",onChange:e=>D("preferences","timeFormat",e.target.value),children:[(0,Kg.jsx)("option",{value:"24h",children:"24 Hour"}),(0,Kg.jsx)("option",{value:"12h",children:"12 Hour"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Patients Per Day"}),(0,Kg.jsx)("input",{type:"number",min:"1",max:"15",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(g=N.preferences)||void 0===g?void 0:g.maxPatientsPerDay)||8,onChange:e=>D("preferences","maxPatientsPerDay",parseInt(e.target.value))})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Working Hours Start"}),(0,Kg.jsx)("input",{type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(y=N.preferences)||void 0===y||null===(v=y.workingHours)||void 0===v?void 0:v.start)||"08:00",onChange:e=>{var t;return D("preferences","workingHours",Le(Le({},null===(t=N.preferences)||void 0===t?void 0:t.workingHours),{},{start:e.target.value}))}})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Working Hours End"}),(0,Kg.jsx)("input",{type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(x=N.preferences)||void 0===x||null===(_=x.workingHours)||void 0===_?void 0:_.end)||"18:00",onChange:e=>{var t;return D("preferences","workingHours",Le(Le({},null===(t=N.preferences)||void 0===t?void 0:t.workingHours),{},{end:e.target.value}))}})]})]})]}),"security"===R&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Security Settings"}),(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Change Password"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("input",{type:A?"text":"password",className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter current password"}),(0,Kg.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>O(!A),children:A?(0,Kg.jsx)(jv,{className:"h-4 w-4 text-gray-400"}):(0,Kg.jsx)(rv,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("input",{type:j?"text":"password",className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter new password"}),(0,Kg.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>k(!j),children:j?(0,Kg.jsx)(jv,{className:"h-4 w-4 text-gray-400"}):(0,Kg.jsx)(rv,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),(0,Kg.jsx)("input",{type:"password",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm new password"})]}),(0,Kg.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Change Password"})]})]}),(0,Kg.jsx)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Two-Factor Authentication"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Add an extra layer of security to your account"})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:(null===(E=N.security)||void 0===E?void 0:E.twoFactorAuth)||!1,onChange:e=>D("security","twoFactorAuth",e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),(0,Kg.jsx)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Biometric Login"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Use fingerprint or face recognition to log in"})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:(null===(b=N.security)||void 0===b?void 0:b.biometricLogin)||!0,onChange:e=>D("security","biometricLogin",e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),(0,Kg.jsxs)("div",{className:"p-6 bg-white border border-gray-200 rounded-lg",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Session Timeout"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Auto-logout after"}),(0,Kg.jsxs)("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:(null===(w=N.security)||void 0===w?void 0:w.sessionTimeout)||30,onChange:e=>D("security","sessionTimeout",parseInt(e.target.value)),children:[(0,Kg.jsx)("option",{value:"15",children:"15 minutes"}),(0,Kg.jsx)("option",{value:"30",children:"30 minutes"}),(0,Kg.jsx)("option",{value:"60",children:"1 hour"}),(0,Kg.jsx)("option",{value:"120",children:"2 hours"})]})]})]})]})]})]})})]})]})},Dv=Qg("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),Pv=Qg("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Lv=Qg("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Mv=Qg("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Uv=Qg("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]),Vv=Qg("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Fv=Qg("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);var Bv=s(1635),Gv=s.n(Bv);const Wv=new class{constructor(){this.client=null,this.localVideoTrack=null,this.localAudioTrack=null,this.remoteUsers=new Map,this.isJoined=!1,this.isPublished=!1,this.isInitialized=!1,this.eventListeners=new Map,this.config={appId:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_APP_ID||"43c43dc3e6a44a99b2b75a4997e3b1a4",channel:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_CHANNEL||"elderx_dev",token:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_AGORA_TOKEN||"007eJxTYAj736zimGlilN56YtmltxEzVy/6tjyKYx73BPWFcnNFEswVGEyMk02MU5KNU80STUwSLS2TjJLMTRNNLC3NU42TDBNNeP4ezmgIZGRIe8LJwAiFID4XQ2pOSmpRRXxKahkDAwDgxiEn",uid:null,mode:"rtc",codec:"vp8"}}async initialize(){try{if(this.isInitialized)return!0;if(!this.config.appId)throw new Error("Agora App ID is required");return this.client=Gv().createClient({mode:this.config.mode,codec:this.config.codec}),this.setupEventListeners(),this.isInitialized=!0,this.triggerEvent("initialized",{}),!0}catch(e){throw console.error("Failed to initialize Agora client:",e),this.triggerEvent("error",{type:"initialization",error:e.message}),e}}setupEventListeners(){this.client&&(this.client.on("user-published",async(e,t)=>{console.log("User published:",e,t);try{if(await this.client.subscribe(e,t),"video"===t&&this.remoteUsers.set(e.uid,Le(Le({},e),{},{videoTrack:e.videoTrack})),"audio"===t&&this.remoteUsers.set(e.uid,Le(Le({},e),{},{audioTrack:e.audioTrack})),"video"===t){const t=document.getElementById("remote-video-".concat(e.uid));t&&e.videoTrack.play(t)}"audio"===t&&e.audioTrack.play(),this.triggerEvent("user-published",{user:e,mediaType:t})}catch(s){console.error("Failed to subscribe user:",s)}}),this.client.on("user-unpublished",(e,t)=>{console.log("User unpublished:",e,t),"video"===t&&this.remoteUsers.delete(e.uid),this.triggerEvent("user-unpublished",{user:e,mediaType:t})}),this.client.on("user-left",e=>{console.log("User left:",e),this.remoteUsers.delete(e.uid),this.triggerEvent("user-left",{user:e})}),this.client.on("connection-state-change",(e,t)=>{console.log("Connection state changed:",e,t),this.triggerEvent("connection-state-change",{curState:e,revState:t})}))}async joinChannel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(this.isInitialized||await this.initialize(),this.isJoined)return console.warn("Already joined a channel"),this.config.uid;const s=t||this.config.channel,n=e||Math.floor(1e5*Math.random());if(this.config.uid=n,!s||""===s.trim())throw new Error("Channel name is required");return await this.client.join(this.config.appId,s,this.config.token,n),this.isJoined=!0,console.log("Successfully joined channel:",s),await this.createLocalTracks(),await this.publishLocalTracks(),this.triggerEvent("joined",{uid:n,channel:s}),n}catch(s){throw console.error("Failed to join channel:",s),this.triggerEvent("error",{type:"join",error:s.message}),s}}async createLocalTracks(){try{const e=await this.checkCameraPermission(),t=await this.checkMicrophonePermission();if(!e&&!t)throw new Error("Camera and microphone access are required for video calls");if(e&&(this.localVideoTrack=await Gv().createCameraVideoTrack({encoderConfig:"720p_1"})),t&&(this.localAudioTrack=await Gv().createMicrophoneAudioTrack()),this.localVideoTrack){const e=document.getElementById("local-video");e&&this.localVideoTrack.play(e)}console.log("Local tracks created successfully"),this.triggerEvent("tracks-created",{hasVideo:!!this.localVideoTrack,hasAudio:!!this.localAudioTrack})}catch(e){throw console.error("Failed to create local tracks:",e),this.triggerEvent("error",{type:"track-creation",error:e.message}),e}}async checkCameraPermission(){try{return(await Gv().getCameras()).length>0}catch(e){return console.warn("Camera permission check failed:",e),!1}}async checkMicrophonePermission(){try{return(await Gv().getMicrophones()).length>0}catch(e){return console.warn("Microphone permission check failed:",e),!1}}async publishLocalTracks(){try{if(!this.client)throw new Error("Client not initialized");const e=[];if(this.localVideoTrack&&e.push(this.localVideoTrack),this.localAudioTrack&&e.push(this.localAudioTrack),0===e.length)throw new Error("No tracks available to publish");await this.client.publish(e),this.isPublished=!0,console.log("Local tracks published successfully"),this.triggerEvent("published",{videoPublished:!!this.localVideoTrack,audioPublished:!!this.localAudioTrack})}catch(e){throw console.error("Failed to publish local tracks:",e),this.triggerEvent("error",{type:"publish",error:e.message}),e}}async leaveChannel(){try{this.client&&this.isJoined&&(this.isPublished&&await this.client.unpublish([this.localVideoTrack,this.localAudioTrack]),await this.client.leave(),this.isJoined=!1,this.isPublished=!1),this.localVideoTrack&&(this.localVideoTrack.stop(),this.localVideoTrack.close(),this.localVideoTrack=null),this.localAudioTrack&&(this.localAudioTrack.stop(),this.localAudioTrack.close(),this.localAudioTrack=null),this.remoteUsers.clear(),console.log("Successfully left channel"),this.triggerEvent("left",{})}catch(e){throw console.error("Failed to leave channel:",e),e}}async toggleVideo(){try{if(this.localVideoTrack)return await this.localVideoTrack.setEnabled(!this.localVideoTrack.enabled),this.triggerEvent("video-toggled",{enabled:this.localVideoTrack.enabled}),this.localVideoTrack.enabled}catch(e){throw console.error("Failed to toggle video:",e),e}}async toggleAudio(){try{if(this.localAudioTrack)return await this.localAudioTrack.setEnabled(!this.localAudioTrack.enabled),this.triggerEvent("audio-toggled",{enabled:this.localAudioTrack.enabled}),this.localAudioTrack.enabled}catch(e){throw console.error("Failed to toggle audio:",e),e}}getConnectionState(){return this.client?this.client.connectionState:"DISCONNECTED"}getRemoteUsers(){return Array.from(this.remoteUsers.values())}isVideoEnabled(){return!!this.localVideoTrack&&this.localVideoTrack.enabled}isAudioEnabled(){return!!this.localAudioTrack&&this.localAudioTrack.enabled}async getAvailableDevices(){try{const[e,t]=await Promise.all([Gv().getCameras(),Gv().getMicrophones()]);return{cameras:e.map(e=>({deviceId:e.deviceId,label:e.label||"Camera"})),microphones:t.map(e=>({deviceId:e.deviceId,label:e.label||"Microphone"}))}}catch(e){return console.error("Failed to get devices:",e),{cameras:[],microphones:[]}}}async switchCamera(e){try{if(!this.localVideoTrack)throw new Error("No video track available");await this.localVideoTrack.setDevice(e),this.triggerEvent("camera-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch camera:",t),this.triggerEvent("error",{type:"camera-switch",error:t.message}),t}}async switchMicrophone(e){try{if(!this.localAudioTrack)throw new Error("No audio track available");await this.localAudioTrack.setDevice(e),this.triggerEvent("microphone-switched",{deviceId:e})}catch(t){throw console.error("Failed to switch microphone:",t),this.triggerEvent("error",{type:"microphone-switch",error:t.message}),t}}async startRecording(){try{if(!this.client||!this.isJoined)throw new Error("Must be in a call to start recording");return this.triggerEvent("recording-started",{}),!0}catch(e){throw console.error("Failed to start recording:",e),this.triggerEvent("error",{type:"recording-start",error:e.message}),e}}async stopRecording(){try{return this.triggerEvent("recording-stopped",{}),!0}catch(e){throw console.error("Failed to stop recording:",e),this.triggerEvent("error",{type:"recording-stop",error:e.message}),e}}getRecordingStatus(){return{isRecording:!1,recordingId:null,startTime:null}}triggerEvent(e,t){const s=new CustomEvent("agora-".concat(e),{detail:t});window.dispatchEvent(s)}destroy(){this.leaveChannel(),this.client=null}},Hv=Wv,Kv="telemedicine_appointments",zv="telemedicine_calls",qv="telemedicine_recordings",Yv="doctors";const Xv=new class{async createAppointment(e){try{const t=Le(Le({},e),{},{createdAt:Zf(),updatedAt:Zf(),status:"scheduled"});return Le({id:(await Yf(Um(Lg,Kv),t)).id},t)}catch(t){throw console.error("Error creating appointment:",t),t}}async getAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const s="patient"===t?"patientId":"doctorId",n=Nf(Um(Lg,Kv),Tf(s,"==",e),If("appointmentDate","asc")),r=await Hf(n),i=[];return r.forEach(e=>{i.push(Le({id:e.id},e.data()))}),i}catch(s){throw console.error("Error getting appointments:",s),s}}async getUpcomingAppointments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const s=new Date,n="patient"===t?"patientId":"doctorId",r=Nf(Um(Lg,Kv),Tf(n,"==",e),Tf("appointmentDate",">=",Zo.fromDate(s)),Tf("status","==","scheduled"),If("appointmentDate","asc")),i=await Hf(r),a=[];return i.forEach(e=>{a.push(Le({id:e.id},e.data()))}),a}catch(s){throw console.error("Error getting upcoming appointments:",s),s}}async updateAppointmentStatus(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const n=Vm(Lg,Kv,e);return await zf(n,Le({status:t,updatedAt:Zf()},s)),!0}catch(n){throw console.error("Error updating appointment status:",n),n}}async startCall(e,t){try{const s=Le(Le({appointmentId:e},t),{},{startTime:Zf(),status:"active",createdAt:Zf()}),n=await Yf(Um(Lg,zv),s);return await this.updateAppointmentStatus(e,"in-progress",{callId:n.id}),Le({id:n.id},s)}catch(s){throw console.error("Error starting call:",s),s}}async endCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const s=Vm(Lg,zv,e);await zf(s,Le({endTime:Zf(),status:"completed",updatedAt:Zf()},t));const n=await Gf(s);if(n.exists()){const e=n.data();await this.updateAppointmentStatus(e.appointmentId,"completed")}return!0}catch(s){throw console.error("Error ending call:",s),s}}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"patient";try{const s="patient"===t?"patientId":"doctorId",n=Nf(Um(Lg,zv),Tf(s,"==",e),If("startTime","desc"),Of(50)),r=await Hf(n),i=[];return r.forEach(e=>{i.push(Le({id:e.id},e.data()))}),i}catch(s){throw console.error("Error getting call history:",s),s}}async saveRecording(e,t){try{const s=Le(Le({callId:e},t),{},{createdAt:Zf()}),n=await Yf(Um(Lg,qv),s),r=Vm(Lg,zv,e);return await zf(r,{recordingId:n.id,hasRecording:!0,updatedAt:Zf()}),Le({id:n.id},s)}catch(s){throw console.error("Error saving recording:",s),s}}async getCallRecordings(e){try{const t=Nf(Um(Lg,qv),Tf("callId","==",e)),s=await Hf(t),n=[];return s.forEach(e=>{n.push(Le({id:e.id},e.data()))}),n}catch(t){throw console.error("Error getting call recordings:",t),t}}async getAvailableDoctors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=Nf(Um(Lg,Yv),Tf("isActive","==",!0));e&&(t=Nf(t,Tf("specialty","==",e)));const s=await Hf(t),n=[];return s.forEach(e=>{n.push(Le({id:e.id},e.data()))}),n}catch(t){throw console.error("Error getting available doctors:",t),t}}async getDoctor(e){try{const t=Vm(Lg,Yv,e),s=await Gf(t);if(s.exists())return Le({id:s.id},s.data());throw new Error("Doctor not found")}catch(t){throw console.error("Error getting doctor:",t),t}}subscribeToAppointments(e,t,s){const n="patient"===t?"patientId":"doctorId";return Xf(Nf(Um(Lg,Kv),Tf(n,"==",e),If("appointmentDate","asc")),e=>{const t=[];e.forEach(e=>{t.push(Le({id:e.id},e.data()))}),s(t)})}subscribeToCalls(e,t,s){const n="patient"===t?"patientId":"doctorId";return Xf(Nf(Um(Lg,zv),Tf(n,"==",e),If("startTime","desc")),e=>{const t=[];e.forEach(e=>{t.push(Le({id:e.id},e.data()))}),s(t)})}convertTimestamp(e){return e&&e.toDate?e.toDate():e}formatAppointmentForDisplay(e){return Le(Le({},e),{},{appointmentDate:this.convertTimestamp(e.appointmentDate),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}formatCallForDisplay(e){return Le(Le({},e),{},{startTime:this.convertTimestamp(e.startTime),endTime:this.convertTimestamp(e.endTime),createdAt:this.convertTimestamp(e.createdAt),updatedAt:this.convertTimestamp(e.updatedAt)})}},Jv=Xv,Qv=()=>{const[e,s]=co(Pg),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)(!0),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)(0),[x,_]=(0,t.useState)([]),[E,b]=(0,t.useState)("disconnected"),[w,N]=(0,t.useState)(null),[S,T]=(0,t.useState)({cameras:[],microphones:[]}),[C,R]=(0,t.useState)(!1),[I,A]=(0,t.useState)("patient");(0,t.useEffect)(()=>(e&&!s&&(k(),j(),O()),()=>{f&&Hv.leaveChannel()}),[e,s]),(0,t.useEffect)(()=>{if(e){var t;const s=null!==(t=e.displayName)&&void 0!==t&&t.includes("Dr.")?"doctor":"patient";A(s)}},[e]);const O=async()=>{try{const e=await Hv.getAvailableDevices();T(e)}catch(w){console.error("Failed to load devices:",w)}},j=()=>{window.addEventListener("agora-user-published",e=>{const{user:t}=e.detail;_(e=>[...e,t]),yt.success("".concat(t.uid," joined the call"))}),window.addEventListener("agora-user-left",e=>{const{user:t}=e.detail;_(e=>e.filter(e=>e.uid!==t.uid)),yt.info("".concat(t.uid," left the call"))}),window.addEventListener("agora-connection-state-change",e=>{const{curState:t}=e.detail;b(t),console.log("Connection state:",t),"CONNECTED"===t?yt.success("Connected to call"):"DISCONNECTED"===t&&yt.warning("Connection lost")}),window.addEventListener("agora-error",e=>{const{type:t,error:s}=e.detail;switch(N(s),console.error("Agora error:",t,s),t){case"initialization":yt.error("Failed to initialize video calling");break;case"join":yt.error("Failed to join call");break;case"track-creation":yt.error("Failed to access camera/microphone");break;case"publish":yt.error("Failed to start video/audio");break;default:yt.error("Video call error occurred")}}),window.addEventListener("agora-tracks-created",e=>{const{hasVideo:t,hasAudio:s}=e.detail;c(t),d(s),t||s?t?s||yt.warning("Microphone access not available - video only"):yt.warning("Camera access not available - audio only"):yt.warning("No camera or microphone access available")}),window.addEventListener("agora-recording-started",e=>{h(!0),yt.success("Recording started")}),window.addEventListener("agora-recording-stopped",e=>{h(!1),yt.success("Recording stopped")})},k=async()=>{try{if(m(!0),N(null),!e)return void m(!1);const t=(await Jv.getAppointments(e.uid,I)).map(e=>Jv.formatAppointmentForDisplay(e));r(t),m(!1)}catch(w){console.error("Error loading telemedicine data:",w),N("Failed to load appointments. Please try again."),m(!1),D()}},D=()=>{const e=[{id:"mock-1",doctorName:"Dr. Kemi Adebayo",doctorSpecialty:"Cardiologist",doctorImage:null,patientName:"Adunni Okafor",patientAge:72,appointmentDate:new Date("2024-01-20T15:00:00Z"),duration:30,status:"scheduled",type:"video",notes:"Follow-up consultation for heart condition",symptoms:["Chest pain","Shortness of breath"],vitalSigns:{bloodPressure:"140/90",heartRate:85,temperature:98.6},prescription:null,recording:null},{id:"mock-2",doctorName:"Dr. Tunde Williams",doctorSpecialty:"General Practitioner",doctorImage:null,patientName:"Grace Johnson",patientAge:68,appointmentDate:new Date("2024-01-20T16:30:00Z"),duration:45,status:"completed",type:"video",notes:"Regular checkup and medication review",symptoms:["Fatigue","Joint pain"],vitalSigns:{bloodPressure:"130/80",heartRate:72,temperature:98.4},prescription:{medications:[{name:"Metformin",dosage:"500mg",frequency:"twice daily"},{name:"Ibuprofen",dosage:"200mg",frequency:"as needed"}]},recording:{url:"https://example.com/recording1.mp4",duration:"42 minutes",size:"1.2GB"}}];r(e),yt.warning("Using offline data. Some features may be limited.")},P=async()=>{try{const e=await Hv.toggleVideo();c(e),yt.info(e?"Video enabled":"Video disabled")}catch(w){console.error("Failed to toggle video:",w),yt.error("Failed to toggle video")}},L=async()=>{try{const e=await Hv.toggleAudio();d(e),yt.info(e?"Audio enabled":"Audio disabled")}catch(w){console.error("Failed to toggle audio:",w),yt.error("Failed to toggle audio")}},M=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in-progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},U=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return s?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e?p?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Telemedicine"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Virtual consultations and remote healthcare"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{onClick:async()=>{try{yt.info("Seeding sample data..."),await(async()=>{try{console.log("\ud83c\udf31 Seeding telemedicine data...");const e=[{id:"doctor-1",name:"Dr. Kemi Adebayo",specialty:"Cardiologist",email:"kemi.adebayo@elderx.ng",phone:"+234 801 234 5678",isActive:!0,rating:4.9,experience:"15 years",qualifications:["MBBS","MD Cardiology"],languages:["English","Yoruba"],consultationFee:15e3,availableSlots:["09:00","10:00","11:00","14:00","15:00"],createdAt:Zf()},{id:"doctor-2",name:"Dr. Tunde Williams",specialty:"General Practitioner",email:"tunde.williams@elderx.ng",phone:"+234 802 345 6789",isActive:!0,rating:4.8,experience:"12 years",qualifications:["MBBS","MD General Medicine"],languages:["English","Hausa"],consultationFee:1e4,availableSlots:["08:00","09:00","10:00","13:00","14:00"],createdAt:Zf()},{id:"doctor-3",name:"Dr. Sarah Okafor",specialty:"Dermatologist",email:"sarah.okafor@elderx.ng",phone:"+234 803 456 7890",isActive:!0,rating:4.7,experience:"10 years",qualifications:["MBBS","MD Dermatology"],languages:["English","Igbo"],consultationFee:12e3,availableSlots:["10:00","11:00","12:00","15:00","16:00"],createdAt:Zf()}],t=[{id:"patient-1",name:"Adunni Okafor",email:"adunni.okafor@email.com",phone:"+234 804 567 8901",age:72,gender:"Female",medicalConditions:["Hypertension","Diabetes Type 2"],allergies:["Penicillin"],emergencyContact:{name:"Kemi Okafor",phone:"+234 801 987 6543",relationship:"Daughter"},createdAt:Zf()},{id:"patient-2",name:"Grace Johnson",email:"grace.johnson@email.com",phone:"+234 805 678 9012",age:68,gender:"Female",medicalConditions:["Arthritis"],allergies:["None"],emergencyContact:{name:"John Johnson",phone:"+234 802 876 5432",relationship:"Son"},createdAt:Zf()},{id:"patient-3",name:"Tunde Adebayo",email:"tunde.adebayo@email.com",phone:"+234 806 789 0123",age:75,gender:"Male",medicalConditions:["High Blood Pressure"],allergies:["Shellfish"],emergencyContact:{name:"Funmi Adebayo",phone:"+234 803 765 4321",relationship:"Wife"},createdAt:Zf()}],s=[{patientId:"patient-1",doctorId:"doctor-1",appointmentDate:new Date("2024-01-20T15:00:00Z"),duration:30,type:"video",status:"scheduled",notes:"Follow-up consultation for heart condition",symptoms:["Chest pain","Shortness of breath"],vitalSigns:{bloodPressure:"140/90",heartRate:85,temperature:98.6},createdAt:Zf()},{patientId:"patient-2",doctorId:"doctor-2",appointmentDate:new Date("2024-01-20T16:30:00Z"),duration:45,type:"video",status:"completed",notes:"Regular checkup and medication review",symptoms:["Fatigue","Joint pain"],vitalSigns:{bloodPressure:"130/80",heartRate:72,temperature:98.4},prescription:{medications:[{name:"Metformin",dosage:"500mg",frequency:"twice daily"},{name:"Ibuprofen",dosage:"200mg",frequency:"as needed"}]},createdAt:Zf()},{patientId:"patient-3",doctorId:"doctor-3",appointmentDate:new Date("2024-01-21T10:00:00Z"),duration:20,type:"audio",status:"scheduled",notes:"Skin condition consultation",symptoms:["Rash on arms","Itching"],createdAt:Zf()}];console.log("Adding doctors...");for(const n of e)await Kf(Vm(Lg,"doctors",n.id),n),console.log("\u2705 Added doctor: ".concat(n.name));console.log("Adding patients...");for(const n of t)await Kf(Vm(Lg,"patients",n.id),n),console.log("\u2705 Added patient: ".concat(n.name));console.log("Adding appointments...");for(const n of s){const e=await Yf(Um(Lg,"telemedicine_appointments"),n);console.log("\u2705 Added appointment: ".concat(e.id))}return console.log("\ud83c\udf89 Telemedicine data seeded successfully!"),!0}catch(w){throw console.error("\u274c Error seeding telemedicine data:",w),w}})(),yt.success("Sample data seeded successfully!"),k()}catch(w){console.error("Failed to seed data:",w),yt.error("Failed to seed sample data")}},className:"btn btn-secondary",title:"Add sample data to Firebase",children:[(0,Kg.jsx)(Cv,{className:"h-4 w-4 mr-2"}),"Seed Data"]}),(0,Kg.jsxs)("button",{onClick:async()=>{try{yt.info("Running telemedicine tests...");const e=await(async()=>{const e={initialization:!1,deviceDetection:!1,permissions:!1,errors:[]};try{console.log("\ud83e\uddea Testing Telemedicine Service...");try{await Hv.initialize(),e.initialization=!0,console.log("\u2705 Service initialization: PASSED")}catch(w){e.errors.push("Initialization failed: ".concat(w.message)),console.error("\u274c Service initialization: FAILED",w)}try{const t=await Hv.getAvailableDevices();e.deviceDetection=t.cameras.length>0||t.microphones.length>0,console.log("\u2705 Device detection: PASSED",t)}catch(w){e.errors.push("Device detection failed: ".concat(w.message)),console.error("\u274c Device detection: FAILED",w)}try{const t=await Hv.checkCameraPermission(),s=await Hv.checkMicrophonePermission();e.permissions=t||s,console.log("\u2705 Permission checks: PASSED",{hasCamera:t,hasMicrophone:s})}catch(w){e.errors.push("Permission checks failed: ".concat(w.message)),console.error("\u274c Permission checks: FAILED",w)}return e.initialization&&e.deviceDetection&&e.permissions?console.log("\ud83c\udf89 All telemedicine tests PASSED!"):console.log("\u26a0\ufe0f Some telemedicine tests FAILED:",e.errors),e}catch(w){return console.error("\ud83d\udca5 Telemedicine test suite failed:",w),e.errors.push("Test suite failed: ".concat(w.message)),e}})();0===e.errors.length?yt.success("All telemedicine tests passed!"):(yt.warning("Some tests failed: ".concat(e.errors.length," errors")),console.log("Test results:",e))}catch(w){console.error("Test failed:",w),yt.error("Telemedicine test failed")}},className:"btn btn-secondary",title:"Test telemedicine functionality",children:[(0,Kg.jsx)(Ly,{className:"h-4 w-4 mr-2"}),"Test System"]}),(0,Kg.jsxs)("button",{onClick:O,className:"btn btn-secondary",title:"Refresh device list",children:[(0,Kg.jsx)(Cy,{className:"h-4 w-4 mr-2"}),"Refresh Devices"]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 mr-2"}),"Schedule Appointment"]}),(0,Kg.jsxs)("button",{onClick:async()=>{try{const t={patientId:"patient"===I?e.uid:"sample-patient-id",doctorId:"doctor"===I?e.uid:"sample-doctor-id",appointmentDate:new Date(Date.now()+864e5),duration:30,type:"video",notes:"New consultation appointment",status:"scheduled"};await Jv.createAppointment(t);yt.success("New appointment created successfully!"),k()}catch(w){console.error("Failed to create appointment:",w),yt.error("Failed to create appointment")}},className:"btn btn-primary",title:"Create new consultation appointment",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"New Consultation"]})]})]}),S.cameras.length>0||S.microphones.length>0?(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Available Devices"}),(0,Kg.jsxs)("span",{className:"text-xs text-gray-500",children:[S.cameras.length," camera(s), ",S.microphones.length," microphone(s)"]})]})}):(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-yellow-600 mr-2"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"No Devices Detected"}),(0,Kg.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"Please ensure your camera and microphone are connected and permissions are granted."})]})]})})}),(w||"disconnected"!==E)&&(0,Kg.jsxs)("div",{className:"card",children:[w&&(0,Kg.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Connection Error"}),(0,Kg.jsx)("p",{className:"text-sm text-red-700 mt-1",children:w})]})]})}),"disconnected"!==E&&(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat("CONNECTED"===E?"bg-green-500":"CONNECTING"===E?"bg-yellow-500":"bg-red-500")}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-600",children:["Status: ",E.toLowerCase()]})]}),C&&(0,Kg.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Initializing..."]})]})]}),i&&(0,Kg.jsxs)("div",{className:"card bg-gray-900 text-white",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-white font-medium",children:i.doctorName?i.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold",children:i.doctorName||"Doctor"}),(0,Kg.jsx)("p",{className:"text-gray-300",children:i.doctorSpecialty})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsxs)("span",{className:"text-sm text-gray-300",children:["Call Duration: ",(e=>{const t=Math.floor(e/60),s=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"))})(y)]}),u&&(0,Kg.jsxs)("div",{className:"flex items-center space-x-1 bg-red-600 px-2 py-1 rounded-full",children:[(0,Kg.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,Kg.jsx)("span",{className:"text-xs text-white",children:"REC"})]}),(0,Kg.jsx)("button",{onClick:async()=>{try{if(null!==i&&void 0!==i&&i.timer&&clearInterval(i.timer),await Hv.leaveChannel(),null!==i&&void 0!==i&&i.callId)try{const e={duration:y,endReason:"user_ended",hasRecording:u};await Jv.endCall(i.callId,e)}catch(e){console.warn("Failed to save call end to Firebase:",e)}a(null),g(!1),v(0),_([]),c(!0),d(!0),h(!1),yt.success("Call ended successfully!")}catch(w){console.error("Failed to end call:",w),yt.error("Failed to end call properly.")}},className:"p-2 bg-red-600 rounded-full hover:bg-red-700",title:"End call",children:(0,Kg.jsx)(Dv,{className:"h-5 w-5"})})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,Kg.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Kg.jsx)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:x.length>0?x.map((e,t)=>(0,Kg.jsx)("div",{id:"remote-video-".concat(e.uid),className:"w-full h-full"},e.uid)):(0,Kg.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(jy,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-gray-400",children:"Waiting for doctor to join..."})]})})}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-300",children:x.length>0?"".concat(x.length," participant(s)"):"No participants"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:P,className:"p-2 rounded-full ".concat(o?"bg-gray-700":"bg-red-600"),children:o?(0,Kg.jsx)(ly,{className:"h-4 w-4"}):(0,Kg.jsx)(Pv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:L,className:"p-2 rounded-full ".concat(l?"bg-gray-700":"bg-red-600"),children:l?(0,Kg.jsx)(Lv,{className:"h-4 w-4"}):(0,Kg.jsx)(Mv,{className:"h-4 w-4"})})]})]})]}),(0,Kg.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,Kg.jsxs)("div",{className:"aspect-video bg-gray-700 rounded-lg mb-4 relative overflow-hidden",children:[(0,Kg.jsx)("div",{id:"local-video",className:"w-full h-full"}),!o&&(0,Kg.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-600",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(Pv,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-gray-400",children:"Your video is off"})]})})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-300",children:"You"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:P,className:"p-2 rounded-full ".concat(o?"bg-gray-700":"bg-red-600"),children:o?(0,Kg.jsx)(ly,{className:"h-4 w-4"}):(0,Kg.jsx)(Pv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:L,className:"p-2 rounded-full ".concat(l?"bg-gray-700":"bg-red-600"),children:l?(0,Kg.jsx)(Lv,{className:"h-4 w-4"}):(0,Kg.jsx)(Mv,{className:"h-4 w-4"})})]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,Kg.jsx)("button",{onClick:P,className:"p-3 rounded-full transition-colors ".concat(o?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:o?"Turn off video":"Turn on video",children:o?(0,Kg.jsx)(ly,{className:"h-6 w-6"}):(0,Kg.jsx)(Pv,{className:"h-6 w-6"})}),(0,Kg.jsx)("button",{onClick:L,className:"p-3 rounded-full transition-colors ".concat(l?"bg-gray-700 hover:bg-gray-600":"bg-red-600 hover:bg-red-700"),title:l?"Mute microphone":"Unmute microphone",children:l?(0,Kg.jsx)(Lv,{className:"h-6 w-6"}):(0,Kg.jsx)(Mv,{className:"h-6 w-6"})}),(0,Kg.jsx)("button",{onClick:async()=>{try{if(u){if(await Hv.stopRecording(),h(!1),null!==i&&void 0!==i&&i.callId)try{const e={duration:y,status:"completed",recordingUrl:null,fileSize:null};await Jv.saveRecording(i.callId,e)}catch(e){console.warn("Failed to save recording data to Firebase:",e)}yt.success("Recording stopped")}else{if(await Hv.startRecording(),h(!0),null!==i&&void 0!==i&&i.callId)try{const e={status:"recording",startTime:new Date};await Jv.saveRecording(i.callId,e)}catch(e){console.warn("Failed to save recording start to Firebase:",e)}yt.success("Recording started")}}catch(w){console.error("Failed to toggle recording:",w),yt.error("Failed to toggle recording")}},className:"p-3 rounded-full transition-colors ".concat(u?"bg-red-600 hover:bg-red-700":"bg-gray-700 hover:bg-gray-600"),title:u?"Stop recording":"Start recording",children:u?(0,Kg.jsx)(Uv,{className:"h-6 w-6"}):(0,Kg.jsx)(Vv,{className:"h-6 w-6"})}),(0,Kg.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Share screen",children:(0,Kg.jsx)(Fv,{className:"h-6 w-6"})}),(0,Kg.jsx)("button",{className:"p-3 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors",title:"Settings",children:(0,Kg.jsx)(Cy,{className:"h-6 w-6"})})]}),(S.cameras.length>1||S.microphones.length>1)&&(0,Kg.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[S.cameras.length>1&&(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)(jy,{className:"h-4 w-4"}),(0,Kg.jsx)("select",{onChange:e=>(async e=>{try{await Hv.switchCamera(e),yt.success("Camera switched successfully")}catch(w){console.error("Failed to switch camera:",w),yt.error("Failed to switch camera")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:S.cameras.map(e=>(0,Kg.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]}),S.microphones.length>1&&(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)(Lv,{className:"h-4 w-4"}),(0,Kg.jsx)("select",{onChange:e=>(async e=>{try{await Hv.switchMicrophone(e),yt.success("Microphone switched successfully")}catch(w){console.error("Failed to switch microphone:",w),yt.error("Failed to switch microphone")}})(e.target.value),className:"bg-gray-800 text-white rounded px-2 py-1 text-xs",children:S.microphones.map(e=>(0,Kg.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId))})]})]})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Appointments"}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(uv,{className:"h-4 w-4 mr-2"}),"Search"]})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:n.filter(e=>"scheduled"===e.status).map(t=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-blue-600 font-medium",children:t.doctorName?t.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.doctorName||"Doctor"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:t.doctorSpecialty||"General Practice"}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(M(t.status)),children:t.status})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gy,{className:"h-4 w-4 mr-2"}),(0,Kg.jsxs)("span",{children:["Patient: ",t.patientName||"Patient"," (",t.patientAge||"N/A","y)"]})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 mr-2"}),(0,Kg.jsx)("span",{children:t.appointmentDate?U(t.appointmentDate).date:"TBD"})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 mr-2"}),(0,Kg.jsxs)("span",{children:[t.appointmentDate?U(t.appointmentDate).time:"TBD"," (",t.duration||30,"min)"]})]})]}),(0,Kg.jsxs)("div",{className:"mt-2",children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:t.notes}),t.symptoms&&(0,Kg.jsxs)("div",{className:"mt-2",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Symptoms: "}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:t.symptoms.join(", ")})]})]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>(async t=>{try{R(!0),N(null),a(t),g(!0),v(0);const n="appointment_".concat(t.id,"_").concat(Date.now()),r=await Hv.joinChannel(null,n);console.log("Joined call with UID:",r);let i=null;try{const s={appointmentId:t.id,patientId:"patient"===I?e.uid:t.patientId,doctorId:"doctor"===I?e.uid:t.doctorId,channelName:n,uid:r,callType:t.type||"video",status:"active"},o=await Jv.startCall(t.id,s);i=o.id,a(e=>Le(Le({},e),{},{callId:i}))}catch(s){console.warn("Failed to save call to Firebase:",s)}yt.success("Call started successfully!");const o=setInterval(()=>{v(e=>e+1)},1e3);a(e=>Le(Le({},e),{},{timer:o,channelName:n,uid:r,callId:i}))}catch(w){console.error("Failed to start call:",w),N(w.message),yt.error("Failed to start call: ".concat(w.message)),a(null),g(!1)}finally{R(!1)}})(t),disabled:C,className:"btn btn-primary ".concat(C?"opacity-50 cursor-not-allowed":""),children:C?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Starting..."]}):(0,Kg.jsxs)(Kg.Fragment,{children:["video"===t.type?(0,Kg.jsx)(ly,{className:"h-4 w-4 mr-2"}):(0,Kg.jsx)(Ay,{className:"h-4 w-4 mr-2"}),"Start Call"]})}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Ny,{className:"h-4 w-4 mr-2"}),"Chat"]})]})]})},t.id))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Consultations"}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"Filter"]})]}),(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.filter(e=>"completed"===e.status).map(e=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-blue-600 font-medium",children:e.doctorName?e.doctorName.split(" ").map(e=>e[0]).join(""):"DC"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.doctorName||"Doctor"}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.doctorSpecialty||"General Practice"})]})]})}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:e.patientName||"Patient"}),(0,Kg.jsxs)("div",{className:"text-sm text-gray-500",children:["Age: ",e.patientAge||"N/A"]})]}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:e.appointmentDate?U(e.appointmentDate).date:"TBD"}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.appointmentDate?U(e.appointmentDate).time:"TBD"})]}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:["video"===e.type?(0,Kg.jsx)(ly,{className:"h-4 w-4 text-blue-600 mr-1"}):(0,Kg.jsx)(Ay,{className:"h-4 w-4 text-green-600 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900 capitalize",children:e.type})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(M(e.status)),children:e.status})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Kg.jsx)(Ty,{className:"h-4 w-4"})}),e.recording&&(0,Kg.jsx)("button",{className:"text-green-600 hover:text-green-900",children:(0,Kg.jsx)(Tv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{className:"text-purple-600 hover:text-purple-900",children:(0,Kg.jsx)(mv,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]}):(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Required"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Please log in to access telemedicine features."})]})})},Zv=()=>{const[e,s]=(0,t.useState)(!1),n=ee(),r=Z(),i=[{name:"Dashboard",href:"/caregiver",icon:_y},{name:"Today's Schedule",href:"/caregiver/schedule",icon:oy},{name:"My Patients",href:"/caregiver/patients",icon:cy},{name:"Tasks",href:"/caregiver/tasks",icon:Ly},{name:"Messages",href:"/caregiver/messages",icon:Ny},{name:"Navigation",href:"/caregiver/navigation",icon:iv},{name:"Photo Updates",href:"/caregiver/photos",icon:jy},{name:"Performance",href:"/caregiver/performance",icon:wy},{name:"Emergency",href:"/caregiver/emergency",icon:Zg},{name:"Settings",href:"/caregiver/settings",icon:Cy}],a=e=>r.pathname===e;return(0,Kg.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,Kg.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden ".concat(e?"block":"hidden"),children:[(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>s(!1)}),(0,Kg.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,Kg.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,Kg.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>s(!1),children:(0,Kg.jsx)(hy,{className:"h-6 w-6 text-white"})})}),(0,Kg.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Kg.jsx)(cy,{className:"h-8 w-8 text-green-600"})}),(0,Kg.jsx)("div",{className:"ml-3",children:(0,Kg.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Kg.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:i.map(e=>{const t=e.icon;return(0,Kg.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-4 h-6 w-6 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]})]})]}),(0,Kg.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,Kg.jsx)("div",{className:"flex flex-col w-64",children:(0,Kg.jsxs)("div",{className:"flex flex-col h-0 flex-1 bg-white border-r border-gray-200",children:[(0,Kg.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,Kg.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Kg.jsx)(cy,{className:"h-8 w-8 text-green-600"})}),(0,Kg.jsx)("div",{className:"ml-3",children:(0,Kg.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"ElderX Caregiver"})})]})}),(0,Kg.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:i.map(e=>{const t=e.icon;return(0,Kg.jsxs)(Re,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(a(e.href)?"bg-green-100 text-green-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,Kg.jsx)(t,{className:"mr-3 h-5 w-5 ".concat(a(e.href)?"text-green-500":"text-gray-400 group-hover:text-gray-500")}),e.name]},e.name)})})]}),(0,Kg.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:(0,Kg.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-600"})})}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"}),(0,Kg.jsxs)("button",{onClick:async()=>{try{await Ri(Pg),yt.success("Signed out successfully"),n("/login")}catch(e){yt.error("Error signing out"),console.error("Sign out error:",e)}},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center",children:[(0,Kg.jsx)(py,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})})}),(0,Kg.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 dashboard-container",children:[(0,Kg.jsxs)("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white border-b border-gray-200",children:[(0,Kg.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500 lg:hidden",onClick:()=>s(!0),children:(0,Kg.jsx)(my,{className:"h-6 w-6"})}),(0,Kg.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,Kg.jsx)("div",{className:"flex-1 flex",children:(0,Kg.jsx)("div",{className:"w-full flex md:ml-0",children:(0,Kg.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,Kg.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:"Caregiver Portal"})})})})}),(0,Kg.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,Kg.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:(0,Kg.jsx)(fy,{className:"h-6 w-6"})}),(0,Kg.jsx)("div",{className:"ml-3 relative",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-600"})}),(0,Kg.jsx)("div",{className:"ml-3",children:(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Caregiver"})})]})})]})]})]}),(0,Kg.jsx)("main",{className:"flex-1 overflow-auto w-full dashboard-main",children:(0,Kg.jsx)(ge,{})})]})]})},$v=()=>{const[e,s]=(0,t.useState)(null),[n,r]=(0,t.useState)(""),[i,a]=(0,t.useState)(""),[o,c]=(0,t.useState)([{id:1,name:"Dr. Kemi Adebayo",role:"Cardiologist",avatar:null,lastMessage:"Your blood pressure readings look good. Keep monitoring daily.",timestamp:"2 hours ago",unreadCount:2,status:"online",messages:[{id:1,text:"Hello Mrs. Okafor, how are you feeling today?",sender:"doctor",timestamp:"10:30 AM",read:!0},{id:2,text:"I'm feeling much better, thank you doctor.",sender:"patient",timestamp:"10:32 AM",read:!0},{id:3,text:"Your blood pressure readings look good. Keep monitoring daily.",sender:"doctor",timestamp:"2 hours ago",read:!1}]},{id:2,name:"Nurse Fatima Abdullahi",role:"Caregiver",avatar:null,lastMessage:"I'll be there for your appointment at 2 PM.",timestamp:"1 day ago",unreadCount:0,status:"offline",messages:[{id:1,text:"Good morning! I'm on my way for your home visit.",sender:"caregiver",timestamp:"Yesterday 8:00 AM",read:!0},{id:2,text:"I'll be there for your appointment at 2 PM.",sender:"caregiver",timestamp:"1 day ago",read:!0}]},{id:3,name:"ElderX Support",role:"Support Team",avatar:null,lastMessage:"Your subscription will renew on January 15th.",timestamp:"3 days ago",unreadCount:1,status:"online",messages:[{id:1,text:"Welcome to ElderX! We're here to help with any questions.",sender:"support",timestamp:"3 days ago",read:!0},{id:2,text:"Your subscription will renew on January 15th.",sender:"support",timestamp:"3 days ago",read:!1}]}]),[l,d]=(0,t.useState)(o);(0,t.useEffect)(()=>{if(i){const e=o.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())||e.role.toLowerCase().includes(i.toLowerCase()));d(e)}else d(o)},[i,o]);const u=e=>"online"===e?"bg-green-500":"bg-gray-400",h=e=>"patient"===e.sender?e.read?(0,Kg.jsx)(fv,{className:"h-4 w-4 text-blue-500"}):(0,Kg.jsx)(gv,{className:"h-4 w-4 text-gray-400"}):null;return(0,Kg.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Kg.jsxs)("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[(0,Kg.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Kg.jsx)(dy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Messages"})]}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search conversations...",value:i,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto",children:l.map(t=>(0,Kg.jsx)("div",{onClick:()=>s(t),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ".concat((null===e||void 0===e?void 0:e.id)===t.id?"bg-blue-50 border-blue-200":""),children:(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ".concat(u(t.status))})]}),(0,Kg.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:t.name}),(0,Kg.jsx)("span",{className:"text-xs text-gray-500",children:t.timestamp})]}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:t.role}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-600 truncate",children:t.lastMessage}),t.unreadCount>0&&(0,Kg.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:t.unreadCount})]})]})]})},t.id))})]}),(0,Kg.jsx)("div",{className:"flex-1 flex flex-col",children:e?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-5 w-5 text-blue-600"})}),(0,Kg.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ".concat(u(e.status))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:e.role})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Kg.jsx)(Ay,{className:"h-5 w-5"})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Kg.jsx)(ly,{className:"h-5 w-5"})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Kg.jsx)(mv,{className:"h-5 w-5"})})]})]})}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:e.messages.map(e=>(0,Kg.jsx)("div",{className:"flex ".concat("patient"===e.sender?"justify-end":"justify-start"),children:(0,Kg.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("patient"===e.sender?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,Kg.jsx)("p",{className:"text-sm",children:e.text}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between mt-1 ".concat("patient"===e.sender?"text-blue-100":"text-gray-500"),children:[(0,Kg.jsx)("span",{className:"text-xs",children:e.timestamp}),h(e)]})]})},e.id))}),(0,Kg.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:(0,Kg.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),!n.trim()||!e)return;const s={id:Date.now(),text:n,sender:"patient",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),read:!1};c(t=>t.map(t=>t.id===e.id?Le(Le({},t),{},{messages:[...t.messages,s],lastMessage:n,timestamp:"Just now"}):t)),r("")},className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,Kg.jsx)(yv,{className:"h-5 w-5"})}),(0,Kg.jsxs)("div",{className:"flex-1 relative",children:[(0,Kg.jsx)("input",{type:"text",value:n,onChange:e=>r(e.target.value),placeholder:"Type a message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,Kg.jsx)("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(vv,{className:"h-5 w-5"})})]}),(0,Kg.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:(0,Kg.jsx)(xv,{className:"h-5 w-5"})})]})})]}):(0,Kg.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(dy,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,Kg.jsx)("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})},ex=Qg("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),tx=()=>{const[e,s]=(0,t.useState)("premium"),[n,r]=(0,t.useState)("monthly"),i={currentPlan:"Premium",status:"Active",nextBilling:"January 15, 2025",amount:"$49.99",cycle:"Monthly",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications"]},a=[{id:"basic",name:"Basic",price:{monthly:19.99,yearly:199.99},description:"Essential care services",features:["2 home visits per month","Basic health monitoring","Email support","Medication reminders","Emergency contact"],popular:!1,icon:cy},{id:"premium",name:"Premium",price:{monthly:49.99,yearly:499.99},description:"Comprehensive care package",features:["Unlimited home visits","24/7 emergency support","Telemedicine consultations","Medication management","Caregiver coordination","Health monitoring","Family notifications","Priority support"],popular:!0,icon:ex},{id:"elite",name:"Elite",price:{monthly:99.99,yearly:999.99},description:"Premium concierge service",features:["Everything in Premium","Dedicated care manager","Specialist consultations","Advanced health analytics","Custom care plans","White-glove service","Family dashboard","24/7 concierge support"],popular:!1,icon:Uy}],o=e=>{switch(e){case"Active":case"Paid":return"bg-green-100 text-green-800";case"Pending":return"bg-yellow-100 text-yellow-800";case"Failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,Kg.jsxs)("div",{className:"space-y-8",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Subscription"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage your ElderX subscription and billing"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Download Invoice"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Cy,{className:"h-4 w-4 mr-2"}),"Manage Billing"]})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-6",children:[(0,Kg.jsx)(uy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Current Subscription"})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,Kg.jsxs)("div",{className:"p-6 bg-blue-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Kg.jsx)(ex,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[i.currentPlan," Plan"]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(i.status)),children:i.status})]})]}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Amount:"}),(0,Kg.jsx)("span",{className:"font-semibold",children:i.amount})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Cycle:"}),(0,Kg.jsx)("span",{className:"font-semibold",children:i.cycle})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Next billing:"}),(0,Kg.jsx)("span",{className:"font-semibold",children:i.nextBilling})]})]})]}),(0,Kg.jsxs)("div",{className:"p-6 bg-green-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Kg.jsx)(_y,{className:"h-8 w-8 text-green-600 mr-3"}),(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Usage This Month"})]}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Home visits:"}),(0,Kg.jsx)("span",{className:"font-semibold",children:"8 / Unlimited"})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Telemedicine:"}),(0,Kg.jsx)("span",{className:"font-semibold",children:"3 / Unlimited"})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-gray-600",children:"Emergency calls:"}),(0,Kg.jsx)("span",{className:"font-semibold",children:"1 / Unlimited"})]})]})]}),(0,Kg.jsxs)("div",{className:"p-6 bg-purple-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center mb-4",children:[(0,Kg.jsx)(Ry,{className:"h-8 w-8 text-purple-600 mr-3"}),(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Benefits"})]}),(0,Kg.jsx)("div",{className:"space-y-1",children:i.features.slice(0,4).map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gv,{className:"h-4 w-4 text-green-500 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))})]})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Uy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Available Plans"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>r("monthly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("monthly"===n?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Monthly"}),(0,Kg.jsx)("button",{onClick:()=>r("yearly"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("yearly"===n?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Yearly (Save 17%)"})]})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.map(t=>{const r=t.icon,i=e===t.id,a="monthly"===n?t.price.monthly:t.price.yearly,o="yearly"===n?Math.round((12*t.price.monthly-t.price.yearly)/(12*t.price.monthly)*100):0;return(0,Kg.jsxs)("div",{className:"relative p-6 border-2 rounded-lg transition-all ".concat(t.popular?"border-blue-500 bg-blue-50":i?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),children:[t.popular&&(0,Kg.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Kg.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),i&&(0,Kg.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Kg.jsx)("span",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Current Plan"})}),(0,Kg.jsxs)("div",{className:"text-center mb-6",children:[(0,Kg.jsx)(r,{className:"h-12 w-12 mx-auto mb-4 ".concat(t.popular?"text-blue-600":i?"text-green-600":"text-gray-600")}),(0,Kg.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:t.name}),(0,Kg.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,Kg.jsxs)("div",{className:"mb-2",children:[(0,Kg.jsxs)("span",{className:"text-3xl font-bold text-gray-900",children:["$",a]}),(0,Kg.jsxs)("span",{className:"text-gray-600",children:["/","monthly"===n?"month":"year"]})]}),o>0&&(0,Kg.jsxs)("p",{className:"text-sm text-green-600 font-medium",children:["Save ",o,"% with yearly billing"]})]}),(0,Kg.jsx)("div",{className:"space-y-3 mb-6",children:t.features.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gv,{className:"h-4 w-4 text-green-500 mr-3 flex-shrink-0"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:e})]},t))}),(0,Kg.jsx)("button",{onClick:()=>{return e=t.id,void s(e);var e},className:"w-full py-3 px-4 rounded-lg font-semibold transition-colors ".concat(i?"bg-green-600 text-white hover:bg-green-700":t.popular?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),disabled:i,children:i?"Current Plan":"Choose Plan"})]},t.id)})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(uy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Payment Methods"})]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(uy,{className:"h-4 w-4 mr-2"}),"Add Payment Method"]})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:[{id:1,type:"Visa",last4:"4242",expiry:"12/26",isDefault:!0},{id:2,type:"Mastercard",last4:"5555",expiry:"08/25",isDefault:!1}].map(e=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"w-12 h-8 bg-blue-600 rounded flex items-center justify-center",children:(0,Kg.jsx)(uy,{className:"h-5 w-5 text-white"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.type," \u2022\u2022\u2022\u2022 ",e.last4]}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-500",children:["Expires ",e.expiry]})]}),e.isDefault&&(0,Kg.jsx)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"Default"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Edit"}),(0,Kg.jsx)("button",{className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]})]},e.id))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-6 w-6 text-gray-700 mr-3"}),(0,Kg.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Billing History"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Download All"]})]}),(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:[{id:1,date:"December 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:2,date:"November 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"},{id:3,date:"October 15, 2024",amount:"$49.99",status:"Paid",description:"Premium Plan - Monthly"}].map(e=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.description}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:e.amount}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(o(e.status)),children:e.status})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Kg.jsx)(Tv,{className:"h-4 w-4"})})})]},e.id))})]})})]})]})},sx=()=>{const e=[{icon:ey,title:"Home Visits",description:"Scheduled and on-demand home visits from qualified nurses and healthcare professionals.",bgColor:"bg-blue-100",iconColor:"text-blue-600"},{icon:cy,title:"Vitals Monitoring",description:"Regular monitoring of blood pressure, blood sugar, temperature, and other vital signs.",bgColor:"bg-green-100",iconColor:"text-green-600"},{icon:Zg,title:"Emergency Support",description:"24/7 emergency response with direct hospital and ambulance dispatch coordination.",bgColor:"bg-red-100",iconColor:"text-red-600"},{icon:ly,title:"Telemedicine",description:"Video consultations with doctors and specialists.",bgColor:"bg-purple-100",iconColor:"text-purple-600"},{icon:xy,title:"Family Integration",description:"Keep family members informed with real-time updates and notifications.",bgColor:"bg-orange-100",iconColor:"text-orange-600"},{icon:Ry,title:"Medication Management",description:"Medication reminders, administration assistance, and tracking.",bgColor:"bg-blue-100",iconColor:"text-blue-600"}];return(0,Kg.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Kg.jsxs)("div",{className:"text-center mb-16",children:[(0,Kg.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Comprehensive Healthcare Services"}),(0,Kg.jsx)("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Everything you need for quality elderly care, delivered by certified professionals."})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((e,t)=>{const s=e.icon;return(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[(0,Kg.jsx)("div",{className:"w-16 h-16 ".concat(e.bgColor," rounded-lg flex items-center justify-center mb-4"),children:(0,Kg.jsx)(s,{className:"h-8 w-8 ".concat(e.iconColor)})}),(0,Kg.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:e.title}),(0,Kg.jsx)("p",{className:"text-gray-600 leading-relaxed",children:e.description})]},t)})})]}),(0,Kg.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Kg.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Kg.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Kg.jsx)("span",{className:"font-bold",children:"MGX"})]})})]})},nx=()=>(0,Kg.jsxs)("div",{className:"min-h-screen bg-white py-16",children:[(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,Kg.jsxs)("div",{className:"text-center mb-16",children:[(0,Kg.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Affordable Care Plans"}),(0,Kg.jsx)("p",{className:"text-lg text-gray-600",children:"Flexible subscription options designed for Nigerian families."})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12",children:[{name:"Basic",price:"\u20a615,000",period:"per month",features:["2 home visits per month","Basic health monitoring","Emergency support"],buttonText:"Choose Basic",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"},{name:"Premium",price:"\u20a625,000",period:"per month",features:["4 home visits per month","Video consultations","Family notifications"],buttonText:"Choose Premium",buttonStyle:"bg-blue-600 text-white hover:bg-blue-700",popular:!0},{name:"Family",price:"\u20a640,000",period:"per month",features:["Unlimited home visits","24/7 emergency support","Specialist consultations"],buttonText:"Choose Family",buttonStyle:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}].map((e,t)=>(0,Kg.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 relative ".concat(e.popular?"border-2 border-blue-600":"border border-gray-200"),children:[e.popular&&(0,Kg.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,Kg.jsx)("div",{className:"bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),(0,Kg.jsxs)("div",{className:"text-center mb-6",children:[(0,Kg.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.name}),(0,Kg.jsxs)("div",{className:"mb-2",children:[(0,Kg.jsx)("span",{className:"text-4xl font-bold text-blue-600",children:e.price}),(0,Kg.jsx)("span",{className:"text-gray-500 ml-2",children:e.period})]})]}),(0,Kg.jsx)("ul",{className:"space-y-3 mb-8",children:e.features.map((e,t)=>(0,Kg.jsxs)("li",{className:"flex items-center",children:[(0,Kg.jsx)(gv,{className:"h-5 w-5 text-green-500 mr-3 flex-shrink-0"}),(0,Kg.jsx)("span",{className:"text-gray-700",children:e})]},t))}),(0,Kg.jsx)("button",{className:"w-full py-3 px-6 rounded-lg font-medium transition-colors ".concat(e.buttonStyle),children:e.buttonText})]},t))}),(0,Kg.jsx)("div",{className:"text-center",children:(0,Kg.jsx)("button",{className:"bg-gradient-to-r from-blue-600 to-green-600 text-white px-8 py-4 rounded-lg font-medium hover:from-blue-700 hover:to-green-700 transition-all",children:"View All Plans & Get Started"})})]}),(0,Kg.jsx)("div",{className:"fixed bottom-4 right-4",children:(0,Kg.jsxs)("div",{className:"bg-gray-800 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,Kg.jsx)("span",{className:"text-sm mr-2",children:"Made by"}),(0,Kg.jsx)("span",{className:"font-bold",children:"MGX"})]})})]}),rx=Qg("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),ix=()=>{const[e,s]=(0,t.useState)({totalUsers:0,elderlyUsers:0,caregivers:0,activeAppointments:0,emergencyAlerts:0,medicationReminders:0,systemHealth:"Good",revenue:0,satisfaction:0,responseTime:0,uptime:0}),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(new Date);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{s({totalUsers:1247,elderlyUsers:892,caregivers:355,activeAppointments:23,emergencyAlerts:2,medicationReminders:156,systemHealth:"Good",revenue:45680,satisfaction:94.5,responseTime:2.3,uptime:99.8}),r([{id:1,type:"emergency",message:"Emergency alert from Adunni Okafor",time:"2 minutes ago",status:"active"},{id:2,type:"appointment",message:"New appointment scheduled with Dr. Kemi",time:"15 minutes ago",status:"completed"},{id:3,type:"medication",message:"Medication reminder sent to 12 users",time:"1 hour ago",status:"completed"},{id:4,type:"user",message:"New caregiver registered: Tunde Adebayo",time:"2 hours ago",status:"completed"}]),a([{id:1,name:"Sarah Johnson",rating:4.9,patientsServed:12,tasksCompleted:145,responseTime:2.1,avatar:null},{id:2,name:"Michael Adebayo",rating:4.8,patientsServed:10,tasksCompleted:132,responseTime:2.3,avatar:null},{id:3,name:"Grace Okafor",rating:4.7,patientsServed:8,tasksCompleted:118,responseTime:2.5,avatar:null}]),c([{id:1,type:"warning",message:"High server load detected",time:"5 minutes ago",severity:"medium"},{id:2,type:"info",message:"Database backup completed",time:"1 hour ago",severity:"low"},{id:3,type:"success",message:"New caregiver verification completed",time:"2 hours ago",severity:"low"}]),h(new Date),d(!1)},1e3)}catch(e){console.error("Error loading dashboard data:",e),d(!1)}})()},[]);const p=e=>{switch(e){case"emergency":return(0,Kg.jsx)(Zg,{className:"h-4 w-4 text-red-500"});case"appointment":return(0,Kg.jsx)(oy,{className:"h-4 w-4 text-blue-500"});case"medication":return(0,Kg.jsx)(cy,{className:"h-4 w-4 text-green-500"});case"user":return(0,Kg.jsx)(by,{className:"h-4 w-4 text-purple-500"});default:return(0,Kg.jsx)(_y,{className:"h-4 w-4 text-gray-500"})}},m=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return l?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"w-full h-full bg-gray-50 dashboard-full-width dashboard-container space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Monitor and manage the ElderX platform"}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Last updated: ",u.toLocaleTimeString()]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsxs)("button",{onClick:()=>{d(!0),loadDashboardData()},disabled:l,className:"flex items-center px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:[(0,Kg.jsx)($g,{className:"h-4 w-4 mr-2 ".concat(l?"animate-spin":"")}),"Refresh"]}),(0,Kg.jsxs)("button",{className:"flex items-center px-3 py-2 text-sm bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"System Healthy"})]})]})]}),(0,Kg.jsxs)("div",{className:"w-full p-6 dashboard-full-width",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.totalUsers.toLocaleString()})]}),(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"h-6 w-6 text-blue-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-green-600",children:"+12% from last month"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Elderly Users"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.elderlyUsers.toLocaleString()})]}),(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(cy,{className:"h-6 w-6 text-green-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-green-600",children:"+8% from last month"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Caregivers"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.caregivers.toLocaleString()})]}),(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(by,{className:"h-6 w-6 text-purple-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-green-600",children:"+15% from last month"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Appointments"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.activeAppointments})]}),(0,Kg.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Kg.jsx)(oy,{className:"h-6 w-6 text-orange-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 text-blue-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-blue-600",children:"Today's schedule"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20a6",e.revenue.toLocaleString()]})]}),(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(rx,{className:"h-6 w-6 text-green-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-green-600",children:"+18% from last month"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Satisfaction Rate"}),(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.satisfaction,"%"]})]}),(0,Kg.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Kg.jsx)(cy,{className:"h-6 w-6 text-yellow-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-green-600",children:"+2.1% from last month"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Response Time"}),(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.responseTime,"s"]})]}),(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(Fy,{className:"h-6 w-6 text-blue-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(wy,{className:"h-4 w-4 text-red-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-red-600",children:"+0.2s from last week"})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"System Uptime"}),(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.uptime,"%"]})]}),(0,Kg.jsx)("div",{className:"p-3 bg-indigo-100 rounded-full",children:(0,Kg.jsx)(Ry,{className:"h-6 w-6 text-indigo-600"})})]}),(0,Kg.jsxs)("div",{className:"mt-4 flex items-center",children:[(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm text-green-600",children:"+0.1% from last month"})]})]})]}),e.emergencyAlerts>0&&(0,Kg.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Emergency Alerts"}),(0,Kg.jsxs)("p",{className:"text-red-600",children:[e.emergencyAlerts," active emergency alert",e.emergencyAlerts>1?"s":""," requiring immediate attention"]})]})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/emergency",className:"btn btn-red",children:[(0,Kg.jsx)(Zg,{className:"h-4 w-4 mr-2"}),"View Emergencies"]})]})}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"System Health"}),(0,Kg.jsx)(Ry,{className:"h-5 w-5 text-green-600"})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Database"}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Authentication"}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Notifications"}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Healthy"})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"API Response Time"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"45ms"})]})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),(0,Kg.jsx)(_y,{className:"h-5 w-5 text-gray-600"})]}),(0,Kg.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[p(e.type),(0,Kg.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:e.message}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.time}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(m(e.status)),children:e.status})]})]})]},e.id))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Caregivers"}),(0,Kg.jsx)(by,{className:"h-5 w-5 text-purple-600"})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:i.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center",children:(0,Kg.jsx)(by,{className:"h-5 w-5 text-purple-600"})})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-600",children:[e.patientsServed," patients"]})]})]}),(0,Kg.jsxs)("div",{className:"text-right",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.rating}),(0,Kg.jsx)("span",{className:"text-xs text-gray-500 ml-1",children:"\u2605"})]}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-600",children:[e.tasksCompleted," tasks"]})]})]},e.id))})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"System Alerts"}),(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-orange-600"})]}),(0,Kg.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,Kg.jsx)("div",{className:"p-3 rounded-lg border-l-4 ".concat("high"===e.severity?"bg-red-50 border-red-500":"medium"===e.severity?"bg-yellow-50 border-yellow-500":"bg-green-50 border-green-500"),children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:e.message}),(0,Kg.jsx)("span",{className:"text-xs text-gray-500",children:e.time})]})},e.id))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-8 gap-4",children:[(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/users",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(xy,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"Manage Users"})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/caregivers",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(by,{className:"h-5 w-5 text-indigo-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"Caregivers"})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/analytics",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(vy,{className:"h-5 w-5 text-orange-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"Analytics"})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/communication",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(Ny,{className:"h-5 w-5 text-teal-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"Messages"})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/audit-logs",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-gray-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"Audit Logs"})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/emergency",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-red-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"Emergency Center"})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/reports",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-green-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"View Reports"})]}),(0,Kg.jsxs)("button",{onClick:()=>window.location.href="/admin/settings",className:"flex items-center justify-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,Kg.jsx)(Ry,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium",children:"System Settings"})]})]})]})]})]})},ax=Qg("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ox=Qg("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),cx=Qg("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),lx=Qg("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),dx=[{name:"Adunni Okafor",email:"adunni@example.com",phone:"+234 801 987 6543",type:"elderly",status:"active",emergencyContact:"Dr. Kemi Okafor",medicalConditions:["Hypertension","Diabetes Type 2"],address:"Lagos, Nigeria",dateOfBirth:"1955-03-15",gender:"Female"},{name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",type:"caregiver",status:"active",certifications:["CPR Certified","First Aid"],experience:"5 years",address:"Abuja, Nigeria",dateOfBirth:"1985-07-22",gender:"Male"},{name:"Grace Johnson",email:"grace@example.com",phone:"+234 803 456 7890",type:"elderly",status:"inactive",emergencyContact:"Dr. Michael Johnson",medicalConditions:["Arthritis"],address:"Port Harcourt, Nigeria",dateOfBirth:"1950-11-08",gender:"Female"},{name:"Dr. Kemi Okafor",email:"kemi@example.com",phone:"+234 804 789 0123",type:"doctor",status:"active",specialization:"Geriatrics",licenseNumber:"MD12345",hospital:"Lagos University Teaching Hospital",address:"Lagos, Nigeria",dateOfBirth:"1975-05-12",gender:"Female"},{name:"Samuel Adekunle",email:"samuel@example.com",phone:"+234 805 234 5678",type:"caregiver",status:"active",certifications:["Nursing Assistant","Elderly Care Specialist"],experience:"8 years",address:"Ibadan, Nigeria",dateOfBirth:"1982-12-03",gender:"Male"},{name:"Maryam Ibrahim",email:"maryam@example.com",phone:"+234 806 345 6789",type:"elderly",status:"active",emergencyContact:"Dr. Ahmed Ibrahim",medicalConditions:["High Blood Pressure"],address:"Kano, Nigeria",dateOfBirth:"1958-09-18",gender:"Female"},{name:"Dr. John Okonkwo",email:"john@example.com",phone:"+234 807 456 7890",type:"doctor",status:"active",specialization:"Internal Medicine",licenseNumber:"MD67890",hospital:"National Hospital Abuja",address:"Abuja, Nigeria",dateOfBirth:"1970-02-25",gender:"Male"},{name:"Fatima Usman",email:"fatima@example.com",phone:"+234 808 567 8901",type:"caregiver",status:"suspended",certifications:["Home Health Aide"],experience:"3 years",address:"Kaduna, Nigeria",dateOfBirth:"1990-06-14",gender:"Female"}],ux=async()=>{try{console.log("Starting to seed users...");const e=Um(Lg,"users"),t=dx.map(async t=>{const s=Le(Le({},t),{},{createdAt:Zf(),updatedAt:Zf(),joinDate:Zf(),lastActive:Zf()}),n=await Yf(e,s);return console.log("User added with ID: ",n.id),n.id});return await Promise.all(t),console.log("Successfully seeded all users!"),!0}catch(e){throw console.error("Error seeding users:",e),e}},hx=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)("name"),[x,_]=(0,t.useState)("asc"),[E,b]=(0,t.useState)({total:0,elderly:0,caregivers:0,active:0,inactive:0});(0,t.useEffect)(()=>{(async()=>{try{a(!0);const e=await Fg();s(e),r(e);const t=await Hg();b(t),a(!1),yt.success("Users loaded successfully")}catch(e){console.error("Error loading users:",e),yt.error("Failed to load users"),a(!1)}})()},[]),(0,t.useEffect)(()=>{const e=Wg(e=>{s(e);let t=e;o&&(t=t.filter(e=>{var t,s,n;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(o.toLowerCase()))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(o.toLowerCase()))||(null===(n=e.phone)||void 0===n?void 0:n.includes(o))})),"all"!==l&&(t=t.filter(e=>e.type===l)),r(t)});return()=>e()},[o,l]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.phone.includes(o))),"all"!==l&&(t=t.filter(e=>e.type===l)),r(t)},[o,l,e]);const w=e=>{switch(e){case"elderly":return"bg-blue-100 text-blue-800";case"caregiver":return"bg-green-100 text-green-800";case"doctor":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},N=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";case"suspended":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},S=async(e,t)=>{h(t);try{switch(e){case"view":m(!0);break;case"edit":yt.info("Edit functionality coming soon");break;case"delete":window.confirm("Are you sure you want to delete ".concat(t.name,"?"))&&(await Bg(t.id),yt.success("User deleted successfully"));break;case"suspend":const e="active"===t.status?"suspended":"active";await Gg(t.id,e),yt.success("User ".concat("suspended"===e?"suspended":"activated"," successfully"))}}catch(s){console.error("Error performing ".concat(e," action:"),s),yt.error("Failed to ".concat(e," user"))}},T=async()=>{try{a(!0);const e=await Fg();s(e),r(e);const t=await Hg();b(t),yt.success("Users refreshed successfully")}catch(e){console.error("Error refreshing users:",e),yt.error("Failed to refresh users")}finally{a(!1)}};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,Kg.jsx)(ax,{className:"h-12 w-12 animate-spin text-blue-600"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Loading users..."})]})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage elderly users, caregivers, and doctors"})]}),(0,Kg.jsxs)("div",{className:"flex space-x-3",children:[(0,Kg.jsxs)("button",{onClick:async()=>{try{a(!0),await ux(),yt.success("Sample users added successfully"),await T()}catch(e){console.error("Error seeding data:",e),yt.error("Failed to seed data"),a(!1)}},className:"btn btn-outline",disabled:i,title:"Add sample users for testing",children:[(0,Kg.jsx)(ox,{className:"h-4 w-4 mr-2"}),"Seed Data"]}),(0,Kg.jsxs)("button",{onClick:T,className:"btn btn-secondary",disabled:i,children:[(0,Kg.jsx)($g,{className:"h-4 w-4 mr-2 ".concat(i?"animate-spin":"")}),"Refresh"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(ox,{className:"h-4 w-4 mr-2"}),"Add User"]})]})]}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search users by name, email, or phone...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Users"}),(0,Kg.jsx)("option",{value:"elderly",children:"Elderly"}),(0,Kg.jsx)("option",{value:"caregiver",children:"Caregivers"}),(0,Kg.jsx)("option",{value:"doctor",children:"Doctors"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Join Date"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(w(e.type)),children:e.type.charAt(0).toUpperCase()+e.type.slice(1)})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(N(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.joinDate?new Date(e.joinDate).toLocaleDateString():"N/A"}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.lastActive?new Date(e.lastActive).toLocaleDateString():"N/A"}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>S("view",e),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"View Details",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>S("edit",e),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50",title:"Edit User",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>S("suspend",e),className:"p-1 rounded ".concat("active"===e.status?"text-yellow-600 hover:text-yellow-900 hover:bg-yellow-50":"text-green-600 hover:text-green-900 hover:bg-green-50"),title:"active"===e.status?"Suspend User":"Activate User",children:"active"===e.status?(0,Kg.jsx)(cx,{className:"h-4 w-4"}):(0,Kg.jsx)(lx,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>S("delete",e),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Delete User",children:(0,Kg.jsx)(Jy,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===n.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(cx,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"Get started by adding a new user."})]})]}),p&&u&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"User Details"}),(0,Kg.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-lg font-medium text-gray-700",children:u.name.split(" ").map(e=>e[0]).join("")})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-xl font-semibold text-gray-900",children:u.name}),(0,Kg.jsxs)("div",{className:"flex space-x-2",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(w(u.type)),children:u.type.charAt(0).toUpperCase()+u.type.slice(1)}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(N(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,Kg.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Kg.jsx)(Gy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.email})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,Kg.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.phone})]})]})]}),"elderly"===u.type&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Contact"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.emergencyContact})]}),"elderly"===u.type&&u.medicalConditions&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medical Conditions"}),(0,Kg.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:u.medicalConditions.map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:e},t))})]}),"caregiver"===u.type&&u.certifications&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Certifications"}),(0,Kg.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:u.certifications.map((e,t)=>(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Kg.jsx)(lx,{className:"h-3 w-3 mr-1"}),e]},t))})]}),"doctor"===u.type&&(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Specialization"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.specialization})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"License Number"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.licenseNumber})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Join Date"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.joinDate?new Date(u.joinDate).toLocaleDateString():"N/A"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Active"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.lastActive?new Date(u.lastActive).toLocaleDateString():"N/A"})]})]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Xy,{className:"h-4 w-4 mr-2"}),"Edit User"]})]})]})})})]})},px=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)(!0),[i,a]=(0,t.useState)({startDate:"",endDate:""}),[o,c]=(0,t.useState)("all");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{s([{id:1,title:"User Activity Report",description:"Comprehensive overview of user engagement and activity patterns",type:"user_activity",generatedAt:"2024-01-20T10:30:00Z",period:"Last 30 days",records:1247,status:"ready"},{id:2,title:"Emergency Response Report",description:"Analysis of emergency alerts and response times",type:"emergency",generatedAt:"2024-01-19T15:45:00Z",period:"Last 7 days",records:23,status:"ready"},{id:3,title:"Medication Compliance Report",description:"Medication adherence and reminder effectiveness",type:"medication",generatedAt:"2024-01-18T09:15:00Z",period:"Last 14 days",records:892,status:"ready"},{id:4,title:"Caregiver Performance Report",description:"Caregiver activity and patient satisfaction metrics",type:"caregiver",generatedAt:"2024-01-17T14:20:00Z",period:"Last 30 days",records:355,status:"generating"},{id:5,title:"System Health Report",description:"Platform performance and system metrics",type:"system",generatedAt:"2024-01-16T11:00:00Z",period:"Last 24 hours",records:156,status:"ready"}]),r(!1)},1e3)}catch(e){console.error("Error loading reports:",e),r(!1)}})()},[]);const l=e=>{switch(e){case"user_activity":return(0,Kg.jsx)(xy,{className:"h-5 w-5 text-blue-600"});case"emergency":return(0,Kg.jsx)(_y,{className:"h-5 w-5 text-red-600"});case"medication":return(0,Kg.jsx)(cy,{className:"h-5 w-5 text-green-600"});case"caregiver":return(0,Kg.jsx)(xy,{className:"h-5 w-5 text-purple-600"});case"system":return(0,Kg.jsx)(vy,{className:"h-5 w-5 text-orange-600"});default:return(0,Kg.jsx)(Ty,{className:"h-5 w-5 text-gray-600"})}},d=e=>{switch(e){case"ready":return"bg-green-100 text-green-800";case"generating":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return n?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Reports & Analytics"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Generate and view platform reports"})]}),(0,Kg.jsxs)("button",{onClick:()=>{console.log("Generating report with:",{dateRange:i,reportType:o})},className:"btn btn-primary",children:[(0,Kg.jsx)(vy,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Generate New Report"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),(0,Kg.jsxs)("select",{className:"form-input",value:o,onChange:e=>c(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Reports"}),(0,Kg.jsx)("option",{value:"user_activity",children:"User Activity"}),(0,Kg.jsx)("option",{value:"emergency",children:"Emergency Response"}),(0,Kg.jsx)("option",{value:"medication",children:"Medication Compliance"}),(0,Kg.jsx)("option",{value:"caregiver",children:"Caregiver Performance"}),(0,Kg.jsx)("option",{value:"system",children:"System Health"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,Kg.jsx)("input",{type:"date",className:"form-input",value:i.startDate,onChange:e=>a(Le(Le({},i),{},{startDate:e.target.value}))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,Kg.jsx)("input",{type:"date",className:"form-input",value:i.endDate,onChange:e=>a(Le(Le({},i),{},{endDate:e.target.value}))})]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(Ty,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Reports"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(wy,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Ready Reports"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"ready"===e.status).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Kg.jsx)(oy,{className:"h-6 w-6 text-yellow-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Generating"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"generating"===e.status).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(vy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Records"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.reduce((e,t)=>e+t.records,0).toLocaleString()})]})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Reports"}),(0,Kg.jsx)("div",{className:"flex items-center space-x-2",children:(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:l(e.type)}),(0,Kg.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.title}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,Kg.jsxs)("span",{className:"text-sm text-gray-500",children:["Generated: ",new Date(e.generatedAt).toLocaleDateString()]}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-500",children:["Period: ",e.period]}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-500",children:["Records: ",e.records.toLocaleString()]})]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(d(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-1",children:["ready"===e.status&&(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Viewing report:",t);var t},className:"p-2 text-gray-400 hover:text-gray-600",title:"View Report",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,void console.log("Downloading report:",t);var t},className:"p-2 text-gray-400 hover:text-gray-600",title:"Download Report",children:(0,Kg.jsx)(Tv,{className:"h-4 w-4"})})]}),"generating"===e.status&&(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,Kg.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"Generating..."})]})]})]})]})},e.id))}),0===e.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(Ty,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No reports found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Generate your first report to get started."})]})]})]})},mx=Qg("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),fx=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientEmail:"adunni@example.com",patientPhone:"+234 801 987 6543",doctorName:"Dr. Kemi Okafor",type:"Regular Checkup",dateTime:"2024-01-22T10:00:00Z",location:"Lagos General Hospital",status:"scheduled",notes:"Follow-up for hypertension medication",duration:30},{id:2,patientName:"Grace Johnson",patientEmail:"grace@example.com",patientPhone:"+234 803 456 7890",doctorName:"Dr. Michael Johnson",type:"Emergency Consultation",dateTime:"2024-01-21T14:30:00Z",location:"Emergency Room",status:"completed",notes:"Emergency visit for chest pain",duration:45},{id:3,patientName:"Tunde Adebayo",patientEmail:"tunde@example.com",patientPhone:"+234 802 123 4567",doctorName:"Dr. Sarah Williams",type:"Medication Review",dateTime:"2024-01-23T09:15:00Z",location:"Cardiology Clinic",status:"scheduled",notes:"Review diabetes medication effectiveness",duration:20},{id:4,patientName:"Mary Okonkwo",patientEmail:"mary@example.com",patientPhone:"+234 805 234 5678",doctorName:"Dr. Kemi Okafor",type:"Physical Therapy",dateTime:"2024-01-20T11:00:00Z",location:"Physical Therapy Center",status:"cancelled",notes:"Patient cancelled due to illness",duration:60}];s(e),r(e),a(!1)},1e3)}catch(e){console.error("Error loading appointments:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.doctorName.toLowerCase().includes(o.toLowerCase())||e.type.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),r(t)},[o,l,e]);const f=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"rescheduled":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{switch(e){case"scheduled":return(0,Kg.jsx)(Dy,{className:"h-4 w-4"});case"completed":return(0,Kg.jsx)(Ly,{className:"h-4 w-4"});case"cancelled":return(0,Kg.jsx)(Yy,{className:"h-4 w-4"});case"rescheduled":return(0,Kg.jsx)(mx,{className:"h-4 w-4"});default:return(0,Kg.jsx)(oy,{className:"h-4 w-4"})}},y=(e,t)=>{if(h(t),"view"===e)m(!0)},v=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Appointment Management"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage patient appointments and schedules"})]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 mr-2"}),"Schedule Appointment"]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(oy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"completed"===e.status).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Kg.jsx)(Dy,{className:"h-6 w-6 text-yellow-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Scheduled"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"scheduled"===e.status).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Kg.jsx)(Yy,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Cancelled"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"cancelled"===e.status).length})]})]})})]}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search appointments by patient, doctor, or type...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,Kg.jsx)("option",{value:"completed",children:"Completed"}),(0,Kg.jsx)("option",{value:"cancelled",children:"Cancelled"}),(0,Kg.jsx)("option",{value:"rescheduled",children:"Rescheduled"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>{const{date:t,time:s}=v(e.dateTime);return(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(gy,{className:"h-5 w-5 text-gray-600"})})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.patientEmail})]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:e.doctorName})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:e.type})}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:t}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:s})]}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(e.status)),children:[g(e.status),(0,Kg.jsx)("span",{className:"ml-1",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>y("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>y("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Appointment",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),0===n.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(oy,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No appointments found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No appointments have been scheduled yet."})]})]}),p&&u&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Appointment Details"}),(0,Kg.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Name"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.patientName})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Doctor"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.doctorName})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Date & Time"}),(0,Kg.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:v(u.dateTime).date})]}),(0,Kg.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:v(u.dateTime).time})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Duration"}),(0,Kg.jsxs)("p",{className:"mt-1 text-sm text-gray-900",children:[u.duration," minutes"]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,Kg.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Contact"}),(0,Kg.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.patientPhone})]}),(0,Kg.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,Kg.jsx)(Gy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.patientEmail})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(f(u.status)),children:[g(u.status),(0,Kg.jsx)("span",{className:"ml-1",children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:u.notes})]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Xy,{className:"h-4 w-4 mr-2"}),"Edit Appointment"]})]})]})})})]})},gx=Qg("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),yx=()=>{const[e,s]=(0,t.useState)("general"),[n,r]=(0,t.useState)({general:{platformName:"ElderX",platformDescription:"Your trusted health companion for elderly care",supportEmail:"support@elderx.com",supportPhone:"+234 800 ELDERX",timezone:"Africa/Lagos",language:"en"},notifications:{emailNotifications:!0,smsNotifications:!0,pushNotifications:!0,emergencyAlerts:!0,appointmentReminders:!0,medicationReminders:!0,systemAlerts:!0},security:{twoFactorAuth:!0,sessionTimeout:30,passwordPolicy:"strong",loginAttempts:5,ipWhitelist:!1,auditLogging:!0},system:{maintenanceMode:!1,autoBackup:!0,backupFrequency:"daily",dataRetention:365,apiRateLimit:1e3,maxFileSize:10}}),[i,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(null),l=[{id:"general",name:"General",icon:Cy},{id:"notifications",name:"Notifications",icon:fy},{id:"security",name:"Security",icon:Ry},{id:"system",name:"System",icon:gx}],d=(e,t,s)=>{r(n=>Le(Le({},n),{},{[e]:Le(Le({},n[e]),{},{[t]:s})}))},u=()=>(0,Kg.jsx)("div",{className:"space-y-6",children:(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Platform Information"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Platform Name"}),(0,Kg.jsx)("input",{type:"text",className:"form-input",value:n.general.platformName,onChange:e=>d("general","platformName",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Support Email"}),(0,Kg.jsx)("input",{type:"email",className:"form-input",value:n.general.supportEmail,onChange:e=>d("general","supportEmail",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Support Phone"}),(0,Kg.jsx)("input",{type:"text",className:"form-input",value:n.general.supportPhone,onChange:e=>d("general","supportPhone",e.target.value)})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),(0,Kg.jsxs)("select",{className:"form-input",value:n.general.timezone,onChange:e=>d("general","timezone",e.target.value),children:[(0,Kg.jsx)("option",{value:"Africa/Lagos",children:"Africa/Lagos"}),(0,Kg.jsx)("option",{value:"Africa/Cairo",children:"Africa/Cairo"}),(0,Kg.jsx)("option",{value:"Africa/Johannesburg",children:"Africa/Johannesburg"}),(0,Kg.jsx)("option",{value:"UTC",children:"UTC"})]})]})]}),(0,Kg.jsxs)("div",{className:"mt-6",children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Platform Description"}),(0,Kg.jsx)("textarea",{className:"form-input",rows:3,value:n.general.platformDescription,onChange:e=>d("general","platformDescription",e.target.value)})]})]})}),h=e=>({emailNotifications:"Send notifications via email",smsNotifications:"Send notifications via SMS",pushNotifications:"Send push notifications to mobile apps",emergencyAlerts:"Immediate alerts for emergency situations",appointmentReminders:"Remind users about upcoming appointments",medicationReminders:"Remind users to take medications",systemAlerts:"Notify about system issues and updates"}[e]||"");return(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"System Settings"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Configure platform settings and preferences"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:["success"===o&&(0,Kg.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,Kg.jsx)(Ly,{className:"h-4 w-4 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm",children:"Saved successfully"})]}),"error"===o&&(0,Kg.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,Kg.jsx)(Zg,{className:"h-4 w-4 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm",children:"Save failed"})]}),(0,Kg.jsxs)("button",{onClick:async()=>{a(!0),c(null);try{await new Promise(e=>setTimeout(e,1e3)),c("success"),setTimeout(()=>c(null),3e3)}catch(e){c("error"),setTimeout(()=>c(null),3e3)}finally{a(!1)}},disabled:i,className:"btn btn-primary",children:[(0,Kg.jsx)(Ov,{className:"h-4 w-4 mr-2"}),i?"Saving...":"Save Changes"]})]})]}),(0,Kg.jsx)("div",{className:"border-b border-gray-200",children:(0,Kg.jsx)("nav",{className:"-mb-px flex space-x-8",children:l.map(t=>{const n=t.icon;return(0,Kg.jsxs)("button",{onClick:()=>s(t.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center ".concat(e===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(n,{className:"h-4 w-4 mr-2"}),t.name]},t.id)})})}),(0,Kg.jsx)("div",{className:"card",children:(()=>{switch(e){case"general":default:return u();case"notifications":return(0,Kg.jsx)("div",{className:"space-y-6",children:(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Notification Preferences"}),(0,Kg.jsx)("div",{className:"space-y-4",children:Object.entries(n.notifications).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:h(t)})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:e=>d("notifications",t,e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},t)})})]})});case"security":return(0,Kg.jsx)("div",{className:"space-y-6",children:(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Security Configuration"}),(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Two-Factor Authentication"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Require 2FA for admin accounts"})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n.security.twoFactorAuth,onChange:e=>d("security","twoFactorAuth",e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Timeout (minutes)"}),(0,Kg.jsx)("input",{type:"number",className:"form-input w-32",value:n.security.sessionTimeout,onChange:e=>d("security","sessionTimeout",parseInt(e.target.value))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password Policy"}),(0,Kg.jsxs)("select",{className:"form-input w-48",value:n.security.passwordPolicy,onChange:e=>d("security","passwordPolicy",e.target.value),children:[(0,Kg.jsx)("option",{value:"basic",children:"Basic (6+ characters)"}),(0,Kg.jsx)("option",{value:"medium",children:"Medium (8+ chars, mixed case)"}),(0,Kg.jsx)("option",{value:"strong",children:"Strong (8+ chars, mixed case, numbers, symbols)"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Login Attempts"}),(0,Kg.jsx)("input",{type:"number",className:"form-input w-32",value:n.security.loginAttempts,onChange:e=>d("security","loginAttempts",parseInt(e.target.value))})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Audit Logging"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Log all admin actions for security"})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n.security.auditLogging,onChange:e=>d("security","auditLogging",e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]})});case"system":return(0,Kg.jsx)("div",{className:"space-y-6",children:(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"System Configuration"}),(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Maintenance Mode"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Temporarily disable platform access"})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n.system.maintenanceMode,onChange:e=>d("system","maintenanceMode",e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Auto Backup"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"Automatically backup system data"})]}),(0,Kg.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Kg.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:n.system.autoBackup,onChange:e=>d("system","autoBackup",e.target.checked)}),(0,Kg.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Backup Frequency"}),(0,Kg.jsxs)("select",{className:"form-input w-48",value:n.system.backupFrequency,onChange:e=>d("system","backupFrequency",e.target.value),children:[(0,Kg.jsx)("option",{value:"hourly",children:"Hourly"}),(0,Kg.jsx)("option",{value:"daily",children:"Daily"}),(0,Kg.jsx)("option",{value:"weekly",children:"Weekly"}),(0,Kg.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Retention (days)"}),(0,Kg.jsx)("input",{type:"number",className:"form-input w-32",value:n.system.dataRetention,onChange:e=>d("system","dataRetention",parseInt(e.target.value))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Rate Limit (requests/hour)"}),(0,Kg.jsx)("input",{type:"number",className:"form-input w-32",value:n.system.apiRateLimit,onChange:e=>d("system","apiRateLimit",parseInt(e.target.value))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max File Size (MB)"}),(0,Kg.jsx)("input",{type:"number",className:"form-input w-32",value:n.system.maxFileSize,onChange:e=>d("system","maxFileSize",parseInt(e.target.value))})]})]})]})})}})()})]})},vx=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({active:0,resolved:0,averageResponseTime:0,totalToday:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",patientPhone:"+234 801 987 6543",patientEmail:"adunni@example.com",emergencyType:"Medical Emergency",severity:"Critical",description:"Chest pain and difficulty breathing",location:"Lagos, Nigeria",coordinates:{lat:6.5244,lng:3.3792},triggeredAt:"2024-01-20T14:30:00Z",status:"active",responseTime:0,assignedTo:"Dr. Kemi Okafor",assignedToPhone:"+234 802 123 4567",familyContact:"Tunde Adebayo",familyPhone:"+234 803 456 7890",medicalHistory:["Hypertension","Diabetes Type 2"],currentMedications:["Metformin","Lisinopril"],notes:"Patient reported severe chest pain. Emergency services contacted.",actions:[{id:1,action:"Emergency services contacted",timestamp:"2024-01-20T14:32:00Z",performedBy:"System",status:"completed"},{id:2,action:"Family notified",timestamp:"2024-01-20T14:35:00Z",performedBy:"Admin",status:"completed"}]},{id:2,patientName:"Grace Johnson",patientId:"ELD002",patientPhone:"+234 803 456 7890",patientEmail:"grace@example.com",emergencyType:"Fall Detection",severity:"High",description:"Patient fell and may be injured",location:"Abuja, Nigeria",coordinates:{lat:9.0765,lng:7.3986},triggeredAt:"2024-01-20T10:15:00Z",status:"resolved",responseTime:12,assignedTo:"Dr. Michael Johnson",assignedToPhone:"+234 804 567 8901",familyContact:"John Johnson",familyPhone:"+234 805 678 9012",medicalHistory:["Arthritis","Osteoporosis"],currentMedications:["Calcium","Vitamin D"],notes:"Patient fell in bathroom. Minor injuries reported. Family assisted.",actions:[{id:1,action:"Fall detected by sensor",timestamp:"2024-01-20T10:15:00Z",performedBy:"IoT Device",status:"completed"},{id:2,action:"Family contacted",timestamp:"2024-01-20T10:18:00Z",performedBy:"System",status:"completed"},{id:3,action:"Emergency resolved",timestamp:"2024-01-20T10:27:00Z",performedBy:"Dr. Michael Johnson",status:"completed"}]},{id:3,patientName:"Tunde Adebayo",patientId:"ELD003",patientPhone:"+234 802 123 4567",patientEmail:"tunde@example.com",emergencyType:"Medication Overdose",severity:"Critical",description:"Patient may have taken double dose of medication",location:"Ibadan, Nigeria",coordinates:{lat:7.3775,lng:3.947},triggeredAt:"2024-01-20T08:45:00Z",status:"active",responseTime:0,assignedTo:"Dr. Sarah Williams",assignedToPhone:"+234 806 789 0123",familyContact:"Adebayo Family",familyPhone:"+234 807 890 1234",medicalHistory:["Diabetes Type 2","Heart Disease"],currentMedications:["Insulin","Metformin","Aspirin"],notes:"Patient accidentally took double dose of insulin. Monitoring blood sugar levels.",actions:[{id:1,action:"Overdose alert triggered",timestamp:"2024-01-20T08:45:00Z",performedBy:"Medication Tracker",status:"completed"},{id:2,action:"Emergency services contacted",timestamp:"2024-01-20T08:47:00Z",performedBy:"System",status:"completed"}]}],t=e.filter(e=>"active"===e.status).length,n=e.filter(e=>"resolved"===e.status).length,i=e.length,o=e.filter(e=>e.responseTime>0).reduce((e,t)=>e+t.responseTime,0)/n||0;g({active:t,resolved:n,averageResponseTime:Math.round(o),totalToday:i}),s(e),r(e),a(!1)},1e3)}catch(e){console.error("Error loading emergency data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.emergencyType.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),r(t)},[o,l,e]);const y=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800 border-red-200";case"High":return"bg-orange-100 text-orange-800 border-orange-200";case"Medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},v=e=>{switch(e){case"active":return"bg-red-100 text-red-800";case"resolved":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},x=e=>{switch(e){case"active":return(0,Kg.jsx)(Zg,{className:"h-4 w-4"});case"resolved":return(0,Kg.jsx)(Ly,{className:"h-4 w-4"});case"in_progress":return(0,Kg.jsx)(_y,{className:"h-4 w-4"});default:return(0,Kg.jsx)(Dy,{className:"h-4 w-4"})}},_=(e,t)=>{if(h(t),"view"===e)m(!0)},E=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},b=e=>{const t=new Date,s=new Date(e),n=Math.floor((t-s)/6e4);return n<1?"Just now":n<60?"".concat(n,"m ago"):n<1440?"".concat(Math.floor(n/60),"h ago"):"".concat(Math.floor(n/1440),"d ago")};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Management"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Monitor and manage emergency alerts in real-time"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)($g,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(fy,{className:"h-4 w-4 mr-2"}),"Test Alert"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card border-l-4 border-red-500",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Emergencies"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-red-600",children:f.active})]})]})}),(0,Kg.jsx)("div",{className:"card border-l-4 border-green-500",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Resolved Today"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-green-600",children:f.resolved})]})]})}),(0,Kg.jsx)("div",{className:"card border-l-4 border-blue-500",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(Dy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Response Time"}),(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[f.averageResponseTime,"m"]})]})]})}),(0,Kg.jsx)("div",{className:"card border-l-4 border-purple-500",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(wy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Today"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:f.totalToday})]})]})})]}),f.active>0&&(0,Kg.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Active Emergency Alert"}),(0,Kg.jsxs)("p",{className:"text-red-600",children:[f.active," emergency",f.active>1?"ies":""," requiring immediate attention"]})]})]}),(0,Kg.jsxs)("button",{className:"btn btn-red",children:[(0,Kg.jsx)(rv,{className:"h-4 w-4 mr-2"}),"View Active"]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search emergencies by patient, type, or description...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"active",children:"Active"}),(0,Kg.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,Kg.jsx)("option",{value:"resolved",children:"Resolved"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Emergency Alerts"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:"Auto-refresh: ON"}),(0,Kg.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]})]}),(0,Kg.jsx)("div",{className:"space-y-4",children:n.map(e=>{const{date:t,time:s}=E(e.triggeredAt);return(0,Kg.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 ".concat("active"===e.status?"border-red-200 bg-red-50":"border-gray-200"),children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:"active"===e.status?(0,Kg.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}):(0,Kg.jsx)("div",{className:"w-3 h-3 bg-gray-300 rounded-full"})}),(0,Kg.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.patientName}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(y(e.severity)),children:e.severity}),(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(v(e.status)),children:[x(e.status),(0,Kg.jsx)("span",{className:"ml-1",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 mr-1"}),e.location]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 mr-1"}),b(e.triggeredAt)]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gy,{className:"h-4 w-4 mr-1"}),e.assignedTo]})]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>_("view",e),className:"p-2 text-gray-400 hover:text-gray-600",title:"View Details",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),"active"===e.status&&(0,Kg.jsx)("button",{onClick:()=>_("resolve",e),className:"p-2 text-green-600 hover:text-green-800",title:"Mark as Resolved",children:(0,Kg.jsx)(Ly,{className:"h-4 w-4"})})]})]})},e.id)})}),0===n.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(Ry,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No emergencies found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No emergency alerts at this time."})]})]}),p&&u&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-500"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Emergency Details"}),(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(v(u.status)),children:[x(u.status),(0,Kg.jsx)("span",{className:"ml-1",children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]}),(0,Kg.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Patient Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient Name"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.patientName})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.patientPhone})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Gy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.patientEmail})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Medical Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medical History"}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.medicalHistory.map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:e},t))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Current Medications"}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.currentMedications.map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Emergency Details"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Emergency Type"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.emergencyType})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Severity"}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(y(u.severity)),children:u.severity})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.description})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Triggered At"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:[E(u.triggeredAt).date," at ",E(u.triggeredAt).time]})]})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Assigned Personnel"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Assigned Doctor"}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.assignedTo}),(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(Ay,{className:"h-4 w-4"})})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Family Contact"}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.familyContact}),(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(Ay,{className:"h-4 w-4"})})]})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Response Actions"}),(0,Kg.jsx)("div",{className:"space-y-2",children:u.actions.map(e=>(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded",children:[(0,Kg.jsx)(Ly,{className:"h-4 w-4 text-green-500"}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:e.action}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500",children:[E(e.timestamp).date," at ",E(e.timestamp).time," by ",e.performedBy]})]})]},e.id))})]})]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),"active"===u.status&&(0,Kg.jsxs)("button",{className:"btn btn-green",children:[(0,Kg.jsx)(Ly,{className:"h-4 w-4 mr-2"}),"Mark as Resolved"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Ny,{className:"h-4 w-4 mr-2"}),"Add Note"]})]})]})})})]})},xx=Qg("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),_x=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Cardiac Emergency Response",category:"Medical Emergency",severity:"Critical",description:"Standard protocol for handling cardiac emergencies including heart attacks and cardiac arrest",triggerConditions:["Chest pain reported","Heart rate irregular","Cardiac arrest detected","ECG abnormalities"],steps:[{id:1,step:"Immediate Assessment",description:"Assess patient consciousness and vital signs",duration:"2 minutes",responsible:"Emergency Response Team",priority:"Critical"},{id:2,step:"Call Emergency Services",description:"Contact local emergency services (911/999)",duration:"1 minute",responsible:"System/Admin",priority:"Critical"},{id:3,step:"Notify Family",description:"Contact emergency family contacts",duration:"2 minutes",responsible:"Admin",priority:"High"},{id:4,step:"CPR if Needed",description:"Begin CPR if patient is unresponsive",duration:"Ongoing",responsible:"Trained Personnel",priority:"Critical"},{id:5,step:"Medical History Review",description:"Review patient medical history and medications",duration:"3 minutes",responsible:"Medical Team",priority:"Medium"}],escalationRules:[{condition:"No response in 5 minutes",action:"Escalate to senior medical staff",contact:"Dr. Sarah Williams (+234 802 123 4567)"},{condition:"Patient condition worsens",action:"Contact emergency services again",contact:"Emergency Services (911)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Medical Director",name:"Dr. Sarah Williams",phone:"+234 802 123 4567",priority:"High"},{type:"Family Contact",name:"Emergency Family Contact",phone:"Patient-specific",priority:"High"}],isActive:!0,createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-01-20T14:30:00Z",createdBy:"Dr. Sarah Williams"},{id:2,name:"Fall Detection Response",category:"Fall Detection",severity:"High",description:"Protocol for responding to fall detection alerts from IoT devices",triggerConditions:["Fall detected by sensor","Patient reports fall","Caregiver reports fall","Motion sensor alerts"],steps:[{id:1,step:"Immediate Check",description:"Contact patient immediately via phone or app",duration:"1 minute",responsible:"System/Admin",priority:"High"},{id:2,step:"Assess Injury",description:"Determine if patient is injured and needs medical attention",duration:"3 minutes",responsible:"Medical Team",priority:"High"},{id:3,step:"Notify Family",description:"Contact family members about the fall",duration:"2 minutes",responsible:"Admin",priority:"Medium"},{id:4,step:"Arrange Care",description:"Arrange for caregiver or medical assistance if needed",duration:"5 minutes",responsible:"Care Team",priority:"Medium"}],escalationRules:[{condition:"Patient unresponsive",action:"Treat as medical emergency",contact:"Emergency Services (199)"},{condition:"Injury suspected",action:"Arrange immediate medical assessment",contact:"Dr. Michael Johnson (+234 803 456 7890)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Orthopedic Specialist",name:"Dr. Michael Johnson",phone:"+234 803 456 7890",priority:"High"}],isActive:!0,createdAt:"2024-01-10T09:00:00Z",updatedAt:"2024-01-18T16:45:00Z",createdBy:"Dr. Michael Johnson"},{id:3,name:"Medication Overdose Response",category:"Medication Emergency",severity:"Critical",description:"Protocol for handling medication overdoses and adverse reactions",triggerConditions:["Double dose detected","Wrong medication taken","Adverse reaction reported","Medication interaction alert"],steps:[{id:1,step:"Immediate Assessment",description:"Assess patient condition and vital signs",duration:"2 minutes",responsible:"Medical Team",priority:"Critical"},{id:2,step:"Identify Medication",description:"Determine which medication and dosage was taken",duration:"3 minutes",responsible:"Medical Team",priority:"Critical"},{id:3,step:"Contact Poison Control",description:"Contact poison control center for guidance",duration:"2 minutes",responsible:"Medical Team",priority:"Critical"},{id:4,step:"Emergency Services",description:"Call emergency services if needed",duration:"1 minute",responsible:"System/Admin",priority:"Critical"},{id:5,step:"Monitor Patient",description:"Continuous monitoring of patient condition",duration:"Ongoing",responsible:"Medical Team",priority:"High"}],escalationRules:[{condition:"Severe symptoms",action:"Immediate emergency services",contact:"Emergency Services (199)"},{condition:"Unknown medication",action:"Contact poison control immediately",contact:"Poison Control (+234 800 123 4567)"}],contacts:[{type:"Emergency Services",name:"Lagos Emergency Services",phone:"199",priority:"Critical"},{type:"Poison Control",name:"National Poison Control",phone:"+234 800 123 4567",priority:"Critical"},{type:"Pharmacist",name:"Dr. Kemi Okafor",phone:"+234 804 567 8901",priority:"High"}],isActive:!0,createdAt:"2024-01-12T11:30:00Z",updatedAt:"2024-01-19T13:20:00Z",createdBy:"Dr. Kemi Okafor"}];s(e),r(e),a(!1)},1e3)}catch(e){console.error("Error loading protocols:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase())||e.category.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.category===l)),r(t)},[o,l,e]);const x=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800 border-red-200";case"High":return"bg-orange-100 text-orange-800 border-orange-200";case"Medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"Low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},_=e=>{switch(e){case"Critical":return"bg-red-100 text-red-800";case"High":return"bg-orange-100 text-orange-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},E=e=>{switch(e){case"Medical Emergency":return(0,Kg.jsx)(cy,{className:"h-5 w-5 text-red-600"});case"Fall Detection":return(0,Kg.jsx)(_y,{className:"h-5 w-5 text-orange-600"});case"Medication Emergency":return(0,Kg.jsx)(Ry,{className:"h-5 w-5 text-purple-600"});default:return(0,Kg.jsx)(Zg,{className:"h-5 w-5 text-gray-600"})}},b=(e,t)=>{switch(h(t),e){case"view":m(!0);break;case"edit":v(t),g(!0)}},w=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Emergency Protocols"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage emergency response protocols and procedures"})]}),(0,Kg.jsxs)("button",{onClick:()=>g(!0),className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Create Protocol"]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(Ry,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Protocols"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Protocols"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>e.isActive).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Critical Protocols"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>"Critical"===e.severity).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Categories"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:new Set(e.map(e=>e.category)).size})]})]})})]}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search protocols by name, description, or category...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Categories"}),(0,Kg.jsx)("option",{value:"Medical Emergency",children:"Medical Emergency"}),(0,Kg.jsx)("option",{value:"Fall Detection",children:"Fall Detection"}),(0,Kg.jsx)("option",{value:"Medication Emergency",children:"Medication Emergency"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Protocol"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0",children:E(e.category)}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.description})]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e.category})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(x(e.severity)),children:e.severity})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)(Ly,{className:"h-3 w-3 mr-1"}),"Active"]}):(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)(Yy,{className:"h-3 w-3 mr-1"}),"Inactive"]})})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w(e.updatedAt).date}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>b("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>b("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Protocol",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>b("copy",e),className:"text-purple-600 hover:text-purple-900",title:"Copy Protocol",children:(0,Kg.jsx)(xx,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===n.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(Ry,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No protocols found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"Create your first emergency protocol to get started."})]})]}),p&&u&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[E(u.category),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.name}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(x(u.severity)),children:u.severity})]}),(0,Kg.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Description"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-700",children:u.description})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Trigger Conditions"}),(0,Kg.jsx)("ul",{className:"list-disc list-inside space-y-1",children:u.triggerConditions.map((e,t)=>(0,Kg.jsx)("li",{className:"text-sm text-gray-700",children:e},t))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Response Steps"}),(0,Kg.jsx)("div",{className:"space-y-3",children:u.steps.map(e=>(0,Kg.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Kg.jsx)("h5",{className:"font-medium text-gray-900",children:e.step}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(_(e.priority)),children:e.priority})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-3 w-3 mr-1"}),e.duration]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(xy,{className:"h-3 w-3 mr-1"}),e.responsible]})]})]},e.id))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Escalation Rules"}),(0,Kg.jsx)("div",{className:"space-y-2",children:u.escalationRules.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg",children:[(0,Kg.jsx)(Zg,{className:"h-4 w-4 text-yellow-600"}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.condition}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:e.action}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500",children:["Contact: ",e.contact]})]})]},t))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Emergency Contacts"}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.contacts.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.type})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(_(e.priority)),children:e.priority}),(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(Ay,{className:"h-4 w-4"})})]})]},t))})]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Kg.jsxs)("button",{onClick:()=>b("edit",u),className:"btn btn-primary",children:[(0,Kg.jsx)(Xy,{className:"h-4 w-4 mr-2"}),"Edit Protocol"]})]})]})})})]})},Ex=Qg("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),bx=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({totalMedications:0,activeMedications:0,complianceRate:0,overdueDoses:0,drugInteractions:0,sideEffects:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,patientName:"Adunni Okafor",patientId:"ELD001",medicationName:"Metformin",genericName:"Metformin HCl",dosage:"500mg",frequency:"Twice daily",route:"Oral",startDate:"2024-01-01",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:92,totalDoses:60,takenDoses:55,missedDoses:5,lastTaken:"2024-01-20T08:00:00Z",nextDose:"2024-01-20T20:00:00Z",sideEffects:["Mild nausea","Occasional diarrhea"],drugInteractions:["Warfarin - Monitor INR"],instructions:"Take with food to reduce stomach upset",notes:"Patient reports good tolerance. Blood sugar well controlled.",reminders:{enabled:!0,times:["08:00","20:00"],methods:["push","sms"]}},{id:2,patientName:"Adunni Okafor",patientId:"ELD001",medicationName:"Lisinopril",genericName:"Lisinopril",dosage:"10mg",frequency:"Once daily",route:"Oral",startDate:"2023-12-15",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:98,totalDoses:35,takenDoses:34,missedDoses:1,lastTaken:"2024-01-20T09:00:00Z",nextDose:"2024-01-21T09:00:00Z",sideEffects:["Dry cough"],drugInteractions:["Potassium supplements - Monitor levels"],instructions:"Take at the same time each day",notes:"Blood pressure well controlled. Patient tolerates well.",reminders:{enabled:!0,times:["09:00"],methods:["push","email"]}},{id:3,patientName:"Grace Johnson",patientId:"ELD002",medicationName:"Calcium Carbonate",genericName:"Calcium Carbonate",dosage:"1000mg",frequency:"Twice daily",route:"Oral",startDate:"2024-01-10",endDate:"2024-12-31",prescribedBy:"Dr. Michael Johnson",status:"active",complianceRate:85,totalDoses:20,takenDoses:17,missedDoses:3,lastTaken:"2024-01-19T12:00:00Z",nextDose:"2024-01-20T12:00:00Z",sideEffects:["Constipation"],drugInteractions:["Iron supplements - Take 2 hours apart"],instructions:"Take with food and plenty of water",notes:"Patient needs reminder to take with meals.",reminders:{enabled:!0,times:["08:00","18:00"],methods:["push","sms","call"]}},{id:4,patientName:"Tunde Adebayo",patientId:"ELD003",medicationName:"Insulin Glargine",genericName:"Insulin Glargine",dosage:"30 units",frequency:"Once daily",route:"Subcutaneous",startDate:"2023-11-01",endDate:"2024-12-31",prescribedBy:"Dr. Sarah Williams",status:"active",complianceRate:95,totalDoses:80,takenDoses:76,missedDoses:4,lastTaken:"2024-01-20T07:00:00Z",nextDose:"2024-01-21T07:00:00Z",sideEffects:["Injection site irritation"],drugInteractions:["Alcohol - Monitor blood sugar"],instructions:"Inject at the same time each day, rotate injection sites",notes:"Blood sugar levels well controlled. Patient self-injects successfully.",reminders:{enabled:!0,times:["07:00"],methods:["push","sms"]}},{id:5,patientName:"Mary Okonkwo",patientId:"ELD004",medicationName:"Warfarin",genericName:"Warfarin Sodium",dosage:"5mg",frequency:"Once daily",route:"Oral",startDate:"2024-01-05",endDate:"2024-12-31",prescribedBy:"Dr. Kemi Okafor",status:"active",complianceRate:88,totalDoses:15,takenDoses:13,missedDoses:2,lastTaken:"2024-01-19T18:00:00Z",nextDose:"2024-01-20T18:00:00Z",sideEffects:["Bruising"],drugInteractions:["Metformin - Monitor INR closely","Aspirin - Increased bleeding risk"],instructions:"Take at the same time each day. Regular INR monitoring required.",notes:"INR levels stable. Patient educated about bleeding precautions.",reminders:{enabled:!0,times:["18:00"],methods:["push","call"]}}],t=e.length,n=e.filter(e=>"active"===e.status).length,i=e.reduce((e,t)=>e+t.complianceRate,0)/t,o=e.filter(e=>new Date(e.nextDose)<new Date&&"active"===e.status).length,c=e.reduce((e,t)=>e+t.drugInteractions.length,0),l=e.reduce((e,t)=>e+t.sideEffects.length,0);g({totalMedications:t,activeMedications:n,complianceRate:Math.round(i),overdueDoses:o,drugInteractions:c,sideEffects:l}),s(e),r(e),a(!1)},1e3)}catch(e){console.error("Error loading medication data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.patientName.toLowerCase().includes(o.toLowerCase())||e.medicationName.toLowerCase().includes(o.toLowerCase())||e.genericName.toLowerCase().includes(o.toLowerCase()))),"all"!==l&&(t=t.filter(e=>e.status===l)),r(t)},[o,l,e]);const y=e=>e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600",v=e=>e>=90?(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-600"}):e>=80?(0,Kg.jsx)(_y,{className:"h-4 w-4 text-yellow-600"}):(0,Kg.jsx)(Ex,{className:"h-4 w-4 text-red-600"}),x=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"paused":return"bg-yellow-100 text-yellow-800";case"discontinued":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},_=(e,t)=>{if(h(t),"view"===e)m(!0)},E=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},b=e=>new Date(e)<new Date;return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medication Management"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Monitor medication compliance and manage prescriptions"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Add Medication"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(Ey,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Medications"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalMedications})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.activeMedications})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(vy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Compliance Rate"}),(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[f.complianceRate,"%"]})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Overdue Doses"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.overdueDoses})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Kg.jsx)(Ry,{className:"h-6 w-6 text-orange-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Drug Interactions"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.drugInteractions})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Kg.jsx)(cy,{className:"h-6 w-6 text-yellow-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Side Effects"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.sideEffects})]})]})})]}),f.overdueDoses>0&&(0,Kg.jsx)("div",{className:"card border-l-4 border-red-500 bg-red-50",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-500 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Overdue Medication Doses"}),(0,Kg.jsxs)("p",{className:"text-red-600",children:[f.overdueDoses," medication dose",f.overdueDoses>1?"s":""," are overdue and need immediate attention"]})]})]}),(0,Kg.jsxs)("button",{className:"btn btn-red",children:[(0,Kg.jsx)(fy,{className:"h-4 w-4 mr-2"}),"Send Reminders"]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search medications by patient, medication name, or generic name...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"active",children:"Active"}),(0,Kg.jsx)("option",{value:"paused",children:"Paused"}),(0,Kg.jsx)("option",{value:"discontinued",children:"Discontinued"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient & Medication"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dosage & Frequency"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compliance"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Dose"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>{const{date:t,time:s}=E(e.nextDose),n=b(e.nextDose);return(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(n?"bg-red-50":""),children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)(Ey,{className:"h-5 w-5 text-gray-600"})})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.patientName}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.medicationName}),(0,Kg.jsx)("div",{className:"text-xs text-gray-400",children:e.genericName})]})]})}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:e.dosage}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.frequency}),(0,Kg.jsx)("div",{className:"text-xs text-gray-400",children:e.route})]}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[v(e.complianceRate),(0,Kg.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(y(e.complianceRate)),children:[e.complianceRate,"%"]})]}),(0,Kg.jsxs)("div",{className:"text-xs text-gray-500",children:[e.takenDoses,"/",e.totalDoses," doses"]})]}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm ".concat(n?"text-red-600 font-medium":"text-gray-900"),children:t}),(0,Kg.jsx)("div",{className:"text-sm ".concat(n?"text-red-500":"text-gray-500"),children:s}),n&&(0,Kg.jsx)("div",{className:"text-xs text-red-600 font-medium",children:"OVERDUE"})]}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(x(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>_("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>_("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Medication",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),0===n.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(Ey,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No medications found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No medications have been added yet."})]})]}),p&&u&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(Ey,{className:"h-6 w-6 text-blue-600"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Medication Details"}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(x(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]}),(0,Kg.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Medication Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Patient"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.patientName})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Medication Name"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.medicationName}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500",children:["(",u.genericName,")"]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Dosage"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.dosage})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Route"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.route})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Frequency"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.frequency})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Prescribed By"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.prescribedBy})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Compliance Tracking"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Compliance Rate"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[v(u.complianceRate),(0,Kg.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(y(u.complianceRate)),children:[u.complianceRate,"%"]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Doses Taken"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:[u.takenDoses,"/",u.totalDoses]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Missed Doses"}),(0,Kg.jsx)("span",{className:"text-sm text-red-600",children:u.missedDoses})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Taken"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:[E(u.lastTaken).date," at ",E(u.lastTaken).time]})]})]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Schedule & Reminders"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Next Dose"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(oy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsxs)("span",{className:"text-sm ".concat(b(u.nextDose)?"text-red-600 font-medium":"text-gray-900"),children:[E(u.nextDose).date," at ",E(u.nextDose).time]})]}),b(u.nextDose)&&(0,Kg.jsx)("span",{className:"text-xs text-red-600 font-medium",children:"OVERDUE"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Reminders"}),(0,Kg.jsxs)("div",{className:"space-y-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(fy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.reminders.enabled?"Enabled":"Disabled"})]}),(0,Kg.jsxs)("div",{className:"text-sm text-gray-500",children:["Times: ",u.reminders.times.join(", ")]}),(0,Kg.jsxs)("div",{className:"text-sm text-gray-500",children:["Methods: ",u.reminders.methods.join(", ")]})]})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Safety Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[u.sideEffects.length>0&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Side Effects"}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:u.sideEffects.map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:e},t))})]}),u.drugInteractions.length>0&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Drug Interactions"}),(0,Kg.jsx)("div",{className:"space-y-1 mt-1",children:u.drugInteractions.map((e,t)=>(0,Kg.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:e},t))})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Instructions & Notes"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Instructions"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.instructions})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.notes})]})]})]})]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Xy,{className:"h-4 w-4 mr-2"}),"Edit Medication"]})]})]})})})]})},wx=()=>{const[e,s]=(0,t.useState)({complianceTrends:[],medicationStats:[],patientCompliance:[],sideEffectReports:[],drugInteractions:[],reminderEffectiveness:[]}),[n,r]=(0,t.useState)(!0),[i,a]=(0,t.useState)("30days"),[o,c]=(0,t.useState)("compliance");(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{s({complianceTrends:[{date:"2024-01-01",compliance:85,patients:120},{date:"2024-01-02",compliance:87,patients:122},{date:"2024-01-03",compliance:89,patients:125},{date:"2024-01-04",compliance:88,patients:128},{date:"2024-01-05",compliance:91,patients:130},{date:"2024-01-06",compliance:90,patients:132},{date:"2024-01-07",compliance:92,patients:135},{date:"2024-01-08",compliance:89,patients:138},{date:"2024-01-09",compliance:87,patients:140},{date:"2024-01-10",compliance:90,patients:142},{date:"2024-01-11",compliance:93,patients:145},{date:"2024-01-12",compliance:91,patients:148},{date:"2024-01-13",compliance:88,patients:150},{date:"2024-01-14",compliance:90,patients:152},{date:"2024-01-15",compliance:92,patients:155},{date:"2024-01-16",compliance:89,patients:158},{date:"2024-01-17",compliance:87,patients:160},{date:"2024-01-18",compliance:91,patients:162},{date:"2024-01-19",compliance:93,patients:165},{date:"2024-01-20",compliance:90,patients:167}],medicationStats:[{medication:"Metformin",totalPatients:45,avgCompliance:92,sideEffects:3,interactions:2},{medication:"Lisinopril",totalPatients:38,avgCompliance:88,sideEffects:5,interactions:1},{medication:"Insulin",totalPatients:25,avgCompliance:95,sideEffects:2,interactions:3},{medication:"Warfarin",totalPatients:18,avgCompliance:85,sideEffects:4,interactions:4},{medication:"Calcium",totalPatients:32,avgCompliance:78,sideEffects:6,interactions:1},{medication:"Aspirin",totalPatients:28,avgCompliance:90,sideEffects:2,interactions:2}],patientCompliance:[{patient:"Adunni Okafor",totalMedications:3,compliance:92,missedDoses:5,lastCheck:"2024-01-20"},{patient:"Grace Johnson",totalMedications:2,compliance:85,missedDoses:8,lastCheck:"2024-01-19"},{patient:"Tunde Adebayo",totalMedications:4,compliance:95,missedDoses:2,lastCheck:"2024-01-20"},{patient:"Mary Okonkwo",totalMedications:2,compliance:88,missedDoses:6,lastCheck:"2024-01-18"},{patient:"John Smith",totalMedications:3,compliance:78,missedDoses:12,lastCheck:"2024-01-17"},{patient:"Sarah Williams",totalMedications:1,compliance:96,missedDoses:1,lastCheck:"2024-01-20"}],sideEffectReports:[{medication:"Metformin",sideEffect:"Nausea",frequency:12,severity:"Mild",trend:"decreasing"},{medication:"Lisinopril",sideEffect:"Dry Cough",frequency:8,severity:"Moderate",trend:"stable"},{medication:"Warfarin",sideEffect:"Bruising",frequency:6,severity:"Mild",trend:"stable"},{medication:"Calcium",sideEffect:"Constipation",frequency:15,severity:"Mild",trend:"increasing"},{medication:"Insulin",sideEffect:"Injection Site Irritation",frequency:4,severity:"Mild",trend:"decreasing"}],drugInteractions:[{medication1:"Warfarin",medication2:"Aspirin",severity:"High",frequency:3,action:"Monitor INR closely"},{medication1:"Metformin",medication2:"Warfarin",severity:"Medium",frequency:2,action:"Monitor blood sugar"},{medication1:"Calcium",medication2:"Iron",severity:"Low",frequency:5,action:"Take 2 hours apart"},{medication1:"Lisinopril",medication2:"Potassium",severity:"Medium",frequency:1,action:"Monitor potassium levels"}],reminderEffectiveness:[{method:"Push Notifications",sent:1250,responded:1100,effectiveness:88},{method:"SMS",sent:890,responded:756,effectiveness:85},{method:"Email",sent:650,responded:520,effectiveness:80},{method:"Phone Calls",sent:120,responded:108,effectiveness:90}]}),r(!1)},1e3)}catch(e){console.error("Error loading analytics data:",e),r(!1)}})()},[i]);const l=e=>e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600",d=e=>e>=90?(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-600"}):e>=80?(0,Kg.jsx)(_y,{className:"h-4 w-4 text-yellow-600"}):(0,Kg.jsx)(Ex,{className:"h-4 w-4 text-red-600"}),u=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-yellow-100 text-yellow-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},h=e=>{switch(e){case"increasing":return(0,Kg.jsx)(wy,{className:"h-4 w-4 text-red-600"});case"decreasing":return(0,Kg.jsx)(Ex,{className:"h-4 w-4 text-green-600"});case"stable":return(0,Kg.jsx)(_y,{className:"h-4 w-4 text-blue-600"});default:return(0,Kg.jsx)(_y,{className:"h-4 w-4 text-gray-600"})}};return n?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Medication Analytics"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Comprehensive medication compliance and safety analytics"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("select",{className:"form-input",value:i,onChange:e=>a(e.target.value),children:[(0,Kg.jsx)("option",{value:"7days",children:"Last 7 days"}),(0,Kg.jsx)("option",{value:"30days",children:"Last 30 days"}),(0,Kg.jsx)("option",{value:"90days",children:"Last 90 days"}),(0,Kg.jsx)("option",{value:"1year",children:"Last year"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(vy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Compliance"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"90%"}),(0,Kg.jsx)("p",{className:"text-xs text-green-600",children:"+2% from last month"})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Doses Taken"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"2,847"}),(0,Kg.jsx)("p",{className:"text-xs text-green-600",children:"+5% from last month"})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Kg.jsx)(Yy,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Missed Doses"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"156"}),(0,Kg.jsx)("p",{className:"text-xs text-red-600",children:"-8% from last month"})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Patients"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"167"}),(0,Kg.jsx)("p",{className:"text-xs text-blue-600",children:"+12 from last month"})]})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Compliance Trends"}),(0,Kg.jsx)("div",{className:"flex items-center space-x-2",children:(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"Filter"]})})]}),(0,Kg.jsx)("div",{className:"h-64 bg-gray-50 rounded-lg flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(vy,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,Kg.jsx)("p",{className:"text-gray-500",children:"Compliance trend chart would be displayed here"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-400",children:"Integration with charting library needed"})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Medication Performance"}),(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Medication"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patients"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Compliance"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Side Effects"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Interactions"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.medicationStats.map((e,t)=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ey,{className:"h-5 w-5 text-blue-600 mr-3"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.medication})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:e.totalPatients})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[d(e.avgCompliance),(0,Kg.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(l(e.avgCompliance)),children:[e.avgCompliance,"%"]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:e.sideEffects})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:e.interactions})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})})})]},t))})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Patient Compliance Overview"}),(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Medications"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compliance"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Missed Doses"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Check"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.patientCompliance.map((e,t)=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center mr-3",children:(0,Kg.jsx)("span",{className:"text-xs font-medium text-gray-700",children:e.patient.split(" ").map(e=>e[0]).join("")})}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.patient})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:e.totalMedications})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[d(e.compliance),(0,Kg.jsxs)("span",{className:"ml-2 text-sm font-medium ".concat(l(e.compliance)),children:[e.compliance,"%"]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:e.missedDoses})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:e.lastCheck})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})})})]},t))})]})})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Side Effect Reports"}),(0,Kg.jsx)("div",{className:"space-y-3",children:e.sideEffectReports.map((e,t)=>(0,Kg.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ey,{className:"h-4 w-4 text-blue-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.medication})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[h(e.trend),(0,Kg.jsx)("span",{className:"ml-1 text-xs text-gray-500",children:e.trend})]})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.sideEffect}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("span",{className:"text-xs text-gray-500",children:["Frequency: ",e.frequency]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("Mild"===e.severity?"bg-green-100 text-green-800":"Moderate"===e.severity?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.severity})]})]},t))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Drug Interactions"}),(0,Kg.jsx)("div",{className:"space-y-3",children:e.drugInteractions.map((e,t)=>(0,Kg.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-4 w-4 text-orange-600 mr-2"}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.medication1," + ",e.medication2]})]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(u(e.severity)),children:e.severity})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.action}),(0,Kg.jsx)("div",{className:"flex items-center justify-between",children:(0,Kg.jsxs)("span",{className:"text-xs text-gray-500",children:["Frequency: ",e.frequency]})})]},t))})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Reminder Effectiveness"}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:e.reminderEffectiveness.map((e,t)=>(0,Kg.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.method}),(0,Kg.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[e.effectiveness,"%"]})]}),(0,Kg.jsxs)("div",{className:"space-y-1",children:[(0,Kg.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,Kg.jsxs)("span",{children:["Sent: ",e.sent]}),(0,Kg.jsxs)("span",{children:["Responded: ",e.responded]})]}),(0,Kg.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Kg.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(e.effectiveness,"%")}})})]})]},t))})]})]})},Nx=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)("all"),[u,h]=(0,t.useState)(null),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)({totalCaregivers:0,activeCaregivers:0,averageRating:0,totalPatients:0,pendingAssignments:0,trainingCompleted:0});(0,t.useEffect)(()=>{(async()=>{try{setTimeout(()=>{const e=[{id:1,name:"Tunde Adebayo",email:"tunde@example.com",phone:"+234 802 123 4567",status:"active",rating:4.8,totalPatients:8,currentPatients:3,experience:"5 years",specializations:["Elderly Care","Dementia Care","Physical Therapy"],certifications:["CPR Certified","First Aid","Dementia Care Specialist"],location:"Lagos, Nigeria",availability:"Full-time",hourlyRate:2500,joinDate:"2023-06-15",lastActive:"2024-01-20T14:30:00Z",profileImage:null,bio:"Experienced caregiver with 5 years of dedicated service to elderly patients. Specializes in dementia care and physical therapy assistance.",languages:["English","Yoruba"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[{patientId:"ELD001",patientName:"Adunni Okafor",startDate:"2024-01-15",schedule:"Mon-Fri, 9AM-5PM",status:"active"},{patientId:"ELD002",patientName:"Grace Johnson",startDate:"2024-01-10",schedule:"Tue-Thu, 2PM-6PM",status:"active"}],performance:{punctuality:95,patientSatisfaction:4.8,taskCompletion:98,communication:4.7,safety:100},earnings:{thisMonth:18e4,lastMonth:175e3,total:21e5}},{id:2,name:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890",status:"active",rating:4.9,totalPatients:12,currentPatients:4,experience:"7 years",specializations:["Post-Surgery Care","Medication Management","Mobility Assistance"],certifications:["CPR Certified","First Aid","Medication Administration","Physical Therapy Aide"],location:"Abuja, Nigeria",availability:"Part-time",hourlyRate:3e3,joinDate:"2022-03-20",lastActive:"2024-01-20T16:45:00Z",profileImage:null,bio:"Highly skilled caregiver with extensive experience in post-surgery care and medication management. Known for excellent patient communication.",languages:["English","Hausa"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[{patientId:"ELD003",patientName:"Tunde Adebayo",startDate:"2024-01-12",schedule:"Mon-Wed-Fri, 10AM-4PM",status:"active"},{patientId:"ELD004",patientName:"Mary Okonkwo",startDate:"2024-01-08",schedule:"Tue-Thu, 1PM-7PM",status:"active"}],performance:{punctuality:98,patientSatisfaction:4.9,taskCompletion:100,communication:4.8,safety:100},earnings:{thisMonth:22e4,lastMonth:21e4,total:28e5}},{id:3,name:"Michael Johnson",email:"michael@example.com",phone:"+234 804 567 8901",status:"pending",rating:0,totalPatients:0,currentPatients:0,experience:"2 years",specializations:["Basic Care","Companionship"],certifications:["CPR Certified","First Aid"],location:"Ibadan, Nigeria",availability:"Full-time",hourlyRate:2e3,joinDate:"2024-01-18",lastActive:"2024-01-19T10:15:00Z",profileImage:null,bio:"New caregiver eager to provide quality care to elderly patients. Recently completed training and ready to start.",languages:["English","Yoruba"],vehicle:!1,backgroundCheck:"Pending",insurance:"Pending",currentAssignments:[],performance:{punctuality:0,patientSatisfaction:0,taskCompletion:0,communication:0,safety:0},earnings:{thisMonth:0,lastMonth:0,total:0}},{id:4,name:"Grace Okafor",email:"grace@example.com",phone:"+234 805 678 9012",status:"inactive",rating:4.6,totalPatients:15,currentPatients:0,experience:"6 years",specializations:["Palliative Care","End-of-Life Care","Family Support"],certifications:["CPR Certified","First Aid","Palliative Care Specialist","Grief Counseling"],location:"Port Harcourt, Nigeria",availability:"On-call",hourlyRate:3500,joinDate:"2021-09-10",lastActive:"2024-01-15T12:00:00Z",profileImage:null,bio:"Specialized in palliative and end-of-life care. Currently on temporary leave for personal reasons.",languages:["English","Igbo"],vehicle:!0,backgroundCheck:"Passed",insurance:"Active",currentAssignments:[],performance:{punctuality:92,patientSatisfaction:4.6,taskCompletion:95,communication:4.5,safety:98},earnings:{thisMonth:0,lastMonth:45e3,total:32e5}}],t=e.length,n=e.filter(e=>"active"===e.status).length,i=e.filter(e=>e.rating>0).reduce((e,t)=>e+t.rating,0)/e.filter(e=>e.rating>0).length,o=e.reduce((e,t)=>e+t.currentPatients,0),c=e.filter(e=>"pending"===e.status).length,l=e.filter(e=>e.certifications.length>=2).length;g({totalCaregivers:t,activeCaregivers:n,averageRating:Math.round(10*i)/10,totalPatients:o,pendingAssignments:c,trainingCompleted:l}),s(e),r(e),a(!1)},1e3)}catch(e){console.error("Error loading caregiver data:",e),a(!1)}})()},[]),(0,t.useEffect)(()=>{let t=e;o&&(t=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.specializations.some(e=>e.toLowerCase().includes(o.toLowerCase())))),"all"!==l&&(t=t.filter(e=>e.status===l)),r(t)},[o,l,e]);const y=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v=e=>e>=4.5?"text-green-600":e>=4?"text-yellow-600":e>=3?"text-orange-600":"text-red-600",x=(e,t)=>{if(h(t),"view"===e)m(!0)};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Caregiver Management"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage caregivers, assignments, and performance"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(ox,{className:"h-4 w-4 mr-2"}),"Add Caregiver"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Caregivers"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalCaregivers})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.activeCaregivers})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Kg.jsx)(Dy,{className:"h-6 w-6 text-yellow-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.pendingAssignments})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(Uy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Rating"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.averageRating})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Kg.jsx)(cy,{className:"h-6 w-6 text-orange-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Patients"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.totalPatients})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-indigo-100 rounded-full",children:(0,Kg.jsx)(My,{className:"h-6 w-6 text-indigo-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Trained"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.trainingCompleted})]})]})})]}),f.pendingAssignments>0&&(0,Kg.jsx)("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-yellow-500 mr-3"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-yellow-800",children:"Pending Caregiver Approvals"}),(0,Kg.jsxs)("p",{className:"text-yellow-600",children:[f.pendingAssignments," caregiver",f.pendingAssignments>1?"s":""," waiting for approval and assignment"]})]})]}),(0,Kg.jsxs)("button",{className:"btn btn-yellow",children:[(0,Kg.jsx)(rv,{className:"h-4 w-4 mr-2"}),"Review Pending"]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search caregivers by name, email, or specialization...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:l,onChange:e=>d(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"active",children:"Active"}),(0,Kg.jsx)("option",{value:"pending",children:"Pending"}),(0,Kg.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Caregiver"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating & Experience"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Patients"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Specializations"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name.split(" ").map(e=>e[0]).join("")})})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),(0,Kg.jsx)("div",{className:"text-xs text-gray-400",children:e.location})]})]})}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Uy,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm font-medium ".concat(v(e.rating)),children:e.rating>0?e.rating:"N/A"})]}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.experience}),(0,Kg.jsxs)("div",{className:"text-xs text-gray-400",children:["\u20a6",e.hourlyRate.toLocaleString(),"/hr"]})]}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:e.currentPatients}),(0,Kg.jsxs)("div",{className:"text-xs text-gray-500",children:["of ",e.totalPatients," total"]})]}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.specializations.slice(0,2).map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t)),e.specializations.length>2&&(0,Kg.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.specializations.length-2," more"]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(y(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>x("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>x("edit",e),className:"text-green-600 hover:text-green-900",title:"Edit Caregiver",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>x("assign",e),className:"text-purple-600 hover:text-purple-900",title:"Assign Patient",children:(0,Kg.jsx)(qy,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===n.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(xy,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No caregivers found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||"all"!==l?"Try adjusting your search or filter criteria.":"No caregivers have been added yet."})]})]}),p&&u&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-lg font-medium text-gray-700",children:u.name.split(" ").map(e=>e[0]).join("")})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.name}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(y(u.status)),children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})]})]}),(0,Kg.jsxs)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Contact Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Gy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.email})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Ay,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.phone})]}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Vy,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.location})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Professional Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Experience"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.experience})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Hourly Rate"}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-900",children:["\u20a6",u.hourlyRate.toLocaleString()]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Availability"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.availability})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Languages"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900",children:u.languages.join(", ")})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Specializations"}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2",children:u.specializations.map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Certifications"}),(0,Kg.jsx)("div",{className:"space-y-2",children:u.certifications.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(My,{className:"h-4 w-4 text-green-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:e})]},t))})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Performance Metrics"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Overall Rating"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Uy,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm font-medium ".concat(v(u.rating)),children:u.rating>0?u.rating:"N/A"})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Punctuality"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.punctuality,"%"]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Patient Satisfaction"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.performance.patientSatisfaction})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Task Completion"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.taskCompletion,"%"]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Communication"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:u.performance.communication})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Safety Record"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:[u.performance.safety,"%"]})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Current Assignments"}),(0,Kg.jsx)("div",{className:"space-y-3",children:u.currentAssignments.length>0?u.currentAssignments.map((e,t)=>(0,Kg.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Kg.jsx)("h5",{className:"font-medium text-gray-900",children:e.patientName}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.schedule}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500",children:["Started: ",e.startDate]})]},t)):(0,Kg.jsx)("p",{className:"text-sm text-gray-500",children:"No current assignments"})})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Earnings Summary"}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"This Month"}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["\u20a6",u.earnings.thisMonth.toLocaleString()]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Last Month"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:["\u20a6",u.earnings.lastMonth.toLocaleString()]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-700",children:"Total Earnings"}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["\u20a6",u.earnings.total.toLocaleString()]})]})]})]})]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary",children:"Close"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Xy,{className:"h-4 w-4 mr-2"}),"Edit Caregiver"]}),(0,Kg.jsxs)("button",{className:"btn btn-green",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Assign Patient"]})]})]})})})]})},Sx=Qg("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Tx=Qg("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Cx=()=>{const[e,s]=(0,t.useState)({overview:{},userMetrics:{},caregiverMetrics:{},emergencyMetrics:{},medicationMetrics:{},financialMetrics:{},geographicData:{},trends:{}}),[n,r]=(0,t.useState)(!0),[i,a]=(0,t.useState)("30d"),[o,c]=(0,t.useState)("all"),[l,d]=(0,t.useState)({overview:!0,users:!0,caregivers:!1,emergencies:!1,medications:!1,financial:!1,geographic:!1,trends:!1});(0,t.useEffect)(()=>{u()},[i]);const u=async()=>{try{r(!0),setTimeout(()=>{s({overview:{totalUsers:1247,activeCaregivers:89,totalAppointments:2341,emergencyAlerts:12,medicationCompliance:94.2,systemUptime:99.8,userGrowth:15.3,caregiverSatisfaction:4.7},userMetrics:{totalUsers:1247,newUsersThisMonth:156,activeUsers:892,inactiveUsers:355,userRetention:87.3,averageAge:72.5,genderDistribution:{male:45.2,female:54.8},locationDistribution:{Lagos:35.2,Abuja:22.1,Kano:15.8,"Port Harcourt":12.4,Ibadan:8.9,Others:5.6},registrationTrend:[{month:"Jan",count:89},{month:"Feb",count:112},{month:"Mar",count:98},{month:"Apr",count:134},{month:"May",count:156},{month:"Jun",count:178}]},caregiverMetrics:{totalCaregivers:89,activeCaregivers:67,pendingCaregivers:12,inactiveCaregivers:10,averageRating:4.6,averageExperience:4.2,topPerformers:[{name:"Tunde Adebayo",rating:4.9,patients:8,earnings:18e4},{name:"Sarah Williams",rating:4.8,patients:6,earnings:165e3},{name:"Grace Okafor",rating:4.7,patients:7,earnings:155e3}],performanceDistribution:{"Excellent (4.5+)":45,"Good (4.0-4.4)":32,"Average (3.5-3.9)":8,"Below Average (<3.5)":4},specializations:{"Elderly Care":67,"Dementia Care":45,"Physical Therapy":38,"Medication Management":52,"Post-Surgery Care":29}},emergencyMetrics:{totalEmergencies:12,resolvedEmergencies:10,activeEmergencies:2,averageResponseTime:8.5,emergencyTypes:{"Medical Emergency":5,Fall:3,"Medication Issue":2,"Equipment Malfunction":1,Other:1},responseTimeTrend:[{day:"Mon",time:7.2},{day:"Tue",time:8.1},{day:"Wed",time:9.3},{day:"Thu",time:6.8},{day:"Fri",time:8.9},{day:"Sat",time:10.2},{day:"Sun",time:9.1}],severityDistribution:{Critical:2,High:4,Medium:5,Low:1}},medicationMetrics:{totalMedications:2341,complianceRate:94.2,missedDoses:89,medicationErrors:3,averageAdherence:96.1,medicationTypes:{"Blood Pressure":456,Diabetes:389,"Heart Medication":234,"Pain Management":567,Vitamins:445,Other:250},complianceTrend:[{week:"Week 1",rate:92.1},{week:"Week 2",rate:94.3},{week:"Week 3",rate:95.8},{week:"Week 4",rate:94.2}]},financialMetrics:{totalRevenue:125e5,monthlyRevenue:21e5,revenueGrowth:12.5,averageTransactionValue:45e3,revenueByService:{"Caregiver Services":85e5,"Medication Management":21e5,"Emergency Services":12e5,Consultation:7e5},paymentMethods:{"Bank Transfer":45.2,"Card Payment":32.1,"Mobile Money":18.7,Cash:4},monthlyRevenueTrend:[{month:"Jan",revenue:18e5},{month:"Feb",revenue:195e4},{month:"Mar",revenue:21e5},{month:"Apr",revenue:205e4},{month:"May",revenue:22e5},{month:"Jun",revenue:21e5}]},geographicData:{userDistribution:{Lagos:439,Abuja:276,Kano:197,"Port Harcourt":155,Ibadan:111,Others:69},caregiverDistribution:{Lagos:31,Abuja:19,Kano:14,"Port Harcourt":11,Ibadan:8,Others:6},serviceAreas:[{city:"Lagos",coverage:95,users:439,caregivers:31},{city:"Abuja",coverage:88,users:276,caregivers:19},{city:"Kano",coverage:75,users:197,caregivers:14},{city:"Port Harcourt",coverage:70,users:155,caregivers:11},{city:"Ibadan",coverage:65,users:111,caregivers:8}]},trends:{userGrowth:[{month:"Jan",growth:8.2},{month:"Feb",growth:12.1},{month:"Mar",growth:9.8},{month:"Apr",growth:15.3},{month:"May",growth:18.7},{month:"Jun",growth:15.3}],caregiverGrowth:[{month:"Jan",growth:5.1},{month:"Feb",growth:8.3},{month:"Mar",growth:6.7},{month:"Apr",growth:11.2},{month:"May",growth:13.8},{month:"Jun",growth:10.5}],serviceDemand:{"Caregiver Services":78.5,"Medication Management":65.2,"Emergency Response":45.8,"Health Monitoring":52.3,"Family Communication":38.7}}}),r(!1)},1500)}catch(e){console.error("Error loading analytics data:",e),r(!1)}},h=e=>{d(t=>Le(Le({},t),{},{[e]:!t[e]}))},p=e=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(e),m=function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e>0?(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500"}):(0,Kg.jsx)(Ex,{className:"h-4 w-4 text-red-500"}):e>0?(0,Kg.jsx)(Ex,{className:"h-4 w-4 text-red-500"}):(0,Kg.jsx)(wy,{className:"h-4 w-4 text-green-500"})},f=function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e>0?"text-green-600":"text-red-600":e>0?"text-red-600":"text-green-600"};return n?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Comprehensive insights and performance metrics"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("select",{className:"form-input",value:i,onChange:e=>a(e.target.value),children:[(0,Kg.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,Kg.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,Kg.jsx)("option",{value:"90d",children:"Last 90 days"}),(0,Kg.jsx)("option",{value:"1y",children:"Last year"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,Kg.jsxs)("button",{onClick:u,className:"btn btn-primary",children:[(0,Kg.jsx)($g,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(g=e.overview.totalUsers,g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toString())}),(0,Kg.jsxs)("div",{className:"flex items-center mt-1",children:[m(e.overview.userGrowth),(0,Kg.jsxs)("span",{className:"text-sm ".concat(f(e.overview.userGrowth)),children:["+",e.overview.userGrowth,"%"]})]})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(by,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Caregivers"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.overview.activeCaregivers}),(0,Kg.jsxs)("div",{className:"flex items-center mt-1",children:[(0,Kg.jsx)(Star,{className:"h-4 w-4 text-yellow-400"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-600 ml-1",children:[e.overview.caregiverSatisfaction," avg rating"]})]})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(cy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Medication Compliance"}),(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.overview.medicationCompliance,"%"]}),(0,Kg.jsxs)("div",{className:"flex items-center mt-1",children:[(0,Kg.jsx)(Sx,{className:"h-4 w-4 text-green-500"}),(0,Kg.jsx)("span",{className:"text-sm text-green-600 ml-1",children:"Above target"})]})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Kg.jsx)(rx,{className:"h-6 w-6 text-orange-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.monthlyRevenue)}),(0,Kg.jsxs)("div",{className:"flex items-center mt-1",children:[m(e.financialMetrics.revenueGrowth),(0,Kg.jsxs)("span",{className:"text-sm ".concat(f(e.financialMetrics.revenueGrowth)),children:["+",e.financialMetrics.revenueGrowth,"%"]})]})]})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("users"),children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"User Analytics"}),l.users?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),l.users&&(0,Kg.jsx)("div",{className:"mt-6 space-y-6",children:(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"User Distribution"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Active Users"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.userMetrics.activeUsers})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"New This Month"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.userMetrics.newUsersThisMonth})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Retention Rate"}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.userRetention,"%"]})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Average Age"}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.averageAge," years"]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Gender Distribution"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Male"})]}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.genderDistribution.male,"%"]})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"w-3 h-3 bg-pink-500 rounded-full mr-2"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Female"})]}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.userMetrics.genderDistribution.female,"%"]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Top Locations"}),(0,Kg.jsx)("div",{className:"space-y-2",children:Object.entries(e.userMetrics.locationDistribution).slice(0,5).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[s,"%"]})]},t)})})]})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("caregivers"),children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Caregiver Analytics"}),l.caregivers?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),l.caregivers&&(0,Kg.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Performance Distribution"}),(0,Kg.jsx)("div",{className:"space-y-3",children:Object.entries(e.caregiverMetrics.performanceDistribution).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[s," caregivers"]})]},t)})})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Top Performers"}),(0,Kg.jsx)("div",{className:"space-y-3",children:e.caregiverMetrics.topPerformers.map((e,t)=>(0,Kg.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500",children:[e.patients," patients"]})]}),(0,Kg.jsxs)("div",{className:"text-right",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Star,{className:"h-4 w-4 text-yellow-400 mr-1"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.rating})]}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:p(e.earnings)})]})]},t))})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Specializations"}),(0,Kg.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries(e.caregiverMetrics.specializations).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("p",{className:"text-lg font-bold text-gray-900",children:s}),(0,Kg.jsx)("p",{className:"text-xs text-gray-600",children:t})]},t)})})]})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("emergencies"),children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Emergency Analytics"}),l.emergencies?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),l.emergencies&&(0,Kg.jsx)("div",{className:"mt-6 space-y-6",children:(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Emergency Summary"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Total Emergencies"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.emergencyMetrics.totalEmergencies})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Resolved"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-green-600",children:e.emergencyMetrics.resolvedEmergencies})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Active"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-red-600",children:e.emergencyMetrics.activeEmergencies})]}),(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Avg Response Time"}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.emergencyMetrics.averageResponseTime," min"]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Emergency Types"}),(0,Kg.jsx)("div",{className:"space-y-2",children:Object.entries(e.emergencyMetrics.emergencyTypes).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:s})]},t)})})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Severity Distribution"}),(0,Kg.jsx)("div",{className:"space-y-2",children:Object.entries(e.emergencyMetrics.severityDistribution).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:s})]},t)})})]})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("financial"),children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Financial Analytics"}),l.financial?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),l.financial&&(0,Kg.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Revenue by Service"}),(0,Kg.jsx)("div",{className:"space-y-3",children:Object.entries(e.financialMetrics.revenueByService).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-900",children:p(s)})]},t)})})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Payment Methods"}),(0,Kg.jsx)("div",{className:"space-y-3",children:Object.entries(e.financialMetrics.paymentMethods).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[s,"%"]})]},t)})})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Key Financial Metrics"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Kg.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.totalRevenue)}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Total Revenue"})]}),(0,Kg.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p(e.financialMetrics.averageTransactionValue)}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Avg Transaction"})]}),(0,Kg.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["+",e.financialMetrics.revenueGrowth,"%"]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Growth Rate"})]})]})]})]})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h("geographic"),children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Geographic Analytics"}),l.geographic?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),l.geographic&&(0,Kg.jsx)("div",{className:"mt-6 space-y-6",children:(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:"Service Coverage"}),(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"City"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Coverage"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Users"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Caregivers"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.geographicData.serviceAreas.map((e,t)=>(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.city}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.coverage,"%"]}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.users}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.caregivers})]},t))})]})})]})})]})]});var g},Rx=Qg("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),Ix=Qg("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Ax=Qg("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),Ox=()=>{const[e,s]=(0,t.useState)("messages"),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)([]),[u,h]=(0,t.useState)(!0),[p,m]=(0,t.useState)(null),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)(!1),[x,_]=(0,t.useState)(""),[E,b]=(0,t.useState)("all"),[w,N]=(0,t.useState)({inbox:!0,sent:!1,drafts:!1,archived:!1});(0,t.useEffect)(()=>{S()},[]);const S=async()=>{try{h(!0),setTimeout(()=>{r([{id:1,type:"inbox",from:"Adunni Okafor",fromEmail:"adunni@example.com",to:"Admin",subject:"Medication Reminder Issue",content:"Hello, I'm having trouble receiving my medication reminders. Can you please check my settings?",timestamp:"2024-01-20T14:30:00Z",status:"unread",priority:"medium",category:"support",attachments:[],tags:["medication","reminder","technical"],replyCount:0,isStarred:!1,isArchived:!1},{id:2,type:"sent",from:"Admin",fromEmail:"admin@elderx.com",to:"Tunde Adebayo",toEmail:"tunde@example.com",subject:"Caregiver Performance Review",content:"Hi Tunde, your performance this month has been excellent. Keep up the great work!",timestamp:"2024-01-20T10:15:00Z",status:"sent",priority:"low",category:"feedback",attachments:[],tags:["performance","caregiver","review"],replyCount:0,isStarred:!0,isArchived:!1},{id:3,type:"inbox",from:"Grace Johnson",fromEmail:"grace@example.com",to:"Admin",subject:"Emergency Contact Update",content:"I need to update my emergency contact information. My daughter's phone number has changed.",timestamp:"2024-01-19T16:45:00Z",status:"read",priority:"high",category:"emergency",attachments:[],tags:["emergency","contact","update"],replyCount:1,isStarred:!1,isArchived:!1},{id:4,type:"draft",from:"Admin",fromEmail:"admin@elderx.com",to:"All Caregivers",toEmail:"caregivers@elderx.com",subject:"Monthly Training Session",content:"We will be conducting a monthly training session on...",timestamp:"2024-01-19T09:00:00Z",status:"draft",priority:"medium",category:"announcement",attachments:[],tags:["training","caregivers","announcement"],replyCount:0,isStarred:!1,isArchived:!1}]),a([{id:1,type:"system",title:"System Maintenance Scheduled",message:"Scheduled maintenance will occur on January 25th from 2:00 AM to 4:00 AM",timestamp:"2024-01-20T12:00:00Z",status:"unread",priority:"medium",category:"system",actionRequired:!1,isRead:!1},{id:2,type:"emergency",title:"Emergency Alert - Adunni Okafor",message:"Emergency alert triggered by Adunni Okafor. Response time: 3 minutes",timestamp:"2024-01-20T11:30:00Z",status:"active",priority:"high",category:"emergency",actionRequired:!0,isRead:!1},{id:3,type:"medication",title:"Medication Compliance Alert",message:"12 patients have missed their medication doses today",timestamp:"2024-01-20T10:00:00Z",status:"read",priority:"medium",category:"medication",actionRequired:!0,isRead:!0},{id:4,type:"caregiver",title:"New Caregiver Registration",message:"Sarah Williams has completed her registration and is ready for approval",timestamp:"2024-01-19T15:20:00Z",status:"read",priority:"low",category:"caregiver",actionRequired:!0,isRead:!0}]),c([{id:1,name:"Welcome Message",subject:"Welcome to ElderX - Your Health Companion",content:"Dear {{name}}, welcome to ElderX! We're excited to be part of your health journey...",category:"welcome",variables:["name","email"],usageCount:45,lastUsed:"2024-01-15T10:00:00Z",isActive:!0},{id:2,name:"Medication Reminder",subject:"Medication Reminder - {{medicationName}}",content:"Hello {{name}}, this is a reminder to take your {{medicationName}} at {{time}}...",category:"medication",variables:["name","medicationName","time"],usageCount:234,lastUsed:"2024-01-20T08:00:00Z",isActive:!0},{id:3,name:"Emergency Contact",subject:"Emergency Alert - {{patientName}}",content:"EMERGENCY ALERT: {{patientName}} has triggered an emergency alert at {{time}}...",category:"emergency",variables:["patientName","time","location"],usageCount:12,lastUsed:"2024-01-20T11:30:00Z",isActive:!0},{id:4,name:"Caregiver Feedback",subject:"Monthly Performance Review - {{caregiverName}}",content:"Hi {{caregiverName}}, here is your monthly performance review...",category:"caregiver",variables:["caregiverName","rating","feedback"],usageCount:67,lastUsed:"2024-01-18T14:00:00Z",isActive:!0}]),d([{id:1,name:"Monthly Health Check Reminder",subject:"Monthly Health Check Reminder",content:"Dear {{name}}, it's time for your monthly health check...",status:"scheduled",scheduledDate:"2024-01-25T09:00:00Z",recipientCount:1247,sentCount:0,openedCount:0,clickedCount:0,category:"health",targetAudience:"all_users",createdAt:"2024-01-20T10:00:00Z"},{id:2,name:"Caregiver Training Announcement",subject:"Upcoming Caregiver Training Session",content:"Dear caregivers, we have an upcoming training session...",status:"sent",scheduledDate:"2024-01-18T14:00:00Z",recipientCount:89,sentCount:89,openedCount:67,clickedCount:23,category:"training",targetAudience:"caregivers",createdAt:"2024-01-17T16:00:00Z"},{id:3,name:"System Update Notification",subject:"ElderX Platform Update",content:"We've released new features to improve your experience...",status:"draft",scheduledDate:null,recipientCount:0,sentCount:0,openedCount:0,clickedCount:0,category:"announcement",targetAudience:"all_users",createdAt:"2024-01-19T11:00:00Z"}]),h(!1)},1e3)}catch(e){console.error("Error loading communication data:",e),h(!1)}},T=e=>{N(t=>Le(Le({},t),{},{[e]:!t[e]}))},C=e=>{switch(e){case"unread":return"bg-blue-100 text-blue-800";case"read":default:return"bg-gray-100 text-gray-800";case"sent":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"archived":return"bg-purple-100 text-purple-800";case"active":return"bg-red-100 text-red-800"}},R=e=>{switch(e){case"high":return"text-red-600";case"medium":return"text-yellow-600";case"low":return"text-green-600";default:return"text-gray-600"}},I=e=>{switch(e){case"support":default:return(0,Kg.jsx)(Ny,{className:"h-4 w-4"});case"emergency":return(0,Kg.jsx)(Zg,{className:"h-4 w-4"});case"medication":return(0,Kg.jsx)(cy,{className:"h-4 w-4"});case"caregiver":return(0,Kg.jsx)(by,{className:"h-4 w-4"});case"system":return(0,Kg.jsx)(Ry,{className:"h-4 w-4"});case"announcement":return(0,Kg.jsx)(fy,{className:"h-4 w-4"})}},A=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},O=(e,t)=>{if(m(t),"view"===e)g(!0)},j=n.filter(e=>{const t=e.subject.toLowerCase().includes(x.toLowerCase())||e.from.toLowerCase().includes(x.toLowerCase())||e.content.toLowerCase().includes(x.toLowerCase()),s="all"===E||e.status===E;return t&&s});return u?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Communication Center"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage messages, notifications, and communication campaigns"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{onClick:()=>v(!0),className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Compose"]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Cy,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(Ny,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Messages"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:n.length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Kg.jsx)(fy,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Unread Notifications"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(e=>!e.isRead).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(xv,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Campaigns"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:l.filter(e=>"sent"===e.status||"scheduled"===e.status).length})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(Ty,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Templates"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:o.length})]})]})})]}),(0,Kg.jsx)("div",{className:"border-b border-gray-200",children:(0,Kg.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{id:"messages",name:"Messages",icon:Ny},{id:"notifications",name:"Notifications",icon:fy},{id:"templates",name:"Templates",icon:Ty},{id:"campaigns",name:"Campaigns",icon:xv}].map(t=>{const n=t.icon;return(0,Kg.jsxs)("button",{onClick:()=>s(t.id),className:"flex items-center py-2 px-1 border-b-2 font-medium text-sm ".concat(e===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,Kg.jsx)(n,{className:"h-4 w-4 mr-2"}),t.name]},t.id)})})}),"messages"===e&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search messages...",className:"form-input pl-10",value:x,onChange:e=>_(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:E,onChange:e=>b(e.target.value),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"unread",children:"Unread"}),(0,Kg.jsx)("option",{value:"read",children:"Read"}),(0,Kg.jsx)("option",{value:"sent",children:"Sent"}),(0,Kg.jsx)("option",{value:"draft",children:"Draft"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("inbox"),children:[(0,Kg.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Inbox (",n.filter(e=>"inbox"===e.type).length,")"]}),w.inbox?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),w.inbox&&(0,Kg.jsx)("div",{className:"mt-4 space-y-3",children:j.filter(e=>"inbox"===e.type).map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[I(e.category),(0,Kg.jsx)("span",{className:"font-medium text-gray-900",children:e.from}),(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:e.fromEmail})]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status}),(0,Kg.jsxs)("span",{className:"text-xs ".concat(R(e.priority)),children:[e.priority," priority"]})]}),(0,Kg.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Kg.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.tags.map((e,t)=>(0,Kg.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},t))]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[e.isStarred&&(0,Kg.jsx)(Uy,{className:"h-4 w-4 text-yellow-400"}),(0,Kg.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"View Message",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>O("reply",e),className:"text-green-600 hover:text-green-800",title:"Reply",children:(0,Kg.jsx)(Rx,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>O("archive",e),className:"text-purple-600 hover:text-purple-800",title:"Archive",children:(0,Kg.jsx)(Ix,{className:"h-4 w-4"})})]})]})},e.id))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("sent"),children:[(0,Kg.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Sent (",n.filter(e=>"sent"===e.type).length,")"]}),w.sent?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),w.sent&&(0,Kg.jsx)("div",{className:"mt-4 space-y-3",children:j.filter(e=>"sent"===e.type).map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)(xv,{className:"h-4 w-4"}),(0,Kg.jsxs)("span",{className:"font-medium text-gray-900",children:["To: ",e.to]}),(0,Kg.jsx)("span",{className:"text-sm text-gray-500",children:e.toEmail})]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})]}),(0,Kg.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Kg.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.tags.map((e,t)=>(0,Kg.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e},t))]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[e.isStarred&&(0,Kg.jsx)(Uy,{className:"h-4 w-4 text-yellow-400"}),(0,Kg.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"View Message",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>O("forward",e),className:"text-blue-600 hover:text-blue-800",title:"Forward",children:(0,Kg.jsx)(Ax,{className:"h-4 w-4"})})]})]})},e.id))})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>T("drafts"),children:[(0,Kg.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Drafts (",n.filter(e=>"draft"===e.type).length,")"]}),w.drafts?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),w.drafts&&(0,Kg.jsx)("div",{className:"mt-4 space-y-3",children:j.filter(e=>"draft"===e.type).map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)(Xy,{className:"h-4 w-4"}),(0,Kg.jsx)("span",{className:"font-medium text-gray-900",children:"Draft"})]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})]}),(0,Kg.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-1",children:e.subject}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.content}),(0,Kg.jsx)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:(0,Kg.jsxs)("span",{children:["Last saved: ",A(e.timestamp).date," at ",A(e.timestamp).time]})})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,Kg.jsx)("button",{onClick:()=>O("view",e),className:"text-blue-600 hover:text-blue-800",title:"Edit Draft",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{onClick:()=>O("delete",e),className:"text-red-600 hover:text-red-800",title:"Delete Draft",children:(0,Kg.jsx)(Jy,{className:"h-4 w-4"})})]})]})},e.id))})]})]})]}),"notifications"===e&&(0,Kg.jsx)("div",{className:"space-y-6",children:(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Notifications"}),(0,Kg.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,Kg.jsx)("div",{className:"border rounded-lg p-4 ".concat(e.isRead?"bg-gray-50":"bg-white border-blue-200"),children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"p-2 rounded-full ".concat("emergency"===e.category?"bg-red-100":"system"===e.category?"bg-blue-100":"bg-gray-100"),children:I(e.category)}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,Kg.jsx)("h3",{className:"text-md font-medium text-gray-900",children:e.title}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status}),(0,Kg.jsxs)("span",{className:"text-xs ".concat(R(e.priority)),children:[e.priority," priority"]})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,Kg.jsxs)("span",{children:[A(e.timestamp).date," at ",A(e.timestamp).time]}),e.actionRequired&&(0,Kg.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Action Required"})]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),e.actionRequired&&(0,Kg.jsx)("button",{className:"btn btn-primary text-sm",children:"Take Action"})]})]})},e.id))})]})}),"templates"===e&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Message Templates"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Create Template"]})]}),(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(e=>(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Kg.jsx)("h3",{className:"text-md font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.subject}),(0,Kg.jsx)("p",{className:"text-sm text-gray-500 mb-3 line-clamp-3",children:e.content}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[(0,Kg.jsxs)("span",{children:["Used ",e.usageCount," times"]}),(0,Kg.jsxs)("span",{children:["Last used: ",A(e.lastUsed).date]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsxs)("button",{className:"btn btn-primary text-sm flex-1",children:[(0,Kg.jsx)(Xy,{className:"h-3 w-3 mr-1"}),"Edit"]}),(0,Kg.jsx)("button",{className:"btn btn-secondary text-sm",children:(0,Kg.jsx)(rv,{className:"h-3 w-3"})})]})]},e.id))})]}),"campaigns"===e&&(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Communication Campaigns"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(qy,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campaign"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recipients"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Engagement"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Scheduled"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(e=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.subject})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.recipientCount}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,Kg.jsxs)("div",{className:"text-xs",children:[(0,Kg.jsxs)("div",{children:["Opened: ",e.openedCount]}),(0,Kg.jsxs)("div",{children:["Clicked: ",e.clickedCount]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.scheduledDate?A(e.scheduledDate).date:"Not scheduled"}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{className:"text-green-600 hover:text-green-900",children:(0,Kg.jsx)(Xy,{className:"h-4 w-4"})}),(0,Kg.jsx)("button",{className:"text-red-600 hover:text-red-900",children:(0,Kg.jsx)(Jy,{className:"h-4 w-4"})})]})})]},e.id))})]})})})]}),f&&p&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:p.subject}),(0,Kg.jsxs)("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Kg.jsxs)("span",{children:[(0,Kg.jsx)("strong",{children:"From:"})," ",p.from," (",p.fromEmail,")"]}),(0,Kg.jsxs)("span",{children:[(0,Kg.jsx)("strong",{children:"To:"})," ",p.to]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,Kg.jsxs)("span",{children:[(0,Kg.jsx)("strong",{children:"Date:"})," ",A(p.timestamp).date," at ",A(p.timestamp).time]}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(p.status)),children:p.status})]}),(0,Kg.jsx)("div",{className:"border-t pt-4",children:(0,Kg.jsx)("p",{className:"text-gray-900 whitespace-pre-wrap",children:p.content})}),p.tags.length>0&&(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Tags:"}),p.tags.map((e,t)=>(0,Kg.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs",children:e},t))]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>g(!1),className:"btn btn-secondary",children:"Close"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Rx,{className:"h-4 w-4 mr-2"}),"Reply"]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(Ax,{className:"h-4 w-4 mr-2"}),"Forward"]})]})]})})})]})},jx=Qg("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),kx=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(!0),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(null),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)({action:"all",user:"all",resource:"all",status:"all",dateRange:"all",severity:"all"}),[f,g]=(0,t.useState)({overview:!0,recent:!0,security:!1,system:!1,user:!1,data:!1}),[y,v]=(0,t.useState)({totalLogs:0,todayLogs:0,securityEvents:0,systemEvents:0,userEvents:0,dataEvents:0,criticalEvents:0,warningEvents:0});(0,t.useEffect)(()=>{x()},[]),(0,t.useEffect)(()=>{_()},[e,o,p]);const x=async()=>{try{a(!0),setTimeout(()=>{const e=[{id:1,timestamp:"2024-01-20T14:30:00Z",action:"LOGIN",user:"admin@elderx.com",userId:"admin_001",resource:"Authentication",resourceId:"auth_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{loginMethod:"email_password",sessionId:"sess_abc123",location:"Lagos, Nigeria"},changes:null,category:"security"},{id:2,timestamp:"2024-01-20T14:25:00Z",action:"CREATE",user:"admin@elderx.com",userId:"admin_001",resource:"Caregiver",resourceId:"caregiver_002",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{caregiverName:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890"},changes:{before:null,after:{name:"Sarah Williams",email:"sarah@example.com",phone:"+234 803 456 7890",status:"pending"}},category:"user"},{id:3,timestamp:"2024-01-20T14:20:00Z",action:"UPDATE",user:"admin@elderx.com",userId:"admin_001",resource:"Medication",resourceId:"med_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{medicationName:"Metformin",patientId:"patient_001",dosage:"500mg"},changes:{before:{dosage:"250mg",frequency:"twice daily"},after:{dosage:"500mg",frequency:"once daily"}},category:"data"},{id:4,timestamp:"2024-01-20T14:15:00Z",action:"DELETE",user:"admin@elderx.com",userId:"admin_001",resource:"Appointment",resourceId:"appt_003",status:"SUCCESS",severity:"WARNING",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{appointmentDate:"2024-01-25",patientName:"Adunni Okafor",doctorName:"Dr. Kemi Adebayo",reason:"Patient requested cancellation"},changes:{before:{status:"scheduled",date:"2024-01-25T10:00:00Z"},after:null},category:"system"},{id:5,timestamp:"2024-01-20T14:10:00Z",action:"LOGIN_FAILED",user:"unknown@example.com",userId:null,resource:"Authentication",resourceId:"auth_002",status:"FAILED",severity:"WARNING",ipAddress:"192.168.1.200",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{loginMethod:"email_password",failureReason:"Invalid password",attemptCount:3},changes:null,category:"security"},{id:6,timestamp:"2024-01-20T14:05:00Z",action:"PERMISSION_CHANGE",user:"admin@elderx.com",userId:"admin_001",resource:"User",resourceId:"user_005",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{targetUser:"caregiver@example.com",permissionType:"admin_access"},changes:{before:{role:"caregiver",permissions:["read_patients","update_medications"]},after:{role:"admin",permissions:["read_patients","update_medications","manage_users","view_analytics"]}},category:"security"},{id:7,timestamp:"2024-01-20T14:00:00Z",action:"DATA_EXPORT",user:"admin@elderx.com",userId:"admin_001",resource:"Patient Data",resourceId:"export_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{exportType:"patient_medications",recordCount:1247,format:"CSV",purpose:"Monthly report"},changes:null,category:"data"},{id:8,timestamp:"2024-01-20T13:55:00Z",action:"SYSTEM_CONFIG",user:"admin@elderx.com",userId:"admin_001",resource:"System Settings",resourceId:"config_001",status:"SUCCESS",severity:"INFO",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",details:{settingName:"notification_frequency",settingValue:"immediate"},changes:{before:{notification_frequency:"hourly"},after:{notification_frequency:"immediate"}},category:"system"},{id:9,timestamp:"2024-01-20T13:50:00Z",action:"EMERGENCY_ALERT",user:"system",userId:"system",resource:"Emergency System",resourceId:"emergency_001",status:"SUCCESS",severity:"CRITICAL",ipAddress:"system",userAgent:"ElderX Emergency System",details:{patientId:"patient_003",patientName:"Grace Johnson",alertType:"fall_detected",location:"Lagos, Nigeria",responseTime:"2 minutes"},changes:null,category:"system"},{id:10,timestamp:"2024-01-20T13:45:00Z",action:"BACKUP",user:"system",userId:"system",resource:"Database",resourceId:"backup_001",status:"SUCCESS",severity:"INFO",ipAddress:"system",userAgent:"ElderX Backup System",details:{backupType:"full_database",size:"2.5GB",duration:"15 minutes",location:"cloud_storage"},changes:null,category:"system"}],t=e.length,n=e.filter(e=>{const t=new Date(e.timestamp),s=new Date;return t.toDateString()===s.toDateString()}).length,r=e.filter(e=>"security"===e.category).length,i=e.filter(e=>"system"===e.category).length,o=e.filter(e=>"user"===e.category).length,c=e.filter(e=>"data"===e.category).length,l=e.filter(e=>"CRITICAL"===e.severity).length,d=e.filter(e=>"WARNING"===e.severity).length;v({totalLogs:t,todayLogs:n,securityEvents:r,systemEvents:i,userEvents:o,dataEvents:c,criticalEvents:l,warningEvents:d}),s(e),a(!1)},1e3)}catch(e){console.error("Error loading audit logs:",e),a(!1)}},_=()=>{let t=e;o&&(t=t.filter(e=>e.action.toLowerCase().includes(o.toLowerCase())||e.user.toLowerCase().includes(o.toLowerCase())||e.resource.toLowerCase().includes(o.toLowerCase())||e.details&&JSON.stringify(e.details).toLowerCase().includes(o.toLowerCase()))),"all"!==p.action&&(t=t.filter(e=>e.action===p.action)),"all"!==p.user&&(t=t.filter(e=>e.user===p.user)),"all"!==p.resource&&(t=t.filter(e=>e.resource===p.resource)),"all"!==p.status&&(t=t.filter(e=>e.status===p.status)),"all"!==p.severity&&(t=t.filter(e=>e.severity===p.severity)),r(t)},E=e=>{switch(e){case"CRITICAL":return"bg-red-100 text-red-800 border-red-200";case"WARNING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"INFO":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},b=e=>{switch(e){case"SUCCESS":return"bg-green-100 text-green-800";case"FAILED":return"bg-red-100 text-red-800";case"PENDING":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},w=e=>{switch(e){case"security":return(0,Kg.jsx)(Ry,{className:"h-4 w-4"});case"system":return(0,Kg.jsx)(Cy,{className:"h-4 w-4"});case"user":return(0,Kg.jsx)(gy,{className:"h-4 w-4"});case"data":return(0,Kg.jsx)(gx,{className:"h-4 w-4"});default:return(0,Kg.jsx)(_y,{className:"h-4 w-4"})}},N=e=>{switch(e){case"LOGIN":return(0,Kg.jsx)(jx,{className:"h-4 w-4"});case"LOGOUT":return(0,Kg.jsx)(Wy,{className:"h-4 w-4"});case"CREATE":return(0,Kg.jsx)(qy,{className:"h-4 w-4"});case"UPDATE":return(0,Kg.jsx)(Xy,{className:"h-4 w-4"});case"DELETE":return(0,Kg.jsx)(Jy,{className:"h-4 w-4"});case"LOGIN_FAILED":return(0,Kg.jsx)(Yy,{className:"h-4 w-4"});case"PERMISSION_CHANGE":return(0,Kg.jsx)(Ry,{className:"h-4 w-4"});case"DATA_EXPORT":return(0,Kg.jsx)(Tv,{className:"h-4 w-4"});case"SYSTEM_CONFIG":return(0,Kg.jsx)(Cy,{className:"h-4 w-4"});case"EMERGENCY_ALERT":return(0,Kg.jsx)(Zg,{className:"h-4 w-4"});case"BACKUP":return(0,Kg.jsx)(gx,{className:"h-4 w-4"});default:return(0,Kg.jsx)(_y,{className:"h-4 w-4"})}},S=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),full:t.toLocaleString()}};return i?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Audit Logs"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Comprehensive system activity and security monitoring"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsxs)("button",{onClick:x,className:"btn btn-secondary",children:[(0,Kg.jsx)($g,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,Kg.jsxs)("button",{onClick:()=>{console.log("Exporting logs...")},className:"btn btn-primary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(Ty,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Logs"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.totalLogs})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Dy,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Today's Events"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.todayLogs})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Critical Events"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.criticalEvents})]})]})}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,Kg.jsx)(Ry,{className:"h-6 w-6 text-yellow-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Security Events"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y.securityEvents})]})]})})]}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>{return e="overview",void g(t=>Le(Le({},t),{},{[e]:!t[e]}));var e},children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Activity Overview"}),f.overview?(0,Kg.jsx)(Tx,{className:"h-5 w-5"}):(0,Kg.jsx)($y,{className:"h-5 w-5"})]}),f.overview&&(0,Kg.jsx)("div",{className:"mt-6",children:(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,Kg.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Kg.jsx)(Ry,{className:"h-6 w-6 text-blue-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.securityEvents})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Security Events"})]}),(0,Kg.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Kg.jsx)(Cy,{className:"h-6 w-6 text-green-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.systemEvents})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"System Events"})]}),(0,Kg.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Kg.jsx)(gy,{className:"h-6 w-6 text-purple-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.userEvents})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"User Events"})]}),(0,Kg.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,Kg.jsx)(gx,{className:"h-6 w-6 text-orange-600 mr-2"}),(0,Kg.jsx)("span",{className:"text-lg font-bold text-gray-900",children:y.dataEvents})]}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Data Events"})]})]})})]}),(0,Kg.jsx)("div",{className:"card",children:(0,Kg.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,Kg.jsx)("div",{className:"flex-1",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search audit logs...",className:"form-input pl-10",value:o,onChange:e=>c(e.target.value)})]})}),(0,Kg.jsxs)("div",{className:"flex gap-2",children:[(0,Kg.jsxs)("select",{className:"form-input",value:p.action,onChange:e=>m(Le(Le({},p),{},{action:e.target.value})),children:[(0,Kg.jsx)("option",{value:"all",children:"All Actions"}),(0,Kg.jsx)("option",{value:"LOGIN",children:"Login"}),(0,Kg.jsx)("option",{value:"LOGOUT",children:"Logout"}),(0,Kg.jsx)("option",{value:"CREATE",children:"Create"}),(0,Kg.jsx)("option",{value:"UPDATE",children:"Update"}),(0,Kg.jsx)("option",{value:"DELETE",children:"Delete"}),(0,Kg.jsx)("option",{value:"LOGIN_FAILED",children:"Login Failed"}),(0,Kg.jsx)("option",{value:"PERMISSION_CHANGE",children:"Permission Change"}),(0,Kg.jsx)("option",{value:"DATA_EXPORT",children:"Data Export"}),(0,Kg.jsx)("option",{value:"SYSTEM_CONFIG",children:"System Config"}),(0,Kg.jsx)("option",{value:"EMERGENCY_ALERT",children:"Emergency Alert"}),(0,Kg.jsx)("option",{value:"BACKUP",children:"Backup"})]}),(0,Kg.jsxs)("select",{className:"form-input",value:p.status,onChange:e=>m(Le(Le({},p),{},{status:e.target.value})),children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"SUCCESS",children:"Success"}),(0,Kg.jsx)("option",{value:"FAILED",children:"Failed"}),(0,Kg.jsx)("option",{value:"PENDING",children:"Pending"})]}),(0,Kg.jsxs)("select",{className:"form-input",value:p.severity,onChange:e=>m(Le(Le({},p),{},{severity:e.target.value})),children:[(0,Kg.jsx)("option",{value:"all",children:"All Severity"}),(0,Kg.jsx)("option",{value:"CRITICAL",children:"Critical"}),(0,Kg.jsx)("option",{value:"WARNING",children:"Warning"}),(0,Kg.jsx)("option",{value:"INFO",children:"Info"}),(0,Kg.jsx)("option",{value:"DEBUG",children:"Debug"})]}),(0,Kg.jsxs)("button",{className:"btn btn-secondary",children:[(0,Kg.jsx)(ov,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})]})}),(0,Kg.jsxs)("div",{className:"card",children:[(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Resource"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Severity"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:S(e.timestamp).date}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:S(e.timestamp).time})]}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[N(e.action),(0,Kg.jsx)("span",{className:"ml-2 text-sm font-medium text-gray-900",children:e.action})]})}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsx)("div",{className:"text-sm text-gray-900",children:e.user}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.ipAddress})]}),(0,Kg.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[w(e.category),(0,Kg.jsx)("span",{className:"ml-2 text-sm text-gray-900",children:e.resource})]}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.resourceId})]}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(b(e.status)),children:e.status})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(E(e.severity)),children:e.severity})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsx)("button",{onClick:()=>((e,t)=>{d(t),"view"===e&&h(!0)})("view",e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})})})]},e.id))})]})}),0===n.length&&(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(Ty,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,Kg.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No audit logs found"}),(0,Kg.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o||Object.values(p).some(e=>"all"!==e)?"Try adjusting your search or filter criteria.":"No audit logs have been recorded yet."})]})]}),u&&l&&(0,Kg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,Kg.jsx)("div",{className:"relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white",children:(0,Kg.jsxs)("div",{className:"mt-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[N(l.action),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:l.action}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(E(l.severity)),children:l.severity})]}),(0,Kg.jsxs)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:[(0,Kg.jsx)("span",{className:"sr-only",children:"Close"}),(0,Kg.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Kg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Event Information"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Timestamp:"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:S(l.timestamp).full})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"User:"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:l.user})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"IP Address:"}),(0,Kg.jsx)("span",{className:"text-sm text-gray-900",children:l.ipAddress})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Status:"}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(b(l.status)),children:l.status})]}),(0,Kg.jsxs)("div",{className:"flex justify-between",children:[(0,Kg.jsx)("span",{className:"text-sm text-gray-600",children:"Resource:"}),(0,Kg.jsxs)("span",{className:"text-sm text-gray-900",children:[l.resource," (",l.resourceId,")"]})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Technical Details"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"User Agent"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-900 break-all",children:l.userAgent})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,Kg.jsxs)("div",{className:"flex items-center",children:[w(l.category),(0,Kg.jsx)("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:l.category})]})]})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Event Details"}),(0,Kg.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,Kg.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.details,null,2)})})]}),l.changes&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-3",children:"Changes"}),(0,Kg.jsxs)("div",{className:"space-y-3",children:[l.changes.before&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Before:"}),(0,Kg.jsx)("div",{className:"bg-red-50 rounded-lg p-3",children:(0,Kg.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.changes.before,null,2)})})]}),l.changes.after&&(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"After:"}),(0,Kg.jsx)("div",{className:"bg-green-50 rounded-lg p-3",children:(0,Kg.jsx)("pre",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:JSON.stringify(l.changes.after,null,2)})})]})]})]})]})]}),(0,Kg.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>h(!1),className:"btn btn-secondary",children:"Close"}),(0,Kg.jsxs)("button",{className:"btn btn-primary",children:[(0,Kg.jsx)(Tv,{className:"h-4 w-4 mr-2"}),"Export Log"]})]})]})})})]})},Dx="patients",Px="appointments",Lx="careTasks",Mx="messages",Ux="conversations",Vx=async e=>{try{const t=Nf(Um(Lg,Ux),Tf("participants","array-contains",e),If("lastMessageTime","desc")),s=await Hf(t),n=[];return s.forEach(e=>{var t,s,r,i,a,o;const c=e.data();n.push(Le(Le({id:e.id},c),{},{lastMessageTime:(null===(t=c.lastMessageTime)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||c.lastMessageTime,createdAt:(null===(r=c.createdAt)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||c.createdAt,updatedAt:(null===(a=c.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||c.updatedAt}))}),n}catch(t){throw console.error("Error fetching conversations:",t),t}},Fx=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const s=Nf(Um(Lg,Mx),Tf("conversationId","==",e),If("createdAt","desc"),Of(t)),n=await Hf(s),r=[];return n.forEach(e=>{var t,s;const n=e.data();r.push(Le(Le({id:e.id},n),{},{createdAt:(null===(t=n.createdAt)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||n.createdAt}))}),r.reverse()}catch(s){throw console.error("Error fetching messages:",s),s}},Bx=e=>{var t;let{userProfile:s,userRole:n}=e;return(0,Kg.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(()=>{switch(n){case"doctor":return(0,Kg.jsx)(Oy,{className:"h-6 w-6 text-blue-600"});case"caregiver":return(0,Kg.jsx)(by,{className:"h-6 w-6 text-green-600"});default:return(0,Kg.jsx)(xy,{className:"h-6 w-6 text-gray-600"})}})()}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:(()=>{switch(n){case"doctor":return"Medical Dashboard";case"caregiver":return"Care Dashboard";default:return"Service Provider Dashboard"}})()}),(0,Kg.jsxs)("p",{className:"text-gray-600",children:["Welcome back, ",(null===s||void 0===s?void 0:s.name)||"User"]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsxs)("div",{className:"text-right",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null===s||void 0===s?void 0:s.name}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:n})]}),(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:(null===s||void 0===s||null===(t=s.name)||void 0===t?void 0:t.split(" ").map(e=>e[0]).join(""))||"U"})})]})]})})},Gx=e=>{let{userRole:t,stats:s,loading:n}=e;const r="doctor"===t?[{label:"Patients",value:s.patients||0,icon:xy,color:"blue"},{label:"Today's Appointments",value:s.todaysAppointments||0,icon:oy,color:"green"},{label:"Upcoming",value:s.upcomingAppointments||0,icon:Dy,color:"purple"},{label:"Unread Messages",value:s.unreadMessages||0,icon:Ny,color:"orange"}]:"caregiver"===t?[{label:"Assigned Patients",value:s.patients||0,icon:xy,color:"blue"},{label:"Today's Tasks",value:s.todaysTasks||0,icon:Sy,color:"green"},{label:"Pending Tasks",value:s.pendingTasks||0,icon:Dy,color:"purple"},{label:"Unread Messages",value:s.unreadMessages||0,icon:Ny,color:"orange"}]:[];return(0,Kg.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 p-6",children:r.map((e,t)=>{const s=e.icon;return(0,Kg.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.label}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value})]}),(0,Kg.jsx)("div",{className:"p-3 rounded-full ".concat({blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",purple:"bg-purple-100 text-purple-600",orange:"bg-orange-100 text-orange-600"}[e.color]),children:(0,Kg.jsx)(s,{className:"h-6 w-6"})})]})},t)})})},Wx=e=>{let{userProfile:s}=e;const[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)([]);return(0,t.useEffect)(()=>{r([{id:1,name:"Adunni Okafor",lastVisit:"2024-01-20",condition:"Hypertension",status:"stable"},{id:2,name:"Grace Johnson",lastVisit:"2024-01-19",condition:"Diabetes",status:"improving"}]),a([{id:1,patient:"Samuel Adekunle",time:"10:00 AM",type:"Follow-up"},{id:2,patient:"Maryam Ibrahim",time:"2:00 PM",type:"Initial Consultation"}])},[]),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Kg.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Patients"}),(0,Kg.jsx)(xy,{className:"h-5 w-5 text-gray-400"})]})}),(0,Kg.jsx)("div",{className:"p-6",children:(0,Kg.jsx)("div",{className:"space-y-4",children:n.map(e=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.condition})]}),(0,Kg.jsxs)("div",{className:"text-right",children:[(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.lastVisit}),(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("stable"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.status})]})]},e.id))})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Kg.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Upcoming Consultations"}),(0,Kg.jsx)(oy,{className:"h-5 w-5 text-gray-400"})]})}),(0,Kg.jsx)("div",{className:"p-6",children:(0,Kg.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.patient}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.type})]}),(0,Kg.jsx)("div",{className:"text-right",children:(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.time})})]},e.id))})})]})]})},Hx=e=>{let{userProfile:s}=e;const[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)([]);return(0,t.useEffect)(()=>{r([{id:1,patient:"Adunni Okafor",task:"Morning medication",time:"8:00 AM",completed:!1},{id:2,patient:"Grace Johnson",task:"Physical therapy",time:"10:00 AM",completed:!0}]),a([{id:1,patient:"Samuel Adekunle",type:"Photo Update",time:"2 hours ago"},{id:2,patient:"Maryam Ibrahim",type:"Care Log",time:"4 hours ago"}])},[]),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Kg.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Tasks"}),(0,Kg.jsx)(Sy,{className:"h-5 w-5 text-gray-400"})]})}),(0,Kg.jsx)("div",{className:"p-6",children:(0,Kg.jsx)("div",{className:"space-y-4",children:n.map(e=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("input",{type:"checkbox",checked:e.completed,className:"h-4 w-4 text-blue-600 rounded"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.task}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.patient})]})]}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.time})]},e.id))})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Kg.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Updates"}),(0,Kg.jsx)(_y,{className:"h-5 w-5 text-gray-400"})]})}),(0,Kg.jsx)("div",{className:"p-6",children:(0,Kg.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.type}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.patient})]}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:e.time})]},e.id))})})]})]})},Kx=()=>{const{userProfile:e,userRole:s,loading:n}=qg(),[r,i]=(0,t.useState)({patients:0,todaysAppointments:0,upcomingAppointments:0,todaysTasks:0,pendingTasks:0,unreadMessages:0}),[a,o]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{(async()=>{if(e&&s)try{o(!0);const t=[];"doctor"===s?t.push((async e=>{try{const t=Nf(Um(Lg,Dx),Tf("assignedDoctor","==",e),If("createdAt","desc")),s=await Hf(t),n=[];return s.forEach(e=>{var t,s,r,i,a,o,c,l;const d=e.data();n.push(Le(Le({id:e.id},d),{},{dateOfBirth:(null===(t=d.dateOfBirth)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||d.dateOfBirth,createdAt:(null===(r=d.createdAt)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||d.createdAt,updatedAt:(null===(a=d.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.updatedAt,lastVisit:(null===(c=d.lastVisit)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.lastVisit}))}),n}catch(t){throw console.error("Error fetching patients by doctor:",t),t}})(e.id)):"caregiver"===s?t.push((async e=>{try{const t=Nf(Um(Lg,Dx),Tf("assignedCaregiver","==",e),If("createdAt","desc")),s=await Hf(t),n=[];return s.forEach(e=>{var t,s,r,i,a,o,c,l;const d=e.data();n.push(Le(Le({id:e.id},d),{},{dateOfBirth:(null===(t=d.dateOfBirth)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||d.dateOfBirth,createdAt:(null===(r=d.createdAt)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||d.createdAt,updatedAt:(null===(a=d.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.updatedAt,lastVisit:(null===(c=d.lastVisit)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.lastVisit}))}),n}catch(t){throw console.error("Error fetching patients by caregiver:",t),t}})(e.id)):t.push(Promise.resolve([])),t.push((async(e,t)=>{try{const s=new Date;s.setHours(0,0,0,0);const n=new Date(s);n.setDate(n.getDate()+1);const r=Um(Lg,Px);let i;if("doctor"===t)i=Nf(r,Tf("doctorId","==",e),Tf("scheduledTime",">=",Zo.fromDate(s)),Tf("scheduledTime","<",Zo.fromDate(n)),If("scheduledTime","asc"));else if("caregiver"===t)i=Nf(r,Tf("caregiverId","==",e),Tf("scheduledTime",">=",Zo.fromDate(s)),Tf("scheduledTime","<",Zo.fromDate(n)),If("scheduledTime","asc"));else{if("elderly"!==t)throw new Error("Invalid user role");i=Nf(r,Tf("patientId","==",e),Tf("scheduledTime",">=",Zo.fromDate(s)),Tf("scheduledTime","<",Zo.fromDate(n)),If("scheduledTime","asc"))}const a=await Hf(i),o=[];return a.forEach(e=>{var t,s,n,r,i,a;const c=e.data();o.push(Le(Le({id:e.id},c),{},{scheduledTime:(null===(t=c.scheduledTime)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||c.scheduledTime,createdAt:(null===(n=c.createdAt)||void 0===n||null===(r=n.toDate)||void 0===r?void 0:r.call(n))||c.createdAt,updatedAt:(null===(i=c.updatedAt)||void 0===i||null===(a=i.toDate)||void 0===a?void 0:a.call(i))||c.updatedAt}))}),o}catch(s){throw console.error("Error fetching today's appointments:",s),s}})(e.id,s)),t.push((async(e,t)=>{try{const s=new Date;s.setHours(0,0,0,0);const n=new Date(s);n.setDate(n.getDate()+7);const r=Um(Lg,Px);let i;if("doctor"===t)i=Nf(r,Tf("doctorId","==",e),Tf("scheduledTime",">=",Zo.fromDate(s)),Tf("scheduledTime","<=",Zo.fromDate(n)),If("scheduledTime","asc"));else if("caregiver"===t)i=Nf(r,Tf("caregiverId","==",e),Tf("scheduledTime",">=",Zo.fromDate(s)),Tf("scheduledTime","<=",Zo.fromDate(n)),If("scheduledTime","asc"));else{if("elderly"!==t)throw new Error("Invalid user role");i=Nf(r,Tf("patientId","==",e),Tf("scheduledTime",">=",Zo.fromDate(s)),Tf("scheduledTime","<=",Zo.fromDate(n)),If("scheduledTime","asc"))}const a=await Hf(i),o=[];return a.forEach(e=>{var t,s,n,r,i,a;const c=e.data();o.push(Le(Le({id:e.id},c),{},{scheduledTime:(null===(t=c.scheduledTime)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||c.scheduledTime,createdAt:(null===(n=c.createdAt)||void 0===n||null===(r=n.toDate)||void 0===r?void 0:r.call(n))||c.createdAt,updatedAt:(null===(i=c.updatedAt)||void 0===i||null===(a=i.toDate)||void 0===a?void 0:a.call(i))||c.updatedAt}))}),o}catch(s){throw console.error("Error fetching upcoming appointments:",s),s}})(e.id,s)),"caregiver"===s?(t.push((async e=>{try{const t=new Date;t.setHours(0,0,0,0);const s=new Date(t);s.setDate(s.getDate()+1);const n=Nf(Um(Lg,Lx),Tf("caregiverId","==",e),Tf("scheduledTime",">=",Zo.fromDate(t)),Tf("scheduledTime","<",Zo.fromDate(s)),If("scheduledTime","asc")),r=await Hf(n),i=[];return r.forEach(e=>{var t,s,n,r,a,o,c,l;const d=e.data();i.push(Le(Le({id:e.id},d),{},{scheduledTime:(null===(t=d.scheduledTime)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||d.scheduledTime,completedAt:(null===(n=d.completedAt)||void 0===n||null===(r=n.toDate)||void 0===r?void 0:r.call(n))||d.completedAt,createdAt:(null===(a=d.createdAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.createdAt,updatedAt:(null===(c=d.updatedAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.updatedAt}))}),i}catch(t){throw console.error("Error fetching today's care tasks:",t),t}})(e.id)),t.push((async e=>{try{const t=Nf(Um(Lg,Lx),Tf("caregiverId","==",e),Tf("status","==","pending"),If("scheduledTime","asc")),s=await Hf(t),n=[];return s.forEach(e=>{var t,s,r,i,a,o,c,l;const d=e.data();n.push(Le(Le({id:e.id},d),{},{scheduledTime:(null===(t=d.scheduledTime)||void 0===t||null===(s=t.toDate)||void 0===s?void 0:s.call(t))||d.scheduledTime,completedAt:(null===(r=d.completedAt)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||d.completedAt,createdAt:(null===(a=d.createdAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||d.createdAt,updatedAt:(null===(c=d.updatedAt)||void 0===c||null===(l=c.toDate)||void 0===l?void 0:l.call(c))||d.updatedAt}))}),n}catch(t){throw console.error("Error fetching pending care tasks:",t),t}})(e.id))):(t.push(Promise.resolve([])),t.push(Promise.resolve([]))),t.push((async e=>{try{const t=Nf(Um(Lg,Mx),Tf("read","==",!1)),s=await Hf(t);let n=0;return s.forEach(t=>{const s=t.data();t(Lg,Ux,s.conversationId),s.senderId!==e&&n++}),n}catch(t){throw console.error("Error getting unread message count:",t),t}})(e.id));const[n,r,a,c,l,d]=await Promise.all(t);i({patients:n.length,todaysAppointments:r.length,upcomingAppointments:a.length,todaysTasks:c.length,pendingTasks:l.length,unreadMessages:d})}catch(t){console.error("Error loading dashboard data:",t),yt.error("Failed to load dashboard data")}finally{o(!1)}})()},[e,s]),n||a?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Loading dashboard..."})]})}):e?(0,Kg.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Kg.jsx)(Bx,{userProfile:e,userRole:s}),(0,Kg.jsx)(Gx,{userRole:s,stats:r,loading:a}),"doctor"===s&&(0,Kg.jsx)(Wx,{userProfile:e}),"caregiver"===s&&(0,Kg.jsx)(Hx,{userProfile:e})]}):(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("p",{className:"text-gray-600",children:"No user profile found"})})},zx=e=>{let{onClose:s,userRole:n="elderly"}=e;const[r,i]=(0,t.useState)({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",phone:"",dateOfBirth:"",gender:"",address:"",city:"",state:"",zipCode:"",role:n,emergencyContact:{name:"",phone:"",relationship:""},medicalConditions:[],medications:[],allergies:[],insuranceInfo:{provider:"",policyNumber:"",groupNumber:""},qualifications:[],certifications:[],experience:"",hourlyRate:"",availability:{monday:{available:!1,startTime:"",endTime:""},tuesday:{available:!1,startTime:"",endTime:""},wednesday:{available:!1,startTime:"",endTime:""},thursday:{available:!1,startTime:"",endTime:""},friday:{available:!1,startTime:"",endTime:""},saturday:{available:!1,startTime:"",endTime:""},sunday:{available:!1,startTime:"",endTime:""}},services:[],languages:[],medicalLicense:"",specialty:"",hospitalAffiliation:"",education:[],yearsOfExperience:"",permissions:[],department:"",accessLevel:"standard"}),[a,o]=(0,t.useState)(!1),[c,l]=(0,t.useState)(!1),[d,u]=(0,t.useState)(1),[h,p]=(0,t.useState)({}),m="elderly"===n?4:"caregiver"===n?5:"doctor"===n?4:3,f=(e,t)=>{if(e.includes(".")){const[s,n]=e.split(".");i(e=>Le(Le({},e),{},{[s]:Le(Le({},e[s]),{},{[n]:t})}))}else if(e.includes("availability.")){const[,s,n]=e.split(".");i(e=>Le(Le({},e),{},{availability:Le(Le({},e.availability),{},{[s]:Le(Le({},e.availability[s]),{},{[n]:t})})}))}else i(s=>Le(Le({},s),{},{[e]:t}));h[e]&&p(t=>Le(Le({},t),{},{[e]:null}))},g=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"add";"add"===s?i(s=>Le(Le({},s),{},{[e]:[...s[e],t]})):"remove"===s&&i(s=>Le(Le({},s),{},{[e]:s[e].filter((e,s)=>s!==t)}))},y=e=>{const t={};return 1===e&&(r.firstName.trim()||(t.firstName="First name is required"),r.lastName.trim()||(t.lastName="Last name is required"),r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(t.email="Email is invalid"):t.email="Email is required",r.password?r.password.length<6&&(t.password="Password must be at least 6 characters"):t.password="Password is required",r.password!==r.confirmPassword&&(t.confirmPassword="Passwords do not match")),2===e&&(r.phone.trim()||(t.phone="Phone number is required"),r.dateOfBirth||(t.dateOfBirth="Date of birth is required"),r.gender||(t.gender="Gender is required")),"elderly"===n&&3===e&&(r.emergencyContact.name.trim()||(t["emergencyContact.name"]="Emergency contact name is required"),r.emergencyContact.phone.trim()||(t["emergencyContact.phone"]="Emergency contact phone is required")),"caregiver"===n&&3===e&&(r.experience||(t.experience="Experience is required"),r.hourlyRate||(t.hourlyRate="Hourly rate is required")),"doctor"===n&&3===e&&(r.medicalLicense.trim()||(t.medicalLicense="Medical license is required"),r.specialty||(t.specialty="Specialty is required"),r.yearsOfExperience||(t.yearsOfExperience="Years of experience is required")),p(t),0===Object.keys(t).length};return(0,Kg.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["Create ",n.charAt(0).toUpperCase()+n.slice(1)," User"]}),(0,Kg.jsx)("p",{className:"text-gray-600 mt-1",children:(()=>{switch(d){case 1:return"Basic Information";case 2:return"Personal Details";case 3:return"elderly"===n?"Emergency Contact & Medical Info":"caregiver"===n?"Professional Information":"doctor"===n?"Medical Credentials":"Admin Configuration";case 4:return"elderly"===n?"Insurance Information":"Availability Schedule";default:return"Additional Information"}})()})]}),(0,Kg.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(hy,{size:24})})]}),(0,Kg.jsxs)("div",{className:"p-6",children:[(0,Kg.jsxs)("div",{className:"mb-8",children:[(0,Kg.jsx)("div",{className:"flex items-center justify-between mb-2",children:Array.from({length:m},(e,t)=>(0,Kg.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(t+1<=d?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"),children:t+1},t))}),(0,Kg.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,Kg.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(d/m*100,"%")}})})]}),(0,Kg.jsx)("div",{className:"min-h-[400px]",children:(()=>{switch(d){case 1:return(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),(0,Kg.jsx)("input",{type:"text",value:r.firstName,onChange:e=>f("firstName",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.firstName?"border-red-500":"border-gray-300"),placeholder:"Enter first name"}),h.firstName&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.firstName})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),(0,Kg.jsx)("input",{type:"text",value:r.lastName,onChange:e=>f("lastName",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.lastName?"border-red-500":"border-gray-300"),placeholder:"Enter last name"}),h.lastName&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.lastName})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,Kg.jsx)("input",{type:"email",value:r.email,onChange:e=>f("email",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.email?"border-red-500":"border-gray-300"),placeholder:"Enter email address"}),h.email&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.email})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)("input",{type:c?"text":"password",value:r.password,onChange:e=>f("password",e.target.value),className:"w-full px-4 py-2 pr-10 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.password?"border-red-500":"border-gray-300"),placeholder:"Enter password"}),(0,Kg.jsx)("button",{type:"button",onClick:()=>l(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:c?(0,Kg.jsx)(jv,{size:20}):(0,Kg.jsx)(rv,{size:20})})]}),h.password&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.password})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),(0,Kg.jsx)("input",{type:"password",value:r.confirmPassword,onChange:e=>f("confirmPassword",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.confirmPassword?"border-red-500":"border-gray-300"),placeholder:"Confirm password"}),h.confirmPassword&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.confirmPassword})]})]})]});case 2:return(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),(0,Kg.jsx)("input",{type:"tel",value:r.phone,onChange:e=>f("phone",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.phone?"border-red-500":"border-gray-300"),placeholder:"Enter phone number"}),h.phone&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.phone})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth *"}),(0,Kg.jsx)("input",{type:"date",value:r.dateOfBirth,onChange:e=>f("dateOfBirth",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.dateOfBirth?"border-red-500":"border-gray-300")}),h.dateOfBirth&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.dateOfBirth})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender *"}),(0,Kg.jsxs)("select",{value:r.gender,onChange:e=>f("gender",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.gender?"border-red-500":"border-gray-300"),children:[(0,Kg.jsx)("option",{value:"",children:"Select gender"}),(0,Kg.jsx)("option",{value:"male",children:"Male"}),(0,Kg.jsx)("option",{value:"female",children:"Female"}),(0,Kg.jsx)("option",{value:"other",children:"Other"}),(0,Kg.jsx)("option",{value:"prefer-not-to-say",children:"Prefer not to say"})]}),h.gender&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.gender})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),(0,Kg.jsx)("input",{type:"text",value:r.address,onChange:e=>f("address",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter address"})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),(0,Kg.jsx)("input",{type:"text",value:r.city,onChange:e=>f("city",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter city"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),(0,Kg.jsx)("input",{type:"text",value:r.state,onChange:e=>f("state",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter state"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP Code"}),(0,Kg.jsx)("input",{type:"text",value:r.zipCode,onChange:e=>f("zipCode",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter ZIP code"})]})]})]});case 3:return"elderly"===n?(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Emergency Contact"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Name *"}),(0,Kg.jsx)("input",{type:"text",value:r.emergencyContact.name,onChange:e=>f("emergencyContact.name",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h["emergencyContact.name"]?"border-red-500":"border-gray-300"),placeholder:"Enter emergency contact name"}),h["emergencyContact.name"]&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h["emergencyContact.name"]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone *"}),(0,Kg.jsx)("input",{type:"tel",value:r.emergencyContact.phone,onChange:e=>f("emergencyContact.phone",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h["emergencyContact.phone"]?"border-red-500":"border-gray-300"),placeholder:"Enter emergency contact phone"}),h["emergencyContact.phone"]&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h["emergencyContact.phone"]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship"}),(0,Kg.jsxs)("select",{value:r.emergencyContact.relationship,onChange:e=>f("emergencyContact.relationship",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"",children:"Select relationship"}),(0,Kg.jsx)("option",{value:"spouse",children:"Spouse"}),(0,Kg.jsx)("option",{value:"child",children:"Child"}),(0,Kg.jsx)("option",{value:"sibling",children:"Sibling"}),(0,Kg.jsx)("option",{value:"parent",children:"Parent"}),(0,Kg.jsx)("option",{value:"friend",children:"Friend"}),(0,Kg.jsx)("option",{value:"other",children:"Other"})]})]})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Medical Information"}),(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medical Conditions"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Add medical condition (press Enter to add)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim();t&&(g("medicalConditions",t),e.target.value="")}}}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r.medicalConditions.map((e,t)=>(0,Kg.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm flex items-center gap-2",children:[e,(0,Kg.jsx)("button",{type:"button",onClick:()=>g("medicalConditions",t,"remove"),className:"text-blue-600 hover:text-blue-800",children:"\xd7"})]},t))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Medications"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Add medication (press Enter to add)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim();t&&(g("medications",t),e.target.value="")}}}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r.medications.map((e,t)=>(0,Kg.jsxs)("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm flex items-center gap-2",children:[e,(0,Kg.jsx)("button",{type:"button",onClick:()=>g("medications",t,"remove"),className:"text-green-600 hover:text-green-800",children:"\xd7"})]},t))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Add allergy (press Enter to add)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim();t&&(g("allergies",t),e.target.value="")}}}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r.allergies.map((e,t)=>(0,Kg.jsxs)("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm flex items-center gap-2",children:[e,(0,Kg.jsx)("button",{type:"button",onClick:()=>g("allergies",t,"remove"),className:"text-red-600 hover:text-red-800",children:"\xd7"})]},t))})]})]})]})]}):"caregiver"===n?(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Years of Experience *"}),(0,Kg.jsx)("input",{type:"number",value:r.experience,onChange:e=>f("experience",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.experience?"border-red-500":"border-gray-300"),placeholder:"Enter years of experience",min:"0"}),h.experience&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.experience})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hourly Rate ($) *"}),(0,Kg.jsx)("input",{type:"number",value:r.hourlyRate,onChange:e=>f("hourlyRate",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.hourlyRate?"border-red-500":"border-gray-300"),placeholder:"Enter hourly rate",min:"0",step:"0.01"}),h.hourlyRate&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.hourlyRate})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Qualifications"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Add qualification (press Enter to add)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim();t&&(g("qualifications",t),e.target.value="")}}}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r.qualifications.map((e,t)=>(0,Kg.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm flex items-center gap-2",children:[e,(0,Kg.jsx)("button",{type:"button",onClick:()=>g("qualifications",t,"remove"),className:"text-blue-600 hover:text-blue-800",children:"\xd7"})]},t))})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Services Offered"}),(0,Kg.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:["Personal Care","Medication Management","Meal Preparation","Transportation","Housekeeping","Companionship","Physical Therapy","Medical Monitoring"].map(e=>(0,Kg.jsxs)("label",{className:"flex items-center",children:[(0,Kg.jsx)("input",{type:"checkbox",checked:r.services.includes(e),onChange:t=>{t.target.checked?g("services",e):g("services",r.services.indexOf(e),"remove")},className:"mr-2"}),(0,Kg.jsx)("span",{className:"text-sm",children:e})]},e))})]})]}):"doctor"===n?(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medical License Number *"}),(0,Kg.jsx)("input",{type:"text",value:r.medicalLicense,onChange:e=>f("medicalLicense",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.medicalLicense?"border-red-500":"border-gray-300"),placeholder:"Enter medical license number"}),h.medicalLicense&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.medicalLicense})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialty *"}),(0,Kg.jsxs)("select",{value:r.specialty,onChange:e=>f("specialty",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.specialty?"border-red-500":"border-gray-300"),children:[(0,Kg.jsx)("option",{value:"",children:"Select specialty"}),(0,Kg.jsx)("option",{value:"geriatrics",children:"Geriatrics"}),(0,Kg.jsx)("option",{value:"internal-medicine",children:"Internal Medicine"}),(0,Kg.jsx)("option",{value:"family-medicine",children:"Family Medicine"}),(0,Kg.jsx)("option",{value:"cardiology",children:"Cardiology"}),(0,Kg.jsx)("option",{value:"neurology",children:"Neurology"}),(0,Kg.jsx)("option",{value:"psychiatry",children:"Psychiatry"}),(0,Kg.jsx)("option",{value:"physical-therapy",children:"Physical Therapy"}),(0,Kg.jsx)("option",{value:"occupational-therapy",children:"Occupational Therapy"}),(0,Kg.jsx)("option",{value:"other",children:"Other"})]}),h.specialty&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.specialty})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hospital Affiliation"}),(0,Kg.jsx)("input",{type:"text",value:r.hospitalAffiliation,onChange:e=>f("hospitalAffiliation",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter hospital or clinic name"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Years of Experience *"}),(0,Kg.jsx)("input",{type:"number",value:r.yearsOfExperience,onChange:e=>f("yearsOfExperience",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(h.yearsOfExperience?"border-red-500":"border-gray-300"),placeholder:"Enter years of experience",min:"0"}),h.yearsOfExperience&&(0,Kg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.yearsOfExperience})]})]}):"admin"===n?(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),(0,Kg.jsxs)("select",{value:r.department,onChange:e=>f("department",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"",children:"Select department"}),(0,Kg.jsx)("option",{value:"operations",children:"Operations"}),(0,Kg.jsx)("option",{value:"human-resources",children:"Human Resources"}),(0,Kg.jsx)("option",{value:"finance",children:"Finance"}),(0,Kg.jsx)("option",{value:"it",children:"Information Technology"}),(0,Kg.jsx)("option",{value:"customer-service",children:"Customer Service"}),(0,Kg.jsx)("option",{value:"quality-assurance",children:"Quality Assurance"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Access Level"}),(0,Kg.jsxs)("select",{value:r.accessLevel,onChange:e=>f("accessLevel",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"standard",children:"Standard"}),(0,Kg.jsx)("option",{value:"supervisor",children:"Supervisor"}),(0,Kg.jsx)("option",{value:"manager",children:"Manager"}),(0,Kg.jsx)("option",{value:"director",children:"Director"})]})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),(0,Kg.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:["user-management","system-config","reports","analytics","emergency-access","billing"].map(e=>(0,Kg.jsxs)("label",{className:"flex items-center",children:[(0,Kg.jsx)("input",{type:"checkbox",checked:r.permissions.includes(e),onChange:t=>{t.target.checked?g("permissions",e):g("permissions",r.permissions.indexOf(e),"remove")},className:"mr-2"}),(0,Kg.jsx)("span",{className:"text-sm",children:e.replace("-"," ")})]},e))})]})]}):null;case 4:return"elderly"===n?(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Insurance Information"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Insurance Provider"}),(0,Kg.jsx)("input",{type:"text",value:r.insuranceInfo.provider,onChange:e=>f("insuranceInfo.provider",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter insurance provider"})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Number"}),(0,Kg.jsx)("input",{type:"text",value:r.insuranceInfo.policyNumber,onChange:e=>f("insuranceInfo.policyNumber",e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter policy number"})]})]})]}):"caregiver"===n?(0,Kg.jsxs)("div",{className:"space-y-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Availability Schedule"}),(0,Kg.jsx)("div",{className:"space-y-4",children:Object.entries(r.availability).map(e=>{let[t,s]=e;return(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsx)("div",{className:"w-24",children:(0,Kg.jsxs)("label",{className:"flex items-center",children:[(0,Kg.jsx)("input",{type:"checkbox",checked:s.available,onChange:e=>f("availability.".concat(t,".available"),e.target.checked),className:"mr-2"}),(0,Kg.jsx)("span",{className:"text-sm font-medium capitalize",children:t})]})}),s.available&&(0,Kg.jsxs)("div",{className:"flex space-x-2",children:[(0,Kg.jsx)("input",{type:"time",value:s.startTime,onChange:e=>f("availability.".concat(t,".startTime"),e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm"}),(0,Kg.jsx)("span",{className:"text-sm",children:"to"}),(0,Kg.jsx)("input",{type:"time",value:s.endTime,onChange:e=>f("availability.".concat(t,".endTime"),e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm"})]})]},t)})})]}):null;default:return null}})()}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between mt-8 pt-6 border-t",children:[(0,Kg.jsx)("button",{onClick:()=>{u(e=>Math.max(e-1,1))},disabled:1===d,className:"px-6 py-2 rounded-lg font-medium ".concat(1===d?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Previous"}),(0,Kg.jsxs)("div",{className:"flex space-x-4",children:[(0,Kg.jsx)("button",{onClick:s,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50",children:"Cancel"}),d===m?(0,Kg.jsx)("button",{onClick:async()=>{if(y(d)){o(!0);try{const e=(await wi(Pg,r.email,r.password)).user;await Si(e,{displayName:"".concat(r.firstName," ").concat(r.lastName)});const t=Le(Le(Le(Le({id:e.uid,firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone,dateOfBirth:new Date(r.dateOfBirth),gender:r.gender,address:r.address,city:r.city,state:r.state,zipCode:r.zipCode,role:r.role,status:"active",profilePicture:null,joinDate:new Date,lastActive:new Date},"elderly"===n&&{emergencyContact:r.emergencyContact,medicalConditions:r.medicalConditions,medications:r.medications,allergies:r.allergies,insuranceInfo:r.insuranceInfo}),"caregiver"===n&&{qualifications:r.qualifications,certifications:r.certifications,experience:r.experience,hourlyRate:parseFloat(r.hourlyRate),availability:r.availability,services:r.services,languages:r.languages}),"doctor"===n&&{medicalLicense:r.medicalLicense,specialty:r.specialty,hospitalAffiliation:r.hospitalAffiliation,education:r.education,yearsOfExperience:parseInt(r.yearsOfExperience)}),"admin"===n&&{permissions:r.permissions,department:r.department,accessLevel:r.accessLevel});await Kf(Vm(Lg,"users",e.uid),t),yt.success("".concat(n.charAt(0).toUpperCase()+n.slice(1)," user created successfully!")),s()}catch(e){console.error("Error creating user:",e),yt.error("Failed to create user: ".concat(e.message))}finally{o(!1)}}},disabled:a,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:a?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)(ax,{className:"animate-spin",size:16}),(0,Kg.jsx)("span",{children:"Creating..."})]}):(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)(Ov,{size:16}),(0,Kg.jsx)("span",{children:"Create User"})]})}):(0,Kg.jsx)("button",{onClick:()=>{y(d)&&u(e=>Math.min(e+1,m))},className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",children:"Next"})]})]})]})]})})},qx=()=>{const{userProfile:e,userRole:s,isAdmin:n}=qg(),[r,i]=(0,t.useState)([]),[a,o]=(0,t.useState)([]),[c,l]=(0,t.useState)(!0),[d,u]=(0,t.useState)(""),[h,p]=(0,t.useState)("all"),[m,f]=(0,t.useState)("all"),[g,y]=(0,t.useState)(!1),[v,x]=(0,t.useState)("elderly"),[_,E]=(0,t.useState)({total:0,elderly:0,caregivers:0,doctors:0,active:0,inactive:0});(0,t.useEffect)(()=>{(async()=>{try{l(!0);const[e,t]=await Promise.all([Fg(),Hg()]);i(e),o(e),E(t)}catch(e){console.error("Error loading users:",e),yt.error("Failed to load users")}finally{l(!1)}})()},[]),(0,t.useEffect)(()=>Wg(e=>{i(e)}),[]),(0,t.useEffect)(()=>{let e=r;d&&(e=e.filter(e=>{var t,s,n;return(null===(t=e.firstName)||void 0===t?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null===(s=e.lastName)||void 0===s?void 0:s.toLowerCase().includes(d.toLowerCase()))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(d.toLowerCase()))})),"all"!==h&&(e=e.filter(e=>e.role===h)),"all"!==m&&(e=e.filter(e=>e.status===m)),o(e)},[r,d,h,m]);const b=e=>{x(e),y(!0)},w=async(e,t)=>{try{"delete"===t?window.confirm("Are you sure you want to delete this user?")&&(await Bg(e),yt.success("User deleted successfully")):"suspend"===t?(await Gg(e,"inactive"),yt.success("User suspended successfully")):"activate"===t&&(await Gg(e,"active"),yt.success("User activated successfully"))}catch(s){console.error("Error performing user action:",s),yt.error("Failed to ".concat(t," user"))}},N=e=>{switch(e){case"elderly":return(0,Kg.jsx)(cy,{size:16,className:"text-blue-600"});case"caregiver":return(0,Kg.jsx)(xy,{size:16,className:"text-green-600"});case"doctor":return(0,Kg.jsx)(Oy,{size:16,className:"text-purple-600"});case"admin":return(0,Kg.jsx)(Ry,{size:16,className:"text-red-600"});default:return(0,Kg.jsx)(xy,{size:16,className:"text-gray-600"})}},S=e=>{switch(e){case"active":return(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Kg.jsx)(Ly,{size:12,className:"mr-1"}),"Active"]});case"inactive":return(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,Kg.jsx)(Yy,{size:12,className:"mr-1"}),"Inactive"]});case"pending":return(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,Kg.jsx)(Dy,{size:12,className:"mr-1"}),"Pending"]});default:return(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,Kg.jsx)(mx,{size:12,className:"mr-1"}),"Unknown"]})}},T=e=>e?new Date(e).toLocaleDateString():"N/A";return n?(0,Kg.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,Kg.jsx)("div",{className:"mb-8",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"User Management"}),(0,Kg.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage users across all roles in the ElderX platform"})]}),(0,Kg.jsx)("div",{className:"flex space-x-3",children:(0,Kg.jsxs)("button",{onClick:async()=>{try{await ux(),yt.success("Sample data added successfully")}catch(e){console.error("Error seeding data:",e),yt.error("Failed to add sample data")}},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center space-x-2",children:[(0,Kg.jsx)(xy,{size:16}),(0,Kg.jsx)("span",{children:"Add Sample Data"})]})})]})}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,Kg.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"text-blue-600",size:24})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:_.total})]})]})}),(0,Kg.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(cy,{className:"text-green-600",size:24})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Elderly"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:_.elderly})]})]})}),(0,Kg.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(Oy,{className:"text-purple-600",size:24})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Doctors"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:_.doctors})]})]})}),(0,Kg.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-orange-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"text-orange-600",size:24})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Caregivers"}),(0,Kg.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:_.caregivers})]})]})})]}),(0,Kg.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Quick Actions"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,Kg.jsxs)("button",{onClick:()=>b("elderly"),className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors group",children:[(0,Kg.jsx)(cy,{size:32,className:"mx-auto mb-2 text-gray-400 group-hover:text-blue-600"}),(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 group-hover:text-blue-800",children:"Add Elderly User"})]}),(0,Kg.jsxs)("button",{onClick:()=>b("caregiver"),className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors group",children:[(0,Kg.jsx)(xy,{size:32,className:"mx-auto mb-2 text-gray-400 group-hover:text-green-600"}),(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 group-hover:text-green-800",children:"Add Caregiver"})]}),(0,Kg.jsxs)("button",{onClick:()=>b("doctor"),className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors group",children:[(0,Kg.jsx)(Oy,{size:32,className:"mx-auto mb-2 text-gray-400 group-hover:text-purple-600"}),(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 group-hover:text-purple-800",children:"Add Doctor"})]}),(0,Kg.jsxs)("button",{onClick:()=>b("admin"),className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-red-500 hover:bg-red-50 transition-colors group",children:[(0,Kg.jsx)(Ry,{size:32,className:"mx-auto mb-2 text-gray-400 group-hover:text-red-600"}),(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600 group-hover:text-red-800",children:"Add Admin"})]})]})]}),(0,Kg.jsx)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:(0,Kg.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,Kg.jsx)("div",{className:"flex-1 max-w-md",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search users...",value:d,onChange:e=>u(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,Kg.jsxs)("div",{className:"flex space-x-4",children:[(0,Kg.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"all",children:"All Roles"}),(0,Kg.jsx)("option",{value:"elderly",children:"Elderly"}),(0,Kg.jsx)("option",{value:"caregiver",children:"Caregiver"}),(0,Kg.jsx)("option",{value:"doctor",children:"Doctor"}),(0,Kg.jsx)("option",{value:"admin",children:"Admin"})]}),(0,Kg.jsxs)("select",{value:m,onChange:e=>f(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,Kg.jsx)("option",{value:"all",children:"All Status"}),(0,Kg.jsx)("option",{value:"active",children:"Active"}),(0,Kg.jsx)("option",{value:"inactive",children:"Inactive"}),(0,Kg.jsx)("option",{value:"pending",children:"Pending"})]})]})]})}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,Kg.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Kg.jsxs)("h2",{className:"text-lg font-semibold text-gray-800",children:["Users (",a.length,")"]})}),c?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)(ax,{className:"animate-spin text-blue-600",size:32})}):0===a.length?(0,Kg.jsxs)("div",{className:"text-center py-12",children:[(0,Kg.jsx)(xy,{size:64,className:"mx-auto mb-4 text-gray-300"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"No users found"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Try adjusting your search or filters"})]}):(0,Kg.jsx)("div",{className:"overflow-x-auto",children:(0,Kg.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,Kg.jsx)("thead",{className:"bg-gray-50",children:(0,Kg.jsxs)("tr",{children:[(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Join Date"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),(0,Kg.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,Kg.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(e=>{var t,s;return(0,Kg.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,Kg.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,Kg.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[null===(t=e.firstName)||void 0===t?void 0:t[0],null===(s=e.lastName)||void 0===s?void 0:s[0]]})})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),(0,Kg.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[N(e.role),(0,Kg.jsx)("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:e.role})]})}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:S(e.status)}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(e.joinDate)}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(e.lastActive)}),(0,Kg.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>{},className:"text-blue-600 hover:text-blue-900",children:(0,Kg.jsx)(rv,{size:16})}),(0,Kg.jsx)("button",{onClick:()=>{},className:"text-green-600 hover:text-green-900",children:(0,Kg.jsx)(Xy,{size:16})}),"active"===e.status?(0,Kg.jsx)("button",{onClick:()=>w(e.id,"suspend"),className:"text-yellow-600 hover:text-yellow-900",children:(0,Kg.jsx)(Yy,{size:16})}):(0,Kg.jsx)("button",{onClick:()=>w(e.id,"activate"),className:"text-green-600 hover:text-green-900",children:(0,Kg.jsx)(Ly,{size:16})}),(0,Kg.jsx)("button",{onClick:()=>w(e.id,"delete"),className:"text-red-600 hover:text-red-900",children:(0,Kg.jsx)(Jy,{size:16})})]})})]},e.id)})})]})})]})]}),g&&(0,Kg.jsx)(zx,{userRole:v,onClose:()=>{y(!1),x("elderly")}})]}):(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)(Ry,{size:64,className:"mx-auto mb-4 text-gray-300"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Access Denied"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})})},Yx=Qg("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);const Xx=class{constructor(){this.activeCall=null,this.callListeners=new Map}generateCallId(){return"call_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}async initiateCall(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"video";try{const n=this.generateCallId(),r={callId:n,callerId:e,recipientId:t,callType:s,status:"initiating",createdAt:Zf(),answeredAt:null,endedAt:null,duration:0},i=await Yf(Um(Lg,"calls"),r);return await this.sendCallNotification(t,{callId:n,callerId:e,callType:s,status:"incoming"}),this.activeCall=Le(Le({},r),{},{id:i.id}),{success:!0,callId:n,callData:this.activeCall}}catch(n){return console.error("Error initiating call:",n),{success:!1,error:n.message}}}async answerCall(e,t){try{const s=Nf(Um(Lg,"calls"),Tf("callId","==",e)),n=await Hf(s);if(n.empty)throw new Error("Call not found");const r=n.docs[0];return await zf(r.ref,{status:"answered",answeredAt:Zf()}),await this.sendCallNotification(r.data().callerId,{callId:e,recipientId:t,status:"answered"}),{success:!0}}catch(s){return console.error("Error answering call:",s),{success:!1,error:s.message}}}async rejectCall(e,t){try{const s=Nf(Um(Lg,"calls"),Tf("callId","==",e)),n=await Hf(s);if(n.empty)throw new Error("Call not found");const r=n.docs[0];return await zf(r.ref,{status:"rejected",endedAt:Zf()}),await this.sendCallNotification(r.data().callerId,{callId:e,recipientId:t,status:"rejected"}),{success:!0}}catch(s){return console.error("Error rejecting call:",s),{success:!1,error:s.message}}}async endCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{const s=Nf(Um(Lg,"calls"),Tf("callId","==",e)),n=await Hf(s);if(n.empty)throw new Error("Call not found");const r=n.docs[0];return await zf(r.ref,{status:"ended",endedAt:Zf(),duration:t}),this.activeCall&&this.activeCall.callId===e&&(this.activeCall=null),{success:!0}}catch(s){return console.error("Error ending call:",s),{success:!1,error:s.message}}}async sendCallNotification(e,t){try{await Yf(Um(Lg,"notifications"),{userId:e,type:"call",data:t,read:!1,createdAt:Zf()}),await Yf(Um(Lg,"callNotifications"),Le(Le({userId:e},t),{},{timestamp:Zf()}))}catch(s){console.error("Error sending call notification:",s)}}listenForIncomingCalls(e,t){const s=Xf(Nf(Um(Lg,"callNotifications"),Tf("userId","==",e),If("timestamp","desc")),e=>{e.docChanges().forEach(e=>{if("added"===e.type){const s=e.doc.data();"incoming"===s.status&&t(s)}})});return this.callListeners.set(e,s),s}stopListeningForCalls(e){const t=this.callListeners.get(e);t&&(t(),this.callListeners.delete(e))}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const s=Nf(Um(Lg,"calls"),Tf("callerId","==",e),If("createdAt","desc"),t(t));return new Promise((e,t)=>{const n=Xf(s,t=>{const s=t.docs.map(e=>Le({id:e.id},e.data()));e(s)},t);setTimeout(()=>n(),5e3)})}catch(s){throw console.error("Error getting call history:",s),s}}async getRecentCalls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{const s=Nf(Um(Lg,"calls"),Tf("callerId","==",e),If("createdAt","desc"),t(t)),n=Nf(Um(Lg,"calls"),Tf("recipientId","==",e),If("createdAt","desc"),t(t)),[r,i]=await Promise.all([Hf(s),Hf(n)]),a=r.docs.map(e=>Le(Le({id:e.id},e.data()),{},{direction:"outgoing"})),o=i.docs.map(e=>Le(Le({id:e.id},e.data()),{},{direction:"incoming"})),c=[...a,...o].sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)).slice(0,t);return c}catch(s){throw console.error("Error getting recent calls:",s),s}}async getCallStats(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{const s=new Date;s.setDate(s.getDate()-t);const n=Nf(Um(Lg,"calls"),Tf("callerId","==",e),Tf("createdAt",">=",s)),r=(await Hf(n)).docs.map(e=>e.data()),i={totalCalls:r.length,answeredCalls:r.filter(e=>"answered"===e.status).length,missedCalls:r.filter(e=>"rejected"===e.status||"initiating"===e.status).length,totalDuration:r.reduce((e,t)=>e+(t.duration||0),0),averageDuration:0,videoCalls:r.filter(e=>"video"===e.callType).length,voiceCalls:r.filter(e=>"audio"===e.callType).length};return i.answeredCalls>0&&(i.averageDuration=i.totalDuration/i.answeredCalls),i}catch(s){throw console.error("Error getting call stats:",s),s}}async cleanupOldNotifications(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{const t=new Date;t.setDate(t.getDate()-e);const s=Nf(Um(Lg,"callNotifications"),Tf("timestamp","<",t)),n=await Hf(s),r=[];return n.docs.forEach(e=>{r.push(qf(e.ref))}),await Promise.all(r),{success:!0,deletedCount:r.length}}catch(t){return console.error("Error cleaning up notifications:",t),{success:!1,error:t.message}}}getActiveCall(){return this.activeCall}setActiveCall(e){this.activeCall=e}clearActiveCall(){this.activeCall=null}},Jx=Qg("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Qx=Qg("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Zx=Qg("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),$x=Qg("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);const e_=class{constructor(){this.localStream=null,this.remoteStream=null,this.peerConnection=null,this.callId=null,this.isInitiator=!1,this.callbacks={onLocalStream:null,onRemoteStream:null,onCallEnded:null,onCallStateChange:null},this.configuration={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]}}async initialize(){try{return await this.setupPeerConnection(),!0}catch(e){return console.error("Failed to initialize WebRTC service:",e),!1}}async setupPeerConnection(){this.peerConnection=new RTCPeerConnection(this.configuration),this.peerConnection.onicecandidate=e=>{e.candidate&&this.sendSignalingMessage("ice-candidate",{candidate:e.candidate})},this.peerConnection.ontrack=e=>{console.log("Received remote stream"),this.remoteStream=e.streams[0],this.callbacks.onRemoteStream&&this.callbacks.onRemoteStream(e.streams[0])},this.peerConnection.onconnectionstatechange=()=>{console.log("Connection state:",this.peerConnection.connectionState),this.callbacks.onCallStateChange&&this.callbacks.onCallStateChange(this.peerConnection.connectionState)},this.peerConnection.oniceconnectionstatechange=()=>{console.log("ICE connection state:",this.peerConnection.iceConnectionState),"failed"!==this.peerConnection.iceConnectionState&&"disconnected"!==this.peerConnection.iceConnectionState&&"closed"!==this.peerConnection.iceConnectionState||this.endCall()}}async getUserMedia(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0,audio:!0};try{return this.localStream=await navigator.mediaDevices.getUserMedia(e),this.localStream.getTracks().forEach(e=>{this.peerConnection.addTrack(e,this.localStream)}),this.callbacks.onLocalStream&&this.callbacks.onLocalStream(this.localStream),this.localStream}catch(t){throw console.error("Error accessing media devices:",t),t}}async startCall(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"video";try{this.callId=e,this.isInitiator=!0;await Yf(Um(Lg,"calls"),{callId:e,callerId:this.getCurrentUserId(),recipientId:t,callType:s,status:"initiating",createdAt:Zf(),endedAt:null});const n="video"===s?{video:!0,audio:!0}:{video:!1,audio:!0};await this.getUserMedia(n);const r=await this.peerConnection.createOffer();return await this.peerConnection.setLocalDescription(r),await this.sendSignalingMessage("offer",{offer:r,callType:s}),!0}catch(n){throw console.error("Error starting call:",n),n}}async answerCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video";try{this.callId=e,this.isInitiator=!1;const s="video"===t?{video:!0,audio:!0}:{video:!1,audio:!0};return await this.getUserMedia(s),!0}catch(s){throw console.error("Error answering call:",s),s}}async handleOffer(e,t){try{await this.peerConnection.setRemoteDescription(e);const t=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(t),await this.sendSignalingMessage("answer",{answer:t}),!0}catch(s){throw console.error("Error handling offer:",s),s}}async handleAnswer(e){try{return await this.peerConnection.setRemoteDescription(e),!0}catch(t){throw console.error("Error handling answer:",t),t}}async handleIceCandidate(e){try{return await this.peerConnection.addIceCandidate(e),!0}catch(t){throw console.error("Error handling ICE candidate:",t),t}}async sendSignalingMessage(e,t){if(!this.callId)throw new Error("No active call");try{await Yf(Um(Lg,"signaling"),{callId:this.callId,type:e,data:t,from:this.getCurrentUserId(),timestamp:Zf()})}catch(s){throw console.error("Error sending signaling message:",s),s}}listenForSignaling(e,t){return Xf(Nf(Um(Lg,"signaling"),Tf("callId","==",e),If("timestamp","asc")),e=>{e.docChanges().forEach(e=>{if("added"===e.type){const s=e.doc.data();s.from!==this.getCurrentUserId()&&t(s)}})})}toggleAudio(){if(this.localStream){const e=this.localStream.getAudioTracks()[0];if(e)return e.enabled=!e.enabled,e.enabled}return!1}toggleVideo(){if(this.localStream){const e=this.localStream.getVideoTracks()[0];if(e)return e.enabled=!e.enabled,e.enabled}return!1}async switchCamera(){if(this.localStream){const t=this.localStream.getVideoTracks()[0];if(t){const s="user"===t.getSettings().facingMode?"environment":"user";try{const e=(await navigator.mediaDevices.getUserMedia({video:{facingMode:s},audio:!0})).getVideoTracks()[0],n=this.peerConnection.getSenders().find(e=>e.track&&"video"===e.track.kind);return n&&await n.replaceTrack(e),this.localStream.removeTrack(t),this.localStream.addTrack(e),t.stop(),this.callbacks.onLocalStream&&this.callbacks.onLocalStream(this.localStream),!0}catch(e){return console.error("Error switching camera:",e),!1}}}return!1}async endCall(){try{if(this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.callId){Nf(Um(Lg,"calls"),Tf("callId","==",this.callId));console.log("Call ended:",this.callId)}return this.callId=null,this.isInitiator=!1,this.remoteStream=null,this.callbacks.onCallEnded&&this.callbacks.onCallEnded(),!0}catch(e){throw console.error("Error ending call:",e),e}}async getCallHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const s=Nf(Um(Lg,"calls"),Tf("callerId","==",e),If("createdAt","desc"),t(t));return new Promise((e,t)=>{const n=Xf(s,t=>{const s=t.docs.map(e=>Le({id:e.id},e.data()));e(s)},t);setTimeout(()=>n(),5e3)})}catch(s){throw console.error("Error getting call history:",s),s}}setCallbacks(e){this.callbacks=Le(Le({},this.callbacks),e)}getCurrentUserId(){return"current-user-id"}static isSupported(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.RTCPeerConnection)}static async getMediaDevices(){try{const e=await navigator.mediaDevices.enumerateDevices();return{audioInput:e.filter(e=>"audioinput"===e.kind),audioOutput:e.filter(e=>"audiooutput"===e.kind),videoInput:e.filter(e=>"videoinput"===e.kind)}}catch(e){return console.error("Error getting media devices:",e),{audioInput:[],audioOutput:[],videoInput:[]}}}},t_=e=>{var s,n;let{isOpen:r,onClose:i,callType:a="video",participantInfo:o=null,isIncoming:c=!1,onCallAccepted:l,onCallRejected:d}=e;const[u,h]=(0,t.useState)("connecting"),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)("video"===a),[y,v]=(0,t.useState)(!1),[x,_]=(0,t.useState)(0),[E,b]=(0,t.useState)(!1),[w,N]=(0,t.useState)("good"),[S,T]=(0,t.useState)(null),[C,R]=(0,t.useState)(null),[I,A]=(0,t.useState)(null),O=(0,t.useRef)(null),j=(0,t.useRef)(null),k=(0,t.useRef)(null),D=(0,t.useRef)(null);(0,t.useEffect)(()=>(r&&(async()=>{if(!e_.isSupported())return yt.error("WebRTC is not supported in this browser"),void i();const e=new e_;await e.initialize(),e.setCallbacks({onLocalStream:e=>{R(e),O.current&&(O.current.srcObject=e)},onRemoteStream:e=>{A(e),j.current&&(j.current.srcObject=e),k.current&&(k.current.srcObject=e),h("connected"),P()},onCallEnded:()=>{h("ended"),L(),setTimeout(()=>{i()},2e3)},onCallStateChange:e=>{N("connected"===e?"good":"poor")}}),T(e)})(),()=>{S&&S.endCall()}),[r]);const P=()=>{D.current=setInterval(()=>{_(e=>e+1)},1e3)},L=()=>{D.current&&(clearInterval(D.current),D.current=null)},M=e=>{const t=Math.floor(e/60),s=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"))},U=async()=>{S&&await S.endCall(),h("ended"),L(),setTimeout(()=>{i()},1e3)};return(0,t.useEffect)(()=>{r&&c&&(async()=>{c&&(h("ringing"),yt.info("Incoming ".concat(a," call from ").concat(null===o||void 0===o?void 0:o.name)))})()},[r,c]),r?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("audio",{ref:k,autoPlay:!0,playsInline:!0,muted:!y,style:{display:"none"}}),(0,Kg.jsxs)("div",{className:"fixed inset-0 z-50 ".concat(E?"pointer-events-none":""),children:[(0,Kg.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-75"}),(0,Kg.jsx)("div",{className:"relative w-full h-full flex items-center justify-center ".concat(E?"scale-50 translate-x-1/2 translate-y-1/2":""," transition-all duration-300"),children:(0,Kg.jsxs)("div",{className:"relative w-full h-full",children:[(0,Kg.jsxs)("div",{className:"absolute inset-0",children:["video"===a?(0,Kg.jsx)("video",{ref:j,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover",style:{transform:I?"scaleX(1)":"scaleX(-1)",filter:I?"none":"blur(10px)"}}):(0,Kg.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-900 to-purple-900 flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center text-white",children:[(0,Kg.jsx)("div",{className:"w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Kg.jsx)("span",{className:"text-4xl font-bold",children:(null===o||void 0===o||null===(s=o.name)||void 0===s?void 0:s[0])||"U"})}),(0,Kg.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:(null===o||void 0===o?void 0:o.name)||"Unknown User"}),(0,Kg.jsx)("p",{className:"text-blue-200",children:(null===o||void 0===o?void 0:o.role)||"User"})]})}),(0,Kg.jsxs)("div",{className:"absolute top-4 left-4 flex items-center space-x-2",children:[(0,Kg.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("good"===w?"bg-green-500":"bg-red-500")}),(0,Kg.jsx)("span",{className:"text-white text-sm",children:"good"===w?"Good connection":"Poor connection"})]}),"connected"===u&&(0,Kg.jsx)("div",{className:"absolute top-4 right-4 bg-black bg-opacity-50 rounded-lg px-3 py-1",children:(0,Kg.jsx)("span",{className:"text-white text-sm font-mono",children:M(x)})}),"video"===a&&C&&(0,Kg.jsxs)("div",{className:"absolute bottom-20 md:bottom-24 right-2 md:right-4 w-24 h-18 md:w-32 md:h-24 bg-gray-900 rounded-lg overflow-hidden border-2 border-white",children:[(0,Kg.jsx)("video",{ref:O,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover scale-x-[-1]"}),!f&&(0,Kg.jsx)("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center",children:(0,Kg.jsx)(Pv,{className:"text-white",size:16})})]})]}),"connected"!==u&&(0,Kg.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center text-white",children:["connecting"===u&&(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)(ax,{className:"animate-spin mx-auto mb-4",size:48}),(0,Kg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Connecting..."}),(0,Kg.jsxs)("p",{children:["Establishing connection with ",null===o||void 0===o?void 0:o.name]})]}),"ringing"===u&&(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("div",{className:"w-24 h-24 md:w-24 md:h-24 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse",children:(0,Kg.jsx)(Ay,{className:"text-white",size:32})}),(0,Kg.jsx)("h2",{className:"text-xl md:text-2xl font-semibold mb-2",children:"Incoming Call"}),(0,Kg.jsx)("p",{className:"text-lg md:text-xl mb-6",children:null===o||void 0===o?void 0:o.name}),(0,Kg.jsxs)("div",{className:"flex space-x-6 md:space-x-4 justify-center",children:[(0,Kg.jsx)("button",{onClick:()=>{h("ended"),d&&d(),i()},className:"w-20 h-20 md:w-16 md:h-16 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600 active:bg-red-700 transition-colors touch-manipulation",children:(0,Kg.jsx)(hy,{className:"text-white",size:28})}),(0,Kg.jsx)("button",{onClick:async()=>{S&&c&&(h("connecting"),await S.answerCall("call-id",a),l&&l())},className:"w-20 h-20 md:w-16 md:h-16 bg-green-500 rounded-full flex items-center justify-center hover:bg-green-600 active:bg-green-700 transition-colors touch-manipulation",children:(0,Kg.jsx)(gv,{className:"text-white",size:28})})]})]}),"ended"===u&&(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("div",{className:"w-24 h-24 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Kg.jsx)(Dv,{className:"text-white",size:32})}),(0,Kg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Call Ended"}),(0,Kg.jsxs)("p",{children:["Duration: ",M(x)]})]})]})}),"connected"===u&&(0,Kg.jsx)("div",{className:"absolute bottom-4 md:bottom-6 left-1/2 transform -translate-x-1/2 w-full max-w-md px-4",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-center space-x-2 md:space-x-4 bg-black bg-opacity-50 rounded-full px-4 md:px-6 py-3",children:[(0,Kg.jsx)("button",{onClick:()=>{if(S){const e=S.toggleAudio();m(!e)}},className:"w-14 h-14 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-colors touch-manipulation ".concat(p?"bg-red-500 hover:bg-red-600 active:bg-red-700":"bg-gray-600 hover:bg-gray-700 active:bg-gray-800"),children:p?(0,Kg.jsx)(Mv,{className:"text-white",size:24}):(0,Kg.jsx)(Lv,{className:"text-white",size:24})}),"video"===a&&(0,Kg.jsx)("button",{onClick:()=>{if(S){const e=S.toggleVideo();g(e)}},className:"w-14 h-14 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-colors touch-manipulation ".concat(f?"bg-gray-600 hover:bg-gray-700 active:bg-gray-800":"bg-red-500 hover:bg-red-600 active:bg-red-700"),children:f?(0,Kg.jsx)(ly,{className:"text-white",size:24}):(0,Kg.jsx)(Pv,{className:"text-white",size:24})}),"video"===a&&f&&(0,Kg.jsx)("button",{onClick:async()=>{if(S){await S.switchCamera()||yt.error("Failed to switch camera")}},className:"w-14 h-14 md:w-12 md:h-12 rounded-full bg-gray-600 hover:bg-gray-700 active:bg-gray-800 flex items-center justify-center transition-colors touch-manipulation",children:(0,Kg.jsx)(jy,{className:"text-white",size:24})}),(0,Kg.jsx)("button",{onClick:()=>{k.current&&(k.current.muted=!k.current.muted,v(!k.current.muted))},className:"w-14 h-14 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-colors touch-manipulation ".concat(y?"bg-blue-500 hover:bg-blue-600 active:bg-blue-700":"bg-gray-600 hover:bg-gray-700 active:bg-gray-800"),children:y?(0,Kg.jsx)(Jx,{className:"text-white",size:24}):(0,Kg.jsx)(Qx,{className:"text-white",size:24})}),(0,Kg.jsx)("button",{onClick:()=>b(!E),className:"hidden md:flex w-12 h-12 rounded-full bg-gray-600 hover:bg-gray-700 active:bg-gray-800 items-center justify-center transition-colors touch-manipulation",children:E?(0,Kg.jsx)(Zx,{className:"text-white",size:20}):(0,Kg.jsx)($x,{className:"text-white",size:20})}),(0,Kg.jsx)("button",{onClick:U,className:"w-16 h-16 md:w-12 md:h-12 rounded-full bg-red-500 hover:bg-red-600 active:bg-red-700 flex items-center justify-center transition-colors touch-manipulation",children:(0,Kg.jsx)(Dv,{className:"text-white",size:28})})]})}),"connected"===u&&(0,Kg.jsx)("div",{className:"absolute bottom-6 left-6 text-white",children:(0,Kg.jsxs)("div",{className:"bg-black bg-opacity-50 rounded-lg px-3 py-2",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium",children:null===o||void 0===o?void 0:o.name}),(0,Kg.jsx)("p",{className:"text-xs text-gray-300",children:null===o||void 0===o?void 0:o.role})]})})]})}),E&&"connected"===u&&(0,Kg.jsx)("div",{className:"fixed bottom-4 left-4 bg-black bg-opacity-75 rounded-lg p-3 pointer-events-auto",children:(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:(0,Kg.jsx)("span",{className:"text-white font-bold text-sm",children:(null===o||void 0===o||null===(n=o.name)||void 0===n?void 0:n[0])||"U"})}),(0,Kg.jsxs)("div",{className:"text-white",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium",children:null===o||void 0===o?void 0:o.name}),(0,Kg.jsx)("p",{className:"text-xs text-gray-300",children:M(x)})]}),(0,Kg.jsx)("button",{onClick:U,className:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:(0,Kg.jsx)(Dv,{className:"text-white",size:14})})]})})]})]}):null},s_=Qg("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),n_=Qg("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]),r_=e=>{let{onCallBack:s,showStats:n=!0}=e;const{userProfile:r}=qg(),[i,a]=(0,t.useState)([]),[o,c]=(0,t.useState)({totalCalls:0,answeredCalls:0,missedCalls:0,totalDuration:0,averageDuration:0,videoCalls:0,voiceCalls:0}),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(""),[p,m]=(0,t.useState)("all"),[f,g]=(0,t.useState)("all"),[y,v]=(0,t.useState)("7"),x=new Xx;(0,t.useEffect)(()=>{(async()=>{if(r)try{d(!0);const[e,t]=await Promise.all([x.getRecentCalls(r.id,50),x.getCallStats(r.id,parseInt(y))]);a(e),c(t)}catch(e){console.error("Error loading call data:",e),yt.error("Failed to load call history")}finally{d(!1)}})()},[r,y]);const _=i.filter(e=>{const t=""===u||e.participantName&&e.participantName.toLowerCase().includes(u.toLowerCase()),s="all"===p||"answered"===p&&"answered"===e.status||"missed"===p&&("rejected"===e.status||"initiating"===e.status)||"video"===p&&"video"===e.callType||"voice"===p&&"audio"===e.callType,n="all"===f||e.direction===f;return t&&s&&n}),E=e=>{if(!e)return"0:00";const t=Math.floor(e/60),s=e%60;return"".concat(t,":").concat(s.toString().padStart(2,"0"))},b=e=>{if(!e)return"Unknown";const t=new Date(e),s=(new Date-t)/36e5;return s<1?"Just now":s<24?"".concat(Math.floor(s),"h ago"):s<48?"Yesterday":t.toLocaleDateString()};return l?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,Kg.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Call History"}),(0,Kg.jsx)("p",{className:"text-gray-600 text-sm",children:"Recent calls and statistics"})]}),(0,Kg.jsx)("button",{onClick:async()=>{if(r)try{d(!0);const[e,t]=await Promise.all([x.getRecentCalls(r.id,50),x.getCallStats(r.id,parseInt(y))]);a(e),c(t),yt.success("Call history refreshed")}catch(e){console.error("Error refreshing call data:",e),yt.error("Failed to refresh call history")}finally{d(!1)}},className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Kg.jsx)($g,{size:20})})]}),n&&(0,Kg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,Kg.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Yx,{className:"text-blue-600",size:20}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Calls"}),(0,Kg.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:o.totalCalls})]})]})}),(0,Kg.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(gv,{className:"text-green-600",size:20}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Answered"}),(0,Kg.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:o.answeredCalls})]})]})}),(0,Kg.jsx)("div",{className:"bg-red-50 p-4 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(hy,{className:"text-red-600",size:20}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Missed"}),(0,Kg.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:o.missedCalls})]})]})}),(0,Kg.jsx)("div",{className:"bg-purple-50 p-4 rounded-lg",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)(Dy,{className:"text-purple-600",size:20}),(0,Kg.jsxs)("div",{className:"ml-3",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Duration"}),(0,Kg.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:E(o.averageDuration)})]})]})})]}),(0,Kg.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,Kg.jsx)("div",{className:"flex-1 max-w-md",children:(0,Kg.jsxs)("div",{className:"relative",children:[(0,Kg.jsx)(uv,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search calls...",value:u,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),(0,Kg.jsxs)("div",{className:"flex space-x-2",children:[(0,Kg.jsxs)("select",{value:y,onChange:e=>v(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,Kg.jsx)("option",{value:"7",children:"Last 7 days"}),(0,Kg.jsx)("option",{value:"30",children:"Last 30 days"}),(0,Kg.jsx)("option",{value:"90",children:"Last 90 days"})]}),(0,Kg.jsxs)("select",{value:p,onChange:e=>m(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,Kg.jsx)("option",{value:"all",children:"All Types"}),(0,Kg.jsx)("option",{value:"answered",children:"Answered"}),(0,Kg.jsx)("option",{value:"missed",children:"Missed"}),(0,Kg.jsx)("option",{value:"video",children:"Video Calls"}),(0,Kg.jsx)("option",{value:"voice",children:"Voice Calls"})]}),(0,Kg.jsxs)("select",{value:f,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,Kg.jsx)("option",{value:"all",children:"All Directions"}),(0,Kg.jsx)("option",{value:"incoming",children:"Incoming"}),(0,Kg.jsx)("option",{value:"outgoing",children:"Outgoing"})]})]})]})]}),(0,Kg.jsx)("div",{className:"divide-y divide-gray-200",children:0===_.length?(0,Kg.jsxs)("div",{className:"p-8 text-center",children:[(0,Kg.jsx)(Ay,{className:"mx-auto mb-4 text-gray-300",size:48}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"No calls found"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"No calls match your current filters"})]}):_.map(e=>{return(0,Kg.jsx)("div",{className:"p-4 hover:bg-gray-50",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(r=e.direction,"outgoing"===r?(0,Kg.jsx)(s_,{className:"text-blue-500",size:16}):(0,Kg.jsx)(n_,{className:"text-green-500",size:16})),(n=e.callType,"video"===n?(0,Kg.jsx)(ly,{className:"text-purple-500",size:16}):(0,Kg.jsx)(Ay,{className:"text-blue-500",size:16})),(t=e.status,e.direction,"answered"===t?(0,Kg.jsx)(gv,{className:"text-green-500",size:16}):"rejected"===t||"initiating"===t?(0,Kg.jsx)(hy,{className:"text-red-500",size:16}):(0,Kg.jsx)(Dy,{className:"text-yellow-500",size:16}))]}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.participantName||"Unknown User"}),(0,Kg.jsx)("span",{className:"text-xs text-gray-500",children:"outgoing"===e.direction?"Outgoing":"Incoming"})]}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-500",children:[b(e.createdAt),"answered"===e.status&&e.duration&&(0,Kg.jsxs)("span",{className:"ml-2",children:["\u2022 ",E(e.duration)]})]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:["answered"===e.status&&(0,Kg.jsx)("button",{onClick:()=>(e=>{if(s){const t="outgoing"===e.direction?e.recipientId:e.callerId,n=e.participantName||"Unknown User";s(t,n,e.callType)}})(e),className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",title:"Call back",children:(0,Kg.jsx)(Ay,{size:16})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Kg.jsx)(mv,{size:16})})]})]})},e.id);var t,n,r})}),_.length>0&&(0,Kg.jsx)("div",{className:"p-4 border-t border-gray-200 text-center",children:(0,Kg.jsx)("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Load more calls"})})]})},i_=()=>{const{userProfile:e}=qg(),[s,n]=(0,t.useState)(null),[r]=(0,t.useState)(new Xx),[i,a]=(0,t.useState)(!1),o=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video";if(!e)return void yt.error("Please log in to make calls");const s=prompt("Enter recipient user ID:");if(!s)return;const i=prompt("Enter recipient name:")||"Unknown User";try{a(!0);const o=await r.initiateCall(e.id,s,t);o.success?(n({callId:o.callId,participantId:s,participantName:i,callType:t}),yt.success("".concat("video"===t?"Video":"Voice"," call initiated"))):yt.error("Failed to start call")}catch(o){console.error("Error starting call:",o),yt.error("Failed to start call")}finally{a(!1)}};return(0,Kg.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,Kg.jsx)("div",{className:"mb-8",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Calls"}),(0,Kg.jsx)("p",{className:"text-gray-600 mt-2",children:"Make voice and video calls with your care team"})]}),(0,Kg.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[(0,Kg.jsxs)("button",{onClick:()=>o("audio"),disabled:i,className:"px-4 sm:px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 active:bg-green-800 disabled:opacity-50 flex items-center justify-center space-x-2 touch-manipulation",children:[(0,Kg.jsx)(Ay,{size:20}),(0,Kg.jsx)("span",{children:"Voice Call"})]}),(0,Kg.jsxs)("button",{onClick:()=>o("video"),disabled:i,className:"px-4 sm:px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 flex items-center justify-center space-x-2 touch-manipulation",children:[(0,Kg.jsx)(ly,{size:20}),(0,Kg.jsx)("span",{children:"Video Call"})]})]})]})}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-8",children:[(0,Kg.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,Kg.jsx)(Yx,{className:"text-green-600",size:24})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Voice Calls"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Make audio-only calls"})]})]}),(0,Kg.jsx)("button",{onClick:()=>o("audio"),disabled:i,className:"mt-4 w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 active:bg-green-800 disabled:opacity-50 touch-manipulation",children:"Start Voice Call"})]}),(0,Kg.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,Kg.jsx)(ly,{className:"text-blue-600",size:24})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Video Calls"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Make video calls with camera"})]})]}),(0,Kg.jsx)("button",{onClick:()=>o("video"),disabled:i,className:"mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 touch-manipulation",children:"Start Video Call"})]}),(0,Kg.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,Kg.jsx)(xy,{className:"text-purple-600",size:24})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Group Calls"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Coming soon"})]})]}),(0,Kg.jsx)("button",{disabled:!0,className:"mt-4 w-full px-4 py-2 bg-gray-400 text-white rounded-lg cursor-not-allowed",children:"Coming Soon"})]})]}),(0,Kg.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,Kg.jsx)(r_,{onCallBack:(e,t,s)=>{n({callId:"callback_".concat(Date.now()),participantId:e,participantName:t,callType:s})},showStats:!0})}),(0,Kg.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Call Tips"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Kg.jsx)("span",{className:"text-white text-xs font-bold",children:"1"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"font-medium text-blue-800",children:"Good Internet Connection"}),(0,Kg.jsx)("p",{className:"text-blue-700 text-sm",children:"Ensure you have a stable internet connection for the best call quality."})]})]}),(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Kg.jsx)("span",{className:"text-white text-xs font-bold",children:"2"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"font-medium text-blue-800",children:"Quiet Environment"}),(0,Kg.jsx)("p",{className:"text-blue-700 text-sm",children:"Choose a quiet place for important calls to avoid background noise."})]})]}),(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Kg.jsx)("span",{className:"text-white text-xs font-bold",children:"3"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"font-medium text-blue-800",children:"Camera Positioning"}),(0,Kg.jsx)("p",{className:"text-blue-700 text-sm",children:"Position your camera at eye level and ensure good lighting for video calls."})]})]}),(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,Kg.jsx)("span",{className:"text-white text-xs font-bold",children:"4"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h4",{className:"font-medium text-blue-800",children:"Emergency Calls"}),(0,Kg.jsx)("p",{className:"text-blue-700 text-sm",children:"For medical emergencies, always call emergency services directly."})]})]})]})]})]}),s&&(0,Kg.jsx)(t_,{isOpen:!!s,onClose:async()=>{if(s)try{await r.endCall(s.callId)}catch(e){console.error("Error ending call:",e)}n(null)},callType:s.callType,participantInfo:{id:s.participantId,name:s.participantName,role:"User"},isIncoming:!1})]})},a_=()=>{const{userProfile:e,userRole:s}=qg(),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)(null),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)(""),[p,m]=(0,t.useState)("all"),[f,g]=(0,t.useState)(!0),[y,v]=(0,t.useState)(!1),[x]=(0,t.useState)(new Xx),[_,E]=(0,t.useState)(null),[b,w]=(0,t.useState)(null),[N,S]=(0,t.useState)(!1),T=(0,t.useRef)(null),C=(0,t.useRef)(null);(0,t.useEffect)(()=>{(()=>{var e;null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[o]),(0,t.useEffect)(()=>{(async()=>{if(e)try{g(!0);const t=await Vx(e.id);r(t),t.length>0&&!i&&a(t[0])}catch(t){console.error("Error loading conversations:",t),yt.error("Failed to load conversations")}finally{g(!1)}})()},[e]),(0,t.useEffect)(()=>{if(!e)return;const t=((e,t)=>Xf(Nf(Um(Lg,Ux),Tf("participants","array-contains",e),If("lastMessageTime","desc")),e=>{const s=[];e.forEach(e=>{var t,n,r,i,a,o;const c=e.data();s.push(Le(Le({id:e.id},c),{},{lastMessageTime:(null===(t=c.lastMessageTime)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||c.lastMessageTime,createdAt:(null===(r=c.createdAt)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||c.createdAt,updatedAt:(null===(a=c.updatedAt)||void 0===a||null===(o=a.toDate)||void 0===o?void 0:o.call(a))||c.updatedAt}))}),t(s)}))(e.id,e=>{r(e)});return t},[e]),(0,t.useEffect)(()=>{if(!i)return;const e=((e,t)=>Xf(Nf(Um(Lg,Mx),Tf("conversationId","==",e),If("createdAt","desc"),Of(50)),e=>{const s=[];e.forEach(e=>{var t,n;const r=e.data();s.push(Le(Le({id:e.id},r),{},{createdAt:(null===(t=r.createdAt)||void 0===t||null===(n=t.toDate)||void 0===n?void 0:n.call(t))||r.createdAt}))}),t(s.reverse())}))(i.id,e=>{c(e)});return e},[i]),(0,t.useEffect)(()=>{if(!e)return;return x.listenForIncomingCalls(e.id,e=>{w(e)})},[e,x]),(0,t.useEffect)(()=>{(async()=>{if(i)try{const t=await Fx(i.id);c(t),await(async(e,t)=>{try{const s=Nf(Um(Lg,Mx),Tf("conversationId","==",e),Tf("senderId","!=",t),Tf("read","==",!1)),n=await Hf(s),r=[];return n.forEach(e=>{r.push(zf(e.ref,{read:!0,readAt:Zf()}))}),await Promise.all(r),!0}catch(s){throw console.error("Error marking conversation as read:",s),s}})(i.id,e.id)}catch(t){console.error("Error loading messages:",t),yt.error("Failed to load messages")}})()},[i,e]);const R=async()=>{if(l.trim()&&i&&!y){v(!0);try{await(async(e,t,s)=>{try{const n=Um(Lg,Mx),r=Le(Le({},s),{},{conversationId:e,senderId:t,read:!1,createdAt:Zf()}),i=await Yf(n,r),a=Vm(Lg,Ux,e);return await zf(a,{lastMessage:s.text||s.content,lastMessageTime:Zf(),updatedAt:Zf()}),i.id}catch(n){throw console.error("Error sending message:",n),n}})(i.id,e.id,{text:l.trim(),messageType:i.conversationType||"general"}),d("")}catch(t){console.error("Error sending message:",t),yt.error("Failed to send message")}finally{v(!1)}}},I=async()=>{if(!i||!e)return;const t=i.participants.find(t=>t.id!==e.id);if(t)try{const s=await x.initiateCall(e.id,t.id,"audio");s.success?E({callId:s.callId,participantId:t.id,participantName:t.name||t.displayName,callType:"audio"}):yt.error("Failed to start voice call")}catch(s){console.error("Error starting voice call:",s),yt.error("Failed to start voice call")}},A=async()=>{if(!i||!e)return;const t=i.participants.find(t=>t.id!==e.id);if(t)try{const s=await x.initiateCall(e.id,t.id,"video");s.success?E({callId:s.callId,participantId:t.id,participantName:t.name||t.displayName,callType:"video"}):yt.error("Failed to start video call")}catch(s){console.error("Error starting video call:",s),yt.error("Failed to start video call")}},O=async()=>{if(b)try{await x.rejectCall(b.callId,e.id),w(null)}catch(t){console.error("Error rejecting call:",t),yt.error("Failed to reject call")}},j=e=>{switch(e){case"medical":return(0,Kg.jsx)(Oy,{size:16,className:"text-blue-600"});case"care":return(0,Kg.jsx)(cy,{size:16,className:"text-green-600"});case"emergency":return(0,Kg.jsx)(mx,{size:16,className:"text-red-600"});default:return(0,Kg.jsx)(Ny,{size:16,className:"text-gray-600"})}},k=e=>{switch(e){case"medical":return"bg-blue-50 border-blue-200";case"care":return"bg-green-50 border-green-200";case"emergency":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},D=e=>{if(!e)return"";const t=new Date(e),s=(new Date-t)/36e5;return s<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s<48?"Yesterday":t.toLocaleDateString()},P=n.filter(e=>{var t;const s=(null===(t=e.lastMessage)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||e.participants.some(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase())}),n="all"===p||e.conversationType===p;return s&&n}),L=t=>{if(!t.participants)return"Unknown";const s=t.participants.find(t=>t.id!==e.id);return(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.displayName)||"Unknown User"},M=t=>{if(!t.participants)return"";const s=t.participants.find(t=>t.id!==e.id);return(null===s||void 0===s?void 0:s.role)||""};return f?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"flex h-full bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,Kg.jsxs)("div",{className:"".concat(N?"flex":"hidden"," md:flex w-full md:w-1/3 border-r border-gray-200 flex-col absolute md:relative z-10 md:z-auto bg-white h-full"),children:[(0,Kg.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>S(!N),className:"md:hidden p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Kg.jsx)(my,{size:20})}),(0,Kg.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Messages"})]}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Kg.jsx)(qy,{size:20})})]}),(0,Kg.jsxs)("div",{className:"relative mb-4",children:[(0,Kg.jsx)(uv,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,Kg.jsx)("input",{type:"text",placeholder:"Search conversations...",value:u,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,Kg.jsx)("div",{className:"flex space-x-2",children:["all","general","medical","care","emergency"].map(e=>(0,Kg.jsx)("button",{onClick:()=>m(e),className:"px-3 py-1 text-xs rounded-full ".concat(p===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,Kg.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===P.length?(0,Kg.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,Kg.jsx)(Ny,{size:48,className:"mx-auto mb-4 text-gray-300"}),(0,Kg.jsx)("p",{children:"No conversations found"})]}):P.map(e=>(0,Kg.jsx)("div",{onClick:()=>a(e),className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat((null===i||void 0===i?void 0:i.id)===e.id?"bg-blue-50 border-r-4 border-r-blue-600":""),children:(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(k(e.conversationType)),children:j(e.conversationType)}),(0,Kg.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:L(e)}),(0,Kg.jsx)("span",{className:"text-xs text-gray-500",children:D(e.lastMessageTime)})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-2 mt-1",children:(0,Kg.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("medical"===e.conversationType?"bg-blue-100 text-blue-800":"care"===e.conversationType?"bg-green-100 text-green-800":"emergency"===e.conversationType?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:M(e)})}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 truncate mt-1",children:e.lastMessage||"No messages yet"})]})]})},e.id))})]}),(0,Kg.jsxs)("div",{className:"flex-1 flex flex-col md:flex",children:[i&&(0,Kg.jsxs)("div",{className:"md:hidden flex items-center justify-between p-4 border-b border-gray-200 bg-white",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("button",{onClick:()=>S(!0),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Kg.jsx)(my,{size:20})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:L(i)}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:M(i)})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:I,className:"p-2 text-green-600 hover:text-green-800 rounded-lg hover:bg-green-50 transition-colors",title:"Voice Call",children:(0,Kg.jsx)(Ay,{size:20})}),(0,Kg.jsx)("button",{onClick:A,className:"p-2 text-blue-600 hover:text-blue-800 rounded-lg hover:bg-blue-50 transition-colors",title:"Video Call",children:(0,Kg.jsx)(ly,{size:20})})]})]}),i?(0,Kg.jsxs)(Kg.Fragment,{children:[(0,Kg.jsx)("div",{className:"hidden md:block p-4 border-b border-gray-200 bg-gray-50",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(k(i.conversationType)),children:j(i.conversationType)}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:L(i)}),(0,Kg.jsxs)("p",{className:"text-sm text-gray-600",children:[M(i)," \u2022 ",i.conversationType]})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:I,className:"p-2 text-gray-400 hover:text-green-600 rounded-lg hover:bg-green-50 transition-colors",title:"Voice Call",children:(0,Kg.jsx)(Ay,{size:20})}),(0,Kg.jsx)("button",{onClick:A,className:"p-2 text-gray-400 hover:text-blue-600 rounded-lg hover:bg-blue-50 transition-colors",title:"Video Call",children:(0,Kg.jsx)(ly,{size:20})}),(0,Kg.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:(0,Kg.jsx)(mv,{size:20})})]})]})}),(0,Kg.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===o.length?(0,Kg.jsxs)("div",{className:"text-center text-gray-500 mt-8",children:[(0,Kg.jsx)(Ny,{size:48,className:"mx-auto mb-4 text-gray-300"}),(0,Kg.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):o.map(t=>(0,Kg.jsx)("div",{className:"flex ".concat(t.senderId===e.id?"justify-end":"justify-start"),children:(0,Kg.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(t.senderId===e.id?"bg-blue-600 text-white":"system"===t.senderId?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-gray-100 text-gray-800"),children:["system"===t.senderId&&(0,Kg.jsxs)("div",{className:"flex items-center space-x-1 mb-1",children:[(0,Kg.jsx)(Ry,{size:12}),(0,Kg.jsx)("span",{className:"text-xs font-medium",children:"System"})]}),(0,Kg.jsx)("p",{className:"text-sm",children:t.text}),(0,Kg.jsxs)("div",{className:"flex items-center justify-end space-x-1 mt-1 ".concat(t.senderId===e.id?"text-blue-100":"text-gray-500"),children:[(0,Kg.jsx)("span",{className:"text-xs",children:D(t.createdAt)}),t.senderId===e.id&&(0,Kg.jsx)("div",{className:"flex items-center",children:t.read?(0,Kg.jsx)(fv,{size:12,className:"text-blue-100"}):(0,Kg.jsx)(gv,{size:12,className:"text-blue-100"})})]})]})},t.id)),(0,Kg.jsx)("div",{ref:T})]}),(0,Kg.jsx)("div",{className:"p-3 md:p-4 border-t border-gray-200 bg-gray-50",children:(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 touch-manipulation",children:(0,Kg.jsx)(yv,{size:20})}),(0,Kg.jsx)("input",{type:"file",ref:C,className:"hidden",accept:"image/*,application/pdf"}),(0,Kg.jsxs)("div",{className:"flex-1 relative",children:[(0,Kg.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"Type a message...",className:"w-full px-4 py-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,Kg.jsx)("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(vv,{size:20})})]}),(0,Kg.jsx)("button",{onClick:R,disabled:!l.trim()||y,className:"p-2 md:p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation",children:y?(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):(0,Kg.jsx)(xv,{size:20})})]})})]}):(0,Kg.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,Kg.jsxs)("div",{className:"text-center text-gray-500",children:[(0,Kg.jsx)(Ny,{size:64,className:"mx-auto mb-4 text-gray-300"}),(0,Kg.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Select a conversation"}),(0,Kg.jsx)("p",{className:"text-sm",children:"Choose a conversation from the sidebar to start messaging"})]})})]}),_&&(0,Kg.jsx)(t_,{isOpen:!!_,onClose:async()=>{if(_)try{await x.endCall(_.callId)}catch(e){console.error("Error ending call:",e)}E(null),w(null)},callType:_.callType,participantInfo:{id:_.participantId,name:_.participantName,role:"User"},isIncoming:!1}),b&&(0,Kg.jsx)(t_,{isOpen:!!b,onClose:O,callType:b.callType,participantInfo:{id:b.callerId,name:"Incoming Call",role:"User"},isIncoming:!0,onCallAccepted:async()=>{if(b)try{await x.answerCall(b.callId,e.id),E({callId:b.callId,participantId:b.callerId,participantName:"Incoming Call",callType:b.callType}),w(null)}catch(t){console.error("Error accepting call:",t),yt.error("Failed to accept call")}},onCallRejected:O})]})},o_=()=>((0,t.useEffect)(()=>{(()=>{let e=document.querySelector('meta[name="viewport"]'),t=document.querySelector('meta[name="theme-color"]'),s=document.querySelector('meta[name="apple-mobile-web-app-capable"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover",t||(t=document.createElement("meta"),t.name="theme-color",document.head.appendChild(t)),t.content="#3B82F6",s||(s=document.createElement("meta"),s.name="apple-mobile-web-app-capable",document.head.appendChild(s)),s.content="yes";let n=document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');n||(n=document.createElement("meta"),n.name="apple-mobile-web-app-status-bar-style",document.head.appendChild(n)),n.content="default";let r=document.querySelector('link[rel="apple-touch-icon"]');r||(r=document.createElement("link"),r.rel="apple-touch-icon",r.sizes="180x180",r.href="/favicon.ico",document.head.appendChild(r));let i=document.querySelector('link[rel="manifest"]');i||(i=document.createElement("link"),i.rel="manifest",i.href="/manifest.json",document.head.appendChild(i))})(),(()=>{let e=0;document.addEventListener("touchend",t=>{const s=(new Date).getTime();s-e<=300&&t.preventDefault(),e=s},!1);document.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("focus",()=>{window.innerWidth<768&&(document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")}),e.addEventListener("blur",()=>{document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"})})})(),(()=>{const e=document.createElement("style");e.textContent="\n        /* Mobile optimizations */\n        @media (max-width: 768px) {\n          /* Prevent horizontal scroll */\n          body {\n            overflow-x: hidden;\n          }\n          \n          /* Touch-friendly button sizes */\n          button, .btn {\n            min-height: 44px;\n            min-width: 44px;\n          }\n          \n          /* Improve touch targets */\n          input, textarea, select {\n            min-height: 44px;\n          }\n          \n          /* Better scrolling on iOS */\n          .overflow-y-auto {\n            -webkit-overflow-scrolling: touch;\n          }\n          \n          /* Prevent text selection on UI elements */\n          button, .no-select {\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n          }\n          \n          /* Optimize for mobile viewport */\n          .mobile-full-height {\n            height: 100vh;\n            height: 100dvh; /* Dynamic viewport height for mobile */\n          }\n          \n          /* Better touch feedback */\n          .touch-manipulation {\n            touch-action: manipulation;\n          }\n          \n          /* Prevent pull-to-refresh on mobile */\n          body {\n            overscroll-behavior: none;\n          }\n        }\n        \n        /* Landscape mobile optimizations */\n        @media (max-width: 768px) and (orientation: landscape) {\n          .mobile-landscape-hide {\n            display: none !important;\n          }\n          \n          .mobile-landscape-compact {\n            padding: 0.5rem !important;\n          }\n        }\n        \n        /* iOS specific fixes */\n        @supports (-webkit-touch-callout: none) {\n          input, textarea {\n            font-size: 16px; /* Prevents zoom on iOS */\n          }\n        }\n      ",document.head.appendChild(e)})();/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&document.body.classList.add("mobile-device");const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};return window.addEventListener("orientationchange",e),window.addEventListener("resize",e),e(),()=>{window.removeEventListener("orientationchange",e),window.removeEventListener("resize",e)}},[]),null),c_=()=>(0,Kg.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Loading ElderX..."})]})}),l_=Qg("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),d_=Qg("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const u_=new class{constructor(){this.isInstalled=!1,this.deferredPrompt=null,this.isOnline=navigator.onLine,this.swRegistration=null,this.init()}async init(){await this.registerServiceWorker(),this.setupInstallPrompt(),this.setupOnlineOfflineListeners(),this.setupUpdateNotifications()}async registerServiceWorker(){if("serviceWorker"in navigator)try{this.swRegistration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered successfully:",this.swRegistration),this.swRegistration.addEventListener("updatefound",()=>{const e=this.swRegistration.installing;e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})}),navigator.serviceWorker.addEventListener("message",e=>{this.handleServiceWorkerMessage(e.data)})}catch(e){console.error("Service Worker registration failed:",e)}}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{console.log("PWA install prompt triggered"),e.preventDefault(),this.deferredPrompt=e,this.showInstallPrompt()}),window.addEventListener("appinstalled",()=>{console.log("PWA installed successfully"),this.isInstalled=!0,this.deferredPrompt=null,yt.success("ElderX has been installed successfully!")})}showInstallPrompt(){if(this.deferredPrompt&&!this.isInstalled){const e=document.createElement("button");e.textContent="Install ElderX",e.className="pwa-install-button",e.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: #3b82f6;\n        color: white;\n        border: none;\n        padding: 12px 20px;\n        border-radius: 25px;\n        font-weight: 500;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n        z-index: 1000;\n        animation: slideInUp 0.3s ease-out;\n      ",e.addEventListener("click",()=>{this.installPWA(),e.remove()}),document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.remove()},1e4)}}async installPWA(){if(this.deferredPrompt){this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;"accepted"===e?console.log("User accepted PWA install"):console.log("User dismissed PWA install"),this.deferredPrompt=null}}setupOnlineOfflineListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.handleOnline()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.handleOffline()})}handleOnline(){console.log("Connection restored"),yt.success("Connection restored! Syncing data..."),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CONNECTION_RESTORED"}),this.syncOfflineData()}handleOffline(){console.log("Connection lost"),yt.info("You're now offline. Some features may be limited.")}setupUpdateNotifications(){this.swRegistration&&this.swRegistration.addEventListener("updatefound",()=>{const e=this.swRegistration.installing;e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})})}showUpdateNotification(){const e=document.createElement("div");e.className="pwa-update-notification",e.innerHTML='\n      <div style="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: white;\n        border: 1px solid #e5e7eb;\n        border-radius: 12px;\n        padding: 16px;\n        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);\n        z-index: 1000;\n        max-width: 300px;\n        animation: slideInRight 0.3s ease-out;\n      ">\n        <h4 style="margin: 0 0 8px 0; color: #1f2937; font-size: 14px; font-weight: 600;">\n          Update Available\n        </h4>\n        <p style="margin: 0 0 12px 0; color: #6b7280; font-size: 12px; line-height: 1.4;">\n          A new version of ElderX is available. Refresh to update.\n        </p>\n        <div style="display: flex; gap: 8px;">\n          <button id="update-now" style="\n            background: #3b82f6;\n            color: white;\n            border: none;\n            padding: 6px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            cursor: pointer;\n            font-weight: 500;\n          ">Update Now</button>\n          <button id="update-later" style="\n            background: #f3f4f6;\n            color: #6b7280;\n            border: none;\n            padding: 6px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            cursor: pointer;\n          ">Later</button>\n        </div>\n      </div>\n    ',document.body.appendChild(e),document.getElementById("update-now").addEventListener("click",()=>{this.updateApp(),e.remove()}),document.getElementById("update-later").addEventListener("click",()=>{e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},15e3)}async updateApp(){this.swRegistration&&this.swRegistration.waiting&&(this.swRegistration.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())}async syncOfflineData(){try{const t=await this.getQueuedRequests();for(const s of t)try{await this.retryRequest(s),await this.removeQueuedRequest(s.id)}catch(e){console.error("Failed to sync request:",e)}t.length>0&&yt.success("".concat(t.length," offline actions synced successfully!"))}catch(e){console.error("Failed to sync offline data:",e)}}async getQueuedRequests(){return new Promise((e,t)=>{const s=indexedDB.open("elderx-offline-queue",1);s.onerror=()=>t(s.error),s.onsuccess=()=>{const n=s.result;if(!n.objectStoreNames.contains("requests"))return void e([]);const r=n.transaction(["requests"],"readonly").objectStore("requests").getAll();r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)},s.onupgradeneeded=()=>{const e=s.result;e.objectStoreNames.contains("requests")||e.createObjectStore("requests",{keyPath:"timestamp"})}})}async retryRequest(e){const t=await fetch(e.url,{method:e.method,headers:e.headers,body:e.body});if(!t.ok)throw new Error("Request failed: ".concat(t.status));return t}async removeQueuedRequest(e){return new Promise((t,s)=>{const n=indexedDB.open("elderx-offline-queue",1);n.onerror=()=>s(n.error),n.onsuccess=()=>{const r=n.result.transaction(["requests"],"readwrite").objectStore("requests").delete(e);r.onsuccess=()=>t(),r.onerror=()=>s(r.error)}})}handleServiceWorkerMessage(e){switch(e.type){case"REQUEST_QUEUED":yt.info("Action queued for when you're back online");break;case"REQUEST_RETRY_SUCCESS":console.log("Queued request retried successfully");break;case"UPDATE_AVAILABLE":this.showUpdateNotification();break;default:console.log("Unknown service worker message:",e)}}isPWAInstalled(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")}getPWAStatus(){return{isInstalled:this.isPWAInstalled(),isOnline:this.isOnline,hasServiceWorker:!!this.swRegistration,canInstall:!!this.deferredPrompt}}async requestNotificationPermission(){if("Notification"in window&&"default"===Notification.permission){return"granted"===await Notification.requestPermission()}return"granted"===Notification.permission}showLocalNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("Notification"in window&&"granted"===Notification.permission){const s=new Notification(e,Le({icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png"},t));return s.onclick=()=>{window.focus(),s.close()},s}}async registerBackgroundSync(e){if("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype){const t=await navigator.serviceWorker.ready;await t.sync.register(e)}}async getCacheStatus(){if("caches"in window){const e=await caches.keys(),t={};for(const s of e){const e=await caches.open(s),n=await e.keys();t[s]=n.length}return t}return{}}async clearCache(){if("caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e))),yt.success("Cache cleared successfully")}}},h_=u_,p_=()=>{const[e,s]=(0,t.useState)(!1),[n,r]=(0,t.useState)(!1),[i,a]=(0,t.useState)(null);(0,t.useEffect)(()=>{r(h_.isPWAInstalled());const e=e=>{e.preventDefault(),a(e),s(!0)},t=()=>{r(!0),s(!1),a(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}},[]);const o=()=>{s(!1),sessionStorage.setItem("pwa-install-dismissed","true")};return n||!e||sessionStorage.getItem("pwa-install-dismissed")?null:(0,Kg.jsx)("div",{className:"fixed bottom-4 right-4 z-50 max-w-sm",children:(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 animate-slide-in-up",children:[(0,Kg.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,Kg.jsx)(Tv,{className:"w-4 h-4 text-blue-600"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"font-semibold text-gray-900 text-sm",children:"Install ElderX"}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:"Get the full app experience"})]})]}),(0,Kg.jsx)("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,Kg.jsx)(hy,{className:"w-4 h-4"})})]}),(0,Kg.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[(0,Kg.jsx)(l_,{className:"w-3 h-3"}),(0,Kg.jsx)("span",{children:"Works offline"})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[(0,Kg.jsx)(d_,{className:"w-3 h-3"}),(0,Kg.jsx)("span",{children:"Fast and responsive"})]})]}),(0,Kg.jsxs)("div",{className:"flex space-x-2",children:[(0,Kg.jsx)("button",{onClick:async()=>{if(i){i.prompt();const{outcome:e}=await i.userChoice;"accepted"===e?console.log("User accepted PWA install"):console.log("User dismissed PWA install"),a(null),s(!1)}},className:"flex-1 bg-blue-600 text-white text-sm font-medium py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors",children:"Install"}),(0,Kg.jsx)("button",{onClick:o,className:"flex-1 bg-gray-100 text-gray-700 text-sm font-medium py-2 px-3 rounded-lg hover:bg-gray-200 transition-colors",children:"Not now"})]})]})})},m_=Qg("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),f_=Qg("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),g_=()=>{const[e,s]=(0,t.useState)(navigator.onLine),[n,r]=(0,t.useState)(!1),[i,a]=(0,t.useState)(0);(0,t.useEffect)(()=>{const e=()=>{s(!0),r(!1),setTimeout(()=>{r(!1)},3e3)},t=()=>{s(!1),r(!0)};return window.addEventListener("online",e),window.addEventListener("offline",t),navigator.onLine||r(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,t.useEffect)(()=>{const e=async()=>{try{const e=await h_.getQueuedRequests();a(e.length)}catch(e){console.error("Failed to check queued requests:",e)}},t=setInterval(e,5e3);return e(),()=>clearInterval(t)},[]);return n?(0,Kg.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 max-w-sm w-full mx-4",children:(0,Kg.jsxs)("div",{className:"rounded-lg shadow-lg p-3 transition-all duration-300 ".concat(e?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"),children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center ".concat(e?"bg-green-200":"bg-red-200"),children:e?(0,Kg.jsx)(m_,{className:"w-3 h-3 text-green-600"}):(0,Kg.jsx)(f_,{className:"w-3 h-3 text-red-600"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("p",{className:"text-sm font-medium ".concat(e?"text-green-800":"text-red-800"),children:e?"Back Online":"You're Offline"}),(0,Kg.jsx)("p",{className:"text-xs ".concat(e?"text-green-600":"text-red-600"),children:e?"Syncing your data...":i>0?"".concat(i," actions queued"):"Some features may be limited"})]})]}),!e&&i>0&&(0,Kg.jsx)("button",{onClick:async()=>{try{await h_.syncOfflineData(),a(0)}catch(e){console.error("Failed to sync offline data:",e)}},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-200 rounded transition-colors",title:"Retry sync",children:(0,Kg.jsx)($g,{className:"w-4 h-4"})})]}),!e&&(0,Kg.jsx)("div",{className:"mt-2 pt-2 border-t border-red-200",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between text-xs text-red-600",children:[(0,Kg.jsx)("span",{children:"Available offline:"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("span",{children:"\ud83d\udccb View data"}),(0,Kg.jsx)("span",{children:"\ud83d\udcac Read messages"}),(0,Kg.jsx)("span",{children:"\ud83d\udcc5 Check schedule"})]})]})})]})}):null};const y_=new class{constructor(){this.onListeningStart=null,this.onListeningEnd=null,this.onError=null,this.onNoMatch=null,this.onUnknownCommand=null,this.onCallCommand=null,this.onEndCallCommand=null,this.onAnswerCallCommand=null,this.onRejectCallCommand=null,this.onSendMessageCommand=null,this.onReadMessagesCommand=null,this.onNavigationCommand=null,this.onBackCommand=null,this.onHomeCommand=null,this.onCompleteTaskCommand=null,this.onAssignTaskCommand=null,this.onEmergencyCommand=null,this.onMedicationCommand=null,this.onVitalSignsCommand=null,this.onHelpCommand=null,this.recognition=null,this.isListening=!1,this.isSupported=!1,this.commands=new Map,this.continuousMode=!1,this.language="en-US",this.grammars=null,this.init()}init(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.recognition=new e,this.isSupported=!0,this.setupRecognition(),this.setupDefaultCommands(),console.log("Voice command service initialized")):console.log("Speech recognition not supported")}setupRecognition(){this.recognition&&(this.recognition.continuous=this.continuousMode,this.recognition.interimResults=!1,this.recognition.lang=this.language,this.recognition.maxAlternatives=1,this.recognition.onstart=()=>{var e;this.isListening=!0,console.log("Voice recognition started"),null===(e=this.onListeningStart)||void 0===e||e.call(this)},this.recognition.onresult=e=>{const t=e.results[e.resultIndex],s=t[0].transcript.toLowerCase().trim(),n=t[0].confidence;console.log("Voice command:",s,"Confidence:",n),this.processCommand(s,n)},this.recognition.onerror=e=>{var t;console.error("Voice recognition error:",e.error),this.isListening=!1,null===(t=this.onError)||void 0===t||t.call(this,e.error)},this.recognition.onend=()=>{var e;this.isListening=!1,console.log("Voice recognition ended"),null===(e=this.onListeningEnd)||void 0===e||e.call(this)},this.recognition.onspeechstart=()=>{console.log("Speech started")},this.recognition.onspeechend=()=>{console.log("Speech ended")},this.recognition.onnomatch=()=>{var e;console.log("No speech was recognized"),null===(e=this.onNoMatch)||void 0===e||e.call(this)})}setupDefaultCommands(){this.addCommand("call",["call","phone","dial"],e=>{var t;null===(t=this.onCallCommand)||void 0===t||t.call(this,e)}),this.addCommand("end call",["end call","hang up","disconnect"],()=>{var e;null===(e=this.onEndCallCommand)||void 0===e||e.call(this)}),this.addCommand("answer call",["answer","pick up"],()=>{var e;null===(e=this.onAnswerCallCommand)||void 0===e||e.call(this)}),this.addCommand("reject call",["reject","decline"],()=>{var e;null===(e=this.onRejectCallCommand)||void 0===e||e.call(this)}),this.addCommand("send message",["send message","text","message"],e=>{var t;null===(t=this.onSendMessageCommand)||void 0===t||t.call(this,e)}),this.addCommand("read messages",["read messages","show messages"],()=>{var e;null===(e=this.onReadMessagesCommand)||void 0===e||e.call(this)}),this.addCommand("go to",["go to","navigate to","open"],e=>{var t;null===(t=this.onNavigationCommand)||void 0===t||t.call(this,e)}),this.addCommand("back",["back","go back","return"],()=>{var e;null===(e=this.onBackCommand)||void 0===e||e.call(this)}),this.addCommand("home",["home","dashboard"],()=>{var e;null===(e=this.onHomeCommand)||void 0===e||e.call(this)}),this.addCommand("complete task",["complete task","mark done"],e=>{var t;null===(t=this.onCompleteTaskCommand)||void 0===t||t.call(this,e)}),this.addCommand("assign task",["assign task","create task"],e=>{var t;null===(t=this.onAssignTaskCommand)||void 0===t||t.call(this,e)}),this.addCommand("emergency",["emergency","urgent","help"],()=>{var e;null===(e=this.onEmergencyCommand)||void 0===e||e.call(this)}),this.addCommand("medication",["medication","medicine","drug"],e=>{var t;null===(t=this.onMedicationCommand)||void 0===t||t.call(this,e)}),this.addCommand("vital signs",["vital signs","check vitals"],()=>{var e;null===(e=this.onVitalSignsCommand)||void 0===e||e.call(this)}),this.addCommand("stop listening",["stop listening","stop voice"],()=>{this.stopListening()}),this.addCommand("start listening",["start listening","voice command"],()=>{this.startListening()}),this.addCommand("help",["help","commands"],()=>{var e;null===(e=this.onHelpCommand)||void 0===e||e.call(this)})}addCommand(e,t,s){this.commands.set(e,{triggers:t,callback:s,name:e})}removeCommand(e){return this.commands.delete(e)}processCommand(e,t){if(t<.5)return void console.log("Low confidence command ignored:",e);let s=!1;for(const[r,i]of this.commands){for(const t of i.triggers)if(e.includes(t)){s=!0;const n=this.extractParameters(e,t);console.log("Executing command:",r,"with params:",n),i.callback(n);break}if(s)break}var n;s||(console.log("No matching command found for:",e),null===(n=this.onUnknownCommand)||void 0===n||n.call(this,e))}extractParameters(e,t){const s={};let n=e.replace(t,"").trim();if(n){s.text=n;const e=n.match(/\b[A-Z][a-z]+\b/g);e&&(s.names=e);const t=n.match(/\d+/g);t&&(s.numbers=t.map(Number));const r=/\b(\d{1,2}):(\d{2})\b/g,i=[];let a;for(;null!==(a=r.exec(n));)i.push({hour:parseInt(a[1]),minute:parseInt(a[2])});i.length>0&&(s.times=i)}return s}startListening(){if(!this.isSupported||this.isListening)return!1;try{return this.recognition.start(),!0}catch(e){return console.error("Failed to start voice recognition:",e),!1}}stopListening(){this.isListening&&this.recognition.stop()}setContinuousMode(e){this.continuousMode=e,this.recognition&&(this.recognition.continuous=e)}setLanguage(e){this.language=e,this.recognition&&(this.recognition.lang=e)}setMaxAlternatives(e){this.recognition&&(this.recognition.maxAlternatives=e)}getCommands(){const e=[];for(const[t,s]of this.commands)e.push({name:t,triggers:s.triggers,description:this.getCommandDescription(t)});return e}getCommandDescription(e){return{call:"Initiate a voice or video call","end call":"End the current call","answer call":"Answer an incoming call","reject call":"Reject an incoming call","send message":"Send a text message","read messages":"Read recent messages","go to":"Navigate to a specific page",back:"Go back to previous page",home:"Go to dashboard","complete task":"Mark a task as complete","assign task":"Assign a new task",emergency:"Trigger emergency alert",medication:"Access medication information","vital signs":"Check patient vital signs","stop listening":"Stop voice recognition","start listening":"Start voice recognition",help:"Show available voice commands"}[e]||"Custom voice command"}getStatus(){return{supported:this.isSupported,listening:this.isListening,continuous:this.continuousMode,language:this.language,commands:this.commands.size}}test(){this.isSupported?(console.log("Testing voice recognition..."),this.startListening(),setTimeout(()=>{this.stopListening()},5e3)):console.log("Voice recognition not supported")}createVoiceButton(e,t){if(!e||!this.isSupported)return e;return e.addEventListener("click",()=>{this.isListening?this.stopListening():this.startListening()}),e}addVoiceCommand(e,t){if(!e||!this.isSupported)return e;return e.addEventListener("click",()=>{this.processCommand(t,1)}),e}getCapabilities(){return{continuous:!0,interimResults:!0,maxAlternatives:10,grammars:!1,languages:["en-US","en-GB","en-AU","en-CA","es-ES","es-MX","fr-FR","fr-CA","de-DE","it-IT","pt-BR","pt-PT","ru-RU","ja-JP","ko-KR","zh-CN"]}}},v_=y_;const x_=new class{constructor(){this.isSupported="vibrate"in navigator,this.isHapticSupported="vibrate"in navigator||"navigator"in window&&"vibrate"in navigator,this.patterns={incomingCall:[200,100,200,100,200,100,200,100,200,100,200,100,200,100,200,100],callConnected:[100,50,100],callEnded:[200,100,200,100,200],callRejected:[300,100,300],newMessage:[100,50,100],messageSent:[50],buttonPress:[50],navigation:[25],success:[100,50,100],error:[200,100,200,100,200],warning:[150,100,150,100,150],taskComplete:[100,50,100,50,100],taskAssigned:[75,25,75],alert:[300,200,300,200,300],reminder:[100,100,100],emergency:[500,250,500,250,500,250,500]},this.init()}init(){this.isSupported?console.log("Haptic feedback service initialized"):console.log("Haptic feedback not supported on this device")}vibrate(e){if(!this.isSupported)return console.log("Vibration not supported"),!1;try{return"string"===typeof e&&this.patterns[e]?navigator.vibrate(this.patterns[e]):(Array.isArray(e)||"number"===typeof e)&&navigator.vibrate(e),!0}catch(t){return console.error("Vibration failed:",t),!1}}incomingCall(){return this.vibrate("incomingCall")}callConnected(){return this.vibrate("callConnected")}callEnded(){return this.vibrate("callEnded")}callRejected(){return this.vibrate("callRejected")}newMessage(){return this.vibrate("newMessage")}messageSent(){return this.vibrate("messageSent")}buttonPress(){return this.vibrate("buttonPress")}navigation(){return this.vibrate("navigation")}success(){return this.vibrate("success")}error(){return this.vibrate("error")}warning(){return this.vibrate("warning")}taskComplete(){return this.vibrate("taskComplete")}taskAssigned(){return this.vibrate("taskAssigned")}alert(){return this.vibrate("alert")}reminder(){return this.vibrate("reminder")}emergency(){return this.vibrate("emergency")}custom(e){return this.vibrate(e)}stop(){this.isSupported&&navigator.vibrate(0)}isHapticSupported(){return this.isSupported}getPatterns(){return Object.keys(this.patterns)}addPattern(e,t){return!!(Array.isArray(t)&&t.length>0)&&(this.patterns[e]=t,!0)}removePattern(e){return!(!this.patterns[e]||this.isBuiltInPattern(e))&&(delete this.patterns[e],!0)}isBuiltInPattern(e){return["incomingCall","callConnected","callEnded","callRejected","newMessage","messageSent","buttonPress","navigation","success","error","warning","taskComplete","taskAssigned","alert","reminder","emergency"].includes(e)}getPattern(e){return this.patterns[e]||null}test(){console.log("Testing haptic feedback..."),this.buttonPress(),setTimeout(()=>{this.success()},500),setTimeout(()=>{this.error()},1e3)}createHapticButton(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"buttonPress";if(!e||!this.isSupported)return e;const s=e.onClick;return e.onClick=e=>{this.vibrate(t),s&&s(e)},e}addHapticToElement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"buttonPress";if(!e||!this.isSupported)return e;const s=()=>{this.vibrate(t)};return e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("click",s),e}removeHapticFromElement(e){if(!e)return;const t=()=>{this.stop()};e.removeEventListener("touchstart",t),e.removeEventListener("click",t)}formFeedback(e,t){switch(e){case"focus":this.vibrate(25);break;case"blur":this.vibrate(15);break;case"submit":this.success();break;case"error":this.error();break;case"validation":this.warning();break;default:this.buttonPress()}}contextualFeedback(e,t){const s={call:{start:()=>this.callConnected(),end:()=>this.callEnded(),reject:()=>this.callRejected(),incoming:()=>this.incomingCall()},message:{send:()=>this.messageSent(),receive:()=>this.newMessage()},navigation:{back:()=>this.navigation(),forward:()=>this.navigation(),menu:()=>this.buttonPress()},task:{complete:()=>this.taskComplete(),assign:()=>this.taskAssigned()},medical:{alert:()=>this.alert(),reminder:()=>this.reminder(),emergency:()=>this.emergency()}};return s[e]&&s[e][t]?s[e][t]():this.buttonPress()}getStatus(){return{supported:this.isSupported,patterns:Object.keys(this.patterns).length,customPatterns:Object.keys(this.patterns).filter(e=>!this.isBuiltInPattern(e)).length}}},__=e=>{let{isOpen:s,onClose:n,onCommand:r}=e;const[i,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(!1),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)([]),[p,m]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[y,v]=(0,t.useState)("en-US"),x=(0,t.useRef)(null);(0,t.useEffect)(()=>(c(v_.isSupported),h(v_.getCommands()),v_.onListeningStart=()=>{a(!0),x_.buttonPress()},v_.onListeningEnd=()=>{a(!1)},v_.onError=e=>{console.error("Voice recognition error:",e),a(!1),x_.error()},v_.onUnknownCommand=e=>{d('Unknown command: "'.concat(e,'"')),x_.warning()},v_.onCallCommand=e=>{null===r||void 0===r||r("call",e),x_.callConnected()},v_.onEndCallCommand=()=>{null===r||void 0===r||r("endCall",{}),x_.callEnded()},v_.onAnswerCallCommand=()=>{null===r||void 0===r||r("answerCall",{}),x_.callConnected()},v_.onRejectCallCommand=()=>{null===r||void 0===r||r("rejectCall",{}),x_.callRejected()},v_.onSendMessageCommand=e=>{null===r||void 0===r||r("sendMessage",e),x_.messageSent()},v_.onReadMessagesCommand=()=>{null===r||void 0===r||r("readMessages",{}),x_.buttonPress()},v_.onNavigationCommand=e=>{null===r||void 0===r||r("navigate",e),x_.navigation()},v_.onBackCommand=()=>{null===r||void 0===r||r("back",{}),x_.navigation()},v_.onHomeCommand=()=>{null===r||void 0===r||r("home",{}),x_.navigation()},v_.onCompleteTaskCommand=e=>{null===r||void 0===r||r("completeTask",e),x_.taskComplete()},v_.onAssignTaskCommand=e=>{null===r||void 0===r||r("assignTask",e),x_.taskAssigned()},v_.onEmergencyCommand=()=>{null===r||void 0===r||r("emergency",{}),x_.emergency()},v_.onMedicationCommand=e=>{null===r||void 0===r||r("medication",e),x_.alert()},v_.onVitalSignsCommand=()=>{null===r||void 0===r||r("vitalSigns",{}),x_.alert()},v_.onHelpCommand=()=>{null===r||void 0===r||r("help",{}),x_.buttonPress()},()=>{v_.onListeningStart=null,v_.onListeningEnd=null,v_.onError=null,v_.onUnknownCommand=null}),[r]),(0,t.useEffect)(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[l]);return s?(0,Kg.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Voice Commands"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>m(!p),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Kg.jsx)(Cy,{className:"w-4 h-4"})}),(0,Kg.jsx)("button",{onClick:n,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Kg.jsx)(hy,{className:"w-4 h-4"})})]})]}),(0,Kg.jsxs)("div",{className:"p-4 space-y-4",children:[(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("div",{className:"w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center transition-colors ".concat(i?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"),children:i?(0,Kg.jsx)(Lv,{className:"w-8 h-8"}):(0,Kg.jsx)(Mv,{className:"w-8 h-8"})}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:i?"Listening...":"Tap to start voice commands"})]}),l&&(0,Kg.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,Kg.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Transcript:"}),(0,Kg.jsx)("div",{ref:x,className:"text-sm text-gray-900 max-h-20 overflow-y-auto",children:l})]}),(0,Kg.jsx)("div",{className:"flex justify-center space-x-4",children:(0,Kg.jsx)("button",{onClick:()=>{i?v_.stopListening():v_.startListening()&&d("")},disabled:!o,className:"px-6 py-3 rounded-lg font-medium transition-colors ".concat(i?"bg-red-600 text-white hover:bg-red-700":"bg-blue-600 text-white hover:bg-blue-700"," ").concat(o?"":"opacity-50 cursor-not-allowed"),children:i?"Stop Listening":"Start Listening"})}),p&&(0,Kg.jsxs)("div",{className:"space-y-3 pt-3 border-t border-gray-200",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Continuous Mode"}),(0,Kg.jsx)("button",{onClick:()=>{return g(e=!f),void v_.setContinuousMode(e);var e},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(f?"bg-blue-600":"bg-gray-200"),children:(0,Kg.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(f?"translate-x-6":"translate-x-1")})})]}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Language"}),(0,Kg.jsxs)("select",{value:y,onChange:e=>{return t=e.target.value,v(t),void v_.setLanguage(t);var t},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,Kg.jsx)("option",{value:"en-US",children:"English (US)"}),(0,Kg.jsx)("option",{value:"en-GB",children:"English (UK)"}),(0,Kg.jsx)("option",{value:"es-ES",children:"Spanish"}),(0,Kg.jsx)("option",{value:"fr-FR",children:"French"}),(0,Kg.jsx)("option",{value:"de-DE",children:"German"})]})]})]}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Available Commands:"}),(0,Kg.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:u.slice(0,10).map((e,t)=>(0,Kg.jsxs)("div",{className:"text-xs text-gray-600 bg-gray-50 p-2 rounded",children:[(0,Kg.jsx)("div",{className:"font-medium",children:e.name}),(0,Kg.jsx)("div",{className:"text-gray-500",children:e.description})]},t))})]}),!o&&(0,Kg.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,Kg.jsx)("p",{className:"text-sm text-yellow-800",children:"Voice commands are not supported on this device or browser."})})]})]})}):null},E_=Qg("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),b_=Qg("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),w_=Qg("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),N_=Qg("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),S_=Qg("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),T_=Qg("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]),C_=Qg("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);const R_=new class{constructor(){this.onSwipeLeft=null,this.onSwipeRight=null,this.onSwipeUp=null,this.onSwipeDown=null,this.onPinchIn=null,this.onPinchOut=null,this.onLongPress=null,this.onDoubleTap=null,this.isSupported="ontouchstart"in window,this.gestures=new Map,this.activeGestures=new Map,this.thresholds={swipe:{minDistance:50,maxTime:500,maxAngle:30},pinch:{minScale:.5,maxScale:3},longPress:{duration:500},doubleTap:{maxTime:300}},this.init()}init(){this.isSupported?(this.setupEventListeners(),this.setupDefaultGestures(),console.log("Gesture service initialized")):console.log("Touch gestures not supported")}setupEventListeners(){document.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),document.addEventListener("touchcancel",this.handleTouchCancel.bind(this),{passive:!1})}setupDefaultGestures(){this.addGesture("swipe-left",{type:"swipe",direction:"left",callback:e=>{var t;return null===(t=this.onSwipeLeft)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("swipe-right",{type:"swipe",direction:"right",callback:e=>{var t;return null===(t=this.onSwipeRight)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("swipe-up",{type:"swipe",direction:"up",callback:e=>{var t;return null===(t=this.onSwipeUp)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("swipe-down",{type:"swipe",direction:"down",callback:e=>{var t;return null===(t=this.onSwipeDown)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("pinch-in",{type:"pinch",direction:"in",callback:e=>{var t;return null===(t=this.onPinchIn)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("pinch-out",{type:"pinch",direction:"out",callback:e=>{var t;return null===(t=this.onPinchOut)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("long-press",{type:"longPress",callback:e=>{var t;return null===(t=this.onLongPress)||void 0===t?void 0:t.call(this,e)}}),this.addGesture("double-tap",{type:"doubleTap",callback:e=>{var t;return null===(t=this.onDoubleTap)||void 0===t?void 0:t.call(this,e)}})}addGesture(e,t){this.gestures.set(e,Le(Le({},t),{},{name:e,active:!1,startTime:0,startPosition:null,startDistance:0,lastTapTime:0}))}removeGesture(e){return this.gestures.delete(e)}handleTouchStart(e){const t=e.touches[0],s=Date.now();for(const[n,r]of this.gestures)if("longPress"===r.type)r.active=!0,r.startTime=s,r.startPosition={x:t.clientX,y:t.clientY},r.timeout=setTimeout(()=>{r.active&&this.triggerGesture(n,{position:r.startPosition,duration:Date.now()-r.startTime})},this.thresholds.longPress.duration);else if("doubleTap"===r.type){const e=s-r.lastTapTime;e<this.thresholds.doubleTap.maxTime&&this.triggerGesture(n,{position:{x:t.clientX,y:t.clientY},timeSinceLastTap:e}),r.lastTapTime=s}else"swipe"===r.type?(r.active=!0,r.startTime=s,r.startPosition={x:t.clientX,y:t.clientY}):"pinch"===r.type&&2===e.touches.length&&(r.active=!0,r.startTime=s,r.startDistance=this.getDistance({x:e.touches[0].clientX,y:e.touches[0].clientY},{x:e.touches[1].clientX,y:e.touches[1].clientY}))}handleTouchMove(e){const t=e.touches[0],s=Date.now();for(const[n,r]of this.gestures)if(r.active)if("longPress"===r.type){this.getDistance(r.startPosition,{x:t.clientX,y:t.clientY})>10&&(r.active=!1,r.timeout&&clearTimeout(r.timeout))}else if("swipe"===r.type){const e=this.getDistance(r.startPosition,{x:t.clientX,y:t.clientY}),i=this.getAngle(r.startPosition,{x:t.clientX,y:t.clientY});if(e>this.thresholds.swipe.minDistance&&s-r.startTime<this.thresholds.swipe.maxTime){this.getSwipeDirection(i)===r.direction&&(this.triggerGesture(n,{startPosition:r.startPosition,endPosition:{x:t.clientX,y:t.clientY},distance:e,angle:i,duration:s-r.startTime}),r.active=!1)}}else if("pinch"===r.type&&2===e.touches.length){const t=this.getDistance({x:e.touches[0].clientX,y:e.touches[0].clientY},{x:e.touches[1].clientX,y:e.touches[1].clientY}),i=t/r.startDistance;("out"===r.direction&&i>1.1||"in"===r.direction&&i<.9)&&(this.triggerGesture(n,{startDistance:r.startDistance,currentDistance:t,scale:i,duration:s-r.startTime}),r.active=!1)}}handleTouchEnd(e){Date.now();for(const[t,s]of this.gestures)s.active&&("longPress"===s.type?(s.active=!1,s.timeout&&clearTimeout(s.timeout)):("swipe"===s.type||"pinch"===s.type)&&(s.active=!1))}handleTouchCancel(e){for(const[t,s]of this.gestures)s.active=!1,s.timeout&&clearTimeout(s.timeout)}triggerGesture(e,t){const s=this.gestures.get(e);s&&s.callback&&(console.log("Triggering gesture:",e,t),s.callback(t))}getDistance(e,t){const s=t.x-e.x,n=t.y-e.y;return Math.sqrt(s*s+n*n)}getAngle(e,t){const s=t.x-e.x,n=t.y-e.y;return 180*Math.atan2(n,s)/Math.PI}getSwipeDirection(e){return e>=-45&&e<45?"right":e>=45&&e<135?"down":e>=135||e<-135?"left":e>=-135&&e<-45?"up":null}addGestureToElement(e,t,s){if(!e||!this.isSupported)return e;const n=this.gestures.get(t);if(!n)return console.error("Gesture not found:",t),e;const r=Le(Le({},n),{},{element:e,callback:s.callback||n.callback});return e.addEventListener("touchstart",e=>{this.handleElementTouchStart(e,r)},{passive:!1}),e.addEventListener("touchmove",e=>{this.handleElementTouchMove(e,r)},{passive:!1}),e.addEventListener("touchend",e=>{this.handleElementTouchEnd(e,r)},{passive:!1}),e}handleElementTouchStart(e,t){(e.target===t.element||t.element.contains(e.target))&&this.handleTouchStart(e)}handleElementTouchMove(e,t){(e.target===t.element||t.element.contains(e.target))&&this.handleTouchMove(e)}handleElementTouchEnd(e,t){(e.target===t.element||t.element.contains(e.target))&&this.handleTouchEnd(e)}setThreshold(e,t){this.thresholds[e]&&(this.thresholds[e]=Le(Le({},this.thresholds[e]),t))}getStatus(){return{supported:this.isSupported,gestures:this.gestures.size,thresholds:this.thresholds}}enableGesture(e){const t=this.gestures.get(e);t&&(t.enabled=!0)}disableGesture(e){const t=this.gestures.get(e);t&&(t.enabled=!1)}test(){this.isSupported?(console.log("Testing gestures..."),console.log("Available gestures:",Array.from(this.gestures.keys()))):console.log("Touch gestures not supported")}},I_=R_,A_=e=>{let{isOpen:s,onClose:n,onGesture:r}=e;const[i,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(new Set),[p,m]=(0,t.useState)({swipe:{minDistance:50,maxTime:500,maxAngle:30},pinch:{minScale:.5,maxScale:3},longPress:{duration:500},doubleTap:{maxTime:300}});(0,t.useEffect)(()=>{if(a(I_.isSupported),I_.isSupported){c([{name:"swipe-left",icon:E_,description:"Swipe left to go back"},{name:"swipe-right",icon:Py,description:"Swipe right to go forward"},{name:"swipe-up",icon:b_,description:"Swipe up to scroll up"},{name:"swipe-down",icon:w_,description:"Swipe down to scroll down"},{name:"pinch-in",icon:N_,description:"Pinch in to zoom out"},{name:"pinch-out",icon:S_,description:"Pinch out to zoom in"},{name:"long-press",icon:T_,description:"Long press for context menu"},{name:"double-tap",icon:C_,description:"Double tap to refresh"}]),I_.onSwipeLeft=e=>{x_.navigation(),null===r||void 0===r||r("swipe-left",e)},I_.onSwipeRight=e=>{x_.navigation(),null===r||void 0===r||r("swipe-right",e)},I_.onSwipeUp=e=>{x_.buttonPress(),null===r||void 0===r||r("swipe-up",e)},I_.onSwipeDown=e=>{x_.buttonPress(),null===r||void 0===r||r("swipe-down",e)},I_.onPinchIn=e=>{x_.buttonPress(),null===r||void 0===r||r("pinch-in",e)},I_.onPinchOut=e=>{x_.buttonPress(),null===r||void 0===r||r("pinch-out",e)},I_.onLongPress=e=>{x_.alert(),null===r||void 0===r||r("long-press",e)},I_.onDoubleTap=e=>{x_.buttonPress(),null===r||void 0===r||r("double-tap",e)}}return()=>{I_.onSwipeLeft=null,I_.onSwipeRight=null,I_.onSwipeUp=null,I_.onSwipeDown=null,I_.onPinchIn=null,I_.onPinchOut=null,I_.onLongPress=null,I_.onDoubleTap=null}},[r]);const f=(e,t,s)=>{const n=Le({},p);n[e]=Le(Le({},n[e]),{},{[t]:Number(s)}),m(n),I_.setThreshold(e,{[t]:Number(s)})};return s?(0,Kg.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Gesture Controls"}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>d(!l),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Kg.jsx)(Cy,{className:"w-4 h-4"})}),(0,Kg.jsx)("button",{onClick:n,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,Kg.jsx)(hy,{className:"w-4 h-4"})})]})]}),(0,Kg.jsxs)("div",{className:"p-4 space-y-4",children:[(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("div",{className:"w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center ".concat(i?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:(0,Kg.jsx)(T_,{className:"w-8 h-8"})}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:i?"Touch gestures enabled":"Touch gestures not supported"})]}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Available Gestures:"}),(0,Kg.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:o.map((e,t)=>{const s=e.icon,n=u.has(e.name);return(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border transition-colors ".concat(n?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50"),children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat(n?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"),children:(0,Kg.jsx)(s,{className:"w-4 h-4"})}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("div",{className:"text-sm font-medium text-gray-900 capitalize",children:e.name.replace("-"," ")}),(0,Kg.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Kg.jsx)("button",{onClick:()=>{return t=e.name,x_.buttonPress(),void(null===r||void 0===r||r(t,{test:!0}));var t},className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Test gesture",children:(0,Kg.jsx)(C_,{className:"w-3 h-3"})}),(0,Kg.jsx)("button",{onClick:()=>(e=>{const t=new Set(u);t.has(e)?(t.delete(e),I_.disableGesture(e)):(t.add(e),I_.enableGesture(e)),h(t),x_.buttonPress()})(e.name),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n?"bg-blue-600":"bg-gray-200"),children:(0,Kg.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n?"translate-x-6":"translate-x-1")})})]})]},t)})})]}),l&&(0,Kg.jsxs)("div",{className:"space-y-3 pt-3 border-t border-gray-200",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Gesture Sensitivity:"}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsx)("label",{className:"text-xs text-gray-600",children:"Swipe Distance (pixels)"}),(0,Kg.jsx)("input",{type:"range",min:"20",max:"100",value:p.swipe.minDistance,onChange:e=>f("swipe","minDistance",e.target.value),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,Kg.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[p.swipe.minDistance,"px"]})]}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsx)("label",{className:"text-xs text-gray-600",children:"Swipe Time (ms)"}),(0,Kg.jsx)("input",{type:"range",min:"200",max:"1000",value:p.swipe.maxTime,onChange:e=>f("swipe","maxTime",e.target.value),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,Kg.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[p.swipe.maxTime,"ms"]})]}),(0,Kg.jsxs)("div",{className:"space-y-2",children:[(0,Kg.jsx)("label",{className:"text-xs text-gray-600",children:"Long Press Duration (ms)"}),(0,Kg.jsx)("input",{type:"range",min:"300",max:"1000",value:p.longPress.duration,onChange:e=>f("longPress","duration",e.target.value),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,Kg.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[p.longPress.duration,"ms"]})]})]}),!i&&(0,Kg.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,Kg.jsx)("p",{className:"text-sm text-yellow-800",children:"Touch gestures are not supported on this device. This feature requires a touch screen."})}),(0,Kg.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,Kg.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"How to use:"}),(0,Kg.jsxs)("ul",{className:"text-xs text-blue-800 space-y-1",children:[(0,Kg.jsx)("li",{children:"\u2022 Swipe left/right to navigate"}),(0,Kg.jsx)("li",{children:"\u2022 Swipe up/down to scroll"}),(0,Kg.jsx)("li",{children:"\u2022 Pinch to zoom in/out"}),(0,Kg.jsx)("li",{children:"\u2022 Long press for context menu"}),(0,Kg.jsx)("li",{children:"\u2022 Double tap to refresh"})]})]})]})]})}):null},O_=e=>{let{onVoiceCommand:s,onGestureControl:n,onSettings:r,isOnline:i,isVoiceEnabled:a=!0,isGestureEnabled:o=!0,isHapticEnabled:c=!0}=e;const[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(!1);return(0,Kg.jsx)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40",children:(0,Kg.jsx)("div",{className:"bg-white rounded-full shadow-lg border border-gray-200 p-2",children:(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[a&&(0,Kg.jsx)("button",{onClick:()=>{d(!l),c&&x_.buttonPress(),null===s||void 0===s||s(!l)},className:"p-3 rounded-full transition-all duration-200 ".concat(l?"bg-blue-100 text-blue-600 shadow-md":"text-gray-600 hover:text-blue-600 hover:bg-blue-50"),title:l?"Stop voice commands":"Start voice commands",children:l?(0,Kg.jsx)(Lv,{className:"w-5 h-5"}):(0,Kg.jsx)(Mv,{className:"w-5 h-5"})}),o&&(0,Kg.jsx)("button",{onClick:()=>{h(!u),c&&x_.buttonPress(),null===n||void 0===n||n(!u)},className:"p-3 rounded-full transition-all duration-200 ".concat(u?"bg-green-100 text-green-600 shadow-md":"text-gray-600 hover:text-green-600 hover:bg-green-50"),title:u?"Disable gestures":"Enable gestures",children:(0,Kg.jsx)(T_,{className:"w-5 h-5"})}),(0,Kg.jsx)("div",{className:"p-3 rounded-full ".concat(i?"text-green-600 bg-green-50":"text-red-600 bg-red-50"),title:i?"Online":"Offline",children:i?(0,Kg.jsx)(m_,{className:"w-5 h-5"}):(0,Kg.jsx)(f_,{className:"w-5 h-5"})}),(0,Kg.jsx)("button",{onClick:()=>{c&&x_.buttonPress(),null===r||void 0===r||r()},className:"p-3 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-full transition-all duration-200",title:"Mobile settings",children:(0,Kg.jsx)(Cy,{className:"w-5 h-5"})})]})})})},j_=Qg("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]);const k_=new class{constructor(){this.maxLoginAttempts=Ag.get("security.maxLoginAttempts"),this.lockoutDuration=Ag.get("security.lockoutDuration"),this.sessionTimeout=Ag.get("security.sessionTimeout"),this.loginAttempts=new Map,this.lockedAccounts=new Map,this.activeSessions=new Map}async secureSignIn(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(this.isAccountLocked(e))throw new Error("Account is temporarily locked due to multiple failed attempts");if(this.getLoginAttempts(e)>=this.maxLoginAttempts)throw this.lockAccount(e),new Error("Too many failed login attempts. Account locked.");Tg.info("Attempting secure sign in",{email:e,userAgent:navigator.userAgent});const n=(await Ni(Pg,e,t)).user;this.resetLoginAttempts(e);const r=Le({userId:n.uid,email:n.email,loginTime:Date.now(),userAgent:navigator.userAgent,ipAddress:await this.getClientIP(),sessionId:Rg.generateSecureToken()},s);return this.activeSessions.set(n.uid,r),Tg.info("Secure sign in successful",{userId:n.uid,email:n.email,sessionId:r.sessionId}),this.setSessionTimeout(n.uid),{user:n,sessionData:r}}catch(n){throw this.incrementLoginAttempts(e),Tg.warn("Secure sign in failed",{email:e,error:n.message,attempts:this.getLoginAttempts(e)}),xg.handleError(n,{context:"secure_sign_in",email:e,attempts:this.getLoginAttempts(e)}),n}}async secureSignUp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{this.validatePasswordStrength(t),this.validateEmail(e),Tg.info("Attempting secure sign up",{email:e});const n=(await wi(Pg,e,t)).user,r=Rg.encryptHealthData(s);return Tg.info("Secure sign up successful",{userId:n.uid,email:n.email}),{user:n,encryptedUserData:r}}catch(n){throw Tg.error("Secure sign up failed",{email:e,error:n.message}),xg.handleError(n,{context:"secure_sign_up",email:e}),n}}async secureSignOut(){try{const e=Pg.currentUser;e&&(this.activeSessions.delete(e.uid),Tg.info("Secure sign out",{userId:e.uid})),await Ri(Pg)}catch(e){throw Tg.error("Secure sign out failed",{error:e.message}),xg.handleError(e,{context:"secure_sign_out"}),e}}validatePasswordStrength(e){const t=/[A-Z]/.test(e),s=/[a-z]/.test(e),n=/\d/.test(e),r=/[!@#$%^&*(),.?":{}|<>]/.test(e);if(e.length<8)throw new Error("Password must be at least ".concat(8," characters long"));if(!t)throw new Error("Password must contain at least one uppercase letter");if(!s)throw new Error("Password must contain at least one lowercase letter");if(!n)throw new Error("Password must contain at least one number");if(!r)throw new Error("Password must contain at least one special character");if(["password","123456","qwerty","admin","letmein"].includes(e.toLowerCase()))throw new Error("Password is too common. Please choose a stronger password")}validateEmail(e){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))throw new Error("Invalid email format")}async setupTwoFactorAuth(e){try{if(!Ag.isFeatureEnabled("twoFactorAuth"))throw new Error("Two-factor authentication is not enabled");const t=Pg.currentUser;if(!t)throw new Error("User must be signed in to setup 2FA");await ji(t).getSession();const s=new ua(Pg),n=await s.verifyPhoneNumber(e,new la("recaptcha-container",{size:"invisible"}));return Tg.info("2FA setup initiated",{userId:t.uid,phoneNumber:e}),n}catch(t){throw Tg.error("2FA setup failed",{error:t.message}),xg.handleError(t,{context:"setup_2fa"}),t}}async verifyTwoFactorAuth(e,t){try{const s=Pg.currentUser;if(!s)throw new Error("User must be signed in");const n=ua.credential(e,t),r=ji(s).assertion(n);return await ji(s).enroll(r),Tg.info("2FA verification successful",{userId:s.uid}),!0}catch(s){throw Tg.error("2FA verification failed",{error:s.message}),xg.handleError(s,{context:"verify_2fa"}),s}}setSessionTimeout(e){setTimeout(()=>{var t;this.activeSessions.has(e)&&(this.activeSessions.delete(e),Tg.info("Session expired",{userId:e}),(null===(t=Pg.currentUser)||void 0===t?void 0:t.uid)===e&&this.secureSignOut())},1e3*this.sessionTimeout)}isSessionValid(e){return this.activeSessions.has(e)}getSessionData(e){return this.activeSessions.get(e)}incrementLoginAttempts(e){const t=this.getLoginAttempts(e)+1;this.loginAttempts.set(e,{count:t,lastAttempt:Date.now()})}getLoginAttempts(e){const t=this.loginAttempts.get(e);return t?t.count:0}resetLoginAttempts(e){this.loginAttempts.delete(e)}lockAccount(e){this.lockedAccounts.set(e,Date.now()),Tg.warn("Account locked due to failed attempts",{email:e})}isAccountLocked(e){const t=this.lockedAccounts.get(e);if(!t)return!1;return!(Date.now()-t>1e3*this.lockoutDuration)||(this.lockedAccounts.delete(e),!1)}async getClientIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return"unknown"}}async securePasswordReset(e){try{await async function(e,t,s){const n=kr(e),r={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};s&&Ei(n,r,s),await Fr(n,r,"getOobCode",Yr)}(Pg,e),Tg.info("Password reset email sent",{email:e})}catch(t){throw Tg.error("Password reset failed",{email:e,error:t.message}),xg.handleError(t,{context:"password_reset",email:e}),t}}async securePasswordChange(e,t){try{const s=Pg.currentUser;if(!s||!s.email)throw new Error("User must be signed in");const n=ti.credential(s.email,e);await yi(s,n),this.validatePasswordStrength(t),await function(e,t){return Ti(Wt(e),null,t)}(s,t),Tg.info("Password changed successfully",{userId:s.uid})}catch(s){throw Tg.error("Password change failed",{error:s.message}),xg.handleError(s,{context:"password_change"}),s}}logSecurityEvent(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Le({timestamp:(new Date).toISOString(),event:e,userId:null===(t=Pg.currentUser)||void 0===t?void 0:t.uid,userAgent:navigator.userAgent,ipAddress:this.getClientIP()},s);Tg.info("Security event",n),Ag.get("isProduction")&&this.sendSecurityAlert(n)}async sendSecurityAlert(e){try{console.log("Security Alert:",e)}catch(t){Tg.error("Failed to send security alert",{error:t.message})}}},D_=k_,P_=()=>{const[e,s]=(0,t.useState)(!1),[n,r]=(0,t.useState)(!1),[i,a]=(0,t.useState)(""),[o,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(!1),[p,m]=(0,t.useState)({twoFactorAuth:!1,biometricAuth:!1,dataEncryption:!0,auditLogging:!0,rateLimiting:!0});(0,t.useEffect)(()=>{f()},[]);const f=()=>{const e=Ag.getFeatureFlags();m(e),s(e.twoFactorAuth),r(e.biometricAuth)};return(0,Kg.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Security Settings"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Manage your account security and privacy settings"})]}),(0,Kg.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6",children:(0,Kg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(Ry,{className:"h-8 w-8 text-blue-600"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Security Status"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Your account security overview"})]})]}),(0,Kg.jsxs)("div",{className:"flex items-center space-x-2",children:[p.dataEncryption&&(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"}),p.auditLogging&&(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"}),e&&(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"}),n&&(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]})]})}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(l_,{className:"h-6 w-6 text-blue-600"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Two-Factor Authentication"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Add an extra layer of security to your account"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-2",children:e?(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Kg.jsx)(Ly,{className:"h-3 w-3 mr-1"}),"Enabled"]}):(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,Kg.jsx)(mx,{className:"h-3 w-3 mr-1"}),"Disabled"]})})]}),!e&&!l&&(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,Kg.jsx)("input",{type:"tel",value:i,onChange:e=>a(e.target.value),placeholder:"+1 (555) 123-4567",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Kg.jsx)("button",{onClick:async()=>{if(i){h(!0);try{await D_.setupTwoFactorAuth(i);d(!0),yt.success("Verification code sent to your phone"),Tg.info("2FA setup initiated",{phoneNumber:i})}catch(e){yt.error("Failed to setup 2FA: "+e.message),Tg.error("2FA setup failed",{error:e.message})}finally{h(!1)}}else yt.error("Please enter your phone number")},disabled:u,className:"btn btn-primary",children:u?"Setting up...":"Enable 2FA"})]}),l&&(0,Kg.jsxs)("div",{className:"space-y-4",children:[(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Code"}),(0,Kg.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Enter 6-digit code",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,Kg.jsxs)("div",{className:"flex space-x-3",children:[(0,Kg.jsx)("button",{onClick:async()=>{if(o){h(!0);try{await D_.verifyTwoFactorAuth(o),s(!0),d(!1),yt.success("Two-factor authentication enabled successfully!"),Tg.info("2FA verification successful")}catch(e){yt.error("Verification failed: "+e.message),Tg.error("2FA verification failed",{error:e.message})}finally{h(!1)}}else yt.error("Please enter the verification code")},disabled:u,className:"btn btn-primary",children:u?"Verifying...":"Verify & Enable"}),(0,Kg.jsx)("button",{onClick:()=>d(!1),className:"btn btn-outline",children:"Cancel"})]})]})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(j_,{className:"h-6 w-6 text-green-600"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Biometric Authentication"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Use fingerprint or face recognition for quick access"})]})]}),(0,Kg.jsx)("div",{className:"flex items-center space-x-2",children:n?(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,Kg.jsx)(Ly,{className:"h-3 w-3 mr-1"}),"Enabled"]}):(0,Kg.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,Kg.jsx)(mx,{className:"h-3 w-3 mr-1"}),"Not Available"]})})]}),(0,Kg.jsx)("button",{onClick:async()=>{if(n)r(!1),yt.success("Biometric authentication disabled"),Tg.info("Biometric authentication disabled");else{if(!navigator.credentials||!navigator.credentials.create)return void yt.error("Biometric authentication not supported on this device");try{await navigator.credentials.create({publicKey:{challenge:new Uint8Array(32),rp:{name:"ElderX"},user:{id:new Uint8Array(16),name:"user@elderx.com",displayName:"ElderX User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required"}}});r(!0),yt.success("Biometric authentication enabled!"),Tg.info("Biometric authentication enabled")}catch(e){yt.error("Failed to enable biometric authentication: "+e.message),Tg.error("Biometric setup failed",{error:e.message})}}},disabled:u,className:"btn btn-outline",children:n?"Disable Biometric":"Enable Biometric"})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,Kg.jsx)(rv,{className:"h-6 w-6 text-purple-600"}),(0,Kg.jsxs)("div",{children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Password Management"}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600",children:"Change your password and manage security"})]})]}),(0,Kg.jsx)("button",{onClick:async()=>{const e=prompt("Enter current password:"),t=prompt("Enter new password:"),s=prompt("Confirm new password:");if(e&&t&&s)if(t===s){h(!0);try{await D_.securePasswordChange(e,t),yt.success("Password changed successfully!"),Tg.info("Password changed successfully")}catch(n){yt.error("Failed to change password: "+n.message),Tg.error("Password change failed",{error:n.message})}finally{h(!1)}}else yt.error("Passwords do not match");else yt.error("All fields are required")},disabled:u,className:"btn btn-outline",children:"Change Password"})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Security Features"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Data Encryption"}),(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Audit Logging"}),(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Rate Limiting"}),(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Session Timeout"}),(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]})]})]}),(0,Kg.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,Kg.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-3",children:"Security Tips"}),(0,Kg.jsxs)("ul",{className:"space-y-2 text-sm text-yellow-700",children:[(0,Kg.jsx)("li",{children:"\u2022 Use a strong, unique password for your account"}),(0,Kg.jsx)("li",{children:"\u2022 Enable two-factor authentication for extra security"}),(0,Kg.jsx)("li",{children:"\u2022 Keep your phone number updated for 2FA"}),(0,Kg.jsx)("li",{children:"\u2022 Log out from shared or public devices"}),(0,Kg.jsx)("li",{children:"\u2022 Report any suspicious activity immediately"})]})]})]})},L_=()=>{const[e,s]=(0,t.useState)([]),[n,r]=(0,t.useState)([]),[i,a]=(0,t.useState)({totalEvents:0,activeThreats:0,resolvedThreats:0,lastActivity:null}),[o,c]=(0,t.useState)(!0);(0,t.useEffect)(()=>{l(),d();const e=setInterval(l,3e4);return()=>{clearInterval(e),ry.removeAlertCallback(u)}},[]);const l=()=>{try{const e=ry.getActiveAlerts(),t=ry.getActiveThreats();s(e),r(t),a({totalEvents:e.length+t.length,activeThreats:t.length,resolvedThreats:0,lastActivity:(new Date).toISOString()}),c(!1)}catch(e){Tg.error("Failed to load security data",{error:e.message}),c(!1)}},d=()=>{ry.addAlertCallback(u)},u=e=>{s(t=>[e,...t]),yt.warning("Security Alert: ".concat(e.message),{position:"top-right",autoClose:1e4})},h=e=>{switch(e){case"HIGH":return"text-red-600 bg-red-100";case"MEDIUM":return"text-yellow-600 bg-yellow-100";case"LOW":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},p=e=>{switch(e){case"HIGH":case"MEDIUM":return(0,Kg.jsx)(Zg,{className:"h-4 w-4"});case"LOW":return(0,Kg.jsx)(Ly,{className:"h-4 w-4"});default:return(0,Kg.jsx)(Ry,{className:"h-4 w-4"})}};return o?(0,Kg.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Kg.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,Kg.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[(0,Kg.jsxs)("div",{className:"text-center",children:[(0,Kg.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Security Dashboard"}),(0,Kg.jsx)("p",{className:"text-gray-600",children:"Monitor security events and threats in real-time"})]}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,Kg.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,Kg.jsx)(_y,{className:"h-6 w-6 text-blue-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Events"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i.totalEvents})]})]})}),(0,Kg.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,Kg.jsx)(Zg,{className:"h-6 w-6 text-red-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Threats"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i.activeThreats})]})]})}),(0,Kg.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,Kg.jsx)(Ly,{className:"h-6 w-6 text-green-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Resolved"}),(0,Kg.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i.resolvedThreats})]})]})}),(0,Kg.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,Kg.jsxs)("div",{className:"flex items-center",children:[(0,Kg.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,Kg.jsx)(Dy,{className:"h-6 w-6 text-purple-600"})}),(0,Kg.jsxs)("div",{className:"ml-4",children:[(0,Kg.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Last Activity"}),(0,Kg.jsx)("p",{className:"text-sm font-bold text-gray-900",children:i.lastActivity?new Date(i.lastActivity).toLocaleTimeString():"N/A"})]})]})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Kg.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Active Security Alerts"})}),(0,Kg.jsx)("div",{className:"p-6",children:0===e.length?(0,Kg.jsxs)("div",{className:"text-center py-8",children:[(0,Kg.jsx)(Ry,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,Kg.jsx)("p",{className:"text-gray-500",children:"No active security alerts"})]}):(0,Kg.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"p-2 rounded-lg ".concat(h(e.severity)),children:p(e.severity)}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.type}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),(0,Kg.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:new Date(e.timestamp).toLocaleString()}),e.actions&&e.actions.length>0&&(0,Kg.jsxs)("div",{className:"mt-2",children:[(0,Kg.jsx)("p",{className:"text-xs text-gray-500",children:"Recommended Actions:"}),(0,Kg.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.actions.map((e,t)=>(0,Kg.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e},t))})]})]})]}),(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,ry.dismissAlert(t),s(e=>e.filter(e=>e.id!==t)),void yt.success("Alert dismissed");var t},className:"text-gray-400 hover:text-gray-600",children:(0,Kg.jsx)(rv,{className:"h-4 w-4"})})]})},e.id))})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,Kg.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Active Security Threats"})}),(0,Kg.jsx)("div",{className:"p-6",children:0===n.length?(0,Kg.jsxs)("div",{className:"text-center py-8",children:[(0,Kg.jsx)(Ly,{className:"h-12 w-12 text-green-400 mx-auto mb-4"}),(0,Kg.jsx)("p",{className:"text-gray-500",children:"No active security threats"})]}):(0,Kg.jsx)("div",{className:"space-y-4",children:n.map(e=>(0,Kg.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,Kg.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Kg.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Kg.jsx)("div",{className:"p-2 rounded-lg ".concat(h(e.severity)),children:p(e.severity)}),(0,Kg.jsxs)("div",{className:"flex-1",children:[(0,Kg.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.type}),(0,Kg.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,Kg.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Detected: ",new Date(e.detectedAt).toLocaleString()]}),e.events&&e.events.length>0&&(0,Kg.jsx)("div",{className:"mt-2",children:(0,Kg.jsxs)("p",{className:"text-xs text-gray-500",children:["Related Events: ",e.events.length]})})]})]}),(0,Kg.jsx)("button",{onClick:()=>{return t=e.id,ry.resolveThreat(t),r(e=>e.filter(e=>e.id!==t)),void yt.success("Threat resolved");var t},className:"text-green-600 hover:text-green-800",children:(0,Kg.jsx)(Ly,{className:"h-4 w-4"})})]})},e.id))})})]}),(0,Kg.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,Kg.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Security Features Status"}),(0,Kg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(Wy,{className:"h-5 w-5 text-green-600"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Data Encryption"})]}),(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(Ry,{className:"h-5 w-5 text-green-600"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Audit Logging"})]}),(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]}),(0,Kg.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,Kg.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Kg.jsx)(_y,{className:"h-5 w-5 text-green-600"}),(0,Kg.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Real-time Monitoring"})]}),(0,Kg.jsx)(Ly,{className:"h-5 w-5 text-green-500"})]})]})]})]})};const M_=function(){const[e,s]=co(Pg),[n,r]=(0,t.useState)(!1),[i,a]=(0,t.useState)(!1),[o,c]=(0,t.useState)(navigator.onLine),[l,d]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{try{h_.init(),Tg.info("PWA services initialized successfully"),ry.initialize(),ay.initialize(),ry.logSecurityEvent("APP_INITIALIZATION",{timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,features:Ag.getFeatureFlags()}),Tg.info("Security services initialized successfully")}catch(n){xg.handleError(n,{context:"pwa_initialization"})}const e=()=>{try{d(window.innerWidth<=768||"ontouchstart"in window)}catch(n){xg.handleError(n,{context:"mobile_detection"})}};e(),window.addEventListener("resize",e);const t=()=>{c(!0),Tg.info("App is back online")},s=()=>{c(!1),Tg.warn("App is offline")};if(window.addEventListener("online",t),window.addEventListener("offline",s),"Notification"in window&&"default"===Notification.permission)try{h_.requestNotificationPermission()}catch(n){xg.handleError(n,{context:"notification_permission"})}return()=>{window.removeEventListener("resize",e),window.removeEventListener("online",t),window.removeEventListener("offline",s)}},[]),s?(0,Kg.jsx)(c_,{}):(0,Kg.jsx)(sy,{name:"App",children:(0,Kg.jsxs)(Yg,{children:[(0,Kg.jsx)(o_,{}),(0,Kg.jsx)(p_,{}),(0,Kg.jsx)(g_,{}),l&&e&&(0,Kg.jsx)(O_,{onVoiceCommand:e=>r(e),onGestureControl:e=>a(e),onSettings:()=>{},isOnline:o,isVoiceEnabled:v_.isSupported,isGestureEnabled:I_.isSupported,isHapticEnabled:x_.isSupported}),(0,Kg.jsx)(__,{isOpen:n,onClose:()=>r(!1),onCommand:(e,t)=>{switch(console.log("Voice command received:",e,t),e){case"call":window.location.href="/service-provider/calls";break;case"endCall":case"answerCall":case"rejectCall":case"completeTask":case"assignTask":case"help":break;case"sendMessage":case"readMessages":window.location.href="/service-provider/messages";break;case"navigate":if(t.text){const e=t.text.toLowerCase();e.includes("patient")?window.location.href="/service-provider/patients":e.includes("schedule")?window.location.href="/service-provider/schedule":e.includes("task")&&(window.location.href="/service-provider/tasks")}break;case"back":window.history.back();break;case"home":window.location.href="/service-provider";break;case"emergency":window.location.href="/service-provider/emergency";break;case"medication":window.location.href="/service-provider/prescriptions";break;case"vitalSigns":window.location.href="/service-provider/diagnostics";break;default:console.log("Unknown voice command:",e)}}}),(0,Kg.jsx)(A_,{isOpen:i,onClose:()=>a(!1),onGesture:(e,t)=>{switch(console.log("Gesture received:",e,t),e){case"swipe-left":window.history.back();break;case"swipe-right":window.history.forward();break;case"swipe-up":window.scrollBy(0,-100);break;case"swipe-down":window.scrollBy(0,100);break;case"pinch-in":document.body.style.zoom=Math.max(.5,parseFloat(document.body.style.zoom||1)-.1);break;case"pinch-out":document.body.style.zoom=Math.min(2,parseFloat(document.body.style.zoom||1)+.1);break;case"long-press":break;case"double-tap":window.location.reload();break;default:console.log("Unknown gesture:",e)}}}),(0,Kg.jsxs)(xe,{children:[(0,Kg.jsx)(ye,{path:"/",element:(0,Kg.jsx)(By,{})}),(0,Kg.jsx)(ye,{path:"/login",element:e?(0,Kg.jsx)(fe,{to:"/dashboard",replace:!0}):(0,Kg.jsx)(Hy,{})}),(0,Kg.jsx)(ye,{path:"/signup",element:e?(0,Kg.jsx)(fe,{to:"/dashboard",replace:!0}):(0,Kg.jsx)(Ky,{})}),(0,Kg.jsx)(ye,{path:"/dashboard",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(zy,{})})}),(0,Kg.jsx)(ye,{path:"/medications",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(Qy,{})})}),(0,Kg.jsx)(ye,{path:"/vital-signs",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(ev,{})})}),(0,Kg.jsx)(ye,{path:"/appointments",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(sv,{})})}),(0,Kg.jsx)(ye,{path:"/telemedicine",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(Qv,{})})}),(0,Kg.jsx)(ye,{path:"/profile",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(nv,{})})}),(0,Kg.jsx)(ye,{path:"/messages",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)($v,{})})}),(0,Kg.jsx)(ye,{path:"/subscription",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(tx,{})})}),(0,Kg.jsx)(ye,{path:"/security",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(P_,{})})}),(0,Kg.jsx)(ye,{path:"/security-dashboard",element:e?(0,Kg.jsx)(yy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(L_,{})})}),(0,Kg.jsxs)(ye,{path:"/caregiver",element:e?(0,Kg.jsx)(Zv,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(av,{})}),(0,Kg.jsx)(ye,{path:"schedule",element:(0,Kg.jsx)(dv,{})}),(0,Kg.jsx)(ye,{path:"patients",element:(0,Kg.jsx)(hv,{})}),(0,Kg.jsx)(ye,{path:"tasks",element:(0,Kg.jsx)(pv,{})}),(0,Kg.jsx)(ye,{path:"messages",element:(0,Kg.jsx)(_v,{})}),(0,Kg.jsx)(ye,{path:"navigation",element:(0,Kg.jsx)(Nv,{})}),(0,Kg.jsx)(ye,{path:"photos",element:(0,Kg.jsx)(Rv,{})}),(0,Kg.jsx)(ye,{path:"performance",element:(0,Kg.jsx)(Iv,{})}),(0,Kg.jsx)(ye,{path:"emergency",element:(0,Kg.jsx)(Av,{})}),(0,Kg.jsx)(ye,{path:"settings",element:(0,Kg.jsx)(kv,{})})]}),(0,Kg.jsxs)(ye,{path:"/service-provider",element:e?(0,Kg.jsx)(ky,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(Kx,{})}),(0,Kg.jsx)(ye,{path:"schedule",element:(0,Kg.jsx)(dv,{})}),(0,Kg.jsx)(ye,{path:"patients",element:(0,Kg.jsx)(hv,{})}),(0,Kg.jsx)(ye,{path:"messages",element:(0,Kg.jsx)(a_,{})}),(0,Kg.jsx)(ye,{path:"calls",element:(0,Kg.jsx)(i_,{})}),(0,Kg.jsx)(ye,{path:"tasks",element:(0,Kg.jsx)(pv,{})}),(0,Kg.jsx)(ye,{path:"care-logs",element:(0,Kg.jsx)(Rv,{})}),(0,Kg.jsx)(ye,{path:"photos",element:(0,Kg.jsx)(Rv,{})}),(0,Kg.jsx)(ye,{path:"activities",element:(0,Kg.jsx)(Iv,{})}),(0,Kg.jsx)(ye,{path:"medical-records",element:(0,Kg.jsx)(hv,{})}),(0,Kg.jsx)(ye,{path:"prescriptions",element:(0,Kg.jsx)(Qy,{})}),(0,Kg.jsx)(ye,{path:"consultations",element:(0,Kg.jsx)(sv,{})}),(0,Kg.jsx)(ye,{path:"diagnostics",element:(0,Kg.jsx)(ev,{})}),(0,Kg.jsx)(ye,{path:"settings",element:(0,Kg.jsx)(kv,{})})]}),(0,Kg.jsx)(ye,{path:"/services",element:(0,Kg.jsx)(sx,{})}),(0,Kg.jsx)(ye,{path:"/pricing",element:(0,Kg.jsx)(nx,{})}),(0,Kg.jsxs)(ye,{path:"/admin",element:e?(0,Kg.jsx)(Iy,{}):(0,Kg.jsx)(fe,{to:"/login",replace:!0}),children:[(0,Kg.jsx)(ye,{index:!0,element:(0,Kg.jsx)(ix,{})}),(0,Kg.jsx)(ye,{path:"users",element:(0,Kg.jsx)(hx,{})}),(0,Kg.jsx)(ye,{path:"user-management",element:(0,Kg.jsx)(qx,{})}),(0,Kg.jsx)(ye,{path:"appointments",element:(0,Kg.jsx)(fx,{})}),(0,Kg.jsx)(ye,{path:"emergency",element:(0,Kg.jsx)(vx,{})}),(0,Kg.jsx)(ye,{path:"emergency/protocols",element:(0,Kg.jsx)(_x,{})}),(0,Kg.jsx)(ye,{path:"medications",element:(0,Kg.jsx)(bx,{})}),(0,Kg.jsx)(ye,{path:"medications/analytics",element:(0,Kg.jsx)(wx,{})}),(0,Kg.jsx)(ye,{path:"caregivers",element:(0,Kg.jsx)(Nx,{})}),(0,Kg.jsx)(ye,{path:"analytics",element:(0,Kg.jsx)(Cx,{})}),(0,Kg.jsx)(ye,{path:"communication",element:(0,Kg.jsx)(Ox,{})}),(0,Kg.jsx)(ye,{path:"audit-logs",element:(0,Kg.jsx)(kx,{})}),(0,Kg.jsx)(ye,{path:"reports",element:(0,Kg.jsx)(px,{})}),(0,Kg.jsx)(ye,{path:"settings",element:(0,Kg.jsx)(yx,{})})]}),(0,Kg.jsx)(ye,{path:"*",element:(0,Kg.jsx)(fe,{to:"/",replace:!0})})]})]})})},U_=new Oe.QueryClient;(0,r.H)(document.getElementById("root")).render((0,Kg.jsx)(t.StrictMode,{children:(0,Kg.jsx)(Oe.QueryClientProvider,{client:U_,children:(0,Kg.jsxs)(Se,{children:[(0,Kg.jsx)(M_,{}),(0,Kg.jsx)(ot,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})})}))})()})();
//# sourceMappingURL=main.00f0e65a.js.map